function w_e(n,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var oE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function y0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var DM={exports:{}},Xb={},LM={exports:{}},hr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var w$;function R_e(){if(w$)return hr;w$=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(Ae){return Ae===null||typeof Ae!="object"?null:(Ae=A&&Ae[A]||Ae["@@iterator"],typeof Ae=="function"?Ae:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,B={};function G(Ae,Ie,be){this.props=Ae,this.context=Ie,this.refs=B,this.updater=be||F}G.prototype.isReactComponent={},G.prototype.setState=function(Ae,Ie){if(typeof Ae!="object"&&typeof Ae!="function"&&Ae!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ae,Ie,"setState")},G.prototype.forceUpdate=function(Ae){this.updater.enqueueForceUpdate(this,Ae,"forceUpdate")};function J(){}J.prototype=G.prototype;function K(Ae,Ie,be){this.props=Ae,this.context=Ie,this.refs=B,this.updater=be||F}var ne=K.prototype=new J;ne.constructor=K,j(ne,G.prototype),ne.isPureReactComponent=!0;var de=Array.isArray,oe=Object.prototype.hasOwnProperty,_e={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function ee(Ae,Ie,be){var xe,We={},Qe=null,Ze=null;if(Ie!=null)for(xe in Ie.ref!==void 0&&(Ze=Ie.ref),Ie.key!==void 0&&(Qe=""+Ie.key),Ie)oe.call(Ie,xe)&&!Z.hasOwnProperty(xe)&&(We[xe]=Ie[xe]);var ut=arguments.length-2;if(ut===1)We.children=be;else if(1<ut){for(var it=Array(ut),It=0;It<ut;It++)it[It]=arguments[It+2];We.children=it}if(Ae&&Ae.defaultProps)for(xe in ut=Ae.defaultProps,ut)We[xe]===void 0&&(We[xe]=ut[xe]);return{$$typeof:n,type:Ae,key:Qe,ref:Ze,props:We,_owner:_e.current}}function te(Ae,Ie){return{$$typeof:n,type:Ae.type,key:Ie,ref:Ae.ref,props:Ae.props,_owner:Ae._owner}}function ce(Ae){return typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===n}function me(Ae){var Ie={"=":"=0",":":"=2"};return"$"+Ae.replace(/[=:]/g,function(be){return Ie[be]})}var he=/\/+/g;function se(Ae,Ie){return typeof Ae=="object"&&Ae!==null&&Ae.key!=null?me(""+Ae.key):Ie.toString(36)}function Se(Ae,Ie,be,xe,We){var Qe=typeof Ae;(Qe==="undefined"||Qe==="boolean")&&(Ae=null);var Ze=!1;if(Ae===null)Ze=!0;else switch(Qe){case"string":case"number":Ze=!0;break;case"object":switch(Ae.$$typeof){case n:case t:Ze=!0}}if(Ze)return Ze=Ae,We=We(Ze),Ae=xe===""?"."+se(Ze,0):xe,de(We)?(be="",Ae!=null&&(be=Ae.replace(he,"$&/")+"/"),Se(We,Ie,be,"",function(It){return It})):We!=null&&(ce(We)&&(We=te(We,be+(!We.key||Ze&&Ze.key===We.key?"":(""+We.key).replace(he,"$&/")+"/")+Ae)),Ie.push(We)),1;if(Ze=0,xe=xe===""?".":xe+":",de(Ae))for(var ut=0;ut<Ae.length;ut++){Qe=Ae[ut];var it=xe+se(Qe,ut);Ze+=Se(Qe,Ie,be,it,We)}else if(it=N(Ae),typeof it=="function")for(Ae=it.call(Ae),ut=0;!(Qe=Ae.next()).done;)Qe=Qe.value,it=xe+se(Qe,ut++),Ze+=Se(Qe,Ie,be,it,We);else if(Qe==="object")throw Ie=String(Ae),Error("Objects are not valid as a React child (found: "+(Ie==="[object Object]"?"object with keys {"+Object.keys(Ae).join(", ")+"}":Ie)+"). If you meant to render a collection of children, use an array instead.");return Ze}function Ve(Ae,Ie,be){if(Ae==null)return Ae;var xe=[],We=0;return Se(Ae,xe,"","",function(Qe){return Ie.call(be,Qe,We++)}),xe}function tt(Ae){if(Ae._status===-1){var Ie=Ae._result;Ie=Ie(),Ie.then(function(be){(Ae._status===0||Ae._status===-1)&&(Ae._status=1,Ae._result=be)},function(be){(Ae._status===0||Ae._status===-1)&&(Ae._status=2,Ae._result=be)}),Ae._status===-1&&(Ae._status=0,Ae._result=Ie)}if(Ae._status===1)return Ae._result.default;throw Ae._result}var ke={current:null},Me={transition:null},Ce={ReactCurrentDispatcher:ke,ReactCurrentBatchConfig:Me,ReactCurrentOwner:_e};function Xe(){throw Error("act(...) is not supported in production builds of React.")}return hr.Children={map:Ve,forEach:function(Ae,Ie,be){Ve(Ae,function(){Ie.apply(this,arguments)},be)},count:function(Ae){var Ie=0;return Ve(Ae,function(){Ie++}),Ie},toArray:function(Ae){return Ve(Ae,function(Ie){return Ie})||[]},only:function(Ae){if(!ce(Ae))throw Error("React.Children.only expected to receive a single React element child.");return Ae}},hr.Component=G,hr.Fragment=s,hr.Profiler=l,hr.PureComponent=K,hr.StrictMode=a,hr.Suspense=v,hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ce,hr.act=Xe,hr.cloneElement=function(Ae,Ie,be){if(Ae==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ae+".");var xe=j({},Ae.props),We=Ae.key,Qe=Ae.ref,Ze=Ae._owner;if(Ie!=null){if(Ie.ref!==void 0&&(Qe=Ie.ref,Ze=_e.current),Ie.key!==void 0&&(We=""+Ie.key),Ae.type&&Ae.type.defaultProps)var ut=Ae.type.defaultProps;for(it in Ie)oe.call(Ie,it)&&!Z.hasOwnProperty(it)&&(xe[it]=Ie[it]===void 0&&ut!==void 0?ut[it]:Ie[it])}var it=arguments.length-2;if(it===1)xe.children=be;else if(1<it){ut=Array(it);for(var It=0;It<it;It++)ut[It]=arguments[It+2];xe.children=ut}return{$$typeof:n,type:Ae.type,key:We,ref:Qe,props:xe,_owner:Ze}},hr.createContext=function(Ae){return Ae={$$typeof:p,_currentValue:Ae,_currentValue2:Ae,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ae.Provider={$$typeof:d,_context:Ae},Ae.Consumer=Ae},hr.createElement=ee,hr.createFactory=function(Ae){var Ie=ee.bind(null,Ae);return Ie.type=Ae,Ie},hr.createRef=function(){return{current:null}},hr.forwardRef=function(Ae){return{$$typeof:E,render:Ae}},hr.isValidElement=ce,hr.lazy=function(Ae){return{$$typeof:w,_payload:{_status:-1,_result:Ae},_init:tt}},hr.memo=function(Ae,Ie){return{$$typeof:T,type:Ae,compare:Ie===void 0?null:Ie}},hr.startTransition=function(Ae){var Ie=Me.transition;Me.transition={};try{Ae()}finally{Me.transition=Ie}},hr.unstable_act=Xe,hr.useCallback=function(Ae,Ie){return ke.current.useCallback(Ae,Ie)},hr.useContext=function(Ae){return ke.current.useContext(Ae)},hr.useDebugValue=function(){},hr.useDeferredValue=function(Ae){return ke.current.useDeferredValue(Ae)},hr.useEffect=function(Ae,Ie){return ke.current.useEffect(Ae,Ie)},hr.useId=function(){return ke.current.useId()},hr.useImperativeHandle=function(Ae,Ie,be){return ke.current.useImperativeHandle(Ae,Ie,be)},hr.useInsertionEffect=function(Ae,Ie){return ke.current.useInsertionEffect(Ae,Ie)},hr.useLayoutEffect=function(Ae,Ie){return ke.current.useLayoutEffect(Ae,Ie)},hr.useMemo=function(Ae,Ie){return ke.current.useMemo(Ae,Ie)},hr.useReducer=function(Ae,Ie,be){return ke.current.useReducer(Ae,Ie,be)},hr.useRef=function(Ae){return ke.current.useRef(Ae)},hr.useState=function(Ae){return ke.current.useState(Ae)},hr.useSyncExternalStore=function(Ae,Ie,be){return ke.current.useSyncExternalStore(Ae,Ie,be)},hr.useTransition=function(){return ke.current.useTransition()},hr.version="18.3.1",hr}var R$;function Cu(){return R$||(R$=1,LM.exports=R_e()),LM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C$;function C_e(){if(C$)return Xb;C$=1;var n=Cu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(E,v,T){var w,A={},N=null,F=null;T!==void 0&&(N=""+T),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(E&&E.defaultProps)for(w in v=E.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:t,type:E,key:N,ref:F,props:A,_owner:l.current}}return Xb.Fragment=s,Xb.jsx=p,Xb.jsxs=p,Xb}var I$;function I_e(){return I$||(I$=1,DM.exports=C_e()),DM.exports}var I=I_e(),L=Cu();const ti=y0(L),A$=w_e({__proto__:null,default:ti},[L]);var qP={},xM={exports:{}},Wc={},MM={exports:{}},UM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var P$;function A_e(){return P$||(P$=1,function(n){function t(Me,Ce){var Xe=Me.length;Me.push(Ce);e:for(;0<Xe;){var Ae=Xe-1>>>1,Ie=Me[Ae];if(0<l(Ie,Ce))Me[Ae]=Ce,Me[Xe]=Ie,Xe=Ae;else break e}}function s(Me){return Me.length===0?null:Me[0]}function a(Me){if(Me.length===0)return null;var Ce=Me[0],Xe=Me.pop();if(Xe!==Ce){Me[0]=Xe;e:for(var Ae=0,Ie=Me.length,be=Ie>>>1;Ae<be;){var xe=2*(Ae+1)-1,We=Me[xe],Qe=xe+1,Ze=Me[Qe];if(0>l(We,Xe))Qe<Ie&&0>l(Ze,We)?(Me[Ae]=Ze,Me[Qe]=Xe,Ae=Qe):(Me[Ae]=We,Me[xe]=Xe,Ae=xe);else if(Qe<Ie&&0>l(Ze,Xe))Me[Ae]=Ze,Me[Qe]=Xe,Ae=Qe;else break e}}return Ce}function l(Me,Ce){var Xe=Me.sortIndex-Ce.sortIndex;return Xe!==0?Xe:Me.id-Ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,E=p.now();n.unstable_now=function(){return p.now()-E}}var v=[],T=[],w=1,A=null,N=3,F=!1,j=!1,B=!1,G=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Me){for(var Ce=s(T);Ce!==null;){if(Ce.callback===null)a(T);else if(Ce.startTime<=Me)a(T),Ce.sortIndex=Ce.expirationTime,t(v,Ce);else break;Ce=s(T)}}function de(Me){if(B=!1,ne(Me),!j)if(s(v)!==null)j=!0,tt(oe);else{var Ce=s(T);Ce!==null&&ke(de,Ce.startTime-Me)}}function oe(Me,Ce){j=!1,B&&(B=!1,J(ee),ee=-1),F=!0;var Xe=N;try{for(ne(Ce),A=s(v);A!==null&&(!(A.expirationTime>Ce)||Me&&!me());){var Ae=A.callback;if(typeof Ae=="function"){A.callback=null,N=A.priorityLevel;var Ie=Ae(A.expirationTime<=Ce);Ce=n.unstable_now(),typeof Ie=="function"?A.callback=Ie:A===s(v)&&a(v),ne(Ce)}else a(v);A=s(v)}if(A!==null)var be=!0;else{var xe=s(T);xe!==null&&ke(de,xe.startTime-Ce),be=!1}return be}finally{A=null,N=Xe,F=!1}}var _e=!1,Z=null,ee=-1,te=5,ce=-1;function me(){return!(n.unstable_now()-ce<te)}function he(){if(Z!==null){var Me=n.unstable_now();ce=Me;var Ce=!0;try{Ce=Z(!0,Me)}finally{Ce?se():(_e=!1,Z=null)}}else _e=!1}var se;if(typeof K=="function")se=function(){K(he)};else if(typeof MessageChannel<"u"){var Se=new MessageChannel,Ve=Se.port2;Se.port1.onmessage=he,se=function(){Ve.postMessage(null)}}else se=function(){G(he,0)};function tt(Me){Z=Me,_e||(_e=!0,se())}function ke(Me,Ce){ee=G(function(){Me(n.unstable_now())},Ce)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Me){Me.callback=null},n.unstable_continueExecution=function(){j||F||(j=!0,tt(oe))},n.unstable_forceFrameRate=function(Me){0>Me||125<Me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<Me?Math.floor(1e3/Me):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return s(v)},n.unstable_next=function(Me){switch(N){case 1:case 2:case 3:var Ce=3;break;default:Ce=N}var Xe=N;N=Ce;try{return Me()}finally{N=Xe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Me,Ce){switch(Me){case 1:case 2:case 3:case 4:case 5:break;default:Me=3}var Xe=N;N=Me;try{return Ce()}finally{N=Xe}},n.unstable_scheduleCallback=function(Me,Ce,Xe){var Ae=n.unstable_now();switch(typeof Xe=="object"&&Xe!==null?(Xe=Xe.delay,Xe=typeof Xe=="number"&&0<Xe?Ae+Xe:Ae):Xe=Ae,Me){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=Xe+Ie,Me={id:w++,callback:Ce,priorityLevel:Me,startTime:Xe,expirationTime:Ie,sortIndex:-1},Xe>Ae?(Me.sortIndex=Xe,t(T,Me),s(v)===null&&Me===s(T)&&(B?(J(ee),ee=-1):B=!0,ke(de,Xe-Ae))):(Me.sortIndex=Ie,t(v,Me),j||F||(j=!0,tt(oe))),Me},n.unstable_shouldYield=me,n.unstable_wrapCallback=function(Me){var Ce=N;return function(){var Xe=N;N=Ce;try{return Me.apply(this,arguments)}finally{N=Xe}}}}(UM)),UM}var O$;function P_e(){return O$||(O$=1,MM.exports=A_e()),MM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k$;function O_e(){if(k$)return Wc;k$=1;var n=Cu(),t=P_e();function s(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,b=1;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(f){return v.call(A,f)?!0:v.call(w,f)?!1:T.test(f)?A[f]=!0:(w[f]=!0,!1)}function F(f,g,b,O){if(b!==null&&b.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:b!==null?!b.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function j(f,g,b,O){if(g===null||typeof g>"u"||F(f,g,b,O))return!0;if(O)return!1;if(b!==null)switch(b.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,b,O,M,H,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=f,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ae}var G={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){G[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];G[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){G[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){G[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){G[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){G[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){G[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){G[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){G[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function K(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(J,K);G[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(J,K);G[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(J,K);G[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){G[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),G.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){G[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function ne(f,g,b,O){var M=G.hasOwnProperty(g)?G[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,b,M,O)&&(b=null),O||M===null?N(g)&&(b===null?f.removeAttribute(g):f.setAttribute(g,""+b)):M.mustUseProperty?f[M.propertyName]=b===null?M.type===3?!1:"":b:(g=M.attributeName,O=M.attributeNamespace,b===null?f.removeAttribute(g):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,O?f.setAttributeNS(O,g,b):f.setAttribute(g,b))))}var de=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),_e=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),ce=Symbol.for("react.provider"),me=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),Ve=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),ke=Symbol.for("react.offscreen"),Me=Symbol.iterator;function Ce(f){return f===null||typeof f!="object"?null:(f=Me&&f[Me]||f["@@iterator"],typeof f=="function"?f:null)}var Xe=Object.assign,Ae;function Ie(f){if(Ae===void 0)try{throw Error()}catch(b){var g=b.stack.trim().match(/\n( *(at )?)/);Ae=g&&g[1]||""}return`
`+Ae+f}var be=!1;function xe(f,g){if(!f||be)return"";be=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(nt){var O=nt}Reflect.construct(f,[],g)}else{try{g.call()}catch(nt){O=nt}f.call(g.prototype)}else{try{throw Error()}catch(nt){O=nt}f()}}catch(nt){if(nt&&O&&typeof nt.stack=="string"){for(var M=nt.stack.split(`
`),H=O.stack.split(`
`),ae=M.length-1,Te=H.length-1;1<=ae&&0<=Te&&M[ae]!==H[Te];)Te--;for(;1<=ae&&0<=Te;ae--,Te--)if(M[ae]!==H[Te]){if(ae!==1||Te!==1)do if(ae--,Te--,0>Te||M[ae]!==H[Te]){var Le=`
`+M[ae].replace(" at new "," at ");return f.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",f.displayName)),Le}while(1<=ae&&0<=Te);break}}}finally{be=!1,Error.prepareStackTrace=b}return(f=f?f.displayName||f.name:"")?Ie(f):""}function We(f){switch(f.tag){case 5:return Ie(f.type);case 16:return Ie("Lazy");case 13:return Ie("Suspense");case 19:return Ie("SuspenseList");case 0:case 2:case 15:return f=xe(f.type,!1),f;case 11:return f=xe(f.type.render,!1),f;case 1:return f=xe(f.type,!0),f;default:return""}}function Qe(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Z:return"Fragment";case _e:return"Portal";case te:return"Profiler";case ee:return"StrictMode";case se:return"Suspense";case Se:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case me:return(f.displayName||"Context")+".Consumer";case ce:return(f._context.displayName||"Context")+".Provider";case he:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ve:return g=f.displayName||null,g!==null?g:Qe(f.type)||"Memo";case tt:g=f._payload,f=f._init;try{return Qe(f(g))}catch{}}return null}function Ze(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qe(g);case 8:return g===ee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function it(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function It(f){var g=it(f)?"checked":"value",b=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),O=""+f[g];if(!f.hasOwnProperty(g)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,H=b.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,H.call(this,ae)}}),Object.defineProperty(f,g,{enumerable:b.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function yn(f){f._valueTracker||(f._valueTracker=It(f))}function Vt(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var b=g.getValue(),O="";return f&&(O=it(f)?f.checked?"true":"false":f.value),f=O,f!==b?(g.setValue(f),!0):!1}function ln(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function xn(f,g){var b=g.checked;return Xe({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??f._wrapperState.initialChecked})}function Qt(f,g){var b=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;b=ut(g.value!=null?g.value:b),f._wrapperState={initialChecked:O,initialValue:b,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Ot(f,g){g=g.checked,g!=null&&ne(f,"checked",g,!1)}function Dt(f,g){Ot(f,g);var b=ut(g.value),O=g.type;if(b!=null)O==="number"?(b===0&&f.value===""||f.value!=b)&&(f.value=""+b):f.value!==""+b&&(f.value=""+b);else if(O==="submit"||O==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Ue(f,g.type,b):g.hasOwnProperty("defaultValue")&&Ue(f,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function ve(f,g,b){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,b||g===f.value||(f.value=g),f.defaultValue=g}b=f.name,b!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,b!==""&&(f.name=b)}function Ue(f,g,b){(g!=="number"||ln(f.ownerDocument)!==f)&&(b==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+b&&(f.defaultValue=""+b))}var He=Array.isArray;function _t(f,g,b,O){if(f=f.options,g){g={};for(var M=0;M<b.length;M++)g["$"+b[M]]=!0;for(b=0;b<f.length;b++)M=g.hasOwnProperty("$"+f[b].value),f[b].selected!==M&&(f[b].selected=M),M&&O&&(f[b].defaultSelected=!0)}else{for(b=""+ut(b),g=null,M=0;M<f.length;M++){if(f[M].value===b){f[M].selected=!0,O&&(f[M].defaultSelected=!0);return}g!==null||f[M].disabled||(g=f[M])}g!==null&&(g.selected=!0)}}function vt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return Xe({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function St(f,g){var b=g.value;if(b==null){if(b=g.children,g=g.defaultValue,b!=null){if(g!=null)throw Error(s(92));if(He(b)){if(1<b.length)throw Error(s(93));b=b[0]}g=b}g==null&&(g=""),b=g}f._wrapperState={initialValue:ut(b)}}function zt(f,g){var b=ut(g.value),O=ut(g.defaultValue);b!=null&&(b=""+b,b!==f.value&&(f.value=b),g.defaultValue==null&&f.defaultValue!==b&&(f.defaultValue=b)),O!=null&&(f.defaultValue=""+O)}function dn(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function fn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xt(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?fn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Bn,cc=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,b,O,M){MSApp.execUnsafeLocalFunction(function(){return f(g,b,O,M)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(Bn=Bn||document.createElement("div"),Bn.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Bn.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function jt(f,g){if(g){var b=f.firstChild;if(b&&b===f.lastChild&&b.nodeType===3){b.nodeValue=g;return}}f.textContent=g}var an={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zi=["Webkit","ms","Moz","O"];Object.keys(an).forEach(function(f){Zi.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),an[g]=an[f]})});function Ms(f,g,b){return g==null||typeof g=="boolean"||g===""?"":b||typeof g!="number"||g===0||an.hasOwnProperty(f)&&an[f]?(""+g).trim():g+"px"}function qs(f,g){f=f.style;for(var b in g)if(g.hasOwnProperty(b)){var O=b.indexOf("--")===0,M=Ms(b,g[b],O);b==="float"&&(b="cssFloat"),O?f.setProperty(b,M):f[b]=M}}var hi=Xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ma(f,g){if(g){if(hi[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function tl(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lo=null;function uo(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Ml=null,Us=null,lc=null;function ra(f){if(f=Yp(f)){if(typeof Ml!="function")throw Error(s(280));var g=f.stateNode;g&&(g=Xp(g),Ml(f.stateNode,f.type,g))}}function uc(f){Us?lc?lc.push(f):lc=[f]:Us=f}function nl(){if(Us){var f=Us,g=lc;if(lc=Us=null,ra(f),g)for(f=0;f<g.length;f++)ra(g[f])}}function Nu(f,g){return f(g)}function dc(){}var rl=!1;function Co(f,g,b){if(rl)return f(g,b);rl=!0;try{return Nu(f,g,b)}finally{rl=!1,(Us!==null||lc!==null)&&(dc(),nl())}}function ki(f,g){var b=f.stateNode;if(b===null)return null;var O=Xp(b);if(O===null)return null;b=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(f=f.type,O=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!O;break e;default:f=!1}if(f)return null;if(b&&typeof b!="function")throw Error(s(231,g,typeof b));return b}var as=!1;if(E)try{var Ua={};Object.defineProperty(Ua,"passive",{get:function(){as=!0}}),window.addEventListener("test",Ua,Ua),window.removeEventListener("test",Ua,Ua)}catch{as=!1}function Du(f,g,b,O,M,H,ae,Te,Le){var nt=Array.prototype.slice.call(arguments,3);try{g.apply(b,nt)}catch(At){this.onError(At)}}var hc=!1,ia=null,sa=!1,Ld=null,Og={onError:function(f){hc=!0,ia=f}};function Lu(f,g,b,O,M,H,ae,Te,Le){hc=!1,ia=null,Du.apply(Og,arguments)}function af(f,g,b,O,M,H,ae,Te,Le){if(Lu.apply(this,arguments),hc){if(hc){var nt=ia;hc=!1,ia=null}else throw Error(s(198));sa||(sa=!0,Ld=nt)}}function Vs(f){var g=f,b=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(b=g.return),f=g.return;while(f)}return g.tag===3?b:null}function xu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function oa(f){if(Vs(f)!==f)throw Error(s(188))}function xd(f){var g=f.alternate;if(!g){if(g=Vs(f),g===null)throw Error(s(188));return g!==f?null:f}for(var b=f,O=g;;){var M=b.return;if(M===null)break;var H=M.alternate;if(H===null){if(O=M.return,O!==null){b=O;continue}break}if(M.child===H.child){for(H=M.child;H;){if(H===b)return oa(M),f;if(H===O)return oa(M),g;H=H.sibling}throw Error(s(188))}if(b.return!==O.return)b=M,O=H;else{for(var ae=!1,Te=M.child;Te;){if(Te===b){ae=!0,b=M,O=H;break}if(Te===O){ae=!0,O=M,b=H;break}Te=Te.sibling}if(!ae){for(Te=H.child;Te;){if(Te===b){ae=!0,b=H,O=M;break}if(Te===O){ae=!0,O=H,b=M;break}Te=Te.sibling}if(!ae)throw Error(s(189))}}if(b.alternate!==O)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?f:g}function Md(f){return f=xd(f),f!==null?Va(f):null}function Va(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Va(f);if(g!==null)return g;f=f.sibling}return null}var Ud=t.unstable_scheduleCallback,Mu=t.unstable_cancelCallback,Io=t.unstable_shouldYield,Vd=t.unstable_requestPaint,Vr=t.unstable_now,fi=t.unstable_getCurrentPriorityLevel,fc=t.unstable_ImmediatePriority,il=t.unstable_UserBlockingPriority,aa=t.unstable_NormalPriority,cf=t.unstable_LowPriority,Fd=t.unstable_IdlePriority,Ul=null,ho=null;function Lp(f){if(ho&&typeof ho.onCommitFiberRoot=="function")try{ho.onCommitFiberRoot(Ul,f,void 0,(f.current.flags&128)===128)}catch{}}var Ys=Math.clz32?Math.clz32:jd,lf=Math.log,sl=Math.LN2;function jd(f){return f>>>=0,f===0?32:31-(lf(f)/sl|0)|0}var Bd=64,ur=4194304;function Vl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Fl(f,g){var b=f.pendingLanes;if(b===0)return 0;var O=0,M=f.suspendedLanes,H=f.pingedLanes,ae=b&268435455;if(ae!==0){var Te=ae&~M;Te!==0?O=Vl(Te):(H&=ae,H!==0&&(O=Vl(H)))}else ae=b&~M,ae!==0?O=Vl(ae):H!==0&&(O=Vl(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,H=g&-g,M>=H||M===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=b&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=O;0<g;)b=31-Ys(g),M=1<<b,O|=f[b],g&=~M;return O}function Uu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fa(f,g){for(var b=f.suspendedLanes,O=f.pingedLanes,M=f.expirationTimes,H=f.pendingLanes;0<H;){var ae=31-Ys(H),Te=1<<ae,Le=M[ae];Le===-1?((Te&b)===0||(Te&O)!==0)&&(M[ae]=Uu(Te,g)):Le<=g&&(f.expiredLanes|=Te),H&=~Te}}function Ao(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Vu(){var f=Bd;return Bd<<=1,(Bd&4194240)===0&&(Bd=64),f}function ol(f){for(var g=[],b=0;31>b;b++)g.push(f);return g}function jl(f,g,b){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-Ys(g),f[g]=b}function Wr(f,g){var b=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var O=f.eventTimes;for(f=f.expirationTimes;0<b;){var M=31-Ys(b),H=1<<M;g[M]=0,O[M]=-1,f[M]=-1,b&=~H}}function ja(f,g){var b=f.entangledLanes|=g;for(f=f.entanglements;b;){var O=31-Ys(b),M=1<<O;M&g|f[O]&g&&(f[O]|=g),b&=~M}}var rr=0;function pc(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var xp,Bl,Wd,uf,Mp,df=!1,Po=[],es=null,Oo=null,ko=null,Wl=new Map,No=new Map,Do=[],Up="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mc(f,g){switch(f){case"focusin":case"focusout":es=null;break;case"dragenter":case"dragleave":Oo=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":Wl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":No.delete(g.pointerId)}}function cs(f,g,b,O,M,H){return f===null||f.nativeEvent!==H?(f={blockedOn:g,domEventName:b,eventSystemFlags:O,nativeEvent:H,targetContainers:[M]},g!==null&&(g=Yp(g),g!==null&&Bl(g)),f):(f.eventSystemFlags|=O,g=f.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),f)}function Fu(f,g,b,O,M){switch(g){case"focusin":return es=cs(es,f,g,b,O,M),!0;case"dragenter":return Oo=cs(Oo,f,g,b,O,M),!0;case"mouseover":return ko=cs(ko,f,g,b,O,M),!0;case"pointerover":var H=M.pointerId;return Wl.set(H,cs(Wl.get(H)||null,f,g,b,O,M)),!0;case"gotpointercapture":return H=M.pointerId,No.set(H,cs(No.get(H)||null,f,g,b,O,M)),!0}return!1}function hf(f){var g=vf(f.target);if(g!==null){var b=Vs(g);if(b!==null){if(g=b.tag,g===13){if(g=xu(b),g!==null){f.blockedOn=g,Mp(f.priority,function(){Wd(b)});return}}else if(g===3&&b.stateNode.current.memoizedState.isDehydrated){f.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}f.blockedOn=null}function al(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var b=mr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(b===null){b=f.nativeEvent;var O=new b.constructor(b.type,b);lo=O,b.target.dispatchEvent(O),lo=null}else return g=Yp(b),g!==null&&Bl(g),f.blockedOn=b,!1;g.shift()}return!0}function zl(f,g,b){al(f)&&b.delete(g)}function Vp(){df=!1,es!==null&&al(es)&&(es=null),Oo!==null&&al(Oo)&&(Oo=null),ko!==null&&al(ko)&&(ko=null),Wl.forEach(zl),No.forEach(zl)}function ca(f,g){f.blockedOn===g&&(f.blockedOn=null,df||(df=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Vp)))}function la(f){function g(M){return ca(M,f)}if(0<Po.length){ca(Po[0],f);for(var b=1;b<Po.length;b++){var O=Po[b];O.blockedOn===f&&(O.blockedOn=null)}}for(es!==null&&ca(es,f),Oo!==null&&ca(Oo,f),ko!==null&&ca(ko,f),Wl.forEach(g),No.forEach(g),b=0;b<Do.length;b++)O=Do[b],O.blockedOn===f&&(O.blockedOn=null);for(;0<Do.length&&(b=Do[0],b.blockedOn===null);)hf(b),b.blockedOn===null&&Do.shift()}var cl=de.ReactCurrentBatchConfig,ye=!0;function Oe(f,g,b,O){var M=rr,H=cl.transition;cl.transition=null;try{rr=1,qt(f,g,b,O)}finally{rr=M,cl.transition=H}}function et(f,g,b,O){var M=rr,H=cl.transition;cl.transition=null;try{rr=4,qt(f,g,b,O)}finally{rr=M,cl.transition=H}}function qt(f,g,b,O){if(ye){var M=mr(f,g,b,O);if(M===null)JE(f,g,O,Kn,b),mc(f,O);else if(Fu(M,f,g,b,O))O.stopPropagation();else if(mc(f,O),g&4&&-1<Up.indexOf(f)){for(;M!==null;){var H=Yp(M);if(H!==null&&xp(H),H=mr(f,g,b,O),H===null&&JE(f,g,O,Kn,b),H===M)break;M=H}M!==null&&O.stopPropagation()}else JE(f,g,O,null,b)}}var Kn=null;function mr(f,g,b,O){if(Kn=null,f=uo(O),f=vf(f),f!==null)if(g=Vs(f),g===null)f=null;else if(b=g.tag,b===13){if(f=xu(g),f!==null)return f;f=null}else if(b===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Kn=f,null}function Fr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fi()){case fc:return 1;case il:return 4;case aa:case cf:return 16;case Fd:return 536870912;default:return 16}default:return 16}}var cn=null,kr=null,pi=null;function Rs(){if(pi)return pi;var f,g=kr,b=g.length,O,M="value"in cn?cn.value:cn.textContent,H=M.length;for(f=0;f<b&&g[f]===M[f];f++);var ae=b-f;for(O=1;O<=ae&&g[b-O]===M[H-O];O++);return pi=M.slice(f,1<O?1-O:void 0)}function Lo(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function xo(){return!0}function ju(){return!1}function Hi(f){function g(b,O,M,H,ae){this._reactName=b,this._targetInst=M,this.type=O,this.nativeEvent=H,this.target=ae,this.currentTarget=null;for(var Te in f)f.hasOwnProperty(Te)&&(b=f[Te],this[Te]=b?b(H):H[Te]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?xo:ju,this.isPropagationStopped=ju,this}return Xe(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=xo)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=xo)},persist:function(){},isPersistent:xo}),g}var ll={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zd=Hi(ll),gc=Xe({},ll,{view:0,detail:0}),kg=Hi(gc),Fp,Bu,Mo,Gl=Xe({},gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_c,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Mo&&(Mo&&f.type==="mousemove"?(Fp=f.screenX-Mo.screenX,Bu=f.screenY-Mo.screenY):Bu=Fp=0,Mo=f),Fp)},movementY:function(f){return"movementY"in f?f.movementY:Bu}}),jp=Hi(Gl),Ng=Xe({},Gl,{dataTransfer:0}),zE=Hi(Ng),Bp=Xe({},gc,{relatedTarget:0}),Wp=Hi(Bp),Wu=Xe({},ll,{animationName:0,elapsedTime:0,pseudoElement:0}),zu=Hi(Wu),Gu=Xe({},ll,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Dg=Hi(Gu),GE=Xe({},ll,{data:0}),Mn=Hi(GE),zp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},HE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $E(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=HE[f])?!!g[f]:!1}function _c(){return $E}var C=Xe({},gc,{key:function(f){if(f.key){var g=zp[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Lo(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Uo[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_c,charCode:function(f){return f.type==="keypress"?Lo(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Lo(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),W=Hi(C),Q=Xe({},Gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fe=Hi(Q),$e=Xe({},gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_c}),ot=Hi($e),xt=Xe({},ll,{propertyName:0,elapsedTime:0,pseudoElement:0}),zr=Hi(xt),ri=Xe({},Gl,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),gr=Hi(ri),Fs=[9,13,27,32],ls=E&&"CompositionEvent"in window,Ba=null;E&&"documentMode"in document&&(Ba=document.documentMode);var Vo=E&&"TextEvent"in window&&!Ba,ff=E&&(!ls||Ba&&8<Ba&&11>=Ba),Gp=" ",Wa=!1;function lC(f,g){switch(f){case"keyup":return Fs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uC(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var Hp=!1;function c1(f,g){switch(f){case"compositionend":return uC(g);case"keypress":return g.which!==32?null:(Wa=!0,Gp);case"textInput":return f=g.data,f===Gp&&Wa?null:f;default:return null}}function dC(f,g){if(Hp)return f==="compositionend"||!ls&&lC(f,g)?(f=Rs(),pi=kr=cn=null,Hp=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return ff&&g.locale!=="ko"?null:g.data;default:return null}}var l1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hC(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!l1[f.type]:g==="textarea"}function L0(f,g,b,O){uc(O),g=QE(g,"onChange"),0<g.length&&(b=new zd("onChange","change",null,b,O),f.push({event:b,listeners:g}))}var pf=null,Lg=null;function u1(f){B0(f,0)}function mf(f){var g=Sf(f);if(Vt(g))return f}function d1(f,g){if(f==="change")return g}var fC=!1;if(E){var x0;if(E){var Ec="oninput"in document;if(!Ec){var pC=document.createElement("div");pC.setAttribute("oninput","return;"),Ec=typeof pC.oninput=="function"}x0=Ec}else x0=!1;fC=x0&&(!document.documentMode||9<document.documentMode)}function mC(){pf&&(pf.detachEvent("onpropertychange",ua),Lg=pf=null)}function ua(f){if(f.propertyName==="value"&&mf(Lg)){var g=[];L0(g,Lg,f,uo(f)),Co(u1,g)}}function h1(f,g,b){f==="focusin"?(mC(),pf=g,Lg=b,pf.attachEvent("onpropertychange",ua)):f==="focusout"&&mC()}function f1(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return mf(Lg)}function p1(f,g){if(f==="click")return mf(g)}function m1(f,g){if(f==="input"||f==="change")return mf(g)}function gC(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var ul=typeof Object.is=="function"?Object.is:gC;function xg(f,g){if(ul(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var b=Object.keys(f),O=Object.keys(g);if(b.length!==O.length)return!1;for(O=0;O<b.length;O++){var M=b[O];if(!v.call(g,M)||!ul(f[M],g[M]))return!1}return!0}function _C(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function M0(f,g){var b=_C(f);f=0;for(var O;b;){if(b.nodeType===3){if(O=f+b.textContent.length,f<=g&&O>=g)return{node:b,offset:g-f};f=O}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=_C(b)}}function EC(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?EC(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function yC(){for(var f=window,g=ln();g instanceof f.HTMLIFrameElement;){try{var b=typeof g.contentWindow.location.href=="string"}catch{b=!1}if(b)f=g.contentWindow;else break;g=ln(f.document)}return g}function Mg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function U0(f){var g=yC(),b=f.focusedElem,O=f.selectionRange;if(g!==b&&b&&b.ownerDocument&&EC(b.ownerDocument.documentElement,b)){if(O!==null&&Mg(b)){if(g=O.start,f=O.end,f===void 0&&(f=g),"selectionStart"in b)b.selectionStart=g,b.selectionEnd=Math.min(f,b.value.length);else if(f=(g=b.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var M=b.textContent.length,H=Math.min(O.start,M);O=O.end===void 0?H:Math.min(O.end,M),!f.extend&&H>O&&(M=O,O=H,H=M),M=M0(b,H);var ae=M0(b,O);M&&ae&&(f.rangeCount!==1||f.anchorNode!==M.node||f.anchorOffset!==M.offset||f.focusNode!==ae.node||f.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),f.removeAllRanges(),H>O?(f.addRange(g),f.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),f.addRange(g)))}}for(g=[],f=b;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<g.length;b++)f=g[b],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var g1=E&&"documentMode"in document&&11>=document.documentMode,st=null,V0=null,Ug=null,F0=!1;function vC(f,g,b){var O=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;F0||st==null||st!==ln(O)||(O=st,"selectionStart"in O&&Mg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Ug&&xg(Ug,O)||(Ug=O,O=QE(V0,"onSelect"),0<O.length&&(g=new zd("onSelect","select",null,g,b),f.push({event:g,listeners:O}),g.target=st)))}function KE(f,g){var b={};return b[f.toLowerCase()]=g.toLowerCase(),b["Webkit"+f]="webkit"+g,b["Moz"+f]="moz"+g,b}var $p={animationend:KE("Animation","AnimationEnd"),animationiteration:KE("Animation","AnimationIteration"),animationstart:KE("Animation","AnimationStart"),transitionend:KE("Transition","TransitionEnd")},j0={},SC={};E&&(SC=document.createElement("div").style,"AnimationEvent"in window||(delete $p.animationend.animation,delete $p.animationiteration.animation,delete $p.animationstart.animation),"TransitionEvent"in window||delete $p.transitionend.transition);function gf(f){if(j0[f])return j0[f];if(!$p[f])return f;var g=$p[f],b;for(b in g)if(g.hasOwnProperty(b)&&b in SC)return j0[f]=g[b];return f}var _f=gf("animationend"),TC=gf("animationiteration"),bC=gf("animationstart"),wC=gf("transitionend"),RC=new Map,qE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Gd(f,g){RC.set(f,g),d(g,[f])}for(var YE=0;YE<qE.length;YE++){var za=qE[YE],_1=za.toLowerCase(),Vg=za[0].toUpperCase()+za.slice(1);Gd(_1,"on"+Vg)}Gd(_f,"onAnimationEnd"),Gd(TC,"onAnimationIteration"),Gd(bC,"onAnimationStart"),Gd("dblclick","onDoubleClick"),Gd("focusin","onFocus"),Gd("focusout","onBlur"),Gd(wC,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),E1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fg));function CC(f,g,b){var O=f.type||"unknown-event";f.currentTarget=b,af(O,g,void 0,f),f.currentTarget=null}function B0(f,g){g=(g&4)!==0;for(var b=0;b<f.length;b++){var O=f[b],M=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Te=O[ae],Le=Te.instance,nt=Te.currentTarget;if(Te=Te.listener,Le!==H&&M.isPropagationStopped())break e;CC(M,Te,nt),H=Le}else for(ae=0;ae<O.length;ae++){if(Te=O[ae],Le=Te.instance,nt=Te.currentTarget,Te=Te.listener,Le!==H&&M.isPropagationStopped())break e;CC(M,Te,nt),H=Le}}}if(sa)throw f=Ld,sa=!1,Ld=null,f}function vi(f,g){var b=g[zg];b===void 0&&(b=g[zg]=new Set);var O=f+"__bubble";b.has(O)||(IC(g,f,2,!1),b.add(O))}function W0(f,g,b){var O=0;g&&(O|=4),IC(b,f,O,g)}var XE="_reactListening"+Math.random().toString(36).slice(2);function Ef(f){if(!f[XE]){f[XE]=!0,a.forEach(function(b){b!=="selectionchange"&&(E1.has(b)||W0(b,!1,f),W0(b,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[XE]||(g[XE]=!0,W0("selectionchange",!1,g))}}function IC(f,g,b,O){switch(Fr(g)){case 1:var M=Oe;break;case 4:M=et;break;default:M=qt}b=M.bind(null,g,b,f),M=void 0,!as||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?f.addEventListener(g,b,{capture:!0,passive:M}):f.addEventListener(g,b,!0):M!==void 0?f.addEventListener(g,b,{passive:M}):f.addEventListener(g,b,!1)}function JE(f,g,b,O,M){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Te=O.stateNode.containerInfo;if(Te===M||Te.nodeType===8&&Te.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var Le=ae.tag;if((Le===3||Le===4)&&(Le=ae.stateNode.containerInfo,Le===M||Le.nodeType===8&&Le.parentNode===M))return;ae=ae.return}for(;Te!==null;){if(ae=vf(Te),ae===null)return;if(Le=ae.tag,Le===5||Le===6){O=H=ae;continue e}Te=Te.parentNode}}O=O.return}Co(function(){var nt=H,At=uo(b),Pt=[];e:{var Rt=RC.get(f);if(Rt!==void 0){var $t=zd,tn=f;switch(f){case"keypress":if(Lo(b)===0)break e;case"keydown":case"keyup":$t=W;break;case"focusin":tn="focus",$t=Wp;break;case"focusout":tn="blur",$t=Wp;break;case"beforeblur":case"afterblur":$t=Wp;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$t=jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$t=zE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$t=ot;break;case _f:case TC:case bC:$t=zu;break;case wC:$t=zr;break;case"scroll":$t=kg;break;case"wheel":$t=gr;break;case"copy":case"cut":case"paste":$t=Dg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$t=fe}var nn=(g&4)!==0,Ki=!nn&&f==="scroll",qe=nn?Rt!==null?Rt+"Capture":null:Rt;nn=[];for(var Fe=nt,Je;Fe!==null;){Je=Fe;var Nt=Je.stateNode;if(Je.tag===5&&Nt!==null&&(Je=Nt,qe!==null&&(Nt=ki(Fe,qe),Nt!=null&&nn.push(Kp(Fe,Nt,Je)))),Ki)break;Fe=Fe.return}0<nn.length&&(Rt=new $t(Rt,tn,null,b,At),Pt.push({event:Rt,listeners:nn}))}}if((g&7)===0){e:{if(Rt=f==="mouseover"||f==="pointerover",$t=f==="mouseout"||f==="pointerout",Rt&&b!==lo&&(tn=b.relatedTarget||b.fromElement)&&(vf(tn)||tn[yc]))break e;if(($t||Rt)&&(Rt=At.window===At?At:(Rt=At.ownerDocument)?Rt.defaultView||Rt.parentWindow:window,$t?(tn=b.relatedTarget||b.toElement,$t=nt,tn=tn?vf(tn):null,tn!==null&&(Ki=Vs(tn),tn!==Ki||tn.tag!==5&&tn.tag!==6)&&(tn=null)):($t=null,tn=nt),$t!==tn)){if(nn=jp,Nt="onMouseLeave",qe="onMouseEnter",Fe="mouse",(f==="pointerout"||f==="pointerover")&&(nn=fe,Nt="onPointerLeave",qe="onPointerEnter",Fe="pointer"),Ki=$t==null?Rt:Sf($t),Je=tn==null?Rt:Sf(tn),Rt=new nn(Nt,Fe+"leave",$t,b,At),Rt.target=Ki,Rt.relatedTarget=Je,Nt=null,vf(At)===nt&&(nn=new nn(qe,Fe+"enter",tn,b,At),nn.target=Je,nn.relatedTarget=Ki,Nt=nn),Ki=Nt,$t&&tn)t:{for(nn=$t,qe=tn,Fe=0,Je=nn;Je;Je=yf(Je))Fe++;for(Je=0,Nt=qe;Nt;Nt=yf(Nt))Je++;for(;0<Fe-Je;)nn=yf(nn),Fe--;for(;0<Je-Fe;)qe=yf(qe),Je--;for(;Fe--;){if(nn===qe||qe!==null&&nn===qe.alternate)break t;nn=yf(nn),qe=yf(qe)}nn=null}else nn=null;$t!==null&&jg(Pt,Rt,$t,nn,!1),tn!==null&&Ki!==null&&jg(Pt,Ki,tn,nn,!0)}}e:{if(Rt=nt?Sf(nt):window,$t=Rt.nodeName&&Rt.nodeName.toLowerCase(),$t==="select"||$t==="input"&&Rt.type==="file")var rn=d1;else if(hC(Rt))if(fC)rn=m1;else{rn=f1;var pn=h1}else($t=Rt.nodeName)&&$t.toLowerCase()==="input"&&(Rt.type==="checkbox"||Rt.type==="radio")&&(rn=p1);if(rn&&(rn=rn(f,nt))){L0(Pt,rn,b,At);break e}pn&&pn(f,Rt,nt),f==="focusout"&&(pn=Rt._wrapperState)&&pn.controlled&&Rt.type==="number"&&Ue(Rt,"number",Rt.value)}switch(pn=nt?Sf(nt):window,f){case"focusin":(hC(pn)||pn.contentEditable==="true")&&(st=pn,V0=nt,Ug=null);break;case"focusout":Ug=V0=st=null;break;case"mousedown":F0=!0;break;case"contextmenu":case"mouseup":case"dragend":F0=!1,vC(Pt,b,At);break;case"selectionchange":if(g1)break;case"keydown":case"keyup":vC(Pt,b,At)}var vn;if(ls)e:{switch(f){case"compositionstart":var kn="onCompositionStart";break e;case"compositionend":kn="onCompositionEnd";break e;case"compositionupdate":kn="onCompositionUpdate";break e}kn=void 0}else Hp?lC(f,b)&&(kn="onCompositionEnd"):f==="keydown"&&b.keyCode===229&&(kn="onCompositionStart");kn&&(ff&&b.locale!=="ko"&&(Hp||kn!=="onCompositionStart"?kn==="onCompositionEnd"&&Hp&&(vn=Rs()):(cn=At,kr="value"in cn?cn.value:cn.textContent,Hp=!0)),pn=QE(nt,kn),0<pn.length&&(kn=new Mn(kn,f,null,b,At),Pt.push({event:kn,listeners:pn}),vn?kn.data=vn:(vn=uC(b),vn!==null&&(kn.data=vn)))),(vn=Vo?c1(f,b):dC(f,b))&&(nt=QE(nt,"onBeforeInput"),0<nt.length&&(At=new Mn("onBeforeInput","beforeinput",null,b,At),Pt.push({event:At,listeners:nt}),At.data=vn))}B0(Pt,g)})}function Kp(f,g,b){return{instance:f,listener:g,currentTarget:b}}function QE(f,g){for(var b=g+"Capture",O=[];f!==null;){var M=f,H=M.stateNode;M.tag===5&&H!==null&&(M=H,H=ki(f,b),H!=null&&O.unshift(Kp(f,H,M)),H=ki(f,g),H!=null&&O.push(Kp(f,H,M))),f=f.return}return O}function yf(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function jg(f,g,b,O,M){for(var H=g._reactName,ae=[];b!==null&&b!==O;){var Te=b,Le=Te.alternate,nt=Te.stateNode;if(Le!==null&&Le===O)break;Te.tag===5&&nt!==null&&(Te=nt,M?(Le=ki(b,H),Le!=null&&ae.unshift(Kp(b,Le,Te))):M||(Le=ki(b,H),Le!=null&&ae.push(Kp(b,Le,Te)))),b=b.return}ae.length!==0&&f.push({event:g,listeners:ae})}var y1=/\r\n?/g,v1=/\u0000|\uFFFD/g;function AC(f){return(typeof f=="string"?f:""+f).replace(y1,`
`).replace(v1,"")}function ZE(f,g,b){if(g=AC(g),AC(f)!==g&&b)throw Error(s(425))}function ey(){}var ty=null,Bg=null;function z0(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Wg=typeof setTimeout=="function"?setTimeout:void 0,S1=typeof clearTimeout=="function"?clearTimeout:void 0,PC=typeof Promise=="function"?Promise:void 0,T1=typeof queueMicrotask=="function"?queueMicrotask:typeof PC<"u"?function(f){return PC.resolve(null).then(f).catch(b1)}:Wg;function b1(f){setTimeout(function(){throw f})}function G0(f,g){var b=g,O=0;do{var M=b.nextSibling;if(f.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(O===0){f.removeChild(M),la(g);return}O--}else b!=="$"&&b!=="$?"&&b!=="$!"||O++;b=M}while(b);la(g)}function Hd(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function OC(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var b=f.data;if(b==="$"||b==="$!"||b==="$?"){if(g===0)return f;g--}else b==="/$"&&g++}f=f.previousSibling}return null}var qp=Math.random().toString(36).slice(2),Hl="__reactFiber$"+qp,$d="__reactProps$"+qp,yc="__reactContainer$"+qp,zg="__reactEvents$"+qp,w1="__reactListeners$"+qp,R1="__reactHandles$"+qp;function vf(f){var g=f[Hl];if(g)return g;for(var b=f.parentNode;b;){if(g=b[yc]||b[Hl]){if(b=g.alternate,g.child!==null||b!==null&&b.child!==null)for(f=OC(f);f!==null;){if(b=f[Hl])return b;f=OC(f)}return g}f=b,b=f.parentNode}return null}function Yp(f){return f=f[Hl]||f[yc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Sf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(s(33))}function Xp(f){return f[$d]||null}var H0=[],Jp=-1;function vc(f){return{current:f}}function Si(f){0>Jp||(f.current=H0[Jp],H0[Jp]=null,Jp--)}function mi(f,g){Jp++,H0[Jp]=f.current,f.current=g}var Kd={},fo=vc(Kd),da=vc(!1),Tf=Kd;function bf(f,g){var b=f.type.contextTypes;if(!b)return Kd;var O=f.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},H;for(H in b)M[H]=g[H];return O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=M),M}function ha(f){return f=f.childContextTypes,f!=null}function ny(){Si(da),Si(fo)}function kC(f,g,b){if(fo.current!==Kd)throw Error(s(168));mi(fo,g),mi(da,b)}function ry(f,g,b){var O=f.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return b;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(s(108,Ze(f)||"Unknown",M));return Xe({},b,O)}function iy(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Kd,Tf=fo.current,mi(fo,f),mi(da,da.current),!0}function NC(f,g,b){var O=f.stateNode;if(!O)throw Error(s(169));b?(f=ry(f,g,Tf),O.__reactInternalMemoizedMergedChildContext=f,Si(da),Si(fo),mi(fo,f)):Si(da),mi(da,b)}var Sc=null,sy=!1,$0=!1;function DC(f){Sc===null?Sc=[f]:Sc.push(f)}function C1(f){sy=!0,DC(f)}function qd(){if(!$0&&Sc!==null){$0=!0;var f=0,g=rr;try{var b=Sc;for(rr=1;f<b.length;f++){var O=b[f];do O=O(!0);while(O!==null)}Sc=null,sy=!1}catch(M){throw Sc!==null&&(Sc=Sc.slice(f+1)),Ud(fc,qd),M}finally{rr=g,$0=!1}}return null}var Qp=[],Hu=0,Gg=null,oy=0,Tc=[],Ga=0,wf=null,$u=1,Ku="";function qu(f,g){Qp[Hu++]=oy,Qp[Hu++]=Gg,Gg=f,oy=g}function ay(f,g,b){Tc[Ga++]=$u,Tc[Ga++]=Ku,Tc[Ga++]=wf,wf=f;var O=$u;f=Ku;var M=32-Ys(O)-1;O&=~(1<<M),b+=1;var H=32-Ys(g)+M;if(30<H){var ae=M-M%5;H=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,$u=1<<32-Ys(g)+M|b<<M|O,Ku=H+f}else $u=1<<H|b<<M|O,Ku=f}function cy(f){f.return!==null&&(qu(f,1),ay(f,1,0))}function Hg(f){for(;f===Gg;)Gg=Qp[--Hu],Qp[Hu]=null,oy=Qp[--Hu],Qp[Hu]=null;for(;f===wf;)wf=Tc[--Ga],Tc[Ga]=null,Ku=Tc[--Ga],Tc[Ga]=null,$u=Tc[--Ga],Tc[Ga]=null}var fa=null,pa=null,ii=!1,Fo=null;function LC(f,g){var b=Ka(5,null,null,0);b.elementType="DELETED",b.stateNode=g,b.return=f,g=f.deletions,g===null?(f.deletions=[b],f.flags|=16):g.push(b)}function xC(f,g){switch(f.tag){case 5:var b=f.type;return g=g.nodeType!==1||b.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,fa=f,pa=Hd(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,fa=f,pa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(b=wf!==null?{id:$u,overflow:Ku}:null,f.memoizedState={dehydrated:g,treeContext:b,retryLane:1073741824},b=Ka(18,null,null,0),b.stateNode=g,b.return=f,f.child=b,fa=f,pa=null,!0):!1;default:return!1}}function ly(f){return(f.mode&1)!==0&&(f.flags&128)===0}function K0(f){if(ii){var g=pa;if(g){var b=g;if(!xC(f,g)){if(ly(f))throw Error(s(418));g=Hd(b.nextSibling);var O=fa;g&&xC(f,g)?LC(O,b):(f.flags=f.flags&-4097|2,ii=!1,fa=f)}}else{if(ly(f))throw Error(s(418));f.flags=f.flags&-4097|2,ii=!1,fa=f}}}function MC(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;fa=f}function $g(f){if(f!==fa)return!1;if(!ii)return MC(f),ii=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!z0(f.type,f.memoizedProps)),g&&(g=pa)){if(ly(f))throw UC(),Error(s(418));for(;g;)LC(f,g),g=Hd(g.nextSibling)}if(MC(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(s(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var b=f.data;if(b==="/$"){if(g===0){pa=Hd(f.nextSibling);break e}g--}else b!=="$"&&b!=="$!"&&b!=="$?"||g++}f=f.nextSibling}pa=null}}else pa=fa?Hd(f.stateNode.nextSibling):null;return!0}function UC(){for(var f=pa;f;)f=Hd(f.nextSibling)}function Zp(){pa=fa=null,ii=!1}function q0(f){Fo===null?Fo=[f]:Fo.push(f)}var I1=de.ReactCurrentBatchConfig;function Kg(f,g,b){if(f=b.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(s(309));var O=b.stateNode}if(!O)throw Error(s(147,f));var M=O,H=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ae){var Te=M.refs;ae===null?delete Te[H]:Te[H]=ae},g._stringRef=H,g)}if(typeof f!="string")throw Error(s(284));if(!b._owner)throw Error(s(290,f))}return f}function uy(f,g){throw f=Object.prototype.toString.call(g),Error(s(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function Y0(f){var g=f._init;return g(f._payload)}function Yd(f){function g(qe,Fe){if(f){var Je=qe.deletions;Je===null?(qe.deletions=[Fe],qe.flags|=16):Je.push(Fe)}}function b(qe,Fe){if(!f)return null;for(;Fe!==null;)g(qe,Fe),Fe=Fe.sibling;return null}function O(qe,Fe){for(qe=new Map;Fe!==null;)Fe.key!==null?qe.set(Fe.key,Fe):qe.set(Fe.index,Fe),Fe=Fe.sibling;return qe}function M(qe,Fe){return qe=nd(qe,Fe),qe.index=0,qe.sibling=null,qe}function H(qe,Fe,Je){return qe.index=Je,f?(Je=qe.alternate,Je!==null?(Je=Je.index,Je<Fe?(qe.flags|=2,Fe):Je):(qe.flags|=2,Fe)):(qe.flags|=1048576,Fe)}function ae(qe){return f&&qe.alternate===null&&(qe.flags|=2),qe}function Te(qe,Fe,Je,Nt){return Fe===null||Fe.tag!==6?(Fe=NT(Je,qe.mode,Nt),Fe.return=qe,Fe):(Fe=M(Fe,Je),Fe.return=qe,Fe)}function Le(qe,Fe,Je,Nt){var rn=Je.type;return rn===Z?At(qe,Fe,Je.props.children,Nt,Je.key):Fe!==null&&(Fe.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&Y0(rn)===Fe.type)?(Nt=M(Fe,Je.props),Nt.ref=Kg(qe,Fe,Je),Nt.return=qe,Nt):(Nt=Xy(Je.type,Je.key,Je.props,null,qe.mode,Nt),Nt.ref=Kg(qe,Fe,Je),Nt.return=qe,Nt)}function nt(qe,Fe,Je,Nt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==Je.containerInfo||Fe.stateNode.implementation!==Je.implementation?(Fe=DT(Je,qe.mode,Nt),Fe.return=qe,Fe):(Fe=M(Fe,Je.children||[]),Fe.return=qe,Fe)}function At(qe,Fe,Je,Nt,rn){return Fe===null||Fe.tag!==7?(Fe=Mf(Je,qe.mode,Nt,rn),Fe.return=qe,Fe):(Fe=M(Fe,Je),Fe.return=qe,Fe)}function Pt(qe,Fe,Je){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=NT(""+Fe,qe.mode,Je),Fe.return=qe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case oe:return Je=Xy(Fe.type,Fe.key,Fe.props,null,qe.mode,Je),Je.ref=Kg(qe,null,Fe),Je.return=qe,Je;case _e:return Fe=DT(Fe,qe.mode,Je),Fe.return=qe,Fe;case tt:var Nt=Fe._init;return Pt(qe,Nt(Fe._payload),Je)}if(He(Fe)||Ce(Fe))return Fe=Mf(Fe,qe.mode,Je,null),Fe.return=qe,Fe;uy(qe,Fe)}return null}function Rt(qe,Fe,Je,Nt){var rn=Fe!==null?Fe.key:null;if(typeof Je=="string"&&Je!==""||typeof Je=="number")return rn!==null?null:Te(qe,Fe,""+Je,Nt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:return Je.key===rn?Le(qe,Fe,Je,Nt):null;case _e:return Je.key===rn?nt(qe,Fe,Je,Nt):null;case tt:return rn=Je._init,Rt(qe,Fe,rn(Je._payload),Nt)}if(He(Je)||Ce(Je))return rn!==null?null:At(qe,Fe,Je,Nt,null);uy(qe,Je)}return null}function $t(qe,Fe,Je,Nt,rn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return qe=qe.get(Je)||null,Te(Fe,qe,""+Nt,rn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case oe:return qe=qe.get(Nt.key===null?Je:Nt.key)||null,Le(Fe,qe,Nt,rn);case _e:return qe=qe.get(Nt.key===null?Je:Nt.key)||null,nt(Fe,qe,Nt,rn);case tt:var pn=Nt._init;return $t(qe,Fe,Je,pn(Nt._payload),rn)}if(He(Nt)||Ce(Nt))return qe=qe.get(Je)||null,At(Fe,qe,Nt,rn,null);uy(Fe,Nt)}return null}function tn(qe,Fe,Je,Nt){for(var rn=null,pn=null,vn=Fe,kn=Fe=0,ps=null;vn!==null&&kn<Je.length;kn++){vn.index>kn?(ps=vn,vn=null):ps=vn.sibling;var _r=Rt(qe,vn,Je[kn],Nt);if(_r===null){vn===null&&(vn=ps);break}f&&vn&&_r.alternate===null&&g(qe,vn),Fe=H(_r,Fe,kn),pn===null?rn=_r:pn.sibling=_r,pn=_r,vn=ps}if(kn===Je.length)return b(qe,vn),ii&&qu(qe,kn),rn;if(vn===null){for(;kn<Je.length;kn++)vn=Pt(qe,Je[kn],Nt),vn!==null&&(Fe=H(vn,Fe,kn),pn===null?rn=vn:pn.sibling=vn,pn=vn);return ii&&qu(qe,kn),rn}for(vn=O(qe,vn);kn<Je.length;kn++)ps=$t(vn,qe,kn,Je[kn],Nt),ps!==null&&(f&&ps.alternate!==null&&vn.delete(ps.key===null?kn:ps.key),Fe=H(ps,Fe,kn),pn===null?rn=ps:pn.sibling=ps,pn=ps);return f&&vn.forEach(function(oh){return g(qe,oh)}),ii&&qu(qe,kn),rn}function nn(qe,Fe,Je,Nt){var rn=Ce(Je);if(typeof rn!="function")throw Error(s(150));if(Je=rn.call(Je),Je==null)throw Error(s(151));for(var pn=rn=null,vn=Fe,kn=Fe=0,ps=null,_r=Je.next();vn!==null&&!_r.done;kn++,_r=Je.next()){vn.index>kn?(ps=vn,vn=null):ps=vn.sibling;var oh=Rt(qe,vn,_r.value,Nt);if(oh===null){vn===null&&(vn=ps);break}f&&vn&&oh.alternate===null&&g(qe,vn),Fe=H(oh,Fe,kn),pn===null?rn=oh:pn.sibling=oh,pn=oh,vn=ps}if(_r.done)return b(qe,vn),ii&&qu(qe,kn),rn;if(vn===null){for(;!_r.done;kn++,_r=Je.next())_r=Pt(qe,_r.value,Nt),_r!==null&&(Fe=H(_r,Fe,kn),pn===null?rn=_r:pn.sibling=_r,pn=_r);return ii&&qu(qe,kn),rn}for(vn=O(qe,vn);!_r.done;kn++,_r=Je.next())_r=$t(vn,qe,kn,_r.value,Nt),_r!==null&&(f&&_r.alternate!==null&&vn.delete(_r.key===null?kn:_r.key),Fe=H(_r,Fe,kn),pn===null?rn=_r:pn.sibling=_r,pn=_r);return f&&vn.forEach(function(z1){return g(qe,z1)}),ii&&qu(qe,kn),rn}function Ki(qe,Fe,Je,Nt){if(typeof Je=="object"&&Je!==null&&Je.type===Z&&Je.key===null&&(Je=Je.props.children),typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:e:{for(var rn=Je.key,pn=Fe;pn!==null;){if(pn.key===rn){if(rn=Je.type,rn===Z){if(pn.tag===7){b(qe,pn.sibling),Fe=M(pn,Je.props.children),Fe.return=qe,qe=Fe;break e}}else if(pn.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&Y0(rn)===pn.type){b(qe,pn.sibling),Fe=M(pn,Je.props),Fe.ref=Kg(qe,pn,Je),Fe.return=qe,qe=Fe;break e}b(qe,pn);break}else g(qe,pn);pn=pn.sibling}Je.type===Z?(Fe=Mf(Je.props.children,qe.mode,Nt,Je.key),Fe.return=qe,qe=Fe):(Nt=Xy(Je.type,Je.key,Je.props,null,qe.mode,Nt),Nt.ref=Kg(qe,Fe,Je),Nt.return=qe,qe=Nt)}return ae(qe);case _e:e:{for(pn=Je.key;Fe!==null;){if(Fe.key===pn)if(Fe.tag===4&&Fe.stateNode.containerInfo===Je.containerInfo&&Fe.stateNode.implementation===Je.implementation){b(qe,Fe.sibling),Fe=M(Fe,Je.children||[]),Fe.return=qe,qe=Fe;break e}else{b(qe,Fe);break}else g(qe,Fe);Fe=Fe.sibling}Fe=DT(Je,qe.mode,Nt),Fe.return=qe,qe=Fe}return ae(qe);case tt:return pn=Je._init,Ki(qe,Fe,pn(Je._payload),Nt)}if(He(Je))return tn(qe,Fe,Je,Nt);if(Ce(Je))return nn(qe,Fe,Je,Nt);uy(qe,Je)}return typeof Je=="string"&&Je!==""||typeof Je=="number"?(Je=""+Je,Fe!==null&&Fe.tag===6?(b(qe,Fe.sibling),Fe=M(Fe,Je),Fe.return=qe,qe=Fe):(b(qe,Fe),Fe=NT(Je,qe.mode,Nt),Fe.return=qe,qe=Fe),ae(qe)):b(qe,Fe)}return Ki}var em=Yd(!0),VC=Yd(!1),dy=vc(null),qg=null,tm=null,hy=null;function X0(){hy=tm=qg=null}function J0(f){var g=dy.current;Si(dy),f._currentValue=g}function Q0(f,g,b){for(;f!==null;){var O=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),f===b)break;f=f.return}}function Yu(f,g){qg=f,hy=tm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(ga=!0),f.firstContext=null)}function bc(f){var g=f._currentValue;if(hy!==f)if(f={context:f,memoizedValue:g,next:null},tm===null){if(qg===null)throw Error(s(308));tm=f,qg.dependencies={lanes:0,firstContext:f}}else tm=tm.next=f;return g}var Rf=null;function Z0(f){Rf===null?Rf=[f]:Rf.push(f)}function FC(f,g,b,O){var M=g.interleaved;return M===null?(b.next=b,Z0(g)):(b.next=M.next,M.next=b),g.interleaved=b,Xu(f,O)}function Xu(f,g){f.lanes|=g;var b=f.alternate;for(b!==null&&(b.lanes|=g),b=f,f=f.return;f!==null;)f.childLanes|=g,b=f.alternate,b!==null&&(b.childLanes|=g),b=f,f=f.return;return b.tag===3?b.stateNode:null}var Xd=!1;function Yg(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function jC(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function $l(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function Jd(f,g,b){var O=f.updateQueue;if(O===null)return null;if(O=O.shared,(Tr&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,Xu(f,b)}return M=O.interleaved,M===null?(g.next=g,Z0(O)):(g.next=M.next,M.next=g),O.interleaved=g,Xu(f,b)}function Xg(f,g,b){if(g=g.updateQueue,g!==null&&(g=g.shared,(b&4194240)!==0)){var O=g.lanes;O&=f.pendingLanes,b|=O,g.lanes=b,ja(f,b)}}function BC(f,g){var b=f.updateQueue,O=f.alternate;if(O!==null&&(O=O.updateQueue,b===O)){var M=null,H=null;if(b=b.firstBaseUpdate,b!==null){do{var ae={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};H===null?M=H=ae:H=H.next=ae,b=b.next}while(b!==null);H===null?M=H=g:H=H.next=g}else M=H=g;b={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:H,shared:O.shared,effects:O.effects},f.updateQueue=b;return}f=b.lastBaseUpdate,f===null?b.firstBaseUpdate=g:f.next=g,b.lastBaseUpdate=g}function fy(f,g,b,O){var M=f.updateQueue;Xd=!1;var H=M.firstBaseUpdate,ae=M.lastBaseUpdate,Te=M.shared.pending;if(Te!==null){M.shared.pending=null;var Le=Te,nt=Le.next;Le.next=null,ae===null?H=nt:ae.next=nt,ae=Le;var At=f.alternate;At!==null&&(At=At.updateQueue,Te=At.lastBaseUpdate,Te!==ae&&(Te===null?At.firstBaseUpdate=nt:Te.next=nt,At.lastBaseUpdate=Le))}if(H!==null){var Pt=M.baseState;ae=0,At=nt=Le=null,Te=H;do{var Rt=Te.lane,$t=Te.eventTime;if((O&Rt)===Rt){At!==null&&(At=At.next={eventTime:$t,lane:0,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null});e:{var tn=f,nn=Te;switch(Rt=g,$t=b,nn.tag){case 1:if(tn=nn.payload,typeof tn=="function"){Pt=tn.call($t,Pt,Rt);break e}Pt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=nn.payload,Rt=typeof tn=="function"?tn.call($t,Pt,Rt):tn,Rt==null)break e;Pt=Xe({},Pt,Rt);break e;case 2:Xd=!0}}Te.callback!==null&&Te.lane!==0&&(f.flags|=64,Rt=M.effects,Rt===null?M.effects=[Te]:Rt.push(Te))}else $t={eventTime:$t,lane:Rt,tag:Te.tag,payload:Te.payload,callback:Te.callback,next:null},At===null?(nt=At=$t,Le=Pt):At=At.next=$t,ae|=Rt;if(Te=Te.next,Te===null){if(Te=M.shared.pending,Te===null)break;Rt=Te,Te=Rt.next,Rt.next=null,M.lastBaseUpdate=Rt,M.shared.pending=null}}while(!0);if(At===null&&(Le=Pt),M.baseState=Le,M.firstBaseUpdate=nt,M.lastBaseUpdate=At,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else H===null&&(M.shared.lanes=0);kf|=ae,f.lanes=ae,f.memoizedState=Pt}}function WC(f,g,b){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var O=f[g],M=O.callback;if(M!==null){if(O.callback=null,O=b,typeof M!="function")throw Error(s(191,M));M.call(O)}}}var Jg={},Kl=vc(Jg),Qg=vc(Jg),nm=vc(Jg);function Cf(f){if(f===Jg)throw Error(s(174));return f}function eT(f,g){switch(mi(nm,g),mi(Qg,f),mi(Kl,Jg),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Xt(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=Xt(g,f)}Si(Kl),mi(Kl,g)}function If(){Si(Kl),Si(Qg),Si(nm)}function zC(f){Cf(nm.current);var g=Cf(Kl.current),b=Xt(g,f.type);g!==b&&(mi(Qg,f),mi(Kl,b))}function rm(f){Qg.current===f&&(Si(Kl),Si(Qg))}var Ci=vc(0);function Qd(f){for(var g=f;g!==null;){if(g.tag===13){var b=g.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var tT=[];function nT(){for(var f=0;f<tT.length;f++)tT[f]._workInProgressVersionPrimary=null;tT.length=0}var py=de.ReactCurrentDispatcher,rT=de.ReactCurrentBatchConfig,ql=0,Ni=null,us=null,ds=null,im=!1,Zg=!1,e_=0,A1=0;function po(){throw Error(s(321))}function iT(f,g){if(g===null)return!1;for(var b=0;b<g.length&&b<f.length;b++)if(!ul(f[b],g[b]))return!1;return!0}function sm(f,g,b,O,M,H){if(ql=H,Ni=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,py.current=f===null||f.memoizedState===null?k1:eI,f=b(O,M),Zg){H=0;do{if(Zg=!1,e_=0,25<=H)throw Error(s(301));H+=1,ds=us=null,g.updateQueue=null,py.current=N1,f=b(O,M)}while(Zg)}if(py.current=Ey,g=us!==null&&us.next!==null,ql=0,ds=us=Ni=null,im=!1,g)throw Error(s(300));return f}function sT(){var f=e_!==0;return e_=0,f}function jo(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ds===null?Ni.memoizedState=ds=f:ds=ds.next=f,ds}function ma(){if(us===null){var f=Ni.alternate;f=f!==null?f.memoizedState:null}else f=us.next;var g=ds===null?Ni.memoizedState:ds.next;if(g!==null)ds=g,us=f;else{if(f===null)throw Error(s(310));us=f,f={memoizedState:us.memoizedState,baseState:us.baseState,baseQueue:us.baseQueue,queue:us.queue,next:null},ds===null?Ni.memoizedState=ds=f:ds=ds.next=f}return ds}function Zd(f,g){return typeof g=="function"?g(f):g}function Af(f){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=f;var O=us,M=O.baseQueue,H=b.pending;if(H!==null){if(M!==null){var ae=M.next;M.next=H.next,H.next=ae}O.baseQueue=M=H,b.pending=null}if(M!==null){H=M.next,O=O.baseState;var Te=ae=null,Le=null,nt=H;do{var At=nt.lane;if((ql&At)===At)Le!==null&&(Le=Le.next={lane:0,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),O=nt.hasEagerState?nt.eagerState:f(O,nt.action);else{var Pt={lane:At,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null};Le===null?(Te=Le=Pt,ae=O):Le=Le.next=Pt,Ni.lanes|=At,kf|=At}nt=nt.next}while(nt!==null&&nt!==H);Le===null?ae=O:Le.next=Te,ul(O,g.memoizedState)||(ga=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=Le,b.lastRenderedState=O}if(f=b.interleaved,f!==null){M=f;do H=M.lane,Ni.lanes|=H,kf|=H,M=M.next;while(M!==f)}else M===null&&(b.lanes=0);return[g.memoizedState,b.dispatch]}function om(f){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=f;var O=b.dispatch,M=b.pending,H=g.memoizedState;if(M!==null){b.pending=null;var ae=M=M.next;do H=f(H,ae.action),ae=ae.next;while(ae!==M);ul(H,g.memoizedState)||(ga=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),b.lastRenderedState=H}return[H,O]}function GC(){}function oT(f,g){var b=Ni,O=ma(),M=g(),H=!ul(O.memoizedState,M);if(H&&(O.memoizedState=M,ga=!0),O=O.queue,wc($C.bind(null,b,O,f),[f]),O.getSnapshot!==g||H||ds!==null&&ds.memoizedState.tag&1){if(b.flags|=2048,t_(9,aT.bind(null,b,O,M,g),void 0,null),js===null)throw Error(s(349));(ql&30)!==0||HC(b,g,M)}return M}function HC(f,g,b){f.flags|=16384,f={getSnapshot:g,value:b},g=Ni.updateQueue,g===null?(g={lastEffect:null,stores:null},Ni.updateQueue=g,g.stores=[f]):(b=g.stores,b===null?g.stores=[f]:b.push(f))}function aT(f,g,b,O){g.value=b,g.getSnapshot=O,KC(g)&&my(f)}function $C(f,g,b){return b(function(){KC(g)&&my(f)})}function KC(f){var g=f.getSnapshot;f=f.value;try{var b=g();return!ul(f,b)}catch{return!0}}function my(f){var g=Xu(f,1);g!==null&&Ac(g,f,1,-1)}function gy(f){var g=jo();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zd,lastRenderedState:f},g.queue=f,f=f.dispatch=O1.bind(null,Ni,f),[g.memoizedState,f]}function t_(f,g,b,O){return f={tag:f,create:g,destroy:b,deps:O,next:null},g=Ni.updateQueue,g===null?(g={lastEffect:null,stores:null},Ni.updateQueue=g,g.lastEffect=f.next=f):(b=g.lastEffect,b===null?g.lastEffect=f.next=f:(O=b.next,b.next=f,f.next=O,g.lastEffect=f)),f}function qC(){return ma().memoizedState}function n_(f,g,b,O){var M=jo();Ni.flags|=f,M.memoizedState=t_(1|g,b,void 0,O===void 0?null:O)}function am(f,g,b,O){var M=ma();O=O===void 0?null:O;var H=void 0;if(us!==null){var ae=us.memoizedState;if(H=ae.destroy,O!==null&&iT(O,ae.deps)){M.memoizedState=t_(g,b,H,O);return}}Ni.flags|=f,M.memoizedState=t_(1|g,b,H,O)}function YC(f,g){return n_(8390656,8,f,g)}function wc(f,g){return am(2048,8,f,g)}function Pf(f,g){return am(4,2,f,g)}function eh(f,g){return am(4,4,f,g)}function cT(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function lT(f,g,b){return b=b!=null?b.concat([f]):null,am(4,4,cT.bind(null,g,f),b)}function Ju(){}function _y(f,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&iT(g,O[1])?O[0]:(b.memoizedState=[f,g],f)}function XC(f,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&iT(g,O[1])?O[0]:(f=f(),b.memoizedState=[f,g],f)}function uT(f,g,b){return(ql&21)===0?(f.baseState&&(f.baseState=!1,ga=!0),f.memoizedState=b):(ul(b,g)||(b=Vu(),Ni.lanes|=b,kf|=b,f.baseState=!0),g)}function P1(f,g){var b=rr;rr=b!==0&&4>b?b:4,f(!0);var O=rT.transition;rT.transition={};try{f(!1),g()}finally{rr=b,rT.transition=O}}function dT(){return ma().memoizedState}function JC(f,g,b){var O=Ic(f);if(b={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null},Qu(f))QC(g,b);else if(b=FC(f,g,b,O),b!==null){var M=Qs();Ac(b,f,O,M),ZC(b,g,O)}}function O1(f,g,b){var O=Ic(f),M={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null};if(Qu(f))QC(g,M);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ae=g.lastRenderedState,Te=H(ae,b);if(M.hasEagerState=!0,M.eagerState=Te,ul(Te,ae)){var Le=g.interleaved;Le===null?(M.next=M,Z0(g)):(M.next=Le.next,Le.next=M),g.interleaved=M;return}}catch{}finally{}b=FC(f,g,M,O),b!==null&&(M=Qs(),Ac(b,f,O,M),ZC(b,g,O))}}function Qu(f){var g=f.alternate;return f===Ni||g!==null&&g===Ni}function QC(f,g){Zg=im=!0;var b=f.pending;b===null?g.next=g:(g.next=b.next,b.next=g),f.pending=g}function ZC(f,g,b){if((b&4194240)!==0){var O=g.lanes;O&=f.pendingLanes,b|=O,g.lanes=b,ja(f,b)}}var Ey={readContext:bc,useCallback:po,useContext:po,useEffect:po,useImperativeHandle:po,useInsertionEffect:po,useLayoutEffect:po,useMemo:po,useReducer:po,useRef:po,useState:po,useDebugValue:po,useDeferredValue:po,useTransition:po,useMutableSource:po,useSyncExternalStore:po,useId:po,unstable_isNewReconciler:!1},k1={readContext:bc,useCallback:function(f,g){return jo().memoizedState=[f,g===void 0?null:g],f},useContext:bc,useEffect:YC,useImperativeHandle:function(f,g,b){return b=b!=null?b.concat([f]):null,n_(4194308,4,cT.bind(null,g,f),b)},useLayoutEffect:function(f,g){return n_(4194308,4,f,g)},useInsertionEffect:function(f,g){return n_(4,2,f,g)},useMemo:function(f,g){var b=jo();return g=g===void 0?null:g,f=f(),b.memoizedState=[f,g],f},useReducer:function(f,g,b){var O=jo();return g=b!==void 0?b(g):g,O.memoizedState=O.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},O.queue=f,f=f.dispatch=JC.bind(null,Ni,f),[O.memoizedState,f]},useRef:function(f){var g=jo();return f={current:f},g.memoizedState=f},useState:gy,useDebugValue:Ju,useDeferredValue:function(f){return jo().memoizedState=f},useTransition:function(){var f=gy(!1),g=f[0];return f=P1.bind(null,f[1]),jo().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,b){var O=Ni,M=jo();if(ii){if(b===void 0)throw Error(s(407));b=b()}else{if(b=g(),js===null)throw Error(s(349));(ql&30)!==0||HC(O,g,b)}M.memoizedState=b;var H={value:b,getSnapshot:g};return M.queue=H,YC($C.bind(null,O,H,f),[f]),O.flags|=2048,t_(9,aT.bind(null,O,H,b,g),void 0,null),b},useId:function(){var f=jo(),g=js.identifierPrefix;if(ii){var b=Ku,O=$u;b=(O&~(1<<32-Ys(O)-1)).toString(32)+b,g=":"+g+"R"+b,b=e_++,0<b&&(g+="H"+b.toString(32)),g+=":"}else b=A1++,g=":"+g+"r"+b.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},eI={readContext:bc,useCallback:_y,useContext:bc,useEffect:wc,useImperativeHandle:lT,useInsertionEffect:Pf,useLayoutEffect:eh,useMemo:XC,useReducer:Af,useRef:qC,useState:function(){return Af(Zd)},useDebugValue:Ju,useDeferredValue:function(f){var g=ma();return uT(g,us.memoizedState,f)},useTransition:function(){var f=Af(Zd)[0],g=ma().memoizedState;return[f,g]},useMutableSource:GC,useSyncExternalStore:oT,useId:dT,unstable_isNewReconciler:!1},N1={readContext:bc,useCallback:_y,useContext:bc,useEffect:wc,useImperativeHandle:lT,useInsertionEffect:Pf,useLayoutEffect:eh,useMemo:XC,useReducer:om,useRef:qC,useState:function(){return om(Zd)},useDebugValue:Ju,useDeferredValue:function(f){var g=ma();return us===null?g.memoizedState=f:uT(g,us.memoizedState,f)},useTransition:function(){var f=om(Zd)[0],g=ma().memoizedState;return[f,g]},useMutableSource:GC,useSyncExternalStore:oT,useId:dT,unstable_isNewReconciler:!1};function Ha(f,g){if(f&&f.defaultProps){g=Xe({},g),f=f.defaultProps;for(var b in f)g[b]===void 0&&(g[b]=f[b]);return g}return g}function yy(f,g,b,O){g=f.memoizedState,b=b(O,g),b=b==null?g:Xe({},g,b),f.memoizedState=b,f.lanes===0&&(f.updateQueue.baseState=b)}var vy={isMounted:function(f){return(f=f._reactInternals)?Vs(f)===f:!1},enqueueSetState:function(f,g,b){f=f._reactInternals;var O=Qs(),M=Ic(f),H=$l(O,M);H.payload=g,b!=null&&(H.callback=b),g=Jd(f,H,M),g!==null&&(Ac(g,f,M,O),Xg(g,f,M))},enqueueReplaceState:function(f,g,b){f=f._reactInternals;var O=Qs(),M=Ic(f),H=$l(O,M);H.tag=1,H.payload=g,b!=null&&(H.callback=b),g=Jd(f,H,M),g!==null&&(Ac(g,f,M,O),Xg(g,f,M))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var b=Qs(),O=Ic(f),M=$l(b,O);M.tag=2,g!=null&&(M.callback=g),g=Jd(f,M,O),g!==null&&(Ac(g,f,O,b),Xg(g,f,O))}};function hT(f,g,b,O,M,H,ae){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(O,H,ae):g.prototype&&g.prototype.isPureReactComponent?!xg(b,O)||!xg(M,H):!0}function tI(f,g,b){var O=!1,M=Kd,H=g.contextType;return typeof H=="object"&&H!==null?H=bc(H):(M=ha(g)?Tf:fo.current,O=g.contextTypes,H=(O=O!=null)?bf(f,M):Kd),g=new g(b,H),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=vy,f.stateNode=g,g._reactInternals=f,O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=M,f.__reactInternalMemoizedMaskedChildContext=H),g}function nI(f,g,b,O){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(b,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(b,O),g.state!==f&&vy.enqueueReplaceState(g,g.state,null)}function fT(f,g,b,O){var M=f.stateNode;M.props=b,M.state=f.memoizedState,M.refs={},Yg(f);var H=g.contextType;typeof H=="object"&&H!==null?M.context=bc(H):(H=ha(g)?Tf:fo.current,M.context=bf(f,H)),M.state=f.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(yy(f,g,H,b),M.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&vy.enqueueReplaceState(M,M.state,null),fy(f,b,M,O),M.state=f.memoizedState),typeof M.componentDidMount=="function"&&(f.flags|=4194308)}function cm(f,g){try{var b="",O=g;do b+=We(O),O=O.return;while(O);var M=b}catch(H){M=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:g,stack:M,digest:null}}function pT(f,g,b){return{value:f,source:null,stack:b??null,digest:g??null}}function mT(f,g){try{console.error(g.value)}catch(b){setTimeout(function(){throw b})}}var D1=typeof WeakMap=="function"?WeakMap:Map;function gT(f,g,b){b=$l(-1,b),b.tag=3,b.payload={element:null};var O=g.value;return b.callback=function(){Vy||(Vy=!0,IT=O),mT(f,g)},b}function Zu(f,g,b){b=$l(-1,b),b.tag=3;var O=f.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;b.payload=function(){return O(M)},b.callback=function(){mT(f,g)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(b.callback=function(){mT(f,g),typeof O!="function"&&(th===null?th=new Set([this]):th.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),b}function rI(f,g,b){var O=f.pingCache;if(O===null){O=f.pingCache=new D1;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(b)||(M.add(b),f=II.bind(null,f,g,b),g.then(f,f))}function iI(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function sI(f,g,b,O,M){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(g=$l(-1,1),g.tag=2,Jd(b,g,1))),b.lanes|=1),f):(f.flags|=65536,f.lanes=M,f)}var L1=de.ReactCurrentOwner,ga=!1;function Bo(f,g,b,O){g.child=f===null?VC(g,null,b,O):em(g,f.child,b,O)}function Sy(f,g,b,O,M){b=b.render;var H=g.ref;return Yu(g,M),O=sm(f,g,b,O,H,M),b=sT(),f!==null&&!ga?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Yl(f,g,M)):(ii&&b&&cy(g),g.flags|=1,Bo(f,g,O,M),g.child)}function oI(f,g,b,O,M){if(f===null){var H=b.type;return typeof H=="function"&&!rh(H)&&H.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(g.tag=15,g.type=H,aI(f,g,H,O,M)):(f=Xy(b.type,null,O,g,g.mode,M),f.ref=g.ref,f.return=g,g.child=f)}if(H=f.child,(f.lanes&M)===0){var ae=H.memoizedProps;if(b=b.compare,b=b!==null?b:xg,b(ae,O)&&f.ref===g.ref)return Yl(f,g,M)}return g.flags|=1,f=nd(H,O),f.ref=g.ref,f.return=g,g.child=f}function aI(f,g,b,O,M){if(f!==null){var H=f.memoizedProps;if(xg(H,O)&&f.ref===g.ref)if(ga=!1,g.pendingProps=O=H,(f.lanes&M)!==0)(f.flags&131072)!==0&&(ga=!0);else return g.lanes=f.lanes,Yl(f,g,M)}return _T(f,g,b,O,M)}function cI(f,g,b){var O=g.pendingProps,M=O.children,H=f!==null?f.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},mi(dl,$a),$a|=b;else{if((b&1073741824)===0)return f=H!==null?H.baseLanes|b:b,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,mi(dl,$a),$a|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:b,mi(dl,$a),$a|=O}else H!==null?(O=H.baseLanes|b,g.memoizedState=null):O=b,mi(dl,$a),$a|=O;return Bo(f,g,M,b),g.child}function lI(f,g){var b=g.ref;(f===null&&b!==null||f!==null&&f.ref!==b)&&(g.flags|=512,g.flags|=2097152)}function _T(f,g,b,O,M){var H=ha(b)?Tf:fo.current;return H=bf(g,H),Yu(g,M),b=sm(f,g,b,O,H,M),O=sT(),f!==null&&!ga?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,Yl(f,g,M)):(ii&&O&&cy(g),g.flags|=1,Bo(f,g,b,M),g.child)}function uI(f,g,b,O,M){if(ha(b)){var H=!0;iy(g)}else H=!1;if(Yu(g,M),g.stateNode===null)Iy(f,g),tI(g,b,O),fT(g,b,O,M),O=!0;else if(f===null){var ae=g.stateNode,Te=g.memoizedProps;ae.props=Te;var Le=ae.context,nt=b.contextType;typeof nt=="object"&&nt!==null?nt=bc(nt):(nt=ha(b)?Tf:fo.current,nt=bf(g,nt));var At=b.getDerivedStateFromProps,Pt=typeof At=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Pt||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Te!==O||Le!==nt)&&nI(g,ae,O,nt),Xd=!1;var Rt=g.memoizedState;ae.state=Rt,fy(g,O,ae,M),Le=g.memoizedState,Te!==O||Rt!==Le||da.current||Xd?(typeof At=="function"&&(yy(g,b,At,O),Le=g.memoizedState),(Te=Xd||hT(g,b,Te,O,Rt,Le,nt))?(Pt||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Le),ae.props=O,ae.state=Le,ae.context=nt,O=Te):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,jC(f,g),Te=g.memoizedProps,nt=g.type===g.elementType?Te:Ha(g.type,Te),ae.props=nt,Pt=g.pendingProps,Rt=ae.context,Le=b.contextType,typeof Le=="object"&&Le!==null?Le=bc(Le):(Le=ha(b)?Tf:fo.current,Le=bf(g,Le));var $t=b.getDerivedStateFromProps;(At=typeof $t=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Te!==Pt||Rt!==Le)&&nI(g,ae,O,Le),Xd=!1,Rt=g.memoizedState,ae.state=Rt,fy(g,O,ae,M);var tn=g.memoizedState;Te!==Pt||Rt!==tn||da.current||Xd?(typeof $t=="function"&&(yy(g,b,$t,O),tn=g.memoizedState),(nt=Xd||hT(g,b,nt,O,Rt,tn,Le)||!1)?(At||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,tn,Le),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,tn,Le)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Te===f.memoizedProps&&Rt===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&Rt===f.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=tn),ae.props=O,ae.state=tn,ae.context=Le,O=nt):(typeof ae.componentDidUpdate!="function"||Te===f.memoizedProps&&Rt===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Te===f.memoizedProps&&Rt===f.memoizedState||(g.flags|=1024),O=!1)}return Ty(f,g,b,O,H,M)}function Ty(f,g,b,O,M,H){lI(f,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&NC(g,b,!1),Yl(f,g,H);O=g.stateNode,L1.current=g;var Te=ae&&typeof b.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,f!==null&&ae?(g.child=em(g,f.child,null,H),g.child=em(g,null,Te,H)):Bo(f,g,Te,H),g.memoizedState=O.state,M&&NC(g,b,!0),g.child}function ET(f){var g=f.stateNode;g.pendingContext?kC(f,g.pendingContext,g.pendingContext!==g.context):g.context&&kC(f,g.context,!1),eT(f,g.containerInfo)}function dI(f,g,b,O,M){return Zp(),q0(M),g.flags|=256,Bo(f,g,b,O),g.child}var yT={dehydrated:null,treeContext:null,retryLane:0};function lm(f){return{baseLanes:f,cachePool:null,transitions:null}}function by(f,g,b){var O=g.pendingProps,M=Ci.current,H=!1,ae=(g.flags&128)!==0,Te;if((Te=ae)||(Te=f!==null&&f.memoizedState===null?!1:(M&2)!==0),Te?(H=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(M|=1),mi(Ci,M&1),f===null)return K0(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,f=O.fallback,H?(O=g.mode,H=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ae):H=ih(ae,O,0,null),f=Mf(f,O,b,null),H.return=g,f.return=g,H.sibling=f,g.child=H,g.child.memoizedState=lm(b),g.memoizedState=yT,f):wy(g,ae));if(M=f.memoizedState,M!==null&&(Te=M.dehydrated,Te!==null))return hI(f,g,ae,O,Te,M,b);if(H){H=O.fallback,ae=g.mode,M=f.child,Te=M.sibling;var Le={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=Le,g.deletions=null):(O=nd(M,Le),O.subtreeFlags=M.subtreeFlags&14680064),Te!==null?H=nd(Te,H):(H=Mf(H,ae,b,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ae=f.child.memoizedState,ae=ae===null?lm(b):{baseLanes:ae.baseLanes|b,cachePool:null,transitions:ae.transitions},H.memoizedState=ae,H.childLanes=f.childLanes&~b,g.memoizedState=yT,O}return H=f.child,f=H.sibling,O=nd(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=b),O.return=g,O.sibling=null,f!==null&&(b=g.deletions,b===null?(g.deletions=[f],g.flags|=16):b.push(f)),g.child=O,g.memoizedState=null,O}function wy(f,g){return g=ih({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Of(f,g,b,O){return O!==null&&q0(O),em(g,f.child,null,b),f=wy(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function hI(f,g,b,O,M,H,ae){if(b)return g.flags&256?(g.flags&=-257,O=pT(Error(s(422))),Of(f,g,ae,O)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(H=O.fallback,M=g.mode,O=ih({mode:"visible",children:O.children},M,0,null),H=Mf(H,M,ae,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&em(g,f.child,null,ae),g.child.memoizedState=lm(ae),g.memoizedState=yT,H);if((g.mode&1)===0)return Of(f,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Te=O.dgst;return O=Te,H=Error(s(419)),O=pT(H,O,void 0),Of(f,g,ae,O)}if(Te=(ae&f.childLanes)!==0,ga||Te){if(O=js,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==H.retryLane&&(H.retryLane=M,Xu(f,M),Ac(O,f,M,-1))}return OT(),O=pT(Error(s(421))),Of(f,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=f.child,g=Ky.bind(null,f),M._reactRetry=g,null):(f=H.treeContext,pa=Hd(M.nextSibling),fa=g,ii=!0,Fo=null,f!==null&&(Tc[Ga++]=$u,Tc[Ga++]=Ku,Tc[Ga++]=wf,$u=f.id,Ku=f.overflow,wf=g),g=wy(g,O.children),g.flags|=4096,g)}function fI(f,g,b){f.lanes|=g;var O=f.alternate;O!==null&&(O.lanes|=g),Q0(f.return,g,b)}function Ry(f,g,b,O,M){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:b,tailMode:M}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=b,H.tailMode=M)}function Cy(f,g,b){var O=g.pendingProps,M=O.revealOrder,H=O.tail;if(Bo(f,g,O.children,b),O=Ci.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&fI(f,b,g);else if(f.tag===19)fI(f,b,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}O&=1}if(mi(Ci,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(b=g.child,M=null;b!==null;)f=b.alternate,f!==null&&Qd(f)===null&&(M=b),b=b.sibling;b=M,b===null?(M=g.child,g.child=null):(M=b.sibling,b.sibling=null),Ry(g,!1,M,b,H);break;case"backwards":for(b=null,M=g.child,g.child=null;M!==null;){if(f=M.alternate,f!==null&&Qd(f)===null){g.child=M;break}f=M.sibling,M.sibling=b,b=M,M=f}Ry(g,!0,b,null,H);break;case"together":Ry(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Iy(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Yl(f,g,b){if(f!==null&&(g.dependencies=f.dependencies),kf|=g.lanes,(b&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(s(153));if(g.child!==null){for(f=g.child,b=nd(f,f.pendingProps),g.child=b,b.return=g;f.sibling!==null;)f=f.sibling,b=b.sibling=nd(f,f.pendingProps),b.return=g;b.sibling=null}return g.child}function pI(f,g,b){switch(g.tag){case 3:ET(g),Zp();break;case 5:zC(g);break;case 1:ha(g.type)&&iy(g);break;case 4:eT(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;mi(dy,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(mi(Ci,Ci.current&1),g.flags|=128,null):(b&g.child.childLanes)!==0?by(f,g,b):(mi(Ci,Ci.current&1),f=Yl(f,g,b),f!==null?f.sibling:null);mi(Ci,Ci.current&1);break;case 19:if(O=(b&g.childLanes)!==0,(f.flags&128)!==0){if(O)return Cy(f,g,b);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),mi(Ci,Ci.current),O)break;return null;case 22:case 23:return g.lanes=0,cI(f,g,b)}return Yl(f,g,b)}var mI,Ay,vT,gI;mI=function(f,g){for(var b=g.child;b!==null;){if(b.tag===5||b.tag===6)f.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===g)break;for(;b.sibling===null;){if(b.return===null||b.return===g)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},Ay=function(){},vT=function(f,g,b,O){var M=f.memoizedProps;if(M!==O){f=g.stateNode,Cf(Kl.current);var H=null;switch(b){case"input":M=xn(f,M),O=xn(f,O),H=[];break;case"select":M=Xe({},M,{value:void 0}),O=Xe({},O,{value:void 0}),H=[];break;case"textarea":M=vt(f,M),O=vt(f,O),H=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(f.onclick=ey)}Ma(b,O);var ae;b=null;for(nt in M)if(!O.hasOwnProperty(nt)&&M.hasOwnProperty(nt)&&M[nt]!=null)if(nt==="style"){var Te=M[nt];for(ae in Te)Te.hasOwnProperty(ae)&&(b||(b={}),b[ae]="")}else nt!=="dangerouslySetInnerHTML"&&nt!=="children"&&nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&nt!=="autoFocus"&&(l.hasOwnProperty(nt)?H||(H=[]):(H=H||[]).push(nt,null));for(nt in O){var Le=O[nt];if(Te=M!=null?M[nt]:void 0,O.hasOwnProperty(nt)&&Le!==Te&&(Le!=null||Te!=null))if(nt==="style")if(Te){for(ae in Te)!Te.hasOwnProperty(ae)||Le&&Le.hasOwnProperty(ae)||(b||(b={}),b[ae]="");for(ae in Le)Le.hasOwnProperty(ae)&&Te[ae]!==Le[ae]&&(b||(b={}),b[ae]=Le[ae])}else b||(H||(H=[]),H.push(nt,b)),b=Le;else nt==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Te=Te?Te.__html:void 0,Le!=null&&Te!==Le&&(H=H||[]).push(nt,Le)):nt==="children"?typeof Le!="string"&&typeof Le!="number"||(H=H||[]).push(nt,""+Le):nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&(l.hasOwnProperty(nt)?(Le!=null&&nt==="onScroll"&&vi("scroll",f),H||Te===Le||(H=[])):(H=H||[]).push(nt,Le))}b&&(H=H||[]).push("style",b);var nt=H;(g.updateQueue=nt)&&(g.flags|=4)}},gI=function(f,g,b,O){b!==O&&(g.flags|=4)};function r_(f,g){if(!ii)switch(f.tailMode){case"hidden":g=f.tail;for(var b=null;g!==null;)g.alternate!==null&&(b=g),g=g.sibling;b===null?f.tail=null:b.sibling=null;break;case"collapsed":b=f.tail;for(var O=null;b!==null;)b.alternate!==null&&(O=b),b=b.sibling;O===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:O.sibling=null}}function mo(f){var g=f.alternate!==null&&f.alternate.child===f.child,b=0,O=0;if(g)for(var M=f.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=f,M=M.sibling;else for(M=f.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=f,M=M.sibling;return f.subtreeFlags|=O,f.childLanes=b,g}function Py(f,g,b){var O=g.pendingProps;switch(Hg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mo(g),null;case 1:return ha(g.type)&&ny(),mo(g),null;case 3:return O=g.stateNode,If(),Si(da),Si(fo),nT(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(f===null||f.child===null)&&($g(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Fo!==null&&(zy(Fo),Fo=null))),Ay(f,g),mo(g),null;case 5:rm(g);var M=Cf(nm.current);if(b=g.type,f!==null&&g.stateNode!=null)vT(f,g,b,O,M),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return mo(g),null}if(f=Cf(Kl.current),$g(g)){O=g.stateNode,b=g.type;var H=g.memoizedProps;switch(O[Hl]=g,O[$d]=H,f=(g.mode&1)!==0,b){case"dialog":vi("cancel",O),vi("close",O);break;case"iframe":case"object":case"embed":vi("load",O);break;case"video":case"audio":for(M=0;M<Fg.length;M++)vi(Fg[M],O);break;case"source":vi("error",O);break;case"img":case"image":case"link":vi("error",O),vi("load",O);break;case"details":vi("toggle",O);break;case"input":Qt(O,H),vi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},vi("invalid",O);break;case"textarea":St(O,H),vi("invalid",O)}Ma(b,H),M=null;for(var ae in H)if(H.hasOwnProperty(ae)){var Te=H[ae];ae==="children"?typeof Te=="string"?O.textContent!==Te&&(H.suppressHydrationWarning!==!0&&ZE(O.textContent,Te,f),M=["children",Te]):typeof Te=="number"&&O.textContent!==""+Te&&(H.suppressHydrationWarning!==!0&&ZE(O.textContent,Te,f),M=["children",""+Te]):l.hasOwnProperty(ae)&&Te!=null&&ae==="onScroll"&&vi("scroll",O)}switch(b){case"input":yn(O),ve(O,H,!0);break;case"textarea":yn(O),dn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=ey)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=fn(b)),f==="http://www.w3.org/1999/xhtml"?b==="script"?(f=ae.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof O.is=="string"?f=ae.createElement(b,{is:O.is}):(f=ae.createElement(b),b==="select"&&(ae=f,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):f=ae.createElementNS(f,b),f[Hl]=g,f[$d]=O,mI(f,g,!1,!1),g.stateNode=f;e:{switch(ae=tl(b,O),b){case"dialog":vi("cancel",f),vi("close",f),M=O;break;case"iframe":case"object":case"embed":vi("load",f),M=O;break;case"video":case"audio":for(M=0;M<Fg.length;M++)vi(Fg[M],f);M=O;break;case"source":vi("error",f),M=O;break;case"img":case"image":case"link":vi("error",f),vi("load",f),M=O;break;case"details":vi("toggle",f),M=O;break;case"input":Qt(f,O),M=xn(f,O),vi("invalid",f);break;case"option":M=O;break;case"select":f._wrapperState={wasMultiple:!!O.multiple},M=Xe({},O,{value:void 0}),vi("invalid",f);break;case"textarea":St(f,O),M=vt(f,O),vi("invalid",f);break;default:M=O}Ma(b,M),Te=M;for(H in Te)if(Te.hasOwnProperty(H)){var Le=Te[H];H==="style"?qs(f,Le):H==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&cc(f,Le)):H==="children"?typeof Le=="string"?(b!=="textarea"||Le!=="")&&jt(f,Le):typeof Le=="number"&&jt(f,""+Le):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Le!=null&&H==="onScroll"&&vi("scroll",f):Le!=null&&ne(f,H,Le,ae))}switch(b){case"input":yn(f),ve(f,O,!1);break;case"textarea":yn(f),dn(f);break;case"option":O.value!=null&&f.setAttribute("value",""+ut(O.value));break;case"select":f.multiple=!!O.multiple,H=O.value,H!=null?_t(f,!!O.multiple,H,!1):O.defaultValue!=null&&_t(f,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(f.onclick=ey)}switch(b){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return mo(g),null;case 6:if(f&&g.stateNode!=null)gI(f,g,f.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(b=Cf(nm.current),Cf(Kl.current),$g(g)){if(O=g.stateNode,b=g.memoizedProps,O[Hl]=g,(H=O.nodeValue!==b)&&(f=fa,f!==null))switch(f.tag){case 3:ZE(O.nodeValue,b,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&ZE(O.nodeValue,b,(f.mode&1)!==0)}H&&(g.flags|=4)}else O=(b.nodeType===9?b:b.ownerDocument).createTextNode(O),O[Hl]=g,g.stateNode=O}return mo(g),null;case 13:if(Si(Ci),O=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(ii&&pa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)UC(),Zp(),g.flags|=98560,H=!1;else if(H=$g(g),O!==null&&O.dehydrated!==null){if(f===null){if(!H)throw Error(s(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(s(317));H[Hl]=g}else Zp(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;mo(g),H=!1}else Fo!==null&&(zy(Fo),Fo=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=b,g):(O=O!==null,O!==(f!==null&&f.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Ci.current&1)!==0?fs===0&&(fs=3):OT())),g.updateQueue!==null&&(g.flags|=4),mo(g),null);case 4:return If(),Ay(f,g),f===null&&Ef(g.stateNode.containerInfo),mo(g),null;case 10:return J0(g.type._context),mo(g),null;case 17:return ha(g.type)&&ny(),mo(g),null;case 19:if(Si(Ci),H=g.memoizedState,H===null)return mo(g),null;if(O=(g.flags&128)!==0,ae=H.rendering,ae===null)if(O)r_(H,!1);else{if(fs!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ae=Qd(f),ae!==null){for(g.flags|=128,r_(H,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=b,b=g.child;b!==null;)H=b,f=O,H.flags&=14680066,ae=H.alternate,ae===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ae.childLanes,H.lanes=ae.lanes,H.child=ae.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ae.memoizedProps,H.memoizedState=ae.memoizedState,H.updateQueue=ae.updateQueue,H.type=ae.type,f=ae.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),b=b.sibling;return mi(Ci,Ci.current&1|2),g.child}f=f.sibling}H.tail!==null&&Vr()>hm&&(g.flags|=128,O=!0,r_(H,!1),g.lanes=4194304)}else{if(!O)if(f=Qd(ae),f!==null){if(g.flags|=128,O=!0,b=f.updateQueue,b!==null&&(g.updateQueue=b,g.flags|=4),r_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ae.alternate&&!ii)return mo(g),null}else 2*Vr()-H.renderingStartTime>hm&&b!==1073741824&&(g.flags|=128,O=!0,r_(H,!1),g.lanes=4194304);H.isBackwards?(ae.sibling=g.child,g.child=ae):(b=H.last,b!==null?b.sibling=ae:g.child=ae,H.last=ae)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=Vr(),g.sibling=null,b=Ci.current,mi(Ci,O?b&1|2:b&1),g):(mo(g),null);case 22:case 23:return d_(),O=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?($a&1073741824)!==0&&(mo(g),g.subtreeFlags&6&&(g.flags|=8192)):mo(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function x1(f,g){switch(Hg(g),g.tag){case 1:return ha(g.type)&&ny(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return If(),Si(da),Si(fo),nT(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return rm(g),null;case 13:if(Si(Ci),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(s(340));Zp()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Si(Ci),null;case 4:return If(),null;case 10:return J0(g.type._context),null;case 22:case 23:return d_(),null;case 24:return null;default:return null}}var Oy=!1,go=!1,_I=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function um(f,g){var b=f.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(O){Di(f,g,O)}else b.current=null}function i_(f,g,b){try{b()}catch(O){Di(f,g,O)}}var EI=!1;function ST(f,g){if(ty=ye,f=yC(),Mg(f)){if("selectionStart"in f)var b={start:f.selectionStart,end:f.selectionEnd};else e:{b=(b=f.ownerDocument)&&b.defaultView||window;var O=b.getSelection&&b.getSelection();if(O&&O.rangeCount!==0){b=O.anchorNode;var M=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{b.nodeType,H.nodeType}catch{b=null;break e}var ae=0,Te=-1,Le=-1,nt=0,At=0,Pt=f,Rt=null;t:for(;;){for(var $t;Pt!==b||M!==0&&Pt.nodeType!==3||(Te=ae+M),Pt!==H||O!==0&&Pt.nodeType!==3||(Le=ae+O),Pt.nodeType===3&&(ae+=Pt.nodeValue.length),($t=Pt.firstChild)!==null;)Rt=Pt,Pt=$t;for(;;){if(Pt===f)break t;if(Rt===b&&++nt===M&&(Te=ae),Rt===H&&++At===O&&(Le=ae),($t=Pt.nextSibling)!==null)break;Pt=Rt,Rt=Pt.parentNode}Pt=$t}b=Te===-1||Le===-1?null:{start:Te,end:Le}}else b=null}b=b||{start:0,end:0}}else b=null;for(Bg={focusedElem:f,selectionRange:b},ye=!1,Zt=g;Zt!==null;)if(g=Zt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Zt=f;else for(;Zt!==null;){g=Zt;try{var tn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var nn=tn.memoizedProps,Ki=tn.memoizedState,qe=g.stateNode,Fe=qe.getSnapshotBeforeUpdate(g.elementType===g.type?nn:Ha(g.type,nn),Ki);qe.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var Je=g.stateNode.containerInfo;Je.nodeType===1?Je.textContent="":Je.nodeType===9&&Je.documentElement&&Je.removeChild(Je.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Nt){Di(g,g.return,Nt)}if(f=g.sibling,f!==null){f.return=g.return,Zt=f;break}Zt=g.return}return tn=EI,EI=!1,tn}function s_(f,g,b){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&f)===f){var H=M.destroy;M.destroy=void 0,H!==void 0&&i_(g,b,H)}M=M.next}while(M!==O)}}function o_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var b=g=g.next;do{if((b.tag&f)===f){var O=b.create;b.destroy=O()}b=b.next}while(b!==g)}}function TT(f){var g=f.ref;if(g!==null){var b=f.stateNode;switch(f.tag){case 5:f=b;break;default:f=b}typeof g=="function"?g(f):g.current=f}}function yI(f){var g=f.alternate;g!==null&&(f.alternate=null,yI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[Hl],delete g[$d],delete g[zg],delete g[w1],delete g[R1])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function bT(f){return f.tag===5||f.tag===3||f.tag===4}function vI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||bT(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function wT(f,g,b){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?b.nodeType===8?b.parentNode.insertBefore(f,g):b.insertBefore(f,g):(b.nodeType===8?(g=b.parentNode,g.insertBefore(f,b)):(g=b,g.appendChild(f)),b=b._reactRootContainer,b!=null||g.onclick!==null||(g.onclick=ey));else if(O!==4&&(f=f.child,f!==null))for(wT(f,g,b),f=f.sibling;f!==null;)wT(f,g,b),f=f.sibling}function ky(f,g,b){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?b.insertBefore(f,g):b.appendChild(f);else if(O!==4&&(f=f.child,f!==null))for(ky(f,g,b),f=f.sibling;f!==null;)ky(f,g,b),f=f.sibling}var Xs=null,Rc=!1;function Xl(f,g,b){for(b=b.child;b!==null;)SI(f,g,b),b=b.sibling}function SI(f,g,b){if(ho&&typeof ho.onCommitFiberUnmount=="function")try{ho.onCommitFiberUnmount(Ul,b)}catch{}switch(b.tag){case 5:go||um(b,g);case 6:var O=Xs,M=Rc;Xs=null,Xl(f,g,b),Xs=O,Rc=M,Xs!==null&&(Rc?(f=Xs,b=b.stateNode,f.nodeType===8?f.parentNode.removeChild(b):f.removeChild(b)):Xs.removeChild(b.stateNode));break;case 18:Xs!==null&&(Rc?(f=Xs,b=b.stateNode,f.nodeType===8?G0(f.parentNode,b):f.nodeType===1&&G0(f,b),la(f)):G0(Xs,b.stateNode));break;case 4:O=Xs,M=Rc,Xs=b.stateNode.containerInfo,Rc=!0,Xl(f,g,b),Xs=O,Rc=M;break;case 0:case 11:case 14:case 15:if(!go&&(O=b.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var H=M,ae=H.destroy;H=H.tag,ae!==void 0&&((H&2)!==0||(H&4)!==0)&&i_(b,g,ae),M=M.next}while(M!==O)}Xl(f,g,b);break;case 1:if(!go&&(um(b,g),O=b.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=b.memoizedProps,O.state=b.memoizedState,O.componentWillUnmount()}catch(Te){Di(b,g,Te)}Xl(f,g,b);break;case 21:Xl(f,g,b);break;case 22:b.mode&1?(go=(O=go)||b.memoizedState!==null,Xl(f,g,b),go=O):Xl(f,g,b);break;default:Xl(f,g,b)}}function TI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var b=f.stateNode;b===null&&(b=f.stateNode=new _I),g.forEach(function(O){var M=AI.bind(null,f,O);b.has(O)||(b.add(O),O.then(M,M))})}}function Wo(f,g){var b=g.deletions;if(b!==null)for(var O=0;O<b.length;O++){var M=b[O];try{var H=f,ae=g,Te=ae;e:for(;Te!==null;){switch(Te.tag){case 5:Xs=Te.stateNode,Rc=!1;break e;case 3:Xs=Te.stateNode.containerInfo,Rc=!0;break e;case 4:Xs=Te.stateNode.containerInfo,Rc=!0;break e}Te=Te.return}if(Xs===null)throw Error(s(160));SI(H,ae,M),Xs=null,Rc=!1;var Le=M.alternate;Le!==null&&(Le.return=null),M.return=null}catch(nt){Di(M,g,nt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)RT(g,f),g=g.sibling}function RT(f,g){var b=f.alternate,O=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(Wo(g,f),_a(f),O&4){try{s_(3,f,f.return),o_(3,f)}catch(nn){Di(f,f.return,nn)}try{s_(5,f,f.return)}catch(nn){Di(f,f.return,nn)}}break;case 1:Wo(g,f),_a(f),O&512&&b!==null&&um(b,b.return);break;case 5:if(Wo(g,f),_a(f),O&512&&b!==null&&um(b,b.return),f.flags&32){var M=f.stateNode;try{jt(M,"")}catch(nn){Di(f,f.return,nn)}}if(O&4&&(M=f.stateNode,M!=null)){var H=f.memoizedProps,ae=b!==null?b.memoizedProps:H,Te=f.type,Le=f.updateQueue;if(f.updateQueue=null,Le!==null)try{Te==="input"&&H.type==="radio"&&H.name!=null&&Ot(M,H),tl(Te,ae);var nt=tl(Te,H);for(ae=0;ae<Le.length;ae+=2){var At=Le[ae],Pt=Le[ae+1];At==="style"?qs(M,Pt):At==="dangerouslySetInnerHTML"?cc(M,Pt):At==="children"?jt(M,Pt):ne(M,At,Pt,nt)}switch(Te){case"input":Dt(M,H);break;case"textarea":zt(M,H);break;case"select":var Rt=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!H.multiple;var $t=H.value;$t!=null?_t(M,!!H.multiple,$t,!1):Rt!==!!H.multiple&&(H.defaultValue!=null?_t(M,!!H.multiple,H.defaultValue,!0):_t(M,!!H.multiple,H.multiple?[]:"",!1))}M[$d]=H}catch(nn){Di(f,f.return,nn)}}break;case 6:if(Wo(g,f),_a(f),O&4){if(f.stateNode===null)throw Error(s(162));M=f.stateNode,H=f.memoizedProps;try{M.nodeValue=H}catch(nn){Di(f,f.return,nn)}}break;case 3:if(Wo(g,f),_a(f),O&4&&b!==null&&b.memoizedState.isDehydrated)try{la(g.containerInfo)}catch(nn){Di(f,f.return,nn)}break;case 4:Wo(g,f),_a(f);break;case 13:Wo(g,f),_a(f),M=f.child,M.flags&8192&&(H=M.memoizedState!==null,M.stateNode.isHidden=H,!H||M.alternate!==null&&M.alternate.memoizedState!==null||(Uy=Vr())),O&4&&TI(f);break;case 22:if(At=b!==null&&b.memoizedState!==null,f.mode&1?(go=(nt=go)||At,Wo(g,f),go=nt):Wo(g,f),_a(f),O&8192){if(nt=f.memoizedState!==null,(f.stateNode.isHidden=nt)&&!At&&(f.mode&1)!==0)for(Zt=f,At=f.child;At!==null;){for(Pt=Zt=At;Zt!==null;){switch(Rt=Zt,$t=Rt.child,Rt.tag){case 0:case 11:case 14:case 15:s_(4,Rt,Rt.return);break;case 1:um(Rt,Rt.return);var tn=Rt.stateNode;if(typeof tn.componentWillUnmount=="function"){O=Rt,b=Rt.return;try{g=O,tn.props=g.memoizedProps,tn.state=g.memoizedState,tn.componentWillUnmount()}catch(nn){Di(O,b,nn)}}break;case 5:um(Rt,Rt.return);break;case 22:if(Rt.memoizedState!==null){a_(Pt);continue}}$t!==null?($t.return=Rt,Zt=$t):a_(Pt)}At=At.sibling}e:for(At=null,Pt=f;;){if(Pt.tag===5){if(At===null){At=Pt;try{M=Pt.stateNode,nt?(H=M.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Te=Pt.stateNode,Le=Pt.memoizedProps.style,ae=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Te.style.display=Ms("display",ae))}catch(nn){Di(f,f.return,nn)}}}else if(Pt.tag===6){if(At===null)try{Pt.stateNode.nodeValue=nt?"":Pt.memoizedProps}catch(nn){Di(f,f.return,nn)}}else if((Pt.tag!==22&&Pt.tag!==23||Pt.memoizedState===null||Pt===f)&&Pt.child!==null){Pt.child.return=Pt,Pt=Pt.child;continue}if(Pt===f)break e;for(;Pt.sibling===null;){if(Pt.return===null||Pt.return===f)break e;At===Pt&&(At=null),Pt=Pt.return}At===Pt&&(At=null),Pt.sibling.return=Pt.return,Pt=Pt.sibling}}break;case 19:Wo(g,f),_a(f),O&4&&TI(f);break;case 21:break;default:Wo(g,f),_a(f)}}function _a(f){var g=f.flags;if(g&2){try{e:{for(var b=f.return;b!==null;){if(bT(b)){var O=b;break e}b=b.return}throw Error(s(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(jt(M,""),O.flags&=-33);var H=vI(f);ky(f,H,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Te=vI(f);wT(f,Te,ae);break;default:throw Error(s(161))}}catch(Le){Di(f,f.return,Le)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function dm(f,g,b){Zt=f,CT(f)}function CT(f,g,b){for(var O=(f.mode&1)!==0;Zt!==null;){var M=Zt,H=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||Oy;if(!ae){var Te=M.alternate,Le=Te!==null&&Te.memoizedState!==null||go;Te=Oy;var nt=go;if(Oy=ae,(go=Le)&&!nt)for(Zt=M;Zt!==null;)ae=Zt,Le=ae.child,ae.tag===22&&ae.memoizedState!==null?bI(M):Le!==null?(Le.return=ae,Zt=Le):bI(M);for(;H!==null;)Zt=H,CT(H),H=H.sibling;Zt=M,Oy=Te,go=nt}Ny(f)}else(M.subtreeFlags&8772)!==0&&H!==null?(H.return=M,Zt=H):Ny(f)}}function Ny(f){for(;Zt!==null;){var g=Zt;if((g.flags&8772)!==0){var b=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:go||o_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!go)if(b===null)O.componentDidMount();else{var M=g.elementType===g.type?b.memoizedProps:Ha(g.type,b.memoizedProps);O.componentDidUpdate(M,b.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&WC(g,H,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(b=null,g.child!==null)switch(g.child.tag){case 5:b=g.child.stateNode;break;case 1:b=g.child.stateNode}WC(g,ae,b)}break;case 5:var Te=g.stateNode;if(b===null&&g.flags&4){b=Te;var Le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&b.focus();break;case"img":Le.src&&(b.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var nt=g.alternate;if(nt!==null){var At=nt.memoizedState;if(At!==null){var Pt=At.dehydrated;Pt!==null&&la(Pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}go||g.flags&512&&TT(g)}catch(Rt){Di(g,g.return,Rt)}}if(g===f){Zt=null;break}if(b=g.sibling,b!==null){b.return=g.return,Zt=b;break}Zt=g.return}}function a_(f){for(;Zt!==null;){var g=Zt;if(g===f){Zt=null;break}var b=g.sibling;if(b!==null){b.return=g.return,Zt=b;break}Zt=g.return}}function bI(f){for(;Zt!==null;){var g=Zt;try{switch(g.tag){case 0:case 11:case 15:var b=g.return;try{o_(4,g)}catch(Le){Di(g,b,Le)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(Le){Di(g,M,Le)}}var H=g.return;try{TT(g)}catch(Le){Di(g,H,Le)}break;case 5:var ae=g.return;try{TT(g)}catch(Le){Di(g,ae,Le)}}}catch(Le){Di(g,g.return,Le)}if(g===f){Zt=null;break}var Te=g.sibling;if(Te!==null){Te.return=g.return,Zt=Te;break}Zt=g.return}}var M1=Math.ceil,Dy=de.ReactCurrentDispatcher,Ly=de.ReactCurrentOwner,Cc=de.ReactCurrentBatchConfig,Tr=0,js=null,$i=null,hs=0,$a=0,dl=vc(0),fs=0,Js=null,kf=0,xy=0,My=0,c_=null,zo=null,Uy=0,hm=1/0,Jl=null,Vy=!1,IT=null,th=null,fm=!1,Ql=null,Fy=0,Nf=0,AT=null,l_=-1,jy=0;function Qs(){return(Tr&6)!==0?Vr():l_!==-1?l_:l_=Vr()}function Ic(f){return(f.mode&1)===0?1:(Tr&2)!==0&&hs!==0?hs&-hs:I1.transition!==null?(jy===0&&(jy=Vu()),jy):(f=rr,f!==0||(f=window.event,f=f===void 0?16:Fr(f.type)),f)}function Ac(f,g,b,O){if(50<Nf)throw Nf=0,AT=null,Error(s(185));jl(f,b,O),((Tr&2)===0||f!==js)&&(f===js&&((Tr&2)===0&&(xy|=b),fs===4&&ed(f,hs)),_o(f,O),b===1&&Tr===0&&(g.mode&1)===0&&(hm=Vr()+500,sy&&qd()))}function _o(f,g){var b=f.callbackNode;Fa(f,g);var O=Fl(f,f===js?hs:0);if(O===0)b!==null&&Mu(b),f.callbackNode=null,f.callbackPriority=0;else if(g=O&-O,f.callbackPriority!==g){if(b!=null&&Mu(b),g===1)f.tag===0?C1(Df.bind(null,f)):DC(Df.bind(null,f)),T1(function(){(Tr&6)===0&&qd()}),b=null;else{switch(pc(O)){case 1:b=fc;break;case 4:b=il;break;case 16:b=aa;break;case 536870912:b=Fd;break;default:b=aa}b=h_(b,By.bind(null,f))}f.callbackPriority=g,f.callbackNode=b}}function By(f,g){if(l_=-1,jy=0,(Tr&6)!==0)throw Error(s(327));var b=f.callbackNode;if(pm()&&f.callbackNode!==b)return null;var O=Fl(f,f===js?hs:0);if(O===0)return null;if((O&30)!==0||(O&f.expiredLanes)!==0||g)g=Zl(f,O);else{g=O;var M=Tr;Tr|=2;var H=wI();(js!==f||hs!==g)&&(Jl=null,hm=Vr()+500,nh(f,g));do try{U1();break}catch(Te){PT(f,Te)}while(!0);X0(),Dy.current=H,Tr=M,$i!==null?g=0:(js=null,hs=0,g=fs)}if(g!==0){if(g===2&&(M=Ao(f),M!==0&&(O=M,g=Wy(f,M))),g===1)throw b=Js,nh(f,0),ed(f,O),_o(f,Vr()),b;if(g===6)ed(f,O);else{if(M=f.current.alternate,(O&30)===0&&!Gy(M)&&(g=Zl(f,O),g===2&&(H=Ao(f),H!==0&&(O=H,g=Wy(f,H))),g===1))throw b=Js,nh(f,0),ed(f,O),_o(f,Vr()),b;switch(f.finishedWork=M,f.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:Lf(f,zo,Jl);break;case 3:if(ed(f,O),(O&130023424)===O&&(g=Uy+500-Vr(),10<g)){if(Fl(f,0)!==0)break;if(M=f.suspendedLanes,(M&O)!==O){Qs(),f.pingedLanes|=f.suspendedLanes&M;break}f.timeoutHandle=Wg(Lf.bind(null,f,zo,Jl),g);break}Lf(f,zo,Jl);break;case 4:if(ed(f,O),(O&4194240)===O)break;for(g=f.eventTimes,M=-1;0<O;){var ae=31-Ys(O);H=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~H}if(O=M,O=Vr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*M1(O/1960))-O,10<O){f.timeoutHandle=Wg(Lf.bind(null,f,zo,Jl),O);break}Lf(f,zo,Jl);break;case 5:Lf(f,zo,Jl);break;default:throw Error(s(329))}}}return _o(f,Vr()),f.callbackNode===b?By.bind(null,f):null}function Wy(f,g){var b=c_;return f.current.memoizedState.isDehydrated&&(nh(f,g).flags|=256),f=Zl(f,g),f!==2&&(g=zo,zo=b,g!==null&&zy(g)),f}function zy(f){zo===null?zo=f:zo.push.apply(zo,f)}function Gy(f){for(var g=f;;){if(g.flags&16384){var b=g.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var O=0;O<b.length;O++){var M=b[O],H=M.getSnapshot;M=M.value;try{if(!ul(H(),M))return!1}catch{return!1}}}if(b=g.child,g.subtreeFlags&16384&&b!==null)b.return=g,g=b;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function ed(f,g){for(g&=~My,g&=~xy,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var b=31-Ys(g),O=1<<b;f[b]=-1,g&=~O}}function Df(f){if((Tr&6)!==0)throw Error(s(327));pm();var g=Fl(f,0);if((g&1)===0)return _o(f,Vr()),null;var b=Zl(f,g);if(f.tag!==0&&b===2){var O=Ao(f);O!==0&&(g=O,b=Wy(f,O))}if(b===1)throw b=Js,nh(f,0),ed(f,g),_o(f,Vr()),b;if(b===6)throw Error(s(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,Lf(f,zo,Jl),_o(f,Vr()),null}function u_(f,g){var b=Tr;Tr|=1;try{return f(g)}finally{Tr=b,Tr===0&&(hm=Vr()+500,sy&&qd())}}function td(f){Ql!==null&&Ql.tag===0&&(Tr&6)===0&&pm();var g=Tr;Tr|=1;var b=Cc.transition,O=rr;try{if(Cc.transition=null,rr=1,f)return f()}finally{rr=O,Cc.transition=b,Tr=g,(Tr&6)===0&&qd()}}function d_(){$a=dl.current,Si(dl)}function nh(f,g){f.finishedWork=null,f.finishedLanes=0;var b=f.timeoutHandle;if(b!==-1&&(f.timeoutHandle=-1,S1(b)),$i!==null)for(b=$i.return;b!==null;){var O=b;switch(Hg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&ny();break;case 3:If(),Si(da),Si(fo),nT();break;case 5:rm(O);break;case 4:If();break;case 13:Si(Ci);break;case 19:Si(Ci);break;case 10:J0(O.type._context);break;case 22:case 23:d_()}b=b.return}if(js=f,$i=f=nd(f.current,null),hs=$a=g,fs=0,Js=null,My=xy=kf=0,zo=c_=null,Rf!==null){for(g=0;g<Rf.length;g++)if(b=Rf[g],O=b.interleaved,O!==null){b.interleaved=null;var M=O.next,H=b.pending;if(H!==null){var ae=H.next;H.next=M,O.next=ae}b.pending=O}Rf=null}return f}function PT(f,g){do{var b=$i;try{if(X0(),py.current=Ey,im){for(var O=Ni.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}im=!1}if(ql=0,ds=us=Ni=null,Zg=!1,e_=0,Ly.current=null,b===null||b.return===null){fs=1,Js=g,$i=null;break}e:{var H=f,ae=b.return,Te=b,Le=g;if(g=hs,Te.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var nt=Le,At=Te,Pt=At.tag;if((At.mode&1)===0&&(Pt===0||Pt===11||Pt===15)){var Rt=At.alternate;Rt?(At.updateQueue=Rt.updateQueue,At.memoizedState=Rt.memoizedState,At.lanes=Rt.lanes):(At.updateQueue=null,At.memoizedState=null)}var $t=iI(ae);if($t!==null){$t.flags&=-257,sI($t,ae,Te,H,g),$t.mode&1&&rI(H,nt,g),g=$t,Le=nt;var tn=g.updateQueue;if(tn===null){var nn=new Set;nn.add(Le),g.updateQueue=nn}else tn.add(Le);break e}else{if((g&1)===0){rI(H,nt,g),OT();break e}Le=Error(s(426))}}else if(ii&&Te.mode&1){var Ki=iI(ae);if(Ki!==null){(Ki.flags&65536)===0&&(Ki.flags|=256),sI(Ki,ae,Te,H,g),q0(cm(Le,Te));break e}}H=Le=cm(Le,Te),fs!==4&&(fs=2),c_===null?c_=[H]:c_.push(H),H=ae;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var qe=gT(H,Le,g);BC(H,qe);break e;case 1:Te=Le;var Fe=H.type,Je=H.stateNode;if((H.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||Je!==null&&typeof Je.componentDidCatch=="function"&&(th===null||!th.has(Je)))){H.flags|=65536,g&=-g,H.lanes|=g;var Nt=Zu(H,Te,g);BC(H,Nt);break e}}H=H.return}while(H!==null)}CI(b)}catch(rn){g=rn,$i===b&&b!==null&&($i=b=b.return);continue}break}while(!0)}function wI(){var f=Dy.current;return Dy.current=Ey,f===null?Ey:f}function OT(){(fs===0||fs===3||fs===2)&&(fs=4),js===null||(kf&268435455)===0&&(xy&268435455)===0||ed(js,hs)}function Zl(f,g){var b=Tr;Tr|=2;var O=wI();(js!==f||hs!==g)&&(Jl=null,nh(f,g));do try{RI();break}catch(M){PT(f,M)}while(!0);if(X0(),Tr=b,Dy.current=O,$i!==null)throw Error(s(261));return js=null,hs=0,fs}function RI(){for(;$i!==null;)Hy($i)}function U1(){for(;$i!==null&&!Io();)Hy($i)}function Hy(f){var g=qy(f.alternate,f,$a);f.memoizedProps=f.pendingProps,g===null?CI(f):$i=g,Ly.current=null}function CI(f){var g=f;do{var b=g.alternate;if(f=g.return,(g.flags&32768)===0){if(b=Py(b,g,$a),b!==null){$i=b;return}}else{if(b=x1(b,g),b!==null){b.flags&=32767,$i=b;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{fs=6,$i=null;return}}if(g=g.sibling,g!==null){$i=g;return}$i=g=f}while(g!==null);fs===0&&(fs=5)}function Lf(f,g,b){var O=rr,M=Cc.transition;try{Cc.transition=null,rr=1,V1(f,g,b,O)}finally{Cc.transition=M,rr=O}return null}function V1(f,g,b,O){do pm();while(Ql!==null);if((Tr&6)!==0)throw Error(s(327));b=f.finishedWork;var M=f.finishedLanes;if(b===null)return null;if(f.finishedWork=null,f.finishedLanes=0,b===f.current)throw Error(s(177));f.callbackNode=null,f.callbackPriority=0;var H=b.lanes|b.childLanes;if(Wr(f,H),f===js&&($i=js=null,hs=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||fm||(fm=!0,h_(aa,function(){return pm(),null})),H=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||H){H=Cc.transition,Cc.transition=null;var ae=rr;rr=1;var Te=Tr;Tr|=4,Ly.current=null,ST(f,b),RT(b,f),U0(Bg),ye=!!ty,Bg=ty=null,f.current=b,dm(b),Vd(),Tr=Te,rr=ae,Cc.transition=H}else f.current=b;if(fm&&(fm=!1,Ql=f,Fy=M),H=f.pendingLanes,H===0&&(th=null),Lp(b.stateNode),_o(f,Vr()),g!==null)for(O=f.onRecoverableError,b=0;b<g.length;b++)M=g[b],O(M.value,{componentStack:M.stack,digest:M.digest});if(Vy)throw Vy=!1,f=IT,IT=null,f;return(Fy&1)!==0&&f.tag!==0&&pm(),H=f.pendingLanes,(H&1)!==0?f===AT?Nf++:(Nf=0,AT=f):Nf=0,qd(),null}function pm(){if(Ql!==null){var f=pc(Fy),g=Cc.transition,b=rr;try{if(Cc.transition=null,rr=16>f?16:f,Ql===null)var O=!1;else{if(f=Ql,Ql=null,Fy=0,(Tr&6)!==0)throw Error(s(331));var M=Tr;for(Tr|=4,Zt=f.current;Zt!==null;){var H=Zt,ae=H.child;if((Zt.flags&16)!==0){var Te=H.deletions;if(Te!==null){for(var Le=0;Le<Te.length;Le++){var nt=Te[Le];for(Zt=nt;Zt!==null;){var At=Zt;switch(At.tag){case 0:case 11:case 15:s_(8,At,H)}var Pt=At.child;if(Pt!==null)Pt.return=At,Zt=Pt;else for(;Zt!==null;){At=Zt;var Rt=At.sibling,$t=At.return;if(yI(At),At===nt){Zt=null;break}if(Rt!==null){Rt.return=$t,Zt=Rt;break}Zt=$t}}}var tn=H.alternate;if(tn!==null){var nn=tn.child;if(nn!==null){tn.child=null;do{var Ki=nn.sibling;nn.sibling=null,nn=Ki}while(nn!==null)}}Zt=H}}if((H.subtreeFlags&2064)!==0&&ae!==null)ae.return=H,Zt=ae;else e:for(;Zt!==null;){if(H=Zt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:s_(9,H,H.return)}var qe=H.sibling;if(qe!==null){qe.return=H.return,Zt=qe;break e}Zt=H.return}}var Fe=f.current;for(Zt=Fe;Zt!==null;){ae=Zt;var Je=ae.child;if((ae.subtreeFlags&2064)!==0&&Je!==null)Je.return=ae,Zt=Je;else e:for(ae=Fe;Zt!==null;){if(Te=Zt,(Te.flags&2048)!==0)try{switch(Te.tag){case 0:case 11:case 15:o_(9,Te)}}catch(rn){Di(Te,Te.return,rn)}if(Te===ae){Zt=null;break e}var Nt=Te.sibling;if(Nt!==null){Nt.return=Te.return,Zt=Nt;break e}Zt=Te.return}}if(Tr=M,qd(),ho&&typeof ho.onPostCommitFiberRoot=="function")try{ho.onPostCommitFiberRoot(Ul,f)}catch{}O=!0}return O}finally{rr=b,Cc.transition=g}}return!1}function $y(f,g,b){g=cm(b,g),g=gT(f,g,1),f=Jd(f,g,1),g=Qs(),f!==null&&(jl(f,1,g),_o(f,g))}function Di(f,g,b){if(f.tag===3)$y(f,f,b);else for(;g!==null;){if(g.tag===3){$y(g,f,b);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(th===null||!th.has(O))){f=cm(b,f),f=Zu(g,f,1),g=Jd(g,f,1),f=Qs(),g!==null&&(jl(g,1,f),_o(g,f));break}}g=g.return}}function II(f,g,b){var O=f.pingCache;O!==null&&O.delete(g),g=Qs(),f.pingedLanes|=f.suspendedLanes&b,js===f&&(hs&b)===b&&(fs===4||fs===3&&(hs&130023424)===hs&&500>Vr()-Uy?nh(f,0):My|=b),_o(f,g)}function kT(f,g){g===0&&((f.mode&1)===0?g=1:(g=ur,ur<<=1,(ur&130023424)===0&&(ur=4194304)));var b=Qs();f=Xu(f,g),f!==null&&(jl(f,g,b),_o(f,b))}function Ky(f){var g=f.memoizedState,b=0;g!==null&&(b=g.retryLane),kT(f,b)}function AI(f,g){var b=0;switch(f.tag){case 13:var O=f.stateNode,M=f.memoizedState;M!==null&&(b=M.retryLane);break;case 19:O=f.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),kT(f,b)}var qy;qy=function(f,g,b){if(f!==null)if(f.memoizedProps!==g.pendingProps||da.current)ga=!0;else{if((f.lanes&b)===0&&(g.flags&128)===0)return ga=!1,pI(f,g,b);ga=(f.flags&131072)!==0}else ga=!1,ii&&(g.flags&1048576)!==0&&ay(g,oy,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;Iy(f,g),f=g.pendingProps;var M=bf(g,fo.current);Yu(g,b),M=sm(null,g,O,f,M,b);var H=sT();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ha(O)?(H=!0,iy(g)):H=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,Yg(g),M.updater=vy,g.stateNode=M,M._reactInternals=g,fT(g,O,f,b),g=Ty(null,g,O,!0,H,b)):(g.tag=0,ii&&H&&cy(g),Bo(null,g,M,b),g=g.child),g;case 16:O=g.elementType;e:{switch(Iy(f,g),f=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=xf(O),f=Ha(O,f),M){case 0:g=_T(null,g,O,f,b);break e;case 1:g=uI(null,g,O,f,b);break e;case 11:g=Sy(null,g,O,f,b);break e;case 14:g=oI(null,g,O,Ha(O.type,f),b);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ha(O,M),_T(f,g,O,M,b);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ha(O,M),uI(f,g,O,M,b);case 3:e:{if(ET(g),f===null)throw Error(s(387));O=g.pendingProps,H=g.memoizedState,M=H.element,jC(f,g),fy(g,O,null,b);var ae=g.memoizedState;if(O=ae.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){M=cm(Error(s(423)),g),g=dI(f,g,O,b,M);break e}else if(O!==M){M=cm(Error(s(424)),g),g=dI(f,g,O,b,M);break e}else for(pa=Hd(g.stateNode.containerInfo.firstChild),fa=g,ii=!0,Fo=null,b=VC(g,null,O,b),g.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Zp(),O===M){g=Yl(f,g,b);break e}Bo(f,g,O,b)}g=g.child}return g;case 5:return zC(g),f===null&&K0(g),O=g.type,M=g.pendingProps,H=f!==null?f.memoizedProps:null,ae=M.children,z0(O,M)?ae=null:H!==null&&z0(O,H)&&(g.flags|=32),lI(f,g),Bo(f,g,ae,b),g.child;case 6:return f===null&&K0(g),null;case 13:return by(f,g,b);case 4:return eT(g,g.stateNode.containerInfo),O=g.pendingProps,f===null?g.child=em(g,null,O,b):Bo(f,g,O,b),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ha(O,M),Sy(f,g,O,M,b);case 7:return Bo(f,g,g.pendingProps,b),g.child;case 8:return Bo(f,g,g.pendingProps.children,b),g.child;case 12:return Bo(f,g,g.pendingProps.children,b),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,H=g.memoizedProps,ae=M.value,mi(dy,O._currentValue),O._currentValue=ae,H!==null)if(ul(H.value,ae)){if(H.children===M.children&&!da.current){g=Yl(f,g,b);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Te=H.dependencies;if(Te!==null){ae=H.child;for(var Le=Te.firstContext;Le!==null;){if(Le.context===O){if(H.tag===1){Le=$l(-1,b&-b),Le.tag=2;var nt=H.updateQueue;if(nt!==null){nt=nt.shared;var At=nt.pending;At===null?Le.next=Le:(Le.next=At.next,At.next=Le),nt.pending=Le}}H.lanes|=b,Le=H.alternate,Le!==null&&(Le.lanes|=b),Q0(H.return,b,g),Te.lanes|=b;break}Le=Le.next}}else if(H.tag===10)ae=H.type===g.type?null:H.child;else if(H.tag===18){if(ae=H.return,ae===null)throw Error(s(341));ae.lanes|=b,Te=ae.alternate,Te!==null&&(Te.lanes|=b),Q0(ae,b,g),ae=H.sibling}else ae=H.child;if(ae!==null)ae.return=H;else for(ae=H;ae!==null;){if(ae===g){ae=null;break}if(H=ae.sibling,H!==null){H.return=ae.return,ae=H;break}ae=ae.return}H=ae}Bo(f,g,M.children,b),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Yu(g,b),M=bc(M),O=O(M),g.flags|=1,Bo(f,g,O,b),g.child;case 14:return O=g.type,M=Ha(O,g.pendingProps),M=Ha(O.type,M),oI(f,g,O,M,b);case 15:return aI(f,g,g.type,g.pendingProps,b);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Ha(O,M),Iy(f,g),g.tag=1,ha(O)?(f=!0,iy(g)):f=!1,Yu(g,b),tI(g,O,M),fT(g,O,M,b),Ty(null,g,O,!0,f,b);case 19:return Cy(f,g,b);case 22:return cI(f,g,b)}throw Error(s(156,g.tag))};function h_(f,g){return Ud(f,g)}function Yy(f,g,b,O){this.tag=f,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ka(f,g,b,O){return new Yy(f,g,b,O)}function rh(f){return f=f.prototype,!(!f||!f.isReactComponent)}function xf(f){if(typeof f=="function")return rh(f)?1:0;if(f!=null){if(f=f.$$typeof,f===he)return 11;if(f===Ve)return 14}return 2}function nd(f,g){var b=f.alternate;return b===null?(b=Ka(f.tag,g,f.key,f.mode),b.elementType=f.elementType,b.type=f.type,b.stateNode=f.stateNode,b.alternate=f,f.alternate=b):(b.pendingProps=g,b.type=f.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=f.flags&14680064,b.childLanes=f.childLanes,b.lanes=f.lanes,b.child=f.child,b.memoizedProps=f.memoizedProps,b.memoizedState=f.memoizedState,b.updateQueue=f.updateQueue,g=f.dependencies,b.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},b.sibling=f.sibling,b.index=f.index,b.ref=f.ref,b}function Xy(f,g,b,O,M,H){var ae=2;if(O=f,typeof f=="function")rh(f)&&(ae=1);else if(typeof f=="string")ae=5;else e:switch(f){case Z:return Mf(b.children,M,H,g);case ee:ae=8,M|=8;break;case te:return f=Ka(12,b,g,M|2),f.elementType=te,f.lanes=H,f;case se:return f=Ka(13,b,g,M),f.elementType=se,f.lanes=H,f;case Se:return f=Ka(19,b,g,M),f.elementType=Se,f.lanes=H,f;case ke:return ih(b,M,H,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ce:ae=10;break e;case me:ae=9;break e;case he:ae=11;break e;case Ve:ae=14;break e;case tt:ae=16,O=null;break e}throw Error(s(130,f==null?f:typeof f,""))}return g=Ka(ae,b,g,M),g.elementType=f,g.type=O,g.lanes=H,g}function Mf(f,g,b,O){return f=Ka(7,f,O,g),f.lanes=b,f}function ih(f,g,b,O){return f=Ka(22,f,O,g),f.elementType=ke,f.lanes=b,f.stateNode={isHidden:!1},f}function NT(f,g,b){return f=Ka(6,f,null,g),f.lanes=b,f}function DT(f,g,b){return g=Ka(4,f.children!==null?f.children:[],f.key,g),g.lanes=b,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function F1(f,g,b,O,M){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ol(0),this.expirationTimes=ol(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ol(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function LT(f,g,b,O,M,H,ae,Te,Le){return f=new F1(f,g,b,Te,Le),g===1?(g=1,H===!0&&(g|=8)):g=0,H=Ka(3,null,null,g),f.current=H,H.stateNode=f,H.memoizedState={element:O,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Yg(H),f}function j1(f,g,b){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_e,key:O==null?null:""+O,children:f,containerInfo:g,implementation:b}}function PI(f){if(!f)return Kd;f=f._reactInternals;e:{if(Vs(f)!==f||f.tag!==1)throw Error(s(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ha(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(f.tag===1){var b=f.type;if(ha(b))return ry(f,b,g)}return g}function Jy(f,g,b,O,M,H,ae,Te,Le){return f=LT(b,O,!0,f,M,H,ae,Te,Le),f.context=PI(null),b=f.current,O=Qs(),M=Ic(b),H=$l(O,M),H.callback=g??null,Jd(b,H,M),f.current.lanes=M,jl(f,M,O),_o(f,O),f}function f_(f,g,b,O){var M=g.current,H=Qs(),ae=Ic(M);return b=PI(b),g.context===null?g.context=b:g.pendingContext=b,g=$l(H,ae),g.payload={element:f},O=O===void 0?null:O,O!==null&&(g.callback=O),f=Jd(M,g,ae),f!==null&&(Ac(f,M,ae,H),Xg(f,M,ae)),ae}function Qy(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function xT(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var b=f.retryLane;f.retryLane=b!==0&&b<g?b:g}}function MT(f,g){xT(f,g),(f=f.alternate)&&xT(f,g)}function p_(){return null}var hl=typeof reportError=="function"?reportError:function(f){console.error(f)};function Zy(f){this._internalRoot=f}ev.prototype.render=Zy.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(s(409));f_(f,g,null,null)},ev.prototype.unmount=Zy.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;td(function(){f_(null,f,null,null)}),g[yc]=null}};function ev(f){this._internalRoot=f}ev.prototype.unstable_scheduleHydration=function(f){if(f){var g=uf();f={blockedOn:null,target:f,priority:g};for(var b=0;b<Do.length&&g!==0&&g<Do[b].priority;b++);Do.splice(b,0,f),b===0&&hf(f)}};function UT(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function mm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function VT(){}function B1(f,g,b,O,M){if(M){if(typeof O=="function"){var H=O;O=function(){var nt=Qy(ae);H.call(nt)}}var ae=Jy(g,O,f,0,null,!1,!1,"",VT);return f._reactRootContainer=ae,f[yc]=ae.current,Ef(f.nodeType===8?f.parentNode:f),td(),ae}for(;M=f.lastChild;)f.removeChild(M);if(typeof O=="function"){var Te=O;O=function(){var nt=Qy(Le);Te.call(nt)}}var Le=LT(f,0,!1,null,null,!1,!1,"",VT);return f._reactRootContainer=Le,f[yc]=Le.current,Ef(f.nodeType===8?f.parentNode:f),td(function(){f_(g,Le,b,O)}),Le}function Uf(f,g,b,O,M){var H=b._reactRootContainer;if(H){var ae=H;if(typeof M=="function"){var Te=M;M=function(){var Le=Qy(ae);Te.call(Le)}}f_(g,ae,f,M)}else ae=B1(b,g,f,M,O);return Qy(ae)}xp=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var b=Vl(g.pendingLanes);b!==0&&(ja(g,b|1),_o(g,Vr()),(Tr&6)===0&&(hm=Vr()+500,qd()))}break;case 13:td(function(){var O=Xu(f,1);if(O!==null){var M=Qs();Ac(O,f,1,M)}}),MT(f,1)}},Bl=function(f){if(f.tag===13){var g=Xu(f,134217728);if(g!==null){var b=Qs();Ac(g,f,134217728,b)}MT(f,134217728)}},Wd=function(f){if(f.tag===13){var g=Ic(f),b=Xu(f,g);if(b!==null){var O=Qs();Ac(b,f,g,O)}MT(f,g)}},uf=function(){return rr},Mp=function(f,g){var b=rr;try{return rr=f,g()}finally{rr=b}},Ml=function(f,g,b){switch(g){case"input":if(Dt(f,b),g=b.name,b.type==="radio"&&g!=null){for(b=f;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<b.length;g++){var O=b[g];if(O!==f&&O.form===f.form){var M=Xp(O);if(!M)throw Error(s(90));Vt(O),Dt(O,M)}}}break;case"textarea":zt(f,b);break;case"select":g=b.value,g!=null&&_t(f,!!b.multiple,g,!1)}},Nu=u_,dc=td;var sh={usingClientEntryPoint:!1,Events:[Yp,Sf,Xp,uc,nl,u_]},rd={findFiberByHostInstance:vf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},W1={bundleType:rd.bundleType,version:rd.version,rendererPackageName:rd.rendererPackageName,rendererConfig:rd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Md(f),f===null?null:f.stateNode},findFiberByHostInstance:rd.findFiberByHostInstance||p_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var tv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!tv.isDisabled&&tv.supportsFiber)try{Ul=tv.inject(W1),ho=tv}catch{}}return Wc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sh,Wc.createPortal=function(f,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!UT(g))throw Error(s(200));return j1(f,g,null,b)},Wc.createRoot=function(f,g){if(!UT(f))throw Error(s(299));var b=!1,O="",M=hl;return g!=null&&(g.unstable_strictMode===!0&&(b=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=LT(f,1,!1,null,null,b,!1,O,M),f[yc]=g.current,Ef(f.nodeType===8?f.parentNode:f),new Zy(g)},Wc.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(s(188)):(f=Object.keys(f).join(","),Error(s(268,f)));return f=Md(g),f=f===null?null:f.stateNode,f},Wc.flushSync=function(f){return td(f)},Wc.hydrate=function(f,g,b){if(!mm(g))throw Error(s(200));return Uf(null,f,g,!0,b)},Wc.hydrateRoot=function(f,g,b){if(!UT(f))throw Error(s(405));var O=b!=null&&b.hydratedSources||null,M=!1,H="",ae=hl;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(H=b.identifierPrefix),b.onRecoverableError!==void 0&&(ae=b.onRecoverableError)),g=Jy(g,null,f,1,b??null,M,!1,H,ae),f[yc]=g.current,Ef(f),O)for(f=0;f<O.length;f++)b=O[f],M=b._getVersion,M=M(b._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[b,M]:g.mutableSourceEagerHydrationData.push(b,M);return new ev(g)},Wc.render=function(f,g,b){if(!mm(g))throw Error(s(200));return Uf(null,f,g,!1,b)},Wc.unmountComponentAtNode=function(f){if(!mm(f))throw Error(s(40));return f._reactRootContainer?(td(function(){Uf(null,null,f,!1,function(){f._reactRootContainer=null,f[yc]=null})}),!0):!1},Wc.unstable_batchedUpdates=u_,Wc.unstable_renderSubtreeIntoContainer=function(f,g,b,O){if(!mm(b))throw Error(s(200));if(f==null||f._reactInternals===void 0)throw Error(s(38));return Uf(f,g,b,!1,O)},Wc.version="18.3.1-next-f1338f8080-20240426",Wc}var N$;function nQ(){if(N$)return xM.exports;N$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),xM.exports=O_e(),xM.exports}var D$;function k_e(){if(D$)return qP;D$=1;var n=nQ();return qP.createRoot=n.createRoot,qP.hydrateRoot=n.hydrateRoot,qP}var N_e=k_e();const Jk=y0(N_e);function D_e(n,t,s,a){return n.addEventListener(t,s,a),()=>{n.removeEventListener(t,s,a)}}function Qk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function L_e(){return!!(globalThis!=null&&globalThis.document)}function rQ(n){return n.parentElement&&rQ(n.parentElement)?!0:n.hidden}function x_e(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function M_e(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function U_e(n){var t;return((t=iQ(n))==null?void 0:t.defaultView)??window}function iQ(n){return Qk(n)?n.ownerDocument:document}function V_e(n){return n.view??window}function F_e(n){return iQ(n).activeElement}function j_e(n){const t=V_e(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function sQ(n){return!!n.touches}function B_e(n){return sQ(n)&&n.touches.length>1}function W_e(n,t="page"){const s=n.touches[0]||n.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function z_e(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function oQ(n,t="page"){return sQ(n)?W_e(n,t):z_e(n,t)}function G_e(n){return t=>{const s=j_e(t);(!s||s&&t.button===0)&&n(t)}}function H_e(n,t=!1){function s(l){n(l,{point:oQ(l)})}return t?G_e(s):s}function AO(n,t,s,a){return D_e(n,t,H_e(s,t==="pointerdown"),a)}function $_e(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const s={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Yn=n=>n?"":void 0,kS=n=>n?!0:void 0;function K_e(n){return Array.isArray(n)}function bu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!K_e(n)}function q_e(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function Y_e(n){const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function sU(n){if(n==null)return n;const{unitless:t}=Y_e(n);return t||typeof n=="number"?`${n}px`:n}const aQ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,jV=n=>Object.fromEntries(Object.entries(n).sort(aQ));function L$(n){const t=jV(n);return Object.assign(Object.values(t),t)}function X_e(n){const t=Object.keys(jV(n));return new Set(t)}function x$(n){if(!n)return n;n=sU(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function Ew(n,t){const s=["@media screen"];return n&&s.push("and",`(min-width: ${sU(n)})`),t&&s.push("and",`(max-width: ${sU(t)})`),s.join(" ")}function J_e(n){if(!n)return null;n.base=n.base??"0px";const t=L$(n),s=Object.entries(n).sort(aQ).map(([d,p],E,v)=>{let[,T]=v[E+1]??[];return T=parseFloat(T)>0?x$(T):void 0,{_minW:x$(p),breakpoint:d,minW:p,maxW:T,maxWQuery:Ew(null,T),minWQuery:Ew(p),minMaxQuery:Ew(p,T)}}),a=X_e(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(E=>a.has(E))},asObject:jV(n),asArray:L$(n),details:s,get(d){return s.find(p=>p.breakpoint===d)},media:[null,...t.map(d=>Ew(d)).slice(1)],toArrayValue(d){if(!bu(d))throw new Error("toArrayValue: value must be an object");const p=l.map(E=>d[E]??null);for(;q_e(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,E,v)=>{const T=l[v];return T!=null&&E!=null&&(p[T]=E),p},{})}}}function cQ(...n){return function(...s){n.forEach(a=>a==null?void 0:a(...s))}}function Zn(...n){return function(s){n.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function BV(n){return L.Children.toArray(n).filter(t=>L.isValidElement(t))}function Zk(n){const t=Object.assign({},n);for(let s in t)t[s]===void 0&&delete t[s];return t}function Q_e(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Gi(n={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,E=L.createContext(p);E.displayName=t;function v(){var w;const T=L.useContext(E);if(!T&&s){const A=new Error(d??Q_e(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return T}return[E.Provider,v,E]}const hn=(...n)=>n.filter(Boolean).join(" "),lQ=n=>n.hasAttribute("tabindex"),Z_e=n=>lQ(n)&&n.tabIndex===-1;function lk(n){if(!Qk(n)||rQ(n)||M_e(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():x_e(n)?!0:lQ(n)}function eEe(n){return n?Qk(n)&&lk(n)&&!Z_e(n):!1}const tEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],nEe=tEe.join(),rEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function uQ(n){const t=Array.from(n.querySelectorAll(nEe));return t.unshift(n),t.filter(s=>lk(s)&&rEe(s))}function iEe(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const sEe=n=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,p);return E.set(l,v),v}},dQ=sEe(iEe),oEe=n=>n.default||n;function WV(n){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=n;return!!(!s||a||l==="keepMounted"&&t)}function aEe(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function cEe(n,t){let s=aEe(n);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function lEe(n){if(!Number.isFinite(n))return 0;let t=1,s=0;for(;Math.round(n*t)/t!==n;)t*=10,s+=1;return s}function M$(n,t,s){return(n-t)*100/(s-t)}function uEe(n,t,s){return(s-t)*n+t}function U$(n,t,s){const a=Math.round((n-t)/s)*s+t,l=lEe(s);return cEe(a,l)}function VM(n,t,s){return n==null?n:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),s))}function LR(n,t=[]){const s=Object.assign({},n);for(const a of t)a in s&&delete s[a];return s}function hQ(n,t){const s={};for(const a of t)a in n&&(s[a]=n[a]);return s}function eN(n,t){return Array.isArray(n)?n.map(s=>s===null?null:t(s)):bu(n)?Object.keys(n).reduce((s,a)=>(s[a]=t(n[a]),s),{}):n!=null?t(n):null}const dEe=n=>typeof n=="function";function qc(n,...t){return dEe(n)?n(...t):n}function hEe(n){const t=n.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(s+l+a)}function fEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function fQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Qk(n)&&hEe(n)?n:fQ(fEe(n))}function pEe(n,t){const s={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function mEe(n,...t){const s=Object.getOwnPropertyDescriptors(n),a=Object.keys(s),l=p=>{const E={};for(let v=0;v<p.length;v++){const T=p[v];s[T]&&(Object.defineProperty(E,T,s[T]),delete s[T])}return E},d=p=>l(Array.isArray(p)?p:a.filter(p));return t.map(d).concat(l(a))}function V$(n,t,s={}){const{stop:a,getKey:l}=s;function d(p,E=[]){if(bu(p)||Array.isArray(p)){const v={};for(const[T,w]of Object.entries(p)){const A=(l==null?void 0:l(T))??T,N=[...E,A];if(a!=null&&a(p,N))return t(p,E);v[A]=d(w,N)}return v}return t(p,E)}return d(n)}var yw={exports:{}};yw.exports;var F$;function gEe(){return F$||(F$=1,function(n,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,E="[object Arguments]",v="[object Array]",T="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",F="[object Function]",j="[object GeneratorFunction]",B="[object Map]",G="[object Number]",J="[object Null]",K="[object Object]",ne="[object Proxy]",de="[object RegExp]",oe="[object Set]",_e="[object String]",Z="[object Undefined]",ee="[object WeakMap]",te="[object ArrayBuffer]",ce="[object DataView]",me="[object Float32Array]",he="[object Float64Array]",se="[object Int8Array]",Se="[object Int16Array]",Ve="[object Int32Array]",tt="[object Uint8Array]",ke="[object Uint8ClampedArray]",Me="[object Uint16Array]",Ce="[object Uint32Array]",Xe=/[\\^$.*+?()[\]{}|]/g,Ae=/^\[object .+?Constructor\]$/,Ie=/^(?:0|[1-9]\d*)$/,be={};be[me]=be[he]=be[se]=be[Se]=be[Ve]=be[tt]=be[ke]=be[Me]=be[Ce]=!0,be[E]=be[v]=be[te]=be[w]=be[ce]=be[A]=be[N]=be[F]=be[B]=be[G]=be[K]=be[de]=be[oe]=be[_e]=be[ee]=!1;var xe=typeof oE=="object"&&oE&&oE.Object===Object&&oE,We=typeof self=="object"&&self&&self.Object===Object&&self,Qe=xe||We||Function("return this")(),Ze=t&&!t.nodeType&&t,ut=Ze&&!0&&n&&!n.nodeType&&n,it=ut&&ut.exports===Ze,It=it&&xe.process,yn=function(){try{var ye=ut&&ut.require&&ut.require("util").types;return ye||It&&It.binding&&It.binding("util")}catch{}}(),Vt=yn&&yn.isTypedArray;function ln(ye,Oe,et){switch(et.length){case 0:return ye.call(Oe);case 1:return ye.call(Oe,et[0]);case 2:return ye.call(Oe,et[0],et[1]);case 3:return ye.call(Oe,et[0],et[1],et[2])}return ye.apply(Oe,et)}function xn(ye,Oe){for(var et=-1,qt=Array(ye);++et<ye;)qt[et]=Oe(et);return qt}function Qt(ye){return function(Oe){return ye(Oe)}}function Ot(ye,Oe){return ye==null?void 0:ye[Oe]}function Dt(ye,Oe){return function(et){return ye(Oe(et))}}var ve=Array.prototype,Ue=Function.prototype,He=Object.prototype,_t=Qe["__core-js_shared__"],vt=Ue.toString,St=He.hasOwnProperty,zt=function(){var ye=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return ye?"Symbol(src)_1."+ye:""}(),dn=He.toString,fn=vt.call(Object),Xt=RegExp("^"+vt.call(St).replace(Xe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bn=it?Qe.Buffer:void 0,cc=Qe.Symbol,jt=Qe.Uint8Array;Bn&&Bn.allocUnsafe;var an=Dt(Object.getPrototypeOf,Object),Zi=Object.create,Ms=He.propertyIsEnumerable,qs=ve.splice,hi=cc?cc.toStringTag:void 0,Ma=function(){try{var ye=Fa(Object,"defineProperty");return ye({},"",{}),ye}catch{}}(),tl=Bn?Bn.isBuffer:void 0,lo=Math.max,uo=Date.now,Ml=Fa(Qe,"Map"),Us=Fa(Object,"create"),lc=function(){function ye(){}return function(Oe){if(!mc(Oe))return{};if(Zi)return Zi(Oe);ye.prototype=Oe;var et=new ye;return ye.prototype=void 0,et}}();function ra(ye){var Oe=-1,et=ye==null?0:ye.length;for(this.clear();++Oe<et;){var qt=ye[Oe];this.set(qt[0],qt[1])}}function uc(){this.__data__=Us?Us(null):{},this.size=0}function nl(ye){var Oe=this.has(ye)&&delete this.__data__[ye];return this.size-=Oe?1:0,Oe}function Nu(ye){var Oe=this.__data__;if(Us){var et=Oe[ye];return et===a?void 0:et}return St.call(Oe,ye)?Oe[ye]:void 0}function dc(ye){var Oe=this.__data__;return Us?Oe[ye]!==void 0:St.call(Oe,ye)}function rl(ye,Oe){var et=this.__data__;return this.size+=this.has(ye)?0:1,et[ye]=Us&&Oe===void 0?a:Oe,this}ra.prototype.clear=uc,ra.prototype.delete=nl,ra.prototype.get=Nu,ra.prototype.has=dc,ra.prototype.set=rl;function Co(ye){var Oe=-1,et=ye==null?0:ye.length;for(this.clear();++Oe<et;){var qt=ye[Oe];this.set(qt[0],qt[1])}}function ki(){this.__data__=[],this.size=0}function as(ye){var Oe=this.__data__,et=Vd(Oe,ye);if(et<0)return!1;var qt=Oe.length-1;return et==qt?Oe.pop():qs.call(Oe,et,1),--this.size,!0}function Ua(ye){var Oe=this.__data__,et=Vd(Oe,ye);return et<0?void 0:Oe[et][1]}function Du(ye){return Vd(this.__data__,ye)>-1}function hc(ye,Oe){var et=this.__data__,qt=Vd(et,ye);return qt<0?(++this.size,et.push([ye,Oe])):et[qt][1]=Oe,this}Co.prototype.clear=ki,Co.prototype.delete=as,Co.prototype.get=Ua,Co.prototype.has=Du,Co.prototype.set=hc;function ia(ye){var Oe=-1,et=ye==null?0:ye.length;for(this.clear();++Oe<et;){var qt=ye[Oe];this.set(qt[0],qt[1])}}function sa(){this.size=0,this.__data__={hash:new ra,map:new(Ml||Co),string:new ra}}function Ld(ye){var Oe=Uu(this,ye).delete(ye);return this.size-=Oe?1:0,Oe}function Og(ye){return Uu(this,ye).get(ye)}function Lu(ye){return Uu(this,ye).has(ye)}function af(ye,Oe){var et=Uu(this,ye),qt=et.size;return et.set(ye,Oe),this.size+=et.size==qt?0:1,this}ia.prototype.clear=sa,ia.prototype.delete=Ld,ia.prototype.get=Og,ia.prototype.has=Lu,ia.prototype.set=af;function Vs(ye){var Oe=this.__data__=new Co(ye);this.size=Oe.size}function xu(){this.__data__=new Co,this.size=0}function oa(ye){var Oe=this.__data__,et=Oe.delete(ye);return this.size=Oe.size,et}function xd(ye){return this.__data__.get(ye)}function Md(ye){return this.__data__.has(ye)}function Va(ye,Oe){var et=this.__data__;if(et instanceof Co){var qt=et.__data__;if(!Ml||qt.length<s-1)return qt.push([ye,Oe]),this.size=++et.size,this;et=this.__data__=new ia(qt)}return et.set(ye,Oe),this.size=et.size,this}Vs.prototype.clear=xu,Vs.prototype.delete=oa,Vs.prototype.get=xd,Vs.prototype.has=Md,Vs.prototype.set=Va;function Ud(ye,Oe){var et=Oo(ye),qt=!et&&es(ye),Kn=!et&&!qt&&No(ye),mr=!et&&!qt&&!Kn&&hf(ye),Fr=et||qt||Kn||mr,cn=Fr?xn(ye.length,String):[],kr=cn.length;for(var pi in ye)Fr&&(pi=="length"||Kn&&(pi=="offset"||pi=="parent")||mr&&(pi=="buffer"||pi=="byteLength"||pi=="byteOffset")||ol(pi,kr))||cn.push(pi);return cn}function Mu(ye,Oe,et){(et!==void 0&&!Po(ye[Oe],et)||et===void 0&&!(Oe in ye))&&Vr(ye,Oe,et)}function Io(ye,Oe,et){var qt=ye[Oe];(!(St.call(ye,Oe)&&Po(qt,et))||et===void 0&&!(Oe in ye))&&Vr(ye,Oe,et)}function Vd(ye,Oe){for(var et=ye.length;et--;)if(Po(ye[et][0],Oe))return et;return-1}function Vr(ye,Oe,et){Oe=="__proto__"&&Ma?Ma(ye,Oe,{configurable:!0,enumerable:!0,value:et,writable:!0}):ye[Oe]=et}var fi=Fl();function fc(ye){return ye==null?ye===void 0?Z:J:hi&&hi in Object(ye)?Ao(ye):xp(ye)}function il(ye){return cs(ye)&&fc(ye)==E}function aa(ye){if(!mc(ye)||ja(ye))return!1;var Oe=Do(ye)?Xt:Ae;return Oe.test(df(ye))}function cf(ye){return cs(ye)&&Up(ye.length)&&!!be[fc(ye)]}function Fd(ye){if(!mc(ye))return pc(ye);var Oe=rr(ye),et=[];for(var qt in ye)qt=="constructor"&&(Oe||!St.call(ye,qt))||et.push(qt);return et}function Ul(ye,Oe,et,qt,Kn){ye!==Oe&&fi(Oe,function(mr,Fr){if(Kn||(Kn=new Vs),mc(mr))ho(ye,Oe,Fr,et,Ul,qt,Kn);else{var cn=qt?qt(Wd(ye,Fr),mr,Fr+"",ye,Oe,Kn):void 0;cn===void 0&&(cn=mr),Mu(ye,Fr,cn)}},zl)}function ho(ye,Oe,et,qt,Kn,mr,Fr){var cn=Wd(ye,et),kr=Wd(Oe,et),pi=Fr.get(kr);if(pi){Mu(ye,et,pi);return}var Rs=mr?mr(cn,kr,et+"",ye,Oe,Fr):void 0,Lo=Rs===void 0;if(Lo){var xo=Oo(kr),ju=!xo&&No(kr),Hi=!xo&&!ju&&hf(kr);Rs=kr,xo||ju||Hi?Oo(cn)?Rs=cn:Wl(cn)?Rs=Bd(cn):ju?(Lo=!1,Rs=lf(kr)):Hi?(Lo=!1,Rs=jd(kr)):Rs=[]:Fu(kr)||es(kr)?(Rs=cn,es(cn)?Rs=al(cn):(!mc(cn)||Do(cn))&&(Rs=Vu(kr))):Lo=!1}Lo&&(Fr.set(kr,Rs),Kn(Rs,kr,qt,mr,Fr),Fr.delete(kr)),Mu(ye,et,Rs)}function Lp(ye,Oe){return uf(Bl(ye,Oe,la),ye+"")}var Ys=Ma?function(ye,Oe){return Ma(ye,"toString",{configurable:!0,enumerable:!1,value:ca(Oe),writable:!0})}:la;function lf(ye,Oe){return ye.slice()}function sl(ye){var Oe=new ye.constructor(ye.byteLength);return new jt(Oe).set(new jt(ye)),Oe}function jd(ye,Oe){var et=sl(ye.buffer);return new ye.constructor(et,ye.byteOffset,ye.length)}function Bd(ye,Oe){var et=-1,qt=ye.length;for(Oe||(Oe=Array(qt));++et<qt;)Oe[et]=ye[et];return Oe}function ur(ye,Oe,et,qt){var Kn=!et;et||(et={});for(var mr=-1,Fr=Oe.length;++mr<Fr;){var cn=Oe[mr],kr=void 0;kr===void 0&&(kr=ye[cn]),Kn?Vr(et,cn,kr):Io(et,cn,kr)}return et}function Vl(ye){return Lp(function(Oe,et){var qt=-1,Kn=et.length,mr=Kn>1?et[Kn-1]:void 0,Fr=Kn>2?et[2]:void 0;for(mr=ye.length>3&&typeof mr=="function"?(Kn--,mr):void 0,Fr&&jl(et[0],et[1],Fr)&&(mr=Kn<3?void 0:mr,Kn=1),Oe=Object(Oe);++qt<Kn;){var cn=et[qt];cn&&ye(Oe,cn,qt,mr)}return Oe})}function Fl(ye){return function(Oe,et,qt){for(var Kn=-1,mr=Object(Oe),Fr=qt(Oe),cn=Fr.length;cn--;){var kr=Fr[++Kn];if(et(mr[kr],kr,mr)===!1)break}return Oe}}function Uu(ye,Oe){var et=ye.__data__;return Wr(Oe)?et[typeof Oe=="string"?"string":"hash"]:et.map}function Fa(ye,Oe){var et=Ot(ye,Oe);return aa(et)?et:void 0}function Ao(ye){var Oe=St.call(ye,hi),et=ye[hi];try{ye[hi]=void 0;var qt=!0}catch{}var Kn=dn.call(ye);return qt&&(Oe?ye[hi]=et:delete ye[hi]),Kn}function Vu(ye){return typeof ye.constructor=="function"&&!rr(ye)?lc(an(ye)):{}}function ol(ye,Oe){var et=typeof ye;return Oe=Oe??p,!!Oe&&(et=="number"||et!="symbol"&&Ie.test(ye))&&ye>-1&&ye%1==0&&ye<Oe}function jl(ye,Oe,et){if(!mc(et))return!1;var qt=typeof Oe;return(qt=="number"?ko(et)&&ol(Oe,et.length):qt=="string"&&Oe in et)?Po(et[Oe],ye):!1}function Wr(ye){var Oe=typeof ye;return Oe=="string"||Oe=="number"||Oe=="symbol"||Oe=="boolean"?ye!=="__proto__":ye===null}function ja(ye){return!!zt&&zt in ye}function rr(ye){var Oe=ye&&ye.constructor,et=typeof Oe=="function"&&Oe.prototype||He;return ye===et}function pc(ye){var Oe=[];if(ye!=null)for(var et in Object(ye))Oe.push(et);return Oe}function xp(ye){return dn.call(ye)}function Bl(ye,Oe,et){return Oe=lo(Oe===void 0?ye.length-1:Oe,0),function(){for(var qt=arguments,Kn=-1,mr=lo(qt.length-Oe,0),Fr=Array(mr);++Kn<mr;)Fr[Kn]=qt[Oe+Kn];Kn=-1;for(var cn=Array(Oe+1);++Kn<Oe;)cn[Kn]=qt[Kn];return cn[Oe]=et(Fr),ln(ye,this,cn)}}function Wd(ye,Oe){if(!(Oe==="constructor"&&typeof ye[Oe]=="function")&&Oe!="__proto__")return ye[Oe]}var uf=Mp(Ys);function Mp(ye){var Oe=0,et=0;return function(){var qt=uo(),Kn=d-(qt-et);if(et=qt,Kn>0){if(++Oe>=l)return arguments[0]}else Oe=0;return ye.apply(void 0,arguments)}}function df(ye){if(ye!=null){try{return vt.call(ye)}catch{}try{return ye+""}catch{}}return""}function Po(ye,Oe){return ye===Oe||ye!==ye&&Oe!==Oe}var es=il(function(){return arguments}())?il:function(ye){return cs(ye)&&St.call(ye,"callee")&&!Ms.call(ye,"callee")},Oo=Array.isArray;function ko(ye){return ye!=null&&Up(ye.length)&&!Do(ye)}function Wl(ye){return cs(ye)&&ko(ye)}var No=tl||cl;function Do(ye){if(!mc(ye))return!1;var Oe=fc(ye);return Oe==F||Oe==j||Oe==T||Oe==ne}function Up(ye){return typeof ye=="number"&&ye>-1&&ye%1==0&&ye<=p}function mc(ye){var Oe=typeof ye;return ye!=null&&(Oe=="object"||Oe=="function")}function cs(ye){return ye!=null&&typeof ye=="object"}function Fu(ye){if(!cs(ye)||fc(ye)!=K)return!1;var Oe=an(ye);if(Oe===null)return!0;var et=St.call(Oe,"constructor")&&Oe.constructor;return typeof et=="function"&&et instanceof et&&vt.call(et)==fn}var hf=Vt?Qt(Vt):cf;function al(ye){return ur(ye,zl(ye))}function zl(ye){return ko(ye)?Ud(ye):Fd(ye)}var Vp=Vl(function(ye,Oe,et,qt){Ul(ye,Oe,et,qt)});function ca(ye){return function(){return ye}}function la(ye){return ye}function cl(){return!1}n.exports=Vp}(yw,yw.exports)),yw.exports}var _Ee=gEe();const Vh=y0(_Ee);function Yc(n,t=[]){const s=L.useRef(n);return L.useEffect(()=>{s.current=n}),L.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function NS(n,t,s,a){const l=Yc(s);return L.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,s]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function pQ(n){const{isOpen:t,ref:s}=n,[a,l]=L.useState(t),[d,p]=L.useState(!1);return L.useEffect(()=>{d||(l(t),p(!0))},[t,d,a]),NS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var w;const v=U_e(s.current),T=new v.CustomEvent("animationend",{bubbles:!0});(w=s.current)==null||w.dispatchEvent(T)}}}function mQ(n){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=n,d=Yc(a),p=Yc(l),[E,v]=L.useState(s),T=t!==void 0,w=T?t:E,A=Yc(N=>{const j=typeof N=="function"?N(w):N;p(w,j)&&(T||v(j),d(j))},[T,d,w,p]);return[w,A]}function bp(n={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=n,d=Yc(s),p=Yc(t),[E,v]=L.useState(n.defaultIsOpen||!1),T=a!==void 0?a:E,w=a!==void 0,A=L.useId(),N=l??`disclosure-${A}`,F=L.useCallback(()=>{w||v(!1),p==null||p()},[w,p]),j=L.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=L.useCallback(()=>{T?F():j()},[T,j,F]);function G(K={}){return{...K,"aria-expanded":T,"aria-controls":N,onClick(ne){var de;(de=K.onClick)==null||de.call(K,ne),B()}}}function J(K={}){return{...K,hidden:!T,id:N}}return{isOpen:T,onOpen:j,onClose:F,onToggle:B,isControlled:w,getButtonProps:G,getDisclosureProps:J}}const rg=globalThis!=null&&globalThis.document?L.useLayoutEffect:L.useEffect,hg=(n,t)=>{const s=L.useRef(!1),a=L.useRef(!1);L.useEffect(()=>{if(s.current&&a.current)return n();a.current=!0},t),L.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function EEe(n){const t=n.current;if(!t)return!1;const s=F_e(t);return!s||t.contains(s)?!1:!!eEe(s)}function gQ(n,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;hg(()=>{if(!d||EEe(n))return;const p=(l==null?void 0:l.current)||n.current;let E;if(p)return E=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,n,l])}const yEe={preventScroll:!0,shouldFocus:!1};function vEe(n,t=yEe){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,p=SEe(n)?n.current:n,E=l&&d,v=L.useRef(E),T=L.useRef(d);rg(()=>{!T.current&&d&&(v.current=E),T.current=d},[d,E]);const w=L.useCallback(()=>{if(!(!d||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var A;(A=s.current)==null||A.focus({preventScroll:a})});else{const A=uQ(p);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,p,s]);hg(()=>{w()},[w]),NS(p,"transitionend",w)}function SEe(n){return"current"in n}function TEe(n){return"current"in n}const _Q=()=>typeof window<"u";function bEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const wEe=n=>_Q()&&n.test(navigator.vendor),REe=n=>_Q()&&n.test(bEe()),CEe=()=>REe(/mac|iphone|ipad|ipod/i),IEe=()=>CEe()&&wEe(/apple/i);function AEe(n){const{ref:t,elements:s,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};NS(l,"pointerdown",d=>{var T,w;if(!IEe()||!a)return;const p=((w=(T=d.composedPath)==null?void 0:T.call(d))==null?void 0:w[0])??d.target,v=(s??[t]).some(A=>{const N=TEe(A)?A.current:A;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(d.preventDefault(),p.focus())})}function PEe(n,t){const s=L.useId();return L.useMemo(()=>n||[t,s].filter(Boolean).join("-"),[n,t,s])}function OEe(n,...t){const s=PEe(n);return L.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function EQ(n){const t=L.useRef(null);return t.current=n,t}function kEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function Ji(...n){return t=>{n.forEach(s=>{kEe(s,t)})}}function NEe(...n){return L.useMemo(()=>Ji(...n),n)}function yQ(n){const{ref:t,handler:s,enabled:a=!0}=n,l=Yc(s),p=L.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;L.useEffect(()=>{if(!a)return;const E=A=>{FM(A,t)&&(p.isPointerDown=!0)},v=A=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&s&&FM(A,t)&&(p.isPointerDown=!1,l(A))},T=A=>{p.ignoreEmulatedMouseEvents=!0,s&&p.isPointerDown&&FM(A,t)&&(p.isPointerDown=!1,l(A))},w=vQ(t.current);return w.addEventListener("mousedown",E,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",E,!0),w.addEventListener("touchend",T,!0),()=>{w.removeEventListener("mousedown",E,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",E,!0),w.removeEventListener("touchend",T,!0)}},[s,t,l,p,a])}function FM(n,t){var a,l;const s=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return s&&!vQ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function vQ(n){return(n==null?void 0:n.ownerDocument)??document}function DEe(n,t){const s=Yc(n);L.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const SQ=1/60*1e3,LEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),TQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(LEe()),SQ);function xEe(n){let t=[],s=[],a=0,l=!1,d=!1;const p=new WeakSet,E={schedule:(v,T=!1,w=!1)=>{const A=w&&l,N=A?t:s;return T&&p.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=t.length)),v},cancel:v=>{const T=s.indexOf(v);T!==-1&&s.splice(T,1),p.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let T=0;T<a;T++){const w=t[T];w(v),p.has(w)&&(E.schedule(w),n())}l=!1,d&&(d=!1,E.process(v))}};return E}const MEe=40;let oU=!0,tR=!1,aU=!1;const DS={delta:0,timestamp:0},xR=["read","update","preRender","render","postRender"],tN=xR.reduce((n,t)=>(n[t]=xEe(()=>tR=!0),n),{}),UEe=xR.reduce((n,t)=>{const s=tN[t];return n[t]=(a,l=!1,d=!1)=>(tR||jEe(),s.schedule(a,l,d)),n},{}),VEe=xR.reduce((n,t)=>(n[t]=tN[t].cancel,n),{});xR.reduce((n,t)=>(n[t]=()=>tN[t].process(DS),n),{});const FEe=n=>tN[n].process(DS),bQ=n=>{tR=!1,DS.delta=oU?SQ:Math.max(Math.min(n-DS.timestamp,MEe),1),DS.timestamp=n,aU=!0,xR.forEach(FEe),aU=!1,tR&&(oU=!1,TQ(bQ))},jEe=()=>{tR=!0,oU=!0,aU||TQ(bQ)},j$=()=>DS;var BEe=Object.defineProperty,WEe=(n,t,s)=>t in n?BEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,vd=(n,t,s)=>(WEe(n,typeof t!="symbol"?t+"":t,s),s);class zEe{constructor(t,s,a){if(vd(this,"history",[]),vd(this,"startEvent",null),vd(this,"lastEvent",null),vd(this,"lastEventInfo",null),vd(this,"handlers",{}),vd(this,"removeListeners",()=>{}),vd(this,"threshold",3),vd(this,"win"),vd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=jM(this.lastEventInfo,this.history),v=this.startEvent!==null,T=KEe(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!T)return;const{timestamp:w}=j$();this.history.push({...E.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),vd(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,UEe.update(this.updatePoint,!0)}),vd(this,"onPointerUp",(E,v)=>{const T=jM(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(E,T),this.end(),!(!w||!this.startEvent)&&(w==null||w(E,T))}),this.win=t.view??window,B_e(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:oQ(t)},{timestamp:d}=j$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=s;p==null||p(t,jM(l,this.history)),this.removeListeners=$Ee(AO(this.win,"pointermove",this.onPointerMove),AO(this.win,"pointerup",this.onPointerUp),AO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),VEe.update(this.updatePoint)}}function B$(n,t){return{x:n.x-t.x,y:n.y-t.y}}function jM(n,t){return{point:n.point,delta:B$(n.point,t[t.length-1]),offset:B$(n.point,t[0]),velocity:HEe(t,.1)}}const GEe=n=>n*1e3;function HEe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=n[n.length-1];for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>GEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function $Ee(...n){return t=>n.reduce((s,a)=>a(s),t)}function BM(n,t){return Math.abs(n-t)}function W$(n){return"x"in n&&"y"in n}function KEe(n,t){if(typeof n=="number"&&typeof t=="number")return BM(n,t);if(W$(n)&&W$(t)){const s=BM(n.x,t.x),a=BM(n.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function qEe(n,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:E}=t,v=!!(s||a||l||d||p),T=L.useRef(null),w=EQ({onSessionStart:d,onSessionEnd:p,onStart:a,onMove:s,onEnd(A,N){T.current=null,l==null||l(A,N)}});L.useEffect(()=>{var A;(A=T.current)==null||A.updateHandlers(w.current)}),L.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(F){T.current=new zEe(F,w.current,E)}return AO(A,"pointerdown",N)},[n,v,w,E]),L.useEffect(()=>()=>{var A;(A=T.current)==null||A.end(),T.current=null},[])}const io={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Ah=n=>wQ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),rp=n=>wQ(t=>n(t,"~ &"),"[data-peer]",".peer"),wQ=(n,...t)=>t.map(n).join(", "),LS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Ah(io.open),_groupClosed:Ah(io.closed),_groupHover:Ah(io.hover),_peerHover:rp(io.hover),_groupFocus:Ah(io.focus),_peerFocus:rp(io.focus),_groupFocusVisible:Ah(io.focusVisible),_peerFocusVisible:rp(io.focusVisible),_groupActive:Ah(io.active),_peerActive:rp(io.active),_groupDisabled:Ah(io.disabled),_peerDisabled:rp(io.disabled),_groupInvalid:Ah(io.invalid),_peerInvalid:rp(io.invalid),_groupChecked:Ah(io.checked),_peerChecked:rp(io.checked),_groupFocusWithin:Ah(io.focusWithin),_peerFocusWithin:rp(io.focusWithin),_peerPlaceholderShown:rp(io.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},RQ=Object.keys(LS),YEe=n=>/!(important)?$/.test(n),z$=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,XEe=(n,t)=>s=>{const a=String(t),l=YEe(a),d=z$(a),p=n?`${n}.${d}`:d;let E=bu(s.__cssMap)&&p in s.__cssMap?s.__cssMap[p].varRef:t;return E=z$(E),l?`${E} !important`:E};function zV(n){const{scale:t,transform:s,compose:a}=n;return(d,p)=>{const E=XEe(t,d)(p);let v=(s==null?void 0:s(E,p))??E;return a&&(v=a(v,p)),v}}const YP=(...n)=>t=>n.reduce((s,a)=>a(s),t);function Eu(n,t){return s=>{const a={property:s,scale:n};return a.transform=zV({scale:n,transform:t}),a}}const JEe=({rtl:n,ltr:t})=>s=>s.direction==="rtl"?n:t;function QEe(n){const{property:t,scale:s,transform:a}=n;return{scale:s,property:JEe(t),transform:s?zV({scale:s,compose:a}):a}}const CQ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function ZEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...CQ].join(" ")}function eye(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...CQ].join(" ")}const tye={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},nye={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function rye(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const iye={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},cU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},sye=new Set(Object.values(cU)),lU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),oye=n=>n.trim();function aye(n,t){if(n==null||lU.has(n))return n;if(!(uU(n)||lU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...T]=p.split(",").map(oye).filter(Boolean);if((T==null?void 0:T.length)===0)return n;const w=v in cU?cU[v]:v;T.unshift(w);const A=T.map(N=>{if(sye.has(N))return N;const F=N.indexOf(" "),[j,B]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],G=uU(B)?B:B&&B.split(" "),J=`colors.${j}`,K=J in t.__cssMap?t.__cssMap[J].varRef:j;return G?[K,...Array.isArray(G)?G:[G]].join(" "):K});return`${E}(${A.join(", ")})`}const uU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),cye=(n,t)=>aye(n,t??{});function lye(n){return/^var\(--.+\)$/.test(n)}const uye=n=>{const t=parseFloat(n.toString()),s=n.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Ph=n=>t=>`${n}(${t})`,Cr={filter(n){return n!=="auto"?n:tye},backdropFilter(n){return n!=="auto"?n:nye},ring(n){return rye(Cr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?ZEe():n==="auto-gpu"?eye():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=uye(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[n]:n},degree(n){if(lye(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:cye,blur:Ph("blur"),opacity:Ph("opacity"),brightness:Ph("brightness"),contrast:Ph("contrast"),dropShadow:Ph("drop-shadow"),grayscale:Ph("grayscale"),hueRotate:n=>Ph("hue-rotate")(Cr.degree(n)),invert:Ph("invert"),saturate:Ph("saturate"),sepia:Ph("sepia"),bgImage(n){return n==null||uU(n)||lU.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:s}=iye[n]??{},a={flexDirection:n};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:Eu("borderWidths"),borderStyles:Eu("borderStyles"),colors:Eu("colors"),borders:Eu("borders"),gradients:Eu("gradients",Cr.gradient),radii:Eu("radii",Cr.px),space:Eu("space",YP(Cr.vh,Cr.px)),spaceT:Eu("space",YP(Cr.vh,Cr.px)),degreeT(n){return{property:n,transform:Cr.degree}},prop(n,t,s){return{property:n,scale:t,...t&&{transform:zV({scale:t,transform:s})}}},propT(n,t){return{property:n,transform:t}},sizes:Eu("sizes",YP(Cr.vh,Cr.px)),sizesT:Eu("sizes",YP(Cr.vh,Cr.fraction)),shadows:Eu("shadows"),logical:QEe,blur:Eu("blur",Cr.blur)},PO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Cr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Cr.bgClip}};Object.assign(PO,{bgImage:PO.backgroundImage,bgImg:PO.backgroundImage});const Hr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Hr,{rounded:Hr.borderRadius,roundedTop:Hr.borderTopRadius,roundedTopLeft:Hr.borderTopLeftRadius,roundedTopRight:Hr.borderTopRightRadius,roundedTopStart:Hr.borderStartStartRadius,roundedTopEnd:Hr.borderStartEndRadius,roundedBottom:Hr.borderBottomRadius,roundedBottomLeft:Hr.borderBottomLeftRadius,roundedBottomRight:Hr.borderBottomRightRadius,roundedBottomStart:Hr.borderEndStartRadius,roundedBottomEnd:Hr.borderEndEndRadius,roundedLeft:Hr.borderLeftRadius,roundedRight:Hr.borderRightRadius,roundedStart:Hr.borderInlineStartRadius,roundedEnd:Hr.borderInlineEndRadius,borderStart:Hr.borderInlineStart,borderEnd:Hr.borderInlineEnd,borderTopStartRadius:Hr.borderStartStartRadius,borderTopEndRadius:Hr.borderStartEndRadius,borderBottomStartRadius:Hr.borderEndStartRadius,borderBottomEndRadius:Hr.borderEndEndRadius,borderStartRadius:Hr.borderInlineStartRadius,borderEndRadius:Hr.borderInlineEndRadius,borderStartWidth:Hr.borderInlineStartWidth,borderEndWidth:Hr.borderInlineEndWidth,borderStartColor:Hr.borderInlineStartColor,borderEndColor:Hr.borderInlineEndColor,borderStartStyle:Hr.borderInlineStartStyle,borderEndStyle:Hr.borderInlineEndStyle});const dye={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},uk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Cr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(uk,{flexDir:uk.flexDirection});const Su={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Cr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Su,{w:Su.width,h:Su.height,minW:Su.minWidth,maxW:Su.maxWidth,minH:Su.minHeight,maxH:Su.maxHeight,overscroll:Su.overscrollBehavior,overscrollX:Su.overscrollBehaviorX,overscrollY:Su.overscrollBehaviorY});const hye={filter:{transform:Cr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Cr.brightness),contrast:Be.propT("--chakra-contrast",Cr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Cr.hueRotate),invert:Be.propT("--chakra-invert",Cr.invert),saturate:Be.propT("--chakra-saturate",Cr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Cr.dropShadow),backdropFilter:{transform:Cr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Cr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Cr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Cr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Cr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Cr.saturate)},fye={ring:{transform:Cr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},pye={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Cr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},IQ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function mye(n,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?s:n}const gye=n=>{const t=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=n(a,l,d,p);return E.set(l,v),v}},_ye=gye(mye),Eye={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},yye={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},WM=(n,t,s)=>{const a={},l=_ye(n,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},vye={srOnly:{transform(n){return n===!0?Eye:n==="focusable"?yye:{}}},layerStyle:{processResult:!0,transform:(n,t,s)=>WM(t,`layerStyles.${n}`,s)},textStyle:{processResult:!0,transform:(n,t,s)=>WM(t,`textStyles.${n}`,s)},apply:{processResult:!0,transform:(n,t,s)=>WM(t,n,s)}},Mw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Mw,{insetStart:Mw.insetInlineStart,insetEnd:Mw.insetInlineEnd});const dU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(dU,{shadow:dU.boxShadow});const Fi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Fi,{m:Fi.margin,mt:Fi.marginTop,mr:Fi.marginRight,me:Fi.marginInlineEnd,marginEnd:Fi.marginInlineEnd,mb:Fi.marginBottom,ml:Fi.marginLeft,ms:Fi.marginInlineStart,marginStart:Fi.marginInlineStart,mx:Fi.marginX,my:Fi.marginY,p:Fi.padding,pt:Fi.paddingTop,py:Fi.paddingY,px:Fi.paddingX,pb:Fi.paddingBottom,pl:Fi.paddingLeft,ps:Fi.paddingInlineStart,paddingStart:Fi.paddingInlineStart,pr:Fi.paddingRight,pe:Fi.paddingInlineEnd,paddingEnd:Fi.paddingInlineEnd});const Sye={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},Tye={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Cr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},bye={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},wye={clipPath:!0,transform:Be.propT("transform",Cr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},Rye={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},Cye={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},GV=Vh({},PO,Hr,dye,uk,Su,hye,fye,pye,IQ,vye,Mw,dU,Fi,Sye,Tye,bye,wye,Rye,Cye),Iye=Object.assign({},Fi,Su,uk,IQ,Mw),Aye=Object.keys(Iye),Pye=[...Object.keys(GV),...RQ],Oye={...GV,...LS},kye=n=>n in Oye,Nye=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const p in n){let E=qc(n[p],t);if(E==null)continue;if(E=bu(E)&&s(E)?a(E):E,!Array.isArray(E)){d[p]=E;continue}const v=E.slice(0,l.length).length;for(let T=0;T<v;T+=1){const w=l==null?void 0:l[T];if(!w){d[p]=E[T];continue}d[w]=d[w]||{},E[T]!=null&&(d[w][p]=E[T])}}return d};function Dye(n){const t=[];let s="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function Lye(n){return/^var\(--.+\)$/.test(n)}const xye=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!Lye(t),Mye=(n,t)=>{if(t==null)return t;const s=p=>{var E,v;return(v=(E=n.__cssMap)==null?void 0:E[p])==null?void 0:v.varRef},a=p=>s(p)??p,[l,d]=Dye(t);return t=s(l)??a(d)??a(t),t};function Uye(n){const{configs:t={},pseudos:s={},theme:a}=n,l=(d,p=!1)=>{var w;const E=qc(d,a),v=Nye(E)(a);let T={};for(let A in v){const N=v[A];let F=qc(N,a);A in s&&(A=s[A]),xye(A,F)&&(F=Mye(a,F));let j=t[A];if(j===!0&&(j={property:A}),bu(F)){T[A]=T[A]??{},T[A]=Vh({},T[A],l(F,!0));continue}let B=((w=j==null?void 0:j.transform)==null?void 0:w.call(j,F,a,E))??F;B=j!=null&&j.processResult?l(B,!0):B;const G=qc(j==null?void 0:j.property,a);if(!p&&(j!=null&&j.static)){const J=qc(j.static,a);T=Vh({},T,J)}if(G&&Array.isArray(G)){for(const J of G)T[J]=B;continue}if(G){G==="&"&&bu(B)?T=Vh({},T,B):T[G]=B;continue}if(bu(B)){T=Vh({},T,B);continue}T[A]=B}return T};return l}const AQ=n=>t=>Uye({theme:t,pseudos:LS,configs:GV})(n);function r8e(n){return n}function i8e(n){return n}function Oi(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Vye(n,t,s){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function Fye(n,t){if(Array.isArray(n))return n;if(bu(n))return t(n);if(n!=null)return[n]}function jye(n,t){for(let s=t+1;s<n.length;s++)if(n[s]!=null)return s;return-1}function Bye(n){const t=n.__breakpoints;return function(a,l,d,p){var N,F;if(!t)return;const E={},v=Fye(d,t.toArrayValue);if(!v)return E;const T=v.length,w=T===1,A=!!a.parts;for(let j=0;j<T;j++){const B=t.details[j],G=t.details[jye(v,j)],J=Ew(B.minW,G==null?void 0:G._minW),K=qc((N=a[l])==null?void 0:N[v[j]],p);if(K){if(A){(F=a.parts)==null||F.forEach(ne=>{Vh(E,{[ne]:w?K[ne]:{[J]:K[ne]}})});continue}if(!A){w?Vh(E,K):E[J]=K;continue}E[J]=K}}return E}}function Wye(n){return t=>{const{variant:s,size:a,theme:l}=t,d=Bye(l);return Vh({},qc(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",s,t))}}function Qi(n){return LR(n,["styleConfig","size","variant","colorScheme"])}function PQ(n){return bu(n)&&n.reference?n.reference:String(n)}const nN=(n,...t)=>t.map(PQ).join(` ${n} `).replace(/calc/g,""),G$=(...n)=>`calc(${nN("+",...n)})`,H$=(...n)=>`calc(${nN("-",...n)})`,hU=(...n)=>`calc(${nN("*",...n)})`,$$=(...n)=>`calc(${nN("/",...n)})`,K$=n=>{const t=PQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:hU(t,-1)},cp=Object.assign(n=>({add:(...t)=>cp(G$(n,...t)),subtract:(...t)=>cp(H$(n,...t)),multiply:(...t)=>cp(hU(n,...t)),divide:(...t)=>cp($$(n,...t)),negate:()=>cp(K$(n)),toString:()=>n.toString()}),{add:G$,subtract:H$,multiply:hU,divide:$$,negate:K$});function zye(n,t="-"){return n.replace(/\s+/g,t)}function Gye(n){const t=zye(n.toString());return $ye(Hye(t))}function Hye(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function $ye(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Kye(n,t=""){return[t,n].filter(Boolean).join("-")}function qye(n,t){return`var(${n}${t?`, ${t}`:""})`}function Yye(n,t=""){return Gye(`--${Kye(n,t)}`)}function On(n,t,s){const a=Yye(n,s);return{variable:a,reference:qye(a,t)}}function Xye(n,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=On(`${n}-${l}`,d);continue}s[a]=On(`${n}-${a}`)}return s}const Jye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Qye(n){return hQ(n,Jye)}function Zye(n){return n.semanticTokens}function eve(n){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=n;return l}function tve(n){const t=Qye(n),s=Zye(n),a=d=>RQ.includes(d)||d==="default",l={};return V$(t,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),V$(s,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function q$(n,t){return On(String(n).replace(/\./g,"-"),void 0,t)}function nve(n){var p;const t=tve(n),s=(p=n.config)==null?void 0:p.cssVarPrefix;let a={};const l={};function d(E,v){const w=[String(E).split(".")[0],v].join(".");if(!t[w])return v;const{reference:N}=q$(w,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:T,value:w}=v,{variable:A,reference:N}=q$(E,s);if(!T){if(E.startsWith("space")){const j=E.split("."),[B,...G]=j,J=`${B}.-${G.join(".")}`,K=cp.negate(w),ne=cp.negate(N);l[J]={value:K,var:A,varRef:ne}}a[A]=w,l[E]={value:w,var:A,varRef:N};continue}const F=bu(w)?w:{default:w};a=Vh(a,Object.entries(F).reduce((j,[B,G])=>{if(!G)return j;const J=d(E,`${G}`);if(B==="default")return j[A]=J,j;const K=(LS==null?void 0:LS[B])??B;return j[K]={[A]:J},j},{})),l[E]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function rve(n){const t=eve(n),{cssMap:s,cssVars:a}=nve(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:J_e(t.breakpoints)}),t}function Yr(n,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)t[A]=v(A);return Yr(n,t)}function d(...w){for(const A of w)A in t||(t[A]=v(A));return Yr(n,t)}function p(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([A,N])=>[A,N.className]))}function v(w){const F=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:p,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const ive=Yr("accordion").parts("root","container","button","panel","icon"),sve=Yr("alert").parts("title","description","container","icon","spinner"),ove=Yr("avatar").parts("label","badge","container","excessLabel","group"),ave=Yr("breadcrumb").parts("link","item","container","separator");Yr("button").parts();const cve=Yr("checkbox").parts("control","icon","container","label");Yr("progress").parts("track","filledTrack","label");const lve=Yr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),uve=Yr("editable").parts("preview","input","textarea"),dve=Yr("form").parts("container","requiredIndicator","helperText"),hve=Yr("formError").parts("text","icon"),fve=Yr("input").parts("addon","field","element","group"),pve=Yr("list").parts("container","item","icon"),mve=Yr("menu").parts("button","list","item","groupTitle","icon","command","divider"),gve=Yr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),_ve=Yr("numberinput").parts("root","field","stepperGroup","stepper");Yr("pininput").parts("field");const Eve=Yr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),yve=Yr("progress").parts("label","filledTrack","track"),vve=Yr("radio").parts("container","control","label"),Sve=Yr("select").parts("field","icon"),Tve=Yr("slider").parts("container","track","thumb","filledTrack","mark"),bve=Yr("stat").parts("container","label","helpText","number","icon"),wve=Yr("switch").parts("container","track","thumb","label"),Rve=Yr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Cve=Yr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Ive=Yr("tag").parts("container","label","closeButton"),Ave=Yr("card").parts("container","header","body","footer");Yr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Pve,defineMultiStyleConfig:Ove}=Oi(ive.keys),kve={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Nve={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Dve={pt:"2",px:"4",pb:"5"},Lve={fontSize:"1.25em"},xve=Pve({container:kve,button:Nve,panel:Dve,icon:Lve}),Mve=Ove({baseStyle:xve});function aE(n,t,s){return Math.min(Math.max(n,s),t)}class Uve extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var vw=Uve;function HV(n){if(typeof n!="string")throw new vw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=Hve.test(n)?jve(n):n;const s=Bve.exec(t);if(s){const p=Array.from(s).slice(1);return[...p.slice(0,3).map(E=>parseInt(nR(E,2),16)),parseInt(nR(p[3]||"f",2),16)/255]}const a=Wve.exec(t);if(a){const p=Array.from(a).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,16)),parseInt(p[3]||"ff",16)/255]}const l=zve.exec(t);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(E=>parseInt(E,10)),parseFloat(p[3]||"1")]}const d=Gve.exec(t);if(d){const[p,E,v,T]=Array.from(d).slice(1).map(parseFloat);if(aE(0,100,E)!==E)throw new vw(n);if(aE(0,100,v)!==v)throw new vw(n);return[...$ve(p,E,v),Number.isNaN(T)?1:T]}throw new vw(n)}function Vve(n){let t=5381,s=n.length;for(;s;)t=t*33^n.charCodeAt(--s);return(t>>>0)%2341}const Y$=n=>parseInt(n.replace(/_/g,""),36),Fve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const s=Y$(t.substring(0,3)),a=Y$(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[s]=`${l}${a}`,n},{});function jve(n){const t=n.toLowerCase().trim(),s=Fve[Vve(t)];if(!s)throw new vw(n);return`#${s}`}const nR=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),Bve=new RegExp(`^#${nR("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Wve=new RegExp(`^#${nR("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),zve=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${nR(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Gve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Hve=/^[a-z]+$/i,X$=n=>Math.round(n*255),$ve=(n,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(X$);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),p=d*(1-Math.abs(l%2-1));let E=0,v=0,T=0;l>=0&&l<1?(E=d,v=p):l>=1&&l<2?(E=p,v=d):l>=2&&l<3?(v=d,T=p):l>=3&&l<4?(v=p,T=d):l>=4&&l<5?(E=p,T=d):l>=5&&l<6&&(E=d,T=p);const w=a-d/2,A=E+w,N=v+w,F=T+w;return[A,N,F].map(X$)};function Kve(n,t,s,a){return`rgba(${aE(0,255,n).toFixed()}, ${aE(0,255,t).toFixed()}, ${aE(0,255,s).toFixed()}, ${parseFloat(aE(0,1,a).toFixed(3))})`}function qve(n,t){const[s,a,l,d]=HV(n);return Kve(s,a,l,d-t)}function Yve(n){const[t,s,a,l]=HV(n);let d=p=>{const E=aE(0,255,p).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const Xve=n=>Object.keys(n).length===0;function Jve(n,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?s:n}const nc=(n,t,s)=>{const a=Jve(n,`colors.${t}`,t);try{return Yve(a),a}catch{return s??"#000000"}},Qve=n=>{const[t,s,a]=HV(n);return(t*299+s*587+a*114)/1e3},Zve=n=>t=>{const s=nc(t,n);return Qve(s)<128?"dark":"light"},eSe=n=>t=>Zve(n)(t)==="dark",YS=(n,t)=>s=>{const a=nc(s,n);return qve(a,1-t)};function J$(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const tSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function nSe(n){const t=tSe();return!n||Xve(n)?t:n.string&&n.colors?iSe(n.string,n.colors):n.string&&!n.colors?rSe(n.string):n.colors&&!n.string?sSe(n.colors):t}function rSe(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function iSe(n,t){let s=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)s=n.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function sSe(n){return n[Math.floor(Math.random()*n.length)]}function Pn(n,t){return s=>s.colorMode==="dark"?t:n}function $V(n){const{orientation:t,vertical:s,horizontal:a}=n;return t?t==="vertical"?s:a:{}}function OQ(n){return bu(n)&&n.reference?n.reference:String(n)}const rN=(n,...t)=>t.map(OQ).join(` ${n} `).replace(/calc/g,""),Q$=(...n)=>`calc(${rN("+",...n)})`,Z$=(...n)=>`calc(${rN("-",...n)})`,fU=(...n)=>`calc(${rN("*",...n)})`,eK=(...n)=>`calc(${rN("/",...n)})`,tK=n=>{const t=OQ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:fU(t,-1)},lp=Object.assign(n=>({add:(...t)=>lp(Q$(n,...t)),subtract:(...t)=>lp(Z$(n,...t)),multiply:(...t)=>lp(fU(n,...t)),divide:(...t)=>lp(eK(n,...t)),negate:()=>lp(tK(n)),toString:()=>n.toString()}),{add:Q$,subtract:Z$,multiply:fU,divide:eK,negate:tK});function oSe(n){return!Number.isInteger(parseFloat(n.toString()))}function aSe(n,t="-"){return n.replace(/\s+/g,t)}function kQ(n){const t=aSe(n.toString());return t.includes("\\.")?n:oSe(n)?t.replace(".","\\."):n}function cSe(n,t=""){return[t,kQ(n)].filter(Boolean).join("-")}function lSe(n,t){return`var(${kQ(n)}${t?`, ${t}`:""})`}function uSe(n,t=""){return`--${cSe(n,t)}`}function co(n,t){const s=uSe(n,t==null?void 0:t.prefix);return{variable:s,reference:lSe(s,dSe(t==null?void 0:t.fallback))}}function dSe(n){return n==null?void 0:n.reference}const{definePartsStyle:MR,defineMultiStyleConfig:hSe}=Oi(sve.keys),Pl=On("alert-fg"),wp=On("alert-bg"),fSe=MR({container:{bg:wp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Pl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function KV(n){const{theme:t,colorScheme:s}=n,a=YS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const pSe=MR(n=>{const{colorScheme:t}=n,s=KV(n);return{container:{[Pl.variable]:`colors.${t}.600`,[wp.variable]:s.light,_dark:{[Pl.variable]:`colors.${t}.200`,[wp.variable]:s.dark}}}}),mSe=MR(n=>{const{colorScheme:t}=n,s=KV(n);return{container:{[Pl.variable]:`colors.${t}.600`,[wp.variable]:s.light,_dark:{[Pl.variable]:`colors.${t}.200`,[wp.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Pl.reference}}}),gSe=MR(n=>{const{colorScheme:t}=n,s=KV(n);return{container:{[Pl.variable]:`colors.${t}.600`,[wp.variable]:s.light,_dark:{[Pl.variable]:`colors.${t}.200`,[wp.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Pl.reference}}}),_Se=MR(n=>{const{colorScheme:t}=n;return{container:{[Pl.variable]:"colors.white",[wp.variable]:`colors.${t}.600`,_dark:{[Pl.variable]:"colors.gray.900",[wp.variable]:`colors.${t}.200`},color:Pl.reference}}}),ESe={subtle:pSe,"left-accent":mSe,"top-accent":gSe,solid:_Se},ySe=hSe({baseStyle:fSe,variants:ESe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),NQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},vSe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},SSe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},DQ={...NQ,...vSe,container:SSe},TSe=n=>typeof n=="function";function rc(n,...t){return TSe(n)?n(...t):n}const{definePartsStyle:LQ,defineMultiStyleConfig:bSe}=Oi(ove.keys),xS=On("avatar-border-color"),Uw=On("avatar-bg"),rR=On("avatar-font-size"),XS=On("avatar-size"),wSe={borderRadius:"full",border:"0.2em solid",borderColor:xS.reference,[xS.variable]:"white",_dark:{[xS.variable]:"colors.gray.800"}},RSe={bg:Uw.reference,fontSize:rR.reference,width:XS.reference,height:XS.reference,lineHeight:"1",[Uw.variable]:"colors.gray.200",_dark:{[Uw.variable]:"colors.whiteAlpha.400"}},CSe=n=>{const{name:t,theme:s}=n,a=t?nSe({string:t}):"colors.gray.400",l=eSe(a)(s);let d="white";return l||(d="gray.800"),{bg:Uw.reference,fontSize:rR.reference,color:d,borderColor:xS.reference,verticalAlign:"top",width:XS.reference,height:XS.reference,"&:not([data-loaded])":{[Uw.variable]:a},[xS.variable]:"colors.white",_dark:{[xS.variable]:"colors.gray.800"}}},ISe={fontSize:rR.reference,lineHeight:"1"},ASe=LQ(n=>({badge:rc(wSe,n),excessLabel:rc(RSe,n),container:rc(CSe,n),label:ISe}));function Bm(n){const t=n!=="100%"?DQ[n]:void 0;return LQ({container:{[XS.variable]:t??n,[rR.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[XS.variable]:t??n,[rR.variable]:`calc(${t??n} / 2.5)`}})}const PSe={"2xs":Bm(4),xs:Bm(6),sm:Bm(8),md:Bm(12),lg:Bm(16),xl:Bm(24),"2xl":Bm(32),full:Bm("100%")},OSe=bSe({baseStyle:ASe,sizes:PSe,defaultProps:{size:"md"}}),Ls=Xye("badge",["bg","color","shadow"]),kSe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Ls.bg.reference,color:Ls.color.reference,boxShadow:Ls.shadow.reference},NSe=n=>{const{colorScheme:t,theme:s}=n,a=YS(`${t}.500`,.6)(s);return{[Ls.bg.variable]:`colors.${t}.500`,[Ls.color.variable]:"colors.white",_dark:{[Ls.bg.variable]:a,[Ls.color.variable]:"colors.whiteAlpha.800"}}},DSe=n=>{const{colorScheme:t,theme:s}=n,a=YS(`${t}.200`,.16)(s);return{[Ls.bg.variable]:`colors.${t}.100`,[Ls.color.variable]:`colors.${t}.800`,_dark:{[Ls.bg.variable]:a,[Ls.color.variable]:`colors.${t}.200`}}},LSe=n=>{const{colorScheme:t,theme:s}=n,a=YS(`${t}.200`,.8)(s);return{[Ls.color.variable]:`colors.${t}.500`,_dark:{[Ls.color.variable]:a},[Ls.shadow.variable]:`inset 0 0 0px 1px ${Ls.color.reference}`}},xSe={solid:NSe,subtle:DSe,outline:LSe},Vw={baseStyle:kSe,variants:xSe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:MSe,definePartsStyle:USe}=Oi(ave.keys),zM=On("breadcrumb-link-decor"),VSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:zM.reference,[zM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[zM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},FSe=USe({link:VSe}),jSe=MSe({baseStyle:FSe}),BSe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},xQ=n=>{const{colorScheme:t,theme:s}=n;if(t==="gray")return{color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.100","whiteAlpha.200")(n)},_active:{bg:Pn("gray.200","whiteAlpha.300")(n)}};const a=YS(`${t}.200`,.12)(s),l=YS(`${t}.200`,.24)(s);return{color:Pn(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:Pn(`${t}.50`,a)(n)},_active:{bg:Pn(`${t}.100`,l)(n)}}},WSe=n=>{const{colorScheme:t}=n,s=Pn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...rc(xQ,n)}},zSe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},GSe=n=>{const{colorScheme:t}=n;if(t==="gray"){const E=Pn("gray.100","whiteAlpha.200")(n);return{bg:E,color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.200","whiteAlpha.300")(n),_disabled:{bg:E}},_active:{bg:Pn("gray.300","whiteAlpha.400")(n)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=zSe[t]??{},p=Pn(s,`${t}.200`)(n);return{bg:p,color:Pn(a,"gray.800")(n),_hover:{bg:Pn(l,`${t}.300`)(n),_disabled:{bg:p}},_active:{bg:Pn(d,`${t}.400`)(n)}}},HSe=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Pn(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Pn(`${t}.700`,`${t}.500`)(n)}}},$Se={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},KSe={ghost:xQ,outline:WSe,solid:GSe,link:HSe,unstyled:$Se},qSe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},YSe={baseStyle:BSe,variants:KSe,sizes:qSe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:dE,defineMultiStyleConfig:XSe}=Oi(Ave.keys),dk=On("card-bg"),_p=On("card-padding"),MQ=On("card-shadow"),OO=On("card-radius"),UQ=On("card-border-width","0"),VQ=On("card-border-color"),JSe=dE({container:{[dk.variable]:"colors.chakra-body-bg",backgroundColor:dk.reference,boxShadow:MQ.reference,borderRadius:OO.reference,color:"chakra-body-text",borderWidth:UQ.reference,borderColor:VQ.reference},body:{padding:_p.reference,flex:"1 1 0%"},header:{padding:_p.reference},footer:{padding:_p.reference}}),QSe={sm:dE({container:{[OO.variable]:"radii.base",[_p.variable]:"space.3"}}),md:dE({container:{[OO.variable]:"radii.md",[_p.variable]:"space.5"}}),lg:dE({container:{[OO.variable]:"radii.xl",[_p.variable]:"space.7"}})},ZSe={elevated:dE({container:{[MQ.variable]:"shadows.base",_dark:{[dk.variable]:"colors.gray.700"}}}),outline:dE({container:{[UQ.variable]:"1px",[VQ.variable]:"colors.chakra-border-color"}}),filled:dE({container:{[dk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[_p.variable]:0},header:{[_p.variable]:0},footer:{[_p.variable]:0}}},e0e=XSe({baseStyle:JSe,variants:ZSe,sizes:QSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:kO,defineMultiStyleConfig:t0e}=Oi(cve.keys),Fw=On("checkbox-size"),n0e=n=>{const{colorScheme:t}=n;return{w:Fw.reference,h:Fw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Pn(`${t}.500`,`${t}.200`)(n),borderColor:Pn(`${t}.500`,`${t}.200`)(n),color:Pn("white","gray.900")(n),_hover:{bg:Pn(`${t}.600`,`${t}.300`)(n),borderColor:Pn(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:Pn("gray.200","transparent")(n),bg:Pn("gray.200","whiteAlpha.300")(n),color:Pn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Pn(`${t}.500`,`${t}.200`)(n),borderColor:Pn(`${t}.500`,`${t}.200`)(n),color:Pn("white","gray.900")(n)},_disabled:{bg:Pn("gray.100","whiteAlpha.100")(n),borderColor:Pn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Pn("red.500","red.300")(n)}}},r0e={_disabled:{cursor:"not-allowed"}},i0e={userSelect:"none",_disabled:{opacity:.4}},s0e={transitionProperty:"transform",transitionDuration:"normal"},o0e=kO(n=>({icon:s0e,container:r0e,control:rc(n0e,n),label:i0e})),a0e={sm:kO({control:{[Fw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:kO({control:{[Fw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:kO({control:{[Fw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Km=t0e({baseStyle:o0e,sizes:a0e,defaultProps:{size:"md",colorScheme:"blue"}}),jw=co("close-button-size"),Jb=co("close-button-bg"),c0e={w:[jw.reference],h:[jw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Jb.variable]:"colors.blackAlpha.100",_dark:{[Jb.variable]:"colors.whiteAlpha.100"}},_active:{[Jb.variable]:"colors.blackAlpha.200",_dark:{[Jb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Jb.reference},l0e={lg:{[jw.variable]:"sizes.10",fontSize:"md"},md:{[jw.variable]:"sizes.8",fontSize:"xs"},sm:{[jw.variable]:"sizes.6",fontSize:"2xs"}},u0e={baseStyle:c0e,sizes:l0e,defaultProps:{size:"md"}},{variants:d0e,defaultProps:h0e}=Vw,f0e={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Ls.bg.reference,color:Ls.color.reference,boxShadow:Ls.shadow.reference},p0e={baseStyle:f0e,variants:d0e,defaultProps:h0e},m0e={w:"100%",mx:"auto",maxW:"prose",px:"4"},g0e={baseStyle:m0e},_0e={opacity:.6,borderColor:"inherit"},E0e={borderStyle:"solid"},y0e={borderStyle:"dashed"},v0e={solid:E0e,dashed:y0e},S0e={baseStyle:_0e,variants:v0e,defaultProps:{variant:"solid"}},{definePartsStyle:pU,defineMultiStyleConfig:T0e}=Oi(lve.keys),GM=On("drawer-bg"),HM=On("drawer-box-shadow");function sS(n){return pU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const b0e={bg:"blackAlpha.600",zIndex:"modal"},w0e={display:"flex",zIndex:"modal",justifyContent:"center"},R0e=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[GM.variable]:"colors.white",[HM.variable]:"shadows.lg",_dark:{[GM.variable]:"colors.gray.700",[HM.variable]:"shadows.dark-lg"},bg:GM.reference,boxShadow:HM.reference}},C0e={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},I0e={position:"absolute",top:"2",insetEnd:"3"},A0e={px:"6",py:"2",flex:"1",overflow:"auto"},P0e={px:"6",py:"4"},O0e=pU(n=>({overlay:b0e,dialogContainer:w0e,dialog:rc(R0e,n),header:C0e,closeButton:I0e,body:A0e,footer:P0e})),k0e={xs:sS("xs"),sm:sS("md"),md:sS("lg"),lg:sS("2xl"),xl:sS("4xl"),full:sS("full")},N0e=T0e({baseStyle:O0e,sizes:k0e,defaultProps:{size:"xs"}}),{definePartsStyle:D0e,defineMultiStyleConfig:L0e}=Oi(uve.keys),x0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},M0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},U0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},V0e=D0e({preview:x0e,input:M0e,textarea:U0e}),F0e=L0e({baseStyle:V0e}),{definePartsStyle:j0e,defineMultiStyleConfig:B0e}=Oi(dve.keys),MS=On("form-control-color"),W0e={marginStart:"1",[MS.variable]:"colors.red.500",_dark:{[MS.variable]:"colors.red.300"},color:MS.reference},z0e={mt:"2",[MS.variable]:"colors.gray.600",_dark:{[MS.variable]:"colors.whiteAlpha.600"},color:MS.reference,lineHeight:"normal",fontSize:"sm"},G0e=j0e({container:{width:"100%",position:"relative"},requiredIndicator:W0e,helperText:z0e}),H0e=B0e({baseStyle:G0e}),{definePartsStyle:$0e,defineMultiStyleConfig:K0e}=Oi(hve.keys),US=On("form-error-color"),q0e={[US.variable]:"colors.red.500",_dark:{[US.variable]:"colors.red.300"},color:US.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Y0e={marginEnd:"0.5em",[US.variable]:"colors.red.500",_dark:{[US.variable]:"colors.red.300"},color:US.reference},X0e=$0e({text:q0e,icon:Y0e}),J0e=K0e({baseStyle:X0e}),Q0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Z0e={baseStyle:Q0e},eTe={fontFamily:"heading",fontWeight:"bold"},tTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},nTe={baseStyle:eTe,sizes:tTe,defaultProps:{size:"xl"}},{definePartsStyle:dp,defineMultiStyleConfig:rTe}=Oi(fve.keys),yS=On("input-height"),vS=On("input-font-size"),SS=On("input-padding"),TS=On("input-border-radius"),iTe=dp({addon:{height:yS.reference,fontSize:vS.reference,px:SS.reference,borderRadius:TS.reference},field:{width:"100%",height:yS.reference,fontSize:vS.reference,px:SS.reference,borderRadius:TS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),Wm={lg:{[vS.variable]:"fontSizes.lg",[SS.variable]:"space.4",[TS.variable]:"radii.md",[yS.variable]:"sizes.12"},md:{[vS.variable]:"fontSizes.md",[SS.variable]:"space.4",[TS.variable]:"radii.md",[yS.variable]:"sizes.10"},sm:{[vS.variable]:"fontSizes.sm",[SS.variable]:"space.3",[TS.variable]:"radii.sm",[yS.variable]:"sizes.8"},xs:{[vS.variable]:"fontSizes.xs",[SS.variable]:"space.2",[TS.variable]:"radii.sm",[yS.variable]:"sizes.6"}},sTe={lg:dp({field:Wm.lg,group:Wm.lg}),md:dp({field:Wm.md,group:Wm.md}),sm:dp({field:Wm.sm,group:Wm.sm}),xs:dp({field:Wm.xs,group:Wm.xs})};function qV(n){const{focusBorderColor:t,errorBorderColor:s}=n;return{focusBorderColor:t||Pn("blue.500","blue.300")(n),errorBorderColor:s||Pn("red.500","red.300")(n)}}const oTe=dp(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=qV(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Pn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a),boxShadow:`0 0 0 1px ${nc(t,a)}`},_focusVisible:{zIndex:1,borderColor:nc(t,s),boxShadow:`0 0 0 1px ${nc(t,s)}`}},addon:{border:"1px solid",borderColor:Pn("inherit","whiteAlpha.50")(n),bg:Pn("gray.100","whiteAlpha.300")(n)}}}),aTe=dp(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=qV(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n),_hover:{bg:Pn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a)},_focusVisible:{bg:"transparent",borderColor:nc(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n)}}}),cTe=dp(n=>{const{theme:t}=n,{focusBorderColor:s,errorBorderColor:a}=qV(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:nc(t,a),boxShadow:`0px 1px 0px 0px ${nc(t,a)}`},_focusVisible:{borderColor:nc(t,s),boxShadow:`0px 1px 0px 0px ${nc(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),lTe=dp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),uTe={outline:oTe,filled:aTe,flushed:cTe,unstyled:lTe},qr=rTe({baseStyle:iTe,sizes:sTe,variants:uTe,defaultProps:{size:"md",variant:"outline"}}),$M=On("kbd-bg"),dTe={[$M.variable]:"colors.gray.100",_dark:{[$M.variable]:"colors.whiteAlpha.100"},bg:$M.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},hTe={baseStyle:dTe},fTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},pTe={baseStyle:fTe},{defineMultiStyleConfig:mTe,definePartsStyle:gTe}=Oi(pve.keys),_Te={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ETe=gTe({icon:_Te}),yTe=mTe({baseStyle:ETe}),{defineMultiStyleConfig:vTe,definePartsStyle:STe}=Oi(mve.keys),Oh=On("menu-bg"),KM=On("menu-shadow"),TTe={[Oh.variable]:"#fff",[KM.variable]:"shadows.sm",_dark:{[Oh.variable]:"colors.gray.700",[KM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Oh.reference,boxShadow:KM.reference},bTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Oh.variable]:"colors.gray.100",_dark:{[Oh.variable]:"colors.whiteAlpha.100"}},_active:{[Oh.variable]:"colors.gray.200",_dark:{[Oh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Oh.variable]:"colors.gray.100",_dark:{[Oh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Oh.reference},wTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},RTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},CTe={opacity:.6},ITe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},ATe={transitionProperty:"common",transitionDuration:"normal"},PTe=STe({button:ATe,list:TTe,item:bTe,groupTitle:wTe,icon:RTe,command:CTe,divider:ITe}),OTe=vTe({baseStyle:PTe}),{defineMultiStyleConfig:kTe,definePartsStyle:mU}=Oi(gve.keys),qM=On("modal-bg"),YM=On("modal-shadow"),NTe={bg:"blackAlpha.600",zIndex:"modal"},DTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},LTe=n=>{const{isCentered:t,scrollBehavior:s}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[qM.variable]:"colors.white",[YM.variable]:"shadows.lg",_dark:{[qM.variable]:"colors.gray.700",[YM.variable]:"shadows.dark-lg"},bg:qM.reference,boxShadow:YM.reference}},xTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},MTe={position:"absolute",top:"2",insetEnd:"3"},UTe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},VTe={px:"6",py:"4"},FTe=mU(n=>({overlay:NTe,dialogContainer:rc(DTe,n),dialog:rc(LTe,n),header:xTe,closeButton:MTe,body:rc(UTe,n),footer:VTe}));function Sd(n){return mU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const jTe={xs:Sd("xs"),sm:Sd("sm"),md:Sd("md"),lg:Sd("lg"),xl:Sd("xl"),"2xl":Sd("2xl"),"3xl":Sd("3xl"),"4xl":Sd("4xl"),"5xl":Sd("5xl"),"6xl":Sd("6xl"),full:Sd("full")},BTe=kTe({baseStyle:FTe,sizes:jTe,defaultProps:{size:"md"}}),FQ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:WTe,definePartsStyle:jQ}=Oi(_ve.keys),YV=co("number-input-stepper-width"),BQ=co("number-input-input-padding"),zTe=lp(YV).add("0.5rem").toString(),XM=co("number-input-bg"),JM=co("number-input-color"),QM=co("number-input-border-color"),GTe={[YV.variable]:"sizes.6",[BQ.variable]:zTe},HTe=n=>{var t;return((t=rc(qr.baseStyle,n))==null?void 0:t.field)??{}},$Te={width:YV.reference},KTe={borderStart:"1px solid",borderStartColor:QM.reference,color:JM.reference,bg:XM.reference,[JM.variable]:"colors.chakra-body-text",[QM.variable]:"colors.chakra-border-color",_dark:{[JM.variable]:"colors.whiteAlpha.800",[QM.variable]:"colors.whiteAlpha.300"},_active:{[XM.variable]:"colors.gray.200",_dark:{[XM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},qTe=jQ(n=>({root:GTe,field:rc(HTe,n)??{},stepperGroup:$Te,stepper:KTe}));function XP(n){var d,p;const t=(d=qr.sizes)==null?void 0:d[n],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((p=t.field)==null?void 0:p.fontSize)??"md",l=FQ.fontSizes[a];return jQ({field:{...t.field,paddingInlineEnd:BQ.reference,verticalAlign:"top"},stepper:{fontSize:lp(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[n]},_last:{borderBottomEndRadius:s[n],mt:"-1px",borderTopWidth:1}}})}const YTe={xs:XP("xs"),sm:XP("sm"),md:XP("md"),lg:XP("lg")},XTe=WTe({baseStyle:qTe,sizes:YTe,variants:qr.variants,defaultProps:qr.defaultProps});var FJ;const JTe={...(FJ=qr.baseStyle)==null?void 0:FJ.field,textAlign:"center"},QTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var jJ;const ZTe={outline:n=>{var t,s;return((s=rc((t=qr.variants)==null?void 0:t.outline,n))==null?void 0:s.field)??{}},flushed:n=>{var t,s;return((s=rc((t=qr.variants)==null?void 0:t.flushed,n))==null?void 0:s.field)??{}},filled:n=>{var t,s;return((s=rc((t=qr.variants)==null?void 0:t.filled,n))==null?void 0:s.field)??{}},unstyled:((jJ=qr.variants)==null?void 0:jJ.unstyled.field)??{}},ebe={baseStyle:JTe,sizes:QTe,variants:ZTe,defaultProps:qr.defaultProps},{defineMultiStyleConfig:tbe,definePartsStyle:nbe}=Oi(Eve.keys),JP=co("popper-bg"),rbe=co("popper-arrow-bg"),nK=co("popper-arrow-shadow-color"),ibe={zIndex:"popover"},sbe={[JP.variable]:"colors.white",bg:JP.reference,[rbe.variable]:JP.reference,[nK.variable]:"colors.gray.200",_dark:{[JP.variable]:"colors.gray.700",[nK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},obe={px:3,py:2,borderBottomWidth:"1px"},abe={px:3,py:2},cbe={px:3,py:2,borderTopWidth:"1px"},lbe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},ube=nbe({popper:ibe,content:sbe,header:obe,body:abe,footer:cbe,closeButton:lbe}),dbe=tbe({baseStyle:ube}),{defineMultiStyleConfig:hbe,definePartsStyle:Sw}=Oi(yve.keys),fbe=n=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=n,d=Pn(J$(),J$("1rem","rgba(0,0,0,0.1)"))(n),p=Pn(`${t}.500`,`${t}.200`)(n),E=`linear-gradient(
    to right,
    transparent 0%,
    ${nc(s,p)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:p}}},pbe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},mbe=n=>({bg:Pn("gray.100","whiteAlpha.300")(n)}),gbe=n=>({transitionProperty:"common",transitionDuration:"slow",...fbe(n)}),_be=Sw(n=>({label:pbe,filledTrack:gbe(n),track:mbe(n)})),Ebe={xs:Sw({track:{h:"1"}}),sm:Sw({track:{h:"2"}}),md:Sw({track:{h:"3"}}),lg:Sw({track:{h:"4"}})},ybe=hbe({sizes:Ebe,baseStyle:_be,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:vbe,definePartsStyle:NO}=Oi(vve.keys),Sbe=n=>{var s;const t=(s=rc(Km.baseStyle,n))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},Tbe=NO(n=>{var t,s;return{label:(t=Km.baseStyle)==null?void 0:t.call(Km,n).label,container:(s=Km.baseStyle)==null?void 0:s.call(Km,n).container,control:Sbe(n)}}),bbe={md:NO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:NO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:NO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},wbe=vbe({baseStyle:Tbe,sizes:bbe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Rbe,definePartsStyle:Cbe}=Oi(Sve.keys),QP=On("select-bg");var BJ;const Ibe={...(BJ=qr.baseStyle)==null?void 0:BJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:QP.reference,[QP.variable]:"colors.white",_dark:{[QP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:QP.reference}},Abe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Pbe=Cbe({field:Ibe,icon:Abe}),ZP={paddingInlineEnd:"8"};var WJ,zJ,GJ,HJ,$J,KJ,qJ,YJ;const Obe={lg:{...(WJ=qr.sizes)==null?void 0:WJ.lg,field:{...(zJ=qr.sizes)==null?void 0:zJ.lg.field,...ZP}},md:{...(GJ=qr.sizes)==null?void 0:GJ.md,field:{...(HJ=qr.sizes)==null?void 0:HJ.md.field,...ZP}},sm:{...($J=qr.sizes)==null?void 0:$J.sm,field:{...(KJ=qr.sizes)==null?void 0:KJ.sm.field,...ZP}},xs:{...(qJ=qr.sizes)==null?void 0:qJ.xs,field:{...(YJ=qr.sizes)==null?void 0:YJ.xs.field,...ZP},icon:{insetEnd:"1"}}},kbe=Rbe({baseStyle:Pbe,sizes:Obe,variants:qr.variants,defaultProps:qr.defaultProps}),ZM=On("skeleton-start-color"),e2=On("skeleton-end-color"),Nbe={[ZM.variable]:"colors.gray.100",[e2.variable]:"colors.gray.400",_dark:{[ZM.variable]:"colors.gray.800",[e2.variable]:"colors.gray.600"},background:ZM.reference,borderColor:e2.reference,opacity:.7,borderRadius:"sm"},Dbe={baseStyle:Nbe},t2=On("skip-link-bg"),Lbe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[t2.variable]:"colors.white",_dark:{[t2.variable]:"colors.gray.700"},bg:t2.reference}},xbe={baseStyle:Lbe},{defineMultiStyleConfig:Mbe,definePartsStyle:iN}=Oi(Tve.keys),vE=On("slider-thumb-size"),iR=On("slider-track-size"),qm=On("slider-bg"),Ube=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...$V({orientation:t,vertical:{h:"100%",px:cp(vE.reference).divide(2).toString()},horizontal:{w:"100%",py:cp(vE.reference).divide(2).toString()}})}},Vbe=n=>({...$V({orientation:n.orientation,horizontal:{h:iR.reference},vertical:{w:iR.reference}}),overflow:"hidden",borderRadius:"sm",[qm.variable]:"colors.gray.200",_dark:{[qm.variable]:"colors.whiteAlpha.200"},_disabled:{[qm.variable]:"colors.gray.300",_dark:{[qm.variable]:"colors.whiteAlpha.300"}},bg:qm.reference}),Fbe=n=>{const{orientation:t}=n;return{...$V({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:vE.reference,h:vE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},jbe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[qm.variable]:`colors.${t}.500`,_dark:{[qm.variable]:`colors.${t}.200`},bg:qm.reference}},Bbe=iN(n=>({container:Ube(n),track:Vbe(n),thumb:Fbe(n),filledTrack:jbe(n)})),Wbe=iN({container:{[vE.variable]:"sizes.4",[iR.variable]:"sizes.1"}}),zbe=iN({container:{[vE.variable]:"sizes.3.5",[iR.variable]:"sizes.1"}}),Gbe=iN({container:{[vE.variable]:"sizes.2.5",[iR.variable]:"sizes.0.5"}}),Hbe={lg:Wbe,md:zbe,sm:Gbe},$be=Mbe({baseStyle:Bbe,sizes:Hbe,defaultProps:{size:"md",colorScheme:"blue"}}),sE=co("spinner-size"),Kbe={width:[sE.reference],height:[sE.reference]},qbe={xs:{[sE.variable]:"sizes.3"},sm:{[sE.variable]:"sizes.4"},md:{[sE.variable]:"sizes.6"},lg:{[sE.variable]:"sizes.8"},xl:{[sE.variable]:"sizes.12"}},Ybe={baseStyle:Kbe,sizes:qbe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Xbe,definePartsStyle:WQ}=Oi(bve.keys),Jbe={fontWeight:"medium"},Qbe={opacity:.8,marginBottom:"2"},Zbe={verticalAlign:"baseline",fontWeight:"semibold"},ewe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},twe=WQ({container:{},label:Jbe,helpText:Qbe,number:Zbe,icon:ewe}),nwe={md:WQ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},rwe=Xbe({baseStyle:twe,sizes:nwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:iwe,definePartsStyle:Tw}=Oi(["stepper","step","title","description","indicator","separator","icon","number"]),up=On("stepper-indicator-size"),bS=On("stepper-icon-size"),wS=On("stepper-title-font-size"),bw=On("stepper-description-font-size"),Qb=On("stepper-accent-color"),swe=Tw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Qb.variable]:`colors.${n}.500`,_dark:{[Qb.variable]:`colors.${n}.200`}},title:{fontSize:wS.reference,fontWeight:"medium"},description:{fontSize:bw.reference,color:"chakra-subtle-text"},number:{fontSize:wS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:bS.reference,height:bS.reference},indicator:{flexShrink:0,borderRadius:"full",width:up.reference,height:up.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Qb.reference},"&[data-status=complete]":{bg:Qb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Qb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${up.reference} - 8px)`,top:`calc(${up.reference} + 4px)`,insetStart:`calc(${up.reference} / 2 - 1px)`}}})),owe=iwe({baseStyle:swe,sizes:{xs:Tw({stepper:{[up.variable]:"sizes.4",[bS.variable]:"sizes.3",[wS.variable]:"fontSizes.xs",[bw.variable]:"fontSizes.xs"}}),sm:Tw({stepper:{[up.variable]:"sizes.6",[bS.variable]:"sizes.4",[wS.variable]:"fontSizes.sm",[bw.variable]:"fontSizes.xs"}}),md:Tw({stepper:{[up.variable]:"sizes.8",[bS.variable]:"sizes.5",[wS.variable]:"fontSizes.md",[bw.variable]:"fontSizes.sm"}}),lg:Tw({stepper:{[up.variable]:"sizes.10",[bS.variable]:"sizes.6",[wS.variable]:"fontSizes.lg",[bw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:awe,definePartsStyle:DO}=Oi(wve.keys),Bw=co("switch-track-width"),hE=co("switch-track-height"),n2=co("switch-track-diff"),cwe=lp.subtract(Bw,hE),gU=co("switch-thumb-x"),Zb=co("switch-bg"),lwe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[Bw.reference],height:[hE.reference],transitionProperty:"common",transitionDuration:"fast",[Zb.variable]:"colors.gray.300",_dark:{[Zb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Zb.variable]:`colors.${t}.500`,_dark:{[Zb.variable]:`colors.${t}.200`}},bg:Zb.reference}},uwe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[hE.reference],height:[hE.reference],_checked:{transform:`translateX(${gU.reference})`}},dwe=DO(n=>({container:{[n2.variable]:cwe,[gU.variable]:n2.reference,_rtl:{[gU.variable]:lp(n2).negate().toString()}},track:lwe(n),thumb:uwe})),hwe={sm:DO({container:{[Bw.variable]:"1.375rem",[hE.variable]:"sizes.3"}}),md:DO({container:{[Bw.variable]:"1.875rem",[hE.variable]:"sizes.4"}}),lg:DO({container:{[Bw.variable]:"2.875rem",[hE.variable]:"sizes.6"}})},fwe=awe({baseStyle:dwe,sizes:hwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:pwe,definePartsStyle:VS}=Oi(Rve.keys),mwe=VS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),hk={"&[data-is-numeric=true]":{textAlign:"end"}},gwe=VS(n=>{const{colorScheme:t}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...hk},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...hk},caption:{color:Pn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),_we=VS(n=>{const{colorScheme:t}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...hk},td:{borderBottom:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n),...hk},caption:{color:Pn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Pn(`${t}.100`,`${t}.700`)(n)},td:{background:Pn(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Ewe={simple:gwe,striped:_we,unstyled:{}},ywe={sm:VS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:VS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:VS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},vwe=pwe({baseStyle:mwe,variants:Ewe,sizes:ywe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),$c=On("tabs-color"),bd=On("tabs-bg"),eO=On("tabs-border-color"),{defineMultiStyleConfig:Swe,definePartsStyle:Wh}=Oi(Cve.keys),Twe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},bwe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},wwe=n=>{const{align:t="start",orientation:s}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},Rwe={p:4},Cwe=Wh(n=>({root:Twe(n),tab:bwe(n),tablist:wwe(n),tabpanel:Rwe})),Iwe={sm:Wh({tab:{py:1,px:4,fontSize:"sm"}}),md:Wh({tab:{fontSize:"md",py:2,px:4}}),lg:Wh({tab:{fontSize:"lg",py:3,px:4}})},Awe=Wh(n=>{const{colorScheme:t,orientation:s}=n,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[$c.variable]:`colors.${t}.600`,_dark:{[$c.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[bd.variable]:"colors.gray.200",_dark:{[bd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:$c.reference,bg:bd.reference}}}),Pwe=Wh(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[eO.variable]:"transparent",_selected:{[$c.variable]:`colors.${t}.600`,[eO.variable]:"colors.white",_dark:{[$c.variable]:`colors.${t}.300`,[eO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:eO.reference},color:$c.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),Owe=Wh(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[bd.variable]:"colors.gray.50",_dark:{[bd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[bd.variable]:"colors.white",[$c.variable]:`colors.${t}.600`,_dark:{[bd.variable]:"colors.gray.800",[$c.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:$c.reference,bg:bd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),kwe=Wh(n=>{const{colorScheme:t,theme:s}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:nc(s,`${t}.700`),bg:nc(s,`${t}.100`)}}}}),Nwe=Wh(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[$c.variable]:"colors.gray.600",_dark:{[$c.variable]:"inherit"},_selected:{[$c.variable]:"colors.white",[bd.variable]:`colors.${t}.600`,_dark:{[$c.variable]:"colors.gray.800",[bd.variable]:`colors.${t}.300`}},color:$c.reference,bg:bd.reference}}}),Dwe=Wh({}),Lwe={line:Awe,enclosed:Pwe,"enclosed-colored":Owe,"soft-rounded":kwe,"solid-rounded":Nwe,unstyled:Dwe},xwe=Swe({baseStyle:Cwe,sizes:Iwe,variants:Lwe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:Mwe,definePartsStyle:fE}=Oi(Ive.keys),rK=On("tag-bg"),iK=On("tag-color"),r2=On("tag-shadow"),LO=On("tag-min-height"),xO=On("tag-min-width"),MO=On("tag-font-size"),UO=On("tag-padding-inline"),Uwe={fontWeight:"medium",lineHeight:1.2,outline:0,[iK.variable]:Ls.color.reference,[rK.variable]:Ls.bg.reference,[r2.variable]:Ls.shadow.reference,color:iK.reference,bg:rK.reference,boxShadow:r2.reference,borderRadius:"md",minH:LO.reference,minW:xO.reference,fontSize:MO.reference,px:UO.reference,_focusVisible:{[r2.variable]:"shadows.outline"}},Vwe={lineHeight:1.2,overflow:"visible"},Fwe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},jwe=fE({container:Uwe,label:Vwe,closeButton:Fwe}),Bwe={sm:fE({container:{[LO.variable]:"sizes.5",[xO.variable]:"sizes.5",[MO.variable]:"fontSizes.xs",[UO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:fE({container:{[LO.variable]:"sizes.6",[xO.variable]:"sizes.6",[MO.variable]:"fontSizes.sm",[UO.variable]:"space.2"}}),lg:fE({container:{[LO.variable]:"sizes.8",[xO.variable]:"sizes.8",[MO.variable]:"fontSizes.md",[UO.variable]:"space.3"}})},Wwe={subtle:fE(n=>{var t;return{container:(t=Vw.variants)==null?void 0:t.subtle(n)}}),solid:fE(n=>{var t;return{container:(t=Vw.variants)==null?void 0:t.solid(n)}}),outline:fE(n=>{var t;return{container:(t=Vw.variants)==null?void 0:t.outline(n)}})},zwe=Mwe({variants:Wwe,baseStyle:jwe,sizes:Bwe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var XJ;const Gwe={...(XJ=qr.baseStyle)==null?void 0:XJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var JJ;const Hwe={outline:n=>{var t;return((t=qr.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=qr.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=qr.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((JJ=qr.variants)==null?void 0:JJ.unstyled.field)??{}};var QJ,ZJ,eQ,tQ;const $we={xs:((QJ=qr.sizes)==null?void 0:QJ.xs.field)??{},sm:((ZJ=qr.sizes)==null?void 0:ZJ.sm.field)??{},md:((eQ=qr.sizes)==null?void 0:eQ.md.field)??{},lg:((tQ=qr.sizes)==null?void 0:tQ.lg.field)??{}},Kwe={baseStyle:Gwe,sizes:$we,variants:Hwe,defaultProps:{size:"md",variant:"outline"}},tO=co("tooltip-bg"),i2=co("tooltip-fg"),qwe=co("popper-arrow-bg"),Ywe={bg:tO.reference,color:i2.reference,[tO.variable]:"colors.gray.700",[i2.variable]:"colors.whiteAlpha.900",_dark:{[tO.variable]:"colors.gray.300",[i2.variable]:"colors.gray.900"},[qwe.variable]:tO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},Xwe={baseStyle:Ywe},Jwe={Accordion:Mve,Alert:ySe,Avatar:OSe,Badge:Vw,Breadcrumb:jSe,Button:YSe,Checkbox:Km,CloseButton:u0e,Code:p0e,Container:g0e,Divider:S0e,Drawer:N0e,Editable:F0e,Form:H0e,FormError:J0e,FormLabel:Z0e,Heading:nTe,Input:qr,Kbd:hTe,Link:pTe,List:yTe,Menu:OTe,Modal:BTe,NumberInput:XTe,PinInput:ebe,Popover:dbe,Progress:ybe,Radio:wbe,Select:kbe,Skeleton:Dbe,SkipLink:xbe,Slider:$be,Spinner:Ybe,Stat:rwe,Switch:fwe,Table:vwe,Tabs:xwe,Tag:zwe,Textarea:Kwe,Tooltip:Xwe,Card:e0e,Stepper:owe},Qwe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},Zwe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},eRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},tRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},nRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},rRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},iRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},sRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},oRe={property:rRe,easing:iRe,duration:sRe},aRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},cRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},lRe={breakpoints:Zwe,zIndices:aRe,radii:tRe,blur:cRe,colors:eRe,...FQ,sizes:DQ,shadows:nRe,space:NQ,borders:Qwe,transition:oRe},uRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},dRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},hRe="ltr",fRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},pRe={semanticTokens:uRe,direction:hRe,...lRe,components:Jwe,styles:dRe,config:fRe};function mRe(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function gRe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var _Re=function(){function n(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(gRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=mRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Ia="-ms-",fk="-moz-",$r="-webkit-",zQ="comm",XV="rule",JV="decl",ERe="@import",GQ="@keyframes",yRe="@layer",vRe=Math.abs,sN=String.fromCharCode,SRe=Object.assign;function TRe(n,t){return Zo(n,0)^45?(((t<<2^Zo(n,0))<<2^Zo(n,1))<<2^Zo(n,2))<<2^Zo(n,3):0}function HQ(n){return n.trim()}function bRe(n,t){return(n=t.exec(n))?n[0]:n}function Kr(n,t,s){return n.replace(t,s)}function _U(n,t){return n.indexOf(t)}function Zo(n,t){return n.charCodeAt(t)|0}function sR(n,t,s){return n.slice(t,s)}function Dh(n){return n.length}function QV(n){return n.length}function nO(n,t){return t.push(n),n}function wRe(n,t){return n.map(t).join("")}var oN=1,JS=1,$Q=0,Qc=0,Gs=0,v0="";function aN(n,t,s,a,l,d,p){return{value:n,root:t,parent:s,type:a,props:l,children:d,line:oN,column:JS,length:p,return:""}}function ew(n,t){return SRe(aN("",null,null,"",null,null,0),n,{length:-n.length},t)}function RRe(){return Gs}function CRe(){return Gs=Qc>0?Zo(v0,--Qc):0,JS--,Gs===10&&(JS=1,oN--),Gs}function Ol(){return Gs=Qc<$Q?Zo(v0,Qc++):0,JS++,Gs===10&&(JS=1,oN++),Gs}function zh(){return Zo(v0,Qc)}function VO(){return Qc}function UR(n,t){return sR(v0,n,t)}function oR(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function KQ(n){return oN=JS=1,$Q=Dh(v0=n),Qc=0,[]}function qQ(n){return v0="",n}function FO(n){return HQ(UR(Qc-1,EU(n===91?n+2:n===40?n+1:n)))}function IRe(n){for(;(Gs=zh())&&Gs<33;)Ol();return oR(n)>2||oR(Gs)>3?"":" "}function ARe(n,t){for(;--t&&Ol()&&!(Gs<48||Gs>102||Gs>57&&Gs<65||Gs>70&&Gs<97););return UR(n,VO()+(t<6&&zh()==32&&Ol()==32))}function EU(n){for(;Ol();)switch(Gs){case n:return Qc;case 34:case 39:n!==34&&n!==39&&EU(Gs);break;case 40:n===41&&EU(n);break;case 92:Ol();break}return Qc}function PRe(n,t){for(;Ol()&&n+Gs!==57;)if(n+Gs===84&&zh()===47)break;return"/*"+UR(t,Qc-1)+"*"+sN(n===47?n:Ol())}function ORe(n){for(;!oR(zh());)Ol();return UR(n,Qc)}function kRe(n){return qQ(jO("",null,null,null,[""],n=KQ(n),0,[0],n))}function jO(n,t,s,a,l,d,p,E,v){for(var T=0,w=0,A=p,N=0,F=0,j=0,B=1,G=1,J=1,K=0,ne="",de=l,oe=d,_e=a,Z=ne;G;)switch(j=K,K=Ol()){case 40:if(j!=108&&Zo(Z,A-1)==58){_U(Z+=Kr(FO(K),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:Z+=FO(K);break;case 9:case 10:case 13:case 32:Z+=IRe(j);break;case 92:Z+=ARe(VO()-1,7);continue;case 47:switch(zh()){case 42:case 47:nO(NRe(PRe(Ol(),VO()),t,s),v);break;default:Z+="/"}break;case 123*B:E[T++]=Dh(Z)*J;case 125*B:case 59:case 0:switch(K){case 0:case 125:G=0;case 59+w:J==-1&&(Z=Kr(Z,/\f/g,"")),F>0&&Dh(Z)-A&&nO(F>32?oK(Z+";",a,s,A-1):oK(Kr(Z," ","")+";",a,s,A-2),v);break;case 59:Z+=";";default:if(nO(_e=sK(Z,t,s,T,w,l,E,ne,de=[],oe=[],A),d),K===123)if(w===0)jO(Z,t,_e,_e,de,d,A,E,oe);else switch(N===99&&Zo(Z,3)===110?100:N){case 100:case 108:case 109:case 115:jO(n,_e,_e,a&&nO(sK(n,_e,_e,0,0,l,E,ne,l,de=[],A),oe),l,oe,A,E,a?de:oe);break;default:jO(Z,_e,_e,_e,[""],oe,0,E,oe)}}T=w=F=0,B=J=1,ne=Z="",A=p;break;case 58:A=1+Dh(Z),F=j;default:if(B<1){if(K==123)--B;else if(K==125&&B++==0&&CRe()==125)continue}switch(Z+=sN(K),K*B){case 38:J=w>0?1:(Z+="\f",-1);break;case 44:E[T++]=(Dh(Z)-1)*J,J=1;break;case 64:zh()===45&&(Z+=FO(Ol())),N=zh(),w=A=Dh(ne=Z+=ORe(VO())),K++;break;case 45:j===45&&Dh(Z)==2&&(B=0)}}return d}function sK(n,t,s,a,l,d,p,E,v,T,w){for(var A=l-1,N=l===0?d:[""],F=QV(N),j=0,B=0,G=0;j<a;++j)for(var J=0,K=sR(n,A+1,A=vRe(B=p[j])),ne=n;J<F;++J)(ne=HQ(B>0?N[J]+" "+K:Kr(K,/&\f/g,N[J])))&&(v[G++]=ne);return aN(n,t,s,l===0?XV:E,v,T,w)}function NRe(n,t,s){return aN(n,t,s,zQ,sN(RRe()),sR(n,2,-2),0)}function oK(n,t,s,a){return aN(n,t,s,JV,sR(n,0,a),sR(n,a+1,-1),a)}function FS(n,t){for(var s="",a=QV(n),l=0;l<a;l++)s+=t(n[l],l,n,t)||"";return s}function DRe(n,t,s,a){switch(n.type){case yRe:if(n.children.length)break;case ERe:case JV:return n.return=n.return||n.value;case zQ:return"";case GQ:return n.return=n.value+"{"+FS(n.children,a)+"}";case XV:n.value=n.props.join(",")}return Dh(s=FS(n.children,a))?n.return=n.value+"{"+s+"}":""}function LRe(n){var t=QV(n);return function(s,a,l,d){for(var p="",E=0;E<t;E++)p+=n[E](s,a,l,d)||"";return p}}function xRe(n){return function(t){t.root||(t=t.return)&&n(t)}}var aK=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function YQ(n){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=n(s)),t[s]}}var MRe=function(t,s,a){for(var l=0,d=0;l=d,d=zh(),l===38&&d===12&&(s[a]=1),!oR(d);)Ol();return UR(t,Qc)},URe=function(t,s){var a=-1,l=44;do switch(oR(l)){case 0:l===38&&zh()===12&&(s[a]=1),t[a]+=MRe(Qc-1,s,a);break;case 2:t[a]+=FO(l);break;case 4:if(l===44){t[++a]=zh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=sN(l)}while(l=Ol());return t},VRe=function(t,s){return qQ(URe(KQ(t),s))},cK=new WeakMap,FRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!cK.get(a))&&!l){cK.set(t,!0);for(var d=[],p=VRe(s,d),E=a.props,v=0,T=0;v<p.length;v++)for(var w=0;w<E.length;w++,T++)t.props[T]=d[v]?p[v].replace(/&\f/g,E[w]):E[w]+" "+p[v]}}},jRe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function XQ(n,t){switch(TRe(n,t)){case 5103:return $r+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return $r+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return $r+n+fk+n+Ia+n+n;case 6828:case 4268:return $r+n+Ia+n+n;case 6165:return $r+n+Ia+"flex-"+n+n;case 5187:return $r+n+Kr(n,/(\w+).+(:[^]+)/,$r+"box-$1$2"+Ia+"flex-$1$2")+n;case 5443:return $r+n+Ia+"flex-item-"+Kr(n,/flex-|-self/,"")+n;case 4675:return $r+n+Ia+"flex-line-pack"+Kr(n,/align-content|flex-|-self/,"")+n;case 5548:return $r+n+Ia+Kr(n,"shrink","negative")+n;case 5292:return $r+n+Ia+Kr(n,"basis","preferred-size")+n;case 6060:return $r+"box-"+Kr(n,"-grow","")+$r+n+Ia+Kr(n,"grow","positive")+n;case 4554:return $r+Kr(n,/([^-])(transform)/g,"$1"+$r+"$2")+n;case 6187:return Kr(Kr(Kr(n,/(zoom-|grab)/,$r+"$1"),/(image-set)/,$r+"$1"),n,"")+n;case 5495:case 3959:return Kr(n,/(image-set\([^]*)/,$r+"$1$`$1");case 4968:return Kr(Kr(n,/(.+:)(flex-)?(.*)/,$r+"box-pack:$3"+Ia+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+$r+n+n;case 4095:case 3583:case 4068:case 2532:return Kr(n,/(.+)-inline(.+)/,$r+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Dh(n)-1-t>6)switch(Zo(n,t+1)){case 109:if(Zo(n,t+4)!==45)break;case 102:return Kr(n,/(.+:)(.+)-([^]+)/,"$1"+$r+"$2-$3$1"+fk+(Zo(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~_U(n,"stretch")?XQ(Kr(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(Zo(n,t+1)!==115)break;case 6444:switch(Zo(n,Dh(n)-3-(~_U(n,"!important")&&10))){case 107:return Kr(n,":",":"+$r)+n;case 101:return Kr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+$r+(Zo(n,14)===45?"inline-":"")+"box$3$1"+$r+"$2$3$1"+Ia+"$2box$3")+n}break;case 5936:switch(Zo(n,t+11)){case 114:return $r+n+Ia+Kr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return $r+n+Ia+Kr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return $r+n+Ia+Kr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return $r+n+Ia+n+n}return n}var BRe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case JV:t.return=XQ(t.value,t.length);break;case GQ:return FS([ew(t,{value:Kr(t.value,"@","@"+$r)})],l);case XV:if(t.length)return wRe(t.props,function(d){switch(bRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return FS([ew(t,{props:[Kr(d,/:(read-\w+)/,":"+fk+"$1")]})],l);case"::placeholder":return FS([ew(t,{props:[Kr(d,/:(plac\w+)/,":"+$r+"input-$1")]}),ew(t,{props:[Kr(d,/:(plac\w+)/,":"+fk+"$1")]}),ew(t,{props:[Kr(d,/:(plac\w+)/,Ia+"input-$1")]})],l)}return""})}},WRe=[BRe],zRe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var G=B.getAttribute("data-emotion");G.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=t.stylisPlugins||WRe,d={},p,E=[];p=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(B){for(var G=B.getAttribute("data-emotion").split(" "),J=1;J<G.length;J++)d[G[J]]=!0;E.push(B)});var v,T=[FRe,jRe];{var w,A=[DRe,xRe(function(B){w.insert(B)})],N=LRe(T.concat(l,A)),F=function(G){return FS(kRe(G),N)};v=function(G,J,K,ne){w=K,F(G?G+"{"+J.styles+"}":J.styles),ne&&(j.inserted[J.name]=!0)}}var j={key:s,sheet:new _Re({key:s,container:p,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function SE(){return SE=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},SE.apply(null,arguments)}var s2={exports:{}},ei={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lK;function GRe(){if(lK)return ei;lK=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,s=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,E=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,T=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,F=n?Symbol.for("react.memo"):60115,j=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,G=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(oe){if(typeof oe=="object"&&oe!==null){var _e=oe.$$typeof;switch(_e){case t:switch(oe=oe.type,oe){case v:case T:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case E:case w:case j:case F:case p:return oe;default:return _e}}case s:return _e}}}function de(oe){return ne(oe)===T}return ei.AsyncMode=v,ei.ConcurrentMode=T,ei.ContextConsumer=E,ei.ContextProvider=p,ei.Element=t,ei.ForwardRef=w,ei.Fragment=a,ei.Lazy=j,ei.Memo=F,ei.Portal=s,ei.Profiler=d,ei.StrictMode=l,ei.Suspense=A,ei.isAsyncMode=function(oe){return de(oe)||ne(oe)===v},ei.isConcurrentMode=de,ei.isContextConsumer=function(oe){return ne(oe)===E},ei.isContextProvider=function(oe){return ne(oe)===p},ei.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===t},ei.isForwardRef=function(oe){return ne(oe)===w},ei.isFragment=function(oe){return ne(oe)===a},ei.isLazy=function(oe){return ne(oe)===j},ei.isMemo=function(oe){return ne(oe)===F},ei.isPortal=function(oe){return ne(oe)===s},ei.isProfiler=function(oe){return ne(oe)===d},ei.isStrictMode=function(oe){return ne(oe)===l},ei.isSuspense=function(oe){return ne(oe)===A},ei.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===T||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===j||oe.$$typeof===F||oe.$$typeof===p||oe.$$typeof===E||oe.$$typeof===w||oe.$$typeof===G||oe.$$typeof===J||oe.$$typeof===K||oe.$$typeof===B)},ei.typeOf=ne,ei}var uK;function HRe(){return uK||(uK=1,s2.exports=GRe()),s2.exports}var o2,dK;function $Re(){if(dK)return o2;dK=1;var n=HRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function p(j){return n.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function F(j,B,G){if(typeof B!="string"){if(N){var J=A(B);J&&J!==N&&F(j,J,G)}var K=v(B);T&&(K=K.concat(T(B)));for(var ne=p(j),de=p(B),oe=0;oe<K.length;++oe){var _e=K[oe];if(!s[_e]&&!(G&&G[_e])&&!(de&&de[_e])&&!(ne&&ne[_e])){var Z=w(B,_e);try{E(j,_e,Z)}catch{}}}}return j}return o2=F,o2}$Re();var KRe=!0;function JQ(n,t,s){var a="";return s.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var ZV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||KRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},eF=function(t,s,a){ZV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function qRe(n){for(var t=0,s,a=0,l=n.length;l>=4;++a,l-=4)s=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var YRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},XRe=/[A-Z]|^ms/g,JRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,QQ=function(t){return t.charCodeAt(1)===45},hK=function(t){return t!=null&&typeof t!="boolean"},a2=YQ(function(n){return QQ(n)?n:n.replace(XRe,"-$&").toLowerCase()}),fK=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(JRe,function(a,l,d){return Lh={name:l,styles:d,next:Lh},l})}return YRe[t]!==1&&!QQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function aR(n,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Lh={name:l.name,styles:l.styles,next:Lh},l.name;var d=s;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)Lh={name:p.name,styles:p.styles,next:Lh},p=p.next;var E=d.styles+";";return E}return QRe(n,t,s)}case"function":{if(n!==void 0){var v=Lh,T=s(n);return Lh=v,aR(n,t,T)}break}}var w=s;if(t==null)return w;var A=t[w];return A!==void 0?A:w}function QRe(n,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=aR(n,t,s[l])+";";else for(var d in s){var p=s[d];if(typeof p!="object"){var E=p;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":hK(E)&&(a+=a2(d)+":"+fK(d,E)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(t==null||t[p[0]]===void 0))for(var v=0;v<p.length;v++)hK(p[v])&&(a+=a2(d)+":"+fK(d,p[v])+";");else{var T=aR(n,t,p);switch(d){case"animation":case"animationName":{a+=a2(d)+":"+T+";";break}default:a+=d+"{"+T+"}"}}}return a}var pK=/label:\s*([^\s;{]+)\s*(;|$)/g,Lh;function cN(n,t,s){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Lh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=aR(s,t,d);else{var p=d;l+=p[0]}for(var E=1;E<n.length;E++)if(l+=aR(s,t,n[E]),a){var v=d;l+=v[E]}pK.lastIndex=0;for(var T="",w;(w=pK.exec(l))!==null;)T+="-"+w[1];var A=qRe(l)+T;return{name:A,styles:l,next:Lh}}var ZRe=function(t){return t()},ZQ=A$.useInsertionEffect?A$.useInsertionEffect:!1,eZ=ZQ||ZRe,mK=ZQ||L.useLayoutEffect,tF=L.createContext(typeof HTMLElement<"u"?zRe({key:"css"}):null);tF.Provider;var eCe=function(){return L.useContext(tF)},nF=function(t){return L.forwardRef(function(s,a){var l=L.useContext(tF);return t(s,l,a)})},QS=L.createContext({}),tCe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return SE({},t,s)},nCe=aK(function(n){return aK(function(t){return tCe(n,t)})}),rCe=function(t){var s=L.useContext(QS);return t.theme!==s&&(s=nCe(s)(t.theme)),L.createElement(QS.Provider,{value:s},t.children)},rF={}.hasOwnProperty,yU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",iCe=function(t,s){var a={};for(var l in s)rF.call(s,l)&&(a[l]=s[l]);return a[yU]=t,a},sCe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return ZV(s,a,l),eZ(function(){return eF(s,a,l)}),null},oCe=nF(function(n,t,s){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[yU],d=[a],p="";typeof n.className=="string"?p=JQ(t.registered,d,n.className):n.className!=null&&(p=n.className+" ");var E=cN(d,void 0,L.useContext(QS));p+=t.key+"-"+E.name;var v={};for(var T in n)rF.call(n,T)&&T!=="css"&&T!==yU&&(v[T]=n[T]);return v.className=p,s&&(v.ref=s),L.createElement(L.Fragment,null,L.createElement(sCe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),L.createElement(l,v))}),aCe=oCe,gK=function(t,s){var a=arguments;if(s==null||!rF.call(s,"css"))return L.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=aCe,d[1]=iCe(t,s);for(var p=2;p<l;p++)d[p]=a[p];return L.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(gK||(gK={}));var lN=nF(function(n,t){var s=n.styles,a=cN([s],void 0,L.useContext(QS)),l=L.useRef();return mK(function(){var d=t.key+"-global",p=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(p.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),p.hydrate([v])),l.current=[p,E],function(){p.flush()}},[t]),mK(function(){var d=l.current,p=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&eF(t,a.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}t.insert("",a,p,!1)},[t,a.name]),null});function cCe(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return cN(t)}function VR(){var n=cCe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const iF=L.createContext({});iF.displayName="ColorModeContext";function uN(){const n=L.useContext(iF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function lCe(n,t){const{colorMode:s}=uN();return s==="dark"?t:n}const rO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function uCe(n={}){const{preventTransition:t=!0,nonce:s}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?rO.dark:rO.light),document.body.classList.remove(l?rO.light:rO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),p=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const dCe="chakra-ui-color-mode";function hCe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(n)||t}catch{}return s||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const fCe=hCe(dCe),_K=()=>{},pCe=L_e()?L.useLayoutEffect:L.useEffect;function EK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const tZ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:E=fCe}=t,v=eCe(),T=d==="dark"?"dark":"light",[w,A]=L.useState(()=>EK(E,T)),[N,F]=L.useState(()=>EK(E)),{getSystemTheme:j,setClassName:B,setDataset:G,addListener:J}=L.useMemo(()=>uCe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),K=d==="system"&&!w?N:w,ne=L.useCallback(_e=>{const Z=_e==="system"?j():_e;A(Z),B(Z==="dark"),G(Z),E.set(Z)},[E,j,B,G]);pCe(()=>{d==="system"&&F(j())},[]),L.useEffect(()=>{const _e=E.get();if(_e){ne(_e);return}if(d==="system"){ne("system");return}ne(T)},[E,T,d,ne]);const de=L.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);L.useEffect(()=>{if(l)return J(ne)},[l,J,ne]);const oe=L.useMemo(()=>({colorMode:s??K,toggleColorMode:s?_K:de,setColorMode:s?_K:ne,forced:s!==void 0}),[K,de,ne,s]);return I.jsx(iF.Provider,{value:oe,children:a})};tZ.displayName="ColorModeProvider";const nZ=String.raw,rZ=nZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,mCe=()=>I.jsx(lN,{styles:rZ}),gCe=({scope:n=""})=>I.jsx(lN,{styles:nZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${rZ}
    `});function _Ce(n){const{cssVarsRoot:t,theme:s,children:a}=n,l=L.useMemo(()=>rve(s),[s]);return I.jsxs(rCe,{theme:l,children:[I.jsx(ECe,{root:t}),a]})}function ECe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return I.jsx(lN,{styles:s=>({[t]:s.__cssVars})})}Gi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function yCe(){const{colorMode:n}=uN();return I.jsx(lN,{styles:t=>{const s=dQ(t,"styles.global"),a=qc(s,{theme:t,colorMode:n});return a?AQ(a)(t):void 0}})}const[vCe,SCe]=Gi({strict:!1,name:"PortalManagerContext"});function sF(n){const{children:t,zIndex:s}=n;return I.jsx(vCe,{value:{zIndex:s},children:t})}sF.displayName="PortalManager";const iZ=L.createContext({getDocument(){return document},getWindow(){return window}});iZ.displayName="EnvironmentContext";function sZ(n){const{children:t,environment:s,disabled:a}=n,l=L.useRef(null),d=L.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),p=!a||!s;return I.jsxs(iZ.Provider,{value:d,children:[t,p&&I.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}sZ.displayName="EnvironmentProvider";const TCe=n=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:p={},environment:E,cssVarsRoot:v,disableEnvironment:T,disableGlobalStyle:w}=n,A=I.jsx(sZ,{environment:E,disabled:T,children:t});return I.jsx(_Ce,{theme:p,cssVarsRoot:v,children:I.jsxs(tZ,{colorModeManager:s,options:p.config,children:[d?I.jsx(gCe,{scope:l}):I.jsx(mCe,{}),!w&&I.jsx(yCe,{}),a?I.jsx(sF,{zIndex:a,children:A}):A]})})},oF=L.createContext({});function aF(n){const t=L.useRef(null);return t.current===null&&(t.current=n()),t.current}const FR=L.createContext(null),cF=L.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class bCe extends L.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function wCe({children:n,isPresent:t}){const s=L.useId(),a=L.useRef(null),l=L.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=L.useContext(cF);return L.useInsertionEffect(()=>{const{width:p,height:E,top:v,left:T}=l.current;if(t||!a.current||!p||!E)return;a.current.dataset.motionPopId=s;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${T}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[t]),I.jsx(bCe,{isPresent:t,childRef:a,sizeRef:l,children:L.cloneElement(n,{ref:a})})}const RCe=({children:n,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p})=>{const E=aF(CCe),v=L.useId(),T=L.useCallback(A=>{E.set(A,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),w=L.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:T,register:A=>(E.set(A,!1),()=>E.delete(A))}),d?[Math.random(),T]:[s,T]);return L.useMemo(()=>{E.forEach((A,N)=>E.set(N,!1))},[s]),L.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),p==="popLayout"&&(n=I.jsx(wCe,{isPresent:s,children:n})),I.jsx(FR.Provider,{value:w,children:n})};function CCe(){return new Map}function lF(n=!0){const t=L.useContext(FR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=L.useId();L.useEffect(()=>{n&&l(d)},[n]);const p=L.useCallback(()=>n&&a&&a(d),[d,a,n]);return!s&&a?[!1,p]:[!0]}function ICe(){return ACe(L.useContext(FR))}function ACe(n){return n===null?!0:n.isPresent}const iO=n=>n.key||"";function yK(n){const t=[];return L.Children.forEach(n,s=>{L.isValidElement(s)&&t.push(s)}),t}const uF=typeof window<"u",oZ=uF?L.useLayoutEffect:L.useEffect,S0=({children:n,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[E,v]=lF(p),T=L.useMemo(()=>yK(n),[n]),w=p&&!E?[]:T.map(iO),A=L.useRef(!0),N=L.useRef(T),F=aF(()=>new Map),[j,B]=L.useState(T),[G,J]=L.useState(T);oZ(()=>{A.current=!1,N.current=T;for(let de=0;de<G.length;de++){const oe=iO(G[de]);w.includes(oe)?F.delete(oe):F.get(oe)!==!0&&F.set(oe,!1)}},[G,w.length,w.join("-")]);const K=[];if(T!==j){let de=[...T];for(let oe=0;oe<G.length;oe++){const _e=G[oe],Z=iO(_e);w.includes(Z)||(de.splice(oe,0,_e),K.push(_e))}d==="wait"&&K.length&&(de=K),J(yK(de)),B(T);return}const{forceRender:ne}=L.useContext(oF);return I.jsx(I.Fragment,{children:G.map(de=>{const oe=iO(de),_e=p&&!E?!1:T===G||w.includes(oe),Z=()=>{if(F.has(oe))F.set(oe,!0);else return;let ee=!0;F.forEach(te=>{te||(ee=!1)}),ee&&(ne==null||ne(),J(N.current),p&&(v==null||v()),a&&a())};return I.jsx(RCe,{isPresent:_e,initial:!A.current||s?void 0:!1,custom:_e?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:_e?void 0:Z,children:de},oe)})})},kl=n=>n;let aZ=kl;function dF(n){let t;return()=>(t===void 0&&(t=n()),t)}const ZS=(n,t,s)=>{const a=t-n;return a===0?1:(s-n)/a},Ep=n=>n*1e3,yp=n=>n/1e3,PCe={useManualTiming:!1};function OCe(n){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function E(T){d.has(T)&&(v.schedule(T),n()),T(p)}const v={schedule:(T,w=!1,A=!1)=>{const F=A&&a?t:s;return w&&d.add(T),F.has(T)||F.add(T),T},cancel:T=>{s.delete(T),d.delete(T)},process:T=>{if(p=T,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(T))}};return v}const sO=["read","resolveKeyframes","update","preRender","render","postRender"],kCe=40;function cZ(n,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,p=sO.reduce((J,K)=>(J[K]=OCe(d),J),{}),{read:E,resolveKeyframes:v,update:T,preRender:w,render:A,postRender:N}=p,F=()=>{const J=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(J-l.timestamp,kCe),1),l.timestamp=J,l.isProcessing=!0,E.process(l),v.process(l),T.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,n(F))},j=()=>{s=!0,a=!0,l.isProcessing||n(F)};return{schedule:sO.reduce((J,K)=>{const ne=p[K];return J[K]=(de,oe=!1,_e=!1)=>(s||j(),ne.schedule(de,oe,_e)),J},{}),cancel:J=>{for(let K=0;K<sO.length;K++)p[sO[K]].cancel(J)},state:l,steps:p}}const{schedule:Wi,cancel:fg,state:Jo,steps:c2}=cZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:kl,!0),lZ=L.createContext({strict:!1}),vK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},e0={};for(const n in vK)e0[n]={isEnabled:t=>vK[n].some(s=>!!t[s])};function NCe(n){for(const t in n)e0[t]={...e0[t],...n[t]}}const DCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function pk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||DCe.has(n)}let uZ=n=>!pk(n);function LCe(n){n&&(uZ=t=>t.startsWith("on")?!pk(t):n(t))}try{LCe(require("@emotion/is-prop-valid").default)}catch{}function xCe(n,t,s){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(uZ(l)||s===!0&&pk(l)||!t&&!pk(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function MCe(n){if(typeof Proxy>"u")return n;const t=new Map,s=(...a)=>n(...a);return new Proxy(s,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const dN=L.createContext({});function cR(n){return typeof n=="string"||Array.isArray(n)}function hN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const hF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],fF=["initial",...hF];function fN(n){return hN(n.animate)||fF.some(t=>cR(n[t]))}function dZ(n){return!!(fN(n)||n.variants)}function UCe(n,t){if(fN(n)){const{initial:s,animate:a}=n;return{initial:s===!1||cR(s)?s:void 0,animate:cR(a)?a:void 0}}return n.inherit!==!1?t:{}}function VCe(n){const{initial:t,animate:s}=UCe(n,L.useContext(dN));return L.useMemo(()=>({initial:t,animate:s}),[SK(t),SK(s)])}function SK(n){return Array.isArray(n)?n.join(" "):n}const FCe=Symbol.for("motionComponentSymbol");function RS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function jCe(n,t,s){return L.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):RS(s)&&(s.current=a))},[t])}const pF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),BCe="framerAppearId",hZ="data-"+pF(BCe),{schedule:mF}=cZ(queueMicrotask,!1),fZ=L.createContext({});function WCe(n,t,s,a,l){var d,p;const{visualElement:E}=L.useContext(dN),v=L.useContext(lZ),T=L.useContext(FR),w=L.useContext(cF).reducedMotion,A=L.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:t,parent:E,props:s,presenceContext:T,blockInitialAnimation:T?T.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,F=L.useContext(fZ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&zCe(A.current,s,l,F);const j=L.useRef(!1);L.useInsertionEffect(()=>{N&&j.current&&N.update(s,T)});const B=s[hZ],G=L.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return oZ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),mF.render(N.render),G.current&&N.animationState&&N.animationState.animateChanges())}),L.useEffect(()=>{N&&(!G.current&&N.animationState&&N.animationState.animateChanges(),G.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,B)}),G.current=!1))}),N}function zCe(n,t,s,a){const{layoutId:l,layout:d,drag:p,dragConstraints:E,layoutScroll:v,layoutRoot:T}=t;n.projection=new s(n.latestValues,t["data-framer-portal-id"]?void 0:pZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||E&&RS(E),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:T})}function pZ(n){if(n)return n.options.allowProjection!==!1?n.projection:pZ(n.parent)}function GCe({preloadedFeatures:n,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,p;n&&NCe(n);function E(T,w){let A;const N={...L.useContext(cF),...T,layoutId:HCe(T)},{isStatic:F}=N,j=VCe(T),B=a(T,F);if(!F&&uF){$Ce();const G=KCe(N);A=G.MeasureLayout,j.visualElement=WCe(l,B,N,t,G.ProjectionNode)}return I.jsxs(dN.Provider,{value:j,children:[A&&j.visualElement?I.jsx(A,{visualElement:j.visualElement,...N}):null,s(l,T,jCe(B,j.visualElement,w),B,F,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const v=L.forwardRef(E);return v[FCe]=l,v}function HCe({layoutId:n}){const t=L.useContext(oF).id;return t&&n!==void 0?t+"-"+n:n}function $Ce(n,t){L.useContext(lZ).strict}function KCe(n){const{drag:t,layout:s}=e0;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(n)||s!=null&&s.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const qCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function gF(n){return typeof n!="string"||n.includes("-")?!1:!!(qCe.indexOf(n)>-1||/[A-Z]/u.test(n))}function TK(n){const t=[{},{}];return n==null||n.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function _F(n,t,s,a){if(typeof t=="function"){const[l,d]=TK(a);t=t(s!==void 0?s:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=TK(a);t=t(s!==void 0?s:n.custom,l,d)}return t}const vU=n=>Array.isArray(n),YCe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),XCe=n=>vU(n)?n[n.length-1]||0:n,Na=n=>!!(n&&n.getVelocity);function BO(n){const t=Na(n)?n.get():n;return YCe(t)?t.toValue():t}function JCe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:s},a,l,d){const p={latestValues:QCe(a,l,d,n),renderState:t()};return s&&(p.onMount=E=>s({props:a,current:E,...p}),p.onUpdate=E=>s(E)),p}const mZ=n=>(t,s)=>{const a=L.useContext(dN),l=L.useContext(FR),d=()=>JCe(n,t,a,l);return s?d():aF(d)};function QCe(n,t,s,a){const l={},d=a(n,{});for(const N in d)l[N]=BO(d[N]);let{initial:p,animate:E}=n;const v=fN(n),T=dZ(n);t&&T&&!v&&n.inherit!==!1&&(p===void 0&&(p=t.initial),E===void 0&&(E=t.animate));let w=s?s.initial===!1:!1;w=w||p===!1;const A=w?E:p;if(A&&typeof A!="boolean"&&!hN(A)){const N=Array.isArray(A)?A:[A];for(let F=0;F<N.length;F++){const j=_F(n,N[F]);if(j){const{transitionEnd:B,transition:G,...J}=j;for(const K in J){let ne=J[K];if(Array.isArray(ne)){const de=w?ne.length-1:0;ne=ne[de]}ne!==null&&(l[K]=ne)}for(const K in B)l[K]=B[K]}}}return l}const T0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],xE=new Set(T0),gZ=n=>t=>typeof t=="string"&&t.startsWith(n),_Z=gZ("--"),ZCe=gZ("var(--"),EF=n=>ZCe(n)?eIe.test(n.split("/*")[0].trim()):!1,eIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,EZ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Rp=(n,t,s)=>s>t?t:s<n?n:s,b0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},lR={...b0,transform:n=>Rp(0,1,n)},oO={...b0,default:1},jR=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),Hm=jR("deg"),Gh=jR("%"),Dn=jR("px"),tIe=jR("vh"),nIe=jR("vw"),bK={...Gh,parse:n=>Gh.parse(n)/100,transform:n=>Gh.transform(n*100)},rIe={borderWidth:Dn,borderTopWidth:Dn,borderRightWidth:Dn,borderBottomWidth:Dn,borderLeftWidth:Dn,borderRadius:Dn,radius:Dn,borderTopLeftRadius:Dn,borderTopRightRadius:Dn,borderBottomRightRadius:Dn,borderBottomLeftRadius:Dn,width:Dn,maxWidth:Dn,height:Dn,maxHeight:Dn,top:Dn,right:Dn,bottom:Dn,left:Dn,padding:Dn,paddingTop:Dn,paddingRight:Dn,paddingBottom:Dn,paddingLeft:Dn,margin:Dn,marginTop:Dn,marginRight:Dn,marginBottom:Dn,marginLeft:Dn,backgroundPositionX:Dn,backgroundPositionY:Dn},iIe={rotate:Hm,rotateX:Hm,rotateY:Hm,rotateZ:Hm,scale:oO,scaleX:oO,scaleY:oO,scaleZ:oO,skew:Hm,skewX:Hm,skewY:Hm,distance:Dn,translateX:Dn,translateY:Dn,translateZ:Dn,x:Dn,y:Dn,z:Dn,perspective:Dn,transformPerspective:Dn,opacity:lR,originX:bK,originY:bK,originZ:Dn},wK={...b0,transform:Math.round},yF={...rIe,...iIe,zIndex:wK,size:Dn,fillOpacity:lR,strokeOpacity:lR,numOctaves:wK},sIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},oIe=T0.length;function aIe(n,t,s){let a="",l=!0;for(let d=0;d<oIe;d++){const p=T0[d],E=n[p];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(p.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const T=EZ(E,yF[p]);if(!v){l=!1;const w=sIe[p]||p;a+=`${w}(${T}) `}s&&(t[p]=T)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function vF(n,t,s){const{style:a,vars:l,transformOrigin:d}=n;let p=!1,E=!1;for(const v in t){const T=t[v];if(xE.has(v)){p=!0;continue}else if(_Z(v)){l[v]=T;continue}else{const w=EZ(T,yF[v]);v.startsWith("origin")?(E=!0,d[v]=w):a[v]=w}}if(t.transform||(p||s?a.transform=aIe(t,n.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:T="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${T} ${w}`}}const cIe={offset:"stroke-dashoffset",array:"stroke-dasharray"},lIe={offset:"strokeDashoffset",array:"strokeDasharray"};function uIe(n,t,s=1,a=0,l=!0){n.pathLength=1;const d=l?cIe:lIe;n[d.offset]=Dn.transform(-a);const p=Dn.transform(t),E=Dn.transform(s);n[d.array]=`${p} ${E}`}function RK(n,t,s){return typeof n=="string"?n:Dn.transform(t+s*n)}function dIe(n,t,s){const a=RK(t,n.x,n.width),l=RK(s,n.y,n.height);return`${a} ${l}`}function SF(n,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:p,pathSpacing:E=1,pathOffset:v=0,...T},w,A){if(vF(n,T,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:F,dimensions:j}=n;N.transform&&(j&&(F.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=dIe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),p!==void 0&&uIe(N,p,E,v,!1)}const TF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),yZ=()=>({...TF(),attrs:{}}),bF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function vZ(n,{style:t,vars:s},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in s)n.style.setProperty(d,s[d])}const SZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function TZ(n,t,s,a){vZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(SZ.has(l)?l:pF(l),t.attrs[l])}const mk={};function hIe(n){Object.assign(mk,n)}function bZ(n,{layout:t,layoutId:s}){return xE.has(n)||n.startsWith("origin")||(t||s!==void 0)&&(!!mk[n]||n==="opacity")}function wF(n,t,s){var a;const{style:l}=n,d={};for(const p in l)(Na(l[p])||t.style&&Na(t.style[p])||bZ(p,n)||((a=s==null?void 0:s.getValue(p))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function wZ(n,t,s){const a=wF(n,t,s);for(const l in n)if(Na(n[l])||Na(t[l])){const d=T0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function fIe(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const CK=["x","y","width","height","cx","cy","r"],pIe={useVisualState:mZ({scrapeMotionValuesFromProps:wZ,createRenderState:yZ,onUpdate:({props:n,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!n.drag;if(!d){for(const E in l)if(xE.has(E)){d=!0;break}}if(!d)return;let p=!t;if(t)for(let E=0;E<CK.length;E++){const v=CK[E];n[v]!==t[v]&&(p=!0)}p&&Wi.read(()=>{fIe(s,a),Wi.render(()=>{SF(a,l,bF(s.tagName),n.transformTemplate),TZ(s,a)})})}})},mIe={useVisualState:mZ({scrapeMotionValuesFromProps:wF,createRenderState:TF})};function RZ(n,t,s){for(const a in t)!Na(t[a])&&!bZ(a,s)&&(n[a]=t[a])}function gIe({transformTemplate:n},t){return L.useMemo(()=>{const s=TF();return vF(s,t,n),Object.assign({},s.vars,s.style)},[t])}function _Ie(n,t){const s=n.style||{},a={};return RZ(a,s,n),Object.assign(a,gIe(n,t)),a}function EIe(n,t){const s={},a=_Ie(n,t);return n.drag&&n.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(s.tabIndex=0),s.style=a,s}function yIe(n,t,s,a){const l=L.useMemo(()=>{const d=yZ();return SF(d,t,bF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};RZ(d,n.style,n),l.style={...d,...l.style}}return l}function vIe(n=!1){return(s,a,l,{latestValues:d},p)=>{const v=(gF(s)?yIe:EIe)(a,d,p,s),T=xCe(a,typeof s=="string",n),w=s!==L.Fragment?{...T,...v,ref:l}:{},{children:A}=a,N=L.useMemo(()=>Na(A)?A.get():A,[A]);return L.createElement(s,{...w,children:N})}}function SIe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...gF(a)?pIe:mIe,preloadedFeatures:n,useRender:vIe(l),createVisualElement:t,Component:a};return GCe(p)}}function CZ(n,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==n.length)return!1;for(let a=0;a<s;a++)if(t[a]!==n[a])return!1;return!0}function pN(n,t,s){const a=n.getProps();return _F(a,t,s!==void 0?s:a.custom,n)}const TIe=dF(()=>window.ScrollTimeline!==void 0);class bIe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(TIe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class wIe extends bIe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function RF(n,t){return n?n[t]||n.default||n:void 0}const SU=2e4;function IZ(n){let t=0;const s=50;let a=n.next(t);for(;!a.done&&t<SU;)t+=s,a=n.next(t);return t>=SU?1/0:t}function CF(n){return typeof n=="function"}function IK(n,t){n.timeline=t,n.onfinish=null}const IF=n=>Array.isArray(n)&&typeof n[0]=="number",RIe={linearEasing:void 0};function CIe(n,t){const s=dF(n);return()=>{var a;return(a=RIe[t])!==null&&a!==void 0?a:s()}}const gk=CIe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),AZ=(n,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=n(ZS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function PZ(n){return!!(typeof n=="function"&&gk()||!n||typeof n=="string"&&(n in TU||gk())||IF(n)||Array.isArray(n)&&n.every(PZ))}const ww=([n,t,s,a])=>`cubic-bezier(${n}, ${t}, ${s}, ${a})`,TU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ww([0,.65,.55,1]),circOut:ww([.55,0,1,.45]),backIn:ww([.31,.01,.66,-.59]),backOut:ww([.33,1.53,.69,.99])};function OZ(n,t){if(n)return typeof n=="function"&&gk()?AZ(n,t):IF(n)?ww(n):Array.isArray(n)?n.map(s=>OZ(s,t)||TU.easeOut):TU[n]}const Td={x:!1,y:!1};function kZ(){return Td.x||Td.y}function IIe(n,t,s){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function NZ(n,t){const s=IIe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function AK(n){return t=>{t.pointerType==="touch"||kZ()||n(t)}}function AIe(n,t,s={}){const[a,l,d]=NZ(n,s),p=AK(E=>{const{target:v}=E,T=t(E);if(typeof T!="function"||!v)return;const w=AK(A=>{T(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(E=>{E.addEventListener("pointerenter",p,l)}),d}const DZ=(n,t)=>t?n===t?!0:DZ(n,t.parentElement):!1,AF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,PIe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function OIe(n){return PIe.has(n.tagName)||n.tabIndex!==-1}const Rw=new WeakSet;function PK(n){return t=>{t.key==="Enter"&&n(t)}}function l2(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const kIe=(n,t)=>{const s=n.currentTarget;if(!s)return;const a=PK(()=>{if(Rw.has(s))return;l2(s,"down");const l=PK(()=>{l2(s,"up")}),d=()=>l2(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function OK(n){return AF(n)&&!kZ()}function NIe(n,t,s={}){const[a,l,d]=NZ(n,s),p=E=>{const v=E.currentTarget;if(!OK(E)||Rw.has(v))return;Rw.add(v);const T=t(E),w=(F,j)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!OK(F)||!Rw.has(v))&&(Rw.delete(v),typeof T=="function"&&T(F,{success:j}))},A=F=>{w(F,s.useGlobalTarget||DZ(v,F.target))},N=F=>{w(F,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!OIe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",p,l),E.addEventListener("focus",T=>kIe(T,l),l)}),d}function DIe(n){return n==="x"||n==="y"?Td[n]?null:(Td[n]=!0,()=>{Td[n]=!1}):Td.x||Td.y?null:(Td.x=Td.y=!0,()=>{Td.x=Td.y=!1})}const LZ=new Set(["width","height","top","left","right","bottom",...T0]);let WO;function LIe(){WO=void 0}const Hh={now:()=>(WO===void 0&&Hh.set(Jo.isProcessing||PCe.useManualTiming?Jo.timestamp:performance.now()),WO),set:n=>{WO=n,queueMicrotask(LIe)}};function PF(n,t){n.indexOf(t)===-1&&n.push(t)}function OF(n,t){const s=n.indexOf(t);s>-1&&n.splice(s,1)}class kF{constructor(){this.subscriptions=[]}add(t){return PF(this.subscriptions,t),()=>OF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function xZ(n,t){return t?n*(1e3/t):0}const kK=30,xIe=n=>!isNaN(parseFloat(n));class MIe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Hh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Hh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=xIe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new kF);const a=this.events[t].add(s);return t==="change"?()=>{a(),Wi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Hh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>kK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,kK);return xZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function uR(n,t){return new MIe(n,t)}function UIe(n,t,s){n.hasValue(t)?n.getValue(t).set(s):n.addValue(t,uR(s))}function VIe(n,t){const s=pN(n,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const p in d){const E=XCe(d[p]);UIe(n,p,E)}}function FIe(n){return!!(Na(n)&&n.add)}function bU(n,t){const s=n.getValue("willChange");if(FIe(s))return s.add(t)}function MZ(n){return n.props[hZ]}const UZ=(n,t,s)=>(((1-3*s+3*t)*n+(3*s-6*t))*n+3*t)*n,jIe=1e-7,BIe=12;function WIe(n,t,s,a,l){let d,p,E=0;do p=t+(s-t)/2,d=UZ(p,a,l)-n,d>0?s=p:t=p;while(Math.abs(d)>jIe&&++E<BIe);return p}function BR(n,t,s,a){if(n===t&&s===a)return kl;const l=d=>WIe(d,0,1,n,s);return d=>d===0||d===1?d:UZ(l(d),t,a)}const VZ=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,FZ=n=>t=>1-n(1-t),jZ=BR(.33,1.53,.69,.99),NF=FZ(jZ),BZ=VZ(NF),WZ=n=>(n*=2)<1?.5*NF(n):.5*(2-Math.pow(2,-10*(n-1))),DF=n=>1-Math.sin(Math.acos(n)),zZ=FZ(DF),GZ=VZ(DF),HZ=n=>/^0[^.\s]+$/u.test(n);function zIe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||HZ(n):!0}const Ww=n=>Math.round(n*1e5)/1e5,LF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function GIe(n){return n==null}const HIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,xF=(n,t)=>s=>!!(typeof s=="string"&&HIe.test(s)&&s.startsWith(n)||t&&!GIe(s)&&Object.prototype.hasOwnProperty.call(s,t)),$Z=(n,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,p,E]=a.match(LF);return{[n]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(p),alpha:E!==void 0?parseFloat(E):1}},$Ie=n=>Rp(0,255,n),u2={...b0,transform:n=>Math.round($Ie(n))},cE={test:xF("rgb","red"),parse:$Z("red","green","blue"),transform:({red:n,green:t,blue:s,alpha:a=1})=>"rgba("+u2.transform(n)+", "+u2.transform(t)+", "+u2.transform(s)+", "+Ww(lR.transform(a))+")"};function KIe(n){let t="",s="",a="",l="";return n.length>5?(t=n.substring(1,3),s=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),s=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const wU={test:xF("#"),parse:KIe,transform:cE.transform},CS={test:xF("hsl","hue"),parse:$Z("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(n)+", "+Gh.transform(Ww(t))+", "+Gh.transform(Ww(s))+", "+Ww(lR.transform(a))+")"},Aa={test:n=>cE.test(n)||wU.test(n)||CS.test(n),parse:n=>cE.test(n)?cE.parse(n):CS.test(n)?CS.parse(n):wU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?cE.transform(n):CS.transform(n)},qIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function YIe(n){var t,s;return isNaN(n)&&typeof n=="string"&&(((t=n.match(LF))===null||t===void 0?void 0:t.length)||0)+(((s=n.match(qIe))===null||s===void 0?void 0:s.length)||0)>0}const KZ="number",qZ="color",XIe="var",JIe="var(",NK="${}",QIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function dR(n){const t=n.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(QIe,v=>(Aa.test(v)?(a.color.push(d),l.push(qZ),s.push(Aa.parse(v))):v.startsWith(JIe)?(a.var.push(d),l.push(XIe),s.push(v)):(a.number.push(d),l.push(KZ),s.push(parseFloat(v))),++d,NK)).split(NK);return{values:s,split:E,indexes:a,types:l}}function YZ(n){return dR(n).values}function XZ(n){const{split:t,types:s}=dR(n),a=t.length;return l=>{let d="";for(let p=0;p<a;p++)if(d+=t[p],l[p]!==void 0){const E=s[p];E===KZ?d+=Ww(l[p]):E===qZ?d+=Aa.transform(l[p]):d+=l[p]}return d}}const ZIe=n=>typeof n=="number"?0:n;function eAe(n){const t=YZ(n);return XZ(n)(t.map(ZIe))}const pg={test:YIe,parse:YZ,createTransformer:XZ,getAnimatableNone:eAe},tAe=new Set(["brightness","contrast","saturate","opacity"]);function nAe(n){const[t,s]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=s.match(LF)||[];if(!a)return n;const l=s.replace(a,"");let d=tAe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const rAe=/\b([a-z-]*)\(.*?\)/gu,RU={...pg,getAnimatableNone:n=>{const t=n.match(rAe);return t?t.map(nAe).join(" "):n}},iAe={...yF,color:Aa,backgroundColor:Aa,outlineColor:Aa,fill:Aa,stroke:Aa,borderColor:Aa,borderTopColor:Aa,borderRightColor:Aa,borderBottomColor:Aa,borderLeftColor:Aa,filter:RU,WebkitFilter:RU},MF=n=>iAe[n];function JZ(n,t){let s=MF(n);return s!==RU&&(s=pg),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const sAe=new Set(["auto","none","0"]);function oAe(n,t,s){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!sAe.has(d)&&dR(d).values.length&&(l=n[a]),a++}if(l&&s)for(const d of t)n[d]=JZ(s,l)}const DK=n=>n===b0||n===Dn,LK=(n,t)=>parseFloat(n.split(", ")[t]),xK=(n,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return LK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?LK(d[1],n):0}},aAe=new Set(["x","y","z"]),cAe=T0.filter(n=>!aAe.has(n));function lAe(n){const t=[];return cAe.forEach(s=>{const a=n.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const t0={width:({x:n},{paddingLeft:t="0",paddingRight:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),height:({y:n},{paddingTop:t="0",paddingBottom:s="0"})=>n.max-n.min-parseFloat(t)-parseFloat(s),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:xK(4,13),y:xK(5,14)};t0.translateX=t0.x;t0.translateY=t0.y;const pE=new Set;let CU=!1,IU=!1;function QZ(){if(IU){const n=Array.from(pE).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=lAe(a);l.length&&(s.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,p])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(p)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}IU=!1,CU=!1,pE.forEach(n=>n.complete()),pE.clear()}function ZZ(){pE.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(IU=!0)})}function uAe(){ZZ(),QZ()}class UF{constructor(t,s,a,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(pE.add(this),CU||(CU=!0,Wi.read(ZZ),Wi.resolveKeyframes(QZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const p=l==null?void 0:l.get(),E=t[t.length-1];if(p!==void 0)t[0]=p;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&p===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),pE.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,pE.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const eee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),dAe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function hAe(n){const t=dAe.exec(n);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function tee(n,t,s=1){const[a,l]=hAe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const p=d.trim();return eee(p)?parseFloat(p):p}return EF(l)?tee(l,t,s+1):l}const nee=n=>t=>t.test(n),fAe={test:n=>n==="auto",parse:n=>n},ree=[b0,Dn,Gh,Hm,nIe,tIe,fAe],MK=n=>ree.find(nee(n));class iee extends UF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let T=t[v];if(typeof T=="string"&&(T=T.trim(),EF(T))){const w=tee(T,s.current);w!==void 0&&(t[v]=w),v===t.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!LZ.has(a)||t.length!==2)return;const[l,d]=t,p=MK(l),E=MK(d);if(p!==E)if(DK(p)&&DK(E))for(let v=0;v<t.length;v++){const T=t[v];typeof T=="string"&&(t[v]=parseFloat(T))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)zIe(t[l])&&a.push(l);a.length&&oAe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=t0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,E=l[p];l[p]=t0[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,T])=>{s.getValue(v).set(T)}),this.resolveNoneKeyframes()}}const UK=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(pg.test(n)||n==="0")&&!n.startsWith("url("));function pAe(n){const t=n[0];if(n.length===1)return!0;for(let s=0;s<n.length;s++)if(n[s]!==t)return!0}function mAe(n,t,s,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],p=UK(l,t),E=UK(d,t);return!p||!E?!1:pAe(n)||(s==="spring"||CF(s))&&a}const gAe=n=>n!==null;function mN(n,{repeat:t,repeatType:s="loop"},a){const l=n.filter(gAe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const _Ae=40;class see{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Hh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:p,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>_Ae?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&uAe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Hh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:p,onComplete:E,onUpdate:v,isGenerator:T}=this.options;if(!T&&!mAe(t,a,l,d))if(p)this.options.duration=0;else{v&&v(mN(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const w=this.initPlayback(t,s);w!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...w},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ss=(n,t,s)=>n+(t-n)*s;function d2(n,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?n+(t-n)*6*s:s<1/2?t:s<2/3?n+(t-n)*(2/3-s)*6:n}function EAe({hue:n,saturation:t,lightness:s,alpha:a}){n/=360,t/=100,s/=100;let l=0,d=0,p=0;if(!t)l=d=p=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=d2(v,E,n+1/3),d=d2(v,E,n),p=d2(v,E,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:a}}function _k(n,t){return s=>s>0?t:n}const h2=(n,t,s)=>{const a=n*n,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},yAe=[wU,cE,CS],vAe=n=>yAe.find(t=>t.test(n));function VK(n){const t=vAe(n);if(!t)return!1;let s=t.parse(n);return t===CS&&(s=EAe(s)),s}const FK=(n,t)=>{const s=VK(n),a=VK(t);if(!s||!a)return _k(n,t);const l={...s};return d=>(l.red=h2(s.red,a.red,d),l.green=h2(s.green,a.green,d),l.blue=h2(s.blue,a.blue,d),l.alpha=ss(s.alpha,a.alpha,d),cE.transform(l))},SAe=(n,t)=>s=>t(n(s)),WR=(...n)=>n.reduce(SAe),AU=new Set(["none","hidden"]);function TAe(n,t){return AU.has(n)?s=>s<=0?n:t:s=>s>=1?t:n}function bAe(n,t){return s=>ss(n,t,s)}function VF(n){return typeof n=="number"?bAe:typeof n=="string"?EF(n)?_k:Aa.test(n)?FK:CAe:Array.isArray(n)?oee:typeof n=="object"?Aa.test(n)?FK:wAe:_k}function oee(n,t){const s=[...n],a=s.length,l=n.map((d,p)=>VF(d)(d,t[p]));return d=>{for(let p=0;p<a;p++)s[p]=l[p](d);return s}}function wAe(n,t){const s={...n,...t},a={};for(const l in s)n[l]!==void 0&&t[l]!==void 0&&(a[l]=VF(n[l])(n[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function RAe(n,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const p=t.types[d],E=n.indexes[p][l[p]],v=(s=n.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[p]++}return a}const CAe=(n,t)=>{const s=pg.createTransformer(t),a=dR(n),l=dR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?AU.has(n)&&!l.values.length||AU.has(t)&&!a.values.length?TAe(n,t):WR(oee(RAe(a,l),l.values),s):_k(n,t)};function aee(n,t,s){return typeof n=="number"&&typeof t=="number"&&typeof s=="number"?ss(n,t,s):VF(n)(n,t)}const IAe=5;function cee(n,t,s){const a=Math.max(t-IAe,0);return xZ(s-n(a),t-a)}const Ts={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},jK=.001;function AAe({duration:n=Ts.duration,bounce:t=Ts.bounce,velocity:s=Ts.velocity,mass:a=Ts.mass}){let l,d,p=1-t;p=Rp(Ts.minDamping,Ts.maxDamping,p),n=Rp(Ts.minDuration,Ts.maxDuration,yp(n)),p<1?(l=T=>{const w=T*p,A=w*n,N=w-s,F=PU(T,p),j=Math.exp(-A);return jK-N/F*j},d=T=>{const A=T*p*n,N=A*s+s,F=Math.pow(p,2)*Math.pow(T,2)*n,j=Math.exp(-A),B=PU(Math.pow(T,2),p);return(-l(T)+jK>0?-1:1)*((N-F)*j)/B}):(l=T=>{const w=Math.exp(-T*n),A=(T-s)*n+1;return-.001+w*A},d=T=>{const w=Math.exp(-T*n),A=(s-T)*(n*n);return w*A});const E=5/n,v=OAe(l,d,E);if(n=Ep(n),isNaN(v))return{stiffness:Ts.stiffness,damping:Ts.damping,duration:n};{const T=Math.pow(v,2)*a;return{stiffness:T,damping:p*2*Math.sqrt(a*T),duration:n}}}const PAe=12;function OAe(n,t,s){let a=s;for(let l=1;l<PAe;l++)a=a-n(a)/t(a);return a}function PU(n,t){return n*Math.sqrt(1-t*t)}const kAe=["duration","bounce"],NAe=["stiffness","damping","mass"];function BK(n,t){return t.some(s=>n[s]!==void 0)}function DAe(n){let t={velocity:Ts.velocity,stiffness:Ts.stiffness,damping:Ts.damping,mass:Ts.mass,isResolvedFromDuration:!1,...n};if(!BK(n,NAe)&&BK(n,kAe))if(n.visualDuration){const s=n.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*Rp(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:Ts.mass,stiffness:l,damping:d}}else{const s=AAe(n);t={...t,...s,mass:Ts.mass},t.isResolvedFromDuration=!0}return t}function lee(n=Ts.visualDuration,t=Ts.bounce){const s=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],p=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:T,mass:w,duration:A,velocity:N,isResolvedFromDuration:F}=DAe({...s,velocity:-yp(s.velocity||0)}),j=N||0,B=T/(2*Math.sqrt(v*w)),G=p-d,J=yp(Math.sqrt(v/w)),K=Math.abs(G)<5;a||(a=K?Ts.restSpeed.granular:Ts.restSpeed.default),l||(l=K?Ts.restDelta.granular:Ts.restDelta.default);let ne;if(B<1){const oe=PU(J,B);ne=_e=>{const Z=Math.exp(-B*J*_e);return p-Z*((j+B*J*G)/oe*Math.sin(oe*_e)+G*Math.cos(oe*_e))}}else if(B===1)ne=oe=>p-Math.exp(-J*oe)*(G+(j+J*G)*oe);else{const oe=J*Math.sqrt(B*B-1);ne=_e=>{const Z=Math.exp(-B*J*_e),ee=Math.min(oe*_e,300);return p-Z*((j+B*J*G)*Math.sinh(ee)+oe*G*Math.cosh(ee))/oe}}const de={calculatedDuration:F&&A||null,next:oe=>{const _e=ne(oe);if(F)E.done=oe>=A;else{let Z=0;B<1&&(Z=oe===0?Ep(j):cee(ne,oe,_e));const ee=Math.abs(Z)<=a,te=Math.abs(p-_e)<=l;E.done=ee&&te}return E.value=E.done?p:_e,E},toString:()=>{const oe=Math.min(IZ(de),SU),_e=AZ(Z=>de.next(oe*Z).value,oe,30);return oe+"ms "+_e}};return de}function WK({keyframes:n,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:E,max:v,restDelta:T=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},F=ee=>E!==void 0&&ee<E||v!==void 0&&ee>v,j=ee=>E===void 0?v:v===void 0||Math.abs(E-ee)<Math.abs(v-ee)?E:v;let B=s*t;const G=A+B,J=p===void 0?G:p(G);J!==G&&(B=J-A);const K=ee=>-B*Math.exp(-ee/a),ne=ee=>J+K(ee),de=ee=>{const te=K(ee),ce=ne(ee);N.done=Math.abs(te)<=T,N.value=N.done?J:ce};let oe,_e;const Z=ee=>{F(N.value)&&(oe=ee,_e=lee({keyframes:[N.value,j(N.value)],velocity:cee(ne,ee,N.value),damping:l,stiffness:d,restDelta:T,restSpeed:w}))};return Z(0),{calculatedDuration:null,next:ee=>{let te=!1;return!_e&&oe===void 0&&(te=!0,de(ee),Z(ee)),oe!==void 0&&ee>=oe?_e.next(ee-oe):(!te&&de(ee),N)}}}const LAe=BR(.42,0,1,1),xAe=BR(0,0,.58,1),uee=BR(.42,0,.58,1),MAe=n=>Array.isArray(n)&&typeof n[0]!="number",UAe={linear:kl,easeIn:LAe,easeInOut:uee,easeOut:xAe,circIn:DF,circInOut:GZ,circOut:zZ,backIn:NF,backInOut:BZ,backOut:jZ,anticipate:WZ},zK=n=>{if(IF(n)){aZ(n.length===4);const[t,s,a,l]=n;return BR(t,s,a,l)}else if(typeof n=="string")return UAe[n];return n};function VAe(n,t,s){const a=[],l=s||aee,d=n.length-1;for(let p=0;p<d;p++){let E=l(n[p],n[p+1]);if(t){const v=Array.isArray(t)?t[p]||kl:t;E=WR(v,E)}a.push(E)}return a}function FAe(n,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=n.length;if(aZ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const E=VAe(t,a,l),v=E.length,T=w=>{if(p&&w<n[0])return t[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=ZS(n[A],n[A+1],w);return E[A](N)};return s?w=>T(Rp(n[0],n[d-1],w)):T}function jAe(n,t){const s=n[n.length-1];for(let a=1;a<=t;a++){const l=ZS(0,t,a);n.push(ss(s,1,l))}}function BAe(n){const t=[0];return jAe(t,n.length-1),t}function WAe(n,t){return n.map(s=>s*t)}function zAe(n,t){return n.map(()=>t||uee).splice(0,n.length-1)}function Ek({duration:n=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=MAe(a)?a.map(zK):zK(a),d={done:!1,value:t[0]},p=WAe(s&&s.length===t.length?s:BAe(t),n),E=FAe(p,t,{ease:Array.isArray(l)?l:zAe(t,l)});return{calculatedDuration:n,next:v=>(d.value=E(v),d.done=v>=n,d)}}const GAe=n=>{const t=({timestamp:s})=>n(s);return{start:()=>Wi.update(t,!0),stop:()=>fg(t),now:()=>Jo.isProcessing?Jo.timestamp:Hh.now()}},HAe={decay:WK,inertia:WK,tween:Ek,keyframes:Ek,spring:lee},$Ae=n=>n/100;class FF extends see{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||UF,E=(v,T)=>this.onKeyframesResolved(v,T);this.resolver=new p(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,E=CF(s)?s:HAe[s]||Ek;let v,T;E!==Ek&&typeof t[0]!="number"&&(v=WR($Ae,aee(t[0],t[1])),t=[0,100]);const w=E({...this.options,keyframes:t});d==="mirror"&&(T=E({...this.options,keyframes:[...t].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=IZ(w));const{calculatedDuration:A}=w,N=A+l,F=N*(a+1)-l;return{generator:w,mirroredGenerator:T,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:ee}=this.options;return{done:!0,value:ee[ee.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:T,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:j,repeatDelay:B,onUpdate:G}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-w/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const J=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?J<0:J>w;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let ne=this.currentTime,de=d;if(F){const ee=Math.min(this.currentTime,w)/A;let te=Math.floor(ee),ce=ee%1;!ce&&ee>=1&&(ce=1),ce===1&&te--,te=Math.min(te,F+1),!!(te%2)&&(j==="reverse"?(ce=1-ce,B&&(ce-=B/A)):j==="mirror"&&(de=p)),ne=Rp(0,1,ce)*A}const oe=K?{done:!1,value:v[0]}:de.next(ne);E&&(oe.value=E(oe.value));let{done:_e}=oe;!K&&T!==null&&(_e=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_e);return Z&&l!==void 0&&(oe.value=mN(v,this.options,l)),G&&G(oe.value),Z&&this.finish(),oe}get duration(){const{resolved:t}=this;return t?yp(t.calculatedDuration):0}get time(){return yp(this.currentTime)}set time(t){t=Ep(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=yp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=GAe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const KAe=new Set(["opacity","clipPath","filter","transform"]);function qAe(n,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:E="easeInOut",times:v}={}){const T={[t]:s};v&&(T.offset=v);const w=OZ(E,l);return Array.isArray(w)&&(T.easing=w),n.animate(T,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const YAe=dF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yk=10,XAe=2e4;function JAe(n){return CF(n.type)||n.type==="spring"||!PZ(n.ease)}function QAe(n,t){const s=new FF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<XAe;)a=s.sample(d),l.push(a.value),d+=yk;return{times:void 0,keyframes:l,duration:d-yk,ease:"linear"}}const dee={anticipate:WZ,backInOut:BZ,circInOut:GZ};function ZAe(n){return n in dee}class GK extends see{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new iee(d,(p,E)=>this.onKeyframesResolved(p,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:p,motionValue:E,name:v,startTime:T}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&gk()&&ZAe(d)&&(d=dee[d]),JAe(this.options)){const{onComplete:A,onUpdate:N,motionValue:F,element:j,...B}=this.options,G=QAe(t,B);t=G.keyframes,t.length===1&&(t[1]=t[0]),a=G.duration,l=G.times,d=G.ease,p="keyframes"}const w=qAe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return w.startTime=T??this.calcStartTime(),this.pendingTimeline?(IK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;E.set(mN(t,this.options,s)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:p,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return yp(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return yp(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=Ep(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return kl;const{animation:a}=s;IK(a,t)}return kl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:p,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:T,onUpdate:w,onComplete:A,element:N,...F}=this.options,j=new FF({...F,keyframes:a,duration:l,type:d,ease:p,times:E,isGenerator:!0}),B=Ep(this.time);T.setWithVelocity(j.sample(B-yk).value,j.sample(B).value,yk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:p,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:T}=s.owner.getProps();return YAe()&&a&&KAe.has(a)&&!v&&!T&&!l&&d!=="mirror"&&p!==0&&E!=="inertia"}}const ePe={type:"spring",stiffness:500,damping:25,restSpeed:10},tPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),nPe={type:"keyframes",duration:.8},rPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},iPe=(n,{keyframes:t})=>t.length>2?nPe:xE.has(n)?n.startsWith("scale")?tPe(t[1]):ePe:rPe;function sPe({when:n,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:E,from:v,elapsed:T,...w}){return!!Object.keys(w).length}const jF=(n,t,s,a={},l,d)=>p=>{const E=RF(a,n)||{},v=E.delay||a.delay||0;let{elapsed:T=0}=a;T=T-Ep(v);let w={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-T,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{p(),E.onComplete&&E.onComplete()},name:n,motionValue:t,element:d?void 0:l};sPe(E)||(w={...w,...iPe(n,w)}),w.duration&&(w.duration=Ep(w.duration)),w.repeatDelay&&(w.repeatDelay=Ep(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&t.get()!==void 0){const N=mN(w.keyframes,E);if(N!==void 0)return Wi.update(()=>{w.onUpdate(N),w.onComplete()}),new wIe([])}return!d&&GK.supports(w)?new GK(w):new FF(w)};function oPe({protectedKeys:n,needsAnimating:t},s){const a=n.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function hee(n,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(p=a);const T=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),F=v[A];if(F===void 0||w&&oPe(w,A))continue;const j={delay:s,...RF(p||{},A)};let B=!1;if(window.MotionHandoffAnimation){const J=MZ(n);if(J){const K=window.MotionHandoffAnimation(J,A,Wi);K!==null&&(j.startTime=K,B=!0)}}bU(n,A),N.start(jF(A,N,F,n.shouldReduceMotion&&LZ.has(A)?{type:!1}:j,n,B));const G=N.animation;G&&T.push(G)}return E&&Promise.all(T).then(()=>{Wi.update(()=>{E&&VIe(n,E)})}),T}function OU(n,t,s={}){var a;const l=pN(n,t,s.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const p=l?()=>Promise.all(hee(n,l,s)):()=>Promise.resolve(),E=n.variantChildren&&n.variantChildren.size?(T=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return aPe(n,t,w+T,A,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[T,w]=v==="beforeChildren"?[p,E]:[E,p];return T().then(()=>w())}else return Promise.all([p(),E(s.delay)])}function aPe(n,t,s=0,a=0,l=1,d){const p=[],E=(n.variantChildren.size-1)*a,v=l===1?(T=0)=>T*a:(T=0)=>E-T*a;return Array.from(n.variantChildren).sort(cPe).forEach((T,w)=>{T.notify("AnimationStart",t),p.push(OU(T,t,{...d,delay:s+v(w)}).then(()=>T.notify("AnimationComplete",t)))}),Promise.all(p)}function cPe(n,t){return n.sortNodePosition(t)}function lPe(n,t,s={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>OU(n,d,s));a=Promise.all(l)}else if(typeof t=="string")a=OU(n,t,s);else{const l=typeof t=="function"?pN(n,t,s.custom):t;a=Promise.all(hee(n,l,s))}return a.then(()=>{n.notify("AnimationComplete",t)})}const uPe=fF.length;function fee(n){if(!n)return;if(!n.isControllingVariants){const s=n.parent?fee(n.parent)||{}:{};return n.props.initial!==void 0&&(s.initial=n.props.initial),s}const t={};for(let s=0;s<uPe;s++){const a=fF[s],l=n.props[a];(cR(l)||l===!1)&&(t[a]=l)}return t}const dPe=[...hF].reverse(),hPe=hF.length;function fPe(n){return t=>Promise.all(t.map(({animation:s,options:a})=>lPe(n,s,a)))}function pPe(n){let t=fPe(n),s=HK(),a=!0;const l=v=>(T,w)=>{var A;const N=pN(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:F,transitionEnd:j,...B}=N;T={...T,...B,...j}}return T};function d(v){t=v(n)}function p(v){const{props:T}=n,w=fee(n.parent)||{},A=[],N=new Set;let F={},j=1/0;for(let G=0;G<hPe;G++){const J=dPe[G],K=s[J],ne=T[J]!==void 0?T[J]:w[J],de=cR(ne),oe=J===v?K.isActive:null;oe===!1&&(j=G);let _e=ne===w[J]&&ne!==T[J]&&de;if(_e&&a&&n.manuallyAnimateOnMount&&(_e=!1),K.protectedKeys={...F},!K.isActive&&oe===null||!ne&&!K.prevProp||hN(ne)||typeof ne=="boolean")continue;const Z=mPe(K.prevProp,ne);let ee=Z||J===v&&K.isActive&&!_e&&de||G>j&&de,te=!1;const ce=Array.isArray(ne)?ne:[ne];let me=ce.reduce(l(J),{});oe===!1&&(me={});const{prevResolvedValues:he={}}=K,se={...he,...me},Se=ke=>{ee=!0,N.has(ke)&&(te=!0,N.delete(ke)),K.needsAnimating[ke]=!0;const Me=n.getValue(ke);Me&&(Me.liveStyle=!1)};for(const ke in se){const Me=me[ke],Ce=he[ke];if(F.hasOwnProperty(ke))continue;let Xe=!1;vU(Me)&&vU(Ce)?Xe=!CZ(Me,Ce):Xe=Me!==Ce,Xe?Me!=null?Se(ke):N.add(ke):Me!==void 0&&N.has(ke)?Se(ke):K.protectedKeys[ke]=!0}K.prevProp=ne,K.prevResolvedValues=me,K.isActive&&(F={...F,...me}),a&&n.blockInitialAnimation&&(ee=!1),ee&&(!(_e&&Z)||te)&&A.push(...ce.map(ke=>({animation:ke,options:{type:J}})))}if(N.size){const G={};N.forEach(J=>{const K=n.getBaseTarget(J),ne=n.getValue(J);ne&&(ne.liveStyle=!0),G[J]=K??null}),A.push({animation:G})}let B=!!A.length;return a&&(T.initial===!1||T.initial===T.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?t(A):Promise.resolve()}function E(v,T){var w;if(s[v].isActive===T)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,T)}),s[v].isActive=T;const A=p(v);for(const N in s)s[N].protectedKeys={};return A}return{animateChanges:p,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=HK(),a=!0}}}function mPe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!CZ(t,n):!1}function Q_(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function HK(){return{animate:Q_(!0),whileInView:Q_(),whileHover:Q_(),whileTap:Q_(),whileDrag:Q_(),whileFocus:Q_(),exit:Q_()}}class bg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class gPe extends bg{constructor(t){super(t),t.animationState||(t.animationState=pPe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();hN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let _Pe=0;class EPe extends bg{constructor(){super(...arguments),this.id=_Pe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const yPe={animation:{Feature:gPe},exit:{Feature:EPe}};function hR(n,t,s,a={passive:!0}){return n.addEventListener(t,s,a),()=>n.removeEventListener(t,s)}function zR(n){return{point:{x:n.pageX,y:n.pageY}}}const vPe=n=>t=>AF(t)&&n(t,zR(t));function zw(n,t,s,a){return hR(n,t,vPe(s),a)}const $K=(n,t)=>Math.abs(n-t);function SPe(n,t){const s=$K(n.x,t.x),a=$K(n.y,t.y);return Math.sqrt(s**2+a**2)}class pee{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=p2(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=SPe(A.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:j}=A,{timestamp:B}=Jo;this.history.push({...j,timestamp:B});const{onStart:G,onMove:J}=this.handlers;N||(G&&G(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=f2(N,this.transformPagePoint),Wi.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:F,onSessionEnd:j,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const G=p2(A.type==="pointercancel"?this.lastMoveEventInfo:f2(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(A,G),j&&j(A,G)},!AF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const p=zR(t),E=f2(p,this.transformPagePoint),{point:v}=E,{timestamp:T}=Jo;this.history=[{...v,timestamp:T}];const{onSessionStart:w}=s;w&&w(t,p2(E,this.history)),this.removeListeners=WR(zw(this.contextWindow,"pointermove",this.handlePointerMove),zw(this.contextWindow,"pointerup",this.handlePointerUp),zw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),fg(this.updatePoint)}}function f2(n,t){return t?{point:t(n.point)}:n}function KK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function p2({point:n},t){return{point:n,delta:KK(n,mee(t)),offset:KK(n,TPe(t)),velocity:bPe(t,.1)}}function TPe(n){return n[0]}function mee(n){return n[n.length-1]}function bPe(n,t){if(n.length<2)return{x:0,y:0};let s=n.length-1,a=null;const l=mee(n);for(;s>=0&&(a=n[s],!(l.timestamp-a.timestamp>Ep(t)));)s--;if(!a)return{x:0,y:0};const d=yp(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const gee=1e-4,wPe=1-gee,RPe=1+gee,_ee=.01,CPe=0-_ee,IPe=0+_ee;function Nl(n){return n.max-n.min}function APe(n,t,s){return Math.abs(n-t)<=s}function qK(n,t,s,a=.5){n.origin=a,n.originPoint=ss(t.min,t.max,n.origin),n.scale=Nl(s)/Nl(t),n.translate=ss(s.min,s.max,n.origin)-n.originPoint,(n.scale>=wPe&&n.scale<=RPe||isNaN(n.scale))&&(n.scale=1),(n.translate>=CPe&&n.translate<=IPe||isNaN(n.translate))&&(n.translate=0)}function Gw(n,t,s,a){qK(n.x,t.x,s.x,a?a.originX:void 0),qK(n.y,t.y,s.y,a?a.originY:void 0)}function YK(n,t,s){n.min=s.min+t.min,n.max=n.min+Nl(t)}function PPe(n,t,s){YK(n.x,t.x,s.x),YK(n.y,t.y,s.y)}function XK(n,t,s){n.min=t.min-s.min,n.max=n.min+Nl(t)}function Hw(n,t,s){XK(n.x,t.x,s.x),XK(n.y,t.y,s.y)}function OPe(n,{min:t,max:s},a){return t!==void 0&&n<t?n=a?ss(t,n,a.min):Math.max(n,t):s!==void 0&&n>s&&(n=a?ss(s,n,a.max):Math.min(n,s)),n}function JK(n,t,s){return{min:t!==void 0?n.min+t:void 0,max:s!==void 0?n.max+s-(n.max-n.min):void 0}}function kPe(n,{top:t,left:s,bottom:a,right:l}){return{x:JK(n.x,s,l),y:JK(n.y,t,a)}}function QK(n,t){let s=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([s,a]=[a,s]),{min:s,max:a}}function NPe(n,t){return{x:QK(n.x,t.x),y:QK(n.y,t.y)}}function DPe(n,t){let s=.5;const a=Nl(n),l=Nl(t);return l>a?s=ZS(t.min,t.max-a,n.min):a>l&&(s=ZS(n.min,n.max-l,t.min)),Rp(0,1,s)}function LPe(n,t){const s={};return t.min!==void 0&&(s.min=t.min-n.min),t.max!==void 0&&(s.max=t.max-n.min),s}const kU=.35;function xPe(n=kU){return n===!1?n=0:n===!0&&(n=kU),{x:ZK(n,"left","right"),y:ZK(n,"top","bottom")}}function ZK(n,t,s){return{min:eq(n,t),max:eq(n,s)}}function eq(n,t){return typeof n=="number"?n:n[t]||0}const tq=()=>({translate:0,scale:1,origin:0,originPoint:0}),IS=()=>({x:tq(),y:tq()}),nq=()=>({min:0,max:0}),ks=()=>({x:nq(),y:nq()});function Tu(n){return[n("x"),n("y")]}function Eee({top:n,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:n,max:a}}}function MPe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function UPe(n,t){if(!t)return n;const s=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function m2(n){return n===void 0||n===1}function NU({scale:n,scaleX:t,scaleY:s}){return!m2(n)||!m2(t)||!m2(s)}function eE(n){return NU(n)||yee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function yee(n){return rq(n.x)||rq(n.y)}function rq(n){return n&&n!=="0%"}function vk(n,t,s){const a=n-s,l=t*a;return s+l}function iq(n,t,s,a,l){return l!==void 0&&(n=vk(n,l,a)),vk(n,s,a)+t}function DU(n,t=0,s=1,a,l){n.min=iq(n.min,t,s,a,l),n.max=iq(n.max,t,s,a,l)}function vee(n,{x:t,y:s}){DU(n.x,t.translate,t.scale,t.originPoint),DU(n.y,s.translate,s.scale,s.originPoint)}const sq=.999999999999,oq=1.0000000000001;function VPe(n,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,p;for(let E=0;E<l;E++){d=s[E],p=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&PS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(t.x*=p.x.scale,t.y*=p.y.scale,vee(n,p)),a&&eE(d.latestValues)&&PS(n,d.latestValues))}t.x<oq&&t.x>sq&&(t.x=1),t.y<oq&&t.y>sq&&(t.y=1)}function AS(n,t){n.min=n.min+t,n.max=n.max+t}function aq(n,t,s,a,l=.5){const d=ss(n.min,n.max,l);DU(n,t,s,d,a)}function PS(n,t){aq(n.x,t.x,t.scaleX,t.scale,t.originX),aq(n.y,t.y,t.scaleY,t.scale,t.originY)}function See(n,t){return Eee(UPe(n.getBoundingClientRect(),t))}function FPe(n,t,s){const a=See(n,s),{scroll:l}=t;return l&&(AS(a.x,l.offset.x),AS(a.y,l.offset.y)),a}const Tee=({current:n})=>n?n.ownerDocument.defaultView:null,jPe=new WeakMap;class BPe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ks(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(zR(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:F,onDragStart:j}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=DIe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Tu(G=>{let J=this.getAxisMotionValue(G).get()||0;if(Gh.test(J)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[G];ne&&(J=Nl(ne)*(parseFloat(J)/100))}}this.originPoint[G]=J}),j&&Wi.postRender(()=>j(w,A)),bU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(w,A)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:j,onDrag:B}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:G}=A;if(F&&this.currentDirection===null){this.currentDirection=WPe(G),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",A.point,G),this.updateAxis("y",A.point,G),this.visualElement.render(),B&&B(w,A)},E=(w,A)=>this.stop(w,A),v=()=>Tu(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new pee(t,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,contextWindow:Tee(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Wi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!aO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let p=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(p=OPe(p,this.constraints[t],this.elastic[t])),d.set(p)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&RS(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=kPe(l.layoutBox,s):this.constraints=!1,this.elastic=xPe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Tu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=LPe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!RS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=FPe(a,l.root,this.visualElement.getTransformPagePoint());let p=NPe(l.layout.layoutBox,d);if(s){const E=s(MPe(p));this.hasMutatedConstraints=!!E,E&&(p=Eee(E))}return p}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},T=Tu(w=>{if(!aO(w,s,this.currentDirection))return;let A=v&&v[w]||{};p&&(A={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,j={type:"inertia",velocity:a?t[w]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,j)});return Promise.all(T).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return bU(this.visualElement,t),a.start(jF(t,a,0,s,this.visualElement,!1))}stopAnimation(){Tu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Tu(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Tu(s=>{const{drag:a}=this.getProps();if(!aO(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:p,max:E}=l.layout.layoutBox[s];d.set(t[s]-ss(p,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!RS(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Tu(p=>{const E=this.getAxisMotionValue(p);if(E&&this.constraints!==!1){const v=E.get();l[p]=DPe({min:v,max:v},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Tu(p=>{if(!aO(p,t,null))return;const E=this.getAxisMotionValue(p),{min:v,max:T}=this.constraints[p];E.set(ss(v,T,l[p]))})}addListeners(){if(!this.visualElement.current)return;jPe.set(this.visualElement,this);const t=this.visualElement.current,s=zw(t,"pointerdown",v=>{const{drag:T,dragListener:w=!0}=this.getProps();T&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();RS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Wi.read(a);const p=hR(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:T})=>{this.isDragging&&T&&(Tu(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{p(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=kU,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:E}}}function aO(n,t,s){return(t===!0||t===n)&&(s===null||s===n)}function WPe(n,t=10){let s=null;return Math.abs(n.y)>t?s="y":Math.abs(n.x)>t&&(s="x"),s}class zPe extends bg{constructor(t){super(t),this.removeGroupControls=kl,this.removeListeners=kl,this.controls=new BPe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||kl}unmount(){this.removeGroupControls(),this.removeListeners()}}const cq=n=>(t,s)=>{n&&Wi.postRender(()=>n(t,s))};class GPe extends bg{constructor(){super(...arguments),this.removePointerDownListener=kl}onPointerDown(t){this.session=new pee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Tee(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:cq(t),onStart:cq(s),onMove:a,onEnd:(d,p)=>{delete this.session,l&&Wi.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=zw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const zO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function lq(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const tw={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Dn.test(n))n=parseFloat(n);else return n;const s=lq(n,t.target.x),a=lq(n,t.target.y);return`${s}% ${a}%`}},HPe={correct:(n,{treeScale:t,projectionDelta:s})=>{const a=n,l=pg.parse(n);if(l.length>5)return a;const d=pg.createTransformer(n),p=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+p]/=E,l[1+p]/=v;const T=ss(E,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=T),typeof l[3+p]=="number"&&(l[3+p]/=T),d(l)}};class $Pe extends L.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;hIe(KPe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),zO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,p=a.projection;return p&&(p.isPresent=d,l||t.layoutDependency!==s||s===void 0?p.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?p.promote():p.relegate()||Wi.postRender(()=>{const E=p.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),mF.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function bee(n){const[t,s]=lF(),a=L.useContext(oF);return I.jsx($Pe,{...n,layoutGroup:a,switchLayoutGroup:L.useContext(fZ),isPresent:t,safeToRemove:s})}const KPe={borderRadius:{...tw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:tw,borderTopRightRadius:tw,borderBottomLeftRadius:tw,borderBottomRightRadius:tw,boxShadow:HPe};function qPe(n,t,s){const a=Na(n)?n:uR(n);return a.start(jF("",a,t,s)),a.animation}function YPe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const XPe=(n,t)=>n.depth-t.depth;class JPe{constructor(){this.children=[],this.isDirty=!1}add(t){PF(this.children,t),this.isDirty=!0}remove(t){OF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(XPe),this.isDirty=!1,this.children.forEach(t)}}function QPe(n,t){const s=Hh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(fg(a),n(d-t))};return Wi.read(a,!0),()=>fg(a)}const wee=["TopLeft","TopRight","BottomLeft","BottomRight"],ZPe=wee.length,uq=n=>typeof n=="string"?parseFloat(n):n,dq=n=>typeof n=="number"||Dn.test(n);function eOe(n,t,s,a,l,d){l?(n.opacity=ss(0,s.opacity!==void 0?s.opacity:1,tOe(a)),n.opacityExit=ss(t.opacity!==void 0?t.opacity:1,0,nOe(a))):d&&(n.opacity=ss(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let p=0;p<ZPe;p++){const E=`border${wee[p]}Radius`;let v=hq(t,E),T=hq(s,E);if(v===void 0&&T===void 0)continue;v||(v=0),T||(T=0),v===0||T===0||dq(v)===dq(T)?(n[E]=Math.max(ss(uq(v),uq(T),a),0),(Gh.test(T)||Gh.test(v))&&(n[E]+="%")):n[E]=T}(t.rotate||s.rotate)&&(n.rotate=ss(t.rotate||0,s.rotate||0,a))}function hq(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const tOe=Ree(0,.5,zZ),nOe=Ree(.5,.95,kl);function Ree(n,t,s){return a=>a<n?0:a>t?1:s(ZS(n,t,a))}function fq(n,t){n.min=t.min,n.max=t.max}function yu(n,t){fq(n.x,t.x),fq(n.y,t.y)}function pq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function mq(n,t,s,a,l){return n-=t,n=vk(n,1/s,a),l!==void 0&&(n=vk(n,1/l,a)),n}function rOe(n,t=0,s=1,a=.5,l,d=n,p=n){if(Gh.test(t)&&(t=parseFloat(t),t=ss(p.min,p.max,t/100)-p.min),typeof t!="number")return;let E=ss(d.min,d.max,a);n===d&&(E-=t),n.min=mq(n.min,t,s,E,l),n.max=mq(n.max,t,s,E,l)}function gq(n,t,[s,a,l],d,p){rOe(n,t[s],t[a],t[l],t.scale,d,p)}const iOe=["x","scaleX","originX"],sOe=["y","scaleY","originY"];function _q(n,t,s,a){gq(n.x,t,iOe,s?s.x:void 0,a?a.x:void 0),gq(n.y,t,sOe,s?s.y:void 0,a?a.y:void 0)}function Eq(n){return n.translate===0&&n.scale===1}function Cee(n){return Eq(n.x)&&Eq(n.y)}function yq(n,t){return n.min===t.min&&n.max===t.max}function oOe(n,t){return yq(n.x,t.x)&&yq(n.y,t.y)}function vq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function Iee(n,t){return vq(n.x,t.x)&&vq(n.y,t.y)}function Sq(n){return Nl(n.x)/Nl(n.y)}function Tq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class aOe{constructor(){this.members=[]}add(t){PF(this.members,t),t.scheduleRender()}remove(t){if(OF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cOe(n,t,s){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,p=(s==null?void 0:s.z)||0;if((l||d||p)&&(a=`translate3d(${l}px, ${d}px, ${p}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:T,rotate:w,rotateX:A,rotateY:N,skewX:F,skewY:j}=s;T&&(a=`perspective(${T}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=n.x.scale*t.x,v=n.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const tE={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Cw=typeof window<"u"&&window.MotionDebug!==void 0,g2=["","X","Y","Z"],lOe={visibility:"hidden"},bq=1e3;let uOe=0;function _2(n,t,s,a){const{latestValues:l}=t;l[n]&&(s[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function Aee(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const s=MZ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(s,"transform",Wi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&Aee(a)}function Pee({attachResizeListener:n,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},E=t==null?void 0:t()){this.id=uOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Cw&&(tE.totalNodes=tE.resolvedTargetDeltas=tE.recalculatedProjection=0),this.nodes.forEach(fOe),this.nodes.forEach(EOe),this.nodes.forEach(yOe),this.nodes.forEach(pOe),Cw&&window.MotionDebug.record(tE)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new JPe)}addEventListener(p,E){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new kF),this.eventHandlers.get(p).add(E)}notifyListeners(p,...E){const v=this.eventHandlers.get(p);v&&v.notify(...E)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=YPe(p),this.instance=p;const{layoutId:v,layout:T,visualElement:w}=this.options;if(w&&!w.current&&w.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(T||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=QPe(N,250),zO.hasAnimatedSinceResize&&(zO.hasAnimatedSinceResize=!1,this.nodes.forEach(Rq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||T)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||wOe,{onLayoutAnimationStart:G,onLayoutAnimationComplete:J}=w.getProps(),K=!this.targetLayout||!Iee(this.targetLayout,j)||F,ne=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,ne);const de={...RF(B,"layout"),onPlay:G,onComplete:J};(w.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de)}else N||Rq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,fg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(vOe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Aee(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(wq);return}this.isUpdating||this.nodes.forEach(gOe),this.isUpdating=!1,this.nodes.forEach(_Oe),this.nodes.forEach(dOe),this.nodes.forEach(hOe),this.clearAllSnapshots();const E=Hh.now();Jo.delta=Rp(0,1e3/60,E-Jo.timestamp),Jo.timestamp=E,Jo.isProcessing=!0,c2.update.process(Jo),c2.preRender.process(Jo),c2.render.process(Jo),Jo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,mF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(mOe),this.sharedNodes.forEach(SOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Wi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Wi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ks(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!Cee(this.projectionDelta),v=this.getTransformTemplate(),T=v?v(this.latestValues,""):void 0,w=T!==this.prevTransformTemplateValue;p&&(E||eE(this.latestValues)||w)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return p&&(v=this.removeTransform(v)),ROe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:E}=this.options;if(!E)return ks();const v=E.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(COe))){const{scroll:w}=this.root;w&&(AS(v.x,w.offset.x),AS(v.y,w.offset.y))}return v}removeElementScroll(p){var E;const v=ks();if(yu(v,p),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let T=0;T<this.path.length;T++){const w=this.path[T],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&yu(v,p),AS(v.x,A.offset.x),AS(v.y,A.offset.y))}return v}applyTransform(p,E=!1){const v=ks();yu(v,p);for(let T=0;T<this.path.length;T++){const w=this.path[T];!E&&w.options.layoutScroll&&w.scroll&&w!==w.root&&PS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),eE(w.latestValues)&&PS(v,w.latestValues)}return eE(this.latestValues)&&PS(v,this.latestValues),v}removeTransform(p){const E=ks();yu(E,p);for(let v=0;v<this.path.length;v++){const T=this.path[v];if(!T.instance||!eE(T.latestValues))continue;NU(T.latestValues)&&T.updateSnapshot();const w=ks(),A=T.measurePageBox();yu(w,A),_q(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,w)}return eE(this.latestValues)&&_q(E,this.latestValues),E}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Jo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const T=!!this.resumingFrom||this!==v;if(!(p||T&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=Jo.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ks(),this.relativeTargetOrigin=ks(),Hw(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ks(),this.targetWithTransforms=ks()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),PPe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):yu(this.target,this.layout.layoutBox),vee(this.target,this.targetDelta)):yu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ks(),this.relativeTargetOrigin=ks(),Hw(this.relativeTargetOrigin,this.target,F.target),yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Cw&&tE.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||NU(this.parent.latestValues)||yee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let T=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(T=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(T=!1),this.resolvedRelativeTargetAt===Jo.timestamp&&(T=!1),T)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;yu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;VPe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=ks());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(pq(this.prevProjectionDelta.x,this.projectionDelta.x),pq(this.prevProjectionDelta.y,this.projectionDelta.y)),Gw(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!Tq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Tq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),Cw&&tE.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=IS(),this.projectionDelta=IS(),this.projectionDeltaWithTransform=IS()}setAnimationOrigin(p,E=!1){const v=this.snapshot,T=v?v.latestValues:{},w={...this.latestValues},A=IS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=ks(),F=v?v.source:void 0,j=this.layout?this.layout.source:void 0,B=F!==j,G=this.getStack(),J=!G||G.members.length<=1,K=!!(B&&!J&&this.options.crossfade===!0&&!this.path.some(bOe));this.animationProgress=0;let ne;this.mixTargetDelta=de=>{const oe=de/1e3;Cq(A.x,p.x,oe),Cq(A.y,p.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Hw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),TOe(this.relativeTarget,this.relativeTargetOrigin,N,oe),ne&&oOe(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=ks()),yu(ne,this.relativeTarget)),B&&(this.animationValues=w,eOe(w,T,this.latestValues,oe,K,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(fg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Wi.update(()=>{zO.hasAnimatedSinceResize=!0,this.currentAnimation=qPe(0,bq,{...p,onUpdate:E=>{this.mixTargetDelta(E),p.onUpdate&&p.onUpdate(E)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(bq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:E,target:v,layout:T,latestValues:w}=p;if(!(!E||!v||!T)){if(this!==p&&this.layout&&T&&Oee(this.options.animationType,this.layout.layoutBox,T.layoutBox)){v=this.target||ks();const A=Nl(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+A;const N=Nl(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}yu(E,v),PS(E,w),Gw(this.projectionDeltaWithTransform,this.layoutCorrected,E,w)}}registerSharedNode(p,E){this.sharedNodes.has(p)||this.sharedNodes.set(p,new aOe),this.sharedNodes.get(p).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:E}=this.options;return E?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:E}=this.options;return E?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:E,preserveFollowOpacity:v}={}){const T=this.getStack();T&&T.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let E=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const T={};v.z&&_2("z",p,T,this.animationValues);for(let w=0;w<g2.length;w++)_2(`rotate${g2[w]}`,p,T,this.animationValues),_2(`skew${g2[w]}`,p,T,this.animationValues);p.render();for(const w in T)p.setStaticValue(w,T[w]),this.animationValues&&(this.animationValues[w]=T[w]);p.scheduleRender()}getProjectionStyles(p){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return lOe;const T={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,T.opacity="",T.pointerEvents=BO(p==null?void 0:p.pointerEvents)||"",T.transform=w?w(this.latestValues,""):"none",T;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=BO(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!eE(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),T.transform=cOe(this.projectionDeltaWithTransform,this.treeScale,N),w&&(T.transform=w(N,T.transform));const{x:F,y:j}=this.projectionDelta;T.transformOrigin=`${F.origin*100}% ${j.origin*100}% 0`,A.animationValues?T.opacity=A===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:T.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const B in mk){if(N[B]===void 0)continue;const{correct:G,applyTo:J}=mk[B],K=T.transform==="none"?N[B]:G(N[B],A);if(J){const ne=J.length;for(let de=0;de<ne;de++)T[J[de]]=K}else T[B]=K}return this.options.layoutId&&(T.pointerEvents=A===this?BO(p==null?void 0:p.pointerEvents)||"":"none"),T}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var E;return(E=p.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(wq),this.root.sharedNodes.clear()}}}function dOe(n){n.updateLayout()}function hOe(n){var t;const s=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&s&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,p=s.source!==n.layout.source;d==="size"?Tu(A=>{const N=p?s.measuredBox[A]:s.layoutBox[A],F=Nl(N);N.min=a[A].min,N.max=N.min+F}):Oee(d,s.layoutBox,a)&&Tu(A=>{const N=p?s.measuredBox[A]:s.layoutBox[A],F=Nl(a[A]);N.max=N.min+F,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+F)});const E=IS();Gw(E,a,s.layoutBox);const v=IS();p?Gw(v,n.applyTransform(l,!0),s.measuredBox):Gw(v,a,s.layoutBox);const T=!Cee(E);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:F}=A;if(N&&F){const j=ks();Hw(j,s.layoutBox,N.layoutBox);const B=ks();Hw(B,a,F.layoutBox),Iee(j,B)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=j,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:T,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function fOe(n){Cw&&tE.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function pOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function mOe(n){n.clearSnapshot()}function wq(n){n.clearMeasurements()}function gOe(n){n.isLayoutDirty=!1}function _Oe(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function Rq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function EOe(n){n.resolveTargetDelta()}function yOe(n){n.calcProjection()}function vOe(n){n.resetSkewAndRotation()}function SOe(n){n.removeLeadSnapshot()}function Cq(n,t,s){n.translate=ss(t.translate,0,s),n.scale=ss(t.scale,1,s),n.origin=t.origin,n.originPoint=t.originPoint}function Iq(n,t,s,a){n.min=ss(t.min,s.min,a),n.max=ss(t.max,s.max,a)}function TOe(n,t,s,a){Iq(n.x,t.x,s.x,a),Iq(n.y,t.y,s.y,a)}function bOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const wOe={duration:.45,ease:[.4,0,.1,1]},Aq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Pq=Aq("applewebkit/")&&!Aq("chrome/")?Math.round:kl;function Oq(n){n.min=Pq(n.min),n.max=Pq(n.max)}function ROe(n){Oq(n.x),Oq(n.y)}function Oee(n,t,s){return n==="position"||n==="preserve-aspect"&&!APe(Sq(t),Sq(s),.2)}function COe(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const IOe=Pee({attachResizeListener:(n,t)=>hR(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),E2={current:void 0},kee=Pee({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!E2.current){const n=new IOe({});n.mount(window),n.setOptions({layoutScroll:!0}),E2.current=n}return E2.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),AOe={pan:{Feature:GPe},drag:{Feature:zPe,ProjectionNode:kee,MeasureLayout:bee}};function kq(n,t,s){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Wi.postRender(()=>d(t,zR(t)))}class POe extends bg{mount(){const{current:t}=this.node;t&&(this.unmount=AIe(t,s=>(kq(this.node,s,"Start"),a=>kq(this.node,a,"End"))))}unmount(){}}class OOe extends bg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=WR(hR(this.node.current,"focus",()=>this.onFocus()),hR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Nq(n,t,s){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Wi.postRender(()=>d(t,zR(t)))}class kOe extends bg{mount(){const{current:t}=this.node;t&&(this.unmount=NIe(t,s=>(Nq(this.node,s,"Start"),(a,{success:l})=>Nq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const LU=new WeakMap,y2=new WeakMap,NOe=n=>{const t=LU.get(n.target);t&&t(n)},DOe=n=>{n.forEach(NOe)};function LOe({root:n,...t}){const s=n||document;y2.has(s)||y2.set(s,{});const a=y2.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(DOe,{root:n,...t})),a[l]}function xOe(n,t,s){const a=LOe(t);return LU.set(n,s),a.observe(n),()=>{LU.delete(n),a.unobserve(n)}}const MOe={some:0,all:1};class UOe extends bg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,p={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:MOe[l]},E=v=>{const{isIntersecting:T}=v;if(this.isInView===T||(this.isInView=T,d&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=T?w:A;N&&N(v)};return xOe(this.node.current,p,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(VOe(t,s))&&this.startObserver()}unmount(){}}function VOe({viewport:n={}},{viewport:t={}}={}){return s=>n[s]!==t[s]}const FOe={inView:{Feature:UOe},tap:{Feature:kOe},focus:{Feature:OOe},hover:{Feature:POe}},jOe={layout:{ProjectionNode:kee,MeasureLayout:bee}},xU={current:null},Nee={current:!1};function BOe(){if(Nee.current=!0,!!uF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>xU.current=n.matches;n.addListener(t),t()}else xU.current=!1}const WOe=[...ree,Aa,pg],zOe=n=>WOe.find(nee(n)),Dq=new WeakMap;function GOe(n,t,s){for(const a in t){const l=t[a],d=s[a];if(Na(l))n.addValue(a,l);else if(Na(d))n.addValue(a,uR(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const p=n.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(a);n.addValue(a,uR(p!==void 0?p:l,{owner:n}))}}for(const a in s)t[a]===void 0&&n.removeValue(a);return t}const Lq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class HOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=UF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Hh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,Wi.render(this.render,!1,!0))};const{latestValues:v,renderState:T,onUpdate:w}=p;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=T,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=fN(s),this.isVariantNode=dZ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const F in N){const j=N[F];v[F]!==void 0&&Na(j)&&j.set(v[F],!1)}}mount(t){this.current=t,Dq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),Nee.current||BOe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:xU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Dq.delete(this.current),this.projection&&this.projection.unmount(),fg(this.notifyUpdate),fg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=xE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&Wi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),p&&p(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in e0){const s=e0[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ks()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<Lq.length;a++){const l=Lq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=t[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=GOe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=uR(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(eee(l)||HZ(l))?l=parseFloat(l):!zOe(l)&&pg.test(s)&&(l=JZ(t,s)),this.setBaseTarget(t,Na(l)?l.get():l)),Na(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const p=_F(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);p&&(l=p[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!Na(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new kF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class Dee extends HOe{constructor(){super(...arguments),this.KeyframeResolver=iee}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Na(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function $Oe(n){return window.getComputedStyle(n)}class KOe extends Dee{constructor(){super(...arguments),this.type="html",this.renderInstance=vZ}readValueFromInstance(t,s){if(xE.has(s)){const a=MF(s);return a&&a.default||0}else{const a=$Oe(t),l=(_Z(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return See(t,s)}build(t,s,a){vF(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return wF(t,s,a)}}class qOe extends Dee{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ks}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(xE.has(s)){const a=MF(s);return a&&a.default||0}return s=SZ.has(s)?s:pF(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return wZ(t,s,a)}build(t,s,a){SF(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){TZ(t,s,a,l)}mount(t){this.isSVGTag=bF(t.tagName),super.mount(t)}}const YOe=(n,t)=>gF(n)?new qOe(t):new KOe(t,{allowProjection:n!==L.Fragment}),XOe=SIe({...yPe,...FOe,...AOe,...jOe},YOe),rf=MCe(XOe),JOe=(n,t)=>n.find(s=>s.id===t);function xq(n,t){const s=Lee(n,t),a=s?n[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function Lee(n,t){for(const[s,a]of Object.entries(n))if(JOe(a,t))return s}function QOe(n){const t=n.includes("right"),s=n.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function ZOe(n){const s=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:p}}var eke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,tke=YQ(function(n){return eke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),nke=tke,rke=function(t){return t!=="theme"},Mq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?nke:rke},Uq=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(p){return t.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},ike=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return ZV(s,a,l),eZ(function(){return eF(s,a,l)}),null},ske=function n(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,p;s!==void 0&&(d=s.label,p=s.target);var E=Uq(t,s,a),v=E||Mq(l),T=!v("as");return function(){var w=arguments,A=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var F=w.length,j=1;j<F;j++)A.push(w[j],N[j])}var B=nF(function(G,J,K){var ne=T&&G.as||l,de="",oe=[],_e=G;if(G.theme==null){_e={};for(var Z in G)_e[Z]=G[Z];_e.theme=L.useContext(QS)}typeof G.className=="string"?de=JQ(J.registered,oe,G.className):G.className!=null&&(de=G.className+" ");var ee=cN(A.concat(oe),J.registered,_e);de+=J.key+"-"+ee.name,p!==void 0&&(de+=" "+p);var te=T&&E===void 0?Mq(ne):v,ce={};for(var me in G)T&&me==="as"||te(me)&&(ce[me]=G[me]);return ce.className=de,K&&(ce.ref=K),L.createElement(L.Fragment,null,L.createElement(ike,{cache:J,serialized:ee,isStringTag:typeof ne=="string"}),L.createElement(ne,ce))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=t.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=A,B.__emotion_forwardProp=E,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(G,J){var K=n(G,SE({},s,J,{shouldForwardProp:Uq(B,J,!0)}));return K.apply(void 0,A)},B}},oke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],MU=ske.bind(null);oke.forEach(function(n){MU[n]=MU(n)});const ake=new Set([...Pye,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),cke=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function lke(n){return(cke.has(n)||!ake.has(n))&&n[0]!=="_"}const uke=oEe(MU),dke=({baseStyle:n})=>t=>{const{theme:s,css:a,__css:l,sx:d,...p}=t,[E]=mEe(p,kye),v=qc(n,t),T=$_e({},l,v,Zk(E),d),w=AQ(T)(t.theme);return a?[w,a]:w};function v2(n,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=lke);const l=dke({baseStyle:s}),d=uke(n,a)(l);return L.forwardRef(function(v,T){const{children:w,...A}=v,{colorMode:N,forced:F}=uN(),j=F?N:void 0;return L.createElement(d,{ref:T,"data-theme":j,...A},w)})}function hke(){const n=new Map;return new Proxy(v2,{apply(t,s,a){return v2(...a)},get(t,s){return n.has(s)||n.set(s,v2(s)),n.get(s)}})}const Mt=hke(),fke={initial:n=>{const{position:t}=n,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},xee=L.memo(n=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:E=5e3,containerStyle:v,motionVariants:T=fke,toastSpacing:w="0.5rem"}=n,[A,N]=L.useState(E),F=ICe();hg(()=>{F||a==null||a()},[F]),hg(()=>{N(E)},[E]);const j=()=>N(null),B=()=>N(E),G=()=>{F&&l()};L.useEffect(()=>{F&&d&&l()},[F,d,l]),DEe(G,A);const J=L.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),K=L.useMemo(()=>QOe(p),[p]);return I.jsx(rf.div,{layout:!0,className:"chakra-toast",variants:T,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:B,custom:{position:p},style:K,children:I.jsx(Mt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:qc(s,{id:t,onClose:G})})})});xee.displayName="ToastComponent";function Jt(n){return L.forwardRef(n)}var S2,Vq;function pke(){if(Vq)return S2;Vq=1;var n=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var E,v,T;if(Array.isArray(d)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(!l(d[v],p[v]))return!1;return!0}var w;if(t&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(E=d.length,E!=p.length)return!1;for(v=E;v--!==0;)if(d[v]!==p[v])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(T=Object.keys(d),E=T.length,E!==Object.keys(p).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,T[v]))return!1;if(n&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((T[v]==="_owner"||T[v]==="__v"||T[v]==="__o")&&d.$$typeof)&&!l(d[T[v]],p[T[v]]))return!1;return!0}return d!==d&&p!==p}return S2=function(p,E){try{return l(p,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},S2}var mke=pke();const gke=y0(mke);function w0(){const n=L.useContext(QS);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Mee(){const n=uN(),t=w0();return{...n,theme:t}}function _ke(n,t,s){if(t==null)return t;const a=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return a(t)??a(s)??s}function Eke(n,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const p=l.filter(Boolean),E=a.map((v,T)=>{const w=`${n}.${v}`;return _ke(d,w,p[T]??v)});return Array.isArray(t)?E:E[0]}}function Uee(n,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=Mee(),p=n?dQ(l,`components.${n}`):void 0,E=s||p,v=Vh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},Zk(LR(a,["children"])),(w,A)=>w?void 0:A),T=L.useRef({});if(E){const A=Wye(E)(v);gke(T.current,A)||(T.current=A)}return T.current}function ku(n,t={}){return Uee(n,t)}function Zc(n,t={}){return Uee(n,t)}const Fq={path:I.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[I.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),I.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),I.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Hn=Jt((n,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:p,className:E,__css:v,...T}=n,w=hn("chakra-icon",E),A=ku("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},F={ref:t,focusable:d,className:w,__css:N},j=a??Fq.viewBox;if(s&&typeof s!="string")return I.jsx(Mt.svg,{as:s,...F,...T});const B=p??Fq.path;return I.jsx(Mt.svg,{verticalAlign:"middle",viewBox:j,...F,...T,children:B})});Hn.displayName="Icon";function yke(n){return I.jsx(Hn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function vke(n){return I.jsx(Hn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function jq(n){return I.jsx(Hn,{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const Ske=VR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),kp=Jt((n,t)=>{const s=ku("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:E,...v}=Qi(n),T=hn("chakra-spinner",E),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${Ske} ${d} linear infinite`,...s};return I.jsx(Mt.div,{ref:t,__css:w,className:T,...v,children:a&&I.jsx(Mt.span,{srOnly:!0,children:a})})});kp.displayName="Spinner";const[Tke,BF]=Gi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[bke,WF]=Gi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Vee={info:{icon:vke,colorScheme:"blue"},warning:{icon:jq,colorScheme:"orange"},success:{icon:yke,colorScheme:"green"},error:{icon:jq,colorScheme:"red"},loading:{icon:kp,colorScheme:"blue"}};function wke(n){return Vee[n].colorScheme}function Rke(n){return Vee[n].icon}const n0=Jt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Qi(t),p=t.colorScheme??wke(a),E=Zc("Alert",{...t,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return I.jsx(Tke,{value:{status:a},children:I.jsx(bke,{value:E,children:I.jsx(Mt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:hn("chakra-alert",t.className),__css:v})})})});n0.displayName="Alert";function r0(n){const{status:t}=BF(),s=Rke(t),a=WF(),l=t==="loading"?a.spinner:a.icon;return I.jsx(Mt.span,{display:"inherit","data-status":t,...n,className:hn("chakra-alert__icon",n.className),__css:l,children:n.children||I.jsx(s,{h:"100%",w:"100%"})})}r0.displayName="AlertIcon";const Sk=Jt(function(t,s){const a=WF(),{status:l}=BF();return I.jsx(Mt.div,{ref:s,"data-status":l,...t,className:hn("chakra-alert__title",t.className),__css:a.title})});Sk.displayName="AlertTitle";const Tk=Jt(function(t,s){const{status:a}=BF(),l=WF(),d={display:"inline",...l.description};return I.jsx(Mt.div,{ref:s,"data-status":a,...t,className:hn("chakra-alert__desc",t.className),__css:d})});Tk.displayName="AlertDescription";function Cke(n){return I.jsx(Hn,{focusable:"false","aria-hidden":!0,...n,children:I.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const zF=Jt(function(t,s){const a=ku("CloseButton",t),{children:l,isDisabled:d,__css:p,...E}=Qi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return I.jsx(Mt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...p},...E,children:l||I.jsx(Cke,{width:"1em",height:"1em"})})});zF.displayName="CloseButton";const Ike=n=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:p,description:E,colorScheme:v,icon:T}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return I.jsxs(n0,{addRole:!1,status:t,variant:s,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[I.jsx(r0,{children:T}),I.jsxs(Mt.div,{flex:"1",maxWidth:"100%",children:[l&&I.jsx(Sk,{id:w==null?void 0:w.title,children:l}),E&&I.jsx(Tk,{id:w==null?void 0:w.description,display:"block",children:E})]}),d&&I.jsx(zF,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Fee(n={}){const{render:t,toastComponent:s=Ike}=n;return l=>typeof t=="function"?t({...l,...n}):I.jsx(s,{...l,...n})}const Ake={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},xh=Pke(Ake);function Pke(n){let t=n;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>n),s.delete(l)}),removeToast:(l,d)=>{a(p=>({...p,[d]:p[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const p=Oke(l,d),{position:E,id:v}=p;return a(T=>{const A=E.includes("top")?[p,...T[E]??[]]:[...T[E]??[],p];return{...T,[E]:A}}),v},update:(l,d)=>{l&&a(p=>{const E={...p},{position:v,index:T}=xq(E,l);return v&&T!==-1&&(E[v][T]={...E[v][T],...d,message:Fee(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,T)=>(v[T]=d[T].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const p=Lee(d,l);return p?{...d,[p]:d[p].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!xq(xh.getState(),l).position}}let Bq=0;function Oke(n,t={}){Bq+=1;const s=t.id??Bq,a=t.position??"bottom";return{id:s,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>xh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var jee=nQ();const[Bee,kke]=Gi({strict:!1,name:"PortalContext"}),GF="chakra-portal",Nke=".chakra-portal",Dke=n=>I.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),Lke=n=>{const{appendToParentPortal:t,children:s}=n,[a,l]=L.useState(null),d=L.useRef(null),[,p]=L.useState({});L.useEffect(()=>p({}),[]);const E=kke(),v=SCe();rg(()=>{if(!a)return;const w=a.ownerDocument,A=t?E??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=GF,A.appendChild(d.current),p({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const T=v!=null&&v.zIndex?I.jsx(Dke,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?jee.createPortal(I.jsx(Bee,{value:d.current,children:T}),d.current):I.jsx("span",{ref:w=>{w&&l(w)}})},xke=n=>{const{children:t,containerRef:s,appendToParentPortal:a}=n,l=s.current,d=l??(typeof window<"u"?document.body:void 0),p=L.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=GF),v},[l]),[,E]=L.useState({});return rg(()=>E({}),[]),rg(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?jee.createPortal(I.jsx(Bee,{value:a?p:null,children:t}),p):null};function Ll(n){const t={appendToParentPortal:!0,...n},{containerRef:s,...a}=t;return s?I.jsx(xke,{containerRef:s,...a}):I.jsx(Lke,{...a})}Ll.className=GF;Ll.selector=Nke;Ll.displayName="Portal";const[Mke,Uke]=Gi({name:"ToastOptionsContext",strict:!1}),Vke=n=>{const t=L.useSyncExternalStore(xh.subscribe,xh.getState,xh.getState),{motionVariants:s,component:a=xee,portalProps:l,animatePresenceProps:d}=n,E=Object.keys(t).map(v=>{const T=t[v];return I.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:ZOe(v),children:I.jsx(S0,{...d,initial:!1,children:T.map(w=>I.jsx(a,{motionVariants:s,...w},w.id))})},v)});return I.jsx(Ll,{...l,children:E})},Fke=n=>function({children:s,theme:a=n,toastOptions:l,...d}){return I.jsxs(TCe,{theme:a,...d,children:[I.jsx(Mke,{value:l==null?void 0:l.defaultOptions,children:s}),I.jsx(Vke,{...l})]})},gN=Fke(pRe);function Wq(n){return n.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const jke=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function zq(n,t,s){let a=n+1;return s&&a>=t&&(a=0),a}function Gq(n,t,s){let a=n-1;return s&&a<0&&(a=t),a}const T2=typeof window<"u"?L.useLayoutEffect:L.useEffect,Hq=n=>n;var Bke=Object.defineProperty,Wke=(n,t,s)=>t in n?Bke(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,Ss=(n,t,s)=>(Wke(n,typeof t!="symbol"?t+"":t,s),s);class zke{constructor(){Ss(this,"descendants",new Map),Ss(this,"register",t=>{if(t!=null)return jke(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),Ss(this,"unregister",t=>{this.descendants.delete(t);const s=Wq(Array.from(this.descendants.keys()));this.assignIndex(s)}),Ss(this,"destroy",()=>{this.descendants.clear()}),Ss(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),Ss(this,"count",()=>this.descendants.size),Ss(this,"enabledCount",()=>this.enabledValues().length),Ss(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),Ss(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ss(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ss(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ss(this,"first",()=>this.item(0)),Ss(this,"firstEnabled",()=>this.enabledItem(0)),Ss(this,"last",()=>this.item(this.descendants.size-1)),Ss(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ss(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),Ss(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),Ss(this,"next",(t,s=!0)=>{const a=zq(t,this.count(),s);return this.item(a)}),Ss(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=zq(l,this.enabledCount(),s);return this.enabledItem(d)}),Ss(this,"prev",(t,s=!0)=>{const a=Gq(t,this.count()-1,s);return this.item(a)}),Ss(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=Gq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),Ss(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=Wq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function Wee(){const[n,t]=Gi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=L.useRef(new zke);return T2(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[p,E]=L.useState(-1),v=L.useRef(null);T2(()=>()=>{v.current&&d.unregister(v.current)},[]),T2(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);p!=w&&!Number.isNaN(w)&&E(w)});const T=Hq(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(v.current),register:Ji(T,v)}}]}const $q={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},mE={enter:{duration:.2,ease:$q.easeOut},exit:{duration:.1,ease:$q.easeIn}},gE={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},zee=Jt(function(n,t){const{ratio:s=4/3,children:a,className:l,...d}=n,p=L.Children.only(a),E=hn("chakra-aspect-ratio",l);return I.jsx(Mt.div,{ref:t,position:"relative",className:E,_before:{height:0,content:'""',display:"block",paddingBottom:eN(s,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});zee.displayName="AspectRatio";const[Gke,Hke]=Gi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function $ke(n){const t=n.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function Gee(n){const{name:t,getInitials:s,...a}=n,l=Hke();return I.jsx(Mt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}Gee.displayName="AvatarName";const Hee=n=>I.jsxs(Mt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[I.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),I.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function $ee(n){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:p,sizes:E,ignoreFallback:v}=n,[T,w]=L.useState("pending");L.useEffect(()=>{w(s?"loading":"pending")},[s]);const A=L.useRef(null),N=L.useCallback(()=>{if(!s)return;F();const j=new Image;j.src=s,p&&(j.crossOrigin=p),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=B=>{F(),w("loaded"),l==null||l(B)},j.onerror=B=>{F(),w("failed"),d==null||d(B)},A.current=j},[s,p,a,E,l,d,t]),F=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return rg(()=>{if(!v)return T==="loading"&&N(),()=>{F()}},[T,N,v]),v?"loaded":T}const Kke=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function Kee(n){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:p,borderRadius:E,loading:v,iconLabel:T,icon:w=I.jsx(Hee,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:F}=n,B=$ee({src:t,onError:a,crossOrigin:F,ignoreFallback:A})==="loaded";return!t||!B?p?I.jsx(Gee,{className:"chakra-avatar__initials",getInitials:d,name:p}):L.cloneElement(w,{role:"img","aria-label":T}):I.jsx(Mt.img,{src:t,srcSet:s,alt:p??T,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}Kee.displayName="AvatarImage";const qke={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Iu=Jt((n,t)=>{const s=Zc("Avatar",n),[a,l]=L.useState(!1),{src:d,srcSet:p,name:E,showBorder:v,borderRadius:T="full",onError:w,onLoad:A,getInitials:N=$ke,icon:F=I.jsx(Hee,{}),iconLabel:j=" avatar",loading:B,children:G,borderColor:J,ignoreFallback:K,crossOrigin:ne,referrerPolicy:de,...oe}=Qi(n),_e={borderRadius:T,borderWidth:v?"2px":void 0,...qke,...s.container};return J&&(_e.borderColor=J),I.jsx(Mt.span,{ref:t,...oe,className:hn("chakra-avatar",n.className),"data-loaded":Yn(a),__css:_e,children:I.jsxs(Gke,{value:s,children:[I.jsx(Kee,{src:d,srcSet:p,loading:B,onLoad:Zn(A,()=>{l(!0)}),onError:w,getInitials:N,name:E,borderRadius:T,icon:F,iconLabel:j,ignoreFallback:K,crossOrigin:ne,referrerPolicy:de}),G]})})});Iu.displayName="Avatar";const hp=Jt(function(t,s){const a=ku("Badge",t),{className:l,...d}=Qi(t);return I.jsx(Mt.span,{ref:s,className:hn("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});hp.displayName="Badge";const Ct=Mt("div");Ct.displayName="Box";const[o8e,Yke]=Gi({strict:!1,name:"ButtonGroupContext"});function Iw(n){const{children:t,className:s,...a}=n,l=L.isValidElement(t)?L.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=hn("chakra-button__icon",s);return I.jsx(Mt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Iw.displayName="ButtonIcon";function UU(n){const{label:t,placement:s,spacing:a="0.5rem",children:l=I.jsx(kp,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,...E}=n,v=hn("chakra-button__spinner",d),T=s==="start"?"marginEnd":"marginStart",w=L.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[T]:t?a:0,fontSize:"1em",lineHeight:"normal",...p}),[p,t,T,a]);return I.jsx(Mt.div,{className:v,...E,__css:w,children:l})}UU.displayName="ButtonSpinner";function Xke(n){const[t,s]=L.useState(!n);return{ref:L.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const wi=Jt((n,t)=>{const s=Yke(),a=ku("Button",{...s,...n}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:p,children:E,leftIcon:v,rightIcon:T,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:F,spinnerPlacement:j="start",className:B,as:G,shouldWrapChildren:J,...K}=Qi(n),ne=L.useMemo(()=>{const Z={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Z}}},[a,s]),{ref:de,type:oe}=Xke(G),_e={rightIcon:T,leftIcon:v,iconSpacing:A,children:E,shouldWrapChildren:J};return I.jsxs(Mt.button,{disabled:l||d,ref:NEe(t,de),as:G,type:N??oe,"data-active":Yn(p),"data-loading":Yn(d),__css:ne,className:hn("chakra-button",B),...K,children:[d&&j==="start"&&I.jsx(UU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:F}),d?w||I.jsx(Mt.span,{opacity:0,children:I.jsx(Kq,{..._e})}):I.jsx(Kq,{..._e}),d&&j==="end"&&I.jsx(UU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:F})]})});wi.displayName="Button";function Kq(n){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?I.jsxs("span",{style:{display:"contents"},children:[t&&I.jsx(Iw,{marginEnd:l,children:t}),a,s&&I.jsx(Iw,{marginStart:l,children:s})]}):I.jsxs(I.Fragment,{children:[t&&I.jsx(Iw,{marginEnd:l,children:t}),a,s&&I.jsx(Iw,{marginStart:l,children:s})]})}const Oa=Jt((n,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...p}=n,E=s||a,v=L.isValidElement(E)?L.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return I.jsx(wi,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...p,children:v})});Oa.displayName="IconButton";const qee=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});qee.displayName="Center";const Jke={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Jt(function(t,s){const{axis:a="both",...l}=t;return I.jsx(Mt.div,{ref:s,__css:Jke[a],...l,position:"absolute"})});var Qke=()=>typeof document<"u",qq=!1,GR=null,TE=!1,VU=!1,FU=new Set;function HF(n,t){FU.forEach(s=>s(n,t))}var Zke=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function eNe(n){return!(n.metaKey||!Zke&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function Yq(n){TE=!0,eNe(n)&&(GR="keyboard",HF("keyboard",n))}function oS(n){if(GR="pointer",n.type==="mousedown"||n.type==="pointerdown"){TE=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;HF("pointer",n)}}function tNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function nNe(n){tNe(n)&&(TE=!0,GR="virtual")}function rNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!TE&&!VU&&(GR="virtual",HF("virtual",n)),TE=!1,VU=!1)}function iNe(){TE=!1,VU=!0}function Xq(){return GR!=="pointer"}function sNe(){if(!Qke()||qq)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){TE=!0,n.apply(this,s)},document.addEventListener("keydown",Yq,!0),document.addEventListener("keyup",Yq,!0),document.addEventListener("click",nNe,!0),window.addEventListener("focus",rNe,!0),window.addEventListener("blur",iNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",oS,!0),document.addEventListener("pointermove",oS,!0),document.addEventListener("pointerup",oS,!0)):(document.addEventListener("mousedown",oS,!0),document.addEventListener("mousemove",oS,!0),document.addEventListener("mouseup",oS,!0)),qq=!0}function oNe(n){sNe(),n(Xq());const t=()=>n(Xq());return FU.add(t),()=>{FU.delete(t)}}const[aNe,Yee]=Gi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[cNe,R0]=Gi({strict:!1,name:"FormControlContext"});function lNe(n){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...p}=n,E=L.useId(),v=t||`field-${E}`,T=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,F]=L.useState(!1),[j,B]=L.useState(!1),[G,J]=L.useState(!1),K=L.useCallback((Z={},ee=null)=>({id:A,...Z,ref:Ji(ee,te=>{te&&B(!0)})}),[A]),ne=L.useCallback((Z={},ee=null)=>({...Z,ref:ee,"data-focus":Yn(G),"data-disabled":Yn(l),"data-invalid":Yn(a),"data-readonly":Yn(d),id:Z.id!==void 0?Z.id:T,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:v}),[v,l,G,a,d,T]),de=L.useCallback((Z={},ee=null)=>({id:w,...Z,ref:Ji(ee,te=>{te&&F(!0)}),"aria-live":"polite"}),[w]),oe=L.useCallback((Z={},ee=null)=>({...Z,...p,ref:ee,role:"group","data-focus":Yn(G),"data-disabled":Yn(l),"data-invalid":Yn(a),"data-readonly":Yn(d)}),[p,l,G,a,d]),_e=L.useCallback((Z={},ee=null)=>({...Z,ref:ee,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!G,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:j,setHasHelpText:B,id:v,labelId:T,feedbackId:w,helpTextId:A,htmlProps:p,getHelpTextProps:K,getErrorMessageProps:de,getRootProps:oe,getLabelProps:ne,getRequiredIndicatorProps:_e}}const Bi=Jt(function(t,s){const a=Zc("Form",t),l=Qi(t),{getRootProps:d,htmlProps:p,...E}=lNe(l),v=hn("chakra-form-control",t.className);return I.jsx(cNe,{value:E,children:I.jsx(aNe,{value:a,children:I.jsx(Mt.div,{...d({},s),className:v,__css:a.container})})})});Bi.displayName="FormControl";const jU=Jt(function(t,s){const a=R0(),l=Yee(),d=hn("chakra-form__helper-text",t.className);return I.jsx(Mt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});jU.displayName="FormHelperText";function Xee(n){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=Jee(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":kS(s),"aria-required":kS(l),"aria-readonly":kS(a)}}function Jee(n){const t=R0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:p,isInvalid:E,isReadOnly:v,isDisabled:T,onFocus:w,onBlur:A,...N}=n,F=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??T??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??p??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Zn(t==null?void 0:t.onFocus,w),onBlur:Zn(t==null?void 0:t.onBlur,A)}}const uNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function dNe(n={}){const t=Jee(n),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:p,onBlur:E,onFocus:v,"aria-describedby":T}=t,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:F,isIndeterminate:j,name:B,value:G,tabIndex:J=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":de,...oe}=n,_e=LR(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=Yc(F),ee=Yc(E),te=Yc(v),[ce,me]=L.useState(!1),[he,se]=L.useState(!1),[Se,Ve]=L.useState(!1),[tt,ke]=L.useState(!1);L.useEffect(()=>oNe(me),[]);const Me=L.useRef(null),[Ce,Xe]=L.useState(!0),[Ae,Ie]=L.useState(!!w),be=A!==void 0,xe=be?A:Ae,We=L.useCallback(Qt=>{if(a||s){Qt.preventDefault();return}be||Ie(xe?Qt.currentTarget.checked:j?!0:Qt.currentTarget.checked),Z==null||Z(Qt)},[a,s,xe,be,j,Z]);rg(()=>{Me.current&&(Me.current.indeterminate=!!j)},[j]),hg(()=>{s&&se(!1)},[s,se]),rg(()=>{const Qt=Me.current;if(!(Qt!=null&&Qt.form))return;const Ot=()=>{Ie(!!w)};return Qt.form.addEventListener("reset",Ot),()=>{var Dt;return(Dt=Qt.form)==null?void 0:Dt.removeEventListener("reset",Ot)}},[]);const Qe=s&&!N,Ze=L.useCallback(Qt=>{Qt.key===" "&&ke(!0)},[ke]),ut=L.useCallback(Qt=>{Qt.key===" "&&ke(!1)},[ke]);rg(()=>{if(!Me.current)return;Me.current.checked!==xe&&Ie(Me.current.checked)},[Me.current]);const it=L.useCallback((Qt={},Ot=null)=>{const Dt=ve=>{he&&ve.preventDefault(),ke(!0)};return{...Qt,ref:Ot,"data-active":Yn(tt),"data-hover":Yn(Se),"data-checked":Yn(xe),"data-focus":Yn(he),"data-focus-visible":Yn(he&&ce),"data-indeterminate":Yn(j),"data-disabled":Yn(s),"data-invalid":Yn(d),"data-readonly":Yn(a),"aria-hidden":!0,onMouseDown:Zn(Qt.onMouseDown,Dt),onMouseUp:Zn(Qt.onMouseUp,()=>ke(!1)),onMouseEnter:Zn(Qt.onMouseEnter,()=>Ve(!0)),onMouseLeave:Zn(Qt.onMouseLeave,()=>Ve(!1))}},[tt,xe,s,he,ce,Se,j,d,a]),It=L.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,"data-active":Yn(tt),"data-hover":Yn(Se),"data-checked":Yn(xe),"data-focus":Yn(he),"data-focus-visible":Yn(he&&ce),"data-indeterminate":Yn(j),"data-disabled":Yn(s),"data-invalid":Yn(d),"data-readonly":Yn(a)}),[tt,xe,s,he,ce,Se,j,d,a]),yn=L.useCallback((Qt={},Ot=null)=>({..._e,htmlFor:Ce?p:void 0,...Qt,ref:Ji(Ot,Dt=>{Dt&&Xe(Dt.tagName==="LABEL")}),onClick:Zn(Qt.onClick,()=>{var Dt;Ce||((Dt=Me.current)==null||Dt.click(),requestAnimationFrame(()=>{var ve;(ve=Me.current)==null||ve.focus({preventScroll:!0})}))}),"data-disabled":Yn(s),"data-checked":Yn(xe),"data-invalid":Yn(d)}),[_e,s,xe,d,Ce,p]),Vt=L.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ji(Me,Ot),type:"checkbox",name:B,value:G,id:p,tabIndex:J,onChange:Zn(Qt.onChange,We),onBlur:Zn(Qt.onBlur,ee,()=>se(!1)),onFocus:Zn(Qt.onFocus,te,()=>se(!0)),onKeyDown:Zn(Qt.onKeyDown,Ze),onKeyUp:Zn(Qt.onKeyUp,ut),required:l,checked:xe,disabled:Qe,readOnly:a,"aria-label":K,"aria-labelledby":ne,"aria-invalid":de?!!de:d,"aria-describedby":T,"aria-disabled":s,"aria-checked":j?"mixed":xe,style:uNe}),[B,G,p,J,We,ee,te,Ze,ut,l,xe,Qe,a,K,ne,de,d,T,s,j]),ln=L.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,onMouseDown:Zn(Qt.onMouseDown,hNe),"data-disabled":Yn(s),"data-checked":Yn(xe),"data-invalid":Yn(d)}),[xe,s,d]);return{state:{isInvalid:d,isFocused:he,isChecked:xe,isActive:tt,isHovered:Se,isIndeterminate:j,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:yn,getCheckboxProps:it,getIndicatorProps:It,getInputProps:Vt,getLabelProps:ln,htmlProps:_e}}function hNe(n){n.preventDefault(),n.stopPropagation()}const GO=Jt(function(t,s){const{className:a,centerContent:l,...d}=Qi(t),p=ku("Container",t);return I.jsx(Mt.div,{ref:s,className:hn("chakra-container",a),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});GO.displayName="Container";const vp=Jt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:E,borderStyle:v,borderColor:T,...w}=ku("Divider",t),{className:A,orientation:N="horizontal",__css:F,...j}=Qi(t),B={vertical:{borderLeftWidth:a||p||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return I.jsx(Mt.hr,{ref:s,"aria-orientation":N,...j,__css:{...w,border:"0",borderColor:T,borderStyle:v,...B[N],...F},className:hn("chakra-divider",A)})});vp.displayName="Divider";const Ri=Jt(function(t,s){const{direction:a,align:l,justify:d,wrap:p,basis:E,grow:v,shrink:T,...w}=t,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:E,flexGrow:v,flexShrink:T};return I.jsx(Mt.div,{ref:s,__css:A,...w})});Ri.displayName="Flex";function fNe(n,t){if(n==null)return{};var s={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;s[a]=n[a]}return s}var b2={exports:{}},w2,Jq;function pNe(){if(Jq)return w2;Jq=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return w2=n,w2}var R2,Qq;function mNe(){if(Qq)return R2;Qq=1;var n=pNe();function t(){}function s(){}return s.resetWarningCache=t,R2=function(){function a(p,E,v,T,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},R2}var Zq;function gNe(){return Zq||(Zq=1,b2.exports=mNe()()),b2.exports}var _Ne=gNe();const vr=y0(_Ne);var BU="data-focus-lock",Qee="data-focus-lock-disabled",ENe="data-no-focus-lock",yNe="data-autofocus-inside",vNe="data-no-autofocus";function C2(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function SNe(n,t){var s=L.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var TNe=typeof window<"u"?L.useLayoutEffect:L.useEffect,eY=new WeakMap;function Zee(n,t){var s=SNe(null,function(a){return n.forEach(function(l){return C2(l,a)})});return TNe(function(){var a=eY.get(s);if(a){var l=new Set(a),d=new Set(n),p=s.current;l.forEach(function(E){d.has(E)||C2(E,null)}),d.forEach(function(E){l.has(E)||C2(E,p)})}eY.set(s,n)},[n]),s}var I2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Mh=function(){return Mh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Mh.apply(this,arguments)};function HR(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s}function bNe(n,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function ete(n){return n}function tte(n,t){t===void 0&&(t=ete);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(d){var p=t(d,a);return s.push(p),function(){s=s.filter(function(E){return E!==p})}},assignSyncMedium:function(d){for(a=!0;s.length;){var p=s;s=[],p.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var p=[];if(s.length){var E=s;s=[],E.forEach(d),p=s}var v=function(){var w=p;p=[],w.forEach(d)},T=function(){return Promise.resolve().then(v)};T(),s={push:function(w){p.push(w),T()},filter:function(w){return p=p.filter(w),s}}}};return l}function $F(n,t){return t===void 0&&(t=ete),tte(n,t)}function nte(n){n===void 0&&(n={});var t=tte(null);return t.options=Mh({async:!0,ssr:!1},n),t}var rte=function(n){var t=n.sideCar,s=HR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return L.createElement(a,Mh({},s))};rte.isSideCarExport=!0;function wNe(n,t){return n.useMedium(t),rte}var ite=$F({},function(n){var t=n.target,s=n.currentTarget;return{target:t,currentTarget:s}}),ste=$F(),RNe=$F(),CNe=nte({async:!0,ssr:typeof document<"u"}),INe=L.createContext(void 0),ANe=[],KF=L.forwardRef(function(t,s){var a,l=L.useState(),d=l[0],p=l[1],E=L.useRef(),v=L.useRef(!1),T=L.useRef(null),w=L.useState({}),A=w[1],N=t.children,F=t.disabled,j=F===void 0?!1:F,B=t.noFocusGuards,G=B===void 0?!1:B,J=t.persistentFocus,K=J===void 0?!1:J,ne=t.crossFrame,de=ne===void 0?!0:ne,oe=t.autoFocus,_e=oe===void 0?!0:oe;t.allowTextSelection;var Z=t.group,ee=t.className,te=t.whiteList,ce=t.hasPositiveIndices,me=t.shards,he=me===void 0?ANe:me,se=t.as,Se=se===void 0?"div":se,Ve=t.lockProps,tt=Ve===void 0?{}:Ve,ke=t.sideCar,Me=t.returnFocus,Ce=Me===void 0?!1:Me,Xe=t.focusOptions,Ae=t.onActivation,Ie=t.onDeactivation,be=L.useState({}),xe=be[0],We=L.useCallback(function(Ot){var Dt=Ot.captureFocusRestore;if(!T.current){var ve,Ue=(ve=document)==null?void 0:ve.activeElement;T.current=Ue,Ue!==document.body&&(T.current=Dt(Ue))}E.current&&Ae&&Ae(E.current),v.current=!0,A()},[Ae]),Qe=L.useCallback(function(){v.current=!1,Ie&&Ie(E.current),A()},[Ie]),Ze=L.useCallback(function(Ot){var Dt=T.current;if(Dt){var ve=(typeof Dt=="function"?Dt():Dt)||document.body,Ue=typeof Ce=="function"?Ce(ve):Ce;if(Ue){var He=typeof Ue=="object"?Ue:void 0;T.current=null,Ot?Promise.resolve().then(function(){return ve.focus(He)}):ve.focus(He)}}},[Ce]),ut=L.useCallback(function(Ot){v.current&&ite.useMedium(Ot)},[]),it=ste.useMedium,It=L.useCallback(function(Ot){E.current!==Ot&&(E.current=Ot,p(Ot))},[]),yn=SE((a={},a[Qee]=j&&"disabled",a[BU]=Z,a),tt),Vt=G!==!0,ln=Vt&&G!=="tail",xn=Zee([s,It]),Qt=L.useMemo(function(){return{observed:E,shards:he,enabled:!j,active:v.current}},[j,v.current,he,d]);return ti.createElement(L.Fragment,null,Vt&&[ti.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:I2}),ce?ti.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:I2}):null],!j&&ti.createElement(ke,{id:xe,sideCar:CNe,observed:d,disabled:j,persistentFocus:K,crossFrame:de,autoFocus:_e,whiteList:te,shards:he,onActivation:We,onDeactivation:Qe,returnFocus:Ze,focusOptions:Xe,noFocusGuards:G}),ti.createElement(Se,SE({ref:xn},yn,{className:ee,onBlur:it,onFocus:ut}),ti.createElement(INe.Provider,{value:Qt},N)),ln&&ti.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:I2}))});KF.propTypes={};function WU(n,t){return WU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},WU(n,t)}function PNe(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,WU(n,t)}function fR(n){"@babel/helpers - typeof";return fR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fR(n)}function ONe(n,t){if(fR(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var a=s.call(n,t);if(fR(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function kNe(n){var t=ONe(n,"string");return fR(t)=="symbol"?t:t+""}function NNe(n,t,s){return(t=kNe(t))in n?Object.defineProperty(n,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[t]=s,n}function DNe(n,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],p;function E(){p=n(d.map(function(T){return T.props})),t(p)}var v=function(T){PNe(w,T);function w(){return T.apply(this,arguments)||this}w.peek=function(){return p};var A=w.prototype;return A.componentDidMount=function(){d.push(this),E()},A.componentDidUpdate=function(){E()},A.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},A.render=function(){return ti.createElement(l,this.props)},w}(L.PureComponent);return NNe(v,"displayName","SideEffect("+s(l)+")"),v}}var sf=function(n){for(var t=Array(n.length),s=0;s<n.length;++s)t[s]=n[s];return t},bE=function(n){return Array.isArray(n)?n:[n]},ote=function(n){return Array.isArray(n)?n[0]:n},LNe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},ate=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},cte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},xNe=function(n){return n.hasAttribute("inert")},MNe=function(n,t){return!n||cte(n)||!LNe(n)&&!xNe(n)&&t(ate(n))},lte=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=MNe(t,lte.bind(void 0,n));return n.set(t,a),a},UNe=function(n,t){return n&&!cte(n)?jNe(n)?t(ate(n)):!1:!0},ute=function(n,t){var s=n.get(t);if(s!==void 0)return s;var a=UNe(t,ute.bind(void 0,n));return n.set(t,a),a},dte=function(n){return n.dataset},VNe=function(n){return n.tagName==="BUTTON"},hte=function(n){return n.tagName==="INPUT"},fte=function(n){return hte(n)&&n.type==="radio"},FNe=function(n){return!((hte(n)||VNe(n))&&(n.type==="hidden"||n.disabled))},jNe=function(n){var t=n.getAttribute(vNe);return![!0,"true",""].includes(t)},qF=function(n){var t;return!!(n&&(!((t=dte(n))===null||t===void 0)&&t.focusGuard))},zU=function(n){return!qF(n)},BNe=function(n){return!!n},WNe=function(n,t){var s=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=n.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},zNe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},YF=function(n,t,s){return sf(n).map(function(a,l){var d=zNe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(WNe)},GNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],XF=GNe.join(","),HNe="".concat(XF,", [data-focus-guard]"),pte=function(n,t){return sf((n.shadowRoot||n).children).reduce(function(s,a){return s.concat(a.matches(t?HNe:XF)?[a]:[],pte(a))},[])},$Ne=function(n,t){var s;return n instanceof HTMLIFrameElement&&(!((s=n.contentDocument)===null||s===void 0)&&s.body)?i0([n.contentDocument.body],t):[n]},i0=function(n,t){return n.reduce(function(s,a){var l,d=pte(a,t),p=(l=[]).concat.apply(l,d.map(function(E){return $Ne(E,t)}));return s.concat(p,a.parentNode?sf(a.parentNode.querySelectorAll(XF)).filter(function(E){return E===a}):[])},[])},KNe=function(n){var t=n.querySelectorAll("[".concat(yNe,"]"));return sf(t).map(function(s){return i0([s])}).reduce(function(s,a){return s.concat(a)},[])},JF=function(n,t){return sf(n).filter(function(s){return lte(t,s)}).filter(function(s){return FNe(s)})},tY=function(n,t){return t===void 0&&(t=new Map),sf(n).filter(function(s){return ute(t,s)})},QF=function(n,t,s){return YF(JF(i0(n,s),t),!0,s)},pR=function(n,t){return YF(JF(i0(n),t),!1)},qNe=function(n,t){return JF(KNe(n),t)},_E=function(n,t){return n.shadowRoot?_E(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:sf(n.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?_E(l,t):!1}return _E(s,t)})},YNe=function(n){for(var t=new Set,s=n.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(p,E){return!t.has(E)})},mte=function(n){return n.parentNode?mte(n.parentNode):n},ZF=function(n){var t=bE(n);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(BU);return s.push.apply(s,l?YNe(sf(mte(a).querySelectorAll("[".concat(BU,'="').concat(l,'"]:not([').concat(Qee,'="disabled"])')))):[a]),s},[])},XNe=function(n){try{return n()}catch{return}},mR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?mR(t.shadowRoot):t instanceof HTMLIFrameElement&&XNe(function(){return t.contentWindow.document})?mR(t.contentWindow.document):t}},JNe=function(n,t){return n===t},QNe=function(n,t){return!!sf(n.querySelectorAll("iframe")).some(function(s){return JNe(s,t)})},gte=function(n,t){return t===void 0&&(t=mR(ote(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:ZF(n).some(function(s){return _E(s,t)||QNe(s,t)})},ZNe=function(n){n===void 0&&(n=document);var t=mR(n);return t?sf(n.querySelectorAll("[".concat(ENe,"]"))).some(function(s){return _E(s,t)}):!1},e1e=function(n,t){return t.filter(fte).filter(function(s){return s.name===n.name}).filter(function(s){return s.checked})[0]||n},ej=function(n,t){return fte(n)&&n.name?e1e(n,t):n},t1e=function(n){var t=new Set;return n.forEach(function(s){return t.add(ej(s,n))}),n.filter(function(s){return t.has(s)})},nY=function(n){return n[0]&&n.length>1?ej(n[0],n):n[0]},rY=function(n,t){return n.indexOf(ej(t,n))},GU="NEW_FOCUS",n1e=function(n,t,s,a,l){var d=n.length,p=n[0],E=n[d-1],v=qF(a);if(!(a&&n.indexOf(a)>=0)){var T=a!==void 0?s.indexOf(a):-1,w=l?s.indexOf(l):T,A=l?n.indexOf(l):-1;if(T===-1)return A!==-1?A:GU;if(A===-1)return GU;var N=T-w,F=s.indexOf(p),j=s.indexOf(E),B=t1e(s),G=a!==void 0?B.indexOf(a):-1,J=l?B.indexOf(l):G,K=B.filter(function(ee){return ee.tabIndex>=0}),ne=a!==void 0?K.indexOf(a):-1,de=l?K.indexOf(l):ne,oe=ne>=0&&de>=0?de-ne:J-G;if(!N&&A>=0||t.length===0)return A;var _e=rY(n,t[0]),Z=rY(n,t[t.length-1]);if(T<=F&&v&&Math.abs(N)>1)return Z;if(T>=j&&v&&Math.abs(N)>1)return _e;if(N&&Math.abs(oe)>1)return A;if(T<=F)return Z;if(T>j)return _e;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},r1e=function(n){return function(t){var s,a=(s=dte(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},iY=function(n,t,s){var a=n.map(function(d){var p=d.node;return p}),l=tY(a.filter(r1e(s)));return l&&l.length?nY(l):nY(tY(t))},HU=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&HU(n.parentNode.host||n.parentNode,t),t},A2=function(n,t){for(var s=HU(n),a=HU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},_te=function(n,t,s){var a=bE(n),l=bE(t),d=a[0],p=!1;return l.filter(Boolean).forEach(function(E){p=A2(p||E,E)||p,s.filter(Boolean).forEach(function(v){var T=A2(d,v);T&&(!p||_E(T,p)?p=T:p=A2(T,p))})}),p},sY=function(n,t){return n.reduce(function(s,a){return s.concat(qNe(a,t))},[])},i1e=function(n,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),n.map(function(a){return s.get(a)}).filter(BNe)},s1e=function(n,t){var s=mR(bE(n).length>0?document:ote(n).ownerDocument),a=ZF(n).filter(zU),l=_te(s||n,n,a),d=new Map,p=pR(a,d),E=p.filter(function(j){var B=j.node;return zU(B)});if(E[0]){var v=pR([l],d).map(function(j){var B=j.node;return B}),T=i1e(v,E),w=T.map(function(j){var B=j.node;return B}),A=T.filter(function(j){var B=j.tabIndex;return B>=0}).map(function(j){var B=j.node;return B}),N=n1e(w,A,v,s,t);if(N===GU){var F=iY(p,A,sY(a,d))||iY(p,w,sY(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:T[N]}},o1e=function(n){var t=ZF(n).filter(zU),s=_te(n,n,t),a=YF(i0([s],!0),!0,!0),l=i0(t,!1);return a.map(function(d){var p=d.node,E=d.index;return{node:p,index:E,lockItem:l.indexOf(p)>=0,guard:qF(p)}})},tj=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},P2=0,O2=!1,Ete=function(n,t,s){s===void 0&&(s={});var a=s1e(n,t);if(!O2&&a){if(P2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),O2=!0,setTimeout(function(){O2=!1},1);return}P2++,tj(a.node,s.focusOptions),P2--}};function nw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var a1e=function(n){if(!n)return null;for(var t=[],s=n;s&&s!==document.body;)t.push({current:nw(s),parent:nw(s.parentElement),left:nw(s.previousElementSibling),right:nw(s.nextElementSibling)}),s=s.parentElement;return{element:nw(n),stack:t,ownerDocument:n.ownerDocument}},c1e=function(n){var t,s,a,l,d;if(n)for(var p=n.stack,E=n.ownerDocument,v=new Map,T=0,w=p;T<w.length;T++){var A=w[T],N=(t=A.parent)===null||t===void 0?void 0:t.call(A);if(N&&E.contains(N)){for(var F=(s=A.left)===null||s===void 0?void 0:s.call(A),j=A.current(),B=N.contains(j)?j:void 0,G=(a=A.right)===null||a===void 0?void 0:a.call(A),J=QF([N],v),K=(d=(l=B??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:G)!==null&&d!==void 0?d:F;K;){for(var ne=0,de=J;ne<de.length;ne++){var oe=de[ne];if(K!=null&&K.contains(oe.node))return oe.node}K=K.nextElementSibling}if(J.length)return J[0].node}}},yte=function(n){var t=a1e(n);return function(){return c1e(t)}},l1e=function(n,t,s){if(!n||!t)return console.error("no element or scope given"),{};var a=bE(t);if(a.every(function(p){return!_E(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=s?QF(a,new Map):pR(a,new Map),d=l.findIndex(function(p){var E=p.node;return E===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},u1e=function(n,t){var s=t?QF(bE(n),new Map):pR(bE(n),new Map);return{first:s[0],last:s[s.length-1]}},d1e=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},vte=function(n,t,s){t===void 0&&(t={});var a=d1e(t),l=l1e(n,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&tj(d.node,a.focusOptions)}},h1e=function(n,t){t===void 0&&(t={}),vte(n,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},f1e=function(n,t){t===void 0&&(t={}),vte(n,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},Ste=function(n,t,s){var a,l=u1e(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&tj(d.node,t.focusOptions)},p1e=function(n,t){t===void 0&&(t={}),Ste(n,t,"first")},m1e=function(n,t){t===void 0&&(t={}),Ste(n,t,"last")};function nj(n){setTimeout(n,1)}var g1e=function(t){return t&&"current"in t?t.current:t},Tte=function(){return document&&document.activeElement===document.body},_1e=function(){return Tte()||ZNe()},jS=null,zc=null,oY=function(){return null},BS=null,gR=!1,rj=!1,E1e=function(){return!0},y1e=function(t){return(jS.whiteList||E1e)(t)},v1e=function(t,s){BS={observerNode:t,portaledElement:s}},S1e=function(t){return BS&&BS.portaledElement===t};function aY(n,t,s,a){var l=null,d=n;do{var p=a[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var T1e=function(t){return t?!!gR:gR==="meanwhile"},b1e=function n(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&n(t,s.parentNode,a))},w1e=function(t,s){return s.some(function(a){return b1e(t,a,a)})},bte=function(t){return pR(t,new Map)},R1e=function(t){return!bte([t.parentNode]).some(function(s){return s.node===t})},bk=function(){var t=!1;if(jS){var s=jS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,p=s.shards,E=s.crossFrame,v=s.focusOptions,T=s.noFocusGuards,w=a||BS&&BS.portaledElement;if(Tte()&&zc&&zc!==document.body&&(!document.body.contains(zc)||R1e(zc))){var A=oY();A&&A.focus()}var N=document&&document.activeElement;if(w){var F=[w].concat(p.map(g1e).filter(Boolean)),j=function(){if(!T1e(E)||!T||!zc||rj)return!1;var ne=bte(F),de=ne.findIndex(function(oe){var _e=oe.node;return _e===zc});return de===0||de===ne.length-1};if((!N||y1e(N))&&(l||j()||!_1e()||!zc&&d)&&(w&&!(gte(F)||N&&w1e(N,F)||S1e(N))&&(document&&!zc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=Ete(F,zc,{focusOptions:v}),BS={})),zc=document&&document.activeElement,zc!==document.body&&(oY=yte(zc)),gR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,G=o1e(F),J=G.map(function(K){var ne=K.node;return ne}).indexOf(B);J>-1&&(G.filter(function(K){var ne=K.guard,de=K.node;return ne&&de.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),aY(J,G.length,1,G),aY(J,-1,-1,G))}}}return t},wte=function(t){bk()&&t&&(t.stopPropagation(),t.preventDefault())},ij=function(){return nj(bk)},C1e=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||v1e(a,s)},I1e=function(){return null},Rte=function(){rj=!0},Cte=function(){rj=!1,gR="just",nj(function(){gR="meanwhile"})},A1e=function(){document.addEventListener("focusin",wte),document.addEventListener("focusout",ij),window.addEventListener("focus",Rte),window.addEventListener("blur",Cte)},P1e=function(){document.removeEventListener("focusin",wte),document.removeEventListener("focusout",ij),window.removeEventListener("focus",Rte),window.removeEventListener("blur",Cte)};function O1e(n){return n.filter(function(t){var s=t.disabled;return!s})}var Ite={moveFocusInside:Ete,focusInside:gte,focusNextElement:h1e,focusPrevElement:f1e,focusFirstElement:p1e,focusLastElement:m1e,captureFocusRestore:yte};function k1e(n){var t=n.slice(-1)[0];t&&!jS&&A1e();var s=jS,a=s&&t&&t.id===s.id;jS=t,s&&!a&&(s.onDeactivation(),n.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(zc=null,(!a||s.observed!==t.observed)&&t.onActivation(Ite),bk(),nj(bk)):(P1e(),zc=null)}ite.assignSyncMedium(C1e);ste.assignMedium(ij);RNe.assignMedium(function(n){return n(Ite)});const N1e=DNe(O1e,k1e)(I1e);var $U=L.forwardRef(function(t,s){return ti.createElement(KF,SE({sideCar:N1e,ref:s},t))}),Ate=KF.propTypes||{};Ate.sideCar;fNe(Ate,["sideCar"]);$U.propTypes={};const D1e=$U.default??$U,Pte=n=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:p,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:T}=n,w=L.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&uQ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),A=L.useCallback(()=>{var F;(F=s==null?void 0:s.current)==null||F.focus()},[s]),N=l&&!s;return I.jsx(D1e,{crossFrame:T,persistentFocus:v,autoFocus:E,disabled:p,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};Pte.displayName="FocusLock";const[L1e,x1e]=Gi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),ap=Jt((n,t)=>{const s=Zc("FormError",n),a=Qi(n),l=R0();return l!=null&&l.isInvalid?I.jsx(L1e,{value:s,children:I.jsx(Mt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:hn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});ap.displayName="FormErrorMessage";const M1e=Jt((n,t)=>{const s=x1e(),a=R0();if(!(a!=null&&a.isInvalid))return null;const l=hn("chakra-form__error-icon",n.className);return I.jsx(Hn,{ref:t,"aria-hidden":!0,...n,__css:s.icon,className:l,children:I.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});M1e.displayName="FormErrorIcon";const tc=Jt(function(t,s){const a=ku("FormLabel",t),l=Qi(t),{className:d,children:p,requiredIndicator:E=I.jsx(Ote,{}),optionalIndicator:v=null,...T}=l,w=R0(),A=(w==null?void 0:w.getLabelProps(T,s))??{ref:s,...T};return I.jsxs(Mt.label,{...A,className:hn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[p,w!=null&&w.isRequired?E:v]})});tc.displayName="FormLabel";const Ote=Jt(function(t,s){const a=R0(),l=Yee();if(!(a!=null&&a.isRequired))return null;const d=hn("chakra-form__required-indicator",t.className);return I.jsx(Mt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});Ote.displayName="RequiredIndicator";const kte=Jt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:p,column:E,row:v,autoFlow:T,autoRows:w,templateRows:A,autoColumns:N,templateColumns:F,...j}=t,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:T,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:F};return I.jsx(Mt.div,{ref:s,__css:B,...j})});kte.displayName="Grid";const Nte=Jt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:p,minChildWidth:E,...v}=t,T=w0(),w=E?V1e(E,T):F1e(a);return I.jsx(kte,{ref:s,gap:p,columnGap:l,rowGap:d,templateColumns:w,...v})});Nte.displayName="SimpleGrid";function U1e(n){return typeof n=="number"?`${n}px`:n}function V1e(n,t){return eN(n,s=>{const a=Eke("sizes",s,U1e(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function F1e(n){return eN(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function C0(n){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=n,d=L.Children.toArray(n.path),p=Jt((E,v)=>I.jsx(Hn,{ref:v,viewBox:t,...l,...E,children:d.length?d:I.jsx("path",{fill:"currentColor",d:s})}));return p.displayName=a,p}const KU=Jt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...p}=t;return I.jsx("img",{width:a,height:l,ref:s,alt:d,...p})});KU.displayName="NativeImage";const Fh=Jt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:p,align:E,fit:v,loading:T,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...j}=t,B=a!==void 0||l!==void 0,G=T!=null||w||!B,J=$ee({...t,crossOrigin:A,ignoreFallback:G}),K=Kke(J,N),ne={ref:s,objectFit:v,objectPosition:E,...G?j:LR(j,["onError","onLoad"])};return K?l||I.jsx(Mt.img,{as:KU,className:"chakra-image__placeholder",src:a,...ne}):I.jsx(Mt.img,{as:KU,src:d,srcSet:p,crossOrigin:A,loading:T,referrerPolicy:F,className:"chakra-image",...ne})});Fh.displayName="Image";const Ns=Jt(function(t,s){const{htmlSize:a,...l}=t,d=Zc("Input",l),p=Qi(l),E=Xee(p),v=hn("chakra-input",t.className);return I.jsx(Mt.input,{size:a,...E,__css:d.field,ref:s,className:v})});Ns.displayName="Input";Ns.id="Input";const[j1e,B1e]=Gi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),qU=Jt(function(t,s){const a=Zc("Input",t),{children:l,className:d,...p}=Qi(t),E=hn("chakra-input__group",d),v={},T=BV(l),w=a.field;T.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=T.map(N=>{var j,B;const F=Zk({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((B=N.props)==null?void 0:B.variant)||t.variant});return N.type.id!=="Input"?L.cloneElement(N,F):L.cloneElement(N,Object.assign(F,v,N.props))});return I.jsx(Mt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...p,children:I.jsx(j1e,{value:a,children:A})})});qU.displayName="InputGroup";const W1e=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),_N=Jt(function(t,s){const{placement:a="left",...l}=t,d=B1e(),p=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return I.jsx(W1e,{ref:s,__css:v,...l})});_N.id="InputElement";_N.displayName="InputElement";const wk=Jt(function(t,s){const{className:a,...l}=t,d=hn("chakra-input__left-element",a);return I.jsx(_N,{ref:s,placement:"left",className:d,...l})});wk.id="InputLeftElement";wk.displayName="InputLeftElement";const Dte=Jt(function(t,s){const{className:a,...l}=t,d=hn("chakra-input__right-element",a);return I.jsx(_N,{ref:s,placement:"right",className:d,...l})});Dte.id="InputRightElement";Dte.displayName="InputRightElement";const Zh=Jt(function(t,s){const a=ku("Link",t),{className:l,isExternal:d,...p}=Qi(t);return I.jsx(Mt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:hn("chakra-link",l),...p,__css:a})});Zh.displayName="Link";function z1e(n,t,s,a){if(t==null)return a;if(!a)return n.find(p=>s(p).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function G1e(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function H1e(n={}){const{timeout:t=300,preventDefault:s=()=>!0}=n,[a,l]=L.useState([]),d=L.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},t)};L.useEffect(()=>p,[]);function v(T){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(G1e(w)){const A=a.concat(w.key);s(w)&&(w.preventDefault(),w.stopPropagation()),l(A),T(A.join("")),E()}}}return v}var Xc="top",Au="bottom",Pu="right",Jc="left",sj="auto",$R=[Xc,Au,Pu,Jc],s0="start",_R="end",$1e="clippingParents",Lte="viewport",rw="popper",K1e="reference",cY=$R.reduce(function(n,t){return n.concat([t+"-"+s0,t+"-"+_R])},[]),xte=[].concat($R,[sj]).reduce(function(n,t){return n.concat([t,t+"-"+s0,t+"-"+_R])},[]),q1e="beforeRead",Y1e="read",X1e="afterRead",J1e="beforeMain",Q1e="main",Z1e="afterMain",eDe="beforeWrite",tDe="write",nDe="afterWrite",rDe=[q1e,Y1e,X1e,J1e,Q1e,Z1e,eDe,tDe,nDe];function ef(n){return n?(n.nodeName||"").toLowerCase():null}function Dl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function wE(n){var t=Dl(n).Element;return n instanceof t||n instanceof Element}function wu(n){var t=Dl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function oj(n){if(typeof ShadowRoot>"u")return!1;var t=Dl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function iDe(n){var t=n.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!wu(d)||!ef(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(p){var E=l[p];E===!1?d.removeAttribute(p):d.setAttribute(p,E===!0?"":E)}))})}function sDe(n){var t=n.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},p=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=p.reduce(function(v,T){return v[T]="",v},{});!wu(l)||!ef(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const oDe={name:"applyStyles",enabled:!0,phase:"write",fn:iDe,effect:sDe,requires:["computeStyles"]};function $h(n){return n.split("-")[0]}var EE=Math.max,Rk=Math.min,o0=Math.round;function YU(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function Mte(){return!/^((?!chrome|android).)*safari/i.test(YU())}function a0(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&wu(n)&&(l=n.offsetWidth>0&&o0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&o0(a.height)/n.offsetHeight||1);var p=wE(n)?Dl(n):window,E=p.visualViewport,v=!Mte()&&s,T=(a.left+(v&&E?E.offsetLeft:0))/l,w=(a.top+(v&&E?E.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:T+A,bottom:w+N,left:T,x:T,y:w}}function aj(n){var t=a0(n),s=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:s,height:a}}function Ute(n,t){var s=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(s&&oj(s)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Cp(n){return Dl(n).getComputedStyle(n)}function aDe(n){return["table","td","th"].indexOf(ef(n))>=0}function wg(n){return((wE(n)?n.ownerDocument:n.document)||window.document).documentElement}function EN(n){return ef(n)==="html"?n:n.assignedSlot||n.parentNode||(oj(n)?n.host:null)||wg(n)}function lY(n){return!wu(n)||Cp(n).position==="fixed"?null:n.offsetParent}function cDe(n){var t=/firefox/i.test(YU()),s=/Trident/i.test(YU());if(s&&wu(n)){var a=Cp(n);if(a.position==="fixed")return null}var l=EN(n);for(oj(l)&&(l=l.host);wu(l)&&["html","body"].indexOf(ef(l))<0;){var d=Cp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function KR(n){for(var t=Dl(n),s=lY(n);s&&aDe(s)&&Cp(s).position==="static";)s=lY(s);return s&&(ef(s)==="html"||ef(s)==="body"&&Cp(s).position==="static")?t:s||cDe(n)||t}function cj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function $w(n,t,s){return EE(n,Rk(t,s))}function lDe(n,t,s){var a=$w(n,t,s);return a>s?s:a}function Vte(){return{top:0,right:0,bottom:0,left:0}}function Fte(n){return Object.assign({},Vte(),n)}function jte(n,t){return t.reduce(function(s,a){return s[a]=n,s},{})}var uDe=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,Fte(typeof t!="number"?t:jte(t,$R))};function dDe(n){var t,s=n.state,a=n.name,l=n.options,d=s.elements.arrow,p=s.modifiersData.popperOffsets,E=$h(s.placement),v=cj(E),T=[Jc,Pu].indexOf(E)>=0,w=T?"height":"width";if(!(!d||!p)){var A=uDe(l.padding,s),N=aj(d),F=v==="y"?Xc:Jc,j=v==="y"?Au:Pu,B=s.rects.reference[w]+s.rects.reference[v]-p[v]-s.rects.popper[w],G=p[v]-s.rects.reference[v],J=KR(d),K=J?v==="y"?J.clientHeight||0:J.clientWidth||0:0,ne=B/2-G/2,de=A[F],oe=K-N[w]-A[j],_e=K/2-N[w]/2+ne,Z=$w(de,_e,oe),ee=v;s.modifiersData[a]=(t={},t[ee]=Z,t.centerOffset=Z-_e,t)}}function hDe(n){var t=n.state,s=n.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||Ute(t.elements.popper,l)&&(t.elements.arrow=l))}const fDe={name:"arrow",enabled:!0,phase:"main",fn:dDe,effect:hDe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function c0(n){return n.split("-")[1]}var pDe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mDe(n,t){var s=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:o0(s*l)/l||0,y:o0(a*l)/l||0}}function uY(n){var t,s=n.popper,a=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,E=n.position,v=n.gpuAcceleration,T=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=p.x,F=N===void 0?0:N,j=p.y,B=j===void 0?0:j,G=typeof w=="function"?w({x:F,y:B}):{x:F,y:B};F=G.x,B=G.y;var J=p.hasOwnProperty("x"),K=p.hasOwnProperty("y"),ne=Jc,de=Xc,oe=window;if(T){var _e=KR(s),Z="clientHeight",ee="clientWidth";if(_e===Dl(s)&&(_e=wg(s),Cp(_e).position!=="static"&&E==="absolute"&&(Z="scrollHeight",ee="scrollWidth")),_e=_e,l===Xc||(l===Jc||l===Pu)&&d===_R){de=Au;var te=A&&_e===oe&&oe.visualViewport?oe.visualViewport.height:_e[Z];B-=te-a.height,B*=v?1:-1}if(l===Jc||(l===Xc||l===Au)&&d===_R){ne=Pu;var ce=A&&_e===oe&&oe.visualViewport?oe.visualViewport.width:_e[ee];F-=ce-a.width,F*=v?1:-1}}var me=Object.assign({position:E},T&&pDe),he=w===!0?mDe({x:F,y:B},Dl(s)):{x:F,y:B};if(F=he.x,B=he.y,v){var se;return Object.assign({},me,(se={},se[de]=K?"0":"",se[ne]=J?"0":"",se.transform=(oe.devicePixelRatio||1)<=1?"translate("+F+"px, "+B+"px)":"translate3d("+F+"px, "+B+"px, 0)",se))}return Object.assign({},me,(t={},t[de]=K?B+"px":"",t[ne]=J?F+"px":"",t.transform="",t))}function gDe(n){var t=n.state,s=n.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,p=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,T={placement:$h(t.placement),variation:c0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,uY(Object.assign({},T,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:p,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,uY(Object.assign({},T,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const _De={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:gDe,data:{}};var cO={passive:!0};function EDe(n){var t=n.state,s=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,p=a.resize,E=p===void 0?!0:p,v=Dl(t.elements.popper),T=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&T.forEach(function(w){w.addEventListener("scroll",s.update,cO)}),E&&v.addEventListener("resize",s.update,cO),function(){d&&T.forEach(function(w){w.removeEventListener("scroll",s.update,cO)}),E&&v.removeEventListener("resize",s.update,cO)}}const yDe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:EDe,data:{}};var vDe={left:"right",right:"left",bottom:"top",top:"bottom"};function HO(n){return n.replace(/left|right|bottom|top/g,function(t){return vDe[t]})}var SDe={start:"end",end:"start"};function dY(n){return n.replace(/start|end/g,function(t){return SDe[t]})}function lj(n){var t=Dl(n),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function uj(n){return a0(wg(n)).left+lj(n).scrollLeft}function TDe(n,t){var s=Dl(n),a=wg(n),l=s.visualViewport,d=a.clientWidth,p=a.clientHeight,E=0,v=0;if(l){d=l.width,p=l.height;var T=Mte();(T||!T&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:p,x:E+uj(n),y:v}}function bDe(n){var t,s=wg(n),a=lj(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=EE(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=EE(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+uj(n),v=-a.scrollTop;return Cp(l||s).direction==="rtl"&&(E+=EE(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:E,y:v}}function dj(n){var t=Cp(n),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function Bte(n){return["html","body","#document"].indexOf(ef(n))>=0?n.ownerDocument.body:wu(n)&&dj(n)?n:Bte(EN(n))}function Kw(n,t){var s;t===void 0&&(t=[]);var a=Bte(n),l=a===((s=n.ownerDocument)==null?void 0:s.body),d=Dl(a),p=l?[d].concat(d.visualViewport||[],dj(a)?a:[]):a,E=t.concat(p);return l?E:E.concat(Kw(EN(p)))}function XU(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function wDe(n,t){var s=a0(n,!1,t==="fixed");return s.top=s.top+n.clientTop,s.left=s.left+n.clientLeft,s.bottom=s.top+n.clientHeight,s.right=s.left+n.clientWidth,s.width=n.clientWidth,s.height=n.clientHeight,s.x=s.left,s.y=s.top,s}function hY(n,t,s){return t===Lte?XU(TDe(n,s)):wE(t)?wDe(t,s):XU(bDe(wg(n)))}function RDe(n){var t=Kw(EN(n)),s=["absolute","fixed"].indexOf(Cp(n).position)>=0,a=s&&wu(n)?KR(n):n;return wE(a)?t.filter(function(l){return wE(l)&&Ute(l,a)&&ef(l)!=="body"}):[]}function CDe(n,t,s,a){var l=t==="clippingParents"?RDe(n):[].concat(t),d=[].concat(l,[s]),p=d[0],E=d.reduce(function(v,T){var w=hY(n,T,a);return v.top=EE(w.top,v.top),v.right=Rk(w.right,v.right),v.bottom=Rk(w.bottom,v.bottom),v.left=EE(w.left,v.left),v},hY(n,p,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function Wte(n){var t=n.reference,s=n.element,a=n.placement,l=a?$h(a):null,d=a?c0(a):null,p=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case Xc:v={x:p,y:t.y-s.height};break;case Au:v={x:p,y:t.y+t.height};break;case Pu:v={x:t.x+t.width,y:E};break;case Jc:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var T=l?cj(l):null;if(T!=null){var w=T==="y"?"height":"width";switch(d){case s0:v[T]=v[T]-(t[w]/2-s[w]/2);break;case _R:v[T]=v[T]+(t[w]/2-s[w]/2);break}}return v}function ER(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?n.placement:a,d=s.strategy,p=d===void 0?n.strategy:d,E=s.boundary,v=E===void 0?$1e:E,T=s.rootBoundary,w=T===void 0?Lte:T,A=s.elementContext,N=A===void 0?rw:A,F=s.altBoundary,j=F===void 0?!1:F,B=s.padding,G=B===void 0?0:B,J=Fte(typeof G!="number"?G:jte(G,$R)),K=N===rw?K1e:rw,ne=n.rects.popper,de=n.elements[j?K:N],oe=CDe(wE(de)?de:de.contextElement||wg(n.elements.popper),v,w,p),_e=a0(n.elements.reference),Z=Wte({reference:_e,element:ne,placement:l}),ee=XU(Object.assign({},ne,Z)),te=N===rw?ee:_e,ce={top:oe.top-te.top+J.top,bottom:te.bottom-oe.bottom+J.bottom,left:oe.left-te.left+J.left,right:te.right-oe.right+J.right},me=n.modifiersData.offset;if(N===rw&&me){var he=me[l];Object.keys(ce).forEach(function(se){var Se=[Pu,Au].indexOf(se)>=0?1:-1,Ve=[Xc,Au].indexOf(se)>=0?"y":"x";ce[se]+=he[Ve]*Se})}return ce}function IDe(n,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,p=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,T=v===void 0?xte:v,w=c0(a),A=w?E?cY:cY.filter(function(j){return c0(j)===w}):$R,N=A.filter(function(j){return T.indexOf(j)>=0});N.length===0&&(N=A);var F=N.reduce(function(j,B){return j[B]=ER(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[$h(B)],j},{});return Object.keys(F).sort(function(j,B){return F[j]-F[B]})}function ADe(n){if($h(n)===sj)return[];var t=HO(n);return[dY(n),t,dY(t)]}function PDe(n){var t=n.state,s=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,p=s.altAxis,E=p===void 0?!0:p,v=s.fallbackPlacements,T=s.padding,w=s.boundary,A=s.rootBoundary,N=s.altBoundary,F=s.flipVariations,j=F===void 0?!0:F,B=s.allowedAutoPlacements,G=t.options.placement,J=$h(G),K=J===G,ne=v||(K||!j?[HO(G)]:ADe(G)),de=[G].concat(ne).reduce(function(xe,We){return xe.concat($h(We)===sj?IDe(t,{placement:We,boundary:w,rootBoundary:A,padding:T,flipVariations:j,allowedAutoPlacements:B}):We)},[]),oe=t.rects.reference,_e=t.rects.popper,Z=new Map,ee=!0,te=de[0],ce=0;ce<de.length;ce++){var me=de[ce],he=$h(me),se=c0(me)===s0,Se=[Xc,Au].indexOf(he)>=0,Ve=Se?"width":"height",tt=ER(t,{placement:me,boundary:w,rootBoundary:A,altBoundary:N,padding:T}),ke=Se?se?Pu:Jc:se?Au:Xc;oe[Ve]>_e[Ve]&&(ke=HO(ke));var Me=HO(ke),Ce=[];if(d&&Ce.push(tt[he]<=0),E&&Ce.push(tt[ke]<=0,tt[Me]<=0),Ce.every(function(xe){return xe})){te=me,ee=!1;break}Z.set(me,Ce)}if(ee)for(var Xe=j?3:1,Ae=function(We){var Qe=de.find(function(Ze){var ut=Z.get(Ze);if(ut)return ut.slice(0,We).every(function(it){return it})});if(Qe)return te=Qe,"break"},Ie=Xe;Ie>0;Ie--){var be=Ae(Ie);if(be==="break")break}t.placement!==te&&(t.modifiersData[a]._skip=!0,t.placement=te,t.reset=!0)}}const ODe={name:"flip",enabled:!0,phase:"main",fn:PDe,requiresIfExists:["offset"],data:{_skip:!1}};function fY(n,t,s){return s===void 0&&(s={x:0,y:0}),{top:n.top-t.height-s.y,right:n.right-t.width+s.x,bottom:n.bottom-t.height+s.y,left:n.left-t.width-s.x}}function pY(n){return[Xc,Pu,Au,Jc].some(function(t){return n[t]>=0})}function kDe(n){var t=n.state,s=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,p=ER(t,{elementContext:"reference"}),E=ER(t,{altBoundary:!0}),v=fY(p,a),T=fY(E,l,d),w=pY(v),A=pY(T);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:T,isReferenceHidden:w,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const NDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:kDe};function DDe(n,t,s){var a=$h(n),l=[Jc,Xc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:n})):s,p=d[0],E=d[1];return p=p||0,E=(E||0)*l,[Jc,Pu].indexOf(a)>=0?{x:E,y:p}:{x:p,y:E}}function LDe(n){var t=n.state,s=n.options,a=n.name,l=s.offset,d=l===void 0?[0,0]:l,p=xte.reduce(function(w,A){return w[A]=DDe(A,t.rects,d),w},{}),E=p[t.placement],v=E.x,T=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=T),t.modifiersData[a]=p}const xDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:LDe};function MDe(n){var t=n.state,s=n.name;t.modifiersData[s]=Wte({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const UDe={name:"popperOffsets",enabled:!0,phase:"read",fn:MDe,data:{}};function VDe(n){return n==="x"?"y":"x"}function FDe(n){var t=n.state,s=n.options,a=n.name,l=s.mainAxis,d=l===void 0?!0:l,p=s.altAxis,E=p===void 0?!1:p,v=s.boundary,T=s.rootBoundary,w=s.altBoundary,A=s.padding,N=s.tether,F=N===void 0?!0:N,j=s.tetherOffset,B=j===void 0?0:j,G=ER(t,{boundary:v,rootBoundary:T,padding:A,altBoundary:w}),J=$h(t.placement),K=c0(t.placement),ne=!K,de=cj(J),oe=VDe(de),_e=t.modifiersData.popperOffsets,Z=t.rects.reference,ee=t.rects.popper,te=typeof B=="function"?B(Object.assign({},t.rects,{placement:t.placement})):B,ce=typeof te=="number"?{mainAxis:te,altAxis:te}:Object.assign({mainAxis:0,altAxis:0},te),me=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(_e){if(d){var se,Se=de==="y"?Xc:Jc,Ve=de==="y"?Au:Pu,tt=de==="y"?"height":"width",ke=_e[de],Me=ke+G[Se],Ce=ke-G[Ve],Xe=F?-ee[tt]/2:0,Ae=K===s0?Z[tt]:ee[tt],Ie=K===s0?-ee[tt]:-Z[tt],be=t.elements.arrow,xe=F&&be?aj(be):{width:0,height:0},We=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:Vte(),Qe=We[Se],Ze=We[Ve],ut=$w(0,Z[tt],xe[tt]),it=ne?Z[tt]/2-Xe-ut-Qe-ce.mainAxis:Ae-ut-Qe-ce.mainAxis,It=ne?-Z[tt]/2+Xe+ut+Ze+ce.mainAxis:Ie+ut+Ze+ce.mainAxis,yn=t.elements.arrow&&KR(t.elements.arrow),Vt=yn?de==="y"?yn.clientTop||0:yn.clientLeft||0:0,ln=(se=me==null?void 0:me[de])!=null?se:0,xn=ke+it-ln-Vt,Qt=ke+It-ln,Ot=$w(F?Rk(Me,xn):Me,ke,F?EE(Ce,Qt):Ce);_e[de]=Ot,he[de]=Ot-ke}if(E){var Dt,ve=de==="x"?Xc:Jc,Ue=de==="x"?Au:Pu,He=_e[oe],_t=oe==="y"?"height":"width",vt=He+G[ve],St=He-G[Ue],zt=[Xc,Jc].indexOf(J)!==-1,dn=(Dt=me==null?void 0:me[oe])!=null?Dt:0,fn=zt?vt:He-Z[_t]-ee[_t]-dn+ce.altAxis,Xt=zt?He+Z[_t]+ee[_t]-dn-ce.altAxis:St,Bn=F&&zt?lDe(fn,He,Xt):$w(F?fn:vt,He,F?Xt:St);_e[oe]=Bn,he[oe]=Bn-He}t.modifiersData[a]=he}}const jDe={name:"preventOverflow",enabled:!0,phase:"main",fn:FDe,requiresIfExists:["offset"]};function BDe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function WDe(n){return n===Dl(n)||!wu(n)?lj(n):BDe(n)}function zDe(n){var t=n.getBoundingClientRect(),s=o0(t.width)/n.offsetWidth||1,a=o0(t.height)/n.offsetHeight||1;return s!==1||a!==1}function GDe(n,t,s){s===void 0&&(s=!1);var a=wu(t),l=wu(t)&&zDe(t),d=wg(t),p=a0(n,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((ef(t)!=="body"||dj(d))&&(E=WDe(t)),wu(t)?(v=a0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=uj(d))),{x:p.left+E.scrollLeft-v.x,y:p.top+E.scrollTop-v.y,width:p.width,height:p.height}}function HDe(n){var t=new Map,s=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return n.forEach(function(d){s.has(d.name)||l(d)}),a}function $De(n){var t=HDe(n);return rDe.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function KDe(n){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(n())})})),t}}function qDe(n){var t=n.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var mY={placement:"bottom",modifiers:[],strategy:"absolute"};function gY(){for(var n=arguments.length,t=new Array(n),s=0;s<n;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function YDe(n){n===void 0&&(n={});var t=n,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?mY:l;return function(E,v,T){T===void 0&&(T=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},mY,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},A=[],N=!1,F={state:w,setOptions:function(J){var K=typeof J=="function"?J(w.options):J;B(),w.options=Object.assign({},d,w.options,K),w.scrollParents={reference:wE(E)?Kw(E):E.contextElement?Kw(E.contextElement):[],popper:Kw(v)};var ne=$De(qDe([].concat(a,w.options.modifiers)));return w.orderedModifiers=ne.filter(function(de){return de.enabled}),j(),F.update()},forceUpdate:function(){if(!N){var J=w.elements,K=J.reference,ne=J.popper;if(gY(K,ne)){w.rects={reference:GDe(K,KR(ne),w.options.strategy==="fixed"),popper:aj(ne)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(ce){return w.modifiersData[ce.name]=Object.assign({},ce.data)});for(var de=0;de<w.orderedModifiers.length;de++){if(w.reset===!0){w.reset=!1,de=-1;continue}var oe=w.orderedModifiers[de],_e=oe.fn,Z=oe.options,ee=Z===void 0?{}:Z,te=oe.name;typeof _e=="function"&&(w=_e({state:w,options:ee,name:te,instance:F})||w)}}}},update:KDe(function(){return new Promise(function(G){F.forceUpdate(),G(w)})}),destroy:function(){B(),N=!0}};if(!gY(E,v))return F;F.setOptions(T).then(function(G){!N&&T.onFirstUpdate&&T.onFirstUpdate(G)});function j(){w.orderedModifiers.forEach(function(G){var J=G.name,K=G.options,ne=K===void 0?{}:K,de=G.effect;if(typeof de=="function"){var oe=de({state:w,name:J,instance:F,options:ne}),_e=function(){};A.push(oe||_e)}})}function B(){A.forEach(function(G){return G()}),A=[]}return F}}var XDe=[yDe,UDe,_De,oDe,xDe,ODe,jDe,fDe,NDe],JDe=YDe({defaultModifiers:XDe});const aS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),Hs={arrowShadowColor:aS("--popper-arrow-shadow-color"),arrowSize:aS("--popper-arrow-size","8px"),arrowSizeHalf:aS("--popper-arrow-size-half"),arrowBg:aS("--popper-arrow-bg"),transformOrigin:aS("--popper-transform-origin"),arrowOffset:aS("--popper-arrow-offset")};function QDe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const ZDe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},eLe=n=>ZDe[n],_Y={scroll:!0,resize:!0};function tLe(n){let t;return typeof n=="object"?t={enabled:!0,options:{..._Y,...n}}:t={enabled:n,options:_Y},t}const nLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},rLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{EY(n)},effect:({state:n})=>()=>{EY(n)}},EY=n=>{n.elements.popper.style.setProperty(Hs.transformOrigin.var,eLe(n.placement))},iLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{sLe(n)}},sLe=n=>{var s;if(!n.placement)return;const t=oLe(n.placement);if((s=n.elements)!=null&&s.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:Hs.arrowSize.varRef,height:Hs.arrowSize.varRef,zIndex:-1});const a={[Hs.arrowSizeHalf.var]:`calc(${Hs.arrowSize.varRef} / 2 - 1px)`,[Hs.arrowOffset.var]:`calc(${Hs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},oLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Hs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Hs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Hs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Hs.arrowOffset.varRef}},aLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{yY(n)},effect:({state:n})=>()=>{yY(n)}},yY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=QDe(n.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:Hs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},cLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},lLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function uLe(n,t="ltr"){var a;const s=((a=cLe[n])==null?void 0:a[t])||n;return t==="ltr"?s:lLe[n]??s}function hj(n={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:E,gutter:v=8,flip:T=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:F="ltr"}=n,j=L.useRef(null),B=L.useRef(null),G=L.useRef(null),J=uLe(a,F),K=L.useRef(()=>{}),ne=L.useCallback(()=>{var ce;!t||!j.current||!B.current||((ce=K.current)==null||ce.call(K),G.current=JDe(j.current,B.current,{placement:J,modifiers:[aLe,iLe,rLe,{...nLe,enabled:!!N},{name:"eventListeners",...tLe(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!T,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...s??[]],strategy:l}),G.current.forceUpdate(),K.current=G.current.destroy)},[J,t,s,N,p,d,E,v,T,A,w,l]);L.useEffect(()=>()=>{var ce;!j.current&&!B.current&&((ce=G.current)==null||ce.destroy(),G.current=null)},[]);const de=L.useCallback(ce=>{j.current=ce,ne()},[ne]),oe=L.useCallback((ce={},me=null)=>({...ce,ref:Ji(de,me)}),[de]),_e=L.useCallback(ce=>{B.current=ce,ne()},[ne]),Z=L.useCallback((ce={},me=null)=>({...ce,ref:Ji(_e,me),style:{...ce.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,_e,N]),ee=L.useCallback((ce={},me=null)=>{const{size:he,shadowColor:se,bg:Se,style:Ve,...tt}=ce;return{...tt,ref:me,"data-popper-arrow":"",style:dLe(ce)}},[]),te=L.useCallback((ce={},me=null)=>({...ce,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var ce;(ce=G.current)==null||ce.update()},forceUpdate(){var ce;(ce=G.current)==null||ce.forceUpdate()},transformOrigin:Hs.transformOrigin.varRef,referenceRef:de,popperRef:_e,getPopperProps:Z,getArrowProps:ee,getArrowInnerProps:te,getReferenceProps:oe}}function dLe(n){const{size:t,shadowColor:s,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function hLe(){const n=L.useRef(new Map),t=n.current,s=L.useCallback((l,d,p,E)=>{n.current.set(p,{type:d,el:l,options:E}),l.addEventListener(d,p,E)},[]),a=L.useCallback((l,d,p,E)=>{l.removeEventListener(d,p,E),n.current.delete(p)},[]);return L.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function k2(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function zte(n={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:E,onClick:v,onKeyDown:T,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:F,...j}=n,[B,G]=L.useState(!0),[J,K]=L.useState(!1),ne=hLe(),de=ke=>{ke&&ke.tagName!=="BUTTON"&&G(!1)},oe=B?A:A||0,_e=s&&!a,Z=L.useCallback(ke=>{if(s){ke.stopPropagation(),ke.preventDefault();return}ke.currentTarget.focus(),v==null||v(ke)},[s,v]),ee=L.useCallback(ke=>{J&&k2(ke)&&(ke.preventDefault(),ke.stopPropagation(),K(!1),ne.remove(document,"keyup",ee,!1))},[J,ne]),te=L.useCallback(ke=>{if(T==null||T(ke),s||ke.defaultPrevented||ke.metaKey||!k2(ke.nativeEvent)||B)return;const Me=l&&ke.key==="Enter";d&&ke.key===" "&&(ke.preventDefault(),K(!0)),Me&&(ke.preventDefault(),ke.currentTarget.click()),ne.add(document,"keyup",ee,!1)},[s,B,T,l,d,ne,ee]),ce=L.useCallback(ke=>{if(w==null||w(ke),s||ke.defaultPrevented||ke.metaKey||!k2(ke.nativeEvent)||B)return;d&&ke.key===" "&&(ke.preventDefault(),K(!1),ke.currentTarget.click())},[d,B,s,w]),me=L.useCallback(ke=>{ke.button===0&&(K(!1),ne.remove(document,"mouseup",me,!1))},[ne]),he=L.useCallback(ke=>{if(ke.button!==0)return;if(s){ke.stopPropagation(),ke.preventDefault();return}B||K(!0),ke.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",me,!1),p==null||p(ke)},[s,B,p,ne,me]),se=L.useCallback(ke=>{ke.button===0&&(B||K(!1),E==null||E(ke))},[E,B]),Se=L.useCallback(ke=>{if(s){ke.preventDefault();return}N==null||N(ke)},[s,N]),Ve=L.useCallback(ke=>{J&&(ke.preventDefault(),K(!1)),F==null||F(ke)},[J,F]),tt=Ji(t,de);return B?{...j,ref:tt,type:"button","aria-disabled":_e?void 0:s,disabled:_e,onClick:Z,onMouseDown:p,onMouseUp:E,onKeyUp:w,onKeyDown:T,onMouseOver:N,onMouseLeave:F}:{...j,ref:tt,role:"button","data-active":Yn(J),"aria-disabled":s?"true":void 0,tabIndex:_e?void 0:oe,onClick:Z,onMouseDown:he,onMouseUp:se,onKeyUp:ce,onKeyDown:te,onMouseOver:Se,onMouseLeave:Ve}}const[fLe,pLe,mLe,gLe]=Wee(),[_Le,qR]=Gi({strict:!1,name:"MenuContext"});function Gte(n){return(n==null?void 0:n.ownerDocument)??document}function ELe(n){return Gte(n).activeElement===n}function yLe(n={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:E,defaultIsOpen:v,onClose:T,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:j=!1,...B}=n,G=L.useRef(null),J=L.useRef(null),K=L.useRef(!0),ne=mLe(),de=L.useCallback(()=>{requestAnimationFrame(()=>{var be;(be=G.current)==null||be.focus({preventScroll:!1})})},[]),oe=L.useCallback(()=>{const be=setTimeout(()=>{var xe,We;if(l)(xe=l.current)==null||xe.focus();else if(!ne.count())(We=G.current)==null||We.focus({preventScroll:!1});else{const Qe=ne.firstEnabled();Qe&&Se(Qe.index)}});Ce.current.add(be)},[ne,l]),_e=L.useCallback(()=>{const be=setTimeout(()=>{var xe;if(!ne.count())(xe=G.current)==null||xe.focus({preventScroll:!1});else{const We=ne.lastEnabled();We&&Se(We.index)}});Ce.current.add(be)},[ne]),Z=L.useCallback(()=>{w==null||w(),d?oe():de()},[d,oe,de,w]),{isOpen:ee,onOpen:te,onClose:ce,onToggle:me}=bp({isOpen:E,defaultIsOpen:v,onClose:T,onOpen:Z});yQ({enabled:ee&&a,ref:G,handler:be=>{var We,Qe,Ze;const xe=((Qe=(We=be.composedPath)==null?void 0:We.call(be))==null?void 0:Qe[0])??be.target;(Ze=J.current)!=null&&Ze.contains(xe)||ce()}});const he=hj({...B,enabled:ee||j,placement:A,direction:F}),[se,Se]=L.useState(-1);gQ(G,{focusRef:J,visible:ee,shouldFocus:!0});const Ve=pQ({isOpen:ee,ref:G}),[tt,ke]=OEe(t,"menu-button","menu-list"),Me=L.useCallback(()=>{te(),de()},[te,de]),Ce=L.useRef(new Set([]));L.useEffect(()=>{const be=Ce.current;return()=>{be.forEach(xe=>clearTimeout(xe)),be.clear()}},[]),hg(()=>{var be;ee||(Se(-1),(be=G.current)==null||be.scrollTo(0,0))},[ee]),hg(()=>{ee&&se===-1&&de()},[se,ee]),L.useEffect(()=>{var xe;if(!ee)return;const be=ne.item(se);(xe=be==null?void 0:be.node)==null||xe.focus({preventScroll:!K.current})},[ne,se,ee]);const Xe=L.useCallback(()=>{te(),oe()},[oe,te]),Ae=L.useCallback(()=>{K.current=!0,te(),_e()},[te,_e]),Ie=L.useCallback(()=>{var Ze,ut;const be=Gte(G.current),xe=(Ze=G.current)==null?void 0:Ze.contains(be.activeElement);if(!(ee&&!xe))return;const Qe=(ut=ne.item(se))==null?void 0:ut.node;Qe==null||Qe.focus({preventScroll:!K.current})},[ee,se,ne]);return{openAndFocusMenu:Me,openAndFocusFirstItem:Xe,openAndFocusLastItem:Ae,onTransitionEnd:Ie,unstable__animationState:Ve,descendants:ne,popper:he,buttonId:tt,menuId:ke,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:ee,onToggle:me,onOpen:te,onClose:ce,menuRef:G,buttonRef:J,focusedIndex:se,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Se,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function vLe(n={},t=null){const s=qR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:E}=s,v=L.useCallback(T=>{const w=T.key,N={Enter:d,ArrowDown:d,ArrowUp:p}[w];N&&(E.current=!0,T.preventDefault(),T.stopPropagation(),N(T))},[d,p,E]);return{...n,ref:Ji(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Yn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:Zn(n.onClick,a),onKeyDown:Zn(n.onKeyDown,v)}}function JU(n){var t;return wLe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function SLe(n={},t=null){const s=qR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:E,menuId:v,isLazy:T,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=s,F=pLe(),j=H1e({preventDefault:K=>K.key!==" "&&JU(K.target)}),B=L.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,oe={Tab:Z=>Z.preventDefault(),Escape:Z=>{Z.stopPropagation(),E()},ArrowDown:()=>{A.current=!0;const Z=F.nextEnabled(a)??F.firstEnabled();Z&&l(Z.index)},ArrowUp:()=>{A.current=!0;const Z=F.prevEnabled(a)??F.firstEnabled();Z&&l(Z.index)}}[ne];if(oe){K.preventDefault(),oe(K);return}const _e=j(Z=>{const ee=z1e(F.values(),Z,te=>{var ce;return((ce=te==null?void 0:te.node)==null?void 0:ce.textContent)??""},F.item(a));if(ee){const te=F.indexOf(ee.node);l(te)}});JU(K.target)&&_e(K)},[F,a,j,E,l,A]),G=L.useRef(!1);p&&(G.current=!0);const J=WV({wasSelected:G.current,enabled:T,mode:w,isSelected:N.present});return{...n,ref:Ji(d,t),children:J?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Zn(n.onKeyDown,B)}}function TLe(n={}){const{popper:t,isOpen:s}=qR();return t.getPopperProps({...n,style:{visibility:s?"visible":"hidden",...n.style}})}function bLe(n={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:E,isFocusable:v,closeOnSelect:T,type:w,...A}=n,N=qR(),{setFocusedIndex:F,focusedIndex:j,closeOnSelect:B,onClose:G,menuId:J,scrollIntoViewRef:K}=N,ne=L.useRef(null),de=`${J}-menuitem-${L.useId()}`,{index:oe,register:_e}=gLe({disabled:E&&!v}),Z=L.useCallback(Se=>{s==null||s(Se),!E&&(K.current=!1,F(oe))},[F,oe,E,s,K]),ee=L.useCallback(Se=>{a==null||a(Se),ne.current&&!ELe(ne.current)&&Z(Se)},[Z,a]),te=L.useCallback(Se=>{l==null||l(Se),!E&&F(-1)},[F,E,l]),ce=L.useCallback(Se=>{d==null||d(Se),JU(Se.currentTarget)&&(T??B)&&G()},[G,d,B,T]),me=L.useCallback(Se=>{p==null||p(Se),F(oe)},[F,p,oe]),he=oe===j,se=zte({onClick:ce,onFocus:me,onMouseEnter:Z,onMouseMove:ee,onMouseLeave:te,ref:Ji(_e,ne,t),isDisabled:E,isFocusable:v});return{...A,...se,type:w??se.type,id:de,role:"menuitem",tabIndex:he?0:-1}}function wLe(n){if(!RLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function RLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[CLe,I0]=Gi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),yN=n=>{const{children:t}=n,s=Zc("Menu",n),a=Qi(n),{direction:l}=w0(),{descendants:d,...p}=yLe({...a,direction:l}),E=L.useMemo(()=>p,[p]),{isOpen:v,onClose:T,forceUpdate:w}=E;return I.jsx(fLe,{value:d,children:I.jsx(_Le,{value:E,children:I.jsx(CLe,{value:s,children:qc(t,{isOpen:v,onClose:T,forceUpdate:w})})})})};yN.displayName="Menu";const ILe=Jt((n,t)=>{const s=I0();return I.jsx(Mt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),vN=Jt((n,t)=>{const{children:s,as:a,...l}=n,d=vLe(l,t),p=a||ILe;return I.jsx(p,{...d,className:hn("chakra-menu__menu-button",n.className),children:I.jsx(Mt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});vN.displayName="MenuButton";const Hte=Jt((n,t)=>{const s=I0();return I.jsx(Mt.span,{ref:t,...n,__css:s.command,className:"chakra-menu__command"})});Hte.displayName="MenuCommand";const $te=n=>{const{className:t,...s}=n,a=I0();return I.jsx(Mt.hr,{"aria-orientation":"horizontal",className:hn("chakra-menu__divider",t),...s,__css:a.divider})};$te.displayName="MenuDivider";const Kte=n=>{const{className:t,children:s,...a}=n,l=I0(),d=L.Children.only(s),p=L.isValidElement(d)?L.cloneElement(d,{focusable:"false","aria-hidden":!0,className:hn("chakra-menu__icon",d.props.className)}):null,E=hn("chakra-menu__icon-wrapper",t);return I.jsx(Mt.span,{className:E,...a,__css:l.icon,children:p})};Kte.displayName="MenuIcon";const ALe=Jt((n,t)=>{const{type:s,...a}=n,l=I0(),d=a.as||s?s??void 0:"button",p=L.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return I.jsx(Mt.button,{ref:t,type:d,...a,__css:p})}),tg=Jt((n,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,...E}=n,v=bLe(E,t),w=s||l?I.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return I.jsxs(ALe,{...v,className:hn("chakra-menu__menuitem",v.className),children:[s&&I.jsx(Kte,{fontSize:"0.8em",marginEnd:a,children:s}),w,l&&I.jsx(Hte,{marginStart:d,children:l})]})});tg.displayName="MenuItem";const PLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},OLe=Mt(rf.div),SN=Jt(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:p,onTransitionEnd:E,unstable__animationState:v}=qR(),T=SLe(d,s),w=TLe(a),A=I0();return I.jsx(Mt.div,{...w,__css:{zIndex:t.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:I.jsx(OLe,{variants:PLe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...A.list},...l,...T,className:hn("chakra-menu__menu-list",T.className),onUpdate:E,onAnimationComplete:cQ(v.onComplete,T.onAnimationComplete)})})});SN.displayName="MenuList";var kLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},cS=new WeakMap,lO=new WeakMap,uO={},N2=0,qte=function(n){return n&&(n.host||qte(n.parentNode))},NLe=function(n,t){return t.map(function(s){if(n.contains(s))return s;var a=qte(s);return a&&n.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},DLe=function(n,t,s,a){var l=NLe(t,Array.isArray(n)?n:[n]);uO[s]||(uO[s]=new WeakMap);var d=uO[s],p=[],E=new Set,v=new Set(l),T=function(A){!A||E.has(A)||(E.add(A),T(A.parentNode))};l.forEach(T);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(E.has(N))w(N);else try{var F=N.getAttribute(a),j=F!==null&&F!=="false",B=(cS.get(N)||0)+1,G=(d.get(N)||0)+1;cS.set(N,B),d.set(N,G),p.push(N),B===1&&j&&lO.set(N,!0),G===1&&N.setAttribute(s,"true"),j||N.setAttribute(a,"true")}catch(J){console.error("aria-hidden: cannot operate on ",N,J)}})};return w(t),E.clear(),N2++,function(){p.forEach(function(A){var N=cS.get(A)-1,F=d.get(A)-1;cS.set(A,N),d.set(A,F),N||(lO.has(A)||A.removeAttribute(a),lO.delete(A)),F||A.removeAttribute(s)}),N2--,N2||(cS=new WeakMap,cS=new WeakMap,lO=new WeakMap,uO={})}},LLe=function(n,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=kLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),DLe(a,l,s,"aria-hidden")):function(){return null}},xLe=Object.defineProperty,MLe=(n,t,s)=>t in n?xLe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s,ULe=(n,t,s)=>(MLe(n,t+"",s),s);class VLe{constructor(){ULe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const QU=new VLe;function Yte(n,t){const[s,a]=L.useState(0);return L.useEffect(()=>{const l=n.current;if(l){if(t){const d=QU.add(l);a(d)}return()=>{QU.remove(l),a(0)}}},[t,n]),s}function FLe(n){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:E,onEsc:v}=n,T=L.useRef(null),w=L.useRef(null),[A,N,F]=BLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");jLe(T,t&&p);const j=Yte(T,t),B=L.useRef(null),G=L.useCallback(te=>{B.current=te.target},[]),J=L.useCallback(te=>{te.key==="Escape"&&(te.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[K,ne]=L.useState(!1),[de,oe]=L.useState(!1),_e=L.useCallback((te={},ce=null)=>({role:"dialog",...te,ref:Ji(ce,T),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":de?F:void 0,onClick:Zn(te.onClick,me=>me.stopPropagation())}),[F,de,A,N,K]),Z=L.useCallback(te=>{te.stopPropagation(),B.current===te.target&&QU.isTopModal(T.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),ee=L.useCallback((te={},ce=null)=>({...te,ref:Ji(ce,w),onClick:Zn(te.onClick,Z),onKeyDown:Zn(te.onKeyDown,J),onMouseDown:Zn(te.onMouseDown,G)}),[J,G,Z]);return{isOpen:t,onClose:s,headerId:N,bodyId:F,setBodyMounted:oe,setHeaderMounted:ne,dialogRef:T,overlayRef:w,getDialogProps:_e,getDialogContainerProps:ee,index:j}}function jLe(n,t){const s=n.current;L.useEffect(()=>{if(!(!n.current||!t))return LLe(n.current)},[t,n,s])}function BLe(n,...t){const s=L.useId(),a=n||s;return L.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[WLe,A0]=Gi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[zLe,RE]=Gi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),oc=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:j,onCloseComplete:B}=t,G=Zc("Modal",t),K={...FLe(t),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:F};return I.jsx(zLe,{value:K,children:I.jsx(WLe,{value:G,children:I.jsx(S0,{...j,onExitComplete:B,children:K.isOpen&&I.jsx(Ll,{...s,children:a})})})})};oc.displayName="Modal";var $O="right-scroll-bar-position",KO="width-before-scroll-bar",GLe="with-scroll-bars-hidden",HLe="--removed-body-scroll-bar-size",Xte=nte(),D2=function(){},TN=L.forwardRef(function(n,t){var s=L.useRef(null),a=L.useState({onScrollCapture:D2,onWheelCapture:D2,onTouchMoveCapture:D2}),l=a[0],d=a[1],p=n.forwardProps,E=n.children,v=n.className,T=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,F=n.noIsolation,j=n.inert,B=n.allowPinchZoom,G=n.as,J=G===void 0?"div":G,K=n.gapMode,ne=HR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=N,oe=Zee([s,t]),_e=Mh(Mh({},ne),l);return L.createElement(L.Fragment,null,w&&L.createElement(de,{sideCar:Xte,removeScrollBar:T,shards:A,noIsolation:F,inert:j,setCallbacks:d,allowPinchZoom:!!B,lockRef:s,gapMode:K}),p?L.cloneElement(L.Children.only(E),Mh(Mh({},_e),{ref:oe})):L.createElement(J,Mh({},_e,{className:v,ref:oe}),E))});TN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};TN.classNames={fullWidth:KO,zeroRight:$O};var $Le=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function KLe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=$Le();return t&&n.setAttribute("nonce",t),n}function qLe(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function YLe(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var XLe=function(){var n=0,t=null;return{add:function(s){n==0&&(t=KLe())&&(qLe(t,s),YLe(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},JLe=function(){var n=XLe();return function(t,s){L.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},Jte=function(){var n=JLe(),t=function(s){var a=s.styles,l=s.dynamic;return n(a,l),null};return t},QLe={left:0,top:0,right:0,gap:0},L2=function(n){return parseInt(n||"",10)||0},ZLe=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[L2(s),L2(a),L2(l)]},exe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return QLe;var t=ZLe(n),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},txe=Jte(),WS="data-scroll-locked",nxe=function(n,t,s,a){var l=n.left,d=n.top,p=n.right,E=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(GLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(WS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($O,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(KO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat($O," .").concat($O,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(KO," .").concat(KO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(WS,`] {
    `).concat(HLe,": ").concat(E,`px;
  }
`)},vY=function(){var n=parseInt(document.body.getAttribute(WS)||"0",10);return isFinite(n)?n:0},rxe=function(){L.useEffect(function(){return document.body.setAttribute(WS,(vY()+1).toString()),function(){var n=vY()-1;n<=0?document.body.removeAttribute(WS):document.body.setAttribute(WS,n.toString())}},[])},ixe=function(n){var t=n.noRelative,s=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;rxe();var d=L.useMemo(function(){return exe(l)},[l]);return L.createElement(txe,{styles:nxe(d,!t,l,s?"":"!important")})},ZU=!1;if(typeof window<"u")try{var dO=Object.defineProperty({},"passive",{get:function(){return ZU=!0,!0}});window.addEventListener("test",dO,dO),window.removeEventListener("test",dO,dO)}catch{ZU=!1}var lS=ZU?{passive:!1}:!1,sxe=function(n){return n.tagName==="TEXTAREA"},Qte=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!sxe(n)&&s[t]==="visible")},oxe=function(n){return Qte(n,"overflowY")},axe=function(n){return Qte(n,"overflowX")},SY=function(n,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Zte(n,a);if(l){var d=ene(n,a),p=d[1],E=d[2];if(p>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},cxe=function(n){var t=n.scrollTop,s=n.scrollHeight,a=n.clientHeight;return[t,s,a]},lxe=function(n){var t=n.scrollLeft,s=n.scrollWidth,a=n.clientWidth;return[t,s,a]},Zte=function(n,t){return n==="v"?oxe(t):axe(t)},ene=function(n,t){return n==="v"?cxe(t):lxe(t)},uxe=function(n,t){return n==="h"&&t==="rtl"?-1:1},dxe=function(n,t,s,a,l){var d=uxe(n,window.getComputedStyle(t).direction),p=d*a,E=s.target,v=t.contains(E),T=!1,w=p>0,A=0,N=0;do{var F=ene(n,E),j=F[0],B=F[1],G=F[2],J=B-G-d*j;(j||J)&&Zte(n,E)&&(A+=J,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(T=!0),T},hO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},TY=function(n){return[n.deltaX,n.deltaY]},bY=function(n){return n&&"current"in n?n.current:n},hxe=function(n,t){return n[0]===t[0]&&n[1]===t[1]},fxe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},pxe=0,uS=[];function mxe(n){var t=L.useRef([]),s=L.useRef([0,0]),a=L.useRef(),l=L.useState(pxe++)[0],d=L.useState(Jte)[0],p=L.useRef(n);L.useEffect(function(){p.current=n},[n]),L.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=bNe([n.lockRef.current],(n.shards||[]).map(bY),!0).filter(Boolean);return B.forEach(function(G){return G.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(G){return G.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var E=L.useCallback(function(B,G){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var J=hO(B),K=s.current,ne="deltaX"in B?B.deltaX:K[0]-J[0],de="deltaY"in B?B.deltaY:K[1]-J[1],oe,_e=B.target,Z=Math.abs(ne)>Math.abs(de)?"h":"v";if("touches"in B&&Z==="h"&&_e.type==="range")return!1;var ee=SY(Z,_e);if(!ee)return!0;if(ee?oe=Z:(oe=Z==="v"?"h":"v",ee=SY(Z,_e)),!ee)return!1;if(!a.current&&"changedTouches"in B&&(ne||de)&&(a.current=oe),!oe)return!0;var te=a.current||oe;return dxe(te,G,B,te==="h"?ne:de)},[]),v=L.useCallback(function(B){var G=B;if(!(!uS.length||uS[uS.length-1]!==d)){var J="deltaY"in G?TY(G):hO(G),K=t.current.filter(function(oe){return oe.name===G.type&&(oe.target===G.target||G.target===oe.shadowParent)&&hxe(oe.delta,J)})[0];if(K&&K.should){G.cancelable&&G.preventDefault();return}if(!K){var ne=(p.current.shards||[]).map(bY).filter(Boolean).filter(function(oe){return oe.contains(G.target)}),de=ne.length>0?E(G,ne[0]):!p.current.noIsolation;de&&G.cancelable&&G.preventDefault()}}},[]),T=L.useCallback(function(B,G,J,K){var ne={name:B,delta:G,target:J,should:K,shadowParent:gxe(J)};t.current.push(ne),setTimeout(function(){t.current=t.current.filter(function(de){return de!==ne})},1)},[]),w=L.useCallback(function(B){s.current=hO(B),a.current=void 0},[]),A=L.useCallback(function(B){T(B.type,TY(B),B.target,E(B,n.lockRef.current))},[]),N=L.useCallback(function(B){T(B.type,hO(B),B.target,E(B,n.lockRef.current))},[]);L.useEffect(function(){return uS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,lS),document.addEventListener("touchmove",v,lS),document.addEventListener("touchstart",w,lS),function(){uS=uS.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,lS),document.removeEventListener("touchmove",v,lS),document.removeEventListener("touchstart",w,lS)}},[]);var F=n.removeScrollBar,j=n.inert;return L.createElement(L.Fragment,null,j?L.createElement(d,{styles:fxe(l)}):null,F?L.createElement(ixe,{gapMode:n.gapMode}):null)}function gxe(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const _xe=wNe(Xte,mxe);var tne=L.forwardRef(function(n,t){return L.createElement(TN,Mh({},n,{ref:t,sideCar:_xe}))});tne.classNames=TN.classNames;function Exe(n){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:T,lockFocusAcrossFrames:w,isOpen:A}=RE(),[N,F]=lF();L.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const j=Yte(a,A);return I.jsx(Pte,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:I.jsx(tne,{removeScrollBar:!T,allowPinchZoom:p,enabled:j===1&&d,forwardProps:!0,children:n.children})})}const yxe={initial:({offsetX:n,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??gE.enter(mE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const p={x:t,y:n};return{opacity:0,transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,d),...l?{...p,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...p,...a==null?void 0:a.exit}}}}},Aw={initial:"initial",animate:"enter",exit:"exit",variants:yxe},vxe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:p,offsetX:E=0,offsetY:v=8,transition:T,transitionEnd:w,delay:A,animatePresenceProps:N,...F}=t,j=a?l&&a:!0,B=l||a?"enter":"exit",G={offsetX:E,offsetY:v,reverse:d,transition:T,transitionEnd:w,delay:A};return I.jsx(S0,{...N,custom:G,children:j&&I.jsx(rf.div,{ref:s,className:hn("chakra-offset-slide",p),custom:G,...Aw,animate:B,...F})})});vxe.displayName="SlideFade";const Sxe={exit:({reverse:n,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??gE.exit(mE.exit,l)}),enter:({transitionEnd:n,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??gE.enter(mE.enter,s),transitionEnd:n==null?void 0:n.enter})},nne={initial:"exit",animate:"enter",exit:"exit",variants:Sxe},Txe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:p=.95,className:E,transition:v,transitionEnd:T,delay:w,animatePresenceProps:A,...N}=t,F=a?l&&a:!0,j=l||a?"enter":"exit",B={initialScale:p,reverse:d,transition:v,transitionEnd:T,delay:w};return I.jsx(S0,{...A,custom:B,children:F&&I.jsx(rf.div,{ref:s,className:hn("chakra-offset-slide",E),...nne,animate:j,custom:B,...N})})});Txe.displayName="ScaleFade";const bxe={slideInBottom:{...Aw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Aw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Aw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Aw,custom:{offsetX:-16,reverse:!0}},scale:{...nne,custom:{initialScale:.95,reverse:!0}},none:{}},wxe=Mt(rf.section),Rxe=n=>bxe[n||"none"],rne=L.forwardRef((n,t)=>{const{preset:s,motionProps:a=Rxe(s),...l}=n;return I.jsx(wxe,{ref:t,...a,...l})});rne.displayName="ModalTransition";const ac=Jt((n,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...p}=n,{getDialogProps:E,getDialogContainerProps:v}=RE(),T=E(p,t),w=v(l),A=hn("chakra-modal__content",s),N=A0(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:B}=RE();return I.jsx(Exe,{children:I.jsx(Mt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:I.jsx(rne,{preset:B,motionProps:d,className:A,...T,__css:F,children:a})})})});ac.displayName="ModalContent";const ic=Jt((n,t)=>{const{className:s,...a}=n,{bodyId:l,setBodyMounted:d}=RE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=hn("chakra-modal__body",s),E=A0();return I.jsx(Mt.div,{ref:t,className:p,id:l,...a,__css:E.body})});ic.displayName="ModalBody";const el=Jt((n,t)=>{const{onClick:s,className:a,...l}=n,{onClose:d}=RE(),p=hn("chakra-modal__close-btn",a),E=A0();return I.jsx(zF,{ref:t,__css:E.closeButton,className:p,onClick:Zn(s,v=>{v.stopPropagation(),d()}),...l})});el.displayName="ModalCloseButton";const l0=Jt((n,t)=>{const{className:s,...a}=n,l=hn("chakra-modal__footer",s),d=A0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return I.jsx(Mt.footer,{ref:t,...a,__css:p,className:l})});l0.displayName="ModalFooter";const Ou=Jt((n,t)=>{const{className:s,...a}=n,{headerId:l,setHeaderMounted:d}=RE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=hn("chakra-modal__header",s),E=A0(),v={flex:0,...E.header};return I.jsx(Mt.header,{ref:t,className:p,id:l,...a,__css:v})});Ou.displayName="ModalHeader";const Cxe={enter:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??gE.enter(mE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??gE.exit(mE.exit,s),transitionEnd:t==null?void 0:t.exit})},ine={initial:"exit",animate:"enter",exit:"exit",variants:Cxe},Ixe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:p,transitionEnd:E,delay:v,animatePresenceProps:T,...w}=t,A=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:p,transitionEnd:E,delay:v};return I.jsx(S0,{...T,custom:F,children:N&&I.jsx(rf.div,{ref:s,className:hn("chakra-fade",d),custom:F,...ine,animate:A,...w})})});Ixe.displayName="Fade";const Axe=Mt(rf.div),sc=Jt((n,t)=>{const{className:s,transition:a,motionProps:l,...d}=n,p=hn("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...A0().overlay},{motionPreset:T}=RE(),A=l||(T==="none"?{}:ine);return I.jsx(Axe,{...A,__css:v,ref:t,className:p,...d})});sc.displayName="ModalOverlay";function Pxe(n){const{leastDestructiveRef:t,...s}=n;return I.jsx(oc,{...s,initialFocusRef:t})}const Oxe=Jt((n,t)=>I.jsx(ac,{ref:t,role:"alertdialog",...n})),[kxe,bN]=Gi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[Nxe,sne]=Gi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),dS={click:"click",hover:"hover"};function Dxe(n={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:E,arrowShadowColor:v,trigger:T=dS.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:j,...B}=n,{isOpen:G,onClose:J,onOpen:K,onToggle:ne}=bp(n),[de,oe]=L.useState(d);L.useEffect(()=>oe(d),[d]);const _e=L.useRef(null),Z=L.useRef(null),ee=L.useRef(null),te=L.useRef(!1),ce=L.useRef(!1);G&&(ce.current=!0);const[me,he]=L.useState(!1),[se,Se]=L.useState(!1),Ve=L.useId(),tt=l??Ve,[ke,Me,Ce,Xe]=["popover-trigger","popover-content","popover-header","popover-body"].map(Dt=>`${Dt}-${tt}`),{referenceRef:Ae,getArrowProps:Ie,getPopperProps:be,getArrowInnerProps:xe,forceUpdate:We}=hj({...B,enabled:G||!!j}),Qe=pQ({isOpen:G,ref:ee});AEe({enabled:G,ref:Z}),gQ(ee,{focusRef:Z,visible:G,shouldFocus:de&&T===dS.click}),vEe(ee,{focusRef:a,visible:G,shouldFocus:p&&T===dS.click}),yQ({enabled:G&&t,ref:ee,handler(Dt){var Ue;const ve=((Ue=Dt.composedPath)==null?void 0:Ue.call(Dt)[0])??[Dt.target];fO(Z.current,ve)||(ve&&oe(!lk(ve)),J())}});const Ze=WV({wasSelected:ce.current,enabled:N,mode:F,isSelected:Qe.present}),ut=L.useCallback((Dt={},ve=null)=>{const Ue={...Dt,style:{...Dt.style,transformOrigin:Hs.transformOrigin.varRef,[Hs.arrowSize.var]:E?`${E}px`:void 0,[Hs.arrowShadowColor.var]:v},ref:Ji(ee,ve),children:Ze?Dt.children:null,id:Me,tabIndex:-1,role:"dialog",onKeyDown:Zn(Dt.onKeyDown,He=>{He.nativeEvent.isComposing||s&&He.key==="Escape"&&(He.preventDefault(),He.stopPropagation(),J())}),onBlur:Zn(Dt.onBlur,He=>{const _t=wY(He),vt=fO(ee.current,_t),St=fO(Z.current,_t),zt=!vt&&!St;_t&&oe(!lk(_t)),G&&t&&zt&&J()}),"aria-labelledby":me?Ce:void 0,"aria-describedby":se?Xe:void 0};return T===dS.hover&&(Ue.role="tooltip",Ue.onMouseEnter=Zn(Dt.onMouseEnter,()=>{te.current=!0}),Ue.onMouseLeave=Zn(Dt.onMouseLeave,He=>{He.nativeEvent.relatedTarget!==null&&(te.current=!1,setTimeout(()=>J(),A))})),Ue},[Ze,Me,me,Ce,se,Xe,T,s,J,G,t,A,v,E]),it=L.useCallback((Dt={},ve=null)=>be({...Dt,style:{visibility:G?"visible":"hidden",...Dt.style}},ve),[G,be]),It=L.useCallback((Dt,ve=null)=>({...Dt,ref:Ji(ve,_e,Ae)}),[_e,Ae]),yn=L.useRef(void 0),Vt=L.useRef(void 0),ln=L.useCallback(Dt=>{_e.current==null&&Ae(Dt)},[Ae]),xn=L.useCallback((Dt={},ve=null)=>{const Ue={...Dt,ref:Ji(Z,ve,ln),id:ke,"aria-haspopup":"dialog","aria-expanded":G,"aria-controls":Me};return T===dS.click&&(Ue.onClick=Zn(Dt.onClick,ne)),T===dS.hover&&(Ue.onFocus=Zn(Dt.onFocus,()=>{yn.current===void 0&&K()}),Ue.onBlur=Zn(Dt.onBlur,He=>{const _t=wY(He),vt=!fO(ee.current,_t);G&&t&&vt&&J()}),Ue.onKeyDown=Zn(Dt.onKeyDown,He=>{He.key==="Escape"&&J()}),Ue.onMouseEnter=Zn(Dt.onMouseEnter,()=>{te.current=!0,yn.current=window.setTimeout(()=>K(),w)}),Ue.onMouseLeave=Zn(Dt.onMouseLeave,()=>{te.current=!1,yn.current&&(clearTimeout(yn.current),yn.current=void 0),Vt.current=window.setTimeout(()=>{te.current===!1&&J()},A)})),Ue},[ke,G,Me,T,ln,ne,K,t,J,w,A]);L.useEffect(()=>()=>{yn.current&&clearTimeout(yn.current),Vt.current&&clearTimeout(Vt.current)},[]);const Qt=L.useCallback((Dt={},ve=null)=>({...Dt,id:Ce,ref:Ji(ve,Ue=>{he(!!Ue)})}),[Ce]),Ot=L.useCallback((Dt={},ve=null)=>({...Dt,id:Xe,ref:Ji(ve,Ue=>{Se(!!Ue)})}),[Xe]);return{forceUpdate:We,isOpen:G,onAnimationComplete:Qe.onComplete,onClose:J,getAnchorProps:It,getArrowProps:Ie,getArrowInnerProps:xe,getPopoverPositionerProps:it,getPopoverProps:ut,getTriggerProps:xn,getHeaderProps:Qt,getBodyProps:Ot}}function fO(n,t){return n===t||(n==null?void 0:n.contains(t))}function wY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function one(n){const t=Zc("Popover",n),{children:s,...a}=Qi(n),l=w0(),d=Dxe({...a,direction:l.direction});return I.jsx(kxe,{value:d,children:I.jsx(Nxe,{value:t,children:qc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}one.displayName="Popover";function ane(n){var s;const t=L.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(s=n==null?void 0:n.props)==null?void 0:s.ref}const cne=Jt(function(t,s){const{getBodyProps:a}=bN(),l=sne();return I.jsx(Mt.div,{...a(t,s),className:hn("chakra-popover__body",t.className),__css:l.body})});cne.displayName="PopoverBody";function Lxe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const xxe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},Mxe=Mt(rf.section),lne=Jt(function(t,s){const{variants:a=xxe,...l}=t,{isOpen:d}=bN();return I.jsx(Mxe,{ref:s,variants:Lxe(a),initial:!1,animate:d?"enter":"exit",...l})});lne.displayName="PopoverTransition";const une=Jt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:p,getPopoverPositionerProps:E,onAnimationComplete:v}=bN(),T=sne(),w={position:"relative",display:"flex",flexDirection:"column",...T.content};return I.jsx(Mt.div,{...E(a),__css:T.popper,className:"chakra-popover__popper",children:I.jsx(lne,{...l,...p(d,s),onAnimationComplete:cQ(v,d.onAnimationComplete),className:hn("chakra-popover__content",t.className),__css:w})})});une.displayName="PopoverContent";function dne(n){const t=L.Children.only(n.children),{getTriggerProps:s}=bN();return I.jsx(I.Fragment,{children:L.cloneElement(t,s(t.props,ane(t)))})}dne.displayName="PopoverTrigger";function Uxe(n,t,s){return(n-t)*100/(s-t)}VR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});VR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const Vxe=VR({"0%":{left:"-40%"},"100%":{left:"100%"}}),Fxe=VR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function jxe(n){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:p,role:E="progressbar"}=n,v=Uxe(t,s,a);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":p?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[Bxe,Wxe]=Gi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),zxe=Jt((n,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:p,...E}=n,v=jxe({value:l,min:s,max:a,isIndeterminate:d,role:p}),w={height:"100%",...Wxe().filledTrack};return I.jsx(Mt.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:w})}),u0=Jt((n,t)=>{var Z;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:p,children:E,borderRadius:v,isIndeterminate:T,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:F,role:j,...B}=Qi(n),G=Zc("Progress",n),J=v??((Z=G.track)==null?void 0:Z.borderRadius),K={animation:`${Fxe} 1s linear infinite`},oe={...!T&&d&&p&&K,...T&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${Vxe} 1s ease infinite normal none running`}},_e={overflow:"hidden",position:"relative",...G.track};return I.jsx(Mt.div,{ref:t,borderRadius:J,__css:_e,...B,children:I.jsxs(Bxe,{value:G,children:[I.jsx(zxe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:T,css:oe,borderRadius:J,title:F,role:j}),E]})})});u0.displayName="Progress";const hne=Jt(function(t,s){const{children:a,placeholder:l,className:d,...p}=t;return I.jsxs(Mt.select,{...p,ref:s,className:hn("chakra-select",d),children:[l&&I.jsx("option",{value:"",children:l}),a]})});hne.displayName="SelectField";const fne=Jt((n,t)=>{var ne;const s=Zc("Select",n),{rootProps:a,placeholder:l,icon:d,color:p,height:E,h:v,minH:T,minHeight:w,iconColor:A,iconSize:N,...F}=Qi(n),[j,B]=pEe(F,Aye),G=Xee(B),J={width:"100%",height:"fit-content",position:"relative",color:p},K={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(ne=s.field)==null?void 0:ne._focus}};return I.jsxs(Mt.div,{className:"chakra-select__wrapper",__css:J,...j,...a,children:[I.jsx(hne,{ref:t,height:v??E,minH:T??w,placeholder:l,...G,__css:K,children:n.children}),I.jsx(pne,{"data-disabled":Yn(G.disabled),...(A||p)&&{color:A||p},__css:s.icon,...N&&{fontSize:N},children:d})]})});fne.displayName="Select";const Gxe=n=>I.jsx("svg",{viewBox:"0 0 24 24",...n,children:I.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Hxe=Mt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),pne=n=>{const{children:t=I.jsx(Gxe,{}),...s}=n,a=L.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return I.jsx(Hxe,{...s,className:"chakra-select__icon-wrapper",children:L.isValidElement(t)?a:null})};pne.displayName="SelectIcon";function x2(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function $xe(n){const{orientation:t,thumbPercents:s,isReversed:a}=n,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...x2({orientation:t,vertical:{bottom:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...x2({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],T=E?v:s;let w=T[0];!E&&a&&(w=100-w);const A=Math.abs(T[T.length-1]-T[0]),N={...p,...x2({orientation:t,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function Kxe(n){const{isReversed:t,direction:s,orientation:a}=n;return s==="ltr"||a==="vertical"?t:!t}function qxe(n){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:p,direction:E="ltr",orientation:v="horizontal",id:T,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:F,step:j=1,getAriaValueText:B,"aria-valuetext":G,"aria-label":J,"aria-labelledby":K,name:ne,focusThumbOnChange:de=!0,...oe}=n,_e=Yc(N),Z=Yc(F),ee=Yc(B),te=Kxe({isReversed:p,direction:E,orientation:v}),[ce,me]=mQ({value:l,defaultValue:d??Xxe(t,s),onChange:a}),[he,se]=L.useState(!1),[Se,Ve]=L.useState(!1),tt=!(w||A),ke=(s-t)/10,Me=j||(s-t)/100,Ce=VM(ce,t,s),Xe=s-Ce+t,Ie=M$(te?Xe:Ce,t,s),be=v==="vertical",xe=EQ({min:t,max:s,step:j,isDisabled:w,value:Ce,isInteractive:tt,isReversed:te,isVertical:be,eventSource:null,focusThumbOnChange:de,orientation:v}),We=L.useRef(null),Qe=L.useRef(null),Ze=L.useRef(null),ut=L.useId(),it=T??ut,[It,yn]=[`slider-thumb-${it}`,`slider-track-${it}`],Vt=L.useCallback(jt=>{var uo;if(!We.current)return;const an=xe.current;an.eventSource="pointer";const Zi=We.current.getBoundingClientRect(),{clientX:Ms,clientY:qs}=((uo=jt.touches)==null?void 0:uo[0])??jt,hi=be?Zi.bottom-qs:Ms-Zi.left,Ma=be?Zi.height:Zi.width;let tl=hi/Ma;te&&(tl=1-tl);let lo=uEe(tl,an.min,an.max);return an.step&&(lo=parseFloat(U$(lo,an.min,an.step))),lo=VM(lo,an.min,an.max),lo},[be,te,xe]),ln=L.useCallback(jt=>{const an=xe.current;an.isInteractive&&(jt=parseFloat(U$(jt,an.min,Me)),jt=VM(jt,an.min,an.max),me(jt))},[Me,me,xe]),xn=L.useMemo(()=>({stepUp(jt=Me){const an=te?Ce-jt:Ce+jt;ln(an)},stepDown(jt=Me){const an=te?Ce+jt:Ce-jt;ln(an)},reset(){ln(d||0)},stepTo(jt){ln(jt)}}),[ln,te,Ce,Me,d]),Qt=L.useCallback(jt=>{const an=xe.current,Ms={ArrowRight:()=>xn.stepUp(),ArrowUp:()=>xn.stepUp(),ArrowLeft:()=>xn.stepDown(),ArrowDown:()=>xn.stepDown(),PageUp:()=>xn.stepUp(ke),PageDown:()=>xn.stepDown(ke),Home:()=>ln(an.min),End:()=>ln(an.max)}[jt.key];Ms&&(jt.preventDefault(),jt.stopPropagation(),Ms(jt),an.eventSource="keyboard")},[xn,ln,ke,xe]),Ot=(ee==null?void 0:ee(Ce))??G,{getThumbStyle:Dt,rootStyle:ve,trackStyle:Ue,innerTrackStyle:He}=L.useMemo(()=>{const jt=xe.current;return $xe({isReversed:te,orientation:jt.orientation,thumbPercents:[Ie]})},[te,Ie,xe]),_t=L.useCallback(()=>{xe.current.focusThumbOnChange&&setTimeout(()=>{var an;return(an=Qe.current)==null?void 0:an.focus()})},[xe]);hg(()=>{const jt=xe.current;_t(),jt.eventSource==="keyboard"&&(Z==null||Z(jt.value))},[Ce,Z]);function vt(jt){const an=Vt(jt);an!=null&&an!==xe.current.value&&me(an)}qEe(Ze,{onPanSessionStart(jt){const an=xe.current;an.isInteractive&&(se(!0),_t(),vt(jt),_e==null||_e(an.value))},onPanSessionEnd(){const jt=xe.current;jt.isInteractive&&(se(!1),Z==null||Z(jt.value))},onPan(jt){xe.current.isInteractive&&vt(jt)}});const St=L.useCallback((jt={},an=null)=>({...jt,...oe,ref:Ji(an,Ze),tabIndex:-1,"aria-disabled":kS(w),"data-focused":Yn(Se),style:{...jt.style,...ve}}),[oe,w,Se,ve]),zt=L.useCallback((jt={},an=null)=>({...jt,ref:Ji(an,We),id:yn,"data-disabled":Yn(w),style:{...jt.style,...Ue}}),[w,yn,Ue]),dn=L.useCallback((jt={},an=null)=>({...jt,ref:an,style:{...jt.style,...He}}),[He]),fn=L.useCallback((jt={},an=null)=>({...jt,ref:Ji(an,Qe),role:"slider",tabIndex:tt?0:void 0,id:It,"data-active":Yn(he),"aria-valuetext":Ot,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":Ce,"aria-orientation":v,"aria-disabled":kS(w),"aria-readonly":kS(A),"aria-label":J,"aria-labelledby":J?void 0:K,style:{...jt.style,...Dt(0)},onKeyDown:Zn(jt.onKeyDown,Qt),onFocus:Zn(jt.onFocus,()=>Ve(!0)),onBlur:Zn(jt.onBlur,()=>Ve(!1))}),[tt,It,he,Ot,t,s,Ce,v,w,A,J,K,Dt,Qt]),Xt=L.useCallback((jt,an=null)=>{const Zi=!(jt.value<t||jt.value>s),Ms=Ce>=jt.value,qs=M$(jt.value,t,s),hi={position:"absolute",pointerEvents:"none",...Yxe({orientation:v,vertical:{bottom:te?`${100-qs}%`:`${qs}%`},horizontal:{left:te?`${100-qs}%`:`${qs}%`}})};return{...jt,ref:an,role:"presentation","aria-hidden":!0,"data-disabled":Yn(w),"data-invalid":Yn(!Zi),"data-highlighted":Yn(Ms),style:{...jt.style,...hi}}},[w,te,s,t,v,Ce]),Bn=L.useCallback((jt={},an=null)=>({...jt,ref:an,type:"hidden",value:Ce,name:ne}),[ne,Ce]);return{state:{value:Ce,isFocused:Se,isDragging:he},actions:xn,getRootProps:St,getTrackProps:zt,getInnerTrackProps:dn,getThumbProps:fn,getMarkerProps:Xt,getInputProps:Bn}}function Yxe(n){const{orientation:t,vertical:s,horizontal:a}=n;return t==="vertical"?s:a}function Xxe(n,t){return t<n?n:n+(t-n)/2}const[Jxe,wN]=Gi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[Qxe,RN]=Gi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),eV=Jt((n,t)=>{const s={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=Zc("Slider",s),l=Qi(s),{direction:d}=w0();l.direction=d;const{getInputProps:p,getRootProps:E,...v}=qxe(l),T=E(),w=p({},t);return I.jsx(Jxe,{value:v,children:I.jsx(Qxe,{value:a,children:I.jsxs(Mt.div,{...T,className:hn("chakra-slider",s.className),__css:a.container,children:[s.children,I.jsx("input",{...w})]})})})});eV.displayName="Slider";const tV=Jt((n,t)=>{const{getThumbProps:s}=wN(),a=RN(),l=s(n,t);return I.jsx(Mt.div,{...l,className:hn("chakra-slider__thumb",n.className),__css:a.thumb})});tV.displayName="SliderThumb";const nV=Jt((n,t)=>{const{getTrackProps:s}=wN(),a=RN(),l=s(n,t);return I.jsx(Mt.div,{...l,className:hn("chakra-slider__track",n.className),__css:a.track})});nV.displayName="SliderTrack";const rV=Jt((n,t)=>{const{getInnerTrackProps:s}=wN(),a=RN(),l=s(n,t);return I.jsx(Mt.div,{...l,className:hn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});rV.displayName="SliderFilledTrack";const Zxe=Jt((n,t)=>{const{getMarkerProps:s}=wN(),a=RN(),l=s(n,t);return I.jsx(Mt.div,{...l,className:hn("chakra-slider__marker",n.className),__css:a.mark})});Zxe.displayName="SliderMark";const Ck=Mt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Ck.displayName="Spacer";const mne=n=>I.jsx(Mt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});mne.displayName="StackItem";function eMe(n){const{spacing:t,direction:s}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":eN(s,l=>a[l])}}const fj=Jt((n,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:p="0.5rem",wrap:E,children:v,divider:T,className:w,shouldWrapChildren:A,...N}=n,F=s?"row":a??"column",j=L.useMemo(()=>eMe({spacing:p,direction:F}),[p,F]),B=!!T,G=!A&&!B,J=L.useMemo(()=>{const ne=BV(v);return G?ne:ne.map((de,oe)=>{const _e=typeof de.key<"u"?de.key:oe,Z=oe+1===ne.length,te=A?I.jsx(mne,{children:de},_e):de;if(!B)return te;const ce=L.cloneElement(T,{__css:j}),me=Z?null:ce;return I.jsxs(L.Fragment,{children:[te,me]},_e)})},[T,j,B,G,A,v]),K=hn("chakra-stack",w);return I.jsx(Mt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:B?void 0:p,className:K,...N,children:J})});fj.displayName="Stack";const Ai=Jt((n,t)=>I.jsx(fj,{align:"center",...n,direction:"row",ref:t}));Ai.displayName="HStack";const di=Jt((n,t)=>I.jsx(fj,{align:"center",...n,direction:"column",ref:t}));di.displayName="VStack";const ig=Jt(function(t,s){const a=Zc("Switch",t),{spacing:l="0.5rem",children:d,...p}=Qi(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:T,getRootProps:w,getLabelProps:A}=dNe(p),N=L.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=L.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=L.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return I.jsxs(Mt.label,{...w(),className:hn("chakra-switch",t.className),__css:N,children:[I.jsx("input",{className:"chakra-switch__input",...v({},s)}),I.jsx(Mt.span,{...T(),className:"chakra-switch__track",__css:F,children:I.jsx(Mt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&I.jsx(Mt.span,{className:"chakra-switch__label",...A(),__css:j,children:d})]})});ig.displayName="Switch";const[tMe,nMe,rMe,iMe]=Wee();function sMe(n){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:E="horizontal",direction:v="ltr",...T}=n,[w,A]=L.useState(t??0),[N,F]=mQ({defaultValue:t??0,value:a,onChange:s});L.useEffect(()=>{a!=null&&A(a)},[a]);const j=rMe(),B=L.useId();return{id:`tabs-${n.id??B}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:F,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:p,orientation:E,descendants:j,direction:v,htmlProps:T}}const[oMe,CN]=Gi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function aMe(n){const{focusedIndex:t,orientation:s,direction:a}=CN(),l=nMe(),d=L.useCallback(p=>{const E=()=>{var ne;const K=l.nextEnabled(t);K&&((ne=K.node)==null||ne.focus())},v=()=>{var ne;const K=l.prevEnabled(t);K&&((ne=K.node)==null||ne.focus())},T=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},w=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},A=s==="horizontal",N=s==="vertical",F=p.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",J={[j]:()=>A&&v(),[B]:()=>A&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:T,End:w}[F];J&&(p.preventDefault(),J(p))},[l,t,s,a]);return{...n,role:"tablist","aria-orientation":s,onKeyDown:Zn(n.onKeyDown,d)}}function cMe(n){const{isDisabled:t=!1,isFocusable:s=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:E,selectedIndex:v}=CN(),{index:T,register:w}=iMe({disabled:t&&!s}),A=T===v,N=()=>{l(T)},F=()=>{E(T),!d&&!(t&&s)&&l(T)};return{...zte({...a,ref:Ji(w,n.ref),isDisabled:t,isFocusable:s,onClick:Zn(n.onClick,N)}),id:gne(p,T),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":_ne(p,T),onFocus:t?void 0:Zn(n.onFocus,F)}}const[lMe,uMe]=Gi({});function dMe(n){const t=CN(),{id:s,selectedIndex:a}=t,d=BV(n.children).map((p,E)=>L.createElement(lMe,{key:p.key??E,value:{isSelected:E===a,id:_ne(s,E),tabId:gne(s,E),selectedIndex:a}},p));return{...n,children:d}}function hMe(n){const{children:t,...s}=n,{isLazy:a,lazyBehavior:l}=CN(),{isSelected:d,id:p,tabId:E}=uMe(),v=L.useRef(!1);d&&(v.current=!0);const T=WV({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:T?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:p}}function gne(n,t){return`${n}--tab-${t}`}function _ne(n,t){return`${n}--tabpanel-${t}`}const[fMe,IN]=Gi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),YR=Jt(function(t,s){const a=Zc("Tabs",t),{children:l,className:d,...p}=Qi(t),{htmlProps:E,descendants:v,...T}=sMe(p),w=L.useMemo(()=>T,[T]),{isFitted:A,...N}=E,F={position:"relative",...a.root};return I.jsx(tMe,{value:v,children:I.jsx(oMe,{value:w,children:I.jsx(fMe,{value:a,children:I.jsx(Mt.div,{className:hn("chakra-tabs",d),ref:s,...N,__css:F,children:l})})})})});YR.displayName="Tabs";const Cl=Jt(function(t,s){const a=IN(),l=cMe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return I.jsx(Mt.button,{...l,className:hn("chakra-tabs__tab",t.className),__css:d})});Cl.displayName="Tab";const XR=Jt(function(t,s){const a=aMe({...t,ref:s}),l=IN(),d={display:"flex",...l.tablist};return I.jsx(Mt.div,{...a,className:hn("chakra-tabs__tablist",t.className),__css:d})});XR.displayName="TabList";const Rd=Jt(function(t,s){const a=hMe({...t,ref:s}),l=IN();return I.jsx(Mt.div,{outline:"0",...a,className:hn("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Rd.displayName="TabPanel";const AN=Jt(function(t,s){const a=dMe(t),l=IN();return I.jsx(Mt.div,{...a,width:"100%",ref:s,className:hn("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});AN.displayName="TabPanels";function pMe(n,t){const s=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function mMe(n,t){const s=l=>({...t,...l,position:pMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=s(l),p=Fee(d);return xh.notify(p,d)};return a.update=(l,d)=>{xh.update(l,s(d))},a.promise=(l,d)=>{const p=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(p,{status:"success",duration:5e3,...qc(d.success,E)})).catch(E=>a.update(p,{status:"error",duration:5e3,...qc(d.error,E)}))},a.closeAll=xh.closeAll,a.close=xh.close,a.isActive=xh.isActive,a}function kd(n){const{theme:t}=Mee(),s=Uke();return L.useMemo(()=>mMe(t.direction,{...s,...n}),[n,t.direction,s])}const gMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},iV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},qO=n=>{var t,s;return((s=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function _Me(n={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:E=!0,onOpen:v,onClose:T,placement:w,id:A,isOpen:N,defaultIsOpen:F,arrowSize:j=10,arrowShadowColor:B,arrowPadding:G,modifiers:J,isDisabled:K,gutter:ne,offset:de,direction:oe,..._e}=n,{isOpen:Z,onOpen:ee,onClose:te}=bp({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:T}),{referenceRef:ce,getPopperProps:me,getArrowInnerProps:he,getArrowProps:se}=hj({enabled:Z,placement:w,arrowPadding:G,modifiers:J,gutter:ne,offset:de,direction:oe}),Se=L.useId(),tt=`tooltip-${A??Se}`,ke=L.useRef(null),Me=L.useRef(void 0),Ce=L.useCallback(()=>{Me.current&&(clearTimeout(Me.current),Me.current=void 0)},[]),Xe=L.useRef(void 0),Ae=L.useCallback(()=>{Xe.current&&(clearTimeout(Xe.current),Xe.current=void 0)},[]),Ie=L.useCallback(()=>{Ae(),te()},[te,Ae]),be=EMe(ke,Ie),xe=L.useCallback(()=>{if(!K&&!Me.current){Z&&be();const Vt=qO(ke);Me.current=Vt.setTimeout(ee,t)}},[be,K,Z,ee,t]),We=L.useCallback(()=>{Ce();const Vt=qO(ke);Xe.current=Vt.setTimeout(Ie,s)},[s,Ie,Ce]),Qe=L.useCallback(()=>{Z&&a&&We()},[a,We,Z]),Ze=L.useCallback(()=>{Z&&p&&We()},[p,We,Z]),ut=L.useCallback(Vt=>{Z&&Vt.key==="Escape"&&We()},[Z,We]);NS(()=>iV(ke),"keydown",E?ut:void 0),NS(()=>{if(!d)return null;const Vt=ke.current;if(!Vt)return null;const ln=fQ(Vt);return ln.localName==="body"?qO(ke):ln},"scroll",()=>{Z&&d&&Ie()},{passive:!0,capture:!0}),L.useEffect(()=>{K&&(Ce(),Z&&te())},[K,Z,te,Ce]),L.useEffect(()=>()=>{Ce(),Ae()},[Ce,Ae]),NS(()=>ke.current,"pointerleave",We);const it=L.useCallback((Vt={},ln=null)=>({...Vt,ref:Ji(ke,ln,ce),onPointerEnter:Zn(Vt.onPointerEnter,Qt=>{Qt.pointerType!=="touch"&&xe()}),onClick:Zn(Vt.onClick,Qe),onPointerDown:Zn(Vt.onPointerDown,Ze),onFocus:Zn(Vt.onFocus,xe),onBlur:Zn(Vt.onBlur,We),"aria-describedby":Z?tt:void 0}),[xe,We,Ze,Z,tt,Qe,ce]),It=L.useCallback((Vt={},ln=null)=>me({...Vt,style:{...Vt.style,[Hs.arrowSize.var]:j?`${j}px`:void 0,[Hs.arrowShadowColor.var]:B}},ln),[me,j,B]),yn=L.useCallback((Vt={},ln=null)=>{const xn={...Vt.style,position:"relative",transformOrigin:Hs.transformOrigin.varRef};return{ref:ln,..._e,...Vt,id:tt,role:"tooltip",style:xn}},[_e,tt]);return{isOpen:Z,show:xe,hide:We,getTriggerProps:it,getTooltipProps:yn,getTooltipPositionerProps:It,getArrowProps:se,getArrowInnerProps:he}}const M2="chakra-ui:close-tooltip";function EMe(n,t){return L.useEffect(()=>{const s=iV(n);return s.addEventListener(M2,t),()=>s.removeEventListener(M2,t)},[t,n]),()=>{const s=iV(n),a=qO(n);s.dispatchEvent(new a.CustomEvent(M2))}}const yMe=Mt(rf.div),sg=Jt((n,t)=>{const s=ku("Tooltip",n),a=Qi(n),l=w0(),{children:d,label:p,shouldWrapChildren:E,"aria-label":v,hasArrow:T,bg:w,portalProps:A,background:N,backgroundColor:F,bgColor:j,motionProps:B,animatePresenceProps:G,...J}=a,K=N??F??w??j;if(K){s.bg=K;const ce=Vye(l,"colors",K);s[Hs.arrowBg.var]=ce}const ne=_Me({...J,direction:l.direction}),de=!L.isValidElement(d)||E;let oe;if(de)oe=I.jsx(Mt.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:d});else{const ce=L.Children.only(d);oe=L.cloneElement(ce,ne.getTriggerProps(ce.props,ane(ce)))}const _e=!!v,Z=ne.getTooltipProps({},t),ee=_e?LR(Z,["role","id"]):Z,te=hQ(Z,["role","id"]);return p?I.jsxs(I.Fragment,{children:[oe,I.jsx(S0,{...G,children:ne.isOpen&&I.jsx(Ll,{...A,children:I.jsx(Mt.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:I.jsxs(yMe,{variants:gMe,initial:"exit",animate:"enter",exit:"exit",...B,...ee,__css:s,children:[p,_e&&I.jsx(Mt.span,{srOnly:!0,...te,children:v}),T&&I.jsx(Mt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:I.jsx(Mt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):I.jsx(I.Fragment,{children:d})});sg.displayName="Tooltip";const pj=Jt(function(t,s){const a=ku("Heading",t),{className:l,...d}=Qi(t);return I.jsx(Mt.h2,{ref:s,className:hn("chakra-heading",t.className),...d,__css:a})});pj.displayName="Heading";const ft=Jt(function(t,s){const a=ku("Text",t),{className:l,align:d,decoration:p,casing:E,...v}=Qi(t),T=Zk({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return I.jsx(Mt.p,{ref:s,className:hn("chakra-text",t.className),...T,...v,__css:a})});ft.displayName="Text";const vMe="modulepreload",SMe=function(n,t){return new URL(n,t).href},RY={},U2=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const p=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(T=>{if(T=SMe(T,a),T in RY)return;RY[T]=!0;const w=T.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let j=p.length-1;j>=0;j--){const B=p[j];if(B.href===T&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${A}`))return;const F=document.createElement("link");if(F.rel=w?"stylesheet":vMe,w||(F.as="script"),F.crossOrigin="",F.href=T,v&&F.setAttribute("nonce",v),document.head.appendChild(F),w)return new Promise((j,B)=>{F.addEventListener("load",j),F.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${T}`)))})}))}function d(p){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=p,window.dispatchEvent(E),!E.defaultPrevented)throw p}return l.then(p=>{for(const E of p||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},pO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},De={log:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${pO()}] `,...t)}},error:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${pO()}] `,...t)}},warn:(...n)=>{{const t=n.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${pO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${pO()}] ${n}`)}};async function yR(n){let t;try{switch(n){case"default":t=await U2(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:t=await U2(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return t.default}catch(s){return De.error("Failed to load theme:",s),t=await U2(()=>import("./index.v0.1.5.js"),[],import.meta.url),t.default}}const TMe=()=>{};var CY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ene=function(n){const t=[];let s=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},bMe=function(n){const t=[];let s=0,a=0;for(;s<n.length;){const l=n[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[s++],p=n[s++],E=n[s++],v=((l&7)<<18|(d&63)<<12|(p&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[s++],p=n[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return t.join("")},yne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,E=p?n[l+1]:0,v=l+2<n.length,T=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|E>>4;let N=(E&15)<<2|T>>6,F=T&63;v||(F=64,p||(N=64)),a.push(s[w],s[A],s[N],s[F])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Ene(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):bMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=s[n.charAt(l++)],E=l<n.length?s[n.charAt(l)]:0;++l;const T=l<n.length?s[n.charAt(l)]:64;++l;const A=l<n.length?s[n.charAt(l)]:64;if(++l,d==null||E==null||T==null||A==null)throw new wMe;const N=d<<2|E>>4;if(a.push(N),T!==64){const F=E<<4&240|T>>2;if(a.push(F),A!==64){const j=T<<6&192|A;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class wMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const RMe=function(n){const t=Ene(n);return yne.encodeByteArray(t,!0)},Ik=function(n){return RMe(n).replace(/\./g,"")},vne=function(n){try{return yne.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IMe=()=>CMe().__FIREBASE_DEFAULTS__,AMe=()=>{if(typeof process>"u"||typeof CY>"u")return;const n=CY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},PMe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&vne(n[1]);return t&&JSON.parse(t)},PN=()=>{try{return TMe()||IMe()||AMe()||PMe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Sne=n=>{var t,s;return(s=(t=PN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[n]},Tne=n=>{const t=Sne(n);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},bne=()=>{var n;return(n=PN())===null||n===void 0?void 0:n.config},wne=n=>{var t;return(t=PN())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rne(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Ik(JSON.stringify(s)),Ik(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(La())}function NMe(){var n;const t=(n=PN())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function DMe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function LMe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function xMe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function MMe(){const n=La();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function UMe(){return!NMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VMe(){try{return typeof indexedDB=="object"}catch{return!1}}function FMe(){return new Promise((n,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jMe="FirebaseError";class of extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=jMe,Object.setPrototypeOf(this,of.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,JR.prototype.create)}}class JR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],p=d?BMe(d,a):"Error",E=`${this.serviceName}: ${p} (${l}).`;return new of(l,E,a)}}function BMe(n,t){return n.replace(WMe,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const WMe=/\{\$([^}]+)}/g;function zMe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function CE(n,t){if(n===t)return!0;const s=Object.keys(n),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=n[l],p=t[l];if(IY(d)&&IY(p)){if(!CE(d,p))return!1}else if(d!==p)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function IY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QR(n){const t=[];for(const[s,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Pw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function Ow(n){const t=n.indexOf("?");if(!t)return"";const s=n.indexOf("#",t);return n.substring(t,s>0?s:void 0)}function GMe(n,t){const s=new HMe(n,t);return s.subscribe.bind(s)}class HMe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");$Me(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=V2),l.error===void 0&&(l.error=V2),l.complete===void 0&&(l.complete=V2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $Me(n,t){if(typeof n!="object"||n===null)return!1;for(const s of t)if(s in n&&typeof n[s]=="function")return!0;return!1}function V2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n){return n&&n._delegate?n._delegate:n}let mg=class{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nE="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KMe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new OMe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(YMe(t))try{this.getOrInitializeService({instanceIdentifier:nE})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=nE){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=nE){return this.instances.has(t)}getOptions(t=nE){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,p]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&p.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&t(p,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:qMe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=nE){return this.component?this.component.multipleInstances?t:nE:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qMe(n){return n===nE?void 0:n}function YMe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new KMe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var yr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(yr||(yr={}));const JMe={debug:yr.DEBUG,verbose:yr.VERBOSE,info:yr.INFO,warn:yr.WARN,error:yr.ERROR,silent:yr.SILENT},QMe=yr.INFO,ZMe={[yr.DEBUG]:"log",[yr.VERBOSE]:"log",[yr.INFO]:"info",[yr.WARN]:"warn",[yr.ERROR]:"error"},e2e=(n,t,...s)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=ZMe[t];if(l)console[l](`[${a}]  ${n.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class mj{constructor(t){this.name=t,this._logLevel=QMe,this._logHandler=e2e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in yr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?JMe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,yr.DEBUG,...t),this._logHandler(this,yr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,yr.VERBOSE,...t),this._logHandler(this,yr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,yr.INFO,...t),this._logHandler(this,yr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,yr.WARN,...t),this._logHandler(this,yr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,yr.ERROR,...t),this._logHandler(this,yr.ERROR,...t)}}const t2e=(n,t)=>t.some(s=>n instanceof s);let AY,PY;function n2e(){return AY||(AY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function r2e(){return PY||(PY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Cne=new WeakMap,sV=new WeakMap,Ine=new WeakMap,F2=new WeakMap,gj=new WeakMap;function i2e(n){const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{s(og(n.result)),l()},p=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return t.then(s=>{s instanceof IDBCursor&&Cne.set(s,n)}).catch(()=>{}),gj.set(t,n),t}function s2e(n){if(sV.has(n))return;const t=new Promise((s,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{s(),l()},p=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});sV.set(n,t)}let oV={get(n,t,s){if(n instanceof IDBTransaction){if(t==="done")return sV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Ine.get(n);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return og(n[t])},set(n,t,s){return n[t]=s,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function o2e(n){oV=n(oV)}function a2e(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=n.call(j2(this),t,...s);return Ine.set(a,t.sort?t.sort():[t]),og(a)}:r2e().includes(n)?function(...t){return n.apply(j2(this),t),og(Cne.get(this))}:function(...t){return og(n.apply(j2(this),t))}}function c2e(n){return typeof n=="function"?a2e(n):(n instanceof IDBTransaction&&s2e(n),t2e(n,n2e())?new Proxy(n,oV):n)}function og(n){if(n instanceof IDBRequest)return i2e(n);if(F2.has(n))return F2.get(n);const t=c2e(n);return t!==n&&(F2.set(n,t),gj.set(t,n)),t}const j2=n=>gj.get(n);function l2e(n,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const p=indexedDB.open(n,t),E=og(p);return a&&p.addEventListener("upgradeneeded",v=>{a(og(p.result),v.oldVersion,v.newVersion,og(p.transaction),v)}),s&&p.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const u2e=["get","getKey","getAll","getAllKeys","count"],d2e=["put","add","delete","clear"],B2=new Map;function OY(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(B2.get(t))return B2.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=d2e.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||u2e.includes(s)))return;const d=async function(p,...E){const v=this.transaction(p,l?"readwrite":"readonly");let T=v.store;return a&&(T=T.index(E.shift())),(await Promise.all([T[s](...E),l&&v.done]))[0]};return B2.set(t,d),d}o2e(n=>({...n,get:(t,s,a)=>OY(t,s)||n.get(t,s,a),has:(t,s)=>!!OY(t,s)||n.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h2e{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(f2e(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function f2e(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const aV="@firebase/app",kY="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=new mj("@firebase/app"),p2e="@firebase/app-compat",m2e="@firebase/analytics-compat",g2e="@firebase/analytics",_2e="@firebase/app-check-compat",E2e="@firebase/app-check",y2e="@firebase/auth",v2e="@firebase/auth-compat",S2e="@firebase/database",T2e="@firebase/data-connect",b2e="@firebase/database-compat",w2e="@firebase/functions",R2e="@firebase/functions-compat",C2e="@firebase/installations",I2e="@firebase/installations-compat",A2e="@firebase/messaging",P2e="@firebase/messaging-compat",O2e="@firebase/performance",k2e="@firebase/performance-compat",N2e="@firebase/remote-config",D2e="@firebase/remote-config-compat",L2e="@firebase/storage",x2e="@firebase/storage-compat",M2e="@firebase/firestore",U2e="@firebase/vertexai",V2e="@firebase/firestore-compat",F2e="firebase",j2e="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cV="[DEFAULT]",B2e={[aV]:"fire-core",[p2e]:"fire-core-compat",[g2e]:"fire-analytics",[m2e]:"fire-analytics-compat",[E2e]:"fire-app-check",[_2e]:"fire-app-check-compat",[y2e]:"fire-auth",[v2e]:"fire-auth-compat",[S2e]:"fire-rtdb",[T2e]:"fire-data-connect",[b2e]:"fire-rtdb-compat",[w2e]:"fire-fn",[R2e]:"fire-fn-compat",[C2e]:"fire-iid",[I2e]:"fire-iid-compat",[A2e]:"fire-fcm",[P2e]:"fire-fcm-compat",[O2e]:"fire-perf",[k2e]:"fire-perf-compat",[N2e]:"fire-rc",[D2e]:"fire-rc-compat",[L2e]:"fire-gcs",[x2e]:"fire-gcs-compat",[M2e]:"fire-fst",[V2e]:"fire-fst-compat",[U2e]:"fire-vertex","fire-js":"fire-js",[F2e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak=new Map,W2e=new Map,lV=new Map;function NY(n,t){try{n.container.addComponent(t)}catch(s){Ip.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,s)}}function IE(n){const t=n.name;if(lV.has(t))return Ip.debug(`There were multiple attempts to register component ${t}.`),!1;lV.set(t,n);for(const s of Ak.values())NY(s,n);for(const s of W2e.values())NY(s,n);return!0}function ON(n,t){const s=n.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),n.container.getProvider(t)}function Rl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ag=new JR("app","Firebase",z2e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2e{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new mg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ag.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME=j2e;function Ane(n,t={}){let s=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:cV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw ag.create("bad-app-name",{appName:String(l)});if(s||(s=bne()),!s)throw ag.create("no-options");const d=Ak.get(l);if(d){if(CE(s,d.options)&&CE(a,d.config))return d;throw ag.create("duplicate-app",{appName:l})}const p=new XMe(l);for(const v of lV.values())p.addComponent(v);const E=new G2e(s,a,p);return Ak.set(l,E),E}function _j(n=cV){const t=Ak.get(n);if(!t&&n===cV&&bne())return Ane();if(!t)throw ag.create("no-app",{appName:n});return t}function Kh(n,t,s){var a;let l=(a=B2e[n])!==null&&a!==void 0?a:n;s&&(l+=`-${s}`);const d=l.match(/\s|\//),p=t.match(/\s|\//);if(d||p){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&E.push("and"),p&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ip.warn(E.join(" "));return}IE(new mg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2e="firebase-heartbeat-database",$2e=1,vR="firebase-heartbeat-store";let W2=null;function Pne(){return W2||(W2=l2e(H2e,$2e,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(vR)}catch(s){console.warn(s)}}}}).catch(n=>{throw ag.create("idb-open",{originalErrorMessage:n.message})})),W2}async function K2e(n){try{const s=(await Pne()).transaction(vR),a=await s.objectStore(vR).get(One(n));return await s.done,a}catch(t){if(t instanceof of)Ip.warn(t.message);else{const s=ag.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Ip.warn(s.message)}}}async function DY(n,t){try{const a=(await Pne()).transaction(vR,"readwrite");await a.objectStore(vR).put(t,One(n)),await a.done}catch(s){if(s instanceof of)Ip.warn(s.message);else{const a=ag.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Ip.warn(a.message)}}}function One(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2e=1024,Y2e=30;class X2e{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new Q2e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=LY();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>Y2e){const p=Z2e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Ip.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=LY(),{heartbeatsToSend:a,unsentEntries:l}=J2e(this._heartbeatsCache.heartbeats),d=Ik(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Ip.warn(s),""}}}function LY(){return new Date().toISOString().substring(0,10)}function J2e(n,t=q2e){const s=[];let a=n.slice();for(const l of n){const d=s.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),xY(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),xY(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class Q2e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VMe()?FMe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await K2e(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return DY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return DY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function xY(n){return Ik(JSON.stringify({version:2,heartbeats:n})).length}function Z2e(n){if(n.length===0)return-1;let t=0,s=n[0].date;for(let a=1;a<n.length;a++)n[a].date<s&&(s=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eUe(n){IE(new mg("platform-logger",t=>new h2e(t),"PRIVATE")),IE(new mg("heartbeat",t=>new X2e(t),"PRIVATE")),Kh(aV,kY,n),Kh(aV,kY,"esm2017"),Kh("fire-js","")}eUe("");function kne(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tUe=kne,Nne=new JR("auth","Firebase",kne());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pk=new mj("@firebase/auth");function nUe(n,...t){Pk.logLevel<=yr.WARN&&Pk.warn(`Auth (${ME}): ${n}`,...t)}function YO(n,...t){Pk.logLevel<=yr.ERROR&&Pk.error(`Auth (${ME}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ad(n,...t){throw Ej(n,...t)}function qh(n,...t){return Ej(n,...t)}function Dne(n,t,s){const a=Object.assign(Object.assign({},tUe()),{[t]:s});return new JR("auth","Firebase",a).create(t,{appName:n.name})}function Sp(n){return Dne(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ej(n,...t){if(typeof n!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(s,...a)}return Nne.create(n,...t)}function Ln(n,t,...s){if(!n)throw Ej(t,...s)}function fp(n){const t="INTERNAL ASSERTION FAILED: "+n;throw YO(t),new Error(t)}function Ap(n,t){n||fp(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function rUe(){return MY()==="http:"||MY()==="https:"}function MY(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iUe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rUe()||LMe()||"connection"in navigator)?navigator.onLine:!0}function sUe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(t,s){this.shortDelay=t,this.longDelay=s,Ap(s>t,"Short delay should be less than long delay!"),this.isMobile=kMe()||xMe()}get(){return iUe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yj(n,t){Ap(n.emulator,"Emulator should always be set here");const{url:s}=n.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lne{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;fp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;fp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;fp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oUe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aUe=new ZR(3e4,6e4);function Rg(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Cg(n,t,s,a,l={}){return xne(n,l,async()=>{let d={},p={};a&&(t==="GET"?p=a:d={body:JSON.stringify(a)});const E=QR(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const T=Object.assign({method:t,headers:v},d);return DMe()||(T.referrerPolicy="no-referrer"),Lne.fetch()(Mne(n,n.config.apiHost,s,E),T)})}async function xne(n,t,s){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},oUe),t);try{const l=new lUe(n),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw mO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const E=d.ok?p.errorMessage:p.error.message,[v,T]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw mO(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw mO(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw mO(n,"user-disabled",p);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw Dne(n,w,T);Ad(n,w)}}catch(l){if(l instanceof of)throw l;Ad(n,"network-request-failed",{message:String(l)})}}async function eC(n,t,s,a,l={}){const d=await Cg(n,t,s,a,l);return"mfaPendingCredential"in d&&Ad(n,"multi-factor-auth-required",{_serverResponse:d}),d}function Mne(n,t,s,a){const l=`${t}${s}?${a}`;return n.config.emulator?yj(n.config,l):`${n.config.apiScheme}://${l}`}function cUe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lUe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(qh(this.auth,"network-request-failed")),aUe.get())})}}function mO(n,t,s){const a={appName:n.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=qh(n,t,a);return l.customData._tokenResponse=s,l}function UY(n){return n!==void 0&&n.enterprise!==void 0}class uUe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return cUe(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function dUe(n,t){return Cg(n,"GET","/v2/recaptchaConfig",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hUe(n,t){return Cg(n,"POST","/v1/accounts:delete",t)}async function Une(n,t){return Cg(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qw(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function fUe(n,t=!1){const s=zi(n),a=await s.getIdToken(t),l=vj(a);Ln(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:qw(z2(l.auth_time)),issuedAtTime:qw(z2(l.iat)),expirationTime:qw(z2(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function z2(n){return Number(n)*1e3}function vj(n){const[t,s,a]=n.split(".");if(t===void 0||s===void 0||a===void 0)return YO("JWT malformed, contained fewer than 3 sections"),null;try{const l=vne(s);return l?JSON.parse(l):(YO("Failed to decode base64 JWT payload"),null)}catch(l){return YO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function VY(n){const t=vj(n);return Ln(t,"internal-error"),Ln(typeof t.exp<"u","internal-error"),Ln(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SR(n,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof of&&pUe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function pUe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mUe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=qw(this.lastLoginAt),this.creationTime=qw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ok(n){var t;const s=n.auth,a=await n.getIdToken(),l=await SR(n,Une(s,{idToken:a}));Ln(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Vne(d.providerUserInfo):[],E=_Ue(n.providerData,p),v=n.isAnonymous,T=!(n.email&&d.passwordHash)&&!(E!=null&&E.length),w=v?T:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new dV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function gUe(n){const t=zi(n);await Ok(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function _Ue(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Vne(n){return n.map(t=>{var{providerId:s}=t,a=HR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EUe(n,t){const s=await xne(n,{},async()=>{const a=QR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=Mne(n,l,"/v1/token",`key=${d}`),E=await n._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",Lne.fetch()(p,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function yUe(n,t){return Cg(n,"POST","/v2/accounts:revokeToken",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ln(t.idToken,"internal-error"),Ln(typeof t.idToken<"u","internal-error"),Ln(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):VY(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Ln(t.length!==0,"internal-error");const s=VY(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Ln(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await EUe(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,p=new zS;return a&&(Ln(typeof a=="string","internal-error",{appName:t}),p.refreshToken=a),l&&(Ln(typeof l=="string","internal-error",{appName:t}),p.accessToken=l),d&&(Ln(typeof d=="number","internal-error",{appName:t}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new zS,this.toJSON())}_performRefresh(){return fp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zm(n,t){Ln(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class pp{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=HR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new mUe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new dV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await SR(this,this.stsTokenManager.getToken(this.auth,t));return Ln(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return fUe(this,t)}reload(){return gUe(this)}_assign(t){this!==t&&(Ln(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new pp(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Ln(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await Ok(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Rl(this.auth.app))return Promise.reject(Sp(this.auth));const t=await this.getIdToken();return await SR(this,hUe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,p,E,v,T,w;const A=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,F=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,j=(p=s.photoURL)!==null&&p!==void 0?p:void 0,B=(E=s.tenantId)!==null&&E!==void 0?E:void 0,G=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,J=(T=s.createdAt)!==null&&T!==void 0?T:void 0,K=(w=s.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:ne,emailVerified:de,isAnonymous:oe,providerData:_e,stsTokenManager:Z}=s;Ln(ne&&Z,t,"internal-error");const ee=zS.fromJSON(this.name,Z);Ln(typeof ne=="string",t,"internal-error"),zm(A,t.name),zm(N,t.name),Ln(typeof de=="boolean",t,"internal-error"),Ln(typeof oe=="boolean",t,"internal-error"),zm(F,t.name),zm(j,t.name),zm(B,t.name),zm(G,t.name),zm(J,t.name),zm(K,t.name);const te=new pp({uid:ne,auth:t,email:N,emailVerified:de,displayName:A,isAnonymous:oe,photoURL:j,phoneNumber:F,tenantId:B,stsTokenManager:ee,createdAt:J,lastLoginAt:K});return _e&&Array.isArray(_e)&&(te.providerData=_e.map(ce=>Object.assign({},ce))),G&&(te._redirectEventId=G),te}static async _fromIdTokenResponse(t,s,a=!1){const l=new zS;l.updateFromServerResponse(s);const d=new pp({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Ok(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Ln(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Vne(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new zS;E.updateFromIdToken(a);const v=new pp({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:p}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new dV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,T),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FY=new Map;function mp(n){Ap(n instanceof Function,"Expected a class definition");let t=FY.get(n);return t?(Ap(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,FY.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}Fne.type="NONE";const jY=Fne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(n,t,s){return`firebase:${n}:${t}:${s}`}class GS{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=XO(this.userKey,l.apiKey,d),this.fullPersistenceKey=XO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?pp._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new GS(mp(jY),t,a);const l=(await Promise.all(s.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let d=l[0]||mp(jY);const p=XO(a,t.config.apiKey,t.name);let E=null;for(const T of s)try{const w=await T._get(p);if(w){const A=pp._fromJSON(t,w);T!==d&&(E=A),d=T;break}}catch{}const v=l.filter(T=>T._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new GS(d,t,a):(d=v[0],E&&await d._set(p,E.toJSON()),await Promise.all(s.map(async T=>{if(T!==d)try{await T._remove(p)}catch{}})),new GS(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BY(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(zne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(jne(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Hne(t))return"Blackberry";if($ne(t))return"Webos";if(Bne(t))return"Safari";if((t.includes("chrome/")||Wne(t))&&!t.includes("edge/"))return"Chrome";if(Gne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function jne(n=La()){return/firefox\//i.test(n)}function Bne(n=La()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Wne(n=La()){return/crios\//i.test(n)}function zne(n=La()){return/iemobile/i.test(n)}function Gne(n=La()){return/android/i.test(n)}function Hne(n=La()){return/blackberry/i.test(n)}function $ne(n=La()){return/webos/i.test(n)}function Sj(n=La()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function vUe(n=La()){var t;return Sj(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function SUe(){return MMe()&&document.documentMode===10}function Kne(n=La()){return Sj(n)||Gne(n)||$ne(n)||Hne(n)||/windows phone/i.test(n)||zne(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qne(n,t=[]){let s;switch(n){case"Browser":s=BY(La());break;case"Worker":s=`${BY(La())}-${n}`;break;default:s=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${ME}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TUe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((p,E)=>{try{const v=t(d);p(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bUe(n,t={}){return Cg(n,"GET","/v2/passwordPolicy",Rg(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wUe=6;class RUe{constructor(t){var s,a,l,d;const p=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=p.minPasswordLength)!==null&&s!==void 0?s:wUe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,p,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CUe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new WY(this),this.idTokenSubscription=new WY(this),this.beforeStateQueue=new TUe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=mp(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await GS.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await Une(this,{idToken:t}),a=await pp._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(Rl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!p||p===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Ln(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await Ok(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=sUe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Rl(this.app))return Promise.reject(Sp(this));const s=t?zi(t):null;return s&&Ln(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Ln(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Rl(this.app)?Promise.reject(Sp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Rl(this.app)?Promise.reject(Sp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(mp(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await bUe(this),s=new RUe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new JR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await yUe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&mp(t)||this._popupRedirectResolver;Ln(s,this,"argument-error"),this.redirectPersistenceManager=await GS.create(this,[mp(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let p=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ln(E,this,"internal-error"),E.then(()=>{p||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{p=!0,v()}}else{const v=t.addObserver(s);return()=>{p=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ln(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=qne(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(Rl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&nUe(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function UE(n){return zi(n)}class WY{constructor(t){this.auth=t,this.observer=null,this.addObserver=GMe(s=>this.observer=s)}get next(){return Ln(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function IUe(n){kN=n}function Yne(n){return kN.loadJS(n)}function AUe(){return kN.recaptchaEnterpriseScript}function PUe(){return kN.gapiScript}function OUe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class kUe{constructor(){this.enterprise=new NUe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class NUe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const DUe="recaptcha-enterprise",Xne="NO_RECAPTCHA";class LUe{constructor(t){this.type=DUe,this.auth=UE(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,E)=>{dUe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new uUe(v);return d.tenantId==null?d._agentRecaptchaConfig=T:d._tenantRecaptchaConfigs[d.tenantId]=T,p(T.siteKey)}}).catch(v=>{E(v)})})}function l(d,p,E){const v=window.grecaptcha;UY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(T=>{p(T)}).catch(()=>{p(Xne)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new kUe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{a(this.auth).then(E=>{if(!s&&UY(window.grecaptcha))l(E,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=AUe();v.length!==0&&(v+=E),Yne(v).then(()=>{l(E,d,p)}).catch(T=>{p(T)})}}).catch(E=>{p(E)})})}}async function zY(n,t,s,a=!1,l=!1){const d=new LUe(n);let p;if(l)p=Xne;else try{p=await d.verify(s)}catch{p=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:T,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:p}):Object.assign(E,{captchaResponse:p}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function hV(n,t,s,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await zY(n,t,s,s==="getOobCode");return a(n,p)}else return a(n,t).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await zY(n,t,s,s==="getOobCode");return a(n,E)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xUe(n,t){const s=ON(n,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(CE(d,t??{}))return l;Ad(l,"already-initialized")}return s.initialize({options:t})}function MUe(n,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(mp);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function UUe(n,t,s){const a=UE(n);Ln(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=Jne(t),{host:p,port:E}=VUe(t),v=E===null?"":`:${E}`,T={url:`${d}//${p}${v}/`},w=Object.freeze({host:p,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Ln(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Ln(CE(T,a.config.emulator)&&CE(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=T,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,FUe()}function Jne(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function VUe(n){const t=Jne(n),s=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:GY(a.substr(d.length+1))}}else{const[d,p]=a.split(":");return{host:d,port:GY(p)}}}function GY(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function FUe(){function n(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return fp("not implemented")}_getIdTokenResponse(t){return fp("not implemented")}_linkToIdToken(t,s){return fp("not implemented")}_getReauthenticationResolver(t){return fp("not implemented")}}async function jUe(n,t){return Cg(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BUe(n,t){return eC(n,"POST","/v1/accounts:signInWithPassword",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WUe(n,t){return eC(n,"POST","/v1/accounts:signInWithEmailLink",Rg(n,t))}async function zUe(n,t){return eC(n,"POST","/v1/accounts:signInWithEmailLink",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR extends Tj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new TR(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new TR(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hV(t,s,"signInWithPassword",BUe);case"emailLink":return WUe(t,{email:this._email,oobCode:this._password});default:Ad(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hV(t,a,"signUpPassword",jUe);case"emailLink":return zUe(t,{idToken:s,email:this._email,oobCode:this._password});default:Ad(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HS(n,t){return eC(n,"POST","/v1/accounts:signInWithIdp",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GUe="http://localhost";class AE extends Tj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new AE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Ad("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=HR(s,["providerId","signInMethod"]);if(!a||!l)return null;const p=new AE(a,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(t){const s=this.buildRequest();return HS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,HS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,HS(t,s)}buildRequest(){const t={requestUri:GUe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=QR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HUe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $Ue(n){const t=Pw(Ow(n)).link,s=t?Pw(Ow(t)).deep_link_id:null,a=Pw(Ow(n)).deep_link_id;return(a?Pw(Ow(a)).link:null)||a||s||t||n}class bj{constructor(t){var s,a,l,d,p,E;const v=Pw(Ow(t)),T=(s=v.apiKey)!==null&&s!==void 0?s:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=HUe((l=v.mode)!==null&&l!==void 0?l:null);Ln(T&&w&&A,"argument-error"),this.apiKey=T,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=$Ue(t);try{return new bj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(){this.providerId=P0.PROVIDER_ID}static credential(t,s){return TR._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=bj.parseLink(s);return Ln(a,"argument-error"),TR._fromEmailAndCode(t,a.code,a.tenantId)}}P0.PROVIDER_ID="password";P0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";P0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tC extends Qne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends tC{constructor(){super("facebook.com")}static credential(t){return AE._fromParams({providerId:Ym.PROVIDER_ID,signInMethod:Ym.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ym.credentialFromTaggedObject(t)}static credentialFromError(t){return Ym.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Ym.credential(t.oauthAccessToken)}catch{return null}}}Ym.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ym.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm extends tC{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return AE._fromParams({providerId:Xm.PROVIDER_ID,signInMethod:Xm.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Xm.credentialFromTaggedObject(t)}static credentialFromError(t){return Xm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return Xm.credential(s,a)}catch{return null}}}Xm.GOOGLE_SIGN_IN_METHOD="google.com";Xm.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm extends tC{constructor(){super("github.com")}static credential(t){return AE._fromParams({providerId:Jm.PROVIDER_ID,signInMethod:Jm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Jm.credentialFromTaggedObject(t)}static credentialFromError(t){return Jm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Jm.credential(t.oauthAccessToken)}catch{return null}}}Jm.GITHUB_SIGN_IN_METHOD="github.com";Jm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm extends tC{constructor(){super("twitter.com")}static credential(t,s){return AE._fromParams({providerId:Qm.PROVIDER_ID,signInMethod:Qm.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Qm.credentialFromTaggedObject(t)}static credentialFromError(t){return Qm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Qm.credential(s,a)}catch{return null}}}Qm.TWITTER_SIGN_IN_METHOD="twitter.com";Qm.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KUe(n,t){return eC(n,"POST","/v1/accounts:signUp",Rg(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await pp._fromIdTokenResponse(t,a,l),p=HY(a);return new PE({user:d,providerId:p,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=HY(a);return new PE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function HY(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk extends of{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,kk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new kk(t,s,a,l)}}function Zne(n,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(n):s._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?kk._fromErrorAndOperation(n,d,t,a):d})}async function qUe(n,t,s=!1){const a=await SR(n,t._linkToIdToken(n.auth,await n.getIdToken()),s);return PE._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YUe(n,t,s=!1){const{auth:a}=n;if(Rl(a.app))return Promise.reject(Sp(a));const l="reauthenticate";try{const d=await SR(n,Zne(a,l,t,n),s);Ln(d.idToken,a,"internal-error");const p=vj(d.idToken);Ln(p,a,"internal-error");const{sub:E}=p;return Ln(n.uid===E,a,"user-mismatch"),PE._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Ad(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ere(n,t,s=!1){if(Rl(n.app))return Promise.reject(Sp(n));const a="signIn",l=await Zne(n,a,t),d=await PE._fromIdTokenResponse(n,a,l);return s||await n._updateCurrentUser(d.user),d}async function XUe(n,t){return ere(UE(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tre(n){const t=UE(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function JUe(n,t,s){if(Rl(n.app))return Promise.reject(Sp(n));const a=UE(n),p=await hV(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KUe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&tre(n),v}),E=await PE._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(E.user),E}function QUe(n,t,s){return Rl(n.app)?Promise.reject(Sp(n)):XUe(zi(n),P0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&tre(n),a})}function ZUe(n,t,s,a){return zi(n).onIdTokenChanged(t,s,a)}function eVe(n,t,s){return zi(n).beforeAuthStateChanged(t,s)}function tVe(n,t,s,a){return zi(n).onAuthStateChanged(t,s,a)}function nVe(n){return zi(n).signOut()}const Nk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nre{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Nk,"1"),this.storage.removeItem(Nk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rVe=1e3,iVe=10;class rre extends nre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Kne(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((p,E,v)=>{this.notifyListeners(p,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!s&&this.localCache[a]===p||this.notifyListeners(a,p)},d=this.storage.getItem(a);SUe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,iVe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},rVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}rre.type="LOCAL";const sVe=rre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ire extends nre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}ire.type="SESSION";const sre=ire;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oVe(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new NN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(p).map(async T=>T(s.origin,d)),v=await oVe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}NN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wj(n="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return n+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aVe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((E,v)=>{const T=wj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:t,eventId:T,data:s},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yh(){return window}function cVe(n){Yh().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ore(){return typeof Yh().WorkerGlobalScope<"u"&&typeof Yh().importScripts=="function"}async function lVe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function uVe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function dVe(){return ore()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const are="firebaseLocalStorageDb",hVe=1,Dk="firebaseLocalStorage",cre="fbase_key";class nC{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function DN(n,t){return n.transaction([Dk],t?"readwrite":"readonly").objectStore(Dk)}function fVe(){const n=indexedDB.deleteDatabase(are);return new nC(n).toPromise()}function fV(){const n=indexedDB.open(are,hVe);return new Promise((t,s)=>{n.addEventListener("error",()=>{s(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Dk,{keyPath:cre})}catch(l){s(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Dk)?t(a):(a.close(),await fVe(),t(await fV()))})})}async function $Y(n,t,s){const a=DN(n,!0).put({[cre]:t,value:s});return new nC(a).toPromise()}async function pVe(n,t){const s=DN(n,!1).get(t),a=await new nC(s).toPromise();return a===void 0?null:a.value}function KY(n,t){const s=DN(n,!0).delete(t);return new nC(s).toPromise()}const mVe=800,gVe=3;class lre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fV(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>gVe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ore()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=NN._getInstance(dVe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await lVe(),!this.activeServiceWorker)return;this.sender=new aVe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||uVe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await fV();return await $Y(t,Nk,"1"),await KY(t,Nk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>$Y(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>pVe(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>KY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=DN(l,!1).getAll();return new nC(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),mVe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}lre.type="LOCAL";const _Ve=lre;new ZR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EVe(n,t){return t?mp(t):(Ln(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj extends Tj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return HS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return HS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return HS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function yVe(n){return ere(n.auth,new Rj(n),n.bypassAuthState)}function vVe(n){const{auth:t,user:s}=n;return Ln(s,t,"internal-error"),YUe(s,new Rj(n),n.bypassAuthState)}async function SVe(n){const{auth:t,user:s}=n;return Ln(s,t,"internal-error"),qUe(s,new Rj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ure{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:p,type:E}=t;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(T){this.reject(T)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return yVe;case"linkViaPopup":case"linkViaRedirect":return SVe;case"reauthViaPopup":case"reauthViaRedirect":return vVe;default:Ad(this.auth,"internal-error")}}resolve(t){Ap(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ap(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TVe=new ZR(2e3,1e4);class OS extends ure{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,OS.currentPopupAction&&OS.currentPopupAction.cancel(),OS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ln(t,this.auth,"internal-error"),t}async onExecution(){Ap(this.filter.length===1,"Popup operations only handle one event");const t=wj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(qh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(qh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,OS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,TVe.get())};t()}}OS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bVe="pendingRedirect",JO=new Map;class wVe extends ure{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=JO.get(this.auth._key());if(!t){try{const a=await RVe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}JO.set(this.auth._key(),t)}return this.bypassAuthState||JO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RVe(n,t){const s=AVe(t),a=IVe(n);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function CVe(n,t){JO.set(n._key(),t)}function IVe(n){return mp(n._redirectPersistence)}function AVe(n){return XO(bVe,n.config.apiKey,n.name)}async function PVe(n,t,s=!1){if(Rl(n.app))return Promise.reject(Sp(n));const a=UE(n),l=EVe(a,t),p=await new wVe(a,l,s).execute();return p&&!s&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,t)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OVe=10*60*1e3;class kVe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!NVe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!dre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(qh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=OVe&&this.cachedEventUids.clear(),this.cachedEventUids.has(qY(t))}saveEventToCache(t){this.cachedEventUids.add(qY(t)),this.lastProcessedEventTime=Date.now()}}function qY(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function dre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function NVe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DVe(n,t={}){return Cg(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LVe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xVe=/^https?/;async function MVe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await DVe(n);for(const s of t)try{if(UVe(s))return}catch{}Ad(n,"unauthorized-domain")}function UVe(n){const t=uV(),{protocol:s,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&a===""?s==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&p.hostname===a}if(!xVe.test(s))return!1;if(LVe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VVe=new ZR(3e4,6e4);function YY(){const n=Yh().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let s=0;s<n.CP.length;s++)n.CP[s]=null}}function FVe(n){return new Promise((t,s)=>{var a,l,d;function p(){YY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{YY(),s(qh(n,"network-request-failed"))},timeout:VVe.get()})}if(!((l=(a=Yh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Yh().gapi)===null||d===void 0)&&d.load)p();else{const E=OUe("iframefcb");return Yh()[E]=()=>{gapi.load?p():s(qh(n,"network-request-failed"))},Yne(`${PUe()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw QO=null,t})}let QO=null;function jVe(n){return QO=QO||FVe(n),QO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BVe=new ZR(5e3,15e3),WVe="__/auth/iframe",zVe="emulator/auth/iframe",GVe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},HVe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function $Ve(n){const t=n.config;Ln(t.authDomain,n,"auth-domain-config-required");const s=t.emulator?yj(t,zVe):`https://${n.config.authDomain}/${WVe}`,a={apiKey:t.apiKey,appName:n.name,v:ME},l=HVe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${QR(a).slice(1)}`}async function KVe(n){const t=await jVe(n),s=Yh().gapi;return Ln(s,n,"internal-error"),t.open({where:document.body,url:$Ve(n),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:GVe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const p=qh(n,"network-request-failed"),E=Yh().setTimeout(()=>{d(p)},BVe.get());function v(){Yh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qVe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YVe=500,XVe=600,JVe="_blank",QVe="http://localhost";class XY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function ZVe(n,t,s,a=YVe,l=XVe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},qVe),{width:a.toString(),height:l.toString(),top:d,left:p}),T=La().toLowerCase();s&&(E=Wne(T)?JVe:s),jne(T)&&(t=t||QVe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[F,j])=>`${N}${F}=${j},`,"");if(vUe(T)&&E!=="_self")return eFe(t||"",E),new XY(null);const A=window.open(t||"",E,w);Ln(A,n,"popup-blocked");try{A.focus()}catch{}return new XY(A)}function eFe(n,t){const s=document.createElement("a");s.href=n,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tFe="__/auth/handler",nFe="emulator/auth/handler",rFe=encodeURIComponent("fac");async function JY(n,t,s,a,l,d){Ln(n.config.authDomain,n,"auth-domain-config-required"),Ln(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:s,redirectUrl:a,v:ME,eventId:l};if(t instanceof Qne){t.setDefaultLanguage(n.languageCode),p.providerId=t.providerId||"",zMe(t.getCustomParameters())||(p.customParameters=JSON.stringify(t.getCustomParameters()));for(const[w,A]of Object.entries({}))p[w]=A}if(t instanceof tC){const w=t.getScopes().filter(A=>A!=="");w.length>0&&(p.scopes=w.join(","))}n.tenantId&&(p.tid=n.tenantId);const E=p;for(const w of Object.keys(E))E[w]===void 0&&delete E[w];const v=await n._getAppCheckToken(),T=v?`#${rFe}=${encodeURIComponent(v)}`:"";return`${iFe(n)}?${QR(E).slice(1)}${T}`}function iFe({config:n}){return n.emulator?yj(n,nFe):`https://${n.authDomain}/${tFe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G2="webStorageSupport";class sFe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=sre,this._completeRedirectFn=PVe,this._overrideRedirectResult=CVe}async _openPopup(t,s,a,l){var d;Ap((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await JY(t,s,a,uV(),l);return ZVe(t,p,wj())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await JY(t,s,a,uV(),l);return cVe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(Ap(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await KVe(t),a=new kVe(t);return s.register("authEvent",l=>(Ln(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(G2,{type:G2},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[G2];p!==void 0&&s(!!p),Ad(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=MVe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return Kne()||Bne()||Sj()}}const oFe=sFe;var QY="@firebase/auth",ZY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aFe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Ln(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lFe(n){IE(new mg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:p,authDomain:E}=a.options;Ln(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:E,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qne(n)},T=new CUe(a,l,d,v);return MUe(T,s),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),IE(new mg("auth-internal",t=>{const s=UE(t.getProvider("auth").getImmediate());return(a=>new aFe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kh(QY,ZY,cFe(n)),Kh(QY,ZY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uFe=5*60,dFe=wne("authIdTokenMaxAge")||uFe;let eX=null;const hFe=n=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>dFe)return;const l=s==null?void 0:s.token;eX!==l&&(eX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function hre(n=_j()){const t=ON(n,"auth");if(t.isInitialized())return t.getImmediate();const s=xUe(n,{popupRedirectResolver:oFe,persistence:[_Ve,sVe,sre]}),a=wne("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const p=hFe(d.toString());eVe(s,p,()=>p(s.currentUser)),ZUe(s,E=>p(E))}}const l=Sne("auth");return l&&UUe(s,`http://${l}`),s}function fFe(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}IUe({loadJS(n){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=qh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",fFe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lFe("Browser");var tX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var cg,fre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Z,ee){function te(){}te.prototype=ee.prototype,Z.D=ee.prototype,Z.prototype=new te,Z.prototype.constructor=Z,Z.C=function(ce,me,he){for(var se=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)se[Se-2]=arguments[Se];return ee.prototype[me].apply(ce,se)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,ee,te){te||(te=0);var ce=Array(16);if(typeof ee=="string")for(var me=0;16>me;++me)ce[me]=ee.charCodeAt(te++)|ee.charCodeAt(te++)<<8|ee.charCodeAt(te++)<<16|ee.charCodeAt(te++)<<24;else for(me=0;16>me;++me)ce[me]=ee[te++]|ee[te++]<<8|ee[te++]<<16|ee[te++]<<24;ee=Z.g[0],te=Z.g[1],me=Z.g[2];var he=Z.g[3],se=ee+(he^te&(me^he))+ce[0]+3614090360&4294967295;ee=te+(se<<7&4294967295|se>>>25),se=he+(me^ee&(te^me))+ce[1]+3905402710&4294967295,he=ee+(se<<12&4294967295|se>>>20),se=me+(te^he&(ee^te))+ce[2]+606105819&4294967295,me=he+(se<<17&4294967295|se>>>15),se=te+(ee^me&(he^ee))+ce[3]+3250441966&4294967295,te=me+(se<<22&4294967295|se>>>10),se=ee+(he^te&(me^he))+ce[4]+4118548399&4294967295,ee=te+(se<<7&4294967295|se>>>25),se=he+(me^ee&(te^me))+ce[5]+1200080426&4294967295,he=ee+(se<<12&4294967295|se>>>20),se=me+(te^he&(ee^te))+ce[6]+2821735955&4294967295,me=he+(se<<17&4294967295|se>>>15),se=te+(ee^me&(he^ee))+ce[7]+4249261313&4294967295,te=me+(se<<22&4294967295|se>>>10),se=ee+(he^te&(me^he))+ce[8]+1770035416&4294967295,ee=te+(se<<7&4294967295|se>>>25),se=he+(me^ee&(te^me))+ce[9]+2336552879&4294967295,he=ee+(se<<12&4294967295|se>>>20),se=me+(te^he&(ee^te))+ce[10]+4294925233&4294967295,me=he+(se<<17&4294967295|se>>>15),se=te+(ee^me&(he^ee))+ce[11]+2304563134&4294967295,te=me+(se<<22&4294967295|se>>>10),se=ee+(he^te&(me^he))+ce[12]+1804603682&4294967295,ee=te+(se<<7&4294967295|se>>>25),se=he+(me^ee&(te^me))+ce[13]+4254626195&4294967295,he=ee+(se<<12&4294967295|se>>>20),se=me+(te^he&(ee^te))+ce[14]+2792965006&4294967295,me=he+(se<<17&4294967295|se>>>15),se=te+(ee^me&(he^ee))+ce[15]+1236535329&4294967295,te=me+(se<<22&4294967295|se>>>10),se=ee+(me^he&(te^me))+ce[1]+4129170786&4294967295,ee=te+(se<<5&4294967295|se>>>27),se=he+(te^me&(ee^te))+ce[6]+3225465664&4294967295,he=ee+(se<<9&4294967295|se>>>23),se=me+(ee^te&(he^ee))+ce[11]+643717713&4294967295,me=he+(se<<14&4294967295|se>>>18),se=te+(he^ee&(me^he))+ce[0]+3921069994&4294967295,te=me+(se<<20&4294967295|se>>>12),se=ee+(me^he&(te^me))+ce[5]+3593408605&4294967295,ee=te+(se<<5&4294967295|se>>>27),se=he+(te^me&(ee^te))+ce[10]+38016083&4294967295,he=ee+(se<<9&4294967295|se>>>23),se=me+(ee^te&(he^ee))+ce[15]+3634488961&4294967295,me=he+(se<<14&4294967295|se>>>18),se=te+(he^ee&(me^he))+ce[4]+3889429448&4294967295,te=me+(se<<20&4294967295|se>>>12),se=ee+(me^he&(te^me))+ce[9]+568446438&4294967295,ee=te+(se<<5&4294967295|se>>>27),se=he+(te^me&(ee^te))+ce[14]+3275163606&4294967295,he=ee+(se<<9&4294967295|se>>>23),se=me+(ee^te&(he^ee))+ce[3]+4107603335&4294967295,me=he+(se<<14&4294967295|se>>>18),se=te+(he^ee&(me^he))+ce[8]+1163531501&4294967295,te=me+(se<<20&4294967295|se>>>12),se=ee+(me^he&(te^me))+ce[13]+2850285829&4294967295,ee=te+(se<<5&4294967295|se>>>27),se=he+(te^me&(ee^te))+ce[2]+4243563512&4294967295,he=ee+(se<<9&4294967295|se>>>23),se=me+(ee^te&(he^ee))+ce[7]+1735328473&4294967295,me=he+(se<<14&4294967295|se>>>18),se=te+(he^ee&(me^he))+ce[12]+2368359562&4294967295,te=me+(se<<20&4294967295|se>>>12),se=ee+(te^me^he)+ce[5]+4294588738&4294967295,ee=te+(se<<4&4294967295|se>>>28),se=he+(ee^te^me)+ce[8]+2272392833&4294967295,he=ee+(se<<11&4294967295|se>>>21),se=me+(he^ee^te)+ce[11]+1839030562&4294967295,me=he+(se<<16&4294967295|se>>>16),se=te+(me^he^ee)+ce[14]+4259657740&4294967295,te=me+(se<<23&4294967295|se>>>9),se=ee+(te^me^he)+ce[1]+2763975236&4294967295,ee=te+(se<<4&4294967295|se>>>28),se=he+(ee^te^me)+ce[4]+1272893353&4294967295,he=ee+(se<<11&4294967295|se>>>21),se=me+(he^ee^te)+ce[7]+4139469664&4294967295,me=he+(se<<16&4294967295|se>>>16),se=te+(me^he^ee)+ce[10]+3200236656&4294967295,te=me+(se<<23&4294967295|se>>>9),se=ee+(te^me^he)+ce[13]+681279174&4294967295,ee=te+(se<<4&4294967295|se>>>28),se=he+(ee^te^me)+ce[0]+3936430074&4294967295,he=ee+(se<<11&4294967295|se>>>21),se=me+(he^ee^te)+ce[3]+3572445317&4294967295,me=he+(se<<16&4294967295|se>>>16),se=te+(me^he^ee)+ce[6]+76029189&4294967295,te=me+(se<<23&4294967295|se>>>9),se=ee+(te^me^he)+ce[9]+3654602809&4294967295,ee=te+(se<<4&4294967295|se>>>28),se=he+(ee^te^me)+ce[12]+3873151461&4294967295,he=ee+(se<<11&4294967295|se>>>21),se=me+(he^ee^te)+ce[15]+530742520&4294967295,me=he+(se<<16&4294967295|se>>>16),se=te+(me^he^ee)+ce[2]+3299628645&4294967295,te=me+(se<<23&4294967295|se>>>9),se=ee+(me^(te|~he))+ce[0]+4096336452&4294967295,ee=te+(se<<6&4294967295|se>>>26),se=he+(te^(ee|~me))+ce[7]+1126891415&4294967295,he=ee+(se<<10&4294967295|se>>>22),se=me+(ee^(he|~te))+ce[14]+2878612391&4294967295,me=he+(se<<15&4294967295|se>>>17),se=te+(he^(me|~ee))+ce[5]+4237533241&4294967295,te=me+(se<<21&4294967295|se>>>11),se=ee+(me^(te|~he))+ce[12]+1700485571&4294967295,ee=te+(se<<6&4294967295|se>>>26),se=he+(te^(ee|~me))+ce[3]+2399980690&4294967295,he=ee+(se<<10&4294967295|se>>>22),se=me+(ee^(he|~te))+ce[10]+4293915773&4294967295,me=he+(se<<15&4294967295|se>>>17),se=te+(he^(me|~ee))+ce[1]+2240044497&4294967295,te=me+(se<<21&4294967295|se>>>11),se=ee+(me^(te|~he))+ce[8]+1873313359&4294967295,ee=te+(se<<6&4294967295|se>>>26),se=he+(te^(ee|~me))+ce[15]+4264355552&4294967295,he=ee+(se<<10&4294967295|se>>>22),se=me+(ee^(he|~te))+ce[6]+2734768916&4294967295,me=he+(se<<15&4294967295|se>>>17),se=te+(he^(me|~ee))+ce[13]+1309151649&4294967295,te=me+(se<<21&4294967295|se>>>11),se=ee+(me^(te|~he))+ce[4]+4149444226&4294967295,ee=te+(se<<6&4294967295|se>>>26),se=he+(te^(ee|~me))+ce[11]+3174756917&4294967295,he=ee+(se<<10&4294967295|se>>>22),se=me+(ee^(he|~te))+ce[2]+718787259&4294967295,me=he+(se<<15&4294967295|se>>>17),se=te+(he^(me|~ee))+ce[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+ee&4294967295,Z.g[1]=Z.g[1]+(me+(se<<21&4294967295|se>>>11))&4294967295,Z.g[2]=Z.g[2]+me&4294967295,Z.g[3]=Z.g[3]+he&4294967295}a.prototype.u=function(Z,ee){ee===void 0&&(ee=Z.length);for(var te=ee-this.blockSize,ce=this.B,me=this.h,he=0;he<ee;){if(me==0)for(;he<=te;)l(this,Z,he),he+=this.blockSize;if(typeof Z=="string"){for(;he<ee;)if(ce[me++]=Z.charCodeAt(he++),me==this.blockSize){l(this,ce),me=0;break}}else for(;he<ee;)if(ce[me++]=Z[he++],me==this.blockSize){l(this,ce),me=0;break}}this.h=me,this.o+=ee},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var ee=1;ee<Z.length-8;++ee)Z[ee]=0;var te=8*this.o;for(ee=Z.length-8;ee<Z.length;++ee)Z[ee]=te&255,te/=256;for(this.u(Z),Z=Array(16),ee=te=0;4>ee;++ee)for(var ce=0;32>ce;ce+=8)Z[te++]=this.g[ee]>>>ce&255;return Z};function d(Z,ee){var te=E;return Object.prototype.hasOwnProperty.call(te,Z)?te[Z]:te[Z]=ee(Z)}function p(Z,ee){this.h=ee;for(var te=[],ce=!0,me=Z.length-1;0<=me;me--){var he=Z[me]|0;ce&&he==ee||(te[me]=he,ce=!1)}this.g=te}var E={};function v(Z){return-128<=Z&&128>Z?d(Z,function(ee){return new p([ee|0],0>ee?-1:0)}):new p([Z|0],0>Z?-1:0)}function T(Z){if(isNaN(Z)||!isFinite(Z))return A;if(0>Z)return G(T(-Z));for(var ee=[],te=1,ce=0;Z>=te;ce++)ee[ce]=Z/te|0,te*=4294967296;return new p(ee,0)}function w(Z,ee){if(Z.length==0)throw Error("number format error: empty string");if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(Z.charAt(0)=="-")return G(w(Z.substring(1),ee));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var te=T(Math.pow(ee,8)),ce=A,me=0;me<Z.length;me+=8){var he=Math.min(8,Z.length-me),se=parseInt(Z.substring(me,me+he),ee);8>he?(he=T(Math.pow(ee,he)),ce=ce.j(he).add(T(se))):(ce=ce.j(te),ce=ce.add(T(se)))}return ce}var A=v(0),N=v(1),F=v(16777216);n=p.prototype,n.m=function(){if(B(this))return-G(this).m();for(var Z=0,ee=1,te=0;te<this.g.length;te++){var ce=this.i(te);Z+=(0<=ce?ce:4294967296+ce)*ee,ee*=4294967296}return Z},n.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(j(this))return"0";if(B(this))return"-"+G(this).toString(Z);for(var ee=T(Math.pow(Z,6)),te=this,ce="";;){var me=de(te,ee).g;te=J(te,me.j(ee));var he=((0<te.g.length?te.g[0]:te.h)>>>0).toString(Z);if(te=me,j(te))return he+ce;for(;6>he.length;)he="0"+he;ce=he+ce}},n.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function j(Z){if(Z.h!=0)return!1;for(var ee=0;ee<Z.g.length;ee++)if(Z.g[ee]!=0)return!1;return!0}function B(Z){return Z.h==-1}n.l=function(Z){return Z=J(this,Z),B(Z)?-1:j(Z)?0:1};function G(Z){for(var ee=Z.g.length,te=[],ce=0;ce<ee;ce++)te[ce]=~Z.g[ce];return new p(te,~Z.h).add(N)}n.abs=function(){return B(this)?G(this):this},n.add=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),te=[],ce=0,me=0;me<=ee;me++){var he=ce+(this.i(me)&65535)+(Z.i(me)&65535),se=(he>>>16)+(this.i(me)>>>16)+(Z.i(me)>>>16);ce=se>>>16,he&=65535,se&=65535,te[me]=se<<16|he}return new p(te,te[te.length-1]&-2147483648?-1:0)};function J(Z,ee){return Z.add(G(ee))}n.j=function(Z){if(j(this)||j(Z))return A;if(B(this))return B(Z)?G(this).j(G(Z)):G(G(this).j(Z));if(B(Z))return G(this.j(G(Z)));if(0>this.l(F)&&0>Z.l(F))return T(this.m()*Z.m());for(var ee=this.g.length+Z.g.length,te=[],ce=0;ce<2*ee;ce++)te[ce]=0;for(ce=0;ce<this.g.length;ce++)for(var me=0;me<Z.g.length;me++){var he=this.i(ce)>>>16,se=this.i(ce)&65535,Se=Z.i(me)>>>16,Ve=Z.i(me)&65535;te[2*ce+2*me]+=se*Ve,K(te,2*ce+2*me),te[2*ce+2*me+1]+=he*Ve,K(te,2*ce+2*me+1),te[2*ce+2*me+1]+=se*Se,K(te,2*ce+2*me+1),te[2*ce+2*me+2]+=he*Se,K(te,2*ce+2*me+2)}for(ce=0;ce<ee;ce++)te[ce]=te[2*ce+1]<<16|te[2*ce];for(ce=ee;ce<2*ee;ce++)te[ce]=0;return new p(te,0)};function K(Z,ee){for(;(Z[ee]&65535)!=Z[ee];)Z[ee+1]+=Z[ee]>>>16,Z[ee]&=65535,ee++}function ne(Z,ee){this.g=Z,this.h=ee}function de(Z,ee){if(j(ee))throw Error("division by zero");if(j(Z))return new ne(A,A);if(B(Z))return ee=de(G(Z),ee),new ne(G(ee.g),G(ee.h));if(B(ee))return ee=de(Z,G(ee)),new ne(G(ee.g),ee.h);if(30<Z.g.length){if(B(Z)||B(ee))throw Error("slowDivide_ only works with positive integers.");for(var te=N,ce=ee;0>=ce.l(Z);)te=oe(te),ce=oe(ce);var me=_e(te,1),he=_e(ce,1);for(ce=_e(ce,2),te=_e(te,2);!j(ce);){var se=he.add(ce);0>=se.l(Z)&&(me=me.add(te),he=se),ce=_e(ce,1),te=_e(te,1)}return ee=J(Z,me.j(ee)),new ne(me,ee)}for(me=A;0<=Z.l(ee);){for(te=Math.max(1,Math.floor(Z.m()/ee.m())),ce=Math.ceil(Math.log(te)/Math.LN2),ce=48>=ce?1:Math.pow(2,ce-48),he=T(te),se=he.j(ee);B(se)||0<se.l(Z);)te-=ce,he=T(te),se=he.j(ee);j(he)&&(he=N),me=me.add(he),Z=J(Z,se)}return new ne(me,Z)}n.A=function(Z){return de(this,Z).h},n.and=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),te=[],ce=0;ce<ee;ce++)te[ce]=this.i(ce)&Z.i(ce);return new p(te,this.h&Z.h)},n.or=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),te=[],ce=0;ce<ee;ce++)te[ce]=this.i(ce)|Z.i(ce);return new p(te,this.h|Z.h)},n.xor=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),te=[],ce=0;ce<ee;ce++)te[ce]=this.i(ce)^Z.i(ce);return new p(te,this.h^Z.h)};function oe(Z){for(var ee=Z.g.length+1,te=[],ce=0;ce<ee;ce++)te[ce]=Z.i(ce)<<1|Z.i(ce-1)>>>31;return new p(te,Z.h)}function _e(Z,ee){var te=ee>>5;ee%=32;for(var ce=Z.g.length-te,me=[],he=0;he<ce;he++)me[he]=0<ee?Z.i(he+te)>>>ee|Z.i(he+te+1)<<32-ee:Z.i(he+te);return new p(me,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,fre=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=T,p.fromString=w,cg=p}).apply(typeof tX<"u"?tX:typeof self<"u"?self:typeof window<"u"?window:{});var gO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pre,kw,mre,ZO,pV,gre,_re,Ere;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,W,Q){return C==Array.prototype||C==Object.prototype||(C[W]=Q.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof gO=="object"&&gO];for(var W=0;W<C.length;++W){var Q=C[W];if(Q&&Q.Math==Math)return Q}throw Error("Cannot find global object")}var a=s(this);function l(C,W){if(W)e:{var Q=a;C=C.split(".");for(var fe=0;fe<C.length-1;fe++){var $e=C[fe];if(!($e in Q))break e;Q=Q[$e]}C=C[C.length-1],fe=Q[C],W=W(fe),W!=fe&&W!=null&&t(Q,C,{configurable:!0,writable:!0,value:W})}}function d(C,W){C instanceof String&&(C+="");var Q=0,fe=!1,$e={next:function(){if(!fe&&Q<C.length){var ot=Q++;return{value:W(ot,C[ot]),done:!1}}return fe=!0,{done:!0,value:void 0}}};return $e[Symbol.iterator]=function(){return $e},$e}l("Array.prototype.values",function(C){return C||function(){return d(this,function(W,Q){return Q})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},E=this||self;function v(C){var W=typeof C;return W=W!="object"?W:C?Array.isArray(C)?"array":W:"null",W=="array"||W=="object"&&typeof C.length=="number"}function T(C){var W=typeof C;return W=="object"&&C!=null||W=="function"}function w(C,W,Q){return C.call.apply(C.bind,arguments)}function A(C,W,Q){if(!C)throw Error();if(2<arguments.length){var fe=Array.prototype.slice.call(arguments,2);return function(){var $e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply($e,fe),C.apply(W,$e)}}return function(){return C.apply(W,arguments)}}function N(C,W,Q){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function F(C,W){var Q=Array.prototype.slice.call(arguments,1);return function(){var fe=Q.slice();return fe.push.apply(fe,arguments),C.apply(this,fe)}}function j(C,W){function Q(){}Q.prototype=W.prototype,C.aa=W.prototype,C.prototype=new Q,C.prototype.constructor=C,C.Qb=function(fe,$e,ot){for(var xt=Array(arguments.length-2),zr=2;zr<arguments.length;zr++)xt[zr-2]=arguments[zr];return W.prototype[$e].apply(fe,xt)}}function B(C){const W=C.length;if(0<W){const Q=Array(W);for(let fe=0;fe<W;fe++)Q[fe]=C[fe];return Q}return[]}function G(C,W){for(let Q=1;Q<arguments.length;Q++){const fe=arguments[Q];if(v(fe)){const $e=C.length||0,ot=fe.length||0;C.length=$e+ot;for(let xt=0;xt<ot;xt++)C[$e+xt]=fe[xt]}else C.push(fe)}}class J{constructor(W,Q){this.i=W,this.j=Q,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function K(C){return/^[\s\xa0]*$/.test(C)}function ne(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function de(C){return de[" "](C),C}de[" "]=function(){};var oe=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function _e(C,W,Q){for(const fe in C)W.call(Q,C[fe],fe,C)}function Z(C,W){for(const Q in C)W.call(void 0,C[Q],Q,C)}function ee(C){const W={};for(const Q in C)W[Q]=C[Q];return W}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ce(C,W){let Q,fe;for(let $e=1;$e<arguments.length;$e++){fe=arguments[$e];for(Q in fe)C[Q]=fe[Q];for(let ot=0;ot<te.length;ot++)Q=te[ot],Object.prototype.hasOwnProperty.call(fe,Q)&&(C[Q]=fe[Q])}}function me(C){var W=1;C=C.split(":");const Q=[];for(;0<W&&C.length;)Q.push(C.shift()),W--;return C.length&&Q.push(C.join(":")),Q}function he(C){E.setTimeout(()=>{throw C},0)}function se(){var C=Ce;let W=null;return C.g&&(W=C.g,C.g=C.g.next,C.g||(C.h=null),W.next=null),W}class Se{constructor(){this.h=this.g=null}add(W,Q){const fe=Ve.get();fe.set(W,Q),this.h?this.h.next=fe:this.g=fe,this.h=fe}}var Ve=new J(()=>new tt,C=>C.reset());class tt{constructor(){this.next=this.g=this.h=null}set(W,Q){this.h=W,this.g=Q,this.next=null}reset(){this.next=this.g=this.h=null}}let ke,Me=!1,Ce=new Se,Xe=()=>{const C=E.Promise.resolve(void 0);ke=()=>{C.then(Ae)}};var Ae=()=>{for(var C;C=se();){try{C.h.call(C.g)}catch(Q){he(Q)}var W=Ve;W.j(C),100>W.h&&(W.h++,C.next=W.g,W.g=C)}Me=!1};function Ie(){this.s=this.s,this.C=this.C}Ie.prototype.s=!1,Ie.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ie.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function be(C,W){this.type=C,this.g=this.target=W,this.defaultPrevented=!1}be.prototype.h=function(){this.defaultPrevented=!0};var xe=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,W=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const Q=()=>{};E.addEventListener("test",Q,W),E.removeEventListener("test",Q,W)}catch{}return C}();function We(C,W){if(be.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var Q=this.type=C.type,fe=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=W,W=C.relatedTarget){if(oe){e:{try{de(W.nodeName);var $e=!0;break e}catch{}$e=!1}$e||(W=null)}}else Q=="mouseover"?W=C.fromElement:Q=="mouseout"&&(W=C.toElement);this.relatedTarget=W,fe?(this.clientX=fe.clientX!==void 0?fe.clientX:fe.pageX,this.clientY=fe.clientY!==void 0?fe.clientY:fe.pageY,this.screenX=fe.screenX||0,this.screenY=fe.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:Qe[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&We.aa.h.call(this)}}j(We,be);var Qe={2:"touch",3:"pen",4:"mouse"};We.prototype.h=function(){We.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var Ze="closure_listenable_"+(1e6*Math.random()|0),ut=0;function it(C,W,Q,fe,$e){this.listener=C,this.proxy=null,this.src=W,this.type=Q,this.capture=!!fe,this.ha=$e,this.key=++ut,this.da=this.fa=!1}function It(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function yn(C){this.src=C,this.g={},this.h=0}yn.prototype.add=function(C,W,Q,fe,$e){var ot=C.toString();C=this.g[ot],C||(C=this.g[ot]=[],this.h++);var xt=ln(C,W,fe,$e);return-1<xt?(W=C[xt],Q||(W.fa=!1)):(W=new it(W,this.src,ot,!!fe,$e),W.fa=Q,C.push(W)),W};function Vt(C,W){var Q=W.type;if(Q in C.g){var fe=C.g[Q],$e=Array.prototype.indexOf.call(fe,W,void 0),ot;(ot=0<=$e)&&Array.prototype.splice.call(fe,$e,1),ot&&(It(W),C.g[Q].length==0&&(delete C.g[Q],C.h--))}}function ln(C,W,Q,fe){for(var $e=0;$e<C.length;++$e){var ot=C[$e];if(!ot.da&&ot.listener==W&&ot.capture==!!Q&&ot.ha==fe)return $e}return-1}var xn="closure_lm_"+(1e6*Math.random()|0),Qt={};function Ot(C,W,Q,fe,$e){if(Array.isArray(W)){for(var ot=0;ot<W.length;ot++)Ot(C,W[ot],Q,fe,$e);return null}return Q=dn(Q),C&&C[Ze]?C.K(W,Q,T(fe)?!!fe.capture:!1,$e):Dt(C,W,Q,!1,fe,$e)}function Dt(C,W,Q,fe,$e,ot){if(!W)throw Error("Invalid event type");var xt=T($e)?!!$e.capture:!!$e,zr=St(C);if(zr||(C[xn]=zr=new yn(C)),Q=zr.add(W,Q,fe,xt,ot),Q.proxy)return Q;if(fe=ve(),Q.proxy=fe,fe.src=C,fe.listener=Q,C.addEventListener)xe||($e=xt),$e===void 0&&($e=!1),C.addEventListener(W.toString(),fe,$e);else if(C.attachEvent)C.attachEvent(_t(W.toString()),fe);else if(C.addListener&&C.removeListener)C.addListener(fe);else throw Error("addEventListener and attachEvent are unavailable.");return Q}function ve(){function C(Q){return W.call(C.src,C.listener,Q)}const W=vt;return C}function Ue(C,W,Q,fe,$e){if(Array.isArray(W))for(var ot=0;ot<W.length;ot++)Ue(C,W[ot],Q,fe,$e);else fe=T(fe)?!!fe.capture:!!fe,Q=dn(Q),C&&C[Ze]?(C=C.i,W=String(W).toString(),W in C.g&&(ot=C.g[W],Q=ln(ot,Q,fe,$e),-1<Q&&(It(ot[Q]),Array.prototype.splice.call(ot,Q,1),ot.length==0&&(delete C.g[W],C.h--)))):C&&(C=St(C))&&(W=C.g[W.toString()],C=-1,W&&(C=ln(W,Q,fe,$e)),(Q=-1<C?W[C]:null)&&He(Q))}function He(C){if(typeof C!="number"&&C&&!C.da){var W=C.src;if(W&&W[Ze])Vt(W.i,C);else{var Q=C.type,fe=C.proxy;W.removeEventListener?W.removeEventListener(Q,fe,C.capture):W.detachEvent?W.detachEvent(_t(Q),fe):W.addListener&&W.removeListener&&W.removeListener(fe),(Q=St(W))?(Vt(Q,C),Q.h==0&&(Q.src=null,W[xn]=null)):It(C)}}}function _t(C){return C in Qt?Qt[C]:Qt[C]="on"+C}function vt(C,W){if(C.da)C=!0;else{W=new We(W,this);var Q=C.listener,fe=C.ha||C.src;C.fa&&He(C),C=Q.call(fe,W)}return C}function St(C){return C=C[xn],C instanceof yn?C:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function dn(C){return typeof C=="function"?C:(C[zt]||(C[zt]=function(W){return C.handleEvent(W)}),C[zt])}function fn(){Ie.call(this),this.i=new yn(this),this.M=this,this.F=null}j(fn,Ie),fn.prototype[Ze]=!0,fn.prototype.removeEventListener=function(C,W,Q,fe){Ue(this,C,W,Q,fe)};function Xt(C,W){var Q,fe=C.F;if(fe)for(Q=[];fe;fe=fe.F)Q.push(fe);if(C=C.M,fe=W.type||W,typeof W=="string")W=new be(W,C);else if(W instanceof be)W.target=W.target||C;else{var $e=W;W=new be(fe,C),ce(W,$e)}if($e=!0,Q)for(var ot=Q.length-1;0<=ot;ot--){var xt=W.g=Q[ot];$e=Bn(xt,fe,!0,W)&&$e}if(xt=W.g=C,$e=Bn(xt,fe,!0,W)&&$e,$e=Bn(xt,fe,!1,W)&&$e,Q)for(ot=0;ot<Q.length;ot++)xt=W.g=Q[ot],$e=Bn(xt,fe,!1,W)&&$e}fn.prototype.N=function(){if(fn.aa.N.call(this),this.i){var C=this.i,W;for(W in C.g){for(var Q=C.g[W],fe=0;fe<Q.length;fe++)It(Q[fe]);delete C.g[W],C.h--}}this.F=null},fn.prototype.K=function(C,W,Q,fe){return this.i.add(String(C),W,!1,Q,fe)},fn.prototype.L=function(C,W,Q,fe){return this.i.add(String(C),W,!0,Q,fe)};function Bn(C,W,Q,fe){if(W=C.i.g[String(W)],!W)return!0;W=W.concat();for(var $e=!0,ot=0;ot<W.length;++ot){var xt=W[ot];if(xt&&!xt.da&&xt.capture==Q){var zr=xt.listener,ri=xt.ha||xt.src;xt.fa&&Vt(C.i,xt),$e=zr.call(ri,fe)!==!1&&$e}}return $e&&!fe.defaultPrevented}function cc(C,W,Q){if(typeof C=="function")Q&&(C=N(C,Q));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:E.setTimeout(C,W||0)}function jt(C){C.g=cc(()=>{C.g=null,C.i&&(C.i=!1,jt(C))},C.l);const W=C.h;C.h=null,C.m.apply(null,W)}class an extends Ie{constructor(W,Q){super(),this.m=W,this.l=Q,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:jt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zi(C){Ie.call(this),this.h=C,this.g={}}j(Zi,Ie);var Ms=[];function qs(C){_e(C.g,function(W,Q){this.g.hasOwnProperty(Q)&&He(W)},C),C.g={}}Zi.prototype.N=function(){Zi.aa.N.call(this),qs(this)},Zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hi=E.JSON.stringify,Ma=E.JSON.parse,tl=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function lo(){}lo.prototype.h=null;function uo(C){return C.h||(C.h=C.i())}function Ml(){}var Us={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function lc(){be.call(this,"d")}j(lc,be);function ra(){be.call(this,"c")}j(ra,be);var uc={},nl=null;function Nu(){return nl=nl||new fn}uc.La="serverreachability";function dc(C){be.call(this,uc.La,C)}j(dc,be);function rl(C){const W=Nu();Xt(W,new dc(W))}uc.STAT_EVENT="statevent";function Co(C,W){be.call(this,uc.STAT_EVENT,C),this.stat=W}j(Co,be);function ki(C){const W=Nu();Xt(W,new Co(W,C))}uc.Ma="timingevent";function as(C,W){be.call(this,uc.Ma,C),this.size=W}j(as,be);function Ua(C,W){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},W)}function Du(){this.g=!0}Du.prototype.xa=function(){this.g=!1};function hc(C,W,Q,fe,$e,ot){C.info(function(){if(C.g)if(ot)for(var xt="",zr=ot.split("&"),ri=0;ri<zr.length;ri++){var gr=zr[ri].split("=");if(1<gr.length){var Fs=gr[0];gr=gr[1];var ls=Fs.split("_");xt=2<=ls.length&&ls[1]=="type"?xt+(Fs+"="+gr+"&"):xt+(Fs+"=redacted&")}}else xt=null;else xt=ot;return"XMLHTTP REQ ("+fe+") [attempt "+$e+"]: "+W+`
`+Q+`
`+xt})}function ia(C,W,Q,fe,$e,ot,xt){C.info(function(){return"XMLHTTP RESP ("+fe+") [ attempt "+$e+"]: "+W+`
`+Q+`
`+ot+" "+xt})}function sa(C,W,Q,fe){C.info(function(){return"XMLHTTP TEXT ("+W+"): "+Og(C,Q)+(fe?" "+fe:"")})}function Ld(C,W){C.info(function(){return"TIMEOUT: "+W})}Du.prototype.info=function(){};function Og(C,W){if(!C.g)return W;if(!W)return null;try{var Q=JSON.parse(W);if(Q){for(C=0;C<Q.length;C++)if(Array.isArray(Q[C])){var fe=Q[C];if(!(2>fe.length)){var $e=fe[1];if(Array.isArray($e)&&!(1>$e.length)){var ot=$e[0];if(ot!="noop"&&ot!="stop"&&ot!="close")for(var xt=1;xt<$e.length;xt++)$e[xt]=""}}}}return hi(Q)}catch{return W}}var Lu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},af={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Vs;function xu(){}j(xu,lo),xu.prototype.g=function(){return new XMLHttpRequest},xu.prototype.i=function(){return{}},Vs=new xu;function oa(C,W,Q,fe){this.j=C,this.i=W,this.l=Q,this.R=fe||1,this.U=new Zi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xd}function xd(){this.i=null,this.g="",this.h=!1}var Md={},Va={};function Ud(C,W,Q){C.L=1,C.v=ja(Ao(W)),C.m=Q,C.P=!0,Mu(C,null)}function Mu(C,W){C.F=Date.now(),Vr(C),C.A=Ao(C.v);var Q=C.A,fe=C.R;Array.isArray(fe)||(fe=[String(fe)]),Wl(Q.i,"t",fe),C.C=0,Q=C.j.J,C.h=new xd,C.g=GE(C.j,Q?W:null,!C.m),0<C.O&&(C.M=new an(N(C.Y,C,C.g),C.O)),W=C.U,Q=C.g,fe=C.ca;var $e="readystatechange";Array.isArray($e)||($e&&(Ms[0]=$e.toString()),$e=Ms);for(var ot=0;ot<$e.length;ot++){var xt=Ot(Q,$e[ot],fe||W.handleEvent,!1,W.h||W);if(!xt)break;W.g[xt.key]=xt}W=C.H?ee(C.H):{},C.m?(C.u||(C.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,W)):(C.u="GET",C.g.ea(C.A,C.u,null,W)),rl(),hc(C.i,C.u,C.A,C.l,C.R,C.m)}oa.prototype.ca=function(C){C=C.target;const W=this.M;W&&pi(C)==3?W.j():this.Y(C)},oa.prototype.Y=function(C){try{if(C==this.g)e:{const ls=pi(this.g);var W=this.g.Ba();const Ba=this.g.Z();if(!(3>ls)&&(ls!=3||this.g&&(this.h.h||this.g.oa()||Rs(this.g)))){this.J||ls!=4||W==7||(W==8||0>=Ba?rl(3):rl(2)),fc(this);var Q=this.g.Z();this.X=Q;t:if(Io(this)){var fe=Rs(this.g);C="";var $e=fe.length,ot=pi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){aa(this),il(this);var xt="";break t}this.h.i=new E.TextDecoder}for(W=0;W<$e;W++)this.h.h=!0,C+=this.h.i.decode(fe[W],{stream:!(ot&&W==$e-1)});fe.length=0,this.h.g+=C,this.C=0,xt=this.h.g}else xt=this.g.oa();if(this.o=Q==200,ia(this.i,this.u,this.A,this.l,this.R,ls,Q),this.o){if(this.T&&!this.K){t:{if(this.g){var zr,ri=this.g;if((zr=ri.g?ri.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(zr)){var gr=zr;break t}}gr=null}if(Q=gr)sa(this.i,this.l,Q,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,cf(this,Q);else{this.o=!1,this.s=3,ki(12),aa(this),il(this);break e}}if(this.P){Q=!0;let Vo;for(;!this.J&&this.C<xt.length;)if(Vo=Vd(this,xt),Vo==Va){ls==4&&(this.s=4,ki(14),Q=!1),sa(this.i,this.l,null,"[Incomplete Response]");break}else if(Vo==Md){this.s=4,ki(15),sa(this.i,this.l,xt,"[Invalid Chunk]"),Q=!1;break}else sa(this.i,this.l,Vo,null),cf(this,Vo);if(Io(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ls!=4||xt.length!=0||this.h.h||(this.s=1,ki(16),Q=!1),this.o=this.o&&Q,!Q)sa(this.i,this.l,xt,"[Invalid Chunked Response]"),aa(this),il(this);else if(0<xt.length&&!this.W){this.W=!0;var Fs=this.j;Fs.g==this&&Fs.ba&&!Fs.M&&(Fs.j.info("Great, no buffering proxy detected. Bytes received: "+xt.length),Ng(Fs),Fs.M=!0,ki(11))}}else sa(this.i,this.l,xt,null),cf(this,xt);ls==4&&aa(this),this.o&&!this.J&&(ls==4?Wp(this.j,this):(this.o=!1,Vr(this)))}else Lo(this.g),Q==400&&0<xt.indexOf("Unknown SID")?(this.s=3,ki(12)):(this.s=0,ki(13)),aa(this),il(this)}}}catch{}finally{}};function Io(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function Vd(C,W){var Q=C.C,fe=W.indexOf(`
`,Q);return fe==-1?Va:(Q=Number(W.substring(Q,fe)),isNaN(Q)?Md:(fe+=1,fe+Q>W.length?Va:(W=W.slice(fe,fe+Q),C.C=fe+Q,W)))}oa.prototype.cancel=function(){this.J=!0,aa(this)};function Vr(C){C.S=Date.now()+C.I,fi(C,C.I)}function fi(C,W){if(C.B!=null)throw Error("WatchDog timer not null");C.B=Ua(N(C.ba,C),W)}function fc(C){C.B&&(E.clearTimeout(C.B),C.B=null)}oa.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(Ld(this.i,this.A),this.L!=2&&(rl(),ki(17)),aa(this),this.s=2,il(this)):fi(this,this.S-C)};function il(C){C.j.G==0||C.J||Wp(C.j,C)}function aa(C){fc(C);var W=C.M;W&&typeof W.ma=="function"&&W.ma(),C.M=null,qs(C.U),C.g&&(W=C.g,C.g=null,W.abort(),W.ma())}function cf(C,W){try{var Q=C.j;if(Q.G!=0&&(Q.g==C||Ys(Q.h,C))){if(!C.K&&Ys(Q.h,C)&&Q.G==3){try{var fe=Q.Da.g.parse(W)}catch{fe=null}if(Array.isArray(fe)&&fe.length==3){var $e=fe;if($e[0]==0){e:if(!Q.u){if(Q.g)if(Q.g.F+3e3<C.F)Bp(Q),ll(Q);else break e;jp(Q),ki(18)}}else Q.za=$e[1],0<Q.za-Q.T&&37500>$e[2]&&Q.F&&Q.v==0&&!Q.C&&(Q.C=Ua(N(Q.Za,Q),6e3));if(1>=Lp(Q.h)&&Q.ca){try{Q.ca()}catch{}Q.ca=void 0}}else zu(Q,11)}else if((C.K||Q.g==C)&&Bp(Q),!K(W))for($e=Q.Da.g.parse(W),W=0;W<$e.length;W++){let gr=$e[W];if(Q.T=gr[0],gr=gr[1],Q.G==2)if(gr[0]=="c"){Q.K=gr[1],Q.ia=gr[2];const Fs=gr[3];Fs!=null&&(Q.la=Fs,Q.j.info("VER="+Q.la));const ls=gr[4];ls!=null&&(Q.Aa=ls,Q.j.info("SVER="+Q.Aa));const Ba=gr[5];Ba!=null&&typeof Ba=="number"&&0<Ba&&(fe=1.5*Ba,Q.L=fe,Q.j.info("backChannelRequestTimeoutMs_="+fe)),fe=Q;const Vo=C.g;if(Vo){const ff=Vo.g?Vo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ff){var ot=fe.h;ot.g||ff.indexOf("spdy")==-1&&ff.indexOf("quic")==-1&&ff.indexOf("h2")==-1||(ot.j=ot.l,ot.g=new Set,ot.h&&(lf(ot,ot.h),ot.h=null))}if(fe.D){const Gp=Vo.g?Vo.g.getResponseHeader("X-HTTP-Session-Id"):null;Gp&&(fe.ya=Gp,Wr(fe.I,fe.D,Gp))}}Q.G=3,Q.l&&Q.l.ua(),Q.ba&&(Q.R=Date.now()-C.F,Q.j.info("Handshake RTT: "+Q.R+"ms")),fe=Q;var xt=C;if(fe.qa=Dg(fe,fe.J?fe.ia:null,fe.W),xt.K){sl(fe.h,xt);var zr=xt,ri=fe.L;ri&&(zr.I=ri),zr.B&&(fc(zr),Vr(zr)),fe.g=xt}else Gl(fe);0<Q.i.length&&gc(Q)}else gr[0]!="stop"&&gr[0]!="close"||zu(Q,7);else Q.G==3&&(gr[0]=="stop"||gr[0]=="close"?gr[0]=="stop"?zu(Q,7):Hi(Q):gr[0]!="noop"&&Q.l&&Q.l.ta(gr),Q.v=0)}}rl(4)}catch{}}var Fd=class{constructor(C,W){this.g=C,this.map=W}};function Ul(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ho(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function Lp(C){return C.h?1:C.g?C.g.size:0}function Ys(C,W){return C.h?C.h==W:C.g?C.g.has(W):!1}function lf(C,W){C.g?C.g.add(W):C.h=W}function sl(C,W){C.h&&C.h==W?C.h=null:C.g&&C.g.has(W)&&C.g.delete(W)}Ul.prototype.cancel=function(){if(this.i=jd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function jd(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let W=C.i;for(const Q of C.g.values())W=W.concat(Q.D);return W}return B(C.i)}function Bd(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(v(C)){for(var W=[],Q=C.length,fe=0;fe<Q;fe++)W.push(C[fe]);return W}W=[],Q=0;for(fe in C)W[Q++]=C[fe];return W}function ur(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(v(C)||typeof C=="string"){var W=[];C=C.length;for(var Q=0;Q<C;Q++)W.push(Q);return W}W=[],Q=0;for(const fe in C)W[Q++]=fe;return W}}}function Vl(C,W){if(C.forEach&&typeof C.forEach=="function")C.forEach(W,void 0);else if(v(C)||typeof C=="string")Array.prototype.forEach.call(C,W,void 0);else for(var Q=ur(C),fe=Bd(C),$e=fe.length,ot=0;ot<$e;ot++)W.call(void 0,fe[ot],Q&&Q[ot],C)}var Fl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Uu(C,W){if(C){C=C.split("&");for(var Q=0;Q<C.length;Q++){var fe=C[Q].indexOf("="),$e=null;if(0<=fe){var ot=C[Q].substring(0,fe);$e=C[Q].substring(fe+1)}else ot=C[Q];W(ot,$e?decodeURIComponent($e.replace(/\+/g," ")):"")}}}function Fa(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof Fa){this.h=C.h,Vu(this,C.j),this.o=C.o,this.g=C.g,ol(this,C.s),this.l=C.l;var W=C.i,Q=new Po;Q.i=W.i,W.g&&(Q.g=new Map(W.g),Q.h=W.h),jl(this,Q),this.m=C.m}else C&&(W=String(C).match(Fl))?(this.h=!1,Vu(this,W[1]||"",!0),this.o=rr(W[2]||""),this.g=rr(W[3]||"",!0),ol(this,W[4]),this.l=rr(W[5]||"",!0),jl(this,W[6]||"",!0),this.m=rr(W[7]||"")):(this.h=!1,this.i=new Po(null,this.h))}Fa.prototype.toString=function(){var C=[],W=this.j;W&&C.push(pc(W,Bl,!0),":");var Q=this.g;return(Q||W=="file")&&(C.push("//"),(W=this.o)&&C.push(pc(W,Bl,!0),"@"),C.push(encodeURIComponent(String(Q)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Q=this.s,Q!=null&&C.push(":",String(Q))),(Q=this.l)&&(this.g&&Q.charAt(0)!="/"&&C.push("/"),C.push(pc(Q,Q.charAt(0)=="/"?uf:Wd,!0))),(Q=this.i.toString())&&C.push("?",Q),(Q=this.m)&&C.push("#",pc(Q,df)),C.join("")};function Ao(C){return new Fa(C)}function Vu(C,W,Q){C.j=Q?rr(W,!0):W,C.j&&(C.j=C.j.replace(/:$/,""))}function ol(C,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);C.s=W}else C.s=null}function jl(C,W,Q){W instanceof Po?(C.i=W,Do(C.i,C.h)):(Q||(W=pc(W,Mp)),C.i=new Po(W,C.h))}function Wr(C,W,Q){C.i.set(W,Q)}function ja(C){return Wr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function rr(C,W){return C?W?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function pc(C,W,Q){return typeof C=="string"?(C=encodeURI(C).replace(W,xp),Q&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function xp(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var Bl=/[#\/\?@]/g,Wd=/[#\?:]/g,uf=/[#\?]/g,Mp=/[#\?@]/g,df=/#/g;function Po(C,W){this.h=this.g=null,this.i=C||null,this.j=!!W}function es(C){C.g||(C.g=new Map,C.h=0,C.i&&Uu(C.i,function(W,Q){C.add(decodeURIComponent(W.replace(/\+/g," ")),Q)}))}n=Po.prototype,n.add=function(C,W){es(this),this.i=null,C=No(this,C);var Q=this.g.get(C);return Q||this.g.set(C,Q=[]),Q.push(W),this.h+=1,this};function Oo(C,W){es(C),W=No(C,W),C.g.has(W)&&(C.i=null,C.h-=C.g.get(W).length,C.g.delete(W))}function ko(C,W){return es(C),W=No(C,W),C.g.has(W)}n.forEach=function(C,W){es(this),this.g.forEach(function(Q,fe){Q.forEach(function($e){C.call(W,$e,fe,this)},this)},this)},n.na=function(){es(this);const C=Array.from(this.g.values()),W=Array.from(this.g.keys()),Q=[];for(let fe=0;fe<W.length;fe++){const $e=C[fe];for(let ot=0;ot<$e.length;ot++)Q.push(W[fe])}return Q},n.V=function(C){es(this);let W=[];if(typeof C=="string")ko(this,C)&&(W=W.concat(this.g.get(No(this,C))));else{C=Array.from(this.g.values());for(let Q=0;Q<C.length;Q++)W=W.concat(C[Q])}return W},n.set=function(C,W){return es(this),this.i=null,C=No(this,C),ko(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[W]),this.h+=1,this},n.get=function(C,W){return C?(C=this.V(C),0<C.length?String(C[0]):W):W};function Wl(C,W,Q){Oo(C,W),0<Q.length&&(C.i=null,C.g.set(No(C,W),B(Q)),C.h+=Q.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],W=Array.from(this.g.keys());for(var Q=0;Q<W.length;Q++){var fe=W[Q];const ot=encodeURIComponent(String(fe)),xt=this.V(fe);for(fe=0;fe<xt.length;fe++){var $e=ot;xt[fe]!==""&&($e+="="+encodeURIComponent(String(xt[fe]))),C.push($e)}}return this.i=C.join("&")};function No(C,W){return W=String(W),C.j&&(W=W.toLowerCase()),W}function Do(C,W){W&&!C.j&&(es(C),C.i=null,C.g.forEach(function(Q,fe){var $e=fe.toLowerCase();fe!=$e&&(Oo(this,fe),Wl(this,$e,Q))},C)),C.j=W}function Up(C,W){const Q=new Du;if(E.Image){const fe=new Image;fe.onload=F(cs,Q,"TestLoadImage: loaded",!0,W,fe),fe.onerror=F(cs,Q,"TestLoadImage: error",!1,W,fe),fe.onabort=F(cs,Q,"TestLoadImage: abort",!1,W,fe),fe.ontimeout=F(cs,Q,"TestLoadImage: timeout",!1,W,fe),E.setTimeout(function(){fe.ontimeout&&fe.ontimeout()},1e4),fe.src=C}else W(!1)}function mc(C,W){const Q=new Du,fe=new AbortController,$e=setTimeout(()=>{fe.abort(),cs(Q,"TestPingServer: timeout",!1,W)},1e4);fetch(C,{signal:fe.signal}).then(ot=>{clearTimeout($e),ot.ok?cs(Q,"TestPingServer: ok",!0,W):cs(Q,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout($e),cs(Q,"TestPingServer: error",!1,W)})}function cs(C,W,Q,fe,$e){try{$e&&($e.onload=null,$e.onerror=null,$e.onabort=null,$e.ontimeout=null),fe(Q)}catch{}}function Fu(){this.g=new tl}function hf(C,W,Q){const fe=Q||"";try{Vl(C,function($e,ot){let xt=$e;T($e)&&(xt=hi($e)),W.push(fe+ot+"="+encodeURIComponent(xt))})}catch($e){throw W.push(fe+"type="+encodeURIComponent("_badmap")),$e}}function al(C){this.l=C.Ub||null,this.j=C.eb||!1}j(al,lo),al.prototype.g=function(){return new zl(this.l,this.j)},al.prototype.i=function(C){return function(){return C}}({});function zl(C,W){fn.call(this),this.D=C,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(zl,fn),n=zl.prototype,n.open=function(C,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=W,this.readyState=1,la(this)},n.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(W.body=C),(this.D||E).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ca(this)),this.readyState=0},n.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,la(this)),this.g&&(this.readyState=3,la(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Vp(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function Vp(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}n.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var W=C.value?C.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!C.done}))&&(this.response=this.responseText+=W)}C.done?ca(this):la(this),this.readyState==3&&Vp(this)}},n.Ra=function(C){this.g&&(this.response=this.responseText=C,ca(this))},n.Qa=function(C){this.g&&(this.response=C,ca(this))},n.ga=function(){this.g&&ca(this)};function ca(C){C.readyState=4,C.l=null,C.j=null,C.v=null,la(C)}n.setRequestHeader=function(C,W){this.u.append(C,W)},n.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],W=this.h.entries();for(var Q=W.next();!Q.done;)Q=Q.value,C.push(Q[0]+": "+Q[1]),Q=W.next();return C.join(`\r
`)};function la(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(zl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function cl(C){let W="";return _e(C,function(Q,fe){W+=fe,W+=":",W+=Q,W+=`\r
`}),W}function ye(C,W,Q){e:{for(fe in Q){var fe=!1;break e}fe=!0}fe||(Q=cl(Q),typeof C=="string"?Q!=null&&encodeURIComponent(String(Q)):Wr(C,W,Q))}function Oe(C){fn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(Oe,fn);var et=/^https?$/i,qt=["POST","PUT"];n=Oe.prototype,n.Ha=function(C){this.J=C},n.ea=function(C,W,Q,fe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);W=W?W.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Vs.g(),this.v=this.o?uo(this.o):uo(Vs),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(W,String(C),!0),this.B=!1}catch(ot){Kn(this,ot);return}if(C=Q||"",Q=new Map(this.headers),fe)if(Object.getPrototypeOf(fe)===Object.prototype)for(var $e in fe)Q.set($e,fe[$e]);else if(typeof fe.keys=="function"&&typeof fe.get=="function")for(const ot of fe.keys())Q.set(ot,fe.get(ot));else throw Error("Unknown input type for opt_headers: "+String(fe));fe=Array.from(Q.keys()).find(ot=>ot.toLowerCase()=="content-type"),$e=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call(qt,W,void 0))||fe||$e||Q.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ot,xt]of Q)this.g.setRequestHeader(ot,xt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{kr(this),this.u=!0,this.g.send(C),this.u=!1}catch(ot){Kn(this,ot)}};function Kn(C,W){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=W,C.m=5,mr(C),cn(C)}function mr(C){C.A||(C.A=!0,Xt(C,"complete"),Xt(C,"error"))}n.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,Xt(this,"complete"),Xt(this,"abort"),cn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),Oe.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Fr(this):this.bb())},n.bb=function(){Fr(this)};function Fr(C){if(C.h&&typeof p<"u"&&(!C.v[1]||pi(C)!=4||C.Z()!=2)){if(C.u&&pi(C)==4)cc(C.Ea,0,C);else if(Xt(C,"readystatechange"),pi(C)==4){C.h=!1;try{const xt=C.Z();e:switch(xt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var Q;if(!(Q=W)){var fe;if(fe=xt===0){var $e=String(C.D).match(Fl)[1]||null;!$e&&E.self&&E.self.location&&($e=E.self.location.protocol.slice(0,-1)),fe=!et.test($e?$e.toLowerCase():"")}Q=fe}if(Q)Xt(C,"complete"),Xt(C,"success");else{C.m=6;try{var ot=2<pi(C)?C.g.statusText:""}catch{ot=""}C.l=ot+" ["+C.Z()+"]",mr(C)}}finally{cn(C)}}}}function cn(C,W){if(C.g){kr(C);const Q=C.g,fe=C.v[0]?()=>{}:null;C.g=null,C.v=null,W||Xt(C,"ready");try{Q.onreadystatechange=fe}catch{}}}function kr(C){C.I&&(E.clearTimeout(C.I),C.I=null)}n.isActive=function(){return!!this.g};function pi(C){return C.g?C.g.readyState:0}n.Z=function(){try{return 2<pi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(C){if(this.g){var W=this.g.responseText;return C&&W.indexOf(C)==0&&(W=W.substring(C.length)),Ma(W)}};function Rs(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function Lo(C){const W={};C=(C.g&&2<=pi(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let fe=0;fe<C.length;fe++){if(K(C[fe]))continue;var Q=me(C[fe]);const $e=Q[0];if(Q=Q[1],typeof Q!="string")continue;Q=Q.trim();const ot=W[$e]||[];W[$e]=ot,ot.push(Q)}Z(W,function(fe){return fe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function xo(C,W,Q){return Q&&Q.internalChannelParams&&Q.internalChannelParams[C]||W}function ju(C){this.Aa=0,this.i=[],this.j=new Du,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=xo("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=xo("baseRetryDelayMs",5e3,C),this.cb=xo("retryDelaySeedMs",1e4,C),this.Wa=xo("forwardChannelMaxRetries",2,C),this.wa=xo("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new Ul(C&&C.concurrentRequestLimit),this.Da=new Fu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ju.prototype,n.la=8,n.G=1,n.connect=function(C,W,Q,fe){ki(0),this.W=C,this.H=W||{},Q&&fe!==void 0&&(this.H.OSID=Q,this.H.OAID=fe),this.F=this.X,this.I=Dg(this,null,this.W),gc(this)};function Hi(C){if(zd(C),C.G==3){var W=C.U++,Q=Ao(C.I);if(Wr(Q,"SID",C.K),Wr(Q,"RID",W),Wr(Q,"TYPE","terminate"),Bu(C,Q),W=new oa(C,C.j,W),W.L=2,W.v=ja(Ao(Q)),Q=!1,E.navigator&&E.navigator.sendBeacon)try{Q=E.navigator.sendBeacon(W.v.toString(),"")}catch{}!Q&&E.Image&&(new Image().src=W.v,Q=!0),Q||(W.g=GE(W.j,null),W.g.ea(W.v)),W.F=Date.now(),Vr(W)}Gu(C)}function ll(C){C.g&&(Ng(C),C.g.cancel(),C.g=null)}function zd(C){ll(C),C.u&&(E.clearTimeout(C.u),C.u=null),Bp(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function gc(C){if(!ho(C.h)&&!C.s){C.s=!0;var W=C.Ga;ke||Xe(),Me||(ke(),Me=!0),Ce.add(W,C),C.B=0}}function kg(C,W){return Lp(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=W.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=Ua(N(C.Ga,C,W),Wu(C,C.B)),C.B++,!0)}n.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const $e=new oa(this,this.j,C);let ot=this.o;if(this.S&&(ot?(ot=ee(ot),ce(ot,this.S)):ot=this.S),this.m!==null||this.O||($e.H=ot,ot=null),this.P)e:{for(var W=0,Q=0;Q<this.i.length;Q++){t:{var fe=this.i[Q];if("__data__"in fe.map&&(fe=fe.map.__data__,typeof fe=="string")){fe=fe.length;break t}fe=void 0}if(fe===void 0)break;if(W+=fe,4096<W){W=Q;break e}if(W===4096||Q===this.i.length-1){W=Q+1;break e}}W=1e3}else W=1e3;W=Mo(this,$e,W),Q=Ao(this.I),Wr(Q,"RID",C),Wr(Q,"CVER",22),this.D&&Wr(Q,"X-HTTP-Session-Id",this.D),Bu(this,Q),ot&&(this.O?W="headers="+encodeURIComponent(String(cl(ot)))+"&"+W:this.m&&ye(Q,this.m,ot)),lf(this.h,$e),this.Ua&&Wr(Q,"TYPE","init"),this.P?(Wr(Q,"$req",W),Wr(Q,"SID","null"),$e.T=!0,Ud($e,Q,null)):Ud($e,Q,W),this.G=2}}else this.G==3&&(C?Fp(this,C):this.i.length==0||ho(this.h)||Fp(this))};function Fp(C,W){var Q;W?Q=W.l:Q=C.U++;const fe=Ao(C.I);Wr(fe,"SID",C.K),Wr(fe,"RID",Q),Wr(fe,"AID",C.T),Bu(C,fe),C.m&&C.o&&ye(fe,C.m,C.o),Q=new oa(C,C.j,Q,C.B+1),C.m===null&&(Q.H=C.o),W&&(C.i=W.D.concat(C.i)),W=Mo(C,Q,1e3),Q.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),lf(C.h,Q),Ud(Q,fe,W)}function Bu(C,W){C.H&&_e(C.H,function(Q,fe){Wr(W,fe,Q)}),C.l&&Vl({},function(Q,fe){Wr(W,fe,Q)})}function Mo(C,W,Q){Q=Math.min(C.i.length,Q);var fe=C.l?N(C.l.Na,C.l,C):null;e:{var $e=C.i;let ot=-1;for(;;){const xt=["count="+Q];ot==-1?0<Q?(ot=$e[0].g,xt.push("ofs="+ot)):ot=0:xt.push("ofs="+ot);let zr=!0;for(let ri=0;ri<Q;ri++){let gr=$e[ri].g;const Fs=$e[ri].map;if(gr-=ot,0>gr)ot=Math.max(0,$e[ri].g-100),zr=!1;else try{hf(Fs,xt,"req"+gr+"_")}catch{fe&&fe(Fs)}}if(zr){fe=xt.join("&");break e}}}return C=C.i.splice(0,Q),W.D=C,fe}function Gl(C){if(!C.g&&!C.u){C.Y=1;var W=C.Fa;ke||Xe(),Me||(ke(),Me=!0),Ce.add(W,C),C.v=0}}function jp(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=Ua(N(C.Fa,C),Wu(C,C.v)),C.v++,!0)}n.Fa=function(){if(this.u=null,zE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=Ua(N(this.ab,this),C)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ki(10),ll(this),zE(this))};function Ng(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function zE(C){C.g=new oa(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var W=Ao(C.qa);Wr(W,"RID","rpc"),Wr(W,"SID",C.K),Wr(W,"AID",C.T),Wr(W,"CI",C.F?"0":"1"),!C.F&&C.ja&&Wr(W,"TO",C.ja),Wr(W,"TYPE","xmlhttp"),Bu(C,W),C.m&&C.o&&ye(W,C.m,C.o),C.L&&(C.g.I=C.L);var Q=C.g;C=C.ia,Q.L=1,Q.v=ja(Ao(W)),Q.m=null,Q.P=!0,Mu(Q,C)}n.Za=function(){this.C!=null&&(this.C=null,ll(this),jp(this),ki(19))};function Bp(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function Wp(C,W){var Q=null;if(C.g==W){Bp(C),Ng(C),C.g=null;var fe=2}else if(Ys(C.h,W))Q=W.D,sl(C.h,W),fe=1;else return;if(C.G!=0){if(W.o)if(fe==1){Q=W.m?W.m.length:0,W=Date.now()-W.F;var $e=C.B;fe=Nu(),Xt(fe,new as(fe,Q)),gc(C)}else Gl(C);else if($e=W.s,$e==3||$e==0&&0<W.X||!(fe==1&&kg(C,W)||fe==2&&jp(C)))switch(Q&&0<Q.length&&(W=C.h,W.i=W.i.concat(Q)),$e){case 1:zu(C,5);break;case 4:zu(C,10);break;case 3:zu(C,6);break;default:zu(C,2)}}}function Wu(C,W){let Q=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(Q*=2),Q*W}function zu(C,W){if(C.j.info("Error code "+W),W==2){var Q=N(C.fb,C),fe=C.Xa;const $e=!fe;fe=new Fa(fe||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||Vu(fe,"https"),ja(fe),$e?Up(fe.toString(),Q):mc(fe.toString(),Q)}else ki(2);C.G=0,C.l&&C.l.sa(W),Gu(C),zd(C)}n.fb=function(C){C?(this.j.info("Successfully pinged google.com"),ki(2)):(this.j.info("Failed to ping google.com"),ki(1))};function Gu(C){if(C.G=0,C.ka=[],C.l){const W=jd(C.h);(W.length!=0||C.i.length!=0)&&(G(C.ka,W),G(C.ka,C.i),C.h.i.length=0,B(C.i),C.i.length=0),C.l.ra()}}function Dg(C,W,Q){var fe=Q instanceof Fa?Ao(Q):new Fa(Q);if(fe.g!="")W&&(fe.g=W+"."+fe.g),ol(fe,fe.s);else{var $e=E.location;fe=$e.protocol,W=W?W+"."+$e.hostname:$e.hostname,$e=+$e.port;var ot=new Fa(null);fe&&Vu(ot,fe),W&&(ot.g=W),$e&&ol(ot,$e),Q&&(ot.l=Q),fe=ot}return Q=C.D,W=C.ya,Q&&W&&Wr(fe,Q,W),Wr(fe,"VER",C.la),Bu(C,fe),fe}function GE(C,W,Q){if(W&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=C.Ca&&!C.pa?new Oe(new al({eb:Q})):new Oe(C.pa),W.Ha(C.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mn(){}n=Mn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function zp(){}zp.prototype.g=function(C,W){return new Uo(C,W)};function Uo(C,W){fn.call(this),this.g=new ju(W),this.l=C,this.h=W&&W.messageUrlParams||null,C=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(C?C["X-WebChannel-Content-Type"]=W.messageContentType:C={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(C?C["X-WebChannel-Client-Profile"]=W.va:C={"X-WebChannel-Client-Profile":W.va}),this.g.S=C,(C=W&&W.Sb)&&!K(C)&&(this.g.m=C),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!K(W)&&(this.g.D=W,C=this.h,C!==null&&W in C&&(C=this.h,W in C&&delete C[W])),this.j=new _c(this)}j(Uo,fn),Uo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Uo.prototype.close=function(){Hi(this.g)},Uo.prototype.o=function(C){var W=this.g;if(typeof C=="string"){var Q={};Q.__data__=C,C=Q}else this.u&&(Q={},Q.__data__=hi(C),C=Q);W.i.push(new Fd(W.Ya++,C)),W.G==3&&gc(W)},Uo.prototype.N=function(){this.g.l=null,delete this.j,Hi(this.g),delete this.g,Uo.aa.N.call(this)};function HE(C){lc.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var W=C.__sm__;if(W){e:{for(const Q in W){C=Q;break e}C=void 0}(this.i=C)&&(C=this.i,W=W!==null&&C in W?W[C]:void 0),this.data=W}else this.data=C}j(HE,lc);function $E(){ra.call(this),this.status=1}j($E,ra);function _c(C){this.g=C}j(_c,Mn),_c.prototype.ua=function(){Xt(this.g,"a")},_c.prototype.ta=function(C){Xt(this.g,new HE(C))},_c.prototype.sa=function(C){Xt(this.g,new $E)},_c.prototype.ra=function(){Xt(this.g,"b")},zp.prototype.createWebChannel=zp.prototype.g,Uo.prototype.send=Uo.prototype.o,Uo.prototype.open=Uo.prototype.m,Uo.prototype.close=Uo.prototype.close,Ere=function(){return new zp},_re=function(){return Nu()},gre=uc,pV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Lu.NO_ERROR=0,Lu.TIMEOUT=8,Lu.HTTP_ERROR=6,ZO=Lu,af.COMPLETE="complete",mre=af,Ml.EventType=Us,Us.OPEN="a",Us.CLOSE="b",Us.ERROR="c",Us.MESSAGE="d",fn.prototype.listen=fn.prototype.K,kw=Ml,Oe.prototype.listenOnce=Oe.prototype.L,Oe.prototype.getLastError=Oe.prototype.Ka,Oe.prototype.getLastErrorCode=Oe.prototype.Ba,Oe.prototype.getStatus=Oe.prototype.Z,Oe.prototype.getResponseJson=Oe.prototype.Oa,Oe.prototype.getResponseText=Oe.prototype.oa,Oe.prototype.send=Oe.prototype.ea,Oe.prototype.setWithCredentials=Oe.prototype.Ha,pre=Oe}).apply(typeof gO<"u"?gO:typeof self<"u"?self:typeof window<"u"?window:{});const nX="@firebase/firestore",rX="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Pa.UNAUTHENTICATED=new Pa(null),Pa.GOOGLE_CREDENTIALS=new Pa("google-credentials-uid"),Pa.FIRST_PARTY=new Pa("first-party-uid"),Pa.MOCK_USER=new Pa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O0="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE=new mj("@firebase/firestore");function pS(){return OE.logLevel}function en(n,...t){if(OE.logLevel<=yr.DEBUG){const s=t.map(Cj);OE.debug(`Firestore (${O0}): ${n}`,...s)}}function Pp(n,...t){if(OE.logLevel<=yr.ERROR){const s=t.map(Cj);OE.error(`Firestore (${O0}): ${n}`,...s)}}function d0(n,...t){if(OE.logLevel<=yr.WARN){const s=t.map(Cj);OE.warn(`Firestore (${O0}): ${n}`,...s)}}function Cj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jn(n="Unexpected state"){const t=`FIRESTORE (${O0}) INTERNAL ASSERTION FAILED: `+n;throw Pp(t),new Error(t)}function ni(n,t){n||jn()}function Xn(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Gt extends of{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yre{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class pFe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Pa.UNAUTHENTICATED))}shutdown(){}}class mFe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class gFe{constructor(t){this.t=t,this.currentUser=Pa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ni(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new Tp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Tp,t.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{en("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(en("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Tp)}},0),p()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(en("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ni(typeof a.accessToken=="string"),new yre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ni(t===null||typeof t=="string"),new Pa(t)}}class _Fe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Pa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class EFe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new _Fe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Pa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iX{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class yFe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Rl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){ni(this.o===void 0);const a=d=>{d.error!=null&&en("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,en("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{en("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):en("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new iX(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ni(typeof s.token=="string"),this.R=s.token,new iX(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vFe(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<n;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vre{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=vFe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function Ir(n,t){return n<t?-1:n>t?1:0}function h0(n,t,s){return n.length===t.length&&n.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sX=-62135596800,oX=1e6;class oo{static now(){return oo.fromMillis(Date.now())}static fromDate(t){return oo.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*oX);return new oo(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new Gt(gt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new Gt(gt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<sX)throw new Gt(gt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Gt(gt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/oX}_compareTo(t){return this.seconds===t.seconds?Ir(this.nanoseconds,t.nanoseconds):Ir(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-sX;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{static fromTimestamp(t){return new $n(t)}static min(){return new $n(new oo(0,0))}static max(){return new $n(new oo(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aX="__name__";class kh{constructor(t,s,a){s===void 0?s=0:s>t.length&&jn(),a===void 0?a=t.length-s:a>t.length-s&&jn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return kh.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof kh?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=kh.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return Math.sign(t.length-s.length)}static compareSegments(t,s){const a=kh.isNumericId(t),l=kh.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?kh.extractNumericId(t).compare(kh.extractNumericId(s)):t<s?-1:t>s?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return cg.fromString(t.substring(4,t.length-2))}}class Pi extends kh{construct(t,s,a){return new Pi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new Gt(gt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Pi(s)}static emptyPath(){return new Pi([])}}const SFe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ea extends kh{construct(t,s,a){return new ea(t,s,a)}static isValidIdentifier(t){return SFe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ea.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===aX}static keyField(){return new ea([aX])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new Gt(gt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let p=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new Gt(gt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Gt(gt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(p=!p,l++):E!=="."||p?(a+=E,l++):(d(),l++)}if(d(),p)throw new Gt(gt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ea(s)}static emptyPath(){return new ea([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(t){this.path=t}static fromPath(t){return new En(Pi.fromString(t))}static fromName(t){return new En(Pi.fromString(t).popFirst(5))}static empty(){return new En(Pi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Pi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Pi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new En(new Pi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR=-1;function TFe(n,t){const s=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=$n.fromTimestamp(a===1e9?new oo(s+1,0):new oo(s,a));return new gg(l,En.empty(),t)}function bFe(n){return new gg(n.readTime,n.key,bR)}class gg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new gg($n.min(),En.empty(),bR)}static max(){return new gg($n.max(),En.empty(),bR)}}function wFe(n,t){let s=n.readTime.compareTo(t.readTime);return s!==0?s:(s=En.comparator(n.documentKey,t.documentKey),s!==0?s:Ir(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class CFe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k0(n){if(n.code!==gt.FAILED_PRECONDITION||n.message!==RFe)throw n;en("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&jn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new bt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof bt?s:bt.resolve(s)}catch(s){return bt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):bt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):bt.reject(s)}static resolve(t){return new bt((s,a)=>{s(t)})}static reject(t){return new bt((s,a)=>{a(t)})}static waitFor(t){return new bt((s,a)=>{let l=0,d=0,p=!1;t.forEach(E=>{++l,E.next(()=>{++d,p&&d===l&&s()},v=>a(v))}),p=!0,d===l&&s()})}static or(t){let s=bt.resolve(!1);for(const a of t)s=s.next(l=>l?bt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new bt((a,l)=>{const d=t.length,p=new Array(d);let E=0;for(let v=0;v<d;v++){const T=v;s(t[T]).next(w=>{p[T]=w,++E,E===d&&a(p)},w=>l(w))}})}static doWhile(t,s){return new bt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function IFe(n){const t=n.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function N0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}LN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ij=-1;function xN(n){return n==null}function Lk(n){return n===0&&1/n==-1/0}function AFe(n){return typeof n=="number"&&Number.isInteger(n)&&!Lk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sre="";function PFe(n){let t="";for(let s=0;s<n.length;s++)t.length>0&&(t=cX(t)),t=OFe(n.get(s),t);return cX(t)}function OFe(n,t){let s=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":s+="";break;case Sre:s+="";break;default:s+=d}}return s}function cX(n){return n+Sre+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lX(n){let t=0;for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t++;return t}function Ig(n,t){for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&t(s,n[s])}function Tre(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(t,s){this.comparator=t,this.root=s||Qo.EMPTY}insert(t,s){return new os(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Qo.BLACK,null,null))}remove(t){return new os(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Qo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new _O(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new _O(this.root,t,this.comparator,!1)}getReverseIterator(){return new _O(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new _O(this.root,t,this.comparator,!0)}}class _O{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Qo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Qo.RED,this.left=l??Qo.EMPTY,this.right=d??Qo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Qo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Qo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Qo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Qo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Qo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw jn();const t=this.left.check();if(t!==this.right.check())throw jn();return t+(this.isRed()?0:1)}}Qo.EMPTY=null,Qo.RED=!0,Qo.BLACK=!1;Qo.EMPTY=new class{constructor(){this.size=0}get key(){throw jn()}get value(){throw jn()}get color(){throw jn()}get left(){throw jn()}get right(){throw jn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Qo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(t){this.comparator=t,this.data=new os(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new uX(this.data.getIterator())}getIteratorFrom(t){return new uX(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof ao)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new ao(this.comparator);return s.data=t,s}}class uX{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(t){this.fields=t,t.sort(ea.comparator)}static empty(){return new Il([])}unionWith(t){let s=new ao(ea.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new Il(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return h0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bre extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new bre("Invalid base64 string: "+d):d}}(t);return new ta(s)}static fromUint8Array(t){const s=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(t);return new ta(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ir(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ta.EMPTY_BYTE_STRING=new ta("");const kFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _g(n){if(ni(!!n),typeof n=="string"){let t=0;const s=kFe.exec(n);if(ni(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ds(n.seconds),nanos:Ds(n.nanos)}}function Ds(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Eg(n){return typeof n=="string"?ta.fromBase64String(n):ta.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wre="server_timestamp",Rre="__type__",Cre="__previous_value__",Ire="__local_write_time__";function MN(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Rre])===null||s===void 0?void 0:s.stringValue)===wre}function UN(n){const t=n.mapValue.fields[Cre];return MN(t)?UN(t):t}function wR(n){const t=_g(n.mapValue.fields[Ire].timestampValue);return new oo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NFe{constructor(t,s,a,l,d,p,E,v,T){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=T}}const xk="(default)";class RR{constructor(t,s){this.projectId=t,this.database=s||xk}static empty(){return new RR("","")}get isDefaultDatabase(){return this.database===xk}isEqual(t){return t instanceof RR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Are="__type__",DFe="__max__",EO={mapValue:{}},Pre="__vector__",Mk="value";function yg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?MN(n)?4:xFe(n)?9007199254740991:LFe(n)?10:11:jn()}function tf(n,t){if(n===t)return!0;const s=yg(n);if(s!==yg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return wR(n).isEqual(wR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=_g(l.timestampValue),E=_g(d.timestampValue);return p.seconds===E.seconds&&p.nanos===E.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return Eg(l.bytesValue).isEqual(Eg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return Ds(l.geoPointValue.latitude)===Ds(d.geoPointValue.latitude)&&Ds(l.geoPointValue.longitude)===Ds(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ds(l.integerValue)===Ds(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=Ds(l.doubleValue),E=Ds(d.doubleValue);return p===E?Lk(p)===Lk(E):isNaN(p)&&isNaN(E)}return!1}(n,t);case 9:return h0(n.arrayValue.values||[],t.arrayValue.values||[],tf);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},E=d.mapValue.fields||{};if(lX(p)!==lX(E))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(E[v]===void 0||!tf(p[v],E[v])))return!1;return!0}(n,t);default:return jn()}}function CR(n,t){return(n.values||[]).find(s=>tf(s,t))!==void 0}function f0(n,t){if(n===t)return 0;const s=yg(n),a=yg(t);if(s!==a)return Ir(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return Ir(n.booleanValue,t.booleanValue);case 2:return function(d,p){const E=Ds(d.integerValue||d.doubleValue),v=Ds(p.integerValue||p.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(n,t);case 3:return dX(n.timestampValue,t.timestampValue);case 4:return dX(wR(n),wR(t));case 5:return Ir(n.stringValue,t.stringValue);case 6:return function(d,p){const E=Eg(d),v=Eg(p);return E.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,p){const E=d.split("/"),v=p.split("/");for(let T=0;T<E.length&&T<v.length;T++){const w=Ir(E[T],v[T]);if(w!==0)return w}return Ir(E.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,p){const E=Ir(Ds(d.latitude),Ds(p.latitude));return E!==0?E:Ir(Ds(d.longitude),Ds(p.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return hX(n.arrayValue,t.arrayValue);case 10:return function(d,p){var E,v,T,w;const A=d.fields||{},N=p.fields||{},F=(E=A[Mk])===null||E===void 0?void 0:E.arrayValue,j=(v=N[Mk])===null||v===void 0?void 0:v.arrayValue,B=Ir(((T=F==null?void 0:F.values)===null||T===void 0?void 0:T.length)||0,((w=j==null?void 0:j.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:hX(F,j)}(n.mapValue,t.mapValue);case 11:return function(d,p){if(d===EO.mapValue&&p===EO.mapValue)return 0;if(d===EO.mapValue)return 1;if(p===EO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),T=p.fields||{},w=Object.keys(T);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=Ir(v[A],w[A]);if(N!==0)return N;const F=f0(E[v[A]],T[w[A]]);if(F!==0)return F}return Ir(v.length,w.length)}(n.mapValue,t.mapValue);default:throw jn()}}function dX(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return Ir(n,t);const s=_g(n),a=_g(t),l=Ir(s.seconds,a.seconds);return l!==0?l:Ir(s.nanos,a.nanos)}function hX(n,t){const s=n.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=f0(s[l],a[l]);if(d)return d}return Ir(s.length,a.length)}function p0(n){return mV(n)}function mV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(s){const a=_g(s);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(s){return Eg(s).toBase64()}(n.bytesValue):"referenceValue"in n?function(s){return En.fromName(s).toString()}(n.referenceValue):"geoPointValue"in n?function(s){return`geo(${s.latitude},${s.longitude})`}(n.geoPointValue):"arrayValue"in n?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=mV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const p of a)d?d=!1:l+=",",l+=`${p}:${mV(s.fields[p])}`;return l+"}"}(n.mapValue):jn()}function ek(n){switch(yg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=UN(n);return t?16+ek(t):16;case 5:return 2*n.stringValue.length;case 6:return Eg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+ek(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Ig(a.fields,(d,p)=>{l+=d.length+ek(p)}),l}(n.mapValue);default:throw jn()}}function Uk(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function gV(n){return!!n&&"integerValue"in n}function Aj(n){return!!n&&"arrayValue"in n}function fX(n){return!!n&&"nullValue"in n}function pX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function tk(n){return!!n&&"mapValue"in n}function LFe(n){var t,s;return((s=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[Are])===null||s===void 0?void 0:s.stringValue)===Pre}function Yw(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Ig(n.mapValue.fields,(s,a)=>t.mapValue.fields[s]=Yw(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(n.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Yw(n.arrayValue.values[s]);return t}return Object.assign({},n)}function xFe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===DFe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(t){this.value=t}static empty(){return new Kc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!tk(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=Yw(s)}setAll(t){let s=ea.emptyPath(),a={},l=[];t.forEach((p,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}p?a[E.lastSegment()]=Yw(p):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());tk(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return tf(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];tk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Ig(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Kc(Yw(this.value))}}function Ore(n){const t=[];return Ig(n.fields,(s,a)=>{const l=new ea([s]);if(tk(a)){const d=Ore(a.mapValue).fields;if(d.length===0)t.push(l);else for(const p of d)t.push(l.child(p))}else t.push(l)}),new Il(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(t,s,a,l,d,p,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=p,this.documentState=E}static newInvalidDocument(t){return new ka(t,0,$n.min(),$n.min(),$n.min(),Kc.empty(),0)}static newFoundDocument(t,s,a,l){return new ka(t,1,s,$n.min(),a,l,0)}static newNoDocument(t,s){return new ka(t,2,s,$n.min(),$n.min(),Kc.empty(),0)}static newUnknownDocument(t,s){return new ka(t,3,s,$n.min(),$n.min(),Kc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual($n.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Kc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Kc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$n.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ka&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ka(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(t,s){this.position=t,this.inclusive=s}}function mX(n,t,s){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],p=n.position[l];if(d.field.isKeyField()?a=En.comparator(En.fromName(p.referenceValue),s.key):a=f0(p,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function gX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let s=0;s<n.position.length;s++)if(!tf(n.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(t,s="asc"){this.field=t,this.dir=s}}function MFe(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kre{}class $s extends kre{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new VFe(t,s,a):s==="array-contains"?new BFe(t,a):s==="in"?new WFe(t,a):s==="not-in"?new zFe(t,a):s==="array-contains-any"?new GFe(t,a):new $s(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new FFe(t,a):new jFe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(f0(s,this.value)):s!==null&&yg(this.value)===yg(s)&&this.matchesComparison(f0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return jn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pd extends kre{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Pd(t,s)}matches(t){return Nre(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Nre(n){return n.op==="and"}function Dre(n){return UFe(n)&&Nre(n)}function UFe(n){for(const t of n.filters)if(t instanceof Pd)return!1;return!0}function _V(n){if(n instanceof $s)return n.field.canonicalString()+n.op.toString()+p0(n.value);if(Dre(n))return n.filters.map(t=>_V(t)).join(",");{const t=n.filters.map(s=>_V(s)).join(",");return`${n.op}(${t})`}}function Lre(n,t){return n instanceof $s?function(a,l){return l instanceof $s&&a.op===l.op&&a.field.isEqual(l.field)&&tf(a.value,l.value)}(n,t):n instanceof Pd?function(a,l){return l instanceof Pd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,p,E)=>d&&Lre(p,l.filters[E]),!0):!1}(n,t):void jn()}function xre(n){return n instanceof $s?function(s){return`${s.field.canonicalString()} ${s.op} ${p0(s.value)}`}(n):n instanceof Pd?function(s){return s.op.toString()+" {"+s.getFilters().map(xre).join(" ,")+"}"}(n):"Filter"}class VFe extends $s{constructor(t,s,a){super(t,s,a),this.key=En.fromName(a.referenceValue)}matches(t){const s=En.comparator(t.key,this.key);return this.matchesComparison(s)}}class FFe extends $s{constructor(t,s){super(t,"in",s),this.keys=Mre("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class jFe extends $s{constructor(t,s){super(t,"not-in",s),this.keys=Mre("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function Mre(n,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>En.fromName(a.referenceValue))}class BFe extends $s{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return Aj(s)&&CR(s.arrayValue,this.value)}}class WFe extends $s{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&CR(this.value.arrayValue,s)}}class zFe extends $s{constructor(t,s){super(t,"not-in",s)}matches(t){if(CR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!CR(this.value.arrayValue,s)}}class GFe extends $s{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!Aj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>CR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HFe{constructor(t,s=null,a=[],l=[],d=null,p=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=p,this.endAt=E,this.le=null}}function _X(n,t=null,s=[],a=[],l=null,d=null,p=null){return new HFe(n,t,s,a,l,d,p)}function Pj(n){const t=Xn(n);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>_V(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),xN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>p0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>p0(a)).join(",")),t.le=s}return t.le}function Oj(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!MFe(n.orderBy[s],t.orderBy[s]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(!Lre(n.filters[s],t.filters[s]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!gX(n.startAt,t.startAt)&&gX(n.endAt,t.endAt)}function EV(n){return En.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(t,s=null,a=[],l=[],d=null,p="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=p,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function $Fe(n,t,s,a,l,d,p,E){return new VE(n,t,s,a,l,d,p,E)}function VN(n){return new VE(n)}function EX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kj(n){return n.collectionGroup!==null}function $S(n){const t=Xn(n);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(p){let E=new ao(ea.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(T=>{T.isInequality()&&(E=E.add(T.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new IR(d,a))}),s.has(ea.keyField().canonicalString())||t.he.push(new IR(ea.keyField(),a))}return t.he}function Xh(n){const t=Xn(n);return t.Pe||(t.Pe=KFe(t,$S(n))),t.Pe}function KFe(n,t){if(n.limitType==="F")return _X(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new IR(l.field,d)});const s=n.endAt?new m0(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new m0(n.startAt.position,n.startAt.inclusive):null;return _X(n.path,n.collectionGroup,t,n.filters,n.limit,s,a)}}function yV(n,t){const s=n.filters.concat([t]);return new VE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),s,n.limit,n.limitType,n.startAt,n.endAt)}function vV(n,t,s){return new VE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,s,n.startAt,n.endAt)}function FN(n,t){return Oj(Xh(n),Xh(t))&&n.limitType===t.limitType}function Ure(n){return`${Pj(Xh(n))}|lt:${n.limitType}`}function mS(n){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>xre(l)).join(", ")}]`),xN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>p0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>p0(l)).join(",")),`Target(${a})`}(Xh(n))}; limitType=${n.limitType})`}function jN(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):En.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of $S(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(p,E,v){const T=mX(p,E,v);return p.inclusive?T<=0:T<0}(a.startAt,$S(a),l)||a.endAt&&!function(p,E,v){const T=mX(p,E,v);return p.inclusive?T>=0:T>0}(a.endAt,$S(a),l))}(n,t)}function qFe(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Vre(n){return(t,s)=>{let a=!1;for(const l of $S(n)){const d=YFe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function YFe(n,t,s){const a=n.field.isKeyField()?En.comparator(t.key,s.key):function(d,p,E){const v=p.data.field(d),T=E.data.field(d);return v!==null&&T!==null?f0(v,T):jn()}(n.field,t,s);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return jn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Ig(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return Tre(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XFe=new os(En.comparator);function Op(){return XFe}const Fre=new os(En.comparator);function Nw(...n){let t=Fre;for(const s of n)t=t.insert(s.key,s);return t}function jre(n){let t=Fre;return n.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function lE(){return Xw()}function Bre(){return Xw()}function Xw(){return new FE(n=>n.toString(),(n,t)=>n.isEqual(t))}const JFe=new os(En.comparator),QFe=new ao(En.comparator);function Sr(...n){let t=QFe;for(const s of n)t=t.add(s);return t}const ZFe=new ao(Ir);function eje(){return ZFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nj(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lk(t)?"-0":t}}function Wre(n){return{integerValue:""+n}}function tje(n,t){return AFe(t)?Wre(t):Nj(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BN{constructor(){this._=void 0}}function nje(n,t,s){return n instanceof Vk?function(l,d){const p={fields:{[Rre]:{stringValue:wre},[Ire]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&MN(d)&&(d=UN(d)),d&&(p.fields[Cre]=d),{mapValue:p}}(s,t):n instanceof AR?Gre(n,t):n instanceof PR?Hre(n,t):function(l,d){const p=zre(l,d),E=yX(p)+yX(l.Ie);return gV(p)&&gV(l.Ie)?Wre(E):Nj(l.serializer,E)}(n,t)}function rje(n,t,s){return n instanceof AR?Gre(n,t):n instanceof PR?Hre(n,t):s}function zre(n,t){return n instanceof Fk?function(a){return gV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Vk extends BN{}class AR extends BN{constructor(t){super(),this.elements=t}}function Gre(n,t){const s=$re(t);for(const a of n.elements)s.some(l=>tf(l,a))||s.push(a);return{arrayValue:{values:s}}}class PR extends BN{constructor(t){super(),this.elements=t}}function Hre(n,t){let s=$re(t);for(const a of n.elements)s=s.filter(l=>!tf(l,a));return{arrayValue:{values:s}}}class Fk extends BN{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function yX(n){return Ds(n.integerValue||n.doubleValue)}function $re(n){return Aj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function ije(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof AR&&l instanceof AR||a instanceof PR&&l instanceof PR?h0(a.elements,l.elements,tf):a instanceof Fk&&l instanceof Fk?tf(a.Ie,l.Ie):a instanceof Vk&&l instanceof Vk}(n.transform,t.transform)}class sje{constructor(t,s){this.version=t,this.transformResults=s}}class Jh{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Jh}static exists(t){return new Jh(void 0,t)}static updateTime(t){return new Jh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function nk(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class WN{}function Kre(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Yre(n.key,Jh.none()):new rC(n.key,n.data,Jh.none());{const s=n.data,a=Kc.empty();let l=new ao(ea.comparator);for(let d of t.fields)if(!l.has(d)){let p=s.field(d);p===null&&d.length>1&&(d=d.popLast(),p=s.field(d)),p===null?a.delete(d):a.set(d,p),l=l.add(d)}return new Ag(n.key,a,new Il(l.toArray()),Jh.none())}}function oje(n,t,s){n instanceof rC?function(l,d,p){const E=l.value.clone(),v=SX(l.fieldTransforms,d,p.transformResults);E.setAll(v),d.convertToFoundDocument(p.version,E).setHasCommittedMutations()}(n,t,s):n instanceof Ag?function(l,d,p){if(!nk(l.precondition,d))return void d.convertToUnknownDocument(p.version);const E=SX(l.fieldTransforms,d,p.transformResults),v=d.data;v.setAll(qre(l)),v.setAll(E),d.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,t,s):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,t,s)}function Jw(n,t,s,a){return n instanceof rC?function(d,p,E,v){if(!nk(d.precondition,p))return E;const T=d.value.clone(),w=TX(d.fieldTransforms,v,p);return T.setAll(w),p.convertToFoundDocument(p.version,T).setHasLocalMutations(),null}(n,t,s,a):n instanceof Ag?function(d,p,E,v){if(!nk(d.precondition,p))return E;const T=TX(d.fieldTransforms,v,p),w=p.data;return w.setAll(qre(d)),w.setAll(T),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,t,s,a):function(d,p,E){return nk(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):E}(n,t,s)}function aje(n,t){let s=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=zre(a.transform,l||null);d!=null&&(s===null&&(s=Kc.empty()),s.set(a.field,d))}return s||null}function vX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&h0(a,l,(d,p)=>ije(d,p))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class rC extends WN{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Ag extends WN{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function qre(n){const t=new Map;return n.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=n.data.field(s);t.set(s,a)}}),t}function SX(n,t,s){const a=new Map;ni(n.length===s.length);for(let l=0;l<s.length;l++){const d=n[l],p=d.transform,E=t.data.field(d.field);a.set(d.field,rje(p,E,s[l]))}return a}function TX(n,t,s){const a=new Map;for(const l of n){const d=l.transform,p=s.data.field(l.field);a.set(l.field,nje(d,p,t))}return a}class Yre extends WN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class cje extends WN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lje{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&oje(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=Jw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=Jw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=Bre();return this.mutations.forEach(l=>{const d=t.get(l.key),p=d.overlayedDocument;let E=this.applyToLocalView(p,d.mutatedFields);E=s.has(l.key)?null:E;const v=Kre(p,E);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument($n.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Sr())}isEqual(t){return this.batchId===t.batchId&&h0(this.mutations,t.mutations,(s,a)=>vX(s,a))&&h0(this.baseMutations,t.baseMutations,(s,a)=>vX(s,a))}}class Dj{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ni(t.mutations.length===a.length);let l=function(){return JFe}();const d=t.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,a[p].version);return new Dj(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dje{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ws,Or;function hje(n){switch(n){case gt.OK:return jn();case gt.CANCELLED:case gt.UNKNOWN:case gt.DEADLINE_EXCEEDED:case gt.RESOURCE_EXHAUSTED:case gt.INTERNAL:case gt.UNAVAILABLE:case gt.UNAUTHENTICATED:return!1;case gt.INVALID_ARGUMENT:case gt.NOT_FOUND:case gt.ALREADY_EXISTS:case gt.PERMISSION_DENIED:case gt.FAILED_PRECONDITION:case gt.ABORTED:case gt.OUT_OF_RANGE:case gt.UNIMPLEMENTED:case gt.DATA_LOSS:return!0;default:return jn()}}function Xre(n){if(n===void 0)return Pp("GRPC error has no .code"),gt.UNKNOWN;switch(n){case Ws.OK:return gt.OK;case Ws.CANCELLED:return gt.CANCELLED;case Ws.UNKNOWN:return gt.UNKNOWN;case Ws.DEADLINE_EXCEEDED:return gt.DEADLINE_EXCEEDED;case Ws.RESOURCE_EXHAUSTED:return gt.RESOURCE_EXHAUSTED;case Ws.INTERNAL:return gt.INTERNAL;case Ws.UNAVAILABLE:return gt.UNAVAILABLE;case Ws.UNAUTHENTICATED:return gt.UNAUTHENTICATED;case Ws.INVALID_ARGUMENT:return gt.INVALID_ARGUMENT;case Ws.NOT_FOUND:return gt.NOT_FOUND;case Ws.ALREADY_EXISTS:return gt.ALREADY_EXISTS;case Ws.PERMISSION_DENIED:return gt.PERMISSION_DENIED;case Ws.FAILED_PRECONDITION:return gt.FAILED_PRECONDITION;case Ws.ABORTED:return gt.ABORTED;case Ws.OUT_OF_RANGE:return gt.OUT_OF_RANGE;case Ws.UNIMPLEMENTED:return gt.UNIMPLEMENTED;case Ws.DATA_LOSS:return gt.DATA_LOSS;default:return jn()}}(Or=Ws||(Ws={}))[Or.OK=0]="OK",Or[Or.CANCELLED=1]="CANCELLED",Or[Or.UNKNOWN=2]="UNKNOWN",Or[Or.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Or[Or.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Or[Or.NOT_FOUND=5]="NOT_FOUND",Or[Or.ALREADY_EXISTS=6]="ALREADY_EXISTS",Or[Or.PERMISSION_DENIED=7]="PERMISSION_DENIED",Or[Or.UNAUTHENTICATED=16]="UNAUTHENTICATED",Or[Or.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Or[Or.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Or[Or.ABORTED=10]="ABORTED",Or[Or.OUT_OF_RANGE=11]="OUT_OF_RANGE",Or[Or.UNIMPLEMENTED=12]="UNIMPLEMENTED",Or[Or.INTERNAL=13]="INTERNAL",Or[Or.UNAVAILABLE=14]="UNAVAILABLE",Or[Or.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fje(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pje=new cg([4294967295,4294967295],0);function bX(n){const t=fje().encode(n),s=new fre;return s.update(t),new Uint8Array(s.digest())}function wX(n){const t=new DataView(n.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new cg([s,a],0),new cg([l,d],0)]}class Lj{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new Dw(`Invalid padding: ${s}`);if(a<0)throw new Dw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Dw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new Dw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=cg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(cg.fromNumber(a)));return l.compare(pje)===1&&(l=new cg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=bX(t),[a,l]=wX(s);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);if(!this.Re(p))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),p=new Lj(d,l,s);return a.forEach(E=>p.insert(E)),p}insert(t){if(this.Ee===0)return;const s=bX(t),[a,l]=wX(s);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);this.Ve(p)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class Dw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,iC.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new zN($n.min(),l,new os(Ir),Op(),Sr())}}class iC{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new iC(a,s,Sr(),Sr(),Sr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class Jre{constructor(t,s){this.targetId=t,this.ge=s}}class Qre{constructor(t,s,a=ta.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class RX{constructor(){this.pe=0,this.ye=CX(),this.we=ta.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=Sr(),s=Sr(),a=Sr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:jn()}}),new iC(this.we,this.be,t,s,a)}Me(){this.Se=!1,this.ye=CX()}xe(t,s){this.Se=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ni(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class mje{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Op(),this.$e=yO(),this.Ke=yO(),this.Ue=new os(Ir)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:jn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(EV(d))if(a===0){const p=new En(d.path);this.ze(s,p,ka.newNoDocument(p,$n.min()))}else ni(a===1);else{const p=this.et(s);if(p!==a){const E=this.tt(t),v=E?this.nt(E,t,p):1;if(v!==0){this.Ye(s);const T=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,T)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let p,E;try{p=Eg(a).toUint8Array()}catch(v){if(v instanceof bre)return d0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new Lj(p,l,d)}catch(v){return d0(v instanceof Dw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const p=this.ke.it(),E=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,p)=>{const E=this.Xe(p);if(E){if(d.current&&EV(E.target)){const v=new En(E.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,ka.newNoDocument(v,t))}d.ve&&(s.set(p,d.Fe()),d.Me())}});let a=Sr();this.Ke.forEach((d,p)=>{let E=!0;p.forEachWhile(v=>{const T=this.Xe(v);return!T||T.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(t));const l=new zN(t,s,this.Ue,this.Qe,a);return this.Qe=Op(),this.$e=yO(),this.Ke=yO(),this.Ue=new os(Ir),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ke=this.Ke.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ke=this.Ke.insert(s,this.ct(s).delete(t)),this.Ke=this.Ke.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new RX,this.qe.set(t,s)),s}ct(t){let s=this.Ke.get(t);return s||(s=new ao(Ir),this.Ke=this.Ke.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new ao(Ir),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||en("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new RX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function yO(){return new os(En.comparator)}function CX(){return new os(En.comparator)}const gje={asc:"ASCENDING",desc:"DESCENDING"},_je={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Eje={and:"AND",or:"OR"};class yje{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function SV(n,t){return n.useProto3Json||xN(t)?t:{value:t}}function jk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Zre(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function vje(n,t){return jk(n,t.toTimestamp())}function Qh(n){return ni(!!n),$n.fromTimestamp(function(s){const a=_g(s);return new oo(a.seconds,a.nanos)}(n))}function xj(n,t){return TV(n,t).canonicalString()}function TV(n,t){const s=function(l){return new Pi(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?s:s.child(t)}function eie(n){const t=Pi.fromString(n);return ni(sie(t)),t}function bV(n,t){return xj(n.databaseId,t.path)}function H2(n,t){const s=eie(t);if(s.get(1)!==n.databaseId.projectId)throw new Gt(gt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+n.databaseId.projectId);if(s.get(3)!==n.databaseId.database)throw new Gt(gt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+n.databaseId.database);return new En(nie(s))}function tie(n,t){return xj(n.databaseId,t)}function Sje(n){const t=eie(n);return t.length===4?Pi.emptyPath():nie(t)}function wV(n){return new Pi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function nie(n){return ni(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function IX(n,t,s){return{name:bV(n,t),fields:s.value.mapValue.fields}}function Tje(n,t){let s;if("targetChange"in t){t.targetChange;const a=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:jn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(T,w){return T.useProto3Json?(ni(w===void 0||typeof w=="string"),ta.fromBase64String(w||"")):(ni(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ta.fromUint8Array(w||new Uint8Array))}(n,t.targetChange.resumeToken),p=t.targetChange.cause,E=p&&function(T){const w=T.code===void 0?gt.UNKNOWN:Xre(T.code);return new Gt(w,T.message||"")}(p);s=new Qre(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=H2(n,a.document.name),d=Qh(a.document.updateTime),p=a.document.createTime?Qh(a.document.createTime):$n.min(),E=new Kc({mapValue:{fields:a.document.fields}}),v=ka.newFoundDocument(l,d,p,E),T=a.targetIds||[],w=a.removedTargetIds||[];s=new rk(T,w,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=H2(n,a.document),d=a.readTime?Qh(a.readTime):$n.min(),p=ka.newNoDocument(l,d),E=a.removedTargetIds||[];s=new rk([],E,p.key,p)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=H2(n,a.document),d=a.removedTargetIds||[];s=new rk([],d,l,null)}else{if(!("filter"in t))return jn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,p=new dje(l,d),E=a.targetId;s=new Jre(E,p)}}return s}function bje(n,t){let s;if(t instanceof rC)s={update:IX(n,t.key,t.value)};else if(t instanceof Yre)s={delete:bV(n,t.key)};else if(t instanceof Ag)s={update:IX(n,t.key,t.data),updateMask:Nje(t.fieldMask)};else{if(!(t instanceof cje))return jn();s={verify:bV(n,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,p){const E=p.transform;if(E instanceof Vk)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof AR)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof PR)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof Fk)return{fieldPath:p.field.canonicalString(),increment:E.Ie};throw jn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:vje(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:jn()}(n,t.precondition)),s}function wje(n,t){return n&&n.length>0?(ni(t!==void 0),n.map(s=>function(l,d){let p=l.updateTime?Qh(l.updateTime):Qh(d);return p.isEqual($n.min())&&(p=Qh(d)),new sje(p,l.transformResults||[])}(s,t))):[]}function Rje(n,t){return{documents:[tie(n,t.path)]}}function Cje(n,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=tie(n,l);const d=function(T){if(T.length!==0)return iie(Pd.create(T,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const p=function(T){if(T.length!==0)return T.map(w=>function(N){return{field:gS(N.field),direction:Pje(N.dir)}}(w))}(t.orderBy);p&&(s.structuredQuery.orderBy=p);const E=SV(n,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(T){return{before:T.inclusive,values:T.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(T){return{before:!T.inclusive,values:T.position}}(t.endAt)),{ht:s,parent:l}}function Ije(n){let t=Sje(n.parent);const s=n.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ni(a===1);const w=s.from[0];w.allDescendants?l=w.collectionId:t=t.child(w.collectionId)}let d=[];s.where&&(d=function(A){const N=rie(A);return N instanceof Pd&&Dre(N)?N.getFilters():[N]}(s.where));let p=[];s.orderBy&&(p=function(A){return A.map(N=>function(j){return new IR(_S(j.field),function(G){switch(G){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(A){let N;return N=typeof A=="object"?A.value:A,xN(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(A){const N=!!A.before,F=A.values||[];return new m0(F,N)}(s.startAt));let T=null;return s.endAt&&(T=function(A){const N=!A.before,F=A.values||[];return new m0(F,N)}(s.endAt)),$Fe(t,l,p,d,E,"F",v,T)}function Aje(n,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return jn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function rie(n){return n.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=_S(s.unaryFilter.field);return $s.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=_S(s.unaryFilter.field);return $s.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=_S(s.unaryFilter.field);return $s.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=_S(s.unaryFilter.field);return $s.create(p,"!=",{nullValue:"NULL_VALUE"});default:return jn()}}(n):n.fieldFilter!==void 0?function(s){return $s.create(_S(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jn()}}(s.fieldFilter.op),s.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(s){return Pd.create(s.compositeFilter.filters.map(a=>rie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return jn()}}(s.compositeFilter.op))}(n):jn()}function Pje(n){return gje[n]}function Oje(n){return _je[n]}function kje(n){return Eje[n]}function gS(n){return{fieldPath:n.canonicalString()}}function _S(n){return ea.fromServerFormat(n.fieldPath)}function iie(n){return n instanceof $s?function(s){if(s.op==="=="){if(pX(s.value))return{unaryFilter:{field:gS(s.field),op:"IS_NAN"}};if(fX(s.value))return{unaryFilter:{field:gS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(pX(s.value))return{unaryFilter:{field:gS(s.field),op:"IS_NOT_NAN"}};if(fX(s.value))return{unaryFilter:{field:gS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:gS(s.field),op:Oje(s.op),value:s.value}}}(n):n instanceof Pd?function(s){const a=s.getFilters().map(l=>iie(l));return a.length===1?a[0]:{compositeFilter:{op:kje(s.op),filters:a}}}(n):jn()}function Nje(n){const t=[];return n.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function sie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ng{constructor(t,s,a,l,d=$n.min(),p=$n.min(),E=ta.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new ng(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new ng(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ng(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ng(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dje{constructor(t){this.Tt=t}}function Lje(n){const t=Ije({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vV(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xje{constructor(){this.Tn=new Mje}addToCollectionParentIndex(t,s){return this.Tn.add(s),bt.resolve()}getCollectionParents(t,s){return bt.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return bt.resolve()}deleteFieldIndex(t,s){return bt.resolve()}deleteAllFieldIndexes(t){return bt.resolve()}createTargetIndexes(t,s){return bt.resolve()}getDocumentsMatchingTarget(t,s){return bt.resolve(null)}getIndexType(t,s){return bt.resolve(0)}getFieldIndexes(t,s){return bt.resolve([])}getNextCollectionGroupToUpdate(t){return bt.resolve(null)}getMinOffset(t,s){return bt.resolve(gg.min())}getMinOffsetFromCollectionGroup(t,s){return bt.resolve(gg.min())}updateCollectionGroup(t,s,a){return bt.resolve()}updateIndexEntries(t,s){return bt.resolve()}}class Mje{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new ao(Pi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new ao(Pi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oie=41943040;class Hc{static withCacheSize(t){return new Hc(t,Hc.DEFAULT_COLLECTION_PERCENTILE,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Hc.DEFAULT_COLLECTION_PERCENTILE=10,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hc.DEFAULT=new Hc(oie,Hc.DEFAULT_COLLECTION_PERCENTILE,Hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hc.DISABLED=new Hc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new g0(0)}static Un(){return new g0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PX="LruGarbageCollector",Uje=1048576;function OX([n,t],[s,a]){const l=Ir(n,s);return l===0?Ir(t,a):l}class Vje{constructor(t){this.Hn=t,this.buffer=new ao(OX),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();OX(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class Fje{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){en(PX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){N0(s)?en(PX,"Ignoring IndexedDB error during garbage collection: ",s):await k0(s)}await this.er(3e5)})}}class jje{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return bt.resolve(LN.ae);const a=new Vje(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(en("LruGarbageCollector","Garbage collection skipped; disabled"),bt.resolve(AX)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(en("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),AX):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,p,E,v,T;const w=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(en("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,p=Date.now(),this.nthSequenceNumber(t,l))).next(A=>(a=A,E=Date.now(),this.removeTargets(t,a,s))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(A=>(T=Date.now(),pS()<=yr.DEBUG&&en("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-w}ms
	Determined least recently used ${l} in `+(E-p)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${A} documents in `+(T-v)+`ms
Total Duration: ${T-w}ms`),bt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function Bje(n,t){return new jje(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wje{constructor(){this.changes=new FE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,ka.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?bt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zje{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gje{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&Jw(a.mutation,l,Il.empty(),oo.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Sr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Sr()){const l=lE();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let p=Nw();return d.forEach((E,v)=>{p=p.insert(E,v.overlayedDocument)}),p}))}getOverlayedDocuments(t,s){const a=lE();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Sr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((p,E)=>{s.set(p,E)})})}computeViews(t,s,a,l){let d=Op();const p=Xw(),E=function(){return Xw()}();return s.forEach((v,T)=>{const w=a.get(T.key);l.has(T.key)&&(w===void 0||w.mutation instanceof Ag)?d=d.insert(T.key,T):w!==void 0?(p.set(T.key,w.mutation.getFieldMask()),Jw(w.mutation,T,w.mutation.getFieldMask(),oo.now())):p.set(T.key,Il.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((T,w)=>p.set(T,w)),s.forEach((T,w)=>{var A;return E.set(T,new zje(w,(A=p.get(T))!==null&&A!==void 0?A:null))}),E))}recalculateAndSaveOverlays(t,s){const a=Xw();let l=new os((p,E)=>p-E),d=Sr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(p=>{for(const E of p)E.keys().forEach(v=>{const T=s.get(v);if(T===null)return;let w=a.get(v)||Il.empty();w=E.applyToLocalView(T,w),a.set(v,w);const A=(l.get(E.batchId)||Sr()).add(v);l=l.insert(E.batchId,A)})}).next(()=>{const p=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),T=v.key,w=v.value,A=Bre();w.forEach(N=>{if(!d.has(N)){const F=Kre(s.get(N),a.get(N));F!==null&&A.set(N,F),d=d.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(t,T,A))}return bt.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(p){return En.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):kj(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):bt.resolve(lE());let E=bR,v=d;return p.next(T=>bt.forEach(T,(w,A)=>(E<A.largestBatchId&&(E=A.largestBatchId),d.get(w)?bt.resolve():this.remoteDocumentCache.getEntry(t,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(t,T,d)).next(()=>this.computeViews(t,v,T,Sr())).next(w=>({batchId:E,changes:jre(w)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new En(s)).next(a=>{let l=Nw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let p=Nw();return this.indexManager.getCollectionParents(t,d).next(E=>bt.forEach(E,v=>{const T=function(A,N){return new VE(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,T,a,l).next(w=>{w.forEach((A,N)=>{p=p.insert(A,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(p=>{d.forEach((v,T)=>{const w=T.getKey();p.get(w)===null&&(p=p.insert(w,ka.newInvalidDocument(w)))});let E=Nw();return p.forEach((v,T)=>{const w=d.get(v);w!==void 0&&Jw(w.mutation,T,Il.empty(),oo.now()),jN(s,T)&&(E=E.insert(v,T))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hje{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return bt.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:Qh(l.createTime)}}(s)),bt.resolve()}getNamedQuery(t,s){return bt.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:Lje(l.bundledQuery),readTime:Qh(l.readTime)}}(s)),bt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $je{constructor(){this.overlays=new os(En.comparator),this.Rr=new Map}getOverlay(t,s){return bt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=lE();return bt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),bt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),bt.resolve()}getOverlaysForCollection(t,s,a){const l=lE(),d=s.length+1,p=new En(s.child("")),E=this.overlays.getIteratorFrom(p);for(;E.hasNext();){const v=E.getNext().value,T=v.getKey();if(!s.isPrefixOf(T.path))break;T.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return bt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new os((T,w)=>T-w);const p=this.overlays.getIterator();for(;p.hasNext();){const T=p.getNext().value;if(T.getKey().getCollectionGroup()===s&&T.largestBatchId>a){let w=d.get(T.largestBatchId);w===null&&(w=lE(),d=d.insert(T.largestBatchId,w)),w.set(T.getKey(),T)}}const E=lE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((T,w)=>E.set(T,w)),!(E.size()>=l)););return bt.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new uje(s,a));let d=this.Rr.get(s);d===void 0&&(d=Sr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kje{constructor(){this.sessionToken=ta.EMPTY_BYTE_STRING}getSessionToken(t){return bt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,bt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj{constructor(){this.Vr=new ao(Ro.mr),this.gr=new ao(Ro.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new Ro(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new Ro(t,s))}br(t,s){t.forEach(a=>this.removeReference(a,s))}Sr(t){const s=new En(new Pi([])),a=new Ro(s,t),l=new Ro(s,t+1),d=[];return this.gr.forEachInRange([a,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new En(new Pi([])),a=new Ro(s,t),l=new Ro(s,t+1);let d=Sr();return this.gr.forEachInRange([a,l],p=>{d=d.add(p.key)}),d}containsKey(t){const s=new Ro(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class Ro{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return En.comparator(t.key,s.key)||Ir(t.Cr,s.Cr)}static pr(t,s){return Ir(t.Cr,s.Cr)||En.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qje{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new ao(Ro.mr)}checkEmpty(t){return bt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new lje(d,s,a,l);this.mutationQueue.push(p);for(const E of l)this.Mr=this.Mr.add(new Ro(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return bt.resolve(p)}lookupMutationBatch(t,s){return bt.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return bt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return bt.resolve(this.mutationQueue.length===0?Ij:this.Fr-1)}getAllMutationBatches(t){return bt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new Ro(s,0),l=new Ro(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],p=>{const E=this.Or(p.Cr);d.push(E)}),bt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new ao(Ir);return s.forEach(l=>{const d=new Ro(l,0),p=new Ro(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],E=>{a=a.add(E.Cr)})}),bt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;En.isDocumentKey(d)||(d=d.child(""));const p=new Ro(new En(d),0);let E=new ao(Ir);return this.Mr.forEachWhile(v=>{const T=v.key.path;return!!a.isPrefixOf(T)&&(T.length===l&&(E=E.add(v.Cr)),!0)},p),bt.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ni(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return bt.forEach(s.mutations,l=>{const d=new Ro(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new Ro(s,0),l=this.Mr.firstAfterOrEqual(a);return bt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,bt.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(t){this.kr=t,this.docs=function(){return new os(En.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,p=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return bt.resolve(a?a.document.mutableCopy():ka.newInvalidDocument(s))}getEntries(t,s){let a=Op();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():ka.newInvalidDocument(l))}),bt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Op();const p=s.path,E=new En(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:T,value:{document:w}}=v.getNext();if(!p.isPrefixOf(T.path))break;T.path.length>p.length+1||wFe(bFe(w),a)<=0||(l.has(w.key)||jN(s,w))&&(d=d.insert(w.key,w.mutableCopy()))}return bt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){jn()}qr(t,s){return bt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new Xje(this)}getSize(t){return bt.resolve(this.size)}}class Xje extends Wje{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),bt.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jje{constructor(t){this.persistence=t,this.Qr=new FE(s=>Pj(s),Oj),this.lastRemoteSnapshotVersion=$n.min(),this.highestTargetId=0,this.$r=0,this.Kr=new Mj,this.targetCount=0,this.Ur=g0.Kn()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),bt.resolve()}getLastRemoteSnapshotVersion(t){return bt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return bt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),bt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),bt.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Ur=new g0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,bt.resolve()}updateTargetData(t,s){return this.zn(s),bt.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Kr.Sr(s.targetId),this.targetCount-=1,bt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((p,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),bt.waitFor(d).next(()=>l)}getTargetCount(t){return bt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return bt.resolve(a)}addMatchingKeys(t,s,a){return this.Kr.yr(s,a),bt.resolve()}removeMatchingKeys(t,s,a){this.Kr.br(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(p=>{d.push(l.markPotentiallyOrphaned(t,p))}),bt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Kr.Sr(s),bt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Kr.vr(s);return bt.resolve(a)}containsKey(t,s){return bt.resolve(this.Kr.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aie{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new LN(0),this.zr=!1,this.zr=!0,this.jr=new Kje,this.referenceDelegate=t(this),this.Hr=new Jje(this),this.indexManager=new xje,this.remoteDocumentCache=function(l){return new Yje(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new Dje(s),this.Yr=new Hje(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new $je,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new qje(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){en("MemoryPersistence","Starting transaction:",t);const l=new Qje(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return bt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class Qje extends CFe{constructor(t){super(),this.currentSequenceNumber=t}}class Uj{constructor(t){this.persistence=t,this.ti=new Mj,this.ni=null}static ri(t){return new Uj(t)}get ii(){if(this.ni)return this.ni;throw jn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),bt.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),bt.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),bt.resolve()}removeTarget(t,s){this.ti.Sr(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return bt.forEach(this.ii,a=>{const l=En.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,$n.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return bt.or([()=>bt.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class Bk{constructor(t,s){this.persistence=t,this.oi=new FE(a=>PFe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=Bje(this,s)}static ri(t,s){return new Bk(t,s)}Zr(){}Xr(t){return bt.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return bt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?bt.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,p=>this.ar(t,p,s).next(E=>{E||(a++,d.removeEntry(p,$n.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),bt.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),bt.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),bt.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),bt.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=ek(t.data.value)),s}ar(t,s,a){return bt.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return bt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Sr(),l=Sr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new Vj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zje{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return UMe()?8:IFe(La())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new Zje;return this._s(t,s,p).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,p,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(pS()<=yr.DEBUG&&en("QueryEngine","SDK will not create cache indexes for query:",mS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),bt.resolve()):(pS()<=yr.DEBUG&&en("QueryEngine","Query:",mS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(pS()<=yr.DEBUG&&en("QueryEngine","The SDK decides to create cache indexes for query:",mS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xh(s))):bt.resolve())}rs(t,s){if(EX(s))return bt.resolve(null);let a=Xh(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=vV(s,null,"F"),a=Xh(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const p=Sr(...d);return this.ns.getDocuments(t,p).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const T=this.cs(s,E);return this.ls(s,T,p,v.readTime)?this.rs(t,vV(s,null,"F")):this.hs(t,T,s,v)}))})))}ss(t,s,a,l){return EX(s)||l.isEqual($n.min())?bt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const p=this.cs(s,d);return this.ls(s,p,a,l)?bt.resolve(null):(pS()<=yr.DEBUG&&en("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),mS(s)),this.hs(t,p,s,TFe(l,bR)).next(E=>E))})}cs(t,s){let a=new ao(Vre(t));return s.forEach((l,d)=>{jN(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return pS()<=yr.DEBUG&&en("QueryEngine","Using full collection scan to execute query:",mS(s)),this.ns.getDocumentsMatchingQuery(t,s,gg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fj="LocalStore",t4e=3e8;class n4e{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new os(Ir),this.Is=new FE(d=>Pj(d),Oj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Gje(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function r4e(n,t,s,a){return new n4e(n,t,s,a)}async function cie(n,t){const s=Xn(n);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const p=[],E=[];let v=Sr();for(const T of l){p.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}for(const T of d){E.push(T.batchId);for(const w of T.mutations)v=v.add(w.key)}return s.localDocuments.getDocuments(a,v).next(T=>({Rs:T,removedBatchIds:p,addedBatchIds:E}))})})}function i4e(n,t){const s=Xn(n);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,T,w){const A=T.batch,N=A.keys();let F=bt.resolve();return N.forEach(j=>{F=F.next(()=>w.getEntry(v,j)).next(B=>{const G=T.docVersions.get(j);ni(G!==null),B.version.compareTo(G)<0&&(A.applyToRemoteDocument(B,T),B.isValidDocument()&&(B.setReadTime(T.commitVersion),w.addEntry(B)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,A))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=Sr();for(let T=0;T<E.mutationResults.length;++T)E.mutationResults[T].transformResults.length>0&&(v=v.add(E.batch.mutations[T].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function lie(n){const t=Xn(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function s4e(n,t){const s=Xn(n),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>s.Hr.addMatchingKeys(d,w.addedDocuments,A)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(A)!==null?F=F.withResumeToken(ta.EMPTY_BYTE_STRING,$n.min()).withLastLimboFreeSnapshotVersion($n.min()):w.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(w.resumeToken,a)),l=l.insert(A,F),function(B,G,J){return B.resumeToken.approximateByteSize()===0||G.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=t4e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(N,F,w)&&E.push(s.Hr.updateTargetData(d,F))});let v=Op(),T=Sr();if(t.documentUpdates.forEach(w=>{t.resolvedLimboDocuments.has(w)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,w))}),E.push(o4e(d,p,t.documentUpdates).next(w=>{v=w.Vs,T=w.fs})),!a.isEqual($n.min())){const w=s.Hr.getLastRemoteSnapshotVersion(d).next(A=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(w)}return bt.waitFor(E).next(()=>p.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,T)).next(()=>v)}).then(d=>(s.Ts=l,d))}function o4e(n,t,s){let a=Sr(),l=Sr();return s.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let p=Op();return s.forEach((E,v)=>{const T=d.get(E);v.isFoundDocument()!==T.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual($n.min())?(t.removeEntry(E,v.readTime),p=p.insert(E,v)):!T.isValidDocument()||v.version.compareTo(T.version)>0||v.version.compareTo(T.version)===0&&T.hasPendingWrites?(t.addEntry(v),p=p.insert(E,v)):en(Fj,"Ignoring outdated watch update for ",E,". Current version:",T.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function a4e(n,t){const s=Xn(n);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=Ij),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function c4e(n,t){const s=Xn(n);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,bt.resolve(l)):s.Hr.allocateTargetId(a).next(p=>(l=new ng(t,p,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function RV(n,t,s){const a=Xn(n),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!N0(p))throw p;en(Fj,`Failed to update sequence numbers for target ${t}: ${p}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function kX(n,t,s){const a=Xn(n);let l=$n.min(),d=Sr();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,T,w){const A=Xn(v),N=A.Is.get(w);return N!==void 0?bt.resolve(A.Ts.get(N)):A.Hr.getTargetData(T,w)}(a,p,Xh(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(p,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(p,t,s?l:$n.min(),s?d:Sr())).next(E=>(l4e(a,qFe(t),E),{documents:E,gs:d})))}function l4e(n,t,s){let a=n.Es.get(t)||$n.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class NX{constructor(){this.activeTargetIds=eje()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class u4e{constructor(){this.ho=new NX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new NX,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DX="ConnectivityMonitor";class LX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){en(DX,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){en(DX,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vO=null;function CV(){return vO===null?vO=function(){return 268435456+Math.round(2147483648*Math.random())}():vO++,"0x"+vO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2="RestConnection",h4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class f4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===xk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,s,a,l,d){const p=CV(),E=this.So(t,s.toUriEncodedString());en($2,`Sending RPC '${t}' ${p}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(T=>(en($2,`Received RPC '${t}' ${p}: `,T),T),T=>{throw d0($2,`RPC '${t}' ${p} failed with error: `,T,"url: ",E,"request:",a),T})}Co(t,s,a,l,d,p){return this.bo(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+O0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,s){const a=h4e[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra="WebChannelConnection";class m4e extends f4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=CV();return new Promise((p,E)=>{const v=new pre;v.setWithCredentials(!0),v.listenOnce(mre.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case ZO.NO_ERROR:const w=v.getResponseJson();en(Ra,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(w)),p(w);break;case ZO.TIMEOUT:en(Ra,`RPC '${t}' ${d} timed out`),E(new Gt(gt.DEADLINE_EXCEEDED,"Request time out"));break;case ZO.HTTP_ERROR:const A=v.getStatus();if(en(Ra,`RPC '${t}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const j=function(G){const J=G.toLowerCase().replace(/_/g,"-");return Object.values(gt).indexOf(J)>=0?J:gt.UNKNOWN}(F.status);E(new Gt(j,F.message))}else E(new Gt(gt.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new Gt(gt.UNAVAILABLE,"Connection failed."));break;default:jn()}}finally{en(Ra,`RPC '${t}' ${d} completed.`)}});const T=JSON.stringify(l);en(Ra,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",T,a,15)})}Wo(t,s,a){const l=CV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],p=Ere(),E=_re(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(v.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const w=d.join("");en(Ra,`Creating RPC '${t}' stream ${l}: ${w}`,v);const A=p.createWebChannel(w,v);let N=!1,F=!1;const j=new p4e({Fo:G=>{F?en(Ra,`Not sending because RPC '${t}' stream ${l} is closed:`,G):(N||(en(Ra,`Opening RPC '${t}' stream ${l} transport.`),A.open(),N=!0),en(Ra,`RPC '${t}' stream ${l} sending:`,G),A.send(G))},Mo:()=>A.close()}),B=(G,J,K)=>{G.listen(J,ne=>{try{K(ne)}catch(de){setTimeout(()=>{throw de},0)}})};return B(A,kw.EventType.OPEN,()=>{F||(en(Ra,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),B(A,kw.EventType.CLOSE,()=>{F||(F=!0,en(Ra,`RPC '${t}' stream ${l} transport closed`),j.Ko())}),B(A,kw.EventType.ERROR,G=>{F||(F=!0,d0(Ra,`RPC '${t}' stream ${l} transport errored:`,G),j.Ko(new Gt(gt.UNAVAILABLE,"The operation could not be completed")))}),B(A,kw.EventType.MESSAGE,G=>{var J;if(!F){const K=G.data[0];ni(!!K);const ne=K,de=(ne==null?void 0:ne.error)||((J=ne[0])===null||J===void 0?void 0:J.error);if(de){en(Ra,`RPC '${t}' stream ${l} received error:`,de);const oe=de.status;let _e=function(te){const ce=Ws[te];if(ce!==void 0)return Xre(ce)}(oe),Z=de.message;_e===void 0&&(_e=gt.INTERNAL,Z="Unknown error status: "+oe+" with message "+de.message),F=!0,j.Ko(new Gt(_e,Z)),A.close()}else en(Ra,`RPC '${t}' stream ${l} received:`,K),j.Uo(K)}}),B(E,gre.STAT_EVENT,G=>{G.stat===pV.PROXY?en(Ra,`RPC '${t}' stream ${l} detected buffering proxy`):G.stat===pV.NOPROXY&&en(Ra,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function K2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN(n){return new yje(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uie{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&en("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xX="PersistentStream";class die{constructor(t,s,a,l,d,p,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new uie(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===gt.RESOURCE_EXHAUSTED?(Pp(s.toString()),Pp("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===gt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new Gt(gt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return en(xX,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(en(xX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class g4e extends die{constructor(t,s,a,l,d,p){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,p),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=Tje(this.serializer,t),a=function(d){if(!("targetChange"in d))return $n.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?$n.min():p.readTime?Qh(p.readTime):$n.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=wV(this.serializer),s.addTarget=function(d,p){let E;const v=p.target;if(E=EV(v)?{documents:Rje(d,v)}:{query:Cje(d,v).ht},E.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){E.resumeToken=Zre(d,p.resumeToken);const T=SV(d,p.expectedCount);T!==null&&(E.expectedCount=T)}else if(p.snapshotVersion.compareTo($n.min())>0){E.readTime=jk(d,p.snapshotVersion.toTimestamp());const T=SV(d,p.expectedCount);T!==null&&(E.expectedCount=T)}return E}(this.serializer,t);const a=Aje(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=wV(this.serializer),s.removeTarget=t,this.I_(s)}}class _4e extends die{constructor(t,s,a,l,d,p){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,p),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return ni(!!t.streamToken),this.lastStreamToken=t.streamToken,ni(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ni(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=wje(t.writeResults,t.commitTime),a=Qh(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=wV(this.serializer),this.I_(t)}S_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>bje(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4e{}class y4e extends E4e{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Gt(gt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.bo(t,TV(s,a),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===gt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Gt(gt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,E])=>this.connection.Co(t,TV(s,a),l,p,E,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===gt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Gt(gt.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class v4e{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Pp(s),this.N_=!1):en("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE="RemoteStore";class S4e{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{a.enqueueAndForget(async()=>{jE(this)&&(en(kE,"Restarting streams for network reachability change."),await async function(v){const T=Xn(v);T.W_.add(4),await sC(T),T.j_.set("Unknown"),T.W_.delete(4),await HN(T)}(this))})}),this.j_=new v4e(a,l)}}async function HN(n){if(jE(n))for(const t of n.G_)await t(!0)}async function sC(n){for(const t of n.G_)await t(!1)}function hie(n,t){const s=Xn(n);s.U_.has(t.targetId)||(s.U_.set(t.targetId,t),zj(s)?Wj(s):D0(s).c_()&&Bj(s,t))}function jj(n,t){const s=Xn(n),a=D0(s);s.U_.delete(t),a.c_()&&fie(s,t),s.U_.size===0&&(a.c_()?a.P_():jE(s)&&s.j_.set("Unknown"))}function Bj(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo($n.min())>0){const s=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}D0(n).y_(t)}function fie(n,t){n.H_.Ne(t),D0(n).w_(t)}function Wj(n){n.H_=new mje({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.U_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),D0(n).start(),n.j_.B_()}function zj(n){return jE(n)&&!D0(n).u_()&&n.U_.size>0}function jE(n){return Xn(n).W_.size===0}function pie(n){n.H_=void 0}async function T4e(n){n.j_.set("Online")}async function b4e(n){n.U_.forEach((t,s)=>{Bj(n,t)})}async function w4e(n,t){pie(n),zj(n)?(n.j_.q_(t),Wj(n)):n.j_.set("Unknown")}async function R4e(n,t,s){if(n.j_.set("Online"),t instanceof Qre&&t.state===2&&t.cause)try{await async function(l,d){const p=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,p),l.U_.delete(E),l.H_.removeTarget(E))}(n,t)}catch(a){en(kE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Wk(n,a)}else if(t instanceof rk?n.H_.We(t):t instanceof Jre?n.H_.Ze(t):n.H_.je(t),!s.isEqual($n.min()))try{const a=await lie(n.localStore);s.compareTo(a)>=0&&await function(d,p){const E=d.H_.ot(p);return E.targetChanges.forEach((v,T)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.U_.get(T);w&&d.U_.set(T,w.withResumeToken(v.resumeToken,p))}}),E.targetMismatches.forEach((v,T)=>{const w=d.U_.get(v);if(!w)return;d.U_.set(v,w.withResumeToken(ta.EMPTY_BYTE_STRING,w.snapshotVersion)),fie(d,v);const A=new ng(w.target,v,T,w.sequenceNumber);Bj(d,A)}),d.remoteSyncer.applyRemoteEvent(E)}(n,s)}catch(a){en(kE,"Failed to raise snapshot:",a),await Wk(n,a)}}async function Wk(n,t,s){if(!N0(t))throw t;n.W_.add(1),await sC(n),n.j_.set("Offline"),s||(s=()=>lie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{en(kE,"Retrying IndexedDB access"),await s(),n.W_.delete(1),await HN(n)})}function mie(n,t){return t().catch(s=>Wk(n,s,t))}async function $N(n){const t=Xn(n),s=vg(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:Ij;for(;C4e(t);)try{const l=await a4e(t.localStore,a);if(l===null){t.K_.length===0&&s.P_();break}a=l.batchId,I4e(t,l)}catch(l){await Wk(t,l)}gie(t)&&_ie(t)}function C4e(n){return jE(n)&&n.K_.length<10}function I4e(n,t){n.K_.push(t);const s=vg(n);s.c_()&&s.b_&&s.S_(t.mutations)}function gie(n){return jE(n)&&!vg(n).u_()&&n.K_.length>0}function _ie(n){vg(n).start()}async function A4e(n){vg(n).C_()}async function P4e(n){const t=vg(n);for(const s of n.K_)t.S_(s.mutations)}async function O4e(n,t,s){const a=n.K_.shift(),l=Dj.from(a,t,s);await mie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await $N(n)}async function k4e(n,t){t&&vg(n).b_&&await async function(a,l){if(function(p){return hje(p)&&p!==gt.ABORTED}(l.code)){const d=a.K_.shift();vg(a).h_(),await mie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await $N(a)}}(n,t),gie(n)&&_ie(n)}async function MX(n,t){const s=Xn(n);s.asyncQueue.verifyOperationInProgress(),en(kE,"RemoteStore received new credentials");const a=jE(s);s.W_.add(3),await sC(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await HN(s)}async function N4e(n,t){const s=Xn(n);t?(s.W_.delete(2),await HN(s)):t||(s.W_.add(2),await sC(s),s.j_.set("Unknown"))}function D0(n){return n.J_||(n.J_=function(s,a,l){const d=Xn(s);return d.M_(),new g4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:T4e.bind(null,n),No:b4e.bind(null,n),Lo:w4e.bind(null,n),p_:R4e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),zj(n)?Wj(n):n.j_.set("Unknown")):(await n.J_.stop(),pie(n))})),n.J_}function vg(n){return n.Y_||(n.Y_=function(s,a,l){const d=Xn(s);return d.M_(),new _4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:A4e.bind(null,n),Lo:k4e.bind(null,n),D_:P4e.bind(null,n),v_:O4e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await $N(n)):(await n.Y_.stop(),n.K_.length>0&&(en(kE,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Tp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const p=Date.now()+a,E=new Gj(t,s,p,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Gt(gt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hj(n,t){if(Pp("AsyncQueue",`${t}: ${n}`),N0(n))return new Gt(gt.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{static emptySet(t){return new KS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||En.comparator(s.key,a.key):(s,a)=>En.comparator(s.key,a.key),this.keyedMap=Nw(),this.sortedSet=new os(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof KS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new KS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UX{constructor(){this.Z_=new os(En.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):jn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class _0{constructor(t,s,a,l,d,p,E,v,T){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=T}static fromInitialDocuments(t,s,a,l,d){const p=[];return s.forEach(E=>{p.push({type:0,doc:E})}),new _0(t,s,KS.emptySet(s),p,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&FN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class L4e{constructor(){this.queries=VX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=Xn(s),d=l.queries;l.queries=VX(),d.forEach((p,E)=>{for(const v of E.ta)v.onError(a)})})(this,new Gt(gt.ABORTED,"Firestore shutting down"))}}function VX(){return new FE(n=>Ure(n),FN)}async function $j(n,t){const s=Xn(n);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new D4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(p){const E=Hj(p,`Initialization of query '${mS(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&qj(s)}async function Kj(n,t){const s=Xn(n),a=t.query;let l=3;const d=s.queries.get(a);if(d){const p=d.ta.indexOf(t);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function x4e(n,t){const s=Xn(n);let a=!1;for(const l of t){const d=l.query,p=s.queries.get(d);if(p){for(const E of p.ta)E.oa(l)&&(a=!0);p.ea=l}}a&&qj(s)}function M4e(n,t,s){const a=Xn(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function qj(n){n.ia.forEach(t=>{t.next()})}var IV,FX;(FX=IV||(IV={}))._a="default",FX.Cache="cache";class Yj{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new _0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=_0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==IV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eie{constructor(t){this.key=t}}class yie{constructor(t){this.key=t}}class U4e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Sr(),this.mutatedKeys=Sr(),this.ya=Vre(t),this.wa=new KS(this.ya)}get ba(){return this.fa}Sa(t,s){const a=s?s.Da:new UX,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,p=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,T=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((w,A)=>{const N=l.get(w),F=jN(this.query,A)?A:null,j=!!N&&this.mutatedKeys.has(N.key),B=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let G=!1;N&&F?N.data.isEqual(F.data)?j!==B&&(a.track({type:3,doc:F}),G=!0):this.va(N,F)||(a.track({type:2,doc:F}),G=!0,(v&&this.ya(F,v)>0||T&&this.ya(F,T)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),G=!0):N&&!F&&(a.track({type:1,doc:N}),G=!0,(v||T)&&(E=!0)),G&&(F?(p=p.add(F),d=B?d.add(w):d.delete(w)):(p=p.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const w=this.query.limitType==="F"?p.last():p.first();p=p.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:p,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const p=t.Da.X_();p.sort((w,A)=>function(F,j){const B=G=>{switch(G){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jn()}};return B(F)-B(j)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,T=v!==this.ga;return this.ga=v,p.length!==0||T?{snapshot:new _0(this.query,t.wa,d,p,t.mutatedKeys,v===0,T,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new UX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Sr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new yie(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new Eie(a))}),s}Oa(t){this.fa=t.gs,this.pa=Sr();const s=this.Sa(t.documents);return this.applyChanges(s,!0)}Na(){return _0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Xj="SyncEngine";class V4e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class F4e{constructor(t){this.key=t,this.Ba=!1}}class j4e{constructor(t,s,a,l,d,p){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new FE(E=>Ure(E),FN),this.qa=new Map,this.Qa=new Set,this.$a=new os(En.comparator),this.Ka=new Map,this.Ua=new Mj,this.Wa={},this.Ga=new Map,this.za=g0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function B4e(n,t,s=!0){const a=Rie(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await vie(a,t,s,!0),l}async function W4e(n,t){const s=Rie(n);await vie(s,t,!0,!1)}async function vie(n,t,s,a){const l=await c4e(n.localStore,Xh(t)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await z4e(n,t,d,p==="current",l.resumeToken)),n.isPrimaryClient&&s&&hie(n.remoteStore,l),E}async function z4e(n,t,s,a,l){n.Ha=(A,N,F)=>async function(B,G,J,K){let ne=G.view.Sa(J);ne.ls&&(ne=await kX(B.localStore,G.query,!1).then(({documents:Z})=>G.view.Sa(Z,ne)));const de=K&&K.targetChanges.get(G.targetId),oe=K&&K.targetMismatches.get(G.targetId)!=null,_e=G.view.applyChanges(ne,B.isPrimaryClient,de,oe);return BX(B,G.targetId,_e.Ma),_e.snapshot}(n,A,N,F);const d=await kX(n.localStore,t,!0),p=new U4e(t,d.gs),E=p.Sa(d.documents),v=iC.createSynthesizedTargetChangeForCurrentChange(s,a&&n.onlineState!=="Offline",l),T=p.applyChanges(E,n.isPrimaryClient,v);BX(n,s,T.Ma);const w=new V4e(t,s,p);return n.ka.set(t,w),n.qa.has(s)?n.qa.get(s).push(t):n.qa.set(s,[t]),T.snapshot}async function G4e(n,t,s){const a=Xn(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(p=>!FN(p,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await RV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&jj(a.remoteStore,l.targetId),AV(a,l.targetId)}).catch(k0)):(AV(a,l.targetId),await RV(a.localStore,l.targetId,!0))}async function H4e(n,t){const s=Xn(n),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),jj(s.remoteStore,a.targetId))}async function $4e(n,t,s){const a=Z4e(n);try{const l=await function(p,E){const v=Xn(p),T=oo.now(),w=E.reduce((F,j)=>F.add(j.key),Sr());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=Op(),B=Sr();return v.ds.getEntries(F,w).next(G=>{j=G,j.forEach((J,K)=>{K.isValidDocument()||(B=B.add(J))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,j)).next(G=>{A=G;const J=[];for(const K of E){const ne=aje(K,A.get(K.key).overlayedDocument);ne!=null&&J.push(new Ag(K.key,ne,Ore(ne.value.mapValue),Jh.exists(!0)))}return v.mutationQueue.addMutationBatch(F,T,J,E)}).next(G=>{N=G;const J=G.applyToLocalDocumentSet(A,B);return v.documentOverlayCache.saveOverlays(F,G.batchId,J)})}).then(()=>({batchId:N.batchId,changes:jre(A)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(p,E,v){let T=p.Wa[p.currentUser.toKey()];T||(T=new os(Ir)),T=T.insert(E,v),p.Wa[p.currentUser.toKey()]=T}(a,l.batchId,s),await oC(a,l.changes),await $N(a.remoteStore)}catch(l){const d=Hj(l,"Failed to persist write");s.reject(d)}}async function Sie(n,t){const s=Xn(n);try{const a=await s4e(s.localStore,t);t.targetChanges.forEach((l,d)=>{const p=s.Ka.get(d);p&&(ni(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?ni(p.Ba):l.removedDocuments.size>0&&(ni(p.Ba),p.Ba=!1))}),await oC(s,a,t)}catch(a){await k0(a)}}function jX(n,t,s){const a=Xn(n);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,p)=>{const E=p.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(p,E){const v=Xn(p);v.onlineState=E;let T=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(E)&&(T=!0)}),T&&qj(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function K4e(n,t,s){const a=Xn(n);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ka.get(t),d=l&&l.key;if(d){let p=new os(En.comparator);p=p.insert(d,ka.newNoDocument(d,$n.min()));const E=Sr().add(d),v=new zN($n.min(),new Map,new os(Ir),p,E);await Sie(a,v),a.$a=a.$a.remove(d),a.Ka.delete(t),Jj(a)}else await RV(a.localStore,t,!1).then(()=>AV(a,t,s)).catch(k0)}async function q4e(n,t){const s=Xn(n),a=t.batch.batchId;try{const l=await i4e(s.localStore,t);bie(s,a,null),Tie(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await oC(s,l)}catch(l){await k0(l)}}async function Y4e(n,t,s){const a=Xn(n);try{const l=await function(p,E){const v=Xn(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let w;return v.mutationQueue.lookupMutationBatch(T,E).next(A=>(ni(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(T,A))).next(()=>v.mutationQueue.performConsistencyCheck(T)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(T,w,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,w)).next(()=>v.localDocuments.getDocuments(T,w))})}(a.localStore,t);bie(a,t,s),Tie(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await oC(a,l)}catch(l){await k0(l)}}function Tie(n,t){(n.Ga.get(t)||[]).forEach(s=>{s.resolve()}),n.Ga.delete(t)}function bie(n,t,s){const a=Xn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function AV(n,t,s=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),s&&n.La.Ja(a,s);n.qa.delete(t),n.isPrimaryClient&&n.Ua.Sr(t).forEach(a=>{n.Ua.containsKey(a)||wie(n,a)})}function wie(n,t){n.Qa.delete(t.path.canonicalString());const s=n.$a.get(t);s!==null&&(jj(n.remoteStore,s),n.$a=n.$a.remove(t),n.Ka.delete(s),Jj(n))}function BX(n,t,s){for(const a of s)a instanceof Eie?(n.Ua.addReference(a.key,t),X4e(n,a)):a instanceof yie?(en(Xj,"Document no longer in limbo: "+a.key),n.Ua.removeReference(a.key,t),n.Ua.containsKey(a.key)||wie(n,a.key)):jn()}function X4e(n,t){const s=t.key,a=s.path.canonicalString();n.$a.get(s)||n.Qa.has(a)||(en(Xj,"New document in limbo: "+s),n.Qa.add(a),Jj(n))}function Jj(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const s=new En(Pi.fromString(t)),a=n.za.next();n.Ka.set(a,new F4e(s)),n.$a=n.$a.insert(s,a),hie(n.remoteStore,new ng(Xh(VN(s.path)),a,"TargetPurposeLimboResolution",LN.ae))}}async function oC(n,t,s){const a=Xn(n),l=[],d=[],p=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{p.push(a.Ha(v,t,s).then(T=>{var w;if((T||s)&&a.isPrimaryClient){const A=T?!T.fromCache:(w=s==null?void 0:s.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(T){l.push(T);const A=Vj.Yi(v.targetId,T);d.push(A)}}))}),await Promise.all(p),a.La.p_(l),await async function(v,T){const w=Xn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>bt.forEach(T,N=>bt.forEach(N.Hi,F=>w.persistence.referenceDelegate.addReference(A,N.targetId,F)).next(()=>bt.forEach(N.Ji,F=>w.persistence.referenceDelegate.removeReference(A,N.targetId,F)))))}catch(A){if(!N0(A))throw A;en(Fj,"Failed to update sequence numbers: "+A)}for(const A of T){const N=A.targetId;if(!A.fromCache){const F=w.Ts.get(N),j=F.snapshotVersion,B=F.withLastLimboFreeSnapshotVersion(j);w.Ts=w.Ts.insert(N,B)}}}(a.localStore,d))}async function J4e(n,t){const s=Xn(n);if(!s.currentUser.isEqual(t)){en(Xj,"User change. New user:",t.toKey());const a=await cie(s.localStore,t);s.currentUser=t,function(d,p){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new Gt(gt.CANCELLED,p))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await oC(s,a.Rs)}}function Q4e(n,t){const s=Xn(n),a=s.Ka.get(t);if(a&&a.Ba)return Sr().add(a.key);{let l=Sr();const d=s.qa.get(t);if(!d)return l;for(const p of d){const E=s.ka.get(p);l=l.unionWith(E.view.ba)}return l}}function Rie(n){const t=Xn(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Sie.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Q4e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=K4e.bind(null,t),t.La.p_=x4e.bind(null,t.eventManager),t.La.Ja=M4e.bind(null,t.eventManager),t}function Z4e(n){const t=Xn(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=q4e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Y4e.bind(null,t),t}class zk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=GN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return r4e(this.persistence,new e4e,t.initialUser,this.serializer)}Xa(t){return new aie(Uj.ri,this.serializer)}Za(t){return new u4e}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zk.provider={build:()=>new zk};class e3e extends zk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){ni(this.persistence.referenceDelegate instanceof Bk);const a=this.persistence.referenceDelegate.garbageCollector;return new Fje(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Hc.withCacheSize(this.cacheSizeBytes):Hc.DEFAULT;return new aie(a=>Bk.ri(a,s),this.serializer)}}class PV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>jX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=J4e.bind(null,this.syncEngine),await N4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new L4e}()}createDatastore(t){const s=GN(t.databaseInfo.databaseId),a=function(d){return new m4e(d)}(t.databaseInfo);return function(d,p,E,v){return new y4e(d,p,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,p,E){return new S4e(a,l,d,p,E)}(this.localStore,this.datastore,t.asyncQueue,s=>jX(this.syncEngine,s,0),function(){return LX.D()?new LX:new d4e}())}createSyncEngine(t,s){return function(l,d,p,E,v,T,w){const A=new j4e(l,d,p,E,v,T);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=Xn(l);en(kE,"RemoteStore shutting down."),d.W_.add(5),await sC(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}PV.provider={build:()=>new PV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qj{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Pp("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg="FirestoreClient";class t3e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Pa.UNAUTHENTICATED,this.clientId=vre.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async p=>{en(Sg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(en(Sg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Tp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=Hj(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function q2(n,t){n.asyncQueue.verifyOperationInProgress(),en(Sg,"Initializing OfflineComponentProvider");const s=n.configuration;await t.initialize(s);let a=s.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await cie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function WX(n,t){n.asyncQueue.verifyOperationInProgress();const s=await n3e(n);en(Sg,"Initializing OnlineComponentProvider"),await t.initialize(s,n.configuration),n.setCredentialChangeListener(a=>MX(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>MX(t.remoteStore,l)),n._onlineComponents=t}async function n3e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){en(Sg,"Using user provided OfflineComponentProvider");try{await q2(n,n._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===gt.FAILED_PRECONDITION||l.code===gt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;d0("Error using user provided cache. Falling back to memory cache: "+s),await q2(n,new zk)}}else en(Sg,"Using default OfflineComponentProvider"),await q2(n,new e3e(void 0));return n._offlineComponents}async function Cie(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(en(Sg,"Using user provided OnlineComponentProvider"),await WX(n,n._uninitializedComponentsProvider._online)):(en(Sg,"Using default OnlineComponentProvider"),await WX(n,new PV))),n._onlineComponents}function r3e(n){return Cie(n).then(t=>t.syncEngine)}async function Gk(n){const t=await Cie(n),s=t.eventManager;return s.onListen=B4e.bind(null,t.syncEngine),s.onUnlisten=G4e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=W4e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=H4e.bind(null,t.syncEngine),s}function i3e(n,t,s={}){const a=new Tp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,T){const w=new Qj({next:N=>{w.su(),p.enqueueAndForget(()=>Kj(d,A));const F=N.docs.has(E);!F&&N.fromCache?T.reject(new Gt(gt.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?T.reject(new Gt(gt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(N)},error:N=>T.reject(N)}),A=new Yj(VN(E.path),w,{includeMetadataChanges:!0,Ta:!0});return $j(d,A)}(await Gk(n),n.asyncQueue,t,s,a)),a.promise}function s3e(n,t,s={}){const a=new Tp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,E,v,T){const w=new Qj({next:N=>{w.su(),p.enqueueAndForget(()=>Kj(d,A)),N.fromCache&&v.source==="server"?T.reject(new Gt(gt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(N)},error:N=>T.reject(N)}),A=new Yj(E,w,{includeMetadataChanges:!0,Ta:!0});return $j(d,A)}(await Gk(n),n.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iie(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zX=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aie(n,t,s){if(!s)throw new Gt(gt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function o3e(n,t,s,a){if(t===!0&&a===!0)throw new Gt(gt.INVALID_ARGUMENT,`${n} and ${s} cannot be used together.`)}function GX(n){if(!En.isDocumentKey(n))throw new Gt(gt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function HX(n){if(En.isDocumentKey(n))throw new Gt(gt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function KN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":jn()}function Ru(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new Gt(gt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=KN(n);throw new Gt(gt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pie="firestore.googleapis.com",$X=!0;class KX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new Gt(gt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Pie,this.ssl=$X}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:$X;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=oie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Uje)throw new Gt(gt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}o3e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Iie((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Gt(gt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Gt(gt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Gt(gt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class qN{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new KX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Gt(gt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Gt(gt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new KX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new pFe;switch(a.type){case"firstParty":return new EFe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Gt(gt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=zX.get(s);a&&(en("ComponentProvider","Removing Datastore"),zX.delete(s),a.terminate())}(this),Promise.resolve()}}function a3e(n,t,s,a={}){var l;const d=(n=Ru(n,qN))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==Pie&&d.host!==E&&d0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!CE(v,p)&&(n._setSettings(v),a.mockUserToken)){let T,w;if(typeof a.mockUserToken=="string")T=a.mockUserToken,w=Pa.MOCK_USER;else{T=Rne(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new Gt(gt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Pa(A)}n._authCredentials=new mFe(new yre(T,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new Np(this.firestore,t,this._query)}}class Da{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Da(this.firestore,t,this._key)}}class lg extends Np{constructor(t,s,a){super(t,s,VN(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Da(this.firestore,null,new En(t))}withConverter(t){return new lg(this.firestore,t,this._path)}}function OR(n,t,...s){if(n=zi(n),Aie("collection","path",t),n instanceof qN){const a=Pi.fromString(t,...s);return HX(a),new lg(n,null,a)}{if(!(n instanceof Da||n instanceof lg))throw new Gt(gt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Pi.fromString(t,...s));return HX(a),new lg(n.firestore,null,a)}}function na(n,t,...s){if(n=zi(n),arguments.length===1&&(t=vre.newId()),Aie("doc","path",t),n instanceof qN){const a=Pi.fromString(t,...s);return GX(a),new Da(n,null,new En(a))}{if(!(n instanceof Da||n instanceof lg))throw new Gt(gt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Pi.fromString(t,...s));return GX(a),new Da(n.firestore,n instanceof lg?n.converter:null,new En(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qX="AsyncQueue";class YX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new uie(this,"async_queue_retry"),this.bu=()=>{const a=K2();a&&en(qX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const s=K2();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=K2();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new Tp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!N0(t))throw t;en(qX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(p){let E=p.message||"";return p.stack&&(E=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),E}(a);throw Pp("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=Gj.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&jn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}function XX(n){return function(s,a){if(typeof s!="object"||s===null)return!1;const l=s;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class NE extends qN{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new YX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new YX(t),this._firestoreClient=void 0,await t}}}function Oie(n,t){const s=typeof n=="object"?n:_j(),a=typeof n=="string"?n:xk,l=ON(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Tne("firestore");d&&a3e(l,...d)}return l}function YN(n){if(n._terminated)throw new Gt(gt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||c3e(n),n._firestoreClient}function c3e(n){var t,s,a;const l=n._freezeSettings(),d=function(E,v,T,w){return new NFe(E,v,T,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,Iie(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new t3e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new E0(ta.fromBase64String(t))}catch(s){throw new Gt(gt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new E0(ta.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new Gt(gt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ea(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zj{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new Gt(gt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new Gt(gt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ir(this._lat,t._lat)||Ir(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l3e=/^__.*__$/;class u3e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new Ag(t,this.data,this.fieldMask,s,this.fieldTransforms):new rC(t,this.data,s,this.fieldTransforms)}}class kie{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new Ag(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function Nie(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw jn()}}class n4{constructor(t,s,a,l,d,p){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new n4(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return Hk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(Nie(this.Lu)&&l3e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class d3e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||GN(t)}ju(t,s,a,l=!1){return new n4({Lu:t,methodName:s,zu:a,path:ea.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function JN(n){const t=n._freezeSettings(),s=GN(n._databaseId);return new d3e(n._databaseId,!!t.ignoreUndefinedProperties,s)}function h3e(n,t,s,a,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,t,s,l);r4("Data must be an object, but it was:",p,a);const E=Lie(a,p);let v,T;if(d.merge)v=new Il(p.fieldMask),T=p.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=OV(t,A,s);if(!p.contains(N))throw new Gt(gt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Mie(w,N)||w.push(N)}v=new Il(w),T=p.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,T=p.fieldTransforms;return new u3e(new Kc(E),v,T)}class QN extends Zj{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof QN}}function f3e(n,t,s,a){const l=n.ju(1,t,s);r4("Data must be an object, but it was:",l,a);const d=[],p=Kc.empty();Ig(a,(v,T)=>{const w=i4(t,v,s);T=zi(T);const A=l.Ku(w);if(T instanceof QN)d.push(w);else{const N=aC(T,A);N!=null&&(d.push(w),p.set(w,N))}});const E=new Il(d);return new kie(p,E,l.fieldTransforms)}function p3e(n,t,s,a,l,d){const p=n.ju(1,t,s),E=[OV(t,a,s)],v=[l];if(d.length%2!=0)throw new Gt(gt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(OV(t,d[N])),v.push(d[N+1]);const T=[],w=Kc.empty();for(let N=E.length-1;N>=0;--N)if(!Mie(T,E[N])){const F=E[N];let j=v[N];j=zi(j);const B=p.Ku(F);if(j instanceof QN)T.push(F);else{const G=aC(j,B);G!=null&&(T.push(F),w.set(F,G))}}const A=new Il(T);return new kie(w,A,p.fieldTransforms)}function Die(n,t,s,a=!1){return aC(s,n.ju(a?4:3,t))}function aC(n,t){if(xie(n=zi(n)))return r4("Unsupported field value:",t,n),Lie(n,t);if(n instanceof Zj)return function(a,l){if(!Nie(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let p=0;for(const E of a){let v=aC(E,l.Uu(p));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),p++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=zi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return tje(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=oo.fromDate(a);return{timestampValue:jk(l.serializer,d)}}if(a instanceof oo){const d=new oo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:jk(l.serializer,d)}}if(a instanceof e4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof E0)return{bytesValue:Zre(l.serializer,a._byteString)};if(a instanceof Da){const d=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:xj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof t4)return function(p,E){return{mapValue:{fields:{[Are]:{stringValue:Pre},[Mk]:{arrayValue:{values:p.toArray().map(T=>{if(typeof T!="number")throw E.Wu("VectorValues must only contain numeric values.");return Nj(E.serializer,T)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${KN(a)}`)}(n,t)}function Lie(n,t){const s={};return Tre(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ig(n,(a,l)=>{const d=aC(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function xie(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof oo||n instanceof e4||n instanceof E0||n instanceof Da||n instanceof Zj||n instanceof t4)}function r4(n,t,s){if(!xie(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=KN(s);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function OV(n,t,s){if((t=zi(t))instanceof XN)return t._internalPath;if(typeof t=="string")return i4(n,t);throw Hk("Field path arguments must be of type string or ",n,!1,void 0,s)}const m3e=new RegExp("[~\\*/\\[\\]]");function i4(n,t,s){if(t.search(m3e)>=0)throw Hk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,s);try{return new XN(...t.split("."))._internalPath}catch{throw Hk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,s)}}function Hk(n,t,s,a,l){const d=a&&!a.isEmpty(),p=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||p)&&(v+=" (found",d&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new Gt(gt.INVALID_ARGUMENT,E+n+v)}function Mie(n,t){return n.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s4{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Da(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new g3e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(ZN("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class g3e extends s4{data(){return super.data()}}function ZN(n,t){return typeof t=="string"?i4(n,t):t instanceof XN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uie(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Gt(gt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class o4{}class a4 extends o4{}function kV(n,t,...s){let a=[];t instanceof o4&&a.push(t),a=a.concat(s),function(d){const p=d.filter(v=>v instanceof c4).length,E=d.filter(v=>v instanceof e1).length;if(p>1||p>0&&E>0)throw new Gt(gt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class e1 extends a4{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new e1(t,s,a)}_apply(t){const s=this._parse(t);return Vie(t._query,s),new Np(t.firestore,t.converter,yV(t._query,s))}_parse(t){const s=JN(t.firestore);return function(d,p,E,v,T,w,A){let N;if(T.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new Gt(gt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){ZX(A,w);const j=[];for(const B of A)j.push(QX(v,d,B));N={arrayValue:{values:j}}}else N=QX(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||ZX(A,w),N=Die(E,p,A,w==="in"||w==="not-in");return $s.create(T,w,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function JX(n,t,s){const a=t,l=ZN("where",n);return e1._create(l,a,s)}class c4 extends o4{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new c4(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:Pd.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let p=l;const E=d.getFlattenedFilters();for(const v of E)Vie(p,v),p=yV(p,v)}(t._query,s),new Np(t.firestore,t.converter,yV(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class l4 extends a4{constructor(t,s){super(),this._field=t,this._direction=s,this.type="orderBy"}static _create(t,s){return new l4(t,s)}_apply(t){const s=function(l,d,p){if(l.startAt!==null)throw new Gt(gt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Gt(gt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new IR(d,p)}(t._query,this._field,this._direction);return new Np(t.firestore,t.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new VE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t._query,s))}}function _3e(n,t="asc"){const s=t,a=ZN("orderBy",n);return l4._create(a,s)}class u4 extends a4{constructor(t,s,a){super(),this.type=t,this._docOrFields=s,this._inclusive=a}static _create(t,s,a){return new u4(t,s,a)}_apply(t){const s=y3e(t,this.type,this._docOrFields,this._inclusive);return new Np(t.firestore,t.converter,function(l,d){return new VE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(t._query,s))}}function E3e(...n){return u4._create("startAt",n,!0)}function y3e(n,t,s,a){if(s[0]=zi(s[0]),s[0]instanceof s4)return function(d,p,E,v,T){if(!v)throw new Gt(gt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${E}().`);const w=[];for(const A of $S(d))if(A.field.isKeyField())w.push(Uk(p,v.key));else{const N=v.data.field(A.field);if(MN(N))throw new Gt(gt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const F=A.field.canonicalString();throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${F}' (used as the orderBy) does not exist.`)}w.push(N)}return new m0(w,T)}(n._query,n.firestore._databaseId,t,s[0]._document,a);{const l=JN(n.firestore);return function(p,E,v,T,w,A){const N=p.explicitOrderBy;if(w.length>N.length)throw new Gt(gt.INVALID_ARGUMENT,`Too many arguments provided to ${T}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const F=[];for(let j=0;j<w.length;j++){const B=w[j];if(N[j].field.isKeyField()){if(typeof B!="string")throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${T}(), but got a ${typeof B}`);if(!kj(p)&&B.indexOf("/")!==-1)throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${T}() must be a plain document ID, but '${B}' contains a slash.`);const G=p.path.child(Pi.fromString(B));if(!En.isDocumentKey(G))throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${T}() must result in a valid document path, but '${G}' is not because it contains an odd number of segments.`);const J=new En(G);F.push(Uk(E,J))}else{const G=Die(v,T,B);F.push(G)}}return new m0(F,A)}(n._query,n.firestore._databaseId,l,t,s,a)}}function QX(n,t,s){if(typeof(s=zi(s))=="string"){if(s==="")throw new Gt(gt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!kj(t)&&s.indexOf("/")!==-1)throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Pi.fromString(s));if(!En.isDocumentKey(a))throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Uk(n,new En(a))}if(s instanceof Da)return Uk(n,s._key);throw new Gt(gt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${KN(s)}.`)}function ZX(n,t){if(!Array.isArray(n)||n.length===0)throw new Gt(gt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Vie(n,t){const s=function(l,d){for(const p of l)for(const E of p.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new Gt(gt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Gt(gt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class v3e{convertValue(t,s="none"){switch(yg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ds(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(Eg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw jn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Ig(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[Mk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>Ds(p.doubleValue));return new t4(d)}convertGeoPoint(t){return new e4(Ds(t.latitude),Ds(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=UN(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(wR(t));default:return null}}convertTimestamp(t){const s=_g(t);return new oo(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Pi.fromString(t);ni(sie(a));const l=new RR(a.get(1),a.get(3)),d=new En(a.popFirst(5));return l.isEqual(s)||Pp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S3e(n,t,s){let a;return a=n?s&&(s.merge||s.mergeFields)?n.toFirestore(t,s):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lw{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Fie extends s4{constructor(t,s,a,l,d,p){super(t,s,a,l,p),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new ik(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(ZN("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class ik extends Fie{data(t={}){return super.data(t)}}class jie{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new Lw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new ik(this._firestore,this._userDataWriter,a.key,a,new Lw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new Gt(gt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(E=>{const v=new ik(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Lw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new ik(l._firestore,l._userDataWriter,E.doc.key,E.doc,new Lw(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let T=-1,w=-1;return E.type!==0&&(T=p.indexOf(E.doc.key),p=p.delete(E.doc.key)),E.type!==1&&(p=p.add(E.doc),w=p.indexOf(E.doc.key)),{type:T3e(E.type),doc:v,oldIndex:T,newIndex:w}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function T3e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(n){n=Ru(n,Da);const t=Ru(n.firestore,NE);return i3e(YN(t),n._key).then(s=>zie(t,n,s))}class d4 extends v3e{constructor(t){super(),this.firestore=t}convertBytes(t){return new E0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new Da(this.firestore,null,s)}}function $k(n){n=Ru(n,Np);const t=Ru(n.firestore,NE),s=YN(t),a=new d4(t);return Uie(n._query),s3e(s,n._query).then(l=>new jie(t,a,n,l))}function NV(n,t,s){n=Ru(n,Da);const a=Ru(n.firestore,NE),l=S3e(n.converter,t,s);return Wie(a,[h3e(JN(a),"setDoc",n._key,l,n.converter!==null,s).toMutation(n._key,Jh.none())])}function Od(n,t,s,...a){n=Ru(n,Da);const l=Ru(n.firestore,NE),d=JN(l);let p;return p=typeof(t=zi(t))=="string"||t instanceof XN?p3e(d,"updateDoc",n._key,t,s,a):f3e(d,"updateDoc",n._key,t),Wie(l,[p.toMutation(n._key,Jh.exists(!0))])}function Bie(n,...t){var s,a,l;n=zi(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof t[p]!="object"||XX(t[p])||(d=t[p],p++);const E={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(XX(t[p])){const A=t[p];t[p]=(s=A.next)===null||s===void 0?void 0:s.bind(A),t[p+1]=(a=A.error)===null||a===void 0?void 0:a.bind(A),t[p+2]=(l=A.complete)===null||l===void 0?void 0:l.bind(A)}let v,T,w;if(n instanceof Da)T=Ru(n.firestore,NE),w=VN(n._key.path),v={next:A=>{t[p]&&t[p](zie(T,n,A))},error:t[p+1],complete:t[p+2]};else{const A=Ru(n,Np);T=Ru(A.firestore,NE),w=A._query;const N=new d4(T);v={next:F=>{t[p]&&t[p](new jie(T,N,A,F))},error:t[p+1],complete:t[p+2]},Uie(n._query)}return function(N,F,j,B){const G=new Qj(B),J=new Yj(F,G,j);return N.asyncQueue.enqueueAndForget(async()=>$j(await Gk(N),J)),()=>{G.su(),N.asyncQueue.enqueueAndForget(async()=>Kj(await Gk(N),J))}}(YN(T),w,E,v)}function Wie(n,t){return function(a,l){const d=new Tp;return a.asyncQueue.enqueueAndForget(async()=>$4e(await r3e(a),l,d)),d.promise}(YN(n),t)}function zie(n,t,s){const a=s.docs.get(t._key),l=new d4(n);return new Fie(n,l,t._key,a,new Lw(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){O0=l})(ME),IE(new mg("firestore",(a,{instanceIdentifier:l,options:d})=>{const p=a.getProvider("app").getImmediate(),E=new NE(new gFe(a.getProvider("auth-internal")),new yFe(p,a.getProvider("app-check-internal")),function(T,w){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new Gt(gt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new RR(T.options.projectId,w)}(p,l),p);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),Kh(nX,rX,t),Kh(nX,rX,"esm2017")})();var b3e="firebase",w3e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kh(b3e,w3e,"app");const R3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!1);console.log("import.meta.env:",R3e);const $m={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:$m.apiKey?`${$m.apiKey.substring(0,5)}...`:"missing",authDomain:$m.authDomain,projectId:$m.projectId,storageBucket:$m.storageBucket,messagingSenderId:$m.messagingSenderId?"present":"missing",appId:$m.appId?"present":"missing"});const Gie=Ane($m),C3e=hre(Gie),Ks=Oie(Gie),nf=async n=>{try{De.log("userFirestore: Get user Profile data for user ID: "+n);const t=na(Ks,"users",n),s=await Tg(t);return s.exists()?(De.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(De.error("userFirestore: user profile document not found"),null)}catch(t){throw De.error("userFirestore: Error fetching user profile data:",t),t}},I3e=async(n,t,s)=>{try{De.log("userFirestore: Registering new user with email:",n);const l=(await JUe(C3e,n,t)).user,d={email:l.email,createdAt:new Date,groups:["users"],...s};De.log("userFirestore: Creating user document with data:",d);const p=na(Ks,"users",l.uid);return await NV(p,d),De.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw De.error("userFirestore: Error creating user:",a),a}},Hie=async(n,t)=>{try{De.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const s=na(Ks,"users",n);await Od(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),De.log("userFirestore: rpmURL updated successfully.")}catch(s){throw De.error("userFirestore: Error updating rpmURL:",s),s}},A3e=(n,t)=>{if(t==="users")return De.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return De.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${t} - Returning ${a}`),a}return De.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${t} - Returning false`),!1},$ie=async(n,t)=>A3e(n,t),P3e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Cd={sendUserToUnity:"sendUserToUnity"};class O3e{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),De.log(`EventBus: Published event '${t}'`)):De.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Id=new O3e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kie="firebasestorage.googleapis.com",qie="storageBucket",k3e=2*60*1e3,N3e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends of{constructor(t,s,a=0){super(Y2(t),`Firebase Storage: ${s} (${Y2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ws.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Y2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bs||(bs={}));function Y2(n){return"storage/"+n}function h4(){const n="An unknown error occurred, please check the error payload for server response.";return new ws(bs.UNKNOWN,n)}function D3e(n){return new ws(bs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function L3e(n){return new ws(bs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function x3e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ws(bs.UNAUTHENTICATED,n)}function M3e(){return new ws(bs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function U3e(n){return new ws(bs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function V3e(){return new ws(bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function F3e(){return new ws(bs.CANCELED,"User canceled the upload/download.")}function j3e(n){return new ws(bs.INVALID_URL,"Invalid URL '"+n+"'.")}function B3e(n){return new ws(bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function W3e(){return new ws(bs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+qie+"' property when initializing the app?")}function z3e(){return new ws(bs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function G3e(){return new ws(bs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function H3e(n){return new ws(bs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function DV(n){return new ws(bs.INVALID_ARGUMENT,n)}function Yie(){return new ws(bs.APP_DELETED,"The Firebase app was deleted.")}function $3e(n){return new ws(bs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Qw(n,t){return new ws(bs.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function iw(n){throw new ws(bs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Al{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Al.makeFromUrl(t,s)}catch{return new Al(t,"")}if(a.path==="")return a;throw B3e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const p="(/(.*))?$",E=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function T(de){de.path_=decodeURIComponent(de.path)}const w="v[A-Za-z0-9_]+",A=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},B=s===Kie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,G="([^?#]*)",J=new RegExp(`^https?://${B}/${l}/${G}`,"i"),ne=[{regex:E,indices:v,postModify:d},{regex:F,indices:j,postModify:T},{regex:J,indices:{bucket:1,path:2},postModify:T}];for(let de=0;de<ne.length;de++){const oe=ne[de],_e=oe.regex.exec(t);if(_e){const Z=_e[oe.indices.bucket];let ee=_e[oe.indices.path];ee||(ee=""),a=new Al(Z,ee),oe.postModify(a);break}}if(a==null)throw j3e(t);return a}}class K3e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3e(n,t,s){let a=1,l=null,d=null,p=!1,E=0;function v(){return E===2}let T=!1;function w(...G){T||(T=!0,t.apply(null,G))}function A(G){l=setTimeout(()=>{l=null,n(F,v())},G)}function N(){d&&clearTimeout(d)}function F(G,...J){if(T){N();return}if(G){N(),w.call(null,G,...J);return}if(v()||p){N(),w.call(null,G,...J);return}a<64&&(a*=2);let ne;E===1?(E=2,ne=0):ne=(a+Math.random())*1e3,A(ne)}let j=!1;function B(G){j||(j=!0,N(),!T&&(l!==null?(G||(E=2),clearTimeout(l),A(0)):G||(E=1)))}return A(0),d=setTimeout(()=>{p=!0,B(!0)},s),B}function Y3e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X3e(n){return n!==void 0}function J3e(n){return typeof n=="object"&&!Array.isArray(n)}function f4(n){return typeof n=="string"||n instanceof String}function eJ(n){return p4()&&n instanceof Blob}function p4(){return typeof Blob<"u"}function tJ(n,t,s,a){if(a<t)throw DV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>s)throw DV(`Invalid value for '${n}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t1(n,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${n}`}function Xie(n){const t=encodeURIComponent;let s="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var yE;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(yE||(yE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q3e(n,t){const s=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(t,s,a,l,d,p,E,v,T,w,A,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=E,this.errorCallback_=v,this.timeout_=T,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,j)=>{this.resolve_=F,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new SO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=E=>{const v=E.loaded,T=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,T)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const E=d.getErrorCode()===yE.NO_ERROR,v=d.getStatus();if(!E||Q3e(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===yE.ABORT;a(!1,new SO(!1,null,w));return}const T=this.successCodes_.indexOf(v)!==-1;a(!0,new SO(T,d))})},s=(a,l)=>{const d=this.resolve_,p=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());X3e(v)?d(v):d()}catch(v){p(v)}else if(E!==null){const v=h4();v.serverResponse=E.getErrorText(),this.errorCallback_?p(this.errorCallback_(E,v)):p(v)}else if(l.canceled){const v=this.appDelete_?Yie():F3e();p(v)}else{const v=V3e();p(v)}};this.canceled_?s(!1,new SO(!1,null,!0)):this.backoffId_=q3e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&Y3e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class SO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function eBe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function tBe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function nBe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function rBe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function iBe(n,t,s,a,l,d,p=!0){const E=Xie(n.urlParams),v=n.url+E,T=Object.assign({},n.headers);return nBe(T,t),eBe(T,s),tBe(T,d),rBe(T,a),new Z3e(v,n.method,T,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function oBe(...n){const t=sBe();if(t!==void 0){const s=new t;for(let a=0;a<n.length;a++)s.append(n[a]);return s.getBlob()}else{if(p4())return new Blob(n);throw new ws(bs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function aBe(n,t,s){return n.webkitSlice?n.webkitSlice(t,s):n.mozSlice?n.mozSlice(t,s):n.slice?n.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cBe(n){if(typeof atob>"u")throw H3e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class X2{constructor(t,s){this.data=t,this.contentType=s||null}}function lBe(n,t){switch(n){case jh.RAW:return new X2(Jie(t));case jh.BASE64:case jh.BASE64URL:return new X2(Qie(n,t));case jh.DATA_URL:return new X2(dBe(t),hBe(t))}throw h4()}function Jie(n){const t=[];for(let s=0;s<n.length;s++){let a=n.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<n.length-1&&(n.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,p=n.charCodeAt(++s);a=65536|(d&1023)<<10|p&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function uBe(n){let t;try{t=decodeURIComponent(n)}catch{throw Qw(jh.DATA_URL,"Malformed data URL.")}return Jie(t)}function Qie(n,t){switch(n){case jh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw Qw(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case jh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw Qw(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=cBe(t)}catch(l){throw l.message.includes("polyfill")?l:Qw(n,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Zie{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw Qw(jh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=fBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function dBe(n){const t=new Zie(n);return t.base64?Qie(jh.BASE64,t.rest):uBe(t.rest)}function hBe(n){return new Zie(n).contentType}function fBe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(t,s){let a=0,l="";eJ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(eJ(this.data_)){const a=this.data_,l=aBe(a,t,s);return l===null?null:new Zm(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new Zm(a,!0)}}static getBlob(...t){if(p4()){const s=t.map(a=>a instanceof Zm?a.data_:a);return new Zm(oBe.apply(null,s))}else{const s=t.map(p=>f4(p)?lBe(jh.RAW,p).data:p.data_);let a=0;s.forEach(p=>{a+=p.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(p=>{for(let E=0;E<p.length;E++)l[d++]=p[E]}),new Zm(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ese(n){let t;try{t=JSON.parse(n)}catch{return null}return J3e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pBe(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function mBe(n,t){const s=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?s:n+"/"+s}function tse(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gBe(n,t){return t}class Za{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||gBe}}let TO=null;function _Be(n){return!f4(n)||n.length<2?n:tse(n)}function nse(){if(TO)return TO;const n=[];n.push(new Za("bucket")),n.push(new Za("generation")),n.push(new Za("metageneration")),n.push(new Za("name","fullPath",!0));function t(d,p){return _Be(p)}const s=new Za("name");s.xform=t,n.push(s);function a(d,p){return p!==void 0?Number(p):p}const l=new Za("size");return l.xform=a,n.push(l),n.push(new Za("timeCreated")),n.push(new Za("updated")),n.push(new Za("md5Hash",null,!0)),n.push(new Za("cacheControl",null,!0)),n.push(new Za("contentDisposition",null,!0)),n.push(new Za("contentEncoding",null,!0)),n.push(new Za("contentLanguage",null,!0)),n.push(new Za("contentType",null,!0)),n.push(new Za("metadata","customMetadata",!0)),TO=n,TO}function EBe(n,t){function s(){const a=n.bucket,l=n.fullPath,d=new Al(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:s})}function yBe(n,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const p=s[d];a[p.local]=p.xform(a,t[p.server])}return EBe(a,n),a}function rse(n,t,s){const a=ese(t);return a===null?null:yBe(n,a,s)}function vBe(n,t,s,a){const l=ese(t);if(l===null||!f4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(T=>{const w=n.bucket,A=n.fullPath,N="/b/"+p(w)+"/o/"+p(A),F=t1(N,s,a),j=Xie({alt:"media",token:T});return F+j})[0]}function SBe(n,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=n[d.local])}return JSON.stringify(s)}class m4{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(n){if(!n)throw h4()}function TBe(n,t){function s(a,l){const d=rse(n,l,t);return ise(d!==null),d}return s}function bBe(n,t){function s(a,l){const d=rse(n,l,t);return ise(d!==null),vBe(d,l,n.host,n._protocol)}return s}function sse(n){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=M3e():l=x3e():s.getStatus()===402?l=L3e(n.bucket):s.getStatus()===403?l=U3e(n.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function ose(n){const t=sse(n);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=D3e(n.path)),d.serverResponse=l.serverResponse,d}return s}function wBe(n,t,s){const a=t.fullServerUrl(),l=t1(a,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,E=new m4(l,d,bBe(n,s),p);return E.errorHandler=ose(t),E}function RBe(n,t){const s=t.fullServerUrl(),a=t1(s,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(v,T){}const E=new m4(a,l,p,d);return E.successCodes=[200,204],E.errorHandler=ose(t),E}function CBe(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function IBe(n,t,s){const a=Object.assign({},s);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=CBe(null,t)),a}function ABe(n,t,s,a,l){const d=t.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function E(){let ne="";for(let de=0;de<2;de++)ne=ne+Math.random().toString().slice(2);return ne}const v=E();p["Content-Type"]="multipart/related; boundary="+v;const T=IBe(t,a,l),w=SBe(T,s),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+T.contentType+`\r
\r
`,N=`\r
--`+v+"--",F=Zm.getBlob(A,a,N);if(F===null)throw z3e();const j={name:T.fullPath},B=t1(d,n.host,n._protocol),G="POST",J=n.maxUploadRetryTime,K=new m4(B,G,TBe(n,s),J);return K.urlParams=j,K.headers=p,K.body=F.uploadData(),K.errorHandler=sse(t),K}class PBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=yE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=yE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=yE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw iw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw iw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw iw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw iw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw iw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class OBe extends PBe{initXhr(){this.xhr_.responseType="text"}}function g4(){return new OBe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DE{constructor(t,s){this._service=t,s instanceof Al?this._location=s:this._location=Al.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new DE(t,s)}get root(){const t=new Al(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return tse(this._location.path)}get storage(){return this._service}get parent(){const t=pBe(this._location.path);if(t===null)return null;const s=new Al(this._location.bucket,t);return new DE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw $3e(t)}}function kBe(n,t,s){n._throwIfRoot("uploadBytes");const a=ABe(n.storage,n._location,nse(),new Zm(t,!0),s);return n.storage.makeRequestWithTokens(a,g4).then(l=>({metadata:l,ref:n}))}function NBe(n){n._throwIfRoot("getDownloadURL");const t=wBe(n.storage,n._location,nse());return n.storage.makeRequestWithTokens(t,g4).then(s=>{if(s===null)throw G3e();return s})}function DBe(n){n._throwIfRoot("deleteObject");const t=RBe(n.storage,n._location);return n.storage.makeRequestWithTokens(t,g4)}function LBe(n,t){const s=mBe(n._location.path,t),a=new Al(n._location.bucket,s);return new DE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xBe(n){return/^[A-Za-z]+:\/\//.test(n)}function MBe(n,t){return new DE(n,t)}function ase(n,t){if(n instanceof _4){const s=n;if(s._bucket==null)throw W3e();const a=new DE(s,s._bucket);return t!=null?ase(a,t):a}else return t!==void 0?LBe(n,t):n}function UBe(n,t){if(t&&xBe(t)){if(n instanceof _4)return MBe(n,t);throw DV("To use ref(service, url), the first argument must be a Storage instance.")}else return ase(n,t)}function nJ(n,t){const s=t==null?void 0:t[qie];return s==null?null:Al.makeFromBucketSpec(s,n)}function VBe(n,t,s,a={}){n.host=`${t}:${s}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:Rne(l,n.app.options.projectId))}class _4{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Kie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=k3e,this._maxUploadRetryTime=N3e,this._requests=new Set,l!=null?this._bucket=Al.makeFromBucketSpec(l,this._host):this._bucket=nJ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Al.makeFromBucketSpec(this._url,t):this._bucket=nJ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){tJ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){tJ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(Rl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new DE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new K3e(Yie());{const p=iBe(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const rJ="@firebase/storage",iJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cse="storage";function E4(n,t,s){return n=zi(n),kBe(n,t,s)}function n1(n){return n=zi(n),NBe(n)}function y4(n){return n=zi(n),DBe(n)}function BE(n,t){return n=zi(n),UBe(n,t)}function WE(n=_j(),t){n=zi(n);const a=ON(n,cse).getImmediate({identifier:t}),l=Tne("storage");return l&&FBe(a,...l),a}function FBe(n,t,s,a={}){VBe(n,t,s,a)}function jBe(n,{instanceIdentifier:t}){const s=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new _4(s,a,l,t,ME)}function BBe(){IE(new mg(cse,jBe,"PUBLIC").setMultipleInstances(!0)),Kh(rJ,iJ,""),Kh(rJ,iJ,"esm2017")}BBe();const sk=async n=>{const t=WE(),s=BE(t,n);try{return await n1(s)}catch(a){throw De.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let kR={};const ug=async n=>{try{const t=na(Ks,"spaces",n),s=await Tg(t);if(s.exists()){let a=s.data();if(a.webglBuildId){const l=na(Ks,"webglBuilds",a.webglBuildId),d=await Tg(l);if(d.exists()){const p=d.data();a={...a,...p}}else De.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await WBe(a),a=zBe(a),console.log("Space data:",a),De.log(`spacesFirestore: Caching space data for: ${n}`),kR[n]=a,a}else return De.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw De.error("spacesFirestore: Error fetching item data:",t),t}},WBe=async n=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await sk(l))});return await Promise.all(s),n},zBe=n=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let J2={};const lse=async n=>{De.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(J2[n])return De.log("spacesFirestore: Returning cached videos for space:",n),J2[n];const t=OR(Ks,`spaces/${n}/videos`),s=await $k(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),J2[n]=a,a}catch(t){throw De.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},GBe=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=WE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,p=BE(s,`spaces/${n}/logo/${d}`);De.log(`Uploading logo for space ${n}`);const E=await E4(p,t),v=await n1(E.ref),T=na(Ks,"spaces",n);return await Od(T,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),De.log(`Successfully uploaded logo for space ${n}`),v}catch(s){throw De.error("Error uploading space logo:",s),s}},HBe=async n=>{try{const t=na(Ks,"spaces",n),s=await Tg(t);if(!s.exists())return De.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.logoGsUrl){const l=WE(),d=BE(l,a.logoGsUrl);try{await y4(d),De.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(p){De.warn(`Could not delete logo file from storage: ${p.message}`)}}return await Od(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),De.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw De.error("Error deleting space logo:",t),t}},$Be=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=WE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,p=BE(s,`spaces/${n}/background/${d}`);De.log(`Uploading background for space ${n}`);const E=await E4(p,t),v=await n1(E.ref),T=na(Ks,"spaces",n);return await Od(T,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),De.log(`Successfully uploaded background for space ${n}`),v}catch(s){throw De.error("Error uploading space background:",s),s}},KBe=async n=>{try{const t=na(Ks,"spaces",n),s=await Tg(t);if(!s.exists())return De.warn(`No space found with ID: ${n}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=WE(),d=BE(l,a.backgroundGsUrl);try{await y4(d),De.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(p){De.warn(`Could not delete background file from storage: ${p.message}`)}}return await Od(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),De.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw De.error("Error deleting space background:",t),t}},qBe=async(n,t)=>{try{De.log(`spacesFirestore: Updating settings for space: ${n}`,t);const s=na(Ks,"spaces",n),a=await Tg(s);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Od(s,d),kR[n]&&delete kR[n],De.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(s){throw De.error(`spacesFirestore: Error updating settings for space: ${n}`,s),s}},YBe=async(n,t)=>{try{De.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const s=na(Ks,"spaces",n);if(!(await Tg(s)).exists())throw new Error(`Space with ID ${n} not found`);await Od(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),kR[n]&&delete kR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),De.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(s){throw De.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,s),s}},xa=L.createContext(null),r1=({children:n})=>{const[t,s]=L.useState(null),a=L.useRef(null),[l,d]=L.useState(!0),p=hre(),E=J=>J?J.Nickname?J.Nickname:`${J.firstName} ${J.lastName}`:"Anon";L.useEffect(()=>{const J=tVe(p,async K=>{if(De.log("UserProvider: Firebase onAuthStateChanged() fired"),K)try{const ne=await nf(K.uid),de=E(ne),oe={uid:K.uid,email:K.email,...ne,displayName:de};console.log(oe),s(oe),a.current=oe,A(oe)}catch(ne){De.error("UserProvider: Error fetching user profile data:",ne)}else s(null),a.current=null;d(!1)});return()=>{J&&J()}},[]);const v=async(J,K,ne)=>{try{const{firstName:de,lastName:oe}=ne,_e=`${de}${oe.charAt(0).toUpperCase()}`,Z={...ne,Nickname:_e,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ee=await I3e(J,K,Z),te=E(Z),ce={uid:ee.uid,email:ee.email,...Z,displayName:te};return s(ce),a.current=ce,De.log("UserProvider: User registered successfully with groups:",Z.groups),ce}catch(de){throw De.error("UserProvider: Error creating user:",de),de}},T=async(J,K)=>{try{const ne=await QUe(p,J,K),de=await nf(ne.user.uid),oe=E(de),_e={uid:ne.user.uid,email:ne.user.email,...de,displayName:oe};s(_e),A(_e)}catch(ne){throw De.error("UserProvider: Error signing in:",ne),ne}},w=async()=>{try{await nVe(p),s(null),De.log("UserProvider: User signed out.")}catch(J){throw De.error("UserProvider: Error signing out:",J),J}},A=()=>{const J=a.current;if(J){De.log("UserProvider: Current user before filtering:",J);const K=N(J);De.log("UserProvider: sendUserToUnity() using the eventBus",K),Id.publish(Cd.sendUserToUnity,K)}else De.log("UserProvider: No current user to send to Unity.")},N=J=>{De.log("UserProvider: Filtering user properties for Unity. Original user object:",J);const K={},ne=[...P3e,"uid"];return De.log("UserProvider: Properties to include:",ne),ne.forEach(de=>{J.hasOwnProperty(de)&&(K[de]=J[de])}),De.log("UserProvider: Filtered user object for Unity:",K),K},F=async J=>!t||!t.uid?!1:await $ie(t.uid,J),j=async J=>{if(!t||!t.uid)return!1;try{const K=await ug(J);if(K.usersAllowed.includes(t.uid)||K.userAdmin.includes(t.uid)||K.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const de=`space_${J}_owners`,oe=`space_${J}_hosts`;if(t.groups.includes(de)||t.groups.includes(oe))return De.log(`UserProvider: User ${t.uid} has access to space ${J} as owner/host`),!0}return K.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(K){return De.error("UserProvider: Error verifying user access to space:",K),!1}},B=async J=>{if(!t||!t.uid)return!1;try{return(await ug(J)).userAdmin.includes(t.uid)}catch(K){return De.error("UserProvider: Error verifying user admin status for space:",K),!1}},G=async J=>{if(!t||!t.uid)return!1;try{return(await ug(J)).usersModerators.includes(t.uid)}catch(K){return De.error("UserProvider: Error verifying user moderator status for space:",K),!1}};return I.jsx(xa.Provider,{value:{user:t,loading:l,register:v,signIn:T,signOut:w,sendUserToUnity:A,isUserInGroup:F,userHasAccessToSpace:j,userIsAdminOfSpace:B,userIsModeratorOfSpace:G},children:n})},use=L.createContext(),Nd=()=>L.useContext(use),v4=({children:n})=>{const[t,s]=L.useState(!1),a=L.useRef(null),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{const T=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(T)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=L.useCallback(v=>{a.current=v},[]),E=L.useCallback(()=>{const v=a.current;if(!v)return;const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),s(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),s(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{T?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{T?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return L.useEffect(()=>{const v=()=>{const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!T)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),I.jsx(use.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:p,isMobile:l},children:I.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},XBe=C0({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),JBe=C0({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),QBe=C0({displayName:"EmailIcon",path:I.jsxs("g",{fill:"currentColor",children:[I.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),I.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),ZBe=C0({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),e5e=C0({displayName:"QuestionOutlineIcon",path:I.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[I.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),I.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),I.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),t5e=C0({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var cC=n=>n.type==="checkbox",uE=n=>n instanceof Date,ec=n=>n==null;const dse=n=>typeof n=="object";var xs=n=>!ec(n)&&!Array.isArray(n)&&dse(n)&&!uE(n),n5e=n=>xs(n)&&n.target?cC(n.target)?n.target.checked:n.target.value:n,r5e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,i5e=(n,t)=>n.has(r5e(t)),s5e=n=>{const t=n.constructor&&n.constructor.prototype;return xs(t)&&t.hasOwnProperty("isPrototypeOf")},S4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function vu(n){let t;const s=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(S4&&(n instanceof Blob||a))&&(s||xs(n)))if(t=s?[]:{},!s&&!s5e(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=vu(n[l]));else return n;return t}var i1=n=>Array.isArray(n)?n.filter(Boolean):[],zs=n=>n===void 0,on=(n,t,s)=>{if(!t||!xs(n))return s;const a=i1(t.split(/[,[\].]+?/)).reduce((l,d)=>ec(l)?l:l[d],n);return zs(a)||a===n?zs(n[t])?s:n[t]:a},Nh=n=>typeof n=="boolean",T4=n=>/^\w*$/.test(n),hse=n=>i1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),ji=(n,t,s)=>{let a=-1;const l=T4(t)?[t]:hse(t),d=l.length,p=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==p){const T=n[E];v=xs(T)||Array.isArray(T)?T:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;n[E]=v,n=n[E]}return n};const sJ={BLUR:"blur",FOCUS_OUT:"focusout"},wd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ip={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ti.createContext(null);var o5e=(n,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return t._proxyFormState[p]!==wd.all&&(t._proxyFormState[p]=!a||wd.all),n[p]}});return l},Gc=n=>xs(n)&&!Object.keys(n).length,a5e=(n,t,s,a)=>{s(n);const{name:l,...d}=n;return Gc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(p=>t[p]===wd.all)},ok=n=>Array.isArray(n)?n:[n];function c5e(n){const t=ti.useRef(n);t.current=n,ti.useEffect(()=>{const s=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[n.disabled])}var Bh=n=>typeof n=="string",l5e=(n,t,s,a,l)=>Bh(n)?(a&&t.watch.add(n),on(s,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),on(s,d))):(a&&(t.watchAll=!0),s),u5e=(n,t,s,a,l)=>t?{...s[n],types:{...s[n]&&s[n].types?s[n].types:{},[a]:l||!0}}:{},oJ=n=>({isOnSubmit:!n||n===wd.onSubmit,isOnBlur:n===wd.onBlur,isOnChange:n===wd.onChange,isOnAll:n===wd.all,isOnTouch:n===wd.onTouched}),aJ=(n,t,s)=>!s&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const Zw=(n,t,s,a)=>{for(const l of s||Object.keys(n)){const d=on(n,l);if(d){const{_f:p,...E}=d;if(p){if(p.refs&&p.refs[0]&&t(p.refs[0],l)&&!a)return!0;if(p.ref&&t(p.ref,p.name)&&!a)return!0;if(Zw(E,t))break}else if(xs(E)&&Zw(E,t))break}}};var d5e=(n,t,s)=>{const a=ok(on(n,s));return ji(a,"root",t[s]),ji(n,s,a),n},b4=n=>n.type==="file",Uh=n=>typeof n=="function",Kk=n=>{if(!S4)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ak=n=>Bh(n),w4=n=>n.type==="radio",qk=n=>n instanceof RegExp;const cJ={value:!1,isValid:!1},lJ={value:!0,isValid:!0};var fse=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!zs(n[0].attributes.value)?zs(n[0].value)||n[0].value===""?lJ:{value:n[0].value,isValid:!0}:lJ:cJ}return cJ};const uJ={isValid:!1,value:null};var pse=n=>Array.isArray(n)?n.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,uJ):uJ;function dJ(n,t,s="validate"){if(ak(n)||Array.isArray(n)&&n.every(ak)||Nh(n)&&!n)return{type:s,message:ak(n)?n:"",ref:t}}var hS=n=>xs(n)&&!qk(n)?n:{value:n,message:""},hJ=async(n,t,s,a,l,d)=>{const{ref:p,refs:E,required:v,maxLength:T,minLength:w,min:A,max:N,pattern:F,validate:j,name:B,valueAsNumber:G,mount:J}=n._f,K=on(s,B);if(!J||t.has(B))return{};const ne=E?E[0]:p,de=he=>{l&&ne.reportValidity&&(ne.setCustomValidity(Nh(he)?"":he||""),ne.reportValidity())},oe={},_e=w4(p),Z=cC(p),ee=_e||Z,te=(G||b4(p))&&zs(p.value)&&zs(K)||Kk(p)&&p.value===""||K===""||Array.isArray(K)&&!K.length,ce=u5e.bind(null,B,a,oe),me=(he,se,Se,Ve=ip.maxLength,tt=ip.minLength)=>{const ke=he?se:Se;oe[B]={type:he?Ve:tt,message:ke,ref:p,...ce(he?Ve:tt,ke)}};if(d?!Array.isArray(K)||!K.length:v&&(!ee&&(te||ec(K))||Nh(K)&&!K||Z&&!fse(E).isValid||_e&&!pse(E).isValid)){const{value:he,message:se}=ak(v)?{value:!!v,message:v}:hS(v);if(he&&(oe[B]={type:ip.required,message:se,ref:ne,...ce(ip.required,se)},!a))return de(se),oe}if(!te&&(!ec(A)||!ec(N))){let he,se;const Se=hS(N),Ve=hS(A);if(!ec(K)&&!isNaN(K)){const tt=p.valueAsNumber||K&&+K;ec(Se.value)||(he=tt>Se.value),ec(Ve.value)||(se=tt<Ve.value)}else{const tt=p.valueAsDate||new Date(K),ke=Xe=>new Date(new Date().toDateString()+" "+Xe),Me=p.type=="time",Ce=p.type=="week";Bh(Se.value)&&K&&(he=Me?ke(K)>ke(Se.value):Ce?K>Se.value:tt>new Date(Se.value)),Bh(Ve.value)&&K&&(se=Me?ke(K)<ke(Ve.value):Ce?K<Ve.value:tt<new Date(Ve.value))}if((he||se)&&(me(!!he,Se.message,Ve.message,ip.max,ip.min),!a))return de(oe[B].message),oe}if((T||w)&&!te&&(Bh(K)||d&&Array.isArray(K))){const he=hS(T),se=hS(w),Se=!ec(he.value)&&K.length>+he.value,Ve=!ec(se.value)&&K.length<+se.value;if((Se||Ve)&&(me(Se,he.message,se.message),!a))return de(oe[B].message),oe}if(F&&!te&&Bh(K)){const{value:he,message:se}=hS(F);if(qk(he)&&!K.match(he)&&(oe[B]={type:ip.pattern,message:se,ref:p,...ce(ip.pattern,se)},!a))return de(se),oe}if(j){if(Uh(j)){const he=await j(K,s),se=dJ(he,ne);if(se&&(oe[B]={...se,...ce(ip.validate,se.message)},!a))return de(se.message),oe}else if(xs(j)){let he={};for(const se in j){if(!Gc(he)&&!a)break;const Se=dJ(await j[se](K,s),ne,se);Se&&(he={...Se,...ce(se,Se.message)},de(Se.message),a&&(oe[B]=he))}if(!Gc(he)&&(oe[B]={ref:ne,...he},!a))return oe}}return de(!0),oe};function h5e(n,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)n=zs(n)?a++:n[t[a++]];return n}function f5e(n){for(const t in n)if(n.hasOwnProperty(t)&&!zs(n[t]))return!1;return!0}function so(n,t){const s=Array.isArray(t)?t:T4(t)?[t]:hse(t),a=s.length===1?n:h5e(n,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(xs(a)&&Gc(a)||Array.isArray(a)&&f5e(a))&&so(n,s.slice(0,-1)),n}var Q2=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},LV=n=>ec(n)||!dse(n);function eg(n,t){if(LV(n)||LV(t))return n===t;if(uE(n)&&uE(t))return n.getTime()===t.getTime();const s=Object.keys(n),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const p=t[l];if(uE(d)&&uE(p)||xs(d)&&xs(p)||Array.isArray(d)&&Array.isArray(p)?!eg(d,p):d!==p)return!1}}return!0}var mse=n=>n.type==="select-multiple",p5e=n=>w4(n)||cC(n),Z2=n=>Kk(n)&&n.isConnected,gse=n=>{for(const t in n)if(Uh(n[t]))return!0;return!1};function Yk(n,t={}){const s=Array.isArray(n);if(xs(n)||s)for(const a in n)Array.isArray(n[a])||xs(n[a])&&!gse(n[a])?(t[a]=Array.isArray(n[a])?[]:{},Yk(n[a],t[a])):ec(n[a])||(t[a]=!0);return t}function _se(n,t,s){const a=Array.isArray(n);if(xs(n)||a)for(const l in n)Array.isArray(n[l])||xs(n[l])&&!gse(n[l])?zs(t)||LV(s[l])?s[l]=Array.isArray(n[l])?Yk(n[l],[]):{...Yk(n[l])}:_se(n[l],ec(t)?{}:t[l],s[l]):s[l]=!eg(n[l],t[l]);return s}var sw=(n,t)=>_se(n,t,Yk(t)),Ese=(n,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>zs(n)?n:t?n===""?NaN:n&&+n:s&&Bh(n)?new Date(n):a?a(n):n;function eU(n){const t=n.ref;return b4(t)?t.files:w4(t)?pse(n.refs).value:mse(t)?[...t.selectedOptions].map(({value:s})=>s):cC(t)?fse(n.refs).value:Ese(zs(t.value)?n.ref.value:t.value,n)}var m5e=(n,t,s,a)=>{const l={};for(const d of n){const p=on(t,d);p&&ji(l,d,p._f)}return{criteriaMode:s,names:[...n],fields:l,shouldUseNativeValidation:a}},ow=n=>zs(n)?n:qk(n)?n.source:xs(n)?qk(n.value)?n.value.source:n.value:n;const fJ="AsyncFunction";var g5e=n=>!!n&&!!n.validate&&!!(Uh(n.validate)&&n.validate.constructor.name===fJ||xs(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===fJ)),_5e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function pJ(n,t,s){const a=on(n,s);if(a||T4(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),p=on(t,d),E=on(n,d);if(p&&!Array.isArray(p)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var E5e=(n,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||n):(s?a.isOnBlur:l.isOnBlur)?!n:(s?a.isOnChange:l.isOnChange)?n:!0,y5e=(n,t)=>!i1(on(n,t)).length&&so(n,t);const v5e={mode:wd.onSubmit,reValidateMode:wd.onChange,shouldFocusError:!0};function S5e(n={}){let t={...v5e,...n},s={submitCount:0,isDirty:!1,isLoading:Uh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=xs(t.defaultValues)||xs(t.values)?vu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:vu(l),p={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,T=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:Q2(),array:Q2(),state:Q2()},N=oJ(t.mode),F=oJ(t.reValidateMode),j=t.criteriaMode===wd.all,B=ve=>Ue=>{clearTimeout(T),T=setTimeout(ve,Ue)},G=async ve=>{if(!t.disabled&&(w.isValid||ve)){const Ue=t.resolver?Gc((await ee()).errors):await ce(a,!0);Ue!==s.isValid&&A.state.next({isValid:Ue})}},J=(ve,Ue)=>{!t.disabled&&(w.isValidating||w.validatingFields)&&((ve||Array.from(E.mount)).forEach(He=>{He&&(Ue?ji(s.validatingFields,He,Ue):so(s.validatingFields,He))}),A.state.next({validatingFields:s.validatingFields,isValidating:!Gc(s.validatingFields)}))},K=(ve,Ue=[],He,_t,vt=!0,St=!0)=>{if(_t&&He&&!t.disabled){if(p.action=!0,St&&Array.isArray(on(a,ve))){const zt=He(on(a,ve),_t.argA,_t.argB);vt&&ji(a,ve,zt)}if(St&&Array.isArray(on(s.errors,ve))){const zt=He(on(s.errors,ve),_t.argA,_t.argB);vt&&ji(s.errors,ve,zt),y5e(s.errors,ve)}if(w.touchedFields&&St&&Array.isArray(on(s.touchedFields,ve))){const zt=He(on(s.touchedFields,ve),_t.argA,_t.argB);vt&&ji(s.touchedFields,ve,zt)}w.dirtyFields&&(s.dirtyFields=sw(l,d)),A.state.next({name:ve,isDirty:he(ve,Ue),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else ji(d,ve,Ue)},ne=(ve,Ue)=>{ji(s.errors,ve,Ue),A.state.next({errors:s.errors})},de=ve=>{s.errors=ve,A.state.next({errors:s.errors,isValid:!1})},oe=(ve,Ue,He,_t)=>{const vt=on(a,ve);if(vt){const St=on(d,ve,zs(He)?on(l,ve):He);zs(St)||_t&&_t.defaultChecked||Ue?ji(d,ve,Ue?St:eU(vt._f)):Ve(ve,St),p.mount&&G()}},_e=(ve,Ue,He,_t,vt)=>{let St=!1,zt=!1;const dn={name:ve};if(!t.disabled){const fn=!!(on(a,ve)&&on(a,ve)._f&&on(a,ve)._f.disabled);if(!He||_t){w.isDirty&&(zt=s.isDirty,s.isDirty=dn.isDirty=he(),St=zt!==dn.isDirty);const Xt=fn||eg(on(l,ve),Ue);zt=!!(!fn&&on(s.dirtyFields,ve)),Xt||fn?so(s.dirtyFields,ve):ji(s.dirtyFields,ve,!0),dn.dirtyFields=s.dirtyFields,St=St||w.dirtyFields&&zt!==!Xt}if(He){const Xt=on(s.touchedFields,ve);Xt||(ji(s.touchedFields,ve,He),dn.touchedFields=s.touchedFields,St=St||w.touchedFields&&Xt!==He)}St&&vt&&A.state.next(dn)}return St?dn:{}},Z=(ve,Ue,He,_t)=>{const vt=on(s.errors,ve),St=w.isValid&&Nh(Ue)&&s.isValid!==Ue;if(t.delayError&&He?(v=B(()=>ne(ve,He)),v(t.delayError)):(clearTimeout(T),v=null,He?ji(s.errors,ve,He):so(s.errors,ve)),(He?!eg(vt,He):vt)||!Gc(_t)||St){const zt={..._t,...St&&Nh(Ue)?{isValid:Ue}:{},errors:s.errors,name:ve};s={...s,...zt},A.state.next(zt)}},ee=async ve=>{J(ve,!0);const Ue=await t.resolver(d,t.context,m5e(ve||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return J(ve),Ue},te=async ve=>{const{errors:Ue}=await ee(ve);if(ve)for(const He of ve){const _t=on(Ue,He);_t?ji(s.errors,He,_t):so(s.errors,He)}else s.errors=Ue;return Ue},ce=async(ve,Ue,He={valid:!0})=>{for(const _t in ve){const vt=ve[_t];if(vt){const{_f:St,...zt}=vt;if(St){const dn=E.array.has(St.name),fn=vt._f&&g5e(vt._f);fn&&w.validatingFields&&J([_t],!0);const Xt=await hJ(vt,E.disabled,d,j,t.shouldUseNativeValidation&&!Ue,dn);if(fn&&w.validatingFields&&J([_t]),Xt[St.name]&&(He.valid=!1,Ue))break;!Ue&&(on(Xt,St.name)?dn?d5e(s.errors,Xt,St.name):ji(s.errors,St.name,Xt[St.name]):so(s.errors,St.name))}!Gc(zt)&&await ce(zt,Ue,He)}}return He.valid},me=()=>{for(const ve of E.unMount){const Ue=on(a,ve);Ue&&(Ue._f.refs?Ue._f.refs.every(He=>!Z2(He)):!Z2(Ue._f.ref))&&Qe(ve)}E.unMount=new Set},he=(ve,Ue)=>!t.disabled&&(ve&&Ue&&ji(d,ve,Ue),!eg(Ae(),l)),se=(ve,Ue,He)=>l5e(ve,E,{...p.mount?d:zs(Ue)?l:Bh(ve)?{[ve]:Ue}:Ue},He,Ue),Se=ve=>i1(on(p.mount?d:l,ve,t.shouldUnregister?on(l,ve,[]):[])),Ve=(ve,Ue,He={})=>{const _t=on(a,ve);let vt=Ue;if(_t){const St=_t._f;St&&(!St.disabled&&ji(d,ve,Ese(Ue,St)),vt=Kk(St.ref)&&ec(Ue)?"":Ue,mse(St.ref)?[...St.ref.options].forEach(zt=>zt.selected=vt.includes(zt.value)):St.refs?cC(St.ref)?St.refs.length>1?St.refs.forEach(zt=>(!zt.defaultChecked||!zt.disabled)&&(zt.checked=Array.isArray(vt)?!!vt.find(dn=>dn===zt.value):vt===zt.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(zt=>zt.checked=zt.value===vt):b4(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||A.values.next({name:ve,values:{...d}})))}(He.shouldDirty||He.shouldTouch)&&_e(ve,vt,He.shouldTouch,He.shouldDirty,!0),He.shouldValidate&&Xe(ve)},tt=(ve,Ue,He)=>{for(const _t in Ue){const vt=Ue[_t],St=`${ve}.${_t}`,zt=on(a,St);(E.array.has(ve)||xs(vt)||zt&&!zt._f)&&!uE(vt)?tt(St,vt,He):Ve(St,vt,He)}},ke=(ve,Ue,He={})=>{const _t=on(a,ve),vt=E.array.has(ve),St=vu(Ue);ji(d,ve,St),vt?(A.array.next({name:ve,values:{...d}}),(w.isDirty||w.dirtyFields)&&He.shouldDirty&&A.state.next({name:ve,dirtyFields:sw(l,d),isDirty:he(ve,St)})):_t&&!_t._f&&!ec(St)?tt(ve,St,He):Ve(ve,St,He),aJ(ve,E)&&A.state.next({...s}),A.values.next({name:p.mount?ve:void 0,values:{...d}})},Me=async ve=>{p.mount=!0;const Ue=ve.target;let He=Ue.name,_t=!0;const vt=on(a,He),St=()=>Ue.type?eU(vt._f):n5e(ve),zt=dn=>{_t=Number.isNaN(dn)||uE(dn)&&isNaN(dn.getTime())||eg(dn,on(d,He,dn))};if(vt){let dn,fn;const Xt=St(),Bn=ve.type===sJ.BLUR||ve.type===sJ.FOCUS_OUT,cc=!_5e(vt._f)&&!t.resolver&&!on(s.errors,He)&&!vt._f.deps||E5e(Bn,on(s.touchedFields,He),s.isSubmitted,F,N),jt=aJ(He,E,Bn);ji(d,He,Xt),Bn?(vt._f.onBlur&&vt._f.onBlur(ve),v&&v(0)):vt._f.onChange&&vt._f.onChange(ve);const an=_e(He,Xt,Bn,!1),Zi=!Gc(an)||jt;if(!Bn&&A.values.next({name:He,type:ve.type,values:{...d}}),cc)return w.isValid&&(t.mode==="onBlur"&&Bn?G():Bn||G()),Zi&&A.state.next({name:He,...jt?{}:an});if(!Bn&&jt&&A.state.next({...s}),t.resolver){const{errors:Ms}=await ee([He]);if(zt(Xt),_t){const qs=pJ(s.errors,a,He),hi=pJ(Ms,a,qs.name||He);dn=hi.error,He=hi.name,fn=Gc(Ms)}}else J([He],!0),dn=(await hJ(vt,E.disabled,d,j,t.shouldUseNativeValidation))[He],J([He]),zt(Xt),_t&&(dn?fn=!1:w.isValid&&(fn=await ce(a,!0)));_t&&(vt._f.deps&&Xe(vt._f.deps),Z(He,fn,dn,an))}},Ce=(ve,Ue)=>{if(on(s.errors,Ue)&&ve.focus)return ve.focus(),1},Xe=async(ve,Ue={})=>{let He,_t;const vt=ok(ve);if(t.resolver){const St=await te(zs(ve)?ve:vt);He=Gc(St),_t=ve?!vt.some(zt=>on(St,zt)):He}else ve?(_t=(await Promise.all(vt.map(async St=>{const zt=on(a,St);return await ce(zt&&zt._f?{[St]:zt}:zt)}))).every(Boolean),!(!_t&&!s.isValid)&&G()):_t=He=await ce(a);return A.state.next({...!Bh(ve)||w.isValid&&He!==s.isValid?{}:{name:ve},...t.resolver||!ve?{isValid:He}:{},errors:s.errors}),Ue.shouldFocus&&!_t&&Zw(a,Ce,ve?vt:E.mount),_t},Ae=ve=>{const Ue={...p.mount?d:l};return zs(ve)?Ue:Bh(ve)?on(Ue,ve):ve.map(He=>on(Ue,He))},Ie=(ve,Ue)=>({invalid:!!on((Ue||s).errors,ve),isDirty:!!on((Ue||s).dirtyFields,ve),error:on((Ue||s).errors,ve),isValidating:!!on(s.validatingFields,ve),isTouched:!!on((Ue||s).touchedFields,ve)}),be=ve=>{ve&&ok(ve).forEach(Ue=>so(s.errors,Ue)),A.state.next({errors:ve?s.errors:{}})},xe=(ve,Ue,He)=>{const _t=(on(a,ve,{_f:{}})._f||{}).ref,vt=on(s.errors,ve)||{},{ref:St,message:zt,type:dn,...fn}=vt;ji(s.errors,ve,{...fn,...Ue,ref:_t}),A.state.next({name:ve,errors:s.errors,isValid:!1}),He&&He.shouldFocus&&_t&&_t.focus&&_t.focus()},We=(ve,Ue)=>Uh(ve)?A.values.subscribe({next:He=>ve(se(void 0,Ue),He)}):se(ve,Ue,!0),Qe=(ve,Ue={})=>{for(const He of ve?ok(ve):E.mount)E.mount.delete(He),E.array.delete(He),Ue.keepValue||(so(a,He),so(d,He)),!Ue.keepError&&so(s.errors,He),!Ue.keepDirty&&so(s.dirtyFields,He),!Ue.keepTouched&&so(s.touchedFields,He),!Ue.keepIsValidating&&so(s.validatingFields,He),!t.shouldUnregister&&!Ue.keepDefaultValue&&so(l,He);A.values.next({values:{...d}}),A.state.next({...s,...Ue.keepDirty?{isDirty:he()}:{}}),!Ue.keepIsValid&&G()},Ze=({disabled:ve,name:Ue,field:He,fields:_t})=>{(Nh(ve)&&p.mount||ve||E.disabled.has(Ue))&&(ve?E.disabled.add(Ue):E.disabled.delete(Ue),_e(Ue,eU(He?He._f:on(_t,Ue)._f),!1,!1,!0))},ut=(ve,Ue={})=>{let He=on(a,ve);const _t=Nh(Ue.disabled)||Nh(t.disabled);return ji(a,ve,{...He||{},_f:{...He&&He._f?He._f:{ref:{name:ve}},name:ve,mount:!0,...Ue}}),E.mount.add(ve),He?Ze({field:He,disabled:Nh(Ue.disabled)?Ue.disabled:t.disabled,name:ve}):oe(ve,!0,Ue.value),{..._t?{disabled:Ue.disabled||t.disabled}:{},...t.progressive?{required:!!Ue.required,min:ow(Ue.min),max:ow(Ue.max),minLength:ow(Ue.minLength),maxLength:ow(Ue.maxLength),pattern:ow(Ue.pattern)}:{},name:ve,onChange:Me,onBlur:Me,ref:vt=>{if(vt){ut(ve,Ue),He=on(a,ve);const St=zs(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,zt=p5e(St),dn=He._f.refs||[];if(zt?dn.find(fn=>fn===St):St===He._f.ref)return;ji(a,ve,{_f:{...He._f,...zt?{refs:[...dn.filter(Z2),St,...Array.isArray(on(l,ve))?[{}]:[]],ref:{type:St.type,name:ve}}:{ref:St}}}),oe(ve,!1,void 0,St)}else He=on(a,ve,{}),He._f&&(He._f.mount=!1),(t.shouldUnregister||Ue.shouldUnregister)&&!(i5e(E.array,ve)&&p.action)&&E.unMount.add(ve)}}},it=()=>t.shouldFocusError&&Zw(a,Ce,E.mount),It=ve=>{Nh(ve)&&(A.state.next({disabled:ve}),Zw(a,(Ue,He)=>{const _t=on(a,He);_t&&(Ue.disabled=_t._f.disabled||ve,Array.isArray(_t._f.refs)&&_t._f.refs.forEach(vt=>{vt.disabled=_t._f.disabled||ve}))},0,!1))},yn=(ve,Ue)=>async He=>{let _t;He&&(He.preventDefault&&He.preventDefault(),He.persist&&He.persist());let vt=vu(d);if(E.disabled.size)for(const St of E.disabled)ji(vt,St,void 0);if(A.state.next({isSubmitting:!0}),t.resolver){const{errors:St,values:zt}=await ee();s.errors=St,vt=zt}else await ce(a);if(so(s.errors,"root"),Gc(s.errors)){A.state.next({errors:{}});try{await ve(vt,He)}catch(St){_t=St}}else Ue&&await Ue({...s.errors},He),it(),setTimeout(it);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Gc(s.errors)&&!_t,submitCount:s.submitCount+1,errors:s.errors}),_t)throw _t},Vt=(ve,Ue={})=>{on(a,ve)&&(zs(Ue.defaultValue)?ke(ve,vu(on(l,ve))):(ke(ve,Ue.defaultValue),ji(l,ve,vu(Ue.defaultValue))),Ue.keepTouched||so(s.touchedFields,ve),Ue.keepDirty||(so(s.dirtyFields,ve),s.isDirty=Ue.defaultValue?he(ve,vu(on(l,ve))):he()),Ue.keepError||(so(s.errors,ve),w.isValid&&G()),A.state.next({...s}))},ln=(ve,Ue={})=>{const He=ve?vu(ve):l,_t=vu(He),vt=Gc(ve),St=vt?l:_t;if(Ue.keepDefaultValues||(l=He),!Ue.keepValues){if(Ue.keepDirtyValues){const zt=new Set([...E.mount,...Object.keys(sw(l,d))]);for(const dn of Array.from(zt))on(s.dirtyFields,dn)?ji(St,dn,on(d,dn)):ke(dn,on(St,dn))}else{if(S4&&zs(ve))for(const zt of E.mount){const dn=on(a,zt);if(dn&&dn._f){const fn=Array.isArray(dn._f.refs)?dn._f.refs[0]:dn._f.ref;if(Kk(fn)){const Xt=fn.closest("form");if(Xt){Xt.reset();break}}}}a={}}d=t.shouldUnregister?Ue.keepDefaultValues?vu(l):{}:vu(St),A.array.next({values:{...St}}),A.values.next({values:{...St}})}E={mount:Ue.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!w.isValid||!!Ue.keepIsValid||!!Ue.keepDirtyValues,p.watch=!!t.shouldUnregister,A.state.next({submitCount:Ue.keepSubmitCount?s.submitCount:0,isDirty:vt?!1:Ue.keepDirty?s.isDirty:!!(Ue.keepDefaultValues&&!eg(ve,l)),isSubmitted:Ue.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:vt?{}:Ue.keepDirtyValues?Ue.keepDefaultValues&&d?sw(l,d):s.dirtyFields:Ue.keepDefaultValues&&ve?sw(l,ve):Ue.keepDirty?s.dirtyFields:{},touchedFields:Ue.keepTouched?s.touchedFields:{},errors:Ue.keepErrors?s.errors:{},isSubmitSuccessful:Ue.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},xn=(ve,Ue)=>ln(Uh(ve)?ve(d):ve,Ue);return{control:{register:ut,unregister:Qe,getFieldState:Ie,handleSubmit:yn,setError:xe,_executeSchema:ee,_getWatch:se,_getDirty:he,_updateValid:G,_removeUnmounted:me,_updateFieldArray:K,_updateDisabledField:Ze,_getFieldArray:Se,_reset:ln,_resetDefaultValues:()=>Uh(t.defaultValues)&&t.defaultValues().then(ve=>{xn(ve,t.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:ve=>{s={...s,...ve}},_disableForm:It,_subjects:A,_proxyFormState:w,_setErrors:de,get _fields(){return a},get _formValues(){return d},get _state(){return p},set _state(ve){p=ve},get _defaultValues(){return l},get _names(){return E},set _names(ve){E=ve},get _formState(){return s},set _formState(ve){s=ve},get _options(){return t},set _options(ve){t={...t,...ve}}},trigger:Xe,register:ut,handleSubmit:yn,watch:We,setValue:ke,getValues:Ae,reset:xn,resetField:Vt,clearErrors:be,unregister:Qe,setError:xe,setFocus:(ve,Ue={})=>{const He=on(a,ve),_t=He&&He._f;if(_t){const vt=_t.refs?_t.refs[0]:_t.ref;vt.focus&&(vt.focus(),Ue.shouldSelect&&Uh(vt.select)&&vt.select())}},getFieldState:Ie}}function yse(n={}){const t=ti.useRef(void 0),s=ti.useRef(void 0),[a,l]=ti.useState({isDirty:!1,isValidating:!1,isLoading:Uh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Uh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...S5e(n),formState:a});const d=t.current.control;return d._options=n,c5e({subject:d._subjects.state,next:p=>{a5e(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ti.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ti.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==a.isDirty&&d._subjects.state.next({isDirty:p})}},[d,a.isDirty]),ti.useEffect(()=>{n.values&&!eg(n.values,s.current)?(d._reset(n.values,d._options.resetOptions),s.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),ti.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ti.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ti.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=o5e(a,d),t.current}const s1=(n,t="generic-modal")=>{L.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),De.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){De.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),De.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):De.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){De.error(`Failed to enable Unity input for ${t}:`,l)}};return n?s():a(),()=>{n&&a()}},[n,t])};function o1({mode:n,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:E}}=yse(),{register:v}=L.useContext(xa),T=kd(),{fullscreenRef:w}=Nd(),[A,N]=L.useState(!1),[F,j]=L.useState(!1),B=a!==void 0?a:A,G=l||(()=>N(!1));s1(B);const J=async de=>{const{email:oe,password:_e,confirmPassword:Z,...ee}=de;if(_e!==Z){T({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const te=await v(oe,_e,ee);De.log("User: Registration process complete."),G(),T({title:"Registration Successful",description:"Your account has been created and you've been added to the users group.",status:"success",duration:5e3,isClosable:!0,position:"top"})}catch(te){De.error("User: Registration Error:",te),T({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!A)},ne=n==="link"?I.jsx(Zh,{variant:"header",onClick:K,children:t}):I.jsx(wi,{onClick:K,...s,children:t});return I.jsxs(I.Fragment,{children:[!a&&ne,I.jsxs(oc,{isOpen:B,onClose:G,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[I.jsx(sc,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),I.jsxs(ac,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:de=>{de.stopPropagation()},children:[I.jsxs(Ou,{p:8,textAlign:"center",children:[I.jsx(pj,{size:"lg",mb:2,children:"Create Account"}),I.jsx(ft,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),I.jsx(el,{color:"gray.400"}),I.jsx(ic,{px:8,children:I.jsx("form",{onSubmit:p(J),children:I.jsxs(di,{spacing:4,children:[I.jsxs(Bi,{isInvalid:E.companyName,isRequired:!0,children:[I.jsx(Ns,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),I.jsx(ap,{children:E.companyName&&E.companyName.message})]}),I.jsxs(Ri,{gap:4,w:"100%",children:[I.jsxs(Bi,{isInvalid:E.firstName,isRequired:!0,children:[I.jsx(Ns,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),I.jsx(ap,{children:E.firstName&&E.firstName.message})]}),I.jsxs(Bi,{isInvalid:E.lastName,isRequired:!0,children:[I.jsx(Ns,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),I.jsx(ap,{children:E.lastName&&E.lastName.message})]})]}),I.jsxs(Bi,{isInvalid:E.email,isRequired:!0,children:[I.jsx(Ns,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),I.jsx(ap,{children:E.email&&E.email.message})]}),I.jsxs(Ri,{gap:4,w:"100%",children:[I.jsxs(Bi,{isInvalid:E.password,isRequired:!0,children:[I.jsx(Ns,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),I.jsx(ap,{children:E.password&&E.password.message})]}),I.jsxs(Bi,{isInvalid:E.confirmPassword,isRequired:!0,children:[I.jsx(Ns,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),I.jsx(ap,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),I.jsx(Bi,{children:I.jsx(Ns,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),I.jsx(Bi,{children:I.jsx(Ns,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),I.jsxs(l0,{px:8,pb:8,flexDirection:"column",gap:4,children:[I.jsx(wi,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(J),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),I.jsxs(ft,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",I.jsx(Zh,{color:"blue.400",onClick:G,children:"Sign In"})]})]})]})]})]})}o1.propTypes={mode:vr.oneOf(["button","link"]),label:vr.string,buttonProps:vr.object,isOpen:vr.bool,onClose:vr.func};function R4({mode:n="button",label:t="Sign In",buttonProps:s={}}){const{signIn:a}=L.useContext(xa),{fullscreenRef:l}=Nd(),d=kd(),{register:p,handleSubmit:E,formState:{errors:v,isSubmitting:T}}=yse({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[w,A]=L.useState(!1),[N,F]=L.useState(!1);s1(w);const j=async K=>{try{await a(K.email,K.password),De.log("User: Sign-in process complete."),A(!1),window.location.reload()}catch(ne){De.error("User: SignIn Error:",ne),d({title:"Error",description:"An error occurred while logging in. Please check your credentials.",status:"error",duration:1e4,isClosable:!0,position:"top",container:l.current})}},B=()=>A(K=>!K),G=()=>{A(!1),F(!0)},J=n==="link"?I.jsx(Zh,{variant:"header",onClick:B,children:t}):I.jsx(wi,{onClick:B,...s,children:t});return I.jsxs(I.Fragment,{children:[J,I.jsxs(oc,{isOpen:w,onClose:B,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[I.jsx(sc,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),I.jsx("form",{onSubmit:E(j),children:I.jsxs(ac,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:K=>{K.stopPropagation()},children:[I.jsxs(Ou,{p:8,textAlign:"center",children:[I.jsx(pj,{size:"lg",mb:2,children:"Welcome Back"}),I.jsx(ft,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),I.jsx(el,{color:"gray.400"}),I.jsx(ic,{px:8,pb:8,children:I.jsxs(di,{spacing:4,children:[I.jsxs(Bi,{isInvalid:v.email,children:[I.jsxs(qU,{children:[I.jsx(wk,{pointerEvents:"none",children:I.jsx(QBe,{color:"gray.500"})}),I.jsx(Ns,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...p("email",{required:"Email is required."})})]}),I.jsx(ap,{children:v.email&&v.email.message})]}),I.jsxs(Bi,{isInvalid:v.password,children:[I.jsxs(qU,{children:[I.jsx(wk,{pointerEvents:"none",children:I.jsx(XBe,{color:"gray.500"})}),I.jsx(Ns,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...p("password",{required:"Password is required."})})]}),I.jsx(ap,{children:v.password&&v.password.message})]})]})}),I.jsxs(l0,{px:8,pb:8,flexDirection:"column",gap:4,children:[I.jsx(wi,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:T,loadingText:"Signing In",children:"Sign In"}),I.jsxs(ft,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",I.jsx(Zh,{color:"blue.400",onClick:G,children:"Sign Up"})]})]})]})})]}),I.jsx(o1,{mode:"link",isOpen:N,onClose:()=>F(!1)})]})}R4.propTypes={mode:vr.oneOf(["button","link"]),label:vr.string,buttonProps:vr.object};function C4({mode:n="button",label:t="Sign Out"}){const s=kd(),{signOut:a}=L.useContext(xa),{fullscreenRef:l}=Nd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?I.jsx(Zh,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return I.jsx(I.Fragment,{children:p})}C4.propTypes={mode:vr.oneOf(["button","link"]),label:vr.string};const T5e=()=>{const[n,t]=L.useState(!1);return L.useEffect(()=>{var s,a,l;if(n){const d=document.querySelector("#unity-canvas");d&&(d.blur(),d.style.pointerEvents="none");const p=(a=(s=window.unityInstance)==null?void 0:s.Module)==null?void 0:a.WebGLInputHandler;(l=window.unityInstance)!=null&&l.Module&&(window.unityInstance.Module.WebGLInputHandler=null);const E=v=>{v.stopImmediatePropagation(),v.stopPropagation()};return document.addEventListener("keydown",E,!0),document.addEventListener("keyup",E,!0),document.addEventListener("keypress",E,!0),document.addEventListener("keydown",E,!1),document.addEventListener("keyup",E,!1),document.addEventListener("keypress",E,!1),()=>{var v;(v=window.unityInstance)!=null&&v.Module&&p&&(window.unityInstance.Module.WebGLInputHandler=p),d&&(d.style.pointerEvents="auto"),document.removeEventListener("keydown",E,!0),document.removeEventListener("keyup",E,!0),document.removeEventListener("keypress",E,!0),document.removeEventListener("keydown",E,!1),document.removeEventListener("keyup",E,!1),document.removeEventListener("keypress",E,!1)}}},[n]),[n,t]},b5e=({isOpen:n,onClose:t,user:s,profileImageUrl:a})=>{const[l,d]=L.useState(!1),[p,E]=L.useState({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""}),[v,T]=L.useState(!1),[w,A]=T5e(),N=kd(),{sendUserToUnity:F}=L.useContext(xa),j=L.useRef(null);L.useEffect(()=>{E({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""})},[s]),L.useEffect(()=>{if(l&&j.current){const de=()=>{j.current.focus(),A(!0);const Z=document.querySelector("#unity-canvas");Z&&Z.blur()};de();const oe=setTimeout(de,100),_e=setTimeout(de,300);return()=>{clearTimeout(oe),clearTimeout(_e)}}else A(!1)},[l,A]);const B=()=>{d(!1),A(!1),t()},G=de=>{const{name:oe,value:_e}=de.target;E(Z=>({...Z,[oe]:_e}))},J=async()=>{if(p.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}T(!0);try{const de=na(Ks,"users",s.uid),oe=Bie(de,_e=>{_e.exists()&&_e.data().Nickname===p.Nickname&&(F(),oe())});await Od(de,{...p,lastUpdated:new Date().toISOString()}),await updateUser(),E({Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(de){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",de)}finally{T(!1)}},K=()=>I.jsxs(di,{spacing:4,align:"stretch",w:"100%",children:[I.jsx(Ri,{direction:"column",align:"center",gap:2,children:I.jsx(ft,{fontSize:"2xl",fontWeight:"bold",children:s.Nickname})}),I.jsxs(di,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[I.jsxs(Ri,{direction:"column",children:[I.jsx(ft,{color:"gray.400",fontSize:"sm",children:"Company"}),I.jsx(ft,{children:s.companyName||"Not specified"})]}),I.jsxs(Ri,{direction:"column",children:[I.jsx(ft,{color:"gray.400",fontSize:"sm",children:"Full Name"}),I.jsx(ft,{children:`${s.firstName||""} ${s.lastName||""}`.trim()||"Not specified"})]}),I.jsxs(Ri,{direction:"column",children:[I.jsx(ft,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),I.jsx(ft,{children:s.linkedInProfile||"Not specified"})]})]}),I.jsx(wi,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),ne=()=>I.jsxs(di,{spacing:4,align:"stretch",w:"100%",children:[I.jsxs(Bi,{children:[I.jsx(tc,{color:"gray.400",fontSize:"sm",children:"Nickname"}),I.jsx(Ns,{ref:j,name:"Nickname",value:p.Nickname,onChange:G,onFocus:()=>{A(!0);const de=document.querySelector("#unity-canvas");de&&de.blur()},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),I.jsxs(Bi,{children:[I.jsx(tc,{color:"gray.400",fontSize:"sm",children:"Company Name"}),I.jsx(Ns,{name:"companyName",value:p.companyName,onChange:G,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),I.jsxs(Ri,{gap:4,children:[I.jsxs(Bi,{children:[I.jsx(tc,{color:"gray.400",fontSize:"sm",children:"First Name"}),I.jsx(Ns,{name:"firstName",value:p.firstName,onChange:G,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),I.jsxs(Bi,{children:[I.jsx(tc,{color:"gray.400",fontSize:"sm",children:"Last Name"}),I.jsx(Ns,{name:"lastName",value:p.lastName,onChange:G,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),I.jsxs(Bi,{children:[I.jsx(tc,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),I.jsx(Ns,{name:"linkedInProfile",value:p.linkedInProfile,onChange:G,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),I.jsxs(Ri,{gap:2,justify:"flex-end",mt:2,children:[I.jsx(wi,{onClick:()=>{E({Nickname:(s==null?void 0:s.Nickname)||"",companyName:(s==null?void 0:s.companyName)||"",firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",linkedInProfile:(s==null?void 0:s.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),I.jsx(wi,{onClick:J,colorScheme:"blue",size:"sm",isLoading:v,children:"Save Changes"})]})]});return I.jsxs(oc,{isOpen:n,onClose:B,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[I.jsx(sc,{backdropFilter:"blur(10px)"}),I.jsxs(ac,{bg:"gray.800",color:"white",children:[I.jsx(Ou,{children:"Profile"}),I.jsx(el,{}),I.jsx(ic,{pb:6,children:I.jsxs(di,{spacing:6,children:[I.jsx(Iu,{src:a,size:"2xl",borderRadius:"full"}),l?ne():K()]})})]})]})},bO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},vse=()=>{const{user:n,updateUser:t}=L.useContext(xa),[s,a]=L.useState(!0),{isOpen:l,onOpen:d,onClose:p}=bp();L.useEffect(()=>{const T=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(T)},[]);const E=()=>{p(),t()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null;return s?null:I.jsx(Ri,{align:"center",gap:"4",children:n?I.jsxs(I.Fragment,{children:[I.jsx(b5e,{isOpen:l,onClose:E,user:n,profileImageUrl:v}),I.jsxs(yN,{children:[I.jsx(vN,{as:Ct,cursor:"pointer",children:I.jsx(Ri,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:I.jsxs(Ri,{align:"center",gap:"3",children:[I.jsx(Ct,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:I.jsx(Iu,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),I.jsx(ft,{color:"white",fontWeight:"medium",children:n.Nickname}),I.jsx(Ct,{display:"flex",alignItems:"center",height:"28px",children:I.jsx(JBe,{color:"white",w:4,h:4})})]})})}),I.jsx(Ll,{children:I.jsxs(SN,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[I.jsxs(Ct,{p:4,display:"flex",alignItems:"center",gap:3,children:[I.jsx(Iu,{src:v,size:"md",borderRadius:"full"}),I.jsx(ft,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),I.jsx(vp,{borderColor:"gray.700"}),I.jsx(tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),I.jsx(tg,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),I.jsx(vp,{borderColor:"gray.700"}),I.jsx(tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),I.jsx(tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:I.jsx(C4,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):I.jsxs(I.Fragment,{children:[I.jsx(o1,{mode:"button",label:"Register",buttonProps:{...bO,width:["100%","auto"]},customButton:I.jsxs(wi,{...bO,children:[I.jsx(Ct,{as:"span",fontSize:"xl",children:""}),"Register"]})}),I.jsx(R4,{mode:"button",label:"Sign In",buttonProps:{...bO,width:["100%","auto"]},customButton:I.jsxs(wi,{...bO,children:[I.jsx(Ct,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},tU=document.getElementById("header-auth-root");if(tU){const n=tU.getAttribute("data-theme")||"default",t=()=>{const[s,a]=L.useState(null);return L.useEffect(()=>{yR(n).then(a)},[]),s?I.jsx(gN,{theme:s,children:I.jsx(r1,{children:I.jsx(v4,{children:I.jsx(vse,{})})})}):I.jsx("div",{children:"Loading theme..."})};Jk.createRoot(tU).render(I.jsx(t,{}))}else console.error("Root element 'header-auth-root' not found.");var nU={},aw={},cw={},mJ;function w5e(){if(mJ)return cw;mJ=1,Object.defineProperty(cw,"__esModule",{value:!0}),cw.useUnityCanvasId=void 0;var n=Cu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[s,++t].join("-")},[]);return d};return cw.useUnityCanvasId=a,cw}var sp={},lw={},gJ;function Sse(){if(gJ)return lw;gJ=1,Object.defineProperty(lw,"__esModule",{value:!0}),lw.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(lw.UnityLoaderStatus=n={})),lw}var uw={},_J;function I4(){return _J||(_J=1,Object.defineProperty(uw,"__esModule",{value:!0}),uw.isBrowserEnvironment=void 0,uw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),uw}var EJ;function R5e(){if(EJ)return sp;EJ=1;var n=sp&&sp.__awaiter||function(p,E,v,T){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function F(G){try{B(T.next(G))}catch(J){N(J)}}function j(G){try{B(T.throw(G))}catch(J){N(J)}}function B(G){G.done?A(G.value):w(G.value).then(F,j)}B((T=T.apply(p,E||[])).next())})},t=sp&&sp.__generator||function(p,E){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},T,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(B){return function(G){return j([B,G])}}function j(B){if(T)throw new TypeError("Generator is already executing.");for(;N&&(N=0,B[0]&&(v=0)),v;)try{if(T=1,w&&(A=B[0]&2?w.return:B[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,B[1])).done)return A;switch(w=0,A&&(B=[B[0]&2,A.value]),B[0]){case 0:case 1:A=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){v.label=B[1];break}if(B[0]===6&&v.label<A[1]){v.label=A[1],A=B;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(B);break}A[2]&&v.ops.pop(),v.trys.pop();continue}B=E.call(p,v)}catch(G){B=[6,G],w=0}finally{T=A=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(sp,"__esModule",{value:!0}),sp.useUnityInstance=void 0;var s=Cu(),a=Sse(),l=I4(),d=function(p,E,v,T){(0,s.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==a.UnityLoaderStatus.Loaded||E===null)return T.setUnityInstance(null),T.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,T.setLoadingProgression)];case 2:return w=N.sent(),T.setUnityInstance(w),T.setInitialisationError(null),[3,4];case 3:return A=N.sent(),T.setUnityInstance(null),T.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[p,E,v,T])};return sp.useUnityInstance=d,sp}var dw={},yJ;function C5e(){if(yJ)return dw;yJ=1,Object.defineProperty(dw,"__esModule",{value:!0}),dw.useUnityArguments=void 0;var n=Cu(),t=function(s){return(0,n.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return dw.useUnityArguments=t,dw}var hw={},vJ;function I5e(){if(vJ)return hw;vJ=1,Object.defineProperty(hw,"__esModule",{value:!0}),hw.useUnityLoader=void 0;var n=Cu(),t=I4(),s=Sse(),a=function(l){var d=(0,n.useState)(s.UnityLoaderStatus.Loading),p=d[0],E=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var T=function(w){return E(w.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",T),v.addEventListener("error",T),function(){v!==null&&(v.removeEventListener("load",T),v.removeEventListener("error",T),window.document.body.removeChild(v))}}},[l.loaderUrl]),p};return hw.useUnityLoader=a,hw}var SJ;function A5e(){if(SJ)return aw;SJ=1,Object.defineProperty(aw,"__esModule",{value:!0}),aw.Unity=void 0;var n=Cu(),t=Cu(),s=w5e(),a=R5e(),l=C5e(),d=I5e(),p=(0,t.forwardRef)(function(E,v){var T=(0,t.useRef)(null),w=(0,s.useUnityCanvasId)(E),A=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,T.current,A,E.unityProvider),(0,n.useImperativeHandle)(v,function(){return T.current}),(0,n.createElement)("canvas",{ref:T,id:w,style:E.style,className:E.className,tabIndex:E.tabIndex})});return aw.Unity=p,aw}var op={},fw={},TJ;function Tse(){if(TJ)return fw;TJ=1,Object.defineProperty(fw,"__esModule",{value:!0}),fw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return fw.errorMessages=n,fw}var Z_={},bJ;function P5e(){if(bJ)return Z_;bJ=1;var n=Z_&&Z_.__spreadArray||function(E,v,T){if(T||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(Z_,"__esModule",{value:!0}),Z_.useEventSystem=void 0;var t=Cu(),s=Tse(),a=I4(),l=[],d=function(E){for(var v=[],T=1;T<arguments.length;T++)v[T-1]=arguments[T];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([E],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(A,N){E.current=n(n([],E.current,!0),[{eventName:A,callback:N}],!1)},[E]),T=(0,t.useCallback)(function(A,N){E.current=E.current.filter(function(F){return F.eventName!==A&&F.callback!==N})},[E]),w=(0,t.useCallback)(function(A){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var j=E.current.find(function(B){return B.eventName===A});if(typeof j>"u"){console.warn(s.errorMessages.noEventListener,{eventName:A});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:T}};return Z_.useEventSystem=p,Z_}var pw={},wJ;function O5e(){if(wJ)return pw;wJ=1,Object.defineProperty(pw,"__esModule",{value:!0}),pw.useNullableState=void 0;var n=Cu(),t=function(s){return(0,n.useState)(s||null)};return pw.useNullableState=t,pw}var RJ;function k5e(){if(RJ)return op;RJ=1;var n=op&&op.__awaiter||function(E,v,T,w){function A(N){return N instanceof T?N:new T(function(F){F(N)})}return new(T||(T=Promise))(function(N,F){function j(J){try{G(w.next(J))}catch(K){F(K)}}function B(J){try{G(w.throw(J))}catch(K){F(K)}}function G(J){J.done?N(J.value):A(J.value).then(j,B)}G((w=w.apply(E,v||[])).next())})},t=op&&op.__generator||function(E,v){var T={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=j(0),F.throw=j(1),F.return=j(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function j(G){return function(J){return B([G,J])}}function B(G){if(w)throw new TypeError("Generator is already executing.");for(;F&&(F=0,G[0]&&(T=0)),T;)try{if(w=1,A&&(N=G[0]&2?A.return:G[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,G[1])).done)return N;switch(A=0,N&&(G=[G[0]&2,N.value]),G[0]){case 0:case 1:N=G;break;case 4:return T.label++,{value:G[1],done:!1};case 5:T.label++,A=G[1],G=[0];continue;case 7:G=T.ops.pop(),T.trys.pop();continue;default:if(N=T.trys,!(N=N.length>0&&N[N.length-1])&&(G[0]===6||G[0]===2)){T=0;continue}if(G[0]===3&&(!N||G[1]>N[0]&&G[1]<N[3])){T.label=G[1];break}if(G[0]===6&&T.label<N[1]){T.label=N[1],N=G;break}if(N&&T.label<N[2]){T.label=N[2],T.ops.push(G);break}N[2]&&T.ops.pop(),T.trys.pop();continue}G=v.call(E,T)}catch(J){G=[6,J],A=0}finally{w=N=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(op,"__esModule",{value:!0}),op.useUnityContext=void 0;var s=Cu(),a=Tse(),l=P5e(),d=O5e(),p=function(E){var v=(0,d.useNullableState)(),T=v[0],w=v[1],A=(0,s.useState)(0),N=A[0],F=A[1],j=(0,s.useState)(!1),B=j[0],G=j[1],J=(0,d.useNullableState)(),K=J[0],ne=J[1],de=(0,l.useEventSystem)(),oe=(0,s.useRef)({setLoadingProgression:F,setInitialisationError:ne,setUnityInstance:w,setIsLoaded:G,unityConfig:E}),_e=(0,s.useCallback)(function(he){if(T===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}T.SetFullscreen(he===!0?1:0)},[T]),Z=(0,s.useCallback)(function(){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return T.Module.canvas.requestPointerLock()},[T]),ee=(0,s.useCallback)(function(he,se,Se){if(T===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}T.SendMessage(he,se,Se)},[T]),te=(0,s.useCallback)(function(he,se){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return T.Module.canvas.toDataURL(he,se)},[T]),ce=(0,s.useCallback)(function(){return T===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):T.Quit()},[T]),me=(0,s.useCallback)(function(){return n(void 0,void 0,void 0,function(){var he;return t(this,function(se){switch(se.label){case 0:return T===null||typeof T.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=T.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,ce()]);case 1:return se.sent(),he.remove(),[2]}})})},[T]);return(0,s.useEffect)(function(){G(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:K,isLoaded:B,UNSAFE__unityInstance:T,requestFullscreen:_e,requestPointerLock:Z,sendMessage:ee,takeScreenshot:te,unload:ce,UNSAFE__detachAndUnloadImmediate:me,addEventListener:de.addEventListener,removeEventListener:de.removeEventListener}};return op.useUnityContext=p,op}var CJ;function N5e(){return CJ||(CJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=A5e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=k5e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(nU)),nU}var bse=N5e();const Ca="[UnityProvider]",wse=L.createContext(),D5e=({spaceID:n,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:E,showDisruptiveLogo:v})=>{De.log(`${Ca} Initializing with spaceID:`,n),De.log(`${Ca} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),L.useEffect(()=>{De.log(`${Ca} PERMISSION DEBUG: spaceID value:`,n),De.log(`${Ca} PERMISSION DEBUG: Component props:`,{spaceID:n,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[n,s,a,l,d]);const{unityProvider:T,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:B}=bse.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),G={unityProvider:T,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:F,removeEventListener:j,error:B,spaceID:n};L.useEffect(()=>{De.log(`${Ca} PERMISSION DEBUG: Unity context value:`,G),G.spaceID?De.log(`${Ca} PERMISSION DEBUG: spaceID in context:`,G.spaceID):De.error(`${Ca} PERMISSION DEBUG: spaceID is missing in context!`)},[G]);const J=L.useRef(null),K=L.useRef(Date.now());L.useEffect(()=>{const _e=()=>{document.hidden?(De.log(`${Ca} Page hidden, starting keep-alive`),ne()):(De.log(`${Ca} Page visible, stopping keep-alive`),de())};return document.addEventListener("visibilitychange",_e),()=>{document.removeEventListener("visibilitychange",_e),de()}},[]),L.useEffect(()=>{const _e=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",_e),window.addEventListener("keydown",_e),window.addEventListener("touchstart",_e),()=>{window.removeEventListener("mousemove",_e),window.removeEventListener("keydown",_e),window.removeEventListener("touchstart",_e)}},[N]);const ne=()=>{J.current||(J.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),De.debug(`${Ca} Sent keep-alive message`))},1e4))},de=()=>{J.current&&(clearInterval(J.current),J.current=null)};L.useEffect(()=>(De.log(`${Ca} Component mounted`),()=>{De.log(`${Ca} Component unmounting`),de()}),[]),L.useEffect(()=>{De.log(`${Ca} Loading progress:`,w)},[w]),L.useEffect(()=>{A&&(De.log(`${Ca} Unity instance loaded for:`,n),document.hidden&&ne())},[A,n]),L.useEffect(()=>{B&&De.error(`${Ca} Unity error:`,B)},[B]),De.log(`${Ca} Rendering provider with instance:`,G),L.useEffect(()=>{De.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const oe=[];if(s||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return De.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),I.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[I.jsx("h3",{children:"Unity Build Error"}),I.jsxs("p",{children:["Missing required Unity build URLs: ",oe.join(", ")]}),I.jsx("p",{children:"Please check the space configuration in Firestore."})]});try{return L.useEffect(()=>{De.log("UnityProvider: Unity context created:",T),T?De.log("UnityProvider: Unity provider is available"):De.error("UnityProvider: Unity provider is not available"),A?De.log("UnityProvider: Unity is loaded"):De.log("UnityProvider: Unity is not loaded yet")},[T,A]),I.jsx(wse.Provider,{value:G,children:t})}catch(_e){return De.error("UnityProvider: Error creating Unity context:",_e),I.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[I.jsx("h3",{children:"Unity Error"}),I.jsxs("p",{children:["Error creating Unity context: ",_e.message]}),I.jsx("p",{children:"Please check the console for more details."})]})}},xl=()=>L.useContext(wse),Pg=()=>{const{sendMessage:n,isLoaded:t}=xl(),s=L.useRef([]),a=L.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:p}=s.current.shift();De.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(E){De.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:p});break}}},[n,t]);return L.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),L.useCallback((d,p)=>{De.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:p}),a()},[a])},Dp=()=>{const{addEventListener:n,removeEventListener:t}=xl();return L.useCallback((s,a)=>{const l=d=>{De.log(s+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(E){De.warn("Failed to parse JSON data from Unity message:",E)}a(p)};return n(s,l),()=>{t(s,l)}},[n,t])},L5e=()=>{const[n,t]=L.useState(!1),s=Dp();return L.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{De.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),n},x5e=n=>{const[t,s]=L.useState(null),a=Dp(),{spaceID:l}=xl();return L.useEffect(()=>{let p=!0;const v=a("PlayVideo",async T=>{try{const{gameObjectName:w}=T;if(!w){De.error("Game object name is missing in Unity event data.");return}const A=await lse(l);De.log("SPACES VIDEOS",A);const N=A.find(F=>F.id===w);N&&p?(s(N.url),De.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{p=!1,v()}},[a,l,n]),[t,()=>{s(null)}]},M5e=()=>{const n=Dp(),{sendUserToUnity:t}=L.useContext(xa);return L.useEffect(()=>{const a=n("RequestUserForUnity",()=>{De.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},U5e=()=>{const{spaceID:n}=xl(),t=Pg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){De.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{De.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){De.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}De.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await lse(n),p=async T=>{const w=`https://vimeo.com/api/oembed.json?url=${T}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let B=null;for(let G of j){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${G}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${J}`,K)}}return B||N.thumbnail_url},E=d.map(async T=>{const w=await p(T.url);return{gameObjectName:T.id,thumbnailUrl:w}}),v=await Promise.all(E);De.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:T,thumbnailUrl:w})=>{t("SetThumbnail",{gameObjectName:T,thumbnailUrl:w})})}catch(d){De.error("Error fetching thumbnails:",d)}})()},[t,n,s])},V5e=()=>{const[n,t]=L.useState(null),s=Dp();return console.log(" Nameplate click hook initialized"),L.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof p=="string"?JSON.parse(p):p;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},Rse=()=>{const[n,t]=L.useState([]),s=Dp();return L.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(De.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=F=>{if(a){De.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof F=="object"&&F!==null?j=F.players||[]:j=JSON.parse(F).players||[],Array.isArray(j)){const B=Array.from(new Map(j.map(G=>[G.playerId,G])).values());t(B),l&&(clearTimeout(l),l=null)}}catch(j){De.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{De.log("Player disconnected, requesting fresh player list"),d()},v=()=>{De.log("Player left, requesting fresh player list"),d()};d();const T=s("UpdatePlayerList",p),w=s("PlayerDisconnected",E),A=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof T=="function"&&T(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[s]),n},IJ=async(n,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=WE(),T=Date.now(),w=s.name.split(".").pop(),A=`${t}_${T}.${w}`,N=BE(v,`spaces/${n}/mediaScreens/${A}`);De.log(`Uploading image for media screen ${t} in space ${n}`);const F=await E4(N,s);E=await n1(F.ref);const j=na(Ks,`spaces/${n}/mediaScreens`,t);await NV(j,{imageUrl:E,gsUrl:`gs://${F.ref.bucket}/${F.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){E=p;const v=na(Ks,`spaces/${n}/mediaScreens`,t);await NV(v,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return De.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw De.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},A4=async n=>{De.log(`Getting media screen images for space: ${n}`);try{const t=OR(Ks,`spaces/${n}/mediaScreens`),s=await $k(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw De.error("Error fetching media screen images from Firestore:",t),t}},gp=async(n,t)=>{try{const s=na(Ks,`spaces/${n}/mediaScreens`,t),a=await Tg(s);return a.exists()?{id:a.id,...a.data()}:(De.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw De.error("Error fetching media screen image:",s),s}},F5e=async(n,t)=>{try{const s=await gp(n,t);if(!s)return De.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=WE(),d=BE(l,s.gsUrl);try{await y4(d),De.log(`Deleted file from storage: ${s.gsUrl}`)}catch(p){De.warn(`Could not delete file from storage: ${p.message}`)}}const a=na(Ks,`spaces/${n}/mediaScreens`,t);return s.mediaType==="video"?(await Od(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),De.log(`Successfully removed video for media screen ${t}`)):(await Od(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),De.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw De.error("Error deleting media screen image:",s),s}},j5e=async(n,t,s)=>{try{if(!n||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await gp(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return De.warn(`No media screen content found with ID: ${t} to update`),!1;const l=na(Ks,`spaces/${n}/mediaScreens`,t);return await Od(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),De.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw De.error("Error updating media screen display mode:",a),a}},B5e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},Cse=()=>{const{spaceID:n}=xl(),t=Pg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){De.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{De.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){De.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}De.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await A4(n);De.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:E,imageUrl:v,displayAsVideo:T,videoUrl:w}=p;let A=null;(!T||!w)&&(A=v?B5e(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:A,videoUrl:w||null,displayAsVideo:T||!1,timestamp:Date.now()}),De.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${T})`),T&&w&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),De.log(`Set display mode to video for screen ${E}`))})}catch(d){De.error("Error fetching media screen images:",d)}})()},[t,n,s])},W5e=n=>({opacity:1});function z5e(){const{loadingProgression:n,isLoaded:t,error:s}=xl(),{user:a}=L.useContext(xa),[l,d]=L.useState(!1),[p,E]=L.useState(!1),[v,T]=L.useState(!1),[w,A]=L.useState(!1),N=L.useRef(!1),F=L.useRef(!1),j=L.useRef(null),B=L.useRef(null),G=L.useRef(null),J=Dp(),K=L.useRef(null),ne=L.useRef(null),de=L.useRef(null),oe=L.useRef(null);L.useEffect(()=>{d(!a&&n===0)},[a,n]),L.useEffect(()=>{const ee=document.createElement("style");return ee.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(ee),K.current=ee,()=>{K.current&&document.head.removeChild(K.current)}},[]),L.useEffect(()=>{const ee=()=>{const te=document.getElementById("unity-canvas"),ce=document.getElementById("unity-container");te&&(j.current=te,console.log("LoaderProgress: Found Unity canvas"),te.style.zIndex="1"),ce&&(B.current=ce,console.log("LoaderProgress: Found Unity container"),ce.style.zIndex="1"),te&&ce&&de.current&&(clearInterval(de.current),de.current=null)};return ee(),de.current=setInterval(ee,100),()=>{de.current&&(clearInterval(de.current),de.current=null)}},[]),L.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),F.current=!0,A(!0));const te=J("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0}),ce=setTimeout(()=>{F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{te(),clearTimeout(ce)}},[J]),L.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0));const ee=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",ee);const te=J("PlayerInstantiated",ee),ce=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),F.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",ee),te(),clearTimeout(ce)}},[J]),L.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),G.current&&(G.current.style.opacity="0",G.current.style.pointerEvents="none",setTimeout(()=>{G.current&&(G.current.style.display="none")},1500))},2e3)),()=>{ne.current&&clearTimeout(ne.current)}),[w,v]),L.useEffect(()=>(oe.current=setInterval(()=>{var ee,te;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:F.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(ee=j.current)==null?void 0:ee.style.zIndex,loaderZIndex:(te=G.current)==null?void 0:te.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[t]),L.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[t,w,v,n]);const _e=()=>t?t&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",Z=()=>t?t&&!w&&!v?85:w&&!v?95:100:n*80;return I.jsx(I.Fragment,{children:l?I.jsx(Ct,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:I.jsxs(di,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[I.jsx(ft,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),I.jsx(ft,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),I.jsx(wi,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):I.jsx(Ct,{ref:G,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:I.jsxs(Ri,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[I.jsx(ft,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),I.jsx(ft,{fontSize:"sm",children:_e()}),I.jsx(u0,{value:Z(),size:"lg",width:"100%",marginY:2})]})})})}function G5e(){const{user:n}=L.useContext(xa);return I.jsx("div",{children:n!==null?I.jsx("div",{children:I.jsx(C4,{})}):I.jsxs("div",{children:[I.jsx(o1,{}),I.jsx(R4,{})]})})}function H5e(){const{fullscreenRef:n}=Nd(),[t,s]=L.useState(!1),a=()=>{s(!t)};return I.jsxs(I.Fragment,{children:[I.jsx(sg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:I.jsx(Oa,{"aria-label":"Controller Help",icon:I.jsx(e5e,{}),onClick:a,variant:"iconButton"})}),I.jsxs(oc,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[I.jsx(sc,{}),I.jsxs(ac,{children:[I.jsx(Ou,{children:"Notes"}),I.jsx(el,{}),I.jsx(ic,{children:I.jsx(ft,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),I.jsx(l0,{children:I.jsx(wi,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Ise={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},AJ=ti.createContext&&ti.createContext(Ise),dg=function(){return dg=Object.assign||function(n){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},dg.apply(this,arguments)},$5e=function(n,t){var s={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(s[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(s[a[l]]=n[a[l]]);return s};function Ase(n){return n&&n.map(function(t,s){return ti.createElement(t.tag,dg({key:s},t.attr),Ase(t.child))})}function Ur(n){return function(t){return ti.createElement(K5e,dg({attr:dg({},n.attr)},t),Ase(n.child))}}function K5e(n){var t=function(s){var a=n.attr,l=n.size,d=n.title,p=$5e(n,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),n.className&&(v=(v?v+" ":"")+n.className),ti.createElement("svg",dg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,p,{className:v,style:dg(dg({color:n.color||s.color},s.style),n.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&ti.createElement("title",null,d),n.children)};return AJ!==void 0?ti.createElement(AJ.Consumer,null,function(s){return t(s)}):t(Ise)}function Pse(n){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function q5e(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function xV(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function Y5e(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function X5e(n){return Ur({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function J5e(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Ose(n){return Ur({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function Q5e(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function Z5e(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function MV(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function UV(n){return Ur({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function e6e(n){return Ur({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function t6e(n){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function n6e(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function VV(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function r6e(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function i6e(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function s6e(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function o6e(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function kse({open:n,onClose:t}){const s=L.useRef(null),a=Pg(),{user:l}=L.useContext(xa),d=v=>{s.current&&!s.current.contains(v.target)&&t()},p=async v=>{const T=E(v);if((T==null?void 0:T.source)==="readyplayerme"&&(T.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),T.eventName==="v1.avatar.exported")){const w=T.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Hie(l.uid,w),t()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return L.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&I.jsx(Ll,{children:I.jsx(Ct,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:I.jsx(Ct,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:I.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function a6e({isOpen:n,onClose:t}){const[s,a]=L.useState(!1),[l,d]=L.useState(null),{user:p}=L.useContext(xa),E=Pg(),v=j=>{j.stopPropagation(),a(!0)},T=()=>{a(!1),t()},w=async j=>{if(d(j),p&&p.uid)try{await Hie(p.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},A=lCe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return I.jsxs(I.Fragment,{children:[I.jsx(Ll,{children:I.jsxs(oc,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[I.jsx(sc,{bg:"rgba(0, 0, 0, 0.7)"}),I.jsxs(ac,{bg:"gray.800",color:"white",maxW:"900px",children:[I.jsx(Ou,{fontSize:"lg",children:"Customise Your Avatar"}),I.jsx(el,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),I.jsx(ic,{pb:4,children:I.jsxs(di,{spacing:4,align:"stretch",children:[I.jsx(ft,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),I.jsxs(Nte,{columns:5,spacing:2,children:[I.jsx(Ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:I.jsxs(di,{spacing:1,children:[I.jsx(Hn,{as:t6e,boxSize:4}),I.jsx(ft,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(j=>I.jsxs(Ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[I.jsx(Fh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),I.jsx(Ct,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:I.jsx(ft,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),s&&I.jsx(kse,{open:s,onClose:T})]})}function c6e(){const{fullscreenRef:n}=Nd(),[t,s]=L.useState(!1),[a,l]=L.useState(!1),[d,p]=L.useState(!1),[E,v]=L.useState(!1),{user:T}=L.useContext(xa),[w,A]=L.useState(null),[N,F]=L.useState(!0),j=(K,ne)=>!K||!ne?"?":`${K.charAt(0)}${ne.charAt(0)}`.toUpperCase(),B=async()=>{if(T!=null&&T.uid){F(!0);try{const K=await nf(T.uid);A({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{F(!1)}}};L.useEffect(()=>{B()},[T==null?void 0:T.uid]),L.useEffect(()=>{const K=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const G=()=>l(!a),J=()=>{l(!1),B()};return t?I.jsxs(I.Fragment,{children:[I.jsx(sg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:n},children:I.jsxs(Ct,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:G,children:[I.jsx(Iu,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&I.jsx(Ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:I.jsx(ft,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),I.jsx(a6e,{isOpen:a,onClose:J})]}):null}function l6e(n){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function u6e(n){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function d6e(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Nd(),l=kd();L.useEffect(()=>{const p=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return I.jsx(sg,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:I.jsx(Oa,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?I.jsx(l6e,{}):I.jsx(u6e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const PJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function h6e(){const{isOpen:n,onOpen:t,onClose:s}=bp(),{fullscreenRef:a}=Nd(),[l,d]=x5e(!1);L.useEffect(()=>{De.log("VideoPlayer: Current video URL:",l),l&&(De.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const p=()=>{De.log("VideoPlayer: Closing modal"),d(),s()};return I.jsx(Ll,{containerRef:a,children:I.jsxs(oc,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[I.jsx(sc,{bg:"rgba(0, 0, 0, 0.8)"}),I.jsxs(ac,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[I.jsx(el,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),I.jsx(ic,{p:0,width:"100%",children:l&&I.jsx(Ct,{style:PJ.iframeContainer,children:I.jsx("iframe",{src:l,style:PJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function f6e({isOpen:n,onClose:t,playerName:s,playerId:a,uid:l}){const[d,p]=L.useState(null),[E,v]=L.useState(!0),[T,w]=L.useState(null);return L.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){De.warn("NameplateModal: No UID provided for player:",s),w("No user ID available for this player"),v(!1);return}try{De.log("NameplateModal: Fetching profile for UID:",l);const N=await nf(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){De.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,s]),I.jsxs(oc,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[I.jsx(sc,{backdropFilter:"blur(10px)"}),I.jsxs(ac,{bg:"gray.900",color:"white",borderRadius:"xl",children:[I.jsx(Ou,{children:"Player Info"}),I.jsx(el,{}),I.jsx(ic,{pb:6,children:E?I.jsx(qee,{py:8,children:I.jsx(kp,{size:"xl",color:"blue.400"})}):T?I.jsxs(n0,{status:"warning",variant:"solid",borderRadius:"md",children:[I.jsx(r0,{}),T]}):I.jsxs(di,{spacing:4,align:"center",children:[I.jsx(Iu,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),I.jsxs(di,{spacing:1,children:[I.jsx(ft,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&I.jsxs(ft,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),I.jsxs(ft,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&I.jsxs(I.Fragment,{children:[I.jsx(vp,{borderColor:"whiteAlpha.300"}),I.jsxs(Ai,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&I.jsx(Zh,{href:d.linkedinUrl,isExternal:!0,children:I.jsx(Oa,{icon:I.jsx(Pse,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&I.jsx(Zh,{href:d.websiteUrl,isExternal:!0,children:I.jsx(Oa,{icon:I.jsx(Ose,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const p6e=({isVisible:n,onToggleVisibility:t,spaceID:s})=>{const a=Rse(),[l,d]=L.useState(!1),[p,E]=L.useState([]),[v,T]=L.useState(!1),[w,A]=L.useState({}),[N,F]=L.useState({}),[j,B]=L.useState(null),[G,J]=L.useState(!1),K=kd(),ne=window.currentUser||{},oe=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const Se=(window.location.pathname||"").split("/"),Ve=Se[Se.length-1];if(Ve&&Ve.length>5)return Ve;const tt=document.body.getAttribute("data-space-id");if(tt)return tt;const ke=localStorage.getItem("currentSpaceId");return ke||"fallback-space-id"})();L.useEffect(()=>{(async()=>{try{const Ve=await ug(oe);Ve&&Ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),J(!0)):J(!1)}catch(Ve){console.error("UnityPlayerList: Error checking if voice is disabled:",Ve)}})();const Se=Ve=>{Ve.detail&&typeof Ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",Ve.detail.voiceDisabled),J(Ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Se),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Se)}},[oe]),L.useEffect(()=>{const se={};a.forEach(Se=>{if(Se.uid){if(Se.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)se[Se.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ve=window.agoraClient.client.remoteUsers,tt=Ve.find(ke=>String(ke.uid)===String(Se.uid));if(tt)se[Se.uid]=tt.uid;else{const ke=Ve.find(Me=>typeof Me.uid=="string"&&Me.uid.includes(Se.uid));if(ke)se[Se.uid]=ke.uid;else{const Me=Ve.find(Ce=>typeof Se.uid=="string"&&Se.uid.includes(String(Ce.uid)));if(Me)se[Se.uid]=Me.uid;else{const Ce=Ve.filter(Xe=>!(typeof Xe.uid=="string"&&Xe.uid.startsWith("screen-")));Ce.length===1&&!Se.isLocalPlayer&&(se[Se.uid]=Ce[0].uid)}}}}}}),F(se)},[a]);const _e=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const se=window.agoraClient.isVoiceEnabled;se!==v&&T(se)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const se=window.agoraClient.client.remoteUsers,Se={};se.forEach(Ve=>{typeof Ve.uid=="string"&&Ve.uid.startsWith("screen-")||(Se[Ve.uid]=!!Ve.audioTrack&&!Ve.audioTrack.muted)}),JSON.stringify(Se)!==JSON.stringify(w)&&A(Se)}};L.useEffect(()=>{const se=setInterval(_e,500),Se=Ve=>{Ve.detail&&typeof Ve.detail.enabled=="boolean"&&T(Ve.detail.enabled)};return window.addEventListener("VoiceToggled",Se),_e(),()=>{clearInterval(se),window.removeEventListener("VoiceToggled",Se)}},[]),L.useEffect(()=>{const se=()=>{De.log("UnityPlayerList: Player instantiated, showing list"),d(!0)};return window.addEventListener("PlayerInstantiated",se),window.isPlayerInstantiated&&(De.log("UnityPlayerList: Player was already instantiated"),d(!0)),()=>{window.removeEventListener("PlayerInstantiated",se)}},[]),L.useEffect(()=>{(async()=>{const Se=await Promise.all(a.map(async Ve=>{if(Ve.uid)try{const tt=await nf(Ve.uid);let ke=null;if(tt.groups){const Me=`space_${oe}_owners`,Ce=`space_${oe}_hosts`;tt.groups.includes(Me)?ke="owner":tt.groups.includes(Ce)&&(ke="host")}return te({uid:Ve.uid})&&B(ke),{...Ve,firstName:tt.firstName,lastName:tt.lastName,linkedInProfile:tt.linkedInProfile,websiteUrl:tt.websiteUrl,rpmURL:tt.rpmURL?tt.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:ke}}catch(tt){return De.error(`Error fetching data for player ${Ve.playerName}:`,tt),Ve}return Ve}));E(Se)})()},[a,oe]);const Z=[...p].sort((se,Se)=>se.isLocalPlayer?-1:Se.isLocalPlayer?1:0),ee=()=>{De.log("UnityPlayerList: Toggling visibility"),t&&t()},te=se=>!!(se.isLocalPlayer||ne&&ne.uid&&se.uid===ne.uid),ce=se=>{try{if(te(se))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:v;if(se.uid){if(w[se.uid])return!0;const Se=N[se.uid];if(Se&&w[Se])return!0;const Ve=parseInt(se.uid);if(!isNaN(Ve)&&w[Ve])return!0}return!1}catch(Se){return console.error("Error in hasActiveMic:",Se),!1}},me=({player:se})=>{const Se=se.role;return Se==="owner"?I.jsxs(Ai,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[I.jsx(Hn,{as:xV,color:"green.400",boxSize:5}),I.jsx(hp,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Se==="host"?I.jsxs(Ai,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[I.jsx(Hn,{as:VV,color:"purple.400",boxSize:5}),I.jsx(hp,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},he=(se,Se)=>{switch(console.log(`Action "${se}" performed on player: ${Se.playerName}`),se){case"mute":K({title:"Player Muted",description:`${Se.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":K({title:"Player Kicked",description:`${Se.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":K({title:"Player Promoted",description:`${Se.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return I.jsxs(Ct,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:l&&n?"visible":"hidden",role:"group",children:[I.jsx(Ct,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:I.jsx(Oa,{icon:I.jsx(ZBe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:ee,_hover:{opacity:.8}})}),I.jsxs(ft,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",a.length]}),I.jsx(Ct,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:I.jsx(di,{align:"stretch",spacing:1,width:"100%",children:Z.map((se,Se)=>{const Ve=te(se),tt=!G&&ce(se);return I.jsx(Ct,{children:I.jsxs(one,{placement:"left",trigger:"hover",children:[I.jsx(dne,{children:I.jsxs(Ai,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[I.jsx(Iu,{size:"xs",src:se.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),I.jsx(ft,{fontSize:"xs",children:se.playerName}),se.role==="owner"&&I.jsx(Hn,{as:xV,color:"green.400",boxSize:2.5}),se.role==="host"&&I.jsx(Hn,{as:VV,color:"purple.400",boxSize:2.5}),I.jsx(Ck,{}),j==="owner"&&I.jsxs(yN,{closeOnSelect:!0,placement:"bottom-end",children:[I.jsx(vN,{as:Oa,"aria-label":"Options",icon:I.jsx(X5e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:ke=>ke.stopPropagation()}),I.jsxs(SN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[I.jsx(tg,{icon:I.jsx(o6e,{}),onClick:()=>he("mute",se),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:G,children:"Mute Player"}),I.jsx(tg,{icon:I.jsx(r6e,{}),onClick:()=>he("promote",se),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),I.jsx($te,{borderColor:"whiteAlpha.300"}),I.jsx(tg,{icon:I.jsx(q5e,{}),onClick:()=>he("kick",se),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!G&&(tt?I.jsx(Ct,{color:"green.400",children:I.jsx(UV,{})}):I.jsx(Ct,{color:"red.400",children:I.jsx(MV,{})})),Ve&&I.jsx(ft,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),I.jsx(une,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:I.jsx(cne,{children:I.jsxs(di,{align:"center",spacing:3,children:[I.jsx(Iu,{size:"xl",src:se.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),I.jsx(ft,{fontSize:"xl",fontWeight:"bold",children:se.playerName}),I.jsx(me,{player:se}),se.firstName&&I.jsxs(ft,{fontSize:"sm",color:"gray.300",children:[se.firstName," ",se.lastName]}),I.jsxs(Ai,{spacing:4,pt:2,children:[se.linkedInProfile&&I.jsx(Zh,{href:se.linkedInProfile,isExternal:!0,children:I.jsx(Oa,{icon:I.jsx(Pse,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),se.websiteUrl&&I.jsx(Zh,{href:se.websiteUrl,isExternal:!0,children:I.jsx(Oa,{icon:I.jsx(Ose,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!G&&I.jsx(Oa,{icon:tt?I.jsx(UV,{}):I.jsx(MV,{}),variant:"ghost",colorScheme:tt?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),G&&I.jsx(Oa,{icon:I.jsx(s6e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Se)})})})]})};var ck={exports:{}},m6e=ck.exports,OJ;function g6e(){return OJ||(OJ=1,function(n,t){(function(s,a){n.exports=a()})(m6e,function(){function s(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof oE<"u"?oE:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},p=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=p,v=Function.prototype,T=v.call,w=E&&v.bind.bind(T,T),A=E?w:function(e){return function(){return T.apply(e,arguments)}},N=A({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},j=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=p,G=Function.prototype,J=G.apply,K=G.call,ne=typeof Reflect=="object"&&Reflect.apply||(B?K.bind(J):function(){return K.apply(J,arguments)}),de=A,oe=de({}.toString),_e=de("".slice),Z=function(e){return _e(oe(e),8,-1)},ee=Z,te=A,ce=function(e){if(ee(e)==="Function")return te(e)},me=typeof document=="object"&&document.all,he={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},se=he.all,Se=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===se}:function(e){return typeof e=="function"},Ve={},tt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ke=p,Me=Function.prototype.call,Ce=ke?Me.bind(Me):function(){return Me.apply(Me,arguments)},Xe={},Ae={}.propertyIsEnumerable,Ie=Object.getOwnPropertyDescriptor,be=Ie&&!Ae.call({1:2},1);Xe.f=be?function(e){var r=Ie(this,e);return!!r&&r.enumerable}:Ae;var xe,We,Qe=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},Ze=d,ut=Z,it=Object,It=A("".split),yn=Ze(function(){return!it("z").propertyIsEnumerable(0)})?function(e){return ut(e)=="String"?It(e,""):it(e)}:it,Vt=function(e){return e==null},ln=Vt,xn=TypeError,Qt=function(e){if(ln(e))throw xn("Can't call method on "+e);return e},Ot=yn,Dt=Qt,ve=function(e){return Ot(Dt(e))},Ue=Se,He=he.all,_t=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Ue(e)||e===He}:function(e){return typeof e=="object"?e!==null:Ue(e)},vt={},St=vt,zt=j,dn=Se,fn=function(e){return dn(e)?e:void 0},Xt=function(e,r){return arguments.length<2?fn(St[e])||fn(zt[e]):St[e]&&St[e][r]||zt[e]&&zt[e][r]},Bn=typeof navigator<"u"&&String(navigator.userAgent)||"",cc=j,jt=Bn,an=cc.process,Zi=cc.Deno,Ms=an&&an.versions||Zi&&Zi.version,qs=Ms&&Ms.v8;qs&&(We=(xe=qs.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!We&&jt&&(!(xe=jt.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=jt.match(/Chrome\/(\d+)/))&&(We=+xe[1]);var hi=We,Ma=hi,tl=d,lo=j.String,uo=!!Object.getOwnPropertySymbols&&!tl(function(){var e=Symbol();return!lo(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ma&&Ma<41}),Ml=uo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Us=Xt,lc=Se,ra=N,uc=Object,nl=Ml?function(e){return typeof e=="symbol"}:function(e){var r=Us("Symbol");return lc(r)&&ra(r.prototype,uc(e))},Nu=String,dc=function(e){try{return Nu(e)}catch{return"Object"}},rl=Se,Co=dc,ki=TypeError,as=function(e){if(rl(e))return e;throw ki(Co(e)+" is not a function")},Ua=as,Du=Vt,hc=function(e,r){var i=e[r];return Du(i)?void 0:Ua(i)},ia=Ce,sa=Se,Ld=_t,Og=TypeError,Lu={exports:{}},af=j,Vs=Object.defineProperty,xu=function(e,r){try{Vs(af,e,{value:r,configurable:!0,writable:!0})}catch{af[e]=r}return r},oa="__core-js_shared__",xd=j[oa]||xu(oa,{}),Md=xd;(Lu.exports=function(e,r){return Md[e]||(Md[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Va=Lu.exports,Ud=Qt,Mu=Object,Io=function(e){return Mu(Ud(e))},Vd=Io,Vr=A({}.hasOwnProperty),fi=Object.hasOwn||function(e,r){return Vr(Vd(e),r)},fc=A,il=0,aa=Math.random(),cf=fc(1 .toString),Fd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+cf(++il+aa,36)},Ul=Va,ho=fi,Lp=Fd,Ys=uo,lf=Ml,sl=j.Symbol,jd=Ul("wks"),Bd=lf?sl.for||sl:sl&&sl.withoutSetter||Lp,ur=function(e){return ho(jd,e)||(jd[e]=Ys&&ho(sl,e)?sl[e]:Bd("Symbol."+e)),jd[e]},Vl=Ce,Fl=_t,Uu=nl,Fa=hc,Ao=function(e,r){var i,o;if(sa(i=e.toString)&&!Ld(o=ia(i,e))||sa(i=e.valueOf)&&!Ld(o=ia(i,e)))return o;throw Og("Can't convert object to primitive value")},Vu=TypeError,ol=ur("toPrimitive"),jl=function(e,r){if(!Fl(e)||Uu(e))return e;var i,o=Fa(e,ol);if(o){if(i=Vl(o,e,r),!Fl(i)||Uu(i))return i;throw Vu("Can't convert object to primitive value")}return Ao(e)},Wr=nl,ja=function(e){var r=jl(e,"string");return Wr(r)?r:r+""},rr=_t,pc=j.document,xp=rr(pc)&&rr(pc.createElement),Bl=function(e){return xp?pc.createElement(e):{}},Wd=Bl,uf=!tt&&!d(function(){return Object.defineProperty(Wd("div"),"a",{get:function(){return 7}}).a!=7}),Mp=tt,df=Ce,Po=Xe,es=Qe,Oo=ve,ko=ja,Wl=fi,No=uf,Do=Object.getOwnPropertyDescriptor;Ve.f=Mp?Do:function(e,r){if(e=Oo(e),r=ko(r),No)try{return Do(e,r)}catch{}if(Wl(e,r))return es(!df(Po.f,e,r),e[r])};var Up=d,mc=Se,cs=/#|\.prototype\./,Fu=function(e,r){var i=al[hf(e)];return i==Vp||i!=zl&&(mc(r)?Up(r):!!r)},hf=Fu.normalize=function(e){return String(e).replace(cs,".").toLowerCase()},al=Fu.data={},zl=Fu.NATIVE="N",Vp=Fu.POLYFILL="P",ca=Fu,la=as,cl=p,ye=ce(ce.bind),Oe=function(e,r){return la(e),r===void 0?e:cl?ye(e,r):function(){return e.apply(r,arguments)}},et={},qt=tt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Kn=_t,mr=String,Fr=TypeError,cn=function(e){if(Kn(e))return e;throw Fr(mr(e)+" is not an object")},kr=tt,pi=uf,Rs=qt,Lo=cn,xo=ja,ju=TypeError,Hi=Object.defineProperty,ll=Object.getOwnPropertyDescriptor,zd="enumerable",gc="configurable",kg="writable";et.f=kr?Rs?function(e,r,i){if(Lo(e),r=xo(r),Lo(i),typeof e=="function"&&r==="prototype"&&"value"in i&&kg in i&&!i[kg]){var o=ll(e,r);o&&o[kg]&&(e[r]=i.value,i={configurable:gc in i?i[gc]:o[gc],enumerable:zd in i?i[zd]:o[zd],writable:!1})}return Hi(e,r,i)}:Hi:function(e,r,i){if(Lo(e),r=xo(r),Lo(i),pi)try{return Hi(e,r,i)}catch{}if("get"in i||"set"in i)throw ju("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var Fp=et,Bu=Qe,Mo=tt?function(e,r,i){return Fp.f(e,r,Bu(1,i))}:function(e,r,i){return e[r]=i,e},Gl=j,jp=ne,Ng=ce,zE=Se,Bp=Ve.f,Wp=ca,Wu=vt,zu=Oe,Gu=Mo,Dg=fi,GE=function(e){var r=function(i,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return jp(e,this,arguments)};return r.prototype=e.prototype,r},Mn=function(e,r){var i,o,c,u,h,m,_,y,S,R=e.target,P=e.global,k=e.stat,z=e.proto,U=P?Gl:k?Gl[R]:(Gl[R]||{}).prototype,V=P?Wu:Wu[R]||Gu(Wu,R,{})[R],q=V.prototype;for(u in r)o=!(i=Wp(P?u:R+(k?".":"#")+u,e.forced))&&U&&Dg(U,u),m=V[u],o&&(_=e.dontCallGetSet?(S=Bp(U,u))&&S.value:U[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(y=e.bind&&o?zu(h,Gl):e.wrap&&o?GE(h):z&&zE(h)?Ng(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Gu(y,"sham",!0),Gu(V,u,y),z&&(Dg(Wu,c=R+"Prototype")||Gu(Wu,c,{}),Gu(Wu[c],u,h),e.real&&q&&(i||!q[u])&&Gu(q,u,h)))},zp=Math.ceil,Uo=Math.floor,HE=Math.trunc||function(e){var r=+e;return(r>0?Uo:zp)(r)},$E=HE,_c=function(e){var r=+e;return r!=r||r===0?0:$E(r)},C=_c,W=Math.max,Q=Math.min,fe=function(e,r){var i=C(e);return i<0?W(i+r,0):Q(i,r)},$e=_c,ot=Math.min,xt=function(e){return e>0?ot($e(e),9007199254740991):0},zr=xt,ri=function(e){return zr(e.length)},gr=ve,Fs=fe,ls=ri,Ba=function(e){return function(r,i,o){var c,u=gr(r),h=ls(u),m=Fs(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Vo={includes:Ba(!0),indexOf:Ba(!1)},ff=Vo.includes;Mn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return ff(this,e,arguments.length>1?arguments[1]:void 0)}});var Gp=vt,Wa=function(e){return Gp[e+"Prototype"]},lC=Wa("Array").includes,uC=_t,Hp=Z,c1=ur("match"),dC=function(e){var r;return uC(e)&&((r=e[c1])!==void 0?!!r:Hp(e)=="RegExp")},l1=dC,hC=TypeError,L0={};L0[ur("toStringTag")]="z";var pf=String(L0)==="[object z]",Lg=pf,u1=Se,mf=Z,d1=ur("toStringTag"),fC=Object,x0=mf(function(){return arguments}())=="Arguments",Ec=Lg?mf:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(r=fC(e),d1))=="string"?i:x0?mf(r):(o=mf(r))=="Object"&&u1(r.callee)?"Arguments":o},pC=Ec,mC=String,ua=function(e){if(pC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return mC(e)},h1=ur("match"),f1=Mn,p1=function(e){if(l1(e))throw hC("The method doesn't accept regular expressions");return e},m1=Qt,gC=ua,ul=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[h1]=!1,"/./"[e](r)}catch{}}return!1},xg=A("".indexOf);f1({target:"String",proto:!0,forced:!ul("includes")},{includes:function(e){return!!~xg(gC(m1(this)),gC(p1(e)),arguments.length>1?arguments[1]:void 0)}});var _C=Wa("String").includes,M0=N,EC=lC,yC=_C,Mg=Array.prototype,U0=String.prototype,g1=function(e){var r=e.includes;return e===Mg||M0(Mg,e)&&r===Mg.includes?EC:typeof e=="string"||e===U0||M0(U0,e)&&r===U0.includes?yC:r},st=l(g1),V0=as,Ug=Io,F0=yn,vC=ri,KE=TypeError,$p=function(e){return function(r,i,o,c){V0(i);var u=Ug(r),h=F0(u),m=vC(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw KE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},j0={left:$p(!1)},SC=d,gf=function(e,r){var i=[][e];return!!i&&SC(function(){i.call(null,r||function(){return 1},1)})},_f=typeof process<"u"&&Z(process)=="process",TC=j0.left;Mn({target:"Array",proto:!0,forced:!_f&&hi>79&&hi<83||!gf("reduce")},{reduce:function(e){var r=arguments.length;return TC(this,e,r,r>1?arguments[1]:void 0)}});var bC=Wa("Array").reduce,wC=N,RC=bC,qE=Array.prototype,Gd=function(e){var r=e.reduce;return e===qE||wC(qE,e)&&r===qE.reduce?RC:r},YE=Gd,za=l(YE),_1=Z,Vg=Array.isArray||function(e){return _1(e)=="Array"},Fg=Mn,E1=Vg,CC=A([].reverse),B0=[1,2];Fg({target:"Array",proto:!0,forced:String(B0)===String(B0.reverse())},{reverse:function(){return E1(this)&&(this.length=this.length),CC(this)}});var vi=Wa("Array").reverse,W0=N,XE=vi,Ef=Array.prototype,IC=function(e){var r=e.reverse;return e===Ef||W0(Ef,e)&&r===Ef.reverse?XE:r},JE=IC,Kp=l(JE),QE=Fd,yf=Va("keys"),jg=function(e){return yf[e]||(yf[e]=QE(e))},y1=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),v1=fi,AC=Se,ZE=Io,ey=y1,ty=jg("IE_PROTO"),Bg=Object,z0=Bg.prototype,Wg=ey?Bg.getPrototypeOf:function(e){var r=ZE(e);if(v1(r,ty))return r[ty];var i=r.constructor;return AC(i)&&r instanceof i?i.prototype:r instanceof Bg?z0:null},S1=A,PC=as,T1=Se,b1=String,G0=TypeError,Hd=function(e,r,i){try{return S1(PC(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},OC=cn,qp=function(e){if(typeof e=="object"||T1(e))return e;throw G0("Can't set "+b1(e)+" as a prototype")},Hl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=Hd(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,c){return OC(o),qp(c),r?e(o,c):o.__proto__=c,o}}():void 0),$d={},yc={},zg=fi,w1=ve,R1=Vo.indexOf,vf=yc,Yp=A([].push),Sf=function(e,r){var i,o=w1(e),c=0,u=[];for(i in o)!zg(vf,i)&&zg(o,i)&&Yp(u,i);for(;r.length>c;)zg(o,i=r[c++])&&(~R1(u,i)||Yp(u,i));return u},Xp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],H0=Sf,Jp=Xp.concat("length","prototype");$d.f=Object.getOwnPropertyNames||function(e){return H0(e,Jp)};var vc={};vc.f=Object.getOwnPropertySymbols;var Si=Xt,mi=$d,Kd=vc,fo=cn,da=A([].concat),Tf=Si("Reflect","ownKeys")||function(e){var r=mi.f(fo(e)),i=Kd.f;return i?da(r,i(e)):r},bf=fi,ha=Tf,ny=Ve,kC=et,ry={},iy=Sf,NC=Xp,Sc=Object.keys||function(e){return iy(e,NC)},sy=tt,$0=qt,DC=et,C1=cn,qd=ve,Qp=Sc;ry.f=sy&&!$0?Object.defineProperties:function(e,r){C1(e);for(var i,o=qd(r),c=Qp(r),u=c.length,h=0;u>h;)DC.f(e,i=c[h++],o[i]);return e};var Hu,Gg=Xt("document","documentElement"),oy=cn,Tc=ry,Ga=Xp,wf=yc,$u=Gg,Ku=Bl,qu="prototype",ay="script",cy=jg("IE_PROTO"),Hg=function(){},fa=function(e){return"<"+ay+">"+e+"</"+ay+">"},pa=function(e){e.write(fa("")),e.close();var r=e.parentWindow.Object;return e=null,r},ii=function(){try{Hu=new ActiveXObject("htmlfile")}catch{}var e,r,i;ii=typeof document<"u"?document.domain&&Hu?pa(Hu):(r=Ku("iframe"),i="java"+ay+":",r.style.display="none",$u.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(fa("document.F=Object")),e.close(),e.F):pa(Hu);for(var o=Ga.length;o--;)delete ii[qu][Ga[o]];return ii()};wf[cy]=!0;var Fo=Object.create||function(e,r){var i;return e!==null?(Hg[qu]=oy(e),i=new Hg,Hg[qu]=null,i[cy]=e):i=ii(),r===void 0?i:Tc.f(i,r)},LC=_t,xC=Mo,ly=Error,K0=A("".replace),MC=String(ly("zxcasd").stack),$g=/\n\s*at [^:]*:[^\n]*/,UC=$g.test(MC),Zp=Qe,q0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Zp(1,7)),e.stack!==7)}),I1=Mo,Kg=function(e,r){if(UC&&typeof e=="string"&&!ly.prepareStackTrace)for(;r--;)e=K0(e,$g,"");return e},uy=q0,Y0=Error.captureStackTrace,Yd={},em=Yd,VC=ur("iterator"),dy=Array.prototype,qg=function(e){return e!==void 0&&(em.Array===e||dy[VC]===e)},tm=Ec,hy=hc,X0=Vt,J0=Yd,Q0=ur("iterator"),Yu=function(e){if(!X0(e))return hy(e,Q0)||hy(e,"@@iterator")||J0[tm(e)]},bc=Ce,Rf=as,Z0=cn,FC=dc,Xu=Yu,Xd=TypeError,Yg=function(e,r){var i=arguments.length<2?Xu(e):r;if(Rf(i))return Z0(bc(i,e));throw Xd(FC(e)+" is not iterable")},jC=Ce,$l=cn,Jd=hc,Xg=function(e,r,i){var o,c;$l(e);try{if(!(o=Jd(e,"return"))){if(r==="throw")throw i;return i}o=jC(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw i;if(c)throw o;return $l(o),i},BC=Oe,fy=Ce,WC=cn,Jg=dc,Kl=qg,Qg=ri,nm=N,Cf=Yg,eT=Yu,If=Xg,zC=TypeError,rm=function(e,r){this.stopped=e,this.result=r},Ci=rm.prototype,Qd=function(e,r,i){var o,c,u,h,m,_,y,S=i&&i.that,R=!(!i||!i.AS_ENTRIES),P=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),z=!(!i||!i.INTERRUPTED),U=BC(r,S),V=function(Y){return o&&If(o,"normal",Y),new rm(!0,Y)},q=function(Y){return R?(WC(Y),z?U(Y[0],Y[1],V):U(Y[0],Y[1])):z?U(Y,V):U(Y)};if(P)o=e.iterator;else if(k)o=e;else{if(!(c=eT(e)))throw zC(Jg(e)+" is not iterable");if(Kl(c)){for(u=0,h=Qg(e);h>u;u++)if((m=q(e[u]))&&nm(Ci,m))return m;return new rm(!1)}o=Cf(e,c)}for(_=P?e.next:o.next;!(y=fy(_,o)).done;){try{m=q(y.value)}catch(Y){If(o,"throw",Y)}if(typeof m=="object"&&m&&nm(Ci,m))return m}return new rm(!1)},tT=ua,nT=Mn,py=N,rT=Wg,ql=Hl,Ni=function(e,r,i){for(var o=ha(r),c=kC.f,u=ny.f,h=0;h<o.length;h++){var m=o[h];bf(e,m)||i&&bf(i,m)||c(e,m,u(r,m))}},us=Fo,ds=Mo,im=Qe,Zg=function(e,r){LC(r)&&"cause"in r&&xC(e,"cause",r.cause)},e_=function(e,r,i,o){uy&&(Y0?Y0(e,r):I1(e,"stack",Kg(i,o)))},A1=Qd,po=function(e,r){return e===void 0?arguments.length<2?"":r:tT(e)},iT=ur("toStringTag"),sm=Error,sT=[].push,jo=function(e,r){var i,o=py(ma,this);ql?i=ql(sm(),o?rT(this):ma):(i=o?this:us(ma),ds(i,iT,"Error")),r!==void 0&&ds(i,"message",po(r)),e_(i,jo,i.stack,1),arguments.length>2&&Zg(i,arguments[2]);var c=[];return A1(e,sT,{that:c}),ds(i,"errors",c),i};ql?ql(jo,sm):Ni(jo,sm,{name:!0});var ma=jo.prototype=us(sm.prototype,{constructor:im(1,jo),message:im(1,""),name:im(1,"AggregateError")});nT({global:!0},{AggregateError:jo});var Zd,Af,om,GC=Se,oT=j.WeakMap,HC=GC(oT)&&/native code/.test(String(oT)),aT=j,$C=_t,KC=Mo,my=fi,gy=xd,t_=jg,qC=yc,n_="Object already initialized",am=aT.TypeError,YC=aT.WeakMap;if(HC||gy.state){var wc=gy.state||(gy.state=new YC);wc.get=wc.get,wc.has=wc.has,wc.set=wc.set,Zd=function(e,r){if(wc.has(e))throw am(n_);return r.facade=e,wc.set(e,r),r},Af=function(e){return wc.get(e)||{}},om=function(e){return wc.has(e)}}else{var Pf=t_("state");qC[Pf]=!0,Zd=function(e,r){if(my(e,Pf))throw am(n_);return r.facade=e,KC(e,Pf,r),r},Af=function(e){return my(e,Pf)?e[Pf]:{}},om=function(e){return my(e,Pf)}}var eh,cT,lT,Ju={set:Zd,get:Af,has:om,enforce:function(e){return om(e)?Af(e):Zd(e,{})},getterFor:function(e){return function(r){var i;if(!$C(r)||(i=Af(r)).type!==e)throw am("Incompatible receiver, "+e+" required");return i}}},_y=tt,XC=fi,uT=Function.prototype,P1=_y&&Object.getOwnPropertyDescriptor,dT=XC(uT,"name"),JC={PROPER:dT&&(function(){}).name==="something",CONFIGURABLE:dT&&(!_y||_y&&P1(uT,"name").configurable)},O1=Mo,Qu=function(e,r,i,o){return o&&o.enumerable?e[r]=i:O1(e,r,i),e},QC=d,ZC=Se,Ey=_t,k1=Fo,eI=Wg,N1=Qu,Ha=ur("iterator"),yy=!1;[].keys&&("next"in(lT=[].keys())?(cT=eI(eI(lT)))!==Object.prototype&&(eh=cT):yy=!0);var vy=!Ey(eh)||QC(function(){var e={};return eh[Ha].call(e)!==e});ZC((eh=vy?{}:k1(eh))[Ha])||N1(eh,Ha,function(){return this});var hT={IteratorPrototype:eh,BUGGY_SAFARI_ITERATORS:yy},tI=Ec,nI=pf?{}.toString:function(){return"[object "+tI(this)+"]"},fT=pf,cm=et.f,pT=Mo,mT=fi,D1=nI,gT=ur("toStringTag"),Zu=function(e,r,i,o){if(e){var c=i?e:e.prototype;mT(c,gT)||cm(c,gT,{configurable:!0,value:r}),o&&!fT&&pT(c,"toString",D1)}},rI=hT.IteratorPrototype,iI=Fo,sI=Qe,L1=Zu,ga=Yd,Bo=function(){return this},Sy=function(e,r,i,o){var c=r+" Iterator";return e.prototype=iI(rI,{next:sI(+!o,i)}),L1(e,c,!1,!0),ga[c]=Bo,e},oI=Mn,aI=Ce,cI=JC,lI=Sy,_T=Wg,uI=Zu,Ty=Qu,ET=Yd,dI=hT,yT=cI.PROPER,lm=dI.BUGGY_SAFARI_ITERATORS,by=ur("iterator"),wy="keys",Of="values",hI="entries",fI=function(){return this},Ry=function(e,r,i,o,c,u,h){lI(i,r,o);var m,_,y,S=function(q){if(q===c&&U)return U;if(!lm&&q in k)return k[q];switch(q){case wy:case Of:case hI:return function(){return new i(this,q)}}return function(){return new i(this)}},R=r+" Iterator",P=!1,k=e.prototype,z=k[by]||k["@@iterator"]||c&&k[c],U=!lm&&z||S(c),V=r=="Array"&&k.entries||z;if(V&&(m=_T(V.call(new e)))!==Object.prototype&&m.next&&(uI(m,R,!0,!0),ET[R]=fI),yT&&c==Of&&z&&z.name!==Of&&(P=!0,U=function(){return aI(z,this)}),c)if(_={values:S(Of),keys:u?U:S(wy),entries:S(hI)},h)for(y in _)(lm||P||!(y in k))&&Ty(k,y,_[y]);else oI({target:r,proto:!0,forced:lm||P},_);return h&&k[by]!==U&&Ty(k,by,U,{}),ET[r]=U,_},Cy=function(e,r){return{value:e,done:r}},Iy=ve,Yl=Yd,pI=Ju;et.f;var mI=Ry,Ay=Cy,vT="Array Iterator",gI=pI.set,r_=pI.getterFor(vT);mI(Array,"Array",function(e,r){gI(this,{type:vT,target:Iy(e),index:0,kind:r})},function(){var e=r_(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,Ay(void 0,!0)):Ay(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),Yl.Arguments=Yl.Array;var mo=et,Py=function(e,r,i){return mo.f(e,r,i)},x1=Xt,Oy=Py,go=tt,_I=ur("species"),Zt=N,um=TypeError,i_=function(e,r){if(Zt(r,e))return e;throw um("Incorrect invocation")},EI=Se,ST=xd,s_=A(Function.toString);EI(ST.inspectSource)||(ST.inspectSource=function(e){return s_(e)});var o_=ST.inspectSource,TT=A,yI=d,bT=Se,vI=Ec,wT=o_,ky=function(){},Xs=[],Rc=Xt("Reflect","construct"),Xl=/^\s*(?:class|function)\b/,SI=TT(Xl.exec),TI=!Xl.exec(ky),Wo=function(e){if(!bT(e))return!1;try{return Rc(ky,Xs,e),!0}catch{return!1}},RT=function(e){if(!bT(e))return!1;switch(vI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return TI||!!SI(Xl,wT(e))}catch{return!0}};RT.sham=!0;var _a,dm,CT,Ny,a_=!Rc||yI(function(){var e;return Wo(Wo.call)||!Wo(Object)||!Wo(function(){e=!0})||e})?RT:Wo,bI=a_,M1=dc,Dy=TypeError,Ly=cn,Cc=function(e){if(bI(e))return e;throw Dy(M1(e)+" is not a constructor")},Tr=Vt,js=ur("species"),$i=function(e,r){var i,o=Ly(e).constructor;return o===void 0||Tr(i=Ly(o)[js])?r:Cc(i)},hs=A([].slice),$a=TypeError,dl=function(e,r){if(e<r)throw $a("Not enough arguments");return e},fs=/(?:ipad|iphone|ipod).*applewebkit/i.test(Bn),Js=j,kf=ne,xy=Oe,My=Se,c_=fi,zo=d,Uy=Gg,hm=hs,Jl=Bl,Vy=dl,IT=fs,th=_f,fm=Js.setImmediate,Ql=Js.clearImmediate,Fy=Js.process,Nf=Js.Dispatch,AT=Js.Function,l_=Js.MessageChannel,jy=Js.String,Qs=0,Ic={},Ac="onreadystatechange";zo(function(){_a=Js.location});var _o=function(e){if(c_(Ic,e)){var r=Ic[e];delete Ic[e],r()}},By=function(e){return function(){_o(e)}},Wy=function(e){_o(e.data)},zy=function(e){Js.postMessage(jy(e),_a.protocol+"//"+_a.host)};fm&&Ql||(fm=function(e){Vy(arguments.length,1);var r=My(e)?e:AT(e),i=hm(arguments,1);return Ic[++Qs]=function(){kf(r,void 0,i)},dm(Qs),Qs},Ql=function(e){delete Ic[e]},th?dm=function(e){Fy.nextTick(By(e))}:Nf&&Nf.now?dm=function(e){Nf.now(By(e))}:l_&&!IT?(Ny=(CT=new l_).port2,CT.port1.onmessage=Wy,dm=xy(Ny.postMessage,Ny)):Js.addEventListener&&My(Js.postMessage)&&!Js.importScripts&&_a&&_a.protocol!=="file:"&&!zo(zy)?(dm=zy,Js.addEventListener("message",Wy,!1)):dm=Ac in Jl("script")?function(e){Uy.appendChild(Jl("script"))[Ac]=function(){Uy.removeChild(this),_o(e)}}:function(e){setTimeout(By(e),0)});var Gy={set:fm,clear:Ql},ed=function(){this.head=null,this.tail=null};ed.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Df,u_,td,d_,nh,PT=ed,wI=/ipad|iphone|ipod/i.test(Bn)&&typeof Pebble<"u",OT=/web0s(?!.*chrome)/i.test(Bn),Zl=j,RI=Oe,U1=Ve.f,Hy=Gy.set,CI=PT,Lf=fs,V1=wI,pm=OT,$y=_f,Di=Zl.MutationObserver||Zl.WebKitMutationObserver,II=Zl.document,kT=Zl.process,Ky=Zl.Promise,AI=U1(Zl,"queueMicrotask"),qy=AI&&AI.value;if(!qy){var h_=new CI,Yy=function(){var e,r;for($y&&(e=kT.domain)&&e.exit();r=h_.get();)try{r()}catch(i){throw h_.head&&Df(),i}e&&e.enter()};Lf||$y||pm||!Di||!II?!V1&&Ky&&Ky.resolve?((d_=Ky.resolve(void 0)).constructor=Ky,nh=RI(d_.then,d_),Df=function(){nh(Yy)}):$y?Df=function(){kT.nextTick(Yy)}:(Hy=RI(Hy,Zl),Df=function(){Hy(Yy)}):(u_=!0,td=II.createTextNode(""),new Di(Yy).observe(td,{characterData:!0}),Df=function(){td.data=u_=!u_}),qy=function(e){h_.head||Df(),h_.add(e)}}var Ka=qy,rh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},xf=j.Promise,nd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Xy=!nd&&!_f&&typeof window=="object"&&typeof document=="object",Mf=j,ih=xf,NT=Se,DT=ca,F1=o_,LT=ur,j1=Xy,PI=nd,Jy=hi,f_=ih&&ih.prototype,Qy=LT("species"),xT=NT(Mf.PromiseRejectionEvent),MT=DT("Promise",function(){var e=F1(ih),r=e!==String(ih);if(!r&&Jy===66||!f_.catch||!f_.finally)return!0;if(!Jy||Jy<51||!/native code/.test(e)){var i=new ih(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[Qy]=o,!(i.then(function(){})instanceof o))return!0}return!r&&(j1||PI)&&!xT}),p_={CONSTRUCTOR:MT,REJECTION_EVENT:xT},hl={},Zy=as,ev=TypeError,UT=function(e){var r,i;this.promise=new e(function(o,c){if(r!==void 0||i!==void 0)throw ev("Bad Promise constructor");r=o,i=c}),this.resolve=Zy(r),this.reject=Zy(i)};hl.f=function(e){return new UT(e)};var mm,VT,B1=Mn,Uf=_f,sh=j,rd=Ce,W1=Qu,tv=Zu,f=function(e){var r=x1(e);go&&r&&!r[_I]&&Oy(r,_I,{configurable:!0,get:function(){return this}})},g=as,b=Se,O=_t,M=i_,H=$i,ae=Gy.set,Te=Ka,Le=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},nt=rh,At=PT,Pt=Ju,Rt=xf,$t=p_,tn=hl,nn="Promise",Ki=$t.CONSTRUCTOR,qe=$t.REJECTION_EVENT,Fe=Pt.getterFor(nn),Je=Pt.set,Nt=Rt&&Rt.prototype,rn=Rt,pn=Nt,vn=sh.TypeError,kn=sh.document,ps=sh.process,_r=tn.f,oh=_r,z1=!!(kn&&kn.createEvent&&sh.dispatchEvent),k4="unhandledrejection",N4=function(e){var r;return!(!O(e)||!b(r=e.then))&&r},D4=function(e,r){var i,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Kse(r),r.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(vn("Promise-chain cycle")):(o=N4(i))?rd(o,i,_,y):_(i)):y(u)}catch(R){S&&!c&&S.exit(),y(R)}},L4=function(e,r){e.notified||(e.notified=!0,Te(function(){for(var i,o=e.reactions;i=o.get();)D4(i,e);e.notified=!1,r&&!e.rejection&&$se(e)}))},x4=function(e,r,i){var o,c;z1?((o=kn.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),sh.dispatchEvent(o)):o={promise:r,reason:i},!qe&&(c=sh["on"+e])?c(o):e===k4&&Le("Unhandled promise rejection",i)},$se=function(e){rd(ae,sh,function(){var r,i=e.facade,o=e.value;if(M4(e)&&(r=nt(function(){Uf?ps.emit("unhandledRejection",o,i):x4(k4,i,o)}),e.rejection=Uf||M4(e)?2:1,r.error))throw r.value})},M4=function(e){return e.rejection!==1&&!e.parent},Kse=function(e){rd(ae,sh,function(){var r=e.facade;Uf?ps.emit("rejectionHandled",r):x4("rejectionhandled",r,e.value)})},nv=function(e,r,i){return function(o){e(r,o,i)}},rv=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,L4(e,!0))},G1=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw vn("Promise can't be resolved itself");var o=N4(r);o?Te(function(){var c={done:!1};try{rd(o,r,nv(G1,c,e),nv(rv,c,e))}catch(u){rv(c,u,e)}}):(e.value=r,e.state=1,L4(e,!1))}catch(c){rv({done:!1},c,e)}}};Ki&&(pn=(rn=function(e){M(this,pn),g(e),rd(mm,this);var r=Fe(this);try{e(nv(G1,r),nv(rv,r))}catch(i){rv(r,i)}}).prototype,(mm=function(e){Je(this,{type:nn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=W1(pn,"then",function(e,r){var i=Fe(this),o=_r(H(this,rn));return i.parent=!0,o.ok=!b(e)||e,o.fail=b(r)&&r,o.domain=Uf?ps.domain:void 0,i.state==0?i.reactions.add(o):Te(function(){D4(o,i)}),o.promise}),VT=function(){var e=new mm,r=Fe(e);this.promise=e,this.resolve=nv(G1,r),this.reject=nv(rv,r)},tn.f=_r=function(e){return e===rn||e===void 0?new VT(e):oh(e)}),B1({global:!0,wrap:!0,forced:Ki},{Promise:rn}),tv(rn,nn,!1,!0),f(nn);var U4=ur("iterator"),V4=!1;try{var qse=0,F4={next:function(){return{done:!!qse++}},return:function(){V4=!0}};F4[U4]=function(){return this},Array.from(F4,function(){throw 2})}catch{}var Yse=xf,Xse=function(e,r){if(!V4)return!1;var i=!1;try{var o={};o[U4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},OI=p_.CONSTRUCTOR||!Xse(function(e){Yse.all(e).then(void 0,function(){})}),Jse=Ce,Qse=as,Zse=hl,eoe=rh,toe=Qd;Mn({target:"Promise",stat:!0,forced:OI},{all:function(e){var r=this,i=Zse.f(r),o=i.resolve,c=i.reject,u=eoe(function(){var h=Qse(r.resolve),m=[],_=0,y=1;toe(e,function(S){var R=_++,P=!1;y++,Jse(h,r,S).then(function(k){P||(P=!0,m[R]=k,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var noe=Mn,roe=p_.CONSTRUCTOR;xf&&xf.prototype,noe({target:"Promise",proto:!0,forced:roe,real:!0},{catch:function(e){return this.then(void 0,e)}});var ioe=Ce,soe=as,ooe=hl,aoe=rh,coe=Qd;Mn({target:"Promise",stat:!0,forced:OI},{race:function(e){var r=this,i=ooe.f(r),o=i.reject,c=aoe(function(){var u=soe(r.resolve);coe(e,function(h){ioe(u,r,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var loe=Ce,uoe=hl;Mn({target:"Promise",stat:!0,forced:p_.CONSTRUCTOR},{reject:function(e){var r=uoe.f(this);return loe(r.reject,void 0,e),r.promise}});var doe=cn,hoe=_t,foe=hl,j4=function(e,r){if(doe(e),hoe(r)&&r.constructor===e)return r;var i=foe.f(e);return(0,i.resolve)(r),i.promise},poe=Mn,moe=xf,goe=p_.CONSTRUCTOR,_oe=j4,Eoe=Xt("Promise"),yoe=!goe;poe({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return _oe(yoe&&this===Eoe?moe:this,e)}});var voe=Ce,Soe=as,Toe=hl,boe=rh,woe=Qd;Mn({target:"Promise",stat:!0,forced:OI},{allSettled:function(e){var r=this,i=Toe.f(r),o=i.resolve,c=i.reject,u=boe(function(){var h=Soe(r.resolve),m=[],_=0,y=1;woe(e,function(S){var R=_++,P=!1;y++,voe(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--y||o(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Roe=Ce,Coe=as,Ioe=Xt,Aoe=hl,Poe=rh,Ooe=Qd,B4="No one promise resolved";Mn({target:"Promise",stat:!0,forced:OI},{any:function(e){var r=this,i=Ioe("AggregateError"),o=Aoe.f(r),c=o.resolve,u=o.reject,h=Poe(function(){var m=Coe(r.resolve),_=[],y=0,S=1,R=!1;Ooe(e,function(P){var k=y++,z=!1;S++,Roe(m,r,P).then(function(U){z||R||(R=!0,c(U))},function(U){z||R||(z=!0,_[k]=U,--S||u(new i(_,B4)))})}),--S||u(new i(_,B4))});return h.error&&u(h.value),o.promise}});var koe=Mn,H1=xf,Noe=d,Doe=Xt,Loe=Se,xoe=$i,W4=j4,Moe=H1&&H1.prototype;koe({target:"Promise",proto:!0,real:!0,forced:!!H1&&Noe(function(){Moe.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=xoe(this,Doe("Promise")),i=Loe(e);return this.then(i?function(o){return W4(r,e()).then(function(){return o})}:e,i?function(o){return W4(r,e()).then(function(){throw o})}:e)}});var $1=A,Uoe=_c,Voe=ua,Foe=Qt,joe=$1("".charAt),z4=$1("".charCodeAt),Boe=$1("".slice),G4=function(e){return function(r,i){var o,c,u=Voe(Foe(r)),h=Uoe(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=z4(u,h))<55296||o>56319||h+1===m||(c=z4(u,h+1))<56320||c>57343?e?joe(u,h):o:e?Boe(u,h,h+2):c-56320+(o-55296<<10)+65536}},K1={codeAt:G4(!1),charAt:G4(!0)},Woe=K1.charAt,zoe=ua,H4=Ju,Goe=Ry,$4=Cy,K4="String Iterator",Hoe=H4.set,$oe=H4.getterFor(K4);Goe(String,"String",function(e){Hoe(this,{type:K4,string:zoe(e),index:0})},function(){var e,r=$oe(this),i=r.string,o=r.index;return o>=i.length?$4(void 0,!0):(e=Woe(i,o),r.index+=e.length,$4(e,!1))});var Koe=vt.Promise,qoe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Yoe=j,Xoe=Ec,Joe=Mo,q4=Yd,Y4=ur("toStringTag");for(var q1 in qoe){var X4=Yoe[q1],Y1=X4&&X4.prototype;Y1&&Xoe(Y1)!==Y4&&Joe(Y1,Y4,q1),q4[q1]=q4.Array}var J4=Koe,ct=l(J4),Qoe=Wa("Array").values,Zoe=Ec,eae=fi,tae=N,nae=Qoe,X1=Array.prototype,rae={DOMTokenList:!0,NodeList:!0},iae=function(e){var r=e.values;return e===X1||tae(X1,e)&&r===X1.values||eae(rae,Zoe(e))?nae:r},Pc=l(iae),sae=d,oae=ur("iterator"),J1=!sae(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[oae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),aae=Qu,cae=ja,lae=et,uae=Qe,kI=function(e,r,i){var o=cae(r);o in e?lae.f(e,o,uae(0,i)):e[o]=i},Q4=fe,dae=ri,hae=kI,fae=Array,pae=Math.max,Q1=function(e,r,i){for(var o=dae(e),c=Q4(r,o),u=Q4(i===void 0?o:i,o),h=fae(pae(u-c,0)),m=0;c<u;c++,m++)hae(h,m,e[c]);return h.length=m,h},Z4=Q1,mae=Math.floor,Z1=function(e,r){var i=e.length,o=mae(i/2);return i<8?gae(e,r):_ae(e,Z1(Z4(e,0,o),r),Z1(Z4(e,o),r),r)},gae=function(e,r){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},_ae=function(e,r,i,o){for(var c=r.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],i[m])<=0?r[h++]:i[m++]:h<c?r[h++]:i[m++];return e},e3=Z1,eD=Mn,iv=j,NI=Ce,ah=A,sv=tt,t3=J1,n3=Qu,Eae=Py,yae=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:aae(e,o,r[o],i);return e},vae=Zu,Sae=Sy,tD=Ju,r3=i_,nD=Se,Tae=fi,bae=Oe,wae=Ec,Rae=cn,i3=_t,qa=ua,Cae=Fo,s3=Qe,rD=Yg,Iae=Yu,ov=dl,Aae=e3,Pae=ur("iterator"),FT="URLSearchParams",o3=FT+"Iterator",a3=tD.set,eu=tD.getterFor(FT),Oae=tD.getterFor(o3),kae=Object.getOwnPropertyDescriptor,iD=function(e){if(!sv)return iv[e];var r=kae(iv,e);return r&&r.value},c3=iD("fetch"),DI=iD("Request"),jT=iD("Headers"),sD=DI&&DI.prototype,l3=jT&&jT.prototype,Nae=iv.RegExp,Dae=iv.TypeError,u3=iv.decodeURIComponent,Lae=iv.encodeURIComponent,xae=ah("".charAt),d3=ah([].join),m_=ah([].push),oD=ah("".replace),Mae=ah([].shift),h3=ah([].splice),f3=ah("".split),Uae=ah("".slice),Vae=/\+/g,p3=Array(4),Fae=function(e){return p3[e-1]||(p3[e-1]=Nae("((?:%[\\da-f]{2}){"+e+"})","gi"))},jae=function(e){try{return u3(e)}catch{return e}},m3=function(e){var r=oD(e,Vae," "),i=4;try{return u3(r)}catch{for(;i;)r=oD(r,Fae(i--),jae);return r}},Bae=/[!'()~]|%20/g,Wae={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zae=function(e){return Wae[e]},g3=function(e){return oD(Lae(e),Bae,zae)},aD=Sae(function(e,r){a3(this,{type:o3,iterator:rD(eu(e).entries),kind:r})},"Iterator",function(){var e=Oae(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),_3=function(e){this.entries=[],this.url=null,e!==void 0&&(i3(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?xae(e,0)==="?"?Uae(e,1):e:qa(e)))};_3.prototype={type:FT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,c,u,h,m,_=Iae(e);if(_)for(i=(r=rD(e,_)).next;!(o=NI(i,r)).done;){if(u=(c=rD(Rae(o.value))).next,(h=NI(u,c)).done||(m=NI(u,c)).done||!NI(u,c).done)throw Dae("Expected sequence with length 2");m_(this.entries,{key:qa(h.value),value:qa(m.value)})}else for(var y in e)Tae(e,y)&&m_(this.entries,{key:y,value:qa(e[y])})},parseQuery:function(e){if(e)for(var r,i,o=f3(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(i=f3(r,"="),m_(this.entries,{key:m3(Mae(i)),value:m3(d3(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],m_(i,g3(e.key)+"="+g3(e.value));return d3(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var LI=function(){r3(this,av);var e=a3(this,new _3(arguments.length>0?arguments[0]:void 0));sv||(this.size=e.entries.length)},av=LI.prototype;if(yae(av,{append:function(e,r){var i=eu(this);ov(arguments.length,2),m_(i.entries,{key:qa(e),value:qa(r)}),sv||this.length++,i.updateURL()},delete:function(e){for(var r=eu(this),i=ov(arguments.length,1),o=r.entries,c=qa(e),u=i<2?void 0:arguments[1],h=u===void 0?u:qa(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(h3(o,m,1),h!==void 0)break}sv||(this.size=o.length),r.updateURL()},get:function(e){var r=eu(this).entries;ov(arguments.length,1);for(var i=qa(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=eu(this).entries;ov(arguments.length,1);for(var i=qa(e),o=[],c=0;c<r.length;c++)r[c].key===i&&m_(o,r[c].value);return o},has:function(e){for(var r=eu(this).entries,i=ov(arguments.length,1),o=qa(e),c=i<2?void 0:arguments[1],u=c===void 0?c:qa(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var i=eu(this);ov(arguments.length,1);for(var o,c=i.entries,u=!1,h=qa(e),m=qa(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?h3(c,_--,1):(u=!0,o.value=m));u||m_(c,{key:h,value:m}),sv||(this.size=c.length),i.updateURL()},sort:function(){var e=eu(this);Aae(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=eu(this).entries,o=bae(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((r=i[c++]).value,r.key,this)},keys:function(){return new aD(this,"keys")},values:function(){return new aD(this,"values")},entries:function(){return new aD(this,"entries")}},{enumerable:!0}),n3(av,Pae,av.entries,{}),n3(av,"toString",function(){return eu(this).serialize()},{enumerable:!0}),sv&&Eae(av,"size",{get:function(){return eu(this).entries.length},configurable:!0,enumerable:!0}),vae(LI,FT),eD({global:!0,forced:!t3},{URLSearchParams:LI}),!t3&&nD(jT)){var Gae=ah(l3.has),Hae=ah(l3.set),E3=function(e){if(i3(e)){var r,i=e.body;if(wae(i)===FT)return r=e.headers?new jT(e.headers):new jT,Gae(r,"content-type")||Hae(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Cae(e,{body:s3(0,qa(i)),headers:s3(0,r)})}return e};if(nD(c3)&&eD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return c3(e,arguments.length>1?E3(arguments[1]):{})}}),nD(DI)){var cD=function(e){return r3(this,sD),new DI(e,arguments.length>1?E3(arguments[1]):{})};sD.constructor=cD,cD.prototype=sD,eD({global:!0,dontCallGetSet:!0,forced:!0},{Request:cD})}}var tu,$ae={URLSearchParams:LI,getState:eu},Kae=vt.URLSearchParams,y3=tt,qae=A,Yae=Ce,Xae=d,lD=Sc,Jae=vc,Qae=Xe,Zae=Io,ece=yn,cv=Object.assign,v3=Object.defineProperty,tce=qae([].concat),nce=!cv||Xae(function(){if(y3&&cv({b:1},cv(v3({},"a",{enumerable:!0,get:function(){v3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){r[c]=c}),cv({},e)[i]!=7||lD(cv({},r)).join("")!=o})?function(e,r){for(var i=Zae(e),o=arguments.length,c=1,u=Jae.f,h=Qae.f;o>c;)for(var m,_=ece(arguments[c++]),y=u?tce(lD(_),u(_)):lD(_),S=y.length,R=0;S>R;)m=y[R++],y3&&!Yae(h,_,m)||(i[m]=_[m]);return i}:cv,rce=cn,ice=Xg,sce=Oe,oce=Ce,ace=Io,cce=function(e,r,i,o){try{return o?r(rce(i)[0],i[1]):r(i)}catch(c){ice(e,"throw",c)}},lce=qg,uce=a_,dce=ri,S3=kI,hce=Yg,fce=Yu,T3=Array,g_=A,uD=2147483647,pce=/[^\0-\u007E]/,b3=/[.\u3002\uFF0E\uFF61]/g,w3="Overflow: input needs wider integers to process",R3=RangeError,mce=g_(b3.exec),lv=Math.floor,dD=String.fromCharCode,C3=g_("".charCodeAt),I3=g_([].join),gm=g_([].push),gce=g_("".replace),_ce=g_("".split),Ece=g_("".toLowerCase),A3=function(e){return e+22+75*(e<26)},yce=function(e,r,i){var o=0;for(e=i?lv(e/700):e>>1,e+=lv(e/r);e>455;)e=lv(e/35),o+=36;return lv(o+36*e/(e+38))},vce=function(e){var r=[];e=function(q){for(var Y=[],le=0,ge=q.length;le<ge;){var Ee=C3(q,le++);if(Ee>=55296&&Ee<=56319&&le<ge){var pe=C3(q,le++);(64512&pe)==56320?gm(Y,((1023&Ee)<<10)+(1023&pe)+65536):(gm(Y,Ee),le--)}else gm(Y,Ee)}return Y}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&gm(r,dD(o));var _=r.length,y=_;for(_&&gm(r,"-");y<c;){var S=uD;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var R=y+1;if(S-u>lv((uD-h)/R))throw R3(w3);for(h+=(S-u)*R,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>uD)throw R3(w3);if(o==u){for(var P=h,k=36;;){var z=k<=m?1:k>=m+26?26:k-m;if(P<z)break;var U=P-z,V=36-z;gm(r,dD(A3(z+U%V))),P=lv(U/V),k+=36}gm(r,dD(A3(P))),m=yce(h,R,y==_),h=0,y++}}h++,u++}return I3(r,"")},Sce=Mn,hD=tt,Tce=J1,fD=j,P3=Oe,nu=A,xI=Qu,ru=Py,bce=i_,pD=fi,mD=nce,uv=function(e){var r=ace(e),i=uce(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=sce(c,o>2?arguments[2]:void 0));var h,m,_,y,S,R,P=fce(r),k=0;if(!P||this===T3&&lce(P))for(h=dce(r),m=i?new this(h):T3(h);h>k;k++)R=u?c(r[k],k):r[k],S3(m,k,R);else for(S=(y=hce(r,P)).next,m=i?new this:[];!(_=oce(S,y)).done;k++)R=u?cce(y,c,[_.value,k],!0):_.value,S3(m,k,R);return m.length=k,m},id=Q1,wce=K1.codeAt,Rce=function(e){var r,i,o=[],c=_ce(gce(Ece(e),b3,"."),".");for(r=0;r<c.length;r++)i=c[r],gm(o,mce(pce,i)?"xn--"+vce(i):i);return I3(o,".")},Vf=ua,Cce=Zu,Ice=dl,O3=$ae,k3=Ju,Ace=k3.set,MI=k3.getterFor("URL"),Pce=O3.URLSearchParams,Oce=O3.getState,BT=fD.URL,gD=fD.TypeError,UI=fD.parseInt,kce=Math.floor,N3=Math.pow,iu=nu("".charAt),sd=nu(/./.exec),WT=nu([].join),Nce=nu(1 .toString),Dce=nu([].pop),dv=nu([].push),_D=nu("".replace),Lce=nu([].shift),xce=nu("".split),zT=nu("".slice),VI=nu("".toLowerCase),Mce=nu([].unshift),ED="Invalid scheme",__="Invalid host",D3="Invalid port",L3=/[a-z]/i,Uce=/[\d+-.a-z]/i,yD=/\d/,Vce=/^0x/i,Fce=/^[0-7]+$/,jce=/^\d+$/,x3=/^[\da-f]+$/i,Bce=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Wce=/[\0\t\n\r #/:<>?@[\\\]^|]/,zce=/^[\u0000-\u0020]+/,Gce=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Hce=/[\t\n\r]/g,GT=function(e){var r,i,o,c;if(typeof e=="number"){for(r=[],i=0;i<4;i++)Mce(r,e%256),e=kce(e/256);return WT(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(r+=i?":":"::",c=!0):(r+=Nce(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},FI={},M3=mD({},FI,{" ":1,'"':1,"<":1,">":1,"`":1}),U3=mD({},M3,{"#":1,"?":1,"{":1,"}":1}),vD=mD({},U3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),_m=function(e,r){var i=wce(e,0);return i>32&&i<127&&!pD(r,e)?e:encodeURIComponent(e)},jI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},HT=function(e,r){var i;return e.length==2&&sd(L3,iu(e,0))&&((i=iu(e,1))==":"||!r&&i=="|")},V3=function(e){var r;return e.length>1&&HT(zT(e,0,2))&&(e.length==2||(r=iu(e,2))==="/"||r==="\\"||r==="?"||r==="#")},$ce=function(e){return e==="."||VI(e)==="%2e"},SD={},F3={},TD={},j3={},B3={},bD={},W3={},z3={},BI={},WI={},wD={},RD={},CD={},ID={},G3={},AD={},hv={},ch={},H3={},E_={},Ff={},PD=function(e,r,i){var o,c,u,h=Vf(e);if(r){if(c=this.parse(h))throw gD(c);this.searchParams=null}else{if(i!==void 0&&(o=new PD(i,!0)),c=this.parse(h,null,o))throw gD(c);(u=Oce(new Pce)).bindURL(this),this.searchParams=u}};PD.prototype={type:"URL",parse:function(e,r,i){var o,c,u,h,m,_=this,y=r||SD,S=0,R="",P=!1,k=!1,z=!1;for(e=Vf(e),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=_D(e,zce,""),e=_D(e,Gce,"$1")),e=_D(e,Hce,""),o=uv(e);S<=o.length;){switch(c=o[S],y){case SD:if(!c||!sd(L3,c)){if(r)return ED;y=TD;continue}R+=VI(c),y=F3;break;case F3:if(c&&(sd(Uce,c)||c=="+"||c=="-"||c=="."))R+=VI(c);else{if(c!=":"){if(r)return ED;R="",y=TD,S=0;continue}if(r&&(_.isSpecial()!=pD(jI,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&jI[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?y=ID:_.isSpecial()&&i&&i.scheme==_.scheme?y=j3:_.isSpecial()?y=z3:o[S+1]=="/"?(y=B3,S++):(_.cannotBeABaseURL=!0,dv(_.path,""),y=H3)}break;case TD:if(!i||i.cannotBeABaseURL&&c!="#")return ED;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=id(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=Ff;break}y=i.scheme=="file"?ID:bD;continue;case j3:if(c!="/"||o[S+1]!="/"){y=bD;continue}y=BI,S++;break;case B3:if(c=="/"){y=WI;break}y=ch;continue;case bD:if(_.scheme=i.scheme,c==tu)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=W3;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query="",y=E_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.path.length--,y=ch;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=id(i.path),_.query=i.query,_.fragment="",y=Ff}break;case W3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=ch;continue}y=WI}else y=BI;break;case z3:if(y=BI,c!="/"||iu(R,S+1)!="/")continue;S++;break;case BI:if(c!="/"&&c!="\\"){y=WI;continue}break;case WI:if(c=="@"){P&&(R="%40"+R),P=!0,u=uv(R);for(var U=0;U<u.length;U++){var V=u[U];if(V!=":"||z){var q=_m(V,vD);z?_.password+=q:_.username+=q}else z=!0}R=""}else if(c==tu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=uv(R).length+1,R="",y=wD}else R+=c;break;case wD:case RD:if(r&&_.scheme=="file"){y=AD;continue}if(c!=":"||k){if(c==tu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return __;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",y=hv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return __;if(h=_.parseHost(R))return h;if(R="",y=CD,r==RD)return}break;case CD:if(!sd(yD,c)){if(c==tu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=UI(R,10);if(Y>65535)return D3;_.port=_.isSpecial()&&Y===jI[_.scheme]?null:Y,R=""}if(r)return;y=hv;continue}return D3}R+=c;break;case ID:if(_.scheme="file",c=="/"||c=="\\")y=G3;else{if(!i||i.scheme!="file"){y=ch;continue}if(c==tu)_.host=i.host,_.path=id(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=id(i.path),_.query="",y=E_;else{if(c!="#"){V3(WT(id(o,S),""))||(_.host=i.host,_.path=id(i.path),_.shortenPath()),y=ch;continue}_.host=i.host,_.path=id(i.path),_.query=i.query,_.fragment="",y=Ff}}break;case G3:if(c=="/"||c=="\\"){y=AD;break}i&&i.scheme=="file"&&!V3(WT(id(o,S),""))&&(HT(i.path[0],!0)?dv(_.path,i.path[0]):_.host=i.host),y=ch;continue;case AD:if(c==tu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&HT(R))y=ch;else if(R==""){if(_.host="",r)return;y=hv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",y=hv}continue}R+=c;break;case hv:if(_.isSpecial()){if(y=ch,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=tu&&(y=ch,c!="/"))continue}else _.fragment="",y=Ff;else _.query="",y=E_;break;case ch:if(c==tu||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=VI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||dv(_.path,"")):$ce(R)?c=="/"||c=="\\"&&_.isSpecial()||dv(_.path,""):(_.scheme=="file"&&!_.path.length&&HT(R)&&(_.host&&(_.host=""),R=iu(R,0)+":"),dv(_.path,R)),R="",_.scheme=="file"&&(c==tu||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)Lce(_.path);c=="?"?(_.query="",y=E_):c=="#"&&(_.fragment="",y=Ff)}else R+=_m(c,U3);break;case H3:c=="?"?(_.query="",y=E_):c=="#"?(_.fragment="",y=Ff):c!=tu&&(_.path[0]+=_m(c,FI));break;case E_:r||c!="#"?c!=tu&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":_m(c,FI)):(_.fragment="",y=Ff);break;case Ff:c!=tu&&(_.fragment+=_m(c,M3))}S++}},parseHost:function(e){var r,i,o;if(iu(e,0)=="["){if(iu(e,e.length-1)!="]"||(r=function(c){var u,h,m,_,y,S,R,P=[0,0,0,0,0,0,0,0],k=0,z=null,U=0,V=function(){return iu(c,U)};if(V()==":"){if(iu(c,1)!=":")return;U+=2,z=++k}for(;V();){if(k==8)return;if(V()!=":"){for(u=h=0;h<4&&sd(x3,V());)u=16*u+UI(V(),16),U++,h++;if(V()=="."){if(h==0||(U-=h,k>6))return;for(m=0;V();){if(_=null,m>0){if(!(V()=="."&&m<4))return;U++}if(!sd(yD,V()))return;for(;sd(yD,V());){if(y=UI(V(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(V()==":"){if(U++,!V())return}else if(V())return;P[k++]=u}else{if(z!==null)return;U++,z=++k}}if(z!==null)for(S=k-z,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[z+S-1],P[z+--S]=R;else if(k!=8)return;return P}(zT(e,1,-1)),!r))return __;this.host=r}else if(this.isSpecial()){if(e=Rce(e),sd(Bce,e)||(r=function(c){var u,h,m,_,y,S,R,P=xce(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(y=10,_.length>1&&iu(_,0)=="0"&&(y=sd(Vce,_)?16:8,_=zT(_,y==8?1:2)),_==="")S=0;else{if(!sd(y==10?jce:y==8?Fce:x3,_))return c;S=UI(_,y)}dv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=N3(256,5-u))return null}else if(S>255)return null;for(R=Dce(h),m=0;m<h.length;m++)R+=h[m]*N3(256,3-m);return R}(e),r===null))return __;this.host=r}else{if(sd(Wce,e))return __;for(r="",i=uv(e),o=0;o<i.length;o++)r+=_m(i[o],FI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return pD(jI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&HT(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=r+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=GT(c),u!==null&&(y+=":"+u)):r=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+WT(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var r=this.parse(e);if(r)throw gD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new fv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+GT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Vf(e)+":",SD)},getUsername:function(){return this.username},setUsername:function(e){var r=uv(Vf(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=_m(r[i],vD)}},getPassword:function(){return this.password},setPassword:function(e){var r=uv(Vf(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=_m(r[i],vD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?GT(e):GT(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,wD)},getHostname:function(){var e=this.host;return e===null?"":GT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,RD)},getPort:function(){var e=this.port;return e===null?"":Vf(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Vf(e))==""?this.port=null:this.parse(e,CD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+WT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,hv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Vf(e))==""?this.query=null:(iu(e,0)=="?"&&(e=zT(e,1)),this.query="",this.parse(e,E_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Vf(e))!=""?(iu(e,0)=="#"&&(e=zT(e,1)),this.fragment="",this.parse(e,Ff)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var fv=function(e){var r=bce(this,Ya),i=Ice(arguments.length,1)>1?arguments[1]:void 0,o=Ace(r,new PD(e,!1,i));hD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},Ya=fv.prototype,su=function(e,r){return{get:function(){return MI(this)[e]()},set:r&&function(i){return MI(this)[r](i)},configurable:!0,enumerable:!0}};if(hD&&(ru(Ya,"href",su("serialize","setHref")),ru(Ya,"origin",su("getOrigin")),ru(Ya,"protocol",su("getProtocol","setProtocol")),ru(Ya,"username",su("getUsername","setUsername")),ru(Ya,"password",su("getPassword","setPassword")),ru(Ya,"host",su("getHost","setHost")),ru(Ya,"hostname",su("getHostname","setHostname")),ru(Ya,"port",su("getPort","setPort")),ru(Ya,"pathname",su("getPathname","setPathname")),ru(Ya,"search",su("getSearch","setSearch")),ru(Ya,"searchParams",su("getSearchParams")),ru(Ya,"hash",su("getHash","setHash"))),xI(Ya,"toJSON",function(){return MI(this).serialize()},{enumerable:!0}),xI(Ya,"toString",function(){return MI(this).serialize()},{enumerable:!0}),BT){var $3=BT.createObjectURL,K3=BT.revokeObjectURL;$3&&xI(fv,"createObjectURL",P3($3,BT)),K3&&xI(fv,"revokeObjectURL",P3(K3,BT))}Cce(fv,"URL"),Sce({global:!0,forced:!Tce,sham:!hD},{URL:fv});var Kce=Mn,qce=d,Yce=dl,q3=ua,Xce=J1,Y3=Xt("URL");Kce({target:"URL",stat:!0,forced:!(Xce&&qce(function(){Y3.canParse()}))},{canParse:function(e){var r=Yce(arguments.length,1),i=q3(e),o=r<2||arguments[1]===void 0?void 0:q3(arguments[1]);try{return!!new Y3(i,o)}catch{return!1}}});var zI=l(vt.URL);let X3=!0,J3=!0;function GI(e,r,i){const o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function y_(e,r,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Jce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(X3=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Qce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(J3=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Q3(){if(typeof window=="object"){if(X3)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function OD(e,r){J3&&console.warn(e+" is deprecated, please use "+r+" instead.")}function Z3(e){return Object.prototype.toString.call(e)==="[object Object]"}function eB(e){var r;return Z3(e)?za(r=Object.keys(e)).call(r,function(i,o){const c=Z3(e[o]),u=c?eB(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function kD(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?kD(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(c=>{kD(e,e.get(c),i)})}))}function tB(e,r,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&kD(e,m,c)})}),c}const nB=Q3;function rB(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(y.ideal!==void 0){m.optional=m.optional||[];let R={};typeof y.ideal=="number"?(R[S("min",_)]=y.ideal,m.optional.push(R),R={},R[S("max",_)]=y.ideal,m.optional.push(R)):(R[S("",_)]=y.ideal,m.optional.push(R))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(R=>{y[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=y[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,R){S in y&&!(R in y)&&(y[R]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(z=>{var U;return st(U=k.label.toLowerCase()).call(U,z)}));return!P&&R.length&&st(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),nB("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return nB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>ct.reject(u(y))))}}}function iB(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function sB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else y_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function oB(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function aB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(R=>{S[R]=y.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,i])}return new ct((m,_)=>{r.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function cB(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>tB(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),y_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>tB(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?ct.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ct.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function lB(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function uB(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return lB(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(R=>R.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[y.id];if(P)P.addTrack(_),ct.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):y.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ND(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function dB(e,r){y_(e,"negotiationneeded",i=>{const o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var hB=Object.freeze({__proto__:null,fixNegotiationNeeded:dB,shimAddTrackRemoveTrack:uB,shimAddTrackRemoveTrackWithNative:lB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:oB,shimGetStats:aB,shimGetUserMedia:rB,shimMediaStream:iB,shimOnTrack:sB,shimPeerConnection:ND,shimSenderReceiverGetStats:cB});function fB(e,r){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){OD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function pB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function DD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function mB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ct.resolve(new Map)}}function gB(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),y_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function _B(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){OD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&st(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function EB(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function yB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function vB(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function SB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function TB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ct.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var bB=Object.freeze({__proto__:null,shimAddTransceiver:yB,shimCreateAnswer:TB,shimCreateOffer:SB,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ct.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:vB,shimGetUserMedia:fB,shimOnTrack:pB,shimPeerConnection:DD,shimRTCDataChannel:EB,shimReceiverGetStats:gB,shimRemoveStream:_B,shimSenderGetStats:mB});function wB(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>r.call(this,c,i)),i.getVideoTracks().forEach(c=>r.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const o=r.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function RB(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),r.apply(i,arguments)}}}function CB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=i.apply(this,[S]);return y?(R.then(_,y),ct.resolve()):R},r.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return y?(R.then(_,y),ct.resolve()):R};let m=function(_,y,S){const R=c.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R};r.setLocalDescription=m,m=function(_,y,S){const R=u.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R},r.setRemoteDescription=m,m=function(_,y,S){const R=h.apply(this,[_]);return S?(R.then(y,S),ct.resolve()):R},r.addIceCandidate=m}function IB(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=c=>o(AB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,o,c){r.mediaDevices.getUserMedia(i).then(o,c)}).bind(r))}function AB(e){return e&&e.video!==void 0?Object.assign({},e,{video:eB(e.video)}):e}function PB(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(OD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function OB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function kB(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function NB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var DB=Object.freeze({__proto__:null,shimAudioContext:NB,shimCallbacksAPI:CB,shimConstraints:AB,shimCreateOfferLegacy:kB,shimGetUserMedia:IB,shimLocalStreamsAPI:wB,shimRTCIceServerUrls:PB,shimRemoteStreamsAPI:RB,shimTrackEventTransceiver:OB}),LB=`	
\v\f\r \u2028\u2029\uFEFF`,Zce=Qt,ele=ua,LD=LB,xB=A("".replace),tle=RegExp("^["+LD+"]+"),nle=RegExp("(^|[^"+LD+"])["+LD+"]+$"),rle=function(e){return function(r){var i=ele(Zce(r));return 1&e&&(i=xB(i,tle,"")),2&e&&(i=xB(i,nle,"$1")),i}},ile={trim:rle(3)},sle=JC.PROPER,ole=d,MB=LB,ale=ile.trim;Mn({target:"String",proto:!0,forced:function(e){return ole(function(){return!!MB[e]()||""[e]()!==""||sle&&MB[e].name!==e})}("trim")},{trim:function(){return ale(this)}});var cle=Wa("String").trim,lle=N,ule=cle,xD=String.prototype,dle=function(e){var r=e.trim;return typeof e=="string"||e===xD||lle(xD,e)&&r===xD.trim?ule:r},Zs=l(dle),UB={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){const o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){const o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},r.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(i){const o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){const c=r.matchPrefix(i+o,"a=ice-ufrag:")[0],u=r.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=r.parseRtpMap(_),S=r.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?r.parseFmtp(S[0]):{},y.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(i){const o=[],c=r.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(i,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=r.matchPrefix(i,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(i,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(i){const o={},c=r.matchPrefix(i,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o;const c=r.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){const o=r.parseMLine(i),c=r.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){const c=r.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){const o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=r.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(UB);var VB=UB.exports,pv=l(VB),hle=s({__proto__:null,default:pv},[VB]);function HI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new r(i),c=pv.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,y_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function MD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||y_(e,"icecandidate",r=>{if(r.candidate){const i=pv.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function $I(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=pv.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=pv.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;r.browser==="firefox"&&r.version===57&&(y=65535);const S=pv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function KI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return r(o,this),o},y_(e,"datachannel",o=>(r(o.channel,o.target),o))}function UD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function VD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Zs(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function qI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ct.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ct.resolve())})}function YI(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var fle=Object.freeze({__proto__:null,removeExtmapAllowMixed:VD,shimAddIceCandidateNullOrEmpty:qI,shimConnectionState:UD,shimMaxMessageSize:$I,shimParameterlessSetLocalDescription:YI,shimRTCIceCandidate:HI,shimRTCIceCandidateRelayProtocol:MD,shimSendThrowTypeError:KI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=Q3,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=GI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=GI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=GI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:fle,extractVersion:GI,disableLog:Jce,disableWarnings:Qce,sdp:hle};switch(o.browser){case"chrome":if(!hB||!ND||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=hB,qI(e,o),YI(e),rB(e,o),iB(e),ND(e,o),sB(e),uB(e,o),oB(e),aB(e),cB(e),dB(e,o),HI(e),MD(e),UD(e),$I(e,o),KI(e),VD(e,o);break;case"firefox":if(!bB||!DD||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=bB,qI(e,o),YI(e),fB(e,o),DD(e,o),pB(e),_B(e),mB(e),gB(e),EB(e),yB(e),vB(e),SB(e),TB(e),HI(e),UD(e),$I(e,o),KI(e);break;case"safari":if(!DB||!r.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=DB,qI(e,o),YI(e),PB(e),kB(e),CB(e),wB(e),RB(e),OB(e),IB(e),NB(e),HI(e),MD(e),$I(e,o),KI(e),VD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var FB=dc,ple=TypeError,jB=Bn.match(/firefox\/(\d+)/i),mle=!!jB&&+jB[1],gle=/MSIE|Trident/.test(Bn),BB=Bn.match(/AppleWebKit\/(\d+)\./),_le=!!BB&&+BB[1],Ele=Mn,WB=A,yle=as,vle=Io,zB=ri,Sle=function(e,r){if(!delete e[r])throw ple("Cannot delete property "+FB(r)+" of "+FB(e))},GB=ua,FD=d,Tle=e3,ble=gf,HB=mle,wle=gle,$B=hi,KB=_le,Em=[],qB=WB(Em.sort),Rle=WB(Em.push),Cle=FD(function(){Em.sort(void 0)}),Ile=FD(function(){Em.sort(null)}),Ale=ble("sort"),YB=!FD(function(){if($B)return $B<70;if(!(HB&&HB>3)){if(wle)return!0;if(KB)return KB<603;var e,r,i,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)Em.push({k:r+o,v:i})}for(Em.sort(function(u,h){return h.v-u.v}),o=0;o<Em.length;o++)r=Em[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Ele({target:"Array",proto:!0,forced:Cle||!Ile||!Ale||!YB},{sort:function(e){e!==void 0&&yle(e);var r=vle(this);if(YB)return e===void 0?qB(r):qB(r,e);var i,o,c=[],u=zB(r);for(o=0;o<u;o++)o in r&&Rle(c,r[o]);for(Tle(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:GB(m)>GB(_)?1:-1}}(e)),i=zB(c),o=0;o<i;)r[o]=c[o++];for(;o<u;)Sle(r,o++);return r}});var Ple=Wa("Array").sort,Ole=N,kle=Ple,jD=Array.prototype,Nle=function(e){var r=e.sort;return e===jD||Ole(jD,e)&&r===jD.sort?kle:r},$T=l(Nle),BD=j;Mn({global:!0,forced:BD.globalThis!==BD},{globalThis:BD});var XB=l(j),WD={exports:{}};(function(e,r){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",R="type",P="vendor",k="version",z="architecture",U="console",V="mobile",q="tablet",Y="smarttv",le="wearable",ge="embedded",Ee="Amazon",pe="Apple",Pe="ASUS",Ke="BlackBerry",lt="Browser",ht="Chrome",Sn="Firefox",Tn="Google",cr="Huawei",Qr="LG",Br="Microsoft",Xo="Motorola",je="Opera",rt="Samsung",Tt="Sharp",ze="Sony",x="Xiaomi",ie="Zebra",ue="Facebook",Ye="Chromium OS",Kt="Mac OS",nr=function(yi){for(var Vi={},Er=0;Er<yi.length;Er++)Vi[yi[Er].toUpperCase()]=yi[Er];return Vi},Ui=function(yi,Vi){return typeof yi===m&&ba(Vi).indexOf(ba(yi))!==-1},ba=function(yi){return yi.toLowerCase()},np=function(yi,Vi){if(typeof yi===m)return yi=yi.replace(/^\s\s*/,""),typeof Vi===u?yi:yi.substring(0,350)},X_=function(yi,Vi){for(var Er,Qa,Ih,Zr,Fn,wa,jm=0;jm<Vi.length&&!Fn;){var yd=Vi[jm],b$=Vi[jm+1];for(Er=Qa=0;Er<yd.length&&!Fn&&yd[Er];)if(Fn=yd[Er++].exec(yi))for(Ih=0;Ih<b$.length;Ih++)wa=Fn[++Qa],typeof(Zr=b$[Ih])===h&&Zr.length>0?Zr.length===2?typeof Zr[1]==c?this[Zr[0]]=Zr[1].call(this,wa):this[Zr[0]]=Zr[1]:Zr.length===3?typeof Zr[1]!==c||Zr[1].exec&&Zr[1].test?this[Zr[0]]=wa?wa.replace(Zr[1],Zr[2]):o:this[Zr[0]]=wa?Zr[1].call(this,wa,Zr[2]):o:Zr.length===4&&(this[Zr[0]]=wa?Zr[3].call(this,wa.replace(Zr[1],Zr[2])):o):this[Zr]=wa||o;jm+=2}},Yb=function(yi,Vi){for(var Er in Vi)if(typeof Vi[Er]===h&&Vi[Er].length>0){for(var Qa=0;Qa<Vi[Er].length;Qa++)if(Ui(Vi[Er][Qa],yi))return Er==="?"?o:Er}else if(Ui(Vi[Er],yi))return Er==="?"?o:Er;return yi},$P={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},KP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+lt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+lt],k],[/\bfocus\/([\w\.]+)/i],[k,[S,Sn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+lt]],[/fxios\/([-\w\.]+)/i],[k,[S,Sn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+lt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+lt],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ue],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,ht+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,ht+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+lt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,Yb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,Sn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[z,"amd64"]],[/(ia32(?=;))/i],[[z,ba]],[/((?:i[346]|x)86)[;\)]/i],[[z,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[z,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[z,"armhf"]],[/windows (ce|mobile); ppc;/i],[[z,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[z,/ower/,"",ba]],[/(sun4\w)[;\)]/i],[[z,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[z,ba]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[P,rt],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[P,rt],[R,V]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[P,pe],[R,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[P,pe],[R,q]],[/(macintosh);/i],[y,[P,pe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[P,Tt],[R,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[P,cr],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[P,cr],[R,V]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,V]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[P,x],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[P,"OPPO"],[R,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[P,"Vivo"],[R,V]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[P,"Realme"],[R,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[P,Xo],[R,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[P,Xo],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[P,Qr],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[P,Qr],[R,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[P,"Nokia"],[R,V]],[/(pixel c)\b/i],[y,[P,Tn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[P,Tn],[R,V]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[P,ze],[R,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[P,ze],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[P,"OnePlus"],[R,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[P,Ee],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[P,Ke],[R,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[P,Pe],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[P,Pe],[R,V]],[/(nexus 9)/i],[y,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[y,/_/g," "],[R,V]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[P,"Meizu"],[R,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,y,[R,V]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,y,[R,q]],[/(surface duo)/i],[y,[P,Br],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[P,"Fairphone"],[R,V]],[/(u304aa)/i],[y,[P,"AT&T"],[R,V]],[/\bsie-(\w*)/i],[y,[P,"Siemens"],[R,V]],[/\b(rct\w+) b/i],[y,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[y,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[y,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[y,[P,"ZTE"],[R,V]],[/\b(gen\d{3}) b.+49h/i],[y,[P,"Swiss"],[R,V]],[/\b(zur\d{3}) b/i],[y,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[y,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],y,[R,q]],[/\b(ns-?\w{0,9}) b/i],[y,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],y,[R,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],y,[R,V]],[/\b(ph-1) /i],[y,[P,"Essential"],[R,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[y,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[y,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[y,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,y,[R,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[P,Br],[R,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[P,ie],[R,V]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[P,rt],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,Qr],[R,Y]],[/(apple) ?tv/i],[P,[y,pe+" TV"],[R,Y]],[/crkey/i],[[y,ht+"cast"],[P,Tn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[P,Ee],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[P,Tt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[P,ze],[R,Y]],[/(mitv-\w{5}) bui/i],[y,[P,x],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,y,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,np],[y,np],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,y,[R,U]],[/droid.+; (shield) bui/i],[y,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[y,[P,ze],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[P,Br],[R,U]],[/((pebble))app/i],[P,y,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[P,pe],[R,le]],[/droid.+; (glass) \d/i],[y,[P,Tn],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[y,[P,ie],[R,le]],[/(quest( 2| pro)?)/i],[y,[P,ue],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ge]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[R,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,Yb,$P]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,Yb,$P]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Kt],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,Ke]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,Sn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,ht+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Ye],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},bl=function(yi,Vi){if(typeof yi===h&&(Vi=yi,yi=o),!(this instanceof bl))return new bl(yi,Vi).getResult();var Er=typeof i!==u&&i.navigator?i.navigator:o,Qa=yi||(Er&&Er.userAgent?Er.userAgent:""),Ih=Er&&Er.userAgentData?Er.userAgentData:o,Zr=Vi?function(Fn,wa){var jm={};for(var yd in Fn)wa[yd]&&wa[yd].length%2==0?jm[yd]=wa[yd].concat(Fn[yd]):jm[yd]=Fn[yd];return jm}(KP,Vi):KP;return this.getBrowser=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Qa,Zr.browser),Fn[_]=function(wa){return typeof wa===m?wa.replace(/[^\d\.]/g,"").split(".")[0]:o}(Fn[k]),Er&&Er.brave&&typeof Er.brave.isBrave==c&&(Fn[S]="Brave"),Fn},this.getCPU=function(){var Fn={};return Fn[z]=o,X_.call(Fn,Qa,Zr.cpu),Fn},this.getDevice=function(){var Fn={};return Fn[P]=o,Fn[y]=o,Fn[R]=o,X_.call(Fn,Qa,Zr.device),!Fn[R]&&Ih&&Ih.mobile&&(Fn[R]=V),Fn[y]=="Macintosh"&&Er&&typeof Er.standalone!==u&&Er.maxTouchPoints&&Er.maxTouchPoints>2&&(Fn[y]="iPad",Fn[R]=q),Fn},this.getEngine=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Qa,Zr.engine),Fn},this.getOS=function(){var Fn={};return Fn[S]=o,Fn[k]=o,X_.call(Fn,Qa,Zr.os),!Fn[S]&&Ih&&Ih.platform!="Unknown"&&(Fn[S]=Ih.platform.replace(/chrome os/i,Ye).replace(/macos/i,Kt)),Fn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Qa},this.setUA=function(Fn){return Qa=typeof Fn===m&&Fn.length>350?np(Fn,350):Fn,this},this.setUA(Qa),this};bl.VERSION="0.7.34",bl.BROWSER=nr([S,k,_]),bl.CPU=nr([z]),bl.DEVICE=nr([y,P,R,U,V,Y,q,le,ge]),bl.ENGINE=bl.OS=nr([S,k]),e.exports&&(r=e.exports=bl),r.UAParser=bl;var Fm=typeof i!==u&&(i.jQuery||i.Zepto);if(Fm&&!Fm.ua){var J_=new bl;Fm.ua=J_.getResult(),Fm.ua.get=function(){return J_.getUA()},Fm.ua.set=function(yi){J_.setUA(yi);var Vi=J_.getResult();for(var Er in Vi)Fm.ua[Er]=Vi[Er]}}})(typeof window=="object"?window:a)})(WD,WD.exports);var Dle=l(WD.exports),Lle=Ec,xle=fi,Mle=Vt,Ule=Yd,Vle=ur("iterator"),Fle=Object,jle=function(e){if(Mle(e))return!1;var r=Fle(e);return r[Vle]!==void 0||"@@iterator"in r||xle(Ule,Lle(r))},Ble=l(jle),JB=Gy.clear;Mn({global:!0,bind:!0,forced:j.clearImmediate!==JB},{clearImmediate:JB});var Wle=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",QB=j,zle=ne,Gle=Se,Hle=Wle,$le=Bn,Kle=hs,qle=dl,Yle=QB.Function,Xle=/MSIE .\./.test($le)||Hle&&function(){var e=QB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Jle=Mn,ZB=j,e5=Gy.set,Qle=function(e,r){var i=1;return Xle?function(o,c){var u=qle(arguments.length,1)>i,h=Gle(o)?o:Yle(o),m=u?Kle(arguments,i):[],_=u?function(){zle(h,this,m)}:h;return e(_)}:e},t5=ZB.setImmediate?Qle(e5):e5;Jle({global:!0,bind:!0,forced:ZB.setImmediate!==t5},{setImmediate:t5});var n5=l(vt.setImmediate),Zle=Mn,eue=Ka,tue=as,nue=dl,rue=_f,iue=j.process;Zle({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){nue(arguments.length,1),tue(e);var r=rue&&iue.domain;eue(r?r.bind(e):e)}});var r5=l(vt.queueMicrotask);function i5(e,r){return function(){return e.apply(r,arguments)}}const{toString:sue}=Object.prototype,{getPrototypeOf:zD}=Object,XI=(GD=Object.create(null),e=>{const r=sue.call(e);return GD[r]||(GD[r]=r.slice(8,-1).toLowerCase())});var GD;const od=e=>(e=e.toLowerCase(),r=>XI(r)===e),JI=e=>r=>typeof r===e,{isArray:mv}=Array,KT=JI("undefined"),s5=od("ArrayBuffer"),oue=JI("string"),fl=JI("function"),o5=JI("number"),QI=e=>e!==null&&typeof e=="object",ZI=e=>{if(XI(e)!=="object")return!1;const r=zD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Ble(e))},aue=od("Date"),cue=od("File"),lue=od("Blob"),uue=od("FileList"),due=od("URLSearchParams"),[hue,fue,pue,mue]=["ReadableStream","Request","Response","Headers"].map(od);function qT(e,r){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),mv(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],r.call(null,e[m],m,e)}}function a5(e,r){r=r.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],r===o.toLowerCase())return o;return null}const v_=XB!==void 0?XB:typeof self<"u"?self:typeof window<"u"?window:oE,c5=e=>!KT(e)&&e!==v_,gue=(HD=typeof Uint8Array<"u"&&zD(Uint8Array),e=>HD&&e instanceof HD);var HD;const _ue=od("HTMLFormElement"),l5=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),Eue=od("RegExp"),u5=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),o={};qT(i,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},$D="abcdefghijklmnopqrstuvwxyz",d5="0123456789",h5={DIGIT:d5,ALPHA:$D,ALPHA_DIGIT:$D+$D.toUpperCase()+d5},yue=od("AsyncFunction"),f5=(p5=typeof n5=="function",m5=fl(v_.postMessage),p5?n5:m5?(KD="axios@".concat(Math.random()),eA=[],v_.addEventListener("message",e=>{let{source:r,data:i}=e;r===v_&&i===KD&&eA.length&&eA.shift()()},!1),e=>{eA.push(e),v_.postMessage(KD,"*")}):e=>setTimeout(e));var p5,m5,KD,eA;const vue=r5!==void 0?r5.bind(v_):typeof process<"u"&&process.nextTick||f5;var at={isArray:mv,isArrayBuffer:s5,isBuffer:function(e){return e!==null&&!KT(e)&&e.constructor!==null&&!KT(e.constructor)&&fl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||fl(e.append)&&((r=XI(e))==="formdata"||r==="object"&&fl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&s5(e.buffer),r},isString:oue,isNumber:o5,isBoolean:e=>e===!0||e===!1,isObject:QI,isPlainObject:ZI,isReadableStream:hue,isRequest:fue,isResponse:pue,isHeaders:mue,isUndefined:KT,isDate:aue,isFile:cue,isBlob:lue,isRegExp:Eue,isFunction:fl,isStream:e=>QI(e)&&fl(e.pipe),isURLSearchParams:due,isTypedArray:gue,isFileList:uue,forEach:qT,merge:function e(){const{caseless:r}=c5(this)&&this||{},i={},o=(c,u)=>{const h=r&&a5(i,u)||u;ZI(i[h])&&ZI(c)?i[h]=e(i[h],c):ZI(c)?i[h]=e({},c):mv(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&qT(arguments[c],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return qT(r,(c,u)=>{i&&fl(c)?e[u]=i5(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Zs(e)?Zs(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=i!==!1&&zD(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:XI,kindOfTest:od,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(mv(e))return e;let r=e.length;if(!o5(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let i;const o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:_ue,hasOwnProperty:l5,hasOwnProp:l5,reduceDescriptors:u5,freezeMethods:e=>{u5(e,(r,i)=>{if(fl(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];fl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return mv(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:a5,global:v_,isContextDefined:c5,ALPHABET:h5,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h5.ALPHA_DIGIT,i="";const{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&fl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),i=(o,c)=>{if(QI(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=mv(o)?[]:{};return qT(o,(h,m)=>{const _=i(h,c+1);!KT(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:yue,isThenable:e=>e&&(QI(e)||fl(e))&&fl(e.then)&&fl(e.catch),setImmediate:f5,asap:vue};function er(e,r,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}at.inherits(er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:at.toJSONObject(this.config),code:this.code,status:this.status}}});const g5=er.prototype,_5={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{_5[e]={value:e}}),Object.defineProperties(er,_5),Object.defineProperty(g5,"isAxiosError",{value:!0}),er.from=(e,r,i,o,c,u)=>{const h=Object.create(g5);return at.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),er.call(h,e.message,r,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function qD(e){return at.isPlainObject(e)||at.isArray(e)}function E5(e){return at.endsWith(e,"[]")?e.slice(0,-2):e}function y5(e,r,i){return e?e.concat(r).map(function(o,c){return o=E5(o),!i&&c?"["+o+"]":o}).join(i?".":""):r}const Sue=at.toFlatObject(at,{},null,function(e){return/^is[A-Z]/.test(e)});function tA(e,r,i){if(!at.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(i=at.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!at.isUndefined(k[P])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&at.isSpecCompliantForm(r);if(!at.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(at.isDate(P))return P.toISOString();if(!m&&at.isBlob(P))throw new er("Blob is not supported. Use a Buffer instead.");return at.isArrayBuffer(P)||at.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function y(P,k,z){let U=P;if(P&&!z&&typeof P=="object"){if(at.endsWith(k,"{}"))k=o?k:k.slice(0,-2),P=JSON.stringify(P);else if(at.isArray(P)&&function(V){return at.isArray(V)&&!V.some(qD)}(P)||(at.isFileList(P)||at.endsWith(k,"[]"))&&(U=at.toArray(P)))return k=E5(k),U.forEach(function(V,q){!at.isUndefined(V)&&V!==null&&r.append(h===!0?y5([k],q,u):h===null?k:k+"[]",_(V))}),!1}return!!qD(P)||(r.append(y5(z,k,u),_(P)),!1)}const S=[],R=Object.assign(Sue,{defaultVisitor:y,convertValue:_,isVisitable:qD});if(!at.isObject(e))throw new TypeError("data must be an object");return function P(k,z){if(!at.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+z.join("."));S.push(k),at.forEach(k,function(U,V){(!(at.isUndefined(U)||U===null)&&c.call(r,U,at.isString(V)?Zs(V).call(V):V,z,R))===!0&&P(U,z?z.concat(V):[V])}),S.pop()}}(e),r}function v5(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function YD(e,r){this._pairs=[],e&&tA(e,this,r)}const S5=YD.prototype;function Tue(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function T5(e,r,i){if(!r)return e;const o=i&&i.encode||Tue;at.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(r,i):at.isURLSearchParams(r)?r.toString():new YD(r,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}S5.append=function(e,r){this._pairs.push([e,r])},S5.toString=function(e){const r=e?function(i){return e.call(this,i,v5)}:v5;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var b5=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){at.forEach(this.handlers,function(r){r!==null&&e(r)})}},w5={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},R5={exports:{}},bue=Mn,wue=tt,C5=et.f;bue({target:"Object",stat:!0,forced:Object.defineProperty!==C5,sham:!wue},{defineProperty:C5});var I5=vt.Object,Rue=R5.exports=function(e,r,i){return I5.defineProperty(e,r,i)};I5.defineProperty.sham&&(Rue.sham=!0);var A5=l(R5.exports),Cue=TypeError,P5=Vg,Iue=a_,Aue=_t,Pue=ur("species"),O5=Array,Oue=function(e){var r;return P5(e)&&(r=e.constructor,(Iue(r)&&(r===O5||P5(r.prototype))||Aue(r)&&(r=r[Pue])===null)&&(r=void 0)),r===void 0?O5:r},k5=function(e,r){return new(Oue(e))(r===0?0:r)},kue=d,Nue=hi,Due=ur("species"),N5=function(e){return Nue>=51||!kue(function(){var r=[];return(r.constructor={})[Due]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Lue=Mn,xue=d,Mue=Vg,Uue=_t,Vue=Io,Fue=ri,D5=function(e){if(e>9007199254740991)throw Cue("Maximum allowed index exceeded");return e},L5=kI,jue=k5,Bue=N5,Wue=hi,x5=ur("isConcatSpreadable"),zue=Wue>=51||!xue(function(){var e=[];return e[x5]=!1,e.concat()[0]!==e}),Gue=function(e){if(!Uue(e))return!1;var r=e[x5];return r!==void 0?!!r:Mue(e)};Lue({target:"Array",proto:!0,forced:!zue||!Bue("concat")},{concat:function(e){var r,i,o,c,u,h=Vue(this),m=jue(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Gue(u=r===-1?h:arguments[r]))for(c=Fue(u),D5(_+c),i=0;i<c;i++,_++)i in u&&L5(m,_,u[i]);else D5(_+1),L5(m,_++,u);return m.length=_,m}});var M5={},Hue=Z,$ue=ve,U5=$d.f,Kue=Q1,V5=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];M5.f=function(e){return V5&&Hue(e)=="Window"?function(r){try{return U5(r)}catch{return Kue(V5)}}(e):U5($ue(e))};var gv={},que=ur;gv.f=que;var F5=vt,Yue=fi,Xue=gv,Jue=et.f,ms=function(e){var r=F5.Symbol||(F5.Symbol={});Yue(r,e)||Jue(r,e,{value:Xue.f(e)})},Que=Ce,Zue=Xt,ede=ur,tde=Qu,j5=function(){var e=Zue("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=ede("toPrimitive");r&&!r[o]&&tde(r,o,function(c){return Que(i,this)},{})},nde=Oe,rde=yn,ide=Io,sde=ri,ode=k5,B5=A([].push),ade=function(e){var r=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,R){for(var P,k,z=ide(_),U=rde(z),V=nde(y,S),q=sde(U),Y=0,le=R||ode,ge=r?le(_,q):i||h?le(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=V(P=U[Y],Y,z),e))if(r)ge[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return P;case 6:return Y;case 2:B5(ge,P)}else switch(e){case 4:return!1;case 7:B5(ge,P)}return u?-1:o||c?c:ge}},W5={forEach:ade(0)},nA=Mn,XD=j,JD=Ce,cde=A,_v=tt,Ev=uo,lde=d,Eo=fi,ude=N,QD=cn,rA=ve,ZD=ja,dde=ua,eL=Qe,YT=Fo,z5=Sc,hde=$d,G5=M5,fde=vc,H5=Ve,$5=et,pde=ry,K5=Xe,q5=Qu,mde=Py,tL=Va,Y5=yc,X5=Fd,gde=ur,_de=gv,Ede=ms,yde=j5,vde=Zu,J5=Ju,iA=W5.forEach,Oc=jg("hidden"),sA="Symbol",XT="prototype",Sde=J5.set,Q5=J5.getterFor(sA),ad=Object[XT],S_=XD.Symbol,oA=S_&&S_[XT],Tde=XD.TypeError,nL=XD.QObject,Z5=H5.f,T_=$5.f,e6=G5.f,bde=K5.f,t6=cde([].push),jf=tL("symbols"),JT=tL("op-symbols"),wde=tL("wks"),rL=!nL||!nL[XT]||!nL[XT].findChild,iL=_v&&lde(function(){return YT(T_({},"a",{get:function(){return T_(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=Z5(ad,r);o&&delete ad[r],T_(e,r,i),o&&e!==ad&&T_(ad,r,o)}:T_,sL=function(e,r){var i=jf[e]=YT(oA);return Sde(i,{type:sA,tag:e,description:r}),_v||(i.description=r),i},aA=function(e,r,i){e===ad&&aA(JT,r,i),QD(e);var o=ZD(r);return QD(i),Eo(jf,o)?(i.enumerable?(Eo(e,Oc)&&e[Oc][o]&&(e[Oc][o]=!1),i=YT(i,{enumerable:eL(0,!1)})):(Eo(e,Oc)||T_(e,Oc,eL(1,{})),e[Oc][o]=!0),iL(e,o,i)):T_(e,o,i)},oL=function(e,r){QD(e);var i=rA(r),o=z5(i).concat(s6(i));return iA(o,function(c){_v&&!JD(n6,i,c)||aA(e,c,i[c])}),e},n6=function(e){var r=ZD(e),i=JD(bde,this,r);return!(this===ad&&Eo(jf,r)&&!Eo(JT,r))&&(!(i||!Eo(this,r)||!Eo(jf,r)||Eo(this,Oc)&&this[Oc][r])||i)},r6=function(e,r){var i=rA(e),o=ZD(r);if(i!==ad||!Eo(jf,o)||Eo(JT,o)){var c=Z5(i,o);return!c||!Eo(jf,o)||Eo(i,Oc)&&i[Oc][o]||(c.enumerable=!0),c}},i6=function(e){var r=e6(rA(e)),i=[];return iA(r,function(o){Eo(jf,o)||Eo(Y5,o)||t6(i,o)}),i},s6=function(e){var r=e===ad,i=e6(r?JT:rA(e)),o=[];return iA(i,function(c){!Eo(jf,c)||r&&!Eo(ad,c)||t6(o,jf[c])}),o};Ev||(S_=function(){if(ude(oA,this))throw Tde("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?dde(arguments[0]):void 0,r=X5(e),i=function(o){this===ad&&JD(i,JT,o),Eo(this,Oc)&&Eo(this[Oc],r)&&(this[Oc][r]=!1),iL(this,r,eL(1,o))};return _v&&rL&&iL(ad,r,{configurable:!0,set:i}),sL(r,e)},q5(oA=S_[XT],"toString",function(){return Q5(this).tag}),q5(S_,"withoutSetter",function(e){return sL(X5(e),e)}),K5.f=n6,$5.f=aA,pde.f=oL,H5.f=r6,hde.f=G5.f=i6,fde.f=s6,_de.f=function(e){return sL(gde(e),e)},_v&&mde(oA,"description",{configurable:!0,get:function(){return Q5(this).description}})),nA({global:!0,wrap:!0,forced:!Ev,sham:!Ev},{Symbol:S_}),iA(z5(wde),function(e){Ede(e)}),nA({target:sA,stat:!0,forced:!Ev},{useSetter:function(){rL=!0},useSimple:function(){rL=!1}}),nA({target:"Object",stat:!0,forced:!Ev,sham:!_v},{create:function(e,r){return r===void 0?YT(e):oL(YT(e),r)},defineProperty:aA,defineProperties:oL,getOwnPropertyDescriptor:r6}),nA({target:"Object",stat:!0,forced:!Ev},{getOwnPropertyNames:i6}),yde(),vde(S_,sA),Y5[Oc]=!0;var o6=uo&&!!Symbol.for&&!!Symbol.keyFor,Rde=Mn,Cde=Xt,Ide=fi,Ade=ua,a6=Va,Pde=o6,aL=a6("string-to-symbol-registry"),Ode=a6("symbol-to-string-registry");Rde({target:"Symbol",stat:!0,forced:!Pde},{for:function(e){var r=Ade(e);if(Ide(aL,r))return aL[r];var i=Cde("Symbol")(r);return aL[r]=i,Ode[i]=r,i}});var kde=Mn,Nde=fi,Dde=nl,Lde=dc,xde=o6,c6=Va("symbol-to-string-registry");kde({target:"Symbol",stat:!0,forced:!xde},{keyFor:function(e){if(!Dde(e))throw TypeError(Lde(e)+" is not a symbol");if(Nde(c6,e))return c6[e]}});var l6=Vg,Mde=Se,u6=Z,Ude=ua,d6=A([].push),Vde=Mn,h6=Xt,f6=ne,Fde=Ce,QT=A,p6=d,m6=Se,g6=nl,_6=hs,jde=function(e){if(Mde(e))return e;if(l6(e)){for(var r=e.length,i=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?d6(i,c):typeof c!="number"&&u6(c)!="Number"&&u6(c)!="String"||d6(i,Ude(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(l6(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},Bde=uo,Wde=String,ym=h6("JSON","stringify"),cA=QT(/./.exec),E6=QT("".charAt),zde=QT("".charCodeAt),Gde=QT("".replace),Hde=QT(1 .toString),$de=/[\uD800-\uDFFF]/g,y6=/^[\uD800-\uDBFF]$/,v6=/^[\uDC00-\uDFFF]$/,S6=!Bde||p6(function(){var e=h6("Symbol")();return ym([e])!="[null]"||ym({a:e})!="{}"||ym(Object(e))!="{}"}),T6=p6(function(){return ym("\uDF06\uD834")!=='"\\udf06\\ud834"'||ym("\uDEAD")!=='"\\udead"'}),Kde=function(e,r){var i=_6(arguments),o=jde(r);if(m6(o)||e!==void 0&&!g6(e))return i[1]=function(c,u){if(m6(o)&&(u=Fde(o,this,Wde(c),u)),!g6(u))return u},f6(ym,null,i)},qde=function(e,r,i){var o=E6(i,r-1),c=E6(i,r+1);return cA(y6,e)&&!cA(v6,c)||cA(v6,e)&&!cA(y6,o)?"\\u"+Hde(zde(e,0),16):e};ym&&Vde({target:"JSON",stat:!0,forced:S6||T6},{stringify:function(e,r,i){var o=_6(arguments),c=f6(S6?Kde:ym,null,o);return T6&&typeof c=="string"?Gde(c,$de,qde):c}});var b6=vc,Yde=Io;Mn({target:"Object",stat:!0,forced:!uo||d(function(){b6.f(1)})},{getOwnPropertySymbols:function(e){var r=b6.f;return r?r(Yde(e)):[]}}),ms("asyncIterator"),ms("hasInstance"),ms("isConcatSpreadable"),ms("iterator"),ms("match"),ms("matchAll"),ms("replace"),ms("search"),ms("species"),ms("split");var Xde=j5;ms("toPrimitive"),Xde();var Jde=Xt,Qde=Zu;ms("toStringTag"),Qde(Jde("Symbol"),"Symbol"),ms("unscopables"),Zu(j.JSON,"JSON",!0);var Zde=vt.Symbol,ehe=ur,the=et.f,w6=ehe("metadata"),R6=Function.prototype;R6[w6]===void 0&&the(R6,w6,{value:null}),ms("dispose"),ms("metadata");var nhe=Zde;ms("asyncDispose");var rhe=A,cL=Xt("Symbol"),ihe=cL.keyFor,she=rhe(cL.prototype.valueOf),C6=cL.isRegisteredSymbol||function(e){try{return ihe(she(e))!==void 0}catch{return!1}};Mn({target:"Symbol",stat:!0},{isRegisteredSymbol:C6});for(var ohe=Va,I6=Xt,ahe=A,che=nl,lhe=ur,lA=I6("Symbol"),A6=lA.isWellKnownSymbol,P6=I6("Object","getOwnPropertyNames"),uhe=ahe(lA.prototype.valueOf),O6=ohe("wks"),lL=0,k6=P6(lA),dhe=k6.length;lL<dhe;lL++)try{var N6=k6[lL];che(lA[N6])&&lhe(N6)}catch{}var D6=function(e){if(A6&&A6(e))return!0;try{for(var r=uhe(e),i=0,o=P6(O6),c=o.length;i<c;i++)if(O6[o[i]]==r)return!0}catch{}return!1};Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:D6}),ms("matcher"),ms("observable"),Mn({target:"Symbol",stat:!0},{isRegistered:C6}),Mn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:D6}),ms("metadataKey"),ms("patternMatch"),ms("replaceAll");var yv=l(nhe),L6=l(gv.f("iterator"));function ZT(e){return ZT=typeof yv=="function"&&typeof L6=="symbol"?function(r){return typeof r}:function(r){return r&&typeof yv=="function"&&r.constructor===yv&&r!==yv.prototype?"symbol":typeof r},ZT(e)}var hhe=l(gv.f("toPrimitive"));function fhe(e){var r=function(i,o){if(ZT(i)!=="object"||i===null)return i;var c=i[hhe];if(c!==void 0){var u=c.call(i,o);if(ZT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return ZT(r)==="symbol"?r:String(r)}function $(e,r,i){return(r=fhe(r))in e?A5(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var x6=l(Kae),phe={isBrowser:!0,classes:{URLSearchParams:x6!==void 0?x6:YD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const uL=typeof window<"u"&&typeof document<"u",dL=typeof navigator=="object"&&navigator||void 0,mhe=uL&&(!dL||["ReactNative","NativeScript","NS"].indexOf(dL.product)<0),ghe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",_he=uL&&window.location.href||"http://localhost";function M6(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function U6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?M6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):M6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Ea=U6(U6({},Object.freeze({__proto__:null,hasBrowserEnv:uL,hasStandardBrowserEnv:mhe,hasStandardBrowserWebWorkerEnv:ghe,navigator:dL,origin:_he})),phe),Ehe=cn,yhe=Ce,vhe=fi,She=N,The=function(){var e=Ehe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},V6=RegExp.prototype,F6=function(e){var r=e.flags;return r!==void 0||"flags"in V6||vhe(e,"flags")||!She(V6,e)?r:yhe(The,e)},bhe=K1.charAt,j6=Ce,whe=cn,Rhe=Se,Che=Z,Ihe=/./.exec,Ahe=TypeError,Phe=Mn,B6=Ce,W6=ce,Ohe=Sy,uA=Cy,z6=Qt,G6=xt,eb=ua,khe=cn,Nhe=Vt,Dhe=Z,Lhe=dC,H6=F6,xhe=hc,Mhe=d,Uhe=$i,Vhe=function(e,r,i){return r+(i?bhe(e,r).length:1)},Fhe=function(e,r){var i=e.exec;if(Rhe(i)){var o=j6(i,e,r);return o!==null&&whe(o),o}if(Che(e)==="RegExp")return j6(Ihe,e,r);throw Ahe("RegExp#exec called on incompatible receiver")},$6=Ju,jhe=ur("matchAll"),K6="RegExp String",q6=K6+" Iterator",Bhe=$6.set,Whe=$6.getterFor(q6),zhe=TypeError,hL=W6("".indexOf),dA=W6("".matchAll),fL=!!dA&&!Mhe(function(){dA("a",/./)}),Ghe=Ohe(function(e,r,i,o){Bhe(this,{type:q6,regexp:e,string:r,global:i,unicode:o,done:!1})},K6,function(){var e=Whe(this);if(e.done)return uA(void 0,!0);var r=e.regexp,i=e.string,o=Fhe(r,i);return o===null?(e.done=!0,uA(void 0,!0)):e.global?(eb(o[0])===""&&(r.lastIndex=Vhe(i,G6(r.lastIndex),e.unicode)),uA(o,!1)):(e.done=!0,uA(o,!1))}),Y6=function(e){var r,i,o,c=khe(this),u=eb(e),h=Uhe(c,RegExp),m=eb(H6(c));return r=new h(h===RegExp?c.source:c,m),i=!!~hL(m,"g"),o=!!~hL(m,"u"),r.lastIndex=G6(c.lastIndex),new Ghe(r,u,i,o)};Phe({target:"String",proto:!0,forced:fL},{matchAll:function(e){var r,i,o,c,u=z6(this);if(Nhe(e)){if(fL)return dA(u,e)}else{if(Lhe(e)&&(r=eb(z6(H6(e))),!~hL(r,"g")))throw zhe("`.matchAll` does not allow non-global regexes");if(fL)return dA(u,e);if((o=xhe(e,jhe))===void 0&&Dhe(e)=="RegExp"&&(o=Y6),o)return B6(o,e,u)}return i=eb(u),c=new RegExp(e,"g"),B6(Y6,c,i)}});var Hhe=Wa("String").matchAll,$he=N,Khe=Hhe,pL=String.prototype,qhe=function(e){var r=e.matchAll;return typeof e=="string"||e===pL||$he(pL,e)&&r===pL.matchAll?Khe:r},Yhe=l(qhe);function X6(e){function r(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&at.isArray(c)?c.length:h,_?(at.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&at.isObject(c[h])||(c[h]=[]),r(i,o,c[h],u)&&at.isArray(c[h])&&(c[h]=function(y){const S={},R=Object.keys(y);let P;const k=R.length;let z;for(P=0;P<k;P++)z=R[P],S[z]=y[z];return S}(c[h])),!m)}if(at.isFormData(e)&&at.isFunction(e.entries)){const i={};return at.forEachEntry(e,(o,c)=>{r(function(u){return Yhe(at).call(at,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const mL={transitional:w5,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",o=i.indexOf("application/json")>-1,c=at.isObject(e);if(c&&at.isHTMLForm(e)&&(e=new FormData(e)),at.isFormData(e))return o?JSON.stringify(X6(e)):e;if(at.isArrayBuffer(e)||at.isBuffer(e)||at.isStream(e)||at.isFile(e)||at.isBlob(e)||at.isReadableStream(e))return e;if(at.isArrayBufferView(e))return e.buffer;if(at.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return tA(h,new Ea.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,R){return Ea.isNode&&at.isBuffer(_)?(this.append(y,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=at.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return tA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(at.isString(h))try{return(m||JSON.parse)(h),Zs(at).call(at,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||mL.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(at.isResponse(e)||at.isReadableStream(e))return e;if(e&&at.isString(e)&&(i&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?er.from(u,er.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ea.classes.FormData,Blob:Ea.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};at.forEach(["delete","get","head","post","put","patch"],e=>{mL.headers[e]={}});var gL=mL;const Xhe=at.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),J6=Symbol("internals");function tb(e){var r;return e&&Zs(r=String(e)).call(r).toLowerCase()}function hA(e){return e===!1||e==null?e:at.isArray(e)?e.map(hA):String(e)}function _L(e,r,i,o,c){return at.isFunction(o)?o.call(this,r,i):(c&&(r=i),at.isString(r)?at.isString(o)?r.indexOf(o)!==-1:at.isRegExp(o)?o.test(r):void 0:void 0)}class fA{constructor(r){r&&this.set(r)}set(r,i,o){const c=this;function u(_,y,S){const R=tb(y);if(!R)throw new Error("header name must be a non-empty string");const P=at.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||y]=hA(_))}const h=(_,y)=>at.forEach(_,(S,R)=>u(S,R,y));if(at.isPlainObject(r)||r instanceof this.constructor)h(r,i);else if(at.isString(r)&&(r=Zs(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Zs(m=r).call(m)))h((_=>{const y={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var z,U;P=k.indexOf(":"),S=Zs(z=k.substring(0,P)).call(z).toLowerCase(),R=Zs(U=k.substring(P+1)).call(U),!S||y[S]&&Xhe[S]||(S==="set-cookie"?y[S]?y[S].push(R):y[S]=[R]:y[S]=y[S]?y[S]+", "+R:R)}),y})(r),i);else if(at.isHeaders(r))for(const[_,y]of r.entries())u(y,_,o);else r!=null&&u(i,r,o);var m;return this}get(r,i){if(r=tb(r)){const o=at.findKey(this,r);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(at.isFunction(i))return i.call(this,c,o);if(at.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=tb(r)){const o=at.findKey(this,r);return!(!o||this[o]===void 0||i&&!_L(0,this[o],o,i))}return!1}delete(r,i){const o=this;let c=!1;function u(h){if(h=tb(h)){const m=at.findKey(o,h);!m||i&&!_L(0,o[m],m,i)||(delete o[m],c=!0)}}return at.isArray(r)?r.forEach(u):u(r),c}clear(r){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];r&&!_L(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const i=this,o={};return at.forEach(this,(c,u)=>{var h;const m=at.findKey(o,u);if(m)return i[m]=hA(c),void delete i[u];const _=r?function(y){return Zs(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):Zs(h=String(u)).call(h);_!==u&&delete i[u],i[_]=hA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return at.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=r&&at.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(r){const i=(this[J6]=this[J6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=tb(u);i[h]||(function(m,_){const y=at.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(o,u),i[h]=!0)}return at.isArray(r)?r.forEach(c):c(r),this}}fA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),at.reduceDescriptors(fA.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(c){this[o]=c}}}),at.freezeMethods(fA);var cd=fA;function EL(e,r){const i=this||gL,o=r||i,c=cd.from(o.headers);let u=o.data;return at.forEach(e,function(h){u=h.call(i,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function Q6(e){return!(!e||!e.__CANCEL__)}function vv(e,r,i){er.call(this,e??"canceled",er.ERR_CANCELED,r,i),this.name="CanceledError"}function Z6(e,r,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new er("Request failed with status code "+i.status,[er.ERR_BAD_REQUEST,er.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}at.inherits(vv,er,{__CANCEL__:!0});const pA=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),z=_[R];y||(y=k),m[S]=P,_[S]=k;let U=R,V=0;for(;U!==S;)V+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-y<h)return;const q=z&&k-z;return q?Math.round(1e3*V/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const R=function(P){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-y;for(var z=arguments.length,U=new Array(z),V=0;V<z;V++)U[V]=arguments[V];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},i)},eW=(e,r)=>{const i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},tW=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return at.asap(()=>e(...i))};var Jhe=Ea.hasStandardBrowserEnv?((e,r)=>i=>(i=new zI(i,Ea.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new zI(Ea.origin),Ea.navigator&&/(msie|trident)/i.test(Ea.navigator.userAgent)):()=>!0,Qhe=Ea.hasStandardBrowserEnv?{write(e,r,i,o,c,u){const h=[e+"="+encodeURIComponent(r)];at.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),at.isString(o)&&h.push("path="+o),at.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function nW(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function rW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const iW=e=>e instanceof cd?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?rW(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):rW(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function b_(e,r){r=r||{};const i={};function o(y,S,R,P){return at.isPlainObject(y)&&at.isPlainObject(S)?at.merge.call({caseless:P},y,S):at.isPlainObject(S)?at.merge({},S):at.isArray(S)?S.slice():S}function c(y,S,R,P){return at.isUndefined(S)?at.isUndefined(y)?void 0:o(void 0,y,0,P):o(y,S,0,P)}function u(y,S){if(!at.isUndefined(S))return o(void 0,S)}function h(y,S){return at.isUndefined(S)?at.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,R){return R in r?o(y,S):R in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,R)=>c(iW(y),iW(S),0,!0)};return at.forEach(Object.keys(Object.assign({},e,r)),function(y){const S=_[y]||c,R=S(e[y],r[y],y);at.isUndefined(R)&&S!==m||(i[y]=R)}),i}var sW=e=>{const r=b_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=cd.from(m),r.url=T5(nW(r.baseURL,r.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),at.isFormData(o)){if(Ea.hasStandardBrowserEnv||Ea.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(R=>Zs(R).call(R)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(Ea.hasStandardBrowserEnv&&(c&&at.isFunction(c)&&(c=c(r)),c||c!==!1&&Jhe(r.url))){const y=u&&h&&Qhe.read(h);y&&m.set(u,y)}return r},Zhe=typeof XMLHttpRequest<"u"&&function(e){return new ct(function(r,i){const o=sW(e);let c=o.data;const u=cd.from(o.headers).normalize();let h,m,_,y,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=o;function z(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const Y=cd.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());Z6(function(le){r(le),z()},function(le){i(le),z()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(i(new er("Request aborted",er.ECONNABORTED,e,U)),U=null)},U.onerror=function(){i(new er("Network Error",er.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||w5;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),i(new er(Y,le.clarifyTimeoutError?er.ETIMEDOUT:er.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&at.forEach(u.toJSON(),function(Y,le){U.setRequestHeader(le,Y)}),at.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=pA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,y]=pA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(i(!Y||Y.type?new vv(null,e,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return le&&le[1]||""}(o.url);q&&Ea.protocols.indexOf(q)===-1?i(new er("Unsupported protocol "+q+":",er.ERR_BAD_REQUEST,e)):U.send(c||null)})},efe=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof er?S:new vv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new er("timeout ".concat(r," of ms exceeded"),er.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>at.asap(m),_}},tfe=J4,nfe=hl;Mn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=nfe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var rfe=hl,ife=rh;Mn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=rfe.f(this),i=ife(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var yL=l(tfe),oW=gv.f("asyncIterator"),sfe=l(oW);function vL(e,r){this.v=e,this.k=r}function nb(e){var r,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof vL;yL.resolve(y?_.v:_).then(function(S){if(y){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(u,h){return new yL(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(r=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function pl(e){return function(){return new nb(e.apply(this,arguments))}}function Rn(e){return new vL(e,0)}function mA(e){var r={},i=!1;function o(c,u){return i=!0,{done:!1,value:new vL(u=new yL(function(h){h(e[c](u))}),1)}}return r[yv!==void 0&&L6||"@@iterator"]=function(){return this},r.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return i?(i=!1,c):o("return",c)}),r}nb.prototype[typeof yv=="function"&&sfe||"@@asyncIterator"]=function(){return this},nb.prototype.next=function(e){return this._invoke("next",e)},nb.prototype.throw=function(e){return this._invoke("throw",e)},nb.prototype.return=function(e){return this._invoke("return",e)};var SL=l(oW);function TL(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=SL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new gA(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function gA(e){function r(i){if(Object(i)!==i)return ct.reject(new TypeError(i+" is not an object."));var o=i.done;return ct.resolve(i.value).then(function(c){return{value:c,done:o}})}return gA=function(i){this.s=i,this.n=i.next},gA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ct.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ct.reject(i):r(o.apply(this.s,arguments))}},new gA(e)}const ofe=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,c=0;for(;c<i;)o=c+r,yield e.slice(c,o),c=o},afe=function(){var e=pl(function*(r,i){var o,c=!1,u=!1;try{for(var h,m=TL(cfe(r));c=!(h=yield Rn(m.next())).done;c=!1){const _=h.value;yield*mA(TL(ofe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Rn(m.return()))}finally{if(u)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),cfe=function(){var e=pl(function*(r){if(r[SL])return void(yield*mA(TL(r)));const i=r.getReader();try{for(;;){const{done:o,value:c}=yield Rn(i.read());if(o)break;yield c}}finally{yield Rn(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),aW=(e,r,i,o)=>{const c=afe(e,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let R=S.byteLength;if(i){let P=h+=R;i(P)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function cW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lW(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cW(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const _A=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",uW=_A&&typeof ReadableStream=="function",lfe=_A&&(typeof TextEncoder=="function"?(dW=new TextEncoder,e=>dW.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var dW;const hW=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},ufe=uW&&hW(()=>{let e=!1;const r=new Request(Ea.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),bL=uW&&hW(()=>at.isReadableStream(new Response("").body)),EA={stream:bL&&(e=>e.body)};var fW;_A&&(fW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!EA[e]&&(EA[e]=at.isFunction(fW[e])?r=>r[e]():(r,i)=>{throw new er("Response type '".concat(e,"' is not supported"),er.ERR_NOT_SUPPORT,i)})}));const dfe=async(e,r)=>{const i=at.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:at.isBlob(o)?o.size:at.isSpecCompliantForm(o)?(await new Request(Ea.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:at.isArrayBufferView(o)||at.isArrayBuffer(o)?o.byteLength:(at.isURLSearchParams(o)&&(o+=""),at.isString(o)?(await lfe(o)).byteLength:void 0))(r)};var hfe=_A&&(async e=>{let{url:r,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:R="same-origin",fetchOptions:P}=sW(e);y=y?(y+"").toLowerCase():"text";let k,z=efe([c,u&&u.toAbortSignal()],h);const U=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let V;try{if(_&&ufe&&i!=="get"&&i!=="head"&&(V=await dfe(S,o))!==0){let Ee,pe=new Request(r,{method:"POST",body:o,duplex:"half"});if(at.isFormData(o)&&(Ee=pe.headers.get("content-type"))&&S.setContentType(Ee),pe.body){const[Pe,Ke]=eW(V,pA(tW(_)));o=aW(pe.body,65536,Pe,Ke)}}at.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,lW(lW({},P),{},{signal:z,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const le=bL&&(y==="stream"||y==="response");if(bL&&(m||le&&U)){const Ee={};["status","statusText","headers"].forEach(lt=>{Ee[lt]=Y[lt]});const pe=at.toFiniteNumber(Y.headers.get("content-length")),[Pe,Ke]=m&&eW(pe,pA(tW(m),!0))||[];Y=new Response(aW(Y.body,65536,Pe,()=>{Ke&&Ke(),U&&U()}),Ee)}y=y||"text";let ge=await EA[at.findKey(EA,y)||"text"](Y,e);return!le&&U&&U(),await new ct((Ee,pe)=>{Z6(Ee,pe,{data:ge,headers:cd.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new er("Network Error",er.ERR_NETWORK,e,k),{cause:q.cause||q}):er.from(q,q&&q.code,e,k)}});const wL={http:null,xhr:Zhe,fetch:hfe};at.forEach(wL,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const pW=e=>"- ".concat(e),ffe=e=>at.isFunction(e)||e===null||e===!1;var mW={getAdapter:e=>{e=at.isArray(e)?e:[e];const{length:r}=e;let i,o;const c={};for(let u=0;u<r;u++){let h;if(i=e[u],o=i,!ffe(i)&&(o=wL[(h=String(i)).toLowerCase()],o===void 0))throw new er("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new er("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(pW).join(`
`):" "+pW(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:wL};function RL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new vv(null,e)}function gW(e){return RL(e),e.headers=cd.from(e.headers),e.data=EL.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),mW.getAdapter(e.adapter||gL.adapter)(e).then(function(r){return RL(e),r.data=EL.call(e,e.transformResponse,r),r.headers=cd.from(r.headers),r},function(r){return Q6(r)||(RL(e),r&&r.response&&(r.response.data=EL.call(e,e.transformResponse,r.response),r.response.headers=cd.from(r.response.headers))),ct.reject(r)})}const _W="1.7.9",yA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{yA[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const EW={};yA.transitional=function(e,r,i){function o(c,u){return"[Axios v"+_W+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new er(o(u," has been removed"+(r?" in "+r:"")),er.ERR_DEPRECATED);return r&&!EW[u]&&(EW[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},yA.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var vA={assertOptions:function(e,r,i){if(typeof e!="object")throw new er("options must be an object",er.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new er("option "+u+" must be "+_,er.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new er("Unknown option "+u,er.ERR_BAD_OPTION)}},validators:yA};const lh=vA.validators;let SA=class{constructor(e){this.defaults=e,this.interceptors={request:new b5,response:new b5}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=b_(this.defaults,r);const{transitional:i,paramsSerializer:o,headers:c}=r;i!==void 0&&vA.assertOptions(i,{silentJSONParsing:lh.transitional(lh.boolean),forcedJSONParsing:lh.transitional(lh.boolean),clarifyTimeoutError:lh.transitional(lh.boolean)},!1),o!=null&&(at.isFunction(o)?r.paramsSerializer={serialize:o}:vA.assertOptions(o,{encode:lh.function,serialize:lh.function},!0)),vA.assertOptions(r,{baseUrl:lh.spelling("baseURL"),withXsrfToken:lh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&at.merge(c.common,c[r.method]);c&&at.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=cd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[gW.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=ct.resolve(r);R<S;)y=y.then(k[R++],k[R++]);return y}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],z=h[R++];try{P=k(P)}catch(U){z.call(this,U);break}}try{y=gW.call(this,P)}catch(k){return ct.reject(k)}for(R=0,S=_.length;R<S;)y=y.then(_[R++],_[R++]);return y}getUri(e){return T5(nW((e=b_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};at.forEach(["delete","get","head","options"],function(e){SA.prototype[e]=function(r,i){return this.request(b_(i||{},{method:e,url:r,data:(i||{}).data}))}}),at.forEach(["post","put","patch"],function(e){function r(i){return function(o,c,u){return this.request(b_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}SA.prototype[e]=r(),SA.prototype[e+"Form"]=r(!0)});var TA=SA;class CL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new ct(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new ct(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new vv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new CL(function(o){r=o}),cancel:r}}}var pfe=CL;const IL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(IL).forEach(e=>{let[r,i]=e;IL[i]=r});var mfe=IL;const Bs=function e(r){const i=new TA(r),o=i5(TA.prototype.request,i);return at.extend(o,TA.prototype,i,{allOwnKeys:!0}),at.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(b_(r,c))},o}(gL);Bs.Axios=TA,Bs.CanceledError=vv,Bs.CancelToken=pfe,Bs.isCancel=Q6,Bs.VERSION=_W,Bs.toFormData=tA,Bs.AxiosError=er,Bs.Cancel=Bs.CanceledError,Bs.all=function(e){return ct.all(e)},Bs.spread=function(e){return function(r){return e.apply(null,r)}},Bs.isAxiosError=function(e){return at.isObject(e)&&e.isAxiosError===!0},Bs.mergeConfig=b_,Bs.AxiosHeaders=cd,Bs.formToJSON=e=>X6(at.isHTMLForm(e)?new FormData(e):e),Bs.getAdapter=mW.getAdapter,Bs.HttpStatusCode=mfe,Bs.default=Bs;var Go=Bs;const gfe=()=>{};function rb(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:gfe};return e.promise=new ct((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const bA=new Map,wA=new Map,uh=new Map;let Li=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Un=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const yW=new Dle;let ld=yW.getResult(),AL=null;function Cn(e){if(!AL){ld=yW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Un.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Un.CHROME;case"Safari":case"Mobile Safari":return Un.SAFARI;case"Edge":return Un.EDGE;case"Firefox":return Un.FIREFOX;case"QQ":case"QQBrowser":return Un.QQ;case"Opera":return Un.OPERA;case"WeChat":return Un.WECHAT;default:return m.browser.name||""}}(ld),i=vW(ld),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(ld),c=ld.os.version,u=vW(ld,!1),h=ld.device.type;if(!(r&&i&&o&&c))return{name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};AL={name:r,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return AL}function vW(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function RA(){return Cn().os}function SW(){const e=Cn();return"".concat(e.os," ").concat(e.osVersion)}function CA(){const e=Cn();return!!(ld.engine.name==="WebKit"&&e.os===Li.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Un.SAFARI||yo()&&e.name!==Un.SAFARI)}function Bf(){return Cn().name===Un.CHROME}function gs(){return Cn().name===Un.SAFARI}function TW(){return Cn().name===Un.EDGE}function Nr(){return Cn().name===Un.FIREFOX}function yo(){return Cn().os===Li.IOS}function ib(e){const r=Cn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)>=e}function bW(e){const r=Cn();return!(r.name!==Un.CHROME||!r.osVersion)&&Number(r.version)<e}function PL(e,r,i){const o=Cn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=r&&Number(o.version)<=i:Number(o.version)===r)}function OL(e){const r=Cn();return!(r.name!==Un.EDGE||!r.osVersion)&&Number(r.version)>=e}function wW(e){const r=Cn();return!(r.name!==Un.SAFARI||!r.osVersion)&&Number(r.version)>=e}function RW(e,r,i){const o=Cn();if(o.os!==Li.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function CW(e,r,i){const o=Cn();if(o.name!==Un.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function kL(e){const r=Cn();return!(r.name!==Un.OPERA||!r.osVersion)&&Number(r.version)>=e}function IW(){const e=Cn();if(e.os!==Li.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Sv(){const e=Cn();if(e.os!==Li.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function NL(){const e=Cn();if(e.os!==Li.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function AW(){const e=Cn();if(e.os!==Li.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function ou(){return gs()&&navigator.maxTouchPoints>0}function PW(){return Cn().name===Un.WECHAT}function OW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function DL(){const e=RA();return function(){const{deviceType:r}=Cn();return r==="mobile"||r==="tablet"}()||e===Li.ANDROID||e===Li.IOS||e===Li.HARMONY_OS}function Wf(){const e=Cn();return e.name!==Un.EDGE&&e.name!==Un.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function IA(){return RA()===Li.ANDROID}function sb(){const e=Cn();return IA()&&(e.name===Un.CHROME||e.name===Un.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function kW(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function pt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?kW(Object(i),!0).forEach(function(o){Ht(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Ht(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Ne=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),Ht(this,"code",void 0),Ht(this,"message",void 0),Ht(this,"data",void 0),Ht(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function zf(e,r){if(typeof e!="boolean")throw new Ne(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ii(e,r,i){if(!st(i).call(i,e))throw new Ne(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function tr(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Ne(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function LL(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ne(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&tr(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&tr(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&tr(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&tr(e.ideal,"".concat(r,".ideal"),1,1/0)}else tr(e,r,1,1/0)}function ts(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ne(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!NW(e,i,o,c))throw new Ne(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Gf(e,r){if(!Array.isArray(e))throw new Ne(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Dr(e){return e==null}function NW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var ob=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(ob||{}),xL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(xL||{});const DW=new class{constructor(){Ht(this,"_clientSize",null),Ht(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ht(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ht(this,"getStyle",e=>window.getComputedStyle(e,null)),Ht(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return st(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Ht(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Ht(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ht(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Ht(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),Ht(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),Ht(this,"checkCoverForAPoint",(e,r,i)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==i}),Ht(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:R})}return[...h]}),Ht(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),Ht(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),Ht(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(_=r<u?r:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-y;return this.checkSizeIsVisible(R,P,h)}),Ht(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ht(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(ob.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(ob.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ob.SIZE)}}return this.returnHiddenResult(ob.STYLE)}return this.returnHiddenResult(xL.UNMOUNTED)}return this.returnHiddenResult(xL.INVALID_HTML_ELEMENT)}),Ht(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function ML(e){return new TextEncoder().encode(e)}const LW=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},UL=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",ML(e)),16);let Ar=class{constructor(){Ht(this,"_events",{}),Ht(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,r)===-1&&i.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,r);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let i=e.length;for(;i--;)if(e[i].listener===r)return i;return-1}},ab=null;function xW(){if(ab)return ab;if(window.electron)return ab=window.electron;if(!window.require)return null;try{return ab=window.require("electron"),ab}catch{return null}}let gi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Lr=function(e){return e.TRACER="tracer",e}({});function MW(e){return tr(e.timeout,"config.timeout",0,1e5),tr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),tr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),tr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let _fe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Wn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function cb(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function UW(e){return ts(e.turnServerURL,"turnServerURL"),ts(e.username,"username"),ts(e.password,"password"),e.udpport&&tr(e.udpport,"udpport",1,99999,!0),e.forceturn&&zf(e.forceturn,"forceturn"),e.security&&zf(e.security,"security"),e.tcpport&&tr(e.tcpport,"tcpport",1,99999,!0),!0}function VL(e){return e.level!==void 0&&Ii(e.level,"level",[1,2,3]),e.delay!==void 0&&tr(e.delay,"delay",0,3e3,!0),!0}let mn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),_s=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Xa=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Tv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Es(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?ct.reject(new Ne(X.UNEXPECTED_ERROR,"can not emit promise")):new ct((u,h)=>{e.emit(r,...o,u,h)})}function sr(e,r){if(e.getListeners(r).length===0)return ct.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return Es(e,r,...o)}function kc(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return lb(e,r,...o)}function lb(e,r){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Ne(X.UNEXPECTED_ERROR,"handler is not sync");return i}const si=new class extends Ar{set networkState(e){this.emit(Tv.NETWORK_STATE_CHANGE,e,this._networkState),e===Xa.ONLINE?this.emit(Tv.ONLINE):e===Xa.OFFLINE&&(this.onlineWaiter=new ct(r=>{this.once(Tv.ONLINE,()=>{this.onlineWaiter=void 0,r(Xa.ONLINE)})}),this.emit(Tv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xa.ONLINE}constructor(){super(),Ht(this,"_moduleName","network-indicator"),Ht(this,"_networkState",Xa.ONLINE),Ht(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Xa.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Xa.OFFLINE})}};function AA(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function bv(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function PA(e){ct!==void 0?ct.resolve().then(e):setTimeout(e,0)}function xr(e){return JSON.parse(JSON.stringify(e))}function w_(e){try{return xr(e)}catch{return e}}const VW={};function vm(e,r){VW[r]||(VW[r]=!0,e())}function R_(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function Sm(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function FW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const o=new Uint8Array(r);o.set(i),i=o}return i}function jW(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=za(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function dh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function BW(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?dh(i):i.size}),r+138}function Efe(e){const r=new Ne(X.TIMEOUT,"timeout");return new ct((i,o)=>{window.setTimeout(()=>o(r),e)})}function ns(e){return new ct(r=>{window.setTimeout(r,e)})}function or(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+or(e-i.length,"")}function C_(){return or(32,"").toUpperCase()}const OA=()=>{},WW=new class{constructor(){Ht(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,pt(pt({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},zW=WW.throttleByKey.bind(WW);function GW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function FL(e,r){if(!GW(e)||!GW(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let o=0;o<r.length;o++)i[o]=FL(e[o],r[o]);return i}{const i=pt({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=FL(e[o],r[o]):i[o]=r[o]);return i}}function HW(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==r););return i}function jL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function $W(e){const r="0123456789abcdef";function i(le){let ge,Ee="";for(ge=0;ge<=3;ge++)Ee+=r.charAt(le>>8*ge+4&15)+r.charAt(le>>8*ge&15);return Ee}function o(le,ge){const Ee=(65535&le)+(65535&ge);return(le>>16)+(ge>>16)+(Ee>>16)<<16|65535&Ee}function c(le,ge,Ee,pe,Pe,Ke){return o(function(lt,ht){return lt<<ht|lt>>>32-ht}(o(o(ge,le),o(pe,Ke)),Pe),Ee)}function u(le,ge,Ee,pe,Pe,Ke,lt){return c(ge&Ee|~ge&pe,le,ge,Pe,Ke,lt)}function h(le,ge,Ee,pe,Pe,Ke,lt){return c(ge&pe|Ee&~pe,le,ge,Pe,Ke,lt)}function m(le,ge,Ee,pe,Pe,Ke,lt){return c(ge^Ee^pe,le,ge,Pe,Ke,lt)}function _(le,ge,Ee,pe,Pe,Ke,lt){return c(Ee^(ge|~pe),le,ge,Pe,Ke,lt)}const y=function(le){let ge;const Ee=1+(le.length+8>>6),pe=new Array(16*Ee);for(ge=0;ge<16*Ee;ge++)pe[ge]=0;for(ge=0;ge<le.length;ge++)pe[ge>>2]|=le.charCodeAt(ge)<<ge%4*8;return pe[ge>>2]|=128<<ge%4*8,pe[16*Ee-2]=8*le.length,pe}(e);let S,R,P,k,z,U=1732584193,V=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)R=U,P=V,k=q,z=Y,U=u(U,V,q,Y,y[S+0],7,-680876936),Y=u(Y,U,V,q,y[S+1],12,-389564586),q=u(q,Y,U,V,y[S+2],17,606105819),V=u(V,q,Y,U,y[S+3],22,-1044525330),U=u(U,V,q,Y,y[S+4],7,-176418897),Y=u(Y,U,V,q,y[S+5],12,1200080426),q=u(q,Y,U,V,y[S+6],17,-1473231341),V=u(V,q,Y,U,y[S+7],22,-45705983),U=u(U,V,q,Y,y[S+8],7,1770035416),Y=u(Y,U,V,q,y[S+9],12,-1958414417),q=u(q,Y,U,V,y[S+10],17,-42063),V=u(V,q,Y,U,y[S+11],22,-1990404162),U=u(U,V,q,Y,y[S+12],7,1804603682),Y=u(Y,U,V,q,y[S+13],12,-40341101),q=u(q,Y,U,V,y[S+14],17,-1502002290),V=u(V,q,Y,U,y[S+15],22,1236535329),U=h(U,V,q,Y,y[S+1],5,-165796510),Y=h(Y,U,V,q,y[S+6],9,-1069501632),q=h(q,Y,U,V,y[S+11],14,643717713),V=h(V,q,Y,U,y[S+0],20,-373897302),U=h(U,V,q,Y,y[S+5],5,-701558691),Y=h(Y,U,V,q,y[S+10],9,38016083),q=h(q,Y,U,V,y[S+15],14,-660478335),V=h(V,q,Y,U,y[S+4],20,-405537848),U=h(U,V,q,Y,y[S+9],5,568446438),Y=h(Y,U,V,q,y[S+14],9,-1019803690),q=h(q,Y,U,V,y[S+3],14,-187363961),V=h(V,q,Y,U,y[S+8],20,1163531501),U=h(U,V,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,V,q,y[S+2],9,-51403784),q=h(q,Y,U,V,y[S+7],14,1735328473),V=h(V,q,Y,U,y[S+12],20,-1926607734),U=m(U,V,q,Y,y[S+5],4,-378558),Y=m(Y,U,V,q,y[S+8],11,-2022574463),q=m(q,Y,U,V,y[S+11],16,1839030562),V=m(V,q,Y,U,y[S+14],23,-35309556),U=m(U,V,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,V,q,y[S+4],11,1272893353),q=m(q,Y,U,V,y[S+7],16,-155497632),V=m(V,q,Y,U,y[S+10],23,-1094730640),U=m(U,V,q,Y,y[S+13],4,681279174),Y=m(Y,U,V,q,y[S+0],11,-358537222),q=m(q,Y,U,V,y[S+3],16,-722521979),V=m(V,q,Y,U,y[S+6],23,76029189),U=m(U,V,q,Y,y[S+9],4,-640364487),Y=m(Y,U,V,q,y[S+12],11,-421815835),q=m(q,Y,U,V,y[S+15],16,530742520),V=m(V,q,Y,U,y[S+2],23,-995338651),U=_(U,V,q,Y,y[S+0],6,-198630844),Y=_(Y,U,V,q,y[S+7],10,1126891415),q=_(q,Y,U,V,y[S+14],15,-1416354905),V=_(V,q,Y,U,y[S+5],21,-57434055),U=_(U,V,q,Y,y[S+12],6,1700485571),Y=_(Y,U,V,q,y[S+3],10,-1894986606),q=_(q,Y,U,V,y[S+10],15,-1051523),V=_(V,q,Y,U,y[S+1],21,-2054922799),U=_(U,V,q,Y,y[S+8],6,1873313359),Y=_(Y,U,V,q,y[S+15],10,-30611744),q=_(q,Y,U,V,y[S+6],15,-1560198380),V=_(V,q,Y,U,y[S+13],21,1309151649),U=_(U,V,q,Y,y[S+4],6,-145523070),Y=_(Y,U,V,q,y[S+11],10,-1120210379),q=_(q,Y,U,V,y[S+2],15,718787259),V=_(V,q,Y,U,y[S+9],21,-343485551),U=o(U,R),V=o(V,P),q=o(q,k),Y=o(Y,z);return i(U)+i(V)+i(q)+i(Y)}let yfe=1,KW=console,Cs=class{static setLogger(e){KW=e}constructor(e,r){Ht(this,"id",void 0),Ht(this,"lockingPromise",ct.resolve()),Ht(this,"locks",0),Ht(this,"name",""),Ht(this,"lockId",void 0),this.lockId=yfe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");KW.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new ct(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function wv(e,r){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const _i={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function BL(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function ud(e,r,i,o){const c=Object.assign({},_i,o);let u=c.timeout;const h=async()=>{await function(y){return new ct(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new ct(async(y,S)=>{r=r||(()=>!1),i=i||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Ne(X.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return y(P);await h()}catch(P){if(!i(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let kA,qW=class{constructor(e){Ht(this,"input",[]),Ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:za(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},NA=0,WL=0;function zL(e,r,i,o){return new ct((c,u)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),NA+=dh(r.data)):i&&(r.data.size?NA+=r.data.size:r.data instanceof FormData?NA+=BW(r.data):NA+=dh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Go.request(r).then(h=>{typeof h.data=="string"?WL+=dh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?WL+=h.data.byteLength:WL+=dh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Go.isCancel(h)?u(new Ne(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ne(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Ne(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ne(X.NETWORK_ERROR,h.message))})})}async function vfe(e,r){const i=new Blob([r.data],{type:"buffer"});return await zL(e,pt(pt({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const YW=()=>window.isSecureContext!==void 0;function au(e){if(Array.isArray(e))return e.map(i=>i);if(!XW(e))return e;const r={};for(const i in e){const o=e[i];XW(o)||Array.isArray(o)?r[i]=au(o):r[i]=o}return r}function XW(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let GL=class{constructor(e){Ht(this,"input",[]),Ht(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const hh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},ub={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:hh,remoteCandidate:hh},updateInterval:0},JW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},QW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},ZW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},e8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let HL=class{constructor(e,r){Ht(this,"onFirstVideoReceived",void 0),Ht(this,"onFirstVideoDecoded",void 0),Ht(this,"onFirstAudioReceived",void 0),Ht(this,"onFirstVideoDecodedTimeout",void 0),Ht(this,"onFirstAudioDecoded",void 0),Ht(this,"onSelectedLocalCandidateChanged",void 0),Ht(this,"onSelectedRemoteCandidateChanged",void 0),Ht(this,"videoIsReady",!1),Ht(this,"videoIsReady2",{}),Ht(this,"pc",void 0),Ht(this,"options",void 0),Ht(this,"intervalTimer",void 0),Ht(this,"stats",au(ub)),Ht(this,"isFirstVideoReceived",{}),Ht(this,"isFirstVideoDecoded",{}),Ht(this,"isFirstAudioReceived",{}),Ht(this,"isFirstAudioDecoded",{}),Ht(this,"isFirstVideoDecodedTimeout",{}),Ht(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ct(e=>{e({local:pt({},hh),remote:pt({},hh)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[r-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[r-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,R=this.lossRateWindowStats[r-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Sfe=class extends HL{constructor(){super(...arguments),Ht(this,"_stats",ub),Ht(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=au(ub);const i=r.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const o=st(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=au(QW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=au(JW),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:pt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=au(e8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=au(ZW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ct((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),r.push(o)}),r}},db=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),DA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),$L=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Nc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Rv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Rv||{});function hb(e,r,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Rv.kNone;if(!r)return;const u=Number(r[i]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let t8=class extends HL{constructor(){super(...arguments),Ht(this,"_stats",ub),Ht(this,"report",void 0),Ht(this,"lastDecodeVideoReceiverStats",new Map),Ht(this,"lastVideoFramesRecv",new Map),Ht(this,"lastVideoFramesSent",new Map),Ht(this,"lastVideoFramesDecode",new Map),Ht(this,"lastVideoFramesOutput",new Map),Ht(this,"lastVideoJBDelay",new Map),Ht(this,"lastAudioJBDelay",new Map),Ht(this,"mediaBytesSent",new Map),Ht(this,"mediaBytesRetransmit",new Map),Ht(this,"mediaBytesTargetEncode",new Map),Ht(this,"lastDecodeAudioReceiverStats",new Map),Ht(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=au(ub),this.report.forEach(e=>{switch(e.type){case Nc.OUTBOUND:case Nc.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===Nc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===Nc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case Nc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Nc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:pt({},hh),remote:pt({},hh)};return e.forEach(i=>{let o;if(i.type===Nc.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===Nc.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Nc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Nc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Nc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(pt({},r),pt({},this.stats.selectedCandidatePair.localCandidate)),e.type===Nc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(pt({},r),pt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=au(e8),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=hb(i,r,"totalProcessingDelay","jitterBufferEmittedCount",Rv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,pt({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=au(JW),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=hb(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=hb(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",Rv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=hb(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Rv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=hb(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",Rv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:pt({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=au(QW),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new GL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new GL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new GL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Nc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=au(ZW),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,Nc.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const o=Array.from(Pc(i=this.report).call(i)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(i.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:P,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,i){var o,c,u,h,m;const _=r?this.report.get(r):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const z=this.lastVideoFramesRecv.get(i.ssrc),U=Date.now();i.framesReceivedCount=y;let V=0;z&&U-z.lts>=800?(V=Math.round((y-z.count)/((U-z.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:V})):z?V=z.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:0}),i.receivedFrame={width:S||0,height:R||0,frameRate:V||0},i.decodedFrame={width:S||0,height:R||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:R||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(P&&k){const z=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=z.jitterBufferMs;const V=k-z.jitterBufferEmittedCount;V>0&&(U=1e3*(P-z.jitterBufferDelay)/V),i.jitterBufferMs=U,i.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,r,i){var o,c,u,h,m,_,y;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,z=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,V=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof P=="number"&&(i.totalSamplesReceived=P),R&&P&&(i.accelerateRate=R/P),k&&z){const le=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ge=le.jitterBufferMs;const Ee=z-le.jitterBufferEmittedCount;Ee>0&&(ge=1e3*(k-le.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(ge),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:z,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=U;let Y=1920;V&&P&&(Y=P/V/50,i.receivedFrames=Math.round(P/Y)),q&&(i.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Tfe=class extends HL{updateStats(){return ct.resolve()}};function KL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Sfe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new t8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ct||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new t8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Tfe(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const n8="websdk_ng_install_id";function qL(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(n8);return e||(e=C_(),window.localStorage.setItem(n8,e)),Jn("INSTALL_ID",e),e}catch{return}}const ml=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),YL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let I_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ys=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ys;const LA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},XL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},JL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",QL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},fr=pt(pt(pt({},QL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:XL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},LA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Jn(e,r,i){var o,c,u;st(o=Object.keys(fr)).call(o,e)&&(!i&&st(c=Object.keys(dd)).call(c,e)||(fr[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(fr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(fr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,fr.USE_NEW_NETWORK_CONFIG=u,u&&(fr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],fr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],fr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],fr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],fr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",fr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(fr.ENABLE_INSTANT_VIDEO=!0,fr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(fr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(fr.NEW_TURN_MODE||(fr.NEW_TURN_MODE=4))))}function re(e){return fr[e]}YL||(fr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],fr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],fr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],fr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],fr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],fr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],fr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",fr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",fr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",fr.AREAS=["NORTH_AMERICA","OVERSEA"]);let r8=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const dd={};var gn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(gn||{});let xA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const i8=128,bfe=96,s8=1e3,Cv=10;let wfe=0;var o8=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>lt,Printer:()=>Qr,parse:()=>rt,print:()=>Tt});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(ze){return ze>="0"&&ze<="9"}function R(ze){return ze>="!"&&ze<="~"}function P(ze){return R(ze)||ze>=""&&ze<=""}function k(ze){return ze==="!"||ze>="#"&&ze<="'"||ze>="*"&&ze<="+"||ze>="-"&&ze<="."||ze>="0"&&ze<="9"||ze>="A"&&ze<="Z"||ze>="^"&&ze<="~"}function z(ze){return ze>="1"&&ze<="9"}function U(ze){return ze>="A"&&ze<="Z"||ze>="a"&&ze<="z"}function V(ze){return ze==="d"||ze==="h"||ze==="m"||ze==="s"}function q(ze){return ze>""&&ze<"	"||ze>"\v"&&ze<"\f"||ze>""&&ze<""}function Y(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function le(ze){return S(ze)||U(ze)||ze==="+"||ze==="/"||ze==="-"||ze==="_"}function ge(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function Ee(ze,x){var ie=Object.keys(ze);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(ze);x&&(ue=ue.filter(function(Ye){return Object.getOwnPropertyDescriptor(ze,Ye).enumerable})),ie.push.apply(ie,ue)}return ie}function pe(ze){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?Ee(Object(ie),!0).forEach(function(ue){Pe(ze,ue,ie[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ze,Object.getOwnPropertyDescriptors(ie)):Ee(Object(ie)).forEach(function(ue){Object.defineProperty(ze,ue,Object.getOwnPropertyDescriptor(ie,ue))})}return ze}function Pe(ze,x,ie){return x in ze?Object.defineProperty(ze,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[x]=ie,ze}(function(ze){ze.VERSION="v",ze.ORIGIN="o",ze.SESSION_NAME="s",ze.INFORMATION="i",ze.URI="u",ze.EMAIL="e",ze.PHONE="p",ze.CONNECTION="c",ze.BANDWIDTH="b",ze.TIME="t",ze.REPEAT="r",ze.ZONE_ADJUSTMENTS="z",ze.KEY="k",ze.ATTRIBUTE="a",ze.MEDIA="m"})(y||(y={}));class Ke{consumeText(x,ie){let ue=ie;for(;ue<x.length;){const Ye=x[ue];if(Ye==="\0"||Ye==="\r"||Ye===h)break;ue+=1}if(ue-ie==0)throw new Error("Invalid text, at ".concat(x));return ue}consumeUnicastAddress(x,ie,ue){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,ue){let Ye=ie;for(;ue(x[Ye]);)Ye++;if(Ye-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Ye}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let ue=ie;for(let Ye=0;Ye<4;Ye++)if(ue=this.consumeDecimalUChar(x,ue),Ye!==3){if(x[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(x,ie){let ue=ie;for(let Kt=0;Kt<3&&S(x[ue]);Kt++,ue++);if(ue-ie==0)throw new Error("Invalid decimal uchar.");const Ye=parseInt(x.slice(ie,ue));if(Ye>=0&&Ye<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let ue=this.consumeHexpart(x,ie);return x[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(x,ue)),ue}consumeHexpart(x,ie){let ue=ie;if(x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}if(ue=this.consumeHexseq(x,ue),x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}return ue}consumeHexseq(x,ie){let ue=ie;for(;ue=this.consumeHex4(x,ue),x[ue]===":"&&x[ue+1]!==":";)ue+=1;return ue}consumeHex4(x,ie){let ue=0;for(;ue<4;ue++)if(!((Ye=x[ie+ue])>="0"&&Ye<="9"||Ye>="a"&&Ye<="f"||Ye>="A"&&Ye<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var Ye;return ie+ue}consumeFQDN(x,ie){let ue=ie;for(;S(x[ue])||U(x[ue])||x[ue]==="-"||x[ue]===".";)ue+=1;if(ue-ie<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,P)}consumeMulticastAddress(x,ie,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const ue=this.consumeHexpart(x,ie);return x[ue]==="/"?this.consumeInteger(x,ue+1):ue}consumeIP4MulticastAddress(x,ie){let ue=ie+3;const Ye=x.slice(ie,ue),Kt=parseInt(Ye);if(Kt<224||Kt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let nr=0;nr<3;nr++){if(x[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(x,ue)}return x[ue]==="/"&&(ue+=1),ue=this.consumeTTL(x,ue),x[ue]==="/"&&(ue=this.consumeInteger(x,ue)),ue}consumeInteger(x,ie){if(!z(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!z(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let ue=0;ue<2&&S(x[ie]);ue++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let ue=ie;if(x[ue]==="0")return ue+1;for(z(x[ue])&&(ue+=1);S(x[ue]);)ue++;if(ue-ie<10)throw new Error("Invalid time");return ue}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let ue=ie;return ue=this.consumeOneOrMore(x,ue,S),V(x[ue])?ue+1:ue}consumeRepeatInterval(x,ie){if(!z(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return V(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,ue){for(let Ye=0;Ye<ue.length;Ye++){if(ie+Ye>=x.length)throw new Error("consume exceeding value length");if(x[ie+Ye]!==ue[Ye])throw new Error("consume ".concat(ue," failed at ").concat(Ye))}return ie+ue.length}consumeTill(x,ie,ue){let Ye=ie;for(;Ye<x.length&&(typeof ue!="string"||x[Ye]!==ue)&&(typeof ue!="function"||!ue(x[Ye]));)Ye++;return Ye}}class lt extends Ke{constructor(){super(),Pe(this,"records",[]),Pe(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter(J_=>!!Zs(J_).call(J_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),Ye=this.parseOrigin(),Kt=this.parseSessionName(),nr=this.parseInformation(),Ui=this.parseUri(),ba=this.parseEmail(),np=this.parsePhone(),X_=this.parseConnection(),Yb=this.parseBandWidth(),$P=this.parseTimeFields(),KP=this.parseKey(),bl=this.parseSessionAttribute(),Fm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:Ye,sessionName:Kt,information:nr,uri:Ui,emails:ba,phones:np,connection:X_,bandwidths:Yb,timeFields:$P,key:KP,attributes:bl,mediaDescriptions:Fm}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new Sn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ie,Ye=>k(Ye)&&Ye!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,ue.attValue=this.extractOneOrMore(ie,q)),x.parse(ue),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new Tn(x);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==y.ATTRIBUTE)break;const Ye={attField:this.extractOneOrMore(ue,Kt=>k(Kt)&&Kt!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,Ye.attValue=this.extractOneOrMore(ue,q)),ie.parse(Ye),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const ue=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Ye=!1;x.value[x.cur]==="-"&&(Ye=!0,x.cur+=1);const Kt=this.extract(x,this.consumeTypedTime);ie.push({time:ue,typedTime:Kt,back:Ye})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const ue=this.extract(ie,this.consumeRepeatInterval),Ye=this.parseTypedTime(ie);x.push({repeatInterval:ue,typedTimes:Ye}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const ue=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:ue}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const ue=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Ye=this.extractOneOrMore(ie,S);x.push({bwtype:ue,bandwidth:Ye}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,P);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Ye=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Kt=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const nr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Ui=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:ue,sessVersion:Ye,nettype:Kt,addrtype:nr,unicastAddress:Ui}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Ye=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:ue,address:Ye}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let ue=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,ue+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Ye=[];for(Ye.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Ye.push(this.extract(x,this.consumeToken));if(Ye.length===0)throw new Error("Invalid proto");const Kt=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:ue,protos:Ye,fmts:Kt}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),ue=this.parseRepeat(),Ye=this.parseZone();x.push({time:ie,repeats:ue,zones:Ye})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),ue=this.parseInformation(),Ye=this.parseConnections(),Kt=this.parseBandWidth(),nr=this.parseKey(),Ui=this.parseMediaAttributes(ie);x.push({media:ie,information:ue,connections:Ye,bandwidths:Kt,key:nr,attributes:Ui})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var ue=arguments.length,Ye=new Array(ue>2?ue-2:0),Kt=2;Kt<ue;Kt++)Ye[Kt-2]=arguments[Kt];const nr=ie.call(this,x.value,x.cur,...Ye),Ui=x.value.slice(x.cur,nr);return x.cur=nr,Ui}extractOneOrMore(x,ie){const ue=this.consumeOneOrMore(x.value,x.cur,ie),Ye=x.value.slice(x.cur,ue);return x.cur=ue,Ye}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class ht extends Ke{constructor(){super(...arguments),Pe(this,"attributes",void 0),Pe(this,"digested",!1)}extractOneOrMore(x,ie,ue){const Ye=this.consumeOneOrMore(x.attValue,x._cur,ie),Kt=x.attValue.slice(x._cur,Ye),[nr,Ui]=ue||[];if(typeof nr=="number"&&Kt.length<nr)throw new Error("error in length, should be more or equal than ".concat(nr," characters."));if(typeof Ui=="number"&&Kt.length>Ui)throw new Error("error in length, should be less or equal than ".concat(Ui," characters."));return x._cur=Ye,Kt}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,Ye=new Array(ue>2?ue-2:0),Kt=2;Kt<ue;Kt++)Ye[Kt-2]=arguments[Kt];const nr=ie.call(this,x.attValue,x._cur,...Ye),Ui=x.attValue.slice(x._cur,nr);return x._cur=nr,Ui}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let ue=0;ue<ie.length;ue++)if(ie[ue]!==x.attValue[x._cur+ue])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(ue){if(this.atEnd(x))break;throw ue}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:ue})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let ue;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),ue=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Ye=this.extract(x,this.consumeTill,_),Kt=pe(pe({entry:parseInt(ie,10)},ue&&{direction:ue}),{},{extensionName:Ye});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Kt.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push(Kt)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class Sn extends ht{constructor(){super(...arguments),Pe(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),ue.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,le)}parseIdentity(x){const ie=this.extractOneOrMore(x,ge),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Ye=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const Kt=this.extractOneOrMore(x,nr=>nr!==_&&q(nr));ue.push({name:Ye,value:Kt})}this.attributes.identities.push({assertionValue:ie,extensions:ue})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const ue=this.extract(x,this.consumeTill,_);ie.identifierList.push(ue)}}this.attributes.msidSemantic=ie}}class Tn extends ht{constructor(x){super(),Pe(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Ye=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const Kt=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const nr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Ui=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const ba={foundation:ie,componentId:ue,transport:Ye,priority:Kt,connectionAddress:nr,port:Ui,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),ba.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),ba.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const np=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),ba.extension[np]=this.extractOneOrMore(x,R)}this.attributes.candidates.push(ba)}parseRemoteCandidate(x){const ie=[];for(;;){const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Ye=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Kt=this.extract(x,this.consumePort);ie.push({componentId:ue,connectionAddress:Ye,port:Kt});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Ye={encodingName:ue,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Ye.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const Kt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));Kt?Kt.rtpMap=Ye:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Ye,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,":");let Ye;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Ye=this.extract(x,this.consumeTill));const Kt=this.attributes.ssrcs.find(nr=>nr.ssrcId===parseInt(ie,10));Kt?Kt.attributes[ue]=Ye:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[ue]:Ye}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill),Ye={};ue.split(";").forEach(nr=>{let[Ui,ba]=nr.split("=");Ui=Zs(Ui).call(Ui);const np=typeof ba=="string"?Zs(ba).call(ba):null;typeof Ui=="string"&&Ui.length>0&&(Ye[Ui]=np)});const Kt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));Kt?Kt.fmtp={parameters:Ye}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Ye}})}parseFmtParameters(x){const ie={},ue=this.extract(x,this.consumeTill,"=");x._cur++;const Ye=this.extract(x,this.consumeTill,";");for(ie[ue]=Ye;x.attValue[x._cur]===";";){const Kt=this.extract(x,this.consumeTill,"=");x._cur++;const nr=this.extract(x,this.consumeTill,";");ie[Kt]=nr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,_);let Ye;if(ue==="trr-int")Ye={type:ue,interval:this.extract(x,this.consumeTill)};else{const Kt={type:ue};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Kt.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&(Kt.additional=this.extract(x,this.consumeTill))),Ye=Kt}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Ye);else{const Kt=this.attributes.payloads.find(nr=>nr.payloadType===parseInt(ie,10));Kt?Kt.rtcpFeedbacks.push(Ye):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Ye]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Ye=>U(Ye)||S(Ye)||Ye==="_"||Ye==="-");this.consumeAttributeSpace(x);const ue={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Ye=[];for(;;){const Kt=this.extract(x,this.consumeToken);Ye.push(Kt);try{this.extract(x,this.consume,",")}catch{break}}ue.payloads=Ye,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Ye=this.extract(x,this.consumeToken);switch(Ye){case"depend":{const Kt={type:Ye,rids:this.extract(x,this.consume,"=").split(",")};ue.params.push(Kt);break}default:{const Kt={type:Ye};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),Kt.val=this.extract(x,this.consumeTill,";")),ue.params.push(Kt)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(x);const Ye=this.extract(x,this.consumeInteger);ue.push(parseInt(Ye,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:ue})}}function cr(ze,x,ie){return x in ze?Object.defineProperty(ze,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[x]=ie,ze}class Qr{constructor(){cr(this,"eol",m)}print(x,ie){let ue="";return ie&&(this.eol=ie),ue+=this.printVersion(x.version),ue+=this.printOrigin(x.origin),ue+=this.printSessionName(x.sessionName),ue+=this.printInformation(x.information),ue+=this.printUri(x.uri),ue+=this.printEmail(x.emails),ue+=this.printPhone(x.phones),ue+=this.printConnection(x.connection),ue+=this.printBandwidth(x.bandwidths),ue+=this.printTimeFields(x.timeFields),ue+=this.printKey(x.key),ue+=this.printSessionAttributes(x.attributes),ue+=this.printMediaDescription(x.mediaDescriptions),ue}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printPhone(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const ue of x)ie+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const ue of x){ie+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const Ye of ue.repeats)ie+="r=".concat(Ye.repeatInterval," ").concat(Ye.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ie+="z=",ie+="z=".concat(ue.zoneAdjustments.map(Ye=>"".concat(Ye.time," ").concat(Ye.back?"-":""," ").concat(Ye.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const ue of x)ie+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const ue of x)ie+=this.printMedia(ue.media),ie+=this.printInformation(ue.information),ie+=this.printConnections(ue.connections),ie+=this.printBandwidth(ue.bandwidths),ie+=this.printKey(ue.key),ie+=this.printMediaAttributes(ue);return ie}printConnections(x){let ie="";for(const ue of x)ie+=this.printConnection(ue);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new Xo(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Br{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class Xo extends Br{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(Ye=>"".concat(_).concat(Ye)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(ue=>"".concat(_).concat(ue))),ie+this.eol}}class je extends Br{print(x){const ie=x.attributes;let ue="";return ue+=this.printRTCP(ie.rtcp),ue+=this.printIceUfrag(ie.iceUfrag),ue+=this.printIcePwd(ie.icePwd),ue+=this.printIceOptions(ie.iceOptions),ue+=this.printCandidates(ie.candidates),ue+=this.printRemoteCandidatesList(ie.remoteCandidatesList),ue+=this.printEndOfCandidates(ie.endOfCandidates),ue+=this.printFingerprints(ie.fingerprints),ue+=this.printSetup(ie.setup),ue+=this.printMid(ie.mid),ue+=this.printExtmap(ie.extmaps),ue+=this.printRTPRelated(ie),ue+=this.printPtime(ie.ptime),ue+=this.printMaxPtime(ie.maxPtime),ue+=this.printDirection(ie.direction),ue+=this.printSSRCGroups(ie.ssrcGroups),ue+=this.printSSRC(ie.ssrcs),ue+=this.printRTCPMux(ie.rtcpMux),ue+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),ue+=this.printRTCPRsize(ie.rtcpRsize),ue+=this.printMSId(ie.msids),ue+=this.printImageattr(ie.imageattr),ue+=this.printRid(ie.rids),ue+=this.printSimulcast(ie.simulcast),ue+=this.printSCTPPort(ie.sctpPort),ue+=this.printMaxMessageSize(ie.maxMessageSize),ue+=this.printUnrecognized(ie.unrecognized),ue}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ie.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let ue="";ue+=x.rtcpFeedbackWildcards.map(Ye=>this.printRTCPFeedback("*",Ye)).join("");for(const Ye of ie)ue+=this.printRtpMap(Ye.payloadType,Ye.rtpMap),ue+=this.printFmtp(Ye.payloadType,Ye.fmtp),ue+=Ye.rtcpFeedbacks.map(Kt=>this.printRTCPFeedback(Ye.payloadType,Kt)).join("");return ue}printFmtp(x,ie){if(!ie)return"";const ue=Object.keys(ie.parameters);return ue.length===1&&ie.parameters[ue[0]]===null?"a=fmtp:".concat(x).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Ye=>"".concat(Ye,"=").concat(ie.parameters[Ye])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let ue="a=rtcp-fb:".concat(x).concat(_),Ye=ie;return Ye.type==="trr-int"?ue+="ttr-int".concat(_).concat(Ye.interval):(ue+="".concat(Ye.type),Ye.parameter&&(ue+="".concat(_).concat(Ye.parameter),Ye.additional&&(ue+="".concat(_).concat(Ye.additional)))),ue+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(ue=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(ue).concat(ie.attributes[ue]?":".concat(ie.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let ue="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(ue+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(ue+="".concat(_).concat(ie.params.map(Ye=>Ye.type==="depend"?"depend=".concat(Ye.rids.join(",")):"".concat(Ye.type,"=").concat(Ye.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function rt(ze){return new lt().parse(ze)}function Tt(ze,x){return new Qr().print(ze,x)}}},r={};function i(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ya(e){return o8.parse(e)}function Tm(e,r){return o8.print(e,r)}var Rfe=Wa("Array").keys,Cfe=Ec,Ife=fi,Afe=N,Pfe=Rfe,ZL=Array.prototype,Ofe={DOMTokenList:!0,NodeList:!0},kfe=function(e){var r=e.keys;return e===ZL||Afe(ZL,e)&&r===ZL.keys||Ife(Ofe,Cfe(e))?Pfe:r},Dc=l(kfe);function a8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function sn(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a8(Object(i),!0).forEach(function(o){Mr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Mr(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}const c8=new class extends Ar{constructor(){super(...arguments),Mr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Nfe{constructor(r){Mr(this,"logger",void 0),Mr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function ex(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function l8(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const gl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},MA=Date.now(),fb=e=>{for(const r in gl)if(Object.prototype.hasOwnProperty.call(gl,r)&&gl[r]===e)return r;return"DEFAULT"},D=new class{constructor(){Mr(this,"proxyServerURL",void 0),Mr(this,"logLevel",gl.DEBUG),Mr(this,"uploadState","collecting"),Mr(this,"uploadLogWaitingList",[]),Mr(this,"uploadLogUploadingList",[]),Mr(this,"uploadErrorCount",0),Mr(this,"currentLogID",0),Mr(this,"url",void 0),Mr(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[gl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[gl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[gl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[gl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const o=[gl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Jn("UPLOAD_LOG",!0)}disableLogUpload(){Jn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Nfe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-MA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-MA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=ex()+" Agora-SDK [".concat(fb(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=ex()+" %cAgora-SDK [".concat(fb(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case gl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case gl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case gl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case gl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-MA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-MA);const o=Math.max(0,Math.min(4,r[0]));r[0]=ex()+" Agora-SDK [".concat(fb(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=l8()+" Agora-SDK [".concat(fb(e),"]:"):i[0]=l8()+" Agora-SDK [".concat(fb(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:ml,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return ud(async()=>{const i=await Go.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),c8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var u8;function Dfe(e){return ts(e.reportId,"params.reportId",0,100,!1),ts(e.category,"params.category",0,100,!1),ts(e.event,"params.event",0,100,!1),ts(e.label,"params.label",0,100,!1),tr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(u8={}).FREE="free",u8.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Lfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let xi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),br=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let xfe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(P){D.warning(P),S=[]}try{JSON.stringify(S)}catch{D.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const R=(e.report||wt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Lr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,_);return P instanceof ct?P.then(k=>(R.onSuccess(e.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const wt=new class{constructor(){Mr(this,"baseInfoMap",new Map),Mr(this,"proxyServer",void 0),Mr(this,"eventUploadTimer",void 0),Mr(this,"setSessionIdTimer",void 0),Mr(this,"url",void 0),Mr(this,"sids",new Set),Mr(this,"backupUrl",void 0),Mr(this,"_appId",void 0),Mr(this,"_aid",0),Mr(this,"keyEventUploadPendingItems",[]),Mr(this,"normalEventUploadPendingItems",[]),Mr(this,"apiInvokeUploadPendingItems",[]),Mr(this,"apiInvokeCount",0),Mr(this,"apiInvokeLoggedCount",0),Mr(this,"ltsList",[]),Mr(this,"lastSendNormalEventTime",Date.now()),Mr(this,"customReportCounterTimer",void 0),Mr(this,"customReportCount",0),Mr(this,"extApiInvoke",async e=>{for(const r of e){const i=sn(sn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Lr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,o]=r;return i+o}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,z){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),D.info("".concat(U," ").concat(k),k==="start"?r.options:z||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});y("start");let R=!1;ns(r.timeout).then(()=>{R||(this.sendApiInvoke(sn(sn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const P=new Ne(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const z=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(sn(sn({},S()),{},{success:!0},r.reportResult&&{result:k})),y("onSuccess"),k};return i?zW(z,r.name+"Success",i,()=>R=!0):z()},onError:k=>{const z=()=>{if(R)throw k;R=!0,this.sendApiInvoke(sn(sn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return i?zW(z,r.name+"Error",i,()=>R=!0):z()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:YL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=r,R=Date.now(),P=sn(sn({},o),{},{eventType:xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:JL,lts:R,elapse:R-i,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:ml,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:st(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:br.SESSION,data:P},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{role:r.role,eventType:xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:br.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{eventType:xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-i.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:br.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,y=c-(u&&h?h:i.startTime),S=sn(sn({},o),{},{eventType:xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:y,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:qL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:br.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const z=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const z=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:z&&z.length?z[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:xi.REJOIN_GATEWAY});this.send({type:br.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=sn(sn({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:br.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{eventType:xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:br.PUBLISH,data:u},!0)}subscribe(e,r,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=sn(sn({},c),{},{eventType:xi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:br.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const i=[...Dc(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn({},u),{},{eventType:xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:br.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:i,data:m},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:xi.AB_TEST,lts:c});this.send({type:br.AB_TEST,data:u},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:br.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:br.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{eventType:r,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{eventType:xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-i.startTime,success:r.succ});this.send({type:br.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{eventType:xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:br.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{eventType:xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:br.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:br.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=dh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-y||(R[R.length]=pt(pt({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=pt(pt({},u),{},{[h]:_.substring(S)})),R})(sn(sn(sn({},o),r),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:br.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:br.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-i.startTime,lts:c,extend:r.extend||void 0});this.send({type:br.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-i.startTime,lts:c});this.send({type:br.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Ne(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=r.map(c=>({type:br.USER_ANALYTICS,data:sn(sn({sid:e},c),{},{lts:i})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw D.error("send custom report message failed",c.toString()),new Ne(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=re("NOT_REPORT_EVENT");if(e.tag&&st(r)&&st(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ne){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:br.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),$T(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&i.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){si.networkState===Xa.OFFLINE&&await ct.race([si.onlineWaiter,ns(2*_i.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=ML(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(R=>{let P=0;return Object.entries(br).forEach(k=>{let[z,U]=k;U===R.type&&(P=xfe[z])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=LW(u,new Uint8Array(_)),u=LW(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await zL(o,{timeout:1e4,data:r(e),headers:sn(sn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};si.networkState===Xa.OFFLINE&&await ct.race([si.onlineWaiter,ns(2*_i.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await vfe(h,{timeout:1e4,data:c}):await zL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,r){const i=Object.assign({},Lfe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Lr.TRACER}).onSuccess()}};c8.on("REPORT_LOG_UPLOAD",e=>{e.networkState=si.networkState,wt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Lr.TRACER}).onSuccess("logUploadError")});class Re extends Ne{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Mr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,D)}throw(){super.throw(D)}}const rs={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Nn(){return rs}function d8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(Bf()||TW())&&!DL())}function h8(){return!rs.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Wf()}let is=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Iv(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function In(e,r,i,o,c){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:c}}function cu(e,r,i,o,c){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:c}}function tx(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const Mfe={"90p":In(160,90),"90p_1":In(160,90),"120p":In(160,120,15,30,65),"120p_1":In(160,120,15,30,65),"120p_3":In(120,120,15,30,50),"120p_4":In(212,120),"180p":In(320,180,15,30,140),"180p_1":In(320,180,15,30,140),"180p_3":In(180,180,15,30,100),"180p_4":In(240,180,15,30,120),"240p":In(320,240,15,40,200),"240p_1":In(320,240,15,40,200),"240p_3":In(240,240,15,40,140),"240p_4":In(424,240,15,40,220),"360p":In(640,360,15,80,400),"360p_1":In(640,360,15,80,400),"360p_3":In(360,360,15,80,260),"360p_4":In(640,360,30,80,600),"360p_6":In(360,360,30,80,400),"360p_7":In(480,360,15,80,320),"360p_8":In(480,360,30,80,490),"360p_9":In(640,360,15,80,800),"360p_10":In(640,360,24,80,800),"360p_11":In(640,360,24,80,1e3),"480p":In(640,480,15,100,500),"480p_1":In(640,480,15,100,500),"480p_2":In(640,480,30,100,1e3),"480p_3":In(480,480,15,100,400),"480p_4":In(640,480,30,100,750),"480p_6":In(480,480,30,100,600),"480p_8":In(848,480,15,100,610),"480p_9":In(848,480,30,100,930),"480p_10":In(640,480,10,100,400),"720p":In(1280,720,15,120,1130),"720p_auto":In(1280,720,30,900,3e3),"720p_1":In(1280,720,15,120,1130),"720p_2":In(1280,720,30,120,2e3),"720p_3":In(1280,720,30,120,1710),"720p_5":In(960,720,15,120,910),"720p_6":In(960,720,30,120,1380),"1080p":In(1920,1080,15,120,2080),"1080p_1":In(1920,1080,15,120,2080),"1080p_2":In(1920,1080,30,120,3e3),"1080p_3":In(1920,1080,30,120,3150),"1080p_5":In(1920,1080,60,120,4780),"1440p":In(2560,1440,30,120,4850),"1440p_1":In(2560,1440,30,120,4850),"1440p_2":In(2560,1440,60,120,7350),"4k":In(3840,2160,30,120,8910),"4k_1":In(3840,2160,30,120,8910),"4k_3":In(3840,2160,60,120,13500)},Ufe={"480p":cu(640,480,5),"480p_1":cu(640,480,5),"480p_2":cu(640,480,30),"480p_3":cu(640,480,15),"720p":cu(1280,720,5),"720p_auto":In(1280,720,30,900,3e3),"720p_1":cu(1280,720,5),"720p_2":cu(1280,720,30),"720p_3":cu(1280,720,15),"1080p":cu(1920,1080,5),"1080p_1":cu(1920,1080,5),"1080p_2":cu(1920,1080,30),"1080p_3":cu(1920,1080,15)},Vfe={"1SL1TL":tx(1,1),"3SL3TL":tx(3,3),"2SL3TL":tx(2,3)};function fh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Mfe[e]):e}function nx(e){return typeof e=="string"?Object.assign({},Ufe[e]):e}function UA(e){return typeof e=="string"?Object.assign({},Vfe[e]):e}const Ffe={speech_low_quality:Iv(16e3,!1),speech_standard:Iv(32e3,!1,18),music_standard:Iv(48e3,!1),standard_stereo:Iv(48e3,!0,56),high_quality:Iv(48e3,!1,128),high_quality_stereo:Iv(48e3,!0,192)};function VA(e){return typeof e=="string"?Object.assign({},Ffe[e]):e}const Av=[];function f8(e){return Ii(e,"mediaSource",["screen","window","application"]),!0}let Et=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ar=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Pv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),jfe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),Bfe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),A_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Ov=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),kv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Nv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Lc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const rx={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},ix={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},p8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Wfe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},m8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let vo=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),xc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),pb=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),P_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),eo=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ph=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const sx={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let FA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function g8(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function wr(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?g8(Object(i),!0).forEach(function(o){we(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g8(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function we(e,r,i){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function An(e,r,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=za(u=Kp(h=i.slice()).call(h)).call(u,function(_,y){return y(e,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class _8 extends Ar{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(A_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),we(this,"trackMediaType",void 0),we(this,"_ID",void 0),we(this,"_rtpTransceiver",void 0),we(this,"_lowRtpTransceiver",void 0),we(this,"_hints",[]),we(this,"_isClosed",!1),we(this,"_originMediaStreamTrack",void 0),we(this,"mediaStreamTrack",void 0),we(this,"_external",{}),this._ID=i||or(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){st(Av).call(Av,o)||Av.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||vm(()=>{var i;wt.reportApiInvoke(null,{name:gi.GET_MEDIA_STREAM_TRACK,options:[],tag:Lr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Pv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=Av.indexOf(r);i!==-1&&Av.splice(i,1)}(this),this.emit(Ov.CLOSED),this.removeAllListeners(A_.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===Pv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(A_.TRANSCEIVER_UPDATED,r,i)}}class Dv extends _8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),we(this,"_enabled",!0),we(this,"_muted",!1),we(this,"_isExternalTrack",!1),we(this,"_isClosed",!1),we(this,"_enabledMutex",void 0),we(this,"processor",void 0),we(this,"_processorContext",void 0),we(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Cs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(Et.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,Et.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ov.TRACK_ENDED)}stateCheck(r,i){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),zf(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new Ne(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new Ne(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ct.resolve([])}}const E8=window.AudioContext||window.webkitAudioContext;let Mc=null;const Qn=new class extends Ar{constructor(){super(...arguments),we(this,"prevState",void 0),we(this,"curState",void 0),we(this,"currentTime",void 0),we(this,"currentTimeStuckAt",void 0),we(this,"interruptDetectorTrack",void 0),we(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(is.IOS_15_16_INTERRUPTION_START)}),we(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(Mc&&await Mc.suspend(),this.emit(is.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Lv(){if(!Mc){if(function(){if(!E8)return void D.error("your browser is not support web audio");D.info("create audio context");const e=wr({},re("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),Mc=new E8(e),Qn.curState=Mc.state,Mc.onstatechange=()=>{Qn.prevState=Qn.curState,Qn.curState=Mc?Mc.state:void 0;const{prevState:r,curState:i}=Qn,o=i==="running",c=i==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Cn().osVersion;(yo()||ou())&&u&&c&&(D.info("ios".concat(_,"-interruption-start")),Qn.emit(is.IOS_INTERRUPTION_START)),(yo()||ou())&&(h||m)&&o&&(D.info("ios".concat(_,"-interruption-end")),Qn.emit(is.IOS_INTERRUPTION_END)),r!==i&&Qn.emit(is.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=Mc)===null||r===void 0?void 0:r.currentTime;Qn.currentTime!==i?(Qn.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(i)),Qn.currentTimeStuckAt=void 0),Qn.currentTime=i):(i!==Qn.currentTimeStuckAt&&(wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Lr.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(i))),Qn.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):yo()||ou()?r.state==="suspended"&&(_(!0),U&&r.resume().then(y,y)):r.state!=="closed"&&(_(!0),U&&r.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let V=0,q=i;V<q.length;V+=1){const Y=q[V];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let V;P(!1),h=!0;try{V=o.play(),V?V.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let V=0,q=i;V<q.length;V++){const Y=q[V];U?window.addEventListener(Y,z,{capture:!0,passive:!0}):window.removeEventListener(Y,z,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function z(){R(!0)}if(yo()){const U=r.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=V.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Qn.on(is.STATE_CHANGE,function(){m(!0)}),m(!1)}(Mc)}(),!Mc)throw new Ne(X.NOT_SUPPORTED,"can not create audio context");return Mc}return Mc}function O_(e){if(function(){if(ox!==null)return ox;const o=Lv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),ox=m,m}())return;const r=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),st(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?AA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let ox=null;function ax(e,r){let i=!1;const o=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Lv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class y8{constructor(){we(this,"context",void 0),we(this,"analyserNode",void 0),we(this,"sourceNode",void 0),this.context=Lv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||yo()||ou()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const i=za(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class v8 extends Ar{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),we(this,"outputNode",void 0),we(this,"outputTrack",void 0),we(this,"isPlayed",!1),we(this,"sourceNode",void 0),we(this,"context",void 0),we(this,"audioBufferNode",void 0),we(this,"destNode",void 0),we(this,"audioOutputLevel",0),we(this,"volumeLevelAnalyser",void 0),we(this,"_processedNode",void 0),we(this,"playNode",void 0),we(this,"isDestroyed",!1),we(this,"onNoAudioInput",void 0),we(this,"isNoAudioInput",!1),we(this,"_noAudioInputCount",0),this.context=Lv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),O_(this.outputNode),this.volumeLevelAnalyser=new y8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Lc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Nn().webAudioMediaStreamDest)throw new Ne(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&PA(()=>{Qn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;yo()||ou()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ns(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class S8 extends v8{get isFreeze(){return!1}constructor(r,i,o){var c;if(super(),we(this,"sourceNode",void 0),we(this,"track",void 0),we(this,"clonedTrack",void 0),we(this,"audioElement",void 0),we(this,"isCurrentTrackCloned",!1),we(this,"isRemoteTrack",!1),we(this,"originVolumeLevelAnalyser",void 0),we(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),O_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),O_(this.outputNode),this.emit(Lc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Ne(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),O_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));O_(_),this.originVolumeLevelAnalyser=new y8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Cn();i&&h.os===Li.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Qn.on(is.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),O_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Lc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Qn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),D.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));O_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function T8(e,r,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function zfe(e,r){const i=await b8(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ct((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const z=document.createElement("button");z.innerHTML="cancel",z.setAttribute("style","width: 85px;"),z.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const V=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const le=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},V.appendChild(Y),V.appendChild(le)}k.appendChild(V),k.appendChild(z),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ge=Y.thumbnail;try{const{width:Ee}=ge.getSize();Ee>1920&&(ge=ge.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ge.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(le)}})})}(i,r);return await T8(o,e,c)}async function b8(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=xW();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Ne(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ct((u,h)=>{i.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Ne(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const cx=new Cs("safari");let w8=!1,R8=!1;async function Uc(e,r){let i=0,o=null;for(;i<2;)try{o=await Gfe(e,r,i>0);break}catch(c){if(c instanceof Ne)throw D.error("[".concat(r,"] ").concat(c.toString())),c;const u=jA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){D.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await ns(500);continue}throw D.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Ne(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Gfe(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ne(X.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Nn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(xW())e.screen.sourceId?xv(c,await T8(e.screen.sourceId,e.screen,!!e.screenAudio)):xv(c,await zfe(e.screen,!!e.screenAudio));else if(Bf()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Ne(X.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new ct((k,z)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return D.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void z(new Ne(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){D.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),z(new Ne(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,xv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&f8(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:V}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:z,systemAudio:U,preferCurrentTab:V};!k&&delete q.selfBrowserSurface,!z&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!V&&delete q.preferCurrentTab,D.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:q})),xv(c,await navigator.mediaDevices.getDisplayMedia(wr({video:P,audio:e.screenAudio},q)))}else{if(!Nr())throw D.error("[".concat(r,"] This browser does not support screenSharing")),new Ne(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&f8(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),xv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=FL(_,y)}catch{}D.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Cn();let S,R=null;(gs()||yo()||CA())&&(R=await cx.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(w8=!0),_.video&&(R8=!0),xv(c,S),R&&R(),c}function jA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ne(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Ne(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Ne(X.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Ne(X.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ne(X.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Ne(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return D.error("getUserMedia unexpected error",e),new Ne(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function xv(e,r){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Vc=new class extends Ar{get state(){return this._state}set state(e){e!==this._state&&(this.emit(P_.STATE_CHANGE,e),this._state=e)}constructor(){super(),we(this,"_state",pb.IDLE),we(this,"isAccessMicrophonePermission",!1),we(this,"isAccessCameraPermission",!1),we(this,"lastAccessMicrophonePermission",!1),we(this,"lastAccessCameraPermission",!1),we(this,"checkdeviceMatched",!1),we(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(IA()||RA()===Li.HARMONY_OS)&&Wf())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ne(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(cx.isLocked&&(D.debug("[device manager] wait GUM lock"),(await cx.lock())(),D.debug("[device manager] GUM unlock")),w8&&(u=!1,this.isAccessMicrophonePermission=!0),R8&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=jA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=jA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=jA(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;D.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),m=null,_=null,y=null,new Ne(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new Ne(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=pb.INITING;try{await this.updateDevicesInfo(),this.state=pb.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=pb.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ne(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):D.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",i.push(c))}),this.state!==pb.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(P_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(P_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(P_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let lx=!1;const Fc=new class extends Ar{constructor(){super(...arguments),we(this,"onAutoplayFailed",void 0),we(this,"onAudioAutoplayFailed",void 0)}};function C8(){if(Cn(),!lx){const e=r=>{r.preventDefault(),lx=!1,sb()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};lx=!0,sb()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fc.onAutoplayFailed?Fc.onAutoplayFailed():Fc.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Fc.emit("autoplay-failed")}}function I8(e,r,i,o){if(!e)return;const c=wt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=wr(wr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Fc.onAutoplayFailed||Fc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});wt.send({type:br.AUTOPLAY_FAILED,data:m},!0)}const Hfe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ho=new class{constructor(){we(this,"onAutoplayFailed",void 0),we(this,"elementMap",new Map),we(this,"elementStateMap",new Map),we(this,"elementsNeedToResume",[]),we(this,"sinkIdMap",new Map),we(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(D.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Qn.curState==="running")return Sv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),we(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Qn.on(is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.on(is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Qn.on(is.STATE_CHANGE,()=>{yo()&&Qn.prevState==="suspended"&&Qn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new Ne(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,eo.INIT),this.setVolume(r,i);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{D.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&I8(o,"audio",m.message,r),D.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),PA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),C8()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){Hfe.forEach(i=>{r.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{D.debug("Auto resume audio element success")}).catch(i=>{D.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new ct(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{sb()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Xr(){return function(e,r,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Ne(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof ct?new ct((_,y)=>{m.then(_).catch(y)}):m}),i}}class A8 extends Ar{constructor(r){super(),we(this,"name","VideoProcessorDestination"),we(this,"ID","0"),we(this,"_source",void 0),we(this,"videoContext",void 0),we(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ne(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ne(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(vo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(vo.ON_TRACK,void 0)}}class P8 extends Ar{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),we(this,"constraintsMap",new Map),we(this,"statsRegistry",[]),we(this,"usageRegistry",[]),we(this,"trackId",void 0),we(this,"direction",void 0),we(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await Es(this,xc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),sr(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return D.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),sr(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Ne(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ct&&(o=await o),r.push(wr(wr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class O8 extends Ar{constructor(r){super(),we(this,"name","AudioProcessorDestination"),we(this,"ID","0"),we(this,"inputTrack",void 0),we(this,"inputNode",void 0),we(this,"audioProcessorContext",void 0),we(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ne(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ne(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(vo.ON_TRACK,void 0),this.emit(vo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(vo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(vo.ON_NODE,this.inputNode))}}class k8 extends Ar{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),we(this,"constraintsMap",new Map),we(this,"statsRegistry",[]),we(this,"audioContext",void 0),we(this,"trackId",void 0),we(this,"direction",void 0),we(this,"usageRegistry",[]),we(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return Es(this,xc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),sr(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),sr(this,xc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Pc(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Ne(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof ct&&(o=await o),r.push(wr(wr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class ux extends Ar{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),we(this,"context",void 0),we(this,"processSourceNode",void 0),we(this,"outputTrack",void 0),we(this,"processedNode",void 0),we(this,"clonedTrack",void 0),we(this,"outputNode",void 0),this.outputNode=new $fe}setVolume(){}createOutputTrack(){throw new Ne(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class $fe{disconnect(){}connect(){}}function N8(e){return new ct((r,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=yo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Nr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(OA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function BA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=fh(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!OW()&&i.frameRate&&(r.frameRate=i.frameRate),TW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Nr()&&(r.frameRate={ideal:30,max:30}),r}function D8(e){const r={};return OW()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,Bf()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function L8(e){const r=D8(e);if(e.encoderConfig){const i=VA(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),IA()&&(r.sampleRate=void 0),r}const Kfe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=jL(h),m=jL(m),u=jL(u);const{max:_,min:y}=function(k,z,U){const V=200*Math.pow(U/15,.6)*Math.pow(k*z/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||y,scaleResolutionDownBy:1,scale:0}},x8=async(e,r,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let R=0;R<y.length;R+=2)S.push(parseInt(y.slice(R,R+2),16));return Uint8Array.from(S)}($W(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,r,i),dx=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ct((i,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await M8(c);i({buffer:u,width:r.width,height:r.height})}else o(new Ne(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},M8=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var U8,V8,F8,j8,B8,W8,z8,G8,H8,$8,K8,q8,Y8,X8,J8,Q8,Z8,ez,Pr,tz,nz,rz,iz,sz,oz,mh,az,cz,lz,uz,dz,hz,fz,pz,mz,gz,_z,Ez,yz,vs;let jr=(U8=Ut({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),V8=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),F8=Xr(),j8=wv("LocalAudioTrack","_enabledMutex"),B8=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),W8=Xr(),z8=wv("LocalAudioTrack","_enabledMutex"),G8=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),H8=Xr(),$8=Xr(),K8=Xr(),q8=Ut({argsMap:e=>[e.getTrackId()]}),Y8=Xr(),X8=Ut({argsMap:e=>[e.getTrackId()]}),J8=Xr(),Q8=Ut({argsMap:e=>[e.getTrackId()]}),Z8=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),ez=Ut({argsMap:e=>[e.getTrackId()]}),An((Pr=class extends Dv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ho.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),we(this,"trackMediaType",Nv.AUDIO),we(this,"_encoderConfig",void 0),we(this,"_trackSource",void 0),we(this,"metadata",[]),we(this,"_enabled",!0),we(this,"_volume",100),we(this,"_useAudioElement",!0),we(this,"_bypassWebAudio",!1),we(this,"processor",void 0),we(this,"_processorContext",void 0),we(this,"_processorDestination",void 0),we(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new ux,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),gs()&&!Mc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){tr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ho.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,sr(this,Et.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!d8())throw new Ne(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ho.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await sr(this,Et.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await sr(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sr(this,Et.NEED_MUTE_TRACK,this):await sr(this,Et.NEED_UNMUTE_TRACK,this))}getStats(){return vm(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),kc(this,Et.GET_STATS)||wr({},rx)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),this._source.on(Lc.ON_AUDIO_BUFFER,i=>e(i))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ho.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ho.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ho.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,Et.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ct.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ne(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ne(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(vo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await sr(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,Et.NEED_REPLACE_TRACK,this))}),e.on(vo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(vo.ON_TRACK),e.removeAllListeners(vo.ON_NODE)}bindProcessorContextEvents(e){e.on(xc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(xc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof ux&&(this._trackSource=new S8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new k8(this._source.context,this.getTrackId(),"local"),r=new O8(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(Lc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ho.stop(this.getTrackId()),this._source.play()),sr(this,Et.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[U8],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),An(Pr.prototype,"setPlaybackDevice",[V8,F8],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),An(Pr.prototype,"setEnabled",[j8,B8,W8],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),An(Pr.prototype,"setMuted",[z8,G8,H8],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),An(Pr.prototype,"getStats",[$8],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),An(Pr.prototype,"setAudioFrameCallback",[K8],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),An(Pr.prototype,"play",[q8,Y8],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),An(Pr.prototype,"stop",[X8,J8],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),An(Pr.prototype,"close",[Q8],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),An(Pr.prototype,"pipe",[Z8],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),An(Pr.prototype,"unpipe",[ez],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),WA=(tz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),nz=Xr(),rz=wv("MicrophoneAudioTrack","_enabledMutex"),iz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),sz=Xr(),oz=Ut({argsMap:e=>[e.getTrackId()]}),An((mh=class extends jr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?VA(r.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),we(this,"_config",void 0),we(this,"_deviceName","default"),we(this,"_constraints",void 0),we(this,"_originalConstraints",void 0),we(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Sv()||NL())&&Qn.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await Vc.getDeviceById(e),i={};i.audio=wr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Uc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Uc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Vc.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(yo()||ou())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await sr(this,Et.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=wr({},this._constraints),u=Vc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Uc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sr(this,Et.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Sv()||NL())&&Qn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((yo()||ou())&&this._enabled&&!this._isClosed&&Qn.duringInterruption){const e=async()=>{Qn.off(is.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qn.on(is.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ov.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=Vc.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await Uc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(xc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(xc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[tz,nz],Object.getOwnPropertyDescriptor(mh.prototype,"setDevice"),mh.prototype),An(mh.prototype,"setEnabled",[rz,iz,sz],Object.getOwnPropertyDescriptor(mh.prototype,"setEnabled"),mh.prototype),An(mh.prototype,"close",[oz],Object.getOwnPropertyDescriptor(mh.prototype,"close"),mh.prototype),mh),qfe=(az=Ut({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),cz=Xr(),lz=Ut({argsMap:e=>[e.getTrackId()]}),uz=Xr(),dz=Ut({argsMap:e=>[e.getTrackId()]}),hz=Xr(),fz=Ut({argsMap:e=>[e.getTrackId()]}),pz=Xr(),mz=Ut({argsMap:e=>[e.getTrackId()]}),gz=Xr(),_z=Ut({argsMap:e=>[e.getTrackId()]}),Ez=Ut({argsMap:e=>[e.getTrackId()]}),yz=Xr(),An((vs=class extends jr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),we(this,"source",void 0),we(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(Lc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Ov.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){tr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[az,cz],Object.getOwnPropertyDescriptor(vs.prototype,"startProcessAudioBuffer"),vs.prototype),An(vs.prototype,"pauseProcessAudioBuffer",[lz,uz],Object.getOwnPropertyDescriptor(vs.prototype,"pauseProcessAudioBuffer"),vs.prototype),An(vs.prototype,"seekAudioBuffer",[dz,hz],Object.getOwnPropertyDescriptor(vs.prototype,"seekAudioBuffer"),vs.prototype),An(vs.prototype,"resumeProcessAudioBuffer",[fz,pz],Object.getOwnPropertyDescriptor(vs.prototype,"resumeProcessAudioBuffer"),vs.prototype),An(vs.prototype,"stopProcessAudioBuffer",[mz,gz],Object.getOwnPropertyDescriptor(vs.prototype,"stopProcessAudioBuffer"),vs.prototype),An(vs.prototype,"close",[_z],Object.getOwnPropertyDescriptor(vs.prototype,"close"),vs.prototype),An(vs.prototype,"setAudioBufferPlaybackSpeed",[Ez,yz],Object.getOwnPropertyDescriptor(vs.prototype,"setAudioBufferPlaybackSpeed"),vs.prototype),vs);class Ti extends jr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Lv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,or(8,"track-mix-")),we(this,"trackList",void 0),we(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(D.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):D.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){D.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}AA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof Ti?i.emit(A_.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class Yfe extends v8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Lc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),we(this,"audioBuffer",void 0),we(this,"sourceNode",void 0),we(this,"startPlayTime",0),we(this,"startPlayOffset",0),we(this,"pausePlayTime",0),we(this,"options",void 0),we(this,"currentLoopCount",0),we(this,"currentPlaybackSpeed",100),we(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const vz=new Map;class hx{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){we(this,"trackId",void 0),we(this,"config",void 0),we(this,"onFirstVideoFrameDecoded",void 0),we(this,"onVideoStateChanged",void 0),we(this,"freezeTimeCounterList",[]),we(this,"renderFreezeAccTime",0),we(this,"isKeepLastFrame",!1),we(this,"timeUpdatedCount",0),we(this,"freezeTime",0),we(this,"playbackTime",0),we(this,"lastTimeUpdatedTime",0),we(this,"autoplayFailed",!1),we(this,"videoTrack",void 0),we(this,"videoElement",void 0),we(this,"cacheVideoElement",void 0),we(this,"renderStats",void 0),we(this,"_videoState",ph.VideoStateStopped),we(this,"videoElementCheckInterval",void 0),we(this,"videoElementFreezeTimeout",void 0),we(this,"_videoElementStatus",eo.NONE),we(this,"isGettingVideoDimensions",!1),we(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),we(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Qn.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(SW())),AW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),we(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=eo.PLAYING;break;case"loadeddata":if(this.videoState=ph.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=eo.CANPLAY;break;case"stalled":this.videoElementStatus=eo.STALLED;break;case"suspend":this.videoElementStatus=eo.SUSPEND;break;case"pause":this.videoElementStatus=eo.PAUSED,yo()||ou()||gs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=eo.WAITING;break;case"abort":this.videoElementStatus=eo.ABORT;break;case"ended":this.videoElementStatus=eo.ENDED;break;case"emptied":this.videoElementStatus=eo.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=eo.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Hf.lastVisibleTime<Hf.lastHiddenTime||u<Hf.lastHiddenTime||u<Hf.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),we(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(SW())),AW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Qn.on(is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.on(is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{r&&I8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Cn();if((o.name==="Safari"&&Number(o.version)===15||Sv())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return D.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ct((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await M8(m);u({buffer:_,width:o.width,height:o.height})}else h(new Ne(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await dx(r)}destroy(){this.renderStats=void 0,Qn.off(is.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Qn.off(is.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ph.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=eo.INIT,!this.videoElementCheckInterval&&(Sz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=eo.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ph.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ph.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===eo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===ph.VideoStateStarting&&(this.videoState=ph.VideoStateDecoding),this.videoState===ph.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===ph.VideoStateFrozen&&(this.videoState=ph.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Hf.lastVisibleTime>=Hf.lastHiddenTime&&u.timestamp>Hf.lastVisibleTime&&u.timestamp>Hf.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=wr(wr({},S),{},{timestamp:y})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),IA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Cn();o.name==="Safari"&&Number(o.version)===15||Sv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{D.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Sz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=eo.NONE}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{D.error(o)}),this.autoplayFailed=!1,sb()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};sb()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),C8()}}const Sz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Tz extends hx{constructor(r){super(r),we(this,"container",void 0),we(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await dx(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var bz,wz,Rz,Cz,Iz,Az,Pz,Oz,kz,Nz,Dz,Lz,xz,Mz,Uz,Vz,Fz,jz,Bz,Wz,zz,Gz,Hz,$z,bn,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,jc;let pr=(bz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),wz=Xr(),Rz=Ut({argsMap:e=>[e.getTrackId()]}),Cz=wv("LocalVideoTrack","_enabledMutex"),Iz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Az=Xr(),Pz=wv("LocalVideoTrack","_enabledMutex"),Oz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),kz=Xr(),Nz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Dz=Xr(),Lz=Xr(),xz=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),Mz=Xr(),Uz=Xr(),Vz=Xr(),Fz=Xr(),jz=Xr(),Bz=Xr(),Wz=Xr(),zz=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Gz=Ut({argsMap:e=>[e.getTrackId()]}),Hz=Ut({argsMap:e=>[e.getTrackId()]}),$z=Ut({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),bn=class Nse extends Dv{get videoHeight(){if(gs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(gs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,c,u,h){if(super(r,u),we(this,"trackMediaType",Nv.VIDEO),we(this,"_player",void 0),we(this,"isUseScaleResolutionDownBy",!1),we(this,"_videoVisibleTimer",null),we(this,"_previousVideoVisibleStatus",void 0),we(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),we(this,"_encoderConfig",void 0),we(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),we(this,"_optimizationMode",void 0),we(this,"_videoHeight",void 0),we(this,"_videoWidth",void 0),we(this,"_forceBitrateLimit",void 0),we(this,"_enabled",!0),we(this,"_processorDestination",void 0),we(this,"_processorContext",void 0),gs()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(PL(Un.CHROME,115)&&RA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&Nn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,z=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let V=window.setInterval(()=>{if(k&&P&&Date.now()-z>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,le)=>{R.readyState==="live"?(k=le,z=Date.now(),P===void 0?(P=Y,le.enqueue(Y.clone())):(le.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new P8(this.getTrackId(),"local"),this._processorDestination=new A8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=wr(wr(wr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new hx(o):this._player=new Tz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Ov.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await sr(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sr(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await sr(this,Et.NEED_MUTE_TRACK,this):await sr(this,Et.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Ne(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=BA({encoderConfig:r});(gs()||yo()||ou())&&(o.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Ne(X.UNEXPECTED_ERROR,c.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(D)}}getStats(){return vm(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),kc(this,Et.GET_STATS)||wr({},ix)}async setBeautyEffect(r){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await dx(r)}async setBitrateLimit(r){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void D.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await sr(this,Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return D.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){N8(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(OA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Ne(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var z;const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));P=k==="STANDARD_BITRATE"?4*V:2*V,R=(z=R)!==null&&z!==void 0?z:V}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,i;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=DW.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:gi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Ne(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Ne(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=wr(wr({},o),fh(r))),o=w_(o);const c=or(8,"track-video-cloned-"),u=new Nse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,w_(this._scalabilityMode),this._optimizationMode,c,w_(this._hints));return r&&o&&u.setEncoderConfiguration(o),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new Ne(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Ne(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(vm(()=>{wt.reportApiInvoke(null,{name:gi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Lr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Ne(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void D.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):D.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(vo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await sr(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,Et.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(xc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(xc.REQUEST_CONSTRAINTS)}},An(bn.prototype,"play",[bz,wz],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),An(bn.prototype,"stop",[Rz],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),An(bn.prototype,"setEnabled",[Cz,Iz,Az],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),An(bn.prototype,"setMuted",[Pz,Oz,kz],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),An(bn.prototype,"setEncoderConfiguration",[Nz,Dz],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),An(bn.prototype,"getStats",[Lz],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),An(bn.prototype,"setBeautyEffect",[xz,Mz],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),An(bn.prototype,"getCurrentFrameData",[Uz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),An(bn.prototype,"getCurrentFrameImage",[Vz],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),An(bn.prototype,"setBitrateLimit",[Fz],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),An(bn.prototype,"setOptimizationMode",[jz],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),An(bn.prototype,"setScalabiltyMode",[Bz],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),An(bn.prototype,"updateMediaStreamTrackResolution",[Wz],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),An(bn.prototype,"pipe",[zz],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),An(bn.prototype,"unpipe",[Gz],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),An(bn.prototype,"close",[Hz],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),An(bn.prototype,"replaceTrack",[$z],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),fx=(Kz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),qz=Xr(),Yz=wv("CameraVideoTrack","_enabledMutex"),Xz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Jz=Xr(),Qz=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),Zz=Xr(),eG=Ut({argsMap:e=>[e.getTrackId()]}),jc=class Dse extends pr{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,c,u,h){super(r,fh(i.encoderConfig),c,u,h),we(this,"_config",void 0),we(this,"_originalConstraints",void 0),we(this,"_constraints",void 0),we(this,"_enabled",!0),we(this,"_deviceName","default"),we(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Sv()||NL())&&!function(){const m=Cn();if(m.os!==Li.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&PW()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=fh(this._config.encoderConfig),Qn.on(is.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qn.on(is.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await Vc.getDeviceById(r),o={};o.video=wr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Uc(o,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Uc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Vc.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:wr(wr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Uc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Uc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=wr({},i.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Uc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await sr(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await sr(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new Ne(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=xr(this._config);o.encoderConfig=r;const c=BA(o);(gs()||yo()||ou())&&(c.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Ne(X.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((yo()||ou())&&this._enabled&&!this._isClosed&&Qn.duringInterruption){const r=async()=>{Qn.off(is.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Qn.on(is.IOS_INTERRUPTION_END,r)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ov.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,o=Vc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await Uc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Qn.off(is.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Qn.off(is.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=wr(wr({},o),fh(r))),o=w_(o);const c=or(8,"track-cam-cloned-"),u=new Dse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,w_(wr(wr({},this._config),{},{encoderConfig:o})),w_(this._constraints),w_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(xc.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(xc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},An(jc.prototype,"setDevice",[Kz,qz],Object.getOwnPropertyDescriptor(jc.prototype,"setDevice"),jc.prototype),An(jc.prototype,"setEnabled",[Yz,Xz,Jz],Object.getOwnPropertyDescriptor(jc.prototype,"setEnabled"),jc.prototype),An(jc.prototype,"setEncoderConfiguration",[Qz,Zz],Object.getOwnPropertyDescriptor(jc.prototype,"setEncoderConfiguration"),jc.prototype),An(jc.prototype,"close",[eG],Object.getOwnPropertyDescriptor(jc.prototype,"close"),jc.prototype),jc);function px(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=wr(wr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?D.debug("[".concat(e,"] set content hint to"),i.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var tG,nG,rG,iG,_l,sG,oG,aG,cG,lG,uG,to;class dG extends _8{getUserId(){return this._userId}constructor(r,i,o,c){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(or(5,""))),we(this,"_userId",void 0),we(this,"_uintId",void 0),we(this,"_isDestroyed",!1),we(this,"store",void 0),we(this,"processor",void 0),we(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Mv=(tG=Ut({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),nG=Ut({argsMap:e=>[e.getTrackId()]}),rG=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),iG=Ut({argsMap:e=>[e.getTrackId()]}),An((_l=class extends dG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),we(this,"_videoVisibleTimer",null),we(this,"_previousVideoVisibleStatus",void 0),we(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),we(this,"trackMediaType",Nv.VIDEO),we(this,"_videoWidth",void 0),we(this,"_videoHeight",void 0),we(this,"_player",void 0),we(this,"processorDestination",void 0),we(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new P8(this.getTrackId(),"remote"),this.processorDestination=new A8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return vm(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),kc(this,Et.GET_STATS)||wr({},m8)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=wr(wr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new hx(i):this._player=new Tz(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(kv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(kv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(kv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){N8(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(OA)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=DW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:gi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Ne(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ne(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(A_.SEI_RECEIVED,e)}}).prototype,"play",[tG],Object.getOwnPropertyDescriptor(_l.prototype,"play"),_l.prototype),An(_l.prototype,"stop",[nG],Object.getOwnPropertyDescriptor(_l.prototype,"stop"),_l.prototype),An(_l.prototype,"pipe",[rG],Object.getOwnPropertyDescriptor(_l.prototype,"pipe"),_l.prototype),An(_l.prototype,"unpipe",[iG],Object.getOwnPropertyDescriptor(_l.prototype,"unpipe"),_l.prototype),_l),Uv=(sG=Ut({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),oG=Ut({argsMap:(e,r)=>[e.getTrackId(),r]}),aG=Ut({argsMap:e=>[e.getTrackId()]}),cG=Ut({argsMap:e=>[e.getTrackId()]}),lG=Ut({argsMap:(e,r)=>[e.getTrackId(),r.name]}),uG=Ut({argsMap:e=>[e.getTrackId()]}),An((to=class extends dG{get isPlaying(){return this._useAudioElement?Ho.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),we(this,"trackMediaType",Nv.AUDIO),we(this,"_source",void 0),we(this,"_useAudioElement",!0),we(this,"_volume",100),we(this,"processorContext",void 0),we(this,"processorDestination",void 0),we(this,"_played",!1),we(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new ux,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new S8(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Lc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(kv.FIRST_FRAME_DECODED)}),this.processorContext=new k8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new O8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Lc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Lc.ON_AUDIO_BUFFER),this._source.on(Lc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?Ho.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!d8())throw new Ne(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ho.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return vm(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),kc(this,Et.GET_STATS)||wr({},p8)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ho.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ho.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ho.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ne(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ne(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ne(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vo.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(vo.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vo.ON_TRACK),this.processorDestination.removeAllListeners(vo.ON_NODE)}}).prototype,"setVolume",[sG],Object.getOwnPropertyDescriptor(to.prototype,"setVolume"),to.prototype),An(to.prototype,"setPlaybackDevice",[oG],Object.getOwnPropertyDescriptor(to.prototype,"setPlaybackDevice"),to.prototype),An(to.prototype,"play",[aG],Object.getOwnPropertyDescriptor(to.prototype,"play"),to.prototype),An(to.prototype,"stop",[cG],Object.getOwnPropertyDescriptor(to.prototype,"stop"),to.prototype),An(to.prototype,"pipe",[lG],Object.getOwnPropertyDescriptor(to.prototype,"pipe"),to.prototype),An(to.prototype,"unpipe",[uG],Object.getOwnPropertyDescriptor(to.prototype,"unpipe"),to.prototype),to);const Hf=new class extends Ar{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),we(this,"_lastHiddenTime",0),we(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class hG extends Ar{constructor(r,i){super(),we(this,"trackMediaType",Nv.DATA),we(this,"_version",1),we(this,"_type",3),we(this,"_config",void 0),we(this,"_originDataChannel",void 0),we(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),we(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),we(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ct((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;i(new Ne(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Ne(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Ne(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[FA.OPEN,FA.CLOSE,FA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Xfe extends hG{constructor(r){super(r),we(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(FA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Jfe extends hG{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function zA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>zI.revokeObjectURL(e),0),new Worker(zI.createObjectURL(e))}const fG=71,mx=1,gx=2,_x=1,pG=2;var $f=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}($f||{});function mG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==fG)return;const o=e.getUint16(1),c=mx+gx+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=mx+gx;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+_x),S=_x+pG;if(_===$f.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<y;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:r?127^R>>1:127&R})}else if(_===$f.METADATA||_===$f.AUDIO_64_BIT_PTS){const R=new Uint8Array(y);for(let P=0;P<y;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:_,length:y,value:R})}m+=S+y}return h}const GA=new Map,HA=127,k_=1e-10,Ex=139/13,$A=new Map;function yx(e,r,i){const o="".concat(e,"-").concat(r,"-").concat(i);let c=0;return $A.has(o)?c=$A.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,R=1;S>m;S--,R++)y=y*S/R;return y}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,$A.set(o,c)),c<k_&&(c=k_),c}function gG(e,r,i){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=$A;let Qfe=0;class _G{constructor(r){we(this,"id",void 0),we(this,"immediates",[]),we(this,"lastNonSilence",-1),we(this,"immediateSpeechActivityScore",k_),we(this,"lastLevelChangedTime",Date.now()),we(this,"levels",[]),we(this,"longs",[]),we(this,"longSpeechActivityScore",k_),we(this,"mediums",[]),we(this,"mediumSpeechActivityScore",k_),we(this,"minLevel",0),we(this,"nextMinLevel",0),we(this,"nextMinLevelWindowLength",0),we(this,"energyScore",0),this.id=r||"".concat(Qfe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,o=this.minLevel+Ex;let c=!1;for(let u=0;u<r.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/Ex);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return gG(this.mediums,this.longs,4)}computeMediums(){return gG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=yx(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=yx(this.longs[0],10,47),this.longSpeechActivityScore>k_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=yx(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(Kp(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=r;return r<0&&(o=0),r>HA&&(o=HA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+Ex?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>HA&&(i=HA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Zfe{constructor(r){we(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class vx{constructor(r,i,o){we(this,"isDominant",void 0),we(this,"energyRanking",void 0),we(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=o}}class epe extends Ar{constructor(r){super(),we(this,"dominantId",null),we(this,"lastDecisionTime",0),we(this,"lastLevelChangedTime",0),we(this,"lastLevelIdleTime",0),we(this,"relativeSpeechActivities",[]),we(this,"speakers",new Map),we(this,"enableSilence",!1),we(this,"timeoutToSilenceInterval",0),we(this,"decisionMaker",null),we(this,"loudest",[]),we(this,"numLoudestToTrack",3),we(this,"energyExpireTimeMs",250),we(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new _G(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,o){const c=r.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new vx(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new vx(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new vx(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Zfe(this),this.decisionMaker.execute())}makeDecision(r){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Pc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let V=0;V<_.length;++V){const q=m==null?k_:m.getSpeechActivityScore(V);_[V]=Math.log(P.getSpeechActivityScore(V)/q)}const k=_[0],z=_[1],U=_[2];k>3&&z>2&&U>0&&z>y&&(y=z,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=i;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const i=[];for(const c of Pc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Vv=new Map;let hd=null,KA=null;const EG=3;let N_=[];const fd=new Map,qA=new Map;class tpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){we(this,"id",void 0),we(this,"track",void 0),we(this,"score",0),we(this,"active",!0),we(this,"muted",!1),we(this,"timer",0),we(this,"actives",0),we(this,"inactives",0),this.id=r,this.track=i,this.setActive(fd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(Pc(fd).call(fd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let o;return Array.from(Pc(fd).call(fd)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let o;return Array.from(Pc(fd).call(fd)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let YA;function yG(e){const r=fd.get(e);r&&(fd.delete(e),r.clearTimer())}const XA=new Map,npe=new Map;function rpe(e,r,i){let o=new Uint8Array(e,r,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const JA=new Map,mb=new Map;(function(){const e=Cn();rs.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),rs.getStreamFromExtension=e.name===Un.CHROME&&Number(e.version)>34,rs.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),rs.supportMinBitrate=e.name===Un.CHROME||e.name===Un.EDGE,rs.supportSetRtpSenderParameters=function(){const r=Cn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Wf()||!(!gs()&&!CA())||r.name===Un.FIREFOX&&Number(r.version)>=64)}(),e.name===Un.SAFARI&&(Number(e.version)>=14?rs.supportDualStream=!0:rs.supportDualStream=!1),rs.webAudioMediaStreamDest=function(){const r=Cn();return!(r.name===Un.SAFARI&&Number(r.version)<12)}(),rs.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",rs.supportWebGL=typeof WebGLRenderingContext<"u",rs.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Wf()||(rs.webAudioWithAEC=!0),rs.supportShareAudio=function(){const r=Cn();return(r.os===Li.WIN_10||r.os===Li.WIN_81||r.os===Li.WIN_7||r.os===Li.LINUX||r.os===Li.MAC_OS||r.os===Li.CHROMIUM_OS)&&r.name===Un.CHROME&&Number(r.version)>=74}(),rs.supportDataChannel=!!(ib(76)||function(r){const i=Cn();return!(i.name!==Un.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||wW(14)),rs.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Nr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),rs.supportWebRTCEncodedTransform=function(){const r=Cn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),rs.supportWebRTCInsertableStream=function(){const r=Cn();return(r.name===Un.CHROME||r.name===Un.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),rs.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,rs.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,PA(()=>{rs.supportDualStreamEncoding=function(){const r=Cn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",rs)})})();const ipe=["CHINA","GLOBAL"],vG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],D_=[],Fv=[];function L_(e,r){return!!r&&D_.some(i=>i.uid===e&&i.channelName===r)}function Sx(){return Fv.length>0}var spe=W5.forEach,SG=gf("forEach")?[].forEach:function(e){return spe(this,e,arguments.length>1?arguments[1]:void 0)};Mn({target:"Array",proto:!0,forced:[].forEach!=SG},{forEach:SG});var ope=Wa("Array").forEach,ape=Ec,cpe=fi,lpe=N,upe=ope,Tx=Array.prototype,dpe={DOMTokenList:!0,NodeList:!0},hpe=function(e){var r=e.forEach;return e===Tx||lpe(Tx,e)&&r===Tx.forEach||cpe(dpe,ape(e))?upe:r},fpe=l(hpe),ppe=Io,TG=Sc;Mn({target:"Object",stat:!0,forced:d(function(){TG(1)})},{keys:function(e){return TG(ppe(e))}});var bG=l(vt.Object.keys),mpe=l(YE),gpe=l(JE),_pe=Mn,wG=Vg,Epe=a_,ype=_t,RG=fe,vpe=ri,Spe=ve,Tpe=kI,bpe=ur,wpe=hs,Rpe=N5("slice"),Cpe=bpe("species"),bx=Array,Ipe=Math.max;_pe({target:"Array",proto:!0,forced:!Rpe},{slice:function(e,r){var i,o,c,u=Spe(this),h=vpe(u),m=RG(e,h),_=RG(r===void 0?h:r,h);if(wG(u)&&(i=u.constructor,(Epe(i)&&(i===bx||wG(i.prototype))||ype(i)&&(i=i[Cpe])===null)&&(i=void 0),i===bx||i===void 0))return wpe(u,m,_);for(o=new(i===void 0?bx:i)(Ipe(_-m,0)),c=0;m<_;m++,c++)m in u&&Tpe(o,c,u[m]);return o.length=c,o}});var Ape=Wa("Array").slice,Ppe=N,Ope=Ape,wx=Array.prototype,kpe=function(e){var r=e.slice;return e===wx||Ppe(wx,e)&&r===wx.slice?Ope:r},Npe=l(kpe);function yt(e,r,i,o,c){var u,h,m,_={};return fpe(u=bG(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=mpe(h=gpe(m=Npe(i).call(i)).call(m)).call(h,function(y,S){return S(e,r,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(A5(e,r,_),_=null),_}let QA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Rx=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),lu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),So=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Lt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),lr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Wt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Bt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),gb=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),_n=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),To=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Yt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function ZA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new Re(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function eP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||NW(e,1,255)))throw new Re(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Kf=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Dpe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Cx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Ix(e,r){ts(e.url,"".concat(r,".url"),1,1e3,!1),Dr(e.x)||tr(e.x,"".concat(r,".x"),0,1e4),Dr(e.y)||tr(e.y,"".concat(r,".y"),0,1e4),Dr(e.width)||tr(e.width,"".concat(r,".width"),0,1e4),Dr(e.height)||tr(e.height,"".concat(r,".height"),0,1e4),Dr(e.zOrder)||tr(e.zOrder,"".concat(r,".zOrder"),0,255),Dr(e.alpha)||tr(e.alpha,"".concat(r,".alpha"),0,1,!1)}const Lpe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let bm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Ax=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),bi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function CG(e){if(!e.channelName)throw new Re(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Re(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ts(e.token,"info.token",1,2047),eP(e.uid),ZA(e.channelName),!0}let bo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),qf=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),va=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),jv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Gn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),qi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),tP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Mi=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Vn=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const IG=[Vn.AFRICA,Vn.ASIA,Vn.CHINA,Vn.EUROPE,Vn.GLOBAL,Vn.INDIA,Vn.JAPAN,Vn.NORTH_AMERICA,Vn.OCEANIA,Vn.OVERSEA,Vn.SOUTH_AMERICA];let Is=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const nP={CHINA:{},ASIA:{CODE:Is.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Is.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Is.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Is.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Is.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Is.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Is.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Is.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Is.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Is.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Is.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Is.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Is.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};YL&&(nP.CHINA={CODE:Is.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let _b=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function AG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class PG extends Ar{constructor(r,i){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class OG extends PG{constructor(r,i){super(r,i),$(this,"establishPromise",void 0)}}let mt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),As=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),Yf=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const kG=["disconnected","failed"];let Ge=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),zn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),kt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),uu=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),du=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Yi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),NG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),gh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),El=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),pd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Bv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Jr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Wv=function(e){return e.ABORT="abort",e}({}),wm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),xpe=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const Mpe={[QA.ACCESS_POINT]:{[So.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[So.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[So.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[So.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[So.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[So.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[So.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[So.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[So.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[So.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[So.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[So.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[So.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[So.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[So.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[So.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[So.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[So.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[QA.UNILBS]:{[lu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[lu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[lu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[lu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[lu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[lu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[lu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[lu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[lu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[lu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[lu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[lu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[QA.STRING_UID_ALLOCATOR]:{[Rx.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Rx.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Rx.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function zv(e){const r=Mpe[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===QA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const Upe={[Lt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Lt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Lt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Lt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Lt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Lt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Lt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Lt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Lt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Lt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Lt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Lt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Lt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Lt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Lt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Lt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Lt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Lt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Lt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Lt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Lt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Lt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Lt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Lt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Lt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Lt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Lt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Lt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Lt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Lt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Lt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Lt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Lt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Lt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Lt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Lt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Lt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Lt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Lt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Lt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Lt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Lt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Lt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Lt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Lt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Lt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Lt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Lt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Lt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Lt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Lt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Lt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Lt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Lt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Lt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Lt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Lt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Lt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Lt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Eb(e){return Upe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function DG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Px(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?DG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):DG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function LG(e,r){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Vpe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Fpe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,jpe=/wss:\/\/(.+):([0-9]+)\/?/,Bpe=/wss:\/\/(.[^\/]+)\/?/;let Wpe=0;class zpe{constructor(r,i){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++Wpe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];D.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return st(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(LG(Px(Px({},r),{},{host:r.host.replace(m,P)}),i))});else{const P=Px({},r);if(i&&m){const k=c.find(z=>z!==m);k&&(P.host=P.host.replace(m,k))}_.push(LG(P,i))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Re(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const y=rb();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const z=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(z)),z&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:tP.A_ROUND_WS_FAILED})):!i&&z&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),i?this.isTry443PortFailed=z:this.isNormalPortFailed=z},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(y.isResolved)return S();Cn().os===Li.MAC_OS&&Nr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{y.resolve(P)}).catch(P=>{this.isNormalPortFailed&&y.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(r,i,o,c){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(Vpe)||[],h||([,m,_]=u.match(Fpe)||[]),m&&_||([,m,_]=u.match(jpe)||[]),m&&_||([,m]=u.match(Bpe)||[]),m||D.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function xG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class MG extends Ar{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;st(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Yt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Yt.CONNECTED):this._state==="closed"?this.emit(Yt.CLOSED):this._state==="failed"&&this.emit(Yt.FAILED))}resetReconnectCount(r){D.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?xG(Object(k),!0).forEach(function(z){$(R,z,k[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):xG(Object(k)).forEach(function(z){Object.defineProperty(R,z,Object.getOwnPropertyDescriptor(k,z))})}return R}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Cs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);Xa.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),si.on(Tv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Xa.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{const c=rb(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(NG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Yt.CLOSED,()=>{c.reject(new Ne(X.WS_DISCONNECT))}),this.once(Yt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ne(X.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Ne(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const o=rb();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(D.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Ne(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=kc(this,Yt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new Ne(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Yt.ON_MESSAGE,S)},m=S=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),r);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof Ne,k=P&&S.code===X.WS_ABORT,z=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||z?(o.reject(R?new Ne(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Ne(X.WS_ERR,"init websocket failed: ".concat(U))),z&&D.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||si.isOnline||!si.onlineWaiter||(this.onlineReconnectListener=si.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=BL(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ct.race([ns(h),this.onlineReconnectListener||new ct(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Yt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Es(this,Yt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class Ox extends MG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const o=rb(),c=function(h,m){return new zpe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Ne(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class yb extends MG{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new ct((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(z=>{z.onclose=null,z.onopen=null,z.onmessage=null,z.close()}),c(new Ne(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=r.indexOf("?h="),S=m.find(z=>y!==-1?st(r).call(r,z,y):st(r).call(r,z));D.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const z=Date.now();try{m.forEach(U=>{const V=y===-1?r.replace(S,U):r.substr(0,y)+r.substr(y).replace(S,U),q=new WebSocket(V);q.binaryType="arraybuffer",h.push(q),D.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(V=>V.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},i),h.forEach(U=>{U.onopen=()=>{if(u)return;const V=Date.now()-z;D.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter(q=>q!==U).forEach(q=>{D.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=V=>{_=V,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=V=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}}),ns(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let z;D.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},i);try{z=new WebSocket(r),h.push(z),z.binaryType="arraybuffer"}catch(U){const V=new Ne(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return D.error("[".concat(this.name,"]").concat(V)),void c(V)}z.onopen=()=>{o(z)},z.onclose=U=>{c(U)},z.onmessage=U=>{D.debug("[choose-best-ws]".concat(z.url," onmessage: ").concat(U.data))},ns(this.forceCloseTimeout).then(()=>{z&&z.readyState!==WebSocket.OPEN&&z.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Gpe extends Ar{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new qW(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wn.UID_BANNED);break;case 15:this.close(Wn.IP_BANNED);break;case 16:this.close(Wn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Wn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Wn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Wn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Wn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new Ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",_s.OFFLINE)})}async request(r,i,o,c){const u=or(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new ct((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const V=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,V),U(new Re(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,V),this.once(Wt.WS_CLOSED,q),r!==Bt.PUBLISH&&r!==Bt.PUBLISH_DATASTREAM&&r!==Bt.SUBSCRIBE&&r!==Bt.SUBSCRIBE_DATASTREAM&&r!==Bt.UNSUBSCRIBE&&r!==Bt.UNSUBSCRIBE_DATASTREAM&&r!==Bt.UNPUBLISH&&r!==Bt.UNPUBLISH_DATASTREAM&&r!==Bt.CONTROL&&r!==Bt.RESTART_ICE||this.once(Wt.DISCONNECT_P2P,()=>{U(new Re(X.DISCONNECT_P2P))}),r!==Bt.PUBLISH&&r!==Bt.RESTART_ICE||this.once(Wt.ABORT_P2P_EXECUTION,()=>{U(new Re(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===Bt.JOIN||r===Bt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new ct((z,U)=>{let V=!1;const q=(le,ge)=>{V=!0,z({isSuccess:le==="success",message:ge||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Re(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),ns(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(z){if(this.connectionState===lr.CLOSED||r===Bt.LEAVE)throw new Re(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===Bt.JOIN||r===Bt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=Eb(R),k=new Re(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===Bt.JOIN||r===Bt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_s.MULTI_IP)):this.reconnect(P.action,_s.SERVER_ERROR),r===Bt.JOIN||r===Bt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ct(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(gb.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ct((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,c=>o(this.initError||new Re(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Wn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Es(this,Wt.REQUEST_JOIN_INFO),i=await this.request(Bt.JOIN,r);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,tP.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Re(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=lb(this,Wt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(Bt.REJOIN,r);return!!i&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(_n.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:o.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_n.MUTE_VIDEO,{uid:o.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_n.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Eb(r.code);if(r.code===28&&"detail"in r&&(D.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Wt.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wn.UID_BANNED),void this.close()):void this.reconnect(i.action,_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_s.TIMEOUT):this.request(Bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(Bt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(gb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Yt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Yt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Yt.FAILED,()=>{this._disconnectedReason=Wn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Yt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Yt.WILL_RECONNECT,(r,i,o)=>{const c=lb(this,Wt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=tP.P2P_DISCONNECTED),u&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Wt.REPORT_JOIN_GATEWAY,i||tP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Wt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",_s.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Re){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return this.initError=new Re(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Wn.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_s.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Yt.REQUEST_NEW_URLS,(r,i)=>{Es(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(NG.PRE_CONNECT_PC,()=>{this.emit(Wt.PRE_CONNECT_PC)})}}let Hpe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),oi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function UG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function rP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?UG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):UG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Rm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function kx(e,r){e.addresses||(e.addresses=[]);const i=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&st(_).call(_,y[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:z}=R;if(P)return{address:"".concat(P,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(z),V=U?"".concat(z.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(z,":").concat(k);return U||D.debug("Cannot recognized as ip address: ".concat(z,", use as host")),{ip:z,port:k,address:V}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=Zs(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Ja(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function VG(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(Ja(r.width),"x").concat(Ja(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function FG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function vb(e,r){let i,o,c;switch(r){case oi.CHOOSE_SERVER:o=4096,c="choose server";break;case oi.CLOUD_PROXY:o=1048576,c="proxy";break;case oi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case oi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Re(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>rP(rP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:rP(rP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Re(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function jG(e,r){return await ct.all(e.addresses.map(async i=>({address:re("USE_TURN_IP")?i.ip:Rm(i.ip),tcpport:i.port,udpport:i.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():ys.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await UL(r.toString()):ys.password})))}function Nx(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,c=r.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(Ja(e.height),Ja(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Cm(e){let{candidateType:r,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function iP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in DA}(e)?e:DA.L1T3}const BG={[mt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[mt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function sP(e,r,i){r.forEach(o=>{var c;const u=BG[e].find(m=>{var _;let{key:y}=m;return st(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Gv(e,r){r.forEach(i=>{var o;const c=BG[e].find(u=>{var h;let{key:m}=u;return st(h=i.extensionName).call(h,m)});st(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function WG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(e).call(e,"abs-send-time")}function oP(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function zG(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function GG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?zG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Sb(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:y}=i;let S=[],R=[],P=[],k=[],z=!1,U=!1;if(ya(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||z||(R=q.attributes.payloads,k=q.attributes.extmaps,z=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return st(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var le;return st(_).call(_,((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=q.concat(c?[]:xx(q,R))}const V=re("UNSUPPORTED_VIDEO_CODEC");return V&&V.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(V).call(V,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Im(e){const r=ya(e);let i,o;for(const c of r.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function HG(e,r){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function $G(e,r,i){const{cname:o}=e;let c=[];r&&(c=KG(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),D.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=cP(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:mt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:mt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function KG(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function x_(e,r,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=or(8,"track-"),y={ssrcId:h,attributes:GG({label:_,mslabel:i=i||or(10,""),msid:"".concat(i," ").concat(_)},r&&{cname:r})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:GG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Hv(e,r){r instanceof jr&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Nr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function Dx(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function Lx(e,r){var i;if(!(r instanceof pr&&r._encoderConfig&&r._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Nn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Nn().supportMinBitrate&&!st(i=r._hints).call(i,ar.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function qG(e){if(e.media.mediaType!=="video")return;const r=Cn();if(r.name!==Un.SAFARI&&r.os!==Li.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function aP(e,r,i){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),r.twcc===!0){const u=o.find(h=>oP(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>oP(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>oP(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>WG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>WG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function YG(e,r,i){if(Nr()||e.media.mediaType!=="video"||!(r instanceof pr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!re("SIMULCAST")||i==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:xr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:xr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function XG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=Sb(y,m,_,"sendonly"),R=Sb(y,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hu(S,R,"videoExtensions",P,k,z),hu(S,R,"videoCodecs",P,k,z),hu(S,R,"audioExtensions",P,k,z),hu(S,R,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var ge,Ee;const pe=z.videoCodecs[Y+1],Pe=pe&&tH(q,pe),Ke=(ge=q.fmtp)===null||ge===void 0?void 0:ge.parameters["profile-level-id"],lt=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ke||Ke!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&lt!==re("FIRST_PACKETIZATION_MODE")?Pe?V.push([q,pe]):V.push([q]):Pe?U.push([q,pe]):U.push([q])}}),U.length>0&&V.length>0&&(D.debug("raising H264 baseline profile priority"),z.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const ge=tH(q,z.videoCodecs[Y+1]),Ee=U.shift()||V.shift()||[];Ee.length>0&&(ge?z.videoCodecs.splice(Y,2,...Ee):z.videoCodecs.splice(Y,1,...Ee))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:z}}(e,r,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function JG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=Sb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hu(e,r,"videoExtensions",i,o,c),hu(e,r,"videoCodecs",i,o,c),hu(e,r,"audioExtensions",i,o,c),hu(e,r,"audioCodecs",i,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){D.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function hu(e,r,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{r[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void r[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function cP(e){const{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function $v(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function Tb(e,r,i,o){let c=[];if(e===mt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(y):st(S).call(S,"vp9")?h.push(y):st(S).call(S,"vp8")?m.push(y):st(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=r.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=xx(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function xx(e,r){const i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function bb(e,r,i){const o=r.toString(),c=ZG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=QG(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function QG(e,r,i){const o=ya(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!st(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&$v(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Tm(o)}function ZG(e,r,i,o){if(re("SDP_LOGGING"))return D.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{ZG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function eH(e){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>st(e).call(e,i))}function tH(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function nH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function yl(e,r){return typeof re(e)===r?re(e):void 0}function $pe(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?nH(Object(o),!0).forEach(function(c){$(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):nH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const rH={};function Am(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),rH[e.name]=e}function Xf(e){const r=rH[e];if(!r)throw new Ne(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function iH(e,r){return Xf("DataStream").create(e,r)}function lP(){return Xf("InterceptFrame").create()}function sH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Jf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?sH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Mx=new Map;class Kpe extends Ar{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(qi.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(qi.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var o,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(o={spec:Jf(Jf({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(c=(u=Xf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Gpe(Jf(Jf({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=Mx.get(r.cname);if(u||(u=new Map,Mx.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const y=new Re(X.UID_CONFLICT);throw wt.joinGateway(r.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),y}u.set(r.uid,!0),this.joinInfo=r,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),z={host:P,port:k};return r.proxyServer&&(z.proxy=r.proxyServer),z});h=(await this.signal.init(y)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw D.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),wt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(qi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(qi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(qi.NETWORK_QUALITY,{uplinkNetworkQuality:FG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:FG(this._statsCollector.trafficStats.B_dnq)}):this.emit(qi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Wn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==lr.CONNECTED||await function(o,c){return c===1/0?o:ct.race([o,Efe(c)])}(this.signal.request(Bt.LEAVE,void 0,!0),3e3)}catch(o){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Wn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(Bt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw u}}async publishDataChannel(r,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Bt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Lt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw h}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Bt.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ct.all(r.map(i=>this.signal.request(Bt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){D.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Bt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,i,!1);throw u}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(Bt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw u}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Bt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw u}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Bt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Lt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(Bt.SET_VIDEO_PROFILE,i);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ct.all(r.map(o=>this.signal.request(Bt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){D.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Bt.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Bt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Bt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Bt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Bt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(Bt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Bt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(Bt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(Bt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Bt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Jf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Bt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=Mx.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ys.username,password:ys.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Jf(Jf({},ys),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Bt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&PA(()=>{this.emit(qi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Re(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(qi.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(Fv).call(Fv,c)||Fv.push(c);const u=!(Nr()||bW(87)||h8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!h8()&&yl("ENABLE_PREALLOC_PC","boolean"),m=$pe(),_=ib(87)||function(){const S=Cn();if(S.name!==Un.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),y=Jf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ml,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:Jf({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&PL(Un.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:yl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:yl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:yl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:yl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:yl("USE_XR","boolean"),enableLossbasedBwe:yl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:yl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?yl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:yl("PUBLISH_TWCC","boolean"),enableSubTWCC:yl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:yl("USE_PUB_RTX","boolean"),enableSubRTX:yl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Re(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Wt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Wt.WS_RECONNECTING,r=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||_s.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Wt.WS_CLOSED,r=>{let i;switch(r){case Wn.LEAVE:i=_s.LEAVE;break;case Wn.UID_BANNED:case Wn.IP_BANNED:case Wn.CHANNEL_BANNED:case Wn.SERVER_ERROR:i=_s.SERVER_ERROR;break;case Wn.FALLBACK:i=_s.FALLBACK;break;case Wn.LICENSE_MISSING:case Wn.LICENSE_EXPIRED:case Wn.LICENSE_MINUTES_EXCEEDED:case Wn.LICENSE_PERIOD_INVALID:case Wn.LICENSE_MULTIPLE_SDK_SERVICE:case Wn.LICENSE_ILLEGAL:case Wn.TOKEN_EXPIRE:i=r;break;default:i=_s.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+_s.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Wn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==Wn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Wt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Jn("EVENT_REPORT_DOMAIN",r[1]),Jn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Jn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Wt.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new Re(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Es(this,qi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Wt.REQUEST_JOIN_INFO,async(r,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=xr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;y.length>0&&(y=[y[R%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Es(this,qi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Wt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Wt.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Re?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Wt.IS_P2P_DISCONNECTED,r=>{r(lb(this,qi.IS_P2P_DISCONNECTED))}),this.signal.on(Wt.DISCONNECT_P2P,()=>{this.emit(qi.DISCONNECT_P2P)}),this.signal.on(Wt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Wt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Wt.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(qi.JOIN_RESPONSE,r,i)}),this.signal.on(Wt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),i=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){const o=KG(r);this.emit(qi.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Wt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(Bt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw D.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(Bt.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(Bt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw D.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Bt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){const o={action:r.find(c=>c.stream_type===Gn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,i){const o={action:r.find(c=>c.stream_type===Gn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,i){const o={action:r===mt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,i){const o={action:r===mt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Bt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Bt.RESTART_ICE,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||_s.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Bt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let uP=0,Ux=0;function md(e,r,i,o){return new ct((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),uP+=dh(r.data)):i&&(r.data.size?uP+=r.data.size:r.data instanceof FormData?uP+=BW(r.data):uP+=dh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,Go.request(r).then(h=>{typeof h.data=="string"?Ux+=dh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Ux+=h.data.byteLength:Ux+=dh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Go.isCancel(h)?u(new Re(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Re(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Re(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Re(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(je){var rt=0;return function(){return rt<je.length?{done:!1,value:je[rt++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,rt,Tt){return je==Array.prototype||je==Object.prototype||(je[rt]=Tt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var rt=0;rt<je.length;++rt){var Tt=je[rt];if(Tt&&Tt.Math==Math)return Tt}throw Error("Cannot find global object")}(this);function u(je,rt){if(rt)e:{var Tt=c;je=je.split(".");for(var ze=0;ze<je.length-1;ze++){var x=je[ze];if(!(x in Tt))break e;Tt=Tt[x]}(rt=rt(ze=Tt[je=je[je.length-1]]))!=ze&&rt!=null&&i(Tt,je,{configurable:!0,writable:!0,value:rt})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var rt=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return rt?rt.call(je):{next:r(je)}}if(u("Symbol",function(je){function rt(x,ie){this.A=x,i(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;rt.prototype.toString=function(){return this.A};var Tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ze=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new rt(Tt+(ie||"")+"_"+ze++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var rt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Tt=0;Tt<rt.length;Tt++){var ze=c[rt[Tt]];typeof ze=="function"&&typeof ze.prototype[je]!="function"&&i(ze.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(je,rt){if(je.__proto__=rt,je.__proto__!==rt)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,rt){return je.h=3,{value:rt}}function z(je){this.g=new R,this.G=je}function U(je,rt,Tt,ze){try{var x=rt.call(je.g.j,Tt);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(ue){return je.g.j=null,je.g.s(ue),V(je)}return je.g.j=null,ze.call(je.g,ie),V(je)}function V(je){for(;je.g.h;)try{var rt=je.G(je.g);if(rt)return je.g.m=!1,{value:rt.value,done:!1}}catch(Tt){je.g.v=void 0,je.g.s(Tt)}if(je.g.m=!1,je.g.l){if(rt=je.g.l,je.g.l=null,rt.F)throw rt.D;return{value:rt.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(rt){return je.o(rt)},this.throw=function(rt){return je.s(rt)},this.return=function(rt){return function(Tt,ze){P(Tt.g);var x=Tt.g.j;return x?U(Tt,"return"in x?x.return:function(ie){return{value:ie,done:!0}},ze,Tt.g.return):(Tt.g.return(ze),V(Tt))}(je,rt)},this[Symbol.iterator]=function(){return this}}function Y(je,rt){return rt=new q(new z(rt)),S&&je.prototype&&S(rt,je.prototype),rt}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},z.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),V(this))},z.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),V(this))},u("Array.prototype.entries",function(je){return je||function(){return function(rt,Tt){rt instanceof String&&(rt+="");var ze=0,x=!1,ie={next:function(){if(!x&&ze<rt.length){var ue=ze++;return{value:Tt(ue,rt[ue]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(rt,Tt){return[rt,Tt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(je,rt){for(var Tt=0;Tt<je.length;Tt++)rt(je[Tt])},ge=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Ee=function(je,rt,Tt){return rt instanceof Blob?(Tt=Tt!==void 0?Tt+"":typeof rt.name=="string"?rt.name:"blob",rt.name===Tt&&Object.prototype.toString.call(rt)!=="[object Blob]"||(rt=new File([rt],Tt)),[String(je),rt]):[String(je),String(rt)]},pe=function(je,rt){if(je.length<rt)throw new TypeError(rt+" argument required, but only "+je.length+" present.")},Pe=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ke=Pe.FormData,lt=Pe.XMLHttpRequest&&Pe.XMLHttpRequest.prototype.send,ht=Pe.Request&&Pe.fetch,Sn=Pe.navigator&&Pe.navigator.sendBeacon,Tn=Pe.Element&&Pe.Element.prototype,cr=Pe.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in Pe&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{Pe.File=function(rt,Tt,ze){return rt=new Blob(rt,ze||{}),Object.defineProperties(rt,{name:{value:Tt},lastModified:{value:+(ze&&ze.lastModified!==void 0?new Date(ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(rt,cr,{value:"File"}),rt}}var Qr=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Br=function(je){this.i=[];var rt=this;je&&le(je.elements,function(Tt){if(Tt.name&&!Tt.disabled&&Tt.type!=="submit"&&Tt.type!=="button"&&!Tt.matches("form fieldset[disabled] *"))if(Tt.type==="file"){var ze=Tt.files&&Tt.files.length?Tt.files:[new File([],"",{type:"application/octet-stream"})];le(ze,function(x){rt.append(Tt.name,x)})}else Tt.type==="select-multiple"||Tt.type==="select-one"?le(Tt.options,function(x){!x.disabled&&x.selected&&rt.append(Tt.name,x.value)}):Tt.type==="checkbox"||Tt.type==="radio"?Tt.checked&&rt.append(Tt.name,Tt.value):(ze=Tt.type==="textarea"?ge(Tt.value):Tt.value,rt.append(Tt.name,ze))})};if((e=Br.prototype).append=function(je,rt,Tt){pe(arguments,2),this.i.push(Ee(je,rt,Tt))},e.delete=function(je){pe(arguments,1);var rt=[];je=String(je),le(this.i,function(Tt){Tt[0]!==je&&rt.push(Tt)}),this.i=rt},e.entries=function je(){var rt,Tt=this;return Y(je,function(ze){if(ze.h==1&&(rt=0),ze.h!=3)return rt<Tt.i.length?ze=k(ze,Tt.i[rt]):(ze.h=0,ze=void 0),ze;rt++,ze.h=2})},e.forEach=function(je,rt){pe(arguments,1);for(var Tt=m(this),ze=Tt.next();!ze.done;ze=Tt.next()){var x=m(ze.value);ze=x.next().value,x=x.next().value,je.call(rt,x,ze,this)}},e.get=function(je){pe(arguments,1);var rt=this.i;je=String(je);for(var Tt=0;Tt<rt.length;Tt++)if(rt[Tt][0]===je)return rt[Tt][1];return null},e.getAll=function(je){pe(arguments,1);var rt=[];return je=String(je),le(this.i,function(Tt){Tt[0]===je&&rt.push(Tt[1])}),rt},e.has=function(je){pe(arguments,1),je=String(je);for(var rt=0;rt<this.i.length;rt++)if(this.i[rt][0]===je)return!0;return!1},e.keys=function je(){var rt,Tt,ze,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(rt=m(ie),Tt=rt.next()),ue.h!=3)return Tt.done?void(ue.h=0):(ze=Tt.value,x=m(ze),k(ue,x.next().value));Tt=rt.next(),ue.h=2})},e.set=function(je,rt,Tt){pe(arguments,2),je=String(je);var ze=[],x=Ee(je,rt,Tt),ie=!0;le(this.i,function(ue){ue[0]===je?ie&&(ie=!ze.push(x)):ze.push(ue)}),ie&&ze.push(x),this.i=ze},e.values=function je(){var rt,Tt,ze,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(rt=m(ie),Tt=rt.next()),ue.h!=3)return Tt.done?void(ue.h=0):(ze=Tt.value,(x=m(ze)).next(),k(ue,x.next().value));Tt=rt.next(),ue.h=2})},Br.prototype._asNative=function(){for(var je=new Ke,rt=m(this),Tt=rt.next();!Tt.done;Tt=rt.next()){var ze=m(Tt.value);Tt=ze.next().value,ze=ze.next().value,je.append(Tt,ze)}return je},Br.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),rt=[],Tt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ze,x){return typeof ze=="string"?rt.push(Tt+Qr(ge(x))+`"\r
\r
`+ge(ze)+`\r
`):rt.push(Tt+Qr(ge(x))+'"; filename="'+Qr(ze.name)+`"\r
Content-Type: `+(ze.type||"application/octet-stream")+`\r
\r
`,ze,`\r
`)}),rt.push("--"+je+"--"),new Blob(rt,{type:"multipart/form-data; boundary="+je})},Br.prototype[Symbol.iterator]=function(){return this.entries()},Br.prototype.toString=function(){return"[object FormData]"},Tn&&!Tn.matches&&(Tn.matches=Tn.matchesSelector||Tn.mozMatchesSelector||Tn.msMatchesSelector||Tn.oMatchesSelector||Tn.webkitMatchesSelector||function(je){for(var rt=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--rt&&je.item(rt)!==this;);return-1<rt}),cr&&(Br.prototype[cr]="FormData"),lt){var Xo=Pe.XMLHttpRequest.prototype.setRequestHeader;Pe.XMLHttpRequest.prototype.setRequestHeader=function(je,rt){Xo.call(this,je,rt),je.toLowerCase()==="content-type"&&(this.B=!0)},Pe.XMLHttpRequest.prototype.send=function(je){je instanceof Br?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),lt.call(this,je)):lt.call(this,je)}}ht&&(Pe.fetch=function(je,rt){return rt&&rt.body&&rt.body instanceof Br&&(rt.body=rt.body._blob()),ht.call(this,je,rt)}),Sn&&(Pe.navigator.sendBeacon=function(je,rt){return rt instanceof Br&&(rt=rt._asNative()),Sn.call(this,je,rt)}),Pe.FormData=Br}})();const wb=()=>{const e=re("AREAS");return e.length===0&&e.push(Vn.GLOBAL),za(e).call(e,(r,i,o)=>{const c=oH(i);return c?o===0?c:"".concat(r,",").concat(c):r},"")},oH=e=>e===Vn.OVERSEA?"".concat(Is.ASIA,",").concat(Is.EUROPE,",").concat(Is.AFRICA,",").concat(Is.NORTH_AMERICA,",").concat(Is.SOUTH_AMERICA,",").concat(Is.OCEANIA):Is[e],qpe=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=nP[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},dP={GLOBAL:{ASIA:[Vn.CHINA,Vn.JAPAN,Vn.INDIA,Vn.KOREA,Vn.HKMC],EUROPE:[],NORTH_AMERICA:[Vn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},hP=Object.keys(dP[Vn.GLOBAL]),Vx=[Vn.CHINA,Vn.NORTH_AMERICA,Vn.EUROPE,Vn.ASIA,Vn.JAPAN,Vn.INDIA,Vn.OCEANIA,Vn.SOUTH_AMERICA,Vn.AFRICA,Vn.KOREA,Vn.HKMC,Vn.US],Ype=function(e,r){let i=[];if(st(e).call(e,Vn.GLOBAL)){const u=[Vn.GLOBAL,Vn.OVERSEA],h=Object.keys(nP);if(r===Vn.GLOBAL)throw new Re(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Vn.CHINA)i=[Vn.OVERSEA];else if(c=r,st(hP).call(hP,c)){const m=(o=r,dP[Vn.GLOBAL][o]||[]),_=[...u,r,...m];i=h.filter(y=>!st(_).call(_,y))}else if(function(m){let _=!1;return hP.forEach(y=>{var S;st(S=dP[Vn.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(r)){const m=function(y){let S;return hP.forEach(R=>{var P;st(P=dP[Vn.GLOBAL][R]).call(P,y)&&(S=R)}),S}(r),_=[...u,m,r];i=h.filter(y=>!st(_).call(_,y))}else i=e;i=function(m){const _=[];return Vx.forEach(y=>{st(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!st(Vx).call(Vx,y)))}(i)}else i=e;var o,c;return i};function aH(e){var r,i;if(!e&&st(r=re("AREAS")).call(r,Vn.EXTENSIONS))return D.debug("update area from ap : reset"),void Fx(ipe,!0);if(!st(i=re("AREAS")).call(i,Vn.GLOBAL)||!e)return;let o=nP.EXTENSIONS;o&&(o={CODE:oH(Vn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),o),Jn("AREAS",[Vn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Jn(c,o[c][0]):Jn(c,o[c])}))}function Fx(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=wt.reportApiInvoke(null,{name:gi.SET_AREA,options:e,tag:Lr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!st(IG).call(IG,u))throw new Re(X.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Re(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Ype(m,h):m}if(!r){if(dd.AREAS){const u=new Re(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void D.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,Vn.GLOBAL)&&re("AREAS")===Vn.EXTENSIONS){const u=new Re(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void D.warning("setArea is prohibited because of ap extensions")}}Jn("AREAS",o,r);const c=qpe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Jn(u,c[u][0]):Jn(u,c[u])}),D.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function cH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _h(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let jx=1;function Xpe(e,r,i,o,c){jx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:jx,requestId:jx,version:ml,cname:i.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,y=e[0];return ud(async()=>{m=Date.now();const S=await md(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Re(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw D.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Re(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw D.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Re(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw D.error(k.toString()),k}const P=function(k,z){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(z))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),_h(_h({},P),{},{responseTime:_})},(S,R)=>(wt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:e[R%e.length]}),!1),(S,R)=>(wt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:e[R%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(R+1)%e.length],!0)),c)}let Bx=1;function lH(e,r,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,_=Date.now();let y;const S=r.role,[R,P]=zx(r,u,[oi.CHOOSE_SERVER]);let k=si.networkState;return ud(async()=>{k&&si.networkState===Xa.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,ns(o&&o.maxRetryTimeout||_i.maxRetryTimeout)]),k=si.networkState;const{data:z,headers:U}=await md(c,{data:R,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,wt.reportResourceTiming(c,m),dH(z,c,r,_,[oi.CHOOSE_SERVER],y);const V=vb(z,oi.CHOOSE_SERVER);return Wx(V),kx(V,c)},z=>(z&&wt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:z.gatewayAddrs.map(U=>U.address),ec:null,cid:z.cid.toString(),uid:z.uid.toString(),csIp:z.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:z.res.detail&&z.res.detail[38]}),!1),z=>z.code!==X.OPERATION_ABORTED&&(z.code===X.CAN_NOT_GET_GATEWAY_SERVER?z.data.retry:(wt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:z.code,csIp:z.data&&z.data.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:r.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),z),!0)),o)}function uH(e,r,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=r.role,[S,R]=zx(r,h,m);let P;return ud(async()=>{P&&si.networkState===Xa.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,ns(o&&o.maxRetryTimeout||_i.maxRetryTimeout)]),P=si.networkState;const{data:k,headers:z}=await md(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=z.http3==="1"?1:-1,wt.reportResourceTiming(u,r.sid),dH(k,u,r,_,m,c);const U=vb(k,oi.CHOOSE_SERVER),V=vb(k,r.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK);return Wx(U),{gatewayInfo:kx(U,u),proxyInfo:V,url:u}},k=>(k.gatewayInfo&&wt.joinChooseServer(r.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(z=>z.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&wt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(z=>z.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(wt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),D.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const dH=(e,r,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=R=>{R.flag===4096?wt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||wt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Re(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};y.push(k),S(k)}if(P!==0){const k=zv(P),z={error:new Re(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?D.warning(z.error.toString()):y.push(z),S(z)}}),y.length)throw D.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Re(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!y.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},Wx=e=>{var r,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Re(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?aH(e.detail[23].toLowerCase()):aH()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=Zs(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},Jpe=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=zv(i.buffer.code);throw new Re(X.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",r),new Re(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},zx=(e,r,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:_h(_h(_h({6:e.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Qpe=(e,r)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let Kv=0;function qv(e){return ct.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const Rb=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let _,y=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return i.slice(P,k).map(o)})();u&&u.push(...R);try{_=await qv(R)}catch(P){if(y+=m,h++,!(y>=i.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},hH=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=i(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function Gx(e,r,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:wb()})),z=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await Rb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),lH(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},P=async()=>{if(await ns(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:wb()})),z=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await Rb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),lH(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};try{return y=await qv([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,r,i,o)}}async function fH(e,r,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await Gx(e,r,i,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await gH(e,r,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const z=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||ys.tcpport,udpport:U.udpport||ys.udpport,username:U.username||ys.username,password:U.password||ys.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:P.uid,V="glb:".concat(U.toString()),q=await UL(V),Y=k.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||ys.tcpport,udpport:le.udpport||ys.udpport,username:V,password:q,forceturn:!1,security:!0}));z.push(...Y)}return e.turnServer={mode:"manual",servers:z},{gatewayInfo:P}}return await Gx(e,r,i,c)}const{proxyInfo:m,gatewayInfo:_}=await gH(e,r,i,c),y={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:ys.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:ys.udpport,username:P.username||ys.username,password:P.password||ys.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),z=await UL(k),U=m.map(V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||ys.tcpport,udpport:u==="proxy4"?void 0:V.udpport||ys.udpport,username:k,password:z,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function pH(e,r,i,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,R,P,k){const z=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let V=y[0];const q=await ud(()=>md(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,le)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Re(X.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(U.sid,{lts:z,success:!0,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const ge=zv(Y.code);return ge.retry&&(V=y[(le+1)%y.length]),wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:ge.desc,extend:U}),ge.retry},(Y,le)=>Y.code!==X.OPERATION_ABORTED&&(wt.reqUserAccount(U.sid,{lts:z,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),V=y[(le+1)%y.length],!0),k);if(q.code!==0){const Y=zv(q.code);throw new Re(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,r,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Zpe(e,r,i){const o=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await hH({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const R=Date.now(),P={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await md(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const z=zv(k.code);throw new Re(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(z.desc),z)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Re(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,e,r,i),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function eme(e,r,i){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,R,P){const k=Cn(),z={flag:64,cipher_method:0,features:_h(_h(_h(_h(_h({install_id:qL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:ml,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Hpe.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return ud(()=>md(y,{data:z,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,e,r,i));let u=null,h=null,m={};try{u=await qv(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),wt.reportApiInvoke(e.sid,{name:gi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),R={};return S.forEach(P=>{var k;const z=Zs(k=P.slice(4)).call(k),U=JSON.parse(y[P]),V=U[1];R[z]={tag:U[0]||"",value:V}}),R}(u)}catch{}return m}async function mH(e,r){const i=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:wb(),serviceIds:[oi.CHOOSE_SERVER,oi.CLOUD_PROXY_FALLBACK]}));try{return await hH({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,z]=zx(h,S,R);let U=si.networkState;try{U&&si.networkState===Xa.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,ns(_i.maxRetryTimeout)]),U=si.networkState;const{data:V,headers:q}=await md(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(Ee=>{const pe=[];if(Ee.response_body.forEach(Pe=>{const Ke=Pe.buffer.code;if(Pe.uri===23&&Ke===0&&!Pe.buffer.edges_services)if(Pe.buffer.flag===4194310)Pe.buffer.edges_services=[];else{const lt={error:new Re(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:Pe.buffer.flag};pe.push(lt)}if(Ke!==0){const lt=zv(Ke),ht={error:new Re(X.CAN_NOT_GET_GATEWAY_SERVER,lt.desc,{desc:lt.desc,retry:lt.retry,csIp:Ee.detail[502]}),flag:Pe.buffer.flag};Pe.buffer.flag===4194310?D.warning(ht.error.toString()):pe.push(ht)}}),pe.length)throw new Re(X.CAN_NOT_GET_GATEWAY_SERVER,pe.map(Pe=>"flag: ".concat(Pe.flag,", message: ").concat(Pe.error.message)).join(" | "),{retry:!!pe.find(Pe=>Pe.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(pe.map(Pe=>{var Ke;return Pe==null||(Ke=Pe.error)===null||Ke===void 0||(Ke=Ke.data)===null||Ke===void 0?void 0:Ke.desc}).filter(Pe=>!!Pe))]})})(V);const le=vb(V,oi.CHOOSE_SERVER),ge=vb(V,oi.CLOUD_PROXY_FALLBACK);return Wx(le),{gatewayInfo:kx(le,y),proxyInfo:ge,opid:z,requestTime:P,url:y,isHttp3:_,elapse:Date.now()-P}}catch(V){throw V}}(c,e,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function gH(e,r,i,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,z,U)=>{let V=U||c;return Array.isArray(V)&&(V=z%2==0?c[1]:c[0]),"https://".concat(V,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:wb(),serviceIds:[oi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await Rb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),uH(V,e,r,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U},y=async()=>{if(await ns(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:wb(),serviceIds:[oi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?oi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?oi.CLOUD_PROXY:oi.CLOUD_PROXY_FALLBACK]}}),z=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await Rb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),uH(V,e,r,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},z),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},z),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await qv([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Re(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,k)&&(e.proxyServer=k,D.setProxyServer(k),wt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await jG(R,S.uid)},h}async function tme(e,r,i){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:ml,cname:m.cname,uid:m.uid.toString(),requestId:Bx,seq:Bx};Bx+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return ud(async()=>{const P=await md(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const z=new Re(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw D.error(z.toString()),z}const k=JSON.parse(P.json_body);if(k.code!==200){const z=new Re(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw D.error(z.toString()),z}if(!k.servers||k.servers.length===0){const z=new Re(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(z.toString()),z}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(z=>"wss://".concat(z.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(z.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),y)}(u,e,r,i));try{const u=await qv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function nme(e,r,i){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await ns(1e3),o!==null)?o:await Rb({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,R,P){const[k]=Qpe(S,[oi.CHOOSE_SERVER]);let z=si.networkState;return ud(async()=>{z&&si.networkState===Xa.OFFLINE&&si.onlineWaiter&&await ct.race([si.onlineWaiter,ns(P&&P.maxRetryTimeout||_i.maxRetryTimeout)]),z=si.networkState;const U=await md(y,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Jpe(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(D.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,e,r,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await qv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function _H(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Hx(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?_H(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_H(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class rme extends Ar{get isSuccess(){return!!this.configs}constructor(r,i){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new Cs("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wt.reportApiInvoke(null,{options:void 0,name:gi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Lr.TRACER}).onSuccess(JSON.stringify(dd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await eme(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=$T(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,z=h[S-1],U=c[z].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const V=R;h[S]=h[S-1],h[S-1]=V}}else{const V=R;h[S]=h[S-1],h[S-1]=V}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Re(X.NETWORK_RESPONSE_ERROR,o);D.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){AG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(_b.UPDATE_BITRATE_LIMIT,r):this.emit(_b.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Hx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=r[u].value,S=r[u].tag;let R=0;_?_===r8.REALTIME&&(R=1):Object.keys(y).some(P=>Object.prototype.hasOwnProperty.call(QL,P)||!Sx()&&Object.prototype.hasOwnProperty.call(LA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&wt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){D.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Hx(Hx({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(r);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&AG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:R,expires:P}=m[y];P&&P<=_||((R===r8.REALTIME||Object.prototype.hasOwnProperty.call(QL,y))&&(dd[y]=S,fr[y]=S,D.debug("Update realtime parameters from config distribute",y,S)),R||Sx()||!Object.prototype.hasOwnProperty.call(LA,y)||(dd[y]=S,fr[y]=S,D.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){D.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(u))}catch(c){D.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(fr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(fr[o],c)||(dd[o]=c,fr[o]=c,this.emit(_b.UPDATE_CLIENT_ROLE_OPTIONS,c),D.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){D.error("Error handling global parameter config:",i.message)}}}class ime extends Ar{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",EH[r],r,i),!c.isPrevNormal&&h&&this.emit("exception",EH[r]+2e3,r+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof Ti&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=Ja(i._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof Ti&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const EH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ps=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function yH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function M_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?yH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Cb{constructor(r){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",DA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new ime,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ge.LocalAudioTrack)||M_({},rx)}getLocalVideoTrackStats(){return this.localStats.get(Ge.LocalVideoTrack)||M_({},ix)}getRemoteAudioTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(r){const i={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(i[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(r){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=i(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let r=0,i=0,o=0,c=0;const u=this.localStats.get(Ge.LocalAudioTrack);u&&(r+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get(Ge.LocalVideoTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get(Ge.LocalVideoLowTrack);m&&(r+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:R}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Ps.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ps.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case Ge.LocalVideoTrack:case Ge.LocalVideoLowTrack:{const h=c,m=M_({},ix),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ge.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case Ge.LocalAudioTrack:{const h=c,m=M_({},rx),_=r.getStats(),y=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ge.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,R=_,P=M_({},p8),k=M_({},m8),z=M_({},Wfe),{audioTrack:U,videoTrack:V,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let le;le=this.store.useP2P?r.getStats(!0):r.getStats();const ge=(o=le)===null||o===void 0?void 0:o.audioRecv.find(Ke=>Ke.ssrc===q),Ee=(c=le)===null||c===void 0?void 0:c.videoRecv.find(Ke=>Ke.ssrc===Y),pe=this.trafficStats&&this.trafficStats.peer_delay.find(Ke=>Ke.peer_uid===u);if(ge&&(ge.codec!=="opus"&&ge.codec!=="aac"&&ge.codec!=="PCMU"&&ge.codec!=="PCMA"&&ge.codec!=="G722"||(P.codecType=ge.codec),ge.outputLevel?P.receiveLevel=Math.round(32767*ge.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=ge.bytes,P.receivePackets=ge.packets,P.receivePacketsLost=ge.packetsLost,P.receivePacketsDiscarded=ge.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=y?8*Math.max(0,P.receiveBytes-y.receiveBytes):0,P.totalDuration=y?y.totalDuration+1:1,P.totalFreezeTime=y?y.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ge.jitterBufferMs,P.totalDuration>10&&Cb.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),Ee){var Pe;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(k.codecType=Ee.codec),k.receiveBytes=Ee.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,k.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(k.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(k.receiveFrameRate=Ee.receivedFrame.frameRate,k.receiveResolutionHeight=Ee.receivedFrame.height,k.receiveResolutionWidth=Ee.receivedFrame.width):V&&(k.receiveResolutionHeight=V._videoHeight||0,k.receiveResolutionWidth=V._videoWidth||0),Ee.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(Ee.framesRateFirefox)),k.receivePackets=Ee.packets,k.receivePacketsLost=Ee.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ke=S?S.totalFreezeTime:0,lt=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(Pe=Ee.totalFreezesDuration)!==null&&Pe!==void 0?Pe:Ke||0,k.receiveDelay=Ee.jitterBufferMs||0;const ht=!!Y&&r.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&V&&ht&&Cb.isRemoteVideoFreeze(V,Ee,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ke)/(k.totalDuration-lt),1))}pe&&(P.end2EndDelay=pe.B_ad,k.end2EndDelay=pe.B_vd,P.transportDelay=pe.B_ed,k.transportDelay=pe.B_ed,P.currentPacketLossRate=pe.B_ealr4/100,k.currentPacketLossRate=pe.B_evlr4/100,z.uplinkNetworkQuality=pe.B_punq?pe.B_punq:0,z.downlinkNetworkQuality=pe.B_pdnq?pe.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:Ee,networkStats:z}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),V&&this.exceptionMonitor.setRemoteVideoStats(V,k)})}}class vH{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){CG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){CG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){ZA(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function SH(e){if(!(e instanceof vH))return new Re(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new Re(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Re(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Pm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function TH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function bH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?TH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Ib="9",wH=4e4;function RH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Qf(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?RH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):RH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Yv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Yv||{});const fP=new Map;function CH(e,r,i,o){let{scale:c}=e;if(c===0&&o===Yv.UP||c>=r.length-1&&o===Yv.DOWN)return e;let u=Qf(Qf({},e),{},{scale:o===Yv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=Qf(Qf({},u),r[c].motion);break;case"maintain-resolution":u=Qf(Qf({},u),r[c].detail);break;case"balanced":u=Qf(Qf({},u),r[c].balanced)}return u}function IH(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:AH(r)};fP.set(e,i)}else fP.delete(e)}function AH(e){const r=Qf({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:z,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:ge,DETAIL_BITRATE_FACTOR:Ee}=XL,pe=Math.min(r.frameRate,m),Pe=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(k,1)*pe),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ke=1;Ke<=_;Ke++){const lt={bwe_up:Math.round(Math.pow(R,Ke)*i),bwe_down:Math.round(Math.pow(P,Ke+1)*i),fps_up:Math.round(Math.pow(z,Ke)*pe),fps_down:Math.round(Math.pow(k,Ke+1)*pe)},ht={scaleResolutionDownBy:c/Math.pow(q,Ke),frameRate:Math.max(Math.round(Math.pow(V,Ke)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,Ke)*i),S),bitrateMin:Math.max(Math.round(Math.pow(U,Ke)*u),y)},Sn={scaleResolutionDownBy:c/Math.pow(Y,Ke),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,Ke)*i),S),bitrateMin:Math.max(Math.round(Math.pow(le,Ke)*u),y)},Tn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ge,Ke)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ke)*i),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ke)*u),y)};Pe.push({scale:Ke,threshold:lt,balanced:ht,motion:Sn,detail:Tn})}return Pe}function sme(e,r,i,o,c,u){const h=fP.get(e)||{overUse:0,underUse:0,adaptationList:AH(c)},{adaptationList:m}=h;fP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=XL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(k,z,U,V){if(z>=U.length)return!1;let{threshold:{fps_down:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=db.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(k,z,U){if(z>=U.length)return!1;const{threshold:{bwe_down:V}}=U[z];return k<V}(i,S,m)&&(h.overUse++,P=db.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=CH(o,m,u,Yv.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(k,z,U,V){if(z===0)return;let{threshold:{fps_up:q}}=U[z];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,z,U){if(z===0)return;const{threshold:{bwe_up:V}}=U[z];return k>V}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,R=CH(o,m,u,Yv.UP),R.scale===0&&(P=db.NONE))),[R,P])}function PH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $x(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?PH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):PH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function ome(e){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof fx||st(r=e._hints).call(r,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Cn();if(o.os!==Li.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&RW(17,4)||wW(14)&&CW(17,4,!0)))}const pP=new Map;function mP(e,r){const i=pP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),pP.delete(e)}r.qualityLimitationReason=db.NONE,IH(e)}function ame(e,r){var i;let o;switch(r){case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoTrack:o=st(i=e._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return o}function Kx(e){const r=Nn();if(e.some(i=>i._bypassWebAudio))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function qx(e,r){Kx(e);const i=new Ti;return e.forEach(o=>i.addAudioTrack(o)),i}const cme=!Nn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Wf();function gP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return cme?(i={spec:r,store:e},Xf("PlanBConnection").create(i)):new Eh(r,e)}function Yx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function OH(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(cb(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var wn;function kH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gd(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?kH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Eh=(wn=class rE extends OG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(xA)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"id",or(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",db.NONE),$(this,"isFirstConnected",!1),this.store=i,this.forceTurn=OH(r),this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(rE.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=KL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const i=this.preSSRCMap.get(r);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Im(o.sdp),u=await XG({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=cP(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:DA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=ya(y.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&eH(o.sdp)&&(h=xr(u),(i=h).send&&(Gv(mt.VIDEO,i.send.videoExtensions),Gv(mt.AUDIO,i.send.audioExtensions)),i.recv&&(Gv(mt.VIDEO,i.recv.videoExtensions),Gv(mt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Gv(mt.VIDEO,i.sendrecv.videoExtensions),Gv(mt.AUDIO,i.sendrecv.audioExtensions))),gd(gd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Ne(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&eH(this.initialOffer.sdp)&&(i=r.rtpCapabilities,o=this.localCapabilities,i.send&&(sP(mt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),sP(mt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(sP(mt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),sP(mt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=xr(y);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:z,setup:U,localCapabilities:V,cname:q}=y;this._rtpCapabilities=z,this._candidates=k,this._originCandidates=xr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=V,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(z),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let z=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const V=2*U+2e4,q=2*U+wH,{ssrcs:Y,ssrcGroups:le}=x_([{ssrcId:V}],this.cname),{ssrcs:ge,ssrcGroups:Ee}=x_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Ib,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ge,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Ib,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++z)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Tm(this.sessionDesc)}send(y,S,R,P){const{ssrcs:k,ssrcGroups:z}=x_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Nr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const V=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const V=this.findAvailableMediaIndex(y,k);let q;return V===-1||V===1&&(gs()||function(){const Y=Cn();return!(Y.name!==Un.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&Bf())||V===0&&re("USE_SUB_RTX")||IW()?(q=this.createOrRecycleSendMedia(y,k,z,"sendonly",P),this.updateBundleMids()):(q=xr(this.sessionDesc.mediaDescriptions[V]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=z,this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(q,P)),Nr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:z,ssrcMsg:U,mslabel:V}=k;return this.send(z,U,V)}),R=[];let P=!1;return S.forEach(k=>{let{mid:z,needExchangeSDP:U}=k;U&&(P=!0),R.push(z)}),{mids:R,needExchangeSDP:P}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Nr()||IW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(y).call(y,R.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(y,S,R,P){y.forEach((k,z)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[z])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(R=>y.indexOf(R.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||ya((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=y;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const z of S.mediaDescriptions){if(z.attributes.iceUfrag=this._iceParameters.iceUfrag,z.attributes.icePwd=this._iceParameters.icePwd,z.attributes.fingerprints=this._dtlsParameters.fingerprints,z.attributes.candidates=this._candidates,z.attributes.setup=this.setup,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];z.media.fmts=U.map(V=>V.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.videoCodecs,z.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=x_([{ssrcId:wH,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=V}}if(z.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];z.media.fmts=U.map(V=>V.payloadType.toString(10)),z.attributes.payloads=U,z.attributes.extmaps=[]}else if(z.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),z.attributes.payloads=P.audioCodecs,z.attributes.extmaps=P.audioExtensions,$v(z),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=x_([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=U,z.attributes.ssrcGroups=V}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(bH(bH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(y){case As.TCP_RELAY:this._candidates=R;break;case As.UDP_TCP_RELAY:case As.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(y){y=xr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let R=0;R<y;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===y&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Nr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:Ib,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,R,P,k,z){const U=y._mediaStreamTrack.kind,V=this.rtpCapabilities.recv,q=Tb(U,V,this.localCapabilities.send,U===mt.VIDEO?P:k),Y=U===mt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let ge={media:{mediaType:U,port:Ib,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(pe=>pe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};ge=this.mungRecvMediaDsec(ge,y,z);const Ee=this.findFirstClosedMedia(U);if(Ee){const pe=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[pe]=ge}else this.sessionDesc.mediaDescriptions.push(ge);return ge}updateRemoteCodec(y,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ge=>ge.rtpMap&&ge.rtpMap.encodingName.toLowerCase()||"").filter(ge=>{var Ee;return st(Ee=Object.keys(xA)).call(Ee,ge)}))],k=new Set(S);if(P.every(ge=>k.has(ge)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const z=this._rtpCapabilities.recv.videoCodecs.filter(ge=>S.some(Ee=>{var pe;return st(pe=ge.rtpMap&&ge.rtpMap.encodingName.toLowerCase()||"").call(pe,Ee)}));if(z.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(z.map(ge=>ge.rtpMap&&ge.rtpMap.encodingName.toLowerCase()||""))];let V;if(D.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),y.length===0)V=this.sessionDesc.mediaDescriptions.filter(ge=>ge.media.mediaType==="video"&&ge.attributes.direction==="recvonly");else if(V=this.sessionDesc.mediaDescriptions.filter(ge=>ge.attributes.mid&&st(y).call(y,ge.attributes.mid)&&ge.attributes.direction==="recvonly"),V.length!==y.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const ge=xx(z,this.rtpCapabilities.recv.videoCodecs);z.push(...ge)}this._rtpCapabilities.recv.videoCodecs=z;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,le=Tb(mt.VIDEO,Y,q,R);return V.forEach(ge=>{const Ee=le.map(pe=>pe.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(ge.attributes.mid,", from"),ge.attributes.payloads,"to",le),ge.attributes.payloads=le,ge.media.fmts=Ee}),!0}createOrRecycleSendMedia(y,S,R,P,k){const z=this.rtpCapabilities.send,U=y===mt.VIDEO?z.videoCodecs:z.audioCodecs,V=y===mt.VIDEO?z.videoExtensions:z.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:Ib,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const le=this.findFirstClosedMedia(y);if(le){const ge=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[ge]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,R){const P=xr(y);return Dx(P),Hv(P,S),Lx(P,S),qG(P),aP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(y,S){const R=xr(y);return aP(R,S,this.localCapabilities.recv),$v(R),R}updateRecvMedia(y,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===y);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Nr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(gd(gd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=QG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await bb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await bb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return pl(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=iP();r.forEach(V=>{const q=c.peerConnection.addTransceiver(V._mediaStreamTrack,gd({direction:"sendonly"},V.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),V._updateRtpTransceiver(q)}),Nr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,r)));const _=yield Rn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,y),R=ya(S),P=y.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return HG(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(V){k=[],c.remoteSDP.receive(r,i,o,k);const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(y,!0)),V}c.remoteSDP.receive(r,i,o,k);const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.applySimulcastEncodings(h,r)),yield Rn(c.applySendEncodings(h,r)),U==null||U(z),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:z})),h.map((V,q)=>{const Y=y[q];return{localSSRC:P[q],id:Y,transceiver:V}})}catch(h){throw h instanceof Ne?h:new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Ne?o:new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof Ne?i:new Ne(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;mP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);h&&(await bb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await bb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return pl(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Nn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||i.forceTurn;if(r===As.RELAY&&!c)return;if(c&&!u){const R=r===As.RELAY?"relay":"all",P=i.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,i.peerConnection.setConfiguration(P))}i.remoteSDP.updateCandidates(r);const h=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Im(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield Rn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(As.TCP_RELAY),await bb(this.peerConnection,this.remoteSDP,this.extension)}catch(i){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{mP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return gd(gd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ne(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:gd(gd({},hh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:gd(gd({},hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(cb(r.turnServer.servers)?i.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&i.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...rE.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...rE.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...rE.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...rE.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Nn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Rm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(V=>V.track===r._mediaStreamTrack)),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,V){return U.getTransceivers().find(q=>q.sender.track===V||q.receiver.track===V)}(this.peerConnection,r._mediaStreamTrack),_=Kfe(r);if(ome(r)&&m&&i&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const U=u.degradationPreference||(st(y=r._hints).call(y,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,q,Y,le,ge,Ee){if(mP(V,Y),ge(q),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let pe=-1;IH(V,q);const Pe=window.setInterval(()=>{const lt=pP.get(V);if(!re("ENABLE_AG_ADAPTATION")||!lt)return mP(V,Y),void ge(q);const ht=Ee();if(ht.sendPackets>0&&ht.OutgoingAvailableBandwidth>0){if(pe===-1)return void(pe=Date.now());if(Date.now()-pe<1e3)return;const Sn=ht.sendFrameRate,Tn=ht.OutgoingAvailableBandwidth,[cr,Qr]=sme(V,Sn,Tn,lt.adaptationConfig,q,le);Qr&&(Y.qualityLimitationReason=Qr),cr&&lt.adaptationConfig.scale!==cr.scale&&(D.debug("[".concat(V,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(Sn,", bwe ").concat(Tn,", switch from ").concat(lt.adaptationConfig.scale," to ").concat(cr.scale," ")),lt.adaptationConfig=$x($x({},lt.adaptationConfig),cr),ge(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),Ke=$x({},q);pP.set(V,{timer:Pe,adaptationConfig:Ke,originConfig:q,adaptationFunc:ge}),D.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(le))})(this.id+m.mid,_,this,U,V=>{i&&this.updateAdaptation(i,V)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(st(S=r._hints).call(S,ar.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=Ja(V)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Wf()){var P;const U=re("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=i.getParameters(),z=(c=k.encodings)===null||c===void 0?void 0:c[0];Nr()&&!z&&(u.encodings=[h]),z&&Object.assign(z,h),Object.assign(k,u),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await i.setParameters(k),await async function(U,V,q){try{var Y;if(!Nn().supportSetRtpSenderParameters||!function(Pe){return Pe==="vp9"||Pe==="av1"}(U)||!re("ENABLE_SVC"))return;const le={},ge={},Ee=V.getParameters(),pe=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];ge.scalabilityMode=iP(q),pe&&Object.assign(pe,ge),Object.assign(Ee,le),await V.setParameters(Ee),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(le){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,i,re("SVC_MODE"))}async updateAdaptation(r,i){var o,c;if(!r)return D.debug("[updateAdaptation] no rtpSender found");if(!Nn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=Ja(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=r.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await r.setParameters(y),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!Nn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof pr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ya(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Hv(_,u),YG(_,u,this.store.codec))}),Tm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof pr&&!st(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Nr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof pr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof pr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(Nn().supportPCSetConfiguration){const i=rE.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},yt(wn.prototype,"updateRemoteRTPCapabilities",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),yt(wn.prototype,"connect",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),yt(wn.prototype,"updateRemoteConnect",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteConnect"),wn.prototype),yt(wn.prototype,"createDataChannels",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"createDataChannels"),wn.prototype),yt(wn.prototype,"receive",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"receive"),wn.prototype),yt(wn.prototype,"batchReceive",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"batchReceive"),wn.prototype),yt(wn.prototype,"stopReceiving",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"stopReceiving"),wn.prototype),yt(wn.prototype,"muteRemote",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),yt(wn.prototype,"unmuteRemote",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),yt(wn.prototype,"muteLocal",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"muteLocal"),wn.prototype),yt(wn.prototype,"unmuteLocal",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteLocal"),wn.prototype),yt(wn.prototype,"close",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),yt(wn.prototype,"updateEncoderConfig",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"updateEncoderConfig"),wn.prototype),yt(wn.prototype,"updateSendParameters",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"updateSendParameters"),wn.prototype),yt(wn.prototype,"replaceTrack",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),yt(wn.prototype,"updateAdaptation",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"updateAdaptation"),wn.prototype),yt(wn.prototype,"getRemoteSSRC",[$o],Object.getOwnPropertyDescriptor(wn.prototype,"getRemoteSSRC"),wn.prototype),wn);function $o(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function Xx(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=Ja(r.width),o.height=Ja(r.height);const c=Ja(r.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Re(X.UNEXPECTED_ERROR,"can not get canvas context");const m=Nn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,R=i.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(D.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=ax(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),D.debug("clean low stream renderer")},_}var _P=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(_P||{}),ai=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ai||{}),U_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(U_||{}),ci=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(ci||{}),V_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(V_||{}),NH=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(NH||{}),yh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(yh||{}),Ko=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Ko||{}),DH=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(DH||{}),qo=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(qo||{}),EP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(EP||{});const F_=1e3,j_=6,yP=3,lme=Math.max(j_,yP);function Ft(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function LH(e){const r={[qo.CONN_TYPE]:0,[qo.RTT]:e.rtt,[qo.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[qo.CONN_TYPE]=1),i==="tcp"&&(r[qo.CONN_TYPE]=3),i==="tls"&&(r[qo.CONN_TYPE]=4);break}case"srflx":r[qo.CONN_TYPE]=2;break;case"unknown":r[qo.CONN_TYPE]=5;break;default:r[qo.CONN_TYPE]=0}return r}function xH(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class MH extends Ar{constructor(r){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%yP==0,o=r%j_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[EP.RTC_PEER_CONNECTION_STATE]=$L[_]):m.misc=[{addition:{[EP.RTC_PEER_CONNECTION_STATE]:$L[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[EP.RTC_PEER_CONNECTION_STATE]:$L[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===lme+1&&(r=1)},F_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[qo.RTT]:r.rtt,[qo.CONN_TYPE]:void 0,[qo.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=LH(r);if(this.store.useP2P){if(i){const u=LH(i);c[qo.CONN_TYPE]+=u[qo.CONN_TYPE]<<3}c[qo.CONN_TYPE]+=110}else c[qo.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:R,ssrcs:P}]=y;switch(S){case Ge.LocalVideoLowTrack:case Ge.LocalVideoTrack:if(S===Ge.LocalVideoTrack){const k=function(V,q,Y,le,ge,Ee){const pe=q.videoSend.find(ht=>ht.ssrc===V);if(!pe)return;const Pe={},{sentFrame:Ke,inputFrame:lt}=pe;if(Ee&&(Ft(Pe,ai.QP_SUM,pe.qpSumPerFrame),lt&&Ke)){const ht=lt.frameRate,Sn=Ke.frameRate;Pe[ai.FREEZE]=function(Tn,cr){let Qr=!0;return Qr=!(Tn<=5)&&(Tn<=10?cr<3:Tn<=20?cr<4:cr<5),Qr}(ht,Sn)?1:0}if(ge){switch(Ke&&(Ft(Pe,ai.HEIGHT,Ke.height),Ft(Pe,ai.WIDTH,Ke.width),Ft(Pe,ai.FRAME_RATE,Ke.frameRate)),Pe[ai.DISABLED]=le._originMediaStreamTrack&&!le._originMediaStreamTrack.enabled||le._mediaStreamTrack&&!le._mediaStreamTrack.enabled?1:0,pe.adaptionChangeReason){case"none":Pe[ai.ADAPTATION]=0;break;case"cpu":Pe[ai.ADAPTATION]=1;break;case"bandwidth":Pe[ai.ADAPTATION]=2;break;case"other":Pe[ai.ADAPTATION]=3}let ht=0;pe.adaptionChangeReason&&(ht+=xH(pe.adaptionChangeReason)),q.qualityLimitationReason&&(ht+=xH(q.qualityLimitationReason)<<3),Pe[ai.ADAPTATION]=ht,Pe[ai.PLAYER_STATUS]=sx[le._player?le._player.videoElementStatus:"uninit"],Ft(Pe,ai.NACKS,pe.nacksCount),Ft(Pe,ai.PLIS,pe.plisCount),Ft(Pe,ai.FIRS,pe.firsCount),Ft(Pe,ai.AVG_ENCODE,pe.avgEncodeMs),Ft(Pe,ai.HUGE_FRAME_SENT,pe.hugeFramesSent),Ft(Pe,ai.BYTES_RETRANSMIT,pe.retransmittedBytesSent),Ft(Pe,ai.PACKAGES_RETRANSMIT,pe.retransmittedPacketsSent),Ft(Pe,ai.KEY_FRAMES_ENCODED,pe.keyFramesEncoded);const Sn=Y&&Y.videoSend.find(Tn=>Tn.ssrc===V);if(Sn){let Tn=ge?F_:F_*j_;Sn.timestamp&&pe.timestamp&&(Tn=pe.timestamp-Sn.timestamp),Sn.packets!=null&&pe.packets!=null&&Ft(Pe,ai.PACKAGE_RATE,1e3*(pe.packets-Sn.packets)/Tn),pe.packetsLost!=null&&Sn.packetsLost!=null&&Ft(Pe,ai.PACKAGE_LOST,pe.packetsLost-Sn.packetsLost),Sn.bytes!=null&&pe.bytes!=null&&Ft(Pe,ai.BITRATE,8*(pe.bytes-Sn.bytes)/Tn)}}return Pe}(P[0].ssrcId,r,i,R,o,c),z=R&&function(V,q,Y,le){const ge=q.videoSend.find(pe=>pe.ssrc===V);if(!ge)return null;const Ee={};if(le){const pe=ge.inputFrame,Pe=pe&&pe.height||Y.videoHeight||0,Ke=pe&&pe.width||Y.videoWidth||0,lt=pe&&pe.frameRate||0;Ft(Ee,_P.HEIGHT,Pe),Ft(Ee,_P.WIDTH,Ke),Ft(Ee,_P.FRAME_RATE,lt)}return Ee}(P[0].ssrcId,r,R,o),U=function(V,q){const Y={};return q&&(Ft(Y,ai.RETRANSMIT,V.bitrate.retransmit),Ft(Y,ai.TARGET_ENCODED,V.bitrate.targetEncoded),Ft(Y,ai.ACTUAL_ENCODED,V.bitrate.actualEncoded),Ft(Y,ai.TRANSMIT,V.bitrate.transmit),Ft(Y,ai.BANDWIDTH,V.sendBandwidth)),Y}(r,o);m=Object.assign({},k,z,U)}else _=function(k,z,U,V){const q=z.videoSend.find(le=>le.ssrc===k);if(!q)return;const Y={};if(V){const le=q.sentFrame;if(le&&(Ft(Y,U_.HEIGHT,le.height),Ft(Y,U_.WIDTH,le.width),Ft(Y,U_.FRAME_RATE,le.frameRate)),U){const ge=U.videoSend.find(Ee=>Ee.ssrc===k);if(ge){let Ee=F_*j_;ge.timestamp&&q.timestamp&&(Ee=q.timestamp-ge.timestamp),ge.packets!=null&&q.packets!=null&&Ft(Y,U_.PACKAGE_RATE,1e3*(q.packets-ge.packets)/Ee),q.packetsLost!=null&&ge.packetsLost!=null&&Ft(Y,U_.PACKAGE_LOST,q.packetsLost-ge.packetsLost),ge.bytes!=null&&q.bytes!=null&&Ft(Y,U_.BITRATE,8*(q.bytes-ge.bytes)/Ee)}}}return Y}(P[0].ssrcId,r,i,o);break;case Ge.LocalAudioTrack:h=R&&function(k,z,U,V,q){const Y=z.audioSend.find(ge=>ge.ssrc===k);if(!Y)return;const le={};if(q){le[yh.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const ge=100*V._source.getAccurateVolumeLevel(),Ee=Y.inputLevel;if(Ee!=null){const Pe=Math.ceil(50*Math.log10(100*Ee+1));Ft(le,yh.LEVEL,Pe)}Ft(le,NH.PCM_LEVEL,ge),Ft(le,yh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(le,yh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(le,yh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(le,yh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),le[yh.FREEZE]=0;const pe=U&&U.audioSend.find(Pe=>Pe.ssrc===k);if(pe){let Pe=F_*j_;pe.timestamp&&Y.timestamp&&(Pe=Y.timestamp-pe.timestamp),pe.bytes!=null&&Y.bytes!=null&&Ft(le,yh.BITRATE,8*(Y.bytes-pe.bytes)/Pe),pe.packets!=null&&Y.packets!=null&&Ft(le,yh.PACKAGE_RATE,1e3*(Y.packets-pe.packets)/Pe)}}return le}(P[0].ssrcId,r,i,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(mt.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,z,U,V,q,Y,le,ge){const Ee=z.videoRecv.find(Tn=>Tn.ssrc===k);if(!Ee)return;const pe={},{receivedFrame:Pe,outputFrame:Ke,decodeFrameRate:lt}=Ee,ht=U&&U.videoRecv.find(Tn=>Tn.ssrc===k);if(Ft(pe,V_.FRAME_RATE_DECODE,lt),Ee.framesRateFirefox&&Ft(pe,ci.FRAME_RATE,Ee.framesRateFirefox),Pe&&Ft(pe,ci.FRAME_RATE,Pe.frameRate),Ft(pe,ci.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(pe,ci.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(pe,ci.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(pe,ci.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(pe,ci.AVG_DECODE,Ee.avgDecodeMs),Ft(pe,ci.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(pe,ci.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(pe,ci.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(pe,ci.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),ht){const Tn=z.timestamp-U.timestamp||F_*(ge?j_:le?yP:1);Ee.packetsLost!=null&&ht.packetsLost!=null&&Ft(pe,ci.PACKAGE_LOST,Ee.packetsLost-ht.packetsLost),ht.bytes!=null&&Ee.bytes!=null&&Ft(pe,ci.BITRATE,8*(Ee.bytes-ht.bytes)/Tn),ht.packets!=null&&Ee.packets!=null&&Ft(pe,ci.PACKAGE_RATE,1e3*(Ee.packets-ht.packets)/Tn)}if(ge&&(Ft(pe,ci.QP_SUM,Ee.qpSumPerFrame),pe[ci.FREEZE]=q&&Cb.isRemoteVideoFreeze(V,Ee,ht)?1:0),le){var Sn;Pe?(Ft(pe,ci.HEIGHT,Pe.height),Ft(pe,ci.WIDTH,Pe.width)):V&&(Ft(pe,ci.HEIGHT,V._videoHeight||0),Ft(pe,ci.WIDTH,V._videoWidth||0)),Ke&&Ft(pe,V_.FRAME_RATE_OUTPUT,Ke.frameRate);const Tn=(Sn=V._player)===null||Sn===void 0?void 0:Sn.rendFrameRate.toFixed(0);if(Tn&&Ft(pe,V_.FRAME_RATE_RENDER,+Tn),Ft(pe,ci.JITTER_BUFFER,Ee.jitterBufferMs),Ft(pe,ci.CURRENT_DELAY,Ee.currentDelayMs),Ft(pe,ci.FIRS,Ee.firsCount),Ft(pe,ci.NACKS,Ee.nacksCount),Ft(pe,ci.PLIS,Ee.plisCount),V){pe[ci.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1;const cr=V._player;if(cr){const{freezeTimeCounterList:Qr,renderFreezeAccTime:Br,videoElementStatus:Xo}=cr;if(Qr&&Qr.length>0&&Ft(pe,V_.FREEZE_TIME,Qr.splice(0,1)[0]),Y&&Hf.visibility==="visible"&&Xo===eo.PLAYING&&Nn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Br);cr.renderFreezeAccTime=Math.max(0,Br-je),Ft(pe,V_.FREEZE_TIME_RENDER,je)}if(typeof Ee.totalFreezesDuration=="number"){const je=ht&&ht.totalFreezesDuration?Ee.totalFreezesDuration-ht.totalFreezesDuration:Ee.totalFreezesDuration;Ft(pe,V_.FREEZE_DURATION,1e3*je)}}}if(pe[ci.PLAYER_STATUS]=sx[V._player?V._player.videoElementStatus:"uninit"],ht&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&ht.totalInterFrameDelay!==void 0&&ht.totalSquaredInterFrameDelay!==void 0){const cr=Ee.totalInterFrameDelay-ht.totalInterFrameDelay,Qr=Ee.totalSquaredInterFrameDelay-ht.totalSquaredInterFrameDelay,Br=Ee.framesDecodeCount-ht.framesDecodeCount,Xo=cr/Br*1e3,je=Math.round(1e3*Math.sqrt((Qr-Math.pow(cr,2)/Br)/Br));!isNaN(je)&&Xo+je>Math.max(3*Xo,Xo+150)&&(pe[ci.I_FRAME_DELAY]=je)}}return pe}(_._videoSSRC,r,i,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(y.has(mt.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,z,U,V,q){const Y=k.audioRecv.find(pe=>pe.ssrc===P);if(!Y)return;const le={},ge=z&&z.audioRecv.find(pe=>pe.ssrc===P);if(Ft(le,Ko.JITTER,Y.jitterMs),Ft(le,Ko.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(le,Ko.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(le,Ko.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(le,Ko.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),ge){const pe=k.timestamp-z.timestamp||F_*(q?j_:V?yP:1);Y.packets!=null&&ge.packets!=null&&Ft(le,Ko.PACKAGE_RATE,1e3*(Y.packets-ge.packets)/pe),V&&ge.bytes!=null&&Y.bytes!=null&&Ft(le,Ko.BITRATE,8*(Y.bytes-ge.bytes)/pe),Y.packetsLost!=null&&ge.packetsLost!=null&&Ft(le,Ko.PACKAGE_LOST,Y.packetsLost-ge.packetsLost)}if(q){const{receivedFrames:pe,droppedFrames:Pe}=Y;pe!=null&&Pe!=null&&(le[Ko.FREEZE]=(Ee=pe)===0||100*Pe/Ee>20?1:0)}var Ee;if(V){const pe=100*U._source.getAccurateVolumeLevel(),Pe=Y.outputLevel;if(Pe!=null){const Ke=Math.ceil(50*Math.log10(100*Pe+1));Ft(le,DH.LEVEL,Ke)}if(Ft(le,Ko.PCM_LEVEL,pe),U&&(le[Ko.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(le,Ko.JITTER_BUFFER,Y.jitterBufferMs),Ft(le,Ko.CURRENT_DELAY,Y.jitterBufferMs),le[Ko.PLAYER_STATUS]=sx[Ho.getPlayerState(U.getTrackId())],ge){const Ke=Y.concealedSamples-ge.concealedSamples;Ke>0&&Ft(le,Ko.CONCEALED_SAMPLES,Ke);const lt=Y.totalSamplesReceived-ge.totalSamplesReceived;lt>0&&Ft(le,Ko.TOTAL_SAMPLES_RECEIVED,lt)}}return le}(_._audioSSRC,r,i,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof WA);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(gb.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(mt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(mt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(mt.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(mt.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const R={};for(const{id:U,value:V,level:q,direction:Y}of y){var P;const le=(P=S.get(U))!==null&&P!==void 0?P:0,ge=V===2?le+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var k,z;S.set(U,ge),R[U]?(V===2&&(R[U].value=V),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:V,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(z=S.get(U))!==null&&z!==void 0?z:0}}return Object.keys(R).map(U=>{const{level:V,value:q,totalTs:Y}=R[U];return{id:U,level:V,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(gb.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const ume=re("ICE_RESTART_INTERVAL");let vP=new Map,Xv=new Map,Om=[As.UDP_TCP_RELAY,As.TCP_RELAY,As.RELAY],Jx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nn().supportPCSetConfiguration;function UH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=vP.get(e.id);i&&(window.clearTimeout(i),vP.delete(e.id));const o=Xv.get(e.id);r&&o&&o.index===Om.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),Xv.delete(e.id))}function VH(e,r,i){if(vP.size===0&&Xv.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Om,re("RESTART_SEQUENCE"))&&(Om=re("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(As)).call(_,m))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(Om.join(" => ")))),Jx=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Nn().supportPCSetConfiguration),Om.length===0)return void i();let o,{index:c=0,type:u}=Xv.get(e.id)||{};if(Jx&&u===As.RELAY)return void i();let h=u&&c>=Om.length-1;if(Jx)u=As.RELAY;else{if(h)return void i();u?(c++,u=Om[c]):(u=Om[0],c=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),Xv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>VH(e,r,i),ume),vP.set(e.id,o)}var un;function FH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function vh(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?FH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function jH(e){var r,i,o,c=2;for(typeof Symbol<"u"&&(i=SL,o=Symbol.iterator);c--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new SP(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function SP(e){function r(i){if(Object(i)!==i)return ct.reject(new TypeError(i+" is not an object."));var o=i.done;return ct.resolve(i.value).then(function(c){return{value:c,done:o}})}return SP=function(i){this.s=i,this.n=i.next},SP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?ct.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?ct.reject(i):r(o.apply(this.s,arguments))}},new SP(e)}let Ab=(un=class extends Ar{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",zn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?Yf.FIRST_CONNECTION:Yf.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==zn.Connected)return void c(new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await sr(this,kt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==zn.Connected)return void c(new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=Xx(i,lb(this,kt.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new ct((S,R)=>{this.handleReplaceTrack(y.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await sr(this,kt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ge.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==zn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ge.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==zn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==zn.Connected)return void o();const h=qx([i]);let m;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.connection||!y||this.state!==zn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===Ge.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ge.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ct((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new MH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Cs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Nn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Wf(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&Nn().supportPCSetConfiguration&&DL(),this.shouldForwardP2PCreation&&(this.connection=gP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=zn.New,this._forceTurn=OH(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=gP(this.store,e),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ne(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?Yf.FIRST_CONNECTION:Yf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ne(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===zn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=zn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[Ge.LocalVideoLowTrack,Ge.LocalVideoTrack]).call(u,h)}),i=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Eh){if(wt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!st(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(e).call(e,u));c&&(this.store.codec=c,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof Eh&&this.connection.peerConnectionState!=="closed"&&st(e=[zn.New,zn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==zn.Connected){if(this.state===zn.Disconnected)throw new Ne(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;st(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return pl(function*(){const c=yield Rn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==zn.Connected||h){if(o.state===zn.Disconnected)throw new Ne(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ps.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,i);if(m.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));yield*mA(jH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var i=this;return pl(function*(){r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();i.store.publish(k.getTrackId(),z===Ge.LocalAudioTrack?"audio":"video",U)}),i.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:k}=P;return k}),c=yield Rn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield Rn(c.next())).value,h=i.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:z}=k;i.pendingLocalTracks.indexOf(z)===-1&&i.pendingLocalTracks.push(z)}),i.unbindLocalTrackEvents(r),P}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield Rn(c.next(_))).value;if(i.state===zn.Disconnected)throw new Ne(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:z,interceptLocalAudioFrame:U}=lP();P.trackMediaType===mt.VIDEO?await z(k.sender,P):P.trackMediaType===mt.AUDIO&&await U(k.sender,{metadata:R?()=>{const V=P.metadata.shift();return V&&V.value}:void 0})}),r.forEach(P=>{let{type:k}=P;i.statsCollector.addLocalStats(k)}),i.assignLocalTracks(r,y),i.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:z}=P;const U=Date.now();i.store.publish(k.getTrackId(),z===Ge.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof pr))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=Nx(u,h)),m.maxFramerate=u.framerate?Ja(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ge.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return D.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=Ja(m.width)),m.height&&(_.height=Ja(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=ax(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},Ja(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),D.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return pl(function*(){if(!r.connection||r.state!==zn.Connected)return;const i=yield Rn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ge.LocalVideoTrack);if(!c)throw new Ne(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ge.LocalVideoLowTrack))throw new Ne(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:Ge.LocalVideoLowTrack}];if(yield*mA(jH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ge.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Rn(r.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Es(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Es(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==mt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==mt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Es(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===mt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(kt.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==zn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==zn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==zn.Connected)return;const e=this.localTrackMap.get(Ge.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[Ge.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==zn.Connected)throw new Ne(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,c){var u;if(!this.connection||this.state!==zn.Connected)throw new Ne(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const P=c.find(z=>{let{stream_type:U}=z;return U===r});if(!P)throw new Ne(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof Eh&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof Eh&&(_=P.transceiver),h=P.track,m=P.id}if(r===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Uv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Mv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=lP();r==mt.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(z=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(z)})}):r==mt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:z=>{this.safeEmit(kt.AudioMetadata,z)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:z}=P;return k.uid===e.uid&&r===z});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==zn.Connected)throw new Ne(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=lP();u==mt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=c._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):u==mt.AUDIO&&await z(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===mt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Uv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Mv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:z}=lP();u==mt.VIDEO?await k(S.receiver,{onSei:U=>{var V;(V=c._videoTrack)===null||V===void 0||V._onSei(U)}}):u==mt.AUDIO&&await z(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:z,kind:U}=k;return z.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===e.uid&&r===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===zn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===mt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===mt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==zn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===mt.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===mt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===mt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==zn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===mt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=za(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===mt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===mt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===mt.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==zn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(Ge.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(Ge.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ti){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ge.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ge.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ge.LocalAudioTrack),m=o?this.localTrackMap.get(Ge.LocalVideoLowTrack):this.localTrackMap.get(Ge.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof jr),m=o?(u=this.localTrackMap.get(Ge.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof pr);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Cs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=gP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=zn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof pr||r&&r.track instanceof jr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Dc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ge.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=$T(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=zn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=gP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ge.LocalVideoTrack:st(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ge.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ge.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Dc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Dc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Pm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Pm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return pl(function*(){if(!r.connection||r.state!==zn.Connected)return;const i=yield Rn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Rn(r.connection.restartICE(e));const u=yield Rn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(Yx(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case As.UDP_TCP_RELAY:r._pcStatsUploadType=Yf.UDP_TCP_RESTART;break;case As.TCP_RELAY:r._pcStatsUploadType=Yf.TCP_RESTART;break;case As.RELAY:r._pcStatsUploadType=Yf.RELAY_RESTART;break;default:r._pcStatsUploadType=Yf.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(Ge.LocalVideoTrack),i=this.localTrackMap.get(Ge.LocalAudioTrack),o=e.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=kc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return vG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=kc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ct((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==zn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ge.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ge.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ct((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,r,i){const o=[],c=this.getAllTracks();e=bv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get(Ge.LocalAudioTrack);for(const _ of e){if(_ instanceof pr&&(this.localTrackMap.has(Ge.LocalVideoTrack)||h?new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ge.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:Ge.LocalVideoLowTrack})}if(_ instanceof jr)if(m){const y=m.track;if(y instanceof Ti)Kx([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=qx([y,_]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof Ti?(Kx([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Nn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=qx(u?[_,u]:[_]):u=_}return u&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ge.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=bv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof jr){const c=this.localTrackMap.get(Ge.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ge.LocalAudioTrack,c]),c.track.close())):r.push([Ge.LocalAudioTrack,c])}if(o instanceof pr){const c=this.localTrackMap.get(Ge.LocalVideoTrack);if(!c)continue;r.push([Ge.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ge.LocalVideoLowTrack);u&&r.push([Ge.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=bv(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=bv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ge.LocalVideoTrack:i.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Et.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ge.LocalVideoTrack:i.off(Et.GET_STATS,this.handleGetLocalVideoStats),i.off(Et.GET_RTC_STATS,this.handleGetRTCStats),i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Mv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Uv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case Ge.LocalAudioTrack:u=Gn.Audio,h={dtx:m instanceof WA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ge.LocalVideoTrack:u=st(c=m._hints).call(c,ar.SCREEN_TRACK)?Gn.Screen:Gn.High,h=vh(vh({},VG(m)),{},{codec:this.store.codec,svc_mode:iP()});break;case Ge.LocalVideoLowTrack:u=Gn.Low,h=vh(vh({},VG(m)),{},{codec:this.store.codec,svc_mode:iP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof Eh&&!Nr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Eh&&UH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=Yf.DISCONNECTED_OR_FAILED,kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));wt.reportApiInvoke(this.store.sessionId,{name:gi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Lr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof Eh&&!Nr()&&!this._forceTurn){if(st(kG).call(kG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{Yx(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},o=()=>{Yx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{VH(e,i,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&kc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Lr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(kv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_AUDIO_DECODE,br.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_AUDIO_RECEIVED,br.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_VIDEO_RECEIVED,br.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cm(i))," -> ").concat(JSON.stringify(Cm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cm(i))," -> ").concat(JSON.stringify(Cm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return vh(vh({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof Eh&&function(r){Xv.delete(r.id),UH(r)}(e),e.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ge.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||r.push([Ge.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ge.LocalVideoTrack)){const c=this.localTrackMap.get(Ge.LocalVideoLowTrack);c&&r.push([Ge.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ge.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&r.push([Ge.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ge.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ge.LocalVideoLowTrack);c&&r.push([Ge.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(r.has(o)){let u=r.get(o);c===mt.VIDEO?u|=Mi.Video:u|=Mi.Audio,r.set(o,u)}else c===mt.VIDEO?r.set(o,Mi.Video):r.set(o,Mi.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ge.LocalVideoTrack),i=this.localTrackMap.get(Ge.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ct((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ct((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(st(_).call(_,ar.SCREEN_TRACK)||st(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,D.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof jr){var r;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await sr(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ns(BL(this.dtlsFailedCount,_i)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Es(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof pr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof pr).length>1)throw new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof jr).length>1&&(e.some(r=>r instanceof jr&&r._bypassWebAudio)||!Nn().webAudioMediaStreamDest))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof pr&&this.pendingLocalTracks.some(i=>i instanceof pr))throw new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof jr&&this.pendingLocalTracks.some(i=>i instanceof jr)&&(!Nn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jr&&i._bypassWebAudio)))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding,c=vh(vh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():Xx(e,c);const h=or(8,"track-low-"),m=new pr(u,vh(vh({},o&&{scaleResolutionDownBy:Nx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(A_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Pv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),st(i=e._hints).call(i,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(Et.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Eh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();wt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Dc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,xi.FIRST_VIDEO_DECODE,br.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ge.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Pv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},yt(un.prototype,"startP2PConnection",[no],Object.getOwnPropertyDescriptor(un.prototype,"startP2PConnection"),un.prototype),yt(un.prototype,"connect",[no],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),yt(un.prototype,"updateRemoteRTPCapabilities",[no],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),yt(un.prototype,"publishDataChannel",[no],Object.getOwnPropertyDescriptor(un.prototype,"publishDataChannel"),un.prototype),yt(un.prototype,"unpublish",[no],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),yt(un.prototype,"unpublishDataChannel",[no],Object.getOwnPropertyDescriptor(un.prototype,"unpublishDataChannel"),un.prototype),yt(un.prototype,"unpublishLowStream",[no],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),yt(un.prototype,"subscribeDataChannel",[no],Object.getOwnPropertyDescriptor(un.prototype,"subscribeDataChannel"),un.prototype),yt(un.prototype,"subscribe",[no],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),yt(un.prototype,"massSubscribe",[no],Object.getOwnPropertyDescriptor(un.prototype,"massSubscribe"),un.prototype),yt(un.prototype,"unsubscribe",[no],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),yt(un.prototype,"unsubscribeDataChannel",[no],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribeDataChannel"),un.prototype),yt(un.prototype,"massUnsubscribe",[no],Object.getOwnPropertyDescriptor(un.prototype,"massUnsubscribe"),un.prototype),yt(un.prototype,"muteRemote",[no],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),yt(un.prototype,"unmuteRemote",[no],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),yt(un.prototype,"hasRemoteMediaWithLock",[no],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),yt(un.prototype,"disconnectForReconnect",[no],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),yt(un.prototype,"updateBitrateLimit",[no],Object.getOwnPropertyDescriptor(un.prototype,"updateBitrateLimit"),un.prototype),yt(un.prototype,"remoteMediaSsrcChanged",[no],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function no(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function BH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function WH(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?BH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const dme=Date.now(),hme=20,Qx=new Map,TP=new Map;async function zH(e){const r=Qx.get(e),i=Array.isArray(r)&&r[r.length-1],o=TP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(r.pop(),GH(i.context,c),m=0):m=Math.min(m,hme),setTimeout(()=>r.length&&zH(e),m)}function GH(e,r){e.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function fme(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return GH(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=Qx.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=WH(WH({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),Qx.set(o,c);let m=!1;var _;TP.has(o)?m=!((_=TP.get(o))===null||_===void 0||!_.isSyncing):TP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||zH(o)}const pme=Cn().name;function HH(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $H(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?HH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Jv="websdk_ng_cache_parameter",mme=re("MAX_PRELOAD_ASYNC_LENGTH"),gme=1e4,B_=new Map,W_=[];let Zx=null,eM=0,tM=0;const bP=new Map,_me=function(e,r){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ct(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<r&&(o++,c())})}}(KH,mme),nM=Go.CancelToken.source();async function KH(e,r,i,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!Nn().supportWebCrypto)return void vm(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Ne(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ts(i,"token",1,2047),ts(e,"appid",1,2047),ZA(r),o&&eP(o);const h=C_();D.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await ct.all([Zpe(o,{sid:h,appId:e},nM.token),mH($H($H({},m),{},{token:i||e,uid:0}),nM.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await mH(m,nM.token));const S={sid:h,appId:e,cname:r,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(R){let P;try{R.uid&&YH({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=ZH(R),z=await async function(V,q){try{const Y=await window.crypto.subtle.importKey("raw",FW(q),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,R_(window.btoa(JSON.stringify(V))));return Sm(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!z)return;P=QH(Jv);const U=P?JSON.parse(P):[];U.push({[k]:z}),U.length>re("AP_CACHE_NUM")&&U.shift(),wP(Jv,JSON.stringify(U))}catch(k){D.warn("Error caching server parameters:",k.message),wP(Jv,"")}}(S),eM++}catch(h){throw tM++,function(m){Zx||(Zx=window.setTimeout(()=>{let y="";bP.forEach((S,R)=>{y+="".concat(R,": ").concat(S," ;")}),wt.reportApiInvoke(null,{name:gi.PRELOAD,options:{success:eM,failed:tM,err:y}}).onError(m),eM=0,tM=0,bP.clear(),Zx=null},gme));const _=bP.get(m.code)||0;bP.set(m.code,_+1)}(h),h}}async function qH(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=YH(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",FW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,R_(o));return JSON.parse(window.atob(Sm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<re("AP_CACHE_LIFETIME"))return i}catch(r){D.warn("Error get preloadInfo",r.message)}}function YH(e){let r;try{if(r=QH(Jv),!r)return;const i=JSON.parse(r),o=ZH(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return wP(Jv,JSON.stringify(i)),u[o]}catch(i){D.warn("Error delete preload info: ".concat(r),i.message),wP(Jv,"")}}function rM(e){if(e){let r=B_.get(e);r&&(window.clearTimeout(r),r=null,B_.delete(e)),st(W_).call(W_,e)||e.cloudProxyServer!=="disabled"||W_.push(e)}if(B_.size<re("AP_CACHE_NUM")&&W_.length>0){const r=W_.shift();B_.set(r,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await _me(i,o,c,h,m,u),B_.has(r)&&rM(r)}catch(_){D.warn("update preload failed",_.message),XH(r)}},re("AP_UPDATE_INTERVAL")))}}function XH(e){const r=W_.indexOf(e);r!==-1&&W_.splice(r,1);let i=B_.get(e);i&&(window.clearTimeout(i),i=null,B_.delete(e),rM())}function JH(e,r){const i=e.sua,o=e.ap;r&&i&&wt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),wt.reportResourceTiming(e.ap.url,e.sid),wt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[oi.CHOOSE_SERVER,oi.CLOUD_PROXY_FALLBACK].toString()}),wt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[oi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function QH(e){return window.atob(window.localStorage.getItem(e)||"")}function wP(e,r){window.localStorage.setItem(e,window.btoa(r))}function ZH(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),$W(r)}function Eme(e){let r=function(){const i=Sme.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(li(o,10),km(o,c));let u=i.cid;u!==void 0&&(li(o,16),li(o,u));let h=i.cname;h!==void 0&&(li(o,26),km(o,h));let m=i.deviceId;m!==void 0&&(li(o,34),km(o,m));let _=i.elapse;_!==void 0&&(li(o,40),Nm(o,_));let y=i.fileSize;y!==void 0&&(li(o,48),Nm(o,Qv(y)));let S=i.height;S!==void 0&&(li(o,56),Nm(o,Qv(S)));let R=i.jpg;R!==void 0&&(li(o,66),li(o,R.length),t9(o,R));let P=i.networkType;P!==void 0&&(li(o,72),Nm(o,Qv(P)));let k=i.osType;k!==void 0&&(li(o,80),Nm(o,Qv(k)));let z=i.requestId;z!==void 0&&(li(o,90),km(o,z));let U=i.sdkVersion;U!==void 0&&(li(o,98),km(o,U));let V=i.sequence;V!==void 0&&(li(o,104),Nm(o,Qv(V)));let q=i.sid;q!==void 0&&(li(o,114),km(o,q));let Y=i.timestamp;Y!==void 0&&(li(o,120),Nm(o,Y));let le=i.uid;le!==void 0&&(li(o,128),li(o,le));let ge=i.vid;ge!==void 0&&(li(o,136),li(o,ge));let Ee=i.width;Ee!==void 0&&(li(o,144),Nm(o,Qv(Ee)));let pe=i.service;pe!==void 0&&(li(o,152),li(o,pe));let Pe=i.callbackData;Pe!==void 0&&(li(o,162),li(o,Pe.length),t9(o,Pe));let Ke=i.ticket;Ke!==void 0&&(li(o,170),km(o,Ke));let lt=i.vendorConfigs;lt!==void 0&&(li(o,178),km(o,lt))}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function yme(e){return function(i){let o={};e:for(;!Tme(i);){let c=Pb(i);switch(c>>>3){case 0:break e;case 1:o.code=Pb(i);break;case 2:o.msg=n9(i,Pb(i));break;case 3:o.requestId=n9(i,Pb(i));break;case 4:o.timestamp=bme(i,!1);break;default:vme(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function vme(e,r){switch(r){case 0:for(;128&fu(e););break;case 2:iM(e,Pb(e));break;case 5:iM(e,4);break;case 1:iM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function Qv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Sme=[];function iM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function Tme(e){return e.offset>=e.limit}function RP(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function e9(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function t9(e,r){let i=RP(e,r.length);e.bytes.set(r,i)}function n9(e,r){let i=e9(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function km(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}li(e,o);let c=RP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function fu(e){return e.bytes[e9(e,1)]}function r9(e,r){let i=RP(e,1);e.bytes[i]=r}function Pb(e){let r,i=0,o=0;do r=fu(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function li(e,r){for(r>>>=0;r>=128;)r9(e,127&r|128),r>>>=7;r9(e,r)}function bme(e,r){let i,o=0,c=0,u=0;return i=fu(e),o=127&i,128&i&&(i=fu(e),o|=(127&i)<<7,128&i&&(i=fu(e),o|=(127&i)<<14,128&i&&(i=fu(e),o|=(127&i)<<21,128&i&&(i=fu(e),c=127&i,128&i&&(i=fu(e),c|=(127&i)<<7,128&i&&(i=fu(e),c|=(127&i)<<14,128&i&&(i=fu(e),c|=(127&i)<<21,128&i&&(i=fu(e),u=127&i,128&i&&(i=fu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Nm(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=RP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const i9={},s9={},CP=4294967296,wme=CP*CP,Rme=wme/2;a9(0,!0);const o9=a9(0),Cme=Ob(0,-2147483648,!1),Ime=Ob(-1,2147483647,!1);function a9(e,r){let i,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=s9[e],o)?o:(i=Ob(e,0,!0),c&&(s9[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=i9[e],o)?o:(i=Ob(e,e<0?-1:0,!1),c&&(i9[e]=i),i)}function Ob(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function c9(e,r){if(isNaN(e))return o9;{if(e<=-9223372036854776e3)return Cme;if(e+1>=Rme)return Ime}return e<0?o9:Ob(e%CP|0,e/CP|0,r)}function l9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class sM extends Ar{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(pd.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",El.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Go.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==El.CONNECTED)throw new Re(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===El.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=or(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new yb("worker-"+this._moderationId,_i),this.on(pd.STATE_CHANGE,(o,c)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Bv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(pd.STATE_CHANGE,Bv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ct((c,u)=>{this.on(pd.CONNECTION_STATE_CHANGE,(h,m)=>{h===El.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===El.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,R){let{appId:P,areaCode:k,cname:z,sid:U,token:V,uid:q}=y;Kv++;const Y="moderation_plugin",le={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:z,command:"allocateEdge",requestId:Kv,seq:Kv,sid:U,appToken:V,ts:Date.now(),uid:q+""})};let ge,Ee,pe=_[0];return ud(async()=>{ge=Date.now();const Pe=await md(pe,{data:le,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ge,Pe.code!==0){const ht=new Re(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Pe.code,{retry:!0,responseTime:Ee});throw D.error(ht.toString()),ht}const Ke=JSON.parse(Pe.json_body);if(Ke.code!==200){const ht=new Re(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ke.code,", reason: ").concat(Ke.reason),{code:Ke.code,responseTime:Ee});throw D.error(ht.toString()),ht}if(!Ke.servers||!Array.isArray(Ke.servers)||Ke.servers.length===0){const ht=new Re(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ke.code,responseTime:Ee});throw D.error(ht.toString()),ht}if(!Ke.servers.some(ht=>!!ht.wss)){const ht=new Re(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ke.code,responseTime:Ee});throw D.error(ht.toString()),ht}const lt=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ke.servers.map(ht=>{let{address:Sn,wss:Tn}=ht;if(Sn&&Tn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(lt,":").concat(Tn,"/moderation")}).filter(ht=>!!ht),workerToken:Ke.workerToken,vid:Ke.vid,ticket:Ke.appTicket,responseTime:Ee}},(Pe,Ke)=>(wt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(Pe.addressList),firstSuccess:Ke===0,responseTime:Ee,serverIp:_[Ke%_.length]}),!1),(Pe,Ke)=>(wt.apworkerEvent(U,{success:!1,sc:Pe.data&&Pe.data.code||200,serviceName:Y,responseTime:Ee,serverIp:_[Ke%_.length]}),!!(Pe.code!==X.OPERATION_ABORTED&&Pe.code!==X.UNEXPECTED_RESPONSE||Pe.data&&Pe.data.retry)&&(pe=_[(Ke+1)%_.length],!0)),R)}(c,r,i,o);this.emit(pd.STATE_CHANGE,Bv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(pd.STATE_CHANGE,Bv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Yt.CONNECTED,async()=>{this.emit(pd.STATE_CHANGE,Bv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=El.CONNECTED}),this._workerConnection.on(Yt.CLOSED,()=>{this.connectionState=El.CLOSED}),this._workerConnection.on(Yt.FAILED,()=>{this.connectionState=El.CLOSED}),this._workerConnection.on(Yt.RECONNECTING,()=>{this.connectionState=this.connectionState===El.CONNECTED?El.RECONNECTING:El.CONNECTING}),this._workerConnection.on(Yt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=yme(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wt.reportApiInvoke(this._connectInfo.sid||null,{name:gi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Lr.TRACER}).onError(new Re(X.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Yt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Yt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=kc(this,pd.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await x8(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:sM.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:c9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const z=Eme(k);if(z.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(V){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?l9(Object(Y),!0).forEach(function(le){$(V,le,Y[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):l9(Object(Y)).forEach(function(le){Object.defineProperty(V,le,Object.getOwnPropertyDescriptor(Y,le))})}return V}({},k);delete U.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return z}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Go.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=El.CLOSED,this.emit(pd.STATE_CHANGE,Bv.CLOSED)}}function u9(e){if(tr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Re(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Re(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ame={name:"ImageModeration",create:function(e){let{config:r}=e;return u9(r),new sM(r)}};var d9,h9,f9,p9,m9,g9,_9,E9,y9,v9,S9,T9,b9,w9,R9,C9,I9,A9,P9,O9,k9,N9,D9,L9,x9,M9,U9,V9,F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,dt;function Q9(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function pu(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Q9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Cs.setLogger(D);let Pme=(d9=Ut(),h9=Ut({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof Dv))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),f9=Ut({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Nv.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),p9=Ut({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),m9=Ut({argsMap:(e,r,i)=>[r,i]}),g9=Ut({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),_9=Ut({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),E9=Ut({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),y9=Ut(),v9=Ut(),S9=Ut(),T9=Ut(),b9=Ut(),w9=Ut(),R9=Ut(),C9=Ut(),I9=Ut(),A9=Ut(),P9=Ut(),O9=Ut(),k9=Ut(),N9=Ut(),D9=Ut(),L9=Ut({argsMap:(e,r)=>[r]}),x9=Ut(),M9=Ut(),U9=Ut(),V9=Ut(),F9=Ut(),j9=Ut(),B9=Ut(),W9=Ut(),z9=Ut({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),G9=Ut(),H9=Ut(),$9=Ut(),K9=Ut(),q9=Ut(),Y9=Ut(),X9=Ut({reportResult:!0}),J9=Ut(),dt=class extends Ar{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",Go.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return void D.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new Pm(c.uid,c.uint_id||c.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:AA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),D.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),y&&(R._audioOrtc=y)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),y&&(R._videoOrtc=y)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?wt.onGatewayStream(this._sessionId,xi.ON_ADD_VIDEO_STREAM,br.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):wt.onGatewayStream(this._sessionId,xi.ON_ADD_AUDIO_STREAM,br.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Ab))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(z=>{D.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{D.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof Ab&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),wt.onGatewayStream(this._sessionId,xi.ON_REMOVE_STREAM,br.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(D.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),D.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&L_(c,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void D.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),D.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(D.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{D.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||or(5,"client-"),this.store=new class{constructor(c,u,h,m){Ht(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:I_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return pt(pt({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return pt(pt({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return pt(pt({},u),{},{uid:h.uid});case gn.SET_INT_UID:return pt(pt({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return pt(pt({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return pt(pt({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=pt(pt({},m[_]),h.metric),pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{publish:[...m]})})):pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=pt(pt({},m[_]),h.metric),pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{subscribe:[...m]})})):pt(pt({},u),{},{keyMetrics:pt(pt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=pt(pt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return pt(pt({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return pt(pt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:pt(pt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:pt(pt(pt(pt(pt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:pt(pt(pt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:pt(pt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Cs("client-leave",this._clientId),this._publishMutex=new Cs("client-publish",this._clientId),this._renewTokenMutex=new Cs("client-renewtoken",this._clientId),this._subscribeMutex=new Cs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ml," build: ").concat(JL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{VL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){D.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new Cb(this.store),this._statsCollector.onStatsException=(c,u,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Kpe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||_i,httpRetryConfig:e.httpRetryConfig||_i,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new rme(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Xf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new Ab(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Jn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Jn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof Ox&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){bA.get(_)||bA.set(_,[]),wA.get(_)||wA.set(_,y),uh.get(_)||uh.set(_,0);const R=bA.get(_),P=wA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(uh.get(_)===P){const q=rb();R.push(q),await q.promise}uh.set(_,uh.get(_)+1);for(var k=arguments.length,z=new Array(k>3?k-3:0),U=3;U<k;U++)z[U-3]=arguments[U];const V=await S(...z);return uh.set(_,uh.get(_)-1),uh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),uh.get(_)===0&&(bA.set(_,[]),wA.set(_,0),uh.set(_,0)),V}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,c)}async join(e,r,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(kA||kA||(kA=(window.location.protocol.split(":")[0]||"").toUpperCase(),kA))==="HTTPS",m=YW()?window.isSecureContext:"Browser Not Support";(!YW()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),wt.setAppId(e);try{if(!i&&i!==null)throw new Re(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&ts(i,"token",1,2047),ts(e,"appid",1,2047),ZA(r),o&&eP(o),c&&ts(c,"optionalInfo",1,2047)}catch(U){throw wt.reportApiInvoke(C_(),{name:gi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw wt.reportApiInvoke(C_(),{name:gi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await qH({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||C_();D.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=wt.reportApiInvoke(y,{id:this._clientId,name:gi.JOIN,options:[e,r,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}),R=pu(pu(pu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const V=function(ge){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),pe=new Uint8Array(new ArrayBuffer(Ee.length));for(let Pe=0;Pe<Ee.length;Pe+=1)pe[Pe]=Ee.charCodeAt(Pe);return pe}(),q=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=ML(U),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(ge){let Ee="";for(let pe=0;pe<ge.length;pe+=1)Ee+=String.fromCharCode(ge[pe]);return window.btoa(Ee)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,V=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,le){const ge=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256,pe=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:s8,hash:"SHA-256",salt:le},ge,Ee+bfe);return new Uint8Array(pe).subarray(Ee/8)}(this._encryptionMode,V,R_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,le){const ge=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:s8,hash:"SHA-256",salt:le},ge,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,V,R_(this._encryptionSalt))}else m?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const V=R.cloudProxyServer;if(st(k=["proxy3","proxy4","proxy5"]).call(k,V)){const Ee=re("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(wt.setProxyServer(R.proxyServer),D.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await jG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(pe=>({turnServerURL:pe.address,tcpport:pe.tcpport||ys.tcpport,udpport:pe.udpport||ys.udpport,username:pe.username||ys.username,password:pe.password||ys.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}JH(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,U]=await ct.all([pH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,this.store),fH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,U.gatewayInfo.uid=Ee,U.gatewayInfo.res.uid=Ee}else U=await fH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(_b.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(_b.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=i||e;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=pu(pu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(le),this._appId=e,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(gs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ge=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ge)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),z=this,st(D_).call(D_,z)||D_.push(z),this._cloudProxyServerMode==="disabled"&&Nn().supportWebCrypto&&re("ENABLE_PRELOAD")&&rM(this._joinInfo),le}catch(U){const V=Array.isArray(U)?U[0]:U;throw V&&V.code===X.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V):D.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V),V.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(V),V}var z}_joinGateway(){if(!this._joinInfo||!this._key)throw new Re(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(gs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=D_.indexOf(r);i!==-1&&D_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Wn.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Dv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Re(X.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Re(X.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Dv))throw new Re(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Re(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof pr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),D.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw D.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){tr(e.id,"id",0,65535,!0),zf(e.ordered,"ordered"),ts(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Re(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Re(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Re(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return iH(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Re(X.CREATE_DATACHANNEL_ERROR);try{await ct.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw D.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Re(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof Dv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(Jr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw D.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof Pm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Re(X.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(Ii(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Re(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Re(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===mt.AUDIO,o=r===mt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Re(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new Pm(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=i?S._audioTrack:S._videoTrack;if(!R)throw new Re(X.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var i;if(tr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Re(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Re(X.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===r);if(!c)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Re(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Re(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,i){if(Ii(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Re(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Re(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Re(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Re(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Ii(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Re(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Re(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Re(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),y}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c}),Ps.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=r==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Re(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Gf(e,"subscribeList"),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y;if(Ii(R,"mediaType",["audio","video"]),!S){const U=new Re(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Re(X.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Re(X.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=Mi.Video|Mi.LwoVideo,z=i.get(S);if(z){if(R==="video"?z&k:z&Mi.Audio){e.splice(_,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}i.set(S,z|(R==="video"?k:Mi.Audio))}else i.set(S,R==="video"?k:Mi.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:R}=y,P=Mi.Video|Mi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=i.get(S);i.set(S,R==="video"?k^P:k^Mi.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=za(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,R]=y;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&Mi.Audio&&(P.audio_ssrc=S._audioSSRC),R&Mi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:R}=y;return{user:S,mediaType:R,ssrcId:R===mt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===mt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:z}=S;(P||k||z)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:z})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(z=>z.uid===R);if(k){let z;P.error_code||P.video_error_code&&P.audio_error_code?z=void 0:P.video_error_code?z=mt.VIDEO:P.audio_error_code&&(z=mt.AUDIO),y.push({user:k,mediaType:z})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const R=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(R){const P=Eb(R);D.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(P.desc)),y.error=new Re(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;wt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===mt.VIDEO,audio:y.mediaType===mt.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===mt.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:R}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,r,i){if(!(e instanceof Pm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Re(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&Ii(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Re(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&AA(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&tr(r,"id",0,65535,!0),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Re(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Re(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Gf(e,"unsubscribeList"),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Re(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ii(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Mi.Video|Mi.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Mi.Audio;break;default:_=m&(Mi.Audio|h)}if(_){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?r.set(o,m|Mi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Mi.Audio|h)}else c?c==="audio"?r.set(o,Mi.Audio):c==="video"&&r.set(o,h):r.set(o,Mi.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===X.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Ne(X.INVALID_PARAMS);Dr(i.width)||LL(i.width,"streamParameter.width"),Dr(i.height)||LL(i.height,"streamParameter.height"),Dr(i.framerate)||LL(i.framerate,"streamParameter.framerate"),Dr(i.bitrate)||tr(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Ge.LocalVideoLowTrack)}async enableDualStream(){if(!Nn().supportDualStream)throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Re(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Re(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Re(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ge.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Ii(o,"role",["audience","host"])}(e),r&&VL(r),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Re(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Re(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Re(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",_s.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&VL(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(ts(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Re(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Re(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,wt.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Re(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Re(X.INVALID_OPERATION,"You have already set the proxy")}if(cb(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>UW(i)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Re(X.INVALID_OPERATION,"you should set license before join channel");if(ts(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Re(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Re(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Re(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Re(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Re(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Re(X.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Re(X.INVALID_PARAMS,"accessPoints is required.");Gf(e.accessPoints.serverList,"accessPoints.serverList"),ts(e.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{tr(P,k,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Re(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Jn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Jn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Jn("WEBCS_DOMAIN",h),Jn("WEBCS_DOMAIN_BACKUP_LIST",h),Jn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Gf(e.report.hostname,"report.hostname"),Jn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Jn("EVENT_REPORT_DOMAIN",u[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),Jn("STATS_COLLECTOR_PORT",m),e.report?Jn("ENABLE_EVENT_REPORT",!0):Jn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Gf(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),y=e.log.port),Jn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Gf(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),Jn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?Jn("ENABLE_CONFIG_DISTRIBUTE",!0):Jn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(Gf(e,"serverList"),ts(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Re(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Jn("WEBCS_DOMAIN",e),Jn("WEBCS_DOMAIN_BACKUP_LIST",e),Jn("GATEWAY_DOMAINS",[r]),Jn("EVENT_REPORT_DOMAIN",e[0]),Jn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Jn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ii(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Ii(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Ii(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw D.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(u){Ii(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ts(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Re(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Re(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(zf(o,"encryptDataStream"),!st(c).call(c,e))throw new Re(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=Sm(i))}async renewToken(e){if(ts(e,"token",1,2047),!this._key||!this._joinInfo)throw new Re(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await nme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||_i);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,D.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Re(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Re(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Re(X.LIVE_STREAMING_TASK_CONFLICT);const i=r?Kf.TRANSCODE:Kf.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Kf.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new Re(X.INVALID_PARAMS,"can not find live streaming url to stop");await ct.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){SH(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){SH(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof Ab&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Re(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=za(m=Array.from(h)).call(m,(U,V)=>U+V,0),y={serverTs:0,seq:wfe++,length:h.length,checkSum:_},S=new Uint8Array(HW(_,2)),R=new ArrayBuffer(Cv),P=new DataView(R);P.setUint32(0,y.serverTs),P.setUint16(4,y.seq),P.setUint16(6,y.length),P.setUint16(8,y.checkSum);const k=16-h.length%16;h=jW(h,new Uint8Array(k));const z=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:i8,additionalData:S},u,h);return jW(new Uint8Array(R),new Uint8Array(z))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Re(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Bt.DATA_STREAM,{payload:Sm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-dme},!i)}sendMetadata(e){if(!this._joinInfo)throw new Re(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Re(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Bt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Sm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Dfe),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"can not send custom report, not joined");await wt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Ii(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ii(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(zf(r,"apRTM"),tr(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const r=Fv.indexOf(e);r!==-1&&Fv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Go.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&XH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&wt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Cs("client-publish",this._clientId),this._subscribeMutex=new Cs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const o=e||C_();e?D.debug("[".concat(this._clientId,"] new Session ").concat(o)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,wt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};wt.sessionInit(this._sessionId,pu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Re(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Re(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Jr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof pr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Re(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Re(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}i.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Re(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Xf("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:gi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Lr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:gi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Lr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},i.on(Ax.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Re(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Xpe(R,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,_i).then(u).catch(h)}),i};return e===Kf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Re(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},Xf("ChannelMediaRelay").create(e));o.on("state",c=>{c===va.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(z){return iH(z,!0)}(P);R._dataChannels.push(k),D.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(qi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=i||u||Sx()||!Object.prototype.hasOwnProperty.call(LA,o)||(dd[o]=c,fr[o]=c,D.debug("Update gateway parameters from config distribute",o,c))})}catch(r){D.error("Error update config from local cache",r.message)}})()}),this._gateway.on(qi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(qi.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===Wn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,e,r,i)};if(wt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:gi.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:Lr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(qi.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Re(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await qH(pu(pu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,JH(o),this._joinInfo.preload=!0):(i=await Gx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||_i,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){r(i)}}),this._gateway.on(qi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,e)}),this._gateway.on(qi.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,e,r),wt.reportApiInvoke(this._sessionId,{name:gi.STREAM_TYPE_CHANGE,options:[e,r],tag:Lr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(qi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(qi.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(qi.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const o=$G(e.ortc,r,i);this._p2pChannel.connect(o)}),this._gateway.on(qi.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,e=>{const r=R_(e.metadata);this.safeEmit(mn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=R_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<Cv)throw new Re(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Cv));i=await async function(u,h,m){const _=m.subarray(0,Cv),y=_.slice(8,Cv),S=(y[0]<<8)+y[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:i8,additionalData:new Uint8Array(HW(S,2))},h,m.subarray(Cv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),fme(pu(pu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{vm(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Wn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Wt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case Bt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===Gn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==Gn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===Gn.Screen||y===Gn.ScreenLow});r.state==="offer"&&wt.publish(this._joinInfo.sid,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===Gn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==Gn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Bt.SUBSCRIBE:r&&wt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===mt.AUDIO,video:r.stream_type===mt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!L_(o.string_id||o.stream_id,this.channelName)));const r=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Pm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=Mi.Audio&o.stream_type,h=(Mi.Video|Mi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof Ab&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return st(o=Object.keys(xA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Jr.PUBLISH,(e,r,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Jr.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Wt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Jr.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===Gn.Audio?mt.AUDIO:mt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){i(h)}}}),this._gateway.signal.on(Jr.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case wm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,mt.VIDEO,!0);break;case wm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,mt.AUDIO,!0);break;case wm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,mt.VIDEO,!1);break;case wm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,mt.AUDIO,!1)}}),this._gateway.signal.on(Jr.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==To.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(Jr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(Jr.RESTART_ICE,e,o===To.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(kt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Jr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(Jr.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.StateChange,(e,r)=>{r===zn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(kt.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(e,r,i)=>{ct.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(i)}),this._p2pChannel.on(kt.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:o,kind:c}of e)c===mt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(kt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(kt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(kt.MediaReconnectStart,e=>{this.safeEmit(mn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(kt.MediaReconnectEnd,e=>{this.safeEmit(mn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(kt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),h=$G(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,e=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(kt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,e=>{this.safeEmit(mn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},Xf("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},_i)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(Yi.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===uu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Re(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Yi.INSPECT_RESULT,(r,i)=>{var o;if((i==null?void 0:i.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,i)}),e.on(Yi.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(zf(e,"enabled"),e){if(!r)throw new Re(X.INVALID_PARAMS,"config is required");if(u9(r),!this._joinInfo)throw new Re(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(i={config:r},Xf("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},_i)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Re(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(pd.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===El.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Re(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(pd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Ii(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Re(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){zf(e,"enabled"),Jn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},yt(dt.prototype,"leave",[d9],Object.getOwnPropertyDescriptor(dt.prototype,"leave"),dt.prototype),yt(dt.prototype,"publish",[h9],Object.getOwnPropertyDescriptor(dt.prototype,"publish"),dt.prototype),yt(dt.prototype,"unpublish",[f9],Object.getOwnPropertyDescriptor(dt.prototype,"unpublish"),dt.prototype),yt(dt.prototype,"subscribe",[p9],Object.getOwnPropertyDescriptor(dt.prototype,"subscribe"),dt.prototype),yt(dt.prototype,"presubscribe",[m9],Object.getOwnPropertyDescriptor(dt.prototype,"presubscribe"),dt.prototype),yt(dt.prototype,"massSubscribe",[g9],Object.getOwnPropertyDescriptor(dt.prototype,"massSubscribe"),dt.prototype),yt(dt.prototype,"unsubscribe",[_9],Object.getOwnPropertyDescriptor(dt.prototype,"unsubscribe"),dt.prototype),yt(dt.prototype,"massUnsubscribe",[E9],Object.getOwnPropertyDescriptor(dt.prototype,"massUnsubscribe"),dt.prototype),yt(dt.prototype,"setLowStreamParameter",[y9],Object.getOwnPropertyDescriptor(dt.prototype,"setLowStreamParameter"),dt.prototype),yt(dt.prototype,"enableDualStream",[v9],Object.getOwnPropertyDescriptor(dt.prototype,"enableDualStream"),dt.prototype),yt(dt.prototype,"disableDualStream",[S9],Object.getOwnPropertyDescriptor(dt.prototype,"disableDualStream"),dt.prototype),yt(dt.prototype,"setClientRole",[T9],Object.getOwnPropertyDescriptor(dt.prototype,"setClientRole"),dt.prototype),yt(dt.prototype,"_setClientRoleOptions",[b9],Object.getOwnPropertyDescriptor(dt.prototype,"_setClientRoleOptions"),dt.prototype),yt(dt.prototype,"setProxyServer",[w9],Object.getOwnPropertyDescriptor(dt.prototype,"setProxyServer"),dt.prototype),yt(dt.prototype,"setTurnServer",[R9],Object.getOwnPropertyDescriptor(dt.prototype,"setTurnServer"),dt.prototype),yt(dt.prototype,"setLicense",[C9],Object.getOwnPropertyDescriptor(dt.prototype,"setLicense"),dt.prototype),yt(dt.prototype,"startProxyServer",[I9],Object.getOwnPropertyDescriptor(dt.prototype,"startProxyServer"),dt.prototype),yt(dt.prototype,"stopProxyServer",[A9],Object.getOwnPropertyDescriptor(dt.prototype,"stopProxyServer"),dt.prototype),yt(dt.prototype,"setLocalAccessPointsV2",[P9],Object.getOwnPropertyDescriptor(dt.prototype,"setLocalAccessPointsV2"),dt.prototype),yt(dt.prototype,"setLocalAccessPoints",[O9],Object.getOwnPropertyDescriptor(dt.prototype,"setLocalAccessPoints"),dt.prototype),yt(dt.prototype,"setRemoteDefaultVideoStreamType",[k9],Object.getOwnPropertyDescriptor(dt.prototype,"setRemoteDefaultVideoStreamType"),dt.prototype),yt(dt.prototype,"setRemoteVideoStreamType",[N9],Object.getOwnPropertyDescriptor(dt.prototype,"setRemoteVideoStreamType"),dt.prototype),yt(dt.prototype,"setStreamFallbackOption",[D9],Object.getOwnPropertyDescriptor(dt.prototype,"setStreamFallbackOption"),dt.prototype),yt(dt.prototype,"setEncryptionConfig",[L9],Object.getOwnPropertyDescriptor(dt.prototype,"setEncryptionConfig"),dt.prototype),yt(dt.prototype,"renewToken",[x9],Object.getOwnPropertyDescriptor(dt.prototype,"renewToken"),dt.prototype),yt(dt.prototype,"enableAudioVolumeIndicator",[M9],Object.getOwnPropertyDescriptor(dt.prototype,"enableAudioVolumeIndicator"),dt.prototype),yt(dt.prototype,"startLiveStreaming",[U9],Object.getOwnPropertyDescriptor(dt.prototype,"startLiveStreaming"),dt.prototype),yt(dt.prototype,"setLiveTranscoding",[V9],Object.getOwnPropertyDescriptor(dt.prototype,"setLiveTranscoding"),dt.prototype),yt(dt.prototype,"stopLiveStreaming",[F9],Object.getOwnPropertyDescriptor(dt.prototype,"stopLiveStreaming"),dt.prototype),yt(dt.prototype,"startChannelMediaRelay",[j9],Object.getOwnPropertyDescriptor(dt.prototype,"startChannelMediaRelay"),dt.prototype),yt(dt.prototype,"updateChannelMediaRelay",[B9],Object.getOwnPropertyDescriptor(dt.prototype,"updateChannelMediaRelay"),dt.prototype),yt(dt.prototype,"stopChannelMediaRelay",[W9],Object.getOwnPropertyDescriptor(dt.prototype,"stopChannelMediaRelay"),dt.prototype),yt(dt.prototype,"sendCustomReportMessage",[z9],Object.getOwnPropertyDescriptor(dt.prototype,"sendCustomReportMessage"),dt.prototype),yt(dt.prototype,"pickSVCLayer",[G9],Object.getOwnPropertyDescriptor(dt.prototype,"pickSVCLayer"),dt.prototype),yt(dt.prototype,"setRTMConfig",[H9],Object.getOwnPropertyDescriptor(dt.prototype,"setRTMConfig"),dt.prototype),yt(dt.prototype,"enableContentInspect",[$9],Object.getOwnPropertyDescriptor(dt.prototype,"enableContentInspect"),dt.prototype),yt(dt.prototype,"disableContentInspect",[K9],Object.getOwnPropertyDescriptor(dt.prototype,"disableContentInspect"),dt.prototype),yt(dt.prototype,"setImageModeration",[q9],Object.getOwnPropertyDescriptor(dt.prototype,"setImageModeration"),dt.prototype),yt(dt.prototype,"setP2PTransport",[Y9],Object.getOwnPropertyDescriptor(dt.prototype,"setP2PTransport"),dt.prototype),yt(dt.prototype,"getJoinChannelServiceRecords",[X9],Object.getOwnPropertyDescriptor(dt.prototype,"getJoinChannelServiceRecords"),dt.prototype),yt(dt.prototype,"setPublishAudioFilterEnabled",[J9],Object.getOwnPropertyDescriptor(dt.prototype,"setPublishAudioFilterEnabled"),dt.prototype),dt);class kb{constructor(r,i){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),kb.count+=1,this.id=kb.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ct(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Re(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(c){throw new Re(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Re(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Z9,IP;$(kb,"count",0);const Ome=window.AudioContext||window.webkitAudioContext,kme=new(Z9=Ut({report:wt}),yt((IP=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ome);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new kb(e,this.context),this.units.push(r)),r.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Cn().name!==Un.SAFARI}}).prototype,"processExternalMediaAEC",[Z9],Object.getOwnPropertyDescriptor(IP.prototype,"processExternalMediaAEC"),IP.prototype),IP);function e7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function t7(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?e7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):e7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const oM=window||document;function n7(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!oM)return;const i=Ei._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const o=c=>{if(!(c&&c.blockedURI&&(Ei.onSecurityPolicyViolation||Ei.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(Ei.onSecurityPolicyViolation&&typeof Ei.onSecurityPolicyViolation=="function"&&Ei.onSecurityPolicyViolation(c),Ei.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0&&Ei.safeEmit(gh.SECURITY_POLICY_VIOLATION,c))};i&&oM.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||Ei.getListeners(gh.SECURITY_POLICY_VIOLATION).length>0)&&oM.addEventListener("securitypolicyviolation",o),Ei._cspEventHandlerPointer=o}var Nme=N,Dme=F6,r7=RegExp.prototype,Lme=function(e){return e===r7||Nme(r7,e)?Dme(e):e.flags},ro=l(Lme);function Zv(e){let r=e.length;for(;--r>=0;)e[r]=0}const aM=256,i7=286,Nb=30,Db=15,cM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),AP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),xme=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zf=new Array(576);Zv(Zf);const Lb=new Array(60);Zv(Lb);const xb=new Array(512);Zv(xb);const Mb=new Array(256);Zv(Mb);const lM=new Array(29);Zv(lM);const PP=new Array(Nb);function uM(e,r,i,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let o7,a7,c7;function dM(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}Zv(PP);const l7=e=>e<256?xb[e]:xb[256+(e>>>7)],Ub=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},Bc=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,Ub(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},Sh=(e,r,i)=>{Bc(e,i[2*r],i[2*r+1])},u7=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},d7=(e,r,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=Db;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=u7(o[m]++,m))}},h7=e=>{let r;for(r=0;r<i7;r++)e.dyn_ltree[2*r]=0;for(r=0;r<Nb;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},f7=e=>{e.bi_valid>8?Ub(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},p7=(e,r,i,o)=>{const c=2*r,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[i]},hM=(e,r,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&p7(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!p7(r,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},m7=(e,r,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Sh(e,c,r):(u=Mb[c],Sh(e,u+aM+1,r),h=cM[u],h!==0&&(c-=lM[u],Bc(e,c,h)),o--,u=l7(o),Sh(e,u,i),h=AP[u],h!==0&&(o-=PP[u],Bc(e,o,h)));while(m<e.sym_next);Sh(e,256,r)},fM=(e,r)=>{const i=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(r.max_code=y,h=e.heap_len>>1;h>=1;h--)hM(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],hM(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,hM(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,z=R.stat_desc.static_tree,U=R.stat_desc.has_stree,V=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let le,ge,Ee,pe,Pe,Ke,lt=0;for(pe=0;pe<=Db;pe++)S.bl_count[pe]=0;for(P[2*S.heap[S.heap_max]+1]=0,le=S.heap_max+1;le<573;le++)ge=S.heap[le],pe=P[2*P[2*ge+1]+1]+1,pe>Y&&(pe=Y,lt++),P[2*ge+1]=pe,ge>k||(S.bl_count[pe]++,Pe=0,ge>=q&&(Pe=V[ge-q]),Ke=P[2*ge],S.opt_len+=Ke*(pe+Pe),U&&(S.static_len+=Ke*(z[2*ge+1]+Pe)));if(lt!==0){do{for(pe=Y-1;S.bl_count[pe]===0;)pe--;S.bl_count[pe]--,S.bl_count[pe+1]+=2,S.bl_count[Y]--,lt-=2}while(lt>0);for(pe=Y;pe!==0;pe--)for(ge=S.bl_count[pe];ge!==0;)Ee=S.heap[--le],Ee>k||(P[2*Ee+1]!==pe&&(S.opt_len+=(pe-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=pe),ge--)}})(e,r),d7(i,y,e.bl_count)},g7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},_7=(e,r,i)=>{let o,c,u=-1,h=r[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do Sh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Sh(e,c,e.bl_tree),m--),Sh(e,16,e.bl_tree),Bc(e,m-3,2)):m<=10?(Sh(e,17,e.bl_tree),Bc(e,m-3,3)):(Sh(e,18,e.bl_tree),Bc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let E7=!1;const y7=(e,r,i,o)=>{Bc(e,0+(o?1:0),3),f7(e),Ub(e,i),Ub(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var Mme=e=>{E7||((()=>{let r,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(lM[c]=o,r=0;r<1<<cM[c];r++)Mb[o++]=c;for(Mb[o-1]=c,u=0,c=0;c<16;c++)for(PP[c]=u,r=0;r<1<<AP[c];r++)xb[u++]=c;for(u>>=7;c<Nb;c++)for(PP[c]=u<<7,r=0;r<1<<AP[c]-7;r++)xb[256+u++]=c;for(i=0;i<=Db;i++)h[i]=0;for(r=0;r<=143;)Zf[2*r+1]=8,r++,h[8]++;for(;r<=255;)Zf[2*r+1]=9,r++,h[9]++;for(;r<=279;)Zf[2*r+1]=7,r++,h[7]++;for(;r<=287;)Zf[2*r+1]=8,r++,h[8]++;for(d7(Zf,287,h),r=0;r<Nb;r++)Lb[2*r+1]=5,Lb[2*r]=u7(r,5);o7=new uM(Zf,cM,257,i7,Db),a7=new uM(Lb,AP,0,Nb,Db),c7=new uM(new Array(0),xme,0,19,7)})(),E7=!0),e.l_desc=new dM(e.dyn_ltree,o7),e.d_desc=new dM(e.dyn_dtree,a7),e.bl_desc=new dM(e.bl_tree,c7),e.bi_buf=0,e.bi_valid=0,h7(e)},Ume=(e,r,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<aM;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),fM(e,e.l_desc),fM(e,e.d_desc),h=(m=>{let _;for(g7(m,m.dyn_ltree,m.l_desc.max_code),g7(m,m.dyn_dtree,m.d_desc.max_code),fM(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*s7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&r!==-1?y7(e,r,i,o):e.strategy===4||u===c?(Bc(e,2+(o?1:0),3),m7(e,Zf,Lb)):(Bc(e,4+(o?1:0),3),((m,_,y,S)=>{let R;for(Bc(m,_-257,5),Bc(m,y-1,5),Bc(m,S-4,4),R=0;R<S;R++)Bc(m,m.bl_tree[2*s7[R]+1],3);_7(m,m.dyn_ltree,_-1),_7(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),m7(e,e.dyn_ltree,e.dyn_dtree)),h7(e),o&&f7(e)},Vme=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(Mb[i]+aM+1)]++,e.dyn_dtree[2*l7(r)]++),e.sym_next===e.sym_end),Fme=e=>{Bc(e,2,3),Sh(e,256,Zf),(r=>{r.bi_valid===16?(Ub(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},jme={_tr_init:Mme,_tr_stored_block:y7,_tr_flush_block:Ume,_tr_tally:Vme,_tr_align:Fme},Vb=(e,r,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Bme=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var wo=(e,r,i,o)=>{const c=Bme,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},z_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},OP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Wme,_tr_stored_block:pM,_tr_flush_block:zme,_tr_tally:Dm,_tr_align:Gme}=jme,{Z_NO_FLUSH:Lm,Z_PARTIAL_FLUSH:Hme,Z_FULL_FLUSH:$me,Z_FINISH:mu,Z_BLOCK:v7,Z_OK:Yo,Z_STREAM_END:S7,Z_STREAM_ERROR:Th,Z_DATA_ERROR:Kme,Z_BUF_ERROR:mM,Z_DEFAULT_COMPRESSION:qme,Z_FILTERED:Yme,Z_HUFFMAN_ONLY:kP,Z_RLE:Xme,Z_FIXED:Jme,Z_DEFAULT_STRATEGY:Qme,Z_UNKNOWN:Zme,Z_DEFLATED:NP}=OP,gM=286,ege=30,tge=19,nge=2*gM+1,rge=15,G_=258,bh=262,eS=42,H_=113,Fb=666,$_=(e,r)=>(e.msg=z_[r],r),T7=e=>2*e-(e>4?9:0),xm=e=>{let r=e.length;for(;--r>=0;)e[r]=0},ige=e=>{let r,i,o,c=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--r);r=c,o=r;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--r)};let Mm=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const vl=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},Sl=(e,r)=>{zme(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,vl(e.strm)},Gr=(e,r)=>{e.pending_buf[e.pending++]=r},jb=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},_M=(e,r,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=Vb(e.adler,r,c,i):e.state.wrap===2&&(e.adler=wo(e.adler,r,c,i)),e.next_in+=c,e.total_in+=c,c)},b7=(e,r)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-bh?e.strstart-(e.w_size-bh):0,y=e.window,S=e.w_mask,R=e.prev,P=e.strstart+G_;let k=y[u+h-1],z=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=r,y[i+h]===z&&y[i+h-1]===k&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<P);if(o=G_-(P-u),u=P-G_,o>h){if(e.match_start=r,h=o,o>=m)break;k=y[u+h-1],z=y[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},tS=e=>{const r=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-bh)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),ige(e),o+=r),e.strm.avail_in===0)break;if(i=_M(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Mm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Mm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<bh&&e.strm.avail_in!==0)},w7=(e,r)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&r!==mu||r===Lm||i!==o+e.strm.avail_in)))break;h=r===mu&&i===o+e.strm.avail_in?1:0,pM(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,vl(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(_M(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==Lm&&r!==mu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(_M(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===mu)&&r!==Lm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=r===mu&&e.strm.avail_in===0&&i===o?1:0,pM(e,e.block_start,i,h),e.block_start+=i,vl(e.strm)),h?3:1)},EM=(e,r)=>{let i,o;for(;;){if(e.lookahead<bh){if(tS(e),e.lookahead<bh&&r===Lm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Mm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-bh&&(e.match_length=b7(e,i)),e.match_length>=3)if(o=Dm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Mm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Mm(e,e.ins_h,e.window[e.strstart+1]);else o=Dm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Sl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===mu?(Sl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Sl(e,!1),e.strm.avail_out===0)?1:2},nS=(e,r)=>{let i,o,c;for(;;){if(e.lookahead<bh){if(tS(e),e.lookahead<bh&&r===Lm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Mm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-bh&&(e.match_length=b7(e,i),e.match_length<=5&&(e.strategy===Yme||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=Dm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Mm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Sl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=Dm(e,0,e.window[e.strstart-1]),o&&Sl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=Dm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===mu?(Sl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Sl(e,!1),e.strm.avail_out===0)?1:2};function wh(e,r,i,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=c}const Bb=[new wh(0,0,0,0,w7),new wh(4,4,8,4,EM),new wh(4,5,16,8,EM),new wh(4,6,32,32,EM),new wh(4,4,16,16,nS),new wh(8,16,32,32,nS),new wh(8,16,128,128,nS),new wh(8,32,128,256,nS),new wh(32,128,258,1024,nS),new wh(32,258,258,4096,nS)];function sge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=NP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nge),this.dyn_dtree=new Uint16Array(2*(2*ege+1)),this.bl_tree=new Uint16Array(2*(2*tge+1)),xm(this.dyn_ltree),xm(this.dyn_dtree),xm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rge+1),this.heap=new Uint16Array(2*gM+1),xm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*gM+1),xm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Wb=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==eS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==H_&&r.status!==Fb?1:0},R7=e=>{if(Wb(e))return $_(e,Th);e.total_in=e.total_out=0,e.data_type=Zme;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?eS:H_,e.adler=r.wrap===2?0:1,r.last_flush=-2,Wme(r),Yo},C7=e=>{const r=R7(e);return r===Yo&&(i=>{i.window_size=2*i.w_size,xm(i.head),i.max_lazy_match=Bb[i.level].max_lazy,i.good_match=Bb[i.level].good_length,i.nice_match=Bb[i.level].nice_length,i.max_chain_length=Bb[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},I7=(e,r,i,o,c,u)=>{if(!e)return Th;let h=1;if(r===qme&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==NP||o<8||o>15||r<0||r>9||u<0||u>Jme||o===8&&h!==1)return $_(e,Th);o===8&&(o=9);const m=new sge;return e.state=m,m.strm=e,m.status=eS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=i,C7(e)};var oge=(e,r)=>{if(Wb(e)||r>v7||r<0)return e?$_(e,Th):Th;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===Fb&&r!==mu)return $_(e,e.avail_out===0?mM:Th);const o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(vl(e),e.avail_out===0)return i.last_flush=-1,Yo}else if(e.avail_in===0&&T7(r)<=T7(o)&&r!==mu)return $_(e,mM);if(i.status===Fb&&e.avail_in!==0)return $_(e,mM);if(i.status===eS&&i.wrap===0&&(i.status=H_),i.status===eS){let c=NP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=kP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,jb(i,c),i.strstart!==0&&(jb(i,e.adler>>>16),jb(i,65535&e.adler)),e.adler=1,i.status=H_,vl(e),i.pending!==0)return i.last_flush=-1,Yo}if(i.status===57){if(e.adler=0,Gr(i,31),Gr(i,139),Gr(i,8),i.gzhead)Gr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Gr(i,255&i.gzhead.time),Gr(i,i.gzhead.time>>8&255),Gr(i,i.gzhead.time>>16&255),Gr(i,i.gzhead.time>>24&255),Gr(i,i.level===9?2:i.strategy>=kP||i.level<2?4:0),Gr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Gr(i,255&i.gzhead.extra.length),Gr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=wo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,0),Gr(i,i.level===9?2:i.strategy>=kP||i.level<2?4:0),Gr(i,3),i.status=H_,vl(e),i.pending!==0)return i.last_flush=-1,Yo}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=wo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,vl(e),i.pending!==0)return i.last_flush=-1,Yo;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=wo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=wo(e.adler,i.pending_buf,i.pending-u,u)),vl(e),i.pending!==0)return i.last_flush=-1,Yo;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=wo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=wo(e.adler,i.pending_buf,i.pending-u,u)),vl(e),i.pending!==0)return i.last_flush=-1,Yo;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Gr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=wo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(vl(e),i.pending!==0))return i.last_flush=-1,Yo;Gr(i,255&e.adler),Gr(i,e.adler>>8&255),e.adler=0}if(i.status=H_,vl(e),i.pending!==0)return i.last_flush=-1,Yo}if(e.avail_in!==0||i.lookahead!==0||r!==Lm&&i.status!==Fb){let c=i.level===0?w7(i,r):i.strategy===kP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(tS(u),u.lookahead===0)){if(h===Lm)return 1;break}if(u.match_length=0,m=Dm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Sl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===mu?(Sl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Sl(u,!1),u.strm.avail_out===0)?1:2})(i,r):i.strategy===Xme?((u,h)=>{let m,_,y,S;const R=u.window;for(;;){if(u.lookahead<=G_){if(tS(u),u.lookahead<=G_&&h===Lm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=R[y],_===R[++y]&&_===R[++y]&&_===R[++y])){S=u.strstart+G_;do;while(_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&_===R[++y]&&y<S);u.match_length=G_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Dm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Dm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Sl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===mu?(Sl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Sl(u,!1),u.strm.avail_out===0)?1:2})(i,r):Bb[i.level].func(i,r);if(c!==3&&c!==4||(i.status=Fb),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Yo;if(c===2&&(r===Hme?Gme(i):r!==v7&&(pM(i,0,0,!1),r===$me&&(xm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),vl(e),e.avail_out===0))return i.last_flush=-1,Yo}return r!==mu?Yo:i.wrap<=0?S7:(i.wrap===2?(Gr(i,255&e.adler),Gr(i,e.adler>>8&255),Gr(i,e.adler>>16&255),Gr(i,e.adler>>24&255),Gr(i,255&e.total_in),Gr(i,e.total_in>>8&255),Gr(i,e.total_in>>16&255),Gr(i,e.total_in>>24&255)):(jb(i,e.adler>>>16),jb(i,65535&e.adler)),vl(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Yo:S7)},age=(e,r)=>{let i=r.length;if(Wb(e))return Th;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==eS||o.lookahead)return Th;if(c===1&&(e.adler=Vb(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){c===0&&(xm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(i-o.w_size,i),0),r=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,tS(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=Mm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,tS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,Yo},zb={deflateInit:(e,r)=>I7(e,r,NP,15,8,Qme),deflateInit2:I7,deflateReset:C7,deflateResetKeep:R7,deflateSetHeader:(e,r)=>Wb(e)||e.state.wrap!==2?Th:(e.state.gzhead=r,Yo),deflate:oge,deflateEnd:e=>{if(Wb(e))return Th;const r=e.state.status;return e.state=null,r===H_?$_(e,Kme):Yo},deflateSetDictionary:age,deflateInfo:"pako deflate (from Nodeca project)"};const cge=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var DP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)cge(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const i=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let A7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{A7=!1}const Gb=new Uint8Array(256);for(let e=0;e<256;e++)Gb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Gb[254]=Gb[254]=1;var Hb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?r[u++]=i:i<2048?(r[u++]=192|i>>>6,r[u++]=128|63&i):i<65536?(r[u++]=224|i>>>12,r[u++]=128|i>>>6&63,r[u++]=128|63&i):(r[u++]=240|i>>>18,r[u++]=128|i>>>12&63,r[u++]=128|i>>>6&63,r[u++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=Gb[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&A7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+Gb[e[i]]>r?i:r}},P7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const O7=Object.prototype.toString,{Z_NO_FLUSH:lge,Z_SYNC_FLUSH:uge,Z_FULL_FLUSH:dge,Z_FINISH:hge,Z_OK:LP,Z_STREAM_END:fge,Z_DEFAULT_COMPRESSION:pge,Z_DEFAULT_STRATEGY:mge,Z_DEFLATED:gge}=OP;function xP(e){this.options=DP.assign({level:pge,method:gge,chunkSize:16384,windowBits:15,memLevel:8,strategy:mge},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new P7,this.strm.avail_out=0;let i=zb.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==LP)throw new Error(z_[i]);if(r.header&&zb.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?Hb.string2buf(r.dictionary):O7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=zb.deflateSetDictionary(this.strm,o),i!==LP)throw new Error(z_[i]);this._dict_set=!0}}function _ge(e,r){const i=new xP(r);if(i.push(e,!0),i.err)throw i.msg||z_[i.err];return i.result}xP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?hge:lge,typeof e=="string"?i.input=Hb.string2buf(e):O7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===uge||u===dge)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=zb.deflate(i,u),c===fge)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=zb.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===LP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},xP.prototype.onData=function(e){this.chunks.push(e)},xP.prototype.onEnd=function(e){e===LP&&(this.result=DP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ege={deflate:_ge};const MP=16209;var yge=function(e,r){let i,o,c,u,h,m,_,y,S,R,P,k,z,U,V,q,Y,le,ge,Ee,pe,Pe,Ke,lt;const ht=e.state;i=e.next_in,Ke=e.input,o=i+(e.avail_in-5),c=e.next_out,lt=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=ht.dmax,_=ht.wsize,y=ht.whave,S=ht.wnext,R=ht.window,P=ht.hold,k=ht.bits,z=ht.lencode,U=ht.distcode,V=(1<<ht.lenbits)-1,q=(1<<ht.distbits)-1;e:do{k<15&&(P+=Ke[i++]<<k,k+=8,P+=Ke[i++]<<k,k+=8),Y=z[P&V];t:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,le===0)lt[c++]=65535&Y;else{if(!(16&le)){if((64&le)==0){Y=z[(65535&Y)+(P&(1<<le)-1)];continue t}if(32&le){ht.mode=16191;break e}e.msg="invalid literal/length code",ht.mode=MP;break e}ge=65535&Y,le&=15,le&&(k<le&&(P+=Ke[i++]<<k,k+=8),ge+=P&(1<<le)-1,P>>>=le,k-=le),k<15&&(P+=Ke[i++]<<k,k+=8,P+=Ke[i++]<<k,k+=8),Y=U[P&q];n:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,!(16&le)){if((64&le)==0){Y=U[(65535&Y)+(P&(1<<le)-1)];continue n}e.msg="invalid distance code",ht.mode=MP;break e}if(Ee=65535&Y,le&=15,k<le&&(P+=Ke[i++]<<k,k+=8,k<le&&(P+=Ke[i++]<<k,k+=8)),Ee+=P&(1<<le)-1,Ee>m){e.msg="invalid distance too far back",ht.mode=MP;break e}if(P>>>=le,k-=le,le=c-u,Ee>le){if(le=Ee-le,le>y&&ht.sane){e.msg="invalid distance too far back",ht.mode=MP;break e}if(pe=0,Pe=R,S===0){if(pe+=_-le,le<ge){ge-=le;do lt[c++]=R[pe++];while(--le);pe=c-Ee,Pe=lt}}else if(S<le){if(pe+=_+S-le,le-=S,le<ge){ge-=le;do lt[c++]=R[pe++];while(--le);if(pe=0,S<ge){le=S,ge-=le;do lt[c++]=R[pe++];while(--le);pe=c-Ee,Pe=lt}}}else if(pe+=S-le,le<ge){ge-=le;do lt[c++]=R[pe++];while(--le);pe=c-Ee,Pe=lt}for(;ge>2;)lt[c++]=Pe[pe++],lt[c++]=Pe[pe++],lt[c++]=Pe[pe++],ge-=3;ge&&(lt[c++]=Pe[pe++],ge>1&&(lt[c++]=Pe[pe++]))}else{pe=c-Ee;do lt[c++]=lt[pe++],lt[c++]=lt[pe++],lt[c++]=lt[pe++],ge-=3;while(ge>2);ge&&(lt[c++]=lt[pe++],ge>1&&(lt[c++]=lt[pe++]))}break}}break}}while(i<o&&c<h);ge=k>>3,i-=ge,k-=ge<<3,P&=(1<<k)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),ht.hold=P,ht.bits=k};const UP=15,vge=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Sge=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Tge=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bge=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var $b=(e,r,i,o,c,u,h,m)=>{const _=m.bits;let y,S,R,P,k,z,U=0,V=0,q=0,Y=0,le=0,ge=0,Ee=0,pe=0,Pe=0,Ke=0,lt=null;const ht=new Uint16Array(16),Sn=new Uint16Array(16);let Tn,cr,Qr,Br=null;for(U=0;U<=UP;U++)ht[U]=0;for(V=0;V<o;V++)ht[r[i+V]]++;for(le=_,Y=UP;Y>=1&&ht[Y]===0;Y--);if(le>Y&&(le=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&ht[q]===0;q++);for(le<q&&(le=q),pe=1,U=1;U<=UP;U++)if(pe<<=1,pe-=ht[U],pe<0)return-1;if(pe>0&&(e===0||Y!==1))return-1;for(Sn[1]=0,U=1;U<UP;U++)Sn[U+1]=Sn[U]+ht[U];for(V=0;V<o;V++)r[i+V]!==0&&(h[Sn[r[i+V]]++]=V);if(e===0?(lt=Br=h,z=20):e===1?(lt=vge,Br=Sge,z=257):(lt=Tge,Br=bge,z=0),Ke=0,V=0,U=q,k=u,ge=le,Ee=0,R=-1,Pe=1<<le,P=Pe-1,e===1&&Pe>852||e===2&&Pe>592)return 1;for(;;){Tn=U-Ee,h[V]+1<z?(cr=0,Qr=h[V]):h[V]>=z?(cr=Br[h[V]-z],Qr=lt[h[V]-z]):(cr=96,Qr=0),y=1<<U-Ee,S=1<<ge,q=S;do S-=y,c[k+(Ke>>Ee)+S]=Tn<<24|cr<<16|Qr|0;while(S!==0);for(y=1<<U-1;Ke&y;)y>>=1;if(y!==0?(Ke&=y-1,Ke+=y):Ke=0,V++,--ht[U]==0){if(U===Y)break;U=r[i+h[V]]}if(U>le&&(Ke&P)!==R){for(Ee===0&&(Ee=le),k+=q,ge=U-Ee,pe=1<<ge;ge+Ee<Y&&(pe-=ht[ge+Ee],!(pe<=0));)ge++,pe<<=1;if(Pe+=1<<ge,e===1&&Pe>852||e===2&&Pe>592)return 1;R=Ke&P,c[R]=le<<24|ge<<16|k-u|0}}return Ke!==0&&(c[k+Ke]=U-Ee<<24|64<<16|0),m.bits=le,0};const{Z_FINISH:k7,Z_BLOCK:wge,Z_TREES:VP,Z_OK:K_,Z_STREAM_END:Rge,Z_NEED_DICT:Cge,Z_STREAM_ERROR:gu,Z_DATA_ERROR:N7,Z_MEM_ERROR:D7,Z_BUF_ERROR:Ige,Z_DEFLATED:L7}=OP,FP=16180,jP=16190,ep=16191,yM=16192,vM=16194,BP=16199,WP=16200,SM=16206,Xi=16209,x7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Age(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const q_=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<FP||r.mode>16211?1:0},M7=e=>{if(q_(e))return gu;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=FP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,K_},U7=e=>{if(q_(e))return gu;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,M7(e)},V7=(e,r)=>{let i;if(q_(e))return gu;const o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?gu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,U7(e))},F7=(e,r)=>{if(!e)return gu;const i=new Age;e.state=i,i.strm=e,i.window=null,i.mode=FP;const o=V7(e,r);return o!==K_&&(e.state=null),o};let TM,bM,j7=!0;const Pge=e=>{if(j7){TM=new Int32Array(512),bM=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for($b(1,e.lens,0,288,TM,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;$b(2,e.lens,0,32,bM,0,e.work,{bits:5}),j7=!1}e.lencode=TM,e.lenbits=9,e.distcode=bM,e.distbits=5},B7=(e,r,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Oge=(e,r)=>{let i,o,c,u,h,m,_,y,S,R,P,k,z,U,V,q,Y,le,ge,Ee,pe,Pe,Ke=0;const lt=new Uint8Array(4);let ht,Sn;const Tn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(q_(e)||!e.output||!e.input&&e.avail_in!==0)return gu;i=e.state,i.mode===ep&&(i.mode=yM),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,R=m,P=_,Pe=K_;e:for(;;)switch(i.mode){case FP:if(i.wrap===0){i.mode=yM;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,lt[0]=255&y,lt[1]=y>>>8&255,i.check=wo(i.check,lt,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=Xi;break}if((15&y)!==L7){e.msg="unknown compression method",i.mode=Xi;break}if(y>>>=4,S-=4,pe=8+(15&y),i.wbits===0&&(i.wbits=pe),pe>15||pe>i.wbits){e.msg="invalid window size",i.mode=Xi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:ep,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&ro(i))!==L7){e.msg="unknown compression method",i.mode=Xi;break}if(57344&ro(i)){e.msg="unknown header flags set",i.mode=Xi;break}i.head&&(i.head.text=y>>8&1),512&ro(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=wo(i.check,lt,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&ro(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,lt[2]=y>>>16&255,lt[3]=y>>>24&255,i.check=wo(i.check,lt,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&ro(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=wo(i.check,lt,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&ro(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&ro(i)&&4&i.wrap&&(lt[0]=255&y,lt[1]=y>>>8&255,i.check=wo(i.check,lt,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&ro(i)&&(k=i.length,k>m&&(k=m),k&&(i.head&&(pe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+k),pe)),512&ro(i)&&4&i.wrap&&(i.check=wo(i.check,o,k,u)),m-=k,u+=k,i.length-=k),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&ro(i)){if(m===0)break e;k=0;do pe=o[u+k++],i.head&&pe&&i.length<65536&&(i.head.name+=String.fromCharCode(pe));while(pe&&k<m);if(512&ro(i)&&4&i.wrap&&(i.check=wo(i.check,o,k,u)),m-=k,u+=k,pe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&ro(i)){if(m===0)break e;k=0;do pe=o[u+k++],i.head&&pe&&i.length<65536&&(i.head.comment+=String.fromCharCode(pe));while(pe&&k<m);if(512&ro(i)&&4&i.wrap&&(i.check=wo(i.check,o,k,u)),m-=k,u+=k,pe)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&ro(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Xi;break}y=0,S=0}i.head&&(i.head.hcrc=ro(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=ep;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=x7(y),y=0,S=0,i.mode=jP;case jP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Cge;e.adler=i.check=1,i.mode=ep;case ep:if(r===wge||r===VP)break e;case yM:if(i.last){y>>>=7&S,S-=7&S,i.mode=SM;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(Pge(i),i.mode=BP,r===VP){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Xi}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Xi;break}if(i.length=65535&y,y=0,S=0,i.mode=vM,r===VP)break e;case vM:i.mode=16195;case 16195:if(k=i.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,i.length-=k;break}i.mode=ep;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Xi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[Tn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[Tn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ht={bits:i.lenbits},Pe=$b(0,i.lens,0,19,i.lencode,0,i.work,ht),i.lenbits=ht.bits,Pe){e.msg="invalid code lengths set",i.mode=Xi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ke=i.lencode[y&(1<<i.lenbits)-1],V=Ke>>>24,q=Ke>>>16&255,Y=65535&Ke,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(Y<16)y>>>=V,S-=V,i.lens[i.have++]=Y;else{if(Y===16){for(Sn=V+2;S<Sn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=V,S-=V,i.have===0){e.msg="invalid bit length repeat",i.mode=Xi;break}pe=i.lens[i.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(Sn=V+3;S<Sn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,pe=0,k=3+(7&y),y>>>=3,S-=3}else{for(Sn=V+7;S<Sn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,pe=0,k=11+(127&y),y>>>=7,S-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Xi;break}for(;k--;)i.lens[i.have++]=pe}}if(i.mode===Xi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Xi;break}if(i.lenbits=9,ht={bits:i.lenbits},Pe=$b(1,i.lens,0,i.nlen,i.lencode,0,i.work,ht),i.lenbits=ht.bits,Pe){e.msg="invalid literal/lengths set",i.mode=Xi;break}if(i.distbits=6,i.distcode=i.distdyn,ht={bits:i.distbits},Pe=$b(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ht),i.distbits=ht.bits,Pe){e.msg="invalid distances set",i.mode=Xi;break}if(i.mode=BP,r===VP)break e;case BP:i.mode=WP;case WP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,yge(e,P),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===ep&&(i.back=-1);break}for(i.back=0;Ke=i.lencode[y&(1<<i.lenbits)-1],V=Ke>>>24,q=Ke>>>16&255,Y=65535&Ke,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(le=V,ge=q,Ee=Y;Ke=i.lencode[Ee+((y&(1<<le+ge)-1)>>le)],V=Ke>>>24,q=Ke>>>16&255,Y=65535&Ke,!(le+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=le,S-=le,i.back+=le}if(y>>>=V,S-=V,i.back+=V,i.length=Y,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=ep;break}if(64&q){e.msg="invalid literal/length code",i.mode=Xi;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(Sn=i.extra;S<Sn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ke=i.distcode[y&(1<<i.distbits)-1],V=Ke>>>24,q=Ke>>>16&255,Y=65535&Ke,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(le=V,ge=q,Ee=Y;Ke=i.distcode[Ee+((y&(1<<le+ge)-1)>>le)],V=Ke>>>24,q=Ke>>>16&255,Y=65535&Ke,!(le+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=le,S-=le,i.back+=le}if(y>>>=V,S-=V,i.back+=V,64&q){e.msg="invalid distance code",i.mode=Xi;break}i.offset=Y,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(Sn=i.extra;S<Sn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Xi;break}i.mode=16204;case 16204:if(_===0)break e;if(k=P-_,i.offset>k){if(k=i.offset-k,k>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Xi;break}k>i.wnext?(k-=i.wnext,z=i.wsize-k):z=i.wnext-k,k>i.length&&(k=i.length),U=i.window}else U=c,z=h-i.offset,k=i.length;k>_&&(k=_),_-=k,i.length-=k;do c[h++]=U[z++];while(--k);i.length===0&&(i.mode=WP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=WP;break;case SM:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(P-=_,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=ro(i)?wo(i.check,c,P,h-P):Vb(i.check,c,P,h-P)),P=_,4&i.wrap&&(ro(i)?y:x7(y))!==i.check){e.msg="incorrect data check",i.mode=Xi;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&ro(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Xi;break}y=0,S=0}i.mode=16208;case 16208:Pe=Rge;break e;case Xi:Pe=N7;break e;case 16210:return D7;default:return gu}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||P!==e.avail_out&&i.mode<Xi&&(i.mode<SM||r!==k7))&&B7(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,i.total+=P,4&i.wrap&&P&&(e.adler=i.check=ro(i)?wo(i.check,c,P,e.next_out-P):Vb(i.check,c,P,e.next_out-P)),e.data_type=i.bits+(i.last?64:0)+(i.mode===ep?128:0)+(i.mode===BP||i.mode===vM?256:0),(R===0&&P===0||r===k7)&&Pe===K_&&(Pe=Ige),Pe},tp={inflateReset:U7,inflateReset2:V7,inflateResetKeep:M7,inflateInit:e=>F7(e,15),inflateInit2:F7,inflate:Oge,inflateEnd:e=>{if(q_(e))return gu;let r=e.state;return r.window&&(r.window=null),e.state=null,K_},inflateGetHeader:(e,r)=>{if(q_(e))return gu;const i=e.state;return(2&i.wrap)==0?gu:(i.head=r,r.done=!1,K_)},inflateSetDictionary:(e,r)=>{const i=r.length;let o,c,u;return q_(e)?gu:(o=e.state,o.wrap!==0&&o.mode!==jP?gu:o.mode===jP&&(c=1,c=Vb(c,r,i,0),c!==o.check)?N7:(u=B7(e,r,i,i),u?(o.mode=16210,D7):(o.havedict=1,K_)))},inflateInfo:"pako inflate (from Nodeca project)"},kge=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const W7=Object.prototype.toString,{Z_NO_FLUSH:Nge,Z_FINISH:Dge,Z_OK:Kb,Z_STREAM_END:wM,Z_NEED_DICT:RM,Z_STREAM_ERROR:Lge,Z_DATA_ERROR:z7,Z_MEM_ERROR:xge}=OP;function zP(e){this.options=DP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new P7,this.strm.avail_out=0;let i=tp.inflateInit2(this.strm,r.windowBits);if(i!==Kb)throw new Error(z_[i]);if(this.header=new kge,tp.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Hb.string2buf(r.dictionary):W7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=tp.inflateSetDictionary(this.strm,r.dictionary),i!==Kb)))throw new Error(z_[i])}function Mge(e,r){const i=new zP(r);if(i.push(e),i.err)throw i.msg||z_[i.err];return i.result}zP.prototype.push=function(e,r){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Dge:Nge,W7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=tp.inflate(i,h),u===RM&&c&&(u=tp.inflateSetDictionary(i,c),u===Kb?u=tp.inflate(i,h):u===z7&&(u=RM));i.avail_in>0&&u===wM&&i.state.wrap>0&&e[i.next_in]!==0;)tp.inflateReset(i),u=tp.inflate(i,h);switch(u){case Lge:case z7:case RM:case xge:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===wM))if(this.options.to==="string"){let _=Hb.utf8border(i.output,i.next_out),y=i.next_out-_,S=Hb.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==Kb||m!==0){if(u===wM)return u=tp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},zP.prototype.onData=function(e){this.chunks.push(e)},zP.prototype.onEnd=function(e){e===Kb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=DP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Uge={inflate:Mge};const{deflate:Vge}=Ege,{inflate:Fge}=Uge;var jge=Vge,Bge=Fge,G7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(G7||{});class Wge{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:i,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const i=new DataView(r);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===G7.TWO_BYTE,m=[],_=new DataView(r,2);let y=0;for(;y<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,R=_.getUint8(y),y++):(S=15&_.getUint8(y),R=_.getUint8(y)>>4,y++),R>0&&(P=_.buffer.slice(y+2,y+2+R),y+=P.byteLength),m.push({id:S,length:R,data:P})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Bge(new Uint8Array(r))}compress(r){return jge(new Uint8Array(r))}}const zge={name:"DataStream",create:(e,r)=>{const i=r?new Xfe(e):new Jfe(e);return i.useDataStream(new Wge),i}};class Gge extends Ar{constructor(r,i,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=i,this.ws=new yb("cross-channel-".concat(this.clientId),o),this.ws.on(Yt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Yt.CONNECTED,this.onOpen),this.ws.on(Yt.ON_MESSAGE,this.onMessage),this.ws.on(Yt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new ct((i,o)=>{const c=window.setTimeout(()=>{o(new Re(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Re(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Re(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Re(X.WS_DISCONNECT);const i=()=>new ct((h,m)=>{this.ws.once(Yt.CLOSED,()=>m(new Re(X.WS_ABORT))),this.ws.once(Yt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(r),c=new ct((h,m)=>{const _=()=>{m(new Re(X.WS_ABORT))};this.ws.once(Yt.RECONNECTING,_),this.ws.once(Yt.CLOSED,_),this.once("req_".concat(o),h),ns(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Yt.RECONNECTING,_),this.ws.off(Yt.CLOSED,_),m(new Re(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Re(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Yt.REQUEST_NEW_URLS),this.ws.on(Yt.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Hge extends Ar{set state(r){r!==this._state&&(r!==va.RELAY_STATE_FAILURE&&(this.errorCode=jv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",Go.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",va.RELAY_STATE_IDLE),$(this,"errorCode",jv.RELAY_OK),$(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",qf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",qf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=jv.SRC_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=jv.DEST_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",qf.NETWORK_DISCONNECTED),this.state=va.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==va.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=jv.SERVER_CONNECTION_LOST,this.state=va.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=C_(),this.signal=new Gge(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==va.RELAY_STATE_IDLE)throw new Re(X.INVALID_OPERATION);this.state=va.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Re(X.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Re(X.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Re(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==va.RELAY_STATE_RUNNING)throw new Re(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==va.RELAY_STATE_RUNNING)throw new Re(X.INVALID_OPERATION);const i=this.genMessage(bo.SetVideoProfile);await this.signal.request(i),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=va.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Go.CancelToken.source(),this.state=va.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await tme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",qf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(bo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(bo.SetSdkProfile,r);await this.signal.request(o),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(bo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",qf.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(bo.SetSourceUserId,r);await this.signal.request(u),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(bo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",qf.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(bo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",qf.PACKET_SENT_TO_DEST_CHANNEL),this.state=va.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(bo.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",qf.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(bo.StopPacketTransfer);await this.signal.request(r),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ml,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case bo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case bo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Re(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case bo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Re(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case bo.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Re(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case bo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case bo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case bo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case bo.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Re(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case bo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const $ge={name:"ChannelMediaRelay",create:function(e){return new Hge(e.joinInfo,e.clientId,e.websocketRetryConfig||_i,e.httpRetryConfig||_i,e.resolution)}};function H7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function qb(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?H7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):H7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Kge extends Ar{constructor(r,i,o,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Kf.TRANSCODE?1:2}),this.emit(bm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=r,this.serviceMode=c,this.websocket=new yb("live-streaming",o),this.websocket.on(Yt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Yt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Yt.REQUEST_NEW_URLS,(u,h)=>{Es(this,bm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Yt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Re(X.UNEXPECTED_ERROR);const m=qb({command:r,sdkVersion:ml==="4.23.2"?"0.0.1":ml,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Re(X.WS_DISCONNECT);const _=()=>new ct((P,k)=>{this.websocket.once(Yt.CLOSED,()=>k(new Re(X.WS_ABORT))),this.websocket.once(Yt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new ct((P,k)=>{const z=()=>{k(new Re(X.WS_ABORT))};this.websocket.once(Yt.RECONNECTING,z),this.websocket.once(Yt.CLOSED,z),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&wt.workerEvent(this.spec.sid,qb(qb({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await y}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,i,o)}return c&&wt.workerEvent(this.spec.sid,qb(qb({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=ml==="4.23.2"?"0.0.1":ml;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case bi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case bi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case bi.LIVE_STREAM_RESPONSE_BAD_STREAM:case bi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Re(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Re(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Re(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(bm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Re(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(bm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Re(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Re(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(bm.WARNING,i,r.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case bi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Re(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(OA)},6e3)}}function $7(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sa(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?$7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class qge extends Ar{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_i,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:_i;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new Cs("live-streaming")),$(this,"cancelToken",Go.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=Sa(Sa({},Lpe),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Sa(Sa(Sa({},Dpe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Dr(h.width)||tr(h.width,"config.width",0,1e4),Dr(h.height)||tr(h.height,"config.height",0,1e4),Dr(h.videoBitrate)||tr(h.videoBitrate,"config.videoBitrate",1,1e6),Dr(h.videoFrameRate)||tr(h.videoFrameRate,"config.videoFrameRate"),Dr(h.lowLatency)||zf(h.lowLatency,"config.lowLatency"),Dr(h.audioSampleRate)||Ii(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Dr(h.audioBitrate)||tr(h.audioBitrate,"config.audioBitrate",1,128),Dr(h.audioChannels)||Ii(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Dr(h.videoGop)||tr(h.videoGop,"config.videoGop"),Dr(h.videoCodecProfile)||Ii(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Dr(h.userCount)||tr(h.userCount,"config.userCount",0,17),Dr(h.backgroundColor)||tr(h.backgroundColor,"config.backgroundColor",0,16777215),Dr(h.userConfigExtraInfo)||ts(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Dr(h.transcodingUsers)&&(Gf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{eP(m.uid),Dr(m.x)||tr(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Dr(m.y)||tr(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Dr(m.width)||tr(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Dr(m.height)||tr(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Dr(m.zOrder)||tr(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Dr(m.alpha)||tr(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Dr(h.watermark)||Ix(h.watermark,"watermark"),Dr(h.backgroundImage)||Ix(h.backgroundImage,"backgroundImage"),h.images&&!Dr(h.images)&&(Gf(h.images,"config.images"),h.images.forEach((m,_)=>{Ix(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Sa(Sa(Sa({},Cx),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Sa(Sa(Sa({},Cx),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Sa(Sa(Sa({},Cx),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Sa({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?ct.resolve(h.uid):pH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ct.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Pc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===Kf.TRANSCODE)throw new Re(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Re(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Kf.TRANSCODE:c.transcodingConfig=Sa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ct((y,S)=>{ns(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await ct.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:i===Kf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:i,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,m)):await this.startLiveStreamingTask(r,i,m)}}stopLiveStreamingTask(r){return new ct((i,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Re(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===Kf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;const i=Array.from(Pc(r=this.streamingTasks).call(r));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Go.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Re(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await Es(this,Ax.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new Kge(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(bm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(bm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(bm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Re(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));Es(this,Ax.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=r.reason;switch(r.code){case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Re(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Re(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Pc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Re(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{D.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Yge={name:"LiveStreaming",create:function(e){return new qge(e.joinInfo,e.websocketRetryConfig||_i,e.httpRetryConfig||_i)}};function Xge(e){let r=Y7();return function(i,o){let c=i.appId;c!==void 0&&(qn(o,10),Rh(o,c));let u=i.cid;u!==void 0&&(qn(o,16),qn(o,u));let h=i.cname;h!==void 0&&(qn(o,26),Rh(o,h));let m=i.deviceId;m!==void 0&&(qn(o,34),Rh(o,m));let _=i.elapse;_!==void 0&&(qn(o,40),Um(o,_));let y=i.fileSize;y!==void 0&&(qn(o,48),Um(o,rS(y)));let S=i.height;S!==void 0&&(qn(o,56),Um(o,rS(S)));let R=i.jpg;R!==void 0&&(qn(o,66),qn(o,R.length),function(Xo,je){let rt=iS(Xo,je.length);Xo.bytes.set(je,rt)}(o,R));let P=i.networkType;P!==void 0&&(qn(o,72),Um(o,rS(P)));let k=i.osType;k!==void 0&&(qn(o,80),Um(o,rS(k)));let z=i.requestId;z!==void 0&&(qn(o,90),Rh(o,z));let U=i.sdkVersion;U!==void 0&&(qn(o,98),Rh(o,U));let V=i.sequence;V!==void 0&&(qn(o,104),Um(o,rS(V)));let q=i.sid;q!==void 0&&(qn(o,114),Rh(o,q));let Y=i.timestamp;Y!==void 0&&(qn(o,120),Um(o,Y));let le=i.uid;le!==void 0&&(qn(o,128),qn(o,le));let ge=i.vid;ge!==void 0&&(qn(o,136),qn(o,ge));let Ee=i.width;Ee!==void 0&&(qn(o,144),Um(o,rS(Ee)));let pe=i.service;pe!==void 0&&(qn(o,152),qn(o,pe));let Pe=i.callbackData;Pe!==void 0&&(qn(o,162),Rh(o,Pe));let Ke=i.jpgEncryption;Ke!==void 0&&(qn(o,168),qn(o,Ke));let lt=i.requestType;lt!==void 0&&(qn(o,176),qn(o,lt));let ht=i.scorePorn;ht!==void 0&&(qn(o,185),OM(o,ht));let Sn=i.scoreSexy;Sn!==void 0&&(qn(o,193),OM(o,Sn));let Tn=i.scoreNeutral;Tn!==void 0&&(qn(o,201),OM(o,Tn));let cr=i.scene;cr!==void 0&&(qn(o,208),qn(o,cr));let Qr=i.ossFilePrefix;Qr!==void 0&&(qn(o,218),Rh(o,Qr));let Br=i.serviceVendor;if(Br!==void 0)for(let Xo of Br){qn(o,226);let je=Y7();Zge(Xo,je),qn(o,je.limit),r_e(o,je),n_e(je)}}(e,r),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Jge(e){return function(i){let o={};e:for(;!X7(i);){let c=Ch(i);switch(c>>>3){case 0:break e;case 1:o.code=Ch(i);break;case 2:o.msg=J7(i,Ch(i));break;case 3:{let u=e_e(i);o.data=Qge(i),i.limit=u;break}default:K7(i,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function Qge(e){let r={};e:for(;!X7(e);){let i=Ch(e);switch(i>>>3){case 0:break e;case 1:r.requestId=J7(e,Ch(e));break;case 2:r.requestType=Ch(e)>>>0;break;case 3:r.scorePorn=PM(e);break;case 4:r.scoreSexy=PM(e);break;case 5:r.scoreNeutral=PM(e);break;case 6:r.requestScene=Ch(e)>>>0;break;case 7:r.scene=Ch(e)>>>0;break;default:K7(e,7&i)}}return r}function Zge(e,r){let i=e.service;i!==void 0&&(qn(r,8),qn(r,i));let o=e.vendor;o!==void 0&&(qn(r,16),qn(r,o));let c=e.token;c!==void 0&&(qn(r,26),Rh(r,c));let u=e.callbackUrl;u!==void 0&&(qn(r,34),Rh(r,u))}function e_e(e){let r=Ch(e),i=e.limit;return e.limit=e.offset+r,i}function K7(e,r){switch(r){case 0:for(;128&Q7(e););break;case 2:IM(e,Ch(e));break;case 5:IM(e,4);break;case 1:IM(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let t_e=new Float32Array(1);new Uint8Array(t_e.buffer);let CM=new Float64Array(1),Ta=new Uint8Array(CM.buffer);function rS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let q7=[];function Y7(){const e=q7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function n_e(e){q7.push(e)}function IM(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function X7(e){return e.offset>=e.limit}function iS(e,r){let i=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function AM(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function J7(e,r){let i=AM(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let _,y,S,R,P=c[m+i];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&y,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&y)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Rh(e,r){let i=r.length,o=0;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}qn(e,o);let c=iS(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function r_e(e,r){let i=iS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+i]=c[u]}function Q7(e){return e.bytes[AM(e,1)]}function Z7(e,r){let i=iS(e,1);e.bytes[i]=r}function PM(e){let r=AM(e,8),i=e.bytes;return Ta[0]=i[r++],Ta[1]=i[r++],Ta[2]=i[r++],Ta[3]=i[r++],Ta[4]=i[r++],Ta[5]=i[r++],Ta[6]=i[r++],Ta[7]=i[r++],CM[0]}function OM(e,r){let i=iS(e,8),o=e.bytes;CM[0]=r,o[i++]=Ta[0],o[i++]=Ta[1],o[i++]=Ta[2],o[i++]=Ta[3],o[i++]=Ta[4],o[i++]=Ta[5],o[i++]=Ta[6],o[i++]=Ta[7]}function Ch(e){let r,i=0,o=0;do r=Q7(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function qn(e,r){for(r>>>=0;r>=128;)Z7(e,127&r|128),r>>>=7;Z7(e,r)}function Um(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=iS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function e$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const i_e=new Map([["moderation",1],["supervise",2]]);class s_e extends Ar{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(Yi.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=za(i=r.map(o=>i_e.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",uu.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Go.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==uu.CONNECTED)throw new Re(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===uu.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=or(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new yb("worker-manager-"+this._inspectId,_i),this.on(Yi.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(du[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new yb("worker-"+this._inspectId,_i),this.handleWorkerEvents()}async init(r,i){this.emit(Yi.STATE_CHANGE,du.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=i,new ct((c,u)=>{this.on(Yi.CONNECTION_STATE_CHANGE,(h,m)=>{m===uu.CONNECTED&&c()}),this.requestAP(r,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,i,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:R,areaCode:P,cname:k,sid:z,token:U,uid:V}=_;Kv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:Kv,seq:Kv,sid:z,token:U,ts:Date.now(),uid:V+""})};let le,ge,Ee=m[0];return ud(async()=>{le=Date.now();const pe=await md(Ee,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ge=Date.now()-le,pe.code!==0){const ht=new Re(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+pe.code,{retry:!0,responseTime:ge});throw D.error(ht.toString()),ht}const Pe=JSON.parse(pe.json_body);if(Pe.code!==200){const ht=new Re(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Pe.code,", reason: ").concat(Pe.reason),{code:Pe.code,responseTime:ge});throw D.error(ht.toString()),ht}if(!Pe.servers||!Array.isArray(Pe.servers)||Pe.servers.length===0){const ht=new Re(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Pe.code,responseTime:ge});throw D.error(ht.toString()),ht}const Ke=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),lt=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Pe.servers.map(ht=>{let{address:Sn,wss:Tn}=ht;if(Sn&&Tn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(Ke,":").concat(lt||Tn)}).filter(ht=>!!ht),workerToken:Pe.workerToken,vid:Pe.vid,responseTime:ge}},(pe,Pe)=>(wt.apworkerEvent(z,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(pe.addressList),firstSuccess:Pe===0,responseTime:ge,serverIp:m[Pe%m.length]}),!1),(pe,Pe)=>(wt.apworkerEvent(z,{success:!1,sc:pe.data&&pe.data.code||200,serviceName:q,responseTime:ge,serverIp:m[Pe%m.length]}),!!(pe.code!==X.OPERATION_ABORTED&&pe.code!==X.UNEXPECTED_RESPONSE||pe.data&&pe.data.retry)&&(Ee=m[(Pe+1)%m.length],!0)),S)}(c,r,i,o);this.emit(Yi.STATE_CHANGE,du.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Yi.STATE_CHANGE,du.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Yt.CONNECTED,async()=>{this.emit(Yi.STATE_CHANGE,du.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Yt.CLOSED,()=>{this._innerConnectionState<du.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Yt.FAILED,()=>{this._innerConnectionState<du.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Yt.RECONNECTING,()=>{this._innerConnectionState<du.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Yt.ON_MESSAGE,async r=>{this.emit(Yi.STATE_CHANGE,du.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Re(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Re(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Yi.STATE_CHANGE,du.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Yi.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Yt.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(Yt.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Yt.CONNECTED,async()=>{this.emit(Yi.STATE_CHANGE,du.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=uu.CONNECTED}),this.workerConnection.on(Yt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=Jge(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Yi.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=za(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Yi.INSPECT_RESULT,h)}else this.emit(Yi.INSPECT_RESULT,void 0,new Re(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Yi.INSPECT_RESULT,void 0,new Re(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Yi.INSPECT_RESULT,void 0,new Re(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Yt.CLOSED,()=>{this.connectionState=uu.CLOSED}),this.workerConnection.on(Yt.FAILED,()=>{this.connectionState=uu.CLOSED}),this.workerConnection.on(Yt.RECONNECTING,()=>{this.connectionState=this.connectionState===uu.CONNECTED?uu.RECONNECTING:uu.CONNECTING}),this.workerConnection.on(Yt.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Yt.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(Yi.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const r=kc(this,Yi.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(Yi.INSPECT_RESULT,void 0,new Re(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Yi.INSPECT_RESULT,void 0,new Re(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await x8(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(z=Number(y-this.inspectStartTime),{low:z|=0,high:z>>31,unsigned:z>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:c9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var z;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=Xge(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=function(q){for(var Y=1;Y<arguments.length;Y++){var le=arguments[Y]!=null?arguments[Y]:{};Y%2?e$(Object(le),!0).forEach(function(ge){$(q,ge,le[ge])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(le)):e$(Object(le)).forEach(function(ge){Object.defineProperty(q,ge,Object.getOwnPropertyDescriptor(le,ge))})}return q}({},k);delete V.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Go.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=uu.CLOSED,this.emit(Yi.STATE_CHANGE,du.CLOSED)}}const o_e={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new Re(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Re(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Re(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Re(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new s_e(r)}};var t$=l(vt.Object.getOwnPropertySymbols),a_e=Mn,c_e=Vo.indexOf,l_e=gf,kM=ce([].indexOf),n$=!!kM&&1/kM([1],1,-0)<0;a_e({target:"Array",proto:!0,forced:n$||!l_e("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return n$?kM(this,e,r)||0:c_e(this,e,r)}});var u_e=Wa("Array").indexOf,d_e=N,h_e=u_e,NM=Array.prototype,f_e=function(e){var r=e.indexOf;return e===NM||d_e(NM,e)&&r===NM.indexOf?h_e:r},r$=l(f_e);function p_e(e,r){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},R=bG(h);for(y=0;y<R.length;y++)_=R[y],r$(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,r);if(t$){var u=t$(e);for(o=0;o<u.length;o++)i=u[o],r$(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let i$=class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=xr(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===To.RECEIVE_ONLY?ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=u;const R=h===To.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===To.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===To.RECEIVE_ONLY?c.send.videoCodecs:Tb(mt.VIDEO,R,P,_),z=h===To.RECEIVE_ONLY?c.send.audioCodecs:Tb(mt.AUDIO,R,P,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=i.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(V=>V.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=z.map(V=>V.payloadType.toString(10)),U.attributes.payloads=z,U.attributes.extmaps=R.audioExtensions,$v(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Tm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=x_(r,this.cname,re("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=xr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,i),this.updateBundleMids()):(m=xr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:r??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=Tb(u,h,this.localCapabilities.send,u===mt.AUDIO?c:o),_=u===mt.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>st(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Nr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=xr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,c,u){const h=this.rtpCapabilities.send,m=e===mt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===mt.VIDEO?h.videoExtensions:h.audioExtensions;Nr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,r,i){const o=xr(e);return Dx(o),Hv(o,r),Lx(o,r),qG(o),aP(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const i=xr(e);return aP(i,r,this.localCapabilities.recv),$v(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Nr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const m_e=["sdp"];var dr;function s$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Vm(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?s$(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let o$=(dr=class ES extends PG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(ES.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??To.SEND_ONLY,this.name=this.direction===To.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=KL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await XG();if(this.localCapabilities=cP(i),r){const{sdp:o}=r,c=p_e(r,m_e),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=Sb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hu(R,S,"videoExtensions",P,k,z),hu(R,S,"videoCodecs",P,k,z),hu(R,S,"audioExtensions",P,k,z),hu(R,S,"audioCodecs",P,k,z),re("RAISE_H264_BASELINE_PRIORITY")){const U=z.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const V=z.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(V<U){D.debug("raising H264 baseline profile priority");const q=z.videoCodecs[U];z.videoCodecs.splice(U,1),z.videoCodecs.splice(V,0,q)}V!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:z}}({},{},o);this.remoteSDP=new i$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Im(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await JG({},{},h.sdp);this.localCapabilities=cP(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Vm(Vm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Im(o.sdp);return this.initialOffer=o,Vm(Vm({},c),{},{sdp:o.sdp})}}catch(i){throw new Ne(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=r,u=await JG({},{},i);this.remoteSDP=new i$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Ne(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var c=this;return pl(function*(){const u=yield Rn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,i,o);r.forEach((V,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(Y),V._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(le=>le.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),V._updateRtpTransceiver(Y)}}),Nr()&&re("SIMULCAST")===!0&&(yield Rn(c.applySimulcastForFirefox(h,r)));const _=m.map(V=>V.mid),y=yield Rn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,r,_),R=ya(S),P=_.map(V=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return HG(q,re("USE_PUB_RTX"))}),k=h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(V){const q=c.remoteSDP.toString();throw yield Rn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Rn(c.stopSending(_,!0)),V}yield Rn(c.applySimulcastEncodings(h,r)),yield Rn(c.applySendEncodings(h,r));const z=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(z),yield Rn(c.setRemoteDescription({type:"answer",sdp:z})),h.map((V,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof Ne?h:new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);y==null||y(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===I_.Auto&&(this.store.p2pTransport=I_.SdRtn,Nn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ES.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Nn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(ES.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Im(i.sdp);return this.store.descriptionStart(),this.direction===To.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===To.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Im(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ne(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Vm(Vm({},hh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Vm(Vm({},hh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(cb(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...ES.turnServerConfigToIceServers(r.turnServer.servers,i,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...ES.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),st(u=[I_.Relay,I_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Nn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);D.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case I_.SdRtn:const m=r.filter(y=>{var S;return st(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Rm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Rm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case I_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Rm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Rm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Nn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,ar.LOW_STREAM)&&(R&&(u.maxFramerate=Ja(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&Wf()){var m;const S=re("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];Nr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(r,i){try{if(!Nn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];u instanceof pr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){const c=ya(r);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Hv(_,u),YG(_,u,this.store.codec))}),Tm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const y=r[_],S=i[_];if(S instanceof pr&&!st(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,i){if(!Nr()&&r.length===i.length)for(let o=0;o<r.length;o++){const c=i[o];if(c instanceof pr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var i,o,c,u,h;return!!(r instanceof pr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(i=r._hints).call(i,ar.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),r),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ya(i).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),st(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){const c=ya(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===mt.AUDIO&&u.media.mediaType==="audio"&&$v(u),Tm(c)}},yt(dr.prototype,"establish",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"establish"),dr.prototype),yt(dr.prototype,"connect",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"connect"),dr.prototype),yt(dr.prototype,"receive",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"receive"),dr.prototype),yt(dr.prototype,"mockReceive",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"mockReceive"),dr.prototype),yt(dr.prototype,"stopReceiving",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"stopReceiving"),dr.prototype),yt(dr.prototype,"restartICE",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"restartICE"),dr.prototype),yt(dr.prototype,"close",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"close"),dr.prototype),yt(dr.prototype,"updateEncoderConfig",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"updateEncoderConfig"),dr.prototype),yt(dr.prototype,"updateSendParameters",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"updateSendParameters"),dr.prototype),yt(dr.prototype,"replaceTrack",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"replaceTrack"),dr.prototype),yt(dr.prototype,"muteLocal",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"muteLocal"),dr.prototype),yt(dr.prototype,"unmuteLocal",[_u],Object.getOwnPropertyDescriptor(dr.prototype,"unmuteLocal"),dr.prototype),dr);function _u(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let _d=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var a$,c$,l$,u$,d$,h$,f$,p$,m$,g$,_$,Rr;function E$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function GP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?E$(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let g_e=(a$=Ed(_d.SEND_ONLY),c$=Ed(_d.SEND_ONLY),l$=Ed(),u$=Ed(_d.RECEIVE_ONLY),d$=Ed(_d.RECEIVE_ONLY),h$=Ed(_d.RECEIVE_ONLY),f$=Ed(_d.RECEIVE_ONLY),p$=Ed(_d.RECEIVE_ONLY),m$=Ed(_d.RECEIVE_ONLY),g$=Ed(),_$=Ed(_d.RECEIVE_ONLY),Rr=class extends Ar{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(kt.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",zn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==zn.Connected)return void c(new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:z}]=k;return z}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ge.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ge.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await sr(this,kt.RequestMuteLocal,R);const P=i.trackMediaType==="video"?wm.MUTE_LOCAL_VIDEO:wm.MUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==zn.Connected)return void c(new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?wm.UNMUTE_LOCAL_VIDEO:wm.UNMUTE_LOCAL_AUDIO;await sr(this,kt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get(Ge.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==zn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(kt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ge.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==zn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return i===R});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==zn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===Ge.LocalVideoTrack&&Nn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ge.LocalVideoLowTrack);if(S){const R=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ct((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new MH(e),this.bindStatsUploaderEvents(),this.sendMutex=new Cs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Cs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new o$(e,this.store,To.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=zn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new o$(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Ne(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=zn.Connected}async addRemoteCandidate(e,r){if(r===To.RECEIVE_ONLY){if(!this.sendConnection)throw new Ne(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ne(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return pl(function*(){const c=yield Rn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==zn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,Ps.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,i);if(u.length===0)return void(yield Rn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===Ge.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield Rn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield Rn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),y}yield Rn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:R}=y;const P=Date.now();o.store.publish(S.getTrackId(),R===Ge.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==zn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===zn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:ame(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):i.push(m)}),r.length>0&&r.forEach(o=>{sr(this,kt.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{sr(this,kt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return pl(function*(){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Es(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var c;if(!this.recvConnection)throw new Ne(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Uv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Mv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(kt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new Ne(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===mt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===mt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===mt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===mt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;sr(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[mt.VIDEO,mt.AUDIO].forEach(o=>{i.has(o)?sr(this,kt.RequestP2PUnmuteRemote,o):sr(this,kt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ne(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(Ge.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ti){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ge.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Ge.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Ge.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,c){if(e){const h=this.localTrackMap.get(Ge.LocalAudioTrack),m=o?this.localTrackMap.get(Ge.LocalVideoLowTrack):this.localTrackMap.get(Ge.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof jr),m=o?(u=this.localTrackMap.get(Ge.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof pr);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:o===mt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Cs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Cs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Ge.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=zn.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Ge.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Ge.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof pr||r&&r.track instanceof jr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(Dc(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ge.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=$T(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=zn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case Ge.LocalVideoTrack:st(r=o._hints).call(r,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ge.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ge.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(Dc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Pm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===To.SEND_ONLY){if(!this.sendConnection)throw new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Ne(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Es(this,kt.RequestP2PRestartICE,{direction:To.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(Ge.LocalVideoTrack),i=this.localTrackMap.get(Ge.LocalAudioTrack),o=e.videoSend.find(k=>{var z;return k.ssrc===(r==null||(z=r.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)}),c=e.audioSend.find(k=>{var z;return k.ssrc===(i==null||(z=i.ssrcs)===null||z===void 0?void 0:z[0].ssrcId)});if(!o||!c)return 1;const u=kc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,z=e.bitrate.actualEncoded;if(k&&z){const U=(1e3*k-z)/(1e3*k);return vG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(z=>z.ssrc===c),m=e.videoRecv.find(z=>z.ssrc===u);if(!h&&!m)return void(r+=1);const _=kc(this,kt.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ct((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const o=[],c=Nn(),u=this.getAllTracks();e=bv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof pr&&(this.localTrackMap.has(Ge.LocalVideoTrack)||h?new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:Ge.LocalVideoTrack}),h=!0),r)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:Ge.LocalVideoLowTrack})}if(_ instanceof jr){const y=this.localTrackMap.get(Ge.LocalAudioTrack);if(y){if(!(y.track instanceof Ti))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===Ge.LocalAudioTrack});if(!(S.track instanceof Ti))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ti||_._bypassWebAudio)o.push({track:_,type:Ge.LocalAudioTrack});else{const S=new Ti;S.addAudioTrack(_),o.push({track:S,type:Ge.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=bv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof jr){const c=this.localTrackMap.get(Ge.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ge.LocalAudioTrack,c]),c.track.close())):r.push([Ge.LocalAudioTrack,c])}if(o instanceof pr){const c=this.localTrackMap.get(Ge.LocalVideoTrack);if(!c)continue;r.push([Ge.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ge.LocalVideoLowTrack);u&&r.push([Ge.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ge.LocalVideoTrack:i.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ge.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Ge.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case Ge.LocalVideoTrack:i.off(Et.GET_STATS,this.handleGetLocalVideoStats),i.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ge.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Ge.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Et.GET_STATS,this.handleGetLocalAudioStats),e.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Mv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof Uv&&r.addListener(Et.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case Ge.LocalAudioTrack:u=Gn.Audio;break;case Ge.LocalVideoTrack:u=st(c=h._hints).call(c,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:u=Gn.Low}return{kind:m===Ge.LocalAudioTrack?mt.AUDIO:mt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),st(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await ns(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Lr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(kv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_AUDIO_DECODE,br.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_AUDIO_RECEIVED,br.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;const o=Array.from(Dc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===r);o&&wt.firstRemoteFrame(this.store.sessionId,xi.FIRST_VIDEO_RECEIVED,br.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const o=r.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Cm(i))," -> ").concat(JSON.stringify(Cm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Cm(i))," -> ").concat(JSON.stringify(Cm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===To.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===To.SEND_ONLY?this.restartICE(e):Es(this,kt.RequestP2PRestartICE,{direction:To.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(Ge.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||r.push([Ge.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Ge.LocalVideoTrack)){const c=this.localTrackMap.get(Ge.LocalVideoLowTrack);c&&r.push([Ge.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(Ge.LocalAudioTrack);if(e instanceof jr&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&r.push([Ge.LocalAudioTrack,i]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Ge.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ge.LocalVideoLowTrack);c&&r.push([Ge.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ge.LocalAudioTrack:o=Gn.Audio;break;case Ge.LocalVideoTrack:o=st(i=u._hints).call(i,ar.SCREEN_TRACK)?Gn.Screen:Gn.High;break;case Ge.LocalVideoLowTrack:o=Gn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){const c=o.get(r);if(!c)return i;i.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Ge.LocalVideoTrack),i=this.localTrackMap.get(Ge.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ct((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ct((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof jr){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await sr(this,kt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(kt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ns(BL(this.dtlsFailedCount,_i)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ge.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof pr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof pr).length>1)throw new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof jr).length>1&&(e.some(r=>r instanceof jr&&r._bypassWebAudio)||!Nn().webAudioMediaStreamDest))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof pr&&this.pendingLocalTracks.some(i=>i instanceof pr))throw new Ne(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof jr&&this.pendingLocalTracks.some(i=>i instanceof jr)&&(!Nn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof jr&&i._bypassWebAudio)))throw new Ne(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Nn().supportDualStreamEncoding,o=GP(GP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=i?e._mediaStreamTrack.clone():Xx(e,o);const u=or(8,"track-low-"),h=new pr(c,GP(GP({},i&&{scaleResolutionDownBy:Nx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(A_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Pv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),e.addListener(Et.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var c;const u=Array.from(Dc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,xi.FIRST_VIDEO_DECODE,br.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:i,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ne(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ne(X.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Ne(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Ne(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Ne(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Ne(X.NOT_SUPPORTED)}async preConnect(e){throw new Ne(X.NOT_SUPPORTED)}getEstablishParams(){throw new Ne(X.NOT_SUPPORTED)}async reSubscribe(e){throw new Ne(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Ne(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===Ge.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Pv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},yt(Rr.prototype,"p2pConnect",[a$],Object.getOwnPropertyDescriptor(Rr.prototype,"p2pConnect"),Rr.prototype),yt(Rr.prototype,"unpublish",[c$],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublish"),Rr.prototype),yt(Rr.prototype,"unpublishLowStream",[l$],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublishLowStream"),Rr.prototype),yt(Rr.prototype,"subscribe",[u$],Object.getOwnPropertyDescriptor(Rr.prototype,"subscribe"),Rr.prototype),yt(Rr.prototype,"mockSubscribe",[d$],Object.getOwnPropertyDescriptor(Rr.prototype,"mockSubscribe"),Rr.prototype),yt(Rr.prototype,"unsubscribe",[h$],Object.getOwnPropertyDescriptor(Rr.prototype,"unsubscribe"),Rr.prototype),yt(Rr.prototype,"muteRemote",[f$],Object.getOwnPropertyDescriptor(Rr.prototype,"muteRemote"),Rr.prototype),yt(Rr.prototype,"unmuteRemote",[p$],Object.getOwnPropertyDescriptor(Rr.prototype,"unmuteRemote"),Rr.prototype),yt(Rr.prototype,"hasRemoteMediaWithLock",[m$],Object.getOwnPropertyDescriptor(Rr.prototype,"hasRemoteMediaWithLock"),Rr.prototype),yt(Rr.prototype,"disconnectForReconnect",[g$],Object.getOwnPropertyDescriptor(Rr.prototype,"disconnectForReconnect"),Rr.prototype),yt(Rr.prototype,"remoteMediaSsrcChanged",[_$],Object.getOwnPropertyDescriptor(Rr.prototype,"remoteMediaSsrcChanged"),Rr.prototype),Rr);function Ed(e){return function(r,i,o){const c=r[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case _d.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case _d.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class Y_ extends Ar{constructor(r,i){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const o=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(Pc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:or(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&D.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(Bt.DATA_STREAM,{payload:Sm(this.encoder.encode(P))})});const R=new ct((P,k)=>{const z=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Wv.ABORT,V),D.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new Ne(X.INVALID_REMOTE_USER)):k(new Ne(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{z&&window.clearTimeout(z),this.off(Wv.ABORT,V),o&&P()},V=()=>{z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Ne(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Wv.ABORT,V),this.once("res-@".concat(c,"_ack"),U);const q=(le,ge)=>{Y=!0,z&&window.clearTimeout(z),this.off("res-@".concat(c,"_ack"),U),this.off(Wv.ABORT,V),le==="success"?P(ge):k(new Ne(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),ns(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||D.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,i,o,c,u);throw P}}onMessage(r){var i;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Jr.CHECK)return;const{token:y}=r;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:y,total:S}=r,R=(h=c.get(y))!==null&&h!==void 0?h:[];if(R.push(r),c.has(y)||c.set(y,R),R.length!==S)return;{const P=$T(R).call(R,(k,z)=>k.index-z.index).map(k=>k.payload).join("");c.delete(y),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(st(i=[Jr.ACK,Jr.CHECK]).call(i,m))return m===Jr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):D.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:or(6,""),token:this.token,_type:Jr.CHECK};re("SHOW_P2P_LOG")&&D.debug("send message",r),this.signal.request(Bt.DATA_STREAM,{payload:Sm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:Jr.ACK,token:this.token};re("SHOW_P2P_LOG")&&D.debug("send message",i),this.signal.request(Bt.DATA_STREAM,{payload:Sm(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(Jr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=y;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),y.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void D.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:o,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&D.debug("receive message",r),i){let h;switch(r._type!==Jr.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Jr.CANDIDATE:case Jr.CONTROL:this.signal.emit(o,h,u);break;case Jr.PUBLISH:case Jr.UNPUBLISH:case Jr.RESTART_ICE:case Jr.CALL:h.uid=u,Es(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Jr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Jr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<Y_.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:o}=JSON.parse(r),c=or(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>Y_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),r=r.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(r,i){return r.token!==i?(D.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(i)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Es(this.signal,Jr.CALL,void 0),i=await this.send(Jr.CALL,r);this.signal.emit(Wt.P2P_CONNECTION,i,!0)}async reset(r,i){const o=this.userMap.get(r);o&&(this.emit(Wv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:o.uid,reason:xpe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(D.debug("change local token from ".concat(i," to ").concat(i)),this.token=or(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Wv.ABORT)}}$(Y_,"MAX_SIZE",1),$(Y_,"MAX_MESSAGE_SIZE",1024);class __e extends Ar{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===lr.CONNECTED?this.emit(Wt.WS_CONNECTED):r===lr.RECONNECTING?this.emit(Wt.WS_RECONNECTING,this._websocketReconnectReason):r===lr.CLOSED&&this.emit(Wt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new qW(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Wt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Wn.UID_BANNED);break;case 15:this.close(Wn.IP_BANNED);break;case 16:this.close(Wn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Lt.ERR_LICENSE_MISSING:this.close(Wn.LICENSE_MISSING);break;case Lt.ERR_LICENSE_EXPIRED:this.close(Wn.LICENSE_EXPIRED);break;case Lt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Wn.LICENSE_MINUTES_EXCEEDED);break;case Lt.ERR_LICENSE_PERIOD_INVALID:this.close(Wn.LICENSE_PERIOD_INVALID);break;case Lt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Wn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Lt.ERR_LICENSE_ILLEGAL:this.close(Wn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new Ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",_s.OFFLINE)}),this.p2pToken=or(6,""),this._external_signal=new Y_(this,this.p2pToken)}async request(r,i,o,c){const u=or(6,""),h={_id:u,_type:r,_message:i},m=this.websocket.connectionID,_=()=>new ct((z,U)=>{if(this.connectionState===lr.CONNECTED)return z();const V=()=>{this.off(Wt.WS_CLOSED,q),z()},q=()=>{this.off(Wt.WS_CONNECTED,V),U(new Ne(X.WS_ABORT))};this.once(Wt.WS_CONNECTED,V),this.once(Wt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||r===Bt.JOIN||r===Bt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new ct((z,U)=>{let V=!1;const q=(le,ge)=>{V=!0,z({isSuccess:le==="success",message:ge||{}}),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.emit(Wt.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Ne(X.WS_ABORT,"type: ".concat(r))),this.off(Wt.WS_CLOSED,Y),this.off(Wt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Wt.WS_CLOSED,Y),this.once(Wt.WS_RECONNECTING,Y),ns(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Wt.REQUEST_TIMEOUT,r,i))})});let S=null;try{S=await y}catch(z){if(this.connectionState===lr.CLOSED||r===Bt.LEAVE)throw new Ne(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?z.throw():r===Bt.JOIN||r===Bt.REJOIN?null:(await _(),await this.request(r,i))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=Eb(R),k=new Ne(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Lt.ERR_TOO_MANY_BROADCASTERS?((r===Bt.JOIN||r===Bt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===Lt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_s.MULTI_IP)):this.reconnect(P.action,_s.SERVER_ERROR),r===Bt.JOIN||r===Bt.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new ct(o=>{const c=u=>{(!i||i(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(gb.WRTC_STATS,i)}upload(r,i){const o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ct((i,o)=>{this.once(Wt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Wt.WS_CLOSED,()=>o(this.initError||new Ne(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Wn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=or(6,""),this._external_signal.clear(),this._external_signal=new Y_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Wt.ABORT_P2P_EXECUTION);const r=await Es(this,Wt.REQUEST_JOIN_INFO),i=await this.request(Bt.JOIN,r);if(!i)return this.emit(Wt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Wt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;const o=R_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(i=Object.values(Jr)).call(i,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){D.debug("[".concat(this.clientId,"] receive notification: "),r);const i=Eb(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Wn.UID_BANNED),void this.close()):void this.reconnect(i.action,_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_s.TIMEOUT):this.request(Bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(Bt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Yt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Wt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Yt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Yt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Yt.FAILED,()=>{this._disconnectedReason=Wn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Yt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Yt.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Yt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Wt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Ne&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===Lt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_s.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Yt.REQUEST_NEW_URLS,(r,i)=>{Es(this,Wt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Yt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const E_e={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new g_e(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new __e(i,r)}};function y$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function v$(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?y$(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class y_e{constructor(r){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),r=xr(r);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=r,S=ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=xr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=i.iceUfrag,P.attributes.icePwd=i.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(z=>z.payloadType.toString(10));let k=u.videoCodecs.filter(z=>{var U,V;return(U=z.rtpMap)===null||U===void 0?void 0:st(V=U.encodingName.toLowerCase()).call(V,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Tm(this.sessionDesc)}send(r,i,o){const{ssrcs:c,ssrcGroups:u}=x_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>r===mt.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(v$(v$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(r){case As.TCP_RELAY:this.candidates=o;break;case As.UDP_TCP_RELAY:case As.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=xr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=xr(r);return Hv(o,i),Lx(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===mt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(r){const i=xr(r);return Dx(i),function(o){const c=o.attributes.extmaps.find(u=>oP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var ir;function S$(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function HP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?S$(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S$(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let v_e=(ir=class xw extends OG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return st(i=Object.keys(xA)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=i,this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(xw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=KL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Im(r.sdp),o=Sb(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,HP(HP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Ne(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new y_e(HP(HP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new Ne(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return pl(function*(){const c=yield Rn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Rn(o.peerConnection.createOffer()),m=ya(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,z=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!z)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,V,q){const Y=U.attributes.ssrcs.filter(ge=>ge.attributes.label===V),le=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&Y.length>1){const ge=le.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return ge?[{ssrcId:ge.ssrcIds[0],rtx:q?ge.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(z,k.id,o.useRTX)});let y;try{y=yield _}catch(P){throw u.forEach(k=>{gs()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,i,y);const R=o.remoteSDP.toString();return yield Rn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Rn(o.applySendEncodings(u,r)),yield Rn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const z=P._mediaStreamTrack.id;return{localSSRC:_[k],id:z}})}catch(u){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{gs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,i,c),m=new ct((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=z=>{const U=Cn();if((U.name==="Safari"&&Number(U.version)===11||yo())&&z.track.id!==u&&z.streams[0].id===h){var V;const q=z.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(r,u,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(z.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(z.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(gs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(gs()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return pl(function*(){const o=yield Rn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Nn().supportPCSetConfiguration;if(r===As.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=r===As.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}r!==As.RELAY&&i.remoteSDP.updateCandidates(r);const u=yield Rn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Im(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield Rn(i.peerConnection.setLocalDescription(u)),yield Rn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Ne(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new Ne(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Ne(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(cb(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...xw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...xw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!i)return D.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Nn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof pr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Wf()){var h;const y=re("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),D.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(r,i){try{if(!Nn().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const o=ya(r);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Hv(m,c)}),Tm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=r[h];return new ct((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=z=>{const U=Cn();if(U.name==="Safari"&&Number(U.version)===11&&z.track.id!==m&&z.streams[0].id===_){var V;const q=z.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,z.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(z.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:z.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ct.all(i)}catch(i){throw new Ne(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(Nn().supportPCSetConfiguration){const i=xw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},yt(ir.prototype,"connect",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"connect"),ir.prototype),yt(ir.prototype,"stopSending",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"stopSending"),ir.prototype),yt(ir.prototype,"receive",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"receive"),ir.prototype),yt(ir.prototype,"stopReceiving",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"stopReceiving"),ir.prototype),yt(ir.prototype,"muteRemote",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"muteRemote"),ir.prototype),yt(ir.prototype,"unmuteRemote",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"unmuteRemote"),ir.prototype),yt(ir.prototype,"muteLocal",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"muteLocal"),ir.prototype),yt(ir.prototype,"unmuteLocal",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"unmuteLocal"),ir.prototype),yt(ir.prototype,"close",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"close"),ir.prototype),yt(ir.prototype,"updateEncoderConfig",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"updateEncoderConfig"),ir.prototype),yt(ir.prototype,"updateSendParameters",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"updateSendParameters"),ir.prototype),yt(ir.prototype,"replaceTrack",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"replaceTrack"),ir.prototype),yt(ir.prototype,"getRemoteSSRC",[Tl],Object.getOwnPropertyDescriptor(ir.prototype,"getRemoteSSRC"),ir.prototype),ir);function Tl(e,r,i){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const S_e={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new v_e(i,r)}},T_e={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(GA.has(e)||!e.track)return;const i={track:e.track};if(Bf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(y,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?$f.AUDIO_64_BIT_PTS:$f.METADATA;R.data=function(z,U,V){const q=V.byteLength,Y=q+_x+pG,le=mx+gx+Y,ge=new ArrayBuffer(z.byteLength+le),Ee=new DataView(ge);Ee.setUint8(0,fG),Ee.setUint16(1,Y),Ee.setUint8(3,U),Ee.setUint16(4,q);for(let Pe=0;Pe<q;Pe++)Ee.setUint8(6+Pe,V[Pe]);const pe=new Uint8Array(Ee.buffer);return pe.set(new Uint8Array(z),le),pe.buffer}(R.data,k,y),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=zA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=r.metadata&&r.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=GA.get(e);if(c){GA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}GA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(XA.has(e))return;const i={track:e.track,onMetadata:r.onMetadata};if(Bf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");PL(Un.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),r.enableTopn?function(_,y,S){var R;const P=mG(new DataView(y.data));if(!P)return S.enqueue(y);const k=_.track.id;npe.set(k,_.track);const z=(R=P.tlv.find(ge=>ge.tag===$f.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof z=="number"&&(U=127-z);const V=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(ge,Ee){let pe=Vv.get(ge);if(pe||(pe=function(Pe){const Ke=new _G;return Vv.set(Pe,Ke),hd||(hd=new epe(re("TOPN_SILENCE_THRESHOLD")||500),hd.on("ActiveSpeakerChanged",lt=>{lt!=null&&(KA=lt)})),hd.addSpeakers([Ke]),Ke}(ge)),Vv.size<=EG)return{selected:!0,speaker:pe};if(!hd)throw new Error("no active speaker detector");return hd.levelChanged(pe.id,Ee),N_=hd.loudest.map(Pe=>Pe.id),KA&&!st(N_).call(N_,KA)&&N_.length>=EG&&N_.pop(),{selected:st(N_).call(N_,pe.id)||pe.id===KA,speaker:pe}}(_,V),le=function(ge,Ee,pe){const Pe=fd.get(ge)||new tpe(ge,Ee);return Pe.score=pe,fd.set(ge,Pe),function(Ke){if(qA.set(Ke,!0),!YA)return void(YA=Date.now());const lt=Date.now();lt-YA>1e3&&(qA.get(Ke)?qA.set(Ke,!1):(yG(Ke),qA.delete(Ke)),YA=lt)}(ge),Pe}(k,_.track,Y.energyScore);le.addSample(q),le.active&&(y.data=P.frame.buffer,S.enqueue(y))}(e,h,m):r.enableMetadata?function(_,y,S){const R=mG(new DataView(_.data));if(!R)return y.enqueue(_);const P=R.tlv.find(k=>k.tag===$f.METADATA||k.tag===$f.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,y.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=zA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=XA.get(c);if(u){(function(_){const y=Vv.get(_);y&&(Vv.delete(_),hd&&(hd.removeSpeakers([y]),Vv.size===0&&(hd.destroy(),hd=null)))})(c),yG(c.track.id),XA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}}(e)}XA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(JA.has(e)||!e.track)return;const i={track:e.track};if(Bf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void D.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,R){const P=function(Y){const le=Y.length;let ge=[],Ee=0;for(;Ee<le;)Ee+2<le&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(ge.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(ge.push(Y[Ee]),Ee++);return new Uint8Array(ge)}(R),k=P.length,z=Math.floor(k/255),U=k%255,V=new Uint8Array(6+z+1+k+S.byteLength);V[0]=0,V[1]=0,V[2]=0,V[3]=1,V[4]=6,V[5]=101;let q=0;for(;q<z;)V[6+q]=255,q++;return V[6+q]=U,q++,V.set(P,6+q),V.set(new Uint8Array(S),6+q+k),V.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!gs())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=zA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=JA.get(e);if(c){JA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}JA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Nn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(mb.has(e)){const c=mb.get(e);return void(c&&(c.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if(Bf()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let R=0;for(;R+4<y.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,z=0;for(;(z=S.getUint8(P++))===255;)k+=255;k+=z;const U=rpe(y.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=zA(),u=new MessageChannel;await new ct(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new ct(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=mb.get(c);if(u){mb.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}})(e)}mb.set(e,i),e.track.addEventListener("ended",o)}},b_e={name:"InterceptFrame",create:()=>T_e};qL(),Jn("PROCESS_ID","process-".concat(or(8,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void D.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();D.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(fr,o)){const{value:c,expires:u}=r[o];if(u&&u<=i)return;dd[o]=c,fr[o]=c}})}catch(r){D.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(dd.AREAS)&&dd.AREAS.length>0&&Fx(dd.AREAS,!0);const T$=(e,r,i)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),Jn(e,r,i)};Am($ge,!1),Am(Yge,!1),Am(Ame,!1),Am(o_e,!1),Am(zge,!1),Am(E_e,!1),Am(S_e,!1),Am(b_e,!1);const Ei=function(e){const r=new Ar,i=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===gh.SECURITY_POLICY_VIOLATION&&n7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return t7(t7({},i),o)}({__TRACK_LIST__:Av,VERSION:ml,BUILD:JL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:T$,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(o){let c;return Nn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!i)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(r){throw new Re(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=wt.reportApiInvoke(null,{name:gi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Lr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&DL()&&bW(75)&&new u().close()}catch(u){return D.error("check system requirement failed: ",u),!1}let i=!1;const o=Cn();o.name===Un.CHROME&&Number(o.version)>=58&&(ld.engine.name!=="WebKit"||function(){const u=Cn();if(CA()){if(u.os===Li.MAC_OS)return!0;if(u.os===Li.IOS){const h=ld.os.version&&ld.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Un.FIREFOX&&Number(o.version)>=56||o.name===Un.OPERA&&Number(o.version)>=45||o.name===Un.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(yo()||ou())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||PW()||Cn().name===Un.QQ)&&(i=!0),D.debug("checkSystemRequirements, api:",r,"browser",i);const c=r&&i;return e.onSuccess(c),c},getDevices:function(e){return Vc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Vc.getRecordingDevices(e)},getCameras:function(e){return Vc.getCamerasDevices(e)},getElectronScreenSources:b8,getPlaybackDevices:function(e){return Vc.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=or(5,"client-"),o=wt.reportApiInvoke(null,{id:i,name:gi.CREATE_CLIENT,options:[r],tag:Lr.TRACER});try{(function(c){Ii(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ii(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ii(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ts(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&UW(c.turnServer),c.httpRetryConfig!==void 0&&MW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&MW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(RW(16,0)||CW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",D.debug("browser not support vp9, force use vp8")),Jn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new Pme(pu(pu({forceWaitGatewayResponse:!0},r),{},{role:st(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),i=or(8,"track-cam-"),o=wt.reportApiInvoke(null,{id:i,tag:Lr.TRACER,name:gi.CREATE_CAM_VIDEO_TRACK,options:[wr({},e),r]});r&&(e.encoderConfig=r);const c=BA(e);let u=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Uc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Ne(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(D)}e.optimizationMode&&px(i,u,e,fh(e.encoderConfig));const h=new fx(u,e,c,e.scalabiltyMode?UA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const r=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:r,tag:Lr.TRACER,name:gi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new pr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?UA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[ar.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),D.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function(P){return D8(P)}(r):void 0;i&&(r="auto");const o=or(8,"track-scr-v-"),c=wt.reportApiInvoke(null,{id:o,tag:Lr.TRACER,name:gi.CREATE_SCREEN_VIDEO_TRACK,options:[wr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&Bf()&&(k.extensionId=P.extensionId);const{displaySurface:z,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:q,preferCurrentTab:Y}=P;(ib(107)||OL(107)||kL(93))&&(z&&(Ii(z,"displaySurface",["browser","window","monitor"]),k.displaySurface=z),U?(Ii(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",V&&(Ii(V,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=V)),(ib(105)||OL(105)||kL(91))&&q&&(Ii(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(ib(94)||OL(94)||kL(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const le=P.encoderConfig?nx(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(k.mandatory.maxFrameRate=le.frameRate,k.mandatory.minFrameRate=le.frameRate):(k.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,k.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),k.frameRate=le.frameRate),le.width&&(k.width=le.width),le.height&&(k.height=le.height)),k}(e);let h=null,m=null;const _=Nn();if(!_.supportShareAudio&&r==="enable"){const P=new Ne(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(D)}D.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const y=_.supportShareAudio&&r!=="disable";try{const P=await Uc({screen:u,screenAudio:y?i||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Ne(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(D)}if(!m&&r==="enable"){h&&h.stop();const P=new Ne(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(px(o,h,e,e.encoderConfig&&nx(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new pr(h,e.encoderConfig?nx(e.encoderConfig):{},e.scalabiltyMode?UA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),D.info("create screen video track success","video:",S.getTrackId()),S;const R=new jr(m,void 0,or(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=re("CAMERA_CAPTURE_CONFIG"),o=or(8,"track-mic-"),c=or(8,"track-cam-"),u=wt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Lr.TRACER,name:gi.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const h=BA(r),m=L8(e);let _=null,y=null;D.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await Uc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],y=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!y){const P=new Ne(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(D)}r.optimizationMode&&px(c,y,r,fh(r.encoderConfig));const S=new WA(_,e,m,o),R=new fx(y,r,h,r.scalabiltyMode?UA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),D.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=or(8,"track-mic-"),i=wt.reportApiInvoke(null,{id:r,tag:Lr.TRACER,name:gi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=L8(e);let c=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await Uc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Ne(X.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(D)}const u=new WA(c,e,o,r);return i.onSuccess(u.getTrackId()),D.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:r,tag:Lr.TRACER,name:gi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new jr(e.mediaStreamTrack,e.encoderConfig?VA(e.encoderConfig):{},r,!1);return D.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:i,encoderConfig:o},h=or(8,"track-buf-"),m=wt.reportApiInvoke(null,{id:h,tag:Lr.TRACER,name:gi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Ne(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=vz.get(R);if(U)return D.debug("use cached audio resource: ",R),U;try{k=(await ud(()=>Go.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new Ne(X.FETCH_AUDIO_FILE_FAILED,V.toString())}}else k=await new ct((V,q)=>{const Y=new FileReader;Y.onload=le=>{le.target?V(le.target.result):q(new Ne(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Ne(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const z=await function(U){const V=Lv();return new ct((q,Y)=>{V.decodeAudioData(U,le=>{q(le)},le=>{Y(new Ne(X.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(k);return typeof R=="string"&&P&&vz.set(R,z),z}(c,i)}catch(R){return m.onError(R),R.throw(D)}const y=new Yfe(c),S=new qfe(_,y,o?VA(o):{},h);return D.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new Re(X.INVALID_PARAMS,"invalid app type",e);Jn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Jn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Jn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new vH},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:gi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof jr||e instanceof Uv)){const _=new Re(X.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof jr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ct(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(y);const k=R,z={duration:P,deviceLabel:o,maxVolumeLevel:u,result:k};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(z))),i.onSuccess(z),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:gi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof pr||e instanceof Mv)){const R=new Re(X.INVALID_TRACK,"the parameter is not a video track");return i.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof pr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(gs()||CA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,z,U){let V,q=0,Y=null;return new ct((le,ge)=>{function Ee(){q>U&&V&&(V(),le(q));const pe=z.getContext("2d");if(!pe){const lt=new Re(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(lt.toString()),void ge(lt)}pe.drawImage(P,0,0,160,120);const Pe=pe.getImageData(0,0,z.width,z.height),Ke=Math.floor(Pe.data.length/3);if(Y){for(let lt=0;lt<Ke;lt+=3)if(Pe.data[lt]!==Y[lt])return q+=1,void(Y=Pe.data);Y=Pe.data}else Y=Pe.data}setTimeout(()=>{V&&(V(),le(q))},k),V=ax(()=>{Ee()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw i.onError(R),R}pme===Un.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:Fx,audioElementPlayCenter:Ho,resumeAudioContext:function(){Ho.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){kme.processExternalMediaAEC(e)},registerExtensions:function(e){const r=re("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!st(r).call(r,i.name)&&r.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=D.extLog,o.reporter.hookApiInvoke=wt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),T$("PLUGIN_INFO",r)},ChannelMediaRelayError:jv,ChannelMediaRelayEvent:qf,ChannelMediaRelayState:va,RemoteStreamFallbackType:Bfe,RemoteStreamType:jfe,ConnectionDisconnectedReason:Wn,AudienceLatencyLevelType:_fe,AREAS:Vn,preload:async function(e,r,i,o){return KH(e,r,i,o)}});return Object.defineProperties(Ei,{onAudioAutoplayFailed:{get:()=>Fc.onAudioAutoplayFailed,set:e=>{Fc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Fc.onAutoplayFailed,set:e=>{Fc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ei._onSecurityPolicyViolation,set(e){Ei._onSecurityPolicyViolation=e,n7(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?D_:[]}}),Vc.on(P_.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),Ei.onCameraChanged&&Ei.onCameraChanged(e),Ei.safeEmit(gh.CAMERA_CHANGED,e)}),Vc.on(P_.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),Ei.onMicrophoneChanged&&Ei.onMicrophoneChanged(e),Ei.safeEmit(gh.MICROPHONE_CHANGED,e)}),Vc.on(P_.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),Ei.onPlaybackDeviceChanged&&Ei.onPlaybackDeviceChanged(e),Ei.safeEmit(gh.PLAYBACK_DEVICE_CHANGED,e)}),Ho.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),Fc.onAudioAutoplayFailed&&Fc.onAudioAutoplayFailed()},Qn.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),Fc.onAudioAutoplayFailed&&Fc.onAudioAutoplayFailed(),Ei.safeEmit(gh.AUTOPLAY_FAILED)}),Qn.on(is.STATE_CHANGE,(e,r)=>{D.info("audio context state changed: ".concat(r," => ").concat(e)),Ei.onAudioContextStateChanged&&Ei.onAudioContextStateChanged(e,r),Ei.safeEmit(gh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),si.on(Tv.NETWORK_STATE_CHANGE,(e,r)=>{D.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Ei),Ei})}(ck)),ck.exports}var _6e=g6e();const NR=y0(_6e),E6e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"},Lse="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Lse);console.log("AgoraProvider: import.meta.env:",E6e);const y6e=NR.createClient({mode:"rtc",codec:"vp8"});let mw=null;const xse=L.createContext(null),Mse=({children:n,appId:t=Lse,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,T]=L.useState(!1),[w,A]=L.useState(!1),[N,F]=L.useState([]),[j,B]=L.useState(null),[G,J]=L.useState(null),[K,ne]=L.useState(null),[de,oe]=L.useState(!1),[_e,Z]=L.useState(!1),[ee,te]=L.useState(!1),[ce,me]=L.useState(null),[he,se]=L.useState(!1),Se=kd(),Ve=L.useRef(y6e),tt=L.useRef({appId:t,channel:s,uid:l,enabled:d}),ke=L.useRef(!1),Me=L.useRef(null);L.useRef(null),L.useEffect(()=>{tt.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ve.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),J(s)},[s]),L.useEffect(()=>{if(!Ve.current)return;const Ze=ut=>{console.log(`Connection state changed to: ${ut}`),ut==="DISCONNECTED"?(T(!1),console.log("Disconnected from Agora")):ut==="CONNECTED"&&(T(!0),B(null))};return Ve.current.on("connection-state-change",Ze),()=>{Ve.current.off("connection-state-change",Ze)}},[]),L.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const Ze=async(Vt,ln)=>{console.log("AgoraProvider: User published:",Vt.uid,ln);try{await Ve.current.subscribe(Vt,ln),console.log("AgoraProvider: Subscribed to user:",Vt.uid,"mediaType:",ln),ln==="audio"&&(Vt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Vt.uid)),F(xn=>xn.some(Qt=>Qt.uid===Vt.uid)?xn:[...xn,Vt])}catch(xn){console.error("AgoraProvider: Error subscribing to user:",xn)}},ut=(Vt,ln)=>{console.log("AgoraProvider: User unpublished:",Vt.uid,ln),ln==="audio"&&Vt.audioTrack&&(Vt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Vt.uid))},it=Vt=>{console.log("AgoraProvider: User joined:",Vt.uid),F(ln=>ln.some(xn=>xn.uid===Vt.uid)?ln:[...ln,Vt])},It=Vt=>{console.log("AgoraProvider: User left:",Vt.uid),F(ln=>ln.filter(xn=>xn.uid!==Vt.uid))};Ve.current.on("user-published",Ze),Ve.current.on("user-unpublished",ut),Ve.current.on("user-joined",it),Ve.current.on("user-left",It);const yn=async()=>{if(ke.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}ke.current=!0;try{if(v&&Me.current===s){console.log("AgoraProvider: Already joined to channel",s),oe(!0),E(Ve.current);return}if(Ve.current.connectionState==="CONNECTING"||Ve.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",Ve.current.connectionState),Me.current&&Me.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ae()}catch(Vt){console.error("AgoraProvider: Error leaving channel:",Vt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),T(!0),oe(!0),Me.current=s,mw=s,E(Ve.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",Me.current),await Xe(),console.log("AgoraProvider: Join channel completed")}catch(Vt){console.error("AgoraProvider: Error during initialization:",Vt)}finally{ke.current=!1}};return console.log("AgoraProvider: Running initialization"),yn(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),Ve.current.off("user-published",Ze),Ve.current.off("user-unpublished",ut),Ve.current.off("user-joined",it),Ve.current.off("user-left",It)}},[s,d,l,E,v]);const Ce=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const Ze=await NR.createMicrophoneAudioTrack();return await Ze.setMuted(p),ne(Ze),console.log("Microphone initialized successfully"),Ze}catch(Ze){return console.error("Error initializing microphone:",Ze),B("Failed to initialize microphone. Please check your permissions."),null}};L.useEffect(()=>{(async()=>{if(s)try{const It=await ug(s);It&&It.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),se(!0),v&&await Ae()):se(!1)}catch(it){console.error("AgoraProvider: Error checking if voice is disabled:",it)}})();const ut=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",it.detail.voiceDisabled),se(it.detail.voiceDisabled),it.detail.voiceDisabled&&v?Ae():!it.detail.voiceDisabled&&!v&&d&&s&&Xe())};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[s,v,d]);const Xe=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(he)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:_e,connectionState:Ve.current.connectionState,joinedChannel:Me.current}),v&&Me.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(_e)return console.log("AgoraProvider: Already in the process of joining"),!1;if(Ve.current.connectionState==="CONNECTED")if(Me.current&&Me.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Ae()}catch(Ze){console.error("AgoraProvider: Error leaving channel:",Ze)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),T(!0),oe(!0),Me.current=s,mw=s,E(Ve.current),!0;if(Ve.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise(Ze=>{const ut=setInterval(()=>{Ve.current.connectionState==="CONNECTED"&&(clearInterval(ut),T(!0),Z(!1),oe(!0),Me.current=s,mw=s,E(Ve.current),Ze(!0))},500);setTimeout(()=>{clearInterval(ut),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),Ze(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const ut="AgoraProvider: App ID is empty or invalid";return console.error(ut),B(ut),Z(!1),!1}Z(!0);const Ze=l||Math.floor(Math.random()*1e6);return await Ve.current.join(t,s,a,Ze),console.log("AgoraProvider: Joined channel successfully with UID:",Ve.current.uid),T(!0),Z(!1),oe(!0),Me.current=s,mw=s,E(Ve.current),!0}catch(Ze){return console.error("AgoraProvider: Error joining channel:",Ze),B(`Error joining channel: ${Ze.toString()}`),Z(!1),!1}},Ae=async()=>{if(v)try{K&&await Ve.current.unpublish(K),await Ve.current.leave(),mw=null,Me.current=null,console.log("Left channel successfully"),T(!1),F([])}catch(Ze){console.error("Error leaving channel:",Ze),B(Ze.message||"Failed to leave channel")}};L.useEffect(()=>()=>{K&&K.close()},[]),L.useEffect(()=>{d&&s&&(!v||Me.current!==s)&&Xe()},[d,s,v]);const Ie=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(Ze){return console.error("Error checking microphone status:",Ze),!1}};L.useEffect(()=>{const Ze=()=>{const it=Ie();it!==w&&(console.log("Syncing microphone state:",{actualStatus:it,currentState:w}),A(it),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:it}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=it,window.agoraClient.microphoneTrack=K))};K&&Ze();const ut=setInterval(Ze,1e3);return()=>{clearInterval(ut)}},[K,w]);const be=async()=>{var Ze;if(he)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Se({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ut=w!==void 0?w:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ut,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await Ce()))return console.error("AgoraProvider: Failed to initialize microphone"),ut;const it=!ut;if(console.log("AgoraProvider: New voice state will be:",it),ut){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(It){return console.error("Error muting track:",It),ut}}else if(K)try{Ve.current&&v&&!((Ze=Ve.current.localTracks)!=null&&Ze.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await Ve.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(It){return console.error("Error unmuting track:",It),ut}return A(it),it}catch(ut){return console.error("AgoraProvider: Error toggling voice:",ut),w}},xe=async Ze=>{try{ne(Ze),console.log("Microphone track updated successfully")}catch(ut){throw console.error("Error updating microphone track:",ut),ut}},We=async()=>{if(!Ve.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ee)return console.log("AgoraProvider: Stopping screen share"),ce&&(Array.isArray(ce)?(await Ve.current.unpublish(ce),ce.forEach(Ze=>Ze.close())):(await Ve.current.unpublish(ce),ce.close()),me(null)),te(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const Ze=await NR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",Ze),Ze.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),Ve.current.unpublish(Ze),Ze.close(),me(null),te(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ve.current.publish(Ze),me(Ze),te(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=Ze,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(Ze){return console.error("AgoraProvider: Error creating screen track:",Ze),te(!1),me(null),!1}}catch(Ze){return console.error("AgoraProvider: Error toggling screen share:",Ze),te(!1),me(null),!1}};L.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ve.current,isScreenSharing:!1,screenTrack:null};const Ze=it=>{console.log("AgoraProvider: Received ToggleScreenShare event"),We().then(It=>{it.detail&&it.detail.callback&&it.detail.callback(!0,It)}).catch(It=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",It),it.detail&&it.detail.callback&&it.detail.callback(!1,ee)})},ut=it=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Xe().then(It=>{it.detail&&it.detail.callback&&it.detail.callback(It)}).catch(It=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",It),it.detail&&it.detail.callback&&it.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",Ze),window.addEventListener("JoinVoiceChat",ut),()=>{window.removeEventListener("ToggleScreenShare",Ze),window.removeEventListener("JoinVoiceChat",ut),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),L.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Ve.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,K]);const Qe={client:Ve.current,isJoined:v,isVoiceEnabled:w,users:N,error:j,channel:G,appId:t,toggleVoice:be,leaveChannel:Ae,joinChannel:Xe,microphoneTrack:K,isReady:de,createMicrophoneTrack:xe,isScreenSharing:ee,screenTrack:ce,toggleScreenShare:We,voiceDisabled:he};return I.jsx(xse.Provider,{value:Qe,children:n})},Use=()=>{const n=L.useContext(xse);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Mse.propTypes={children:vr.node.isRequired,appId:vr.string.isRequired,channel:vr.string.isRequired,token:vr.string,uid:vr.oneOfType([vr.string,vr.number])};const v6e=()=>{var ke,Me;const{client:n,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:p,channel:E,appId:v,toggleVoice:T,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:j,toggleScreenShare:B,voiceDisabled:G}=Use(),[J,K]=L.useState(t!==void 0?t:((ke=window.agoraClient)==null?void 0:ke.isVoiceEnabled)||!1),[ne,de]=L.useState(F!==void 0?F:((Me=window.agoraClient)==null?void 0:Me.isScreenSharing)||!1),[oe,_e]=L.useState(G!==void 0?G:!1),[Z,ee]=L.useState(!0);L.useEffect(()=>{var Ce;t!==void 0?K(t):((Ce=window.agoraClient)==null?void 0:Ce.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),L.useEffect(()=>{var Ce;F!==void 0?de(F):((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)!==void 0&&de(window.agoraClient.isScreenSharing)},[F]),L.useEffect(()=>{G!==void 0&&_e(G)},[G]);const te=L.useRef({isVoiceEnabled:J,isScreenSharing:ne,isJoined:s,users:a,error:l,isReady:p,channel:E,appId:v,voiceDisabled:oe});L.useEffect(()=>{te.current={isVoiceEnabled:J,isScreenSharing:ne,isJoined:s,users:a,error:l,isReady:p,channel:E,appId:v,voiceDisabled:oe}},[J,ne,s,a,l,p,E,v,oe]),L.useEffect(()=>{const Ce=setTimeout(()=>{ee(!1)},5e3);return()=>clearTimeout(Ce)},[]),L.useEffect(()=>{p&&ee(!1)},[p]),L.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:J,contextIsScreenSharing:F,localScreenSharing:ne,isJoined:s,users:a.length,error:l,isReady:p,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,J,F,ne,s,a,l,p,E,v,d,j]);const ce=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const Ce=await T();if(console.log("useVoiceChat: Toggle result:",Ce),Ce!==void 0)K(Ce);else{const Xe=!J;K(Xe),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Xe)}return Ce!==void 0?Ce:!J}catch(Ce){return console.error("useVoiceChat: Error toggling voice:",Ce),J}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const Ce=await B();if(console.log("useVoiceChat: Screen share toggle result:",Ce),Ce!==void 0)de(Ce);else{const Xe=!ne;de(Xe),window.agoraClient&&(window.agoraClient.isScreenSharing=Xe)}return Ce!==void 0?Ce:!ne}catch(Ce){return console.error("useVoiceChat: Error toggling screen share:",Ce),ne}},he=async()=>{J&&d&&await ce()},se=async()=>{!J&&d&&await ce()},Se=Ce=>a.some(Xe=>{var Ae;return Xe.uid===Ce&&((Ae=Xe.audioTrack)==null?void 0:Ae.isPlaying)}),Ve=L.useCallback(()=>{if(!d||!J)return 0;try{return d.getVolumeLevel()}catch(Ce){return console.error("Error getting volume level:",Ce),0}},[d,J]);return{isVoiceEnabled:J,isScreenSharing:ne,isJoined:s,users:a,error:l,toggleVoice:ce,toggleScreenShare:me,mute:he,unmute:se,isUserSpeaking:Se,getVolumeLevel:Ve,microphoneTrack:d,screenTrack:j,isLoading:Z,channel:E,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async Ce=>{try{if(!Ce){console.error("No device ID provided");return}if(!n||!s){console.error("Client not initialized or not joined to a channel");return}d&&(J&&await n.unpublish(d),await d.close());const Xe=await NR.createMicrophoneAudioTrack({microphoneId:Ce,encoderConfig:"music_standard"});N&&await N(Xe),J&&await n.publish(Xe),console.log("Microphone device changed successfully")}catch(Xe){throw console.error("Error changing microphone device:",Xe),Xe}},voiceDisabled:oe}},S6e=({size:n="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:E,joinChannel:v,channel:T,client:w,voiceDisabled:A}=v6e(),[N,F]=L.useState(!1),[j,B]=L.useState(!1);L.useEffect(()=>{const K=()=>{De.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(De.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),L.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:T,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:A})},[d,E,T,w,j,A]);const G=async()=>{if(!(N||A)){F(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",d);const K=await p();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{F(!1)}}},J=()=>A?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||A?null:I.jsx(sg,{label:J(),placement:t,hasArrow:!0,children:I.jsxs(Ct,{position:"relative",cursor:"pointer",onClick:G,children:[I.jsx(Iu,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?I.jsx(UV,{color:"white"}):I.jsx(MV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&I.jsx(Ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:I.jsx(kp,{size:"sm",color:"white"})})]})})},T6e=ti.createContext({user:null}),b6e=({userNickname:n})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Use(),[p,E]=L.useState([]),[v,T]=L.useState(!1),[w,A]=L.useState(!0);L.useRef({});const N=L.useRef(null);L.useRef(null);const{user:F}=L.useContext(T6e)||{user:null},[j,B]=L.useState({}),G=L.useRef(a),[J,K]=L.useState(null),{isOpen:ne,onOpen:de,onClose:oe}=bp(),[_e,Z]=L.useState(!1),ee=L.useRef(null),te=L.useRef(null);L.useEffect(()=>{G.current=a},[a]),L.useEffect(()=>{if(!t||!s){T(!1);return}const Se=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const Ve=t.connectionState;if(console.log("Current connection state:",Ve),Ve==="CONNECTED")T(!0),A(!1);else{T(!1);const tt=ke=>{console.log("Connection state changed:",ke),ke==="CONNECTED"?(T(!0),A(!1)):T(!1)};return t.on("connection-state-change",tt),()=>{t.off("connection-state-change",tt),clearTimeout(Se)}}return()=>{clearTimeout(Se)}},[t,s]),L.useEffect(()=>{const Se=async()=>{const Ve={...j};let tt=!1;for(const ke of p){if(j[ke.uid])continue;let Me=null,Ce=ke.uid;if(typeof Ce=="string"&&(Ce.includes("-")?(Me=Ce.split("-")[0],Ce=Ce.split("-")[1]):Ce.includes("_")&&(Me=Ce.split("_")[0],Ce=Ce.split("_")[1])),Ce)try{console.log("Trying to fetch nickname for user ID:",Ce);const Xe=await nf(Ce);Xe&&Xe.Nickname?(console.log("Found nickname in Firebase for user ID:",Ce,"Nickname:",Xe.Nickname),Ve[ke.uid]=Xe.Nickname,tt=!0):Me?(console.log("Using extracted name for user ID:",Ce,"Name:",Me),Ve[ke.uid]=Me,tt=!0):(Ve[ke.uid]="User",tt=!0)}catch(Xe){console.error("Error fetching user profile:",Xe),Me?(Ve[ke.uid]=Me,tt=!0):(Ve[ke.uid]="User",tt=!0)}else Me?(Ve[ke.uid]=Me,tt=!0):(Ve[ke.uid]="User",tt=!0)}tt&&B(Ve)};p.length>0&&Se()},[p,j]),L.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Se=async(ke,Me)=>{if(console.log("User published:",ke.uid,Me,ke),Me==="video"){console.log("Remote video track detected:",ke.uid);try{await t.subscribe(ke,Me),console.log("Subscribed to remote video track:",ke.uid),E(Ce=>Ce.some(Xe=>Xe.uid===ke.uid)?Ce:[...Ce,ke])}catch(Ce){console.error("Error subscribing to remote video track:",Ce)}}},Ve=(ke,Me)=>{if(console.log("User unpublished:",ke.uid,Me),Me==="video"){if(console.log("Remote video track unpublished:",ke.uid),ke.videoTrack)try{ke.videoTrack.stop()}catch(Ce){console.error("Error stopping video track:",Ce)}if(E(Ce=>Ce.filter(Xe=>Xe.uid!==ke.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),G.current.play(N.current)}catch(Ce){console.error("Error replaying local screen track:",Ce)}}},tt=ke=>{console.log("User left:",ke.uid);const Me=p.find(Ce=>Ce.uid===ke.uid);if(Me&&Me.videoTrack)try{Me.videoTrack.stop()}catch(Ce){console.error("Error stopping video track:",Ce)}if(E(Ce=>Ce.filter(Xe=>Xe.uid!==ke.uid)),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),G.current.play(N.current)}catch(Ce){console.error("Error replaying local screen track:",Ce)}};return t.on("user-published",Se),t.on("user-unpublished",Ve),t.on("user-left",tt),()=>{t.off("user-published",Se),t.off("user-unpublished",Ve),t.off("user-left",tt)}},[t,s,v,p,l]),L.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(Se=>{if(Se.videoTrack)try{console.log("Playing video track for:",Se.uid),Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ve){console.error("Error playing video track:",Ve)}}),l&&G.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),G.current.play(N.current)}catch(Se){console.error("Error replaying local screen track:",Se)}},[p,l]),L.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Se){console.error("Error playing local screen track:",Se)}},[l,a]),L.useEffect(()=>()=>{if(p.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.stop()}catch(Ve){console.error("Error stopping video track on unmount:",Ve)}}),a)try{a.stop()}catch(Se){console.error("Error stopping local screen track on unmount:",Se)}},[p,a]);const ce=()=>{console.log("Stopping local screen share"),d()},me=Se=>(console.log("Getting display name for UID:",Se,"type:",typeof Se),l&&F&&(Se===F.uid||Se===(t==null?void 0:t.uid))?n||"You":j[Se]?j[Se]:typeof Se=="string"?Se.includes("-")?Se.split("-")[0]:Se.includes("_")?Se.split("_")[0]:Se:"User"),he=Se=>{console.log("Opening modal for remote screen",Se),K(Se),de()},se=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),de()};return L.useEffect(()=>{ne&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&G.current)try{console.log("Playing local screen in modal"),G.current.play("modal-screen-container"),Z(!0)}catch(Se){console.error("Error playing local screen in modal:",Se)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),Z(!0)}catch(Se){console.error("Error playing remote screen in modal:",Se)}},500)):ne||(Z(!1),K(null),setTimeout(()=>{if(l&&G.current)try{G.current.play("local-screen-container")}catch(Se){console.error("Error playing local screen in small container:",Se)}p.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ve){console.error(`Error playing remote screen ${Se.uid} in small container:`,Ve)}})},500))},[ne,J,l,p]),!v||w&&p.length===0&&!l||p.length===0&&!l?null:I.jsxs(I.Fragment,{children:[!ne&&I.jsxs(Ct,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ee,children:[l&&a&&I.jsxs(Ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:se,children:[I.jsx(Ct,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),I.jsx(Ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(Se=>{const Ve=j[Se.uid]||me(Se.uid);return I.jsxs(Ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Se),children:[I.jsx(Ct,{id:`video-container-${Se.uid}`,width:"100%",height:"100%",position:"relative"}),I.jsx(Ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ve}'s Screen`})]},Se.uid)})]}),ne&&I.jsx(Ct,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:I.jsxs(Ct,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Se=>Se.stopPropagation(),children:[!_e&&I.jsxs(Ct,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[I.jsx(kp,{size:"xl"}),I.jsx(ft,{mt:4,children:"Loading screen share..."})]}),I.jsx(Ct,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:te}),I.jsx(Ct,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),I.jsx(Ct,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${j[J==null?void 0:J.uid]||me(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&I.jsx(Ct,{position:"absolute",bottom:4,right:4,children:I.jsx(wi,{colorScheme:"red",size:"sm",onClick:ce,children:"Stop Sharing"})})]})})]})},w6e=({onClose:n})=>{const t=kd(),[s,a]=L.useState(!1),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const T=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(T),window.removeEventListener("ScreenShareToggled",w)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const T=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(T)}}catch(T){console.error("Error in screen share handler:",T),a(!1),t({title:"Screen sharing error",description:T.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(T,w)=>{a(!1),T?(d(w),t(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function R6e({open:n,onClose:t}){const[s,a]=L.useState(0);return I.jsxs(oc,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[I.jsx(sc,{backdropFilter:"blur(4px)"}),I.jsxs(ac,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[I.jsx(Ou,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),I.jsx(el,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),I.jsx(ic,{p:0,display:"flex",children:I.jsxs(YR,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[I.jsxs(XR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:Z5e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Movement"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:e6e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Camera"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:J5e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Actions"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:Q5e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Tips"})]})]}),I.jsxs(AN,{flexGrow:1,display:"flex",flexDirection:"column",children:[I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),I.jsxs(Ri,{wrap:"wrap",gap:3,children:[I.jsx(wl,{keyLabel:"W",description:"Move Forward"}),I.jsx(wl,{keyLabel:"A",description:"Move Left"}),I.jsx(wl,{keyLabel:"S",description:"Move Backward"}),I.jsx(wl,{keyLabel:"D",description:"Move Right"}),I.jsx(wl,{keyLabel:"Shift",description:"Run"}),I.jsx(wl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),I.jsxs(Ri,{wrap:"wrap",gap:3,children:[I.jsx(wl,{keyLabel:"Mouse",description:"Look Around"}),I.jsx(wl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),I.jsx(wl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),I.jsxs(Ri,{wrap:"wrap",gap:3,children:[I.jsx(wl,{keyLabel:"E",description:"Interact"}),I.jsx(wl,{keyLabel:"F",description:"Emote Menu"}),I.jsx(wl,{keyLabel:"T",description:"Chat"}),I.jsx(wl,{keyLabel:"M",description:"Mute Mic"})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),I.jsxs(di,{align:"stretch",spacing:2,children:[I.jsx(ft,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),I.jsx(ft,{fontSize:"xs",children:" Press ESC to access settings"}),I.jsx(ft,{fontSize:"xs",children:" Click on players to view their profile"}),I.jsx(ft,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const wl=({keyLabel:n,description:t})=>I.jsx(Ct,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:I.jsxs(Ai,{spacing:2,children:[I.jsx(Ct,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),I.jsx(ft,{fontSize:"xs",children:t})]})}),C6e=()=>{const[n,t]=L.useState([]),[s,a]=L.useState(""),[l,d]=L.useState(0),[p,E]=L.useState(100),[v,T]=L.useState(100),[w,A]=L.useState(!0),[N,F]=L.useState(!0),[j,B]=L.useState(!1);L.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await NR.getMicrophones();t(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),L.useEffect(()=>{const de=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(de)},[j]);const G=de=>{const oe=de.target.value;a(oe),console.log("Microphone changed to:",oe)},J=de=>{E(de),console.log("Microphone volume set to:",de)},K=de=>{T(de),console.log("Speaker volume set to:",de)},ne=()=>{B(!j)};return I.jsxs(di,{spacing:6,align:"stretch",children:[I.jsxs(Bi,{children:[I.jsxs(tc,{children:["Microphone",I.jsx(hp,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),I.jsxs(fne,{value:s,onChange:G,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(de=>I.jsx("option",{value:de.deviceId,children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),n.length===0&&I.jsx("option",{value:"",children:"No microphones found"})]})]}),I.jsxs(Ct,{children:[I.jsx(ft,{mb:2,children:"Microphone Level"}),I.jsx(u0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),I.jsxs(Bi,{children:[I.jsxs(tc,{children:["Microphone Volume: ",p,"%"]}),I.jsxs(eV,{value:p,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[I.jsx(nV,{bg:"gray.700",children:I.jsx(rV,{})}),I.jsx(tV,{boxSize:6})]})]}),I.jsxs(Bi,{children:[I.jsxs(tc,{children:["Speaker Volume: ",v,"%"]}),I.jsxs(eV,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[I.jsx(nV,{bg:"gray.700",children:I.jsx(rV,{})}),I.jsx(tV,{boxSize:6})]})]}),I.jsxs(Bi,{display:"flex",alignItems:"center",children:[I.jsx(tc,{mb:"0",children:"Microphone Enabled"}),I.jsx(ig,{isChecked:j,onChange:ne,colorScheme:"green",size:"lg"})]}),I.jsxs(Bi,{display:"flex",alignItems:"center",children:[I.jsx(tc,{mb:"0",children:"Echo Cancellation"}),I.jsx(ig,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),I.jsxs(Bi,{display:"flex",alignItems:"center",children:[I.jsx(tc,{mb:"0",children:"Noise Suppression"}),I.jsx(ig,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),I.jsxs(n0,{status:"info",borderRadius:"md",children:[I.jsx(r0,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function I6e({open:n,onClose:t,containerRef:s}){return I.jsx(Ll,{containerRef:s,children:I.jsxs(oc,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[I.jsx(sc,{}),I.jsxs(ac,{bg:"gray.900",color:"white",borderRadius:"lg",children:[I.jsx(Ou,{children:"Settings"}),I.jsx(el,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),I.jsx(ic,{children:I.jsxs(YR,{variant:"enclosed",children:[I.jsxs(XR,{mb:4,children:[I.jsx(Cl,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),I.jsx(Cl,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),I.jsxs(AN,{children:[I.jsx(Rd,{children:I.jsx(Ct,{p:4,bg:"gray.800",borderRadius:"md",children:I.jsx(C6e,{})})}),I.jsx(Rd,{children:I.jsx(Ct,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function A6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function P6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function qS(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function O6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function k6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function N6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function D6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function eR(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function FV(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function kJ(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function wO(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function L6e(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const x6e=({isOpen:n,onClose:t})=>{const{spaceID:s}=xl(),[a,l]=L.useState(0),[d,p]=L.useState(null),[E,v]=L.useState(null),[T,w]=L.useState(!1),[A,N]=L.useState(0),[F,j]=L.useState(null),B=L.useRef(null),[G,J]=L.useState(null),[K,ne]=L.useState(null),[de,oe]=L.useState(!1),[_e,Z]=L.useState(0),[ee,te]=L.useState(null),ce=L.useRef(null),[me,he]=L.useState([]),[se,Se]=L.useState([]),[Ve,tt]=L.useState(!1),[ke,Me]=L.useState(!1),[Ce,Xe]=L.useState(!0),[Ae,Ie]=L.useState(!1),be=kd();L.useEffect(()=>{n&&s&&We()},[n,s]);const xe=async Ot=>{if(s&&n){tt(!0);try{const Dt=Oie(),ve=`space_${s}_owners`,Ue=kV(OR(Dt,"users"),JX("groups","array-contains",ve)),He=await $k(Ue),_t=[];for(const fn of He.docs){const Xt=fn.data(),Bn=await nf(fn.id);_t.push({uid:fn.id,email:Xt.email,displayName:Xt.displayName||Bn.Nickname||"Unknown User",photoURL:Xt.photoURL||Bn.photoURL,firstName:Bn.firstName,lastName:Bn.lastName})}he(_t);const vt=`space_${s}_hosts`,St=kV(OR(Dt,"users"),JX("groups","array-contains",vt)),zt=await $k(St),dn=[];for(const fn of zt.docs){const Xt=fn.data(),Bn=await nf(fn.id);dn.push({uid:fn.id,email:Xt.email,displayName:Xt.displayName||Bn.Nickname||"Unknown User",photoURL:Xt.photoURL||Bn.photoURL,firstName:Bn.firstName,lastName:Bn.lastName})}Se(dn)}catch(Dt){De.error("Error fetching space users:",Dt),be({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{tt(!1)}}},We=async()=>{try{const Ot=await ug(s);Ot.logoUrl&&j(Ot.logoUrl),Ot.backgroundUrl&&te(Ot.backgroundUrl),Ot.voiceDisabled!==void 0&&Me(Ot.voiceDisabled),Ot.accessibleToAllUsers!==void 0&&Xe(Ot.accessibleToAllUsers),xe(Ot)}catch(Ot){De.error("Error fetching space data:",Ot),be({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};L.useEffect(()=>{s&&n&&a===3&&xe()},[s,n,a]);const Qe=Ot=>{const Dt=Ot.target.files[0];if(Dt){if(!Dt.type.startsWith("image/")){be({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}p(Dt);const ve=new FileReader;ve.onloadend=()=>{v(ve.result)},ve.readAsDataURL(Dt)}},Ze=Ot=>{const Dt=Ot.target.files[0];if(Dt){if(!Dt.type.startsWith("image/")){be({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}J(Dt);const ve=new FileReader;ve.onloadend=()=>{ne(ve.result)},ve.readAsDataURL(Dt)}},ut=async()=>{if(!d){be({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{w(!0);const Ot=setInterval(()=>{N(ve=>{const Ue=ve+10;return Ue>=90?90:Ue})},300),Dt=await GBe(s,d);clearInterval(Ot),N(100),j(Dt),be({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{p(null),v(null),N(0),w(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Dt}}))}catch(Ot){console.error("Error uploading logo:",Ot),be({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),w(!1),N(0)}},it=async()=>{if(!G){be({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{oe(!0);const Ot=setInterval(()=>{Z(ve=>{const Ue=ve+10;return Ue>=90?90:Ue})},300),Dt=await $Be(s,G);clearInterval(Ot),Z(100),te(Dt),be({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{J(null),ne(null),Z(0),oe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Dt}}))}catch(Ot){console.error("Error uploading background:",Ot),be({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),oe(!1),Z(0)}},It=async()=>{if(F)try{w(!0),await HBe(s),j(null),be({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),w(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ot){console.error("Error deleting logo:",Ot),be({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),w(!1)}},yn=async()=>{if(ee)try{oe(!0),await KBe(s),te(null),be({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),oe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ot){console.error("Error deleting background:",Ot),be({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),oe(!1)}},Vt=()=>{B.current&&B.current.click()},ln=()=>{ce.current&&ce.current.click()},xn=async()=>{Ie(!0);try{await qBe(s,{voiceDisabled:!ke}),Me(!ke),be({title:"Settings Updated",description:`Voice chat has been ${ke?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){De.error("Error updating voice settings:",Ot),be({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{Ie(!1)}},Qt=async()=>{Ie(!0);try{await YBe(s,!Ce),Xe(!Ce),be({title:"Settings Updated",description:`Space is now ${Ce?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){De.error("Error updating accessibility settings:",Ot),be({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{Ie(!1)}};return I.jsxs(oc,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[I.jsx(sc,{backdropFilter:"blur(4px)"}),I.jsxs(ac,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[I.jsx(Ou,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),I.jsx(el,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),I.jsx(ic,{p:0,display:"flex",children:I.jsxs(YR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[I.jsxs(XR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:qS,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Logo"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:P6e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Background"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:N6e,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Settings"})]}),I.jsxs(Cl,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[I.jsx(Hn,{as:kJ,mb:1}),I.jsx(ft,{fontSize:"xs",children:"Users"})]})]}),I.jsxs(AN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),I.jsx(ft,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(F||E)&&I.jsxs(Ri,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[F&&I.jsxs(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(ft,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),I.jsx(Fh,{src:F,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),I.jsx(wi,{mt:3,colorScheme:"red",leftIcon:I.jsx(Hn,{as:eR}),onClick:It,isLoading:T,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),E&&I.jsxs(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(ft,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),I.jsx(Fh,{src:E,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),I.jsxs(Bi,{children:[I.jsx(tc,{fontSize:"xs",children:"Upload New Logo"}),I.jsx(Ns,{type:"file",accept:"image/*",onChange:Qe,ref:B,display:"none"}),T&&I.jsxs(Ct,{mt:3,mb:3,children:[I.jsxs(ft,{fontSize:"xs",mb:1,children:["Uploading... ",A,"%"]}),I.jsx(u0,{value:A,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),I.jsxs(Ai,{mt:3,spacing:3,children:[I.jsx(wi,{colorScheme:"blue",leftIcon:I.jsx(Hn,{as:qS}),onClick:Vt,isDisabled:T,size:"sm",variant:"outline",children:"Browse"}),I.jsx(wi,{colorScheme:"green",leftIcon:I.jsx(Hn,{as:FV}),onClick:ut,isLoading:T,loadingText:"Uploading...",isDisabled:!d||T,size:"sm",children:"Upload"})]}),I.jsx(jU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),I.jsx(ft,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(ee||K)&&I.jsxs(Ri,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ee&&I.jsxs(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(ft,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),I.jsx(Fh,{src:ee,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),I.jsx(wi,{mt:3,colorScheme:"red",leftIcon:I.jsx(Hn,{as:eR}),onClick:yn,isLoading:de,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),K&&I.jsxs(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[I.jsx(ft,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),I.jsx(Fh,{src:K,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),I.jsxs(Bi,{children:[I.jsx(tc,{fontSize:"xs",children:"Upload New Background"}),I.jsx(Ns,{type:"file",accept:"image/*",onChange:Ze,ref:ce,display:"none"}),de&&I.jsxs(Ct,{mt:3,mb:3,children:[I.jsxs(ft,{fontSize:"xs",mb:1,children:["Uploading... ",_e,"%"]}),I.jsx(u0,{value:_e,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),I.jsxs(Ai,{mt:3,spacing:3,children:[I.jsx(wi,{colorScheme:"blue",leftIcon:I.jsx(Hn,{as:qS}),onClick:ln,isDisabled:de,size:"sm",variant:"outline",children:"Browse"}),I.jsx(wi,{colorScheme:"green",leftIcon:I.jsx(Hn,{as:FV}),onClick:it,isLoading:de,loadingText:"Uploading...",isDisabled:!G||de,size:"sm",children:"Upload"})]}),I.jsx(jU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),I.jsx(ft,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),I.jsxs(di,{spacing:4,align:"stretch",children:[I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:I.jsxs(Ai,{justify:"space-between",align:"center",children:[I.jsxs(Ct,{children:[I.jsxs(Ai,{mb:1,spacing:2,children:[I.jsxs(Ct,{position:"relative",w:"16px",h:"16px",children:[I.jsx(Hn,{as:L6e,color:ke?"red.400":"green.400"}),ke&&I.jsx(Ct,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),I.jsx(ft,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.800",children:ke?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),I.jsx(ig,{isChecked:!ke,onChange:xn,colorScheme:"green",size:"md",isDisabled:Ae})]})}),I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:I.jsxs(Ai,{justify:"space-between",align:"center",children:[I.jsxs(Ct,{children:[I.jsxs(Ai,{mb:1,spacing:2,children:[I.jsx(Ct,{position:"relative",w:"16px",h:"16px",children:I.jsx(Hn,{as:kJ,color:Ce?"green.400":"red.400"})}),I.jsx(ft,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.800",children:Ce?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),I.jsx(ft,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),I.jsx(ig,{isChecked:Ce,onChange:Qt,colorScheme:"green",size:"md",isDisabled:Ae})]})}),I.jsxs(n0,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[I.jsx(r0,{color:"blue.300"}),I.jsxs(Ct,{children:[I.jsx(Sk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),I.jsx(Tk,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),I.jsxs(Rd,{p:4,display:"flex",flexDirection:"column",children:[I.jsx(ft,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),I.jsx(ft,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Ve?I.jsx(Ri,{justify:"center",align:"center",h:"200px",children:I.jsx(kp,{color:"blue.300"})}):I.jsxs(di,{spacing:4,align:"stretch",children:[I.jsxs(Ct,{children:[I.jsxs(Ai,{mb:2,children:[I.jsx(Hn,{as:A6e,color:"green.400"}),I.jsx(ft,{fontSize:"sm",fontWeight:"600",children:"Owners"}),I.jsx(hp,{colorScheme:"green",ml:2,children:me.length})]}),I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:me.length===0?I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):I.jsx(di,{spacing:1,align:"stretch",children:me.map(Ot=>I.jsxs(Ai,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[I.jsx(Iu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),I.jsxs(Ct,{children:[I.jsx(ft,{fontSize:"xs",children:Ot.displayName}),I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),I.jsx(Ck,{}),I.jsx(hp,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ot.uid))})})]}),I.jsxs(Ct,{children:[I.jsxs(Ai,{mb:2,children:[I.jsx(Hn,{as:D6e,color:"purple.400"}),I.jsx(ft,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),I.jsx(hp,{colorScheme:"purple",ml:2,children:se.length})]}),I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:se.length===0?I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):I.jsx(di,{spacing:1,align:"stretch",children:se.map(Ot=>I.jsxs(Ai,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[I.jsx(Iu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),I.jsxs(Ct,{children:[I.jsx(ft,{fontSize:"xs",children:Ot.displayName}),I.jsx(ft,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),I.jsx(Ck,{}),I.jsx(hp,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ot.uid))})})]}),I.jsx(vp,{borderColor:"whiteAlpha.200"}),I.jsxs(n0,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[I.jsx(r0,{color:"blue.300",boxSize:4}),I.jsxs(Ct,{children:[I.jsx(Sk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),I.jsx(Tk,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},M6e=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:s}=Nd(),[a,l]=L.useState(!0),[d,p]=L.useState(!1),[E,v]=L.useState(!1),[T,w]=L.useState(!1),[A,N]=L.useState(!1),[F,j]=L.useState(!1),[B,G]=L.useState(null),[J,K]=L.useState(!1),[ne,de]=L.useState(!1),[oe,_e]=L.useState(!1),[Z,ee]=L.useState(!1),te=kd(),{user:ce}=L.useContext(xa),me=(ce==null?void 0:ce.Nickname)||"Unknown",[he,se]=L.useState(!1),Se=async()=>{if(ce!=null&&ce.uid&&t)try{const be=await nf(ce.uid);let xe=!1,We=!1;if(be.groups){const Ze=`space_${t}_owners`,ut=`space_${t}_hosts`;xe=be.groups.includes(Ze),We=be.groups.includes(ut)}const Qe=await $ie(ce.uid,"disruptiveAdmin");if(ee(Qe),G({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),de(xe||Qe),_e(We),!xe&&!Qe&&J){K(!1);const Ze=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Ze),te({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),de(!1),_e(!1),ee(!1)}else de(!1),_e(!1),ee(!1)};L.useEffect(()=>{Se()},[ce==null?void 0:ce.uid,t,J]),L.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),L.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&se(window.agoraClient.voiceDisabled)}catch(We){console.error("Error checking if voice is disabled:",We)}})();const xe=We=>{We.detail&&typeof We.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",We.detail.voiceDisabled),se(We.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",xe),()=>{window.removeEventListener("SpaceVoiceSettingChanged",xe)}},[]);const Ve=()=>v(!E),tt=()=>w(!T),ke=()=>{j(!F),Xe()},Me=()=>{N(!1),Se()},Ce=be=>{be.stopPropagation(),typeof n=="function"&&(De.log("CanvasMainMenu: Toggling player list"),n())},Xe=()=>{p(!1)},Ae=be=>{if(be.stopPropagation(),!ne){te({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const xe=!J;K(xe);const We=new CustomEvent("editModeChanged",{detail:{enabled:xe}});window.dispatchEvent(We),te({title:xe?"Edit Mode Enabled":"Edit Mode Disabled",description:xe?"You can now make changes to the scene.":"Scene editing is now disabled.",status:xe?"info":"success",duration:3e3,isClosable:!0,position:"top"})},Ie=ne||oe||Z;return I.jsxs(I.Fragment,{children:[I.jsxs(yN,{isOpen:d,onClose:()=>p(!1),children:[I.jsx(vN,{as:Oa,icon:I.jsx(t5e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),I.jsx(Ll,{containerRef:s,children:I.jsx(SN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:I.jsxs(di,{align:"stretch",spacing:4,children:[I.jsxs(Ai,{children:[I.jsx(Iu,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),I.jsxs(di,{align:"start",spacing:0,children:[I.jsxs(Ai,{children:[I.jsx(ft,{fontWeight:"bold",children:me}),ne&&!Z&&I.jsx(sg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Ct,{display:"inline-block",children:I.jsx(Hn,{as:xV,color:"green.400",boxSize:3})})}),!ne&&oe&&!Z&&I.jsx(sg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Ct,{display:"inline-block",children:I.jsx(Hn,{as:VV,color:"purple.400",boxSize:3})})}),Z&&I.jsx(sg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:I.jsx(Ct,{display:"inline-block",children:I.jsx(Hn,{as:n6e,color:"blue.400",boxSize:3})})})]}),I.jsx(ft,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),I.jsxs(Ai,{spacing:4,justify:"center",children:[I.jsx(Oa,{icon:I.jsx(i6e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ce}),ne&&I.jsx(Oa,{icon:I.jsx(Y5e,{}),variant:"ghost",colorScheme:J?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Ae}),I.jsx(Oa,{icon:I.jsx(Ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),I.jsx(Oa,{icon:I.jsx(Ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),I.jsx(vp,{borderColor:"whiteAlpha.300"}),I.jsxs(di,{align:"stretch",spacing:2,children:[ne&&I.jsxs(Ai,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[I.jsx(ft,{fontSize:"md",children:"Edit Mode"}),I.jsx(ig,{id:"edit-mode-toggle",isChecked:J,onChange:Ae,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:J?"green.500":"black"}}})]}),ne&&I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ke,children:"Manage Space"}),ce&&t&&!he&&Ie&&I.jsx(w6e,{onClose:Xe}),I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Ve,children:"Settings"}),I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:tt,children:"Controls"}),I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),I.jsx(ft,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),T&&I.jsx(R6e,{open:T,onClose:tt}),E&&I.jsx(I6e,{open:E,onClose:Ve}),A&&I.jsx(kse,{open:A,onClose:Me}),I.jsx(x6e,{isOpen:F,onClose:ke})]})},U6e=({isOpen:n,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=xl(),d=Pg(),p=kd(),E=L.useRef(null),v=L.useRef(null),T=L.useRef(),[w,A]=L.useState(null),[N,F]=L.useState(""),[j,B]=L.useState(!1),[G,J]=L.useState(0),[K,ne]=L.useState(null),[de,oe]=L.useState(!0),[_e,Z]=L.useState(!1),[ee,te]=L.useState(!1),[ce,me]=L.useState(0),[he,se]=L.useState("image"),[Se,Ve]=L.useState(""),[tt,ke]=L.useState(!1);L.useEffect(()=>{(async()=>{if(n&&s&&l){oe(!0);try{const It=await gp(l,s);if(It&&(It.imageUrl||It.videoUrl)){ne(It);const yn=It.mediaType==="video";se(yn?"video":"image"),ke(It.displayAsVideo||!1),yn&&It.videoUrl&&(Ve(It.videoUrl),me(1))}else ne(null)}catch(It){De.error("Error fetching existing image:",It),ne(null)}finally{oe(!1)}}})()},[n,s,l]),L.useEffect(()=>{n||(A(null),F(""),J(0),Ve(""))},[n]);const Me=L.useCallback(it=>{it.preventDefault(),it.stopPropagation(),te(!0)},[]),Ce=L.useCallback(it=>{it.preventDefault(),it.stopPropagation(),te(!1)},[]),Xe=L.useCallback(it=>{it.preventDefault(),it.stopPropagation()},[]),Ae=L.useCallback(it=>{if(it.preventDefault(),it.stopPropagation(),te(!1),it.dataTransfer.files&&it.dataTransfer.files.length>0){const It=it.dataTransfer.files[0];Ie(It)}},[]);L.useEffect(()=>{const it=v.current;if(it)return it.addEventListener("dragenter",Me),it.addEventListener("dragleave",Ce),it.addEventListener("dragover",Xe),it.addEventListener("drop",Ae),()=>{it.removeEventListener("dragenter",Me),it.removeEventListener("dragleave",Ce),it.removeEventListener("dragover",Xe),it.removeEventListener("drop",Ae)}},[Me,Ce,Xe,Ae]);const Ie=it=>{if(!it)return;if(!it.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(it);const It=new FileReader;It.onloadend=()=>{F(It.result)},It.readAsDataURL(it)},be=it=>{const It=it.target.files[0];Ie(It)},xe=async it=>{const It=it.target.checked;if(ke(It),K)try{await j5e(l,s,It),It?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:It}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${It?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),De.log(`Updated display mode for media screen ${s} to ${It?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:It})}catch(yn){De.error("Error updating display mode:",yn),p({title:"Update failed",description:yn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),ke(!It)}},We=async()=>{if(he==="image"&&!w){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Se){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const it=setInterval(()=>{J(ln=>{const xn=ln+10;return xn>=90?90:xn})},300);let It;he==="image"?It=await IJ(l,s,w,{mediaType:he,displayAsVideo:tt}):(It=Se,await IJ(l,s,null,{mediaType:"video",directUrl:Se,displayAsVideo:tt})),clearInterval(it),J(100);let yn=null,Vt=null;he==="image"?(yn=tt?null:It,Vt=(K==null?void 0:K.videoUrl)||null):(yn=!tt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Vt=It),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:yn,videoUrl:Vt,mediaType:he,displayAsVideo:tt}),De.log(`Uploaded and sent ${he} for media screen ${s} (display as video: ${tt})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:he==="image"?It:K==null?void 0:K.imageUrl,videoUrl:he==="video"?It:K==null?void 0:K.videoUrl,mediaType:he,displayAsVideo:tt}),p({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),F(""),B(!1),J(0),t()},1e3)}catch(it){De.error(`Error uploading ${he}:`,it),p({title:"Upload failed",description:it.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1),J(0)}},Qe=async()=>{Z(!1);try{B(!0),await F5e(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:he==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:he==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),De.log(`Deleted ${he} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),p({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),B(!1),Ve(""),ke(!1),setTimeout(()=>{t()},500)}catch(it){De.error(`Error deleting ${he}:`,it),p({title:"Deletion failed",description:it.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},Ze=()=>{j||(A(null),F(""),J(0),t())},ut=it=>{me(it),se(it===0?"image":"video")};return I.jsxs(I.Fragment,{children:[I.jsxs(oc,{isOpen:n,onClose:Ze,size:"xl",children:[I.jsx(sc,{backdropFilter:"blur(10px)"}),I.jsxs(ac,{bg:"gray.800",color:"white",maxW:"900px",children:[I.jsx(Ou,{children:"Media Screen Content"}),I.jsx(el,{isDisabled:j}),I.jsxs(Ct,{px:6,pb:2,children:[I.jsxs(Ri,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[I.jsxs(Ai,{spacing:4,children:[I.jsx(ft,{fontWeight:"medium",children:"Display as:"}),I.jsxs(Ai,{spacing:2,children:[I.jsx(Hn,{as:qS,color:tt?"gray.400":"green.300"}),I.jsx(ig,{colorScheme:"purple",size:"md",isChecked:tt,onChange:xe}),I.jsx(Hn,{as:wO,color:tt?"purple.300":"gray.400"})]})]}),I.jsx(hp,{colorScheme:tt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:tt?"Video Output":"Image Output"})]}),I.jsxs(ft,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",I.jsx("strong",{children:s})]}),I.jsx(ft,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),I.jsx(vp,{mb:4})]}),I.jsx(ic,{children:I.jsxs(Ri,{children:[I.jsx(YR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ce,onChange:ut,h:"100%",minW:"120px",mr:4,children:I.jsxs(XR,{children:[I.jsxs(Cl,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[I.jsx(Hn,{as:qS,mr:2})," Image"]}),I.jsxs(Cl,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[I.jsx(Hn,{as:wO,mr:2})," Video"]})]})}),I.jsx(Ct,{flex:"1",children:de?I.jsx(Ri,{justify:"center",align:"center",h:"150px",children:I.jsx(kp,{size:"xl",color:"blue.400"})}):I.jsxs(I.Fragment,{children:[I.jsx(Ct,{children:ce===0?I.jsxs(di,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&he==="image"&&I.jsxs(Ct,{children:[I.jsx(ft,{fontWeight:"semibold",mb:2,children:"Current Image:"}),I.jsxs(Ri,{children:[I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:I.jsx(Fh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),I.jsxs(di,{align:"flex-start",spacing:2,children:[I.jsxs(ft,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),I.jsxs(ft,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),I.jsx(wi,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:I.jsx(Hn,{as:eR}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),I.jsx(vp,{my:4})]}),I.jsx(ft,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),I.jsxs(Ct,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:ee?"blue.400":"gray.500",bg:ee?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?I.jsx(Ct,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:I.jsx(Fh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):I.jsxs(di,{spacing:2,children:[I.jsx(Hn,{as:FV,boxSize:"24px",color:"gray.400"}),I.jsx(ft,{children:"Drag and drop an image here, or click to browse"}),I.jsx(ft,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),I.jsx(Ns,{type:"file",accept:"image/*",onChange:be,ref:E,display:"none"})]}),w&&I.jsxs(ft,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):I.jsxs(di,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&he==="video"&&I.jsxs(Ct,{children:[I.jsx(ft,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),I.jsxs(Ri,{children:[I.jsx(Ct,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:I.jsx(ft,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),I.jsxs(di,{align:"flex-start",spacing:2,children:[I.jsxs(ft,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),I.jsxs(ft,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),I.jsx(wi,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:I.jsx(Hn,{as:eR}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),I.jsx(vp,{my:4})]}),I.jsx(ft,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),I.jsx(Ct,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:I.jsxs(Ai,{children:[I.jsx(Hn,{as:O6e,color:"blue.300"}),I.jsx(ft,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),I.jsxs(Bi,{children:[I.jsx(tc,{fontSize:"sm",children:"Video URL"}),I.jsx(Ns,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Se,onChange:it=>Ve(it.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),I.jsx(ft,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),I.jsxs(Ct,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[I.jsxs(Ai,{children:[I.jsx(Hn,{as:wO,color:"blue.300"}),I.jsx(ft,{fontWeight:"medium",children:"Video Support"})]}),I.jsx(ft,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),I.jsx(ft,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Se&&I.jsxs(Ct,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[I.jsxs(Ai,{mb:2,children:[I.jsx(Hn,{as:k6e,color:"blue.300"}),I.jsx(ft,{fontWeight:"medium",children:"URL Preview"})]}),I.jsx(ft,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Se}),I.jsx(ft,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&I.jsxs(Ct,{mt:4,children:[I.jsxs(ft,{mb:2,children:["Uploading: ",G,"%"]}),I.jsx(u0,{value:G,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),I.jsxs(l0,{children:[I.jsx(wi,{variant:"ghost",mr:3,onClick:Ze,isDisabled:j,children:"Cancel"}),I.jsx(wi,{colorScheme:"blue",onClick:We,isLoading:j,loadingText:"Uploading",isDisabled:he==="image"&&!w||he==="video"&&!Se||j||de,leftIcon:I.jsx(Hn,{as:he==="image"?qS:wO}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),I.jsx(Pxe,{isOpen:_e,leastDestructiveRef:T,onClose:()=>Z(!1),children:I.jsx(sc,{children:I.jsxs(Oxe,{bg:"gray.800",color:"white",children:[I.jsxs(Ou,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),I.jsxs(ic,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),I.jsxs(l0,{children:[I.jsx(wi,{ref:T,onClick:()=>Z(!1),children:"Cancel"}),I.jsx(wi,{colorScheme:"red",onClick:Qe,ml:3,leftIcon:I.jsx(Hn,{as:eR}),children:"Delete"})]})]})})})]})},V6e=n=>{const[t,s]=L.useState(null),[a,l]=L.useState(""),[d,p]=L.useState(null),[E,v]=L.useState(!1),T=Dp(),{spaceID:w}=xl(),A=L.useCallback(j=>{var B,G;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let J="";return j.includes("youtube.com/watch")?J=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(J=j.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const J=(G=(B=j.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:G.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:j}return j}catch(J){return De.error("Error converting to embed URL:",J),j}},[]),N=L.useCallback(()=>{setTimeout(()=>{v(!1),De.log("Video processing state reset")},100)},[]);L.useEffect(()=>{let j=!0,B=null;const J=T("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:de}=K||{};if(!ne){De.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),De.log("Edit mode is active, setting media screen ID but not playing video"),p(ne);return}if(v(!0),B=setTimeout(()=>{j&&(De.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),de){if(console.log(`Using direct video URL from event: ${de}`),j)try{const oe=A(de);console.log(`Setting video URL to: ${oe} (original: ${de})`),s(oe),l(`Media Screen ${ne}`),p(ne),De.log("Media screen video URL set directly from event:",oe)}catch(oe){De.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const oe=await gp(w,ne);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){De.error("No video URL found for media screen:",ne),N(),clearTimeout(B);return}if(!oe.displayAsVideo){De.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(B);return}if(j)try{const _e=A(oe.videoUrl);console.log(`Setting video URL to: ${_e} (original: ${oe.videoUrl})`),s(_e),l(oe.title||`Media Screen ${ne}`),p(ne),De.log("Media screen video URL set to:",_e)}catch(_e){De.error("Error setting video URL from Firestore:",_e)}finally{N(),clearTimeout(B)}}catch(oe){De.error(`Error fetching media screen data for ${ne}:`,oe),N(),clearTimeout(B)}}catch(ne){De.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),N(),clearTimeout(B)}});return()=>{j=!1,B&&clearTimeout(B),J()}},[T,w,n,A,N]);const F=L.useCallback(()=>{s(null),l(""),p(null),v(!1),De.log("Video player state reset")},[]);return[t,a,d,F,E]},F6e=()=>{const{spaceID:n}=xl(),t=Pg(),s=Dp(),[a,l]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){De.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const T=()=>{De.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",T),()=>{window.removeEventListener("PlayerInstantiated",T)}},[]);const d=L.useCallback(async T=>{try{return T.includes("vimeo.com")?await p(T):T.includes("youtube.com")||T.includes("youtu.be")?E(T):"https://via.placeholder.com/640x360?text=Video"}catch(w){return De.error(`Error fetching thumbnail for ${T}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async T=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(T)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);return(await A.json()).thumbnail_url}catch(w){return De.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=T=>{let w="";if(T.includes("youtube.com/watch")?w=new URLSearchParams(new URL(T).search).get("v"):T.includes("youtu.be/")&&(w=T.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=L.useCallback(async T=>{try{if(!n||!T)return;console.log(`Refreshing thumbnail for media screen ${T}`);const w=await gp(n,T);if(!w){console.log(`No media screen found with ID ${T}`);return}if(console.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){console.log(`Media screen ${T} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:T,thumbnailUrl:A}),console.log(`Sent refreshed thumbnail for media screen ${T}`)}catch(w){console.error(`Error refreshing thumbnail for media screen ${T}:`,w)}},[n,d,t]);L.useEffect(()=>{if(!a){De.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}De.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=s("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:F}=A;F==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[s,v,a]),L.useEffect(()=>{if(!a){De.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}De.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const T=async()=>{try{if(!n)throw new Error("spaceID is not defined.");console.log("Fetching media screens for thumbnails...");const A=await A4(n);console.log("All media screens:",A);const N=A.filter(B=>B.displayAsVideo&&B.videoUrl);if(console.log("Media screens set to display as videos:",N),N.length===0){De.log("No media screens set to display as videos found.");return}De.log(`Found ${N.length} media screens set to display as videos.`);const F=N.map(async B=>{try{const G=await d(B.videoUrl);return{mediaScreenId:B.id,thumbnailUrl:G}}catch(G){return De.error(`Error processing thumbnail for media screen ${B.id}:`,G),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(F);De.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:B,thumbnailUrl:G})=>{t("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:G})})}catch(A){De.error("Error fetching media screen thumbnails:",A)}};T();const w=setInterval(T,5*60*1e3);return()=>{clearInterval(w)}},[t,n,d,a])},NJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},j6e=()=>I.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),B6e=({videoUrl:n,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Nd();return s1(a,`video-modal-${s}`),L.useEffect(()=>{if(a){const p=T=>{T.target.classList&&T.target.classList.contains("chakra-modal__overlay")&&(T.stopPropagation(),T.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(T){console.error("Error disabling Unity input:",T)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(T){console.error("Error re-enabling Unity input:",T)}}}},[a]),I.jsxs(I.Fragment,{children:[I.jsx(j6e,{}),I.jsxs(oc,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[I.jsx(sc,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),I.jsxs(ac,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[I.jsx(el,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),I.jsx(ic,{p:0,width:"100%",children:n?I.jsx(Ct,{className:"iframe-container",style:NJ.iframeContainer,children:I.jsx("iframe",{className:"video-iframe",src:n,style:NJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):I.jsxs(Ri,{direction:"column",align:"center",justify:"center",h:"400px",children:[I.jsx(kp,{size:"xl",mb:4}),I.jsx(ft,{children:"Unable to load video"}),I.jsx(ft,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Os=(...n)=>{},W6e=()=>{const{isOpen:n,onOpen:t,onClose:s}=bp(),[a,l]=L.useState(null),[d,p]=L.useState("image"),E=L.useRef(null);s1(n,"image-viewer-modal");const v=L.useCallback(A=>{A.stopPropagation()},[]);return L.useEffect(()=>{if(n&&E.current){const A=E.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const F=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),j=F?"image":N;console.log(`[DEBUG] Detected URL as ${F?"image":"non-image"}, using media type: ${j}`),l(A),p(j),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:E,preventPropagation:v}},z6e=()=>I.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),rU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Os(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},G6e=()=>{const{spaceID:n}=xl(),[t,s]=L.useState(!1),[a,l]=L.useState([]),[d,p]=L.useState(null),{isOpen:E,onOpen:v,onClose:T}=bp(),[w,A]=L.useState({}),[N,F]=L.useState(0);L.useRef(null);const j=Pg(),{fullscreenRef:B}=Nd(),G=Dp(),[J,K]=L.useState(!1),{isOpen:ne,currentImageUrl:de,currentMediaType:oe,openImageViewer:_e,closeImageViewer:Z,modalContentRef:ee,preventPropagation:te}=W6e(),[ce,me,he,se,Se]=V6e(t),{isOpen:Ve,onOpen:tt,onClose:ke}=bp();F6e(),Cse(),L.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Ie=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Ie),()=>{window.removeEventListener("PlayerInstantiated",Ie)}},[]);const Me=L.useCallback(Ie=>{if(Array.isArray(a)&&a.length>0){const be=a.find(xe=>xe.mediaScreenId===Ie);if(be){const xe=be.imageUrl,We=be.videoUrl;return{screen:be,imageUrl:xe,videoUrl:We,mediaType:be.mediaType||"image",displayAsVideo:be.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(de){let be=null;return Array.isArray(a)&&(be=a.find(xe=>xe.mediaScreenId===Ie)),{screen:be||{mediaScreenId:Ie},imageUrl:de,videoUrl:null,mediaType:(be==null?void 0:be.mediaType)||"image",displayAsVideo:(be==null?void 0:be.displayAsVideo)||!1}}return n&&Ie&&gp(n,Ie).then(be=>{be&&l(xe=>Array.isArray(xe)&&xe.some(Qe=>Qe.mediaScreenId===Ie)?xe.map(Qe=>Qe.mediaScreenId===Ie?{...Qe,imageUrl:be.imageUrl,videoUrl:be.videoUrl,mediaType:be.mediaType||"image",displayAsVideo:be.displayAsVideo||!1,hasImage:!!be.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Qe):[...Array.isArray(xe)?xe:[],{mediaScreenId:Ie,imageUrl:be.imageUrl,videoUrl:be.videoUrl,mediaType:be.mediaType||"image",displayAsVideo:be.displayAsVideo||!1,hasImage:!!be.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(be=>{console.error(`Error fetching media screen data for ${Ie}:`,be)}),console.warn("No screen data found for:",Ie),null},[a,de,n,l]),Ce=L.useCallback(Ie=>{if(console.log(`[DEBUG] Processing click on screen: ${Ie}, isEditMode: ${t}`),p(Ie),t)console.log(`[DEBUG] Opening upload modal for screen: ${Ie} in edit mode`),v();else{const be=Me(Ie);if(be){if(console.log(`[DEBUG] Screen data for ${Ie}:`,be),Os("Screen data details:",{mediaScreenId:Ie,imageUrl:be.imageUrl,videoUrl:be.videoUrl,mediaType:be.mediaType,displayAsVideo:be.displayAsVideo}),Ve&&he===Ie)return;if(be.displayAsVideo&&be.videoUrl)Os(`Opening video player for: ${be.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Ie,videoUrl:be.videoUrl});else if(be.imageUrl){Os(`Opening viewer modal with ${be.mediaType}: ${be.imageUrl}`);const We=rU(be.imageUrl);_e(We,be.mediaType||"image")}else n&&gp(n,Ie).then(We=>{if(We){if(We.displayAsVideo&&We.videoUrl)Os(`Opening video player for: ${We.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Ie,videoUrl:We.videoUrl});else if(We.imageUrl){Os(`Opening viewer modal with image: ${We.imageUrl}`);const Qe=rU(We.imageUrl);_e(Qe,We.mediaType||"image")}l(Qe=>Array.isArray(Qe)&&Qe.some(ut=>ut.mediaScreenId===Ie)?Qe.map(ut=>ut.mediaScreenId===Ie?{...ut,...We,mediaScreenId:Ie,source:"firestore-click",lastUpdated:new Date().toISOString()}:ut):[...Array.isArray(Qe)?Qe:[],{...We,mediaScreenId:Ie,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(We=>{console.error(`Error fetching media screen data for ${Ie}:`,We)})}else n&&gp(n,Ie).then(xe=>{if(xe){if(xe.displayAsVideo&&xe.videoUrl)Os(`Opening video player for: ${xe.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Ie,videoUrl:xe.videoUrl});else if(xe.imageUrl){Os(`Opening viewer modal with image: ${xe.imageUrl}`);const We=rU(xe.imageUrl);_e(We,xe.mediaType||"image")}l(We=>Array.isArray(We)&&We.some(Ze=>Ze.mediaScreenId===Ie)?We.map(Ze=>Ze.mediaScreenId===Ie?{...Ze,...xe,mediaScreenId:Ie,source:"firestore-click",lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(We)?We:[],{...xe,mediaScreenId:Ie,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(xe=>{console.error(`Error fetching media screen data for ${Ie}:`,xe)})}},[t,v,Me,Ve,he,j,_e,n]);L.useEffect(()=>{if(!J)return;const Ie=async()=>{if(n)try{const xe=await A4(n),We={};xe.forEach(Qe=>{Qe.id&&Qe.imageUrl&&(We[Qe.id]=Qe.imageUrl)}),l(Qe=>Qe.map(Ze=>{const ut=!!We[Ze.mediaScreenId],it=We[Ze.mediaScreenId],It=Ze.mediaType||"image";return{...Ze,hasImage:ut,imageUrl:it,mediaType:It}}))}catch(xe){console.error("Error fetching media screen images:",xe)}};Ie();let be=null;return t&&(be=setInterval(Ie,5e3)),()=>{be&&clearInterval(be)}},[n,t,N,J]);const Xe=Ie=>{l(be=>be.map(xe=>{if(xe.mediaScreenId===Ie.mediaScreenId){if(Ie.type==="upload")return{...xe,hasImage:!0,imageUrl:Ie.imageUrl,mediaType:Ie.mediaType||"image"};if(Ie.type==="delete")return{...xe,hasImage:!1,imageUrl:null,mediaType:null}}return xe})),Ie.type==="delete"?(setTimeout(()=>{l(be=>be.filter(xe=>xe.mediaScreenId!==Ie.mediaScreenId))},100),setTimeout(()=>{l(be=>be.filter(xe=>xe.mediaScreenId!==Ie.mediaScreenId))},1500)):setTimeout(()=>{l(be=>be.some(We=>We.mediaScreenId===Ie.mediaScreenId)?be.map(We=>We.mediaScreenId===Ie.mediaScreenId?{...We,imageUrl:Ie.imageUrl,hasImage:!0,mediaType:Ie.mediaType||"image"}:We):[...be,{mediaScreenId:Ie.mediaScreenId,imageUrl:Ie.imageUrl,hasImage:!0,mediaType:Ie.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};L.useEffect(()=>{const Ie=be=>{const xe=be.detail.enabled;s(xe),xe?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Ie),()=>{window.removeEventListener("editModeChanged",Ie)}},[j]),L.useEffect(()=>(window.JsSendMediaScreenClick=function(Ie){console.log("Unity: MediaScreenClick received with data:",Ie);try{const be=JSON.parse(Ie),xe=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(be)});window.dispatchEvent(xe)}catch(be){console.error("Error processing MediaScreenClick data:",be)}},window.handleMediaScreenClick=function(Ie){console.log("Direct call to handleMediaScreenClick with ID:",Ie),Ce(Ie)},window.TestJavaScriptFromUnity=function(Ie){console.log("Unity called TestJavaScriptFromUnity with:",Ie),alert("Unity called JavaScript: "+Ie)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Ce]),L.useEffect(()=>{const Ie=We=>{try{const Qe=JSON.parse(We.detail);De.log(`MediaScreen registered: ${Qe.mediaScreenId}`),Os("MediaScreen registered from Unity:",Qe),l(ut=>ut.some(It=>It.mediaScreenId===Qe.mediaScreenId)?ut.map(It=>It.mediaScreenId===Qe.mediaScreenId?{...It,...Qe,source:"event",lastUpdated:new Date().toISOString()}:It):[...ut,{...Qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:Qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const Ze=Qe.mediaScreenId;Ze&&gp(n,Ze).then(ut=>{ut&&(Os(`Media screen data for ${Ze}:`,ut),ut.displayAsVideo&&ut.videoUrl&&(Os(`Media screen ${Ze} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:Ze,imageUrl:null,displayAsVideo:!0})))}).catch(ut=>{console.error(`Error fetching media screen data for ${Ze}:`,ut)})}catch(Qe){console.error("Error handling MediaScreen registration:",Qe)}},be=We=>{try{Os("MediaScreenClick event received:",We);let Qe;if(typeof We=="string")Qe=We,Os("MediaScreenClick: Direct call with ID:",Qe);else{Os("MediaScreenClick: Event from Unity:",We),Os("MediaScreenClick: Event detail:",We.detail);try{Qe=JSON.parse(We.detail).mediaScreenId,Os("MediaScreenClick: Parsed mediaScreenId:",Qe)}catch(Ze){if(console.error("MediaScreenClick: Error parsing event detail:",Ze),We.detail&&We.detail.mediaScreenId)Qe=We.detail.mediaScreenId,Os("MediaScreenClick: Using direct mediaScreenId from detail:",Qe);else throw new Error("Could not extract mediaScreenId from event")}}De.log(`MediaScreen clicked: ${Qe}`),Os("MediaScreen clicked:",Qe),Ce(Qe)}catch(Qe){console.error("Error handling MediaScreen click:",Qe)}},xe=We=>{if(We.detail&&We.detail.eventName==="RegisterMediaScreen")Ie({detail:We.detail.eventData});else if(We.detail&&We.detail.eventName==="MediaScreenClick")be({detail:We.detail.eventData});else if(We.detail&&We.detail.eventName==="SetMediaScreenImage")try{const Qe=JSON.parse(We.detail.eventData);Qe.mediaScreenId&&(Os("SetMediaScreenImage event received:",Qe),l(Ze=>Array.isArray(Ze)&&Ze.some(it=>it.mediaScreenId===Qe.mediaScreenId)?Ze.map(it=>it.mediaScreenId===Qe.mediaScreenId?{...it,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:it):[...Array.isArray(Ze)?Ze:[],{mediaScreenId:Qe.mediaScreenId,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Qe){console.error("Error handling SetMediaScreenImage event:",Qe)}};return window.addEventListener("RegisterMediaScreen",Ie),window.addEventListener("MediaScreenClick",be),window.addEventListener("reactUnityEvent",xe),()=>{window.removeEventListener("RegisterMediaScreen",Ie),window.removeEventListener("MediaScreenClick",be),window.removeEventListener("reactUnityEvent",xe)}},[t,v,j,a,ne,Ve,_e,Ce,n]),L.useEffect(()=>{const Ie=be=>{try{Os("Direct MediaScreenClick event received:",be);let xe;if(be.detail)try{xe=JSON.parse(be.detail).mediaScreenId}catch(We){console.error("Error parsing MediaScreenClick event detail:",We);return}if(!xe){console.error("No mediaScreenId found in MediaScreenClick event");return}Os(`Direct handler: Processing click for media screen ${xe}`),Ce(xe)}catch(xe){console.error("Error in direct MediaScreenClick handler:",xe)}};return window.addEventListener("MediaScreenClick",Ie),()=>{window.removeEventListener("MediaScreenClick",Ie)}},[Ce]),L.useEffect(()=>{ce&&tt()},[ce,tt]);const Ae=()=>{se(),ke()};return L.useEffect(()=>{const be=G("RegisterMediaScreen",xe=>{try{if(De.log("Direct RegisterMediaScreen event received with data:",xe),!xe||!xe.mediaScreenId){De.warn("RegisterMediaScreen event received with invalid data");return}const We=xe.mediaScreenId;De.log(`Media screen registered directly: ${We}`),l(Qe=>Qe.some(ut=>ut.mediaScreenId===We)?Qe.map(ut=>ut.mediaScreenId===We?{...ut,...xe,source:"direct-event",lastUpdated:new Date().toISOString()}:ut):[...Qe,{...xe,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:We,enabled:!0,showUploadIcon:!0})}catch(We){console.error("Error handling direct RegisterMediaScreen event:",We)}});return()=>{be()}},[G,t,j]),L.useEffect(()=>{const be=G("MediaScreenClick",xe=>{try{if(De.log("Direct MediaScreenClick event received with data:",xe),!xe||!xe.mediaScreenId){De.warn("MediaScreenClick event received with invalid data");return}const We=xe.mediaScreenId;De.log(`Media screen clicked directly: ${We}`),Ce(We)}catch(We){console.error("Error handling direct MediaScreenClick event:",We)}});return()=>{be()}},[G,Ce]),L.useEffect(()=>{t&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),p(he),v(),se())},[t,he,v,se]),I.jsxs(I.Fragment,{children:[I.jsx(U6e,{isOpen:E,onClose:T,mediaScreenId:d,onImageChange:Xe}),I.jsx(z6e,{}),I.jsx(Ll,{containerRef:B,children:I.jsxs(oc,{isOpen:ne,onClose:Z,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[I.jsx(sc,{bg:"rgba(0, 0, 0, 0.8)",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te}),I.jsxs(ac,{ref:ee,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te,children:[I.jsx(el,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),I.jsx(ic,{p:0,width:"100%",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te,children:de?I.jsx(Ct,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te,children:oe==="image"?I.jsx(Fh,{src:de,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",de),onError:Ie=>console.error("Error loading image:",Ie,de),onClick:te}):I.jsxs(Ct,{width:"100%",textAlign:"center",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te,children:[I.jsx(ft,{mb:4,fontSize:"lg",children:"Video URL:"}),I.jsx(ft,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:de}),I.jsx(ft,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):I.jsx(Ri,{direction:"column",align:"center",justify:"center",h:"400px",onClick:te,onMouseMove:te,onMouseDown:te,onMouseUp:te,onWheel:te,children:I.jsx(ft,{children:"No image available"})})})]})]})}),I.jsx(B6e,{videoUrl:ce,videoTitle:me,mediaScreenId:he,isOpen:Ve,onClose:Ae})]})},Vse=({backgroundUrl:n=null,containerRef:t})=>{const[s,a]=L.useState(!1),[l,d]=L.useState(n),p=L.useRef(null),E=L.useRef(null);return L.useEffect(()=>{const v=T=>{const{backgroundUrl:w}=T.detail;d(w),p.current&&(w?(p.current.style.backgroundImage=`url('${w}')`,p.current.style.display="block",E.current&&(E.current.style.display="block")):(p.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),L.useEffect(()=>{d(n),p.current&&n!==l&&(p.current.style.backgroundImage=`url('${n}')`)},[n]),L.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");p.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const T=document.createElement("div");E.current=T,Object.assign(T.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(T);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",T.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Id.subscribe(Cd.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Id.unsubscribe(Cd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)}}},[l,t]),null};Vse.propTypes={backgroundUrl:vr.string,containerRef:vr.shape({current:vr.instanceOf(Element)})};const Fse=({containerRef:n})=>{const{spaceID:t}=xl(),[s,a]=L.useState(!1),[l,d]=L.useState(!1),[p,E]=L.useState(0),[v,T]=L.useState("Initialising World"),[w,A]=L.useState(null),N=L.useRef(null),F=L.useRef(null),j=L.useRef(null);return L.useEffect(()=>{(async()=>{if(t)try{const G=await ug(t);G&&G.logoUrl&&A(G.logoUrl)}catch(G){console.error("Error fetching space logo:",G)}})()},[t]),L.useEffect(()=>{const B=G=>{const{logoUrl:J}=G.detail;A(J),F.current&&(J?(F.current.src=J,j.current.style.display="flex"):j.current.style.display="none")};return window.addEventListener("SpaceLogoUpdated",B),()=>{window.removeEventListener("SpaceLogoUpdated",B)}},[]),L.useEffect(()=>{if(!n||!n.current)return;const B=document.createElement("div");if(N.current=B,Object.assign(B.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){const he=document.createElement("div");j.current=he,Object.assign(he.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const se=document.createElement("img");F.current=se,se.src=w,se.alt="Space Logo",se.style.maxHeight="100px",se.style.maxWidth="100%",se.style.objectFit="contain",se.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",he.appendChild(se),n.current.appendChild(he)}const G=document.createElement("style");G.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(G);const J=document.createElement("div");J.style.fontSize="16px",J.style.fontWeight="bold",J.style.textAlign="center",J.style.marginBottom="16px",J.style.color="#ffffff",J.textContent="Initialising World";const K=document.createElement("div");K.style.width="100%",K.style.height="12px",K.style.backgroundColor="rgba(255, 255, 255, 0.2)",K.style.borderRadius="6px",K.style.overflow="hidden",K.style.position="relative",K.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const ne=document.createElement("div");ne.style.height="100%",ne.style.width="0%",ne.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",ne.style.backgroundSize="200% 200%",ne.style.animation="progress-glow 2s ease infinite",ne.style.transition="width 0.5s ease-out",ne.style.borderRadius="6px",ne.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",K.appendChild(ne);const de=document.createElement("div");de.style.marginTop="8px",de.style.fontSize="14px",de.style.fontWeight="bold",de.style.color="#ffffff",de.textContent="0%",B.appendChild(J),B.appendChild(K),B.appendChild(de),n.current.appendChild(B);const oe=he=>{E(he),ne.style.width=`${Math.round(he*100)}%`,de.textContent=`${Math.round(he*100)}%`},_e=he=>{T(he),J.textContent=he},Z=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];_e(Z[0].stage),oe(.05);const ee=he=>{const se=he.detail.progress;oe(se),se<.33?_e(Z[0].stage):se<.66?_e(Z[1].stage):_e(Z[2].stage)},te=()=>{console.log("PersistentLoader: First scene loaded event received"),a(!0),_e(Z[1].stage),oe(.66)},ce=()=>{console.log("PersistentLoader: Player instantiated event received"),me&&clearInterval(me),window.removeEventListener("UnityProgress",ee),d(!0),_e(Z[2].stage),ne.style.width="100%",de.textContent="100%",setTimeout(()=>{B.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{n.current&&(n.current.contains(B)&&n.current.removeChild(B),j.current&&n.current.contains(j.current)&&n.current.removeChild(j.current))},1500)},1e3)};let me=null;if(!window.isPlayerInstantiated){let he=.05;me=setInterval(()=>{!s&&!l?(he+=.01,he>.6&&(he=.6,clearInterval(me),me=null),oe(he),he<.33?_e(Z[0].stage):he<.66&&_e(Z[1].stage)):(clearInterval(me),me=null)},200)}if(window.isPlayerInstantiated)console.log("PersistentLoader: Player was already instantiated"),ce();else{window.addEventListener("UnityProgress",ee),Id.subscribe(Cd.firstSceneLoaded,te),window.addEventListener("FirstSceneLoaded",te),Id.subscribe(Cd.playerInstantiated,ce),window.addEventListener("PlayerInstantiated",ce);const he=setTimeout(()=>{console.log("PersistentLoader: Forcing loader removal after timeout"),ce()},3e4);return()=>{window.removeEventListener("UnityProgress",ee),Id.unsubscribe(Cd.firstSceneLoaded,te),window.removeEventListener("FirstSceneLoaded",te),Id.unsubscribe(Cd.playerInstantiated,ce),window.removeEventListener("PlayerInstantiated",ce),clearTimeout(he),n.current&&(B&&n.current.contains(B)&&n.current.removeChild(B),j.current&&n.current.contains(j.current)&&n.current.removeChild(j.current)),document.head.contains(G)&&document.head.removeChild(G)}}},[n,w]),null};Fse.propTypes={containerRef:vr.shape({current:vr.instanceOf(Element)})};const H6e="a2a7f4eb05284449b1063eb71d8301dc",P4=L.forwardRef(({settings:n},t)=>{const{unityProvider:s,isLoaded:a}=xl(),l=L5e();M5e();const d=Pg(),p=W5e(l),{user:E}=L.useContext(xa),[v,T]=L.useState(!1),[w,A]=L.useState(window.devicePixelRatio),[N,F]=V5e();Rse().find(Se=>Se.isLocalPlayer);const[B,G]=L.useState(!0),[J,K]=L.useState(!0),[ne,de]=L.useState(!1),oe=n.spaceID||"default",_e=L.useMemo(()=>{const tt=new URLSearchParams(window.location.search).get("sessionId")||oe;return console.log("WebGLRenderer: Using session ID:",tt),tt},[oe]),[Z,ee]=L.useState(null);L.useEffect(()=>{E!=null&&E.uid&&nf(E.uid).then(Se=>{ee(Se),console.log("WebGLRenderer: User profile loaded:",(Se==null?void 0:Se.Nickname)||"Unknown")}).catch(Se=>{console.error("Error fetching user profile:",Se)})},[E==null?void 0:E.uid]),L.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Se=()=>{console.log("WebGLRenderer: Player instantiated event received"),K(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),K(!0)),Id.subscribe(Cd.playerInstantiated,Se);const Ve=setTimeout(()=>{J||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),K(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Id.unsubscribe(Cd.playerInstantiated,Se),clearTimeout(Ve)}},[J]),L.useEffect(()=>{a||l?setTimeout(()=>{T(!0),De.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):De.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,l]),L.useEffect(()=>{const Se=Ve=>{De.log("WebGLRenderer: Received 'sendUserToUnity' event"),d("FirebaseUserFromReact",Ve)};return Id.subscribe(Cd.sendUserToUnity,Se),()=>Id.unsubscribe(Cd.sendUserToUnity,Se)},[d]);const{setFullscreenRef:te,fullscreenRef:ce}=Nd();L.useEffect(()=>{te(t.current)},[t,te]);const me=()=>{G(!B)},he=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:J,showVoiceChat:he,sessionId:_e}),L.useEffect(()=>{const Se=Ve=>{de(Ve.detail.enabled)};return window.addEventListener("editModeChanged",Se),()=>{window.removeEventListener("editModeChanged",Se)}},[]),Cse(),U5e();const se=L.useRef(null);return I.jsxs(Ct,{className:"webgl-renderer",children:[n.urlLoadingBackground&&I.jsx(Vse,{backgroundUrl:n.urlLoadingBackground,containerRef:se}),I.jsx(Fse,{containerRef:se}),I.jsx(sF,{containerRef:ce.current?ce:document.body,children:I.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[I.jsxs(Ct,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&I.jsx(G5e,{}),he&&I.jsxs(Mse,{appId:H6e,channel:_e,uid:E==null?void 0:E.uid,enabled:!0,children:[I.jsx(S6e,{size:"md",defaultMuted:!0,joinOnClick:!0}),I.jsx(b6e,{userNickname:Z==null?void 0:Z.Nickname})]}),I.jsx(c6e,{}),I.jsx(Ct,{position:"relative",zIndex:"9999",children:I.jsx(M6e,{onTogglePlayerList:me,spaceID:oe})})]}),I.jsxs(Ct,{ref:se,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[I.jsx(Ct,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),I.jsx(Ct,{...p,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:I.jsx(bse.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:w})}),I.jsx(Ct,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:I.jsx(z5e,{})})]}),I.jsx(Ct,{...p,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&I.jsx(Fh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),I.jsx(Ct,{...p,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),I.jsxs(Ct,{...p,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&I.jsx(H5e,{}),I.jsx(d6e,{})]}),I.jsx(h6e,{}),I.jsx(f6e,{isOpen:N!==null,onClose:()=>{console.log(" Closing nameplate modal"),F()},playerName:(N==null?void 0:N.playerName)||"Unknown Player",playerId:(N==null?void 0:N.playerId)||"Unknown ID"}),I.jsx(p6e,{isVisible:B,onToggleVisibility:G,spaceID:oe}),I.jsx(G6e,{})]})})]})});P4.displayName="WebGLRenderer";P4.propTypes={settings:vr.shape({urlLoadingBackground:vr.string,showAuthButton:vr.bool,showDisruptiveLogo:vr.bool,urlDisruptiveLogo:vr.string,showHelpButton:vr.bool,enableVoiceChat:vr.bool,spaceID:vr.string})};const O4=({spaceID:n,overrideSettings:t})=>{const s=L.useRef(null),[a,l]=L.useState(!0),[d,p]=L.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=L.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return L.useEffect(()=>{(async()=>{try{const w=await ug(n);if(w){p(F=>({...F,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await sk(E.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await sk(w.backgroundGsUrl)}catch(F){De.warn("WebGLLoader: Error fetching background from GS URL:",F)}else if(w.gsUrlLoadingBackground)try{N=await sk(w.gsUrlLoadingBackground)}catch(F){De.warn("WebGLLoader: Error fetching background from legacy GS URL:",F)}v(F=>({...F,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...t||{}})),l(!1)}else De.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){De.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,E.urlDisruptiveLogo,t]),L.useEffect(()=>{a||(De.log("WebGLLoader: Unity config from Firebase",d),De.log("WebGLLoader: Space settings from Firebase",E))},[a]),I.jsx(I.Fragment,{children:a?I.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):I.jsx(D5e,{...d,children:I.jsx(P4,{ref:s,settings:E})})})};O4.propTypes={spaceID:vr.string.isRequired,overrideSettings:vr.object};const RO=document.getElementById("webgl-root");if(RO){const n=RO.getAttribute("data-space-id"),t=RO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=L.useState(null);return L.useEffect(()=>{yR(t).then(l)},[]),a?I.jsx(gN,{theme:a,children:I.jsx(r1,{children:I.jsx(v4,{children:I.jsx(O4,{spaceID:n})})})}):I.jsx("div",{children:"Loading theme..."})};Jk.createRoot(RO).render(I.jsx(s,{}))}else console.error("Root element 'webgl-root' not found.");const $6e=(n,t)=>{try{const s=OR(Ks,`spaces/${n}/chatMessages`),a=new Date,l=kV(s,_3e("timestamp","asc"),E3e(a));return Bie(l,d=>{const p=[];d.docChanges().forEach(E=>{if(E.type==="added"){const v=E.doc.data();console.log("Firestore document data:",v),p.push({id:E.doc.id,...v})}}),p.length>0&&t(p)})}catch(s){throw De.error("Error subscribing to space chat messages:",s),s}};function Dd(n){const t=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&t==="[object Date]"?new n.constructor(+n):typeof n=="number"||t==="[object Number]"||typeof n=="string"||t==="[object String]"?new Date(n):new Date(NaN)}function LE(n,t){return n instanceof Date?new n.constructor(t):new Date(t)}const jse=6048e5,K6e=864e5;let q6e={};function a1(){return q6e}function DR(n,t){var E,v,T,w;const s=a1(),a=(t==null?void 0:t.weekStartsOn)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.weekStartsOn)??s.weekStartsOn??((w=(T=s.locale)==null?void 0:T.options)==null?void 0:w.weekStartsOn)??0,l=Dd(n),d=l.getDay(),p=(d<a?7:0)+d-a;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function Xk(n){return DR(n,{weekStartsOn:1})}function Bse(n){const t=Dd(n),s=t.getFullYear(),a=LE(n,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const l=Xk(a),d=LE(n,0);d.setFullYear(s,0,4),d.setHours(0,0,0,0);const p=Xk(d);return t.getTime()>=l.getTime()?s+1:t.getTime()>=p.getTime()?s:s-1}function DJ(n){const t=Dd(n);return t.setHours(0,0,0,0),t}function LJ(n){const t=Dd(n),s=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return s.setUTCFullYear(t.getFullYear()),+n-+s}function Y6e(n,t){const s=DJ(n),a=DJ(t),l=+s-LJ(s),d=+a-LJ(a);return Math.round((l-d)/K6e)}function X6e(n){const t=Bse(n),s=LE(n,0);return s.setFullYear(t,0,4),s.setHours(0,0,0,0),Xk(s)}function J6e(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Q6e(n){if(!J6e(n)&&typeof n!="number")return!1;const t=Dd(n);return!isNaN(Number(t))}function Z6e(n){const t=Dd(n),s=LE(n,0);return s.setFullYear(t.getFullYear(),0,1),s.setHours(0,0,0,0),s}const eWe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},tWe=(n,t,s)=>{let a;const l=eWe[n];return typeof l=="string"?a=l:t===1?a=l.one:a=l.other.replace("{{count}}",t.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+a:a+" ago":a};function iU(n){return(t={})=>{const s=t.width?String(t.width):n.defaultWidth;return n.formats[s]||n.formats[n.defaultWidth]}}const nWe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},rWe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},iWe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},sWe={date:iU({formats:nWe,defaultWidth:"full"}),time:iU({formats:rWe,defaultWidth:"full"}),dateTime:iU({formats:iWe,defaultWidth:"full"})},oWe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},aWe=(n,t,s,a)=>oWe[n];function gw(n){return(t,s)=>{const a=s!=null&&s.context?String(s.context):"standalone";let l;if(a==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,E=s!=null&&s.width?String(s.width):p;l=n.formattingValues[E]||n.formattingValues[p]}else{const p=n.defaultWidth,E=s!=null&&s.width?String(s.width):n.defaultWidth;l=n.values[E]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(t):t;return l[d]}}const cWe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},lWe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uWe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dWe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},fWe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pWe=(n,t)=>{const s=Number(n),a=s%100;if(a>20||a<10)switch(a%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},mWe={ordinalNumber:pWe,era:gw({values:cWe,defaultWidth:"wide"}),quarter:gw({values:lWe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:gw({values:uWe,defaultWidth:"wide"}),day:gw({values:dWe,defaultWidth:"wide"}),dayPeriod:gw({values:hWe,defaultWidth:"wide",formattingValues:fWe,defaultFormattingWidth:"wide"})};function _w(n){return(t,s={})=>{const a=s.width,l=a&&n.matchPatterns[a]||n.matchPatterns[n.defaultMatchWidth],d=t.match(l);if(!d)return null;const p=d[0],E=a&&n.parsePatterns[a]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(E)?_We(E,A=>A.test(p)):gWe(E,A=>A.test(p));let T;T=n.valueCallback?n.valueCallback(v):v,T=s.valueCallback?s.valueCallback(T):T;const w=t.slice(p.length);return{value:T,rest:w}}}function gWe(n,t){for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)&&t(n[s]))return s}function _We(n,t){for(let s=0;s<n.length;s++)if(t(n[s]))return s}function EWe(n){return(t,s={})=>{const a=t.match(n.matchPattern);if(!a)return null;const l=a[0],d=t.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=s.valueCallback?s.valueCallback(p):p;const E=t.slice(l.length);return{value:p,rest:E}}}const yWe=/^(\d+)(th|st|nd|rd)?/i,vWe=/\d+/i,SWe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},TWe={any:[/^b/i,/^(a|c)/i]},bWe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},wWe={any:[/1/i,/2/i,/3/i,/4/i]},RWe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},CWe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},IWe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},AWe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},PWe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},OWe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},kWe={ordinalNumber:EWe({matchPattern:yWe,parsePattern:vWe,valueCallback:n=>parseInt(n,10)}),era:_w({matchPatterns:SWe,defaultMatchWidth:"wide",parsePatterns:TWe,defaultParseWidth:"any"}),quarter:_w({matchPatterns:bWe,defaultMatchWidth:"wide",parsePatterns:wWe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:_w({matchPatterns:RWe,defaultMatchWidth:"wide",parsePatterns:CWe,defaultParseWidth:"any"}),day:_w({matchPatterns:IWe,defaultMatchWidth:"wide",parsePatterns:AWe,defaultParseWidth:"any"}),dayPeriod:_w({matchPatterns:PWe,defaultMatchWidth:"any",parsePatterns:OWe,defaultParseWidth:"any"})},NWe={code:"en-US",formatDistance:tWe,formatLong:sWe,formatRelative:aWe,localize:mWe,match:kWe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function DWe(n){const t=Dd(n);return Y6e(t,Z6e(t))+1}function LWe(n){const t=Dd(n),s=+Xk(t)-+X6e(t);return Math.round(s/jse)+1}function Wse(n,t){var w,A,N,F;const s=Dd(n),a=s.getFullYear(),l=a1(),d=(t==null?void 0:t.firstWeekContainsDate)??((A=(w=t==null?void 0:t.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??l.firstWeekContainsDate??((F=(N=l.locale)==null?void 0:N.options)==null?void 0:F.firstWeekContainsDate)??1,p=LE(n,0);p.setFullYear(a+1,0,d),p.setHours(0,0,0,0);const E=DR(p,t),v=LE(n,0);v.setFullYear(a,0,d),v.setHours(0,0,0,0);const T=DR(v,t);return s.getTime()>=E.getTime()?a+1:s.getTime()>=T.getTime()?a:a-1}function xWe(n,t){var E,v,T,w;const s=a1(),a=(t==null?void 0:t.firstWeekContainsDate)??((v=(E=t==null?void 0:t.locale)==null?void 0:E.options)==null?void 0:v.firstWeekContainsDate)??s.firstWeekContainsDate??((w=(T=s.locale)==null?void 0:T.options)==null?void 0:w.firstWeekContainsDate)??1,l=Wse(n,t),d=LE(n,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),DR(d,t)}function MWe(n,t){const s=Dd(n),a=+DR(s,t)-+xWe(s,t);return Math.round(a/jse)+1}function ui(n,t){const s=n<0?"-":"",a=Math.abs(n).toString().padStart(t,"0");return s+a}const Gm={y(n,t){const s=n.getFullYear(),a=s>0?s:1-s;return ui(t==="yy"?a%100:a,t.length)},M(n,t){const s=n.getMonth();return t==="M"?String(s+1):ui(s+1,2)},d(n,t){return ui(n.getDate(),t.length)},a(n,t){const s=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(n,t){return ui(n.getHours()%12||12,t.length)},H(n,t){return ui(n.getHours(),t.length)},m(n,t){return ui(n.getMinutes(),t.length)},s(n,t){return ui(n.getSeconds(),t.length)},S(n,t){const s=t.length,a=n.getMilliseconds(),l=Math.trunc(a*Math.pow(10,s-3));return ui(l,t.length)}},fS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},xJ={G:function(n,t,s){const a=n.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return s.era(a,{width:"abbreviated"});case"GGGGG":return s.era(a,{width:"narrow"});case"GGGG":default:return s.era(a,{width:"wide"})}},y:function(n,t,s){if(t==="yo"){const a=n.getFullYear(),l=a>0?a:1-a;return s.ordinalNumber(l,{unit:"year"})}return Gm.y(n,t)},Y:function(n,t,s,a){const l=Wse(n,a),d=l>0?l:1-l;if(t==="YY"){const p=d%100;return ui(p,2)}return t==="Yo"?s.ordinalNumber(d,{unit:"year"}):ui(d,t.length)},R:function(n,t){const s=Bse(n);return ui(s,t.length)},u:function(n,t){const s=n.getFullYear();return ui(s,t.length)},Q:function(n,t,s){const a=Math.ceil((n.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return ui(a,2);case"Qo":return s.ordinalNumber(a,{unit:"quarter"});case"QQQ":return s.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,t,s){const a=Math.ceil((n.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return ui(a,2);case"qo":return s.ordinalNumber(a,{unit:"quarter"});case"qqq":return s.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,t,s){const a=n.getMonth();switch(t){case"M":case"MM":return Gm.M(n,t);case"Mo":return s.ordinalNumber(a+1,{unit:"month"});case"MMM":return s.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(a,{width:"wide",context:"formatting"})}},L:function(n,t,s){const a=n.getMonth();switch(t){case"L":return String(a+1);case"LL":return ui(a+1,2);case"Lo":return s.ordinalNumber(a+1,{unit:"month"});case"LLL":return s.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(a,{width:"wide",context:"standalone"})}},w:function(n,t,s,a){const l=MWe(n,a);return t==="wo"?s.ordinalNumber(l,{unit:"week"}):ui(l,t.length)},I:function(n,t,s){const a=LWe(n);return t==="Io"?s.ordinalNumber(a,{unit:"week"}):ui(a,t.length)},d:function(n,t,s){return t==="do"?s.ordinalNumber(n.getDate(),{unit:"date"}):Gm.d(n,t)},D:function(n,t,s){const a=DWe(n);return t==="Do"?s.ordinalNumber(a,{unit:"dayOfYear"}):ui(a,t.length)},E:function(n,t,s){const a=n.getDay();switch(t){case"E":case"EE":case"EEE":return s.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(a,{width:"short",context:"formatting"});case"EEEE":default:return s.day(a,{width:"wide",context:"formatting"})}},e:function(n,t,s,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(d);case"ee":return ui(d,2);case"eo":return s.ordinalNumber(d,{unit:"day"});case"eee":return s.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(l,{width:"short",context:"formatting"});case"eeee":default:return s.day(l,{width:"wide",context:"formatting"})}},c:function(n,t,s,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(d);case"cc":return ui(d,t.length);case"co":return s.ordinalNumber(d,{unit:"day"});case"ccc":return s.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(l,{width:"narrow",context:"standalone"});case"cccccc":return s.day(l,{width:"short",context:"standalone"});case"cccc":default:return s.day(l,{width:"wide",context:"standalone"})}},i:function(n,t,s){const a=n.getDay(),l=a===0?7:a;switch(t){case"i":return String(l);case"ii":return ui(l,t.length);case"io":return s.ordinalNumber(l,{unit:"day"});case"iii":return s.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(a,{width:"short",context:"formatting"});case"iiii":default:return s.day(a,{width:"wide",context:"formatting"})}},a:function(n,t,s){const l=n.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,t,s){const a=n.getHours();let l;switch(a===12?l=fS.noon:a===0?l=fS.midnight:l=a/12>=1?"pm":"am",t){case"b":case"bb":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,t,s){const a=n.getHours();let l;switch(a>=17?l=fS.evening:a>=12?l=fS.afternoon:a>=4?l=fS.morning:l=fS.night,t){case"B":case"BB":case"BBB":return s.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,t,s){if(t==="ho"){let a=n.getHours()%12;return a===0&&(a=12),s.ordinalNumber(a,{unit:"hour"})}return Gm.h(n,t)},H:function(n,t,s){return t==="Ho"?s.ordinalNumber(n.getHours(),{unit:"hour"}):Gm.H(n,t)},K:function(n,t,s){const a=n.getHours()%12;return t==="Ko"?s.ordinalNumber(a,{unit:"hour"}):ui(a,t.length)},k:function(n,t,s){let a=n.getHours();return a===0&&(a=24),t==="ko"?s.ordinalNumber(a,{unit:"hour"}):ui(a,t.length)},m:function(n,t,s){return t==="mo"?s.ordinalNumber(n.getMinutes(),{unit:"minute"}):Gm.m(n,t)},s:function(n,t,s){return t==="so"?s.ordinalNumber(n.getSeconds(),{unit:"second"}):Gm.s(n,t)},S:function(n,t){return Gm.S(n,t)},X:function(n,t,s){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(t){case"X":return UJ(a);case"XXXX":case"XX":return iE(a);case"XXXXX":case"XXX":default:return iE(a,":")}},x:function(n,t,s){const a=n.getTimezoneOffset();switch(t){case"x":return UJ(a);case"xxxx":case"xx":return iE(a);case"xxxxx":case"xxx":default:return iE(a,":")}},O:function(n,t,s){const a=n.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+MJ(a,":");case"OOOO":default:return"GMT"+iE(a,":")}},z:function(n,t,s){const a=n.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+MJ(a,":");case"zzzz":default:return"GMT"+iE(a,":")}},t:function(n,t,s){const a=Math.trunc(n.getTime()/1e3);return ui(a,t.length)},T:function(n,t,s){const a=n.getTime();return ui(a,t.length)}};function MJ(n,t=""){const s=n>0?"-":"+",a=Math.abs(n),l=Math.trunc(a/60),d=a%60;return d===0?s+String(l):s+String(l)+t+ui(d,2)}function UJ(n,t){return n%60===0?(n>0?"-":"+")+ui(Math.abs(n)/60,2):iE(n,t)}function iE(n,t=""){const s=n>0?"-":"+",a=Math.abs(n),l=ui(Math.trunc(a/60),2),d=ui(a%60,2);return s+l+t+d}const VJ=(n,t)=>{switch(n){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},zse=(n,t)=>{switch(n){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},UWe=(n,t)=>{const s=n.match(/(P+)(p+)?/)||[],a=s[1],l=s[2];if(!l)return VJ(n,t);let d;switch(a){case"P":d=t.dateTime({width:"short"});break;case"PP":d=t.dateTime({width:"medium"});break;case"PPP":d=t.dateTime({width:"long"});break;case"PPPP":default:d=t.dateTime({width:"full"});break}return d.replace("{{date}}",VJ(a,t)).replace("{{time}}",zse(l,t))},VWe={p:zse,P:UWe},FWe=/^D+$/,jWe=/^Y+$/,BWe=["D","DD","YY","YYYY"];function WWe(n){return FWe.test(n)}function zWe(n){return jWe.test(n)}function GWe(n,t,s){const a=HWe(n,t,s);if(console.warn(a),BWe.includes(n))throw new RangeError(a)}function HWe(n,t,s){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${t}\`) for formatting ${a} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const $We=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,KWe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qWe=/^'([^]*?)'?$/,YWe=/''/g,XWe=/[a-zA-Z]/;function JWe(n,t,s){var w,A,N,F;const a=a1(),l=a.locale??NWe,d=a.firstWeekContainsDate??((A=(w=a.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??1,p=a.weekStartsOn??((F=(N=a.locale)==null?void 0:N.options)==null?void 0:F.weekStartsOn)??0,E=Dd(n);if(!Q6e(E))throw new RangeError("Invalid time value");let v=t.match(KWe).map(j=>{const B=j[0];if(B==="p"||B==="P"){const G=VWe[B];return G(j,l.formatLong)}return j}).join("").match($We).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const B=j[0];if(B==="'")return{isToken:!1,value:QWe(j)};if(xJ[B])return{isToken:!0,value:j};if(B.match(XWe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:j}});l.localize.preprocessor&&(v=l.localize.preprocessor(E,v));const T={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return v.map(j=>{if(!j.isToken)return j.value;const B=j.value;(zWe(B)||WWe(B))&&GWe(B,t,String(n));const G=xJ[B[0]];return G(E,B,l.localize,T)}).join("")}function QWe(n){const t=n.match(qWe);return t?t[1].replace(YWe,"'"):n}const ZWe=rf(Ct),Gse=({name:n,timestamp:t,text:s,isCurrentUser:a})=>{console.log("Message props:",{name:n,timestamp:t,text:s,isCurrentUser:a});const l=t&&t.toDate?JWe(t.toDate(),"HH:mm"):"Invalid date";return I.jsxs(ZWe,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[I.jsxs(Ct,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[I.jsx(ft,{fontWeight:"bold",children:n}),I.jsx(ft,{children:s})]}),I.jsx(ft,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};Gse.propTypes={name:vr.string.isRequired,timestamp:vr.object,text:vr.string.isRequired,isCurrentUser:vr.bool.isRequired};const e8e=({spaceID:n})=>{const[t,s]=L.useState([]),{user:a}=L.useContext(xa),l=L.useRef(null);return L.useEffect(()=>{const d=$6e(n,p=>{console.log("New messages received:",p),s(E=>[...E,...p]),De.log("Messages updated:",p)});return()=>d()},[n]),L.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[t]),I.jsxs(Ct,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[t.map(d=>{const p=d.uid===(a==null?void 0:a.uid);return I.jsx(Gse,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),I.jsx("div",{ref:l})]})},t8e=({spaceID:n})=>{},Hse=({spaceID:n})=>{const{user:t}=L.useContext(xa);return t?I.jsxs(Ct,{children:[I.jsx(Ct,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:I.jsx(e8e,{spaceID:n})}),I.jsx(Ct,{mt:"8px",children:I.jsx(t8e,{spaceID:n})})]}):(console.log("No user found, returning login message"),I.jsx(Ct,{children:I.jsx(ft,{children:"Please log in to view the chat."})}))},CO=document.getElementById("chat-root");if(CO){const n=CO.getAttribute("data-space-id"),t=CO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=L.useState(null);return L.useEffect(()=>{yR(t).then(l)},[]),a?I.jsx(gN,{theme:a,children:I.jsx(r1,{children:I.jsx(Hse,{spaceID:n})})}):I.jsx("div",{children:"Loading theme..."})};Jk.createRoot(CO).render(I.jsx(s,{}))}else console.error("Root element 'chat-root' not found.");class n8e extends Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,s){console.error("WebGL Error:",t,s)}render(){return this.state.hasError?I.jsx(Ct,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:I.jsx(ft,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const IO=document.getElementById("root");if(IO){const n=IO.getAttribute("data-space-id"),t=IO.getAttribute("data-theme")||"default",s=()=>{const[a,l]=L.useState(null),[d,p]=L.useState(!1);return L.useEffect(()=>{yR(t).then(l);const E=()=>{document.hidden||yR(t).then(l)};return document.addEventListener("visibilitychange",E),()=>{document.removeEventListener("visibilitychange",E)}},[]),a?I.jsx(gN,{theme:a,children:I.jsx(r1,{children:I.jsx(v4,{children:I.jsxs(di,{spacing:4,align:"stretch",children:[I.jsxs(Ri,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[I.jsx(ft,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),I.jsx(Ct,{zIndex:"100",position:"relative",children:I.jsx(vse,{})})]}),I.jsx(GO,{maxW:"container.xl",p:0,zIndex:"1",children:I.jsx(zee,{ratio:16/9,bg:"blue.100",m:0,children:I.jsx(Ct,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:I.jsx(n8e,{children:I.jsx(O4,{spaceID:n})})})})}),I.jsxs(GO,{maxW:"container.xl",p:2,children:[I.jsx(wi,{size:"sm",colorScheme:"blue",onClick:()=>p(!d),children:d?"Hide Voice Chat Debug":"Show Voice Chat Debug"}),d&&I.jsx(Ct,{mt:2,p:3,borderWidth:"1px",borderRadius:"md",bg:"gray.50",children:I.jsx(AgoraProvider,{appId:"a2a7f4eb05284449b1063eb71d8301dc",channel:n||"default-channel",children:I.jsx(VoiceChatDebugPanel,{})})})]}),I.jsx(GO,{maxW:"container.xl",p:0,children:I.jsx(Hse,{spaceID:n})})]})})})}):I.jsx("div",{children:"Loading theme..."})};Jk.createRoot(IO).render(I.jsx(s,{}))}else console.error("Root element 'root' not found.");export{K_e as a,gve as b,Oi as c,fve as d,i8e as e,r8e as f,sve as g,bu as i,Vh as m,pRe as t};
