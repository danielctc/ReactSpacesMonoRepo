function fye(n,e){for(var i=0;i<e.length;i++){const a=e[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var my=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zM={exports:{}},lw={},GM={exports:{}},gr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G$;function pye(){if(G$)return gr;G$=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),A=Symbol.iterator;function N(Te){return Te===null||typeof Te!="object"?null:(Te=A&&Te[A]||Te["@@iterator"],typeof Te=="function"?Te:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},F=Object.assign,B={};function W(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}W.prototype.isReactComponent={},W.prototype.setState=function(Te,be){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,be,"setState")},W.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function J(){}J.prototype=W.prototype;function $(Te,be,Ae){this.props=Te,this.context=be,this.refs=B,this.updater=Ae||V}var te=$.prototype=new J;te.constructor=$,F(te,W.prototype),te.isPureReactComponent=!0;var ce=Array.isArray,oe=Object.prototype.hasOwnProperty,_e={current:null},ne={key:!0,ref:!0,__self:!0,__source:!0};function ee(Te,be,Ae){var Ue,Ge={},Qe=null,tt=null;if(be!=null)for(Ue in be.ref!==void 0&&(tt=be.ref),be.key!==void 0&&(Qe=""+be.key),be)oe.call(be,Ue)&&!ne.hasOwnProperty(Ue)&&(Ge[Ue]=be[Ue]);var ht=arguments.length-2;if(ht===1)Ge.children=Ae;else if(1<ht){for(var Ze=Array(ht),Ct=0;Ct<ht;Ct++)Ze[Ct]=arguments[Ct+2];Ge.children=Ze}if(Te&&Te.defaultProps)for(Ue in ht=Te.defaultProps,ht)Ge[Ue]===void 0&&(Ge[Ue]=ht[Ue]);return{$$typeof:n,type:Te,key:Qe,ref:tt,props:Ge,_owner:_e.current}}function Q(Te,be){return{$$typeof:n,type:Te.type,key:be,ref:Te.ref,props:Te.props,_owner:Te._owner}}function se(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function fe(Te){var be={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Ae){return be[Ae]})}var pe=/\/+/g;function ue(Te,be){return typeof Te=="object"&&Te!==null&&Te.key!=null?fe(""+Te.key):be.toString(36)}function Me(Te,be,Ae,Ue,Ge){var Qe=typeof Te;(Qe==="undefined"||Qe==="boolean")&&(Te=null);var tt=!1;if(Te===null)tt=!0;else switch(Qe){case"string":case"number":tt=!0;break;case"object":switch(Te.$$typeof){case n:case e:tt=!0}}if(tt)return tt=Te,Ge=Ge(tt),Te=Ue===""?"."+ue(tt,0):Ue,ce(Ge)?(Ae="",Te!=null&&(Ae=Te.replace(pe,"$&/")+"/"),Me(Ge,be,Ae,"",function(Ct){return Ct})):Ge!=null&&(se(Ge)&&(Ge=Q(Ge,Ae+(!Ge.key||tt&&tt.key===Ge.key?"":(""+Ge.key).replace(pe,"$&/")+"/")+Te)),be.push(Ge)),1;if(tt=0,Ue=Ue===""?".":Ue+":",ce(Te))for(var ht=0;ht<Te.length;ht++){Qe=Te[ht];var Ze=Ue+ue(Qe,ht);tt+=Me(Qe,be,Ae,Ze,Ge)}else if(Ze=N(Te),typeof Ze=="function")for(Te=Ze.call(Te),ht=0;!(Qe=Te.next()).done;)Qe=Qe.value,Ze=Ue+ue(Qe,ht++),tt+=Me(Qe,be,Ae,Ze,Ge);else if(Qe==="object")throw be=String(Te),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return tt}function He(Te,be,Ae){if(Te==null)return Te;var Ue=[],Ge=0;return Me(Te,Ue,"","",function(Qe){return be.call(Ae,Qe,Ge++)}),Ue}function nt(Te){if(Te._status===-1){var be=Te._result;be=be(),be.then(function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Ae)},function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Ae)}),Te._status===-1&&(Te._status=0,Te._result=be)}if(Te._status===1)return Te._result.default;throw Te._result}var we={current:null},Re={transition:null},ve={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Re,ReactCurrentOwner:_e};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return gr.Children={map:He,forEach:function(Te,be,Ae){He(Te,function(){be.apply(this,arguments)},Ae)},count:function(Te){var be=0;return He(Te,function(){be++}),be},toArray:function(Te){return He(Te,function(be){return be})||[]},only:function(Te){if(!se(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},gr.Component=W,gr.Fragment=i,gr.Profiler=l,gr.PureComponent=$,gr.StrictMode=a,gr.Suspense=v,gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,gr.act=Ne,gr.cloneElement=function(Te,be,Ae){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Ue=F({},Te.props),Ge=Te.key,Qe=Te.ref,tt=Te._owner;if(be!=null){if(be.ref!==void 0&&(Qe=be.ref,tt=_e.current),be.key!==void 0&&(Ge=""+be.key),Te.type&&Te.type.defaultProps)var ht=Te.type.defaultProps;for(Ze in be)oe.call(be,Ze)&&!ne.hasOwnProperty(Ze)&&(Ue[Ze]=be[Ze]===void 0&&ht!==void 0?ht[Ze]:be[Ze])}var Ze=arguments.length-2;if(Ze===1)Ue.children=Ae;else if(1<Ze){ht=Array(Ze);for(var Ct=0;Ct<Ze;Ct++)ht[Ct]=arguments[Ct+2];Ue.children=ht}return{$$typeof:n,type:Te.type,key:Ge,ref:Qe,props:Ue,_owner:tt}},gr.createContext=function(Te){return Te={$$typeof:p,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},gr.createElement=ee,gr.createFactory=function(Te){var be=ee.bind(null,Te);return be.type=Te,be},gr.createRef=function(){return{current:null}},gr.forwardRef=function(Te){return{$$typeof:y,render:Te}},gr.isValidElement=se,gr.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:nt}},gr.memo=function(Te,be){return{$$typeof:b,type:Te,compare:be===void 0?null:be}},gr.startTransition=function(Te){var be=Re.transition;Re.transition={};try{Te()}finally{Re.transition=be}},gr.unstable_act=Ne,gr.useCallback=function(Te,be){return we.current.useCallback(Te,be)},gr.useContext=function(Te){return we.current.useContext(Te)},gr.useDebugValue=function(){},gr.useDeferredValue=function(Te){return we.current.useDeferredValue(Te)},gr.useEffect=function(Te,be){return we.current.useEffect(Te,be)},gr.useId=function(){return we.current.useId()},gr.useImperativeHandle=function(Te,be,Ae){return we.current.useImperativeHandle(Te,be,Ae)},gr.useInsertionEffect=function(Te,be){return we.current.useInsertionEffect(Te,be)},gr.useLayoutEffect=function(Te,be){return we.current.useLayoutEffect(Te,be)},gr.useMemo=function(Te,be){return we.current.useMemo(Te,be)},gr.useReducer=function(Te,be,Ae){return we.current.useReducer(Te,be,Ae)},gr.useRef=function(Te){return we.current.useRef(Te)},gr.useState=function(Te){return we.current.useState(Te)},gr.useSyncExternalStore=function(Te,be,Ae){return we.current.useSyncExternalStore(Te,be,Ae)},gr.useTransition=function(){return we.current.useTransition()},gr.version="18.3.1",gr}var H$;function xu(){return H$||(H$=1,GM.exports=pye()),GM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $$;function mye(){if($$)return lw;$$=1;var n=xu(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(y,v,b){var w,A={},N=null,V=null;b!==void 0&&(N=""+b),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(V=v.ref);for(w in v)a.call(v,w)&&!d.hasOwnProperty(w)&&(A[w]=v[w]);if(y&&y.defaultProps)for(w in v=y.defaultProps,v)A[w]===void 0&&(A[w]=v[w]);return{$$typeof:e,type:y,key:N,ref:V,props:A,_owner:l.current}}return lw.Fragment=i,lw.jsx=p,lw.jsxs=p,lw}var K$;function gye(){return K$||(K$=1,zM.exports=mye()),zM.exports}var C=gye(),D=xu();const ui=Gy(D),q$=fye({__proto__:null,default:ui},[D]);var cO={},HM={exports:{}},Qc={},$M={exports:{}},KM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y$;function _ye(){return Y$||(Y$=1,function(n){function e(Re,ve){var Ne=Re.length;Re.push(ve);e:for(;0<Ne;){var Te=Ne-1>>>1,be=Re[Te];if(0<l(be,ve))Re[Te]=ve,Re[Ne]=be,Ne=Te;else break e}}function i(Re){return Re.length===0?null:Re[0]}function a(Re){if(Re.length===0)return null;var ve=Re[0],Ne=Re.pop();if(Ne!==ve){Re[0]=Ne;e:for(var Te=0,be=Re.length,Ae=be>>>1;Te<Ae;){var Ue=2*(Te+1)-1,Ge=Re[Ue],Qe=Ue+1,tt=Re[Qe];if(0>l(Ge,Ne))Qe<be&&0>l(tt,Ge)?(Re[Te]=tt,Re[Qe]=Ne,Te=Qe):(Re[Te]=Ge,Re[Ue]=Ne,Te=Ue);else if(Qe<be&&0>l(tt,Ne))Re[Te]=tt,Re[Qe]=Ne,Te=Qe;else break e}}return ve}function l(Re,ve){var Ne=Re.sortIndex-ve.sortIndex;return Ne!==0?Ne:Re.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,y=p.now();n.unstable_now=function(){return p.now()-y}}var v=[],b=[],w=1,A=null,N=3,V=!1,F=!1,B=!1,W=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function te(Re){for(var ve=i(b);ve!==null;){if(ve.callback===null)a(b);else if(ve.startTime<=Re)a(b),ve.sortIndex=ve.expirationTime,e(v,ve);else break;ve=i(b)}}function ce(Re){if(B=!1,te(Re),!F)if(i(v)!==null)F=!0,nt(oe);else{var ve=i(b);ve!==null&&we(ce,ve.startTime-Re)}}function oe(Re,ve){F=!1,B&&(B=!1,J(ee),ee=-1),V=!0;var Ne=N;try{for(te(ve),A=i(v);A!==null&&(!(A.expirationTime>ve)||Re&&!fe());){var Te=A.callback;if(typeof Te=="function"){A.callback=null,N=A.priorityLevel;var be=Te(A.expirationTime<=ve);ve=n.unstable_now(),typeof be=="function"?A.callback=be:A===i(v)&&a(v),te(ve)}else a(v);A=i(v)}if(A!==null)var Ae=!0;else{var Ue=i(b);Ue!==null&&we(ce,Ue.startTime-ve),Ae=!1}return Ae}finally{A=null,N=Ne,V=!1}}var _e=!1,ne=null,ee=-1,Q=5,se=-1;function fe(){return!(n.unstable_now()-se<Q)}function pe(){if(ne!==null){var Re=n.unstable_now();se=Re;var ve=!0;try{ve=ne(!0,Re)}finally{ve?ue():(_e=!1,ne=null)}}else _e=!1}var ue;if(typeof $=="function")ue=function(){$(pe)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=pe,ue=function(){He.postMessage(null)}}else ue=function(){W(pe,0)};function nt(Re){ne=Re,_e||(_e=!0,ue())}function we(Re,ve){ee=W(function(){Re(n.unstable_now())},ve)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){F||V||(F=!0,nt(oe))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Re){switch(N){case 1:case 2:case 3:var ve=3;break;default:ve=N}var Ne=N;N=ve;try{return Re()}finally{N=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,ve){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var Ne=N;N=Re;try{return ve()}finally{N=Ne}},n.unstable_scheduleCallback=function(Re,ve,Ne){var Te=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?Te+Ne:Te):Ne=Te,Re){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=Ne+be,Re={id:w++,callback:ve,priorityLevel:Re,startTime:Ne,expirationTime:be,sortIndex:-1},Ne>Te?(Re.sortIndex=Ne,e(b,Re),i(v)===null&&Re===i(b)&&(B?(J(ee),ee=-1):B=!0,we(ce,Ne-Te))):(Re.sortIndex=be,e(v,Re),F||V||(F=!0,nt(oe))),Re},n.unstable_shouldYield=fe,n.unstable_wrapCallback=function(Re){var ve=N;return function(){var Ne=N;N=ve;try{return Re.apply(this,arguments)}finally{N=Ne}}}}(KM)),KM}var X$;function yye(){return X$||(X$=1,$M.exports=_ye()),$M.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J$;function Eye(){if(J$)return Qc;J$=1;var n=xu(),e=yye();function i(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)a.add(g[f])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},A={};function N(f){return v.call(A,f)?!0:v.call(w,f)?!1:b.test(f)?A[f]=!0:(w[f]=!0,!1)}function V(f,g,T,O){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function F(f,g,T,O){if(g===null||typeof g>"u"||V(f,g,T,O))return!0;if(O)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,T,O,M,H,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ae}var W={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){W[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];W[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){W[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){W[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){W[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){W[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){W[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){W[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){W[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function $(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),W.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function te(f,g,T,O){var M=W.hasOwnProperty(g)?W[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(F(g,T,M,O)&&(T=null),O||M===null?N(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):M.mustUseProperty?f[M.propertyName]=T===null?M.type===3?!1:"":T:(g=M.attributeName,O=M.attributeNamespace,T===null?f.removeAttribute(g):(M=M.type,T=M===3||M===4&&T===!0?"":""+T,O?f.setAttributeNS(O,g,T):f.setAttribute(g,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,oe=Symbol.for("react.element"),_e=Symbol.for("react.portal"),ne=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),fe=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),nt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Re=Symbol.iterator;function ve(f){return f===null||typeof f!="object"?null:(f=Re&&f[Re]||f["@@iterator"],typeof f=="function"?f:null)}var Ne=Object.assign,Te;function be(f){if(Te===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+f}var Ae=!1;function Ue(f,g){if(!f||Ae)return"";Ae=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(rt){var O=rt}Reflect.construct(f,[],g)}else{try{g.call()}catch(rt){O=rt}f.call(g.prototype)}else{try{throw Error()}catch(rt){O=rt}f()}}catch(rt){if(rt&&O&&typeof rt.stack=="string"){for(var M=rt.stack.split(`
`),H=O.stack.split(`
`),ae=M.length-1,Ie=H.length-1;1<=ae&&0<=Ie&&M[ae]!==H[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==H[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==H[Ie]){var Le=`
`+M[ae].replace(" at new "," at ");return f.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",f.displayName)),Le}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?be(f):""}function Ge(f){switch(f.tag){case 5:return be(f.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return f=Ue(f.type,!1),f;case 11:return f=Ue(f.type.render,!1),f;case 1:return f=Ue(f.type,!0),f;default:return""}}function Qe(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case ne:return"Fragment";case _e:return"Portal";case Q:return"Profiler";case ee:return"StrictMode";case ue:return"Suspense";case Me:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case fe:return(f.displayName||"Context")+".Consumer";case se:return(f._context.displayName||"Context")+".Provider";case pe:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case He:return g=f.displayName||null,g!==null?g:Qe(f.type)||"Memo";case nt:g=f._payload,f=f._init;try{return Qe(f(g))}catch{}}return null}function tt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qe(g);case 8:return g===ee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ht(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Ze(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(f){var g=Ze(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),O=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var M=T.get,H=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,H.call(this,ae)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function un(f){f._valueTracker||(f._valueTracker=Ct(f))}function Lt(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),O="";return f&&(O=Ze(f)?f.checked?"true":"false":f.value),f=O,f!==T?(g.setValue(f),!0):!1}function nn(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function kn(f,g){var T=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Kt(f,g){var T=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;T=ht(g.value!=null?g.value:T),f._wrapperState={initialChecked:O,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function zn(f,g){g=g.checked,g!=null&&te(f,"checked",g,!1)}function Bt(f,g){zn(f,g);var T=ht(g.value),O=g.type;if(T!=null)O==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(O==="submit"||O==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(f,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(f,g.type,ht(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Ce(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Fe(f,g,T){(g!=="number"||nn(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var We=Array.isArray;function at(f,g,T,O){if(f=f.options,g){g={};for(var M=0;M<T.length;M++)g["$"+T[M]]=!0;for(T=0;T<f.length;T++)M=g.hasOwnProperty("$"+f[T].value),f[T].selected!==M&&(f[T].selected=M),M&&O&&(f[T].defaultSelected=!0)}else{for(T=""+ht(T),g=null,M=0;M<f.length;M++){if(f[M].value===T){f[M].selected=!0,O&&(f[M].defaultSelected=!0);return}g!==null||f[M].disabled||(g=f[M])}g!==null&&(g.selected=!0)}}function vt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function St(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(We(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:ht(T)}}function Gt(f,g){var T=ht(g.value),O=ht(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),O!=null&&(f.defaultValue=""+O)}function fn(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function Ln(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cn(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?Ln(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var dr,_a=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,O,M){MSApp.execUnsafeLocalFunction(function(){return f(g,T,O,M)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(dr=dr||document.createElement("div"),dr.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=dr.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Vt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var on={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Wi=["Webkit","ms","Moz","O"];Object.keys(on).forEach(function(f){Wi.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),on[g]=on[f]})});function gs(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||on.hasOwnProperty(f)&&on[f]?(""+g).trim():g+"px"}function Ms(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var O=T.indexOf("--")===0,M=gs(T,g[T],O);T==="float"&&(T="cssFloat"),O?f.setProperty(T,M):f[T]=M}}var ii=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pt(f,g){if(g){if(ii[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function wn(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ir=null;function xi(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Sc=null,as=null,ya=null;function Eo(f){if(f=am(f)){if(typeof Sc!="function")throw Error(i(280));var g=f.stateNode;g&&(g=cm(g),Sc(f.stateNode,f.type,g))}}function Ea(f){as?ya?ya.push(f):ya=[f]:as=f}function va(){if(as){var f=as,g=ya;if(ya=as=null,Eo(f),g)for(f=0;f<g.length;f++)Eo(g[f])}}function ro(f,g){return f(g)}function _s(){}var cs=!1;function jo(f,g,T){if(cs)return f(g,T);cs=!0;try{return ro(f,g,T)}finally{cs=!1,(as!==null||ya!==null)&&(_s(),va())}}function zi(f,g){var T=f.stateNode;if(T===null)return null;var O=cm(T);if(O===null)return null;T=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(f=f.type,O=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!O;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var ys=!1;if(y)try{var Ja={};Object.defineProperty(Ja,"passive",{get:function(){ys=!0}}),window.addEventListener("test",Ja,Ja),window.removeEventListener("test",Ja,Ja)}catch{ys=!1}function Uu(f,g,T,O,M,H,ae,Ie,Le){var rt=Array.prototype.slice.call(arguments,3);try{g.apply(T,rt)}catch(At){this.onError(At)}}var bc=!1,Sa=null,ba=!1,jd=null,Vg={onError:function(f){bc=!0,Sa=f}};function Vu(f,g,T,O,M,H,ae,Ie,Le){bc=!1,Sa=null,Uu.apply(Vg,arguments)}function pf(f,g,T,O,M,H,ae,Ie,Le){if(Vu.apply(this,arguments),bc){if(bc){var rt=Sa;bc=!1,Sa=null}else throw Error(i(198));ba||(ba=!0,jd=rt)}}function qs(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function Fu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function Ta(f){if(qs(f)!==f)throw Error(i(188))}function Bd(f){var g=f.alternate;if(!g){if(g=qs(f),g===null)throw Error(i(188));return g!==f?null:f}for(var T=f,O=g;;){var M=T.return;if(M===null)break;var H=M.alternate;if(H===null){if(O=M.return,O!==null){T=O;continue}break}if(M.child===H.child){for(H=M.child;H;){if(H===T)return Ta(M),f;if(H===O)return Ta(M),g;H=H.sibling}throw Error(i(188))}if(T.return!==O.return)T=M,O=H;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===T){ae=!0,T=M,O=H;break}if(Ie===O){ae=!0,O=M,T=H;break}Ie=Ie.sibling}if(!ae){for(Ie=H.child;Ie;){if(Ie===T){ae=!0,T=H,O=M;break}if(Ie===O){ae=!0,O=H,T=M;break}Ie=Ie.sibling}if(!ae)throw Error(i(189))}}if(T.alternate!==O)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:g}function Wd(f){return f=Bd(f),f!==null?Qa(f):null}function Qa(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Qa(f);if(g!==null)return g;f=f.sibling}return null}var zd=e.unstable_scheduleCallback,ju=e.unstable_cancelCallback,Bo=e.unstable_shouldYield,Gd=e.unstable_requestPaint,Wr=e.unstable_now,Si=e.unstable_getCurrentPriorityLevel,Tc=e.unstable_ImmediatePriority,ul=e.unstable_UserBlockingPriority,wa=e.unstable_NormalPriority,mf=e.unstable_LowPriority,Hd=e.unstable_IdlePriority,Hl=null,vo=null;function $p(f){if(vo&&typeof vo.onCommitFiberRoot=="function")try{vo.onCommitFiberRoot(Hl,f,void 0,(f.current.flags&128)===128)}catch{}}var io=Math.clz32?Math.clz32:$d,gf=Math.log,dl=Math.LN2;function $d(f){return f>>>=0,f===0?32:31-(gf(f)/dl|0)|0}var Kd=64,pr=4194304;function $l(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Kl(f,g){var T=f.pendingLanes;if(T===0)return 0;var O=0,M=f.suspendedLanes,H=f.pingedLanes,ae=T&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=$l(Ie):(H&=ae,H!==0&&(O=$l(H)))}else ae=T&~M,ae!==0?O=$l(ae):H!==0&&(O=$l(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,H=g&-g,M>=H||M===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=O;0<g;)T=31-io(g),M=1<<T,O|=f[T],g&=~M;return O}function Bu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Za(f,g){for(var T=f.suspendedLanes,O=f.pingedLanes,M=f.expirationTimes,H=f.pendingLanes;0<H;){var ae=31-io(H),Ie=1<<ae,Le=M[ae];Le===-1?((Ie&T)===0||(Ie&O)!==0)&&(M[ae]=Bu(Ie,g)):Le<=g&&(f.expiredLanes|=Ie),H&=~Ie}}function Wo(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Wu(){var f=Kd;return Kd<<=1,(Kd&4194240)===0&&(Kd=64),f}function hl(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function ql(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-io(g),f[g]=T}function Kr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var O=f.eventTimes;for(f=f.expirationTimes;0<T;){var M=31-io(T),H=1<<M;g[M]=0,O[M]=-1,f[M]=-1,T&=~H}}function ec(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var O=31-io(T),M=1<<O;M&g|f[O]&g&&(f[O]|=g),T&=~M}}var sr=0;function wc(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Kp,Yl,qd,_f,qp,yf=!1,zo=[],ls=null,Go=null,Ho=null,Xl=new Map,$o=new Map,Ko=[],Yp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Cc(f,g){switch(f){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":Go=null;break;case"mouseover":case"mouseout":Ho=null;break;case"pointerover":case"pointerout":Xl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":$o.delete(g.pointerId)}}function Es(f,g,T,O,M,H){return f===null||f.nativeEvent!==H?(f={blockedOn:g,domEventName:T,eventSystemFlags:O,nativeEvent:H,targetContainers:[M]},g!==null&&(g=am(g),g!==null&&Yl(g)),f):(f.eventSystemFlags|=O,g=f.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),f)}function zu(f,g,T,O,M){switch(g){case"focusin":return ls=Es(ls,f,g,T,O,M),!0;case"dragenter":return Go=Es(Go,f,g,T,O,M),!0;case"mouseover":return Ho=Es(Ho,f,g,T,O,M),!0;case"pointerover":var H=M.pointerId;return Xl.set(H,Es(Xl.get(H)||null,f,g,T,O,M)),!0;case"gotpointercapture":return H=M.pointerId,$o.set(H,Es($o.get(H)||null,f,g,T,O,M)),!0}return!1}function Ef(f){var g=If(f.target);if(g!==null){var T=qs(g);if(T!==null){if(g=T.tag,g===13){if(g=Fu(T),g!==null){f.blockedOn=g,qp(f.priority,function(){qd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function fl(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=vr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var O=new T.constructor(T.type,T);ir=O,T.target.dispatchEvent(O),ir=null}else return g=am(T),g!==null&&Yl(g),f.blockedOn=T,!1;g.shift()}return!0}function Jl(f,g,T){fl(f)&&T.delete(g)}function Xp(){yf=!1,ls!==null&&fl(ls)&&(ls=null),Go!==null&&fl(Go)&&(Go=null),Ho!==null&&fl(Ho)&&(Ho=null),Xl.forEach(Jl),$o.forEach(Jl)}function Ca(f,g){f.blockedOn===g&&(f.blockedOn=null,yf||(yf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Xp)))}function Ra(f){function g(M){return Ca(M,f)}if(0<zo.length){Ca(zo[0],f);for(var T=1;T<zo.length;T++){var O=zo[T];O.blockedOn===f&&(O.blockedOn=null)}}for(ls!==null&&Ca(ls,f),Go!==null&&Ca(Go,f),Ho!==null&&Ca(Ho,f),Xl.forEach(g),$o.forEach(g),T=0;T<Ko.length;T++)O=Ko[T],O.blockedOn===f&&(O.blockedOn=null);for(;0<Ko.length&&(T=Ko[0],T.blockedOn===null);)Ef(T),T.blockedOn===null&&Ko.shift()}var pl=ce.ReactCurrentBatchConfig,Se=!0;function De(f,g,T,O){var M=sr,H=pl.transition;pl.transition=null;try{sr=1,Xt(f,g,T,O)}finally{sr=M,pl.transition=H}}function et(f,g,T,O){var M=sr,H=pl.transition;pl.transition=null;try{sr=4,Xt(f,g,T,O)}finally{sr=M,pl.transition=H}}function Xt(f,g,T,O){if(Se){var M=vr(f,g,T,O);if(M===null)aE(f,g,O,qn,T),Cc(f,O);else if(zu(M,f,g,T,O))O.stopPropagation();else if(Cc(f,O),g&4&&-1<Yp.indexOf(f)){for(;M!==null;){var H=am(M);if(H!==null&&Kp(H),H=vr(f,g,T,O),H===null&&aE(f,g,O,qn,T),H===M)break;M=H}M!==null&&O.stopPropagation()}else aE(f,g,O,null,T)}}var qn=null;function vr(f,g,T,O){if(qn=null,f=xi(O),f=If(f),f!==null)if(g=qs(f),g===null)f=null;else if(T=g.tag,T===13){if(f=Fu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return qn=f,null}function zr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Si()){case Tc:return 1;case ul:return 4;case wa:case mf:return 16;case Hd:return 536870912;default:return 16}default:return 16}}var ln=null,Lr=null,bi=null;function Us(){if(bi)return bi;var f,g=Lr,T=g.length,O,M="value"in ln?ln.value:ln.textContent,H=M.length;for(f=0;f<T&&g[f]===M[f];f++);var ae=T-f;for(O=1;O<=ae&&g[T-O]===M[H-O];O++);return bi=M.slice(f,1<O?1-O:void 0)}function qo(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function Yo(){return!0}function Gu(){return!1}function es(f){function g(T,O,M,H,ae){this._reactName=T,this._targetInst=M,this.type=O,this.nativeEvent=H,this.target=ae,this.currentTarget=null;for(var Ie in f)f.hasOwnProperty(Ie)&&(T=f[Ie],this[Ie]=T?T(H):H[Ie]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Yo:Gu,this.isPropagationStopped=Gu,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),g}var ml={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yd=es(ml),Rc=Ne({},ml,{view:0,detail:0}),Fg=es(Rc),Jp,Hu,Xo,Ql=Ne({},Rc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ic,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Xo&&(Xo&&f.type==="mousemove"?(Jp=f.screenX-Xo.screenX,Hu=f.screenY-Xo.screenY):Hu=Jp=0,Xo=f),Jp)},movementY:function(f){return"movementY"in f?f.movementY:Hu}}),Qp=es(Ql),jg=Ne({},Ql,{dataTransfer:0}),Zy=es(jg),Zp=Ne({},Rc,{relatedTarget:0}),em=es(Zp),$u=Ne({},ml,{animationName:0,elapsedTime:0,pseudoElement:0}),Ku=es($u),qu=Ne({},ml,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Bg=es(qu),eE=Ne({},ml,{data:0}),Vn=es(eE),tm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nE(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=tE[f])?!!g[f]:!1}function Ic(){return nE}var I=Ne({},Rc,{key:function(f){if(f.key){var g=tm[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=qo(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Jo[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ic,charCode:function(f){return f.type==="keypress"?qo(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?qo(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),z=es(I),Z=Ne({},Ql,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),me=es(Z),Ke=Ne({},Rc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ic}),ct=es(Ke),Mt=Ne({},ml,{propertyName:0,elapsedTime:0,pseudoElement:0}),qr=es(Mt),hi=Ne({},Ql,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Sr=es(hi),Ys=[9,13,27,32],vs=y&&"CompositionEvent"in window,tc=null;y&&"documentMode"in document&&(tc=document.documentMode);var Qo=y&&"TextEvent"in window&&!tc,vf=y&&(!vs||tc&&8<tc&&11>=tc),nm=" ",nc=!1;function TR(f,g){switch(f){case"keyup":return Ys.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wR(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var rm=!1;function yN(f,g){switch(f){case"compositionend":return wR(g);case"keypress":return g.which!==32?null:(nc=!0,nm);case"textInput":return f=g.data,f===nm&&nc?null:f;default:return null}}function CR(f,g){if(rm)return f==="compositionend"||!vs&&TR(f,g)?(f=Us(),bi=Lr=ln=null,rm=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return vf&&g.locale!=="ko"?null:g.data;default:return null}}var EN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function RR(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!EN[f.type]:g==="textarea"}function K0(f,g,T,O){Ea(O),g=cE(g,"onChange"),0<g.length&&(T=new Yd("onChange","change",null,T,O),f.push({event:T,listeners:g}))}var Sf=null,Wg=null;function vN(f){eb(f,0)}function bf(f){var g=Af(f);if(Lt(g))return f}function SN(f,g){if(f==="change")return g}var IR=!1;if(y){var q0;if(y){var Ac="oninput"in document;if(!Ac){var AR=document.createElement("div");AR.setAttribute("oninput","return;"),Ac=typeof AR.oninput=="function"}q0=Ac}else q0=!1;IR=q0&&(!document.documentMode||9<document.documentMode)}function PR(){Sf&&(Sf.detachEvent("onpropertychange",Ia),Wg=Sf=null)}function Ia(f){if(f.propertyName==="value"&&bf(Wg)){var g=[];K0(g,Wg,f,xi(f)),jo(vN,g)}}function bN(f,g,T){f==="focusin"?(PR(),Sf=g,Wg=T,Sf.attachEvent("onpropertychange",Ia)):f==="focusout"&&PR()}function TN(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return bf(Wg)}function wN(f,g){if(f==="click")return bf(g)}function CN(f,g){if(f==="input"||f==="change")return bf(g)}function OR(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var gl=typeof Object.is=="function"?Object.is:OR;function zg(f,g){if(gl(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),O=Object.keys(g);if(T.length!==O.length)return!1;for(O=0;O<T.length;O++){var M=T[O];if(!v.call(g,M)||!gl(f[M],g[M]))return!1}return!0}function kR(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Y0(f,g){var T=kR(f);f=0;for(var O;T;){if(T.nodeType===3){if(O=f+T.textContent.length,f<=g&&O>=g)return{node:T,offset:g-f};f=O}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=kR(T)}}function NR(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?NR(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function DR(){for(var f=window,g=nn();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=nn(f.document)}return g}function Gg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function X0(f){var g=DR(),T=f.focusedElem,O=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&NR(T.ownerDocument.documentElement,T)){if(O!==null&&Gg(T)){if(g=O.start,f=O.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var M=T.textContent.length,H=Math.min(O.start,M);O=O.end===void 0?H:Math.min(O.end,M),!f.extend&&H>O&&(M=O,O=H,H=M),M=Y0(T,H);var ae=Y0(T,O);M&&ae&&(f.rangeCount!==1||f.anchorNode!==M.node||f.anchorOffset!==M.offset||f.focusNode!==ae.node||f.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),f.removeAllRanges(),H>O?(f.addRange(g),f.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var RN=y&&"documentMode"in document&&11>=document.documentMode,st=null,J0=null,Hg=null,Q0=!1;function xR(f,g,T){var O=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;Q0||st==null||st!==nn(O)||(O=st,"selectionStart"in O&&Gg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Hg&&zg(Hg,O)||(Hg=O,O=cE(J0,"onSelect"),0<O.length&&(g=new Yd("onSelect","select",null,g,T),f.push({event:g,listeners:O}),g.target=st)))}function rE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var im={animationend:rE("Animation","AnimationEnd"),animationiteration:rE("Animation","AnimationIteration"),animationstart:rE("Animation","AnimationStart"),transitionend:rE("Transition","TransitionEnd")},Z0={},LR={};y&&(LR=document.createElement("div").style,"AnimationEvent"in window||(delete im.animationend.animation,delete im.animationiteration.animation,delete im.animationstart.animation),"TransitionEvent"in window||delete im.transitionend.transition);function Tf(f){if(Z0[f])return Z0[f];if(!im[f])return f;var g=im[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in LR)return Z0[f]=g[T];return f}var wf=Tf("animationend"),MR=Tf("animationiteration"),UR=Tf("animationstart"),VR=Tf("transitionend"),FR=new Map,iE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xd(f,g){FR.set(f,g),d(g,[f])}for(var sE=0;sE<iE.length;sE++){var rc=iE[sE],IN=rc.toLowerCase(),$g=rc[0].toUpperCase()+rc.slice(1);Xd(IN,"on"+$g)}Xd(wf,"onAnimationEnd"),Xd(MR,"onAnimationIteration"),Xd(UR,"onAnimationStart"),Xd("dblclick","onDoubleClick"),Xd("focusin","onFocus"),Xd("focusout","onBlur"),Xd(VR,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kg));function jR(f,g,T){var O=f.type||"unknown-event";f.currentTarget=T,pf(O,g,void 0,f),f.currentTarget=null}function eb(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var O=f[T],M=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],Le=Ie.instance,rt=Ie.currentTarget;if(Ie=Ie.listener,Le!==H&&M.isPropagationStopped())break e;jR(M,Ie,rt),H=Le}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],Le=Ie.instance,rt=Ie.currentTarget,Ie=Ie.listener,Le!==H&&M.isPropagationStopped())break e;jR(M,Ie,rt),H=Le}}}if(ba)throw f=jd,ba=!1,jd=null,f}function Oi(f,g){var T=g[Jg];T===void 0&&(T=g[Jg]=new Set);var O=f+"__bubble";T.has(O)||(BR(g,f,2,!1),T.add(O))}function tb(f,g,T){var O=0;g&&(O|=4),BR(T,f,O,g)}var oE="_reactListening"+Math.random().toString(36).slice(2);function Cf(f){if(!f[oE]){f[oE]=!0,a.forEach(function(T){T!=="selectionchange"&&(AN.has(T)||tb(T,!1,f),tb(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[oE]||(g[oE]=!0,tb("selectionchange",!1,g))}}function BR(f,g,T,O){switch(zr(g)){case 1:var M=De;break;case 4:M=et;break;default:M=Xt}T=M.bind(null,g,T,f),M=void 0,!ys||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?f.addEventListener(g,T,{capture:!0,passive:M}):f.addEventListener(g,T,!0):M!==void 0?f.addEventListener(g,T,{passive:M}):f.addEventListener(g,T,!1)}function aE(f,g,T,O,M){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var Le=ae.tag;if((Le===3||Le===4)&&(Le=ae.stateNode.containerInfo,Le===M||Le.nodeType===8&&Le.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=If(Ie),ae===null)return;if(Le=ae.tag,Le===5||Le===6){O=H=ae;continue e}Ie=Ie.parentNode}}O=O.return}jo(function(){var rt=H,At=xi(T),Ot=[];e:{var It=FR.get(f);if(It!==void 0){var qt=Yd,en=f;switch(f){case"keypress":if(qo(T)===0)break e;case"keydown":case"keyup":qt=z;break;case"focusin":en="focus",qt=em;break;case"focusout":en="blur",qt=em;break;case"beforeblur":case"afterblur":qt=em;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Qp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=Zy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=ct;break;case wf:case MR:case UR:qt=Ku;break;case VR:qt=qr;break;case"scroll":qt=Fg;break;case"wheel":qt=Sr;break;case"copy":case"cut":case"paste":qt=Bg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=me}var tn=(g&4)!==0,ns=!tn&&f==="scroll",Ye=tn?It!==null?It+"Capture":null:It;tn=[];for(var Ve=rt,Je;Ve!==null;){Je=Ve;var Dt=Je.stateNode;if(Je.tag===5&&Dt!==null&&(Je=Dt,Ye!==null&&(Dt=zi(Ve,Ye),Dt!=null&&tn.push(sm(Ve,Dt,Je)))),ns)break;Ve=Ve.return}0<tn.length&&(It=new qt(It,en,null,T,At),Ot.push({event:It,listeners:tn}))}}if((g&7)===0){e:{if(It=f==="mouseover"||f==="pointerover",qt=f==="mouseout"||f==="pointerout",It&&T!==ir&&(en=T.relatedTarget||T.fromElement)&&(If(en)||en[Pc]))break e;if((qt||It)&&(It=At.window===At?At:(It=At.ownerDocument)?It.defaultView||It.parentWindow:window,qt?(en=T.relatedTarget||T.toElement,qt=rt,en=en?If(en):null,en!==null&&(ns=qs(en),en!==ns||en.tag!==5&&en.tag!==6)&&(en=null)):(qt=null,en=rt),qt!==en)){if(tn=Qp,Dt="onMouseLeave",Ye="onMouseEnter",Ve="mouse",(f==="pointerout"||f==="pointerover")&&(tn=me,Dt="onPointerLeave",Ye="onPointerEnter",Ve="pointer"),ns=qt==null?It:Af(qt),Je=en==null?It:Af(en),It=new tn(Dt,Ve+"leave",qt,T,At),It.target=ns,It.relatedTarget=Je,Dt=null,If(At)===rt&&(tn=new tn(Ye,Ve+"enter",en,T,At),tn.target=Je,tn.relatedTarget=ns,Dt=tn),ns=Dt,qt&&en)t:{for(tn=qt,Ye=en,Ve=0,Je=tn;Je;Je=Rf(Je))Ve++;for(Je=0,Dt=Ye;Dt;Dt=Rf(Dt))Je++;for(;0<Ve-Je;)tn=Rf(tn),Ve--;for(;0<Je-Ve;)Ye=Rf(Ye),Je--;for(;Ve--;){if(tn===Ye||Ye!==null&&tn===Ye.alternate)break t;tn=Rf(tn),Ye=Rf(Ye)}tn=null}else tn=null;qt!==null&&qg(Ot,It,qt,tn,!1),en!==null&&ns!==null&&qg(Ot,ns,en,tn,!0)}}e:{if(It=rt?Af(rt):window,qt=It.nodeName&&It.nodeName.toLowerCase(),qt==="select"||qt==="input"&&It.type==="file")var rn=SN;else if(RR(It))if(IR)rn=CN;else{rn=TN;var pn=bN}else(qt=It.nodeName)&&qt.toLowerCase()==="input"&&(It.type==="checkbox"||It.type==="radio")&&(rn=wN);if(rn&&(rn=rn(f,rt))){K0(Ot,rn,T,At);break e}pn&&pn(f,It,rt),f==="focusout"&&(pn=It._wrapperState)&&pn.controlled&&It.type==="number"&&Fe(It,"number",It.value)}switch(pn=rt?Af(rt):window,f){case"focusin":(RR(pn)||pn.contentEditable==="true")&&(st=pn,J0=rt,Hg=null);break;case"focusout":Hg=J0=st=null;break;case"mousedown":Q0=!0;break;case"contextmenu":case"mouseup":case"dragend":Q0=!1,xR(Ot,T,At);break;case"selectionchange":if(RN)break;case"keydown":case"keyup":xR(Ot,T,At)}var En;if(vs)e:{switch(f){case"compositionstart":var Nn="onCompositionStart";break e;case"compositionend":Nn="onCompositionEnd";break e;case"compositionupdate":Nn="onCompositionUpdate";break e}Nn=void 0}else rm?TR(f,T)&&(Nn="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Nn="onCompositionStart");Nn&&(vf&&T.locale!=="ko"&&(rm||Nn!=="onCompositionStart"?Nn==="onCompositionEnd"&&rm&&(En=Us()):(ln=At,Lr="value"in ln?ln.value:ln.textContent,rm=!0)),pn=cE(rt,Nn),0<pn.length&&(Nn=new Vn(Nn,f,null,T,At),Ot.push({event:Nn,listeners:pn}),En?Nn.data=En:(En=wR(T),En!==null&&(Nn.data=En)))),(En=Qo?yN(f,T):CR(f,T))&&(rt=cE(rt,"onBeforeInput"),0<rt.length&&(At=new Vn("onBeforeInput","beforeinput",null,T,At),Ot.push({event:At,listeners:rt}),At.data=En))}eb(Ot,g)})}function sm(f,g,T){return{instance:f,listener:g,currentTarget:T}}function cE(f,g){for(var T=g+"Capture",O=[];f!==null;){var M=f,H=M.stateNode;M.tag===5&&H!==null&&(M=H,H=zi(f,T),H!=null&&O.unshift(sm(f,H,M)),H=zi(f,g),H!=null&&O.push(sm(f,H,M))),f=f.return}return O}function Rf(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function qg(f,g,T,O,M){for(var H=g._reactName,ae=[];T!==null&&T!==O;){var Ie=T,Le=Ie.alternate,rt=Ie.stateNode;if(Le!==null&&Le===O)break;Ie.tag===5&&rt!==null&&(Ie=rt,M?(Le=zi(T,H),Le!=null&&ae.unshift(sm(T,Le,Ie))):M||(Le=zi(T,H),Le!=null&&ae.push(sm(T,Le,Ie)))),T=T.return}ae.length!==0&&f.push({event:g,listeners:ae})}var PN=/\r\n?/g,ON=/\u0000|\uFFFD/g;function WR(f){return(typeof f=="string"?f:""+f).replace(PN,`
`).replace(ON,"")}function lE(f,g,T){if(g=WR(g),WR(f)!==g&&T)throw Error(i(425))}function uE(){}var dE=null,Yg=null;function nb(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Xg=typeof setTimeout=="function"?setTimeout:void 0,kN=typeof clearTimeout=="function"?clearTimeout:void 0,zR=typeof Promise=="function"?Promise:void 0,NN=typeof queueMicrotask=="function"?queueMicrotask:typeof zR<"u"?function(f){return zR.resolve(null).then(f).catch(DN)}:Xg;function DN(f){setTimeout(function(){throw f})}function rb(f,g){var T=g,O=0;do{var M=T.nextSibling;if(f.removeChild(T),M&&M.nodeType===8)if(T=M.data,T==="/$"){if(O===0){f.removeChild(M),Ra(g);return}O--}else T!=="$"&&T!=="$?"&&T!=="$!"||O++;T=M}while(T);Ra(g)}function Jd(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function GR(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var om=Math.random().toString(36).slice(2),Zl="__reactFiber$"+om,Qd="__reactProps$"+om,Pc="__reactContainer$"+om,Jg="__reactEvents$"+om,xN="__reactListeners$"+om,LN="__reactHandles$"+om;function If(f){var g=f[Zl];if(g)return g;for(var T=f.parentNode;T;){if(g=T[Pc]||T[Zl]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=GR(f);f!==null;){if(T=f[Zl])return T;f=GR(f)}return g}f=T,T=f.parentNode}return null}function am(f){return f=f[Zl]||f[Pc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Af(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function cm(f){return f[Qd]||null}var ib=[],lm=-1;function Oc(f){return{current:f}}function ki(f){0>lm||(f.current=ib[lm],ib[lm]=null,lm--)}function Ti(f,g){lm++,ib[lm]=f.current,f.current=g}var Zd={},So=Oc(Zd),Aa=Oc(!1),Pf=Zd;function Of(f,g){var T=f.type.contextTypes;if(!T)return Zd;var O=f.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},H;for(H in T)M[H]=g[H];return O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=M),M}function Pa(f){return f=f.childContextTypes,f!=null}function hE(){ki(Aa),ki(So)}function HR(f,g,T){if(So.current!==Zd)throw Error(i(168));Ti(So,g),Ti(Aa,T)}function fE(f,g,T){var O=f.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return T;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(i(108,tt(f)||"Unknown",M));return Ne({},T,O)}function pE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Zd,Pf=So.current,Ti(So,f),Ti(Aa,Aa.current),!0}function $R(f,g,T){var O=f.stateNode;if(!O)throw Error(i(169));T?(f=fE(f,g,Pf),O.__reactInternalMemoizedMergedChildContext=f,ki(Aa),ki(So),Ti(So,f)):ki(Aa),Ti(Aa,T)}var kc=null,mE=!1,sb=!1;function KR(f){kc===null?kc=[f]:kc.push(f)}function MN(f){mE=!0,KR(f)}function eh(){if(!sb&&kc!==null){sb=!0;var f=0,g=sr;try{var T=kc;for(sr=1;f<T.length;f++){var O=T[f];do O=O(!0);while(O!==null)}kc=null,mE=!1}catch(M){throw kc!==null&&(kc=kc.slice(f+1)),zd(Tc,eh),M}finally{sr=g,sb=!1}}return null}var um=[],Yu=0,Qg=null,gE=0,Nc=[],ic=0,kf=null,Xu=1,Ju="";function Qu(f,g){um[Yu++]=gE,um[Yu++]=Qg,Qg=f,gE=g}function _E(f,g,T){Nc[ic++]=Xu,Nc[ic++]=Ju,Nc[ic++]=kf,kf=f;var O=Xu;f=Ju;var M=32-io(O)-1;O&=~(1<<M),T+=1;var H=32-io(g)+M;if(30<H){var ae=M-M%5;H=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,Xu=1<<32-io(g)+M|T<<M|O,Ju=H+f}else Xu=1<<H|T<<M|O,Ju=f}function yE(f){f.return!==null&&(Qu(f,1),_E(f,1,0))}function Zg(f){for(;f===Qg;)Qg=um[--Yu],um[Yu]=null,gE=um[--Yu],um[Yu]=null;for(;f===kf;)kf=Nc[--ic],Nc[ic]=null,Ju=Nc[--ic],Nc[ic]=null,Xu=Nc[--ic],Nc[ic]=null}var Oa=null,ka=null,fi=!1,Zo=null;function qR(f,g){var T=ac(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function YR(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,Oa=f,ka=Jd(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,Oa=f,ka=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=kf!==null?{id:Xu,overflow:Ju}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=ac(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,Oa=f,ka=null,!0):!1;default:return!1}}function EE(f){return(f.mode&1)!==0&&(f.flags&128)===0}function ob(f){if(fi){var g=ka;if(g){var T=g;if(!YR(f,g)){if(EE(f))throw Error(i(418));g=Jd(T.nextSibling);var O=Oa;g&&YR(f,g)?qR(O,T):(f.flags=f.flags&-4097|2,fi=!1,Oa=f)}}else{if(EE(f))throw Error(i(418));f.flags=f.flags&-4097|2,fi=!1,Oa=f}}}function XR(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Oa=f}function e_(f){if(f!==Oa)return!1;if(!fi)return XR(f),fi=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!nb(f.type,f.memoizedProps)),g&&(g=ka)){if(EE(f))throw JR(),Error(i(418));for(;g;)qR(f,g),g=Jd(g.nextSibling)}if(XR(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){ka=Jd(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}ka=null}}else ka=Oa?Jd(f.stateNode.nextSibling):null;return!0}function JR(){for(var f=ka;f;)f=Jd(f.nextSibling)}function dm(){ka=Oa=null,fi=!1}function ab(f){Zo===null?Zo=[f]:Zo.push(f)}var UN=ce.ReactCurrentBatchConfig;function t_(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var O=T.stateNode}if(!O)throw Error(i(147,f));var M=O,H=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[H]:Ie[H]=ae},g._stringRef=H,g)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function vE(f,g){throw f=Object.prototype.toString.call(g),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function cb(f){var g=f._init;return g(f._payload)}function th(f){function g(Ye,Ve){if(f){var Je=Ye.deletions;Je===null?(Ye.deletions=[Ve],Ye.flags|=16):Je.push(Ve)}}function T(Ye,Ve){if(!f)return null;for(;Ve!==null;)g(Ye,Ve),Ve=Ve.sibling;return null}function O(Ye,Ve){for(Ye=new Map;Ve!==null;)Ve.key!==null?Ye.set(Ve.key,Ve):Ye.set(Ve.index,Ve),Ve=Ve.sibling;return Ye}function M(Ye,Ve){return Ye=od(Ye,Ve),Ye.index=0,Ye.sibling=null,Ye}function H(Ye,Ve,Je){return Ye.index=Je,f?(Je=Ye.alternate,Je!==null?(Je=Je.index,Je<Ve?(Ye.flags|=2,Ve):Je):(Ye.flags|=2,Ve)):(Ye.flags|=1048576,Ve)}function ae(Ye){return f&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ie(Ye,Ve,Je,Dt){return Ve===null||Ve.tag!==6?(Ve=Hb(Je,Ye.mode,Dt),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function Le(Ye,Ve,Je,Dt){var rn=Je.type;return rn===ne?At(Ye,Ve,Je.props.children,Dt,Je.key):Ve!==null&&(Ve.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===nt&&cb(rn)===Ve.type)?(Dt=M(Ve,Je.props),Dt.ref=t_(Ye,Ve,Je),Dt.return=Ye,Dt):(Dt=ov(Je.type,Je.key,Je.props,null,Ye.mode,Dt),Dt.ref=t_(Ye,Ve,Je),Dt.return=Ye,Dt)}function rt(Ye,Ve,Je,Dt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Je.containerInfo||Ve.stateNode.implementation!==Je.implementation?(Ve=$b(Je,Ye.mode,Dt),Ve.return=Ye,Ve):(Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ve)}function At(Ye,Ve,Je,Dt,rn){return Ve===null||Ve.tag!==7?(Ve=zf(Je,Ye.mode,Dt,rn),Ve.return=Ye,Ve):(Ve=M(Ve,Je),Ve.return=Ye,Ve)}function Ot(Ye,Ve,Je){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=Hb(""+Ve,Ye.mode,Je),Ve.return=Ye,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case oe:return Je=ov(Ve.type,Ve.key,Ve.props,null,Ye.mode,Je),Je.ref=t_(Ye,null,Ve),Je.return=Ye,Je;case _e:return Ve=$b(Ve,Ye.mode,Je),Ve.return=Ye,Ve;case nt:var Dt=Ve._init;return Ot(Ye,Dt(Ve._payload),Je)}if(We(Ve)||ve(Ve))return Ve=zf(Ve,Ye.mode,Je,null),Ve.return=Ye,Ve;vE(Ye,Ve)}return null}function It(Ye,Ve,Je,Dt){var rn=Ve!==null?Ve.key:null;if(typeof Je=="string"&&Je!==""||typeof Je=="number")return rn!==null?null:Ie(Ye,Ve,""+Je,Dt);if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:return Je.key===rn?Le(Ye,Ve,Je,Dt):null;case _e:return Je.key===rn?rt(Ye,Ve,Je,Dt):null;case nt:return rn=Je._init,It(Ye,Ve,rn(Je._payload),Dt)}if(We(Je)||ve(Je))return rn!==null?null:At(Ye,Ve,Je,Dt,null);vE(Ye,Je)}return null}function qt(Ye,Ve,Je,Dt,rn){if(typeof Dt=="string"&&Dt!==""||typeof Dt=="number")return Ye=Ye.get(Je)||null,Ie(Ve,Ye,""+Dt,rn);if(typeof Dt=="object"&&Dt!==null){switch(Dt.$$typeof){case oe:return Ye=Ye.get(Dt.key===null?Je:Dt.key)||null,Le(Ve,Ye,Dt,rn);case _e:return Ye=Ye.get(Dt.key===null?Je:Dt.key)||null,rt(Ve,Ye,Dt,rn);case nt:var pn=Dt._init;return qt(Ye,Ve,Je,pn(Dt._payload),rn)}if(We(Dt)||ve(Dt))return Ye=Ye.get(Je)||null,At(Ve,Ye,Dt,rn,null);vE(Ve,Dt)}return null}function en(Ye,Ve,Je,Dt){for(var rn=null,pn=null,En=Ve,Nn=Ve=0,Cs=null;En!==null&&Nn<Je.length;Nn++){En.index>Nn?(Cs=En,En=null):Cs=En.sibling;var br=It(Ye,En,Je[Nn],Dt);if(br===null){En===null&&(En=Cs);break}f&&En&&br.alternate===null&&g(Ye,En),Ve=H(br,Ve,Nn),pn===null?rn=br:pn.sibling=br,pn=br,En=Cs}if(Nn===Je.length)return T(Ye,En),fi&&Qu(Ye,Nn),rn;if(En===null){for(;Nn<Je.length;Nn++)En=Ot(Ye,Je[Nn],Dt),En!==null&&(Ve=H(En,Ve,Nn),pn===null?rn=En:pn.sibling=En,pn=En);return fi&&Qu(Ye,Nn),rn}for(En=O(Ye,En);Nn<Je.length;Nn++)Cs=qt(En,Ye,Nn,Je[Nn],Dt),Cs!==null&&(f&&Cs.alternate!==null&&En.delete(Cs.key===null?Nn:Cs.key),Ve=H(Cs,Ve,Nn),pn===null?rn=Cs:pn.sibling=Cs,pn=Cs);return f&&En.forEach(function(hh){return g(Ye,hh)}),fi&&Qu(Ye,Nn),rn}function tn(Ye,Ve,Je,Dt){var rn=ve(Je);if(typeof rn!="function")throw Error(i(150));if(Je=rn.call(Je),Je==null)throw Error(i(151));for(var pn=rn=null,En=Ve,Nn=Ve=0,Cs=null,br=Je.next();En!==null&&!br.done;Nn++,br=Je.next()){En.index>Nn?(Cs=En,En=null):Cs=En.sibling;var hh=It(Ye,En,br.value,Dt);if(hh===null){En===null&&(En=Cs);break}f&&En&&hh.alternate===null&&g(Ye,En),Ve=H(hh,Ve,Nn),pn===null?rn=hh:pn.sibling=hh,pn=hh,En=Cs}if(br.done)return T(Ye,En),fi&&Qu(Ye,Nn),rn;if(En===null){for(;!br.done;Nn++,br=Je.next())br=Ot(Ye,br.value,Dt),br!==null&&(Ve=H(br,Ve,Nn),pn===null?rn=br:pn.sibling=br,pn=br);return fi&&Qu(Ye,Nn),rn}for(En=O(Ye,En);!br.done;Nn++,br=Je.next())br=qt(En,Ye,Nn,br.value,Dt),br!==null&&(f&&br.alternate!==null&&En.delete(br.key===null?Nn:br.key),Ve=H(br,Ve,Nn),pn===null?rn=br:pn.sibling=br,pn=br);return f&&En.forEach(function(ZN){return g(Ye,ZN)}),fi&&Qu(Ye,Nn),rn}function ns(Ye,Ve,Je,Dt){if(typeof Je=="object"&&Je!==null&&Je.type===ne&&Je.key===null&&(Je=Je.props.children),typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case oe:e:{for(var rn=Je.key,pn=Ve;pn!==null;){if(pn.key===rn){if(rn=Je.type,rn===ne){if(pn.tag===7){T(Ye,pn.sibling),Ve=M(pn,Je.props.children),Ve.return=Ye,Ye=Ve;break e}}else if(pn.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===nt&&cb(rn)===pn.type){T(Ye,pn.sibling),Ve=M(pn,Je.props),Ve.ref=t_(Ye,pn,Je),Ve.return=Ye,Ye=Ve;break e}T(Ye,pn);break}else g(Ye,pn);pn=pn.sibling}Je.type===ne?(Ve=zf(Je.props.children,Ye.mode,Dt,Je.key),Ve.return=Ye,Ye=Ve):(Dt=ov(Je.type,Je.key,Je.props,null,Ye.mode,Dt),Dt.ref=t_(Ye,Ve,Je),Dt.return=Ye,Ye=Dt)}return ae(Ye);case _e:e:{for(pn=Je.key;Ve!==null;){if(Ve.key===pn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Je.containerInfo&&Ve.stateNode.implementation===Je.implementation){T(Ye,Ve.sibling),Ve=M(Ve,Je.children||[]),Ve.return=Ye,Ye=Ve;break e}else{T(Ye,Ve);break}else g(Ye,Ve);Ve=Ve.sibling}Ve=$b(Je,Ye.mode,Dt),Ve.return=Ye,Ye=Ve}return ae(Ye);case nt:return pn=Je._init,ns(Ye,Ve,pn(Je._payload),Dt)}if(We(Je))return en(Ye,Ve,Je,Dt);if(ve(Je))return tn(Ye,Ve,Je,Dt);vE(Ye,Je)}return typeof Je=="string"&&Je!==""||typeof Je=="number"?(Je=""+Je,Ve!==null&&Ve.tag===6?(T(Ye,Ve.sibling),Ve=M(Ve,Je),Ve.return=Ye,Ye=Ve):(T(Ye,Ve),Ve=Hb(Je,Ye.mode,Dt),Ve.return=Ye,Ye=Ve),ae(Ye)):T(Ye,Ve)}return ns}var hm=th(!0),QR=th(!1),SE=Oc(null),n_=null,fm=null,bE=null;function lb(){bE=fm=n_=null}function ub(f){var g=SE.current;ki(SE),f._currentValue=g}function db(f,g,T){for(;f!==null;){var O=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),f===T)break;f=f.return}}function Zu(f,g){n_=f,bE=fm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(Da=!0),f.firstContext=null)}function Dc(f){var g=f._currentValue;if(bE!==f)if(f={context:f,memoizedValue:g,next:null},fm===null){if(n_===null)throw Error(i(308));fm=f,n_.dependencies={lanes:0,firstContext:f}}else fm=fm.next=f;return g}var Nf=null;function hb(f){Nf===null?Nf=[f]:Nf.push(f)}function ZR(f,g,T,O){var M=g.interleaved;return M===null?(T.next=T,hb(g)):(T.next=M.next,M.next=T),g.interleaved=T,ed(f,O)}function ed(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var nh=!1;function r_(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function eI(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function eu(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function rh(f,g,T){var O=f.updateQueue;if(O===null)return null;if(O=O.shared,(Ir&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,ed(f,T)}return M=O.interleaved,M===null?(g.next=g,hb(O)):(g.next=M.next,M.next=g),O.interleaved=g,ed(f,T)}function i_(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,ec(f,T)}}function tI(f,g){var T=f.updateQueue,O=f.alternate;if(O!==null&&(O=O.updateQueue,T===O)){var M=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var ae={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?M=H=ae:H=H.next=ae,T=T.next}while(T!==null);H===null?M=H=g:H=H.next=g}else M=H=g;T={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:H,shared:O.shared,effects:O.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function TE(f,g,T,O){var M=f.updateQueue;nh=!1;var H=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var Le=Ie,rt=Le.next;Le.next=null,ae===null?H=rt:ae.next=rt,ae=Le;var At=f.alternate;At!==null&&(At=At.updateQueue,Ie=At.lastBaseUpdate,Ie!==ae&&(Ie===null?At.firstBaseUpdate=rt:Ie.next=rt,At.lastBaseUpdate=Le))}if(H!==null){var Ot=M.baseState;ae=0,At=rt=Le=null,Ie=H;do{var It=Ie.lane,qt=Ie.eventTime;if((O&It)===It){At!==null&&(At=At.next={eventTime:qt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var en=f,tn=Ie;switch(It=g,qt=T,tn.tag){case 1:if(en=tn.payload,typeof en=="function"){Ot=en.call(qt,Ot,It);break e}Ot=en;break e;case 3:en.flags=en.flags&-65537|128;case 0:if(en=tn.payload,It=typeof en=="function"?en.call(qt,Ot,It):en,It==null)break e;Ot=Ne({},Ot,It);break e;case 2:nh=!0}}Ie.callback!==null&&Ie.lane!==0&&(f.flags|=64,It=M.effects,It===null?M.effects=[Ie]:It.push(Ie))}else qt={eventTime:qt,lane:It,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},At===null?(rt=At=qt,Le=Ot):At=At.next=qt,ae|=It;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;It=Ie,Ie=It.next,It.next=null,M.lastBaseUpdate=It,M.shared.pending=null}}while(!0);if(At===null&&(Le=Ot),M.baseState=Le,M.firstBaseUpdate=rt,M.lastBaseUpdate=At,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else H===null&&(M.shared.lanes=0);Vf|=ae,f.lanes=ae,f.memoizedState=Ot}}function nI(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var O=f[g],M=O.callback;if(M!==null){if(O.callback=null,O=T,typeof M!="function")throw Error(i(191,M));M.call(O)}}}var s_={},tu=Oc(s_),o_=Oc(s_),pm=Oc(s_);function Df(f){if(f===s_)throw Error(i(174));return f}function fb(f,g){switch(Ti(pm,g),Ti(o_,f),Ti(tu,s_),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:cn(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=cn(g,f)}ki(tu),Ti(tu,g)}function xf(){ki(tu),ki(o_),ki(pm)}function rI(f){Df(pm.current);var g=Df(tu.current),T=cn(g,f.type);g!==T&&(Ti(o_,f),Ti(tu,T))}function mm(f){o_.current===f&&(ki(tu),ki(o_))}var Li=Oc(0);function ih(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var pb=[];function mb(){for(var f=0;f<pb.length;f++)pb[f]._workInProgressVersionPrimary=null;pb.length=0}var wE=ce.ReactCurrentDispatcher,gb=ce.ReactCurrentBatchConfig,nu=0,Gi=null,Ss=null,bs=null,gm=!1,a_=!1,c_=0,VN=0;function bo(){throw Error(i(321))}function _b(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!gl(f[T],g[T]))return!1;return!0}function _m(f,g,T,O,M,H){if(nu=H,Gi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,wE.current=f===null||f.memoizedState===null?BN:pI,f=T(O,M),a_){H=0;do{if(a_=!1,c_=0,25<=H)throw Error(i(301));H+=1,bs=Ss=null,g.updateQueue=null,wE.current=WN,f=T(O,M)}while(a_)}if(wE.current=AE,g=Ss!==null&&Ss.next!==null,nu=0,bs=Ss=Gi=null,gm=!1,g)throw Error(i(300));return f}function yb(){var f=c_!==0;return c_=0,f}function ea(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?Gi.memoizedState=bs=f:bs=bs.next=f,bs}function Na(){if(Ss===null){var f=Gi.alternate;f=f!==null?f.memoizedState:null}else f=Ss.next;var g=bs===null?Gi.memoizedState:bs.next;if(g!==null)bs=g,Ss=f;else{if(f===null)throw Error(i(310));Ss=f,f={memoizedState:Ss.memoizedState,baseState:Ss.baseState,baseQueue:Ss.baseQueue,queue:Ss.queue,next:null},bs===null?Gi.memoizedState=bs=f:bs=bs.next=f}return bs}function sh(f,g){return typeof g=="function"?g(f):g}function Lf(f){var g=Na(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=Ss,M=O.baseQueue,H=T.pending;if(H!==null){if(M!==null){var ae=M.next;M.next=H.next,H.next=ae}O.baseQueue=M=H,T.pending=null}if(M!==null){H=M.next,O=O.baseState;var Ie=ae=null,Le=null,rt=H;do{var At=rt.lane;if((nu&At)===At)Le!==null&&(Le=Le.next={lane:0,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null}),O=rt.hasEagerState?rt.eagerState:f(O,rt.action);else{var Ot={lane:At,action:rt.action,hasEagerState:rt.hasEagerState,eagerState:rt.eagerState,next:null};Le===null?(Ie=Le=Ot,ae=O):Le=Le.next=Ot,Gi.lanes|=At,Vf|=At}rt=rt.next}while(rt!==null&&rt!==H);Le===null?ae=O:Le.next=Ie,gl(O,g.memoizedState)||(Da=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=Le,T.lastRenderedState=O}if(f=T.interleaved,f!==null){M=f;do H=M.lane,Gi.lanes|=H,Vf|=H,M=M.next;while(M!==f)}else M===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function ym(f){var g=Na(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var O=T.dispatch,M=T.pending,H=g.memoizedState;if(M!==null){T.pending=null;var ae=M=M.next;do H=f(H,ae.action),ae=ae.next;while(ae!==M);gl(H,g.memoizedState)||(Da=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,O]}function iI(){}function Eb(f,g){var T=Gi,O=Na(),M=g(),H=!gl(O.memoizedState,M);if(H&&(O.memoizedState=M,Da=!0),O=O.queue,xc(oI.bind(null,T,O,f),[f]),O.getSnapshot!==g||H||bs!==null&&bs.memoizedState.tag&1){if(T.flags|=2048,l_(9,vb.bind(null,T,O,M,g),void 0,null),Xs===null)throw Error(i(349));(nu&30)!==0||sI(T,g,M)}return M}function sI(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Gi.updateQueue,g===null?(g={lastEffect:null,stores:null},Gi.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function vb(f,g,T,O){g.value=T,g.getSnapshot=O,aI(g)&&CE(f)}function oI(f,g,T){return T(function(){aI(g)&&CE(f)})}function aI(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!gl(f,T)}catch{return!0}}function CE(f){var g=ed(f,1);g!==null&&Vc(g,f,1,-1)}function RE(f){var g=ea();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sh,lastRenderedState:f},g.queue=f,f=f.dispatch=jN.bind(null,Gi,f),[g.memoizedState,f]}function l_(f,g,T,O){return f={tag:f,create:g,destroy:T,deps:O,next:null},g=Gi.updateQueue,g===null?(g={lastEffect:null,stores:null},Gi.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(O=T.next,T.next=f,f.next=O,g.lastEffect=f)),f}function cI(){return Na().memoizedState}function u_(f,g,T,O){var M=ea();Gi.flags|=f,M.memoizedState=l_(1|g,T,void 0,O===void 0?null:O)}function Em(f,g,T,O){var M=Na();O=O===void 0?null:O;var H=void 0;if(Ss!==null){var ae=Ss.memoizedState;if(H=ae.destroy,O!==null&&_b(O,ae.deps)){M.memoizedState=l_(g,T,H,O);return}}Gi.flags|=f,M.memoizedState=l_(1|g,T,H,O)}function lI(f,g){return u_(8390656,8,f,g)}function xc(f,g){return Em(2048,8,f,g)}function Mf(f,g){return Em(4,2,f,g)}function oh(f,g){return Em(4,4,f,g)}function Sb(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function bb(f,g,T){return T=T!=null?T.concat([f]):null,Em(4,4,Sb.bind(null,g,f),T)}function td(){}function IE(f,g){var T=Na();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&_b(g,O[1])?O[0]:(T.memoizedState=[f,g],f)}function uI(f,g){var T=Na();g=g===void 0?null:g;var O=T.memoizedState;return O!==null&&g!==null&&_b(g,O[1])?O[0]:(f=f(),T.memoizedState=[f,g],f)}function Tb(f,g,T){return(nu&21)===0?(f.baseState&&(f.baseState=!1,Da=!0),f.memoizedState=T):(gl(T,g)||(T=Wu(),Gi.lanes|=T,Vf|=T,f.baseState=!0),g)}function FN(f,g){var T=sr;sr=T!==0&&4>T?T:4,f(!0);var O=gb.transition;gb.transition={};try{f(!1),g()}finally{sr=T,gb.transition=O}}function wb(){return Na().memoizedState}function dI(f,g,T){var O=Uc(f);if(T={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null},nd(f))hI(g,T);else if(T=ZR(f,g,T,O),T!==null){var M=ao();Vc(T,f,O,M),fI(T,g,O)}}function jN(f,g,T){var O=Uc(f),M={lane:O,action:T,hasEagerState:!1,eagerState:null,next:null};if(nd(f))hI(g,M);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ae=g.lastRenderedState,Ie=H(ae,T);if(M.hasEagerState=!0,M.eagerState=Ie,gl(Ie,ae)){var Le=g.interleaved;Le===null?(M.next=M,hb(g)):(M.next=Le.next,Le.next=M),g.interleaved=M;return}}catch{}finally{}T=ZR(f,g,M,O),T!==null&&(M=ao(),Vc(T,f,O,M),fI(T,g,O))}}function nd(f){var g=f.alternate;return f===Gi||g!==null&&g===Gi}function hI(f,g){a_=gm=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function fI(f,g,T){if((T&4194240)!==0){var O=g.lanes;O&=f.pendingLanes,T|=O,g.lanes=T,ec(f,T)}}var AE={readContext:Dc,useCallback:bo,useContext:bo,useEffect:bo,useImperativeHandle:bo,useInsertionEffect:bo,useLayoutEffect:bo,useMemo:bo,useReducer:bo,useRef:bo,useState:bo,useDebugValue:bo,useDeferredValue:bo,useTransition:bo,useMutableSource:bo,useSyncExternalStore:bo,useId:bo,unstable_isNewReconciler:!1},BN={readContext:Dc,useCallback:function(f,g){return ea().memoizedState=[f,g===void 0?null:g],f},useContext:Dc,useEffect:lI,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,u_(4194308,4,Sb.bind(null,g,f),T)},useLayoutEffect:function(f,g){return u_(4194308,4,f,g)},useInsertionEffect:function(f,g){return u_(4,2,f,g)},useMemo:function(f,g){var T=ea();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var O=ea();return g=T!==void 0?T(g):g,O.memoizedState=O.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},O.queue=f,f=f.dispatch=dI.bind(null,Gi,f),[O.memoizedState,f]},useRef:function(f){var g=ea();return f={current:f},g.memoizedState=f},useState:RE,useDebugValue:td,useDeferredValue:function(f){return ea().memoizedState=f},useTransition:function(){var f=RE(!1),g=f[0];return f=FN.bind(null,f[1]),ea().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var O=Gi,M=ea();if(fi){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),Xs===null)throw Error(i(349));(nu&30)!==0||sI(O,g,T)}M.memoizedState=T;var H={value:T,getSnapshot:g};return M.queue=H,lI(oI.bind(null,O,H,f),[f]),O.flags|=2048,l_(9,vb.bind(null,O,H,T,g),void 0,null),T},useId:function(){var f=ea(),g=Xs.identifierPrefix;if(fi){var T=Ju,O=Xu;T=(O&~(1<<32-io(O)-1)).toString(32)+T,g=":"+g+"R"+T,T=c_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=VN++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},pI={readContext:Dc,useCallback:IE,useContext:Dc,useEffect:xc,useImperativeHandle:bb,useInsertionEffect:Mf,useLayoutEffect:oh,useMemo:uI,useReducer:Lf,useRef:cI,useState:function(){return Lf(sh)},useDebugValue:td,useDeferredValue:function(f){var g=Na();return Tb(g,Ss.memoizedState,f)},useTransition:function(){var f=Lf(sh)[0],g=Na().memoizedState;return[f,g]},useMutableSource:iI,useSyncExternalStore:Eb,useId:wb,unstable_isNewReconciler:!1},WN={readContext:Dc,useCallback:IE,useContext:Dc,useEffect:xc,useImperativeHandle:bb,useInsertionEffect:Mf,useLayoutEffect:oh,useMemo:uI,useReducer:ym,useRef:cI,useState:function(){return ym(sh)},useDebugValue:td,useDeferredValue:function(f){var g=Na();return Ss===null?g.memoizedState=f:Tb(g,Ss.memoizedState,f)},useTransition:function(){var f=ym(sh)[0],g=Na().memoizedState;return[f,g]},useMutableSource:iI,useSyncExternalStore:Eb,useId:wb,unstable_isNewReconciler:!1};function sc(f,g){if(f&&f.defaultProps){g=Ne({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function PE(f,g,T,O){g=f.memoizedState,T=T(O,g),T=T==null?g:Ne({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var OE={isMounted:function(f){return(f=f._reactInternals)?qs(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var O=ao(),M=Uc(f),H=eu(O,M);H.payload=g,T!=null&&(H.callback=T),g=rh(f,H,M),g!==null&&(Vc(g,f,M,O),i_(g,f,M))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var O=ao(),M=Uc(f),H=eu(O,M);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=rh(f,H,M),g!==null&&(Vc(g,f,M,O),i_(g,f,M))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=ao(),O=Uc(f),M=eu(T,O);M.tag=2,g!=null&&(M.callback=g),g=rh(f,M,O),g!==null&&(Vc(g,f,O,T),i_(g,f,O))}};function Cb(f,g,T,O,M,H,ae){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(O,H,ae):g.prototype&&g.prototype.isPureReactComponent?!zg(T,O)||!zg(M,H):!0}function mI(f,g,T){var O=!1,M=Zd,H=g.contextType;return typeof H=="object"&&H!==null?H=Dc(H):(M=Pa(g)?Pf:So.current,O=g.contextTypes,H=(O=O!=null)?Of(f,M):Zd),g=new g(T,H),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=OE,f.stateNode=g,g._reactInternals=f,O&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=M,f.__reactInternalMemoizedMaskedChildContext=H),g}function gI(f,g,T,O){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,O),g.state!==f&&OE.enqueueReplaceState(g,g.state,null)}function Rb(f,g,T,O){var M=f.stateNode;M.props=T,M.state=f.memoizedState,M.refs={},r_(f);var H=g.contextType;typeof H=="object"&&H!==null?M.context=Dc(H):(H=Pa(g)?Pf:So.current,M.context=Of(f,H)),M.state=f.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(PE(f,g,H,T),M.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&OE.enqueueReplaceState(M,M.state,null),TE(f,T,M,O),M.state=f.memoizedState),typeof M.componentDidMount=="function"&&(f.flags|=4194308)}function vm(f,g){try{var T="",O=g;do T+=Ge(O),O=O.return;while(O);var M=T}catch(H){M=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:g,stack:M,digest:null}}function Ib(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function Ab(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var zN=typeof WeakMap=="function"?WeakMap:Map;function Pb(f,g,T){T=eu(-1,T),T.tag=3,T.payload={element:null};var O=g.value;return T.callback=function(){qE||(qE=!0,jb=O),Ab(f,g)},T}function rd(f,g,T){T=eu(-1,T),T.tag=3;var O=f.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;T.payload=function(){return O(M)},T.callback=function(){Ab(f,g)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Ab(f,g),typeof O!="function"&&(ah===null?ah=new Set([this]):ah.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),T}function _I(f,g,T){var O=f.pingCache;if(O===null){O=f.pingCache=new zN;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(T)||(M.add(T),f=BI.bind(null,f,g,T),g.then(f,f))}function yI(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function EI(f,g,T,O,M){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=eu(-1,1),g.tag=2,rh(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=M,f)}var GN=ce.ReactCurrentOwner,Da=!1;function ta(f,g,T,O){g.child=f===null?QR(g,null,T,O):hm(g,f.child,T,O)}function kE(f,g,T,O,M){T=T.render;var H=g.ref;return Zu(g,M),O=_m(f,g,T,O,H,M),T=yb(),f!==null&&!Da?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,ru(f,g,M)):(fi&&T&&yE(g),g.flags|=1,ta(f,g,O,M),g.child)}function vI(f,g,T,O,M){if(f===null){var H=T.type;return typeof H=="function"&&!lh(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,SI(f,g,H,O,M)):(f=ov(T.type,null,O,g,g.mode,M),f.ref=g.ref,f.return=g,g.child=f)}if(H=f.child,(f.lanes&M)===0){var ae=H.memoizedProps;if(T=T.compare,T=T!==null?T:zg,T(ae,O)&&f.ref===g.ref)return ru(f,g,M)}return g.flags|=1,f=od(H,O),f.ref=g.ref,f.return=g,g.child=f}function SI(f,g,T,O,M){if(f!==null){var H=f.memoizedProps;if(zg(H,O)&&f.ref===g.ref)if(Da=!1,g.pendingProps=O=H,(f.lanes&M)!==0)(f.flags&131072)!==0&&(Da=!0);else return g.lanes=f.lanes,ru(f,g,M)}return Ob(f,g,T,O,M)}function bI(f,g,T){var O=g.pendingProps,M=O.children,H=f!==null?f.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(_l,oc),oc|=T;else{if((T&1073741824)===0)return f=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Ti(_l,oc),oc|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:T,Ti(_l,oc),oc|=O}else H!==null?(O=H.baseLanes|T,g.memoizedState=null):O=T,Ti(_l,oc),oc|=O;return ta(f,g,M,T),g.child}function TI(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Ob(f,g,T,O,M){var H=Pa(T)?Pf:So.current;return H=Of(g,H),Zu(g,M),T=_m(f,g,T,O,H,M),O=yb(),f!==null&&!Da?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~M,ru(f,g,M)):(fi&&O&&yE(g),g.flags|=1,ta(f,g,T,M),g.child)}function wI(f,g,T,O,M){if(Pa(T)){var H=!0;pE(g)}else H=!1;if(Zu(g,M),g.stateNode===null)UE(f,g),mI(g,T,O),Rb(g,T,O,M),O=!0;else if(f===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var Le=ae.context,rt=T.contextType;typeof rt=="object"&&rt!==null?rt=Dc(rt):(rt=Pa(T)?Pf:So.current,rt=Of(g,rt));var At=T.getDerivedStateFromProps,Ot=typeof At=="function"||typeof ae.getSnapshotBeforeUpdate=="function";Ot||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||Le!==rt)&&gI(g,ae,O,rt),nh=!1;var It=g.memoizedState;ae.state=It,TE(g,O,ae,M),Le=g.memoizedState,Ie!==O||It!==Le||Aa.current||nh?(typeof At=="function"&&(PE(g,T,At,O),Le=g.memoizedState),(Ie=nh||Cb(g,T,Ie,O,It,Le,rt))?(Ot||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Le),ae.props=O,ae.state=Le,ae.context=rt,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,eI(f,g),Ie=g.memoizedProps,rt=g.type===g.elementType?Ie:sc(g.type,Ie),ae.props=rt,Ot=g.pendingProps,It=ae.context,Le=T.contextType,typeof Le=="object"&&Le!==null?Le=Dc(Le):(Le=Pa(T)?Pf:So.current,Le=Of(g,Le));var qt=T.getDerivedStateFromProps;(At=typeof qt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==Ot||It!==Le)&&gI(g,ae,O,Le),nh=!1,It=g.memoizedState,ae.state=It,TE(g,O,ae,M);var en=g.memoizedState;Ie!==Ot||It!==en||Aa.current||nh?(typeof qt=="function"&&(PE(g,T,qt,O),en=g.memoizedState),(rt=nh||Cb(g,T,rt,O,It,en,Le)||!1)?(At||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,en,Le),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,en,Le)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&It===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&It===f.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=en),ae.props=O,ae.state=en,ae.context=Le,O=rt):(typeof ae.componentDidUpdate!="function"||Ie===f.memoizedProps&&It===f.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&It===f.memoizedState||(g.flags|=1024),O=!1)}return NE(f,g,T,O,H,M)}function NE(f,g,T,O,M,H){TI(f,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&$R(g,T,!1),ru(f,g,H);O=g.stateNode,GN.current=g;var Ie=ae&&typeof T.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,f!==null&&ae?(g.child=hm(g,f.child,null,H),g.child=hm(g,null,Ie,H)):ta(f,g,Ie,H),g.memoizedState=O.state,M&&$R(g,T,!0),g.child}function kb(f){var g=f.stateNode;g.pendingContext?HR(f,g.pendingContext,g.pendingContext!==g.context):g.context&&HR(f,g.context,!1),fb(f,g.containerInfo)}function CI(f,g,T,O,M){return dm(),ab(M),g.flags|=256,ta(f,g,T,O),g.child}var Nb={dehydrated:null,treeContext:null,retryLane:0};function Sm(f){return{baseLanes:f,cachePool:null,transitions:null}}function DE(f,g,T){var O=g.pendingProps,M=Li.current,H=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=f!==null&&f.memoizedState===null?!1:(M&2)!==0),Ie?(H=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(M|=1),Ti(Li,M&1),f===null)return ob(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,f=O.fallback,H?(O=g.mode,H=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ae):H=uh(ae,O,0,null),f=zf(f,O,T,null),H.return=g,f.return=g,H.sibling=f,g.child=H,g.child.memoizedState=Sm(T),g.memoizedState=Nb,f):xE(g,ae));if(M=f.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return RI(f,g,ae,O,Ie,M,T);if(H){H=O.fallback,ae=g.mode,M=f.child,Ie=M.sibling;var Le={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=Le,g.deletions=null):(O=od(M,Le),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?H=od(Ie,H):(H=zf(H,ae,T,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ae=f.child.memoizedState,ae=ae===null?Sm(T):{baseLanes:ae.baseLanes|T,cachePool:null,transitions:ae.transitions},H.memoizedState=ae,H.childLanes=f.childLanes&~T,g.memoizedState=Nb,O}return H=f.child,f=H.sibling,O=od(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=T),O.return=g,O.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=O,g.memoizedState=null,O}function xE(f,g){return g=uh({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Uf(f,g,T,O){return O!==null&&ab(O),hm(g,f.child,null,T),f=xE(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function RI(f,g,T,O,M,H,ae){if(T)return g.flags&256?(g.flags&=-257,O=Ib(Error(i(422))),Uf(f,g,ae,O)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(H=O.fallback,M=g.mode,O=uh({mode:"visible",children:O.children},M,0,null),H=zf(H,M,ae,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&hm(g,f.child,null,ae),g.child.memoizedState=Sm(ae),g.memoizedState=Nb,H);if((g.mode&1)===0)return Uf(f,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,H=Error(i(419)),O=Ib(H,O,void 0),Uf(f,g,ae,O)}if(Ie=(ae&f.childLanes)!==0,Da||Ie){if(O=Xs,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==H.retryLane&&(H.retryLane=M,ed(f,M),Vc(O,f,M,-1))}return zb(),O=Ib(Error(i(421))),Uf(f,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=f.child,g=rv.bind(null,f),M._reactRetry=g,null):(f=H.treeContext,ka=Jd(M.nextSibling),Oa=g,fi=!0,Zo=null,f!==null&&(Nc[ic++]=Xu,Nc[ic++]=Ju,Nc[ic++]=kf,Xu=f.id,Ju=f.overflow,kf=g),g=xE(g,O.children),g.flags|=4096,g)}function II(f,g,T){f.lanes|=g;var O=f.alternate;O!==null&&(O.lanes|=g),db(f.return,g,T)}function LE(f,g,T,O,M){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:T,tailMode:M}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=T,H.tailMode=M)}function ME(f,g,T){var O=g.pendingProps,M=O.revealOrder,H=O.tail;if(ta(f,g,O.children,T),O=Li.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&II(f,T,g);else if(f.tag===19)II(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}O&=1}if(Ti(Li,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(T=g.child,M=null;T!==null;)f=T.alternate,f!==null&&ih(f)===null&&(M=T),T=T.sibling;T=M,T===null?(M=g.child,g.child=null):(M=T.sibling,T.sibling=null),LE(g,!1,M,T,H);break;case"backwards":for(T=null,M=g.child,g.child=null;M!==null;){if(f=M.alternate,f!==null&&ih(f)===null){g.child=M;break}f=M.sibling,M.sibling=T,T=M,M=f}LE(g,!0,T,null,H);break;case"together":LE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function UE(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function ru(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),Vf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(i(153));if(g.child!==null){for(f=g.child,T=od(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=od(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function AI(f,g,T){switch(g.tag){case 3:kb(g),dm();break;case 5:rI(g);break;case 1:Pa(g.type)&&pE(g);break;case 4:fb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;Ti(SE,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(Ti(Li,Li.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?DE(f,g,T):(Ti(Li,Li.current&1),f=ru(f,g,T),f!==null?f.sibling:null);Ti(Li,Li.current&1);break;case 19:if(O=(T&g.childLanes)!==0,(f.flags&128)!==0){if(O)return ME(f,g,T);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),Ti(Li,Li.current),O)break;return null;case 22:case 23:return g.lanes=0,bI(f,g,T)}return ru(f,g,T)}var PI,VE,Db,OI;PI=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},VE=function(){},Db=function(f,g,T,O){var M=f.memoizedProps;if(M!==O){f=g.stateNode,Df(tu.current);var H=null;switch(T){case"input":M=kn(f,M),O=kn(f,O),H=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),H=[];break;case"textarea":M=vt(f,M),O=vt(f,O),H=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(f.onclick=uE)}Pt(T,O);var ae;T=null;for(rt in M)if(!O.hasOwnProperty(rt)&&M.hasOwnProperty(rt)&&M[rt]!=null)if(rt==="style"){var Ie=M[rt];for(ae in Ie)Ie.hasOwnProperty(ae)&&(T||(T={}),T[ae]="")}else rt!=="dangerouslySetInnerHTML"&&rt!=="children"&&rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&rt!=="autoFocus"&&(l.hasOwnProperty(rt)?H||(H=[]):(H=H||[]).push(rt,null));for(rt in O){var Le=O[rt];if(Ie=M!=null?M[rt]:void 0,O.hasOwnProperty(rt)&&Le!==Ie&&(Le!=null||Ie!=null))if(rt==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||Le&&Le.hasOwnProperty(ae)||(T||(T={}),T[ae]="");for(ae in Le)Le.hasOwnProperty(ae)&&Ie[ae]!==Le[ae]&&(T||(T={}),T[ae]=Le[ae])}else T||(H||(H=[]),H.push(rt,T)),T=Le;else rt==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Ie=Ie?Ie.__html:void 0,Le!=null&&Ie!==Le&&(H=H||[]).push(rt,Le)):rt==="children"?typeof Le!="string"&&typeof Le!="number"||(H=H||[]).push(rt,""+Le):rt!=="suppressContentEditableWarning"&&rt!=="suppressHydrationWarning"&&(l.hasOwnProperty(rt)?(Le!=null&&rt==="onScroll"&&Oi("scroll",f),H||Ie===Le||(H=[])):(H=H||[]).push(rt,Le))}T&&(H=H||[]).push("style",T);var rt=H;(g.updateQueue=rt)&&(g.flags|=4)}},OI=function(f,g,T,O){T!==O&&(g.flags|=4)};function d_(f,g){if(!fi)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var O=null;T!==null;)T.alternate!==null&&(O=T),T=T.sibling;O===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:O.sibling=null}}function To(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,O=0;if(g)for(var M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=f,M=M.sibling;else for(M=f.child;M!==null;)T|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=f,M=M.sibling;return f.subtreeFlags|=O,f.childLanes=T,g}function FE(f,g,T){var O=g.pendingProps;switch(Zg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return To(g),null;case 1:return Pa(g.type)&&hE(),To(g),null;case 3:return O=g.stateNode,xf(),ki(Aa),ki(So),mb(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(f===null||f.child===null)&&(e_(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Zo!==null&&(ZE(Zo),Zo=null))),VE(f,g),To(g),null;case 5:mm(g);var M=Df(pm.current);if(T=g.type,f!==null&&g.stateNode!=null)Db(f,g,T,O,M),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(i(166));return To(g),null}if(f=Df(tu.current),e_(g)){O=g.stateNode,T=g.type;var H=g.memoizedProps;switch(O[Zl]=g,O[Qd]=H,f=(g.mode&1)!==0,T){case"dialog":Oi("cancel",O),Oi("close",O);break;case"iframe":case"object":case"embed":Oi("load",O);break;case"video":case"audio":for(M=0;M<Kg.length;M++)Oi(Kg[M],O);break;case"source":Oi("error",O);break;case"img":case"image":case"link":Oi("error",O),Oi("load",O);break;case"details":Oi("toggle",O);break;case"input":Kt(O,H),Oi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Oi("invalid",O);break;case"textarea":St(O,H),Oi("invalid",O)}Pt(T,H),M=null;for(var ae in H)if(H.hasOwnProperty(ae)){var Ie=H[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(H.suppressHydrationWarning!==!0&&lE(O.textContent,Ie,f),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(H.suppressHydrationWarning!==!0&&lE(O.textContent,Ie,f),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&Oi("scroll",O)}switch(T){case"input":un(O),Ce(O,H,!0);break;case"textarea":un(O),fn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=uE)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Ln(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ae.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof O.is=="string"?f=ae.createElement(T,{is:O.is}):(f=ae.createElement(T),T==="select"&&(ae=f,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):f=ae.createElementNS(f,T),f[Zl]=g,f[Qd]=O,PI(f,g,!1,!1),g.stateNode=f;e:{switch(ae=wn(T,O),T){case"dialog":Oi("cancel",f),Oi("close",f),M=O;break;case"iframe":case"object":case"embed":Oi("load",f),M=O;break;case"video":case"audio":for(M=0;M<Kg.length;M++)Oi(Kg[M],f);M=O;break;case"source":Oi("error",f),M=O;break;case"img":case"image":case"link":Oi("error",f),Oi("load",f),M=O;break;case"details":Oi("toggle",f),M=O;break;case"input":Kt(f,O),M=kn(f,O),Oi("invalid",f);break;case"option":M=O;break;case"select":f._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),Oi("invalid",f);break;case"textarea":St(f,O),M=vt(f,O),Oi("invalid",f);break;default:M=O}Pt(T,M),Ie=M;for(H in Ie)if(Ie.hasOwnProperty(H)){var Le=Ie[H];H==="style"?Ms(f,Le):H==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&_a(f,Le)):H==="children"?typeof Le=="string"?(T!=="textarea"||Le!=="")&&Vt(f,Le):typeof Le=="number"&&Vt(f,""+Le):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Le!=null&&H==="onScroll"&&Oi("scroll",f):Le!=null&&te(f,H,Le,ae))}switch(T){case"input":un(f),Ce(f,O,!1);break;case"textarea":un(f),fn(f);break;case"option":O.value!=null&&f.setAttribute("value",""+ht(O.value));break;case"select":f.multiple=!!O.multiple,H=O.value,H!=null?at(f,!!O.multiple,H,!1):O.defaultValue!=null&&at(f,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(f.onclick=uE)}switch(T){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return To(g),null;case 6:if(f&&g.stateNode!=null)OI(f,g,f.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(i(166));if(T=Df(pm.current),Df(tu.current),e_(g)){if(O=g.stateNode,T=g.memoizedProps,O[Zl]=g,(H=O.nodeValue!==T)&&(f=Oa,f!==null))switch(f.tag){case 3:lE(O.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&lE(O.nodeValue,T,(f.mode&1)!==0)}H&&(g.flags|=4)}else O=(T.nodeType===9?T:T.ownerDocument).createTextNode(O),O[Zl]=g,g.stateNode=O}return To(g),null;case 13:if(ki(Li),O=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(fi&&ka!==null&&(g.mode&1)!==0&&(g.flags&128)===0)JR(),dm(),g.flags|=98560,H=!1;else if(H=e_(g),O!==null&&O.dehydrated!==null){if(f===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[Zl]=g}else dm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;To(g),H=!1}else Zo!==null&&(ZE(Zo),Zo=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(O=O!==null,O!==(f!==null&&f.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Li.current&1)!==0?ws===0&&(ws=3):zb())),g.updateQueue!==null&&(g.flags|=4),To(g),null);case 4:return xf(),VE(f,g),f===null&&Cf(g.stateNode.containerInfo),To(g),null;case 10:return ub(g.type._context),To(g),null;case 17:return Pa(g.type)&&hE(),To(g),null;case 19:if(ki(Li),H=g.memoizedState,H===null)return To(g),null;if(O=(g.flags&128)!==0,ae=H.rendering,ae===null)if(O)d_(H,!1);else{if(ws!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ae=ih(f),ae!==null){for(g.flags|=128,d_(H,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=T,T=g.child;T!==null;)H=T,f=O,H.flags&=14680066,ae=H.alternate,ae===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ae.childLanes,H.lanes=ae.lanes,H.child=ae.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ae.memoizedProps,H.memoizedState=ae.memoizedState,H.updateQueue=ae.updateQueue,H.type=ae.type,f=ae.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return Ti(Li,Li.current&1|2),g.child}f=f.sibling}H.tail!==null&&Wr()>wm&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304)}else{if(!O)if(f=ih(ae),f!==null){if(g.flags|=128,O=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),d_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ae.alternate&&!fi)return To(g),null}else 2*Wr()-H.renderingStartTime>wm&&T!==1073741824&&(g.flags|=128,O=!0,d_(H,!1),g.lanes=4194304);H.isBackwards?(ae.sibling=g.child,g.child=ae):(T=H.last,T!==null?T.sibling=ae:g.child=ae,H.last=ae)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=Wr(),g.sibling=null,T=Li.current,Ti(Li,O?T&1|2:T&1),g):(To(g),null);case 22:case 23:return E_(),O=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(oc&1073741824)!==0&&(To(g),g.subtreeFlags&6&&(g.flags|=8192)):To(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function HN(f,g){switch(Zg(g),g.tag){case 1:return Pa(g.type)&&hE(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return xf(),ki(Aa),ki(So),mb(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return mm(g),null;case 13:if(ki(Li),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(i(340));dm()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return ki(Li),null;case 4:return xf(),null;case 10:return ub(g.type._context),null;case 22:case 23:return E_(),null;case 24:return null;default:return null}}var jE=!1,wo=!1,kI=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function bm(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(O){Hi(f,g,O)}else T.current=null}function h_(f,g,T){try{T()}catch(O){Hi(f,g,O)}}var NI=!1;function xb(f,g){if(dE=Se,f=DR(),Gg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var O=T.getSelection&&T.getSelection();if(O&&O.rangeCount!==0){T=O.anchorNode;var M=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var ae=0,Ie=-1,Le=-1,rt=0,At=0,Ot=f,It=null;t:for(;;){for(var qt;Ot!==T||M!==0&&Ot.nodeType!==3||(Ie=ae+M),Ot!==H||O!==0&&Ot.nodeType!==3||(Le=ae+O),Ot.nodeType===3&&(ae+=Ot.nodeValue.length),(qt=Ot.firstChild)!==null;)It=Ot,Ot=qt;for(;;){if(Ot===f)break t;if(It===T&&++rt===M&&(Ie=ae),It===H&&++At===O&&(Le=ae),(qt=Ot.nextSibling)!==null)break;Ot=It,It=Ot.parentNode}Ot=qt}T=Ie===-1||Le===-1?null:{start:Ie,end:Le}}else T=null}T=T||{start:0,end:0}}else T=null;for(Yg={focusedElem:f,selectionRange:T},Se=!1,Qt=g;Qt!==null;)if(g=Qt,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Qt=f;else for(;Qt!==null;){g=Qt;try{var en=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(en!==null){var tn=en.memoizedProps,ns=en.memoizedState,Ye=g.stateNode,Ve=Ye.getSnapshotBeforeUpdate(g.elementType===g.type?tn:sc(g.type,tn),ns);Ye.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Je=g.stateNode.containerInfo;Je.nodeType===1?Je.textContent="":Je.nodeType===9&&Je.documentElement&&Je.removeChild(Je.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Dt){Hi(g,g.return,Dt)}if(f=g.sibling,f!==null){f.return=g.return,Qt=f;break}Qt=g.return}return en=NI,NI=!1,en}function f_(f,g,T){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&f)===f){var H=M.destroy;M.destroy=void 0,H!==void 0&&h_(g,T,H)}M=M.next}while(M!==O)}}function p_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var O=T.create;T.destroy=O()}T=T.next}while(T!==g)}}function Lb(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function DI(f){var g=f.alternate;g!==null&&(f.alternate=null,DI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[Zl],delete g[Qd],delete g[Jg],delete g[xN],delete g[LN])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function Mb(f){return f.tag===5||f.tag===3||f.tag===4}function xI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Mb(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Ub(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=uE));else if(O!==4&&(f=f.child,f!==null))for(Ub(f,g,T),f=f.sibling;f!==null;)Ub(f,g,T),f=f.sibling}function BE(f,g,T){var O=f.tag;if(O===5||O===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(O!==4&&(f=f.child,f!==null))for(BE(f,g,T),f=f.sibling;f!==null;)BE(f,g,T),f=f.sibling}var so=null,Lc=!1;function iu(f,g,T){for(T=T.child;T!==null;)LI(f,g,T),T=T.sibling}function LI(f,g,T){if(vo&&typeof vo.onCommitFiberUnmount=="function")try{vo.onCommitFiberUnmount(Hl,T)}catch{}switch(T.tag){case 5:wo||bm(T,g);case 6:var O=so,M=Lc;so=null,iu(f,g,T),so=O,Lc=M,so!==null&&(Lc?(f=so,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):so.removeChild(T.stateNode));break;case 18:so!==null&&(Lc?(f=so,T=T.stateNode,f.nodeType===8?rb(f.parentNode,T):f.nodeType===1&&rb(f,T),Ra(f)):rb(so,T.stateNode));break;case 4:O=so,M=Lc,so=T.stateNode.containerInfo,Lc=!0,iu(f,g,T),so=O,Lc=M;break;case 0:case 11:case 14:case 15:if(!wo&&(O=T.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var H=M,ae=H.destroy;H=H.tag,ae!==void 0&&((H&2)!==0||(H&4)!==0)&&h_(T,g,ae),M=M.next}while(M!==O)}iu(f,g,T);break;case 1:if(!wo&&(bm(T,g),O=T.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=T.memoizedProps,O.state=T.memoizedState,O.componentWillUnmount()}catch(Ie){Hi(T,g,Ie)}iu(f,g,T);break;case 21:iu(f,g,T);break;case 22:T.mode&1?(wo=(O=wo)||T.memoizedState!==null,iu(f,g,T),wo=O):iu(f,g,T);break;default:iu(f,g,T)}}function MI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new kI),g.forEach(function(O){var M=WI.bind(null,f,O);T.has(O)||(T.add(O),O.then(M,M))})}}function na(f,g){var T=g.deletions;if(T!==null)for(var O=0;O<T.length;O++){var M=T[O];try{var H=f,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:so=Ie.stateNode,Lc=!1;break e;case 3:so=Ie.stateNode.containerInfo,Lc=!0;break e;case 4:so=Ie.stateNode.containerInfo,Lc=!0;break e}Ie=Ie.return}if(so===null)throw Error(i(160));LI(H,ae,M),so=null,Lc=!1;var Le=M.alternate;Le!==null&&(Le.return=null),M.return=null}catch(rt){Hi(M,g,rt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Vb(g,f),g=g.sibling}function Vb(f,g){var T=f.alternate,O=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(na(g,f),xa(f),O&4){try{f_(3,f,f.return),p_(3,f)}catch(tn){Hi(f,f.return,tn)}try{f_(5,f,f.return)}catch(tn){Hi(f,f.return,tn)}}break;case 1:na(g,f),xa(f),O&512&&T!==null&&bm(T,T.return);break;case 5:if(na(g,f),xa(f),O&512&&T!==null&&bm(T,T.return),f.flags&32){var M=f.stateNode;try{Vt(M,"")}catch(tn){Hi(f,f.return,tn)}}if(O&4&&(M=f.stateNode,M!=null)){var H=f.memoizedProps,ae=T!==null?T.memoizedProps:H,Ie=f.type,Le=f.updateQueue;if(f.updateQueue=null,Le!==null)try{Ie==="input"&&H.type==="radio"&&H.name!=null&&zn(M,H),wn(Ie,ae);var rt=wn(Ie,H);for(ae=0;ae<Le.length;ae+=2){var At=Le[ae],Ot=Le[ae+1];At==="style"?Ms(M,Ot):At==="dangerouslySetInnerHTML"?_a(M,Ot):At==="children"?Vt(M,Ot):te(M,At,Ot,rt)}switch(Ie){case"input":Bt(M,H);break;case"textarea":Gt(M,H);break;case"select":var It=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!H.multiple;var qt=H.value;qt!=null?at(M,!!H.multiple,qt,!1):It!==!!H.multiple&&(H.defaultValue!=null?at(M,!!H.multiple,H.defaultValue,!0):at(M,!!H.multiple,H.multiple?[]:"",!1))}M[Qd]=H}catch(tn){Hi(f,f.return,tn)}}break;case 6:if(na(g,f),xa(f),O&4){if(f.stateNode===null)throw Error(i(162));M=f.stateNode,H=f.memoizedProps;try{M.nodeValue=H}catch(tn){Hi(f,f.return,tn)}}break;case 3:if(na(g,f),xa(f),O&4&&T!==null&&T.memoizedState.isDehydrated)try{Ra(g.containerInfo)}catch(tn){Hi(f,f.return,tn)}break;case 4:na(g,f),xa(f);break;case 13:na(g,f),xa(f),M=f.child,M.flags&8192&&(H=M.memoizedState!==null,M.stateNode.isHidden=H,!H||M.alternate!==null&&M.alternate.memoizedState!==null||(KE=Wr())),O&4&&MI(f);break;case 22:if(At=T!==null&&T.memoizedState!==null,f.mode&1?(wo=(rt=wo)||At,na(g,f),wo=rt):na(g,f),xa(f),O&8192){if(rt=f.memoizedState!==null,(f.stateNode.isHidden=rt)&&!At&&(f.mode&1)!==0)for(Qt=f,At=f.child;At!==null;){for(Ot=Qt=At;Qt!==null;){switch(It=Qt,qt=It.child,It.tag){case 0:case 11:case 14:case 15:f_(4,It,It.return);break;case 1:bm(It,It.return);var en=It.stateNode;if(typeof en.componentWillUnmount=="function"){O=It,T=It.return;try{g=O,en.props=g.memoizedProps,en.state=g.memoizedState,en.componentWillUnmount()}catch(tn){Hi(O,T,tn)}}break;case 5:bm(It,It.return);break;case 22:if(It.memoizedState!==null){m_(Ot);continue}}qt!==null?(qt.return=It,Qt=qt):m_(Ot)}At=At.sibling}e:for(At=null,Ot=f;;){if(Ot.tag===5){if(At===null){At=Ot;try{M=Ot.stateNode,rt?(H=M.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ie=Ot.stateNode,Le=Ot.memoizedProps.style,ae=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Ie.style.display=gs("display",ae))}catch(tn){Hi(f,f.return,tn)}}}else if(Ot.tag===6){if(At===null)try{Ot.stateNode.nodeValue=rt?"":Ot.memoizedProps}catch(tn){Hi(f,f.return,tn)}}else if((Ot.tag!==22&&Ot.tag!==23||Ot.memoizedState===null||Ot===f)&&Ot.child!==null){Ot.child.return=Ot,Ot=Ot.child;continue}if(Ot===f)break e;for(;Ot.sibling===null;){if(Ot.return===null||Ot.return===f)break e;At===Ot&&(At=null),Ot=Ot.return}At===Ot&&(At=null),Ot.sibling.return=Ot.return,Ot=Ot.sibling}}break;case 19:na(g,f),xa(f),O&4&&MI(f);break;case 21:break;default:na(g,f),xa(f)}}function xa(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(Mb(T)){var O=T;break e}T=T.return}throw Error(i(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var H=xI(f);BE(f,H,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=xI(f);Ub(f,Ie,ae);break;default:throw Error(i(161))}}catch(Le){Hi(f,f.return,Le)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function Tm(f,g,T){Qt=f,Fb(f)}function Fb(f,g,T){for(var O=(f.mode&1)!==0;Qt!==null;){var M=Qt,H=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||jE;if(!ae){var Ie=M.alternate,Le=Ie!==null&&Ie.memoizedState!==null||wo;Ie=jE;var rt=wo;if(jE=ae,(wo=Le)&&!rt)for(Qt=M;Qt!==null;)ae=Qt,Le=ae.child,ae.tag===22&&ae.memoizedState!==null?UI(M):Le!==null?(Le.return=ae,Qt=Le):UI(M);for(;H!==null;)Qt=H,Fb(H),H=H.sibling;Qt=M,jE=Ie,wo=rt}WE(f)}else(M.subtreeFlags&8772)!==0&&H!==null?(H.return=M,Qt=H):WE(f)}}function WE(f){for(;Qt!==null;){var g=Qt;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:wo||p_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!wo)if(T===null)O.componentDidMount();else{var M=g.elementType===g.type?T.memoizedProps:sc(g.type,T.memoizedProps);O.componentDidUpdate(M,T.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&nI(g,H,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}nI(g,ae,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var Le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&T.focus();break;case"img":Le.src&&(T.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var rt=g.alternate;if(rt!==null){var At=rt.memoizedState;if(At!==null){var Ot=At.dehydrated;Ot!==null&&Ra(Ot)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}wo||g.flags&512&&Lb(g)}catch(It){Hi(g,g.return,It)}}if(g===f){Qt=null;break}if(T=g.sibling,T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function m_(f){for(;Qt!==null;){var g=Qt;if(g===f){Qt=null;break}var T=g.sibling;if(T!==null){T.return=g.return,Qt=T;break}Qt=g.return}}function UI(f){for(;Qt!==null;){var g=Qt;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{p_(4,g)}catch(Le){Hi(g,T,Le)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(Le){Hi(g,M,Le)}}var H=g.return;try{Lb(g)}catch(Le){Hi(g,H,Le)}break;case 5:var ae=g.return;try{Lb(g)}catch(Le){Hi(g,ae,Le)}}}catch(Le){Hi(g,g.return,Le)}if(g===f){Qt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Qt=Ie;break}Qt=g.return}}var $N=Math.ceil,zE=ce.ReactCurrentDispatcher,GE=ce.ReactCurrentOwner,Mc=ce.ReactCurrentBatchConfig,Ir=0,Xs=null,ts=null,Ts=0,oc=0,_l=Oc(0),ws=0,oo=null,Vf=0,HE=0,$E=0,g_=null,ra=null,KE=0,wm=1/0,su=null,qE=!1,jb=null,ah=null,Cm=!1,ou=null,YE=0,Ff=0,Bb=null,__=-1,XE=0;function ao(){return(Ir&6)!==0?Wr():__!==-1?__:__=Wr()}function Uc(f){return(f.mode&1)===0?1:(Ir&2)!==0&&Ts!==0?Ts&-Ts:UN.transition!==null?(XE===0&&(XE=Wu()),XE):(f=sr,f!==0||(f=window.event,f=f===void 0?16:zr(f.type)),f)}function Vc(f,g,T,O){if(50<Ff)throw Ff=0,Bb=null,Error(i(185));ql(f,T,O),((Ir&2)===0||f!==Xs)&&(f===Xs&&((Ir&2)===0&&(HE|=T),ws===4&&id(f,Ts)),Co(f,O),T===1&&Ir===0&&(g.mode&1)===0&&(wm=Wr()+500,mE&&eh()))}function Co(f,g){var T=f.callbackNode;Za(f,g);var O=Kl(f,f===Xs?Ts:0);if(O===0)T!==null&&ju(T),f.callbackNode=null,f.callbackPriority=0;else if(g=O&-O,f.callbackPriority!==g){if(T!=null&&ju(T),g===1)f.tag===0?MN(jf.bind(null,f)):KR(jf.bind(null,f)),NN(function(){(Ir&6)===0&&eh()}),T=null;else{switch(wc(O)){case 1:T=Tc;break;case 4:T=ul;break;case 16:T=wa;break;case 536870912:T=Hd;break;default:T=wa}T=v_(T,JE.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function JE(f,g){if(__=-1,XE=0,(Ir&6)!==0)throw Error(i(327));var T=f.callbackNode;if(Rm()&&f.callbackNode!==T)return null;var O=Kl(f,f===Xs?Ts:0);if(O===0)return null;if((O&30)!==0||(O&f.expiredLanes)!==0||g)g=au(f,O);else{g=O;var M=Ir;Ir|=2;var H=VI();(Xs!==f||Ts!==g)&&(su=null,wm=Wr()+500,ch(f,g));do try{KN();break}catch(Ie){Wb(f,Ie)}while(!0);lb(),zE.current=H,Ir=M,ts!==null?g=0:(Xs=null,Ts=0,g=ws)}if(g!==0){if(g===2&&(M=Wo(f),M!==0&&(O=M,g=QE(f,M))),g===1)throw T=oo,ch(f,0),id(f,O),Co(f,Wr()),T;if(g===6)id(f,O);else{if(M=f.current.alternate,(O&30)===0&&!ev(M)&&(g=au(f,O),g===2&&(H=Wo(f),H!==0&&(O=H,g=QE(f,H))),g===1))throw T=oo,ch(f,0),id(f,O),Co(f,Wr()),T;switch(f.finishedWork=M,f.finishedLanes=O,g){case 0:case 1:throw Error(i(345));case 2:Bf(f,ra,su);break;case 3:if(id(f,O),(O&130023424)===O&&(g=KE+500-Wr(),10<g)){if(Kl(f,0)!==0)break;if(M=f.suspendedLanes,(M&O)!==O){ao(),f.pingedLanes|=f.suspendedLanes&M;break}f.timeoutHandle=Xg(Bf.bind(null,f,ra,su),g);break}Bf(f,ra,su);break;case 4:if(id(f,O),(O&4194240)===O)break;for(g=f.eventTimes,M=-1;0<O;){var ae=31-io(O);H=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~H}if(O=M,O=Wr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*$N(O/1960))-O,10<O){f.timeoutHandle=Xg(Bf.bind(null,f,ra,su),O);break}Bf(f,ra,su);break;case 5:Bf(f,ra,su);break;default:throw Error(i(329))}}}return Co(f,Wr()),f.callbackNode===T?JE.bind(null,f):null}function QE(f,g){var T=g_;return f.current.memoizedState.isDehydrated&&(ch(f,g).flags|=256),f=au(f,g),f!==2&&(g=ra,ra=T,g!==null&&ZE(g)),f}function ZE(f){ra===null?ra=f:ra.push.apply(ra,f)}function ev(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var O=0;O<T.length;O++){var M=T[O],H=M.getSnapshot;M=M.value;try{if(!gl(H(),M))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function id(f,g){for(g&=~$E,g&=~HE,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-io(g),O=1<<T;f[T]=-1,g&=~O}}function jf(f){if((Ir&6)!==0)throw Error(i(327));Rm();var g=Kl(f,0);if((g&1)===0)return Co(f,Wr()),null;var T=au(f,g);if(f.tag!==0&&T===2){var O=Wo(f);O!==0&&(g=O,T=QE(f,O))}if(T===1)throw T=oo,ch(f,0),id(f,g),Co(f,Wr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,Bf(f,ra,su),Co(f,Wr()),null}function y_(f,g){var T=Ir;Ir|=1;try{return f(g)}finally{Ir=T,Ir===0&&(wm=Wr()+500,mE&&eh())}}function sd(f){ou!==null&&ou.tag===0&&(Ir&6)===0&&Rm();var g=Ir;Ir|=1;var T=Mc.transition,O=sr;try{if(Mc.transition=null,sr=1,f)return f()}finally{sr=O,Mc.transition=T,Ir=g,(Ir&6)===0&&eh()}}function E_(){oc=_l.current,ki(_l)}function ch(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,kN(T)),ts!==null)for(T=ts.return;T!==null;){var O=T;switch(Zg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&hE();break;case 3:xf(),ki(Aa),ki(So),mb();break;case 5:mm(O);break;case 4:xf();break;case 13:ki(Li);break;case 19:ki(Li);break;case 10:ub(O.type._context);break;case 22:case 23:E_()}T=T.return}if(Xs=f,ts=f=od(f.current,null),Ts=oc=g,ws=0,oo=null,$E=HE=Vf=0,ra=g_=null,Nf!==null){for(g=0;g<Nf.length;g++)if(T=Nf[g],O=T.interleaved,O!==null){T.interleaved=null;var M=O.next,H=T.pending;if(H!==null){var ae=H.next;H.next=M,O.next=ae}T.pending=O}Nf=null}return f}function Wb(f,g){do{var T=ts;try{if(lb(),wE.current=AE,gm){for(var O=Gi.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}gm=!1}if(nu=0,bs=Ss=Gi=null,a_=!1,c_=0,GE.current=null,T===null||T.return===null){ws=1,oo=g,ts=null;break}e:{var H=f,ae=T.return,Ie=T,Le=g;if(g=Ts,Ie.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var rt=Le,At=Ie,Ot=At.tag;if((At.mode&1)===0&&(Ot===0||Ot===11||Ot===15)){var It=At.alternate;It?(At.updateQueue=It.updateQueue,At.memoizedState=It.memoizedState,At.lanes=It.lanes):(At.updateQueue=null,At.memoizedState=null)}var qt=yI(ae);if(qt!==null){qt.flags&=-257,EI(qt,ae,Ie,H,g),qt.mode&1&&_I(H,rt,g),g=qt,Le=rt;var en=g.updateQueue;if(en===null){var tn=new Set;tn.add(Le),g.updateQueue=tn}else en.add(Le);break e}else{if((g&1)===0){_I(H,rt,g),zb();break e}Le=Error(i(426))}}else if(fi&&Ie.mode&1){var ns=yI(ae);if(ns!==null){(ns.flags&65536)===0&&(ns.flags|=256),EI(ns,ae,Ie,H,g),ab(vm(Le,Ie));break e}}H=Le=vm(Le,Ie),ws!==4&&(ws=2),g_===null?g_=[H]:g_.push(H),H=ae;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Ye=Pb(H,Le,g);tI(H,Ye);break e;case 1:Ie=Le;var Ve=H.type,Je=H.stateNode;if((H.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Je!==null&&typeof Je.componentDidCatch=="function"&&(ah===null||!ah.has(Je)))){H.flags|=65536,g&=-g,H.lanes|=g;var Dt=rd(H,Ie,g);tI(H,Dt);break e}}H=H.return}while(H!==null)}jI(T)}catch(rn){g=rn,ts===T&&T!==null&&(ts=T=T.return);continue}break}while(!0)}function VI(){var f=zE.current;return zE.current=AE,f===null?AE:f}function zb(){(ws===0||ws===3||ws===2)&&(ws=4),Xs===null||(Vf&268435455)===0&&(HE&268435455)===0||id(Xs,Ts)}function au(f,g){var T=Ir;Ir|=2;var O=VI();(Xs!==f||Ts!==g)&&(su=null,ch(f,g));do try{FI();break}catch(M){Wb(f,M)}while(!0);if(lb(),Ir=T,zE.current=O,ts!==null)throw Error(i(261));return Xs=null,Ts=0,ws}function FI(){for(;ts!==null;)tv(ts)}function KN(){for(;ts!==null&&!Bo();)tv(ts)}function tv(f){var g=iv(f.alternate,f,oc);f.memoizedProps=f.pendingProps,g===null?jI(f):ts=g,GE.current=null}function jI(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=FE(T,g,oc),T!==null){ts=T;return}}else{if(T=HN(T,g),T!==null){T.flags&=32767,ts=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{ws=6,ts=null;return}}if(g=g.sibling,g!==null){ts=g;return}ts=g=f}while(g!==null);ws===0&&(ws=5)}function Bf(f,g,T){var O=sr,M=Mc.transition;try{Mc.transition=null,sr=1,qN(f,g,T,O)}finally{Mc.transition=M,sr=O}return null}function qN(f,g,T,O){do Rm();while(ou!==null);if((Ir&6)!==0)throw Error(i(327));T=f.finishedWork;var M=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var H=T.lanes|T.childLanes;if(Kr(f,H),f===Xs&&(ts=Xs=null,Ts=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Cm||(Cm=!0,v_(wa,function(){return Rm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=Mc.transition,Mc.transition=null;var ae=sr;sr=1;var Ie=Ir;Ir|=4,GE.current=null,xb(f,T),Vb(T,f),X0(Yg),Se=!!dE,Yg=dE=null,f.current=T,Tm(T),Gd(),Ir=Ie,sr=ae,Mc.transition=H}else f.current=T;if(Cm&&(Cm=!1,ou=f,YE=M),H=f.pendingLanes,H===0&&(ah=null),$p(T.stateNode),Co(f,Wr()),g!==null)for(O=f.onRecoverableError,T=0;T<g.length;T++)M=g[T],O(M.value,{componentStack:M.stack,digest:M.digest});if(qE)throw qE=!1,f=jb,jb=null,f;return(YE&1)!==0&&f.tag!==0&&Rm(),H=f.pendingLanes,(H&1)!==0?f===Bb?Ff++:(Ff=0,Bb=f):Ff=0,eh(),null}function Rm(){if(ou!==null){var f=wc(YE),g=Mc.transition,T=sr;try{if(Mc.transition=null,sr=16>f?16:f,ou===null)var O=!1;else{if(f=ou,ou=null,YE=0,(Ir&6)!==0)throw Error(i(331));var M=Ir;for(Ir|=4,Qt=f.current;Qt!==null;){var H=Qt,ae=H.child;if((Qt.flags&16)!==0){var Ie=H.deletions;if(Ie!==null){for(var Le=0;Le<Ie.length;Le++){var rt=Ie[Le];for(Qt=rt;Qt!==null;){var At=Qt;switch(At.tag){case 0:case 11:case 15:f_(8,At,H)}var Ot=At.child;if(Ot!==null)Ot.return=At,Qt=Ot;else for(;Qt!==null;){At=Qt;var It=At.sibling,qt=At.return;if(DI(At),At===rt){Qt=null;break}if(It!==null){It.return=qt,Qt=It;break}Qt=qt}}}var en=H.alternate;if(en!==null){var tn=en.child;if(tn!==null){en.child=null;do{var ns=tn.sibling;tn.sibling=null,tn=ns}while(tn!==null)}}Qt=H}}if((H.subtreeFlags&2064)!==0&&ae!==null)ae.return=H,Qt=ae;else e:for(;Qt!==null;){if(H=Qt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:f_(9,H,H.return)}var Ye=H.sibling;if(Ye!==null){Ye.return=H.return,Qt=Ye;break e}Qt=H.return}}var Ve=f.current;for(Qt=Ve;Qt!==null;){ae=Qt;var Je=ae.child;if((ae.subtreeFlags&2064)!==0&&Je!==null)Je.return=ae,Qt=Je;else e:for(ae=Ve;Qt!==null;){if(Ie=Qt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:p_(9,Ie)}}catch(rn){Hi(Ie,Ie.return,rn)}if(Ie===ae){Qt=null;break e}var Dt=Ie.sibling;if(Dt!==null){Dt.return=Ie.return,Qt=Dt;break e}Qt=Ie.return}}if(Ir=M,eh(),vo&&typeof vo.onPostCommitFiberRoot=="function")try{vo.onPostCommitFiberRoot(Hl,f)}catch{}O=!0}return O}finally{sr=T,Mc.transition=g}}return!1}function nv(f,g,T){g=vm(T,g),g=Pb(f,g,1),f=rh(f,g,1),g=ao(),f!==null&&(ql(f,1,g),Co(f,g))}function Hi(f,g,T){if(f.tag===3)nv(f,f,T);else for(;g!==null;){if(g.tag===3){nv(g,f,T);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(ah===null||!ah.has(O))){f=vm(T,f),f=rd(g,f,1),g=rh(g,f,1),f=ao(),g!==null&&(ql(g,1,f),Co(g,f));break}}g=g.return}}function BI(f,g,T){var O=f.pingCache;O!==null&&O.delete(g),g=ao(),f.pingedLanes|=f.suspendedLanes&T,Xs===f&&(Ts&T)===T&&(ws===4||ws===3&&(Ts&130023424)===Ts&&500>Wr()-KE?ch(f,0):$E|=T),Co(f,g)}function Gb(f,g){g===0&&((f.mode&1)===0?g=1:(g=pr,pr<<=1,(pr&130023424)===0&&(pr=4194304)));var T=ao();f=ed(f,g),f!==null&&(ql(f,g,T),Co(f,T))}function rv(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),Gb(f,T)}function WI(f,g){var T=0;switch(f.tag){case 13:var O=f.stateNode,M=f.memoizedState;M!==null&&(T=M.retryLane);break;case 19:O=f.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(g),Gb(f,T)}var iv;iv=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||Aa.current)Da=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return Da=!1,AI(f,g,T);Da=(f.flags&131072)!==0}else Da=!1,fi&&(g.flags&1048576)!==0&&_E(g,gE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;UE(f,g),f=g.pendingProps;var M=Of(g,So.current);Zu(g,T),M=_m(null,g,O,f,M,T);var H=yb();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Pa(O)?(H=!0,pE(g)):H=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,r_(g),M.updater=OE,g.stateNode=M,M._reactInternals=g,Rb(g,O,f,T),g=NE(null,g,O,!0,H,T)):(g.tag=0,fi&&H&&yE(g),ta(null,g,M,T),g=g.child),g;case 16:O=g.elementType;e:{switch(UE(f,g),f=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=Wf(O),f=sc(O,f),M){case 0:g=Ob(null,g,O,f,T);break e;case 1:g=wI(null,g,O,f,T);break e;case 11:g=kE(null,g,O,f,T);break e;case 14:g=vI(null,g,O,sc(O.type,f),T);break e}throw Error(i(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:sc(O,M),Ob(f,g,O,M,T);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:sc(O,M),wI(f,g,O,M,T);case 3:e:{if(kb(g),f===null)throw Error(i(387));O=g.pendingProps,H=g.memoizedState,M=H.element,eI(f,g),TE(g,O,null,T);var ae=g.memoizedState;if(O=ae.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){M=vm(Error(i(423)),g),g=CI(f,g,O,T,M);break e}else if(O!==M){M=vm(Error(i(424)),g),g=CI(f,g,O,T,M);break e}else for(ka=Jd(g.stateNode.containerInfo.firstChild),Oa=g,fi=!0,Zo=null,T=QR(g,null,O,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(dm(),O===M){g=ru(f,g,T);break e}ta(f,g,O,T)}g=g.child}return g;case 5:return rI(g),f===null&&ob(g),O=g.type,M=g.pendingProps,H=f!==null?f.memoizedProps:null,ae=M.children,nb(O,M)?ae=null:H!==null&&nb(O,H)&&(g.flags|=32),TI(f,g),ta(f,g,ae,T),g.child;case 6:return f===null&&ob(g),null;case 13:return DE(f,g,T);case 4:return fb(g,g.stateNode.containerInfo),O=g.pendingProps,f===null?g.child=hm(g,null,O,T):ta(f,g,O,T),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:sc(O,M),kE(f,g,O,M,T);case 7:return ta(f,g,g.pendingProps,T),g.child;case 8:return ta(f,g,g.pendingProps.children,T),g.child;case 12:return ta(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,H=g.memoizedProps,ae=M.value,Ti(SE,O._currentValue),O._currentValue=ae,H!==null)if(gl(H.value,ae)){if(H.children===M.children&&!Aa.current){g=ru(f,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ie=H.dependencies;if(Ie!==null){ae=H.child;for(var Le=Ie.firstContext;Le!==null;){if(Le.context===O){if(H.tag===1){Le=eu(-1,T&-T),Le.tag=2;var rt=H.updateQueue;if(rt!==null){rt=rt.shared;var At=rt.pending;At===null?Le.next=Le:(Le.next=At.next,At.next=Le),rt.pending=Le}}H.lanes|=T,Le=H.alternate,Le!==null&&(Le.lanes|=T),db(H.return,T,g),Ie.lanes|=T;break}Le=Le.next}}else if(H.tag===10)ae=H.type===g.type?null:H.child;else if(H.tag===18){if(ae=H.return,ae===null)throw Error(i(341));ae.lanes|=T,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=T),db(ae,T,g),ae=H.sibling}else ae=H.child;if(ae!==null)ae.return=H;else for(ae=H;ae!==null;){if(ae===g){ae=null;break}if(H=ae.sibling,H!==null){H.return=ae.return,ae=H;break}ae=ae.return}H=ae}ta(f,g,M.children,T),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Zu(g,T),M=Dc(M),O=O(M),g.flags|=1,ta(f,g,O,T),g.child;case 14:return O=g.type,M=sc(O,g.pendingProps),M=sc(O.type,M),vI(f,g,O,M,T);case 15:return SI(f,g,g.type,g.pendingProps,T);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:sc(O,M),UE(f,g),g.tag=1,Pa(O)?(f=!0,pE(g)):f=!1,Zu(g,T),mI(g,O,M),Rb(g,O,M,T),NE(null,g,O,!0,f,T);case 19:return ME(f,g,T);case 22:return bI(f,g,T)}throw Error(i(156,g.tag))};function v_(f,g){return zd(f,g)}function sv(f,g,T,O){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ac(f,g,T,O){return new sv(f,g,T,O)}function lh(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Wf(f){if(typeof f=="function")return lh(f)?1:0;if(f!=null){if(f=f.$$typeof,f===pe)return 11;if(f===He)return 14}return 2}function od(f,g){var T=f.alternate;return T===null?(T=ac(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function ov(f,g,T,O,M,H){var ae=2;if(O=f,typeof f=="function")lh(f)&&(ae=1);else if(typeof f=="string")ae=5;else e:switch(f){case ne:return zf(T.children,M,H,g);case ee:ae=8,M|=8;break;case Q:return f=ac(12,T,g,M|2),f.elementType=Q,f.lanes=H,f;case ue:return f=ac(13,T,g,M),f.elementType=ue,f.lanes=H,f;case Me:return f=ac(19,T,g,M),f.elementType=Me,f.lanes=H,f;case we:return uh(T,M,H,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case se:ae=10;break e;case fe:ae=9;break e;case pe:ae=11;break e;case He:ae=14;break e;case nt:ae=16,O=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return g=ac(ae,T,g,M),g.elementType=f,g.type=O,g.lanes=H,g}function zf(f,g,T,O){return f=ac(7,f,O,g),f.lanes=T,f}function uh(f,g,T,O){return f=ac(22,f,O,g),f.elementType=we,f.lanes=T,f.stateNode={isHidden:!1},f}function Hb(f,g,T){return f=ac(6,f,null,g),f.lanes=T,f}function $b(f,g,T){return g=ac(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function YN(f,g,T,O,M){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=hl(0),this.expirationTimes=hl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hl(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Kb(f,g,T,O,M,H,ae,Ie,Le){return f=new YN(f,g,T,Ie,Le),g===1?(g=1,H===!0&&(g|=8)):g=0,H=ac(3,null,null,g),f.current=H,H.stateNode=f,H.memoizedState={element:O,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},r_(H),f}function XN(f,g,T){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_e,key:O==null?null:""+O,children:f,containerInfo:g,implementation:T}}function zI(f){if(!f)return Zd;f=f._reactInternals;e:{if(qs(f)!==f||f.tag!==1)throw Error(i(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Pa(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(Pa(T))return fE(f,T,g)}return g}function av(f,g,T,O,M,H,ae,Ie,Le){return f=Kb(T,O,!0,f,M,H,ae,Ie,Le),f.context=zI(null),T=f.current,O=ao(),M=Uc(T),H=eu(O,M),H.callback=g??null,rh(T,H,M),f.current.lanes=M,ql(f,M,O),Co(f,O),f}function S_(f,g,T,O){var M=g.current,H=ao(),ae=Uc(M);return T=zI(T),g.context===null?g.context=T:g.pendingContext=T,g=eu(H,ae),g.payload={element:f},O=O===void 0?null:O,O!==null&&(g.callback=O),f=rh(M,g,ae),f!==null&&(Vc(f,M,ae,H),i_(f,M,ae)),ae}function cv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function qb(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function Yb(f,g){qb(f,g),(f=f.alternate)&&qb(f,g)}function b_(){return null}var yl=typeof reportError=="function"?reportError:function(f){console.error(f)};function lv(f){this._internalRoot=f}uv.prototype.render=lv.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(i(409));S_(f,g,null,null)},uv.prototype.unmount=lv.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;sd(function(){S_(null,f,null,null)}),g[Pc]=null}};function uv(f){this._internalRoot=f}uv.prototype.unstable_scheduleHydration=function(f){if(f){var g=_f();f={blockedOn:null,target:f,priority:g};for(var T=0;T<Ko.length&&g!==0&&g<Ko[T].priority;T++);Ko.splice(T,0,f),T===0&&Ef(f)}};function Xb(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function Im(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function Jb(){}function JN(f,g,T,O,M){if(M){if(typeof O=="function"){var H=O;O=function(){var rt=cv(ae);H.call(rt)}}var ae=av(g,O,f,0,null,!1,!1,"",Jb);return f._reactRootContainer=ae,f[Pc]=ae.current,Cf(f.nodeType===8?f.parentNode:f),sd(),ae}for(;M=f.lastChild;)f.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var rt=cv(Le);Ie.call(rt)}}var Le=Kb(f,0,!1,null,null,!1,!1,"",Jb);return f._reactRootContainer=Le,f[Pc]=Le.current,Cf(f.nodeType===8?f.parentNode:f),sd(function(){S_(g,Le,T,O)}),Le}function Gf(f,g,T,O,M){var H=T._reactRootContainer;if(H){var ae=H;if(typeof M=="function"){var Ie=M;M=function(){var Le=cv(ae);Ie.call(Le)}}S_(g,ae,f,M)}else ae=JN(T,g,f,M,O);return cv(ae)}Kp=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=$l(g.pendingLanes);T!==0&&(ec(g,T|1),Co(g,Wr()),(Ir&6)===0&&(wm=Wr()+500,eh()))}break;case 13:sd(function(){var O=ed(f,1);if(O!==null){var M=ao();Vc(O,f,1,M)}}),Yb(f,1)}},Yl=function(f){if(f.tag===13){var g=ed(f,134217728);if(g!==null){var T=ao();Vc(g,f,134217728,T)}Yb(f,134217728)}},qd=function(f){if(f.tag===13){var g=Uc(f),T=ed(f,g);if(T!==null){var O=ao();Vc(T,f,g,O)}Yb(f,g)}},_f=function(){return sr},qp=function(f,g){var T=sr;try{return sr=f,g()}finally{sr=T}},Sc=function(f,g,T){switch(g){case"input":if(Bt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var O=T[g];if(O!==f&&O.form===f.form){var M=cm(O);if(!M)throw Error(i(90));Lt(O),Bt(O,M)}}}break;case"textarea":Gt(f,T);break;case"select":g=T.value,g!=null&&at(f,!!T.multiple,g,!1)}},ro=y_,_s=sd;var dh={usingClientEntryPoint:!1,Events:[am,Af,cm,Ea,va,y_]},ad={findFiberByHostInstance:If,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QN={bundleType:ad.bundleType,version:ad.version,rendererPackageName:ad.rendererPackageName,rendererConfig:ad.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Wd(f),f===null?null:f.stateNode},findFiberByHostInstance:ad.findFiberByHostInstance||b_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dv.isDisabled&&dv.supportsFiber)try{Hl=dv.inject(QN),vo=dv}catch{}}return Qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dh,Qc.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Xb(g))throw Error(i(200));return XN(f,g,null,T)},Qc.createRoot=function(f,g){if(!Xb(f))throw Error(i(299));var T=!1,O="",M=yl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=Kb(f,1,!1,null,null,T,!1,O,M),f[Pc]=g.current,Cf(f.nodeType===8?f.parentNode:f),new lv(g)},Qc.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Wd(g),f=f===null?null:f.stateNode,f},Qc.flushSync=function(f){return sd(f)},Qc.hydrate=function(f,g,T){if(!Im(g))throw Error(i(200));return Gf(null,f,g,!0,T)},Qc.hydrateRoot=function(f,g,T){if(!Xb(f))throw Error(i(405));var O=T!=null&&T.hydratedSources||null,M=!1,H="",ae=yl;if(T!=null&&(T.unstable_strictMode===!0&&(M=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(ae=T.onRecoverableError)),g=av(g,null,f,1,T??null,M,!1,H,ae),f[Pc]=g.current,Cf(f),O)for(f=0;f<O.length;f++)T=O[f],M=T._getVersion,M=M(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,M]:g.mutableSourceEagerHydrationData.push(T,M);return new uv(g)},Qc.render=function(f,g,T){if(!Im(g))throw Error(i(200));return Gf(null,f,g,!1,T)},Qc.unmountComponentAtNode=function(f){if(!Im(f))throw Error(i(40));return f._reactRootContainer?(sd(function(){Gf(null,null,f,!1,function(){f._reactRootContainer=null,f[Pc]=null})}),!0):!1},Qc.unstable_batchedUpdates=y_,Qc.unstable_renderSubtreeIntoContainer=function(f,g,T,O){if(!Im(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return Gf(f,g,T,!1,O)},Qc.version="18.3.1-next-f1338f8080-20240426",Qc}var Q$;function kQ(){if(Q$)return HM.exports;Q$=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),HM.exports=Eye(),HM.exports}var Z$;function vye(){if(Z$)return cO;Z$=1;var n=kQ();return cO.createRoot=n.createRoot,cO.hydrateRoot=n.hydrateRoot,cO}var Sye=vye();const l1=Gy(Sye);function bye(n,e,i,a){return n.addEventListener(e,i,a),()=>{n.removeEventListener(e,i,a)}}function u1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Tye(){return!!(globalThis!=null&&globalThis.document)}function NQ(n){return n.parentElement&&NQ(n.parentElement)?!0:n.hidden}function wye(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function Cye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function Rye(n){var e;return((e=DQ(n))==null?void 0:e.defaultView)??window}function DQ(n){return u1(n)?n.ownerDocument:document}function Iye(n){return n.view??window}function Aye(n){return DQ(n).activeElement}function Pye(n){const e=Iye(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function xQ(n){return!!n.touches}function Oye(n){return xQ(n)&&n.touches.length>1}function kye(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function Nye(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function LQ(n,e="page"){return xQ(n)?kye(n,e):Nye(n,e)}function Dye(n){return e=>{const i=Pye(e);(!i||i&&e.button===0)&&n(e)}}function xye(n,e=!1){function i(l){n(l,{point:LQ(l)})}return e?Dye(i):i}function jO(n,e,i,a){return bye(n,e,xye(i,e==="pointerdown"),a)}function Lye(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of e)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const Xn=n=>n?"":void 0,GS=n=>n?!0:void 0;function Mye(n){return Array.isArray(n)}function Nu(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!Mye(n)}function Uye(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function Vye(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function yU(n){if(n==null)return n;const{unitless:e}=Vye(n);return e||typeof n=="number"?`${n}px`:n}const MQ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,rF=n=>Object.fromEntries(Object.entries(n).sort(MQ));function eK(n){const e=rF(n);return Object.assign(Object.values(e),e)}function Fye(n){const e=Object.keys(rF(n));return new Set(e)}function tK(n){if(!n)return n;n=yU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function kw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${yU(n)})`),e&&i.push("and",`(max-width: ${yU(e)})`),i.join(" ")}function jye(n){if(!n)return null;n.base=n.base??"0px";const e=eK(n),i=Object.entries(n).sort(MQ).map(([d,p],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?tK(b):void 0,{_minW:tK(p),breakpoint:d,minW:p,maxW:b,maxWQuery:kw(null,b),minWQuery:kw(p),minMaxQuery:kw(p,b)}}),a=Fye(n),l=Array.from(a.values());return{keys:a,normalized:e,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(y=>a.has(y))},asObject:rF(n),asArray:eK(n),details:i,get(d){return i.find(p=>p.breakpoint===d)},media:[null,...e.map(d=>kw(d)).slice(1)],toArrayValue(d){if(!Nu(d))throw new Error("toArrayValue: value must be an object");const p=l.map(y=>d[y]??null);for(;Uye(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,y,v)=>{const b=l[v];return b!=null&&y!=null&&(p[b]=y),p},{})}}}function UQ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function er(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function iF(n){return D.Children.toArray(n).filter(e=>D.isValidElement(e))}function d1(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function Bye(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Fi(n={}){const{name:e,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,y=D.createContext(p);y.displayName=e;function v(){var w;const b=D.useContext(y);if(!b&&i){const A=new Error(d??Bye(a,l));throw A.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,A,v),A}return b}return[y.Provider,v,y]}const dn=(...n)=>n.filter(Boolean).join(" "),VQ=n=>n.hasAttribute("tabindex"),Wye=n=>VQ(n)&&n.tabIndex===-1;function vk(n){if(!u1(n)||NQ(n)||Cye(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in a?a[e]():wye(n)?!0:VQ(n)}function zye(n){return n?u1(n)&&vk(n)&&!Wye(n):!1}const Gye=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],Hye=Gye.join(),$ye=n=>n.offsetWidth>0&&n.offsetHeight>0;function FQ(n){const e=Array.from(n.querySelectorAll(Hye));return e.unshift(n),e.filter(i=>vk(i)&&$ye(i))}function Kye(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const qye=n=>{const e=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const y=e.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,p);return y.set(l,v),v}},jQ=qye(Kye),Yye=n=>n.default||n;function sF(n){const{wasSelected:e,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&e)}function Xye(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function Jye(n,e){let i=Xye(n);const a=10**(e??10);return i=Math.round(i*a)/a,e?i.toFixed(e):i.toString()}function Qye(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function nK(n,e,i){return(n-e)*100/(i-e)}function Zye(n,e,i){return(i-e)*n+e}function rK(n,e,i){const a=Math.round((n-e)/i)*i+e,l=Qye(i);return Jye(a,l)}function qM(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function D0(n,e=[]){const i=Object.assign({},n);for(const a of e)a in i&&delete i[a];return i}function BQ(n,e){const i={};for(const a of e)a in n&&(i[a]=n[a]);return i}function h1(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Nu(n)?Object.keys(n).reduce((i,a)=>(i[a]=e(n[a]),i),{}):n!=null?e(n):null}const eEe=n=>typeof n=="function";function il(n,...e){return eEe(n)?n(...e):n}function tEe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function nEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function WQ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:u1(n)&&tEe(n)?n:WQ(nEe(n))}function rEe(n,e){const i={},a={};for(const[l,d]of Object.entries(n))e.includes(l)?i[l]=d:a[l]=d;return[i,a]}function iEe(n,...e){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=p=>{const y={};for(let v=0;v<p.length;v++){const b=p[v];i[b]&&(Object.defineProperty(y,b,i[b]),delete i[b])}return y},d=p=>l(Array.isArray(p)?p:a.filter(p));return e.map(d).concat(l(a))}function iK(n,e,i={}){const{stop:a,getKey:l}=i;function d(p,y=[]){if(Nu(p)||Array.isArray(p)){const v={};for(const[b,w]of Object.entries(p)){const A=(l==null?void 0:l(b))??b,N=[...y,A];if(a!=null&&a(p,N))return e(p,y);v[A]=d(w,N)}return v}return e(p,y)}return d(n)}var Nw={exports:{}};Nw.exports;var sK;function sEe(){return sK||(sK=1,function(n,e){var i=200,a="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",A="[object Date]",N="[object Error]",V="[object Function]",F="[object GeneratorFunction]",B="[object Map]",W="[object Number]",J="[object Null]",$="[object Object]",te="[object Proxy]",ce="[object RegExp]",oe="[object Set]",_e="[object String]",ne="[object Undefined]",ee="[object WeakMap]",Q="[object ArrayBuffer]",se="[object DataView]",fe="[object Float32Array]",pe="[object Float64Array]",ue="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",nt="[object Uint8Array]",we="[object Uint8ClampedArray]",Re="[object Uint16Array]",ve="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ae={};Ae[fe]=Ae[pe]=Ae[ue]=Ae[Me]=Ae[He]=Ae[nt]=Ae[we]=Ae[Re]=Ae[ve]=!0,Ae[y]=Ae[v]=Ae[Q]=Ae[w]=Ae[se]=Ae[A]=Ae[N]=Ae[V]=Ae[B]=Ae[W]=Ae[$]=Ae[ce]=Ae[oe]=Ae[_e]=Ae[ee]=!1;var Ue=typeof my=="object"&&my&&my.Object===Object&&my,Ge=typeof self=="object"&&self&&self.Object===Object&&self,Qe=Ue||Ge||Function("return this")(),tt=e&&!e.nodeType&&e,ht=tt&&!0&&n&&!n.nodeType&&n,Ze=ht&&ht.exports===tt,Ct=Ze&&Ue.process,un=function(){try{var Se=ht&&ht.require&&ht.require("util").types;return Se||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Lt=un&&un.isTypedArray;function nn(Se,De,et){switch(et.length){case 0:return Se.call(De);case 1:return Se.call(De,et[0]);case 2:return Se.call(De,et[0],et[1]);case 3:return Se.call(De,et[0],et[1],et[2])}return Se.apply(De,et)}function kn(Se,De){for(var et=-1,Xt=Array(Se);++et<Se;)Xt[et]=De(et);return Xt}function Kt(Se){return function(De){return Se(De)}}function zn(Se,De){return Se==null?void 0:Se[De]}function Bt(Se,De){return function(et){return Se(De(et))}}var Ce=Array.prototype,Fe=Function.prototype,We=Object.prototype,at=Qe["__core-js_shared__"],vt=Fe.toString,St=We.hasOwnProperty,Gt=function(){var Se=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),fn=We.toString,Ln=vt.call(Object),cn=RegExp("^"+vt.call(St).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),dr=Ze?Qe.Buffer:void 0,_a=Qe.Symbol,Vt=Qe.Uint8Array;dr&&dr.allocUnsafe;var on=Bt(Object.getPrototypeOf,Object),Wi=Object.create,gs=We.propertyIsEnumerable,Ms=Ce.splice,ii=_a?_a.toStringTag:void 0,Pt=function(){try{var Se=Za(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),wn=dr?dr.isBuffer:void 0,ir=Math.max,xi=Date.now,Sc=Za(Qe,"Map"),as=Za(Object,"create"),ya=function(){function Se(){}return function(De){if(!Cc(De))return{};if(Wi)return Wi(De);Se.prototype=De;var et=new Se;return Se.prototype=void 0,et}}();function Eo(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Xt=Se[De];this.set(Xt[0],Xt[1])}}function Ea(){this.__data__=as?as(null):{},this.size=0}function va(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function ro(Se){var De=this.__data__;if(as){var et=De[Se];return et===a?void 0:et}return St.call(De,Se)?De[Se]:void 0}function _s(Se){var De=this.__data__;return as?De[Se]!==void 0:St.call(De,Se)}function cs(Se,De){var et=this.__data__;return this.size+=this.has(Se)?0:1,et[Se]=as&&De===void 0?a:De,this}Eo.prototype.clear=Ea,Eo.prototype.delete=va,Eo.prototype.get=ro,Eo.prototype.has=_s,Eo.prototype.set=cs;function jo(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Xt=Se[De];this.set(Xt[0],Xt[1])}}function zi(){this.__data__=[],this.size=0}function ys(Se){var De=this.__data__,et=Gd(De,Se);if(et<0)return!1;var Xt=De.length-1;return et==Xt?De.pop():Ms.call(De,et,1),--this.size,!0}function Ja(Se){var De=this.__data__,et=Gd(De,Se);return et<0?void 0:De[et][1]}function Uu(Se){return Gd(this.__data__,Se)>-1}function bc(Se,De){var et=this.__data__,Xt=Gd(et,Se);return Xt<0?(++this.size,et.push([Se,De])):et[Xt][1]=De,this}jo.prototype.clear=zi,jo.prototype.delete=ys,jo.prototype.get=Ja,jo.prototype.has=Uu,jo.prototype.set=bc;function Sa(Se){var De=-1,et=Se==null?0:Se.length;for(this.clear();++De<et;){var Xt=Se[De];this.set(Xt[0],Xt[1])}}function ba(){this.size=0,this.__data__={hash:new Eo,map:new(Sc||jo),string:new Eo}}function jd(Se){var De=Bu(this,Se).delete(Se);return this.size-=De?1:0,De}function Vg(Se){return Bu(this,Se).get(Se)}function Vu(Se){return Bu(this,Se).has(Se)}function pf(Se,De){var et=Bu(this,Se),Xt=et.size;return et.set(Se,De),this.size+=et.size==Xt?0:1,this}Sa.prototype.clear=ba,Sa.prototype.delete=jd,Sa.prototype.get=Vg,Sa.prototype.has=Vu,Sa.prototype.set=pf;function qs(Se){var De=this.__data__=new jo(Se);this.size=De.size}function Fu(){this.__data__=new jo,this.size=0}function Ta(Se){var De=this.__data__,et=De.delete(Se);return this.size=De.size,et}function Bd(Se){return this.__data__.get(Se)}function Wd(Se){return this.__data__.has(Se)}function Qa(Se,De){var et=this.__data__;if(et instanceof jo){var Xt=et.__data__;if(!Sc||Xt.length<i-1)return Xt.push([Se,De]),this.size=++et.size,this;et=this.__data__=new Sa(Xt)}return et.set(Se,De),this.size=et.size,this}qs.prototype.clear=Fu,qs.prototype.delete=Ta,qs.prototype.get=Bd,qs.prototype.has=Wd,qs.prototype.set=Qa;function zd(Se,De){var et=Go(Se),Xt=!et&&ls(Se),qn=!et&&!Xt&&$o(Se),vr=!et&&!Xt&&!qn&&Ef(Se),zr=et||Xt||qn||vr,ln=zr?kn(Se.length,String):[],Lr=ln.length;for(var bi in Se)zr&&(bi=="length"||qn&&(bi=="offset"||bi=="parent")||vr&&(bi=="buffer"||bi=="byteLength"||bi=="byteOffset")||hl(bi,Lr))||ln.push(bi);return ln}function ju(Se,De,et){(et!==void 0&&!zo(Se[De],et)||et===void 0&&!(De in Se))&&Wr(Se,De,et)}function Bo(Se,De,et){var Xt=Se[De];(!(St.call(Se,De)&&zo(Xt,et))||et===void 0&&!(De in Se))&&Wr(Se,De,et)}function Gd(Se,De){for(var et=Se.length;et--;)if(zo(Se[et][0],De))return et;return-1}function Wr(Se,De,et){De=="__proto__"&&Pt?Pt(Se,De,{configurable:!0,enumerable:!0,value:et,writable:!0}):Se[De]=et}var Si=Kl();function Tc(Se){return Se==null?Se===void 0?ne:J:ii&&ii in Object(Se)?Wo(Se):Kp(Se)}function ul(Se){return Es(Se)&&Tc(Se)==y}function wa(Se){if(!Cc(Se)||ec(Se))return!1;var De=Ko(Se)?cn:Te;return De.test(yf(Se))}function mf(Se){return Es(Se)&&Yp(Se.length)&&!!Ae[Tc(Se)]}function Hd(Se){if(!Cc(Se))return wc(Se);var De=sr(Se),et=[];for(var Xt in Se)Xt=="constructor"&&(De||!St.call(Se,Xt))||et.push(Xt);return et}function Hl(Se,De,et,Xt,qn){Se!==De&&Si(De,function(vr,zr){if(qn||(qn=new qs),Cc(vr))vo(Se,De,zr,et,Hl,Xt,qn);else{var ln=Xt?Xt(qd(Se,zr),vr,zr+"",Se,De,qn):void 0;ln===void 0&&(ln=vr),ju(Se,zr,ln)}},Jl)}function vo(Se,De,et,Xt,qn,vr,zr){var ln=qd(Se,et),Lr=qd(De,et),bi=zr.get(Lr);if(bi){ju(Se,et,bi);return}var Us=vr?vr(ln,Lr,et+"",Se,De,zr):void 0,qo=Us===void 0;if(qo){var Yo=Go(Lr),Gu=!Yo&&$o(Lr),es=!Yo&&!Gu&&Ef(Lr);Us=Lr,Yo||Gu||es?Go(ln)?Us=ln:Xl(ln)?Us=Kd(ln):Gu?(qo=!1,Us=gf(Lr)):es?(qo=!1,Us=$d(Lr)):Us=[]:zu(Lr)||ls(Lr)?(Us=ln,ls(ln)?Us=fl(ln):(!Cc(ln)||Ko(ln))&&(Us=Wu(Lr))):qo=!1}qo&&(zr.set(Lr,Us),qn(Us,Lr,Xt,vr,zr),zr.delete(Lr)),ju(Se,et,Us)}function $p(Se,De){return _f(Yl(Se,De,Ra),Se+"")}var io=Pt?function(Se,De){return Pt(Se,"toString",{configurable:!0,enumerable:!1,value:Ca(De),writable:!0})}:Ra;function gf(Se,De){return Se.slice()}function dl(Se){var De=new Se.constructor(Se.byteLength);return new Vt(De).set(new Vt(Se)),De}function $d(Se,De){var et=dl(Se.buffer);return new Se.constructor(et,Se.byteOffset,Se.length)}function Kd(Se,De){var et=-1,Xt=Se.length;for(De||(De=Array(Xt));++et<Xt;)De[et]=Se[et];return De}function pr(Se,De,et,Xt){var qn=!et;et||(et={});for(var vr=-1,zr=De.length;++vr<zr;){var ln=De[vr],Lr=void 0;Lr===void 0&&(Lr=Se[ln]),qn?Wr(et,ln,Lr):Bo(et,ln,Lr)}return et}function $l(Se){return $p(function(De,et){var Xt=-1,qn=et.length,vr=qn>1?et[qn-1]:void 0,zr=qn>2?et[2]:void 0;for(vr=Se.length>3&&typeof vr=="function"?(qn--,vr):void 0,zr&&ql(et[0],et[1],zr)&&(vr=qn<3?void 0:vr,qn=1),De=Object(De);++Xt<qn;){var ln=et[Xt];ln&&Se(De,ln,Xt,vr)}return De})}function Kl(Se){return function(De,et,Xt){for(var qn=-1,vr=Object(De),zr=Xt(De),ln=zr.length;ln--;){var Lr=zr[++qn];if(et(vr[Lr],Lr,vr)===!1)break}return De}}function Bu(Se,De){var et=Se.__data__;return Kr(De)?et[typeof De=="string"?"string":"hash"]:et.map}function Za(Se,De){var et=zn(Se,De);return wa(et)?et:void 0}function Wo(Se){var De=St.call(Se,ii),et=Se[ii];try{Se[ii]=void 0;var Xt=!0}catch{}var qn=fn.call(Se);return Xt&&(De?Se[ii]=et:delete Se[ii]),qn}function Wu(Se){return typeof Se.constructor=="function"&&!sr(Se)?ya(on(Se)):{}}function hl(Se,De){var et=typeof Se;return De=De??p,!!De&&(et=="number"||et!="symbol"&&be.test(Se))&&Se>-1&&Se%1==0&&Se<De}function ql(Se,De,et){if(!Cc(et))return!1;var Xt=typeof De;return(Xt=="number"?Ho(et)&&hl(De,et.length):Xt=="string"&&De in et)?zo(et[De],Se):!1}function Kr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function ec(Se){return!!Gt&&Gt in Se}function sr(Se){var De=Se&&Se.constructor,et=typeof De=="function"&&De.prototype||We;return Se===et}function wc(Se){var De=[];if(Se!=null)for(var et in Object(Se))De.push(et);return De}function Kp(Se){return fn.call(Se)}function Yl(Se,De,et){return De=ir(De===void 0?Se.length-1:De,0),function(){for(var Xt=arguments,qn=-1,vr=ir(Xt.length-De,0),zr=Array(vr);++qn<vr;)zr[qn]=Xt[De+qn];qn=-1;for(var ln=Array(De+1);++qn<De;)ln[qn]=Xt[qn];return ln[De]=et(zr),nn(Se,this,ln)}}function qd(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var _f=qp(io);function qp(Se){var De=0,et=0;return function(){var Xt=xi(),qn=d-(Xt-et);if(et=Xt,qn>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function yf(Se){if(Se!=null){try{return vt.call(Se)}catch{}try{return Se+""}catch{}}return""}function zo(Se,De){return Se===De||Se!==Se&&De!==De}var ls=ul(function(){return arguments}())?ul:function(Se){return Es(Se)&&St.call(Se,"callee")&&!gs.call(Se,"callee")},Go=Array.isArray;function Ho(Se){return Se!=null&&Yp(Se.length)&&!Ko(Se)}function Xl(Se){return Es(Se)&&Ho(Se)}var $o=wn||pl;function Ko(Se){if(!Cc(Se))return!1;var De=Tc(Se);return De==V||De==F||De==b||De==te}function Yp(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=p}function Cc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function Es(Se){return Se!=null&&typeof Se=="object"}function zu(Se){if(!Es(Se)||Tc(Se)!=$)return!1;var De=on(Se);if(De===null)return!0;var et=St.call(De,"constructor")&&De.constructor;return typeof et=="function"&&et instanceof et&&vt.call(et)==Ln}var Ef=Lt?Kt(Lt):mf;function fl(Se){return pr(Se,Jl(Se))}function Jl(Se){return Ho(Se)?zd(Se):Hd(Se)}var Xp=$l(function(Se,De,et,Xt){Hl(Se,De,et,Xt)});function Ca(Se){return function(){return Se}}function Ra(Se){return Se}function pl(){return!1}n.exports=Xp}(Nw,Nw.exports)),Nw.exports}var oEe=sEe();const Gh=Gy(oEe);function sl(n,e=[]){const i=D.useRef(n);return D.useEffect(()=>{i.current=n}),D.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},e)}function HS(n,e,i,a){const l=sl(i);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(e,l,a),()=>{d.removeEventListener(e,l,a)}},[e,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(e,l,a)}}function zQ(n){const{isOpen:e,ref:i}=n,[a,l]=D.useState(e),[d,p]=D.useState(!1);return D.useEffect(()=>{d||(l(e),p(!0))},[e,d,a]),HS(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!a),onComplete(){var w;const v=Rye(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(w=i.current)==null||w.dispatchEvent(b)}}}var YM,oK;function aEe(){return oK||(oK=1,YM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),YM}var XM,aK;function cEe(){if(aK)return XM;aK=1;var n=aEe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(d){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,p)}function l(d,p){var y,v,b,w,A,N,V=!1;p||(p={}),y=p.debug||!1;try{b=n(),w=document.createRange(),A=document.getSelection(),N=document.createElement("span"),N.textContent=d,N.ariaHidden="true",N.style.all="unset",N.style.position="fixed",N.style.top=0,N.style.clip="rect(0, 0, 0, 0)",N.style.whiteSpace="pre",N.style.webkitUserSelect="text",N.style.MozUserSelect="text",N.style.msUserSelect="text",N.style.userSelect="text",N.addEventListener("copy",function(B){if(B.stopPropagation(),p.format)if(B.preventDefault(),typeof B.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var W=e[p.format]||e.default;window.clipboardData.setData(W,d)}else B.clipboardData.clearData(),B.clipboardData.setData(p.format,d);p.onCopy&&(B.preventDefault(),p.onCopy(B.clipboardData))}),document.body.appendChild(N),w.selectNodeContents(N),A.addRange(w);var F=document.execCommand("copy");if(!F)throw new Error("copy command was unsuccessful");V=!0}catch(B){y&&console.error("unable to copy using execCommand: ",B),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",d),p.onCopy&&p.onCopy(window.clipboardData),V=!0}catch(W){y&&console.error("unable to copy using clipboardData: ",W),y&&console.error("falling back to prompt"),v=a("message"in p?p.message:i),window.prompt(v,d)}}finally{A&&(typeof A.removeRange=="function"?A.removeRange(w):A.removeAllRanges()),N&&document.body.removeChild(N),b()}return V}return XM=l,XM}var lEe=cEe();const cK=Gy(lEe);function lK(n,e={}){const[i,a]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:p=1500,...y}=typeof e=="number"?{timeout:e}:e,v=D.useCallback(b=>{const w=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(cK(w,y))):a(cK(w,y))},[l,y]);return D.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{a(!1)},p)),()=>{b&&window.clearTimeout(b)}},[p,i]),{value:l,setValue:d,onCopy:v,hasCopied:i}}function GQ(n){const{value:e,defaultValue:i,onChange:a,shouldUpdate:l=(N,V)=>N!==V}=n,d=sl(a),p=sl(l),[y,v]=D.useState(i),b=e!==void 0,w=b?e:y,A=sl(N=>{const F=typeof N=="function"?N(w):N;p(w,F)&&(b||v(F),d(F))},[b,d,w,p]);return[w,A]}function of(n={}){const{onClose:e,onOpen:i,isOpen:a,id:l}=n,d=sl(i),p=sl(e),[y,v]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:y,w=a!==void 0,A=D.useId(),N=l??`disclosure-${A}`,V=D.useCallback(()=>{w||v(!1),p==null||p()},[w,p]),F=D.useCallback(()=>{w||v(!0),d==null||d()},[w,d]),B=D.useCallback(()=>{b?V():F()},[b,F,V]);function W($={}){return{...$,"aria-expanded":b,"aria-controls":N,onClick(te){var ce;(ce=$.onClick)==null||ce.call($,te),B()}}}function J($={}){return{...$,hidden:!b,id:N}}return{isOpen:b,onOpen:F,onClose:V,onToggle:B,isControlled:w,getButtonProps:W,getDisclosureProps:J}}const Rp=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,vg=(n,e)=>{const i=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},e),D.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function uEe(n){const e=n.current;if(!e)return!1;const i=Aye(e);return!i||e.contains(i)?!1:!!zye(i)}function HQ(n,e){const{shouldFocus:i,visible:a,focusRef:l}=e,d=i&&!a;vg(()=>{if(!d||uEe(n))return;const p=(l==null?void 0:l.current)||n.current;let y;if(p)return y=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[d,n,l])}const dEe={preventScroll:!0,shouldFocus:!1};function hEe(n,e=dEe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=e,p=fEe(n)?n.current:n,y=l&&d,v=D.useRef(y),b=D.useRef(d);Rp(()=>{!b.current&&d&&(v.current=y),b.current=d},[d,y]);const w=D.useCallback(()=>{if(!(!d||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var A;(A=i.current)==null||A.focus({preventScroll:a})});else{const A=FQ(p);A.length>0&&requestAnimationFrame(()=>{A[0].focus({preventScroll:a})})}},[d,a,p,i]);vg(()=>{w()},[w]),HS(p,"transitionend",w)}function fEe(n){return"current"in n}function pEe(n){return"current"in n}const $Q=()=>typeof window<"u";function mEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const gEe=n=>$Q()&&n.test(navigator.vendor),_Ee=n=>$Q()&&n.test(mEe()),yEe=()=>_Ee(/mac|iphone|ipad|ipod/i),EEe=()=>yEe()&&gEe(/apple/i);function vEe(n){const{ref:e,elements:i,enabled:a}=n,l=()=>{var d;return((d=e.current)==null?void 0:d.ownerDocument)??document};HS(l,"pointerdown",d=>{var b,w;if(!EEe()||!a)return;const p=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,v=(i??[e]).some(A=>{const N=pEe(A)?A.current:A;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(d.preventDefault(),p.focus())})}function SEe(n,e){const i=D.useId();return D.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function bEe(n,...e){const i=SEe(n);return D.useMemo(()=>e.map(a=>`${a}-${i}`),[i,e])}function KQ(n){const e=D.useRef(null);return e.current=n,e}function TEe(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function os(...n){return e=>{n.forEach(i=>{TEe(i,e)})}}function wEe(...n){return D.useMemo(()=>os(...n),n)}function qQ(n){const{ref:e,handler:i,enabled:a=!0}=n,l=sl(i),p=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const y=A=>{JM(A,e)&&(p.isPointerDown=!0)},v=A=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&JM(A,e)&&(p.isPointerDown=!1,l(A))},b=A=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&JM(A,e)&&(p.isPointerDown=!1,l(A))},w=YQ(e.current);return w.addEventListener("mousedown",y,!0),w.addEventListener("mouseup",v,!0),w.addEventListener("touchstart",y,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",y,!0),w.removeEventListener("mouseup",v,!0),w.removeEventListener("touchstart",y,!0),w.removeEventListener("touchend",b,!0)}},[i,e,l,p,a])}function JM(n,e){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!YQ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function YQ(n){return(n==null?void 0:n.ownerDocument)??document}function CEe(n,e){const i=sl(n);D.useEffect(()=>{if(e==null)return;let a=null;return a=window.setTimeout(()=>{i()},e),()=>{a&&window.clearTimeout(a)}},[e,i])}const XQ=1/60*1e3,REe=typeof performance<"u"?()=>performance.now():()=>Date.now(),JQ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(REe()),XQ);function IEe(n){let e=[],i=[],a=0,l=!1,d=!1;const p=new WeakSet,y={schedule:(v,b=!1,w=!1)=>{const A=w&&l,N=A?e:i;return b&&p.add(v),N.indexOf(v)===-1&&(N.push(v),A&&l&&(a=e.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),p.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,a=e.length,a)for(let b=0;b<a;b++){const w=e[b];w(v),p.has(w)&&(y.schedule(w),n())}l=!1,d&&(d=!1,y.process(v))}};return y}const AEe=40;let EU=!0,mC=!1,vU=!1;const $S={delta:0,timestamp:0},HC=["read","update","preRender","render","postRender"],f1=HC.reduce((n,e)=>(n[e]=IEe(()=>mC=!0),n),{}),PEe=HC.reduce((n,e)=>{const i=f1[e];return n[e]=(a,l=!1,d=!1)=>(mC||NEe(),i.schedule(a,l,d)),n},{}),OEe=HC.reduce((n,e)=>(n[e]=f1[e].cancel,n),{});HC.reduce((n,e)=>(n[e]=()=>f1[e].process($S),n),{});const kEe=n=>f1[n].process($S),QQ=n=>{mC=!1,$S.delta=EU?XQ:Math.max(Math.min(n-$S.timestamp,AEe),1),$S.timestamp=n,vU=!0,HC.forEach(kEe),vU=!1,mC&&(EU=!1,JQ(QQ))},NEe=()=>{mC=!0,EU=!0,vU||JQ(QQ)},uK=()=>$S;var DEe=Object.defineProperty,xEe=(n,e,i)=>e in n?DEe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,wd=(n,e,i)=>(xEe(n,typeof e!="symbol"?e+"":e,i),i);class LEe{constructor(e,i,a){if(wd(this,"history",[]),wd(this,"startEvent",null),wd(this,"lastEvent",null),wd(this,"lastEventInfo",null),wd(this,"handlers",{}),wd(this,"removeListeners",()=>{}),wd(this,"threshold",3),wd(this,"win"),wd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=QM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=FEe(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:w}=uK();this.history.push({...y.point,timestamp:w});const{onStart:A,onMove:N}=this.handlers;v||(A==null||A(this.lastEvent,y),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,y)}),wd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,PEe.update(this.updatePoint,!0)}),wd(this,"onPointerUp",(y,v)=>{const b=QM(v,this.history),{onEnd:w,onSessionEnd:A}=this.handlers;A==null||A(y,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(y,b))}),this.win=e.view??window,Oye(e))return;this.handlers=i,a&&(this.threshold=a),e.stopPropagation(),e.preventDefault();const l={point:LQ(e)},{timestamp:d}=uK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=i;p==null||p(e,QM(l,this.history)),this.removeListeners=VEe(jO(this.win,"pointermove",this.onPointerMove),jO(this.win,"pointerup",this.onPointerUp),jO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),OEe.update(this.updatePoint)}}function dK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function QM(n,e){return{point:n.point,delta:dK(n.point,e[e.length-1]),offset:dK(n.point,e[0]),velocity:UEe(e,.1)}}const MEe=n=>n*1e3;function UEe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>MEe(e)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function VEe(...n){return e=>n.reduce((i,a)=>a(i),e)}function ZM(n,e){return Math.abs(n-e)}function hK(n){return"x"in n&&"y"in n}function FEe(n,e){if(typeof n=="number"&&typeof e=="number")return ZM(n,e);if(hK(n)&&hK(e)){const i=ZM(n.x,e.x),a=ZM(n.y,e.y);return Math.sqrt(i**2+a**2)}return 0}function jEe(n,e){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:y}=e,v=!!(i||a||l||d||p),b=D.useRef(null),w=KQ({onSessionStart:d,onSessionEnd:p,onStart:a,onMove:i,onEnd(A,N){b.current=null,l==null||l(A,N)}});D.useEffect(()=>{var A;(A=b.current)==null||A.updateHandlers(w.current)}),D.useEffect(()=>{const A=n.current;if(!A||!v)return;function N(V){b.current=new LEe(V,w.current,y)}return jO(A,"pointerdown",N)},[n,v,w,y]),D.useEffect(()=>()=>{var A;(A=b.current)==null||A.end(),b.current=null},[])}const po={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},xh=n=>ZQ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),up=n=>ZQ(e=>n(e,"~ &"),"[data-peer]",".peer"),ZQ=(n,...e)=>e.map(n).join(", "),KS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:xh(po.open),_groupClosed:xh(po.closed),_groupHover:xh(po.hover),_peerHover:up(po.hover),_groupFocus:xh(po.focus),_peerFocus:up(po.focus),_groupFocusVisible:xh(po.focusVisible),_peerFocusVisible:up(po.focusVisible),_groupActive:xh(po.active),_peerActive:up(po.active),_groupDisabled:xh(po.disabled),_peerDisabled:up(po.disabled),_groupInvalid:xh(po.invalid),_peerInvalid:up(po.invalid),_groupChecked:xh(po.checked),_peerChecked:up(po.checked),_groupFocusWithin:xh(po.focusWithin),_peerFocusWithin:up(po.focusWithin),_peerPlaceholderShown:up(po.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},eZ=Object.keys(KS),BEe=n=>/!(important)?$/.test(n),fK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,WEe=(n,e)=>i=>{const a=String(e),l=BEe(a),d=fK(a),p=n?`${n}.${d}`:d;let y=Nu(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return y=fK(y),l?`${y} !important`:y};function oF(n){const{scale:e,transform:i,compose:a}=n;return(d,p)=>{const y=WEe(e,d)(p);let v=(i==null?void 0:i(y,p))??y;return a&&(v=a(v,p)),v}}const lO=(...n)=>e=>n.reduce((i,a)=>a(i),e);function Ru(n,e){return i=>{const a={property:i,scale:n};return a.transform=oF({scale:n,transform:e}),a}}const zEe=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function GEe(n){const{property:e,scale:i,transform:a}=n;return{scale:i,property:zEe(e),transform:i?oF({scale:i,compose:a}):a}}const tZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function HEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...tZ].join(" ")}function $Ee(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...tZ].join(" ")}const KEe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},qEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function YEe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const XEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},SU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},JEe=new Set(Object.values(SU)),bU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),QEe=n=>n.trim();function ZEe(n,e){if(n==null||bU.has(n))return n;if(!(TU(n)||bU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const y=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=p.split(",").map(QEe).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=v in SU?SU[v]:v;b.unshift(w);const A=b.map(N=>{if(JEe.has(N))return N;const V=N.indexOf(" "),[F,B]=V!==-1?[N.substr(0,V),N.substr(V+1)]:[N],W=TU(B)?B:B&&B.split(" "),J=`colors.${F}`,$=J in e.__cssMap?e.__cssMap[J].varRef:F;return W?[$,...Array.isArray(W)?W:[W]].join(" "):$});return`${y}(${A.join(", ")})`}const TU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),eve=(n,e)=>ZEe(n,e??{});function tve(n){return/^var\(--.+\)$/.test(n)}const nve=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Lh=n=>e=>`${n}(${e})`,kr={filter(n){return n!=="auto"?n:KEe},backdropFilter(n){return n!=="auto"?n:qEe},ring(n){return YEe(kr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?HEe():n==="auto-gpu"?$Ee():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=nve(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(tve(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:eve,blur:Lh("blur"),opacity:Lh("opacity"),brightness:Lh("brightness"),contrast:Lh("contrast"),dropShadow:Lh("drop-shadow"),grayscale:Lh("grayscale"),hueRotate:n=>Lh("hue-rotate")(kr.degree(n)),invert:Lh("invert"),saturate:Lh("saturate"),sepia:Lh("sepia"),bgImage(n){return n==null||TU(n)||bU.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=XEe[n]??{},a={flexDirection:n};return e&&(a[e]=1),i&&(a[i]=1),a}},Be={borderWidths:Ru("borderWidths"),borderStyles:Ru("borderStyles"),colors:Ru("colors"),borders:Ru("borders"),gradients:Ru("gradients",kr.gradient),radii:Ru("radii",kr.px),space:Ru("space",lO(kr.vh,kr.px)),spaceT:Ru("space",lO(kr.vh,kr.px)),degreeT(n){return{property:n,transform:kr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:oF({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Ru("sizes",lO(kr.vh,kr.px)),sizesT:Ru("sizes",lO(kr.vh,kr.fraction)),shadows:Ru("shadows"),logical:GEe,blur:Ru("blur",kr.blur)},BO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:kr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:kr.bgClip}};Object.assign(BO,{bgImage:BO.backgroundImage,bgImg:BO.backgroundImage});const Xr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Xr,{rounded:Xr.borderRadius,roundedTop:Xr.borderTopRadius,roundedTopLeft:Xr.borderTopLeftRadius,roundedTopRight:Xr.borderTopRightRadius,roundedTopStart:Xr.borderStartStartRadius,roundedTopEnd:Xr.borderStartEndRadius,roundedBottom:Xr.borderBottomRadius,roundedBottomLeft:Xr.borderBottomLeftRadius,roundedBottomRight:Xr.borderBottomRightRadius,roundedBottomStart:Xr.borderEndStartRadius,roundedBottomEnd:Xr.borderEndEndRadius,roundedLeft:Xr.borderLeftRadius,roundedRight:Xr.borderRightRadius,roundedStart:Xr.borderInlineStartRadius,roundedEnd:Xr.borderInlineEndRadius,borderStart:Xr.borderInlineStart,borderEnd:Xr.borderInlineEnd,borderTopStartRadius:Xr.borderStartStartRadius,borderTopEndRadius:Xr.borderStartEndRadius,borderBottomStartRadius:Xr.borderEndStartRadius,borderBottomEndRadius:Xr.borderEndEndRadius,borderStartRadius:Xr.borderInlineStartRadius,borderEndRadius:Xr.borderInlineEndRadius,borderStartWidth:Xr.borderInlineStartWidth,borderEndWidth:Xr.borderInlineEndWidth,borderStartColor:Xr.borderInlineStartColor,borderEndColor:Xr.borderInlineEndColor,borderStartStyle:Xr.borderInlineStartStyle,borderEndStyle:Xr.borderInlineEndStyle});const rve={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},Sk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:kr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(Sk,{flexDir:Sk.flexDirection});const Pu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",kr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Pu,{w:Pu.width,h:Pu.height,minW:Pu.minWidth,maxW:Pu.maxWidth,minH:Pu.minHeight,maxH:Pu.maxHeight,overscroll:Pu.overscrollBehavior,overscrollX:Pu.overscrollBehaviorX,overscrollY:Pu.overscrollBehaviorY});const ive={filter:{transform:kr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",kr.brightness),contrast:Be.propT("--chakra-contrast",kr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",kr.hueRotate),invert:Be.propT("--chakra-invert",kr.invert),saturate:Be.propT("--chakra-saturate",kr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",kr.dropShadow),backdropFilter:{transform:kr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",kr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",kr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",kr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",kr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",kr.saturate)},sve={ring:{transform:kr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},ove={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:kr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},nZ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function ave(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const cve=n=>{const e=new WeakMap;return(a,l,d,p)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const y=e.get(a);if(y.has(l))return y.get(l);const v=n(a,l,d,p);return y.set(l,v),v}},lve=cve(ave),uve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},dve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},e2=(n,e,i)=>{const a={},l=lve(n,e,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},hve={srOnly:{transform(n){return n===!0?uve:n==="focusable"?dve:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>e2(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>e2(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>e2(e,n,i)}},Yw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Yw,{insetStart:Yw.insetInlineStart,insetEnd:Yw.insetInlineEnd});const wU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(wU,{shadow:wU.boxShadow});const Ji={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Ji,{m:Ji.margin,mt:Ji.marginTop,mr:Ji.marginRight,me:Ji.marginInlineEnd,marginEnd:Ji.marginInlineEnd,mb:Ji.marginBottom,ml:Ji.marginLeft,ms:Ji.marginInlineStart,marginStart:Ji.marginInlineStart,mx:Ji.marginX,my:Ji.marginY,p:Ji.padding,pt:Ji.paddingTop,py:Ji.paddingY,px:Ji.paddingX,pb:Ji.paddingBottom,pl:Ji.paddingLeft,ps:Ji.paddingInlineStart,paddingStart:Ji.paddingInlineStart,pr:Ji.paddingRight,pe:Ji.paddingInlineEnd,paddingEnd:Ji.paddingInlineEnd});const fve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},pve={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",kr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},mve={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},gve={clipPath:!0,transform:Be.propT("transform",kr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},_ve={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},yve={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},aF=Gh({},BO,Xr,rve,Sk,Pu,ive,sve,ove,nZ,hve,Yw,wU,Ji,fve,pve,mve,gve,_ve,yve),Eve=Object.assign({},Ji,Pu,Sk,nZ,Yw),vve=Object.keys(Eve),Sve=[...Object.keys(aF),...eZ],bve={...aF,...KS},Tve=n=>n in bve,wve=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=e.__breakpoints,d={};for(const p in n){let y=il(n[p],e);if(y==null)continue;if(y=Nu(y)&&i(y)?a(y):y,!Array.isArray(y)){d[p]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const w=l==null?void 0:l[b];if(!w){d[p]=y[b];continue}d[w]=d[w]||{},y[b]!=null&&(d[w][p]=y[b])}}return d};function Cve(n){const e=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(e.push(i),i=""):i+=d}return i=i.trim(),i&&e.push(i),e}function Rve(n){return/^var\(--.+\)$/.test(n)}const Ive=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!Rve(e),Ave=(n,e)=>{if(e==null)return e;const i=p=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[p])==null?void 0:v.varRef},a=p=>i(p)??p,[l,d]=Cve(e);return e=i(l)??a(d)??a(e),e};function Pve(n){const{configs:e={},pseudos:i={},theme:a}=n,l=(d,p=!1)=>{var w;const y=il(d,a),v=wve(y)(a);let b={};for(let A in v){const N=v[A];let V=il(N,a);A in i&&(A=i[A]),Ive(A,V)&&(V=Ave(a,V));let F=e[A];if(F===!0&&(F={property:A}),Nu(V)){b[A]=b[A]??{},b[A]=Gh({},b[A],l(V,!0));continue}let B=((w=F==null?void 0:F.transform)==null?void 0:w.call(F,V,a,y))??V;B=F!=null&&F.processResult?l(B,!0):B;const W=il(F==null?void 0:F.property,a);if(!p&&(F!=null&&F.static)){const J=il(F.static,a);b=Gh({},b,J)}if(W&&Array.isArray(W)){for(const J of W)b[J]=B;continue}if(W){W==="&"&&Nu(B)?b=Gh({},b,B):b[W]=B;continue}if(Nu(B)){b=Gh({},b,B);continue}b[A]=B}return b};return l}const rZ=n=>e=>Pve({theme:e,pseudos:KS,configs:aF})(n);function _ze(n){return n}function yze(n){return n}function ji(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function Ove(n,e,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${e}.${i}`])==null?void 0:l.varRef)??i}function kve(n,e){if(Array.isArray(n))return n;if(Nu(n))return e(n);if(n!=null)return[n]}function Nve(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function Dve(n){const e=n.__breakpoints;return function(a,l,d,p){var N,V;if(!e)return;const y={},v=kve(d,e.toArrayValue);if(!v)return y;const b=v.length,w=b===1,A=!!a.parts;for(let F=0;F<b;F++){const B=e.details[F],W=e.details[Nve(v,F)],J=kw(B.minW,W==null?void 0:W._minW),$=il((N=a[l])==null?void 0:N[v[F]],p);if($){if(A){(V=a.parts)==null||V.forEach(te=>{Gh(y,{[te]:w?$[te]:{[J]:$[te]}})});continue}if(!A){w?Gh(y,$):y[J]=$;continue}y[J]=$}}return y}}function xve(n){return e=>{const{variant:i,size:a,theme:l}=e,d=Dve(l);return Gh({},il(n.baseStyle??{},e),d(n,"sizes",a,e),d(n,"variants",i,e))}}function Bi(n){return D0(n,["styleConfig","size","variant","colorScheme"])}function iZ(n){return Nu(n)&&n.reference?n.reference:String(n)}const p1=(n,...e)=>e.map(iZ).join(` ${n} `).replace(/calc/g,""),pK=(...n)=>`calc(${p1("+",...n)})`,mK=(...n)=>`calc(${p1("-",...n)})`,CU=(...n)=>`calc(${p1("*",...n)})`,gK=(...n)=>`calc(${p1("/",...n)})`,_K=n=>{const e=iZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:CU(e,-1)},mp=Object.assign(n=>({add:(...e)=>mp(pK(n,...e)),subtract:(...e)=>mp(mK(n,...e)),multiply:(...e)=>mp(CU(n,...e)),divide:(...e)=>mp(gK(n,...e)),negate:()=>mp(_K(n)),toString:()=>n.toString()}),{add:pK,subtract:mK,multiply:CU,divide:gK,negate:_K});function Lve(n,e="-"){return n.replace(/\s+/g,e)}function Mve(n){const e=Lve(n.toString());return Vve(Uve(e))}function Uve(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function Vve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Fve(n,e=""){return[e,n].filter(Boolean).join("-")}function jve(n,e){return`var(${n}${e?`, ${e}`:""})`}function Bve(n,e=""){return Mve(`--${Fve(n,e)}`)}function On(n,e,i){const a=Bve(n,i);return{variable:a,reference:jve(a,e)}}function Wve(n,e){const i={};for(const a of e){if(Array.isArray(a)){const[l,d]=a;i[l]=On(`${n}-${l}`,d);continue}i[a]=On(`${n}-${a}`)}return i}const zve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Gve(n){return BQ(n,zve)}function Hve(n){return n.semanticTokens}function $ve(n){const{__cssMap:e,__cssVars:i,__breakpoints:a,...l}=n;return l}function Kve(n){const e=Gve(n),i=Hve(n),a=d=>eZ.includes(d)||d==="default",l={};return iK(e,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),iK(i,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function yK(n,e){return On(String(n).replace(/\./g,"-"),void 0,e)}function qve(n){var p;const e=Kve(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let a={};const l={};function d(y,v){const w=[String(y).split(".")[0],v].join(".");if(!e[w])return v;const{reference:N}=yK(w,i);return N}for(const[y,v]of Object.entries(e)){const{isSemantic:b,value:w}=v,{variable:A,reference:N}=yK(y,i);if(!b){if(y.startsWith("space")){const F=y.split("."),[B,...W]=F,J=`${B}.-${W.join(".")}`,$=mp.negate(w),te=mp.negate(N);l[J]={value:$,var:A,varRef:te}}a[A]=w,l[y]={value:w,var:A,varRef:N};continue}const V=Nu(w)?w:{default:w};a=Gh(a,Object.entries(V).reduce((F,[B,W])=>{if(!W)return F;const J=d(y,`${W}`);if(B==="default")return F[A]=J,F;const $=(KS==null?void 0:KS[B])??B;return F[$]={[A]:J},F},{})),l[y]={value:N,var:A,varRef:N}}return{cssVars:a,cssMap:l}}function Yve(n){const e=$ve(n),{cssMap:i,cssVars:a}=qve(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:jye(e.breakpoints)}),e}function ni(n,e={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const A of w)e[A]=v(A);return ni(n,e)}function d(...w){for(const A of w)A in e||(e[A]=v(A));return ni(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([A,N])=>[A,N.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([A,N])=>[A,N.className]))}function v(w){const V=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:V,selector:`.${V}`,toString:()=>w}}return{parts:l,toPart:v,extend:d,selectors:p,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const Xve=ni("accordion").parts("root","container","button","panel","icon"),Jve=ni("alert").parts("title","description","container","icon","spinner"),Qve=ni("avatar").parts("label","badge","container","excessLabel","group"),Zve=ni("breadcrumb").parts("link","item","container","separator");ni("button").parts();const eSe=ni("checkbox").parts("control","icon","container","label");ni("progress").parts("track","filledTrack","label");const tSe=ni("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),nSe=ni("editable").parts("preview","input","textarea"),rSe=ni("form").parts("container","requiredIndicator","helperText"),iSe=ni("formError").parts("text","icon"),sSe=ni("input").parts("addon","field","element","group"),oSe=ni("list").parts("container","item","icon"),aSe=ni("menu").parts("button","list","item","groupTitle","icon","command","divider"),cSe=ni("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),lSe=ni("numberinput").parts("root","field","stepperGroup","stepper");ni("pininput").parts("field");const uSe=ni("popover").parts("content","header","body","footer","popper","arrow","closeButton"),dSe=ni("progress").parts("label","filledTrack","track"),hSe=ni("radio").parts("container","control","label"),fSe=ni("select").parts("field","icon"),pSe=ni("slider").parts("container","track","thumb","filledTrack","mark"),mSe=ni("stat").parts("container","label","helpText","number","icon"),gSe=ni("switch").parts("container","track","thumb","label"),_Se=ni("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),ySe=ni("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),ESe=ni("tag").parts("container","label","closeButton"),vSe=ni("card").parts("container","header","body","footer");ni("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:SSe,defineMultiStyleConfig:bSe}=ji(Xve.keys),TSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},wSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},CSe={pt:"2",px:"4",pb:"5"},RSe={fontSize:"1.25em"},ISe=SSe({container:TSe,button:wSe,panel:CSe,icon:RSe}),ASe=bSe({baseStyle:ISe});function gy(n,e,i){return Math.min(Math.max(n,i),e)}class PSe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Dw=PSe;function cF(n){if(typeof n!="string")throw new Dw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=USe.test(n)?NSe(n):n;const i=DSe.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(y=>parseInt(gC(y,2),16)),parseInt(gC(p[3]||"f",2),16)/255]}const a=xSe.exec(e);if(a){const p=Array.from(a).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,16)),parseInt(p[3]||"ff",16)/255]}const l=LSe.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,10)),parseFloat(p[3]||"1")]}const d=MSe.exec(e);if(d){const[p,y,v,b]=Array.from(d).slice(1).map(parseFloat);if(gy(0,100,y)!==y)throw new Dw(n);if(gy(0,100,v)!==v)throw new Dw(n);return[...VSe(p,y,v),Number.isNaN(b)?1:b]}throw new Dw(n)}function OSe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const EK=n=>parseInt(n.replace(/_/g,""),36),kSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=EK(e.substring(0,3)),a=EK(e.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function NSe(n){const e=n.toLowerCase().trim(),i=kSe[OSe(e)];if(!i)throw new Dw(n);return`#${i}`}const gC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),DSe=new RegExp(`^#${gC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),xSe=new RegExp(`^#${gC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),LSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${gC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),MSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,USe=/^[a-z]+$/i,vK=n=>Math.round(n*255),VSe=(n,e,i)=>{let a=i/100;if(e===0)return[a,a,a].map(vK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(e/100),p=d*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=d,v=p):l>=1&&l<2?(y=p,v=d):l>=2&&l<3?(v=d,b=p):l>=3&&l<4?(v=p,b=d):l>=4&&l<5?(y=p,b=d):l>=5&&l<6&&(y=d,b=p);const w=a-d/2,A=y+w,N=v+w,V=b+w;return[A,N,V].map(vK)};function FSe(n,e,i,a){return`rgba(${gy(0,255,n).toFixed()}, ${gy(0,255,e).toFixed()}, ${gy(0,255,i).toFixed()}, ${parseFloat(gy(0,1,a).toFixed(3))})`}function jSe(n,e){const[i,a,l,d]=cF(n);return FSe(i,a,l,d-e)}function BSe(n){const[e,i,a,l]=cF(n);let d=p=>{const y=gy(0,255,p).toString(16);return y.length===1?`0${y}`:y};return`#${d(e)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const WSe=n=>Object.keys(n).length===0;function zSe(n,e,i,a,l){for(e=e.split?e.split("."):e,a=0;a<e.length;a++)n=n?n[e[a]]:l;return n===l?i:n}const gc=(n,e,i)=>{const a=zSe(n,`colors.${e}`,e);try{return BSe(a),a}catch{return i??"#000000"}},GSe=n=>{const[e,i,a]=cF(n);return(e*299+i*587+a*114)/1e3},HSe=n=>e=>{const i=gc(e,n);return GSe(i)<128?"dark":"light"},$Se=n=>e=>HSe(n)(e)==="dark",l0=(n,e)=>i=>{const a=gc(i,n);return jSe(a,1-e)};function SK(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const KSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function qSe(n){const e=KSe();return!n||WSe(n)?e:n.string&&n.colors?XSe(n.string,n.colors):n.string&&!n.colors?YSe(n.string):n.colors&&!n.string?JSe(n.colors):e}function YSe(n){let e=0;if(n.length===0)return e.toString();for(let a=0;a<n.length;a+=1)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;let i="#";for(let a=0;a<3;a+=1){const l=e>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function XSe(n,e){let i=0;if(n.length===0)return e[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function JSe(n){return n[Math.floor(Math.random()*n.length)]}function Pn(n,e){return i=>i.colorMode==="dark"?e:n}function lF(n){const{orientation:e,vertical:i,horizontal:a}=n;return e?e==="vertical"?i:a:{}}function sZ(n){return Nu(n)&&n.reference?n.reference:String(n)}const m1=(n,...e)=>e.map(sZ).join(` ${n} `).replace(/calc/g,""),bK=(...n)=>`calc(${m1("+",...n)})`,TK=(...n)=>`calc(${m1("-",...n)})`,RU=(...n)=>`calc(${m1("*",...n)})`,wK=(...n)=>`calc(${m1("/",...n)})`,CK=n=>{const e=sZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:RU(e,-1)},gp=Object.assign(n=>({add:(...e)=>gp(bK(n,...e)),subtract:(...e)=>gp(TK(n,...e)),multiply:(...e)=>gp(RU(n,...e)),divide:(...e)=>gp(wK(n,...e)),negate:()=>gp(CK(n)),toString:()=>n.toString()}),{add:bK,subtract:TK,multiply:RU,divide:wK,negate:CK});function QSe(n){return!Number.isInteger(parseFloat(n.toString()))}function ZSe(n,e="-"){return n.replace(/\s+/g,e)}function oZ(n){const e=ZSe(n.toString());return e.includes("\\.")?n:QSe(n)?e.replace(".","\\."):n}function e0e(n,e=""){return[e,oZ(n)].filter(Boolean).join("-")}function t0e(n,e){return`var(${oZ(n)}${e?`, ${e}`:""})`}function n0e(n,e=""){return`--${e0e(n,e)}`}function yo(n,e){const i=n0e(n,e==null?void 0:e.prefix);return{variable:i,reference:t0e(i,r0e(e==null?void 0:e.fallback))}}function r0e(n){return n==null?void 0:n.reference}const{definePartsStyle:$C,defineMultiStyleConfig:i0e}=ji(Jve.keys),Ll=On("alert-fg"),xp=On("alert-bg"),s0e=$C({container:{bg:xp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Ll.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function uF(n){const{theme:e,colorScheme:i}=n,a=l0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:a}}const o0e=$C(n=>{const{colorScheme:e}=n,i=uF(n);return{container:{[Ll.variable]:`colors.${e}.600`,[xp.variable]:i.light,_dark:{[Ll.variable]:`colors.${e}.200`,[xp.variable]:i.dark}}}}),a0e=$C(n=>{const{colorScheme:e}=n,i=uF(n);return{container:{[Ll.variable]:`colors.${e}.600`,[xp.variable]:i.light,_dark:{[Ll.variable]:`colors.${e}.200`,[xp.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Ll.reference}}}),c0e=$C(n=>{const{colorScheme:e}=n,i=uF(n);return{container:{[Ll.variable]:`colors.${e}.600`,[xp.variable]:i.light,_dark:{[Ll.variable]:`colors.${e}.200`,[xp.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Ll.reference}}}),l0e=$C(n=>{const{colorScheme:e}=n;return{container:{[Ll.variable]:"colors.white",[xp.variable]:`colors.${e}.600`,_dark:{[Ll.variable]:"colors.gray.900",[xp.variable]:`colors.${e}.200`},color:Ll.reference}}}),u0e={subtle:o0e,"left-accent":a0e,"top-accent":c0e,solid:l0e},d0e=i0e({baseStyle:s0e,variants:u0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),aZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},h0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},f0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},cZ={...aZ,...h0e,container:f0e},p0e=n=>typeof n=="function";function _c(n,...e){return p0e(n)?n(...e):n}const{definePartsStyle:lZ,defineMultiStyleConfig:m0e}=ji(Qve.keys),qS=On("avatar-border-color"),Xw=On("avatar-bg"),_C=On("avatar-font-size"),u0=On("avatar-size"),g0e={borderRadius:"full",border:"0.2em solid",borderColor:qS.reference,[qS.variable]:"white",_dark:{[qS.variable]:"colors.gray.800"}},_0e={bg:Xw.reference,fontSize:_C.reference,width:u0.reference,height:u0.reference,lineHeight:"1",[Xw.variable]:"colors.gray.200",_dark:{[Xw.variable]:"colors.whiteAlpha.400"}},y0e=n=>{const{name:e,theme:i}=n,a=e?qSe({string:e}):"colors.gray.400",l=$Se(a)(i);let d="white";return l||(d="gray.800"),{bg:Xw.reference,fontSize:_C.reference,color:d,borderColor:qS.reference,verticalAlign:"top",width:u0.reference,height:u0.reference,"&:not([data-loaded])":{[Xw.variable]:a},[qS.variable]:"colors.white",_dark:{[qS.variable]:"colors.gray.800"}}},E0e={fontSize:_C.reference,lineHeight:"1"},v0e=lZ(n=>({badge:_c(g0e,n),excessLabel:_c(_0e,n),container:_c(y0e,n),label:E0e}));function Zm(n){const e=n!=="100%"?cZ[n]:void 0;return lZ({container:{[u0.variable]:e??n,[_C.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[u0.variable]:e??n,[_C.variable]:`calc(${e??n} / 2.5)`}})}const S0e={"2xs":Zm(4),xs:Zm(6),sm:Zm(8),md:Zm(12),lg:Zm(16),xl:Zm(24),"2xl":Zm(32),full:Zm("100%")},b0e=m0e({baseStyle:v0e,sizes:S0e,defaultProps:{size:"md"}}),$s=Wve("badge",["bg","color","shadow"]),T0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:$s.bg.reference,color:$s.color.reference,boxShadow:$s.shadow.reference},w0e=n=>{const{colorScheme:e,theme:i}=n,a=l0(`${e}.500`,.6)(i);return{[$s.bg.variable]:`colors.${e}.500`,[$s.color.variable]:"colors.white",_dark:{[$s.bg.variable]:a,[$s.color.variable]:"colors.whiteAlpha.800"}}},C0e=n=>{const{colorScheme:e,theme:i}=n,a=l0(`${e}.200`,.16)(i);return{[$s.bg.variable]:`colors.${e}.100`,[$s.color.variable]:`colors.${e}.800`,_dark:{[$s.bg.variable]:a,[$s.color.variable]:`colors.${e}.200`}}},R0e=n=>{const{colorScheme:e,theme:i}=n,a=l0(`${e}.200`,.8)(i);return{[$s.color.variable]:`colors.${e}.500`,_dark:{[$s.color.variable]:a},[$s.shadow.variable]:`inset 0 0 0px 1px ${$s.color.reference}`}},I0e={solid:w0e,subtle:C0e,outline:R0e},Jw={baseStyle:T0e,variants:I0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:A0e,definePartsStyle:P0e}=ji(Zve.keys),t2=On("breadcrumb-link-decor"),O0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:t2.reference,[t2.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[t2.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},k0e=P0e({link:O0e}),N0e=A0e({baseStyle:k0e}),D0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},uZ=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.100","whiteAlpha.200")(n)},_active:{bg:Pn("gray.200","whiteAlpha.300")(n)}};const a=l0(`${e}.200`,.12)(i),l=l0(`${e}.200`,.24)(i);return{color:Pn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Pn(`${e}.50`,a)(n)},_active:{bg:Pn(`${e}.100`,l)(n)}}},x0e=n=>{const{colorScheme:e}=n,i=Pn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},..._c(uZ,n)}},L0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},M0e=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=Pn("gray.100","whiteAlpha.200")(n);return{bg:y,color:Pn("gray.800","whiteAlpha.900")(n),_hover:{bg:Pn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:Pn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:a="white",hoverBg:l=`${e}.600`,activeBg:d=`${e}.700`}=L0e[e]??{},p=Pn(i,`${e}.200`)(n);return{bg:p,color:Pn(a,"gray.800")(n),_hover:{bg:Pn(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:Pn(d,`${e}.400`)(n)}}},U0e=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Pn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Pn(`${e}.700`,`${e}.500`)(n)}}},V0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},F0e={ghost:uZ,outline:x0e,solid:M0e,link:U0e,unstyled:V0e},j0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},B0e={baseStyle:D0e,variants:F0e,sizes:j0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:vy,defineMultiStyleConfig:W0e}=ji(vSe.keys),bk=On("card-bg"),Ip=On("card-padding"),dZ=On("card-shadow"),WO=On("card-radius"),hZ=On("card-border-width","0"),fZ=On("card-border-color"),z0e=vy({container:{[bk.variable]:"colors.chakra-body-bg",backgroundColor:bk.reference,boxShadow:dZ.reference,borderRadius:WO.reference,color:"chakra-body-text",borderWidth:hZ.reference,borderColor:fZ.reference},body:{padding:Ip.reference,flex:"1 1 0%"},header:{padding:Ip.reference},footer:{padding:Ip.reference}}),G0e={sm:vy({container:{[WO.variable]:"radii.base",[Ip.variable]:"space.3"}}),md:vy({container:{[WO.variable]:"radii.md",[Ip.variable]:"space.5"}}),lg:vy({container:{[WO.variable]:"radii.xl",[Ip.variable]:"space.7"}})},H0e={elevated:vy({container:{[dZ.variable]:"shadows.base",_dark:{[bk.variable]:"colors.gray.700"}}}),outline:vy({container:{[hZ.variable]:"1px",[fZ.variable]:"colors.chakra-border-color"}}),filled:vy({container:{[bk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Ip.variable]:0},header:{[Ip.variable]:0},footer:{[Ip.variable]:0}}},$0e=W0e({baseStyle:z0e,variants:H0e,sizes:G0e,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:zO,defineMultiStyleConfig:K0e}=ji(eSe.keys),Qw=On("checkbox-size"),q0e=n=>{const{colorScheme:e}=n;return{w:Qw.reference,h:Qw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Pn(`${e}.500`,`${e}.200`)(n),borderColor:Pn(`${e}.500`,`${e}.200`)(n),color:Pn("white","gray.900")(n),_hover:{bg:Pn(`${e}.600`,`${e}.300`)(n),borderColor:Pn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Pn("gray.200","transparent")(n),bg:Pn("gray.200","whiteAlpha.300")(n),color:Pn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Pn(`${e}.500`,`${e}.200`)(n),borderColor:Pn(`${e}.500`,`${e}.200`)(n),color:Pn("white","gray.900")(n)},_disabled:{bg:Pn("gray.100","whiteAlpha.100")(n),borderColor:Pn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Pn("red.500","red.300")(n)}}},Y0e={_disabled:{cursor:"not-allowed"}},X0e={userSelect:"none",_disabled:{opacity:.4}},J0e={transitionProperty:"transform",transitionDuration:"normal"},Q0e=zO(n=>({icon:J0e,container:Y0e,control:_c(q0e,n),label:X0e})),Z0e={sm:zO({control:{[Qw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:zO({control:{[Qw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:zO({control:{[Qw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},sg=K0e({baseStyle:Q0e,sizes:Z0e,defaultProps:{size:"md",colorScheme:"blue"}}),Zw=yo("close-button-size"),uw=yo("close-button-bg"),ebe={w:[Zw.reference],h:[Zw.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[uw.variable]:"colors.blackAlpha.100",_dark:{[uw.variable]:"colors.whiteAlpha.100"}},_active:{[uw.variable]:"colors.blackAlpha.200",_dark:{[uw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:uw.reference},tbe={lg:{[Zw.variable]:"sizes.10",fontSize:"md"},md:{[Zw.variable]:"sizes.8",fontSize:"xs"},sm:{[Zw.variable]:"sizes.6",fontSize:"2xs"}},nbe={baseStyle:ebe,sizes:tbe,defaultProps:{size:"md"}},{variants:rbe,defaultProps:ibe}=Jw,sbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:$s.bg.reference,color:$s.color.reference,boxShadow:$s.shadow.reference},obe={baseStyle:sbe,variants:rbe,defaultProps:ibe},abe={w:"100%",mx:"auto",maxW:"prose",px:"4"},cbe={baseStyle:abe},lbe={opacity:.6,borderColor:"inherit"},ube={borderStyle:"solid"},dbe={borderStyle:"dashed"},hbe={solid:ube,dashed:dbe},fbe={baseStyle:lbe,variants:hbe,defaultProps:{variant:"solid"}},{definePartsStyle:IU,defineMultiStyleConfig:pbe}=ji(tSe.keys),n2=On("drawer-bg"),r2=On("drawer-box-shadow");function mS(n){return IU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const mbe={bg:"blackAlpha.600",zIndex:"modal"},gbe={display:"flex",zIndex:"modal",justifyContent:"center"},_be=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[n2.variable]:"colors.white",[r2.variable]:"shadows.lg",_dark:{[n2.variable]:"colors.gray.700",[r2.variable]:"shadows.dark-lg"},bg:n2.reference,boxShadow:r2.reference}},ybe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Ebe={position:"absolute",top:"2",insetEnd:"3"},vbe={px:"6",py:"2",flex:"1",overflow:"auto"},Sbe={px:"6",py:"4"},bbe=IU(n=>({overlay:mbe,dialogContainer:gbe,dialog:_c(_be,n),header:ybe,closeButton:Ebe,body:vbe,footer:Sbe})),Tbe={xs:mS("xs"),sm:mS("md"),md:mS("lg"),lg:mS("2xl"),xl:mS("4xl"),full:mS("full")},wbe=pbe({baseStyle:bbe,sizes:Tbe,defaultProps:{size:"xs"}}),{definePartsStyle:Cbe,defineMultiStyleConfig:Rbe}=ji(nSe.keys),Ibe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Abe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Pbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Obe=Cbe({preview:Ibe,input:Abe,textarea:Pbe}),kbe=Rbe({baseStyle:Obe}),{definePartsStyle:Nbe,defineMultiStyleConfig:Dbe}=ji(rSe.keys),YS=On("form-control-color"),xbe={marginStart:"1",[YS.variable]:"colors.red.500",_dark:{[YS.variable]:"colors.red.300"},color:YS.reference},Lbe={mt:"2",[YS.variable]:"colors.gray.600",_dark:{[YS.variable]:"colors.whiteAlpha.600"},color:YS.reference,lineHeight:"normal",fontSize:"sm"},Mbe=Nbe({container:{width:"100%",position:"relative"},requiredIndicator:xbe,helperText:Lbe}),Ube=Dbe({baseStyle:Mbe}),{definePartsStyle:Vbe,defineMultiStyleConfig:Fbe}=ji(iSe.keys),XS=On("form-error-color"),jbe={[XS.variable]:"colors.red.500",_dark:{[XS.variable]:"colors.red.300"},color:XS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Bbe={marginEnd:"0.5em",[XS.variable]:"colors.red.500",_dark:{[XS.variable]:"colors.red.300"},color:XS.reference},Wbe=Vbe({text:jbe,icon:Bbe}),zbe=Fbe({baseStyle:Wbe}),Gbe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Hbe={baseStyle:Gbe},$be={fontFamily:"heading",fontWeight:"bold"},Kbe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},qbe={baseStyle:$be,sizes:Kbe,defaultProps:{size:"xl"}},{definePartsStyle:yp,defineMultiStyleConfig:Ybe}=ji(sSe.keys),PS=On("input-height"),OS=On("input-font-size"),kS=On("input-padding"),NS=On("input-border-radius"),Xbe=yp({addon:{height:PS.reference,fontSize:OS.reference,px:kS.reference,borderRadius:NS.reference},field:{width:"100%",height:PS.reference,fontSize:OS.reference,px:kS.reference,borderRadius:NS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),eg={lg:{[OS.variable]:"fontSizes.lg",[kS.variable]:"space.4",[NS.variable]:"radii.md",[PS.variable]:"sizes.12"},md:{[OS.variable]:"fontSizes.md",[kS.variable]:"space.4",[NS.variable]:"radii.md",[PS.variable]:"sizes.10"},sm:{[OS.variable]:"fontSizes.sm",[kS.variable]:"space.3",[NS.variable]:"radii.sm",[PS.variable]:"sizes.8"},xs:{[OS.variable]:"fontSizes.xs",[kS.variable]:"space.2",[NS.variable]:"radii.sm",[PS.variable]:"sizes.6"}},Jbe={lg:yp({field:eg.lg,group:eg.lg}),md:yp({field:eg.md,group:eg.md}),sm:yp({field:eg.sm,group:eg.sm}),xs:yp({field:eg.xs,group:eg.xs})};function dF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Pn("blue.500","blue.300")(n),errorBorderColor:i||Pn("red.500","red.300")(n)}}const Qbe=yp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=dF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Pn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:gc(e,a),boxShadow:`0 0 0 1px ${gc(e,a)}`},_focusVisible:{zIndex:1,borderColor:gc(e,i),boxShadow:`0 0 0 1px ${gc(e,i)}`}},addon:{border:"1px solid",borderColor:Pn("inherit","whiteAlpha.50")(n),bg:Pn("gray.100","whiteAlpha.300")(n)}}}),Zbe=yp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=dF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n),_hover:{bg:Pn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:gc(e,a)},_focusVisible:{bg:"transparent",borderColor:gc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Pn("gray.100","whiteAlpha.50")(n)}}}),eTe=yp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=dF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:gc(e,a),boxShadow:`0px 1px 0px 0px ${gc(e,a)}`},_focusVisible:{borderColor:gc(e,i),boxShadow:`0px 1px 0px 0px ${gc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),tTe=yp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),nTe={outline:Qbe,filled:Zbe,flushed:eTe,unstyled:tTe},Zr=Ybe({baseStyle:Xbe,sizes:Jbe,variants:nTe,defaultProps:{size:"md",variant:"outline"}}),i2=On("kbd-bg"),rTe={[i2.variable]:"colors.gray.100",_dark:{[i2.variable]:"colors.whiteAlpha.100"},bg:i2.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},iTe={baseStyle:rTe},sTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},oTe={baseStyle:sTe},{defineMultiStyleConfig:aTe,definePartsStyle:cTe}=ji(oSe.keys),lTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},uTe=cTe({icon:lTe}),dTe=aTe({baseStyle:uTe}),{defineMultiStyleConfig:hTe,definePartsStyle:fTe}=ji(aSe.keys),Mh=On("menu-bg"),s2=On("menu-shadow"),pTe={[Mh.variable]:"#fff",[s2.variable]:"shadows.sm",_dark:{[Mh.variable]:"colors.gray.700",[s2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Mh.reference,boxShadow:s2.reference},mTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Mh.variable]:"colors.gray.100",_dark:{[Mh.variable]:"colors.whiteAlpha.100"}},_active:{[Mh.variable]:"colors.gray.200",_dark:{[Mh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Mh.variable]:"colors.gray.100",_dark:{[Mh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Mh.reference},gTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},_Te={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},yTe={opacity:.6},ETe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},vTe={transitionProperty:"common",transitionDuration:"normal"},STe=fTe({button:vTe,list:pTe,item:mTe,groupTitle:gTe,icon:_Te,command:yTe,divider:ETe}),bTe=hTe({baseStyle:STe}),{defineMultiStyleConfig:TTe,definePartsStyle:AU}=ji(cSe.keys),o2=On("modal-bg"),a2=On("modal-shadow"),wTe={bg:"blackAlpha.600",zIndex:"modal"},CTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},RTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[o2.variable]:"colors.white",[a2.variable]:"shadows.lg",_dark:{[o2.variable]:"colors.gray.700",[a2.variable]:"shadows.dark-lg"},bg:o2.reference,boxShadow:a2.reference}},ITe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},ATe={position:"absolute",top:"2",insetEnd:"3"},PTe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},OTe={px:"6",py:"4"},kTe=AU(n=>({overlay:wTe,dialogContainer:_c(CTe,n),dialog:_c(RTe,n),header:ITe,closeButton:ATe,body:_c(PTe,n),footer:OTe}));function Cd(n){return AU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const NTe={xs:Cd("xs"),sm:Cd("sm"),md:Cd("md"),lg:Cd("lg"),xl:Cd("xl"),"2xl":Cd("2xl"),"3xl":Cd("3xl"),"4xl":Cd("4xl"),"5xl":Cd("5xl"),"6xl":Cd("6xl"),full:Cd("full")},DTe=TTe({baseStyle:kTe,sizes:NTe,defaultProps:{size:"md"}}),pZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:xTe,definePartsStyle:mZ}=ji(lSe.keys),hF=yo("number-input-stepper-width"),gZ=yo("number-input-input-padding"),LTe=gp(hF).add("0.5rem").toString(),c2=yo("number-input-bg"),l2=yo("number-input-color"),u2=yo("number-input-border-color"),MTe={[hF.variable]:"sizes.6",[gZ.variable]:LTe},UTe=n=>{var e;return((e=_c(Zr.baseStyle,n))==null?void 0:e.field)??{}},VTe={width:hF.reference},FTe={borderStart:"1px solid",borderStartColor:u2.reference,color:l2.reference,bg:c2.reference,[l2.variable]:"colors.chakra-body-text",[u2.variable]:"colors.chakra-border-color",_dark:{[l2.variable]:"colors.whiteAlpha.800",[u2.variable]:"colors.whiteAlpha.300"},_active:{[c2.variable]:"colors.gray.200",_dark:{[c2.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},jTe=mZ(n=>({root:MTe,field:_c(UTe,n)??{},stepperGroup:VTe,stepper:FTe}));function uO(n){var d,p;const e=(d=Zr.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((p=e.field)==null?void 0:p.fontSize)??"md",l=pZ.fontSizes[a];return mZ({field:{...e.field,paddingInlineEnd:gZ.reference,verticalAlign:"top"},stepper:{fontSize:gp(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const BTe={xs:uO("xs"),sm:uO("sm"),md:uO("md"),lg:uO("lg")},WTe=xTe({baseStyle:jTe,sizes:BTe,variants:Zr.variants,defaultProps:Zr.defaultProps});var pQ;const zTe={...(pQ=Zr.baseStyle)==null?void 0:pQ.field,textAlign:"center"},GTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var mQ;const HTe={outline:n=>{var e,i;return((i=_c((e=Zr.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=_c((e=Zr.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=_c((e=Zr.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((mQ=Zr.variants)==null?void 0:mQ.unstyled.field)??{}},$Te={baseStyle:zTe,sizes:GTe,variants:HTe,defaultProps:Zr.defaultProps},{defineMultiStyleConfig:KTe,definePartsStyle:qTe}=ji(uSe.keys),dO=yo("popper-bg"),YTe=yo("popper-arrow-bg"),RK=yo("popper-arrow-shadow-color"),XTe={zIndex:"popover"},JTe={[dO.variable]:"colors.white",bg:dO.reference,[YTe.variable]:dO.reference,[RK.variable]:"colors.gray.200",_dark:{[dO.variable]:"colors.gray.700",[RK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},QTe={px:3,py:2,borderBottomWidth:"1px"},ZTe={px:3,py:2},ewe={px:3,py:2,borderTopWidth:"1px"},twe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},nwe=qTe({popper:XTe,content:JTe,header:QTe,body:ZTe,footer:ewe,closeButton:twe}),rwe=KTe({baseStyle:nwe}),{defineMultiStyleConfig:iwe,definePartsStyle:xw}=ji(dSe.keys),swe=n=>{const{colorScheme:e,theme:i,isIndeterminate:a,hasStripe:l}=n,d=Pn(SK(),SK("1rem","rgba(0,0,0,0.1)"))(n),p=Pn(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${gc(i,p)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:y}:{bgColor:p}}},owe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},awe=n=>({bg:Pn("gray.100","whiteAlpha.300")(n)}),cwe=n=>({transitionProperty:"common",transitionDuration:"slow",...swe(n)}),lwe=xw(n=>({label:owe,filledTrack:cwe(n),track:awe(n)})),uwe={xs:xw({track:{h:"1"}}),sm:xw({track:{h:"2"}}),md:xw({track:{h:"3"}}),lg:xw({track:{h:"4"}})},dwe=iwe({sizes:uwe,baseStyle:lwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hwe,definePartsStyle:GO}=ji(hSe.keys),fwe=n=>{var i;const e=(i=_c(sg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},pwe=GO(n=>{var e,i;return{label:(e=sg.baseStyle)==null?void 0:e.call(sg,n).label,container:(i=sg.baseStyle)==null?void 0:i.call(sg,n).container,control:fwe(n)}}),mwe={md:GO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:GO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:GO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},gwe=hwe({baseStyle:pwe,sizes:mwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:_we,definePartsStyle:ywe}=ji(fSe.keys),hO=On("select-bg");var gQ;const Ewe={...(gQ=Zr.baseStyle)==null?void 0:gQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:hO.reference,[hO.variable]:"colors.white",_dark:{[hO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:hO.reference}},vwe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},Swe=ywe({field:Ewe,icon:vwe}),fO={paddingInlineEnd:"8"};var _Q,yQ,EQ,vQ,SQ,bQ,TQ,wQ;const bwe={lg:{...(_Q=Zr.sizes)==null?void 0:_Q.lg,field:{...(yQ=Zr.sizes)==null?void 0:yQ.lg.field,...fO}},md:{...(EQ=Zr.sizes)==null?void 0:EQ.md,field:{...(vQ=Zr.sizes)==null?void 0:vQ.md.field,...fO}},sm:{...(SQ=Zr.sizes)==null?void 0:SQ.sm,field:{...(bQ=Zr.sizes)==null?void 0:bQ.sm.field,...fO}},xs:{...(TQ=Zr.sizes)==null?void 0:TQ.xs,field:{...(wQ=Zr.sizes)==null?void 0:wQ.xs.field,...fO},icon:{insetEnd:"1"}}},Twe=_we({baseStyle:Swe,sizes:bwe,variants:Zr.variants,defaultProps:Zr.defaultProps}),d2=On("skeleton-start-color"),h2=On("skeleton-end-color"),wwe={[d2.variable]:"colors.gray.100",[h2.variable]:"colors.gray.400",_dark:{[d2.variable]:"colors.gray.800",[h2.variable]:"colors.gray.600"},background:d2.reference,borderColor:h2.reference,opacity:.7,borderRadius:"sm"},Cwe={baseStyle:wwe},f2=On("skip-link-bg"),Rwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[f2.variable]:"colors.white",_dark:{[f2.variable]:"colors.gray.700"},bg:f2.reference}},Iwe={baseStyle:Rwe},{defineMultiStyleConfig:Awe,definePartsStyle:g1}=ji(pSe.keys),Py=On("slider-thumb-size"),yC=On("slider-track-size"),og=On("slider-bg"),Pwe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...lF({orientation:e,vertical:{h:"100%",px:mp(Py.reference).divide(2).toString()},horizontal:{w:"100%",py:mp(Py.reference).divide(2).toString()}})}},Owe=n=>({...lF({orientation:n.orientation,horizontal:{h:yC.reference},vertical:{w:yC.reference}}),overflow:"hidden",borderRadius:"sm",[og.variable]:"colors.gray.200",_dark:{[og.variable]:"colors.whiteAlpha.200"},_disabled:{[og.variable]:"colors.gray.300",_dark:{[og.variable]:"colors.whiteAlpha.300"}},bg:og.reference}),kwe=n=>{const{orientation:e}=n;return{...lF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Py.reference,h:Py.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},Nwe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[og.variable]:`colors.${e}.500`,_dark:{[og.variable]:`colors.${e}.200`},bg:og.reference}},Dwe=g1(n=>({container:Pwe(n),track:Owe(n),thumb:kwe(n),filledTrack:Nwe(n)})),xwe=g1({container:{[Py.variable]:"sizes.4",[yC.variable]:"sizes.1"}}),Lwe=g1({container:{[Py.variable]:"sizes.3.5",[yC.variable]:"sizes.1"}}),Mwe=g1({container:{[Py.variable]:"sizes.2.5",[yC.variable]:"sizes.0.5"}}),Uwe={lg:xwe,md:Lwe,sm:Mwe},Vwe=Awe({baseStyle:Dwe,sizes:Uwe,defaultProps:{size:"md",colorScheme:"blue"}}),fy=yo("spinner-size"),Fwe={width:[fy.reference],height:[fy.reference]},jwe={xs:{[fy.variable]:"sizes.3"},sm:{[fy.variable]:"sizes.4"},md:{[fy.variable]:"sizes.6"},lg:{[fy.variable]:"sizes.8"},xl:{[fy.variable]:"sizes.12"}},Bwe={baseStyle:Fwe,sizes:jwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Wwe,definePartsStyle:_Z}=ji(mSe.keys),zwe={fontWeight:"medium"},Gwe={opacity:.8,marginBottom:"2"},Hwe={verticalAlign:"baseline",fontWeight:"semibold"},$we={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Kwe=_Z({container:{},label:zwe,helpText:Gwe,number:Hwe,icon:$we}),qwe={md:_Z({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Ywe=Wwe({baseStyle:Kwe,sizes:qwe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Xwe,definePartsStyle:Lw}=ji(["stepper","step","title","description","indicator","separator","icon","number"]),_p=On("stepper-indicator-size"),DS=On("stepper-icon-size"),xS=On("stepper-title-font-size"),Mw=On("stepper-description-font-size"),dw=On("stepper-accent-color"),Jwe=Lw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[dw.variable]:`colors.${n}.500`,_dark:{[dw.variable]:`colors.${n}.200`}},title:{fontSize:xS.reference,fontWeight:"medium"},description:{fontSize:Mw.reference,color:"chakra-subtle-text"},number:{fontSize:xS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:DS.reference,height:DS.reference},indicator:{flexShrink:0,borderRadius:"full",width:_p.reference,height:_p.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:dw.reference},"&[data-status=complete]":{bg:dw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:dw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${_p.reference} - 8px)`,top:`calc(${_p.reference} + 4px)`,insetStart:`calc(${_p.reference} / 2 - 1px)`}}})),Qwe=Xwe({baseStyle:Jwe,sizes:{xs:Lw({stepper:{[_p.variable]:"sizes.4",[DS.variable]:"sizes.3",[xS.variable]:"fontSizes.xs",[Mw.variable]:"fontSizes.xs"}}),sm:Lw({stepper:{[_p.variable]:"sizes.6",[DS.variable]:"sizes.4",[xS.variable]:"fontSizes.sm",[Mw.variable]:"fontSizes.xs"}}),md:Lw({stepper:{[_p.variable]:"sizes.8",[DS.variable]:"sizes.5",[xS.variable]:"fontSizes.md",[Mw.variable]:"fontSizes.sm"}}),lg:Lw({stepper:{[_p.variable]:"sizes.10",[DS.variable]:"sizes.6",[xS.variable]:"fontSizes.lg",[Mw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Zwe,definePartsStyle:HO}=ji(gSe.keys),eC=yo("switch-track-width"),Sy=yo("switch-track-height"),p2=yo("switch-track-diff"),eCe=gp.subtract(eC,Sy),PU=yo("switch-thumb-x"),hw=yo("switch-bg"),tCe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[eC.reference],height:[Sy.reference],transitionProperty:"common",transitionDuration:"fast",[hw.variable]:"colors.gray.300",_dark:{[hw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[hw.variable]:`colors.${e}.500`,_dark:{[hw.variable]:`colors.${e}.200`}},bg:hw.reference}},nCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Sy.reference],height:[Sy.reference],_checked:{transform:`translateX(${PU.reference})`}},rCe=HO(n=>({container:{[p2.variable]:eCe,[PU.variable]:p2.reference,_rtl:{[PU.variable]:gp(p2).negate().toString()}},track:tCe(n),thumb:nCe})),iCe={sm:HO({container:{[eC.variable]:"1.375rem",[Sy.variable]:"sizes.3"}}),md:HO({container:{[eC.variable]:"1.875rem",[Sy.variable]:"sizes.4"}}),lg:HO({container:{[eC.variable]:"2.875rem",[Sy.variable]:"sizes.6"}})},sCe=Zwe({baseStyle:rCe,sizes:iCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:oCe,definePartsStyle:JS}=ji(_Se.keys),aCe=JS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Tk={"&[data-is-numeric=true]":{textAlign:"end"}},cCe=JS(n=>{const{colorScheme:e}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${e}.100`,`${e}.700`)(n),...Tk},td:{borderBottom:"1px",borderColor:Pn(`${e}.100`,`${e}.700`)(n),...Tk},caption:{color:Pn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),lCe=JS(n=>{const{colorScheme:e}=n;return{th:{color:Pn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Pn(`${e}.100`,`${e}.700`)(n),...Tk},td:{borderBottom:"1px",borderColor:Pn(`${e}.100`,`${e}.700`)(n),...Tk},caption:{color:Pn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Pn(`${e}.100`,`${e}.700`)(n)},td:{background:Pn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),uCe={simple:cCe,striped:lCe,unstyled:{}},dCe={sm:JS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:JS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:JS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},hCe=oCe({baseStyle:aCe,variants:uCe,sizes:dCe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),nl=On("tabs-color"),Ad=On("tabs-bg"),pO=On("tabs-border-color"),{defineMultiStyleConfig:fCe,definePartsStyle:qh}=ji(ySe.keys),pCe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},mCe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},gCe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},_Ce={p:4},yCe=qh(n=>({root:pCe(n),tab:mCe(n),tablist:gCe(n),tabpanel:_Ce})),ECe={sm:qh({tab:{py:1,px:4,fontSize:"sm"}}),md:qh({tab:{fontSize:"md",py:2,px:4}}),lg:qh({tab:{fontSize:"lg",py:3,px:4}})},vCe=qh(n=>{const{colorScheme:e,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[nl.variable]:`colors.${e}.600`,_dark:{[nl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Ad.variable]:"colors.gray.200",_dark:{[Ad.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:nl.reference,bg:Ad.reference}}}),SCe=qh(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[pO.variable]:"transparent",_selected:{[nl.variable]:`colors.${e}.600`,[pO.variable]:"colors.white",_dark:{[nl.variable]:`colors.${e}.300`,[pO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:pO.reference},color:nl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),bCe=qh(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Ad.variable]:"colors.gray.50",_dark:{[Ad.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Ad.variable]:"colors.white",[nl.variable]:`colors.${e}.600`,_dark:{[Ad.variable]:"colors.gray.800",[nl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:nl.reference,bg:Ad.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),TCe=qh(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:gc(i,`${e}.700`),bg:gc(i,`${e}.100`)}}}}),wCe=qh(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[nl.variable]:"colors.gray.600",_dark:{[nl.variable]:"inherit"},_selected:{[nl.variable]:"colors.white",[Ad.variable]:`colors.${e}.600`,_dark:{[nl.variable]:"colors.gray.800",[Ad.variable]:`colors.${e}.300`}},color:nl.reference,bg:Ad.reference}}}),CCe=qh({}),RCe={line:vCe,enclosed:SCe,"enclosed-colored":bCe,"soft-rounded":TCe,"solid-rounded":wCe,unstyled:CCe},ICe=fCe({baseStyle:yCe,sizes:ECe,variants:RCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:ACe,definePartsStyle:by}=ji(ESe.keys),IK=On("tag-bg"),AK=On("tag-color"),m2=On("tag-shadow"),$O=On("tag-min-height"),KO=On("tag-min-width"),qO=On("tag-font-size"),YO=On("tag-padding-inline"),PCe={fontWeight:"medium",lineHeight:1.2,outline:0,[AK.variable]:$s.color.reference,[IK.variable]:$s.bg.reference,[m2.variable]:$s.shadow.reference,color:AK.reference,bg:IK.reference,boxShadow:m2.reference,borderRadius:"md",minH:$O.reference,minW:KO.reference,fontSize:qO.reference,px:YO.reference,_focusVisible:{[m2.variable]:"shadows.outline"}},OCe={lineHeight:1.2,overflow:"visible"},kCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},NCe=by({container:PCe,label:OCe,closeButton:kCe}),DCe={sm:by({container:{[$O.variable]:"sizes.5",[KO.variable]:"sizes.5",[qO.variable]:"fontSizes.xs",[YO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:by({container:{[$O.variable]:"sizes.6",[KO.variable]:"sizes.6",[qO.variable]:"fontSizes.sm",[YO.variable]:"space.2"}}),lg:by({container:{[$O.variable]:"sizes.8",[KO.variable]:"sizes.8",[qO.variable]:"fontSizes.md",[YO.variable]:"space.3"}})},xCe={subtle:by(n=>{var e;return{container:(e=Jw.variants)==null?void 0:e.subtle(n)}}),solid:by(n=>{var e;return{container:(e=Jw.variants)==null?void 0:e.solid(n)}}),outline:by(n=>{var e;return{container:(e=Jw.variants)==null?void 0:e.outline(n)}})},LCe=ACe({variants:xCe,baseStyle:NCe,sizes:DCe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var CQ;const MCe={...(CQ=Zr.baseStyle)==null?void 0:CQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var RQ;const UCe={outline:n=>{var e;return((e=Zr.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=Zr.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=Zr.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((RQ=Zr.variants)==null?void 0:RQ.unstyled.field)??{}};var IQ,AQ,PQ,OQ;const VCe={xs:((IQ=Zr.sizes)==null?void 0:IQ.xs.field)??{},sm:((AQ=Zr.sizes)==null?void 0:AQ.sm.field)??{},md:((PQ=Zr.sizes)==null?void 0:PQ.md.field)??{},lg:((OQ=Zr.sizes)==null?void 0:OQ.lg.field)??{}},FCe={baseStyle:MCe,sizes:VCe,variants:UCe,defaultProps:{size:"md",variant:"outline"}},mO=yo("tooltip-bg"),g2=yo("tooltip-fg"),jCe=yo("popper-arrow-bg"),BCe={bg:mO.reference,color:g2.reference,[mO.variable]:"colors.gray.700",[g2.variable]:"colors.whiteAlpha.900",_dark:{[mO.variable]:"colors.gray.300",[g2.variable]:"colors.gray.900"},[jCe.variable]:mO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},WCe={baseStyle:BCe},zCe={Accordion:ASe,Alert:d0e,Avatar:b0e,Badge:Jw,Breadcrumb:N0e,Button:B0e,Checkbox:sg,CloseButton:nbe,Code:obe,Container:cbe,Divider:fbe,Drawer:wbe,Editable:kbe,Form:Ube,FormError:zbe,FormLabel:Hbe,Heading:qbe,Input:Zr,Kbd:iTe,Link:oTe,List:dTe,Menu:bTe,Modal:DTe,NumberInput:WTe,PinInput:$Te,Popover:rwe,Progress:dwe,Radio:gwe,Select:Twe,Skeleton:Cwe,SkipLink:Iwe,Slider:Vwe,Spinner:Bwe,Stat:Ywe,Switch:sCe,Table:hCe,Tabs:ICe,Tag:LCe,Textarea:FCe,Tooltip:WCe,Card:$0e,Stepper:Qwe},GCe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},HCe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},$Ce={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},KCe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},qCe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},YCe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},XCe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},JCe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},QCe={property:YCe,easing:XCe,duration:JCe},ZCe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},eRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},tRe={breakpoints:HCe,zIndices:ZCe,radii:KCe,blur:eRe,colors:$Ce,...pZ,sizes:cZ,shadows:qCe,space:aZ,borders:GCe,transition:QCe},nRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},rRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},iRe="ltr",sRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},oRe={semanticTokens:nRe,direction:iRe,...tRe,components:zCe,styles:rRe,config:sRe};function aRe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function cRe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var lRe=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(a){a.forEach(this._insertTag)},e.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(cRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=aRe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},e.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),za="-ms-",wk="-moz-",Jr="-webkit-",yZ="comm",fF="rule",pF="decl",uRe="@import",EZ="@keyframes",dRe="@layer",hRe=Math.abs,_1=String.fromCharCode,fRe=Object.assign;function pRe(n,e){return fa(n,0)^45?(((e<<2^fa(n,0))<<2^fa(n,1))<<2^fa(n,2))<<2^fa(n,3):0}function vZ(n){return n.trim()}function mRe(n,e){return(n=e.exec(n))?n[0]:n}function Qr(n,e,i){return n.replace(e,i)}function OU(n,e){return n.indexOf(e)}function fa(n,e){return n.charCodeAt(e)|0}function EC(n,e,i){return n.slice(e,i)}function Fh(n){return n.length}function mF(n){return n.length}function gO(n,e){return e.push(n),n}function gRe(n,e){return n.map(e).join("")}var y1=1,d0=1,SZ=0,cl=0,eo=0,x0="";function E1(n,e,i,a,l,d,p){return{value:n,root:e,parent:i,type:a,props:l,children:d,line:y1,column:d0,length:p,return:""}}function fw(n,e){return fRe(E1("",null,null,"",null,null,0),n,{length:-n.length},e)}function _Re(){return eo}function yRe(){return eo=cl>0?fa(x0,--cl):0,d0--,eo===10&&(d0=1,y1--),eo}function Ml(){return eo=cl<SZ?fa(x0,cl++):0,d0++,eo===10&&(d0=1,y1++),eo}function Yh(){return fa(x0,cl)}function XO(){return cl}function KC(n,e){return EC(x0,n,e)}function vC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function bZ(n){return y1=d0=1,SZ=Fh(x0=n),cl=0,[]}function TZ(n){return x0="",n}function JO(n){return vZ(KC(cl-1,kU(n===91?n+2:n===40?n+1:n)))}function ERe(n){for(;(eo=Yh())&&eo<33;)Ml();return vC(n)>2||vC(eo)>3?"":" "}function vRe(n,e){for(;--e&&Ml()&&!(eo<48||eo>102||eo>57&&eo<65||eo>70&&eo<97););return KC(n,XO()+(e<6&&Yh()==32&&Ml()==32))}function kU(n){for(;Ml();)switch(eo){case n:return cl;case 34:case 39:n!==34&&n!==39&&kU(eo);break;case 40:n===41&&kU(n);break;case 92:Ml();break}return cl}function SRe(n,e){for(;Ml()&&n+eo!==57;)if(n+eo===84&&Yh()===47)break;return"/*"+KC(e,cl-1)+"*"+_1(n===47?n:Ml())}function bRe(n){for(;!vC(Yh());)Ml();return KC(n,cl)}function TRe(n){return TZ(QO("",null,null,null,[""],n=bZ(n),0,[0],n))}function QO(n,e,i,a,l,d,p,y,v){for(var b=0,w=0,A=p,N=0,V=0,F=0,B=1,W=1,J=1,$=0,te="",ce=l,oe=d,_e=a,ne=te;W;)switch(F=$,$=Ml()){case 40:if(F!=108&&fa(ne,A-1)==58){OU(ne+=Qr(JO($),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:ne+=JO($);break;case 9:case 10:case 13:case 32:ne+=ERe(F);break;case 92:ne+=vRe(XO()-1,7);continue;case 47:switch(Yh()){case 42:case 47:gO(wRe(SRe(Ml(),XO()),e,i),v);break;default:ne+="/"}break;case 123*B:y[b++]=Fh(ne)*J;case 125*B:case 59:case 0:switch($){case 0:case 125:W=0;case 59+w:J==-1&&(ne=Qr(ne,/\f/g,"")),V>0&&Fh(ne)-A&&gO(V>32?OK(ne+";",a,i,A-1):OK(Qr(ne," ","")+";",a,i,A-2),v);break;case 59:ne+=";";default:if(gO(_e=PK(ne,e,i,b,w,l,y,te,ce=[],oe=[],A),d),$===123)if(w===0)QO(ne,e,_e,_e,ce,d,A,y,oe);else switch(N===99&&fa(ne,3)===110?100:N){case 100:case 108:case 109:case 115:QO(n,_e,_e,a&&gO(PK(n,_e,_e,0,0,l,y,te,l,ce=[],A),oe),l,oe,A,y,a?ce:oe);break;default:QO(ne,_e,_e,_e,[""],oe,0,y,oe)}}b=w=V=0,B=J=1,te=ne="",A=p;break;case 58:A=1+Fh(ne),V=F;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&yRe()==125)continue}switch(ne+=_1($),$*B){case 38:J=w>0?1:(ne+="\f",-1);break;case 44:y[b++]=(Fh(ne)-1)*J,J=1;break;case 64:Yh()===45&&(ne+=JO(Ml())),N=Yh(),w=A=Fh(te=ne+=bRe(XO())),$++;break;case 45:F===45&&Fh(ne)==2&&(B=0)}}return d}function PK(n,e,i,a,l,d,p,y,v,b,w){for(var A=l-1,N=l===0?d:[""],V=mF(N),F=0,B=0,W=0;F<a;++F)for(var J=0,$=EC(n,A+1,A=hRe(B=p[F])),te=n;J<V;++J)(te=vZ(B>0?N[J]+" "+$:Qr($,/&\f/g,N[J])))&&(v[W++]=te);return E1(n,e,i,l===0?fF:y,v,b,w)}function wRe(n,e,i){return E1(n,e,i,yZ,_1(_Re()),EC(n,2,-2),0)}function OK(n,e,i,a){return E1(n,e,i,pF,EC(n,0,a),EC(n,a+1,-1),a)}function QS(n,e){for(var i="",a=mF(n),l=0;l<a;l++)i+=e(n[l],l,n,e)||"";return i}function CRe(n,e,i,a){switch(n.type){case dRe:if(n.children.length)break;case uRe:case pF:return n.return=n.return||n.value;case yZ:return"";case EZ:return n.return=n.value+"{"+QS(n.children,a)+"}";case fF:n.value=n.props.join(",")}return Fh(i=QS(n.children,a))?n.return=n.value+"{"+i+"}":""}function RRe(n){var e=mF(n);return function(i,a,l,d){for(var p="",y=0;y<e;y++)p+=n[y](i,a,l,d)||"";return p}}function IRe(n){return function(e){e.root||(e=e.return)&&n(e)}}var kK=function(e){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=e(a);return i.set(a,l),l}};function wZ(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var ARe=function(e,i,a){for(var l=0,d=0;l=d,d=Yh(),l===38&&d===12&&(i[a]=1),!vC(d);)Ml();return KC(e,cl)},PRe=function(e,i){var a=-1,l=44;do switch(vC(l)){case 0:l===38&&Yh()===12&&(i[a]=1),e[a]+=ARe(cl-1,i,a);break;case 2:e[a]+=JO(l);break;case 4:if(l===44){e[++a]=Yh()===58?"&\f":"",i[a]=e[a].length;break}default:e[a]+=_1(l)}while(l=Ml());return e},ORe=function(e,i){return TZ(PRe(bZ(e),i))},NK=new WeakMap,kRe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,a=e.parent,l=e.column===a.column&&e.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!NK.get(a))&&!l){NK.set(e,!0);for(var d=[],p=ORe(i,d),y=a.props,v=0,b=0;v<p.length;v++)for(var w=0;w<y.length;w++,b++)e.props[b]=d[v]?p[v].replace(/&\f/g,y[w]):y[w]+" "+p[v]}}},NRe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function CZ(n,e){switch(pRe(n,e)){case 5103:return Jr+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Jr+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Jr+n+wk+n+za+n+n;case 6828:case 4268:return Jr+n+za+n+n;case 6165:return Jr+n+za+"flex-"+n+n;case 5187:return Jr+n+Qr(n,/(\w+).+(:[^]+)/,Jr+"box-$1$2"+za+"flex-$1$2")+n;case 5443:return Jr+n+za+"flex-item-"+Qr(n,/flex-|-self/,"")+n;case 4675:return Jr+n+za+"flex-line-pack"+Qr(n,/align-content|flex-|-self/,"")+n;case 5548:return Jr+n+za+Qr(n,"shrink","negative")+n;case 5292:return Jr+n+za+Qr(n,"basis","preferred-size")+n;case 6060:return Jr+"box-"+Qr(n,"-grow","")+Jr+n+za+Qr(n,"grow","positive")+n;case 4554:return Jr+Qr(n,/([^-])(transform)/g,"$1"+Jr+"$2")+n;case 6187:return Qr(Qr(Qr(n,/(zoom-|grab)/,Jr+"$1"),/(image-set)/,Jr+"$1"),n,"")+n;case 5495:case 3959:return Qr(n,/(image-set\([^]*)/,Jr+"$1$`$1");case 4968:return Qr(Qr(n,/(.+:)(flex-)?(.*)/,Jr+"box-pack:$3"+za+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Jr+n+n;case 4095:case 3583:case 4068:case 2532:return Qr(n,/(.+)-inline(.+)/,Jr+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Fh(n)-1-e>6)switch(fa(n,e+1)){case 109:if(fa(n,e+4)!==45)break;case 102:return Qr(n,/(.+:)(.+)-([^]+)/,"$1"+Jr+"$2-$3$1"+wk+(fa(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~OU(n,"stretch")?CZ(Qr(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(fa(n,e+1)!==115)break;case 6444:switch(fa(n,Fh(n)-3-(~OU(n,"!important")&&10))){case 107:return Qr(n,":",":"+Jr)+n;case 101:return Qr(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Jr+(fa(n,14)===45?"inline-":"")+"box$3$1"+Jr+"$2$3$1"+za+"$2box$3")+n}break;case 5936:switch(fa(n,e+11)){case 114:return Jr+n+za+Qr(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Jr+n+za+Qr(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Jr+n+za+Qr(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return Jr+n+za+n+n}return n}var DRe=function(e,i,a,l){if(e.length>-1&&!e.return)switch(e.type){case pF:e.return=CZ(e.value,e.length);break;case EZ:return QS([fw(e,{value:Qr(e.value,"@","@"+Jr)})],l);case fF:if(e.length)return gRe(e.props,function(d){switch(mRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return QS([fw(e,{props:[Qr(d,/:(read-\w+)/,":"+wk+"$1")]})],l);case"::placeholder":return QS([fw(e,{props:[Qr(d,/:(plac\w+)/,":"+Jr+"input-$1")]}),fw(e,{props:[Qr(d,/:(plac\w+)/,":"+wk+"$1")]}),fw(e,{props:[Qr(d,/:(plac\w+)/,za+"input-$1")]})],l)}return""})}},xRe=[DRe],LRe=function(e){var i=e.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(B){var W=B.getAttribute("data-emotion");W.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=e.stylisPlugins||xRe,d={},p,y=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(B){for(var W=B.getAttribute("data-emotion").split(" "),J=1;J<W.length;J++)d[W[J]]=!0;y.push(B)});var v,b=[kRe,NRe];{var w,A=[CRe,IRe(function(B){w.insert(B)})],N=RRe(b.concat(l,A)),V=function(W){return QS(TRe(W),N)};v=function(W,J,$,te){w=$,V(W?W+"{"+J.styles+"}":J.styles),te&&(F.inserted[J.name]=!0)}}var F={key:i,sheet:new lRe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:v};return F.sheet.hydrate(y),F};function Oy(){return Oy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Oy.apply(null,arguments)}var _2={exports:{}},li={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DK;function MRe(){if(DK)return li;DK=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,A=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,V=n?Symbol.for("react.memo"):60115,F=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,W=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function te(oe){if(typeof oe=="object"&&oe!==null){var _e=oe.$$typeof;switch(_e){case e:switch(oe=oe.type,oe){case v:case b:case a:case d:case l:case A:return oe;default:switch(oe=oe&&oe.$$typeof,oe){case y:case w:case F:case V:case p:return oe;default:return _e}}case i:return _e}}}function ce(oe){return te(oe)===b}return li.AsyncMode=v,li.ConcurrentMode=b,li.ContextConsumer=y,li.ContextProvider=p,li.Element=e,li.ForwardRef=w,li.Fragment=a,li.Lazy=F,li.Memo=V,li.Portal=i,li.Profiler=d,li.StrictMode=l,li.Suspense=A,li.isAsyncMode=function(oe){return ce(oe)||te(oe)===v},li.isConcurrentMode=ce,li.isContextConsumer=function(oe){return te(oe)===y},li.isContextProvider=function(oe){return te(oe)===p},li.isElement=function(oe){return typeof oe=="object"&&oe!==null&&oe.$$typeof===e},li.isForwardRef=function(oe){return te(oe)===w},li.isFragment=function(oe){return te(oe)===a},li.isLazy=function(oe){return te(oe)===F},li.isMemo=function(oe){return te(oe)===V},li.isPortal=function(oe){return te(oe)===i},li.isProfiler=function(oe){return te(oe)===d},li.isStrictMode=function(oe){return te(oe)===l},li.isSuspense=function(oe){return te(oe)===A},li.isValidElementType=function(oe){return typeof oe=="string"||typeof oe=="function"||oe===a||oe===b||oe===d||oe===l||oe===A||oe===N||typeof oe=="object"&&oe!==null&&(oe.$$typeof===F||oe.$$typeof===V||oe.$$typeof===p||oe.$$typeof===y||oe.$$typeof===w||oe.$$typeof===W||oe.$$typeof===J||oe.$$typeof===$||oe.$$typeof===B)},li.typeOf=te,li}var xK;function URe(){return xK||(xK=1,_2.exports=MRe()),_2.exports}var y2,LK;function VRe(){if(LK)return y2;LK=1;var n=URe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function p(F){return n.isMemo(F)?l:d[F.$$typeof]||e}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,A=Object.getPrototypeOf,N=Object.prototype;function V(F,B,W){if(typeof B!="string"){if(N){var J=A(B);J&&J!==N&&V(F,J,W)}var $=v(B);b&&($=$.concat(b(B)));for(var te=p(F),ce=p(B),oe=0;oe<$.length;++oe){var _e=$[oe];if(!i[_e]&&!(W&&W[_e])&&!(ce&&ce[_e])&&!(te&&te[_e])){var ne=w(B,_e);try{y(F,_e,ne)}catch{}}}}return F}return y2=V,y2}VRe();var FRe=!0;function RZ(n,e,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(a+=l+" ")}),a}var gF=function(e,i,a){var l=e.key+"-"+i.name;(a===!1||FRe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},_F=function(e,i,a){gF(e,i,a);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var d=i;do e.insert(i===d?"."+l:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function jRe(n){for(var e=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(a+2)&255)<<16;case 2:e^=(n.charCodeAt(a+1)&255)<<8;case 1:e^=n.charCodeAt(a)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var BRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},WRe=/[A-Z]|^ms/g,zRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,IZ=function(e){return e.charCodeAt(1)===45},MK=function(e){return e!=null&&typeof e!="boolean"},E2=wZ(function(n){return IZ(n)?n:n.replace(WRe,"-$&").toLowerCase()}),UK=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(zRe,function(a,l,d){return jh={name:l,styles:d,next:jh},l})}return BRe[e]!==1&&!IZ(e)&&typeof i=="number"&&i!==0?i+"px":i};function SC(n,e,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return jh={name:l.name,styles:l.styles,next:jh},l.name;var d=i;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)jh={name:p.name,styles:p.styles,next:jh},p=p.next;var y=d.styles+";";return y}return GRe(n,e,i)}case"function":{if(n!==void 0){var v=jh,b=i(n);return jh=v,SC(n,e,b)}break}}var w=i;if(e==null)return w;var A=e[w];return A!==void 0?A:w}function GRe(n,e,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=SC(n,e,i[l])+";";else for(var d in i){var p=i[d];if(typeof p!="object"){var y=p;e!=null&&e[y]!==void 0?a+=d+"{"+e[y]+"}":MK(y)&&(a+=E2(d)+":"+UK(d,y)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var v=0;v<p.length;v++)MK(p[v])&&(a+=E2(d)+":"+UK(d,p[v])+";");else{var b=SC(n,e,p);switch(d){case"animation":case"animationName":{a+=E2(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var VK=/label:\s*([^\s;{]+)\s*(;|$)/g,jh;function v1(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";jh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=SC(i,e,d);else{var p=d;l+=p[0]}for(var y=1;y<n.length;y++)if(l+=SC(i,e,n[y]),a){var v=d;l+=v[y]}VK.lastIndex=0;for(var b="",w;(w=VK.exec(l))!==null;)b+="-"+w[1];var A=jRe(l)+b;return{name:A,styles:l,next:jh}}var HRe=function(e){return e()},AZ=q$.useInsertionEffect?q$.useInsertionEffect:!1,PZ=AZ||HRe,FK=AZ||D.useLayoutEffect,yF=D.createContext(typeof HTMLElement<"u"?LRe({key:"css"}):null);yF.Provider;var $Re=function(){return D.useContext(yF)},EF=function(e){return D.forwardRef(function(i,a){var l=D.useContext(yF);return e(i,l,a)})},h0=D.createContext({}),KRe=function(e,i){if(typeof i=="function"){var a=i(e);return a}return Oy({},e,i)},qRe=kK(function(n){return kK(function(e){return KRe(n,e)})}),YRe=function(e){var i=D.useContext(h0);return e.theme!==i&&(i=qRe(i)(e.theme)),D.createElement(h0.Provider,{value:i},e.children)},vF={}.hasOwnProperty,NU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",XRe=function(e,i){var a={};for(var l in i)vF.call(i,l)&&(a[l]=i[l]);return a[NU]=e,a},JRe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return gF(i,a,l),PZ(function(){return _F(i,a,l)}),null},QRe=EF(function(n,e,i){var a=n.css;typeof a=="string"&&e.registered[a]!==void 0&&(a=e.registered[a]);var l=n[NU],d=[a],p="";typeof n.className=="string"?p=RZ(e.registered,d,n.className):n.className!=null&&(p=n.className+" ");var y=v1(d,void 0,D.useContext(h0));p+=e.key+"-"+y.name;var v={};for(var b in n)vF.call(n,b)&&b!=="css"&&b!==NU&&(v[b]=n[b]);return v.className=p,i&&(v.ref=i),D.createElement(D.Fragment,null,D.createElement(JRe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),D.createElement(l,v))}),ZRe=QRe,jK=function(e,i){var a=arguments;if(i==null||!vF.call(i,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=ZRe,d[1]=XRe(e,i);for(var p=2;p<l;p++)d[p]=a[p];return D.createElement.apply(null,d)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(jK||(jK={}));var S1=EF(function(n,e){var i=n.styles,a=v1([i],void 0,D.useContext(h0)),l=D.useRef();return FK(function(){var d=e.key+"-global",p=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",d),p.hydrate([v])),l.current=[p,y],function(){p.flush()}},[e]),FK(function(){var d=l.current,p=d[0],y=d[1];if(y){d[1]=!1;return}if(a.next!==void 0&&_F(e,a.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}e.insert("",a,p,!1)},[e,a.name]),null});function eIe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return v1(e)}function qC(){var n=eIe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const SF=D.createContext({});SF.displayName="ColorModeContext";function b1(){const n=D.useContext(SF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function tIe(n,e){const{colorMode:i}=b1();return i==="dark"?e:n}const _O={light:"chakra-ui-light",dark:"chakra-ui-dark"};function nIe(n={}){const{preventTransition:e=!0,nonce:i}=n,a={setDataset:l=>{const d=e?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?_O.dark:_O.light),document.body.classList.remove(l?_O.light:_O.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),p=y=>{l(y.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const rIe="chakra-ui-color-mode";function iIe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const sIe=iIe(rIe),BK=()=>{},oIe=Tye()?D.useLayoutEffect:D.useEffect;function WK(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const OZ=function(e){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:y=sIe}=e,v=$Re(),b=d==="dark"?"dark":"light",[w,A]=D.useState(()=>WK(y,b)),[N,V]=D.useState(()=>WK(y)),{getSystemTheme:F,setClassName:B,setDataset:W,addListener:J}=D.useMemo(()=>nIe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),$=d==="system"&&!w?N:w,te=D.useCallback(_e=>{const ne=_e==="system"?F():_e;A(ne),B(ne==="dark"),W(ne),y.set(ne)},[y,F,B,W]);oIe(()=>{d==="system"&&V(F())},[]),D.useEffect(()=>{const _e=y.get();if(_e){te(_e);return}if(d==="system"){te("system");return}te(b)},[y,b,d,te]);const ce=D.useCallback(()=>{te($==="dark"?"light":"dark")},[$,te]);D.useEffect(()=>{if(l)return J(te)},[l,J,te]);const oe=D.useMemo(()=>({colorMode:i??$,toggleColorMode:i?BK:ce,setColorMode:i?BK:te,forced:i!==void 0}),[$,ce,te,i]);return C.jsx(SF.Provider,{value:oe,children:a})};OZ.displayName="ColorModeProvider";const kZ=String.raw,NZ=kZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,aIe=()=>C.jsx(S1,{styles:NZ}),cIe=({scope:n=""})=>C.jsx(S1,{styles:kZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${NZ}
    `});function lIe(n){const{cssVarsRoot:e,theme:i,children:a}=n,l=D.useMemo(()=>Yve(i),[i]);return C.jsxs(YRe,{theme:l,children:[C.jsx(uIe,{root:e}),a]})}function uIe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return C.jsx(S1,{styles:i=>({[e]:i.__cssVars})})}Fi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function dIe(){const{colorMode:n}=b1();return C.jsx(S1,{styles:e=>{const i=jQ(e,"styles.global"),a=il(i,{theme:e,colorMode:n});return a?rZ(a)(e):void 0}})}const[hIe,fIe]=Fi({strict:!1,name:"PortalManagerContext"});function bF(n){const{children:e,zIndex:i}=n;return C.jsx(hIe,{value:{zIndex:i},children:e})}bF.displayName="PortalManager";const TF=D.createContext({getDocument(){return document},getWindow(){return window}});TF.displayName="EnvironmentContext";function pIe({defer:n}={}){const[,e]=D.useReducer(i=>i+1,0);return Rp(()=>{n&&e()},[n]),D.useContext(TF)}function DZ(n){const{children:e,environment:i,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),p=!a||!i;return C.jsxs(TF.Provider,{value:d,children:[e,p&&C.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}DZ.displayName="EnvironmentProvider";const mIe=n=>{const{children:e,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:p={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:w}=n,A=C.jsx(DZ,{environment:y,disabled:b,children:e});return C.jsx(lIe,{theme:p,cssVarsRoot:v,children:C.jsxs(OZ,{colorModeManager:i,options:p.config,children:[d?C.jsx(cIe,{scope:l}):C.jsx(aIe,{}),!w&&C.jsx(dIe,{}),a?C.jsx(bF,{zIndex:a,children:A}):A]})})},wF=D.createContext({});function CF(n){const e=D.useRef(null);return e.current===null&&(e.current=n()),e.current}const YC=D.createContext(null),RF=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class gIe extends D.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function _Ie({children:n,isPresent:e}){const i=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(RF);return D.useInsertionEffect(()=>{const{width:p,height:y,top:v,left:b}=l.current;if(e||!a.current||!p||!y)return;a.current.dataset.motionPopId=i;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[e]),C.jsx(gIe,{isPresent:e,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const yIe=({children:n,initial:e,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:p})=>{const y=CF(EIe),v=D.useId(),b=D.useCallback(A=>{y.set(A,!0);for(const N of y.values())if(!N)return;a&&a()},[y,a]),w=D.useMemo(()=>({id:v,initial:e,isPresent:i,custom:l,onExitComplete:b,register:A=>(y.set(A,!1),()=>y.delete(A))}),d?[Math.random(),b]:[i,b]);return D.useMemo(()=>{y.forEach((A,N)=>y.set(N,!1))},[i]),D.useEffect(()=>{!i&&!y.size&&a&&a()},[i]),p==="popLayout"&&(n=C.jsx(_Ie,{isPresent:i,children:n})),C.jsx(YC.Provider,{value:w,children:n})};function EIe(){return new Map}function IF(n=!0){const e=D.useContext(YC);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=e,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const p=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,p]:[!0]}function vIe(){return SIe(D.useContext(YC))}function SIe(n){return n===null?!0:n.isPresent}const yO=n=>n.key||"";function zK(n){const e=[];return D.Children.forEach(n,i=>{D.isValidElement(i)&&e.push(i)}),e}const AF=typeof window<"u",xZ=AF?D.useLayoutEffect:D.useEffect,L0=({children:n,custom:e,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[y,v]=IF(p),b=D.useMemo(()=>zK(n),[n]),w=p&&!y?[]:b.map(yO),A=D.useRef(!0),N=D.useRef(b),V=CF(()=>new Map),[F,B]=D.useState(b),[W,J]=D.useState(b);xZ(()=>{A.current=!1,N.current=b;for(let ce=0;ce<W.length;ce++){const oe=yO(W[ce]);w.includes(oe)?V.delete(oe):V.get(oe)!==!0&&V.set(oe,!1)}},[W,w.length,w.join("-")]);const $=[];if(b!==F){let ce=[...b];for(let oe=0;oe<W.length;oe++){const _e=W[oe],ne=yO(_e);w.includes(ne)||(ce.splice(oe,0,_e),$.push(_e))}d==="wait"&&$.length&&(ce=$),J(zK(ce)),B(b);return}const{forceRender:te}=D.useContext(wF);return C.jsx(C.Fragment,{children:W.map(ce=>{const oe=yO(ce),_e=p&&!y?!1:b===W||w.includes(oe),ne=()=>{if(V.has(oe))V.set(oe,!0);else return;let ee=!0;V.forEach(Q=>{Q||(ee=!1)}),ee&&(te==null||te(),J(N.current),p&&(v==null||v()),a&&a())};return C.jsx(yIe,{isPresent:_e,initial:!A.current||i?void 0:!1,custom:_e?void 0:e,presenceAffectsLayout:l,mode:d,onExitComplete:_e?void 0:ne,children:ce},oe)})})},Ul=n=>n;let LZ=Ul;function PF(n){let e;return()=>(e===void 0&&(e=n()),e)}const f0=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a},Ap=n=>n*1e3,Pp=n=>n/1e3,bIe={useManualTiming:!1};function TIe(n){let e=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function y(b){d.has(b)&&(v.schedule(b),n()),b(p)}const v={schedule:(b,w=!1,A=!1)=>{const V=A&&a?e:i;return w&&d.add(b),V.has(b)||V.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(p=b,a){l=!0;return}a=!0,[e,i]=[i,e],e.forEach(y),e.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const EO=["read","resolveKeyframes","update","preRender","render","postRender"],wIe=40;function MZ(n,e){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,p=EO.reduce((J,$)=>(J[$]=TIe(d),J),{}),{read:y,resolveKeyframes:v,update:b,preRender:w,render:A,postRender:N}=p,V=()=>{const J=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(J-l.timestamp,wIe),1),l.timestamp=J,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),w.process(l),A.process(l),N.process(l),l.isProcessing=!1,i&&e&&(a=!1,n(V))},F=()=>{i=!0,a=!0,l.isProcessing||n(V)};return{schedule:EO.reduce((J,$)=>{const te=p[$];return J[$]=(ce,oe=!1,_e=!1)=>(i||F(),te.schedule(ce,oe,_e)),J},{}),cancel:J=>{for(let $=0;$<EO.length;$++)p[EO[$]].cancel(J)},state:l,steps:p}}const{schedule:Zi,cancel:Sg,state:da,steps:v2}=MZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ul,!0),UZ=D.createContext({strict:!1}),GK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},p0={};for(const n in GK)p0[n]={isEnabled:e=>GK[n].some(i=>!!e[i])};function CIe(n){for(const e in n)p0[e]={...p0[e],...n[e]}}const RIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Ck(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||RIe.has(n)}let VZ=n=>!Ck(n);function IIe(n){n&&(VZ=e=>e.startsWith("on")?!Ck(e):n(e))}try{IIe(require("@emotion/is-prop-valid").default)}catch{}function AIe(n,e,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(VZ(l)||i===!0&&Ck(l)||!e&&!Ck(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function PIe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const T1=D.createContext({});function bC(n){return typeof n=="string"||Array.isArray(n)}function w1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const OF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],kF=["initial",...OF];function C1(n){return w1(n.animate)||kF.some(e=>bC(n[e]))}function FZ(n){return!!(C1(n)||n.variants)}function OIe(n,e){if(C1(n)){const{initial:i,animate:a}=n;return{initial:i===!1||bC(i)?i:void 0,animate:bC(a)?a:void 0}}return n.inherit!==!1?e:{}}function kIe(n){const{initial:e,animate:i}=OIe(n,D.useContext(T1));return D.useMemo(()=>({initial:e,animate:i}),[HK(e),HK(i)])}function HK(n){return Array.isArray(n)?n.join(" "):n}const NIe=Symbol.for("motionComponentSymbol");function LS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function DIe(n,e,i){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):LS(i)&&(i.current=a))},[e])}const NF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),xIe="framerAppearId",jZ="data-"+NF(xIe),{schedule:DF}=MZ(queueMicrotask,!1),BZ=D.createContext({});function LIe(n,e,i,a,l){var d,p;const{visualElement:y}=D.useContext(T1),v=D.useContext(UZ),b=D.useContext(YC),w=D.useContext(RF).reducedMotion,A=D.useRef(null);a=a||v.renderer,!A.current&&a&&(A.current=a(n,{visualState:e,parent:y,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const N=A.current,V=D.useContext(BZ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&MIe(A.current,i,l,V);const F=D.useRef(!1);D.useInsertionEffect(()=>{N&&F.current&&N.update(i,b)});const B=i[jZ],W=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return xZ(()=>{N&&(F.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),DF.render(N.render),W.current&&N.animationState&&N.animationState.animateChanges())}),D.useEffect(()=>{N&&(!W.current&&N.animationState&&N.animationState.animateChanges(),W.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,B)}),W.current=!1))}),N}function MIe(n,e,i,a){const{layoutId:l,layout:d,drag:p,dragConstraints:y,layoutScroll:v,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:WZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||y&&LS(y),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function WZ(n){if(n)return n.options.allowProjection!==!1?n.projection:WZ(n.parent)}function UIe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:a,Component:l}){var d,p;n&&CIe(n);function y(b,w){let A;const N={...D.useContext(RF),...b,layoutId:VIe(b)},{isStatic:V}=N,F=kIe(b),B=a(b,V);if(!V&&AF){FIe();const W=jIe(N);A=W.MeasureLayout,F.visualElement=LIe(l,B,N,e,W.ProjectionNode)}return C.jsxs(T1.Provider,{value:F,children:[A&&F.visualElement?C.jsx(A,{visualElement:F.visualElement,...N}):null,i(l,b,DIe(B,F.visualElement,w),B,V,F.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const v=D.forwardRef(y);return v[NIe]=l,v}function VIe({layoutId:n}){const e=D.useContext(wF).id;return e&&n!==void 0?e+"-"+n:n}function FIe(n,e){D.useContext(UZ).strict}function jIe(n){const{drag:e,layout:i}=p0;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const BIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function xF(n){return typeof n!="string"||n.includes("-")?!1:!!(BIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function $K(n){const e=[{},{}];return n==null||n.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function LF(n,e,i,a){if(typeof e=="function"){const[l,d]=$K(a);e=e(i!==void 0?i:n.custom,l,d)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,d]=$K(a);e=e(i!==void 0?i:n.custom,l,d)}return e}const DU=n=>Array.isArray(n),WIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),zIe=n=>DU(n)?n[n.length-1]||0:n,Ka=n=>!!(n&&n.getVelocity);function ZO(n){const e=Ka(n)?n.get():n;return WIe(e)?e.toValue():e}function GIe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},a,l,d){const p={latestValues:HIe(a,l,d,n),renderState:e()};return i&&(p.onMount=y=>i({props:a,current:y,...p}),p.onUpdate=y=>i(y)),p}const zZ=n=>(e,i)=>{const a=D.useContext(T1),l=D.useContext(YC),d=()=>GIe(n,e,a,l);return i?d():CF(d)};function HIe(n,e,i,a){const l={},d=a(n,{});for(const N in d)l[N]=ZO(d[N]);let{initial:p,animate:y}=n;const v=C1(n),b=FZ(n);e&&b&&!v&&n.inherit!==!1&&(p===void 0&&(p=e.initial),y===void 0&&(y=e.animate));let w=i?i.initial===!1:!1;w=w||p===!1;const A=w?y:p;if(A&&typeof A!="boolean"&&!w1(A)){const N=Array.isArray(A)?A:[A];for(let V=0;V<N.length;V++){const F=LF(n,N[V]);if(F){const{transitionEnd:B,transition:W,...J}=F;for(const $ in J){let te=J[$];if(Array.isArray(te)){const ce=w?te.length-1:0;te=te[ce]}te!==null&&(l[$]=te)}for(const $ in B)l[$]=B[$]}}}return l}const M0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Hy=new Set(M0),GZ=n=>e=>typeof e=="string"&&e.startsWith(n),HZ=GZ("--"),$Ie=GZ("var(--"),MF=n=>$Ie(n)?KIe.test(n.split("/*")[0].trim()):!1,KIe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,$Z=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Lp=(n,e,i)=>i>e?e:i<n?n:i,U0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},TC={...U0,transform:n=>Lp(0,1,n)},vO={...U0,default:1},XC=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),rg=XC("deg"),Xh=XC("%"),Mn=XC("px"),qIe=XC("vh"),YIe=XC("vw"),KK={...Xh,parse:n=>Xh.parse(n)/100,transform:n=>Xh.transform(n*100)},XIe={borderWidth:Mn,borderTopWidth:Mn,borderRightWidth:Mn,borderBottomWidth:Mn,borderLeftWidth:Mn,borderRadius:Mn,radius:Mn,borderTopLeftRadius:Mn,borderTopRightRadius:Mn,borderBottomRightRadius:Mn,borderBottomLeftRadius:Mn,width:Mn,maxWidth:Mn,height:Mn,maxHeight:Mn,top:Mn,right:Mn,bottom:Mn,left:Mn,padding:Mn,paddingTop:Mn,paddingRight:Mn,paddingBottom:Mn,paddingLeft:Mn,margin:Mn,marginTop:Mn,marginRight:Mn,marginBottom:Mn,marginLeft:Mn,backgroundPositionX:Mn,backgroundPositionY:Mn},JIe={rotate:rg,rotateX:rg,rotateY:rg,rotateZ:rg,scale:vO,scaleX:vO,scaleY:vO,scaleZ:vO,skew:rg,skewX:rg,skewY:rg,distance:Mn,translateX:Mn,translateY:Mn,translateZ:Mn,x:Mn,y:Mn,z:Mn,perspective:Mn,transformPerspective:Mn,opacity:TC,originX:KK,originY:KK,originZ:Mn},qK={...U0,transform:Math.round},UF={...XIe,...JIe,zIndex:qK,size:Mn,fillOpacity:TC,strokeOpacity:TC,numOctaves:qK},QIe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},ZIe=M0.length;function eAe(n,e,i){let a="",l=!0;for(let d=0;d<ZIe;d++){const p=M0[d],y=n[p];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(p.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const b=$Z(y,UF[p]);if(!v){l=!1;const w=QIe[p]||p;a+=`${w}(${b}) `}i&&(e[p]=b)}}return a=a.trim(),i?a=i(e,l?"":a):l&&(a="none"),a}function VF(n,e,i){const{style:a,vars:l,transformOrigin:d}=n;let p=!1,y=!1;for(const v in e){const b=e[v];if(Hy.has(v)){p=!0;continue}else if(HZ(v)){l[v]=b;continue}else{const w=$Z(b,UF[v]);v.startsWith("origin")?(y=!0,d[v]=w):a[v]=w}}if(e.transform||(p||i?a.transform=eAe(e,n.transform,i):a.transform&&(a.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${v} ${b} ${w}`}}const tAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},nAe={offset:"strokeDashoffset",array:"strokeDasharray"};function rAe(n,e,i=1,a=0,l=!0){n.pathLength=1;const d=l?tAe:nAe;n[d.offset]=Mn.transform(-a);const p=Mn.transform(e),y=Mn.transform(i);n[d.array]=`${p} ${y}`}function YK(n,e,i){return typeof n=="string"?n:Mn.transform(e+i*n)}function iAe(n,e,i){const a=YK(e,n.x,n.width),l=YK(i,n.y,n.height);return`${a} ${l}`}function FF(n,{attrX:e,attrY:i,attrScale:a,originX:l,originY:d,pathLength:p,pathSpacing:y=1,pathOffset:v=0,...b},w,A){if(VF(n,b,A),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:V,dimensions:F}=n;N.transform&&(F&&(V.transform=N.transform),delete N.transform),F&&(l!==void 0||d!==void 0||V.transform)&&(V.transformOrigin=iAe(F,l!==void 0?l:.5,d!==void 0?d:.5)),e!==void 0&&(N.x=e),i!==void 0&&(N.y=i),a!==void 0&&(N.scale=a),p!==void 0&&rAe(N,p,y,v,!1)}const jF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),KZ=()=>({...jF(),attrs:{}}),BF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function qZ(n,{style:e,vars:i},a,l){Object.assign(n.style,e,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const YZ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function XZ(n,e,i,a){qZ(n,e,void 0,a);for(const l in e.attrs)n.setAttribute(YZ.has(l)?l:NF(l),e.attrs[l])}const Rk={};function sAe(n){Object.assign(Rk,n)}function JZ(n,{layout:e,layoutId:i}){return Hy.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Rk[n]||n==="opacity")}function WF(n,e,i){var a;const{style:l}=n,d={};for(const p in l)(Ka(l[p])||e.style&&Ka(e.style[p])||JZ(p,n)||((a=i==null?void 0:i.getValue(p))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function QZ(n,e,i){const a=WF(n,e,i);for(const l in n)if(Ka(n[l])||Ka(e[l])){const d=M0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function oAe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const XK=["x","y","width","height","cx","cy","r"],aAe={useVisualState:zZ({scrapeMotionValuesFromProps:QZ,createRenderState:KZ,onUpdate:({props:n,prevProps:e,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const y in l)if(Hy.has(y)){d=!0;break}}if(!d)return;let p=!e;if(e)for(let y=0;y<XK.length;y++){const v=XK[y];n[v]!==e[v]&&(p=!0)}p&&Zi.read(()=>{oAe(i,a),Zi.render(()=>{FF(a,l,BF(i.tagName),n.transformTemplate),XZ(i,a)})})}})},cAe={useVisualState:zZ({scrapeMotionValuesFromProps:WF,createRenderState:jF})};function ZZ(n,e,i){for(const a in e)!Ka(e[a])&&!JZ(a,i)&&(n[a]=e[a])}function lAe({transformTemplate:n},e){return D.useMemo(()=>{const i=jF();return VF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function uAe(n,e){const i=n.style||{},a={};return ZZ(a,i,n),Object.assign(a,lAe(n,e)),a}function dAe(n,e){const i={},a=uAe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function hAe(n,e,i,a){const l=D.useMemo(()=>{const d=KZ();return FF(d,e,BF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(n.style){const d={};ZZ(d,n.style,n),l.style={...d,...l.style}}return l}function fAe(n=!1){return(i,a,l,{latestValues:d},p)=>{const v=(xF(i)?hAe:dAe)(a,d,p,i),b=AIe(a,typeof i=="string",n),w=i!==D.Fragment?{...b,...v,ref:l}:{},{children:A}=a,N=D.useMemo(()=>Ka(A)?A.get():A,[A]);return D.createElement(i,{...w,children:N})}}function pAe(n,e){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...xF(a)?aAe:cAe,preloadedFeatures:n,useRender:fAe(l),createVisualElement:e,Component:a};return UIe(p)}}function eee(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}function R1(n,e,i){const a=n.getProps();return LF(a,e,i!==void 0?i:a.custom,n)}const mAe=PF(()=>window.ScrollTimeline!==void 0);class gAe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let a=0;a<this.animations.length;a++)this.animations[a][e]=i}attachTimeline(e,i){const a=this.animations.map(l=>{if(mAe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class _Ae extends gAe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function zF(n,e){return n?n[e]||n.default||n:void 0}const xU=2e4;function tee(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<xU;)e+=i,a=n.next(e);return e>=xU?1/0:e}function GF(n){return typeof n=="function"}function JK(n,e){n.timeline=e,n.onfinish=null}const HF=n=>Array.isArray(n)&&typeof n[0]=="number",yAe={linearEasing:void 0};function EAe(n,e){const i=PF(n);return()=>{var a;return(a=yAe[e])!==null&&a!==void 0?a:i()}}const Ik=EAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),nee=(n,e,i=10)=>{let a="";const l=Math.max(Math.round(e/i),2);for(let d=0;d<l;d++)a+=n(f0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function ree(n){return!!(typeof n=="function"&&Ik()||!n||typeof n=="string"&&(n in LU||Ik())||HF(n)||Array.isArray(n)&&n.every(ree))}const Uw=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,LU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Uw([0,.65,.55,1]),circOut:Uw([.55,0,1,.45]),backIn:Uw([.31,.01,.66,-.59]),backOut:Uw([.33,1.53,.69,.99])};function iee(n,e){if(n)return typeof n=="function"&&Ik()?nee(n,e):HF(n)?Uw(n):Array.isArray(n)?n.map(i=>iee(i,e)||LU.easeOut):LU[n]}const Id={x:!1,y:!1};function see(){return Id.x||Id.y}function vAe(n,e,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function oee(n,e){const i=vAe(n),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[i,l,()=>a.abort()]}function QK(n){return e=>{e.pointerType==="touch"||see()||n(e)}}function SAe(n,e,i={}){const[a,l,d]=oee(n,i),p=QK(y=>{const{target:v}=y,b=e(y);if(typeof b!="function"||!v)return;const w=QK(A=>{b(A),v.removeEventListener("pointerleave",w)});v.addEventListener("pointerleave",w,l)});return a.forEach(y=>{y.addEventListener("pointerenter",p,l)}),d}const aee=(n,e)=>e?n===e?!0:aee(n,e.parentElement):!1,$F=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,bAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function TAe(n){return bAe.has(n.tagName)||n.tabIndex!==-1}const Vw=new WeakSet;function ZK(n){return e=>{e.key==="Enter"&&n(e)}}function S2(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const wAe=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=ZK(()=>{if(Vw.has(i))return;S2(i,"down");const l=ZK(()=>{S2(i,"up")}),d=()=>S2(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",d,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function eq(n){return $F(n)&&!see()}function CAe(n,e,i={}){const[a,l,d]=oee(n,i),p=y=>{const v=y.currentTarget;if(!eq(y)||Vw.has(v))return;Vw.add(v);const b=e(y),w=(V,F)=>{window.removeEventListener("pointerup",A),window.removeEventListener("pointercancel",N),!(!eq(V)||!Vw.has(v))&&(Vw.delete(v),typeof b=="function"&&b(V,{success:F}))},A=V=>{w(V,i.useGlobalTarget||aee(v,V.target))},N=V=>{w(V,!1)};window.addEventListener("pointerup",A,l),window.addEventListener("pointercancel",N,l)};return a.forEach(y=>{!TAe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",p,l),y.addEventListener("focus",b=>wAe(b,l),l)}),d}function RAe(n){return n==="x"||n==="y"?Id[n]?null:(Id[n]=!0,()=>{Id[n]=!1}):Id.x||Id.y?null:(Id.x=Id.y=!0,()=>{Id.x=Id.y=!1})}const cee=new Set(["width","height","top","left","right","bottom",...M0]);let ek;function IAe(){ek=void 0}const Jh={now:()=>(ek===void 0&&Jh.set(da.isProcessing||bIe.useManualTiming?da.timestamp:performance.now()),ek),set:n=>{ek=n,queueMicrotask(IAe)}};function KF(n,e){n.indexOf(e)===-1&&n.push(e)}function qF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class YF{constructor(){this.subscriptions=[]}add(e){return KF(this.subscriptions,e),()=>qF(this.subscriptions,e)}notify(e,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,a);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function lee(n,e){return e?n*(1e3/e):0}const tq=30,AAe=n=>!isNaN(parseFloat(n));class PAe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Jh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Jh.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=AAe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new YF);const a=this.events[e].add(i);return e==="change"?()=>{a(),Zi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Jh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>tq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,tq);return lee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wC(n,e){return new PAe(n,e)}function OAe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,wC(i))}function kAe(n,e){const i=R1(n,e);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const p in d){const y=zIe(d[p]);OAe(n,p,y)}}function NAe(n){return!!(Ka(n)&&n.add)}function MU(n,e){const i=n.getValue("willChange");if(NAe(i))return i.add(e)}function uee(n){return n.props[jZ]}const dee=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,DAe=1e-7,xAe=12;function LAe(n,e,i,a,l){let d,p,y=0;do p=e+(i-e)/2,d=dee(p,a,l)-n,d>0?i=p:e=p;while(Math.abs(d)>DAe&&++y<xAe);return p}function JC(n,e,i,a){if(n===e&&i===a)return Ul;const l=d=>LAe(d,0,1,n,i);return d=>d===0||d===1?d:dee(l(d),e,a)}const hee=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,fee=n=>e=>1-n(1-e),pee=JC(.33,1.53,.69,.99),XF=fee(pee),mee=hee(XF),gee=n=>(n*=2)<1?.5*XF(n):.5*(2-Math.pow(2,-10*(n-1))),JF=n=>1-Math.sin(Math.acos(n)),_ee=fee(JF),yee=hee(JF),Eee=n=>/^0[^.\s]+$/u.test(n);function MAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Eee(n):!0}const tC=n=>Math.round(n*1e5)/1e5,QF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function UAe(n){return n==null}const VAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,ZF=(n,e)=>i=>!!(typeof i=="string"&&VAe.test(i)&&i.startsWith(n)||e&&!UAe(i)&&Object.prototype.hasOwnProperty.call(i,e)),vee=(n,e,i)=>a=>{if(typeof a!="string")return a;const[l,d,p,y]=a.match(QF);return{[n]:parseFloat(l),[e]:parseFloat(d),[i]:parseFloat(p),alpha:y!==void 0?parseFloat(y):1}},FAe=n=>Lp(0,255,n),b2={...U0,transform:n=>Math.round(FAe(n))},_y={test:ZF("rgb","red"),parse:vee("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+b2.transform(n)+", "+b2.transform(e)+", "+b2.transform(i)+", "+tC(TC.transform(a))+")"};function jAe(n){let e="",i="",a="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const UU={test:ZF("#"),parse:jAe,transform:_y.transform},MS={test:ZF("hsl","hue"),parse:vee("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+Xh.transform(tC(e))+", "+Xh.transform(tC(i))+", "+tC(TC.transform(a))+")"},Ga={test:n=>_y.test(n)||UU.test(n)||MS.test(n),parse:n=>_y.test(n)?_y.parse(n):MS.test(n)?MS.parse(n):UU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?_y.transform(n):MS.transform(n)},BAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function WAe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(QF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(BAe))===null||i===void 0?void 0:i.length)||0)>0}const See="number",bee="color",zAe="var",GAe="var(",nq="${}",HAe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function CC(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const y=e.replace(HAe,v=>(Ga.test(v)?(a.color.push(d),l.push(bee),i.push(Ga.parse(v))):v.startsWith(GAe)?(a.var.push(d),l.push(zAe),i.push(v)):(a.number.push(d),l.push(See),i.push(parseFloat(v))),++d,nq)).split(nq);return{values:i,split:y,indexes:a,types:l}}function Tee(n){return CC(n).values}function wee(n){const{split:e,types:i}=CC(n),a=e.length;return l=>{let d="";for(let p=0;p<a;p++)if(d+=e[p],l[p]!==void 0){const y=i[p];y===See?d+=tC(l[p]):y===bee?d+=Ga.transform(l[p]):d+=l[p]}return d}}const $Ae=n=>typeof n=="number"?0:n;function KAe(n){const e=Tee(n);return wee(n)(e.map($Ae))}const bg={test:WAe,parse:Tee,createTransformer:wee,getAnimatableNone:KAe},qAe=new Set(["brightness","contrast","saturate","opacity"]);function YAe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(QF)||[];if(!a)return n;const l=i.replace(a,"");let d=qAe.has(e)?1:0;return a!==i&&(d*=100),e+"("+d+l+")"}const XAe=/\b([a-z-]*)\(.*?\)/gu,VU={...bg,getAnimatableNone:n=>{const e=n.match(XAe);return e?e.map(YAe).join(" "):n}},JAe={...UF,color:Ga,backgroundColor:Ga,outlineColor:Ga,fill:Ga,stroke:Ga,borderColor:Ga,borderTopColor:Ga,borderRightColor:Ga,borderBottomColor:Ga,borderLeftColor:Ga,filter:VU,WebkitFilter:VU},ej=n=>JAe[n];function Cee(n,e){let i=ej(n);return i!==VU&&(i=bg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const QAe=new Set(["auto","none","0"]);function ZAe(n,e,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!QAe.has(d)&&CC(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of e)n[d]=Cee(i,l)}const rq=n=>n===U0||n===Mn,iq=(n,e)=>parseFloat(n.split(", ")[e]),sq=(n,e)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return iq(l[1],e);{const d=a.match(/^matrix\((.+)\)$/u);return d?iq(d[1],n):0}},ePe=new Set(["x","y","z"]),tPe=M0.filter(n=>!ePe.has(n));function nPe(n){const e=[];return tPe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const m0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:sq(4,13),y:sq(5,14)};m0.translateX=m0.x;m0.translateY=m0.y;const Ty=new Set;let FU=!1,jU=!1;function Ree(){if(jU){const n=Array.from(Ty).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const l=nPe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,p])=>{var y;(y=a.getValue(d))===null||y===void 0||y.set(p)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}jU=!1,FU=!1,Ty.forEach(n=>n.complete()),Ty.clear()}function Iee(){Ty.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(jU=!0)})}function rPe(){Iee(),Ree()}class tj{constructor(e,i,a,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Ty.add(this),FU||(FU=!0,Zi.read(Iee),Zi.resolveKeyframes(Ree))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:l}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const p=l==null?void 0:l.get(),y=e[e.length-1];if(p!==void 0)e[0]=p;else if(a&&i){const v=a.readValue(i,y);v!=null&&(e[0]=v)}e[0]===void 0&&(e[0]=y),l&&p===void 0&&l.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Ty.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Ty.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Aee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),iPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function sPe(n){const e=iPe.exec(n);if(!e)return[,];const[,i,a,l]=e;return[`--${i??a}`,l]}function Pee(n,e,i=1){const[a,l]=sPe(n);if(!a)return;const d=window.getComputedStyle(e).getPropertyValue(a);if(d){const p=d.trim();return Aee(p)?parseFloat(p):p}return MF(l)?Pee(l,e,i+1):l}const Oee=n=>e=>e.test(n),oPe={test:n=>n==="auto",parse:n=>n},kee=[U0,Mn,Xh,rg,YIe,qIe,oPe],oq=n=>kee.find(Oee(n));class Nee extends tj{constructor(e,i,a,l,d){super(e,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let b=e[v];if(typeof b=="string"&&(b=b.trim(),MF(b))){const w=Pee(b,i.current);w!==void 0&&(e[v]=w),v===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!cee.has(a)||e.length!==2)return;const[l,d]=e,p=oq(l),y=oq(d);if(p!==y)if(rq(p)&&rq(y))for(let v=0;v<e.length;v++){const b=e[v];typeof b=="string"&&(e[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let l=0;l<e.length;l++)MAe(e[l])&&a.push(l);a.length&&ZAe(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=m0[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,y=l[p];l[p]=m0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const aq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(bg.test(n)||n==="0")&&!n.startsWith("url("));function aPe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function cPe(n,e,i,a){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const d=n[n.length-1],p=aq(l,e),y=aq(d,e);return!p||!y?!1:aPe(n)||(i==="spring"||GF(i))&&a}const lPe=n=>n!==null;function I1(n,{repeat:e,repeatType:i="loop"},a){const l=n.filter(lPe),d=e&&i!=="loop"&&e%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const uPe=40;class Dee{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Jh.now(),this.options={autoplay:e,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:p,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>uPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&rPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Jh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:p,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!cPe(e,a,l,d))if(p)this.options.duration=0;else{v&&v(I1(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const w=this.initPlayback(e,i);w!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...w},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ps=(n,e,i)=>n+(e-n)*i;function T2(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function dPe({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let l=0,d=0,p=0;if(!e)l=d=p=i;else{const y=i<.5?i*(1+e):i+e-i*e,v=2*i-y;l=T2(v,y,n+1/3),d=T2(v,y,n),p=T2(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:a}}function Ak(n,e){return i=>i>0?e:n}const w2=(n,e,i)=>{const a=n*n,l=i*(e*e-a)+a;return l<0?0:Math.sqrt(l)},hPe=[UU,_y,MS],fPe=n=>hPe.find(e=>e.test(n));function cq(n){const e=fPe(n);if(!e)return!1;let i=e.parse(n);return e===MS&&(i=dPe(i)),i}const lq=(n,e)=>{const i=cq(n),a=cq(e);if(!i||!a)return Ak(n,e);const l={...i};return d=>(l.red=w2(i.red,a.red,d),l.green=w2(i.green,a.green,d),l.blue=w2(i.blue,a.blue,d),l.alpha=ps(i.alpha,a.alpha,d),_y.transform(l))},pPe=(n,e)=>i=>e(n(i)),QC=(...n)=>n.reduce(pPe),BU=new Set(["none","hidden"]);function mPe(n,e){return BU.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function gPe(n,e){return i=>ps(n,e,i)}function nj(n){return typeof n=="number"?gPe:typeof n=="string"?MF(n)?Ak:Ga.test(n)?lq:EPe:Array.isArray(n)?xee:typeof n=="object"?Ga.test(n)?lq:_Pe:Ak}function xee(n,e){const i=[...n],a=i.length,l=n.map((d,p)=>nj(d)(d,e[p]));return d=>{for(let p=0;p<a;p++)i[p]=l[p](d);return i}}function _Pe(n,e){const i={...n,...e},a={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(a[l]=nj(n[l])(n[l],e[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function yPe(n,e){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const p=e.types[d],y=n.indexes[p][l[p]],v=(i=n.values[y])!==null&&i!==void 0?i:0;a[d]=v,l[p]++}return a}const EPe=(n,e)=>{const i=bg.createTransformer(e),a=CC(n),l=CC(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?BU.has(n)&&!l.values.length||BU.has(e)&&!a.values.length?mPe(n,e):QC(xee(yPe(a,l),l.values),i):Ak(n,e)};function Lee(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?ps(n,e,i):nj(n)(n,e)}const vPe=5;function Mee(n,e,i){const a=Math.max(e-vPe,0);return lee(i-n(a),e-a)}const Ds={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},uq=.001;function SPe({duration:n=Ds.duration,bounce:e=Ds.bounce,velocity:i=Ds.velocity,mass:a=Ds.mass}){let l,d,p=1-e;p=Lp(Ds.minDamping,Ds.maxDamping,p),n=Lp(Ds.minDuration,Ds.maxDuration,Pp(n)),p<1?(l=b=>{const w=b*p,A=w*n,N=w-i,V=WU(b,p),F=Math.exp(-A);return uq-N/V*F},d=b=>{const A=b*p*n,N=A*i+i,V=Math.pow(p,2)*Math.pow(b,2)*n,F=Math.exp(-A),B=WU(Math.pow(b,2),p);return(-l(b)+uq>0?-1:1)*((N-V)*F)/B}):(l=b=>{const w=Math.exp(-b*n),A=(b-i)*n+1;return-.001+w*A},d=b=>{const w=Math.exp(-b*n),A=(i-b)*(n*n);return w*A});const y=5/n,v=TPe(l,d,y);if(n=Ap(n),isNaN(v))return{stiffness:Ds.stiffness,damping:Ds.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:p*2*Math.sqrt(a*b),duration:n}}}const bPe=12;function TPe(n,e,i){let a=i;for(let l=1;l<bPe;l++)a=a-n(a)/e(a);return a}function WU(n,e){return n*Math.sqrt(1-e*e)}const wPe=["duration","bounce"],CPe=["stiffness","damping","mass"];function dq(n,e){return e.some(i=>n[i]!==void 0)}function RPe(n){let e={velocity:Ds.velocity,stiffness:Ds.stiffness,damping:Ds.damping,mass:Ds.mass,isResolvedFromDuration:!1,...n};if(!dq(n,CPe)&&dq(n,wPe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*Lp(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Ds.mass,stiffness:l,damping:d}}else{const i=SPe(n);e={...e,...i,mass:Ds.mass},e.isResolvedFromDuration=!0}return e}function Uee(n=Ds.visualDuration,e=Ds.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],y={done:!1,value:d},{stiffness:v,damping:b,mass:w,duration:A,velocity:N,isResolvedFromDuration:V}=RPe({...i,velocity:-Pp(i.velocity||0)}),F=N||0,B=b/(2*Math.sqrt(v*w)),W=p-d,J=Pp(Math.sqrt(v/w)),$=Math.abs(W)<5;a||(a=$?Ds.restSpeed.granular:Ds.restSpeed.default),l||(l=$?Ds.restDelta.granular:Ds.restDelta.default);let te;if(B<1){const oe=WU(J,B);te=_e=>{const ne=Math.exp(-B*J*_e);return p-ne*((F+B*J*W)/oe*Math.sin(oe*_e)+W*Math.cos(oe*_e))}}else if(B===1)te=oe=>p-Math.exp(-J*oe)*(W+(F+J*W)*oe);else{const oe=J*Math.sqrt(B*B-1);te=_e=>{const ne=Math.exp(-B*J*_e),ee=Math.min(oe*_e,300);return p-ne*((F+B*J*W)*Math.sinh(ee)+oe*W*Math.cosh(ee))/oe}}const ce={calculatedDuration:V&&A||null,next:oe=>{const _e=te(oe);if(V)y.done=oe>=A;else{let ne=0;B<1&&(ne=oe===0?Ap(F):Mee(te,oe,_e));const ee=Math.abs(ne)<=a,Q=Math.abs(p-_e)<=l;y.done=ee&&Q}return y.value=y.done?p:_e,y},toString:()=>{const oe=Math.min(tee(ce),xU),_e=nee(ne=>ce.next(oe*ne).value,oe,30);return oe+"ms "+_e}};return ce}function hq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:y,max:v,restDelta:b=.5,restSpeed:w}){const A=n[0],N={done:!1,value:A},V=ee=>y!==void 0&&ee<y||v!==void 0&&ee>v,F=ee=>y===void 0?v:v===void 0||Math.abs(y-ee)<Math.abs(v-ee)?y:v;let B=i*e;const W=A+B,J=p===void 0?W:p(W);J!==W&&(B=J-A);const $=ee=>-B*Math.exp(-ee/a),te=ee=>J+$(ee),ce=ee=>{const Q=$(ee),se=te(ee);N.done=Math.abs(Q)<=b,N.value=N.done?J:se};let oe,_e;const ne=ee=>{V(N.value)&&(oe=ee,_e=Uee({keyframes:[N.value,F(N.value)],velocity:Mee(te,ee,N.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return ne(0),{calculatedDuration:null,next:ee=>{let Q=!1;return!_e&&oe===void 0&&(Q=!0,ce(ee),ne(ee)),oe!==void 0&&ee>=oe?_e.next(ee-oe):(!Q&&ce(ee),N)}}}const IPe=JC(.42,0,1,1),APe=JC(0,0,.58,1),Vee=JC(.42,0,.58,1),PPe=n=>Array.isArray(n)&&typeof n[0]!="number",OPe={linear:Ul,easeIn:IPe,easeInOut:Vee,easeOut:APe,circIn:JF,circInOut:yee,circOut:_ee,backIn:XF,backInOut:mee,backOut:pee,anticipate:gee},fq=n=>{if(HF(n)){LZ(n.length===4);const[e,i,a,l]=n;return JC(e,i,a,l)}else if(typeof n=="string")return OPe[n];return n};function kPe(n,e,i){const a=[],l=i||Lee,d=n.length-1;for(let p=0;p<d;p++){let y=l(n[p],n[p+1]);if(e){const v=Array.isArray(e)?e[p]||Ul:e;y=QC(v,y)}a.push(y)}return a}function NPe(n,e,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(LZ(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=kPe(e,a,l),v=y.length,b=w=>{if(p&&w<n[0])return e[0];let A=0;if(v>1)for(;A<n.length-2&&!(w<n[A+1]);A++);const N=f0(n[A],n[A+1],w);return y[A](N)};return i?w=>b(Lp(n[0],n[d-1],w)):b}function DPe(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const l=f0(0,e,a);n.push(ps(i,1,l))}}function xPe(n){const e=[0];return DPe(e,n.length-1),e}function LPe(n,e){return n.map(i=>i*e)}function MPe(n,e){return n.map(()=>e||Vee).splice(0,n.length-1)}function Pk({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const l=PPe(a)?a.map(fq):fq(a),d={done:!1,value:e[0]},p=LPe(i&&i.length===e.length?i:xPe(e),n),y=NPe(p,e,{ease:Array.isArray(l)?l:MPe(e,l)});return{calculatedDuration:n,next:v=>(d.value=y(v),d.done=v>=n,d)}}const UPe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>Zi.update(e,!0),stop:()=>Sg(e),now:()=>da.isProcessing?da.timestamp:Jh.now()}},VPe={decay:hq,inertia:hq,tween:Pk,keyframes:Pk,spring:Uee},FPe=n=>n/100;class rj extends Dee{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||tj,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new p(d,y,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,y=GF(i)?i:VPe[i]||Pk;let v,b;y!==Pk&&typeof e[0]!="number"&&(v=QC(FPe,Lee(e[0],e[1])),e=[0,100]);const w=y({...this.options,keyframes:e});d==="mirror"&&(b=y({...this.options,keyframes:[...e].reverse(),velocity:-p})),w.calculatedDuration===null&&(w.calculatedDuration=tee(w));const{calculatedDuration:A}=w,N=A+l,V=N*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:A,resolvedDuration:N,totalDuration:V}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:a}=this;if(!a){const{keyframes:ee}=this.options;return{done:!0,value:ee[ee.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:w,resolvedDuration:A}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:V,repeatType:F,repeatDelay:B,onUpdate:W}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-w/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const J=this.currentTime-N*(this.speed>=0?1:-1),$=this.speed>=0?J<0:J>w;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let te=this.currentTime,ce=d;if(V){const ee=Math.min(this.currentTime,w)/A;let Q=Math.floor(ee),se=ee%1;!se&&ee>=1&&(se=1),se===1&&Q--,Q=Math.min(Q,V+1),!!(Q%2)&&(F==="reverse"?(se=1-se,B&&(se-=B/A)):F==="mirror"&&(ce=p)),te=Lp(0,1,se)*A}const oe=$?{done:!1,value:v[0]}:ce.next(te);y&&(oe.value=y(oe.value));let{done:_e}=oe;!$&&b!==null&&(_e=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const ne=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_e);return ne&&l!==void 0&&(oe.value=I1(v,this.options,l)),W&&W(oe.value),ne&&this.finish(),oe}get duration(){const{resolved:e}=this;return e?Pp(e.calculatedDuration):0}get time(){return Pp(this.currentTime)}set time(e){e=Ap(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Pp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=UPe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const jPe=new Set(["opacity","clipPath","filter","transform"]);function BPe(n,e,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:y="easeInOut",times:v}={}){const b={[e]:i};v&&(b.offset=v);const w=iee(y,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const WPe=PF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Ok=10,zPe=2e4;function GPe(n){return GF(n.type)||n.type==="spring"||!ree(n.ease)}function HPe(n,e){const i=new rj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<zPe;)a=i.sample(d),l.push(a.value),d+=Ok;return{times:void 0,keyframes:l,duration:d-Ok,ease:"linear"}}const Fee={anticipate:gee,backInOut:mee,circInOut:yee};function $Pe(n){return n in Fee}class pq extends Dee{constructor(e){super(e);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new Nee(d,(p,y)=>this.onKeyframesResolved(p,y),i,a,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:a=300,times:l,ease:d,type:p,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof d=="string"&&Ik()&&$Pe(d)&&(d=Fee[d]),GPe(this.options)){const{onComplete:A,onUpdate:N,motionValue:V,element:F,...B}=this.options,W=HPe(e,B);e=W.keyframes,e.length===1&&(e[1]=e[0]),a=W.duration,l=W.times,d=W.ease,p="keyframes"}const w=BPe(y.owner.current,v,e,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(JK(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:A}=this.options;y.set(I1(e,this.options,i)),A&&A(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:p,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Pp(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Pp(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Ap(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Ul;const{animation:a}=i;JK(a,e)}return Ul}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:a,duration:l,type:d,ease:p,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:A,element:N,...V}=this.options,F=new rj({...V,keyframes:a,duration:l,type:d,ease:p,times:y,isGenerator:!0}),B=Ap(this.time);b.setWithVelocity(F.sample(B-Ok).value,F.sample(B).value,Ok)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:p,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return WPe()&&a&&jPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&p!==0&&y!=="inertia"}}const KPe={type:"spring",stiffness:500,damping:25,restSpeed:10},qPe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),YPe={type:"keyframes",duration:.8},XPe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},JPe=(n,{keyframes:e})=>e.length>2?YPe:Hy.has(n)?n.startsWith("scale")?qPe(e[1]):KPe:XPe;function QPe({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:y,from:v,elapsed:b,...w}){return!!Object.keys(w).length}const ij=(n,e,i,a={},l,d)=>p=>{const y=zF(a,n)||{},v=y.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Ap(v);let w={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-b,onUpdate:N=>{e.set(N),y.onUpdate&&y.onUpdate(N)},onComplete:()=>{p(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:d?void 0:l};QPe(y)||(w={...w,...JPe(n,w)}),w.duration&&(w.duration=Ap(w.duration)),w.repeatDelay&&(w.repeatDelay=Ap(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let A=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(A=!0)),A&&!d&&e.get()!==void 0){const N=I1(w.keyframes,y);if(N!==void 0)return Zi.update(()=>{w.onUpdate(N),w.onComplete()}),new _Ae([])}return!d&&pq.supports(w)?new pq(w):new rj(w)};function ZPe({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function jee(n,e,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:y,...v}=e;a&&(p=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const A in v){const N=n.getValue(A,(d=n.latestValues[A])!==null&&d!==void 0?d:null),V=v[A];if(V===void 0||w&&ZPe(w,A))continue;const F={delay:i,...zF(p||{},A)};let B=!1;if(window.MotionHandoffAnimation){const J=uee(n);if(J){const $=window.MotionHandoffAnimation(J,A,Zi);$!==null&&(F.startTime=$,B=!0)}}MU(n,A),N.start(ij(A,N,V,n.shouldReduceMotion&&cee.has(A)?{type:!1}:F,n,B));const W=N.animation;W&&b.push(W)}return y&&Promise.all(b).then(()=>{Zi.update(()=>{y&&kAe(n,y)})}),b}function zU(n,e,i={}){var a;const l=R1(n,e,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const p=l?()=>Promise.all(jee(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:A,staggerDirection:N}=d;return eOe(n,e,w+b,A,N,i)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,w]=v==="beforeChildren"?[p,y]:[y,p];return b().then(()=>w())}else return Promise.all([p(),y(i.delay)])}function eOe(n,e,i=0,a=0,l=1,d){const p=[],y=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>y-b*a;return Array.from(n.variantChildren).sort(tOe).forEach((b,w)=>{b.notify("AnimationStart",e),p.push(zU(b,e,{...d,delay:i+v(w)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(p)}function tOe(n,e){return n.sortNodePosition(e)}function nOe(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(d=>zU(n,d,i));a=Promise.all(l)}else if(typeof e=="string")a=zU(n,e,i);else{const l=typeof e=="function"?R1(n,e,i.custom):e;a=Promise.all(jee(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}const rOe=kF.length;function Bee(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Bee(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<rOe;i++){const a=kF[i],l=n.props[a];(bC(l)||l===!1)&&(e[a]=l)}return e}const iOe=[...OF].reverse(),sOe=OF.length;function oOe(n){return e=>Promise.all(e.map(({animation:i,options:a})=>nOe(n,i,a)))}function aOe(n){let e=oOe(n),i=mq(),a=!0;const l=v=>(b,w)=>{var A;const N=R1(n,w,v==="exit"?(A=n.presenceContext)===null||A===void 0?void 0:A.custom:void 0);if(N){const{transition:V,transitionEnd:F,...B}=N;b={...b,...B,...F}}return b};function d(v){e=v(n)}function p(v){const{props:b}=n,w=Bee(n.parent)||{},A=[],N=new Set;let V={},F=1/0;for(let W=0;W<sOe;W++){const J=iOe[W],$=i[J],te=b[J]!==void 0?b[J]:w[J],ce=bC(te),oe=J===v?$.isActive:null;oe===!1&&(F=W);let _e=te===w[J]&&te!==b[J]&&ce;if(_e&&a&&n.manuallyAnimateOnMount&&(_e=!1),$.protectedKeys={...V},!$.isActive&&oe===null||!te&&!$.prevProp||w1(te)||typeof te=="boolean")continue;const ne=cOe($.prevProp,te);let ee=ne||J===v&&$.isActive&&!_e&&ce||W>F&&ce,Q=!1;const se=Array.isArray(te)?te:[te];let fe=se.reduce(l(J),{});oe===!1&&(fe={});const{prevResolvedValues:pe={}}=$,ue={...pe,...fe},Me=we=>{ee=!0,N.has(we)&&(Q=!0,N.delete(we)),$.needsAnimating[we]=!0;const Re=n.getValue(we);Re&&(Re.liveStyle=!1)};for(const we in ue){const Re=fe[we],ve=pe[we];if(V.hasOwnProperty(we))continue;let Ne=!1;DU(Re)&&DU(ve)?Ne=!eee(Re,ve):Ne=Re!==ve,Ne?Re!=null?Me(we):N.add(we):Re!==void 0&&N.has(we)?Me(we):$.protectedKeys[we]=!0}$.prevProp=te,$.prevResolvedValues=fe,$.isActive&&(V={...V,...fe}),a&&n.blockInitialAnimation&&(ee=!1),ee&&(!(_e&&ne)||Q)&&A.push(...se.map(we=>({animation:we,options:{type:J}})))}if(N.size){const W={};N.forEach(J=>{const $=n.getBaseTarget(J),te=n.getValue(J);te&&(te.liveStyle=!0),W[J]=$??null}),A.push({animation:W})}let B=!!A.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),a=!1,B?e(A):Promise.resolve()}function y(v,b){var w;if(i[v].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(N=>{var V;return(V=N.animationState)===null||V===void 0?void 0:V.setActive(v,b)}),i[v].isActive=b;const A=p(v);for(const N in i)i[N].protectedKeys={};return A}return{animateChanges:p,setActive:y,setAnimateFunction:d,getState:()=>i,reset:()=>{i=mq(),a=!0}}}function cOe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!eee(e,n):!1}function oy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function mq(){return{animate:oy(!0),whileInView:oy(),whileHover:oy(),whileTap:oy(),whileDrag:oy(),whileFocus:oy(),exit:oy()}}class Ng{constructor(e){this.isMounted=!1,this.node=e}update(){}}class lOe extends Ng{constructor(e){super(e),e.animationState||(e.animationState=aOe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();w1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let uOe=0;class dOe extends Ng{constructor(){super(...arguments),this.id=uOe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const hOe={animation:{Feature:lOe},exit:{Feature:dOe}};function RC(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function ZC(n){return{point:{x:n.pageX,y:n.pageY}}}const fOe=n=>e=>$F(e)&&n(e,ZC(e));function nC(n,e,i,a){return RC(n,e,fOe(i),a)}const gq=(n,e)=>Math.abs(n-e);function pOe(n,e){const i=gq(n.x,e.x),a=gq(n.y,e.y);return Math.sqrt(i**2+a**2)}class Wee{constructor(e,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const A=R2(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,V=pOe(A.offset,{x:0,y:0})>=3;if(!N&&!V)return;const{point:F}=A,{timestamp:B}=da;this.history.push({...F,timestamp:B});const{onStart:W,onMove:J}=this.handlers;N||(W&&W(this.lastMoveEvent,A),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,A)},this.handlePointerMove=(A,N)=>{this.lastMoveEvent=A,this.lastMoveEventInfo=C2(N,this.transformPagePoint),Zi.update(this.updatePoint,!0)},this.handlePointerUp=(A,N)=>{this.end();const{onEnd:V,onSessionEnd:F,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=R2(A.type==="pointercancel"?this.lastMoveEventInfo:C2(N,this.transformPagePoint),this.history);this.startEvent&&V&&V(A,W),F&&F(A,W)},!$F(e))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const p=ZC(e),y=C2(p,this.transformPagePoint),{point:v}=y,{timestamp:b}=da;this.history=[{...v,timestamp:b}];const{onSessionStart:w}=i;w&&w(e,R2(y,this.history)),this.removeListeners=QC(nC(this.contextWindow,"pointermove",this.handlePointerMove),nC(this.contextWindow,"pointerup",this.handlePointerUp),nC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Sg(this.updatePoint)}}function C2(n,e){return e?{point:e(n.point)}:n}function _q(n,e){return{x:n.x-e.x,y:n.y-e.y}}function R2({point:n},e){return{point:n,delta:_q(n,zee(e)),offset:_q(n,mOe(e)),velocity:gOe(e,.1)}}function mOe(n){return n[0]}function zee(n){return n[n.length-1]}function gOe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=zee(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Ap(e)));)i--;if(!a)return{x:0,y:0};const d=Pp(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Gee=1e-4,_Oe=1-Gee,yOe=1+Gee,Hee=.01,EOe=0-Hee,vOe=0+Hee;function Fl(n){return n.max-n.min}function SOe(n,e,i){return Math.abs(n-e)<=i}function yq(n,e,i,a=.5){n.origin=a,n.originPoint=ps(e.min,e.max,n.origin),n.scale=Fl(i)/Fl(e),n.translate=ps(i.min,i.max,n.origin)-n.originPoint,(n.scale>=_Oe&&n.scale<=yOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=EOe&&n.translate<=vOe||isNaN(n.translate))&&(n.translate=0)}function rC(n,e,i,a){yq(n.x,e.x,i.x,a?a.originX:void 0),yq(n.y,e.y,i.y,a?a.originY:void 0)}function Eq(n,e,i){n.min=i.min+e.min,n.max=n.min+Fl(e)}function bOe(n,e,i){Eq(n.x,e.x,i.x),Eq(n.y,e.y,i.y)}function vq(n,e,i){n.min=e.min-i.min,n.max=n.min+Fl(e)}function iC(n,e,i){vq(n.x,e.x,i.x),vq(n.y,e.y,i.y)}function TOe(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?ps(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?ps(i,n,a.max):Math.min(n,i)),n}function Sq(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function wOe(n,{top:e,left:i,bottom:a,right:l}){return{x:Sq(n.x,i,l),y:Sq(n.y,e,a)}}function bq(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function COe(n,e){return{x:bq(n.x,e.x),y:bq(n.y,e.y)}}function ROe(n,e){let i=.5;const a=Fl(n),l=Fl(e);return l>a?i=f0(e.min,e.max-a,n.min):a>l&&(i=f0(n.min,n.max-l,e.min)),Lp(0,1,i)}function IOe(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const GU=.35;function AOe(n=GU){return n===!1?n=0:n===!0&&(n=GU),{x:Tq(n,"left","right"),y:Tq(n,"top","bottom")}}function Tq(n,e,i){return{min:wq(n,e),max:wq(n,i)}}function wq(n,e){return typeof n=="number"?n:n[e]||0}const Cq=()=>({translate:0,scale:1,origin:0,originPoint:0}),US=()=>({x:Cq(),y:Cq()}),Rq=()=>({min:0,max:0}),zs=()=>({x:Rq(),y:Rq()});function Ou(n){return[n("x"),n("y")]}function $ee({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function POe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function OOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function I2(n){return n===void 0||n===1}function HU({scale:n,scaleX:e,scaleY:i}){return!I2(n)||!I2(e)||!I2(i)}function cy(n){return HU(n)||Kee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Kee(n){return Iq(n.x)||Iq(n.y)}function Iq(n){return n&&n!=="0%"}function kk(n,e,i){const a=n-i,l=e*a;return i+l}function Aq(n,e,i,a,l){return l!==void 0&&(n=kk(n,l,a)),kk(n,i,a)+e}function $U(n,e=0,i=1,a,l){n.min=Aq(n.min,e,i,a,l),n.max=Aq(n.max,e,i,a,l)}function qee(n,{x:e,y:i}){$U(n.x,e.translate,e.scale,e.originPoint),$U(n.y,i.translate,i.scale,i.originPoint)}const Pq=.999999999999,Oq=1.0000000000001;function kOe(n,e,i,a=!1){const l=i.length;if(!l)return;e.x=e.y=1;let d,p;for(let y=0;y<l;y++){d=i[y],p=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&FS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,qee(n,p)),a&&cy(d.latestValues)&&FS(n,d.latestValues))}e.x<Oq&&e.x>Pq&&(e.x=1),e.y<Oq&&e.y>Pq&&(e.y=1)}function VS(n,e){n.min=n.min+e,n.max=n.max+e}function kq(n,e,i,a,l=.5){const d=ps(n.min,n.max,l);$U(n,e,i,d,a)}function FS(n,e){kq(n.x,e.x,e.scaleX,e.scale,e.originX),kq(n.y,e.y,e.scaleY,e.scale,e.originY)}function Yee(n,e){return $ee(OOe(n.getBoundingClientRect(),e))}function NOe(n,e,i){const a=Yee(n,i),{scroll:l}=e;return l&&(VS(a.x,l.offset.x),VS(a.y,l.offset.y)),a}const Xee=({current:n})=>n?n.ownerDocument.defaultView:null,DOe=new WeakMap;class xOe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=zs(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:A}=this.getProps();A?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(ZC(w).point)},d=(w,A)=>{const{drag:N,dragPropagation:V,onDragStart:F}=this.getProps();if(N&&!V&&(this.openDragLock&&this.openDragLock(),this.openDragLock=RAe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ou(W=>{let J=this.getAxisMotionValue(W).get()||0;if(Xh.test(J)){const{projection:$}=this.visualElement;if($&&$.layout){const te=$.layout.layoutBox[W];te&&(J=Fl(te)*(parseFloat(J)/100))}}this.originPoint[W]=J}),F&&Zi.postRender(()=>F(w,A)),MU(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(w,A)=>{const{dragPropagation:N,dragDirectionLock:V,onDirectionLock:F,onDrag:B}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:W}=A;if(V&&this.currentDirection===null){this.currentDirection=LOe(W),this.currentDirection!==null&&F&&F(this.currentDirection);return}this.updateAxis("x",A.point,W),this.updateAxis("y",A.point,W),this.visualElement.render(),B&&B(w,A)},y=(w,A)=>this.stop(w,A),v=()=>Ou(w=>{var A;return this.getAnimationState(w)==="paused"&&((A=this.getAxisMotionValue(w).animation)===null||A===void 0?void 0:A.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Wee(e,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Xee(this.visualElement)})}stop(e,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Zi.postRender(()=>d(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:l}=this.getProps();if(!a||!SO(e,l,this.currentDirection))return;const d=this.getAxisMotionValue(e);let p=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(p=TOe(p,this.constraints[e],this.elastic[e])),d.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;i&&LS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=wOe(l.layoutBox,i):this.constraints=!1,this.elastic=AOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Ou(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=IOe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!LS(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=NOe(a,l.root,this.visualElement.getTransformPagePoint());let p=COe(l.layout.layoutBox,d);if(i){const y=i(POe(p));this.hasMutatedConstraints=!!y,y&&(p=$ee(y))}return p}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=Ou(w=>{if(!SO(w,i,this.currentDirection))return;let A=v&&v[w]||{};p&&(A={min:0,max:0});const N=l?200:1e6,V=l?40:1e7,F={type:"inertia",velocity:a?e[w]:0,bounceStiffness:N,bounceDamping:V,timeConstant:750,restDelta:1,restSpeed:10,...d,...A};return this.startAxisValueAnimation(w,F)});return Promise.all(b).then(y)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return MU(this.visualElement,e),a.start(ij(e,a,0,i,this.visualElement,!1))}stopAnimation(){Ou(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Ou(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){Ou(i=>{const{drag:a}=this.getProps();if(!SO(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:y}=l.layout.layoutBox[i];d.set(e[i]-ps(p,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!LS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Ou(p=>{const y=this.getAxisMotionValue(p);if(y&&this.constraints!==!1){const v=y.get();l[p]=ROe({min:v,max:v},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Ou(p=>{if(!SO(p,e,null))return;const y=this.getAxisMotionValue(p),{min:v,max:b}=this.constraints[p];y.set(ps(v,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;DOe.set(this.visualElement,this);const e=this.visualElement.current,i=nC(e,"pointerdown",v=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();LS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Zi.read(a);const p=RC(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Ou(w=>{const A=this.getAxisMotionValue(w);A&&(this.originPoint[w]+=v[w].translate,A.set(A.get()+v[w].translate))}),this.visualElement.render())});return()=>{p(),i(),d(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=GU,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:y}}}function SO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function LOe(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class MOe extends Ng{constructor(e){super(e),this.removeGroupControls=Ul,this.removeListeners=Ul,this.controls=new xOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ul}unmount(){this.removeGroupControls(),this.removeListeners()}}const Nq=n=>(e,i)=>{n&&Zi.postRender(()=>n(e,i))};class UOe extends Ng{constructor(){super(...arguments),this.removePointerDownListener=Ul}onPointerDown(e){this.session=new Wee(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Xee(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:Nq(e),onStart:Nq(i),onMove:a,onEnd:(d,p)=>{delete this.session,l&&Zi.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=nC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const tk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function Dq(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const pw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Mn.test(n))n=parseFloat(n);else return n;const i=Dq(n,e.target.x),a=Dq(n,e.target.y);return`${i}% ${a}%`}},VOe={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,l=bg.parse(n);if(l.length>5)return a;const d=bg.createTransformer(n),p=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,v=i.y.scale*e.y;l[0+p]/=y,l[1+p]/=v;const b=ps(y,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class FOe extends D.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=e;sAe(jOe),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),tk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,p=a.projection;return p&&(p.isPresent=d,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?p.promote():p.relegate()||Zi.postRender(()=>{const y=p.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),DF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Jee(n){const[e,i]=IF(),a=D.useContext(wF);return C.jsx(FOe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(BZ),isPresent:e,safeToRemove:i})}const jOe={borderRadius:{...pw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:pw,borderTopRightRadius:pw,borderBottomLeftRadius:pw,borderBottomRightRadius:pw,boxShadow:VOe};function BOe(n,e,i){const a=Ka(n)?n:wC(n);return a.start(ij("",a,e,i)),a.animation}function WOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const zOe=(n,e)=>n.depth-e.depth;class GOe{constructor(){this.children=[],this.isDirty=!1}add(e){KF(this.children,e),this.isDirty=!0}remove(e){qF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(zOe),this.isDirty=!1,this.children.forEach(e)}}function HOe(n,e){const i=Jh.now(),a=({timestamp:l})=>{const d=l-i;d>=e&&(Sg(a),n(d-e))};return Zi.read(a,!0),()=>Sg(a)}const Qee=["TopLeft","TopRight","BottomLeft","BottomRight"],$Oe=Qee.length,xq=n=>typeof n=="string"?parseFloat(n):n,Lq=n=>typeof n=="number"||Mn.test(n);function KOe(n,e,i,a,l,d){l?(n.opacity=ps(0,i.opacity!==void 0?i.opacity:1,qOe(a)),n.opacityExit=ps(e.opacity!==void 0?e.opacity:1,0,YOe(a))):d&&(n.opacity=ps(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let p=0;p<$Oe;p++){const y=`border${Qee[p]}Radius`;let v=Mq(e,y),b=Mq(i,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||Lq(v)===Lq(b)?(n[y]=Math.max(ps(xq(v),xq(b),a),0),(Xh.test(b)||Xh.test(v))&&(n[y]+="%")):n[y]=b}(e.rotate||i.rotate)&&(n.rotate=ps(e.rotate||0,i.rotate||0,a))}function Mq(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const qOe=Zee(0,.5,_ee),YOe=Zee(.5,.95,Ul);function Zee(n,e,i){return a=>a<n?0:a>e?1:i(f0(n,e,a))}function Uq(n,e){n.min=e.min,n.max=e.max}function Iu(n,e){Uq(n.x,e.x),Uq(n.y,e.y)}function Vq(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function Fq(n,e,i,a,l){return n-=e,n=kk(n,1/i,a),l!==void 0&&(n=kk(n,1/l,a)),n}function XOe(n,e=0,i=1,a=.5,l,d=n,p=n){if(Xh.test(e)&&(e=parseFloat(e),e=ps(p.min,p.max,e/100)-p.min),typeof e!="number")return;let y=ps(d.min,d.max,a);n===d&&(y-=e),n.min=Fq(n.min,e,i,y,l),n.max=Fq(n.max,e,i,y,l)}function jq(n,e,[i,a,l],d,p){XOe(n,e[i],e[a],e[l],e.scale,d,p)}const JOe=["x","scaleX","originX"],QOe=["y","scaleY","originY"];function Bq(n,e,i,a){jq(n.x,e,JOe,i?i.x:void 0,a?a.x:void 0),jq(n.y,e,QOe,i?i.y:void 0,a?a.y:void 0)}function Wq(n){return n.translate===0&&n.scale===1}function ete(n){return Wq(n.x)&&Wq(n.y)}function zq(n,e){return n.min===e.min&&n.max===e.max}function ZOe(n,e){return zq(n.x,e.x)&&zq(n.y,e.y)}function Gq(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function tte(n,e){return Gq(n.x,e.x)&&Gq(n.y,e.y)}function Hq(n){return Fl(n.x)/Fl(n.y)}function $q(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class eke{constructor(){this.members=[]}add(e){KF(this.members,e),e.scheduleRender()}remove(e){if(qF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function tke(n,e,i){let a="";const l=n.x.translate/e.x,d=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||d||p)&&(a=`translate3d(${l}px, ${d}px, ${p}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:w,rotateX:A,rotateY:N,skewX:V,skewY:F}=i;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),A&&(a+=`rotateX(${A}deg) `),N&&(a+=`rotateY(${N}deg) `),V&&(a+=`skewX(${V}deg) `),F&&(a+=`skewY(${F}deg) `)}const y=n.x.scale*e.x,v=n.y.scale*e.y;return(y!==1||v!==1)&&(a+=`scale(${y}, ${v})`),a||"none"}const ly={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Fw=typeof window<"u"&&window.MotionDebug!==void 0,A2=["","X","Y","Z"],nke={visibility:"hidden"},Kq=1e3;let rke=0;function P2(n,e,i,a){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),a&&(a[n]=0))}function nte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=uee(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Zi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&nte(a)}function rte({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(p={},y=e==null?void 0:e()){this.id=rke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Fw&&(ly.totalNodes=ly.resolvedTargetDeltas=ly.recalculatedProjection=0),this.nodes.forEach(oke),this.nodes.forEach(dke),this.nodes.forEach(hke),this.nodes.forEach(ake),Fw&&window.MotionDebug.record(ly)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new GOe)}addEventListener(p,y){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new YF),this.eventHandlers.get(p).add(y)}notifyListeners(p,...y){const v=this.eventHandlers.get(p);v&&v.notify(...y)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=WOe(p),this.instance=p;const{layoutId:v,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let A;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,A&&A(),A=HOe(N,250),tk.hasAnimatedSinceResize&&(tk.hasAnimatedSinceResize=!1,this.nodes.forEach(Yq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&w&&(v||b)&&this.addEventListener("didUpdate",({delta:A,hasLayoutChanged:N,hasRelativeTargetChanged:V,layout:F})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||w.getDefaultTransition()||_ke,{onLayoutAnimationStart:W,onLayoutAnimationComplete:J}=w.getProps(),$=!this.targetLayout||!tte(this.targetLayout,F)||V,te=!N&&V;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||te||N&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(A,te);const ce={...zF(B,"layout"),onPlay:W,onComplete:J};(w.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else N||Yq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=F})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Sg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(fke),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&nte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const A=this.path[w];A.shouldResetTransform=!0,A.updateScroll("snapshot"),A.options.layoutRoot&&A.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(qq);return}this.isUpdating||this.nodes.forEach(lke),this.isUpdating=!1,this.nodes.forEach(uke),this.nodes.forEach(ike),this.nodes.forEach(ske),this.clearAllSnapshots();const y=Jh.now();da.delta=Lp(0,1e3/60,y-da.timestamp),da.timestamp=y,da.isProcessing=!0,v2.update.process(da),v2.preRender.process(da),v2.render.process(da),da.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,DF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(cke),this.sharedNodes.forEach(pke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Zi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Zi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=zs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(y=!1),y){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!ete(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;p&&(y||cy(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return p&&(v=this.removeTransform(v)),yke(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:y}=this.options;if(!y)return zs();const v=y.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(Eke))){const{scroll:w}=this.root;w&&(VS(v.x,w.offset.x),VS(v.y,w.offset.y))}return v}removeElementScroll(p){var y;const v=zs();if(Iu(v,p),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:A,options:N}=w;w!==this.root&&A&&N.layoutScroll&&(A.wasRoot&&Iu(v,p),VS(v.x,A.offset.x),VS(v.y,A.offset.y))}return v}applyTransform(p,y=!1){const v=zs();Iu(v,p);for(let b=0;b<this.path.length;b++){const w=this.path[b];!y&&w.options.layoutScroll&&w.scroll&&w!==w.root&&FS(v,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),cy(w.latestValues)&&FS(v,w.latestValues)}return cy(this.latestValues)&&FS(v,this.latestValues),v}removeTransform(p){const y=zs();Iu(y,p);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!cy(b.latestValues))continue;HU(b.latestValues)&&b.updateSnapshot();const w=zs(),A=b.measurePageBox();Iu(w,A),Bq(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return cy(this.latestValues)&&Bq(y,this.latestValues),y}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==da.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:A,layoutId:N}=this.options;if(!(!this.layout||!(A||N))){if(this.resolvedRelativeTargetAt=da.timestamp,!this.targetDelta&&!this.relativeTarget){const V=this.getClosestProjectingParent();V&&V.layout&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zs(),this.relativeTargetOrigin=zs(),iC(this.relativeTargetOrigin,this.layout.layoutBox,V.layout.layoutBox),Iu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=zs(),this.targetWithTransforms=zs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),bOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Iu(this.target,this.layout.layoutBox),qee(this.target,this.targetDelta)):Iu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const V=this.getClosestProjectingParent();V&&!!V.resumingFrom==!!this.resumingFrom&&!V.options.layoutScroll&&V.target&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=zs(),this.relativeTargetOrigin=zs(),iC(this.relativeTargetOrigin,this.target,V.target),Iu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Fw&&ly.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||HU(this.parent.latestValues)||Kee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===da.timestamp&&(b=!1),b)return;const{layout:w,layoutId:A}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||A))return;Iu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,V=this.treeScale.y;kOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=zs());const{target:F}=y;if(!F){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(Vq(this.prevProjectionDelta.x,this.projectionDelta.x),Vq(this.prevProjectionDelta.y,this.projectionDelta.y)),rC(this.projectionDelta,this.layoutCorrected,F,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==V||!$q(this.projectionDelta.x,this.prevProjectionDelta.x)||!$q(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",F)),Fw&&ly.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=US(),this.projectionDelta=US(),this.projectionDeltaWithTransform=US()}setAnimationOrigin(p,y=!1){const v=this.snapshot,b=v?v.latestValues:{},w={...this.latestValues},A=US();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const N=zs(),V=v?v.source:void 0,F=this.layout?this.layout.source:void 0,B=V!==F,W=this.getStack(),J=!W||W.members.length<=1,$=!!(B&&!J&&this.options.crossfade===!0&&!this.path.some(gke));this.animationProgress=0;let te;this.mixTargetDelta=ce=>{const oe=ce/1e3;Xq(A.x,p.x,oe),Xq(A.y,p.y,oe),this.setTargetDelta(A),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(iC(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mke(this.relativeTarget,this.relativeTargetOrigin,N,oe),te&&ZOe(this.relativeTarget,te)&&(this.isProjectionDirty=!1),te||(te=zs()),Iu(te,this.relativeTarget)),B&&(this.animationValues=w,KOe(w,b,this.latestValues,oe,$,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=oe},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Sg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Zi.update(()=>{tk.hasAnimatedSinceResize=!0,this.currentAnimation=BOe(0,Kq,{...p,onUpdate:y=>{this.mixTargetDelta(y),p.onUpdate&&p.onUpdate(y)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Kq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:w}=p;if(!(!y||!v||!b)){if(this!==p&&this.layout&&b&&ite(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||zs();const A=Fl(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+A;const N=Fl(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}Iu(y,v),FS(y,w),rC(this.projectionDeltaWithTransform,this.layoutCorrected,y,w)}}registerSharedNode(p,y){this.sharedNodes.has(p)||this.sharedNodes.set(p,new eke),this.sharedNodes.get(p).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:y}=this.options;return y?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:y}=this.options;return y?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let y=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&P2("z",p,b,this.animationValues);for(let w=0;w<A2.length;w++)P2(`rotate${A2[w]}`,p,b,this.animationValues),P2(`skew${A2[w]}`,p,b,this.animationValues);p.render();for(const w in b)p.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);p.scheduleRender()}getProjectionStyles(p){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return nke;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=ZO(p==null?void 0:p.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const A=this.getLead();if(!this.projectionDelta||!this.layout||!A.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=ZO(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!cy(this.latestValues)&&(B.transform=w?w({},""):"none",this.hasProjected=!1),B}const N=A.animationValues||A.latestValues;this.applyTransformsToTarget(),b.transform=tke(this.projectionDeltaWithTransform,this.treeScale,N),w&&(b.transform=w(N,b.transform));const{x:V,y:F}=this.projectionDelta;b.transformOrigin=`${V.origin*100}% ${F.origin*100}% 0`,A.animationValues?b.opacity=A===this?(v=(y=N.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:b.opacity=A===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const B in Rk){if(N[B]===void 0)continue;const{correct:W,applyTo:J}=Rk[B],$=b.transform==="none"?N[B]:W(N[B],A);if(J){const te=J.length;for(let ce=0;ce<te;ce++)b[J[ce]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=A===this?ZO(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var y;return(y=p.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(qq),this.root.sharedNodes.clear()}}}function ike(n){n.updateLayout()}function ske(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,p=i.source!==n.layout.source;d==="size"?Ou(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],V=Fl(N);N.min=a[A].min,N.max=N.min+V}):ite(d,i.layoutBox,a)&&Ou(A=>{const N=p?i.measuredBox[A]:i.layoutBox[A],V=Fl(a[A]);N.max=N.min+V,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[A].max=n.relativeTarget[A].min+V)});const y=US();rC(y,a,i.layoutBox);const v=US();p?rC(v,n.applyTransform(l,!0),i.measuredBox):rC(v,a,i.layoutBox);const b=!ete(y);let w=!1;if(!n.resumeFrom){const A=n.getClosestProjectingParent();if(A&&!A.resumeFrom){const{snapshot:N,layout:V}=A;if(N&&V){const F=zs();iC(F,i.layoutBox,N.layoutBox);const B=zs();iC(B,a,V.layoutBox),tte(F,B)||(w=!0),A.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=F,n.relativeParent=A)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function oke(n){Fw&&ly.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function ake(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function cke(n){n.clearSnapshot()}function qq(n){n.clearMeasurements()}function lke(n){n.isLayoutDirty=!1}function uke(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function Yq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function dke(n){n.resolveTargetDelta()}function hke(n){n.calcProjection()}function fke(n){n.resetSkewAndRotation()}function pke(n){n.removeLeadSnapshot()}function Xq(n,e,i){n.translate=ps(e.translate,0,i),n.scale=ps(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function Jq(n,e,i,a){n.min=ps(e.min,i.min,a),n.max=ps(e.max,i.max,a)}function mke(n,e,i,a){Jq(n.x,e.x,i.x,a),Jq(n.y,e.y,i.y,a)}function gke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const _ke={duration:.45,ease:[.4,0,.1,1]},Qq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),Zq=Qq("applewebkit/")&&!Qq("chrome/")?Math.round:Ul;function eY(n){n.min=Zq(n.min),n.max=Zq(n.max)}function yke(n){eY(n.x),eY(n.y)}function ite(n,e,i){return n==="position"||n==="preserve-aspect"&&!SOe(Hq(e),Hq(i),.2)}function Eke(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const vke=rte({attachResizeListener:(n,e)=>RC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),O2={current:void 0},ste=rte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!O2.current){const n=new vke({});n.mount(window),n.setOptions({layoutScroll:!0}),O2.current=n}return O2.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Ske={pan:{Feature:UOe},drag:{Feature:MOe,ProjectionNode:ste,MeasureLayout:Jee}};function tY(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&Zi.postRender(()=>d(e,ZC(e)))}class bke extends Ng{mount(){const{current:e}=this.node;e&&(this.unmount=SAe(e,i=>(tY(this.node,i,"Start"),a=>tY(this.node,a,"End"))))}unmount(){}}class Tke extends Ng{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=QC(RC(this.node.current,"focus",()=>this.onFocus()),RC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function nY(n,e,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&Zi.postRender(()=>d(e,ZC(e)))}class wke extends Ng{mount(){const{current:e}=this.node;e&&(this.unmount=CAe(e,i=>(nY(this.node,i,"Start"),(a,{success:l})=>nY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const KU=new WeakMap,k2=new WeakMap,Cke=n=>{const e=KU.get(n.target);e&&e(n)},Rke=n=>{n.forEach(Cke)};function Ike({root:n,...e}){const i=n||document;k2.has(i)||k2.set(i,{});const a=k2.get(i),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(Rke,{root:n,...e})),a[l]}function Ake(n,e,i){const a=Ike(e);return KU.set(n,i),a.observe(n),()=>{KU.delete(n),a.unobserve(n)}}const Pke={some:0,all:1};class Oke extends Ng{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=e,p={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:Pke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:A}=this.node.getProps(),N=b?w:A;N&&N(v)};return Ake(this.node.current,p,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(kke(e,i))&&this.startObserver()}unmount(){}}function kke({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const Nke={inView:{Feature:Oke},tap:{Feature:wke},focus:{Feature:Tke},hover:{Feature:bke}},Dke={layout:{ProjectionNode:ste,MeasureLayout:Jee}},qU={current:null},ote={current:!1};function xke(){if(ote.current=!0,!!AF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>qU.current=n.matches;n.addListener(e),e()}else qU.current=!1}const Lke=[...kee,Ga,bg],Mke=n=>Lke.find(Oee(n)),rY=new WeakMap;function Uke(n,e,i){for(const a in e){const l=e[a],d=i[a];if(Ka(l))n.addValue(a,l);else if(Ka(d))n.addValue(a,wC(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const p=n.getValue(a);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(a);n.addValue(a,wC(p!==void 0?p:l,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const iY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Vke{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=tj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const V=Jh.now();this.renderScheduledAt<V&&(this.renderScheduledAt=V,Zi.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:w}=p;this.onUpdate=w,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!d,this.isControllingVariants=C1(i),this.isVariantNode=FZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:A,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const V in N){const F=N[V];v[V]!==void 0&&Ka(F)&&F.set(v[V],!1)}}mount(e){this.current=e,rY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),ote.current||xke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:qU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){rY.delete(this.current),this.projection&&this.projection.unmount(),Sg(this.notifyUpdate),Sg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=Hy.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&Zi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),d(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in p0){const i=p0[e];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):zs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<iY.length;a++){const l=iY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=e[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=Uke(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=wC(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){var a;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(a=this.getBaseTargetFromProps(this.props,e))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Aee(l)||Eee(l))?l=parseFloat(l):!Mke(l)&&bg.test(i)&&(l=Cee(e,i)),this.setBaseTarget(e,Ka(l)?l.get():l)),Ka(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const p=LF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!Ka(d)?d:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new YF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class ate extends Vke{constructor(){super(...arguments),this.KeyframeResolver=Nee}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ka(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Fke(n){return window.getComputedStyle(n)}class jke extends ate{constructor(){super(...arguments),this.type="html",this.renderInstance=qZ}readValueFromInstance(e,i){if(Hy.has(i)){const a=ej(i);return a&&a.default||0}else{const a=Fke(e),l=(HZ(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Yee(e,i)}build(e,i,a){VF(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return WF(e,i,a)}}class Bke extends ate{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=zs}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(Hy.has(i)){const a=ej(i);return a&&a.default||0}return i=YZ.has(i)?i:NF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return QZ(e,i,a)}build(e,i,a){FF(e,i,this.isSVGTag,a.transformTemplate)}renderInstance(e,i,a,l){XZ(e,i,a,l)}mount(e){this.isSVGTag=BF(e.tagName),super.mount(e)}}const Wke=(n,e)=>xF(n)?new Bke(e):new jke(e,{allowProjection:n!==D.Fragment}),zke=pAe({...hOe,...Nke,...Ske,...Dke},Wke),lf=PIe(zke),Gke=(n,e)=>n.find(i=>i.id===e);function sY(n,e){const i=cte(n,e),a=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:a}}function cte(n,e){for(const[i,a]of Object.entries(n))if(Gke(a,e))return i}function Hke(n){const e=n.includes("right"),i=n.includes("left");let a="center";return e&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function $ke(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:p}}var Kke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,qke=wZ(function(n){return Kke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),Yke=qke,Xke=function(e){return e!=="theme"},oY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?Yke:Xke},aY=function(e,i,a){var l;if(i){var d=i.shouldForwardProp;l=e.__emotion_forwardProp&&d?function(p){return e.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&a&&(l=e.__emotion_forwardProp),l},Jke=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return gF(i,a,l),PZ(function(){return _F(i,a,l)}),null},Qke=function n(e,i){var a=e.__emotion_real===e,l=a&&e.__emotion_base||e,d,p;i!==void 0&&(d=i.label,p=i.target);var y=aY(e,i,a),v=y||oY(l),b=!v("as");return function(){var w=arguments,A=a&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&A.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)A.push.apply(A,w);else{var N=w[0];A.push(N[0]);for(var V=w.length,F=1;F<V;F++)A.push(w[F],N[F])}var B=EF(function(W,J,$){var te=b&&W.as||l,ce="",oe=[],_e=W;if(W.theme==null){_e={};for(var ne in W)_e[ne]=W[ne];_e.theme=D.useContext(h0)}typeof W.className=="string"?ce=RZ(J.registered,oe,W.className):W.className!=null&&(ce=W.className+" ");var ee=v1(A.concat(oe),J.registered,_e);ce+=J.key+"-"+ee.name,p!==void 0&&(ce+=" "+p);var Q=b&&y===void 0?oY(te):v,se={};for(var fe in W)b&&fe==="as"||Q(fe)&&(se[fe]=W[fe]);return se.className=ce,$&&(se.ref=$),D.createElement(D.Fragment,null,D.createElement(Jke,{cache:J,serialized:ee,isStringTag:typeof te=="string"}),D.createElement(te,se))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=e.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=A,B.__emotion_forwardProp=y,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(W,J){var $=n(W,Oy({},i,J,{shouldForwardProp:aY(B,J,!0)}));return $.apply(void 0,A)},B}},Zke=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],YU=Qke.bind(null);Zke.forEach(function(n){YU[n]=YU(n)});const e1e=new Set([...Sve,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),t1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function n1e(n){return(t1e.has(n)||!e1e.has(n))&&n[0]!=="_"}const r1e=Yye(YU),i1e=({baseStyle:n})=>e=>{const{theme:i,css:a,__css:l,sx:d,...p}=e,[y]=iEe(p,Tve),v=il(n,e),b=Lye({},l,v,d1(y),d),w=rZ(b)(e.theme);return a?[w,a]:w};function N2(n,e){const{baseStyle:i,...a}=e??{};a.shouldForwardProp||(a.shouldForwardProp=n1e);const l=i1e({baseStyle:i}),d=r1e(n,a)(l);return D.forwardRef(function(v,b){const{children:w,...A}=v,{colorMode:N,forced:V}=b1(),F=V?N:void 0;return D.createElement(d,{ref:b,"data-theme":F,...A},w)})}function s1e(){const n=new Map;return new Proxy(N2,{apply(e,i,a){return N2(...a)},get(e,i){return n.has(i)||n.set(i,N2(i)),n.get(i)}})}const Nt=s1e(),o1e={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let a=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},lte=D.memo(n=>{const{id:e,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=o1e,toastSpacing:w="0.5rem"}=n,[A,N]=D.useState(y),V=vIe();vg(()=>{V||a==null||a()},[V]),vg(()=>{N(y)},[y]);const F=()=>N(null),B=()=>N(y),W=()=>{V&&l()};D.useEffect(()=>{V&&d&&l()},[V,d,l]),CEe(W,A);const J=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...v}),[v,w]),$=D.useMemo(()=>Hke(p),[p]);return C.jsx(lf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:F,onHoverEnd:B,custom:{position:p},style:$,children:C.jsx(Nt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:il(i,{id:e,onClose:W})})})});lte.displayName="ToastComponent";function Wt(n){return D.forwardRef(n)}var D2,cY;function a1e(){if(cY)return D2;cY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var y,v,b;if(Array.isArray(d)){if(y=d.length,y!=p.length)return!1;for(v=y;v--!==0;)if(!l(d[v],p[v]))return!1;return!0}var w;if(e&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;for(w=d.entries();!(v=w.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(i&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(w=d.entries();!(v=w.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(y=d.length,y!=p.length)return!1;for(v=y;v--!==0;)if(d[v]!==p[v])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),y=b.length,y!==Object.keys(p).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],p[b[v]]))return!1;return!0}return d!==d&&p!==p}return D2=function(p,y){try{return l(p,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},D2}var c1e=a1e();const l1e=Gy(c1e);function V0(){const n=D.useContext(h0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function ute(){const n=b1(),e=V0();return{...n,theme:e}}function u1e(n,e,i){if(e==null)return e;const a=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return a(e)??a(i)??i}function d1e(n,e,i){const a=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return d=>{const p=l.filter(Boolean),y=a.map((v,b)=>{const w=`${n}.${v}`;return u1e(d,w,p[b]??v)});return Array.isArray(e)?y:y[0]}}function dte(n,e={}){const{styleConfig:i,...a}=e,{theme:l,colorMode:d}=ute(),p=n?jQ(l,`components.${n}`):void 0,y=i||p,v=Gh({theme:l,colorMode:d},(y==null?void 0:y.defaultProps)??{},d1(D0(a,["children"])),(w,A)=>w?void 0:A),b=D.useRef({});if(y){const A=xve(y)(v);l1e(b.current,A)||(b.current=A)}return b.current}function Wl(n,e={}){return dte(n,e)}function vc(n,e={}){return dte(n,e)}const lY={path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},xn=Wt((n,e)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:p,className:y,__css:v,...b}=n,w=dn("chakra-icon",y),A=Wl("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...A},V={ref:e,focusable:d,className:w,__css:N},F=a??lY.viewBox;if(i&&typeof i!="string")return C.jsx(Nt.svg,{as:i,...V,...b});const B=p??lY.path;return C.jsx(Nt.svg,{verticalAlign:"middle",viewBox:F,...V,...b,children:B})});xn.displayName="Icon";function h1e(n){return C.jsx(xn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function f1e(n){return C.jsx(xn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function uY(n){return C.jsx(xn,{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const p1e=qC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),uf=Wt((n,e)=>{const i=Wl("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:y,...v}=Bi(n),b=dn("chakra-spinner",y),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${p1e} ${d} linear infinite`,...i};return C.jsx(Nt.div,{ref:e,__css:w,className:b,...v,children:a&&C.jsx(Nt.span,{srOnly:!0,children:a})})});uf.displayName="Spinner";const[m1e,sj]=Fi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[g1e,oj]=Fi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),hte={info:{icon:f1e,colorScheme:"blue"},warning:{icon:uY,colorScheme:"orange"},success:{icon:h1e,colorScheme:"green"},error:{icon:uY,colorScheme:"red"},loading:{icon:uf,colorScheme:"blue"}};function _1e(n){return hte[n].colorScheme}function y1e(n){return hte[n].icon}const Ep=Wt(function(e,i){const{status:a="info",addRole:l=!0,...d}=Bi(e),p=e.colorScheme??_1e(a),y=vc("Alert",{...e,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return C.jsx(m1e,{value:{status:a},children:C.jsx(g1e,{value:y,children:C.jsx(Nt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:dn("chakra-alert",e.className),__css:v})})})});Ep.displayName="Alert";function vp(n){const{status:e}=sj(),i=y1e(e),a=oj(),l=e==="loading"?a.spinner:a.icon;return C.jsx(Nt.span,{display:"inherit","data-status":e,...n,className:dn("chakra-alert__icon",n.className),__css:l,children:n.children||C.jsx(i,{h:"100%",w:"100%"})})}vp.displayName="AlertIcon";const jS=Wt(function(e,i){const a=oj(),{status:l}=sj();return C.jsx(Nt.div,{ref:i,"data-status":l,...e,className:dn("chakra-alert__title",e.className),__css:a.title})});jS.displayName="AlertTitle";const BS=Wt(function(e,i){const{status:a}=sj(),l=oj(),d={display:"inline",...l.description};return C.jsx(Nt.div,{ref:i,"data-status":a,...e,className:dn("chakra-alert__desc",e.className),__css:d})});BS.displayName="AlertDescription";function E1e(n){return C.jsx(xn,{focusable:"false","aria-hidden":!0,...n,children:C.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const aj=Wt(function(e,i){const a=Wl("CloseButton",e),{children:l,isDisabled:d,__css:p,...y}=Bi(e),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return C.jsx(Nt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...v,...a,...p},...y,children:l||C.jsx(E1e,{width:"1em",height:"1em"})})});aj.displayName="CloseButton";const v1e=n=>{const{status:e,variant:i="solid",id:a,title:l,isClosable:d,onClose:p,description:y,colorScheme:v,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return C.jsxs(Ep,{addRole:!1,status:e,variant:i,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[C.jsx(vp,{children:b}),C.jsxs(Nt.div,{flex:"1",maxWidth:"100%",children:[l&&C.jsx(jS,{id:w==null?void 0:w.title,children:l}),y&&C.jsx(BS,{id:w==null?void 0:w.description,display:"block",children:y})]}),d&&C.jsx(aj,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function fte(n={}){const{render:e,toastComponent:i=v1e}=n;return l=>typeof e=="function"?e({...l,...n}):C.jsx(i,{...l,...n})}const S1e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Bh=b1e(S1e);function b1e(n){let e=n;const i=new Set,a=l=>{e=l(e),i.forEach(d=>d())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(p=>({...p,[d]:p[d].filter(y=>y.id!=l)}))},notify:(l,d)=>{const p=T1e(l,d),{position:y,id:v}=p;return a(b=>{const A=y.includes("top")?[p,...b[y]??[]]:[...b[y]??[],p];return{...b,[y]:A}}),v},update:(l,d)=>{l&&a(p=>{const y={...p},{position:v,index:b}=sY(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...d,message:fte(d)}),y})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(w=>({...w,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const p=cte(d,l);return p?{...d,[p]:d[p].map(y=>y.id==l?{...y,requestClose:!0}:y)}:d})},isActive:l=>!!sY(Bh.getState(),l).position}}let dY=0;function T1e(n,e={}){dY+=1;const i=e.id??dY,a=e.position??"bottom";return{id:i,message:n,position:a,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>Bh.removeToast(String(i),a),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var pte=kQ();const[mte,w1e]=Fi({strict:!1,name:"PortalContext"}),cj="chakra-portal",C1e=".chakra-portal",R1e=n=>C.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),I1e=n=>{const{appendToParentPortal:e,children:i}=n,[a,l]=D.useState(null),d=D.useRef(null),[,p]=D.useState({});D.useEffect(()=>p({}),[]);const y=w1e(),v=fIe();Rp(()=>{if(!a)return;const w=a.ownerDocument,A=e?y??w.body:w.body;if(!A)return;d.current=w.createElement("div"),d.current.className=cj,A.appendChild(d.current),p({});const N=d.current;return()=>{A.contains(N)&&A.removeChild(N)}},[a]);const b=v!=null&&v.zIndex?C.jsx(R1e,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return d.current?pte.createPortal(C.jsx(mte,{value:d.current,children:b}),d.current):C.jsx("span",{ref:w=>{w&&l(w)}})},A1e=n=>{const{children:e,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),p=D.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=cj),v},[l]),[,y]=D.useState({});return Rp(()=>y({}),[]),Rp(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?pte.createPortal(C.jsx(mte,{value:a?p:null,children:e}),p):null};function zl(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...a}=e;return i?C.jsx(A1e,{containerRef:i,...a}):C.jsx(I1e,{...a})}zl.className=cj;zl.selector=C1e;zl.displayName="Portal";const[P1e,O1e]=Fi({name:"ToastOptionsContext",strict:!1}),k1e=n=>{const e=D.useSyncExternalStore(Bh.subscribe,Bh.getState,Bh.getState),{motionVariants:i,component:a=lte,portalProps:l,animatePresenceProps:d}=n,y=Object.keys(e).map(v=>{const b=e[v];return C.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:$ke(v),children:C.jsx(L0,{...d,initial:!1,children:b.map(w=>C.jsx(a,{motionVariants:i,...w},w.id))})},v)});return C.jsx(zl,{...l,children:y})},N1e=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return C.jsxs(mIe,{theme:a,...d,children:[C.jsx(P1e,{value:l==null?void 0:l.defaultOptions,children:i}),C.jsx(k1e,{...l})]})},A1=N1e(oRe);function hY(n){return n.sort((e,i)=>{const a=e.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const D1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function fY(n,e,i){let a=n+1;return i&&a>=e&&(a=0),a}function pY(n,e,i){let a=n-1;return i&&a<0&&(a=e),a}const x2=typeof window<"u"?D.useLayoutEffect:D.useEffect,mY=n=>n;var x1e=Object.defineProperty,L1e=(n,e,i)=>e in n?x1e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Ns=(n,e,i)=>(L1e(n,typeof e!="symbol"?e+"":e,i),i);class M1e{constructor(){Ns(this,"descendants",new Map),Ns(this,"register",e=>{if(e!=null)return D1e(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Ns(this,"unregister",e=>{this.descendants.delete(e);const i=hY(Array.from(this.descendants.keys()));this.assignIndex(i)}),Ns(this,"destroy",()=>{this.descendants.clear()}),Ns(this,"assignIndex",e=>{this.descendants.forEach(i=>{const a=e.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Ns(this,"count",()=>this.descendants.size),Ns(this,"enabledCount",()=>this.enabledValues().length),Ns(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Ns(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Ns(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Ns(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Ns(this,"first",()=>this.item(0)),Ns(this,"firstEnabled",()=>this.enabledItem(0)),Ns(this,"last",()=>this.item(this.descendants.size-1)),Ns(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Ns(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Ns(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Ns(this,"next",(e,i=!0)=>{const a=fY(e,this.count(),i);return this.item(a)}),Ns(this,"nextEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=fY(l,this.enabledCount(),i);return this.enabledItem(d)}),Ns(this,"prev",(e,i=!0)=>{const a=pY(e,this.count()-1,i);return this.item(a)}),Ns(this,"prevEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=pY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),Ns(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const a=Array.from(this.descendants.keys()).concat(e),l=hY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:e,index:-1,...i};this.descendants.set(e,d),this.assignIndex(l)})}}function gte(){const[n,e]=Fi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=D.useRef(new M1e);return x2(()=>()=>l.current.destroy()),l.current},l=>{const d=e(),[p,y]=D.useState(-1),v=D.useRef(null);x2(()=>()=>{v.current&&d.unregister(v.current)},[]),x2(()=>{if(!v.current)return;const w=Number(v.current.dataset.index);p!=w&&!Number.isNaN(w)&&y(w)});const b=mY(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(v.current),register:os(b,v)}}]}const gY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},wy={enter:{duration:.2,ease:gY.easeOut},exit:{duration:.1,ease:gY.easeIn}},Cy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},_te=Wt(function(n,e){const{ratio:i=4/3,children:a,className:l,...d}=n,p=D.Children.only(a),y=dn("chakra-aspect-ratio",l);return C.jsx(Nt.div,{ref:e,position:"relative",className:y,_before:{height:0,content:'""',display:"block",paddingBottom:h1(i,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});_te.displayName="AspectRatio";const[U1e,V1e]=Fi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function F1e(n){const e=n.trim().split(" "),i=e[0]??"",a=e.length>1?e[e.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function yte(n){const{name:e,getInitials:i,...a}=n,l=V1e();return C.jsx(Nt.div,{role:"img","aria-label":e,...a,__css:l.label,children:e?i==null?void 0:i(e):null})}yte.displayName="AvatarName";const Ete=n=>C.jsxs(Nt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[C.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),C.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function vte(n){const{loading:e,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:p,sizes:y,ignoreFallback:v}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(i?"loading":"pending")},[i]);const A=D.useRef(null),N=D.useCallback(()=>{if(!i)return;V();const F=new Image;F.src=i,p&&(F.crossOrigin=p),a&&(F.srcset=a),y&&(F.sizes=y),e&&(F.loading=e),F.onload=B=>{V(),w("loaded"),l==null||l(B)},F.onerror=B=>{V(),w("failed"),d==null||d(B)},A.current=F},[i,p,a,y,l,d,e]),V=()=>{A.current&&(A.current.onload=null,A.current.onerror=null,A.current=null)};return Rp(()=>{if(!v)return b==="loading"&&N(),()=>{V()}},[b,N,v]),v?"loaded":b}const j1e=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Ste(n){const{src:e,srcSet:i,onError:a,onLoad:l,getInitials:d,name:p,borderRadius:y,loading:v,iconLabel:b,icon:w=C.jsx(Ete,{}),ignoreFallback:A,referrerPolicy:N,crossOrigin:V}=n,B=vte({src:e,onError:a,crossOrigin:V,ignoreFallback:A})==="loaded";return!e||!B?p?C.jsx(yte,{className:"chakra-avatar__initials",getInitials:d,name:p}):D.cloneElement(w,{role:"img","aria-label":b}):C.jsx(Nt.img,{src:e,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:N,crossOrigin:V??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}Ste.displayName="AvatarImage";const B1e={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},jl=Wt((n,e)=>{const i=vc("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:p,name:y,showBorder:v,borderRadius:b="full",onError:w,onLoad:A,getInitials:N=F1e,icon:V=C.jsx(Ete,{}),iconLabel:F=" avatar",loading:B,children:W,borderColor:J,ignoreFallback:$,crossOrigin:te,referrerPolicy:ce,...oe}=Bi(n),_e={borderRadius:b,borderWidth:v?"2px":void 0,...B1e,...i.container};return J&&(_e.borderColor=J),C.jsx(Nt.span,{ref:e,...oe,className:dn("chakra-avatar",n.className),"data-loaded":Xn(a),__css:_e,children:C.jsxs(U1e,{value:i,children:[C.jsx(Ste,{src:d,srcSet:p,loading:B,onLoad:er(A,()=>{l(!0)}),onError:w,getInitials:N,name:y,borderRadius:b,icon:V,iconLabel:F,ignoreFallback:$,crossOrigin:te,referrerPolicy:ce}),W]})})});jl.displayName="Avatar";const Sp=Wt(function(e,i){const a=Wl("Badge",e),{className:l,...d}=Bi(e);return C.jsx(Nt.span,{ref:i,className:dn("chakra-badge",e.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Sp.displayName="Badge";const mt=Nt("div");mt.displayName="Box";const[vze,W1e]=Fi({strict:!1,name:"ButtonGroupContext"});function jw(n){const{children:e,className:i,...a}=n,l=D.isValidElement(e)?D.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,d=dn("chakra-button__icon",i);return C.jsx(Nt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}jw.displayName="ButtonIcon";function XU(n){const{label:e,placement:i,spacing:a="0.5rem",children:l=C.jsx(uf,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,...y}=n,v=dn("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?a:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,b,a]);return C.jsx(Nt.div,{className:v,...y,__css:w,children:l})}XU.displayName="ButtonSpinner";function z1e(n){const[e,i]=D.useState(!n);return{ref:D.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Br=Wt((n,e)=>{const i=W1e(),a=Wl("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:p,children:y,leftIcon:v,rightIcon:b,loadingText:w,iconSpacing:A="0.5rem",type:N,spinner:V,spinnerPlacement:F="start",className:B,as:W,shouldWrapChildren:J,...$}=Bi(n),te=D.useMemo(()=>{const ne={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:ne}}},[a,i]),{ref:ce,type:oe}=z1e(W),_e={rightIcon:b,leftIcon:v,iconSpacing:A,children:y,shouldWrapChildren:J};return C.jsxs(Nt.button,{disabled:l||d,ref:wEe(e,ce),as:W,type:N??oe,"data-active":Xn(p),"data-loading":Xn(d),__css:te,className:dn("chakra-button",B),...$,children:[d&&F==="start"&&C.jsx(XU,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:A,children:V}),d?w||C.jsx(Nt.span,{opacity:0,children:C.jsx(_Y,{..._e})}):C.jsx(_Y,{..._e}),d&&F==="end"&&C.jsx(XU,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:A,children:V})]})});Br.displayName="Button";function _Y(n){const{leftIcon:e,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?C.jsxs("span",{style:{display:"contents"},children:[e&&C.jsx(jw,{marginEnd:l,children:e}),a,i&&C.jsx(jw,{marginStart:l,children:i})]}):C.jsxs(C.Fragment,{children:[e&&C.jsx(jw,{marginEnd:l,children:e}),a,i&&C.jsx(jw,{marginStart:l,children:i})]})}const xo=Wt((n,e)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...p}=n,y=i||a,v=D.isValidElement(y)?D.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return C.jsx(Br,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":d,...p,children:v})});xo.displayName="IconButton";const bte=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});bte.displayName="Center";const G1e={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Wt(function(e,i){const{axis:a="both",...l}=e;return C.jsx(Nt.div,{ref:i,__css:G1e[a],...l,position:"absolute"})});var H1e=()=>typeof document<"u",yY=!1,eR=null,ky=!1,JU=!1,QU=new Set;function lj(n,e){QU.forEach(i=>i(n,e))}var $1e=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function K1e(n){return!(n.metaKey||!$1e&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function EY(n){ky=!0,K1e(n)&&(eR="keyboard",lj("keyboard",n))}function gS(n){if(eR="pointer",n.type==="mousedown"||n.type==="pointerdown"){ky=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;lj("pointer",n)}}function q1e(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function Y1e(n){q1e(n)&&(ky=!0,eR="virtual")}function X1e(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!ky&&!JU&&(eR="virtual",lj("virtual",n)),ky=!1,JU=!1)}function J1e(){ky=!1,JU=!0}function vY(){return eR!=="pointer"}function Q1e(){if(!H1e()||yY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){ky=!0,n.apply(this,i)},document.addEventListener("keydown",EY,!0),document.addEventListener("keyup",EY,!0),document.addEventListener("click",Y1e,!0),window.addEventListener("focus",X1e,!0),window.addEventListener("blur",J1e,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",gS,!0),document.addEventListener("pointermove",gS,!0),document.addEventListener("pointerup",gS,!0)):(document.addEventListener("mousedown",gS,!0),document.addEventListener("mousemove",gS,!0),document.addEventListener("mouseup",gS,!0)),yY=!0}function Z1e(n){Q1e(),n(vY());const e=()=>n(vY());return QU.add(e),()=>{QU.delete(e)}}const[eNe,Tte]=Fi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[tNe,F0]=Fi({strict:!1,name:"FormControlContext"});function nNe(n){const{id:e,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...p}=n,y=D.useId(),v=e||`field-${y}`,b=`${v}-label`,w=`${v}-feedback`,A=`${v}-helptext`,[N,V]=D.useState(!1),[F,B]=D.useState(!1),[W,J]=D.useState(!1),$=D.useCallback((ne={},ee=null)=>({id:A,...ne,ref:os(ee,Q=>{Q&&B(!0)})}),[A]),te=D.useCallback((ne={},ee=null)=>({...ne,ref:ee,"data-focus":Xn(W),"data-disabled":Xn(l),"data-invalid":Xn(a),"data-readonly":Xn(d),id:ne.id!==void 0?ne.id:b,htmlFor:ne.htmlFor!==void 0?ne.htmlFor:v}),[v,l,W,a,d,b]),ce=D.useCallback((ne={},ee=null)=>({id:w,...ne,ref:os(ee,Q=>{Q&&V(!0)}),"aria-live":"polite"}),[w]),oe=D.useCallback((ne={},ee=null)=>({...ne,...p,ref:ee,role:"group","data-focus":Xn(W),"data-disabled":Xn(l),"data-invalid":Xn(a),"data-readonly":Xn(d)}),[p,l,W,a,d]),_e=D.useCallback((ne={},ee=null)=>({...ne,ref:ee,role:"presentation","aria-hidden":!0,children:ne.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!W,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:N,setHasFeedbackText:V,hasHelpText:F,setHasHelpText:B,id:v,labelId:b,feedbackId:w,helpTextId:A,htmlProps:p,getHelpTextProps:$,getErrorMessageProps:ce,getRootProps:oe,getLabelProps:te,getRequiredIndicatorProps:_e}}const $r=Wt(function(e,i){const a=vc("Form",e),l=Bi(e),{getRootProps:d,htmlProps:p,...y}=nNe(l),v=dn("chakra-form-control",e.className);return C.jsx(tNe,{value:y,children:C.jsx(eNe,{value:a,children:C.jsx(Nt.div,{...d({},i),className:v,__css:a.container})})})});$r.displayName="FormControl";const ZU=Wt(function(e,i){const a=F0(),l=Tte(),d=dn("chakra-form__helper-text",e.className);return C.jsx(Nt.div,{...a==null?void 0:a.getHelpTextProps(e,i),__css:l.helperText,className:d})});ZU.displayName="FormHelperText";function uj(n){const{isDisabled:e,isInvalid:i,isReadOnly:a,isRequired:l,...d}=wte(n);return{...d,disabled:e,readOnly:a,required:l,"aria-invalid":GS(i),"aria-required":GS(l),"aria-readonly":GS(a)}}function wte(n){const e=F0(),{id:i,disabled:a,readOnly:l,required:d,isRequired:p,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:w,onBlur:A,...N}=n,V=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&V.push(e.feedbackId),e!=null&&e.hasHelpText&&V.push(e.helpTextId),{...N,"aria-describedby":V.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:a??b??(e==null?void 0:e.isDisabled),isReadOnly:l??v??(e==null?void 0:e.isReadOnly),isRequired:d??p??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:er(e==null?void 0:e.onFocus,w),onBlur:er(e==null?void 0:e.onBlur,A)}}const rNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function iNe(n={}){const e=wte(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:p,onBlur:y,onFocus:v,"aria-describedby":b}=e,{defaultChecked:w,isChecked:A,isFocusable:N,onChange:V,isIndeterminate:F,name:B,value:W,tabIndex:J=void 0,"aria-label":$,"aria-labelledby":te,"aria-invalid":ce,...oe}=n,_e=D0(oe,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),ne=sl(V),ee=sl(y),Q=sl(v),[se,fe]=D.useState(!1),[pe,ue]=D.useState(!1),[Me,He]=D.useState(!1),[nt,we]=D.useState(!1);D.useEffect(()=>Z1e(fe),[]);const Re=D.useRef(null),[ve,Ne]=D.useState(!0),[Te,be]=D.useState(!!w),Ae=A!==void 0,Ue=Ae?A:Te,Ge=D.useCallback(Kt=>{if(a||i){Kt.preventDefault();return}Ae||be(Ue?Kt.currentTarget.checked:F?!0:Kt.currentTarget.checked),ne==null||ne(Kt)},[a,i,Ue,Ae,F,ne]);Rp(()=>{Re.current&&(Re.current.indeterminate=!!F)},[F]),vg(()=>{i&&ue(!1)},[i,ue]),Rp(()=>{const Kt=Re.current;if(!(Kt!=null&&Kt.form))return;const zn=()=>{be(!!w)};return Kt.form.addEventListener("reset",zn),()=>{var Bt;return(Bt=Kt.form)==null?void 0:Bt.removeEventListener("reset",zn)}},[]);const Qe=i&&!N,tt=D.useCallback(Kt=>{Kt.key===" "&&we(!0)},[we]),ht=D.useCallback(Kt=>{Kt.key===" "&&we(!1)},[we]);Rp(()=>{if(!Re.current)return;Re.current.checked!==Ue&&be(Re.current.checked)},[Re.current]);const Ze=D.useCallback((Kt={},zn=null)=>{const Bt=Ce=>{pe&&Ce.preventDefault(),we(!0)};return{...Kt,ref:zn,"data-active":Xn(nt),"data-hover":Xn(Me),"data-checked":Xn(Ue),"data-focus":Xn(pe),"data-focus-visible":Xn(pe&&se),"data-indeterminate":Xn(F),"data-disabled":Xn(i),"data-invalid":Xn(d),"data-readonly":Xn(a),"aria-hidden":!0,onMouseDown:er(Kt.onMouseDown,Bt),onMouseUp:er(Kt.onMouseUp,()=>we(!1)),onMouseEnter:er(Kt.onMouseEnter,()=>He(!0)),onMouseLeave:er(Kt.onMouseLeave,()=>He(!1))}},[nt,Ue,i,pe,se,Me,F,d,a]),Ct=D.useCallback((Kt={},zn=null)=>({...Kt,ref:zn,"data-active":Xn(nt),"data-hover":Xn(Me),"data-checked":Xn(Ue),"data-focus":Xn(pe),"data-focus-visible":Xn(pe&&se),"data-indeterminate":Xn(F),"data-disabled":Xn(i),"data-invalid":Xn(d),"data-readonly":Xn(a)}),[nt,Ue,i,pe,se,Me,F,d,a]),un=D.useCallback((Kt={},zn=null)=>({..._e,htmlFor:ve?p:void 0,...Kt,ref:os(zn,Bt=>{Bt&&Ne(Bt.tagName==="LABEL")}),onClick:er(Kt.onClick,()=>{var Bt;ve||((Bt=Re.current)==null||Bt.click(),requestAnimationFrame(()=>{var Ce;(Ce=Re.current)==null||Ce.focus({preventScroll:!0})}))}),"data-disabled":Xn(i),"data-checked":Xn(Ue),"data-invalid":Xn(d)}),[_e,i,Ue,d,ve,p]),Lt=D.useCallback((Kt={},zn=null)=>({...Kt,ref:os(Re,zn),type:"checkbox",name:B,value:W,id:p,tabIndex:J,onChange:er(Kt.onChange,Ge),onBlur:er(Kt.onBlur,ee,()=>ue(!1)),onFocus:er(Kt.onFocus,Q,()=>ue(!0)),onKeyDown:er(Kt.onKeyDown,tt),onKeyUp:er(Kt.onKeyUp,ht),required:l,checked:Ue,disabled:Qe,readOnly:a,"aria-label":$,"aria-labelledby":te,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":F?"mixed":Ue,style:rNe}),[B,W,p,J,Ge,ee,Q,tt,ht,l,Ue,Qe,a,$,te,ce,d,b,i,F]),nn=D.useCallback((Kt={},zn=null)=>({...Kt,ref:zn,onMouseDown:er(Kt.onMouseDown,sNe),"data-disabled":Xn(i),"data-checked":Xn(Ue),"data-invalid":Xn(d)}),[Ue,i,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:Ue,isActive:nt,isHovered:Me,isIndeterminate:F,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:un,getCheckboxProps:Ze,getIndicatorProps:Ct,getInputProps:Lt,getLabelProps:nn,htmlProps:_e}}function sNe(n){n.preventDefault(),n.stopPropagation()}const eV=Wt(function(e,i){const{className:a,centerContent:l,...d}=Bi(e),p=Wl("Container",e);return C.jsx(Nt.div,{ref:i,className:dn("chakra-container",a),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});eV.displayName="Container";const Qh=Wt(function(e,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:y,borderStyle:v,borderColor:b,...w}=Wl("Divider",e),{className:A,orientation:N="horizontal",__css:V,...F}=Bi(e),B={vertical:{borderLeftWidth:a||p||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||y||"1px",width:"100%"}};return C.jsx(Nt.hr,{ref:i,"aria-orientation":N,...F,__css:{...w,border:"0",borderColor:b,borderStyle:v,...B[N],...V},className:dn("chakra-divider",A)})});Qh.displayName="Divider";const ei=Wt(function(e,i){const{direction:a,align:l,justify:d,wrap:p,basis:y,grow:v,shrink:b,...w}=e,A={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:y,flexGrow:v,flexShrink:b};return C.jsx(Nt.div,{ref:i,__css:A,...w})});ei.displayName="Flex";function oNe(n,e){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(e.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var L2={exports:{}},M2,SY;function aNe(){if(SY)return M2;SY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return M2=n,M2}var U2,bY;function cNe(){if(bY)return U2;bY=1;var n=aNe();function e(){}function i(){}return i.resetWarningCache=e,U2=function(){function a(p,y,v,b,w,A){if(A!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return d.PropTypes=d,d},U2}var TY;function lNe(){return TY||(TY=1,L2.exports=cNe()()),L2.exports}var uNe=lNe();const _r=Gy(uNe);var tV="data-focus-lock",Cte="data-focus-lock-disabled",dNe="data-no-focus-lock",hNe="data-autofocus-inside",fNe="data-no-autofocus";function V2(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function pNe(n,e){var i=D.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=e,i.facade}var mNe=typeof window<"u"?D.useLayoutEffect:D.useEffect,wY=new WeakMap;function Rte(n,e){var i=pNe(null,function(a){return n.forEach(function(l){return V2(l,a)})});return mNe(function(){var a=wY.get(i);if(a){var l=new Set(a),d=new Set(n),p=i.current;l.forEach(function(y){d.has(y)||V2(y,null)}),d.forEach(function(y){l.has(y)||V2(y,p)})}wY.set(i,n)},[n]),i}var F2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Wh=function(){return Wh=Object.assign||function(e){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d])}return e},Wh.apply(this,arguments)};function tR(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function gNe(n,e,i){if(i||arguments.length===2)for(var a=0,l=e.length,d;a<l;a++)(d||!(a in e))&&(d||(d=Array.prototype.slice.call(e,0,a)),d[a]=e[a]);return n.concat(d||Array.prototype.slice.call(e))}function Ite(n){return n}function Ate(n,e){e===void 0&&(e=Ite);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var p=e(d,a);return i.push(p),function(){i=i.filter(function(y){return y!==p})}},assignSyncMedium:function(d){for(a=!0;i.length;){var p=i;i=[],p.forEach(d)}i={push:function(y){return d(y)},filter:function(){return i}}},assignMedium:function(d){a=!0;var p=[];if(i.length){var y=i;i=[],y.forEach(d),p=i}var v=function(){var w=p;p=[],w.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(w){p.push(w),b()},filter:function(w){return p=p.filter(w),i}}}};return l}function dj(n,e){return e===void 0&&(e=Ite),Ate(n,e)}function Pte(n){n===void 0&&(n={});var e=Ate(null);return e.options=Wh({async:!0,ssr:!1},n),e}var Ote=function(n){var e=n.sideCar,i=tR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,Wh({},i))};Ote.isSideCarExport=!0;function _Ne(n,e){return n.useMedium(e),Ote}var kte=dj({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Nte=dj(),yNe=dj(),ENe=Pte({async:!0,ssr:typeof document<"u"}),vNe=D.createContext(void 0),SNe=[],hj=D.forwardRef(function(e,i){var a,l=D.useState(),d=l[0],p=l[1],y=D.useRef(),v=D.useRef(!1),b=D.useRef(null),w=D.useState({}),A=w[1],N=e.children,V=e.disabled,F=V===void 0?!1:V,B=e.noFocusGuards,W=B===void 0?!1:B,J=e.persistentFocus,$=J===void 0?!1:J,te=e.crossFrame,ce=te===void 0?!0:te,oe=e.autoFocus,_e=oe===void 0?!0:oe;e.allowTextSelection;var ne=e.group,ee=e.className,Q=e.whiteList,se=e.hasPositiveIndices,fe=e.shards,pe=fe===void 0?SNe:fe,ue=e.as,Me=ue===void 0?"div":ue,He=e.lockProps,nt=He===void 0?{}:He,we=e.sideCar,Re=e.returnFocus,ve=Re===void 0?!1:Re,Ne=e.focusOptions,Te=e.onActivation,be=e.onDeactivation,Ae=D.useState({}),Ue=Ae[0],Ge=D.useCallback(function(zn){var Bt=zn.captureFocusRestore;if(!b.current){var Ce,Fe=(Ce=document)==null?void 0:Ce.activeElement;b.current=Fe,Fe!==document.body&&(b.current=Bt(Fe))}y.current&&Te&&Te(y.current),v.current=!0,A()},[Te]),Qe=D.useCallback(function(){v.current=!1,be&&be(y.current),A()},[be]),tt=D.useCallback(function(zn){var Bt=b.current;if(Bt){var Ce=(typeof Bt=="function"?Bt():Bt)||document.body,Fe=typeof ve=="function"?ve(Ce):ve;if(Fe){var We=typeof Fe=="object"?Fe:void 0;b.current=null,zn?Promise.resolve().then(function(){return Ce.focus(We)}):Ce.focus(We)}}},[ve]),ht=D.useCallback(function(zn){v.current&&kte.useMedium(zn)},[]),Ze=Nte.useMedium,Ct=D.useCallback(function(zn){y.current!==zn&&(y.current=zn,p(zn))},[]),un=Oy((a={},a[Cte]=F&&"disabled",a[tV]=ne,a),nt),Lt=W!==!0,nn=Lt&&W!=="tail",kn=Rte([i,Ct]),Kt=D.useMemo(function(){return{observed:y,shards:pe,enabled:!F,active:v.current}},[F,v.current,pe,d]);return ui.createElement(D.Fragment,null,Lt&&[ui.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:F?-1:0,style:F2}),se?ui.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:F?-1:1,style:F2}):null],!F&&ui.createElement(we,{id:Ue,sideCar:ENe,observed:d,disabled:F,persistentFocus:$,crossFrame:ce,autoFocus:_e,whiteList:Q,shards:pe,onActivation:Ge,onDeactivation:Qe,returnFocus:tt,focusOptions:Ne,noFocusGuards:W}),ui.createElement(Me,Oy({ref:kn},un,{className:ee,onBlur:Ze,onFocus:ht}),ui.createElement(vNe.Provider,{value:Kt},N)),nn&&ui.createElement("div",{"data-focus-guard":!0,tabIndex:F?-1:0,style:F2}))});hj.propTypes={};function nV(n,e){return nV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},nV(n,e)}function bNe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,nV(n,e)}function IC(n){"@babel/helpers - typeof";return IC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},IC(n)}function TNe(n,e){if(IC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(IC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function wNe(n){var e=TNe(n,"string");return IC(e)=="symbol"?e:e+""}function CNe(n,e,i){return(e=wNe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function RNe(n,e){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],p;function y(){p=n(d.map(function(b){return b.props})),e(p)}var v=function(b){bNe(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return p};var A=w.prototype;return A.componentDidMount=function(){d.push(this),y()},A.componentDidUpdate=function(){y()},A.componentWillUnmount=function(){var V=d.indexOf(this);d.splice(V,1),y()},A.render=function(){return ui.createElement(l,this.props)},w}(D.PureComponent);return CNe(v,"displayName","SideEffect("+i(l)+")"),v}}var df=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Ny=function(n){return Array.isArray(n)?n:[n]},Dte=function(n){return Array.isArray(n)?n[0]:n},INe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},xte=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Lte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},ANe=function(n){return n.hasAttribute("inert")},PNe=function(n,e){return!n||Lte(n)||!INe(n)&&!ANe(n)&&e(xte(n))},Mte=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=PNe(e,Mte.bind(void 0,n));return n.set(e,a),a},ONe=function(n,e){return n&&!Lte(n)?DNe(n)?e(xte(n)):!1:!0},Ute=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=ONe(e,Ute.bind(void 0,n));return n.set(e,a),a},Vte=function(n){return n.dataset},kNe=function(n){return n.tagName==="BUTTON"},Fte=function(n){return n.tagName==="INPUT"},jte=function(n){return Fte(n)&&n.type==="radio"},NNe=function(n){return!((Fte(n)||kNe(n))&&(n.type==="hidden"||n.disabled))},DNe=function(n){var e=n.getAttribute(fNe);return![!0,"true",""].includes(e)},fj=function(n){var e;return!!(n&&(!((e=Vte(n))===null||e===void 0)&&e.focusGuard))},rV=function(n){return!fj(n)},xNe=function(n){return!!n},LNe=function(n,e){var i=Math.max(0,n.tabIndex),a=Math.max(0,e.tabIndex),l=i-a,d=n.index-e.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},MNe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},pj=function(n,e,i){return df(n).map(function(a,l){var d=MNe(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!e||a.tabIndex>=0}).sort(LNe)},UNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],mj=UNe.join(","),VNe="".concat(mj,", [data-focus-guard]"),Bte=function(n,e){return df((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(e?VNe:mj)?[a]:[],Bte(a))},[])},FNe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?g0([n.contentDocument.body],e):[n]},g0=function(n,e){return n.reduce(function(i,a){var l,d=Bte(a,e),p=(l=[]).concat.apply(l,d.map(function(y){return FNe(y,e)}));return i.concat(p,a.parentNode?df(a.parentNode.querySelectorAll(mj)).filter(function(y){return y===a}):[])},[])},jNe=function(n){var e=n.querySelectorAll("[".concat(hNe,"]"));return df(e).map(function(i){return g0([i])}).reduce(function(i,a){return i.concat(a)},[])},gj=function(n,e){return df(n).filter(function(i){return Mte(e,i)}).filter(function(i){return NNe(i)})},CY=function(n,e){return e===void 0&&(e=new Map),df(n).filter(function(i){return Ute(e,i)})},_j=function(n,e,i){return pj(gj(g0(n,i),e),!0,i)},AC=function(n,e){return pj(gj(g0(n),e),!1)},BNe=function(n,e){return gj(jNe(n),e)},Ry=function(n,e){return n.shadowRoot?Ry(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:df(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?Ry(l,e):!1}return Ry(i,e)})},WNe=function(n){for(var e=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(a)}return n.filter(function(p,y){return!e.has(y)})},Wte=function(n){return n.parentNode?Wte(n.parentNode):n},yj=function(n){var e=Ny(n);return e.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(tV);return i.push.apply(i,l?WNe(df(Wte(a).querySelectorAll("[".concat(tV,'="').concat(l,'"]:not([').concat(Cte,'="disabled"])')))):[a]),i},[])},zNe=function(n){try{return n()}catch{return}},PC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?PC(e.shadowRoot):e instanceof HTMLIFrameElement&&zNe(function(){return e.contentWindow.document})?PC(e.contentWindow.document):e}},GNe=function(n,e){return n===e},HNe=function(n,e){return!!df(n.querySelectorAll("iframe")).some(function(i){return GNe(i,e)})},zte=function(n,e){return e===void 0&&(e=PC(Dte(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:yj(n).some(function(i){return Ry(i,e)||HNe(i,e)})},$Ne=function(n){n===void 0&&(n=document);var e=PC(n);return e?df(n.querySelectorAll("[".concat(dNe,"]"))).some(function(i){return Ry(i,e)}):!1},KNe=function(n,e){return e.filter(jte).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},Ej=function(n,e){return jte(n)&&n.name?KNe(n,e):n},qNe=function(n){var e=new Set;return n.forEach(function(i){return e.add(Ej(i,n))}),n.filter(function(i){return e.has(i)})},RY=function(n){return n[0]&&n.length>1?Ej(n[0],n):n[0]},IY=function(n,e){return n.indexOf(Ej(e,n))},iV="NEW_FOCUS",YNe=function(n,e,i,a,l){var d=n.length,p=n[0],y=n[d-1],v=fj(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,w=l?i.indexOf(l):b,A=l?n.indexOf(l):-1;if(b===-1)return A!==-1?A:iV;if(A===-1)return iV;var N=b-w,V=i.indexOf(p),F=i.indexOf(y),B=qNe(i),W=a!==void 0?B.indexOf(a):-1,J=l?B.indexOf(l):W,$=B.filter(function(ee){return ee.tabIndex>=0}),te=a!==void 0?$.indexOf(a):-1,ce=l?$.indexOf(l):te,oe=te>=0&&ce>=0?ce-te:J-W;if(!N&&A>=0||e.length===0)return A;var _e=IY(n,e[0]),ne=IY(n,e[e.length-1]);if(b<=V&&v&&Math.abs(N)>1)return ne;if(b>=F&&v&&Math.abs(N)>1)return _e;if(N&&Math.abs(oe)>1)return A;if(b<=V)return ne;if(b>F)return _e;if(N)return Math.abs(N)>1?A:(d+A+N)%d}},XNe=function(n){return function(e){var i,a=(i=Vte(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||a!==void 0&&a!=="false"||n.indexOf(e)>=0}},AY=function(n,e,i){var a=n.map(function(d){var p=d.node;return p}),l=CY(a.filter(XNe(i)));return l&&l.length?RY(l):RY(CY(e))},sV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&sV(n.parentNode.host||n.parentNode,e),e},j2=function(n,e){for(var i=sV(n),a=sV(e),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},Gte=function(n,e,i){var a=Ny(n),l=Ny(e),d=a[0],p=!1;return l.filter(Boolean).forEach(function(y){p=j2(p||y,y)||p,i.filter(Boolean).forEach(function(v){var b=j2(d,v);b&&(!p||Ry(b,p)?p=b:p=j2(b,p))})}),p},PY=function(n,e){return n.reduce(function(i,a){return i.concat(BNe(a,e))},[])},JNe=function(n,e){var i=new Map;return e.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(xNe)},QNe=function(n,e){var i=PC(Ny(n).length>0?document:Dte(n).ownerDocument),a=yj(n).filter(rV),l=Gte(i||n,n,a),d=new Map,p=AC(a,d),y=p.filter(function(F){var B=F.node;return rV(B)});if(y[0]){var v=AC([l],d).map(function(F){var B=F.node;return B}),b=JNe(v,y),w=b.map(function(F){var B=F.node;return B}),A=b.filter(function(F){var B=F.tabIndex;return B>=0}).map(function(F){var B=F.node;return B}),N=YNe(w,A,v,i,e);if(N===iV){var V=AY(p,A,PY(a,d))||AY(p,w,PY(a,d));if(V)return{node:V};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:b[N]}},ZNe=function(n){var e=yj(n).filter(rV),i=Gte(n,n,e),a=pj(g0([i],!0),!0,!0),l=g0(e,!1);return a.map(function(d){var p=d.node,y=d.index;return{node:p,index:y,lockItem:l.indexOf(p)>=0,guard:fj(p)}})},vj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},B2=0,W2=!1,Hte=function(n,e,i){i===void 0&&(i={});var a=QNe(n,e);if(!W2&&a){if(B2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),W2=!0,setTimeout(function(){W2=!1},1);return}B2++,vj(a.node,i.focusOptions),B2--}};function mw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var eDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:mw(i),parent:mw(i.parentElement),left:mw(i.previousElementSibling),right:mw(i.nextElementSibling)}),i=i.parentElement;return{element:mw(n),stack:e,ownerDocument:n.ownerDocument}},tDe=function(n){var e,i,a,l,d;if(n)for(var p=n.stack,y=n.ownerDocument,v=new Map,b=0,w=p;b<w.length;b++){var A=w[b],N=(e=A.parent)===null||e===void 0?void 0:e.call(A);if(N&&y.contains(N)){for(var V=(i=A.left)===null||i===void 0?void 0:i.call(A),F=A.current(),B=N.contains(F)?F:void 0,W=(a=A.right)===null||a===void 0?void 0:a.call(A),J=_j([N],v),$=(d=(l=B??(V==null?void 0:V.nextElementSibling))!==null&&l!==void 0?l:W)!==null&&d!==void 0?d:V;$;){for(var te=0,ce=J;te<ce.length;te++){var oe=ce[te];if($!=null&&$.contains(oe.node))return oe.node}$=$.nextElementSibling}if(J.length)return J[0].node}}},$te=function(n){var e=eDe(n);return function(){return tDe(e)}},nDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var a=Ny(e);if(a.every(function(p){return!Ry(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?_j(a,new Map):AC(a,new Map),d=l.findIndex(function(p){var y=p.node;return y===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},rDe=function(n,e){var i=e?_j(Ny(n),new Map):AC(Ny(n),new Map);return{first:i[0],last:i[i.length-1]}},iDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Kte=function(n,e,i){e===void 0&&(e={});var a=iDe(e),l=nDe(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&vj(d.node,a.focusOptions)}},sDe=function(n,e){e===void 0&&(e={}),Kte(n,e,function(i,a){var l=i.next,d=i.first;return l||a&&d})},oDe=function(n,e){e===void 0&&(e={}),Kte(n,e,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},qte=function(n,e,i){var a,l=rDe(n,(a=e.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&vj(d.node,e.focusOptions)},aDe=function(n,e){e===void 0&&(e={}),qte(n,e,"first")},cDe=function(n,e){e===void 0&&(e={}),qte(n,e,"last")};function Sj(n){setTimeout(n,1)}var lDe=function(e){return e&&"current"in e?e.current:e},Yte=function(){return document&&document.activeElement===document.body},uDe=function(){return Yte()||$Ne()},ZS=null,Zc=null,OY=function(){return null},e0=null,OC=!1,bj=!1,dDe=function(){return!0},hDe=function(e){return(ZS.whiteList||dDe)(e)},fDe=function(e,i){e0={observerNode:e,portaledElement:i}},pDe=function(e){return e0&&e0.portaledElement===e};function kY(n,e,i,a){var l=null,d=n;do{var p=a[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==e);l&&(l.node.tabIndex=0)}var mDe=function(e){return e?!!OC:OC==="meanwhile"},gDe=function n(e,i,a){return i&&(i.host===e&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,a))},_De=function(e,i){return i.some(function(a){return gDe(e,a,a)})},Xte=function(e){return AC(e,new Map)},yDe=function(e){return!Xte([e.parentNode]).some(function(i){return i.node===e})},Nk=function(){var e=!1;if(ZS){var i=ZS,a=i.observed,l=i.persistentFocus,d=i.autoFocus,p=i.shards,y=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,w=a||e0&&e0.portaledElement;if(Yte()&&Zc&&Zc!==document.body&&(!document.body.contains(Zc)||yDe(Zc))){var A=OY();A&&A.focus()}var N=document&&document.activeElement;if(w){var V=[w].concat(p.map(lDe).filter(Boolean)),F=function(){if(!mDe(y)||!b||!Zc||bj)return!1;var te=Xte(V),ce=te.findIndex(function(oe){var _e=oe.node;return _e===Zc});return ce===0||ce===te.length-1};if((!N||hDe(N))&&(l||F()||!uDe()||!Zc&&d)&&(w&&!(zte(V)||N&&_De(N,V)||pDe(N))&&(document&&!Zc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(e=Hte(V,Zc,{focusOptions:v}),e0={})),Zc=document&&document.activeElement,Zc!==document.body&&(OY=$te(Zc)),OC=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,W=ZNe(V),J=W.map(function($){var te=$.node;return te}).indexOf(B);J>-1&&(W.filter(function($){var te=$.guard,ce=$.node;return te&&ce.dataset.focusAutoGuard}).forEach(function($){var te=$.node;return te.removeAttribute("tabIndex")}),kY(J,W.length,1,W),kY(J,-1,-1,W))}}}return e},Jte=function(e){Nk()&&e&&(e.stopPropagation(),e.preventDefault())},Tj=function(){return Sj(Nk)},EDe=function(e){var i=e.target,a=e.currentTarget;a.contains(i)||fDe(a,i)},vDe=function(){return null},Qte=function(){bj=!0},Zte=function(){bj=!1,OC="just",Sj(function(){OC="meanwhile"})},SDe=function(){document.addEventListener("focusin",Jte),document.addEventListener("focusout",Tj),window.addEventListener("focus",Qte),window.addEventListener("blur",Zte)},bDe=function(){document.removeEventListener("focusin",Jte),document.removeEventListener("focusout",Tj),window.removeEventListener("focus",Qte),window.removeEventListener("blur",Zte)};function TDe(n){return n.filter(function(e){var i=e.disabled;return!i})}var ene={moveFocusInside:Hte,focusInside:zte,focusNextElement:sDe,focusPrevElement:oDe,focusFirstElement:aDe,focusLastElement:cDe,captureFocusRestore:$te};function wDe(n){var e=n.slice(-1)[0];e&&!ZS&&SDe();var i=ZS,a=i&&e&&e.id===i.id;ZS=e,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!e)),e?(Zc=null,(!a||i.observed!==e.observed)&&e.onActivation(ene),Nk(),Sj(Nk)):(bDe(),Zc=null)}kte.assignSyncMedium(EDe);Nte.assignMedium(Tj);yNe.assignMedium(function(n){return n(ene)});const CDe=RNe(TDe,wDe)(vDe);var oV=D.forwardRef(function(e,i){return ui.createElement(hj,Oy({sideCar:CDe,ref:i},e))}),tne=hj.propTypes||{};tne.sideCar;oNe(tne,["sideCar"]);oV.propTypes={};const RDe=oV.default??oV,nne=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:p,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{e!=null&&e.current?e.current.focus():a!=null&&a.current&&FQ(a.current).length===0&&requestAnimationFrame(()=>{var F;(F=a.current)==null||F.focus()})},[e,a]),A=D.useCallback(()=>{var V;(V=i==null?void 0:i.current)==null||V.focus()},[i]),N=l&&!i;return C.jsx(RDe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:p,onActivation:w,onDeactivation:A,returnFocus:N,children:d})};nne.displayName="FocusLock";const[IDe,ADe]=Fi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),pp=Wt((n,e)=>{const i=vc("FormError",n),a=Bi(n),l=F0();return l!=null&&l.isInvalid?C.jsx(IDe,{value:i,children:C.jsx(Nt.div,{...l==null?void 0:l.getErrorMessageProps(a,e),className:dn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});pp.displayName="FormErrorMessage";const PDe=Wt((n,e)=>{const i=ADe(),a=F0();if(!(a!=null&&a.isInvalid))return null;const l=dn("chakra-form__error-icon",n.className);return C.jsx(xn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:C.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});PDe.displayName="FormErrorIcon";const Gs=Wt(function(e,i){const a=Wl("FormLabel",e),l=Bi(e),{className:d,children:p,requiredIndicator:y=C.jsx(rne,{}),optionalIndicator:v=null,...b}=l,w=F0(),A=(w==null?void 0:w.getLabelProps(b,i))??{ref:i,...b};return C.jsxs(Nt.label,{...A,className:dn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[p,w!=null&&w.isRequired?y:v]})});Gs.displayName="FormLabel";const rne=Wt(function(e,i){const a=F0(),l=Tte();if(!(a!=null&&a.isRequired))return null;const d=dn("chakra-form__required-indicator",e.className);return C.jsx(Nt.span,{...a==null?void 0:a.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:d})});rne.displayName="RequiredIndicator";const ine=Wt(function(e,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:p,column:y,row:v,autoFlow:b,autoRows:w,templateRows:A,autoColumns:N,templateColumns:V,...F}=e,B={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:N,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:A,gridTemplateColumns:V};return C.jsx(Nt.div,{ref:i,__css:B,...F})});ine.displayName="Grid";const sne=Wt(function(e,i){const{columns:a,spacingX:l,spacingY:d,spacing:p,minChildWidth:y,...v}=e,b=V0(),w=y?kDe(y,b):NDe(a);return C.jsx(ine,{ref:i,gap:p,columnGap:l,rowGap:d,templateColumns:w,...v})});sne.displayName="SimpleGrid";function ODe(n){return typeof n=="number"?`${n}px`:n}function kDe(n,e){return h1(n,i=>{const a=d1e("sizes",i,ODe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function NDe(n){return h1(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Dg(n){const{viewBox:e="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),p=Wt((y,v)=>C.jsx(xn,{ref:v,viewBox:e,...l,...y,children:d.length?d:C.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=a,p}const aV=Wt(function(e,i){const{htmlWidth:a,htmlHeight:l,alt:d,...p}=e;return C.jsx("img",{width:a,height:l,ref:i,alt:d,...p})});aV.displayName="NativeImage";const Hh=Wt(function(e,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:p,align:y,fit:v,loading:b,ignoreFallback:w,crossOrigin:A,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:V,...F}=e,B=a!==void 0||l!==void 0,W=b!=null||w||!B,J=vte({...e,crossOrigin:A,ignoreFallback:W}),$=j1e(J,N),te={ref:i,objectFit:v,objectPosition:y,...W?F:D0(F,["onError","onLoad"])};return $?l||C.jsx(Nt.img,{as:aV,className:"chakra-image__placeholder",src:a,...te}):C.jsx(Nt.img,{as:aV,src:d,srcSet:p,crossOrigin:A,loading:b,referrerPolicy:V,className:"chakra-image",...te})});Hh.displayName="Image";const Ai=Wt(function(e,i){const{htmlSize:a,...l}=e,d=vc("Input",l),p=Bi(l),y=uj(p),v=dn("chakra-input",e.className);return C.jsx(Nt.input,{size:a,...y,__css:d.field,ref:i,className:v})});Ai.displayName="Input";Ai.id="Input";const[DDe,xDe]=Fi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),t0=Wt(function(e,i){const a=vc("Input",e),{children:l,className:d,...p}=Bi(e),y=dn("chakra-input__group",d),v={},b=iF(l),w=a.field;b.forEach(N=>{a&&(w&&N.type.id==="InputLeftElement"&&(v.paddingStart=w.height??w.h),w&&N.type.id==="InputRightElement"&&(v.paddingEnd=w.height??w.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const A=b.map(N=>{var F,B;const V=d1({size:((F=N.props)==null?void 0:F.size)||e.size,variant:((B=N.props)==null?void 0:B.variant)||e.variant});return N.type.id!=="Input"?D.cloneElement(N,V):D.cloneElement(N,Object.assign(V,v,N.props))});return C.jsx(Nt.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...p,children:C.jsx(DDe,{value:a,children:A})})});t0.displayName="InputGroup";const LDe=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),P1=Wt(function(e,i){const{placement:a="left",...l}=e,d=xDe(),p=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return C.jsx(LDe,{ref:i,__css:v,...l})});P1.id="InputElement";P1.displayName="InputElement";const sC=Wt(function(e,i){const{className:a,...l}=e,d=dn("chakra-input__left-element",a);return C.jsx(P1,{ref:i,placement:"left",className:d,...l})});sC.id="InputLeftElement";sC.displayName="InputLeftElement";const Dk=Wt(function(e,i){const{className:a,...l}=e,d=dn("chakra-input__right-element",a);return C.jsx(P1,{ref:i,placement:"right",className:d,...l})});Dk.id="InputRightElement";Dk.displayName="InputRightElement";const ku=Wt(function(e,i){const a=Wl("Link",e),{className:l,isExternal:d,...p}=Bi(e);return C.jsx(Nt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:dn("chakra-link",l),...p,__css:a})});ku.displayName="Link";function MDe(n,e={}){const{ssr:i=!0,fallback:a}=e,{getWindow:l}=pIe(),d=Array.isArray(n)?n:[n];let p=Array.isArray(a)?a:[a];p=p.filter(b=>b!=null);const[y,v]=D.useState(()=>d.map((b,w)=>({media:b,matches:i?!!p[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();v(d.map(N=>({media:N,matches:b.matchMedia(N).matches})));const w=d.map(N=>b.matchMedia(N)),A=N=>{v(V=>V.slice().map(F=>F.media===N.media?{...F,matches:N.matches}:F))};return w.forEach(N=>{typeof N.addListener=="function"?N.addListener(A):N.addEventListener("change",A)}),()=>{w.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(A):N.removeEventListener("change",A)})}},[l]),y.map(b=>b.matches)}function UDe(n,e,i,a){if(e==null)return a;if(!a)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function VDe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function FDe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},y=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},e)};D.useEffect(()=>p,[]);function v(b){return w=>{if(w.key==="Backspace"){const A=[...a];A.pop(),l(A);return}if(VDe(w)){const A=a.concat(w.key);i(w)&&(w.preventDefault(),w.stopPropagation()),l(A),b(A.join("")),y()}}}return v}var ol="top",Lu="bottom",Mu="right",al="left",wj="auto",nR=[ol,Lu,Mu,al],_0="start",kC="end",jDe="clippingParents",one="viewport",gw="popper",BDe="reference",NY=nR.reduce(function(n,e){return n.concat([e+"-"+_0,e+"-"+kC])},[]),ane=[].concat(nR,[wj]).reduce(function(n,e){return n.concat([e,e+"-"+_0,e+"-"+kC])},[]),WDe="beforeRead",zDe="read",GDe="afterRead",HDe="beforeMain",$De="main",KDe="afterMain",qDe="beforeWrite",YDe="write",XDe="afterWrite",JDe=[WDe,zDe,GDe,HDe,$De,KDe,qDe,YDe,XDe];function af(n){return n?(n.nodeName||"").toLowerCase():null}function Bl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Dy(n){var e=Bl(n).Element;return n instanceof e||n instanceof Element}function Du(n){var e=Bl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function Cj(n){if(typeof ShadowRoot>"u")return!1;var e=Bl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function QDe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},d=e.elements[i];!Du(d)||!af(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(p){var y=l[p];y===!1?d.removeAttribute(p):d.setAttribute(p,y===!0?"":y)}))})}function ZDe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],d=e.attributes[a]||{},p=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),y=p.reduce(function(v,b){return v[b]="",v},{});!Du(l)||!af(l)||(Object.assign(l.style,y),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const exe={name:"applyStyles",enabled:!0,phase:"write",fn:QDe,effect:ZDe,requires:["computeStyles"]};function Zh(n){return n.split("-")[0]}var Iy=Math.max,xk=Math.min,y0=Math.round;function cV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function cne(){return!/^((?!chrome|android).)*safari/i.test(cV())}function E0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;e&&Du(n)&&(l=n.offsetWidth>0&&y0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&y0(a.height)/n.offsetHeight||1);var p=Dy(n)?Bl(n):window,y=p.visualViewport,v=!cne()&&i,b=(a.left+(v&&y?y.offsetLeft:0))/l,w=(a.top+(v&&y?y.offsetTop:0))/d,A=a.width/l,N=a.height/d;return{width:A,height:N,top:w,right:b+A,bottom:w+N,left:b,x:b,y:w}}function Rj(n){var e=E0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function lne(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&Cj(i)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Mp(n){return Bl(n).getComputedStyle(n)}function txe(n){return["table","td","th"].indexOf(af(n))>=0}function xg(n){return((Dy(n)?n.ownerDocument:n.document)||window.document).documentElement}function O1(n){return af(n)==="html"?n:n.assignedSlot||n.parentNode||(Cj(n)?n.host:null)||xg(n)}function DY(n){return!Du(n)||Mp(n).position==="fixed"?null:n.offsetParent}function nxe(n){var e=/firefox/i.test(cV()),i=/Trident/i.test(cV());if(i&&Du(n)){var a=Mp(n);if(a.position==="fixed")return null}var l=O1(n);for(Cj(l)&&(l=l.host);Du(l)&&["html","body"].indexOf(af(l))<0;){var d=Mp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function rR(n){for(var e=Bl(n),i=DY(n);i&&txe(i)&&Mp(i).position==="static";)i=DY(i);return i&&(af(i)==="html"||af(i)==="body"&&Mp(i).position==="static")?e:i||nxe(n)||e}function Ij(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function oC(n,e,i){return Iy(n,xk(e,i))}function rxe(n,e,i){var a=oC(n,e,i);return a>i?i:a}function une(){return{top:0,right:0,bottom:0,left:0}}function dne(n){return Object.assign({},une(),n)}function hne(n,e){return e.reduce(function(i,a){return i[a]=n,i},{})}var ixe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,dne(typeof e!="number"?e:hne(e,nR))};function sxe(n){var e,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,p=i.modifiersData.popperOffsets,y=Zh(i.placement),v=Ij(y),b=[al,Mu].indexOf(y)>=0,w=b?"height":"width";if(!(!d||!p)){var A=ixe(l.padding,i),N=Rj(d),V=v==="y"?ol:al,F=v==="y"?Lu:Mu,B=i.rects.reference[w]+i.rects.reference[v]-p[v]-i.rects.popper[w],W=p[v]-i.rects.reference[v],J=rR(d),$=J?v==="y"?J.clientHeight||0:J.clientWidth||0:0,te=B/2-W/2,ce=A[V],oe=$-N[w]-A[F],_e=$/2-N[w]/2+te,ne=oC(ce,_e,oe),ee=v;i.modifiersData[a]=(e={},e[ee]=ne,e.centerOffset=ne-_e,e)}}function oxe(n){var e=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||lne(e.elements.popper,l)&&(e.elements.arrow=l))}const axe={name:"arrow",enabled:!0,phase:"main",fn:sxe,effect:oxe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function v0(n){return n.split("-")[1]}var cxe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lxe(n,e){var i=n.x,a=n.y,l=e.devicePixelRatio||1;return{x:y0(i*l)/l||0,y:y0(a*l)/l||0}}function xY(n){var e,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,A=n.isFixed,N=p.x,V=N===void 0?0:N,F=p.y,B=F===void 0?0:F,W=typeof w=="function"?w({x:V,y:B}):{x:V,y:B};V=W.x,B=W.y;var J=p.hasOwnProperty("x"),$=p.hasOwnProperty("y"),te=al,ce=ol,oe=window;if(b){var _e=rR(i),ne="clientHeight",ee="clientWidth";if(_e===Bl(i)&&(_e=xg(i),Mp(_e).position!=="static"&&y==="absolute"&&(ne="scrollHeight",ee="scrollWidth")),_e=_e,l===ol||(l===al||l===Mu)&&d===kC){ce=Lu;var Q=A&&_e===oe&&oe.visualViewport?oe.visualViewport.height:_e[ne];B-=Q-a.height,B*=v?1:-1}if(l===al||(l===ol||l===Lu)&&d===kC){te=Mu;var se=A&&_e===oe&&oe.visualViewport?oe.visualViewport.width:_e[ee];V-=se-a.width,V*=v?1:-1}}var fe=Object.assign({position:y},b&&cxe),pe=w===!0?lxe({x:V,y:B},Bl(i)):{x:V,y:B};if(V=pe.x,B=pe.y,v){var ue;return Object.assign({},fe,(ue={},ue[ce]=$?"0":"",ue[te]=J?"0":"",ue.transform=(oe.devicePixelRatio||1)<=1?"translate("+V+"px, "+B+"px)":"translate3d("+V+"px, "+B+"px, 0)",ue))}return Object.assign({},fe,(e={},e[ce]=$?B+"px":"",e[te]=J?V+"px":"",e.transform="",e))}function uxe(n){var e=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,p=d===void 0?!0:d,y=i.roundOffsets,v=y===void 0?!0:y,b={placement:Zh(e.placement),variation:v0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,xY(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,xY(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const dxe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:uxe,data:{}};var bO={passive:!0};function hxe(n){var e=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,p=a.resize,y=p===void 0?!0:p,v=Bl(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",i.update,bO)}),y&&v.addEventListener("resize",i.update,bO),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",i.update,bO)}),y&&v.removeEventListener("resize",i.update,bO)}}const fxe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:hxe,data:{}};var pxe={left:"right",right:"left",bottom:"top",top:"bottom"};function nk(n){return n.replace(/left|right|bottom|top/g,function(e){return pxe[e]})}var mxe={start:"end",end:"start"};function LY(n){return n.replace(/start|end/g,function(e){return mxe[e]})}function Aj(n){var e=Bl(n),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function Pj(n){return E0(xg(n)).left+Aj(n).scrollLeft}function gxe(n,e){var i=Bl(n),a=xg(n),l=i.visualViewport,d=a.clientWidth,p=a.clientHeight,y=0,v=0;if(l){d=l.width,p=l.height;var b=cne();(b||!b&&e==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:d,height:p,x:y+Pj(n),y:v}}function _xe(n){var e,i=xg(n),a=Aj(n),l=(e=n.ownerDocument)==null?void 0:e.body,d=Iy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Iy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-a.scrollLeft+Pj(n),v=-a.scrollTop;return Mp(l||i).direction==="rtl"&&(y+=Iy(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:y,y:v}}function Oj(n){var e=Mp(n),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function fne(n){return["html","body","#document"].indexOf(af(n))>=0?n.ownerDocument.body:Du(n)&&Oj(n)?n:fne(O1(n))}function aC(n,e){var i;e===void 0&&(e=[]);var a=fne(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=Bl(a),p=l?[d].concat(d.visualViewport||[],Oj(a)?a:[]):a,y=e.concat(p);return l?y:y.concat(aC(O1(p)))}function lV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function yxe(n,e){var i=E0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function MY(n,e,i){return e===one?lV(gxe(n,i)):Dy(e)?yxe(e,i):lV(_xe(xg(n)))}function Exe(n){var e=aC(O1(n)),i=["absolute","fixed"].indexOf(Mp(n).position)>=0,a=i&&Du(n)?rR(n):n;return Dy(a)?e.filter(function(l){return Dy(l)&&lne(l,a)&&af(l)!=="body"}):[]}function vxe(n,e,i,a){var l=e==="clippingParents"?Exe(n):[].concat(e),d=[].concat(l,[i]),p=d[0],y=d.reduce(function(v,b){var w=MY(n,b,a);return v.top=Iy(w.top,v.top),v.right=xk(w.right,v.right),v.bottom=xk(w.bottom,v.bottom),v.left=Iy(w.left,v.left),v},MY(n,p,a));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function pne(n){var e=n.reference,i=n.element,a=n.placement,l=a?Zh(a):null,d=a?v0(a):null,p=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,v;switch(l){case ol:v={x:p,y:e.y-i.height};break;case Lu:v={x:p,y:e.y+e.height};break;case Mu:v={x:e.x+e.width,y};break;case al:v={x:e.x-i.width,y};break;default:v={x:e.x,y:e.y}}var b=l?Ij(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case _0:v[b]=v[b]-(e[w]/2-i[w]/2);break;case kC:v[b]=v[b]+(e[w]/2-i[w]/2);break}}return v}function NC(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,p=d===void 0?n.strategy:d,y=i.boundary,v=y===void 0?jDe:y,b=i.rootBoundary,w=b===void 0?one:b,A=i.elementContext,N=A===void 0?gw:A,V=i.altBoundary,F=V===void 0?!1:V,B=i.padding,W=B===void 0?0:B,J=dne(typeof W!="number"?W:hne(W,nR)),$=N===gw?BDe:gw,te=n.rects.popper,ce=n.elements[F?$:N],oe=vxe(Dy(ce)?ce:ce.contextElement||xg(n.elements.popper),v,w,p),_e=E0(n.elements.reference),ne=pne({reference:_e,element:te,placement:l}),ee=lV(Object.assign({},te,ne)),Q=N===gw?ee:_e,se={top:oe.top-Q.top+J.top,bottom:Q.bottom-oe.bottom+J.bottom,left:oe.left-Q.left+J.left,right:Q.right-oe.right+J.right},fe=n.modifiersData.offset;if(N===gw&&fe){var pe=fe[l];Object.keys(se).forEach(function(ue){var Me=[Mu,Lu].indexOf(ue)>=0?1:-1,He=[ol,Lu].indexOf(ue)>=0?"y":"x";se[ue]+=pe[He]*Me})}return se}function Sxe(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,d=i.rootBoundary,p=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?ane:v,w=v0(a),A=w?y?NY:NY.filter(function(F){return v0(F)===w}):nR,N=A.filter(function(F){return b.indexOf(F)>=0});N.length===0&&(N=A);var V=N.reduce(function(F,B){return F[B]=NC(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[Zh(B)],F},{});return Object.keys(V).sort(function(F,B){return V[F]-V[B]})}function bxe(n){if(Zh(n)===wj)return[];var e=nk(n);return[LY(n),e,LY(e)]}function Txe(n){var e=n.state,i=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!0:p,v=i.fallbackPlacements,b=i.padding,w=i.boundary,A=i.rootBoundary,N=i.altBoundary,V=i.flipVariations,F=V===void 0?!0:V,B=i.allowedAutoPlacements,W=e.options.placement,J=Zh(W),$=J===W,te=v||($||!F?[nk(W)]:bxe(W)),ce=[W].concat(te).reduce(function(Ue,Ge){return Ue.concat(Zh(Ge)===wj?Sxe(e,{placement:Ge,boundary:w,rootBoundary:A,padding:b,flipVariations:F,allowedAutoPlacements:B}):Ge)},[]),oe=e.rects.reference,_e=e.rects.popper,ne=new Map,ee=!0,Q=ce[0],se=0;se<ce.length;se++){var fe=ce[se],pe=Zh(fe),ue=v0(fe)===_0,Me=[ol,Lu].indexOf(pe)>=0,He=Me?"width":"height",nt=NC(e,{placement:fe,boundary:w,rootBoundary:A,altBoundary:N,padding:b}),we=Me?ue?Mu:al:ue?Lu:ol;oe[He]>_e[He]&&(we=nk(we));var Re=nk(we),ve=[];if(d&&ve.push(nt[pe]<=0),y&&ve.push(nt[we]<=0,nt[Re]<=0),ve.every(function(Ue){return Ue})){Q=fe,ee=!1;break}ne.set(fe,ve)}if(ee)for(var Ne=F?3:1,Te=function(Ge){var Qe=ce.find(function(tt){var ht=ne.get(tt);if(ht)return ht.slice(0,Ge).every(function(Ze){return Ze})});if(Qe)return Q=Qe,"break"},be=Ne;be>0;be--){var Ae=Te(be);if(Ae==="break")break}e.placement!==Q&&(e.modifiersData[a]._skip=!0,e.placement=Q,e.reset=!0)}}const wxe={name:"flip",enabled:!0,phase:"main",fn:Txe,requiresIfExists:["offset"],data:{_skip:!1}};function UY(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function VY(n){return[ol,Mu,Lu,al].some(function(e){return n[e]>=0})}function Cxe(n){var e=n.state,i=n.name,a=e.rects.reference,l=e.rects.popper,d=e.modifiersData.preventOverflow,p=NC(e,{elementContext:"reference"}),y=NC(e,{altBoundary:!0}),v=UY(p,a),b=UY(y,l,d),w=VY(v),A=VY(b);e.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:A},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":A})}const Rxe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Cxe};function Ixe(n,e,i){var a=Zh(n),l=[al,ol].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=d[0],y=d[1];return p=p||0,y=(y||0)*l,[al,Mu].indexOf(a)>=0?{x:y,y:p}:{x:p,y}}function Axe(n){var e=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,p=ane.reduce(function(w,A){return w[A]=Ixe(A,e.rects,d),w},{}),y=p[e.placement],v=y.x,b=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=b),e.modifiersData[a]=p}const Pxe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Axe};function Oxe(n){var e=n.state,i=n.name;e.modifiersData[i]=pne({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const kxe={name:"popperOffsets",enabled:!0,phase:"read",fn:Oxe,data:{}};function Nxe(n){return n==="x"?"y":"x"}function Dxe(n){var e=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!1:p,v=i.boundary,b=i.rootBoundary,w=i.altBoundary,A=i.padding,N=i.tether,V=N===void 0?!0:N,F=i.tetherOffset,B=F===void 0?0:F,W=NC(e,{boundary:v,rootBoundary:b,padding:A,altBoundary:w}),J=Zh(e.placement),$=v0(e.placement),te=!$,ce=Ij(J),oe=Nxe(ce),_e=e.modifiersData.popperOffsets,ne=e.rects.reference,ee=e.rects.popper,Q=typeof B=="function"?B(Object.assign({},e.rects,{placement:e.placement})):B,se=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),fe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,pe={x:0,y:0};if(_e){if(d){var ue,Me=ce==="y"?ol:al,He=ce==="y"?Lu:Mu,nt=ce==="y"?"height":"width",we=_e[ce],Re=we+W[Me],ve=we-W[He],Ne=V?-ee[nt]/2:0,Te=$===_0?ne[nt]:ee[nt],be=$===_0?-ee[nt]:-ne[nt],Ae=e.elements.arrow,Ue=V&&Ae?Rj(Ae):{width:0,height:0},Ge=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:une(),Qe=Ge[Me],tt=Ge[He],ht=oC(0,ne[nt],Ue[nt]),Ze=te?ne[nt]/2-Ne-ht-Qe-se.mainAxis:Te-ht-Qe-se.mainAxis,Ct=te?-ne[nt]/2+Ne+ht+tt+se.mainAxis:be+ht+tt+se.mainAxis,un=e.elements.arrow&&rR(e.elements.arrow),Lt=un?ce==="y"?un.clientTop||0:un.clientLeft||0:0,nn=(ue=fe==null?void 0:fe[ce])!=null?ue:0,kn=we+Ze-nn-Lt,Kt=we+Ct-nn,zn=oC(V?xk(Re,kn):Re,we,V?Iy(ve,Kt):ve);_e[ce]=zn,pe[ce]=zn-we}if(y){var Bt,Ce=ce==="x"?ol:al,Fe=ce==="x"?Lu:Mu,We=_e[oe],at=oe==="y"?"height":"width",vt=We+W[Ce],St=We-W[Fe],Gt=[ol,al].indexOf(J)!==-1,fn=(Bt=fe==null?void 0:fe[oe])!=null?Bt:0,Ln=Gt?vt:We-ne[at]-ee[at]-fn+se.altAxis,cn=Gt?We+ne[at]+ee[at]-fn-se.altAxis:St,dr=V&&Gt?rxe(Ln,We,cn):oC(V?Ln:vt,We,V?cn:St);_e[oe]=dr,pe[oe]=dr-We}e.modifiersData[a]=pe}}const xxe={name:"preventOverflow",enabled:!0,phase:"main",fn:Dxe,requiresIfExists:["offset"]};function Lxe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Mxe(n){return n===Bl(n)||!Du(n)?Aj(n):Lxe(n)}function Uxe(n){var e=n.getBoundingClientRect(),i=y0(e.width)/n.offsetWidth||1,a=y0(e.height)/n.offsetHeight||1;return i!==1||a!==1}function Vxe(n,e,i){i===void 0&&(i=!1);var a=Du(e),l=Du(e)&&Uxe(e),d=xg(e),p=E0(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!i)&&((af(e)!=="body"||Oj(d))&&(y=Mxe(e)),Du(e)?(v=E0(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):d&&(v.x=Pj(d))),{x:p.left+y.scrollLeft-v.x,y:p.top+y.scrollTop-v.y,width:p.width,height:p.height}}function Fxe(n){var e=new Map,i=new Set,a=[];n.forEach(function(d){e.set(d.name,d)});function l(d){i.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(y){if(!i.has(y)){var v=e.get(y);v&&l(v)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function jxe(n){var e=Fxe(n);return JDe.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function Bxe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function Wxe(n){var e=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var FY={placement:"bottom",modifiers:[],strategy:"absolute"};function jY(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function zxe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,d=l===void 0?FY:l;return function(y,v,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},FY,d),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},A=[],N=!1,V={state:w,setOptions:function(J){var $=typeof J=="function"?J(w.options):J;B(),w.options=Object.assign({},d,w.options,$),w.scrollParents={reference:Dy(y)?aC(y):y.contextElement?aC(y.contextElement):[],popper:aC(v)};var te=jxe(Wxe([].concat(a,w.options.modifiers)));return w.orderedModifiers=te.filter(function(ce){return ce.enabled}),F(),V.update()},forceUpdate:function(){if(!N){var J=w.elements,$=J.reference,te=J.popper;if(jY($,te)){w.rects={reference:Vxe($,rR(te),w.options.strategy==="fixed"),popper:Rj(te)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(se){return w.modifiersData[se.name]=Object.assign({},se.data)});for(var ce=0;ce<w.orderedModifiers.length;ce++){if(w.reset===!0){w.reset=!1,ce=-1;continue}var oe=w.orderedModifiers[ce],_e=oe.fn,ne=oe.options,ee=ne===void 0?{}:ne,Q=oe.name;typeof _e=="function"&&(w=_e({state:w,options:ee,name:Q,instance:V})||w)}}}},update:Bxe(function(){return new Promise(function(W){V.forceUpdate(),W(w)})}),destroy:function(){B(),N=!0}};if(!jY(y,v))return V;V.setOptions(b).then(function(W){!N&&b.onFirstUpdate&&b.onFirstUpdate(W)});function F(){w.orderedModifiers.forEach(function(W){var J=W.name,$=W.options,te=$===void 0?{}:$,ce=W.effect;if(typeof ce=="function"){var oe=ce({state:w,name:J,instance:V,options:te}),_e=function(){};A.push(oe||_e)}})}function B(){A.forEach(function(W){return W()}),A=[]}return V}}var Gxe=[fxe,kxe,dxe,exe,Pxe,wxe,xxe,axe,Rxe],Hxe=zxe({defaultModifiers:Gxe});const _S=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),to={arrowShadowColor:_S("--popper-arrow-shadow-color"),arrowSize:_S("--popper-arrow-size","8px"),arrowSizeHalf:_S("--popper-arrow-size-half"),arrowBg:_S("--popper-arrow-bg"),transformOrigin:_S("--popper-transform-origin"),arrowOffset:_S("--popper-arrow-offset")};function $xe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const Kxe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},qxe=n=>Kxe[n],BY={scroll:!0,resize:!0};function Yxe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...BY,...n}}:e={enabled:n,options:BY},e}const Xxe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},Jxe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{WY(n)},effect:({state:n})=>()=>{WY(n)}},WY=n=>{n.elements.popper.style.setProperty(to.transformOrigin.var,qxe(n.placement))},Qxe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{Zxe(n)}},Zxe=n=>{var i;if(!n.placement)return;const e=eLe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:to.arrowSize.varRef,height:to.arrowSize.varRef,zIndex:-1});const a={[to.arrowSizeHalf.var]:`calc(${to.arrowSize.varRef} / 2 - 1px)`,[to.arrowOffset.var]:`calc(${to.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},eLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:to.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:to.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:to.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:to.arrowOffset.varRef}},tLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{zY(n)},effect:({state:n})=>()=>{zY(n)}},zY=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=$xe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:to.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},nLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},rLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function iLe(n,e="ltr"){var a;const i=((a=nLe[n])==null?void 0:a[e])||n;return e==="ltr"?i:rLe[n]??i}function kj(n={}){const{enabled:e=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:y,gutter:v=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:A=!0,matchWidth:N,direction:V="ltr"}=n,F=D.useRef(null),B=D.useRef(null),W=D.useRef(null),J=iLe(a,V),$=D.useRef(()=>{}),te=D.useCallback(()=>{var se;!e||!F.current||!B.current||((se=$.current)==null||se.call($),W.current=Hxe(F.current,B.current,{placement:J,modifiers:[tLe,Qxe,Jxe,{...Xxe,enabled:!!N},{name:"eventListeners",...Yxe(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!A,options:{boundary:w}},...i??[]],strategy:l}),W.current.forceUpdate(),$.current=W.current.destroy)},[J,e,i,N,p,d,y,v,b,A,w,l]);D.useEffect(()=>()=>{var se;!F.current&&!B.current&&((se=W.current)==null||se.destroy(),W.current=null)},[]);const ce=D.useCallback(se=>{F.current=se,te()},[te]),oe=D.useCallback((se={},fe=null)=>({...se,ref:os(ce,fe)}),[ce]),_e=D.useCallback(se=>{B.current=se,te()},[te]),ne=D.useCallback((se={},fe=null)=>({...se,ref:os(_e,fe),style:{...se.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,_e,N]),ee=D.useCallback((se={},fe=null)=>{const{size:pe,shadowColor:ue,bg:Me,style:He,...nt}=se;return{...nt,ref:fe,"data-popper-arrow":"",style:sLe(se)}},[]),Q=D.useCallback((se={},fe=null)=>({...se,ref:fe,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=W.current)==null||se.update()},forceUpdate(){var se;(se=W.current)==null||se.forceUpdate()},transformOrigin:to.transformOrigin.varRef,referenceRef:ce,popperRef:_e,getPopperProps:ne,getArrowProps:ee,getArrowInnerProps:Q,getReferenceProps:oe}}function sLe(n){const{size:e,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return e&&(d["--popper-arrow-size"]=e),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function oLe(){const n=D.useRef(new Map),e=n.current,i=D.useCallback((l,d,p,y)=>{n.current.set(p,{type:d,el:l,options:y}),l.addEventListener(d,p,y)},[]),a=D.useCallback((l,d,p,y)=>{l.removeEventListener(d,p,y),n.current.delete(p)},[]);return D.useEffect(()=>()=>{e.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,e]),{add:i,remove:a}}function z2(n){var l,d;const e=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function mne(n={}){const{ref:e,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:w,tabIndex:A,onMouseOver:N,onMouseLeave:V,...F}=n,[B,W]=D.useState(!0),[J,$]=D.useState(!1),te=oLe(),ce=we=>{we&&we.tagName!=="BUTTON"&&W(!1)},oe=B?A:A||0,_e=i&&!a,ne=D.useCallback(we=>{if(i){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[i,v]),ee=D.useCallback(we=>{J&&z2(we)&&(we.preventDefault(),we.stopPropagation(),$(!1),te.remove(document,"keyup",ee,!1))},[J,te]),Q=D.useCallback(we=>{if(b==null||b(we),i||we.defaultPrevented||we.metaKey||!z2(we.nativeEvent)||B)return;const Re=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),$(!0)),Re&&(we.preventDefault(),we.currentTarget.click()),te.add(document,"keyup",ee,!1)},[i,B,b,l,d,te,ee]),se=D.useCallback(we=>{if(w==null||w(we),i||we.defaultPrevented||we.metaKey||!z2(we.nativeEvent)||B)return;d&&we.key===" "&&(we.preventDefault(),$(!1),we.currentTarget.click())},[d,B,i,w]),fe=D.useCallback(we=>{we.button===0&&($(!1),te.remove(document,"mouseup",fe,!1))},[te]),pe=D.useCallback(we=>{if(we.button!==0)return;if(i){we.stopPropagation(),we.preventDefault();return}B||$(!0),we.currentTarget.focus({preventScroll:!0}),te.add(document,"mouseup",fe,!1),p==null||p(we)},[i,B,p,te,fe]),ue=D.useCallback(we=>{we.button===0&&(B||$(!1),y==null||y(we))},[y,B]),Me=D.useCallback(we=>{if(i){we.preventDefault();return}N==null||N(we)},[i,N]),He=D.useCallback(we=>{J&&(we.preventDefault(),$(!1)),V==null||V(we)},[J,V]),nt=os(e,ce);return B?{...F,ref:nt,type:"button","aria-disabled":_e?void 0:i,disabled:_e,onClick:ne,onMouseDown:p,onMouseUp:y,onKeyUp:w,onKeyDown:b,onMouseOver:N,onMouseLeave:V}:{...F,ref:nt,role:"button","data-active":Xn(J),"aria-disabled":i?"true":void 0,tabIndex:_e?void 0:oe,onClick:ne,onMouseDown:pe,onMouseUp:ue,onKeyUp:se,onKeyDown:Q,onMouseOver:Me,onMouseLeave:He}}const[aLe,cLe,lLe,uLe]=gte(),[dLe,iR]=Fi({strict:!1,name:"MenuContext"});function gne(n){return(n==null?void 0:n.ownerDocument)??document}function hLe(n){return gne(n).activeElement===n}function fLe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:w,placement:A="bottom-start",lazyBehavior:N="unmount",direction:V,computePositionOnMount:F=!1,...B}=n,W=D.useRef(null),J=D.useRef(null),$=D.useRef(!0),te=lLe(),ce=D.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=W.current)==null||Ae.focus({preventScroll:!1})})},[]),oe=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,Ge;if(l)(Ue=l.current)==null||Ue.focus();else if(!te.count())(Ge=W.current)==null||Ge.focus({preventScroll:!1});else{const Qe=te.firstEnabled();Qe&&Me(Qe.index)}});ve.current.add(Ae)},[te,l]),_e=D.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!te.count())(Ue=W.current)==null||Ue.focus({preventScroll:!1});else{const Ge=te.lastEnabled();Ge&&Me(Ge.index)}});ve.current.add(Ae)},[te]),ne=D.useCallback(()=>{w==null||w(),d?oe():ce()},[d,oe,ce,w]),{isOpen:ee,onOpen:Q,onClose:se,onToggle:fe}=of({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:ne});qQ({enabled:ee&&a,ref:W,handler:Ae=>{var Ge,Qe,tt;const Ue=((Qe=(Ge=Ae.composedPath)==null?void 0:Ge.call(Ae))==null?void 0:Qe[0])??Ae.target;(tt=J.current)!=null&&tt.contains(Ue)||se()}});const pe=kj({...B,enabled:ee||F,placement:A,direction:V}),[ue,Me]=D.useState(-1);HQ(W,{focusRef:J,visible:ee,shouldFocus:!0});const He=zQ({isOpen:ee,ref:W}),[nt,we]=bEe(e,"menu-button","menu-list"),Re=D.useCallback(()=>{Q(),ce()},[Q,ce]),ve=D.useRef(new Set([]));D.useEffect(()=>{const Ae=ve.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),vg(()=>{var Ae;ee||(Me(-1),(Ae=W.current)==null||Ae.scrollTo(0,0))},[ee]),vg(()=>{ee&&ue===-1&&ce()},[ue,ee]),D.useEffect(()=>{var Ue;if(!ee)return;const Ae=te.item(ue);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!$.current})},[te,ue,ee]);const Ne=D.useCallback(()=>{Q(),oe()},[oe,Q]),Te=D.useCallback(()=>{$.current=!0,Q(),_e()},[Q,_e]),be=D.useCallback(()=>{var tt,ht;const Ae=gne(W.current),Ue=(tt=W.current)==null?void 0:tt.contains(Ae.activeElement);if(!(ee&&!Ue))return;const Qe=(ht=te.item(ue))==null?void 0:ht.node;Qe==null||Qe.focus({preventScroll:!$.current})},[ee,ue,te]);return{openAndFocusMenu:Re,openAndFocusFirstItem:Ne,openAndFocusLastItem:Te,onTransitionEnd:be,unstable__animationState:He,descendants:te,popper:pe,buttonId:nt,menuId:we,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:ee,onToggle:fe,onOpen:Q,onClose:se,menuRef:W,buttonRef:J,focusedIndex:ue,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:$}}function pLe(n={},e=null){const i=iR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:y}=i,v=D.useCallback(b=>{const w=b.key,N={Enter:d,ArrowDown:d,ArrowUp:p}[w];N&&(y.current=!0,b.preventDefault(),b.stopPropagation(),N(b))},[d,p,y]);return{...n,ref:os(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":Xn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:er(n.onClick,a),onKeyDown:er(n.onKeyDown,v)}}function uV(n){var e;return yLe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function mLe(n={},e=null){const i=iR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:y,menuId:v,isLazy:b,lazyBehavior:w,scrollIntoViewRef:A,unstable__animationState:N}=i,V=cLe(),F=FDe({preventDefault:$=>$.key!==" "&&uV($.target)}),B=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const te=$.key,oe={Tab:ne=>ne.preventDefault(),Escape:ne=>{ne.stopPropagation(),y()},ArrowDown:()=>{A.current=!0;const ne=V.nextEnabled(a)??V.firstEnabled();ne&&l(ne.index)},ArrowUp:()=>{A.current=!0;const ne=V.prevEnabled(a)??V.firstEnabled();ne&&l(ne.index)}}[te];if(oe){$.preventDefault(),oe($);return}const _e=F(ne=>{const ee=UDe(V.values(),ne,Q=>{var se;return((se=Q==null?void 0:Q.node)==null?void 0:se.textContent)??""},V.item(a));if(ee){const Q=V.indexOf(ee.node);l(Q)}});uV($.target)&&_e($)},[V,a,F,y,l,A]),W=D.useRef(!1);p&&(W.current=!0);const J=sF({wasSelected:W.current,enabled:b,mode:w,isSelected:N.present});return{...n,ref:os(d,e),children:J?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:er(n.onKeyDown,B)}}function gLe(n={}){const{popper:e,isOpen:i}=iR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function _Le(n={},e=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:y,isFocusable:v,closeOnSelect:b,type:w,...A}=n,N=iR(),{setFocusedIndex:V,focusedIndex:F,closeOnSelect:B,onClose:W,menuId:J,scrollIntoViewRef:$}=N,te=D.useRef(null),ce=`${J}-menuitem-${D.useId()}`,{index:oe,register:_e}=uLe({disabled:y&&!v}),ne=D.useCallback(Me=>{i==null||i(Me),!y&&($.current=!1,V(oe))},[V,oe,y,i,$]),ee=D.useCallback(Me=>{a==null||a(Me),te.current&&!hLe(te.current)&&ne(Me)},[ne,a]),Q=D.useCallback(Me=>{l==null||l(Me),!y&&V(-1)},[V,y,l]),se=D.useCallback(Me=>{d==null||d(Me),uV(Me.currentTarget)&&(b??B)&&W()},[W,d,B,b]),fe=D.useCallback(Me=>{p==null||p(Me),V(oe)},[V,p,oe]),pe=oe===F,ue=mne({onClick:se,onFocus:fe,onMouseEnter:ne,onMouseMove:ee,onMouseLeave:Q,ref:os(_e,te,e),isDisabled:y,isFocusable:v});return{...A,...ue,type:w??ue.type,id:ce,role:"menuitem",tabIndex:pe?0:-1}}function yLe(n){if(!ELe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function ELe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[vLe,j0]=Fi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),sR=n=>{const{children:e}=n,i=vc("Menu",n),a=Bi(n),{direction:l}=V0(),{descendants:d,...p}=fLe({...a,direction:l}),y=D.useMemo(()=>p,[p]),{isOpen:v,onClose:b,forceUpdate:w}=y;return C.jsx(aLe,{value:d,children:C.jsx(dLe,{value:y,children:C.jsx(vLe,{value:i,children:il(e,{isOpen:v,onClose:b,forceUpdate:w})})})})};sR.displayName="Menu";const SLe=Wt((n,e)=>{const i=j0();return C.jsx(Nt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),oR=Wt((n,e)=>{const{children:i,as:a,...l}=n,d=pLe(l,e),p=a||SLe;return C.jsx(p,{...d,className:dn("chakra-menu__menu-button",n.className),children:C.jsx(Nt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});oR.displayName="MenuButton";const _ne=Wt((n,e)=>{const i=j0();return C.jsx(Nt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});_ne.displayName="MenuCommand";const yne=n=>{const{className:e,...i}=n,a=j0();return C.jsx(Nt.hr,{"aria-orientation":"horizontal",className:dn("chakra-menu__divider",e),...i,__css:a.divider})};yne.displayName="MenuDivider";const Ene=n=>{const{className:e,children:i,...a}=n,l=j0(),d=D.Children.only(i),p=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:dn("chakra-menu__icon",d.props.className)}):null,y=dn("chakra-menu__icon-wrapper",e);return C.jsx(Nt.span,{className:y,...a,__css:l.icon,children:p})};Ene.displayName="MenuIcon";const bLe=Wt((n,e)=>{const{type:i,...a}=n,l=j0(),d=a.as||i?i??void 0:"button",p=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return C.jsx(Nt.button,{ref:e,type:d,...a,__css:p})}),Pd=Wt((n,e)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,...y}=n,v=_Le(y,e),w=i||l?C.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return C.jsxs(bLe,{...v,className:dn("chakra-menu__menuitem",v.className),children:[i&&C.jsx(Ene,{fontSize:"0.8em",marginEnd:a,children:i}),w,l&&C.jsx(_ne,{marginStart:d,children:l})]})});Pd.displayName="MenuItem";const TLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},wLe=Nt(lf.div),aR=Wt(function(e,i){var N;const{rootProps:a,motionProps:l,...d}=e,{isOpen:p,onTransitionEnd:y,unstable__animationState:v}=iR(),b=mLe(d,i),w=gLe(a),A=j0();return C.jsx(Nt.div,{...w,__css:{zIndex:e.zIndex??((N=A.list)==null?void 0:N.zIndex)},children:C.jsx(wLe,{variants:TLe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...A.list},...l,...b,className:dn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:UQ(v.onComplete,b.onAnimationComplete)})})});aR.displayName="MenuList";var CLe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},yS=new WeakMap,TO=new WeakMap,wO={},G2=0,vne=function(n){return n&&(n.host||vne(n.parentNode))},RLe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var a=vne(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},ILe=function(n,e,i,a){var l=RLe(e,Array.isArray(n)?n:[n]);wO[i]||(wO[i]=new WeakMap);var d=wO[i],p=[],y=new Set,v=new Set(l),b=function(A){!A||y.has(A)||(y.add(A),b(A.parentNode))};l.forEach(b);var w=function(A){!A||v.has(A)||Array.prototype.forEach.call(A.children,function(N){if(y.has(N))w(N);else try{var V=N.getAttribute(a),F=V!==null&&V!=="false",B=(yS.get(N)||0)+1,W=(d.get(N)||0)+1;yS.set(N,B),d.set(N,W),p.push(N),B===1&&F&&TO.set(N,!0),W===1&&N.setAttribute(i,"true"),F||N.setAttribute(a,"true")}catch(J){console.error("aria-hidden: cannot operate on ",N,J)}})};return w(e),y.clear(),G2++,function(){p.forEach(function(A){var N=yS.get(A)-1,V=d.get(A)-1;yS.set(A,N),d.set(A,V),N||(TO.has(A)||A.removeAttribute(a),TO.delete(A)),V||A.removeAttribute(i)}),G2--,G2||(yS=new WeakMap,yS=new WeakMap,TO=new WeakMap,wO={})}},ALe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=CLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),ILe(a,l,i,"aria-hidden")):function(){return null}},PLe=Object.defineProperty,OLe=(n,e,i)=>e in n?PLe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,kLe=(n,e,i)=>(OLe(n,e+"",i),i);class NLe{constructor(){kLe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const dV=new NLe;function Sne(n,e){const[i,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(e){const d=dV.add(l);a(d)}return()=>{dV.remove(l),a(0)}}},[e,n]),i}function DLe(n){const{isOpen:e,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:y,onEsc:v}=n,b=D.useRef(null),w=D.useRef(null),[A,N,V]=LLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");xLe(b,e&&p);const F=Sne(b,e),B=D.useRef(null),W=D.useCallback(Q=>{B.current=Q.target},[]),J=D.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),d&&(i==null||i()),v==null||v())},[d,i,v]),[$,te]=D.useState(!1),[ce,oe]=D.useState(!1),_e=D.useCallback((Q={},se=null)=>({role:"dialog",...Q,ref:os(se,b),id:A,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?N:void 0,"aria-describedby":ce?V:void 0,onClick:er(Q.onClick,fe=>fe.stopPropagation())}),[V,ce,A,N,$]),ne=D.useCallback(Q=>{Q.stopPropagation(),B.current===Q.target&&dV.isTopModal(b.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),ee=D.useCallback((Q={},se=null)=>({...Q,ref:os(se,w),onClick:er(Q.onClick,ne),onKeyDown:er(Q.onKeyDown,J),onMouseDown:er(Q.onMouseDown,W)}),[J,W,ne]);return{isOpen:e,onClose:i,headerId:N,bodyId:V,setBodyMounted:oe,setHeaderMounted:te,dialogRef:b,overlayRef:w,getDialogProps:_e,getDialogContainerProps:ee,index:F}}function xLe(n,e){const i=n.current;D.useEffect(()=>{if(!(!n.current||!e))return ALe(n.current)},[e,n,i])}function LLe(n,...e){const i=D.useId(),a=n||i;return D.useMemo(()=>e.map(l=>`${l}-${a}`),[a,e])}const[MLe,B0]=Fi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[ULe,xy]=Fi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Lo=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V,animatePresenceProps:F,onCloseComplete:B}=e,W=vc("Modal",e),$={...DLe(e),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:A,motionPreset:N,lockFocusAcrossFrames:V};return C.jsx(ULe,{value:$,children:C.jsx(MLe,{value:W,children:C.jsx(L0,{...F,onExitComplete:B,children:$.isOpen&&C.jsx(zl,{...i,children:a})})})})};Lo.displayName="Modal";var rk="right-scroll-bar-position",ik="width-before-scroll-bar",VLe="with-scroll-bars-hidden",FLe="--removed-body-scroll-bar-size",bne=Pte(),H2=function(){},k1=D.forwardRef(function(n,e){var i=D.useRef(null),a=D.useState({onScrollCapture:H2,onWheelCapture:H2,onTouchMoveCapture:H2}),l=a[0],d=a[1],p=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,w=n.enabled,A=n.shards,N=n.sideCar,V=n.noIsolation,F=n.inert,B=n.allowPinchZoom,W=n.as,J=W===void 0?"div":W,$=n.gapMode,te=tR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,oe=Rte([i,e]),_e=Wh(Wh({},te),l);return D.createElement(D.Fragment,null,w&&D.createElement(ce,{sideCar:bne,removeScrollBar:b,shards:A,noIsolation:V,inert:F,setCallbacks:d,allowPinchZoom:!!B,lockRef:i,gapMode:$}),p?D.cloneElement(D.Children.only(y),Wh(Wh({},_e),{ref:oe})):D.createElement(J,Wh({},_e,{className:v,ref:oe}),y))});k1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};k1.classNames={fullWidth:ik,zeroRight:rk};var jLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function BLe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=jLe();return e&&n.setAttribute("nonce",e),n}function WLe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function zLe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var GLe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=BLe())&&(WLe(e,i),zLe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},HLe=function(){var n=GLe();return function(e,i){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Tne=function(){var n=HLe(),e=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return e},$Le={left:0,top:0,right:0,gap:0},$2=function(n){return parseInt(n||"",10)||0},KLe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],a=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[$2(i),$2(a),$2(l)]},qLe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return $Le;var e=KLe(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-i+e[2]-e[0])}},YLe=Tne(),n0="data-scroll-locked",XLe=function(n,e,i,a){var l=n.left,d=n.top,p=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(VLe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(y,"px ").concat(a,`;
  }
  body[`).concat(n0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(rk,` {
    right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(ik,` {
    margin-right: `).concat(y,"px ").concat(a,`;
  }
  
  .`).concat(rk," .").concat(rk,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(ik," .").concat(ik,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(n0,`] {
    `).concat(FLe,": ").concat(y,`px;
  }
`)},GY=function(){var n=parseInt(document.body.getAttribute(n0)||"0",10);return isFinite(n)?n:0},JLe=function(){D.useEffect(function(){return document.body.setAttribute(n0,(GY()+1).toString()),function(){var n=GY()-1;n<=0?document.body.removeAttribute(n0):document.body.setAttribute(n0,n.toString())}},[])},QLe=function(n){var e=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;JLe();var d=D.useMemo(function(){return qLe(l)},[l]);return D.createElement(YLe,{styles:XLe(d,!e,l,i?"":"!important")})},hV=!1;if(typeof window<"u")try{var CO=Object.defineProperty({},"passive",{get:function(){return hV=!0,!0}});window.addEventListener("test",CO,CO),window.removeEventListener("test",CO,CO)}catch{hV=!1}var ES=hV?{passive:!1}:!1,ZLe=function(n){return n.tagName==="TEXTAREA"},wne=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!ZLe(n)&&i[e]==="visible")},eMe=function(n){return wne(n,"overflowY")},tMe=function(n){return wne(n,"overflowX")},HY=function(n,e){var i=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Cne(n,a);if(l){var d=Rne(n,a),p=d[1],y=d[2];if(p>y)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},nMe=function(n){var e=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[e,i,a]},rMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[e,i,a]},Cne=function(n,e){return n==="v"?eMe(e):tMe(e)},Rne=function(n,e){return n==="v"?nMe(e):rMe(e)},iMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},sMe=function(n,e,i,a,l){var d=iMe(n,window.getComputedStyle(e).direction),p=d*a,y=i.target,v=e.contains(y),b=!1,w=p>0,A=0,N=0;do{var V=Rne(n,y),F=V[0],B=V[1],W=V[2],J=B-W-d*F;(F||J)&&Cne(n,y)&&(A+=J,N+=F),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(e.contains(y)||e===y));return(w&&Math.abs(A)<1||!w&&Math.abs(N)<1)&&(b=!0),b},RO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},$Y=function(n){return[n.deltaX,n.deltaY]},KY=function(n){return n&&"current"in n?n.current:n},oMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},aMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},cMe=0,vS=[];function lMe(n){var e=D.useRef([]),i=D.useRef([0,0]),a=D.useRef(),l=D.useState(cMe++)[0],d=D.useState(Tne)[0],p=D.useRef(n);D.useEffect(function(){p.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=gNe([n.lockRef.current],(n.shards||[]).map(KY),!0).filter(Boolean);return B.forEach(function(W){return W.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(W){return W.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=D.useCallback(function(B,W){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var J=RO(B),$=i.current,te="deltaX"in B?B.deltaX:$[0]-J[0],ce="deltaY"in B?B.deltaY:$[1]-J[1],oe,_e=B.target,ne=Math.abs(te)>Math.abs(ce)?"h":"v";if("touches"in B&&ne==="h"&&_e.type==="range")return!1;var ee=HY(ne,_e);if(!ee)return!0;if(ee?oe=ne:(oe=ne==="v"?"h":"v",ee=HY(ne,_e)),!ee)return!1;if(!a.current&&"changedTouches"in B&&(te||ce)&&(a.current=oe),!oe)return!0;var Q=a.current||oe;return sMe(Q,W,B,Q==="h"?te:ce)},[]),v=D.useCallback(function(B){var W=B;if(!(!vS.length||vS[vS.length-1]!==d)){var J="deltaY"in W?$Y(W):RO(W),$=e.current.filter(function(oe){return oe.name===W.type&&(oe.target===W.target||W.target===oe.shadowParent)&&oMe(oe.delta,J)})[0];if($&&$.should){W.cancelable&&W.preventDefault();return}if(!$){var te=(p.current.shards||[]).map(KY).filter(Boolean).filter(function(oe){return oe.contains(W.target)}),ce=te.length>0?y(W,te[0]):!p.current.noIsolation;ce&&W.cancelable&&W.preventDefault()}}},[]),b=D.useCallback(function(B,W,J,$){var te={name:B,delta:W,target:J,should:$,shadowParent:uMe(J)};e.current.push(te),setTimeout(function(){e.current=e.current.filter(function(ce){return ce!==te})},1)},[]),w=D.useCallback(function(B){i.current=RO(B),a.current=void 0},[]),A=D.useCallback(function(B){b(B.type,$Y(B),B.target,y(B,n.lockRef.current))},[]),N=D.useCallback(function(B){b(B.type,RO(B),B.target,y(B,n.lockRef.current))},[]);D.useEffect(function(){return vS.push(d),n.setCallbacks({onScrollCapture:A,onWheelCapture:A,onTouchMoveCapture:N}),document.addEventListener("wheel",v,ES),document.addEventListener("touchmove",v,ES),document.addEventListener("touchstart",w,ES),function(){vS=vS.filter(function(B){return B!==d}),document.removeEventListener("wheel",v,ES),document.removeEventListener("touchmove",v,ES),document.removeEventListener("touchstart",w,ES)}},[]);var V=n.removeScrollBar,F=n.inert;return D.createElement(D.Fragment,null,F?D.createElement(d,{styles:aMe(l)}):null,V?D.createElement(QLe,{gapMode:n.gapMode}):null)}function uMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const dMe=_Ne(bne,lMe);var Ine=D.forwardRef(function(n,e){return D.createElement(k1,Wh({},n,{ref:e,sideCar:dMe}))});Ine.classNames=k1.classNames;function hMe(n){const{autoFocus:e,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:A}=xy(),[N,V]=IF();D.useEffect(()=>{!N&&V&&setTimeout(V)},[N,V]);const F=Sne(a,A);return C.jsx(nne,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:w,children:C.jsx(Ine,{removeScrollBar:!b,allowPinchZoom:p,enabled:F===1&&d,forwardProps:!0,children:n.children})})}const fMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Cy.exit(wy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Cy.enter(wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Cy.exit(wy.exit,d),...l?{...p,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...p,...a==null?void 0:a.exit}}}}},Bw={initial:"initial",animate:"enter",exit:"exit",variants:fMe},pMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:p,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:w,delay:A,animatePresenceProps:N,...V}=e,F=a?l&&a:!0,B=l||a?"enter":"exit",W={offsetX:y,offsetY:v,reverse:d,transition:b,transitionEnd:w,delay:A};return C.jsx(L0,{...N,custom:W,children:F&&C.jsx(lf.div,{ref:i,className:dn("chakra-offset-slide",p),custom:W,...Bw,animate:B,...V})})});pMe.displayName="SlideFade";const mMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:e,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Cy.exit(wy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Cy.enter(wy.enter,i),transitionEnd:n==null?void 0:n.enter})},Ane={initial:"exit",animate:"enter",exit:"exit",variants:mMe},gMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:p=.95,className:y,transition:v,transitionEnd:b,delay:w,animatePresenceProps:A,...N}=e,V=a?l&&a:!0,F=l||a?"enter":"exit",B={initialScale:p,reverse:d,transition:v,transitionEnd:b,delay:w};return C.jsx(L0,{...A,custom:B,children:V&&C.jsx(lf.div,{ref:i,className:dn("chakra-offset-slide",y),...Ane,animate:F,custom:B,...N})})});gMe.displayName="ScaleFade";const _Me={slideInBottom:{...Bw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Bw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Bw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Bw,custom:{offsetX:-16,reverse:!0}},scale:{...Ane,custom:{initialScale:.95,reverse:!0}},none:{}},yMe=Nt(lf.section),EMe=n=>_Me[n||"none"],Pne=D.forwardRef((n,e)=>{const{preset:i,motionProps:a=EMe(i),...l}=n;return C.jsx(yMe,{ref:e,...a,...l})});Pne.displayName="ModalTransition";const Mo=Wt((n,e)=>{const{className:i,children:a,containerProps:l,motionProps:d,...p}=n,{getDialogProps:y,getDialogContainerProps:v}=xy(),b=y(p,e),w=v(l),A=dn("chakra-modal__content",i),N=B0(),V={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},F={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:B}=xy();return C.jsx(hMe,{children:C.jsx(Nt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:F,children:C.jsx(Pne,{preset:B,motionProps:d,className:A,...b,__css:V,children:a})})})});Mo.displayName="ModalContent";const Uo=Wt((n,e)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=xy();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__body",i),y=B0();return C.jsx(Nt.div,{ref:e,className:p,id:l,...a,__css:y.body})});Uo.displayName="ModalBody";const ma=Wt((n,e)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=xy(),p=dn("chakra-modal__close-btn",a),y=B0();return C.jsx(aj,{ref:e,__css:y.closeButton,className:p,onClick:er(i,v=>{v.stopPropagation(),d()}),...l})});ma.displayName="ModalCloseButton";const Tg=Wt((n,e)=>{const{className:i,...a}=n,l=dn("chakra-modal__footer",i),d=B0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return C.jsx(Nt.footer,{ref:e,...a,__css:p,className:l})});Tg.displayName="ModalFooter";const yc=Wt((n,e)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=xy();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__header",i),y=B0(),v={flex:0,...y.header};return C.jsx(Nt.header,{ref:e,className:p,id:l,...a,__css:v})});yc.displayName="ModalHeader";const vMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Cy.enter(wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Cy.exit(wy.exit,i),transitionEnd:e==null?void 0:e.exit})},One={initial:"exit",animate:"enter",exit:"exit",variants:vMe},SMe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,className:d,transition:p,transitionEnd:y,delay:v,animatePresenceProps:b,...w}=e,A=l||a?"enter":"exit",N=a?l&&a:!0,V={transition:p,transitionEnd:y,delay:v};return C.jsx(L0,{...b,custom:V,children:N&&C.jsx(lf.div,{ref:i,className:dn("chakra-fade",d),custom:V,...One,animate:A,...w})})});SMe.displayName="Fade";const bMe=Nt(lf.div),Vo=Wt((n,e)=>{const{className:i,transition:a,motionProps:l,...d}=n,p=dn("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...B0().overlay},{motionPreset:b}=xy(),A=l||(b==="none"?{}:One);return C.jsx(bMe,{...A,__css:v,ref:e,className:p,...d})});Vo.displayName="ModalOverlay";function TMe(n){const{leastDestructiveRef:e,...i}=n;return C.jsx(Lo,{...i,initialFocusRef:e})}const wMe=Wt((n,e)=>C.jsx(Mo,{ref:e,role:"alertdialog",...n})),[CMe,N1]=Fi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[RMe,kne]=Fi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),SS={click:"click",hover:"hover"};function IMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:y,arrowShadowColor:v,trigger:b=SS.click,openDelay:w=200,closeDelay:A=200,isLazy:N,lazyBehavior:V="unmount",computePositionOnMount:F,...B}=n,{isOpen:W,onClose:J,onOpen:$,onToggle:te}=of(n),[ce,oe]=D.useState(d);D.useEffect(()=>oe(d),[d]);const _e=D.useRef(null),ne=D.useRef(null),ee=D.useRef(null),Q=D.useRef(!1),se=D.useRef(!1);W&&(se.current=!0);const[fe,pe]=D.useState(!1),[ue,Me]=D.useState(!1),He=D.useId(),nt=l??He,[we,Re,ve,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(Bt=>`${Bt}-${nt}`),{referenceRef:Te,getArrowProps:be,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:Ge}=kj({...B,enabled:W||!!F}),Qe=zQ({isOpen:W,ref:ee});vEe({enabled:W,ref:ne}),HQ(ee,{focusRef:ne,visible:W,shouldFocus:ce&&b===SS.click}),hEe(ee,{focusRef:a,visible:W,shouldFocus:p&&b===SS.click}),qQ({enabled:W&&e,ref:ee,handler(Bt){var Fe;const Ce=((Fe=Bt.composedPath)==null?void 0:Fe.call(Bt)[0])??[Bt.target];IO(ne.current,Ce)||(Ce&&oe(!vk(Ce)),J())}});const tt=sF({wasSelected:se.current,enabled:N,mode:V,isSelected:Qe.present}),ht=D.useCallback((Bt={},Ce=null)=>{const Fe={...Bt,style:{...Bt.style,transformOrigin:to.transformOrigin.varRef,[to.arrowSize.var]:y?`${y}px`:void 0,[to.arrowShadowColor.var]:v},ref:os(ee,Ce),children:tt?Bt.children:null,id:Re,tabIndex:-1,role:"dialog",onKeyDown:er(Bt.onKeyDown,We=>{We.nativeEvent.isComposing||i&&We.key==="Escape"&&(We.preventDefault(),We.stopPropagation(),J())}),onBlur:er(Bt.onBlur,We=>{const at=qY(We),vt=IO(ee.current,at),St=IO(ne.current,at),Gt=!vt&&!St;at&&oe(!vk(at)),W&&e&&Gt&&J()}),"aria-labelledby":fe?ve:void 0,"aria-describedby":ue?Ne:void 0};return b===SS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=er(Bt.onMouseEnter,()=>{Q.current=!0}),Fe.onMouseLeave=er(Bt.onMouseLeave,We=>{We.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>J(),A))})),Fe},[tt,Re,fe,ve,ue,Ne,b,i,J,W,e,A,v,y]),Ze=D.useCallback((Bt={},Ce=null)=>Ae({...Bt,style:{visibility:W?"visible":"hidden",...Bt.style}},Ce),[W,Ae]),Ct=D.useCallback((Bt,Ce=null)=>({...Bt,ref:os(Ce,_e,Te)}),[_e,Te]),un=D.useRef(void 0),Lt=D.useRef(void 0),nn=D.useCallback(Bt=>{_e.current==null&&Te(Bt)},[Te]),kn=D.useCallback((Bt={},Ce=null)=>{const Fe={...Bt,ref:os(ne,Ce,nn),id:we,"aria-haspopup":"dialog","aria-expanded":W,"aria-controls":Re};return b===SS.click&&(Fe.onClick=er(Bt.onClick,te)),b===SS.hover&&(Fe.onFocus=er(Bt.onFocus,()=>{un.current===void 0&&$()}),Fe.onBlur=er(Bt.onBlur,We=>{const at=qY(We),vt=!IO(ee.current,at);W&&e&&vt&&J()}),Fe.onKeyDown=er(Bt.onKeyDown,We=>{We.key==="Escape"&&J()}),Fe.onMouseEnter=er(Bt.onMouseEnter,()=>{Q.current=!0,un.current=window.setTimeout(()=>$(),w)}),Fe.onMouseLeave=er(Bt.onMouseLeave,()=>{Q.current=!1,un.current&&(clearTimeout(un.current),un.current=void 0),Lt.current=window.setTimeout(()=>{Q.current===!1&&J()},A)})),Fe},[we,W,Re,b,nn,te,$,e,J,w,A]);D.useEffect(()=>()=>{un.current&&clearTimeout(un.current),Lt.current&&clearTimeout(Lt.current)},[]);const Kt=D.useCallback((Bt={},Ce=null)=>({...Bt,id:ve,ref:os(Ce,Fe=>{pe(!!Fe)})}),[ve]),zn=D.useCallback((Bt={},Ce=null)=>({...Bt,id:Ne,ref:os(Ce,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:Ge,isOpen:W,onAnimationComplete:Qe.onComplete,onClose:J,getAnchorProps:Ct,getArrowProps:be,getArrowInnerProps:Ue,getPopoverPositionerProps:Ze,getPopoverProps:ht,getTriggerProps:kn,getHeaderProps:Kt,getBodyProps:zn}}function IO(n,e){return n===e||(n==null?void 0:n.contains(e))}function qY(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Nne(n){const e=vc("Popover",n),{children:i,...a}=Bi(n),l=V0(),d=IMe({...a,direction:l.direction});return C.jsx(CMe,{value:d,children:C.jsx(RMe,{value:e,children:il(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Nne.displayName="Popover";function Dne(n){var i;const e=D.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const xne=Wt(function(e,i){const{getBodyProps:a}=N1(),l=kne();return C.jsx(Nt.div,{...a(e,i),className:dn("chakra-popover__body",e.className),__css:l.body})});xne.displayName="PopoverBody";function AMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const PMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},OMe=Nt(lf.section),Lne=Wt(function(e,i){const{variants:a=PMe,...l}=e,{isOpen:d}=N1();return C.jsx(OMe,{ref:i,variants:AMe(a),initial:!1,animate:d?"enter":"exit",...l})});Lne.displayName="PopoverTransition";const Mne=Wt(function(e,i){const{rootProps:a,motionProps:l,...d}=e,{getPopoverProps:p,getPopoverPositionerProps:y,onAnimationComplete:v}=N1(),b=kne(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return C.jsx(Nt.div,{...y(a),__css:b.popper,className:"chakra-popover__popper",children:C.jsx(Lne,{...l,...p(d,i),onAnimationComplete:UQ(v,d.onAnimationComplete),className:dn("chakra-popover__content",e.className),__css:w})})});Mne.displayName="PopoverContent";function Une(n){const e=D.Children.only(n.children),{getTriggerProps:i}=N1();return C.jsx(C.Fragment,{children:D.cloneElement(e,i(e.props,Dne(e)))})}Une.displayName="PopoverTrigger";function kMe(n,e,i){return(n-e)*100/(i-e)}qC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});qC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const NMe=qC({"0%":{left:"-40%"},"100%":{left:"100%"}}),DMe=qC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function xMe(n){const{value:e=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:p,role:y="progressbar"}=n,v=kMe(e,i,a);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof d=="function"?d(e,v):l})(),role:y},percent:v,value:e}}const[LMe,MMe]=Fi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),UMe=Wt((n,e)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:p,...y}=n,v=xMe({value:l,min:i,max:a,isIndeterminate:d,role:p}),w={height:"100%",...MMe().filledTrack};return C.jsx(Nt.div,{ref:e,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:w})}),S0=Wt((n,e)=>{var ne;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:p,children:y,borderRadius:v,isIndeterminate:b,"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,title:V,role:F,...B}=Bi(n),W=vc("Progress",n),J=v??((ne=W.track)==null?void 0:ne.borderRadius),$={animation:`${DMe} 1s linear infinite`},oe={...!b&&d&&p&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${NMe} 1s ease infinite normal none running`}},_e={overflow:"hidden",position:"relative",...W.track};return C.jsx(Nt.div,{ref:e,borderRadius:J,__css:_e,...B,children:C.jsxs(LMe,{value:W,children:[C.jsx(UMe,{"aria-label":w,"aria-labelledby":A,"aria-valuetext":N,min:a,max:l,value:i,isIndeterminate:b,css:oe,borderRadius:J,title:V,role:F}),y]})})});S0.displayName="Progress";const Vne=Wt(function(e,i){const{children:a,placeholder:l,className:d,...p}=e;return C.jsxs(Nt.select,{...p,ref:i,className:dn("chakra-select",d),children:[l&&C.jsx("option",{value:"",children:l}),a]})});Vne.displayName="SelectField";const Fne=Wt((n,e)=>{var te;const i=vc("Select",n),{rootProps:a,placeholder:l,icon:d,color:p,height:y,h:v,minH:b,minHeight:w,iconColor:A,iconSize:N,...V}=Bi(n),[F,B]=rEe(V,vve),W=uj(B),J={width:"100%",height:"fit-content",position:"relative",color:p},$={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(te=i.field)==null?void 0:te._focus}};return C.jsxs(Nt.div,{className:"chakra-select__wrapper",__css:J,...F,...a,children:[C.jsx(Vne,{ref:e,height:v??y,minH:b??w,placeholder:l,...W,__css:$,children:n.children}),C.jsx(jne,{"data-disabled":Xn(W.disabled),...(A||p)&&{color:A||p},__css:i.icon,...N&&{fontSize:N},children:d})]})});Fne.displayName="Select";const VMe=n=>C.jsx("svg",{viewBox:"0 0 24 24",...n,children:C.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),FMe=Nt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),jne=n=>{const{children:e=C.jsx(VMe,{}),...i}=n,a=D.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return C.jsx(FMe,{...i,className:"chakra-select__icon-wrapper",children:D.isValidElement(e)?a:null})};jne.displayName="SelectIcon";function K2(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function jMe(n){const{orientation:e,thumbPercents:i,isReversed:a}=n,l=V=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...K2({orientation:e,vertical:{bottom:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...K2({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,a?100-i[0]:i[0]],b=y?v:i;let w=b[0];!y&&a&&(w=100-w);const A=Math.abs(b[b.length-1]-b[0]),N={...p,...K2({orientation:e,vertical:a?{height:`${A}%`,top:`${w}%`}:{height:`${A}%`,bottom:`${w}%`},horizontal:a?{width:`${A}%`,right:`${w}%`}:{width:`${A}%`,left:`${w}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function BMe(n){const{isReversed:e,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?e:!e}function WMe(n){const{min:e=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:p,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:w,isReadOnly:A,onChangeStart:N,onChangeEnd:V,step:F=1,getAriaValueText:B,"aria-valuetext":W,"aria-label":J,"aria-labelledby":$,name:te,focusThumbOnChange:ce=!0,...oe}=n,_e=sl(N),ne=sl(V),ee=sl(B),Q=BMe({isReversed:p,direction:y,orientation:v}),[se,fe]=GQ({value:l,defaultValue:d??GMe(e,i),onChange:a}),[pe,ue]=D.useState(!1),[Me,He]=D.useState(!1),nt=!(w||A),we=(i-e)/10,Re=F||(i-e)/100,ve=qM(se,e,i),Ne=i-ve+e,be=nK(Q?Ne:ve,e,i),Ae=v==="vertical",Ue=KQ({min:e,max:i,step:F,isDisabled:w,value:ve,isInteractive:nt,isReversed:Q,isVertical:Ae,eventSource:null,focusThumbOnChange:ce,orientation:v}),Ge=D.useRef(null),Qe=D.useRef(null),tt=D.useRef(null),ht=D.useId(),Ze=b??ht,[Ct,un]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],Lt=D.useCallback(Vt=>{var xi;if(!Ge.current)return;const on=Ue.current;on.eventSource="pointer";const Wi=Ge.current.getBoundingClientRect(),{clientX:gs,clientY:Ms}=((xi=Vt.touches)==null?void 0:xi[0])??Vt,ii=Ae?Wi.bottom-Ms:gs-Wi.left,Pt=Ae?Wi.height:Wi.width;let wn=ii/Pt;Q&&(wn=1-wn);let ir=Zye(wn,on.min,on.max);return on.step&&(ir=parseFloat(rK(ir,on.min,on.step))),ir=qM(ir,on.min,on.max),ir},[Ae,Q,Ue]),nn=D.useCallback(Vt=>{const on=Ue.current;on.isInteractive&&(Vt=parseFloat(rK(Vt,on.min,Re)),Vt=qM(Vt,on.min,on.max),fe(Vt))},[Re,fe,Ue]),kn=D.useMemo(()=>({stepUp(Vt=Re){const on=Q?ve-Vt:ve+Vt;nn(on)},stepDown(Vt=Re){const on=Q?ve+Vt:ve-Vt;nn(on)},reset(){nn(d||0)},stepTo(Vt){nn(Vt)}}),[nn,Q,ve,Re,d]),Kt=D.useCallback(Vt=>{const on=Ue.current,gs={ArrowRight:()=>kn.stepUp(),ArrowUp:()=>kn.stepUp(),ArrowLeft:()=>kn.stepDown(),ArrowDown:()=>kn.stepDown(),PageUp:()=>kn.stepUp(we),PageDown:()=>kn.stepDown(we),Home:()=>nn(on.min),End:()=>nn(on.max)}[Vt.key];gs&&(Vt.preventDefault(),Vt.stopPropagation(),gs(Vt),on.eventSource="keyboard")},[kn,nn,we,Ue]),zn=(ee==null?void 0:ee(ve))??W,{getThumbStyle:Bt,rootStyle:Ce,trackStyle:Fe,innerTrackStyle:We}=D.useMemo(()=>{const Vt=Ue.current;return jMe({isReversed:Q,orientation:Vt.orientation,thumbPercents:[be]})},[Q,be,Ue]),at=D.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var on;return(on=Qe.current)==null?void 0:on.focus()})},[Ue]);vg(()=>{const Vt=Ue.current;at(),Vt.eventSource==="keyboard"&&(ne==null||ne(Vt.value))},[ve,ne]);function vt(Vt){const on=Lt(Vt);on!=null&&on!==Ue.current.value&&fe(on)}jEe(tt,{onPanSessionStart(Vt){const on=Ue.current;on.isInteractive&&(ue(!0),at(),vt(Vt),_e==null||_e(on.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(ue(!1),ne==null||ne(Vt.value))},onPan(Vt){Ue.current.isInteractive&&vt(Vt)}});const St=D.useCallback((Vt={},on=null)=>({...Vt,...oe,ref:os(on,tt),tabIndex:-1,"aria-disabled":GS(w),"data-focused":Xn(Me),style:{...Vt.style,...Ce}}),[oe,w,Me,Ce]),Gt=D.useCallback((Vt={},on=null)=>({...Vt,ref:os(on,Ge),id:un,"data-disabled":Xn(w),style:{...Vt.style,...Fe}}),[w,un,Fe]),fn=D.useCallback((Vt={},on=null)=>({...Vt,ref:on,style:{...Vt.style,...We}}),[We]),Ln=D.useCallback((Vt={},on=null)=>({...Vt,ref:os(on,Qe),role:"slider",tabIndex:nt?0:void 0,id:Ct,"data-active":Xn(pe),"aria-valuetext":zn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":ve,"aria-orientation":v,"aria-disabled":GS(w),"aria-readonly":GS(A),"aria-label":J,"aria-labelledby":J?void 0:$,style:{...Vt.style,...Bt(0)},onKeyDown:er(Vt.onKeyDown,Kt),onFocus:er(Vt.onFocus,()=>He(!0)),onBlur:er(Vt.onBlur,()=>He(!1))}),[nt,Ct,pe,zn,e,i,ve,v,w,A,J,$,Bt,Kt]),cn=D.useCallback((Vt,on=null)=>{const Wi=!(Vt.value<e||Vt.value>i),gs=ve>=Vt.value,Ms=nK(Vt.value,e,i),ii={position:"absolute",pointerEvents:"none",...zMe({orientation:v,vertical:{bottom:Q?`${100-Ms}%`:`${Ms}%`},horizontal:{left:Q?`${100-Ms}%`:`${Ms}%`}})};return{...Vt,ref:on,role:"presentation","aria-hidden":!0,"data-disabled":Xn(w),"data-invalid":Xn(!Wi),"data-highlighted":Xn(gs),style:{...Vt.style,...ii}}},[w,Q,i,e,v,ve]),dr=D.useCallback((Vt={},on=null)=>({...Vt,ref:on,type:"hidden",value:ve,name:te}),[te,ve]);return{state:{value:ve,isFocused:Me,isDragging:pe},actions:kn,getRootProps:St,getTrackProps:Gt,getInnerTrackProps:fn,getThumbProps:Ln,getMarkerProps:cn,getInputProps:dr}}function zMe(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function GMe(n,e){return e<n?n:n+(e-n)/2}const[HMe,D1]=Fi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[$Me,x1]=Fi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),fV=Wt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=vc("Slider",i),l=Bi(i),{direction:d}=V0();l.direction=d;const{getInputProps:p,getRootProps:y,...v}=WMe(l),b=y(),w=p({},e);return C.jsx(HMe,{value:v,children:C.jsx($Me,{value:a,children:C.jsxs(Nt.div,{...b,className:dn("chakra-slider",i.className),__css:a.container,children:[i.children,C.jsx("input",{...w})]})})})});fV.displayName="Slider";const pV=Wt((n,e)=>{const{getThumbProps:i}=D1(),a=x1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:dn("chakra-slider__thumb",n.className),__css:a.thumb})});pV.displayName="SliderThumb";const mV=Wt((n,e)=>{const{getTrackProps:i}=D1(),a=x1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:dn("chakra-slider__track",n.className),__css:a.track})});mV.displayName="SliderTrack";const gV=Wt((n,e)=>{const{getInnerTrackProps:i}=D1(),a=x1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:dn("chakra-slider__filled-track",n.className),__css:a.filledTrack})});gV.displayName="SliderFilledTrack";const KMe=Wt((n,e)=>{const{getMarkerProps:i}=D1(),a=x1(),l=i(n,e);return C.jsx(Nt.div,{...l,className:dn("chakra-slider__marker",n.className),__css:a.mark})});KMe.displayName="SliderMark";const Lk=Nt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Lk.displayName="Spacer";const Bne=n=>C.jsx(Nt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Bne.displayName="StackItem";function qMe(n){const{spacing:e,direction:i}=n,a={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":h1(i,l=>a[l])}}const Nj=Wt((n,e)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:p="0.5rem",wrap:y,children:v,divider:b,className:w,shouldWrapChildren:A,...N}=n,V=i?"row":a??"column",F=D.useMemo(()=>qMe({spacing:p,direction:V}),[p,V]),B=!!b,W=!A&&!B,J=D.useMemo(()=>{const te=iF(v);return W?te:te.map((ce,oe)=>{const _e=typeof ce.key<"u"?ce.key:oe,ne=oe+1===te.length,Q=A?C.jsx(Bne,{children:ce},_e):ce;if(!B)return Q;const se=D.cloneElement(b,{__css:F}),fe=ne?null:se;return C.jsxs(D.Fragment,{children:[Q,fe]},_e)})},[b,F,B,W,A,v]),$=dn("chakra-stack",w);return C.jsx(Nt.div,{ref:e,display:"flex",alignItems:l,justifyContent:d,flexDirection:V,flexWrap:y,gap:B?void 0:p,className:$,...N,children:J})});Nj.displayName="Stack";const vi=Wt((n,e)=>C.jsx(Nj,{align:"center",...n,direction:"row",ref:e}));vi.displayName="HStack";const ti=Wt((n,e)=>C.jsx(Nj,{align:"center",...n,direction:"column",ref:e}));ti.displayName="VStack";const Op=Wt(function(e,i){const a=vc("Switch",e),{spacing:l="0.5rem",children:d,...p}=Bi(e),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:w,getLabelProps:A}=iNe(p),N=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),V=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),F=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return C.jsxs(Nt.label,{...w(),className:dn("chakra-switch",e.className),__css:N,children:[C.jsx("input",{className:"chakra-switch__input",...v({},i)}),C.jsx(Nt.span,{...b(),className:"chakra-switch__track",__css:V,children:C.jsx(Nt.span,{__css:a.thumb,className:"chakra-switch__thumb",...y()})}),d&&C.jsx(Nt.span,{className:"chakra-switch__label",...A(),__css:F,children:d})]})});Op.displayName="Switch";const[YMe,XMe,JMe,QMe]=gte();function ZMe(n){const{defaultIndex:e,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[w,A]=D.useState(e??0),[N,V]=GQ({defaultValue:e??0,value:a,onChange:i});D.useEffect(()=>{a!=null&&A(a)},[a]);const F=JMe(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:N,focusedIndex:w,setSelectedIndex:V,setFocusedIndex:A,isManual:l,isLazy:d,lazyBehavior:p,orientation:y,descendants:F,direction:v,htmlProps:b}}const[e2e,L1]=Fi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function t2e(n){const{focusedIndex:e,orientation:i,direction:a}=L1(),l=XMe(),d=D.useCallback(p=>{const y=()=>{var te;const $=l.nextEnabled(e);$&&((te=$.node)==null||te.focus())},v=()=>{var te;const $=l.prevEnabled(e);$&&((te=$.node)==null||te.focus())},b=()=>{var te;const $=l.firstEnabled();$&&((te=$.node)==null||te.focus())},w=()=>{var te;const $=l.lastEnabled();$&&((te=$.node)==null||te.focus())},A=i==="horizontal",N=i==="vertical",V=p.key,F=a==="ltr"?"ArrowLeft":"ArrowRight",B=a==="ltr"?"ArrowRight":"ArrowLeft",J={[F]:()=>A&&v(),[B]:()=>A&&y(),ArrowDown:()=>N&&y(),ArrowUp:()=>N&&v(),Home:b,End:w}[V];J&&(p.preventDefault(),J(p))},[l,e,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:er(n.onKeyDown,d)}}function n2e(n){const{isDisabled:e=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:y,selectedIndex:v}=L1(),{index:b,register:w}=QMe({disabled:e&&!i}),A=b===v,N=()=>{l(b)},V=()=>{y(b),!d&&!(e&&i)&&l(b)};return{...mne({...a,ref:os(w,n.ref),isDisabled:e,isFocusable:i,onClick:er(n.onClick,N)}),id:Wne(p,b),role:"tab",tabIndex:A?0:-1,type:"button","aria-selected":A,"aria-controls":zne(p,b),onFocus:e?void 0:er(n.onFocus,V)}}const[r2e,i2e]=Fi({});function s2e(n){const e=L1(),{id:i,selectedIndex:a}=e,d=iF(n.children).map((p,y)=>D.createElement(r2e,{key:p.key??y,value:{isSelected:y===a,id:zne(i,y),tabId:Wne(i,y),selectedIndex:a}},p));return{...n,children:d}}function o2e(n){const{children:e,...i}=n,{isLazy:a,lazyBehavior:l}=L1(),{isSelected:d,id:p,tabId:y}=i2e(),v=D.useRef(!1);d&&(v.current=!0);const b=sF({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":y,hidden:!d,id:p}}function Wne(n,e){return`${n}--tab-${e}`}function zne(n,e){return`${n}--tabpanel-${e}`}const[a2e,M1]=Fi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),cR=Wt(function(e,i){const a=vc("Tabs",e),{children:l,className:d,...p}=Bi(e),{htmlProps:y,descendants:v,...b}=ZMe(p),w=D.useMemo(()=>b,[b]),{isFitted:A,...N}=y,V={position:"relative",...a.root};return C.jsx(YMe,{value:v,children:C.jsx(e2e,{value:w,children:C.jsx(a2e,{value:a,children:C.jsx(Nt.div,{className:dn("chakra-tabs",d),ref:i,...N,__css:V,children:l})})})})});cR.displayName="Tabs";const mc=Wt(function(e,i){const a=M1(),l=n2e({...e,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return C.jsx(Nt.button,{...l,className:dn("chakra-tabs__tab",e.className),__css:d})});mc.displayName="Tab";const lR=Wt(function(e,i){const a=t2e({...e,ref:i}),l=M1(),d={display:"flex",...l.tablist};return C.jsx(Nt.div,{...a,className:dn("chakra-tabs__tablist",e.className),__css:d})});lR.displayName="TabList";const kl=Wt(function(e,i){const a=o2e({...e,ref:i}),l=M1();return C.jsx(Nt.div,{outline:"0",...a,className:dn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});kl.displayName="TabPanel";const U1=Wt(function(e,i){const a=s2e(e),l=M1();return C.jsx(Nt.div,{...a,width:"100%",ref:i,className:dn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});U1.displayName="TabPanels";const[c2e,Gne]=Fi({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Hne=Wt((n,e)=>{const i=vc("Tag",n),a=Bi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return C.jsx(c2e,{value:i,children:C.jsx(Nt.span,{ref:e,...a,__css:l})})});Hne.displayName="Tag";const $ne=Wt((n,e)=>{const i=Gne();return C.jsx(Nt.span,{ref:e,noOfLines:1,...n,__css:i.label})});$ne.displayName="TagLabel";const l2e=Wt((n,e)=>C.jsx(xn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));l2e.displayName="TagLeftIcon";const u2e=Wt((n,e)=>C.jsx(xn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));u2e.displayName="TagRightIcon";const Kne=n=>C.jsx(xn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:C.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Kne.displayName="TagCloseIcon";const qne=Wt((n,e)=>{const{isDisabled:i,children:a,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Gne().closeButton};return C.jsx(Nt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:a||C.jsx(Kne,{})})});qne.displayName="TagCloseButton";const d2e=["h","minH","height","minHeight"],Yne=Wt((n,e)=>{const i=Wl("Textarea",n),{className:a,rows:l,...d}=Bi(n),p=uj(d),y=l?D0(i,d2e):i;return C.jsx(Nt.textarea,{ref:e,rows:l,...p,className:dn("chakra-textarea",a),__css:y})});Yne.displayName="Textarea";function h2e(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function f2e(n,e){const i=l=>({...e,...l,position:h2e((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),a=l=>{const d=i(l),p=fte(d);return Bh.notify(p,d)};return a.update=(l,d)=>{Bh.update(l,i(d))},a.promise=(l,d)=>{const p=a({...d.loading,status:"loading",duration:null});l.then(y=>a.update(p,{status:"success",duration:5e3,...il(d.success,y)})).catch(y=>a.update(p,{status:"error",duration:5e3,...il(d.error,y)}))},a.closeAll=Bh.closeAll,a.close=Bh.close,a.isActive=Bh.isActive,a}function Gl(n){const{theme:e}=ute(),i=O1e();return D.useMemo(()=>f2e(e.direction,{...i,...n}),[n,e.direction,i])}const p2e={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},_V=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},sk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function m2e(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:w,id:A,isOpen:N,defaultIsOpen:V,arrowSize:F=10,arrowShadowColor:B,arrowPadding:W,modifiers:J,isDisabled:$,gutter:te,offset:ce,direction:oe,..._e}=n,{isOpen:ne,onOpen:ee,onClose:Q}=of({isOpen:N,defaultIsOpen:V,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:fe,getArrowInnerProps:pe,getArrowProps:ue}=kj({enabled:ne,placement:w,arrowPadding:W,modifiers:J,gutter:te,offset:ce,direction:oe}),Me=D.useId(),nt=`tooltip-${A??Me}`,we=D.useRef(null),Re=D.useRef(void 0),ve=D.useCallback(()=>{Re.current&&(clearTimeout(Re.current),Re.current=void 0)},[]),Ne=D.useRef(void 0),Te=D.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),be=D.useCallback(()=>{Te(),Q()},[Q,Te]),Ae=g2e(we,be),Ue=D.useCallback(()=>{if(!$&&!Re.current){ne&&Ae();const Lt=sk(we);Re.current=Lt.setTimeout(ee,e)}},[Ae,$,ne,ee,e]),Ge=D.useCallback(()=>{ve();const Lt=sk(we);Ne.current=Lt.setTimeout(be,i)},[i,be,ve]),Qe=D.useCallback(()=>{ne&&a&&Ge()},[a,Ge,ne]),tt=D.useCallback(()=>{ne&&p&&Ge()},[p,Ge,ne]),ht=D.useCallback(Lt=>{ne&&Lt.key==="Escape"&&Ge()},[ne,Ge]);HS(()=>_V(we),"keydown",y?ht:void 0),HS(()=>{if(!d)return null;const Lt=we.current;if(!Lt)return null;const nn=WQ(Lt);return nn.localName==="body"?sk(we):nn},"scroll",()=>{ne&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(ve(),ne&&Q())},[$,ne,Q,ve]),D.useEffect(()=>()=>{ve(),Te()},[ve,Te]),HS(()=>we.current,"pointerleave",Ge);const Ze=D.useCallback((Lt={},nn=null)=>({...Lt,ref:os(we,nn,se),onPointerEnter:er(Lt.onPointerEnter,Kt=>{Kt.pointerType!=="touch"&&Ue()}),onClick:er(Lt.onClick,Qe),onPointerDown:er(Lt.onPointerDown,tt),onFocus:er(Lt.onFocus,Ue),onBlur:er(Lt.onBlur,Ge),"aria-describedby":ne?nt:void 0}),[Ue,Ge,tt,ne,nt,Qe,se]),Ct=D.useCallback((Lt={},nn=null)=>fe({...Lt,style:{...Lt.style,[to.arrowSize.var]:F?`${F}px`:void 0,[to.arrowShadowColor.var]:B}},nn),[fe,F,B]),un=D.useCallback((Lt={},nn=null)=>{const kn={...Lt.style,position:"relative",transformOrigin:to.transformOrigin.varRef};return{ref:nn,..._e,...Lt,id:nt,role:"tooltip",style:kn}},[_e,nt]);return{isOpen:ne,show:Ue,hide:Ge,getTriggerProps:Ze,getTooltipProps:un,getTooltipPositionerProps:Ct,getArrowProps:ue,getArrowInnerProps:pe}}const q2="chakra-ui:close-tooltip";function g2e(n,e){return D.useEffect(()=>{const i=_V(n);return i.addEventListener(q2,e),()=>i.removeEventListener(q2,e)},[e,n]),()=>{const i=_V(n),a=sk(n);i.dispatchEvent(new a.CustomEvent(q2))}}const _2e=Nt(lf.div),kp=Wt((n,e)=>{const i=Wl("Tooltip",n),a=Bi(n),l=V0(),{children:d,label:p,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:w,portalProps:A,background:N,backgroundColor:V,bgColor:F,motionProps:B,animatePresenceProps:W,...J}=a,$=N??V??w??F;if($){i.bg=$;const se=Ove(l,"colors",$);i[to.arrowBg.var]=se}const te=m2e({...J,direction:l.direction}),ce=!D.isValidElement(d)||y;let oe;if(ce)oe=C.jsx(Nt.span,{display:"inline-block",tabIndex:0,...te.getTriggerProps(),children:d});else{const se=D.Children.only(d);oe=D.cloneElement(se,te.getTriggerProps(se.props,Dne(se)))}const _e=!!v,ne=te.getTooltipProps({},e),ee=_e?D0(ne,["role","id"]):ne,Q=BQ(ne,["role","id"]);return p?C.jsxs(C.Fragment,{children:[oe,C.jsx(L0,{...W,children:te.isOpen&&C.jsx(zl,{...A,children:C.jsx(Nt.div,{...te.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:C.jsxs(_2e,{variants:p2e,initial:"exit",animate:"enter",exit:"exit",...B,...ee,__css:i,children:[p,_e&&C.jsx(Nt.span,{srOnly:!0,...Q,children:v}),b&&C.jsx(Nt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:C.jsx(Nt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):C.jsx(C.Fragment,{children:d})});kp.displayName="Tooltip";const Mk=Wt(function(e,i){const a=Wl("Heading",e),{className:l,...d}=Bi(e);return C.jsx(Nt.h2,{ref:i,className:dn("chakra-heading",e.className),...d,__css:a})});Mk.displayName="Heading";const ot=Wt(function(e,i){const a=Wl("Text",e),{className:l,align:d,decoration:p,casing:y,...v}=Bi(e),b=d1({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return C.jsx(Nt.p,{ref:i,className:dn("chakra-text",e.className),...b,...v,__css:a})});ot.displayName="Text";const Xne=Wt(function(e,i){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:p,justify:y,direction:v,align:b,className:w,shouldWrapChildren:A,...N}=e,V=D.useMemo(()=>A?D.Children.map(p,(F,B)=>C.jsx(Dj,{children:F},B)):p,[p,A]);return C.jsx(Nt.div,{ref:i,className:dn("chakra-wrap",w),...N,children:C.jsx(Nt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:V})})});Xne.displayName="Wrap";const Dj=Wt(function(e,i){const{className:a,...l}=e;return C.jsx(Nt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:dn("chakra-wrap__listitem",a),...l})});Dj.displayName="WrapItem";const y2e="modulepreload",E2e=function(n,e){return new URL(n,e).href},YY={},Y2=function(e,i,a){let l=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),v=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=E2e(b,a),b in YY)return;YY[b]=!0;const w=b.endsWith(".css"),A=w?'[rel="stylesheet"]':"";if(!!a)for(let F=p.length-1;F>=0;F--){const B=p[F];if(B.href===b&&(!w||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${A}`))return;const V=document.createElement("link");if(V.rel=w?"stylesheet":y2e,w||(V.as="script"),V.crossOrigin="",V.href=b,v&&V.setAttribute("nonce",v),document.head.appendChild(V),w)return new Promise((F,B)=>{V.addEventListener("load",F),V.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return l.then(p=>{for(const y of p||[])y.status==="rejected"&&d(y.reason);return e().catch(d)})},AO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${a}.${l}`},he={log:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${AO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${AO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${AO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${AO()}] ${n}`)}};async function DC(n){let e;try{switch(n){case"default":e=await Y2(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await Y2(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return he.error("Failed to load theme:",i),e=await Y2(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const v2e=()=>{};var XY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jne=function(n){const e=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},S2e=function(n){const e=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];e[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],p=n[i++],y=n[i++],v=((l&7)<<18|(d&63)<<12|(p&63)<<6|y&63)-65536;e[a++]=String.fromCharCode(55296+(v>>10)),e[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[i++],p=n[i++];e[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return e.join("")},Qne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,y=p?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,w=d>>2,A=(d&3)<<4|y>>4;let N=(y&15)<<2|b>>6,V=b&63;v||(V=64,p||(N=64)),a.push(i[w],i[A],i[N],i[V])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Jne(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):S2e(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const A=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||y==null||b==null||A==null)throw new b2e;const N=d<<2|y>>4;if(a.push(N),b!==64){const V=y<<4&240|b>>2;if(a.push(V),A!==64){const F=b<<6&192|A;a.push(F)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class b2e extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const T2e=function(n){const e=Jne(n);return Qne.encodeByteArray(e,!0)},Uk=function(n){return T2e(n).replace(/\./g,"")},Zne=function(n){try{return Qne.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2e(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2e=()=>w2e().__FIREBASE_DEFAULTS__,R2e=()=>{if(typeof process>"u"||typeof XY>"u")return;const n=XY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},I2e=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Zne(n[1]);return e&&JSON.parse(e)},V1=()=>{try{return v2e()||C2e()||R2e()||I2e()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ere=n=>{var e,i;return(i=(e=V1())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},tre=n=>{const e=ere(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),a]:[e.substring(0,i),a]},nre=()=>{var n;return(n=V1())===null||n===void 0?void 0:n.config},rre=n=>{var e;return(e=V1())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A2e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ire(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=e||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Uk(JSON.stringify(i)),Uk(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ya(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function P2e(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ya())}function O2e(){var n;const e=(n=V1())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function k2e(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function N2e(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function D2e(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function x2e(){const n=Ya();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function L2e(){return!O2e()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function M2e(){try{return typeof indexedDB=="object"}catch{return!1}}function U2e(){return new Promise((n,e)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;e(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2e="FirebaseError";class hf extends Error{constructor(e,i,a){super(i),this.code=e,this.customData=a,this.name=V2e,Object.setPrototypeOf(this,hf.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uR.prototype.create)}}class uR{constructor(e,i,a){this.service=e,this.serviceName=i,this.errors=a}create(e,...i){const a=i[0]||{},l=`${this.service}/${e}`,d=this.errors[e],p=d?F2e(d,a):"Error",y=`${this.serviceName}: ${p} (${l}).`;return new hf(l,y,a)}}function F2e(n,e){return n.replace(j2e,(i,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const j2e=/\{\$([^}]+)}/g;function B2e(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Up(n,e){if(n===e)return!0;const i=Object.keys(n),a=Object.keys(e);for(const l of i){if(!a.includes(l))return!1;const d=n[l],p=e[l];if(JY(d)&&JY(p)){if(!Up(d,p))return!1}else if(d!==p)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function JY(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dR(n){const e=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function Ww(n){const e={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(d)}}),e}function zw(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function W2e(n,e){const i=new z2e(n,e);return i.subscribe.bind(i)}class z2e{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,a){let l;if(e===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");G2e(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:a},l.next===void 0&&(l.next=X2),l.error===void 0&&(l.error=X2),l.complete===void 0&&(l.complete=X2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function G2e(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function X2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vi(n){return n&&n._delegate?n._delegate:n}class wg{constructor(e,i,a){this.name=e,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H2e{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const a=new A2e;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(K2e(e))try{this.getOrInitializeService({instanceIdentifier:uy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(e=uy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=uy){return this.instances.has(e)}getOptions(e=uy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,p]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(d);a===y&&p.resolve(l)}return l}onInit(e,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(e),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&e(p,l),()=>{d.delete(e)}}invokeOnInitCallbacks(e,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:$2e(e),options:i}),this.instances.set(e,a),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=uy){return this.component?this.component.multipleInstances?e:uy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $2e(n){return n===uy?void 0:n}function K2e(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2e{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new H2e(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var wr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(wr||(wr={}));const Y2e={debug:wr.DEBUG,verbose:wr.VERBOSE,info:wr.INFO,warn:wr.WARN,error:wr.ERROR,silent:wr.SILENT},X2e=wr.INFO,J2e={[wr.DEBUG]:"log",[wr.VERBOSE]:"log",[wr.INFO]:"info",[wr.WARN]:"warn",[wr.ERROR]:"error"},Q2e=(n,e,...i)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),l=J2e[e];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class xj{constructor(e){this.name=e,this._logLevel=X2e,this._logHandler=Q2e,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in wr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Y2e[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,wr.DEBUG,...e),this._logHandler(this,wr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,wr.VERBOSE,...e),this._logHandler(this,wr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,wr.INFO,...e),this._logHandler(this,wr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,wr.WARN,...e),this._logHandler(this,wr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,wr.ERROR,...e),this._logHandler(this,wr.ERROR,...e)}}const Z2e=(n,e)=>e.some(i=>n instanceof i);let QY,ZY;function eUe(){return QY||(QY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tUe(){return ZY||(ZY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const sre=new WeakMap,yV=new WeakMap,ore=new WeakMap,J2=new WeakMap,Lj=new WeakMap;function nUe(n){const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{i(pg(n.result)),l()},p=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&sre.set(i,n)}).catch(()=>{}),Lj.set(e,n),e}function rUe(n){if(yV.has(n))return;const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{i(),l()},p=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});yV.set(n,e)}let EV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return yV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||ore.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return pg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function iUe(n){EV=n(EV)}function sUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const a=n.call(Q2(this),e,...i);return ore.set(a,e.sort?e.sort():[e]),pg(a)}:tUe().includes(n)?function(...e){return n.apply(Q2(this),e),pg(sre.get(this))}:function(...e){return pg(n.apply(Q2(this),e))}}function oUe(n){return typeof n=="function"?sUe(n):(n instanceof IDBTransaction&&rUe(n),Z2e(n,eUe())?new Proxy(n,EV):n)}function pg(n){if(n instanceof IDBRequest)return nUe(n);if(J2.has(n))return J2.get(n);const e=oUe(n);return e!==n&&(J2.set(n,e),Lj.set(e,n)),e}const Q2=n=>Lj.get(n);function aUe(n,e,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const p=indexedDB.open(n,e),y=pg(p);return a&&p.addEventListener("upgradeneeded",v=>{a(pg(p.result),v.oldVersion,v.newVersion,pg(p.transaction),v)}),i&&p.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const cUe=["get","getKey","getAll","getAllKeys","count"],lUe=["put","add","delete","clear"],Z2=new Map;function eX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Z2.get(e))return Z2.get(e);const i=e.replace(/FromIndex$/,""),a=e!==i,l=lUe.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||cUe.includes(i)))return;const d=async function(p,...y){const v=this.transaction(p,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(y.shift())),(await Promise.all([b[i](...y),l&&v.done]))[0]};return Z2.set(e,d),d}iUe(n=>({...n,get:(e,i,a)=>eX(e,i)||n.get(e,i,a),has:(e,i)=>!!eX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uUe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(dUe(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function dUe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const vV="@firebase/app",tX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vp=new xj("@firebase/app"),hUe="@firebase/app-compat",fUe="@firebase/analytics-compat",pUe="@firebase/analytics",mUe="@firebase/app-check-compat",gUe="@firebase/app-check",_Ue="@firebase/auth",yUe="@firebase/auth-compat",EUe="@firebase/database",vUe="@firebase/data-connect",SUe="@firebase/database-compat",bUe="@firebase/functions",TUe="@firebase/functions-compat",wUe="@firebase/installations",CUe="@firebase/installations-compat",RUe="@firebase/messaging",IUe="@firebase/messaging-compat",AUe="@firebase/performance",PUe="@firebase/performance-compat",OUe="@firebase/remote-config",kUe="@firebase/remote-config-compat",NUe="@firebase/storage",DUe="@firebase/storage-compat",xUe="@firebase/firestore",LUe="@firebase/vertexai",MUe="@firebase/firestore-compat",UUe="firebase",VUe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SV="[DEFAULT]",FUe={[vV]:"fire-core",[hUe]:"fire-core-compat",[pUe]:"fire-analytics",[fUe]:"fire-analytics-compat",[gUe]:"fire-app-check",[mUe]:"fire-app-check-compat",[_Ue]:"fire-auth",[yUe]:"fire-auth-compat",[EUe]:"fire-rtdb",[vUe]:"fire-data-connect",[SUe]:"fire-rtdb-compat",[bUe]:"fire-fn",[TUe]:"fire-fn-compat",[wUe]:"fire-iid",[CUe]:"fire-iid-compat",[RUe]:"fire-fcm",[IUe]:"fire-fcm-compat",[AUe]:"fire-perf",[PUe]:"fire-perf-compat",[OUe]:"fire-rc",[kUe]:"fire-rc-compat",[NUe]:"fire-gcs",[DUe]:"fire-gcs-compat",[xUe]:"fire-fst",[MUe]:"fire-fst-compat",[LUe]:"fire-vertex","fire-js":"fire-js",[UUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk=new Map,jUe=new Map,bV=new Map;function nX(n,e){try{n.container.addComponent(e)}catch(i){Vp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Ly(n){const e=n.name;if(bV.has(e))return Vp.debug(`There were multiple attempts to register component ${e}.`),!1;bV.set(e,n);for(const i of Vk.values())nX(i,n);for(const i of jUe.values())nX(i,n);return!0}function F1(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Nl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BUe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mg=new uR("app","Firebase",BUe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WUe{constructor(e,i,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new wg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $y=VUe;function are(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const a=Object.assign({name:SV,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw mg.create("bad-app-name",{appName:String(l)});if(i||(i=nre()),!i)throw mg.create("no-options");const d=Vk.get(l);if(d){if(Up(i,d.options)&&Up(a,d.config))return d;throw mg.create("duplicate-app",{appName:l})}const p=new q2e(l);for(const v of bV.values())p.addComponent(v);const y=new WUe(i,a,p);return Vk.set(l,y),y}function Mj(n=SV){const e=Vk.get(n);if(!e&&n===SV&&nre())return are();if(!e)throw mg.create("no-app",{appName:n});return e}function ef(n,e,i){var a;let l=(a=FUe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),p=e.match(/\s|\//);if(d||p){const y=[`Unable to register library "${l}" with version "${e}":`];d&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&y.push("and"),p&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Vp.warn(y.join(" "));return}Ly(new wg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zUe="firebase-heartbeat-database",GUe=1,xC="firebase-heartbeat-store";let eU=null;function cre(){return eU||(eU=aUe(zUe,GUe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(xC)}catch(i){console.warn(i)}}}}).catch(n=>{throw mg.create("idb-open",{originalErrorMessage:n.message})})),eU}async function HUe(n){try{const i=(await cre()).transaction(xC),a=await i.objectStore(xC).get(lre(n));return await i.done,a}catch(e){if(e instanceof hf)Vp.warn(e.message);else{const i=mg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Vp.warn(i.message)}}}async function rX(n,e){try{const a=(await cre()).transaction(xC,"readwrite");await a.objectStore(xC).put(e,lre(n)),await a.done}catch(i){if(i instanceof hf)Vp.warn(i.message);else{const a=mg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Vp.warn(a.message)}}}function lre(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Ue=1024,KUe=30;class qUe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new XUe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=iX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>KUe){const p=JUe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Vp.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=iX(),{heartbeatsToSend:a,unsentEntries:l}=YUe(this._heartbeatsCache.heartbeats),d=Uk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Vp.warn(i),""}}}function iX(){return new Date().toISOString().substring(0,10)}function YUe(n,e=$Ue){const i=[];let a=n.slice();for(const l of n){const d=i.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),sX(i)>e){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),sX(i)>e){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class XUe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return M2e()?U2e().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await HUe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return rX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return rX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function sX(n){return Uk(JSON.stringify({version:2,heartbeats:n})).length}function JUe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QUe(n){Ly(new wg("platform-logger",e=>new uUe(e),"PRIVATE")),Ly(new wg("heartbeat",e=>new qUe(e),"PRIVATE")),ef(vV,tX,n),ef(vV,tX,"esm2017"),ef("fire-js","")}QUe("");function ure(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ZUe=ure,dre=new uR("auth","Firebase",ure());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fk=new xj("@firebase/auth");function eVe(n,...e){Fk.logLevel<=wr.WARN&&Fk.warn(`Auth (${$y}): ${n}`,...e)}function ok(n,...e){Fk.logLevel<=wr.ERROR&&Fk.error(`Auth (${$y}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(n,...e){throw Uj(n,...e)}function tf(n,...e){return Uj(n,...e)}function hre(n,e,i){const a=Object.assign(Object.assign({},ZUe()),{[e]:i});return new uR("auth","Firebase",a).create(e,{appName:n.name})}function Np(n){return hre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Uj(n,...e){if(typeof n!="string"){const i=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return dre.create(n,...e)}function Un(n,e,...i){if(!n)throw Uj(e,...i)}function bp(n){const e="INTERNAL ASSERTION FAILED: "+n;throw ok(e),new Error(e)}function Fp(n,e){n||bp(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function tVe(){return oX()==="http:"||oX()==="https:"}function oX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nVe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tVe()||N2e()||"connection"in navigator)?navigator.onLine:!0}function rVe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Fp(i>e,"Short delay should be less than long delay!"),this.isMobile=P2e()||D2e()}get(){return nVe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vj(n,e){Fp(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fre{static initialize(e,i,a){this.fetchImpl=e,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;bp("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;bp("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;bp("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iVe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sVe=new hR(3e4,6e4);function Wp(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function zp(n,e,i,a,l={}){return pre(n,l,async()=>{let d={},p={};a&&(e==="GET"?p=a:d={body:JSON.stringify(a)});const y=dR(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:v},d);return k2e()||(b.referrerPolicy="no-referrer"),fre.fetch()(mre(n,n.config.apiHost,i,y),b)})}async function pre(n,e,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},iVe),e);try{const l=new aVe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw PO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const y=d.ok?p.errorMessage:p.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw PO(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw PO(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw PO(n,"user-disabled",p);const w=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw hre(n,w,b);Ld(n,w)}}catch(l){if(l instanceof hf)throw l;Ld(n,"network-request-failed",{message:String(l)})}}async function fR(n,e,i,a,l={}){const d=await zp(n,e,i,a,l);return"mfaPendingCredential"in d&&Ld(n,"multi-factor-auth-required",{_serverResponse:d}),d}function mre(n,e,i,a){const l=`${e}${i}?${a}`;return n.config.emulator?Vj(n.config,l):`${n.config.apiScheme}://${l}`}function oVe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class aVe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(tf(this.auth,"network-request-failed")),sVe.get())})}}function PO(n,e,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=tf(n,e,a);return l.customData._tokenResponse=i,l}function aX(n){return n!==void 0&&n.enterprise!==void 0}class cVe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return oVe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function lVe(n,e){return zp(n,"GET","/v2/recaptchaConfig",Wp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uVe(n,e){return zp(n,"POST","/v1/accounts:delete",e)}async function gre(n,e){return zp(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function dVe(n,e=!1){const i=Vi(n),a=await i.getIdToken(e),l=Fj(a);Un(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:cC(tU(l.auth_time)),issuedAtTime:cC(tU(l.iat)),expirationTime:cC(tU(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function tU(n){return Number(n)*1e3}function Fj(n){const[e,i,a]=n.split(".");if(e===void 0||i===void 0||a===void 0)return ok("JWT malformed, contained fewer than 3 sections"),null;try{const l=Zne(i);return l?JSON.parse(l):(ok("Failed to decode base64 JWT payload"),null)}catch(l){return ok("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function cX(n){const e=Fj(n);return Un(e,"internal-error"),Un(typeof e.exp<"u","internal-error"),Un(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LC(n,e,i=!1){if(i)return e;try{return await e}catch(a){throw a instanceof hf&&hVe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function hVe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fVe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=cC(this.lastLoginAt),this.creationTime=cC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(n){var e;const i=n.auth,a=await n.getIdToken(),l=await LC(n,gre(i,{idToken:a}));Un(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?_re(d.providerUserInfo):[],y=mVe(n.providerData,p),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(y!=null&&y.length),w=v?b:!1,A={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:y,metadata:new wV(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,A)}async function pVe(n){const e=Vi(n);await jk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function mVe(n,e){return[...n.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function _re(n){return n.map(e=>{var{providerId:i}=e,a=tR(e,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gVe(n,e){const i=await pre(n,{},async()=>{const a=dR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=mre(n,l,"/v1/token",`key=${d}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",fre.fetch()(p,{method:"POST",headers:y,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function _Ve(n,e){return zp(n,"POST","/v2/accounts:revokeToken",Wp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Un(e.idToken,"internal-error"),Un(typeof e.idToken<"u","internal-error"),Un(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):cX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Un(e.length!==0,"internal-error");const i=cX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Un(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await gVe(e,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(e,i,a){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,p=new r0;return a&&(Un(typeof a=="string","internal-error",{appName:e}),p.refreshToken=a),l&&(Un(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),d&&(Un(typeof d=="number","internal-error",{appName:e}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new r0,this.toJSON())}_performRefresh(){return bp("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(n,e){Un(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Tp{constructor(e){var{uid:i,auth:a,stsTokenManager:l}=e,d=tR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fVe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new wV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const i=await LC(this,this.stsTokenManager.getToken(this.auth,e));return Un(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return dVe(this,e)}reload(){return pVe(this)}_assign(e){this!==e&&(Un(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Tp(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Un(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),i&&await jk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Nl(this.auth.app))return Promise.reject(Np(this.auth));const e=await this.getIdToken();return await LC(this,uVe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var a,l,d,p,y,v,b,w;const A=(a=i.displayName)!==null&&a!==void 0?a:void 0,N=(l=i.email)!==null&&l!==void 0?l:void 0,V=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,F=(p=i.photoURL)!==null&&p!==void 0?p:void 0,B=(y=i.tenantId)!==null&&y!==void 0?y:void 0,W=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,J=(b=i.createdAt)!==null&&b!==void 0?b:void 0,$=(w=i.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:te,emailVerified:ce,isAnonymous:oe,providerData:_e,stsTokenManager:ne}=i;Un(te&&ne,e,"internal-error");const ee=r0.fromJSON(this.name,ne);Un(typeof te=="string",e,"internal-error"),tg(A,e.name),tg(N,e.name),Un(typeof ce=="boolean",e,"internal-error"),Un(typeof oe=="boolean",e,"internal-error"),tg(V,e.name),tg(F,e.name),tg(B,e.name),tg(W,e.name),tg(J,e.name),tg($,e.name);const Q=new Tp({uid:te,auth:e,email:N,emailVerified:ce,displayName:A,isAnonymous:oe,photoURL:F,phoneNumber:V,tenantId:B,stsTokenManager:ee,createdAt:J,lastLoginAt:$});return _e&&Array.isArray(_e)&&(Q.providerData=_e.map(se=>Object.assign({},se))),W&&(Q._redirectEventId=W),Q}static async _fromIdTokenResponse(e,i,a=!1){const l=new r0;l.updateFromServerResponse(i);const d=new Tp({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await jk(d),d}static async _fromGetAccountInfoResponse(e,i,a){const l=i.users[0];Un(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?_re(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),y=new r0;y.updateFromIdToken(a);const v=new Tp({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new wV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lX=new Map;function wp(n){Fp(n instanceof Function,"Expected a class definition");let e=lX.get(n);return e?(Fp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,lX.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}yre.type="NONE";const uX=yre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ak(n,e,i){return`firebase:${n}:${e}:${i}`}class i0{constructor(e,i,a){this.persistence=e,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=ak(this.userKey,l.apiKey,d),this.fullPersistenceKey=ak("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Tp._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,a="authUser"){if(!i.length)return new i0(wp(uX),e,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||wp(uX);const p=ak(a,e.config.apiKey,e.name);let y=null;for(const b of i)try{const w=await b._get(p);if(w){const A=Tp._fromJSON(e,w);b!==d&&(y=A),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new i0(d,e,a):(d=v[0],y&&await d._set(p,y.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new i0(d,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dX(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(bre(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ere(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(wre(e))return"Blackberry";if(Cre(e))return"Webos";if(vre(e))return"Safari";if((e.includes("chrome/")||Sre(e))&&!e.includes("edge/"))return"Chrome";if(Tre(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Ere(n=Ya()){return/firefox\//i.test(n)}function vre(n=Ya()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Sre(n=Ya()){return/crios\//i.test(n)}function bre(n=Ya()){return/iemobile/i.test(n)}function Tre(n=Ya()){return/android/i.test(n)}function wre(n=Ya()){return/blackberry/i.test(n)}function Cre(n=Ya()){return/webos/i.test(n)}function jj(n=Ya()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function yVe(n=Ya()){var e;return jj(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function EVe(){return x2e()&&document.documentMode===10}function Rre(n=Ya()){return jj(n)||Tre(n)||Cre(n)||wre(n)||/windows phone/i.test(n)||bre(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ire(n,e=[]){let i;switch(n){case"Browser":i=dX(Ya());break;case"Worker":i=`${dX(Ya())}-${n}`;break;default:i=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${$y}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vVe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const a=d=>new Promise((p,y)=>{try{const v=e(d);p(v)}catch(v){y(v)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const a of this.queue)await a(e),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SVe(n,e={}){return zp(n,"GET","/v2/passwordPolicy",Wp(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bVe=6;class TVe{constructor(e){var i,a,l,d;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:bVe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,a,l,d,p,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(e,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=e.length>=a),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wVe{constructor(e,i,a,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hX(this),this.idTokenSubscription=new hX(this),this.beforeStateQueue=new vVe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=wp(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await i0.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await gre(this,{idToken:e}),a=await Tp._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Nl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(y,y))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!p||p===y)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Un(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await jk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=rVe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Nl(this.app))return Promise.reject(Np(this));const i=e?Vi(e):null;return i&&Un(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Un(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Nl(this.app)?Promise.reject(Np(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Nl(this.app)?Promise.reject(Np(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(wp(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await SVe(this),i=new TVe(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new uR("auth","Firebase",e())}onAuthStateChanged(e,i,a){return this.registerStateListener(this.authStateSubscription,e,i,a)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,a){return this.registerStateListener(this.idTokenSubscription,e,i,a)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await _Ve(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const a=await this.getOrInitRedirectPersistenceManager(i);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&wp(e)||this._popupRedirectResolver;Un(i,this,"argument-error"),this.redirectPersistenceManager=await i0.create(this,[wp(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let p=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Un(y,this,"internal-error"),y.then(()=>{p||d(this.currentUser)}),typeof i=="function"){const v=e.addObserver(i,a,l);return()=>{p=!0,v()}}else{const v=e.addObserver(i);return()=>{p=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Un(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ire(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Nl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&eVe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Lg(n){return Vi(n)}class hX{constructor(e){this.auth=e,this.observer=null,this.addObserver=W2e(i=>this.observer=i)}get next(){return Un(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function CVe(n){j1=n}function Are(n){return j1.loadJS(n)}function RVe(){return j1.recaptchaEnterpriseScript}function IVe(){return j1.gapiScript}function AVe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class PVe{constructor(){this.enterprise=new OVe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class OVe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const kVe="recaptcha-enterprise",Pre="NO_RECAPTCHA";class NVe{constructor(e){this.type=kVe,this.auth=Lg(e)}async verify(e="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,y)=>{lVe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new cVe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(v=>{y(v)})})}function l(d,p,y){const v=window.grecaptcha;aX(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:e}).then(b=>{p(b)}).catch(()=>{p(Pre)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PVe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{a(this.auth).then(y=>{if(!i&&aX(window.grecaptcha))l(y,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=RVe();v.length!==0&&(v+=y),Are(v).then(()=>{l(y,d,p)}).catch(b=>{p(b)})}}).catch(y=>{p(y)})})}}async function fX(n,e,i,a=!1,l=!1){const d=new NVe(n);let p;if(l)p=Pre;else try{p=await d.verify(i)}catch{p=await d.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return a?Object.assign(y,{captchaResp:p}):Object.assign(y,{captchaResponse:p}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function Bk(n,e,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await fX(n,e,i,i==="getOobCode");return a(n,p)}else return a(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await fX(n,e,i,i==="getOobCode");return a(n,y)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DVe(n,e){const i=F1(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Up(d,e??{}))return l;Ld(l,"already-initialized")}return i.initialize({options:e})}function xVe(n,e){const i=(e==null?void 0:e.persistence)||[],a=(Array.isArray(i)?i:[i]).map(wp);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function LVe(n,e,i){const a=Lg(n);Un(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,d=Ore(e),{host:p,port:y}=MVe(e),v=y===null?"":`:${y}`,b={url:`${d}//${p}${v}/`},w=Object.freeze({host:p,port:y,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Un(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Un(Up(b,a.config.emulator)&&Up(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,UVe()}function Ore(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function MVe(n){const e=Ore(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:pX(a.substr(d.length+1))}}else{const[d,p]=a.split(":");return{host:d,port:pX(p)}}}function pX(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function UVe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bj{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return bp("not implemented")}_getIdTokenResponse(e){return bp("not implemented")}_linkToIdToken(e,i){return bp("not implemented")}_getReauthenticationResolver(e){return bp("not implemented")}}async function VVe(n,e){return zp(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FVe(n,e){return fR(n,"POST","/v1/accounts:signInWithPassword",Wp(n,e))}async function kre(n,e){return zp(n,"POST","/v1/accounts:sendOobCode",Wp(n,e))}async function jVe(n,e){return kre(n,e)}async function BVe(n,e){return kre(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WVe(n,e){return fR(n,"POST","/v1/accounts:signInWithEmailLink",Wp(n,e))}async function zVe(n,e){return fR(n,"POST","/v1/accounts:signInWithEmailLink",Wp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC extends Bj{constructor(e,i,a,l=null){super("password",a),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new MC(e,i,"password")}static _fromEmailAndCode(e,i,a=null){return new MC(e,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bk(e,i,"signInWithPassword",FVe);case"emailLink":return WVe(e,{email:this._email,oobCode:this._password});default:Ld(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Bk(e,a,"signUpPassword",VVe);case"emailLink":return zVe(e,{idToken:i,email:this._email,oobCode:this._password});default:Ld(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s0(n,e){return fR(n,"POST","/v1/accounts:signInWithIdp",Wp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GVe="http://localhost";class My extends Bj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new My(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Ld("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=i,d=tR(i,["providerId","signInMethod"]);if(!a||!l)return null;const p=new My(a,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return s0(e,i)}_linkToIdToken(e,i){const a=this.buildRequest();return a.idToken=i,s0(e,a)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,s0(e,i)}buildRequest(){const e={requestUri:GVe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=dR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HVe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $Ve(n){const e=Ww(zw(n)).link,i=e?Ww(zw(e)).deep_link_id:null,a=Ww(zw(n)).deep_link_id;return(a?Ww(zw(a)).link:null)||a||i||e||n}class Wj{constructor(e){var i,a,l,d,p,y;const v=Ww(zw(e)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,w=(a=v.oobCode)!==null&&a!==void 0?a:null,A=HVe((l=v.mode)!==null&&l!==void 0?l:null);Un(b&&w&&A,"argument-error"),this.apiKey=b,this.operation=A,this.code=w,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=$Ve(e);try{return new Wj(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(){this.providerId=W0.PROVIDER_ID}static credential(e,i){return MC._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const a=Wj.parseLink(i);return Un(a,"argument-error"),MC._fromEmailAndCode(e,a.code,a.tenantId)}}W0.PROVIDER_ID="password";W0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";W0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nre{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR extends Nre{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag extends pR{constructor(){super("facebook.com")}static credential(e){return My._fromParams({providerId:ag.PROVIDER_ID,signInMethod:ag.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ag.credentialFromTaggedObject(e)}static credentialFromError(e){return ag.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ag.credential(e.oauthAccessToken)}catch{return null}}}ag.FACEBOOK_SIGN_IN_METHOD="facebook.com";ag.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg extends pR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return My._fromParams({providerId:cg.PROVIDER_ID,signInMethod:cg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return cg.credentialFromTaggedObject(e)}static credentialFromError(e){return cg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:a}=e;if(!i&&!a)return null;try{return cg.credential(i,a)}catch{return null}}}cg.GOOGLE_SIGN_IN_METHOD="google.com";cg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg extends pR{constructor(){super("github.com")}static credential(e){return My._fromParams({providerId:lg.PROVIDER_ID,signInMethod:lg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lg.credentialFromTaggedObject(e)}static credentialFromError(e){return lg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lg.credential(e.oauthAccessToken)}catch{return null}}}lg.GITHUB_SIGN_IN_METHOD="github.com";lg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug extends pR{constructor(){super("twitter.com")}static credential(e,i){return My._fromParams({providerId:ug.PROVIDER_ID,signInMethod:ug.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return ug.credentialFromTaggedObject(e)}static credentialFromError(e){return ug.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=e;if(!i||!a)return null;try{return ug.credential(i,a)}catch{return null}}}ug.TWITTER_SIGN_IN_METHOD="twitter.com";ug.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KVe(n,e){return fR(n,"POST","/v1/accounts:signUp",Wp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,a,l=!1){const d=await Tp._fromIdTokenResponse(e,a,l),p=mX(a);return new Uy({user:d,providerId:p,_tokenResponse:a,operationType:i})}static async _forOperation(e,i,a){await e._updateTokensIfNecessary(a,!0);const l=mX(a);return new Uy({user:e,providerId:l,_tokenResponse:a,operationType:i})}}function mX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wk extends hf{constructor(e,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Wk.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,i,a,l){return new Wk(e,i,a,l)}}function Dre(n,e,i,a){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Wk._fromErrorAndOperation(n,d,e,a):d})}async function qVe(n,e,i=!1){const a=await LC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Uy._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YVe(n,e,i=!1){const{auth:a}=n;if(Nl(a.app))return Promise.reject(Np(a));const l="reauthenticate";try{const d=await LC(n,Dre(a,l,e,n),i);Un(d.idToken,a,"internal-error");const p=Fj(d.idToken);Un(p,a,"internal-error");const{sub:y}=p;return Un(n.uid===y,a,"user-mismatch"),Uy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Ld(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xre(n,e,i=!1){if(Nl(n.app))return Promise.reject(Np(n));const a="signIn",l=await Dre(n,a,e),d=await Uy._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function XVe(n,e){return xre(Lg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lre(n){const e=Lg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function JVe(n,e,i){const a=Lg(n);await Bk(a,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",BVe)}async function QVe(n,e,i){if(Nl(n.app))return Promise.reject(Np(n));const a=Lg(n),p=await Bk(a,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KVe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Lre(n),v}),y=await Uy._fromIdTokenResponse(a,"signIn",p);return await a._updateCurrentUser(y.user),y}function ZVe(n,e,i){return Nl(n.app)?Promise.reject(Np(n)):XVe(Vi(n),W0.credential(e,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Lre(n),a})}async function CV(n,e){const i=Vi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await jVe(i.auth,l);d!==n.email&&await n.reload()}function eFe(n,e,i,a){return Vi(n).onIdTokenChanged(e,i,a)}function tFe(n,e,i){return Vi(n).beforeAuthStateChanged(e,i)}function nFe(n,e,i,a){return Vi(n).onAuthStateChanged(e,i,a)}function rFe(n){return Vi(n).signOut()}const zk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mre{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(zk,"1"),this.storage.removeItem(zk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iFe=1e3,sFe=10;class Ure extends Mre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Rre(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&e(i,l,a)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,y,v)=>{this.notifyListeners(p,v)});return}const a=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(a);!i&&this.localCache[a]===p||this.notifyListeners(a,p)},d=this.storage.getItem(a);EVe()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,sFe):l()}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:a}),!0)})},iFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ure.type="LOCAL";const oFe=Ure;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vre extends Mre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Vre.type="SESSION";const Fre=Vre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aFe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const a=new B1(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:a,eventType:l,data:d}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const y=Array.from(p).map(async b=>b(i.origin,d)),v=await aFe(y);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}B1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zj(n="",e=10){let i="";for(let a=0;a<e;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cFe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((y,v)=>{const b=zj("",20);l.port1.start();const w=setTimeout(()=>{v(new Error("unsupported_event"))},a);p={messageChannel:l,onMessage(A){const N=A;if(N.data.eventId===b)switch(N.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),y(N.data.response);break;default:clearTimeout(w),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(){return window}function lFe(n){nf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jre(){return typeof nf().WorkerGlobalScope<"u"&&typeof nf().importScripts=="function"}async function uFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function hFe(){return jre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bre="firebaseLocalStorageDb",fFe=1,Gk="firebaseLocalStorage",Wre="fbase_key";class mR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function W1(n,e){return n.transaction([Gk],e?"readwrite":"readonly").objectStore(Gk)}function pFe(){const n=indexedDB.deleteDatabase(Bre);return new mR(n).toPromise()}function RV(){const n=indexedDB.open(Bre,fFe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(Gk,{keyPath:Wre})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(Gk)?e(a):(a.close(),await pFe(),e(await RV()))})})}async function gX(n,e,i){const a=W1(n,!0).put({[Wre]:e,value:i});return new mR(a).toPromise()}async function mFe(n,e){const i=W1(n,!1).get(e),a=await new mR(i).toPromise();return a===void 0?null:a.value}function _X(n,e){const i=W1(n,!0).delete(e);return new mR(i).toPromise()}const gFe=800,_Fe=3;class zre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await RV(),this.db)}async _withRetries(e){let i=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(i++>_Fe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return jre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=B1._getInstance(hFe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await uFe(),!this.activeServiceWorker)return;this.sender=new cFe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||dFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await RV();return await gX(e,zk,"1"),await _X(e,zk),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>gX(a,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(a=>mFe(a,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>_X(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const d=W1(l,!1).getAll();return new mR(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:d}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zre.type="LOCAL";const yFe=zre;new hR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EFe(n,e){return e?wp(e):(Un(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj extends Bj{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return s0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return s0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return s0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function vFe(n){return xre(n.auth,new Gj(n),n.bypassAuthState)}function SFe(n){const{auth:e,user:i}=n;return Un(i,e,"internal-error"),YVe(i,new Gj(n),n.bypassAuthState)}async function bFe(n){const{auth:e,user:i}=n;return Un(i,e,"internal-error"),qVe(i,new Gj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gre{constructor(e,i,a,l,d=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:p,type:y}=e;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vFe;case"linkViaPopup":case"linkViaRedirect":return bFe;case"reauthViaPopup":case"reauthViaRedirect":return SFe;default:Ld(this.auth,"internal-error")}}resolve(e){Fp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Fp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TFe=new hR(2e3,1e4);class WS extends Gre{constructor(e,i,a,l,d){super(e,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,WS.currentPopupAction&&WS.currentPopupAction.cancel(),WS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Un(e,this.auth,"internal-error"),e}async onExecution(){Fp(this.filter.length===1,"Popup operations only handle one event");const e=zj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(tf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(tf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,WS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,TFe.get())};e()}}WS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wFe="pendingRedirect",ck=new Map;class CFe extends Gre{constructor(e,i,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let e=ck.get(this.auth._key());if(!e){try{const a=await RFe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(i){e=()=>Promise.reject(i)}ck.set(this.auth._key(),e)}return this.bypassAuthState||ck.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function RFe(n,e){const i=PFe(e),a=AFe(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function IFe(n,e){ck.set(n._key(),e)}function AFe(n){return wp(n._redirectPersistence)}function PFe(n){return ak(wFe,n.config.apiKey,n.name)}async function OFe(n,e,i=!1){if(Nl(n.app))return Promise.reject(Np(n));const a=Lg(n),l=EFe(a,e),p=await new CFe(a,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await a._persistUserIfCurrent(p.user),await a._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kFe=10*60*1e3;class NFe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(i=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DFe(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var a;if(e.error&&!Hre(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(tf(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const a=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=kFe&&this.cachedEventUids.clear(),this.cachedEventUids.has(yX(e))}saveEventToCache(e){this.cachedEventUids.add(yX(e)),this.lastProcessedEventTime=Date.now()}}function yX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Hre({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function DFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Hre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xFe(n,e={}){return zp(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,MFe=/^https?/;async function UFe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await xFe(n);for(const i of e)try{if(VFe(i))return}catch{}Ld(n,"unauthorized-domain")}function VFe(n){const e=TV(),{protocol:i,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===a}if(!MFe.test(i))return!1;if(LFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FFe=new hR(3e4,6e4);function EX(){const n=nf().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function jFe(n){return new Promise((e,i)=>{var a,l,d;function p(){EX(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{EX(),i(tf(n,"network-request-failed"))},timeout:FFe.get()})}if(!((l=(a=nf().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((d=nf().gapi)===null||d===void 0)&&d.load)p();else{const y=AVe("iframefcb");return nf()[y]=()=>{gapi.load?p():i(tf(n,"network-request-failed"))},Are(`${IVe()}?onload=${y}`).catch(v=>i(v))}}).catch(e=>{throw lk=null,e})}let lk=null;function BFe(n){return lk=lk||jFe(n),lk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WFe=new hR(5e3,15e3),zFe="__/auth/iframe",GFe="emulator/auth/iframe",HFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$Fe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function KFe(n){const e=n.config;Un(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?Vj(e,GFe):`https://${n.config.authDomain}/${zFe}`,a={apiKey:e.apiKey,appName:n.name,v:$y},l=$Fe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${dR(a).slice(1)}`}async function qFe(n){const e=await BFe(n),i=nf().gapi;return Un(i,n,"internal-error"),e.open({where:document.body,url:KFe(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:HFe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const p=tf(n,"network-request-failed"),y=nf().setTimeout(()=>{d(p)},WFe.get());function v(){nf().clearTimeout(y),l(a)}a.ping(v).then(v,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YFe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},XFe=500,JFe=600,QFe="_blank",ZFe="http://localhost";class vX{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eje(n,e,i,a=XFe,l=JFe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-a)/2,0).toString();let y="";const v=Object.assign(Object.assign({},YFe),{width:a.toString(),height:l.toString(),top:d,left:p}),b=Ya().toLowerCase();i&&(y=Sre(b)?QFe:i),Ere(b)&&(e=e||ZFe,v.scrollbars="yes");const w=Object.entries(v).reduce((N,[V,F])=>`${N}${V}=${F},`,"");if(yVe(b)&&y!=="_self")return tje(e||"",y),new vX(null);const A=window.open(e||"",y,w);Un(A,n,"popup-blocked");try{A.focus()}catch{}return new vX(A)}function tje(n,e){const i=document.createElement("a");i.href=n,i.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nje="__/auth/handler",rje="emulator/auth/handler",ije=encodeURIComponent("fac");async function SX(n,e,i,a,l,d){Un(n.config.authDomain,n,"auth-domain-config-required"),Un(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:$y,eventId:l};if(e instanceof Nre){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",B2e(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[w,A]of Object.entries({}))p[w]=A}if(e instanceof pR){const w=e.getScopes().filter(A=>A!=="");w.length>0&&(p.scopes=w.join(","))}n.tenantId&&(p.tid=n.tenantId);const y=p;for(const w of Object.keys(y))y[w]===void 0&&delete y[w];const v=await n._getAppCheckToken(),b=v?`#${ije}=${encodeURIComponent(v)}`:"";return`${sje(n)}?${dR(y).slice(1)}${b}`}function sje({config:n}){return n.emulator?Vj(n,rje):`https://${n.authDomain}/${nje}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nU="webStorageSupport";class oje{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Fre,this._completeRedirectFn=OFe,this._overrideRedirectResult=IFe}async _openPopup(e,i,a,l){var d;Fp((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await SX(e,i,a,TV(),l);return eje(e,p,zj())}async _openRedirect(e,i,a,l){await this._originValidation(e);const d=await SX(e,i,a,TV(),l);return lFe(d),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(Fp(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(e);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(e){const i=await qFe(e),a=new NFe(e);return i.register("authEvent",l=>(Un(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=i,a}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(nU,{type:nU},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[nU];p!==void 0&&i(!!p),Ld(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=UFe(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Rre()||vre()||jj()}}const aje=oje;var bX="@firebase/auth",TX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cje{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Un(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function uje(n){Ly(new wg("auth",(e,{options:i})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:p,authDomain:y}=a.options;Un(p&&!p.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:p,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ire(n)},b=new wVe(a,l,d,v);return xVe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,a)=>{e.getProvider("auth-internal").initialize()})),Ly(new wg("auth-internal",e=>{const i=Lg(e.getProvider("auth").getImmediate());return(a=>new cje(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),ef(bX,TX,lje(n)),ef(bX,TX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dje=5*60,hje=rre("authIdTokenMaxAge")||dje;let wX=null;const fje=n=>async e=>{const i=e&&await e.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>hje)return;const l=i==null?void 0:i.token;wX!==l&&(wX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function $re(n=Mj()){const e=F1(n,"auth");if(e.isInitialized())return e.getImmediate();const i=DVe(n,{popupRedirectResolver:aje,persistence:[yFe,oFe,Fre]}),a=rre("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const p=fje(d.toString());tFe(i,p,()=>p(i.currentUser)),eFe(i,y=>p(y))}}const l=ere("auth");return l&&LVe(i,`http://${l}`),i}function pje(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}CVe({loadJS(n){return new Promise((e,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=l=>{const d=tf("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",pje().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});uje("Browser");var CX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gg,Kre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(ne,ee){function Q(){}Q.prototype=ee.prototype,ne.D=ee.prototype,ne.prototype=new Q,ne.prototype.constructor=ne,ne.C=function(se,fe,pe){for(var ue=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)ue[Me-2]=arguments[Me];return ee.prototype[fe].apply(se,ue)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(ne,ee,Q){Q||(Q=0);var se=Array(16);if(typeof ee=="string")for(var fe=0;16>fe;++fe)se[fe]=ee.charCodeAt(Q++)|ee.charCodeAt(Q++)<<8|ee.charCodeAt(Q++)<<16|ee.charCodeAt(Q++)<<24;else for(fe=0;16>fe;++fe)se[fe]=ee[Q++]|ee[Q++]<<8|ee[Q++]<<16|ee[Q++]<<24;ee=ne.g[0],Q=ne.g[1],fe=ne.g[2];var pe=ne.g[3],ue=ee+(pe^Q&(fe^pe))+se[0]+3614090360&4294967295;ee=Q+(ue<<7&4294967295|ue>>>25),ue=pe+(fe^ee&(Q^fe))+se[1]+3905402710&4294967295,pe=ee+(ue<<12&4294967295|ue>>>20),ue=fe+(Q^pe&(ee^Q))+se[2]+606105819&4294967295,fe=pe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^fe&(pe^ee))+se[3]+3250441966&4294967295,Q=fe+(ue<<22&4294967295|ue>>>10),ue=ee+(pe^Q&(fe^pe))+se[4]+4118548399&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=pe+(fe^ee&(Q^fe))+se[5]+1200080426&4294967295,pe=ee+(ue<<12&4294967295|ue>>>20),ue=fe+(Q^pe&(ee^Q))+se[6]+2821735955&4294967295,fe=pe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^fe&(pe^ee))+se[7]+4249261313&4294967295,Q=fe+(ue<<22&4294967295|ue>>>10),ue=ee+(pe^Q&(fe^pe))+se[8]+1770035416&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=pe+(fe^ee&(Q^fe))+se[9]+2336552879&4294967295,pe=ee+(ue<<12&4294967295|ue>>>20),ue=fe+(Q^pe&(ee^Q))+se[10]+4294925233&4294967295,fe=pe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^fe&(pe^ee))+se[11]+2304563134&4294967295,Q=fe+(ue<<22&4294967295|ue>>>10),ue=ee+(pe^Q&(fe^pe))+se[12]+1804603682&4294967295,ee=Q+(ue<<7&4294967295|ue>>>25),ue=pe+(fe^ee&(Q^fe))+se[13]+4254626195&4294967295,pe=ee+(ue<<12&4294967295|ue>>>20),ue=fe+(Q^pe&(ee^Q))+se[14]+2792965006&4294967295,fe=pe+(ue<<17&4294967295|ue>>>15),ue=Q+(ee^fe&(pe^ee))+se[15]+1236535329&4294967295,Q=fe+(ue<<22&4294967295|ue>>>10),ue=ee+(fe^pe&(Q^fe))+se[1]+4129170786&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=pe+(Q^fe&(ee^Q))+se[6]+3225465664&4294967295,pe=ee+(ue<<9&4294967295|ue>>>23),ue=fe+(ee^Q&(pe^ee))+se[11]+643717713&4294967295,fe=pe+(ue<<14&4294967295|ue>>>18),ue=Q+(pe^ee&(fe^pe))+se[0]+3921069994&4294967295,Q=fe+(ue<<20&4294967295|ue>>>12),ue=ee+(fe^pe&(Q^fe))+se[5]+3593408605&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=pe+(Q^fe&(ee^Q))+se[10]+38016083&4294967295,pe=ee+(ue<<9&4294967295|ue>>>23),ue=fe+(ee^Q&(pe^ee))+se[15]+3634488961&4294967295,fe=pe+(ue<<14&4294967295|ue>>>18),ue=Q+(pe^ee&(fe^pe))+se[4]+3889429448&4294967295,Q=fe+(ue<<20&4294967295|ue>>>12),ue=ee+(fe^pe&(Q^fe))+se[9]+568446438&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=pe+(Q^fe&(ee^Q))+se[14]+3275163606&4294967295,pe=ee+(ue<<9&4294967295|ue>>>23),ue=fe+(ee^Q&(pe^ee))+se[3]+4107603335&4294967295,fe=pe+(ue<<14&4294967295|ue>>>18),ue=Q+(pe^ee&(fe^pe))+se[8]+1163531501&4294967295,Q=fe+(ue<<20&4294967295|ue>>>12),ue=ee+(fe^pe&(Q^fe))+se[13]+2850285829&4294967295,ee=Q+(ue<<5&4294967295|ue>>>27),ue=pe+(Q^fe&(ee^Q))+se[2]+4243563512&4294967295,pe=ee+(ue<<9&4294967295|ue>>>23),ue=fe+(ee^Q&(pe^ee))+se[7]+1735328473&4294967295,fe=pe+(ue<<14&4294967295|ue>>>18),ue=Q+(pe^ee&(fe^pe))+se[12]+2368359562&4294967295,Q=fe+(ue<<20&4294967295|ue>>>12),ue=ee+(Q^fe^pe)+se[5]+4294588738&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=pe+(ee^Q^fe)+se[8]+2272392833&4294967295,pe=ee+(ue<<11&4294967295|ue>>>21),ue=fe+(pe^ee^Q)+se[11]+1839030562&4294967295,fe=pe+(ue<<16&4294967295|ue>>>16),ue=Q+(fe^pe^ee)+se[14]+4259657740&4294967295,Q=fe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^fe^pe)+se[1]+2763975236&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=pe+(ee^Q^fe)+se[4]+1272893353&4294967295,pe=ee+(ue<<11&4294967295|ue>>>21),ue=fe+(pe^ee^Q)+se[7]+4139469664&4294967295,fe=pe+(ue<<16&4294967295|ue>>>16),ue=Q+(fe^pe^ee)+se[10]+3200236656&4294967295,Q=fe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^fe^pe)+se[13]+681279174&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=pe+(ee^Q^fe)+se[0]+3936430074&4294967295,pe=ee+(ue<<11&4294967295|ue>>>21),ue=fe+(pe^ee^Q)+se[3]+3572445317&4294967295,fe=pe+(ue<<16&4294967295|ue>>>16),ue=Q+(fe^pe^ee)+se[6]+76029189&4294967295,Q=fe+(ue<<23&4294967295|ue>>>9),ue=ee+(Q^fe^pe)+se[9]+3654602809&4294967295,ee=Q+(ue<<4&4294967295|ue>>>28),ue=pe+(ee^Q^fe)+se[12]+3873151461&4294967295,pe=ee+(ue<<11&4294967295|ue>>>21),ue=fe+(pe^ee^Q)+se[15]+530742520&4294967295,fe=pe+(ue<<16&4294967295|ue>>>16),ue=Q+(fe^pe^ee)+se[2]+3299628645&4294967295,Q=fe+(ue<<23&4294967295|ue>>>9),ue=ee+(fe^(Q|~pe))+se[0]+4096336452&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=pe+(Q^(ee|~fe))+se[7]+1126891415&4294967295,pe=ee+(ue<<10&4294967295|ue>>>22),ue=fe+(ee^(pe|~Q))+se[14]+2878612391&4294967295,fe=pe+(ue<<15&4294967295|ue>>>17),ue=Q+(pe^(fe|~ee))+se[5]+4237533241&4294967295,Q=fe+(ue<<21&4294967295|ue>>>11),ue=ee+(fe^(Q|~pe))+se[12]+1700485571&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=pe+(Q^(ee|~fe))+se[3]+2399980690&4294967295,pe=ee+(ue<<10&4294967295|ue>>>22),ue=fe+(ee^(pe|~Q))+se[10]+4293915773&4294967295,fe=pe+(ue<<15&4294967295|ue>>>17),ue=Q+(pe^(fe|~ee))+se[1]+2240044497&4294967295,Q=fe+(ue<<21&4294967295|ue>>>11),ue=ee+(fe^(Q|~pe))+se[8]+1873313359&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=pe+(Q^(ee|~fe))+se[15]+4264355552&4294967295,pe=ee+(ue<<10&4294967295|ue>>>22),ue=fe+(ee^(pe|~Q))+se[6]+2734768916&4294967295,fe=pe+(ue<<15&4294967295|ue>>>17),ue=Q+(pe^(fe|~ee))+se[13]+1309151649&4294967295,Q=fe+(ue<<21&4294967295|ue>>>11),ue=ee+(fe^(Q|~pe))+se[4]+4149444226&4294967295,ee=Q+(ue<<6&4294967295|ue>>>26),ue=pe+(Q^(ee|~fe))+se[11]+3174756917&4294967295,pe=ee+(ue<<10&4294967295|ue>>>22),ue=fe+(ee^(pe|~Q))+se[2]+718787259&4294967295,fe=pe+(ue<<15&4294967295|ue>>>17),ue=Q+(pe^(fe|~ee))+se[9]+3951481745&4294967295,ne.g[0]=ne.g[0]+ee&4294967295,ne.g[1]=ne.g[1]+(fe+(ue<<21&4294967295|ue>>>11))&4294967295,ne.g[2]=ne.g[2]+fe&4294967295,ne.g[3]=ne.g[3]+pe&4294967295}a.prototype.u=function(ne,ee){ee===void 0&&(ee=ne.length);for(var Q=ee-this.blockSize,se=this.B,fe=this.h,pe=0;pe<ee;){if(fe==0)for(;pe<=Q;)l(this,ne,pe),pe+=this.blockSize;if(typeof ne=="string"){for(;pe<ee;)if(se[fe++]=ne.charCodeAt(pe++),fe==this.blockSize){l(this,se),fe=0;break}}else for(;pe<ee;)if(se[fe++]=ne[pe++],fe==this.blockSize){l(this,se),fe=0;break}}this.h=fe,this.o+=ee},a.prototype.v=function(){var ne=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ne[0]=128;for(var ee=1;ee<ne.length-8;++ee)ne[ee]=0;var Q=8*this.o;for(ee=ne.length-8;ee<ne.length;++ee)ne[ee]=Q&255,Q/=256;for(this.u(ne),ne=Array(16),ee=Q=0;4>ee;++ee)for(var se=0;32>se;se+=8)ne[Q++]=this.g[ee]>>>se&255;return ne};function d(ne,ee){var Q=y;return Object.prototype.hasOwnProperty.call(Q,ne)?Q[ne]:Q[ne]=ee(ne)}function p(ne,ee){this.h=ee;for(var Q=[],se=!0,fe=ne.length-1;0<=fe;fe--){var pe=ne[fe]|0;se&&pe==ee||(Q[fe]=pe,se=!1)}this.g=Q}var y={};function v(ne){return-128<=ne&&128>ne?d(ne,function(ee){return new p([ee|0],0>ee?-1:0)}):new p([ne|0],0>ne?-1:0)}function b(ne){if(isNaN(ne)||!isFinite(ne))return A;if(0>ne)return W(b(-ne));for(var ee=[],Q=1,se=0;ne>=Q;se++)ee[se]=ne/Q|0,Q*=4294967296;return new p(ee,0)}function w(ne,ee){if(ne.length==0)throw Error("number format error: empty string");if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(ne.charAt(0)=="-")return W(w(ne.substring(1),ee));if(0<=ne.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(ee,8)),se=A,fe=0;fe<ne.length;fe+=8){var pe=Math.min(8,ne.length-fe),ue=parseInt(ne.substring(fe,fe+pe),ee);8>pe?(pe=b(Math.pow(ee,pe)),se=se.j(pe).add(b(ue))):(se=se.j(Q),se=se.add(b(ue)))}return se}var A=v(0),N=v(1),V=v(16777216);n=p.prototype,n.m=function(){if(B(this))return-W(this).m();for(var ne=0,ee=1,Q=0;Q<this.g.length;Q++){var se=this.i(Q);ne+=(0<=se?se:4294967296+se)*ee,ee*=4294967296}return ne},n.toString=function(ne){if(ne=ne||10,2>ne||36<ne)throw Error("radix out of range: "+ne);if(F(this))return"0";if(B(this))return"-"+W(this).toString(ne);for(var ee=b(Math.pow(ne,6)),Q=this,se="";;){var fe=ce(Q,ee).g;Q=J(Q,fe.j(ee));var pe=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(ne);if(Q=fe,F(Q))return pe+se;for(;6>pe.length;)pe="0"+pe;se=pe+se}},n.i=function(ne){return 0>ne?0:ne<this.g.length?this.g[ne]:this.h};function F(ne){if(ne.h!=0)return!1;for(var ee=0;ee<ne.g.length;ee++)if(ne.g[ee]!=0)return!1;return!0}function B(ne){return ne.h==-1}n.l=function(ne){return ne=J(this,ne),B(ne)?-1:F(ne)?0:1};function W(ne){for(var ee=ne.g.length,Q=[],se=0;se<ee;se++)Q[se]=~ne.g[se];return new p(Q,~ne.h).add(N)}n.abs=function(){return B(this)?W(this):this},n.add=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0,fe=0;fe<=ee;fe++){var pe=se+(this.i(fe)&65535)+(ne.i(fe)&65535),ue=(pe>>>16)+(this.i(fe)>>>16)+(ne.i(fe)>>>16);se=ue>>>16,pe&=65535,ue&=65535,Q[fe]=ue<<16|pe}return new p(Q,Q[Q.length-1]&-2147483648?-1:0)};function J(ne,ee){return ne.add(W(ee))}n.j=function(ne){if(F(this)||F(ne))return A;if(B(this))return B(ne)?W(this).j(W(ne)):W(W(this).j(ne));if(B(ne))return W(this.j(W(ne)));if(0>this.l(V)&&0>ne.l(V))return b(this.m()*ne.m());for(var ee=this.g.length+ne.g.length,Q=[],se=0;se<2*ee;se++)Q[se]=0;for(se=0;se<this.g.length;se++)for(var fe=0;fe<ne.g.length;fe++){var pe=this.i(se)>>>16,ue=this.i(se)&65535,Me=ne.i(fe)>>>16,He=ne.i(fe)&65535;Q[2*se+2*fe]+=ue*He,$(Q,2*se+2*fe),Q[2*se+2*fe+1]+=pe*He,$(Q,2*se+2*fe+1),Q[2*se+2*fe+1]+=ue*Me,$(Q,2*se+2*fe+1),Q[2*se+2*fe+2]+=pe*Me,$(Q,2*se+2*fe+2)}for(se=0;se<ee;se++)Q[se]=Q[2*se+1]<<16|Q[2*se];for(se=ee;se<2*ee;se++)Q[se]=0;return new p(Q,0)};function $(ne,ee){for(;(ne[ee]&65535)!=ne[ee];)ne[ee+1]+=ne[ee]>>>16,ne[ee]&=65535,ee++}function te(ne,ee){this.g=ne,this.h=ee}function ce(ne,ee){if(F(ee))throw Error("division by zero");if(F(ne))return new te(A,A);if(B(ne))return ee=ce(W(ne),ee),new te(W(ee.g),W(ee.h));if(B(ee))return ee=ce(ne,W(ee)),new te(W(ee.g),ee.h);if(30<ne.g.length){if(B(ne)||B(ee))throw Error("slowDivide_ only works with positive integers.");for(var Q=N,se=ee;0>=se.l(ne);)Q=oe(Q),se=oe(se);var fe=_e(Q,1),pe=_e(se,1);for(se=_e(se,2),Q=_e(Q,2);!F(se);){var ue=pe.add(se);0>=ue.l(ne)&&(fe=fe.add(Q),pe=ue),se=_e(se,1),Q=_e(Q,1)}return ee=J(ne,fe.j(ee)),new te(fe,ee)}for(fe=A;0<=ne.l(ee);){for(Q=Math.max(1,Math.floor(ne.m()/ee.m())),se=Math.ceil(Math.log(Q)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),pe=b(Q),ue=pe.j(ee);B(ue)||0<ue.l(ne);)Q-=se,pe=b(Q),ue=pe.j(ee);F(pe)&&(pe=N),fe=fe.add(pe),ne=J(ne,ue)}return new te(fe,ne)}n.A=function(ne){return ce(this,ne).h},n.and=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)&ne.i(se);return new p(Q,this.h&ne.h)},n.or=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)|ne.i(se);return new p(Q,this.h|ne.h)},n.xor=function(ne){for(var ee=Math.max(this.g.length,ne.g.length),Q=[],se=0;se<ee;se++)Q[se]=this.i(se)^ne.i(se);return new p(Q,this.h^ne.h)};function oe(ne){for(var ee=ne.g.length+1,Q=[],se=0;se<ee;se++)Q[se]=ne.i(se)<<1|ne.i(se-1)>>>31;return new p(Q,ne.h)}function _e(ne,ee){var Q=ee>>5;ee%=32;for(var se=ne.g.length-Q,fe=[],pe=0;pe<se;pe++)fe[pe]=0<ee?ne.i(pe+Q)>>>ee|ne.i(pe+Q+1)<<32-ee:ne.i(pe+Q);return new p(fe,ne.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Kre=a,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=w,gg=p}).apply(typeof CX<"u"?CX:typeof self<"u"?self:typeof window<"u"?window:{});var OO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var qre,Gw,Yre,uk,IV,Xre,Jre,Qre;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(I,z,Z){return I==Array.prototype||I==Object.prototype||(I[z]=Z.value),I};function i(I){I=[typeof globalThis=="object"&&globalThis,I,typeof window=="object"&&window,typeof self=="object"&&self,typeof OO=="object"&&OO];for(var z=0;z<I.length;++z){var Z=I[z];if(Z&&Z.Math==Math)return Z}throw Error("Cannot find global object")}var a=i(this);function l(I,z){if(z)e:{var Z=a;I=I.split(".");for(var me=0;me<I.length-1;me++){var Ke=I[me];if(!(Ke in Z))break e;Z=Z[Ke]}I=I[I.length-1],me=Z[I],z=z(me),z!=me&&z!=null&&e(Z,I,{configurable:!0,writable:!0,value:z})}}function d(I,z){I instanceof String&&(I+="");var Z=0,me=!1,Ke={next:function(){if(!me&&Z<I.length){var ct=Z++;return{value:z(ct,I[ct]),done:!1}}return me=!0,{done:!0,value:void 0}}};return Ke[Symbol.iterator]=function(){return Ke},Ke}l("Array.prototype.values",function(I){return I||function(){return d(this,function(z,Z){return Z})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},y=this||self;function v(I){var z=typeof I;return z=z!="object"?z:I?Array.isArray(I)?"array":z:"null",z=="array"||z=="object"&&typeof I.length=="number"}function b(I){var z=typeof I;return z=="object"&&I!=null||z=="function"}function w(I,z,Z){return I.call.apply(I.bind,arguments)}function A(I,z,Z){if(!I)throw Error();if(2<arguments.length){var me=Array.prototype.slice.call(arguments,2);return function(){var Ke=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ke,me),I.apply(z,Ke)}}return function(){return I.apply(z,arguments)}}function N(I,z,Z){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:A,N.apply(null,arguments)}function V(I,z){var Z=Array.prototype.slice.call(arguments,1);return function(){var me=Z.slice();return me.push.apply(me,arguments),I.apply(this,me)}}function F(I,z){function Z(){}Z.prototype=z.prototype,I.aa=z.prototype,I.prototype=new Z,I.prototype.constructor=I,I.Qb=function(me,Ke,ct){for(var Mt=Array(arguments.length-2),qr=2;qr<arguments.length;qr++)Mt[qr-2]=arguments[qr];return z.prototype[Ke].apply(me,Mt)}}function B(I){const z=I.length;if(0<z){const Z=Array(z);for(let me=0;me<z;me++)Z[me]=I[me];return Z}return[]}function W(I,z){for(let Z=1;Z<arguments.length;Z++){const me=arguments[Z];if(v(me)){const Ke=I.length||0,ct=me.length||0;I.length=Ke+ct;for(let Mt=0;Mt<ct;Mt++)I[Ke+Mt]=me[Mt]}else I.push(me)}}class J{constructor(z,Z){this.i=z,this.j=Z,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(I){return/^[\s\xa0]*$/.test(I)}function te(){var I=y.navigator;return I&&(I=I.userAgent)?I:""}function ce(I){return ce[" "](I),I}ce[" "]=function(){};var oe=te().indexOf("Gecko")!=-1&&!(te().toLowerCase().indexOf("webkit")!=-1&&te().indexOf("Edge")==-1)&&!(te().indexOf("Trident")!=-1||te().indexOf("MSIE")!=-1)&&te().indexOf("Edge")==-1;function _e(I,z,Z){for(const me in I)z.call(Z,I[me],me,I)}function ne(I,z){for(const Z in I)z.call(void 0,I[Z],Z,I)}function ee(I){const z={};for(const Z in I)z[Z]=I[Z];return z}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(I,z){let Z,me;for(let Ke=1;Ke<arguments.length;Ke++){me=arguments[Ke];for(Z in me)I[Z]=me[Z];for(let ct=0;ct<Q.length;ct++)Z=Q[ct],Object.prototype.hasOwnProperty.call(me,Z)&&(I[Z]=me[Z])}}function fe(I){var z=1;I=I.split(":");const Z=[];for(;0<z&&I.length;)Z.push(I.shift()),z--;return I.length&&Z.push(I.join(":")),Z}function pe(I){y.setTimeout(()=>{throw I},0)}function ue(){var I=ve;let z=null;return I.g&&(z=I.g,I.g=I.g.next,I.g||(I.h=null),z.next=null),z}class Me{constructor(){this.h=this.g=null}add(z,Z){const me=He.get();me.set(z,Z),this.h?this.h.next=me:this.g=me,this.h=me}}var He=new J(()=>new nt,I=>I.reset());class nt{constructor(){this.next=this.g=this.h=null}set(z,Z){this.h=z,this.g=Z,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Re=!1,ve=new Me,Ne=()=>{const I=y.Promise.resolve(void 0);we=()=>{I.then(Te)}};var Te=()=>{for(var I;I=ue();){try{I.h.call(I.g)}catch(Z){pe(Z)}var z=He;z.j(I),100>z.h&&(z.h++,I.next=z.g,z.g=I)}Re=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(I,z){this.type=I,this.g=this.target=z,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var I=!1,z=Object.defineProperty({},"passive",{get:function(){I=!0}});try{const Z=()=>{};y.addEventListener("test",Z,z),y.removeEventListener("test",Z,z)}catch{}return I}();function Ge(I,z){if(Ae.call(this,I?I.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,I){var Z=this.type=I.type,me=I.changedTouches&&I.changedTouches.length?I.changedTouches[0]:null;if(this.target=I.target||I.srcElement,this.g=z,z=I.relatedTarget){if(oe){e:{try{ce(z.nodeName);var Ke=!0;break e}catch{}Ke=!1}Ke||(z=null)}}else Z=="mouseover"?z=I.fromElement:Z=="mouseout"&&(z=I.toElement);this.relatedTarget=z,me?(this.clientX=me.clientX!==void 0?me.clientX:me.pageX,this.clientY=me.clientY!==void 0?me.clientY:me.pageY,this.screenX=me.screenX||0,this.screenY=me.screenY||0):(this.clientX=I.clientX!==void 0?I.clientX:I.pageX,this.clientY=I.clientY!==void 0?I.clientY:I.pageY,this.screenX=I.screenX||0,this.screenY=I.screenY||0),this.button=I.button,this.key=I.key||"",this.ctrlKey=I.ctrlKey,this.altKey=I.altKey,this.shiftKey=I.shiftKey,this.metaKey=I.metaKey,this.pointerId=I.pointerId||0,this.pointerType=typeof I.pointerType=="string"?I.pointerType:Qe[I.pointerType]||"",this.state=I.state,this.i=I,I.defaultPrevented&&Ge.aa.h.call(this)}}F(Ge,Ae);var Qe={2:"touch",3:"pen",4:"mouse"};Ge.prototype.h=function(){Ge.aa.h.call(this);var I=this.i;I.preventDefault?I.preventDefault():I.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),ht=0;function Ze(I,z,Z,me,Ke){this.listener=I,this.proxy=null,this.src=z,this.type=Z,this.capture=!!me,this.ha=Ke,this.key=++ht,this.da=this.fa=!1}function Ct(I){I.da=!0,I.listener=null,I.proxy=null,I.src=null,I.ha=null}function un(I){this.src=I,this.g={},this.h=0}un.prototype.add=function(I,z,Z,me,Ke){var ct=I.toString();I=this.g[ct],I||(I=this.g[ct]=[],this.h++);var Mt=nn(I,z,me,Ke);return-1<Mt?(z=I[Mt],Z||(z.fa=!1)):(z=new Ze(z,this.src,ct,!!me,Ke),z.fa=Z,I.push(z)),z};function Lt(I,z){var Z=z.type;if(Z in I.g){var me=I.g[Z],Ke=Array.prototype.indexOf.call(me,z,void 0),ct;(ct=0<=Ke)&&Array.prototype.splice.call(me,Ke,1),ct&&(Ct(z),I.g[Z].length==0&&(delete I.g[Z],I.h--))}}function nn(I,z,Z,me){for(var Ke=0;Ke<I.length;++Ke){var ct=I[Ke];if(!ct.da&&ct.listener==z&&ct.capture==!!Z&&ct.ha==me)return Ke}return-1}var kn="closure_lm_"+(1e6*Math.random()|0),Kt={};function zn(I,z,Z,me,Ke){if(Array.isArray(z)){for(var ct=0;ct<z.length;ct++)zn(I,z[ct],Z,me,Ke);return null}return Z=fn(Z),I&&I[tt]?I.K(z,Z,b(me)?!!me.capture:!1,Ke):Bt(I,z,Z,!1,me,Ke)}function Bt(I,z,Z,me,Ke,ct){if(!z)throw Error("Invalid event type");var Mt=b(Ke)?!!Ke.capture:!!Ke,qr=St(I);if(qr||(I[kn]=qr=new un(I)),Z=qr.add(z,Z,me,Mt,ct),Z.proxy)return Z;if(me=Ce(),Z.proxy=me,me.src=I,me.listener=Z,I.addEventListener)Ue||(Ke=Mt),Ke===void 0&&(Ke=!1),I.addEventListener(z.toString(),me,Ke);else if(I.attachEvent)I.attachEvent(at(z.toString()),me);else if(I.addListener&&I.removeListener)I.addListener(me);else throw Error("addEventListener and attachEvent are unavailable.");return Z}function Ce(){function I(Z){return z.call(I.src,I.listener,Z)}const z=vt;return I}function Fe(I,z,Z,me,Ke){if(Array.isArray(z))for(var ct=0;ct<z.length;ct++)Fe(I,z[ct],Z,me,Ke);else me=b(me)?!!me.capture:!!me,Z=fn(Z),I&&I[tt]?(I=I.i,z=String(z).toString(),z in I.g&&(ct=I.g[z],Z=nn(ct,Z,me,Ke),-1<Z&&(Ct(ct[Z]),Array.prototype.splice.call(ct,Z,1),ct.length==0&&(delete I.g[z],I.h--)))):I&&(I=St(I))&&(z=I.g[z.toString()],I=-1,z&&(I=nn(z,Z,me,Ke)),(Z=-1<I?z[I]:null)&&We(Z))}function We(I){if(typeof I!="number"&&I&&!I.da){var z=I.src;if(z&&z[tt])Lt(z.i,I);else{var Z=I.type,me=I.proxy;z.removeEventListener?z.removeEventListener(Z,me,I.capture):z.detachEvent?z.detachEvent(at(Z),me):z.addListener&&z.removeListener&&z.removeListener(me),(Z=St(z))?(Lt(Z,I),Z.h==0&&(Z.src=null,z[kn]=null)):Ct(I)}}}function at(I){return I in Kt?Kt[I]:Kt[I]="on"+I}function vt(I,z){if(I.da)I=!0;else{z=new Ge(z,this);var Z=I.listener,me=I.ha||I.src;I.fa&&We(I),I=Z.call(me,z)}return I}function St(I){return I=I[kn],I instanceof un?I:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function fn(I){return typeof I=="function"?I:(I[Gt]||(I[Gt]=function(z){return I.handleEvent(z)}),I[Gt])}function Ln(){be.call(this),this.i=new un(this),this.M=this,this.F=null}F(Ln,be),Ln.prototype[tt]=!0,Ln.prototype.removeEventListener=function(I,z,Z,me){Fe(this,I,z,Z,me)};function cn(I,z){var Z,me=I.F;if(me)for(Z=[];me;me=me.F)Z.push(me);if(I=I.M,me=z.type||z,typeof z=="string")z=new Ae(z,I);else if(z instanceof Ae)z.target=z.target||I;else{var Ke=z;z=new Ae(me,I),se(z,Ke)}if(Ke=!0,Z)for(var ct=Z.length-1;0<=ct;ct--){var Mt=z.g=Z[ct];Ke=dr(Mt,me,!0,z)&&Ke}if(Mt=z.g=I,Ke=dr(Mt,me,!0,z)&&Ke,Ke=dr(Mt,me,!1,z)&&Ke,Z)for(ct=0;ct<Z.length;ct++)Mt=z.g=Z[ct],Ke=dr(Mt,me,!1,z)&&Ke}Ln.prototype.N=function(){if(Ln.aa.N.call(this),this.i){var I=this.i,z;for(z in I.g){for(var Z=I.g[z],me=0;me<Z.length;me++)Ct(Z[me]);delete I.g[z],I.h--}}this.F=null},Ln.prototype.K=function(I,z,Z,me){return this.i.add(String(I),z,!1,Z,me)},Ln.prototype.L=function(I,z,Z,me){return this.i.add(String(I),z,!0,Z,me)};function dr(I,z,Z,me){if(z=I.i.g[String(z)],!z)return!0;z=z.concat();for(var Ke=!0,ct=0;ct<z.length;++ct){var Mt=z[ct];if(Mt&&!Mt.da&&Mt.capture==Z){var qr=Mt.listener,hi=Mt.ha||Mt.src;Mt.fa&&Lt(I.i,Mt),Ke=qr.call(hi,me)!==!1&&Ke}}return Ke&&!me.defaultPrevented}function _a(I,z,Z){if(typeof I=="function")Z&&(I=N(I,Z));else if(I&&typeof I.handleEvent=="function")I=N(I.handleEvent,I);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:y.setTimeout(I,z||0)}function Vt(I){I.g=_a(()=>{I.g=null,I.i&&(I.i=!1,Vt(I))},I.l);const z=I.h;I.h=null,I.m.apply(null,z)}class on extends be{constructor(z,Z){super(),this.m=z,this.l=Z,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Wi(I){be.call(this),this.h=I,this.g={}}F(Wi,be);var gs=[];function Ms(I){_e(I.g,function(z,Z){this.g.hasOwnProperty(Z)&&We(z)},I),I.g={}}Wi.prototype.N=function(){Wi.aa.N.call(this),Ms(this)},Wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ii=y.JSON.stringify,Pt=y.JSON.parse,wn=class{stringify(I){return y.JSON.stringify(I,void 0)}parse(I){return y.JSON.parse(I,void 0)}};function ir(){}ir.prototype.h=null;function xi(I){return I.h||(I.h=I.i())}function Sc(){}var as={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ya(){Ae.call(this,"d")}F(ya,Ae);function Eo(){Ae.call(this,"c")}F(Eo,Ae);var Ea={},va=null;function ro(){return va=va||new Ln}Ea.La="serverreachability";function _s(I){Ae.call(this,Ea.La,I)}F(_s,Ae);function cs(I){const z=ro();cn(z,new _s(z))}Ea.STAT_EVENT="statevent";function jo(I,z){Ae.call(this,Ea.STAT_EVENT,I),this.stat=z}F(jo,Ae);function zi(I){const z=ro();cn(z,new jo(z,I))}Ea.Ma="timingevent";function ys(I,z){Ae.call(this,Ea.Ma,I),this.size=z}F(ys,Ae);function Ja(I,z){if(typeof I!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){I()},z)}function Uu(){this.g=!0}Uu.prototype.xa=function(){this.g=!1};function bc(I,z,Z,me,Ke,ct){I.info(function(){if(I.g)if(ct)for(var Mt="",qr=ct.split("&"),hi=0;hi<qr.length;hi++){var Sr=qr[hi].split("=");if(1<Sr.length){var Ys=Sr[0];Sr=Sr[1];var vs=Ys.split("_");Mt=2<=vs.length&&vs[1]=="type"?Mt+(Ys+"="+Sr+"&"):Mt+(Ys+"=redacted&")}}else Mt=null;else Mt=ct;return"XMLHTTP REQ ("+me+") [attempt "+Ke+"]: "+z+`
`+Z+`
`+Mt})}function Sa(I,z,Z,me,Ke,ct,Mt){I.info(function(){return"XMLHTTP RESP ("+me+") [ attempt "+Ke+"]: "+z+`
`+Z+`
`+ct+" "+Mt})}function ba(I,z,Z,me){I.info(function(){return"XMLHTTP TEXT ("+z+"): "+Vg(I,Z)+(me?" "+me:"")})}function jd(I,z){I.info(function(){return"TIMEOUT: "+z})}Uu.prototype.info=function(){};function Vg(I,z){if(!I.g)return z;if(!z)return null;try{var Z=JSON.parse(z);if(Z){for(I=0;I<Z.length;I++)if(Array.isArray(Z[I])){var me=Z[I];if(!(2>me.length)){var Ke=me[1];if(Array.isArray(Ke)&&!(1>Ke.length)){var ct=Ke[0];if(ct!="noop"&&ct!="stop"&&ct!="close")for(var Mt=1;Mt<Ke.length;Mt++)Ke[Mt]=""}}}}return ii(Z)}catch{return z}}var Vu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},pf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},qs;function Fu(){}F(Fu,ir),Fu.prototype.g=function(){return new XMLHttpRequest},Fu.prototype.i=function(){return{}},qs=new Fu;function Ta(I,z,Z,me){this.j=I,this.i=z,this.l=Z,this.R=me||1,this.U=new Wi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Bd}function Bd(){this.i=null,this.g="",this.h=!1}var Wd={},Qa={};function zd(I,z,Z){I.L=1,I.v=ec(Wo(z)),I.m=Z,I.P=!0,ju(I,null)}function ju(I,z){I.F=Date.now(),Wr(I),I.A=Wo(I.v);var Z=I.A,me=I.R;Array.isArray(me)||(me=[String(me)]),Xl(Z.i,"t",me),I.C=0,Z=I.j.J,I.h=new Bd,I.g=eE(I.j,Z?z:null,!I.m),0<I.O&&(I.M=new on(N(I.Y,I,I.g),I.O)),z=I.U,Z=I.g,me=I.ca;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(gs[0]=Ke.toString()),Ke=gs);for(var ct=0;ct<Ke.length;ct++){var Mt=zn(Z,Ke[ct],me||z.handleEvent,!1,z.h||z);if(!Mt)break;z.g[Mt.key]=Mt}z=I.H?ee(I.H):{},I.m?(I.u||(I.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",I.g.ea(I.A,I.u,I.m,z)):(I.u="GET",I.g.ea(I.A,I.u,null,z)),cs(),bc(I.i,I.u,I.A,I.l,I.R,I.m)}Ta.prototype.ca=function(I){I=I.target;const z=this.M;z&&bi(I)==3?z.j():this.Y(I)},Ta.prototype.Y=function(I){try{if(I==this.g)e:{const vs=bi(this.g);var z=this.g.Ba();const tc=this.g.Z();if(!(3>vs)&&(vs!=3||this.g&&(this.h.h||this.g.oa()||Us(this.g)))){this.J||vs!=4||z==7||(z==8||0>=tc?cs(3):cs(2)),Tc(this);var Z=this.g.Z();this.X=Z;t:if(Bo(this)){var me=Us(this.g);I="";var Ke=me.length,ct=bi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){wa(this),ul(this);var Mt="";break t}this.h.i=new y.TextDecoder}for(z=0;z<Ke;z++)this.h.h=!0,I+=this.h.i.decode(me[z],{stream:!(ct&&z==Ke-1)});me.length=0,this.h.g+=I,this.C=0,Mt=this.h.g}else Mt=this.g.oa();if(this.o=Z==200,Sa(this.i,this.u,this.A,this.l,this.R,vs,Z),this.o){if(this.T&&!this.K){t:{if(this.g){var qr,hi=this.g;if((qr=hi.g?hi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(qr)){var Sr=qr;break t}}Sr=null}if(Z=Sr)ba(this.i,this.l,Z,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,mf(this,Z);else{this.o=!1,this.s=3,zi(12),wa(this),ul(this);break e}}if(this.P){Z=!0;let Qo;for(;!this.J&&this.C<Mt.length;)if(Qo=Gd(this,Mt),Qo==Qa){vs==4&&(this.s=4,zi(14),Z=!1),ba(this.i,this.l,null,"[Incomplete Response]");break}else if(Qo==Wd){this.s=4,zi(15),ba(this.i,this.l,Mt,"[Invalid Chunk]"),Z=!1;break}else ba(this.i,this.l,Qo,null),mf(this,Qo);if(Bo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),vs!=4||Mt.length!=0||this.h.h||(this.s=1,zi(16),Z=!1),this.o=this.o&&Z,!Z)ba(this.i,this.l,Mt,"[Invalid Chunked Response]"),wa(this),ul(this);else if(0<Mt.length&&!this.W){this.W=!0;var Ys=this.j;Ys.g==this&&Ys.ba&&!Ys.M&&(Ys.j.info("Great, no buffering proxy detected. Bytes received: "+Mt.length),jg(Ys),Ys.M=!0,zi(11))}}else ba(this.i,this.l,Mt,null),mf(this,Mt);vs==4&&wa(this),this.o&&!this.J&&(vs==4?em(this.j,this):(this.o=!1,Wr(this)))}else qo(this.g),Z==400&&0<Mt.indexOf("Unknown SID")?(this.s=3,zi(12)):(this.s=0,zi(13)),wa(this),ul(this)}}}catch{}finally{}};function Bo(I){return I.g?I.u=="GET"&&I.L!=2&&I.j.Ca:!1}function Gd(I,z){var Z=I.C,me=z.indexOf(`
`,Z);return me==-1?Qa:(Z=Number(z.substring(Z,me)),isNaN(Z)?Wd:(me+=1,me+Z>z.length?Qa:(z=z.slice(me,me+Z),I.C=me+Z,z)))}Ta.prototype.cancel=function(){this.J=!0,wa(this)};function Wr(I){I.S=Date.now()+I.I,Si(I,I.I)}function Si(I,z){if(I.B!=null)throw Error("WatchDog timer not null");I.B=Ja(N(I.ba,I),z)}function Tc(I){I.B&&(y.clearTimeout(I.B),I.B=null)}Ta.prototype.ba=function(){this.B=null;const I=Date.now();0<=I-this.S?(jd(this.i,this.A),this.L!=2&&(cs(),zi(17)),wa(this),this.s=2,ul(this)):Si(this,this.S-I)};function ul(I){I.j.G==0||I.J||em(I.j,I)}function wa(I){Tc(I);var z=I.M;z&&typeof z.ma=="function"&&z.ma(),I.M=null,Ms(I.U),I.g&&(z=I.g,I.g=null,z.abort(),z.ma())}function mf(I,z){try{var Z=I.j;if(Z.G!=0&&(Z.g==I||io(Z.h,I))){if(!I.K&&io(Z.h,I)&&Z.G==3){try{var me=Z.Da.g.parse(z)}catch{me=null}if(Array.isArray(me)&&me.length==3){var Ke=me;if(Ke[0]==0){e:if(!Z.u){if(Z.g)if(Z.g.F+3e3<I.F)Zp(Z),ml(Z);else break e;Qp(Z),zi(18)}}else Z.za=Ke[1],0<Z.za-Z.T&&37500>Ke[2]&&Z.F&&Z.v==0&&!Z.C&&(Z.C=Ja(N(Z.Za,Z),6e3));if(1>=$p(Z.h)&&Z.ca){try{Z.ca()}catch{}Z.ca=void 0}}else Ku(Z,11)}else if((I.K||Z.g==I)&&Zp(Z),!$(z))for(Ke=Z.Da.g.parse(z),z=0;z<Ke.length;z++){let Sr=Ke[z];if(Z.T=Sr[0],Sr=Sr[1],Z.G==2)if(Sr[0]=="c"){Z.K=Sr[1],Z.ia=Sr[2];const Ys=Sr[3];Ys!=null&&(Z.la=Ys,Z.j.info("VER="+Z.la));const vs=Sr[4];vs!=null&&(Z.Aa=vs,Z.j.info("SVER="+Z.Aa));const tc=Sr[5];tc!=null&&typeof tc=="number"&&0<tc&&(me=1.5*tc,Z.L=me,Z.j.info("backChannelRequestTimeoutMs_="+me)),me=Z;const Qo=I.g;if(Qo){const vf=Qo.g?Qo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vf){var ct=me.h;ct.g||vf.indexOf("spdy")==-1&&vf.indexOf("quic")==-1&&vf.indexOf("h2")==-1||(ct.j=ct.l,ct.g=new Set,ct.h&&(gf(ct,ct.h),ct.h=null))}if(me.D){const nm=Qo.g?Qo.g.getResponseHeader("X-HTTP-Session-Id"):null;nm&&(me.ya=nm,Kr(me.I,me.D,nm))}}Z.G=3,Z.l&&Z.l.ua(),Z.ba&&(Z.R=Date.now()-I.F,Z.j.info("Handshake RTT: "+Z.R+"ms")),me=Z;var Mt=I;if(me.qa=Bg(me,me.J?me.ia:null,me.W),Mt.K){dl(me.h,Mt);var qr=Mt,hi=me.L;hi&&(qr.I=hi),qr.B&&(Tc(qr),Wr(qr)),me.g=Mt}else Ql(me);0<Z.i.length&&Rc(Z)}else Sr[0]!="stop"&&Sr[0]!="close"||Ku(Z,7);else Z.G==3&&(Sr[0]=="stop"||Sr[0]=="close"?Sr[0]=="stop"?Ku(Z,7):es(Z):Sr[0]!="noop"&&Z.l&&Z.l.ta(Sr),Z.v=0)}}cs(4)}catch{}}var Hd=class{constructor(I,z){this.g=I,this.map=z}};function Hl(I){this.l=I||10,y.PerformanceNavigationTiming?(I=y.performance.getEntriesByType("navigation"),I=0<I.length&&(I[0].nextHopProtocol=="hq"||I[0].nextHopProtocol=="h2")):I=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=I?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function vo(I){return I.h?!0:I.g?I.g.size>=I.j:!1}function $p(I){return I.h?1:I.g?I.g.size:0}function io(I,z){return I.h?I.h==z:I.g?I.g.has(z):!1}function gf(I,z){I.g?I.g.add(z):I.h=z}function dl(I,z){I.h&&I.h==z?I.h=null:I.g&&I.g.has(z)&&I.g.delete(z)}Hl.prototype.cancel=function(){if(this.i=$d(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const I of this.g.values())I.cancel();this.g.clear()}};function $d(I){if(I.h!=null)return I.i.concat(I.h.D);if(I.g!=null&&I.g.size!==0){let z=I.i;for(const Z of I.g.values())z=z.concat(Z.D);return z}return B(I.i)}function Kd(I){if(I.V&&typeof I.V=="function")return I.V();if(typeof Map<"u"&&I instanceof Map||typeof Set<"u"&&I instanceof Set)return Array.from(I.values());if(typeof I=="string")return I.split("");if(v(I)){for(var z=[],Z=I.length,me=0;me<Z;me++)z.push(I[me]);return z}z=[],Z=0;for(me in I)z[Z++]=I[me];return z}function pr(I){if(I.na&&typeof I.na=="function")return I.na();if(!I.V||typeof I.V!="function"){if(typeof Map<"u"&&I instanceof Map)return Array.from(I.keys());if(!(typeof Set<"u"&&I instanceof Set)){if(v(I)||typeof I=="string"){var z=[];I=I.length;for(var Z=0;Z<I;Z++)z.push(Z);return z}z=[],Z=0;for(const me in I)z[Z++]=me;return z}}}function $l(I,z){if(I.forEach&&typeof I.forEach=="function")I.forEach(z,void 0);else if(v(I)||typeof I=="string")Array.prototype.forEach.call(I,z,void 0);else for(var Z=pr(I),me=Kd(I),Ke=me.length,ct=0;ct<Ke;ct++)z.call(void 0,me[ct],Z&&Z[ct],I)}var Kl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Bu(I,z){if(I){I=I.split("&");for(var Z=0;Z<I.length;Z++){var me=I[Z].indexOf("="),Ke=null;if(0<=me){var ct=I[Z].substring(0,me);Ke=I[Z].substring(me+1)}else ct=I[Z];z(ct,Ke?decodeURIComponent(Ke.replace(/\+/g," ")):"")}}}function Za(I){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,I instanceof Za){this.h=I.h,Wu(this,I.j),this.o=I.o,this.g=I.g,hl(this,I.s),this.l=I.l;var z=I.i,Z=new zo;Z.i=z.i,z.g&&(Z.g=new Map(z.g),Z.h=z.h),ql(this,Z),this.m=I.m}else I&&(z=String(I).match(Kl))?(this.h=!1,Wu(this,z[1]||"",!0),this.o=sr(z[2]||""),this.g=sr(z[3]||"",!0),hl(this,z[4]),this.l=sr(z[5]||"",!0),ql(this,z[6]||"",!0),this.m=sr(z[7]||"")):(this.h=!1,this.i=new zo(null,this.h))}Za.prototype.toString=function(){var I=[],z=this.j;z&&I.push(wc(z,Yl,!0),":");var Z=this.g;return(Z||z=="file")&&(I.push("//"),(z=this.o)&&I.push(wc(z,Yl,!0),"@"),I.push(encodeURIComponent(String(Z)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),Z=this.s,Z!=null&&I.push(":",String(Z))),(Z=this.l)&&(this.g&&Z.charAt(0)!="/"&&I.push("/"),I.push(wc(Z,Z.charAt(0)=="/"?_f:qd,!0))),(Z=this.i.toString())&&I.push("?",Z),(Z=this.m)&&I.push("#",wc(Z,yf)),I.join("")};function Wo(I){return new Za(I)}function Wu(I,z,Z){I.j=Z?sr(z,!0):z,I.j&&(I.j=I.j.replace(/:$/,""))}function hl(I,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);I.s=z}else I.s=null}function ql(I,z,Z){z instanceof zo?(I.i=z,Ko(I.i,I.h)):(Z||(z=wc(z,qp)),I.i=new zo(z,I.h))}function Kr(I,z,Z){I.i.set(z,Z)}function ec(I){return Kr(I,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),I}function sr(I,z){return I?z?decodeURI(I.replace(/%25/g,"%2525")):decodeURIComponent(I):""}function wc(I,z,Z){return typeof I=="string"?(I=encodeURI(I).replace(z,Kp),Z&&(I=I.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),I):null}function Kp(I){return I=I.charCodeAt(0),"%"+(I>>4&15).toString(16)+(I&15).toString(16)}var Yl=/[#\/\?@]/g,qd=/[#\?:]/g,_f=/[#\?]/g,qp=/[#\?@]/g,yf=/#/g;function zo(I,z){this.h=this.g=null,this.i=I||null,this.j=!!z}function ls(I){I.g||(I.g=new Map,I.h=0,I.i&&Bu(I.i,function(z,Z){I.add(decodeURIComponent(z.replace(/\+/g," ")),Z)}))}n=zo.prototype,n.add=function(I,z){ls(this),this.i=null,I=$o(this,I);var Z=this.g.get(I);return Z||this.g.set(I,Z=[]),Z.push(z),this.h+=1,this};function Go(I,z){ls(I),z=$o(I,z),I.g.has(z)&&(I.i=null,I.h-=I.g.get(z).length,I.g.delete(z))}function Ho(I,z){return ls(I),z=$o(I,z),I.g.has(z)}n.forEach=function(I,z){ls(this),this.g.forEach(function(Z,me){Z.forEach(function(Ke){I.call(z,Ke,me,this)},this)},this)},n.na=function(){ls(this);const I=Array.from(this.g.values()),z=Array.from(this.g.keys()),Z=[];for(let me=0;me<z.length;me++){const Ke=I[me];for(let ct=0;ct<Ke.length;ct++)Z.push(z[me])}return Z},n.V=function(I){ls(this);let z=[];if(typeof I=="string")Ho(this,I)&&(z=z.concat(this.g.get($o(this,I))));else{I=Array.from(this.g.values());for(let Z=0;Z<I.length;Z++)z=z.concat(I[Z])}return z},n.set=function(I,z){return ls(this),this.i=null,I=$o(this,I),Ho(this,I)&&(this.h-=this.g.get(I).length),this.g.set(I,[z]),this.h+=1,this},n.get=function(I,z){return I?(I=this.V(I),0<I.length?String(I[0]):z):z};function Xl(I,z,Z){Go(I,z),0<Z.length&&(I.i=null,I.g.set($o(I,z),B(Z)),I.h+=Z.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const I=[],z=Array.from(this.g.keys());for(var Z=0;Z<z.length;Z++){var me=z[Z];const ct=encodeURIComponent(String(me)),Mt=this.V(me);for(me=0;me<Mt.length;me++){var Ke=ct;Mt[me]!==""&&(Ke+="="+encodeURIComponent(String(Mt[me]))),I.push(Ke)}}return this.i=I.join("&")};function $o(I,z){return z=String(z),I.j&&(z=z.toLowerCase()),z}function Ko(I,z){z&&!I.j&&(ls(I),I.i=null,I.g.forEach(function(Z,me){var Ke=me.toLowerCase();me!=Ke&&(Go(this,me),Xl(this,Ke,Z))},I)),I.j=z}function Yp(I,z){const Z=new Uu;if(y.Image){const me=new Image;me.onload=V(Es,Z,"TestLoadImage: loaded",!0,z,me),me.onerror=V(Es,Z,"TestLoadImage: error",!1,z,me),me.onabort=V(Es,Z,"TestLoadImage: abort",!1,z,me),me.ontimeout=V(Es,Z,"TestLoadImage: timeout",!1,z,me),y.setTimeout(function(){me.ontimeout&&me.ontimeout()},1e4),me.src=I}else z(!1)}function Cc(I,z){const Z=new Uu,me=new AbortController,Ke=setTimeout(()=>{me.abort(),Es(Z,"TestPingServer: timeout",!1,z)},1e4);fetch(I,{signal:me.signal}).then(ct=>{clearTimeout(Ke),ct.ok?Es(Z,"TestPingServer: ok",!0,z):Es(Z,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Ke),Es(Z,"TestPingServer: error",!1,z)})}function Es(I,z,Z,me,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),me(Z)}catch{}}function zu(){this.g=new wn}function Ef(I,z,Z){const me=Z||"";try{$l(I,function(Ke,ct){let Mt=Ke;b(Ke)&&(Mt=ii(Ke)),z.push(me+ct+"="+encodeURIComponent(Mt))})}catch(Ke){throw z.push(me+"type="+encodeURIComponent("_badmap")),Ke}}function fl(I){this.l=I.Ub||null,this.j=I.eb||!1}F(fl,ir),fl.prototype.g=function(){return new Jl(this.l,this.j)},fl.prototype.i=function(I){return function(){return I}}({});function Jl(I,z){Ln.call(this),this.D=I,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}F(Jl,Ln),n=Jl.prototype,n.open=function(I,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=I,this.A=z,this.readyState=1,Ra(this)},n.send=function(I){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};I&&(z.body=I),(this.D||y).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ca(this)),this.readyState=0},n.Sa=function(I){if(this.g&&(this.l=I,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=I.headers,this.readyState=2,Ra(this)),this.g&&(this.readyState=3,Ra(this),this.g)))if(this.responseType==="arraybuffer")I.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in I){if(this.j=I.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Xp(this)}else I.text().then(this.Ra.bind(this),this.ga.bind(this))};function Xp(I){I.j.read().then(I.Pa.bind(I)).catch(I.ga.bind(I))}n.Pa=function(I){if(this.g){if(this.o&&I.value)this.response.push(I.value);else if(!this.o){var z=I.value?I.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!I.done}))&&(this.response=this.responseText+=z)}I.done?Ca(this):Ra(this),this.readyState==3&&Xp(this)}},n.Ra=function(I){this.g&&(this.response=this.responseText=I,Ca(this))},n.Qa=function(I){this.g&&(this.response=I,Ca(this))},n.ga=function(){this.g&&Ca(this)};function Ca(I){I.readyState=4,I.l=null,I.j=null,I.v=null,Ra(I)}n.setRequestHeader=function(I,z){this.u.append(I,z)},n.getResponseHeader=function(I){return this.h&&this.h.get(I.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const I=[],z=this.h.entries();for(var Z=z.next();!Z.done;)Z=Z.value,I.push(Z[0]+": "+Z[1]),Z=z.next();return I.join(`\r
`)};function Ra(I){I.onreadystatechange&&I.onreadystatechange.call(I)}Object.defineProperty(Jl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(I){this.m=I?"include":"same-origin"}});function pl(I){let z="";return _e(I,function(Z,me){z+=me,z+=":",z+=Z,z+=`\r
`}),z}function Se(I,z,Z){e:{for(me in Z){var me=!1;break e}me=!0}me||(Z=pl(Z),typeof I=="string"?Z!=null&&encodeURIComponent(String(Z)):Kr(I,z,Z))}function De(I){Ln.call(this),this.headers=new Map,this.o=I||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}F(De,Ln);var et=/^https?$/i,Xt=["POST","PUT"];n=De.prototype,n.Ha=function(I){this.J=I},n.ea=function(I,z,Z,me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+I);z=z?z.toUpperCase():"GET",this.D=I,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qs.g(),this.v=this.o?xi(this.o):xi(qs),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(z,String(I),!0),this.B=!1}catch(ct){qn(this,ct);return}if(I=Z||"",Z=new Map(this.headers),me)if(Object.getPrototypeOf(me)===Object.prototype)for(var Ke in me)Z.set(Ke,me[Ke]);else if(typeof me.keys=="function"&&typeof me.get=="function")for(const ct of me.keys())Z.set(ct,me.get(ct));else throw Error("Unknown input type for opt_headers: "+String(me));me=Array.from(Z.keys()).find(ct=>ct.toLowerCase()=="content-type"),Ke=y.FormData&&I instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Xt,z,void 0))||me||Ke||Z.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ct,Mt]of Z)this.g.setRequestHeader(ct,Mt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Lr(this),this.u=!0,this.g.send(I),this.u=!1}catch(ct){qn(this,ct)}};function qn(I,z){I.h=!1,I.g&&(I.j=!0,I.g.abort(),I.j=!1),I.l=z,I.m=5,vr(I),ln(I)}function vr(I){I.A||(I.A=!0,cn(I,"complete"),cn(I,"error"))}n.abort=function(I){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=I||7,cn(this,"complete"),cn(this,"abort"),ln(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ln(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?zr(this):this.bb())},n.bb=function(){zr(this)};function zr(I){if(I.h&&typeof p<"u"&&(!I.v[1]||bi(I)!=4||I.Z()!=2)){if(I.u&&bi(I)==4)_a(I.Ea,0,I);else if(cn(I,"readystatechange"),bi(I)==4){I.h=!1;try{const Mt=I.Z();e:switch(Mt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var Z;if(!(Z=z)){var me;if(me=Mt===0){var Ke=String(I.D).match(Kl)[1]||null;!Ke&&y.self&&y.self.location&&(Ke=y.self.location.protocol.slice(0,-1)),me=!et.test(Ke?Ke.toLowerCase():"")}Z=me}if(Z)cn(I,"complete"),cn(I,"success");else{I.m=6;try{var ct=2<bi(I)?I.g.statusText:""}catch{ct=""}I.l=ct+" ["+I.Z()+"]",vr(I)}}finally{ln(I)}}}}function ln(I,z){if(I.g){Lr(I);const Z=I.g,me=I.v[0]?()=>{}:null;I.g=null,I.v=null,z||cn(I,"ready");try{Z.onreadystatechange=me}catch{}}}function Lr(I){I.I&&(y.clearTimeout(I.I),I.I=null)}n.isActive=function(){return!!this.g};function bi(I){return I.g?I.g.readyState:0}n.Z=function(){try{return 2<bi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(I){if(this.g){var z=this.g.responseText;return I&&z.indexOf(I)==0&&(z=z.substring(I.length)),Pt(z)}};function Us(I){try{if(!I.g)return null;if("response"in I.g)return I.g.response;switch(I.H){case"":case"text":return I.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in I.g)return I.g.mozResponseArrayBuffer}return null}catch{return null}}function qo(I){const z={};I=(I.g&&2<=bi(I)&&I.g.getAllResponseHeaders()||"").split(`\r
`);for(let me=0;me<I.length;me++){if($(I[me]))continue;var Z=fe(I[me]);const Ke=Z[0];if(Z=Z[1],typeof Z!="string")continue;Z=Z.trim();const ct=z[Ke]||[];z[Ke]=ct,ct.push(Z)}ne(z,function(me){return me.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Yo(I,z,Z){return Z&&Z.internalChannelParams&&Z.internalChannelParams[I]||z}function Gu(I){this.Aa=0,this.i=[],this.j=new Uu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Yo("failFast",!1,I),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Yo("baseRetryDelayMs",5e3,I),this.cb=Yo("retryDelaySeedMs",1e4,I),this.Wa=Yo("forwardChannelMaxRetries",2,I),this.wa=Yo("forwardChannelRequestTimeoutMs",2e4,I),this.pa=I&&I.xmlHttpFactory||void 0,this.Xa=I&&I.Tb||void 0,this.Ca=I&&I.useFetchStreams||!1,this.L=void 0,this.J=I&&I.supportsCrossDomainXhr||!1,this.K="",this.h=new Hl(I&&I.concurrentRequestLimit),this.Da=new zu,this.P=I&&I.fastHandshake||!1,this.O=I&&I.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=I&&I.Rb||!1,I&&I.xa&&this.j.xa(),I&&I.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&I&&I.detectBufferingProxy||!1,this.ja=void 0,I&&I.longPollingTimeout&&0<I.longPollingTimeout&&(this.ja=I.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Gu.prototype,n.la=8,n.G=1,n.connect=function(I,z,Z,me){zi(0),this.W=I,this.H=z||{},Z&&me!==void 0&&(this.H.OSID=Z,this.H.OAID=me),this.F=this.X,this.I=Bg(this,null,this.W),Rc(this)};function es(I){if(Yd(I),I.G==3){var z=I.U++,Z=Wo(I.I);if(Kr(Z,"SID",I.K),Kr(Z,"RID",z),Kr(Z,"TYPE","terminate"),Hu(I,Z),z=new Ta(I,I.j,z),z.L=2,z.v=ec(Wo(Z)),Z=!1,y.navigator&&y.navigator.sendBeacon)try{Z=y.navigator.sendBeacon(z.v.toString(),"")}catch{}!Z&&y.Image&&(new Image().src=z.v,Z=!0),Z||(z.g=eE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),Wr(z)}qu(I)}function ml(I){I.g&&(jg(I),I.g.cancel(),I.g=null)}function Yd(I){ml(I),I.u&&(y.clearTimeout(I.u),I.u=null),Zp(I),I.h.cancel(),I.s&&(typeof I.s=="number"&&y.clearTimeout(I.s),I.s=null)}function Rc(I){if(!vo(I.h)&&!I.s){I.s=!0;var z=I.Ga;we||Ne(),Re||(we(),Re=!0),ve.add(z,I),I.B=0}}function Fg(I,z){return $p(I.h)>=I.h.j-(I.s?1:0)?!1:I.s?(I.i=z.D.concat(I.i),!0):I.G==1||I.G==2||I.B>=(I.Va?0:I.Wa)?!1:(I.s=Ja(N(I.Ga,I,z),$u(I,I.B)),I.B++,!0)}n.Ga=function(I){if(this.s)if(this.s=null,this.G==1){if(!I){this.U=Math.floor(1e5*Math.random()),I=this.U++;const Ke=new Ta(this,this.j,I);let ct=this.o;if(this.S&&(ct?(ct=ee(ct),se(ct,this.S)):ct=this.S),this.m!==null||this.O||(Ke.H=ct,ct=null),this.P)e:{for(var z=0,Z=0;Z<this.i.length;Z++){t:{var me=this.i[Z];if("__data__"in me.map&&(me=me.map.__data__,typeof me=="string")){me=me.length;break t}me=void 0}if(me===void 0)break;if(z+=me,4096<z){z=Z;break e}if(z===4096||Z===this.i.length-1){z=Z+1;break e}}z=1e3}else z=1e3;z=Xo(this,Ke,z),Z=Wo(this.I),Kr(Z,"RID",I),Kr(Z,"CVER",22),this.D&&Kr(Z,"X-HTTP-Session-Id",this.D),Hu(this,Z),ct&&(this.O?z="headers="+encodeURIComponent(String(pl(ct)))+"&"+z:this.m&&Se(Z,this.m,ct)),gf(this.h,Ke),this.Ua&&Kr(Z,"TYPE","init"),this.P?(Kr(Z,"$req",z),Kr(Z,"SID","null"),Ke.T=!0,zd(Ke,Z,null)):zd(Ke,Z,z),this.G=2}}else this.G==3&&(I?Jp(this,I):this.i.length==0||vo(this.h)||Jp(this))};function Jp(I,z){var Z;z?Z=z.l:Z=I.U++;const me=Wo(I.I);Kr(me,"SID",I.K),Kr(me,"RID",Z),Kr(me,"AID",I.T),Hu(I,me),I.m&&I.o&&Se(me,I.m,I.o),Z=new Ta(I,I.j,Z,I.B+1),I.m===null&&(Z.H=I.o),z&&(I.i=z.D.concat(I.i)),z=Xo(I,Z,1e3),Z.I=Math.round(.5*I.wa)+Math.round(.5*I.wa*Math.random()),gf(I.h,Z),zd(Z,me,z)}function Hu(I,z){I.H&&_e(I.H,function(Z,me){Kr(z,me,Z)}),I.l&&$l({},function(Z,me){Kr(z,me,Z)})}function Xo(I,z,Z){Z=Math.min(I.i.length,Z);var me=I.l?N(I.l.Na,I.l,I):null;e:{var Ke=I.i;let ct=-1;for(;;){const Mt=["count="+Z];ct==-1?0<Z?(ct=Ke[0].g,Mt.push("ofs="+ct)):ct=0:Mt.push("ofs="+ct);let qr=!0;for(let hi=0;hi<Z;hi++){let Sr=Ke[hi].g;const Ys=Ke[hi].map;if(Sr-=ct,0>Sr)ct=Math.max(0,Ke[hi].g-100),qr=!1;else try{Ef(Ys,Mt,"req"+Sr+"_")}catch{me&&me(Ys)}}if(qr){me=Mt.join("&");break e}}}return I=I.i.splice(0,Z),z.D=I,me}function Ql(I){if(!I.g&&!I.u){I.Y=1;var z=I.Fa;we||Ne(),Re||(we(),Re=!0),ve.add(z,I),I.v=0}}function Qp(I){return I.g||I.u||3<=I.v?!1:(I.Y++,I.u=Ja(N(I.Fa,I),$u(I,I.v)),I.v++,!0)}n.Fa=function(){if(this.u=null,Zy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var I=2*this.R;this.j.info("BP detection timer enabled: "+I),this.A=Ja(N(this.ab,this),I)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,zi(10),ml(this),Zy(this))};function jg(I){I.A!=null&&(y.clearTimeout(I.A),I.A=null)}function Zy(I){I.g=new Ta(I,I.j,"rpc",I.Y),I.m===null&&(I.g.H=I.o),I.g.O=0;var z=Wo(I.qa);Kr(z,"RID","rpc"),Kr(z,"SID",I.K),Kr(z,"AID",I.T),Kr(z,"CI",I.F?"0":"1"),!I.F&&I.ja&&Kr(z,"TO",I.ja),Kr(z,"TYPE","xmlhttp"),Hu(I,z),I.m&&I.o&&Se(z,I.m,I.o),I.L&&(I.g.I=I.L);var Z=I.g;I=I.ia,Z.L=1,Z.v=ec(Wo(z)),Z.m=null,Z.P=!0,ju(Z,I)}n.Za=function(){this.C!=null&&(this.C=null,ml(this),Qp(this),zi(19))};function Zp(I){I.C!=null&&(y.clearTimeout(I.C),I.C=null)}function em(I,z){var Z=null;if(I.g==z){Zp(I),jg(I),I.g=null;var me=2}else if(io(I.h,z))Z=z.D,dl(I.h,z),me=1;else return;if(I.G!=0){if(z.o)if(me==1){Z=z.m?z.m.length:0,z=Date.now()-z.F;var Ke=I.B;me=ro(),cn(me,new ys(me,Z)),Rc(I)}else Ql(I);else if(Ke=z.s,Ke==3||Ke==0&&0<z.X||!(me==1&&Fg(I,z)||me==2&&Qp(I)))switch(Z&&0<Z.length&&(z=I.h,z.i=z.i.concat(Z)),Ke){case 1:Ku(I,5);break;case 4:Ku(I,10);break;case 3:Ku(I,6);break;default:Ku(I,2)}}}function $u(I,z){let Z=I.Ta+Math.floor(Math.random()*I.cb);return I.isActive()||(Z*=2),Z*z}function Ku(I,z){if(I.j.info("Error code "+z),z==2){var Z=N(I.fb,I),me=I.Xa;const Ke=!me;me=new Za(me||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Wu(me,"https"),ec(me),Ke?Yp(me.toString(),Z):Cc(me.toString(),Z)}else zi(2);I.G=0,I.l&&I.l.sa(z),qu(I),Yd(I)}n.fb=function(I){I?(this.j.info("Successfully pinged google.com"),zi(2)):(this.j.info("Failed to ping google.com"),zi(1))};function qu(I){if(I.G=0,I.ka=[],I.l){const z=$d(I.h);(z.length!=0||I.i.length!=0)&&(W(I.ka,z),W(I.ka,I.i),I.h.i.length=0,B(I.i),I.i.length=0),I.l.ra()}}function Bg(I,z,Z){var me=Z instanceof Za?Wo(Z):new Za(Z);if(me.g!="")z&&(me.g=z+"."+me.g),hl(me,me.s);else{var Ke=y.location;me=Ke.protocol,z=z?z+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;var ct=new Za(null);me&&Wu(ct,me),z&&(ct.g=z),Ke&&hl(ct,Ke),Z&&(ct.l=Z),me=ct}return Z=I.D,z=I.ya,Z&&z&&Kr(me,Z,z),Kr(me,"VER",I.la),Hu(I,me),me}function eE(I,z,Z){if(z&&!I.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=I.Ca&&!I.pa?new De(new fl({eb:Z})):new De(I.pa),z.Ha(I.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Vn(){}n=Vn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function tm(){}tm.prototype.g=function(I,z){return new Jo(I,z)};function Jo(I,z){Ln.call(this),this.g=new Gu(z),this.l=I,this.h=z&&z.messageUrlParams||null,I=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(I?I["X-Client-Protocol"]="webchannel":I={"X-Client-Protocol":"webchannel"}),this.g.o=I,I=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(I?I["X-WebChannel-Content-Type"]=z.messageContentType:I={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(I?I["X-WebChannel-Client-Profile"]=z.va:I={"X-WebChannel-Client-Profile":z.va}),this.g.S=I,(I=z&&z.Sb)&&!$(I)&&(this.g.m=I),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,I=this.h,I!==null&&z in I&&(I=this.h,z in I&&delete I[z])),this.j=new Ic(this)}F(Jo,Ln),Jo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Jo.prototype.close=function(){es(this.g)},Jo.prototype.o=function(I){var z=this.g;if(typeof I=="string"){var Z={};Z.__data__=I,I=Z}else this.u&&(Z={},Z.__data__=ii(I),I=Z);z.i.push(new Hd(z.Ya++,I)),z.G==3&&Rc(z)},Jo.prototype.N=function(){this.g.l=null,delete this.j,es(this.g),delete this.g,Jo.aa.N.call(this)};function tE(I){ya.call(this),I.__headers__&&(this.headers=I.__headers__,this.statusCode=I.__status__,delete I.__headers__,delete I.__status__);var z=I.__sm__;if(z){e:{for(const Z in z){I=Z;break e}I=void 0}(this.i=I)&&(I=this.i,z=z!==null&&I in z?z[I]:void 0),this.data=z}else this.data=I}F(tE,ya);function nE(){Eo.call(this),this.status=1}F(nE,Eo);function Ic(I){this.g=I}F(Ic,Vn),Ic.prototype.ua=function(){cn(this.g,"a")},Ic.prototype.ta=function(I){cn(this.g,new tE(I))},Ic.prototype.sa=function(I){cn(this.g,new nE)},Ic.prototype.ra=function(){cn(this.g,"b")},tm.prototype.createWebChannel=tm.prototype.g,Jo.prototype.send=Jo.prototype.o,Jo.prototype.open=Jo.prototype.m,Jo.prototype.close=Jo.prototype.close,Qre=function(){return new tm},Jre=function(){return ro()},Xre=Ea,IV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vu.NO_ERROR=0,Vu.TIMEOUT=8,Vu.HTTP_ERROR=6,uk=Vu,pf.COMPLETE="complete",Yre=pf,Sc.EventType=as,as.OPEN="a",as.CLOSE="b",as.ERROR="c",as.MESSAGE="d",Ln.prototype.listen=Ln.prototype.K,Gw=Sc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,qre=De}).apply(typeof OO<"u"?OO:typeof self<"u"?self:typeof window<"u"?window:{});const RX="@firebase/firestore",IX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ha.UNAUTHENTICATED=new Ha(null),Ha.GOOGLE_CREDENTIALS=new Ha("google-credentials-uid"),Ha.FIRST_PARTY=new Ha("first-party-uid"),Ha.MOCK_USER=new Ha("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let z0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vy=new xj("@firebase/firestore");function wS(){return Vy.logLevel}function Zt(n,...e){if(Vy.logLevel<=wr.DEBUG){const i=e.map(Hj);Vy.debug(`Firestore (${z0}): ${n}`,...i)}}function jp(n,...e){if(Vy.logLevel<=wr.ERROR){const i=e.map(Hj);Vy.error(`Firestore (${z0}): ${n}`,...i)}}function b0(n,...e){if(Vy.logLevel<=wr.WARN){const i=e.map(Hj);Vy.warn(`Firestore (${z0}): ${n}`,...i)}}function Hj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(n="Unexpected state"){const e=`FIRESTORE (${z0}) INTERNAL ASSERTION FAILED: `+n;throw jp(e),new Error(e)}function di(n,e){n||Wn()}function Jn(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ht extends hf{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zre{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class mje{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Ha.UNAUTHENTICATED))}shutdown(){}}class gje{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class _je{constructor(e){this.t=e,this.currentUser=Ha.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){di(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,i(v)):Promise.resolve();let d=new Dp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Dp,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=d;e.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{Zt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(Zt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Dp)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(Zt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(di(typeof a.accessToken=="string"),new Zre(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return di(e===null||typeof e=="string"),new Ha(e)}}class yje{constructor(e,i,a){this.l=e,this.h=i,this.P=a,this.type="FirstParty",this.user=Ha.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class Eje{constructor(e,i,a){this.l=e,this.h=i,this.P=a}getToken(){return Promise.resolve(new yje(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(Ha.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vje{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Nl(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){di(this.o===void 0);const a=d=>{d.error!=null&&Zt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,Zt("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>a(d))};const l=d=>{Zt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Zt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new AX(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(di(typeof i.token=="string"),this.R=i.token,new AX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sje(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tie{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=Sje(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=e.charAt(l[d]%62))}return a}}function fr(n,e){return n<e?-1:n>e?1:0}function AV(n,e){let i=0;for(;i<n.length&&i<e.length;){const a=n.codePointAt(i),l=e.codePointAt(i);if(a!==l){if(a<128&&l<128)return fr(a,l);{const d=eie(),p=bje(d.encode(PX(n,i)),d.encode(PX(e,i)));return p!==0?p:fr(a,l)}}i+=a>65535?2:1}return fr(n.length,e.length)}function PX(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function bje(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return fr(n[i],e[i]);return fr(n.length,e.length)}function T0(n,e,i){return n.length===e.length&&n.every((a,l)=>i(a,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OX=-62135596800,kX=1e6;class go{static now(){return go.fromMillis(Date.now())}static fromDate(e){return go.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor((e-1e3*i)*kX);return new go(i,a)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Ht(yt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Ht(yt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<OX)throw new Ht(yt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ht(yt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kX}_compareTo(e){return this.seconds===e.seconds?fr(this.nanoseconds,e.nanoseconds):fr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-OX;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{static fromTimestamp(e){return new Kn(e)}static min(){return new Kn(new go(0,0))}static max(){return new Kn(new go(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NX="__name__";class Uh{constructor(e,i,a){i===void 0?i=0:i>e.length&&Wn(),a===void 0?a=e.length-i:a>e.length-i&&Wn(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return Uh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Uh?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let l=0;l<a;l++){const d=Uh.compareSegments(e.get(l),i.get(l));if(d!==0)return d}return fr(e.length,i.length)}static compareSegments(e,i){const a=Uh.isNumericId(e),l=Uh.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?Uh.extractNumericId(e).compare(Uh.extractNumericId(i)):AV(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return gg.fromString(e.substring(4,e.length-2))}}class Ui extends Uh{construct(e,i,a){return new Ui(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new Ht(yt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new Ui(i)}static emptyPath(){return new Ui([])}}const Tje=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pa extends Uh{construct(e,i,a){return new pa(e,i,a)}static isValidIdentifier(e){return Tje.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===NX}static keyField(){return new pa([NX])}static fromServerFormat(e){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new Ht(yt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let p=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new Ht(yt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new Ht(yt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=v,l+=2}else y==="`"?(p=!p,l++):y!=="."||p?(a+=y,l++):(d(),l++)}if(d(),p)throw new Ht(yt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new pa(i)}static emptyPath(){return new pa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this.path=e}static fromPath(e){return new yn(Ui.fromString(e))}static fromName(e){return new yn(Ui.fromString(e).popFirst(5))}static empty(){return new yn(Ui.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ui.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ui.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new yn(new Ui(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UC=-1;function wje(n,e){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Kn.fromTimestamp(a===1e9?new go(i+1,0):new go(i,a));return new Cg(l,yn.empty(),e)}function Cje(n){return new Cg(n.readTime,n.key,UC)}class Cg{constructor(e,i,a){this.readTime=e,this.documentKey=i,this.largestBatchId=a}static min(){return new Cg(Kn.min(),yn.empty(),UC)}static max(){return new Cg(Kn.max(),yn.empty(),UC)}}function Rje(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=yn.comparator(n.documentKey,e.documentKey),i!==0?i:fr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ije="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Aje{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G0(n){if(n.code!==yt.FAILED_PRECONDITION||n.message!==Ije)throw n;Zt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Wn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new wt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof wt?i:wt.resolve(i)}catch(i){return wt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):wt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):wt.reject(i)}static resolve(e){return new wt((i,a)=>{i(e)})}static reject(e){return new wt((i,a)=>{a(e)})}static waitFor(e){return new wt((i,a)=>{let l=0,d=0,p=!1;e.forEach(y=>{++l,y.next(()=>{++d,p&&d===l&&i()},v=>a(v))}),p=!0,d===l&&i()})}static or(e){let i=wt.resolve(!1);for(const a of e)i=i.next(l=>l?wt.resolve(l):a());return i}static forEach(e,i){const a=[];return e.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(e,i){return new wt((a,l)=>{const d=e.length,p=new Array(d);let y=0;for(let v=0;v<d;v++){const b=v;i(e[b]).next(w=>{p[b]=w,++y,y===d&&a(p)},w=>l(w))}})}static doWhile(e,i){return new wt((a,l)=>{const d=()=>{e()===!0?i().next(()=>{d()},l):a()};d()})}}function Pje(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function H0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z1{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}z1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j=-1;function G1(n){return n==null}function Hk(n){return n===0&&1/n==-1/0}function Oje(n){return typeof n=="number"&&Number.isInteger(n)&&!Hk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nie="";function kje(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=DX(e)),e=Nje(n.get(i),e);return DX(e)}function Nje(n,e){let i=e;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case nie:i+="";break;default:i+=d}}return i}function DX(n){return n+nie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xX(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Mg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function rie(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,i){this.comparator=e,this.root=i||ha.EMPTY}insert(e,i){return new ms(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,ha.BLACK,null,null))}remove(e){return new ms(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ha.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new kO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new kO(this.root,e,this.comparator,!1)}getReverseIterator(){return new kO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new kO(this.root,e,this.comparator,!0)}}class kO{constructor(e,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=i?a(e.key,i):1,i&&l&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ha{constructor(e,i,a,l,d){this.key=e,this.value=i,this.color=a??ha.RED,this.left=l??ha.EMPTY,this.right=d??ha.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,l,d){return new ha(e??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let l=this;const d=a(e,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(e,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return ha.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return ha.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ha.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ha.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Wn();const e=this.left.check();if(e!==this.right.check())throw Wn();return e+(this.isRed()?0:1)}}ha.EMPTY=null,ha.RED=!0,ha.BLACK=!1;ha.EMPTY=new class{constructor(){this.size=0}get key(){throw Wn()}get value(){throw Wn()}get color(){throw Wn()}get left(){throw Wn()}get right(){throw Wn()}copy(e,i,a,l,d){return this}insert(e,i,a){return new ha(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e){this.comparator=e,this.data=new ms(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new LX(this.data.getIterator())}getIteratorFrom(e){return new LX(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof _o)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new _o(this.comparator);return i.data=e,i}}class LX{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(e){this.fields=e,e.sort(pa.comparator)}static empty(){return new Dl([])}unionWith(e){let i=new _o(pa.comparator);for(const a of this.fields)i=i.add(a);for(const a of e)i=i.add(a);return new Dl(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return T0(this.fields,e.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new iie("Invalid base64 string: "+d):d}}(e);return new ga(i)}static fromUint8Array(e){const i=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(e);return new ga(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return fr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ga.EMPTY_BYTE_STRING=new ga("");const Dje=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rg(n){if(di(!!n),typeof n=="string"){let e=0;const i=Dje.exec(n);if(di(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Hs(n.seconds),nanos:Hs(n.nanos)}}function Hs(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ig(n){return typeof n=="string"?ga.fromBase64String(n):ga.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sie="server_timestamp",oie="__type__",aie="__previous_value__",cie="__local_write_time__";function H1(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[oie])===null||i===void 0?void 0:i.stringValue)===sie}function $1(n){const e=n.mapValue.fields[aie];return H1(e)?$1(e):e}function VC(n){const e=Rg(n.mapValue.fields[cie].timestampValue);return new go(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xje{constructor(e,i,a,l,d,p,y,v,b){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b}}const $k="(default)";class FC{constructor(e,i){this.projectId=e,this.database=i||$k}static empty(){return new FC("","")}get isDefaultDatabase(){return this.database===$k}isEqual(e){return e instanceof FC&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lie="__type__",Lje="__max__",NO={mapValue:{}},uie="__vector__",Kk="value";function Ag(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?H1(n)?4:Uje(n)?9007199254740991:Mje(n)?10:11:Wn()}function cf(n,e){if(n===e)return!0;const i=Ag(n);if(i!==Ag(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return VC(n).isEqual(VC(e));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=Rg(l.timestampValue),y=Rg(d.timestampValue);return p.seconds===y.seconds&&p.nanos===y.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,d){return Ig(l.bytesValue).isEqual(Ig(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,d){return Hs(l.geoPointValue.latitude)===Hs(d.geoPointValue.latitude)&&Hs(l.geoPointValue.longitude)===Hs(d.geoPointValue.longitude)}(n,e);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Hs(l.integerValue)===Hs(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=Hs(l.doubleValue),y=Hs(d.doubleValue);return p===y?Hk(p)===Hk(y):isNaN(p)&&isNaN(y)}return!1}(n,e);case 9:return T0(n.arrayValue.values||[],e.arrayValue.values||[],cf);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},y=d.mapValue.fields||{};if(xX(p)!==xX(y))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(y[v]===void 0||!cf(p[v],y[v])))return!1;return!0}(n,e);default:return Wn()}}function jC(n,e){return(n.values||[]).find(i=>cf(i,e))!==void 0}function w0(n,e){if(n===e)return 0;const i=Ag(n),a=Ag(e);if(i!==a)return fr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return fr(n.booleanValue,e.booleanValue);case 2:return function(d,p){const y=Hs(d.integerValue||d.doubleValue),v=Hs(p.integerValue||p.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,e);case 3:return MX(n.timestampValue,e.timestampValue);case 4:return MX(VC(n),VC(e));case 5:return AV(n.stringValue,e.stringValue);case 6:return function(d,p){const y=Ig(d),v=Ig(p);return y.compareTo(v)}(n.bytesValue,e.bytesValue);case 7:return function(d,p){const y=d.split("/"),v=p.split("/");for(let b=0;b<y.length&&b<v.length;b++){const w=fr(y[b],v[b]);if(w!==0)return w}return fr(y.length,v.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,p){const y=fr(Hs(d.latitude),Hs(p.latitude));return y!==0?y:fr(Hs(d.longitude),Hs(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return UX(n.arrayValue,e.arrayValue);case 10:return function(d,p){var y,v,b,w;const A=d.fields||{},N=p.fields||{},V=(y=A[Kk])===null||y===void 0?void 0:y.arrayValue,F=(v=N[Kk])===null||v===void 0?void 0:v.arrayValue,B=fr(((b=V==null?void 0:V.values)===null||b===void 0?void 0:b.length)||0,((w=F==null?void 0:F.values)===null||w===void 0?void 0:w.length)||0);return B!==0?B:UX(V,F)}(n.mapValue,e.mapValue);case 11:return function(d,p){if(d===NO.mapValue&&p===NO.mapValue)return 0;if(d===NO.mapValue)return 1;if(p===NO.mapValue)return-1;const y=d.fields||{},v=Object.keys(y),b=p.fields||{},w=Object.keys(b);v.sort(),w.sort();for(let A=0;A<v.length&&A<w.length;++A){const N=AV(v[A],w[A]);if(N!==0)return N;const V=w0(y[v[A]],b[w[A]]);if(V!==0)return V}return fr(v.length,w.length)}(n.mapValue,e.mapValue);default:throw Wn()}}function MX(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return fr(n,e);const i=Rg(n),a=Rg(e),l=fr(i.seconds,a.seconds);return l!==0?l:fr(i.nanos,a.nanos)}function UX(n,e){const i=n.values||[],a=e.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=w0(i[l],a[l]);if(d)return d}return fr(i.length,a.length)}function C0(n){return PV(n)}function PV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=Rg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Ig(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return yn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=PV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const p of a)d?d=!1:l+=",",l+=`${p}:${PV(i.fields[p])}`;return l+"}"}(n.mapValue):Wn()}function dk(n){switch(Ag(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=$1(n);return e?16+dk(e):16;case 5:return 2*n.stringValue.length;case 6:return Ig(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+dk(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Mg(a.fields,(d,p)=>{l+=d.length+dk(p)}),l}(n.mapValue);default:throw Wn()}}function qk(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function OV(n){return!!n&&"integerValue"in n}function Kj(n){return!!n&&"arrayValue"in n}function VX(n){return!!n&&"nullValue"in n}function FX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function hk(n){return!!n&&"mapValue"in n}function Mje(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[lie])===null||i===void 0?void 0:i.stringValue)===uie}function lC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Mg(n.mapValue.fields,(i,a)=>e.mapValue.fields[i]=lC(a)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=lC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function Uje(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Lje}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e){this.value=e}static empty(){return new rl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!hk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=lC(i)}setAll(e){let i=pa.emptyPath(),a={},l=[];e.forEach((p,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,a,l),a={},l=[],i=y.popLast()}p?a[y.lastSegment()]=lC(p):l.push(y.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(e){const i=this.field(e.popLast());hk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return cf(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=i.mapValue.fields[e.get(a)];hk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,a){Mg(i,(l,d)=>e[l]=d);for(const l of a)delete e[l]}clone(){return new rl(lC(this.value))}}function die(n){const e=[];return Mg(n.fields,(i,a)=>{const l=new pa([i]);if(hk(a)){const d=die(a.mapValue).fields;if(d.length===0)e.push(l);else for(const p of d)e.push(l.child(p))}else e.push(l)}),new Dl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,i,a,l,d,p,y){this.key=e,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=p,this.documentState=y}static newInvalidDocument(e){return new $a(e,0,Kn.min(),Kn.min(),Kn.min(),rl.empty(),0)}static newFoundDocument(e,i,a,l){return new $a(e,1,i,Kn.min(),a,l,0)}static newNoDocument(e,i){return new $a(e,2,i,Kn.min(),Kn.min(),rl.empty(),0)}static newUnknownDocument(e,i){return new $a(e,3,i,Kn.min(),Kn.min(),rl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Kn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=rl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=rl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Kn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $a&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $a(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(e,i){this.position=e,this.inclusive=i}}function jX(n,e,i){let a=0;for(let l=0;l<n.position.length;l++){const d=e[l],p=n.position[l];if(d.field.isKeyField()?a=yn.comparator(yn.fromName(p.referenceValue),i.key):a=w0(p,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function BX(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!cf(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e,i="asc"){this.field=e,this.dir=i}}function Vje(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hie{}class no extends hie{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,a):new jje(e,i,a):i==="array-contains"?new zje(e,a):i==="in"?new Gje(e,a):i==="not-in"?new Hje(e,a):i==="array-contains-any"?new $je(e,a):new no(e,i,a)}static createKeyFieldInFilter(e,i,a){return i==="in"?new Bje(e,a):new Wje(e,a)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(w0(i,this.value)):i!==null&&Ag(this.value)===Ag(i)&&this.matchesComparison(w0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Wn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Md extends hie{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Md(e,i)}matches(e){return fie(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function fie(n){return n.op==="and"}function pie(n){return Fje(n)&&fie(n)}function Fje(n){for(const e of n.filters)if(e instanceof Md)return!1;return!0}function kV(n){if(n instanceof no)return n.field.canonicalString()+n.op.toString()+C0(n.value);if(pie(n))return n.filters.map(e=>kV(e)).join(",");{const e=n.filters.map(i=>kV(i)).join(",");return`${n.op}(${e})`}}function mie(n,e){return n instanceof no?function(a,l){return l instanceof no&&a.op===l.op&&a.field.isEqual(l.field)&&cf(a.value,l.value)}(n,e):n instanceof Md?function(a,l){return l instanceof Md&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,p,y)=>d&&mie(p,l.filters[y]),!0):!1}(n,e):void Wn()}function gie(n){return n instanceof no?function(i){return`${i.field.canonicalString()} ${i.op} ${C0(i.value)}`}(n):n instanceof Md?function(i){return i.op.toString()+" {"+i.getFilters().map(gie).join(" ,")+"}"}(n):"Filter"}class jje extends no{constructor(e,i,a){super(e,i,a),this.key=yn.fromName(a.referenceValue)}matches(e){const i=yn.comparator(e.key,this.key);return this.matchesComparison(i)}}class Bje extends no{constructor(e,i){super(e,"in",i),this.keys=_ie("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class Wje extends no{constructor(e,i){super(e,"not-in",i),this.keys=_ie("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function _ie(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>yn.fromName(a.referenceValue))}class zje extends no{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return Kj(i)&&jC(i.arrayValue,this.value)}}class Gje extends no{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&jC(this.value.arrayValue,i)}}class Hje extends no{constructor(e,i){super(e,"not-in",i)}matches(e){if(jC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!jC(this.value.arrayValue,i)}}class $je extends no{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!Kj(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>jC(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kje{constructor(e,i=null,a=[],l=[],d=null,p=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=p,this.endAt=y,this.le=null}}function WX(n,e=null,i=[],a=[],l=null,d=null,p=null){return new Kje(n,e,i,a,l,d,p)}function qj(n){const e=Jn(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>kV(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),G1(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(a=>C0(a)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(a=>C0(a)).join(",")),e.le=i}return e.le}function Yj(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!Vje(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!mie(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!BX(n.startAt,e.startAt)&&BX(n.endAt,e.endAt)}function NV(n){return yn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(e,i=null,a=[],l=[],d=null,p="F",y=null,v=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=p,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function qje(n,e,i,a,l,d,p,y){return new Ky(n,e,i,a,l,d,p,y)}function K1(n){return new Ky(n)}function zX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Xj(n){return n.collectionGroup!==null}function o0(n){const e=Jn(n);if(e.he===null){e.he=[];const i=new Set;for(const d of e.explicitOrderBy)e.he.push(d),i.add(d.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let y=new _o(pa.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(y=y.add(b.field))})}),y})(e).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||e.he.push(new BC(d,a))}),i.has(pa.keyField().canonicalString())||e.he.push(new BC(pa.keyField(),a))}return e.he}function rf(n){const e=Jn(n);return e.Pe||(e.Pe=Yje(e,o0(n))),e.Pe}function Yje(n,e){if(n.limitType==="F")return WX(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new BC(l.field,d)});const i=n.endAt?new R0(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new R0(n.startAt.position,n.startAt.inclusive):null;return WX(n.path,n.collectionGroup,e,n.filters,n.limit,i,a)}}function DV(n,e){const i=n.filters.concat([e]);return new Ky(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function xV(n,e,i){return new Ky(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function q1(n,e){return Yj(rf(n),rf(e))&&n.limitType===e.limitType}function yie(n){return`${qj(rf(n))}|lt:${n.limitType}`}function CS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>gie(l)).join(", ")}]`),G1(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>C0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>C0(l)).join(",")),`Target(${a})`}(rf(n))}; limitType=${n.limitType})`}function Y1(n,e){return e.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):yn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,e)&&function(a,l){for(const d of o0(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,e)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,e)&&function(a,l){return!(a.startAt&&!function(p,y,v){const b=jX(p,y,v);return p.inclusive?b<=0:b<0}(a.startAt,o0(a),l)||a.endAt&&!function(p,y,v){const b=jX(p,y,v);return p.inclusive?b>=0:b>0}(a.endAt,o0(a),l))}(n,e)}function Xje(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Eie(n){return(e,i)=>{let a=!1;for(const l of o0(n)){const d=Jje(l,e,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function Jje(n,e,i){const a=n.field.isKeyField()?yn.comparator(e.key,i.key):function(d,p,y){const v=p.data.field(d),b=y.data.field(d);return v!==null&&b!==null?w0(v,b):Wn()}(n.field,e,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Wn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,e))return d}}has(e){return this.get(e)!==void 0}set(e,i){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return void(l[d]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Mg(this.inner,(i,a)=>{for(const[l,d]of a)e(l,d)})}isEmpty(){return rie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qje=new ms(yn.comparator);function Bp(){return Qje}const vie=new ms(yn.comparator);function Hw(...n){let e=vie;for(const i of n)e=e.insert(i.key,i);return e}function Sie(n){let e=vie;return n.forEach((i,a)=>e=e.insert(i,a.overlayedDocument)),e}function yy(){return uC()}function bie(){return uC()}function uC(){return new qy(n=>n.toString(),(n,e)=>n.isEqual(e))}const Zje=new ms(yn.comparator),e4e=new _o(yn.comparator);function Cr(...n){let e=e4e;for(const i of n)e=e.add(i);return e}const t4e=new _o(fr);function n4e(){return t4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hk(e)?"-0":e}}function Tie(n){return{integerValue:""+n}}function r4e(n,e){return Oje(e)?Tie(e):Jj(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X1{constructor(){this._=void 0}}function i4e(n,e,i){return n instanceof Yk?function(l,d){const p={fields:{[oie]:{stringValue:sie},[cie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&H1(d)&&(d=$1(d)),d&&(p.fields[aie]=d),{mapValue:p}}(i,e):n instanceof I0?Cie(n,e):n instanceof A0?Rie(n,e):function(l,d){const p=wie(l,d),y=GX(p)+GX(l.Ie);return OV(p)&&OV(l.Ie)?Tie(y):Jj(l.serializer,y)}(n,e)}function s4e(n,e,i){return n instanceof I0?Cie(n,e):n instanceof A0?Rie(n,e):i}function wie(n,e){return n instanceof Xk?function(a){return OV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(e)?e:{integerValue:0}:null}class Yk extends X1{}class I0 extends X1{constructor(e){super(),this.elements=e}}function Cie(n,e){const i=Iie(e);for(const a of n.elements)i.some(l=>cf(l,a))||i.push(a);return{arrayValue:{values:i}}}class A0 extends X1{constructor(e){super(),this.elements=e}}function Rie(n,e){let i=Iie(e);for(const a of n.elements)i=i.filter(l=>!cf(l,a));return{arrayValue:{values:i}}}class Xk extends X1{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function GX(n){return Hs(n.integerValue||n.doubleValue)}function Iie(n){return Kj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aie{constructor(e,i){this.field=e,this.transform=i}}function o4e(n,e){return n.field.isEqual(e.field)&&function(a,l){return a instanceof I0&&l instanceof I0||a instanceof A0&&l instanceof A0?T0(a.elements,l.elements,cf):a instanceof Xk&&l instanceof Xk?cf(a.Ie,l.Ie):a instanceof Yk&&l instanceof Yk}(n.transform,e.transform)}class a4e{constructor(e,i){this.version=e,this.transformResults=i}}class xd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new xd}static exists(e){return new xd(void 0,e)}static updateTime(e){return new xd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class J1{}function Pie(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new kie(n.key,xd.none()):new gR(n.key,n.data,xd.none());{const i=n.data,a=rl.empty();let l=new _o(pa.comparator);for(let d of e.fields)if(!l.has(d)){let p=i.field(d);p===null&&d.length>1&&(d=d.popLast(),p=i.field(d)),p===null?a.delete(d):a.set(d,p),l=l.add(d)}return new Ug(n.key,a,new Dl(l.toArray()),xd.none())}}function c4e(n,e,i){n instanceof gR?function(l,d,p){const y=l.value.clone(),v=$X(l.fieldTransforms,d,p.transformResults);y.setAll(v),d.convertToFoundDocument(p.version,y).setHasCommittedMutations()}(n,e,i):n instanceof Ug?function(l,d,p){if(!fk(l.precondition,d))return void d.convertToUnknownDocument(p.version);const y=$X(l.fieldTransforms,d,p.transformResults),v=d.data;v.setAll(Oie(l)),v.setAll(y),d.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,e,i):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function dC(n,e,i,a){return n instanceof gR?function(d,p,y,v){if(!fk(d.precondition,p))return y;const b=d.value.clone(),w=KX(d.fieldTransforms,v,p);return b.setAll(w),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(n,e,i,a):n instanceof Ug?function(d,p,y,v){if(!fk(d.precondition,p))return y;const b=KX(d.fieldTransforms,v,p),w=p.data;return w.setAll(Oie(d)),w.setAll(b),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),y===null?null:y.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(A=>A.field))}(n,e,i,a):function(d,p,y){return fk(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):y}(n,e,i)}function l4e(n,e){let i=null;for(const a of n.fieldTransforms){const l=e.data.field(a.field),d=wie(a.transform,l||null);d!=null&&(i===null&&(i=rl.empty()),i.set(a.field,d))}return i||null}function HX(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&T0(a,l,(d,p)=>o4e(d,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class gR extends J1{constructor(e,i,a,l=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Ug extends J1{constructor(e,i,a,l,d=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Oie(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);e.set(i,a)}}),e}function $X(n,e,i){const a=new Map;di(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],p=d.transform,y=e.data.field(d.field);a.set(d.field,s4e(p,y,i[l]))}return a}function KX(n,e,i){const a=new Map;for(const l of n){const d=l.transform,p=i.data.field(l.field);a.set(l.field,i4e(d,p,e))}return a}class kie extends J1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class u4e extends J1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{constructor(e,i,a,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(e.key)&&c4e(d,e,a[l])}}applyToLocalView(e,i){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(i=dC(a,e,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(i=dC(a,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const a=bie();return this.mutations.forEach(l=>{const d=e.get(l.key),p=d.overlayedDocument;let y=this.applyToLocalView(p,d.mutatedFields);y=i.has(l.key)?null:y;const v=Pie(p,y);v!==null&&a.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(Kn.min())}),a}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Cr())}isEqual(e){return this.batchId===e.batchId&&T0(this.mutations,e.mutations,(i,a)=>HX(i,a))&&T0(this.baseMutations,e.baseMutations,(i,a)=>HX(i,a))}}class Qj{constructor(e,i,a,l){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(e,i,a){di(e.mutations.length===a.length);let l=function(){return Zje}();const d=e.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,a[p].version);return new Qj(e,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs,xr;function p4e(n){switch(n){case yt.OK:return Wn();case yt.CANCELLED:case yt.UNKNOWN:case yt.DEADLINE_EXCEEDED:case yt.RESOURCE_EXHAUSTED:case yt.INTERNAL:case yt.UNAVAILABLE:case yt.UNAUTHENTICATED:return!1;case yt.INVALID_ARGUMENT:case yt.NOT_FOUND:case yt.ALREADY_EXISTS:case yt.PERMISSION_DENIED:case yt.FAILED_PRECONDITION:case yt.ABORTED:case yt.OUT_OF_RANGE:case yt.UNIMPLEMENTED:case yt.DATA_LOSS:return!0;default:return Wn()}}function Nie(n){if(n===void 0)return jp("GRPC error has no .code"),yt.UNKNOWN;switch(n){case Qs.OK:return yt.OK;case Qs.CANCELLED:return yt.CANCELLED;case Qs.UNKNOWN:return yt.UNKNOWN;case Qs.DEADLINE_EXCEEDED:return yt.DEADLINE_EXCEEDED;case Qs.RESOURCE_EXHAUSTED:return yt.RESOURCE_EXHAUSTED;case Qs.INTERNAL:return yt.INTERNAL;case Qs.UNAVAILABLE:return yt.UNAVAILABLE;case Qs.UNAUTHENTICATED:return yt.UNAUTHENTICATED;case Qs.INVALID_ARGUMENT:return yt.INVALID_ARGUMENT;case Qs.NOT_FOUND:return yt.NOT_FOUND;case Qs.ALREADY_EXISTS:return yt.ALREADY_EXISTS;case Qs.PERMISSION_DENIED:return yt.PERMISSION_DENIED;case Qs.FAILED_PRECONDITION:return yt.FAILED_PRECONDITION;case Qs.ABORTED:return yt.ABORTED;case Qs.OUT_OF_RANGE:return yt.OUT_OF_RANGE;case Qs.UNIMPLEMENTED:return yt.UNIMPLEMENTED;case Qs.DATA_LOSS:return yt.DATA_LOSS;default:return Wn()}}(xr=Qs||(Qs={}))[xr.OK=0]="OK",xr[xr.CANCELLED=1]="CANCELLED",xr[xr.UNKNOWN=2]="UNKNOWN",xr[xr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xr[xr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xr[xr.NOT_FOUND=5]="NOT_FOUND",xr[xr.ALREADY_EXISTS=6]="ALREADY_EXISTS",xr[xr.PERMISSION_DENIED=7]="PERMISSION_DENIED",xr[xr.UNAUTHENTICATED=16]="UNAUTHENTICATED",xr[xr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xr[xr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xr[xr.ABORTED=10]="ABORTED",xr[xr.OUT_OF_RANGE=11]="OUT_OF_RANGE",xr[xr.UNIMPLEMENTED=12]="UNIMPLEMENTED",xr[xr.INTERNAL=13]="INTERNAL",xr[xr.UNAVAILABLE=14]="UNAVAILABLE",xr[xr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4e=new gg([4294967295,4294967295],0);function qX(n){const e=eie().encode(n),i=new Kre;return i.update(e),new Uint8Array(i.digest())}function YX(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new gg([i,a],0),new gg([l,d],0)]}class Zj{constructor(e,i,a){if(this.bitmap=e,this.padding=i,this.hashCount=a,i<0||i>=8)throw new $w(`Invalid padding: ${i}`);if(a<0)throw new $w(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new $w(`Invalid hash count: ${a}`);if(e.length===0&&i!==0)throw new $w(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=gg.fromNumber(this.Ee)}Ae(e,i,a){let l=e.add(i.multiply(gg.fromNumber(a)));return l.compare(m4e)===1&&(l=new gg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=qX(e),[a,l]=YX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);if(!this.Re(p))return!1}return!0}static create(e,i,a){const l=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),p=new Zj(d,l,i);return a.forEach(y=>p.insert(y)),p}insert(e){if(this.Ee===0)return;const i=qX(e),[a,l]=YX(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(a,l,d);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),a=e%8;this.bitmap[i]|=1<<a}}class $w extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q1{constructor(e,i,a,l,d){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,i,a){const l=new Map;return l.set(e,_R.createSynthesizedTargetChangeForCurrentChange(e,i,a)),new Q1(Kn.min(),l,new ms(fr),Bp(),Cr())}}class _R{constructor(e,i,a,l,d){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,i,a){return new _R(a,i,Cr(),Cr(),Cr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,i,a,l){this.me=e,this.removedTargetIds=i,this.key=a,this.fe=l}}class Die{constructor(e,i){this.targetId=e,this.ge=i}}class xie{constructor(e,i,a=ga.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=l}}class XX{constructor(){this.pe=0,this.ye=JX(),this.we=ga.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Cr(),i=Cr(),a=Cr();return this.ye.forEach((l,d)=>{switch(d){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Wn()}}),new _R(this.we,this.Se,e,i,a)}Me(){this.be=!1,this.ye=JX()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,di(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class g4e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Bp(),this.$e=DO(),this.Ue=DO(),this.Ke=new ms(fr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const a=this.He(i);switch(e.state){case 0:this.Je(i)&&a.Ce(e.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(e.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(e.resumeToken));break;default:Wn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,a=e.ge.count,l=this.Xe(i);if(l){const d=l.target;if(NV(d))if(a===0){const p=new yn(d.path);this.ze(i,p,$a.newNoDocument(p,Kn.min()))}else di(a===1);else{const p=this.et(i);if(p!==a){const y=this.tt(e),v=y?this.nt(y,e,p):1;if(v!==0){this.Ye(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let p,y;try{p=Ig(a).toUint8Array()}catch(v){if(v instanceof iie)return b0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new Zj(p,l,d)}catch(v){return b0(v instanceof $w?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(e,i,a){return i.ge.count===a-this.st(e,i.targetId)?0:2}st(e,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const p=this.ke.it(),y=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;e.mightContain(y)||(this.ze(i,d,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((d,p)=>{const y=this.Xe(p);if(y){if(d.current&&NV(y.target)){const v=new yn(y.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,$a.newNoDocument(v,e))}d.ve&&(i.set(p,d.Fe()),d.Me())}});let a=Cr();this.Ue.forEach((d,p)=>{let y=!0;p.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(a=a.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(e));const l=new Q1(e,i,this.Ke,this.Qe,a);return this.Qe=Bp(),this.$e=DO(),this.Ue=DO(),this.Ke=new ms(fr),l}Ge(e,i){if(!this.Je(e))return;const a=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,a){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new XX,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new _o(fr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new _o(fr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||Zt("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new XX),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function DO(){return new ms(yn.comparator)}function JX(){return new ms(yn.comparator)}const _4e={asc:"ASCENDING",desc:"DESCENDING"},y4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},E4e={and:"AND",or:"OR"};class v4e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function LV(n,e){return n.useProto3Json||G1(e)?e:{value:e}}function Jk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Lie(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function S4e(n,e){return Jk(n,e.toTimestamp())}function sf(n){return di(!!n),Kn.fromTimestamp(function(i){const a=Rg(i);return new go(a.seconds,a.nanos)}(n))}function e4(n,e){return MV(n,e).canonicalString()}function MV(n,e){const i=function(l){return new Ui(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Mie(n){const e=Ui.fromString(n);return di(Bie(e)),e}function UV(n,e){return e4(n.databaseId,e.path)}function rU(n,e){const i=Mie(e);if(i.get(1)!==n.databaseId.projectId)throw new Ht(yt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Ht(yt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new yn(Vie(i))}function Uie(n,e){return e4(n.databaseId,e)}function b4e(n){const e=Mie(n);return e.length===4?Ui.emptyPath():Vie(e)}function VV(n){return new Ui(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Vie(n){return di(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function QX(n,e,i){return{name:UV(n,e),fields:i.value.mapValue.fields}}function T4e(n,e){let i;if("targetChange"in e){e.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Wn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(di(w===void 0||typeof w=="string"),ga.fromBase64String(w||"")):(di(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ga.fromUint8Array(w||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,y=p&&function(b){const w=b.code===void 0?yt.UNKNOWN:Nie(b.code);return new Ht(w,b.message||"")}(p);i=new xie(a,l,d,y||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=rU(n,a.document.name),d=sf(a.document.updateTime),p=a.document.createTime?sf(a.document.createTime):Kn.min(),y=new rl({mapValue:{fields:a.document.fields}}),v=$a.newFoundDocument(l,d,p,y),b=a.targetIds||[],w=a.removedTargetIds||[];i=new pk(b,w,v.key,v)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=rU(n,a.document),d=a.readTime?sf(a.readTime):Kn.min(),p=$a.newNoDocument(l,d),y=a.removedTargetIds||[];i=new pk([],y,p.key,p)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=rU(n,a.document),d=a.removedTargetIds||[];i=new pk([],d,l,null)}else{if(!("filter"in e))return Wn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,p=new f4e(l,d),y=a.targetId;i=new Die(y,p)}}return i}function w4e(n,e){let i;if(e instanceof gR)i={update:QX(n,e.key,e.value)};else if(e instanceof kie)i={delete:UV(n,e.key)};else if(e instanceof Ug)i={update:QX(n,e.key,e.data),updateMask:D4e(e.fieldMask)};else{if(!(e instanceof u4e))return Wn();i={verify:UV(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(d,p){const y=p.transform;if(y instanceof Yk)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof I0)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof A0)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Xk)return{fieldPath:p.field.canonicalString(),increment:y.Ie};throw Wn()}(0,a))),e.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:S4e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Wn()}(n,e.precondition)),i}function C4e(n,e){return n&&n.length>0?(di(e!==void 0),n.map(i=>function(l,d){let p=l.updateTime?sf(l.updateTime):sf(d);return p.isEqual(Kn.min())&&(p=sf(d)),new a4e(p,l.transformResults||[])}(i,e))):[]}function R4e(n,e){return{documents:[Uie(n,e.path)]}}function I4e(n,e){const i={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=Uie(n,l);const d=function(b){if(b.length!==0)return jie(Md.create(b,"and"))}(e.filters);d&&(i.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(w=>function(N){return{field:RS(N.field),direction:O4e(N.dir)}}(w))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const y=LV(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function A4e(n){let e=b4e(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){di(a===1);const w=i.from[0];w.allDescendants?l=w.collectionId:e=e.child(w.collectionId)}let d=[];i.where&&(d=function(A){const N=Fie(A);return N instanceof Md&&pie(N)?N.getFilters():[N]}(i.where));let p=[];i.orderBy&&(p=function(A){return A.map(N=>function(F){return new BC(IS(F.field),function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(F.direction))}(N))}(i.orderBy));let y=null;i.limit&&(y=function(A){let N;return N=typeof A=="object"?A.value:A,G1(N)?null:N}(i.limit));let v=null;i.startAt&&(v=function(A){const N=!!A.before,V=A.values||[];return new R0(V,N)}(i.startAt));let b=null;return i.endAt&&(b=function(A){const N=!A.before,V=A.values||[];return new R0(V,N)}(i.endAt)),qje(e,l,p,d,y,"F",v,b)}function P4e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Wn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Fie(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=IS(i.unaryFilter.field);return no.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=IS(i.unaryFilter.field);return no.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=IS(i.unaryFilter.field);return no.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=IS(i.unaryFilter.field);return no.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Wn()}}(n):n.fieldFilter!==void 0?function(i){return no.create(IS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Wn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Md.create(i.compositeFilter.filters.map(a=>Fie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Wn()}}(i.compositeFilter.op))}(n):Wn()}function O4e(n){return _4e[n]}function k4e(n){return y4e[n]}function N4e(n){return E4e[n]}function RS(n){return{fieldPath:n.canonicalString()}}function IS(n){return pa.fromServerFormat(n.fieldPath)}function jie(n){return n instanceof no?function(i){if(i.op==="=="){if(FX(i.value))return{unaryFilter:{field:RS(i.field),op:"IS_NAN"}};if(VX(i.value))return{unaryFilter:{field:RS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(FX(i.value))return{unaryFilter:{field:RS(i.field),op:"IS_NOT_NAN"}};if(VX(i.value))return{unaryFilter:{field:RS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:RS(i.field),op:k4e(i.op),value:i.value}}}(n):n instanceof Md?function(i){const a=i.getFilters().map(l=>jie(l));return a.length===1?a[0]:{compositeFilter:{op:N4e(i.op),filters:a}}}(n):Wn()}function D4e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Bie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,i,a,l,d=Kn.min(),p=Kn.min(),y=ga.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(e){return new fg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new fg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4e{constructor(e){this.Tt=e}}function L4e(n){const e=A4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?xV(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4e{constructor(){this.Tn=new U4e}addToCollectionParentIndex(e,i){return this.Tn.add(i),wt.resolve()}getCollectionParents(e,i){return wt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return wt.resolve()}deleteFieldIndex(e,i){return wt.resolve()}deleteAllFieldIndexes(e){return wt.resolve()}createTargetIndexes(e,i){return wt.resolve()}getDocumentsMatchingTarget(e,i){return wt.resolve(null)}getIndexType(e,i){return wt.resolve(0)}getFieldIndexes(e,i){return wt.resolve([])}getNextCollectionGroupToUpdate(e){return wt.resolve(null)}getMinOffset(e,i){return wt.resolve(Cg.min())}getMinOffsetFromCollectionGroup(e,i){return wt.resolve(Cg.min())}updateCollectionGroup(e,i,a){return wt.resolve()}updateIndexEntries(e,i){return wt.resolve()}}class U4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i]||new _o(Ui.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(e){return(this.index[e]||new _o(Ui.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Wie=41943040;class tl{static withCacheSize(e){return new tl(e,tl.DEFAULT_COLLECTION_PERCENTILE,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tl.DEFAULT_COLLECTION_PERCENTILE=10,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tl.DEFAULT=new tl(Wie,tl.DEFAULT_COLLECTION_PERCENTILE,tl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tl.DISABLED=new tl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new P0(0)}static Kn(){return new P0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eJ="LruGarbageCollector",V4e=1048576;function tJ([n,e],[i,a]){const l=fr(n,i);return l===0?fr(e,a):l}class F4e{constructor(e){this.Hn=e,this.buffer=new _o(tJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();tJ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class j4e{constructor(e,i,a){this.garbageCollector=e,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Zt(eJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){H0(i)?Zt(eJ,"Ignoring IndexedDB error during garbage collection: ",i):await G0(i)}await this.er(3e5)})}}class B4e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(i===0)return wt.resolve(z1.ae);const a=new F4e(i);return this.tr.forEachTarget(e,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.tr.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(Zt("LruGarbageCollector","Garbage collection skipped; disabled"),wt.resolve(ZX)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(Zt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ZX):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let a,l,d,p,y,v,b;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(A=>(A>this.params.maximumSequenceNumbersToCollect?(Zt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${A}`),l=this.params.maximumSequenceNumbersToCollect):l=A,p=Date.now(),this.nthSequenceNumber(e,l))).next(A=>(a=A,y=Date.now(),this.removeTargets(e,a,i))).next(A=>(d=A,v=Date.now(),this.removeOrphanedDocuments(e,a))).next(A=>(b=Date.now(),wS()<=wr.DEBUG&&Zt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-w}ms
	Determined least recently used ${l} in `+(y-p)+`ms
	Removed ${d} targets in `+(v-y)+`ms
	Removed ${A} documents in `+(b-v)+`ms
Total Duration: ${b-w}ms`),wt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:A})))}}function W4e(n,e){return new B4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4e{constructor(){this.changes=new qy(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,$a.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?wt.resolve(a):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4e{constructor(e,i,a,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,i){let a=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(a!==null&&dC(a.mutation,l,Dl.empty(),go.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.getLocalViewOfDocuments(e,a,Cr()).next(()=>a))}getLocalViewOfDocuments(e,i,a=Cr()){const l=yy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,a).next(d=>{let p=Hw();return d.forEach((y,v)=>{p=p.insert(y,v.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const a=yy();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,Cr()))}populateOverlays(e,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(e,l).next(d=>{d.forEach((p,y)=>{i.set(p,y)})})}computeViews(e,i,a,l){let d=Bp();const p=uC(),y=function(){return uC()}();return i.forEach((v,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Ug)?d=d.insert(b.key,b):w!==void 0?(p.set(b.key,w.mutation.getFieldMask()),dC(w.mutation,b,w.mutation.getFieldMask(),go.now())):p.set(b.key,Dl.empty())}),this.recalculateAndSaveOverlays(e,d).next(v=>(v.forEach((b,w)=>p.set(b,w)),i.forEach((b,w)=>{var A;return y.set(b,new G4e(w,(A=p.get(b))!==null&&A!==void 0?A:null))}),y))}recalculateAndSaveOverlays(e,i){const a=uC();let l=new ms((p,y)=>p-y),d=Cr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const y of p)y.keys().forEach(v=>{const b=i.get(v);if(b===null)return;let w=a.get(v)||Dl.empty();w=y.applyToLocalView(b,w),a.set(v,w);const A=(l.get(y.batchId)||Cr()).add(v);l=l.insert(y.batchId,A)})}).next(()=>{const p=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,w=v.value,A=bie();w.forEach(N=>{if(!d.has(N)){const V=Pie(i.get(N),a.get(N));V!==null&&A.set(N,V),d=d.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(e,b,A))}return wt.waitFor(p)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,i,a,l){return function(p){return yn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):Xj(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,a,l):this.getDocumentsMatchingCollectionQuery(e,i,a,l)}getNextDocuments(e,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,a,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,a.largestBatchId,l-d.size):wt.resolve(yy());let y=UC,v=d;return p.next(b=>wt.forEach(b,(w,A)=>(y<A.largestBatchId&&(y=A.largestBatchId),d.get(w)?wt.resolve():this.remoteDocumentCache.getEntry(e,w).next(N=>{v=v.insert(w,N)}))).next(()=>this.populateOverlays(e,b,d)).next(()=>this.computeViews(e,v,b,Cr())).next(w=>({batchId:y,changes:Sie(w)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new yn(i)).next(a=>{let l=Hw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,a,l){const d=i.collectionGroup;let p=Hw();return this.indexManager.getCollectionParents(e,d).next(y=>wt.forEach(y,v=>{const b=function(A,N){return new Ky(N,null,A.explicitOrderBy.slice(),A.filters.slice(),A.limit,A.limitType,A.startAt,A.endAt)}(i,v.child(d));return this.getDocumentsMatchingCollectionQuery(e,b,a,l).next(w=>{w.forEach((A,N)=>{p=p.insert(A,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,a.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,a,d,l))).next(p=>{d.forEach((v,b)=>{const w=b.getKey();p.get(w)===null&&(p=p.insert(w,$a.newInvalidDocument(w)))});let y=Hw();return p.forEach((v,b)=>{const w=d.get(v);w!==void 0&&dC(w.mutation,b,Dl.empty(),go.now()),Y1(i,b)&&(y=y.insert(v,b))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return wt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:sf(l.createTime)}}(i)),wt.resolve()}getNamedQuery(e,i){return wt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:L4e(l.bundledQuery),readTime:sf(l.readTime)}}(i)),wt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4e{constructor(){this.overlays=new ms(yn.comparator),this.Rr=new Map}getOverlay(e,i){return wt.resolve(this.overlays.get(i))}getOverlays(e,i){const a=yy();return wt.forEach(i,l=>this.getOverlay(e,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(e,i,a){return a.forEach((l,d)=>{this.Et(e,i,d)}),wt.resolve()}removeOverlaysForBatchId(e,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),wt.resolve()}getOverlaysForCollection(e,i,a){const l=yy(),d=i.length+1,p=new yn(i.child("")),y=this.overlays.getIteratorFrom(p);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return wt.resolve(l)}getOverlaysForCollectionGroup(e,i,a,l){let d=new ms((b,w)=>b-w);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=yy(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const y=yy(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,w)=>y.set(b,w)),!(y.size()>=l)););return wt.resolve(y)}Et(e,i,a){const l=this.overlays.get(a.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(a.key,new h4e(i,a));let d=this.Rr.get(i);d===void 0&&(d=Cr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4e{constructor(){this.sessionToken=ga.EMPTY_BYTE_STRING}getSessionToken(e){return wt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,wt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{constructor(){this.Vr=new _o(Do.mr),this.gr=new _o(Do.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const a=new Do(e,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.wr(new Do(e,i))}Sr(e,i){e.forEach(a=>this.removeReference(a,i))}br(e){const i=new yn(new Ui([])),a=new Do(i,e),l=new Do(i,e+1),d=[];return this.gr.forEachInRange([a,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new yn(new Ui([])),a=new Do(i,e),l=new Do(i,e+1);let d=Cr();return this.gr.forEachInRange([a,l],p=>{d=d.add(p.key)}),d}containsKey(e){const i=new Do(e,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&e.isEqual(a.key)}}class Do{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return yn.comparator(e.key,i.key)||fr(e.Cr,i.Cr)}static pr(e,i){return fr(e.Cr,i.Cr)||yn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new _o(Do.mr)}checkEmpty(e){return wt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new d4e(d,i,a,l);this.mutationQueue.push(p);for(const y of l)this.Mr=this.Mr.add(new Do(y.key,d)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return wt.resolve(p)}lookupMutationBatch(e,i){return wt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return wt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return wt.resolve(this.mutationQueue.length===0?$j:this.Fr-1)}getAllMutationBatches(e){return wt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new Do(i,0),l=new Do(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],p=>{const y=this.Or(p.Cr);d.push(y)}),wt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new _o(fr);return i.forEach(l=>{const d=new Do(l,0),p=new Do(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],y=>{a=a.add(y.Cr)})}),wt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,l=a.length+1;let d=a;yn.isDocumentKey(d)||(d=d.child(""));const p=new Do(new yn(d),0);let y=new _o(fr);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Cr)),!0)},p),wt.resolve(this.Br(y))}Br(e){const i=[];return e.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){di(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return wt.forEach(i.mutations,l=>{const d=new Do(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=a})}qn(e){}containsKey(e,i){const a=new Do(i,0),l=this.Mr.firstAfterOrEqual(a);return wt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,wt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4e{constructor(e){this.kr=e,this.docs=function(){return new ms(yn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return wt.resolve(a?a.document.mutableCopy():$a.newInvalidDocument(i))}getEntries(e,i){let a=Bp();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():$a.newInvalidDocument(l))}),wt.resolve(a)}getDocumentsMatchingQuery(e,i,a,l){let d=Bp();const p=i.path,y=new yn(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:w}}=v.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||Rje(Cje(w),a)<=0||(l.has(w.key)||Y1(i,w))&&(d=d.insert(w.key,w.mutableCopy()))}return wt.resolve(d)}getAllFromCollectionGroup(e,i,a,l){Wn()}qr(e,i){return wt.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new J4e(this)}getSize(e){return wt.resolve(this.size)}}class J4e extends z4e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(a)}),wt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4e{constructor(e){this.persistence=e,this.Qr=new qy(i=>qj(i),Yj),this.lastRemoteSnapshotVersion=Kn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new t4,this.targetCount=0,this.Kr=P0.Un()}forEachTarget(e,i){return this.Qr.forEach((a,l)=>i(l)),wt.resolve()}getLastRemoteSnapshotVersion(e){return wt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return wt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),wt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),wt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new P0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,wt.resolve()}updateTargetData(e,i){return this.zn(i),wt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,wt.resolve()}removeTargets(e,i,a){let l=0;const d=[];return this.Qr.forEach((p,y)=>{y.sequenceNumber<=i&&a.get(y.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)}),wt.waitFor(d).next(()=>l)}getTargetCount(e){return wt.resolve(this.targetCount)}getTargetData(e,i){const a=this.Qr.get(i)||null;return wt.resolve(a)}addMatchingKeys(e,i,a){return this.Ur.yr(i,a),wt.resolve()}removeMatchingKeys(e,i,a){this.Ur.Sr(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(p=>{d.push(l.markPotentiallyOrphaned(e,p))}),wt.waitFor(d)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),wt.resolve()}getMatchingKeysForTargetId(e,i){const a=this.Ur.vr(i);return wt.resolve(a)}containsKey(e,i){return wt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new z1(0),this.zr=!1,this.zr=!0,this.jr=new q4e,this.referenceDelegate=e(this),this.Hr=new Q4e(this),this.indexManager=new M4e,this.remoteDocumentCache=function(l){return new X4e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new x4e(i),this.Yr=new $4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new K4e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let a=this.Wr[e.toKey()];return a||(a=new Y4e(i,this.referenceDelegate),this.Wr[e.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,a){Zt("MemoryPersistence","Starting transaction:",e);const l=new Z4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(e,i){return wt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(e,i)))}}class Z4e extends Aje{constructor(e){super(),this.currentSequenceNumber=e}}class n4{constructor(e){this.persistence=e,this.ti=new t4,this.ni=null}static ri(e){return new n4(e)}get ii(){if(this.ni)return this.ni;throw Wn()}addReference(e,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),wt.resolve()}removeReference(e,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),wt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),wt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wt.forEach(this.ii,a=>{const l=yn.fromPath(a);return this.si(e,l).next(d=>{d||i.removeEntry(l,Kn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return wt.or([()=>wt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class Qk{constructor(e,i){this.persistence=e,this.oi=new qy(a=>kje(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=W4e(this,i)}static ri(e,i){return new Qk(e,i)}Zr(){}Xr(e){return wt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>i.next(l=>a+l))}sr(e){let i=0;return this.rr(e,a=>{i++}).next(()=>i)}rr(e,i){return wt.forEach(this.oi,(a,l)=>this.ar(e,a,l).next(d=>d?wt.resolve():i(l)))}removeTargets(e,i,a){return this.persistence.getTargetCache().removeTargets(e,i,a)}removeOrphanedDocuments(e,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(y=>{y||(a++,d.removeEntry(p,Kn.min()))})).next(()=>d.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),wt.resolve()}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),wt.resolve()}removeReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),wt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),wt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=dk(e.data.value)),i}ar(e,i,a){return wt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return wt.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4{constructor(e,i,a,l){this.targetId=e,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(e,i){let a=Cr(),l=Cr();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new r4(e,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return L2e()?8:Pje(Ya())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,a,l){const d={result:null};return this.rs(e,i).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(e,i,l,a).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new e3e;return this._s(e,i,p).next(y=>{if(d.result=y,this.Xi)return this.us(e,i,p,y.size)})}).next(()=>d.result)}us(e,i,a,l){return a.documentReadCount<this.es?(wS()<=wr.DEBUG&&Zt("QueryEngine","SDK will not create cache indexes for query:",CS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),wt.resolve()):(wS()<=wr.DEBUG&&Zt("QueryEngine","Query:",CS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(wS()<=wr.DEBUG&&Zt("QueryEngine","The SDK decides to create cache indexes for query:",CS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,rf(i))):wt.resolve())}rs(e,i){if(zX(i))return wt.resolve(null);let a=rf(i);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=xV(i,null,"F"),a=rf(i)),this.indexManager.getDocumentsMatchingTarget(e,a).next(d=>{const p=Cr(...d);return this.ns.getDocuments(e,p).next(y=>this.indexManager.getMinOffset(e,a).next(v=>{const b=this.cs(i,y);return this.ls(i,b,p,v.readTime)?this.rs(e,xV(i,null,"F")):this.hs(e,b,i,v)}))})))}ss(e,i,a,l){return zX(i)||l.isEqual(Kn.min())?wt.resolve(null):this.ns.getDocuments(e,a).next(d=>{const p=this.cs(i,d);return this.ls(i,p,a,l)?wt.resolve(null):(wS()<=wr.DEBUG&&Zt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),CS(i)),this.hs(e,p,i,wje(l,UC)).next(y=>y))})}cs(e,i){let a=new _o(Eie(e));return i.forEach((l,d)=>{Y1(e,d)&&(a=a.add(d))}),a}ls(e,i,a,l){if(e.limit===null)return!1;if(a.size!==i.size)return!0;const d=e.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(e,i,a){return wS()<=wr.DEBUG&&Zt("QueryEngine","Using full collection scan to execute query:",CS(i)),this.ns.getDocumentsMatchingQuery(e,i,Cg.min(),a)}hs(e,i,a,l){return this.ns.getDocumentsMatchingQuery(e,a,l).next(d=>(i.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4="LocalStore",n3e=3e8;class r3e{constructor(e,i,a,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ms(fr),this.Is=new qy(d=>qj(d),Yj),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(a)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new H4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function i3e(n,e,i,a){return new r3e(n,e,i,a)}async function Gie(n,e){const i=Jn(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(e),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const p=[],y=[];let v=Cr();for(const b of l){p.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}for(const b of d){y.push(b.batchId);for(const w of b.mutations)v=v.add(w.key)}return i.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:y}))})})}function s3e(n,e){const i=Jn(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,b,w){const A=b.batch,N=A.keys();let V=wt.resolve();return N.forEach(F=>{V=V.next(()=>w.getEntry(v,F)).next(B=>{const W=b.docVersions.get(F);di(W!==null),B.version.compareTo(W)<0&&(A.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),w.addEntry(B)))})}),V.next(()=>y.mutationQueue.removeMutationBatch(v,A))}(i,a,e,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(y){let v=Cr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v}(e))).next(()=>i.localDocuments.getDocuments(a,l))})}function Hie(n){const e=Jn(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function o3e(n,e){const i=Jn(n),a=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const y=[];e.targetChanges.forEach((w,A)=>{const N=l.get(A);if(!N)return;y.push(i.Hr.removeMatchingKeys(d,w.removedDocuments,A).next(()=>i.Hr.addMatchingKeys(d,w.addedDocuments,A)));let V=N.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(A)!==null?V=V.withResumeToken(ga.EMPTY_BYTE_STRING,Kn.min()).withLastLimboFreeSnapshotVersion(Kn.min()):w.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(w.resumeToken,a)),l=l.insert(A,V),function(B,W,J){return B.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=n3e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(N,V,w)&&y.push(i.Hr.updateTargetData(d,V))});let v=Bp(),b=Cr();if(e.documentUpdates.forEach(w=>{e.resolvedLimboDocuments.has(w)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(d,w))}),y.push(a3e(d,p,e.documentUpdates).next(w=>{v=w.Vs,b=w.fs})),!a.isEqual(Kn.min())){const w=i.Hr.getLastRemoteSnapshotVersion(d).next(A=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));y.push(w)}return wt.waitFor(y).next(()=>p.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(i.Ts=l,d))}function a3e(n,e,i){let a=Cr(),l=Cr();return i.forEach(d=>a=a.add(d)),e.getEntries(n,a).next(d=>{let p=Bp();return i.forEach((y,v)=>{const b=d.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(Kn.min())?(e.removeEntry(y,v.readTime),p=p.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(v),p=p.insert(y,v)):Zt(i4,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function c3e(n,e){const i=Jn(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=$j),i.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function l3e(n,e){const i=Jn(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,e).next(d=>d?(l=d,wt.resolve(l)):i.Hr.allocateTargetId(a).next(p=>(l=new fg(e,p,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(e,a.targetId)),a})}async function FV(n,e,i){const a=Jn(n),l=a.Ts.get(e),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,p=>a.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!H0(p))throw p;Zt(i4,`Failed to update sequence numbers for target ${e}: ${p}`)}a.Ts=a.Ts.remove(e),a.Is.delete(l.target)}function nJ(n,e,i){const a=Jn(n);let l=Kn.min(),d=Cr();return a.persistence.runTransaction("Execute query","readwrite",p=>function(v,b,w){const A=Jn(v),N=A.Is.get(w);return N!==void 0?wt.resolve(A.Ts.get(N)):A.Hr.getTargetData(b,w)}(a,p,rf(e)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(p,y.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(p,e,i?l:Kn.min(),i?d:Cr())).next(y=>(u3e(a,Xje(e),y),{documents:y,gs:d})))}function u3e(n,e,i){let a=n.Es.get(e)||Kn.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(e,a)}class rJ{constructor(){this.activeTargetIds=n4e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class d3e{constructor(){this.ho=new rJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,a){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new rJ,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iJ="ConnectivityMonitor";class sJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Zt(iJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Zt(iJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xO=null;function jV(){return xO===null?xO=function(){return 268435456+Math.round(2147483648*Math.random())}():xO++,"0x"+xO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iU="RestConnection",f3e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class p3e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===$k?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(e,i,a,l,d){const p=jV(),y=this.bo(e,i.toUriEncodedString());Zt(iU,`Sending RPC '${e}' ${p}:`,y,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(e,y,v,a).then(b=>(Zt(iU,`Received RPC '${e}' ${p}: `,b),b),b=>{throw b0(iU,`RPC '${e}' ${p} failed with error: `,b,"url: ",y,"request:",a),b})}Co(e,i,a,l,d,p){return this.So(e,i,a,l,d)}Do(e,i,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+z0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>e[d]=l),a&&a.headers.forEach((l,d)=>e[d]=l)}bo(e,i){const a=f3e[e];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m3e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wa="WebChannelConnection";class g3e extends p3e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,a,l){const d=jV();return new Promise((p,y)=>{const v=new qre;v.setWithCredentials(!0),v.listenOnce(Yre.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case uk.NO_ERROR:const w=v.getResponseJson();Zt(Wa,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(w)),p(w);break;case uk.TIMEOUT:Zt(Wa,`RPC '${e}' ${d} timed out`),y(new Ht(yt.DEADLINE_EXCEEDED,"Request time out"));break;case uk.HTTP_ERROR:const A=v.getStatus();if(Zt(Wa,`RPC '${e}' ${d} failed with status:`,A,"response text:",v.getResponseText()),A>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const V=N==null?void 0:N.error;if(V&&V.status&&V.message){const F=function(W){const J=W.toLowerCase().replace(/_/g,"-");return Object.values(yt).indexOf(J)>=0?J:yt.UNKNOWN}(V.status);y(new Ht(F,V.message))}else y(new Ht(yt.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new Ht(yt.UNAVAILABLE,"Connection failed."));break;default:Wn()}}finally{Zt(Wa,`RPC '${e}' ${d} completed.`)}});const b=JSON.stringify(l);Zt(Wa,`RPC '${e}' ${d} sending request:`,l),v.send(i,"POST",b,a,15)})}Wo(e,i,a){const l=jV(),d=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=Qre(),y=Jre(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,a),v.encodeInitMessageHeaders=!0;const w=d.join("");Zt(Wa,`Creating RPC '${e}' stream ${l}: ${w}`,v);const A=p.createWebChannel(w,v);let N=!1,V=!1;const F=new m3e({Fo:W=>{V?Zt(Wa,`Not sending because RPC '${e}' stream ${l} is closed:`,W):(N||(Zt(Wa,`Opening RPC '${e}' stream ${l} transport.`),A.open(),N=!0),Zt(Wa,`RPC '${e}' stream ${l} sending:`,W),A.send(W))},Mo:()=>A.close()}),B=(W,J,$)=>{W.listen(J,te=>{try{$(te)}catch(ce){setTimeout(()=>{throw ce},0)}})};return B(A,Gw.EventType.OPEN,()=>{V||(Zt(Wa,`RPC '${e}' stream ${l} transport opened.`),F.Qo())}),B(A,Gw.EventType.CLOSE,()=>{V||(V=!0,Zt(Wa,`RPC '${e}' stream ${l} transport closed`),F.Uo())}),B(A,Gw.EventType.ERROR,W=>{V||(V=!0,b0(Wa,`RPC '${e}' stream ${l} transport errored:`,W),F.Uo(new Ht(yt.UNAVAILABLE,"The operation could not be completed")))}),B(A,Gw.EventType.MESSAGE,W=>{var J;if(!V){const $=W.data[0];di(!!$);const te=$,ce=(te==null?void 0:te.error)||((J=te[0])===null||J===void 0?void 0:J.error);if(ce){Zt(Wa,`RPC '${e}' stream ${l} received error:`,ce);const oe=ce.status;let _e=function(Q){const se=Qs[Q];if(se!==void 0)return Nie(se)}(oe),ne=ce.message;_e===void 0&&(_e=yt.INTERNAL,ne="Unknown error status: "+oe+" with message "+ce.message),V=!0,F.Uo(new Ht(_e,ne)),A.close()}else Zt(Wa,`RPC '${e}' stream ${l} received:`,$),F.Ko($)}}),B(y,Xre.STAT_EVENT,W=>{W.stat===IV.PROXY?Zt(Wa,`RPC '${e}' stream ${l} detected buffering proxy`):W.stat===IV.NOPROXY&&Zt(Wa,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{F.$o()},0),F}}function sU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z1(n){return new v4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ie{constructor(e,i,a=1e3,l=1.5,d=6e4){this.Ti=e,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&Zt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oJ="PersistentStream";class Kie{constructor(e,i,a,l,d,p,y,v){this.Ti=e,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new $ie(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===yt.RESOURCE_EXHAUSTED?(jp(i.toString()),jp("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===yt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{e(()=>{const l=new Ht(yt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(e,i){const a=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Zt(oJ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(Zt(oJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class _3e extends Kie{constructor(e,i,a,l,d,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=T4e(this.serializer,e),a=function(d){if(!("targetChange"in d))return Kn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Kn.min():p.readTime?sf(p.readTime):Kn.min()}(e);return this.listener.p_(i,a)}y_(e){const i={};i.database=VV(this.serializer),i.addTarget=function(d,p){let y;const v=p.target;if(y=NV(v)?{documents:R4e(d,v)}:{query:I4e(d,v).ht},y.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){y.resumeToken=Lie(d,p.resumeToken);const b=LV(d,p.expectedCount);b!==null&&(y.expectedCount=b)}else if(p.snapshotVersion.compareTo(Kn.min())>0){y.readTime=Jk(d,p.snapshotVersion.toTimestamp());const b=LV(d,p.expectedCount);b!==null&&(y.expectedCount=b)}return y}(this.serializer,e);const a=P4e(this.serializer,e);a&&(i.labels=a),this.I_(i)}w_(e){const i={};i.database=VV(this.serializer),i.removeTarget=e,this.I_(i)}}class y3e extends Kie{constructor(e,i,a,l,d,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,p),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return di(!!e.streamToken),this.lastStreamToken=e.streamToken,di(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){di(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=C4e(e.writeResults,e.commitTime),a=sf(e.commitTime);return this.listener.v_(a,i)}C_(){const e={};e.database=VV(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>w4e(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3e{}class v3e extends E3e{constructor(e,i,a,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Ht(yt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.So(e,MV(i,a),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===yt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Ht(yt.UNKNOWN,d.toString())})}Co(e,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,y])=>this.connection.Co(e,MV(i,a),l,p,y,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===yt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Ht(yt.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class S3e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(jp(i),this.N_=!1):Zt("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy="RemoteStore";class b3e{constructor(e,i,a,l,d){this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{a.enqueueAndForget(async()=>{Yy(this)&&(Zt(Fy,"Restarting streams for network reachability change."),await async function(v){const b=Jn(v);b.W_.add(4),await yR(b),b.j_.set("Unknown"),b.W_.delete(4),await eN(b)}(this))})}),this.j_=new S3e(a,l)}}async function eN(n){if(Yy(n))for(const e of n.G_)await e(!0)}async function yR(n){for(const e of n.G_)await e(!1)}function qie(n,e){const i=Jn(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),c4(i)?a4(i):$0(i).c_()&&o4(i,e))}function s4(n,e){const i=Jn(n),a=$0(i);i.K_.delete(e),a.c_()&&Yie(i,e),i.K_.size===0&&(a.c_()?a.P_():Yy(i)&&i.j_.set("Unknown"))}function o4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Kn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}$0(n).y_(e)}function Yie(n,e){n.H_.Ne(e),$0(n).w_(e)}function a4(n){n.H_=new g4e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),$0(n).start(),n.j_.B_()}function c4(n){return Yy(n)&&!$0(n).u_()&&n.K_.size>0}function Yy(n){return Jn(n).W_.size===0}function Xie(n){n.H_=void 0}async function T3e(n){n.j_.set("Online")}async function w3e(n){n.K_.forEach((e,i)=>{o4(n,e)})}async function C3e(n,e){Xie(n),c4(n)?(n.j_.q_(e),a4(n)):n.j_.set("Unknown")}async function R3e(n,e,i){if(n.j_.set("Online"),e instanceof xie&&e.state===2&&e.cause)try{await async function(l,d){const p=d.cause;for(const y of d.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,p),l.K_.delete(y),l.H_.removeTarget(y))}(n,e)}catch(a){Zt(Fy,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await Zk(n,a)}else if(e instanceof pk?n.H_.We(e):e instanceof Die?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Kn.min()))try{const a=await Hie(n.localStore);i.compareTo(a)>=0&&await function(d,p){const y=d.H_.ot(p);return y.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const w=d.K_.get(b);w&&d.K_.set(b,w.withResumeToken(v.resumeToken,p))}}),y.targetMismatches.forEach((v,b)=>{const w=d.K_.get(v);if(!w)return;d.K_.set(v,w.withResumeToken(ga.EMPTY_BYTE_STRING,w.snapshotVersion)),Yie(d,v);const A=new fg(w.target,v,b,w.sequenceNumber);o4(d,A)}),d.remoteSyncer.applyRemoteEvent(y)}(n,i)}catch(a){Zt(Fy,"Failed to raise snapshot:",a),await Zk(n,a)}}async function Zk(n,e,i){if(!H0(e))throw e;n.W_.add(1),await yR(n),n.j_.set("Offline"),i||(i=()=>Hie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Zt(Fy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await eN(n)})}function Jie(n,e){return e().catch(i=>Zk(n,i,e))}async function tN(n){const e=Jn(n),i=Pg(e);let a=e.U_.length>0?e.U_[e.U_.length-1].batchId:$j;for(;I3e(e);)try{const l=await c3e(e.localStore,a);if(l===null){e.U_.length===0&&i.P_();break}a=l.batchId,A3e(e,l)}catch(l){await Zk(e,l)}Qie(e)&&Zie(e)}function I3e(n){return Yy(n)&&n.U_.length<10}function A3e(n,e){n.U_.push(e);const i=Pg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function Qie(n){return Yy(n)&&!Pg(n).u_()&&n.U_.length>0}function Zie(n){Pg(n).start()}async function P3e(n){Pg(n).C_()}async function O3e(n){const e=Pg(n);for(const i of n.U_)e.b_(i.mutations)}async function k3e(n,e,i){const a=n.U_.shift(),l=Qj.from(a,e,i);await Jie(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await tN(n)}async function N3e(n,e){e&&Pg(n).S_&&await async function(a,l){if(function(p){return p4e(p)&&p!==yt.ABORTED}(l.code)){const d=a.U_.shift();Pg(a).h_(),await Jie(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await tN(a)}}(n,e),Qie(n)&&Zie(n)}async function aJ(n,e){const i=Jn(n);i.asyncQueue.verifyOperationInProgress(),Zt(Fy,"RemoteStore received new credentials");const a=Yy(i);i.W_.add(3),await yR(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await eN(i)}async function D3e(n,e){const i=Jn(n);e?(i.W_.delete(2),await eN(i)):e||(i.W_.add(2),await yR(i),i.j_.set("Unknown"))}function $0(n){return n.J_||(n.J_=function(i,a,l){const d=Jn(i);return d.M_(),new _3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:T3e.bind(null,n),No:w3e.bind(null,n),Lo:C3e.bind(null,n),p_:R3e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),c4(n)?a4(n):n.j_.set("Unknown")):(await n.J_.stop(),Xie(n))})),n.J_}function Pg(n){return n.Y_||(n.Y_=function(i,a,l){const d=Jn(i);return d.M_(),new y3e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:P3e.bind(null,n),Lo:N3e.bind(null,n),D_:O3e.bind(null,n),v_:k3e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await tN(n)):(await n.Y_.stop(),n.U_.length>0&&(Zt(Fy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l4{constructor(e,i,a,l,d){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Dp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,a,l,d){const p=Date.now()+a,y=new l4(e,i,p,l,d);return y.start(a),y}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ht(yt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function u4(n,e){if(jp("AsyncQueue",`${e}: ${n}`),H0(n))return new Ht(yt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{static emptySet(e){return new a0(e.comparator)}constructor(e){this.comparator=e?(i,a)=>e(i,a)||yn.comparator(i.key,a.key):(i,a)=>yn.comparator(i.key,a.key),this.keyedMap=Hw(),this.sortedSet=new ms(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof a0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const a=new a0;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cJ{constructor(){this.Z_=new ms(yn.comparator)}track(e){const i=e.doc.key,a=this.Z_.get(i);a?e.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.Z_=this.Z_.remove(i):e.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Wn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,a)=>{e.push(a)}),e}}class O0{constructor(e,i,a,l,d,p,y,v,b){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(e,i,a,l,d){const p=[];return i.forEach(y=>{p.push({type:0,doc:y})}),new O0(e,i,a0.emptySet(i),p,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&q1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class L3e{constructor(){this.queries=lJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=Jn(i),d=l.queries;l.queries=lJ(),d.forEach((p,y)=>{for(const v of y.ta)v.onError(a)})})(this,new Ht(yt.ABORTED,"Firestore shutting down"))}}function lJ(){return new qy(n=>yie(n),q1)}async function d4(n,e){const i=Jn(n);let a=3;const l=e.query;let d=i.queries.get(l);d?!d.na()&&e.ra()&&(a=2):(d=new x3e,a=e.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const y=u4(p,`Initialization of query '${CS(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,d),d.ta.push(e),e.sa(i.onlineState),d.ea&&e.oa(d.ea)&&f4(i)}async function h4(n,e){const i=Jn(n),a=e.query;let l=3;const d=i.queries.get(a);if(d){const p=d.ta.indexOf(e);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=e.ra()?0:1:!d.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function M3e(n,e){const i=Jn(n);let a=!1;for(const l of e){const d=l.query,p=i.queries.get(d);if(p){for(const y of p.ta)y.oa(l)&&(a=!0);p.ea=l}}a&&f4(i)}function U3e(n,e,i){const a=Jn(n),l=a.queries.get(e);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(e)}function f4(n){n.ia.forEach(e=>{e.next()})}var BV,uJ;(uJ=BV||(BV={}))._a="default",uJ.Cache="cache";class p4{constructor(e,i,a){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new O0(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=O0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==BV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e){this.key=e}}class tse{constructor(e){this.key=e}}class V3e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Cr(),this.mutatedKeys=Cr(),this.ya=Eie(e),this.wa=new a0(this.ya)}get Sa(){return this.fa}ba(e,i){const a=i?i.Da:new cJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,p=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((w,A)=>{const N=l.get(w),V=Y1(this.query,A)?A:null,F=!!N&&this.mutatedKeys.has(N.key),B=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let W=!1;N&&V?N.data.isEqual(V.data)?F!==B&&(a.track({type:3,doc:V}),W=!0):this.va(N,V)||(a.track({type:2,doc:V}),W=!0,(v&&this.ya(V,v)>0||b&&this.ya(V,b)<0)&&(y=!0)):!N&&V?(a.track({type:0,doc:V}),W=!0):N&&!V&&(a.track({type:1,doc:N}),W=!0,(v||b)&&(y=!0)),W&&(V?(p=p.add(V),d=B?d.add(w):d.delete(w)):(p=p.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const w=this.query.limitType==="F"?p.last():p.first();p=p.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:p,Da:a,ls:y,mutatedKeys:d}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a,l){const d=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((w,A)=>function(V,F){const B=W=>{switch(W){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wn()}};return B(V)-B(F)}(w.type,A.type)||this.ya(w.doc,A.doc)),this.Ca(a),l=l!=null&&l;const y=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,p.length!==0||b?{snapshot:new O0(this.query,e.wa,d,p,e.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new cJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Cr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return e.forEach(a=>{this.pa.has(a)||i.push(new tse(a))}),this.pa.forEach(a=>{e.has(a)||i.push(new ese(a))}),i}Oa(e){this.fa=e.gs,this.pa=Cr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return O0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const m4="SyncEngine";class F3e{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class j3e{constructor(e){this.key=e,this.Ba=!1}}class B3e{constructor(e,i,a,l,d,p){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new qy(y=>yie(y),q1),this.qa=new Map,this.Qa=new Set,this.$a=new ms(yn.comparator),this.Ua=new Map,this.Ka=new t4,this.Wa={},this.Ga=new Map,this.za=P0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function W3e(n,e,i=!0){const a=ase(n);let l;const d=a.ka.get(e);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await nse(a,e,i,!0),l}async function z3e(n,e){const i=ase(n);await nse(i,e,!0,!1)}async function nse(n,e,i,a){const l=await l3e(n.localStore,rf(e)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,i);let y;return a&&(y=await G3e(n,e,d,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&qie(n.remoteStore,l),y}async function G3e(n,e,i,a,l){n.Ha=(A,N,V)=>async function(B,W,J,$){let te=W.view.ba(J);te.ls&&(te=await nJ(B.localStore,W.query,!1).then(({documents:ne})=>W.view.ba(ne,te)));const ce=$&&$.targetChanges.get(W.targetId),oe=$&&$.targetMismatches.get(W.targetId)!=null,_e=W.view.applyChanges(te,B.isPrimaryClient,ce,oe);return hJ(B,W.targetId,_e.Ma),_e.snapshot}(n,A,N,V);const d=await nJ(n.localStore,e,!0),p=new V3e(e,d.gs),y=p.ba(d.documents),v=_R.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=p.applyChanges(y,n.isPrimaryClient,v);hJ(n,i,b.Ma);const w=new F3e(e,i,p);return n.ka.set(e,w),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function H3e(n,e,i){const a=Jn(n),l=a.ka.get(e),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(p=>!q1(p,e))),void a.ka.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await FV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&s4(a.remoteStore,l.targetId),WV(a,l.targetId)}).catch(G0)):(WV(a,l.targetId),await FV(a.localStore,l.targetId,!0))}async function $3e(n,e){const i=Jn(n),a=i.ka.get(e),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),s4(i.remoteStore,a.targetId))}async function K3e(n,e,i){const a=e5e(n);try{const l=await function(p,y){const v=Jn(p),b=go.now(),w=y.reduce((V,F)=>V.add(F.key),Cr());let A,N;return v.persistence.runTransaction("Locally write mutations","readwrite",V=>{let F=Bp(),B=Cr();return v.ds.getEntries(V,w).next(W=>{F=W,F.forEach((J,$)=>{$.isValidDocument()||(B=B.add(J))})}).next(()=>v.localDocuments.getOverlayedDocuments(V,F)).next(W=>{A=W;const J=[];for(const $ of y){const te=l4e($,A.get($.key).overlayedDocument);te!=null&&J.push(new Ug($.key,te,die(te.value.mapValue),xd.exists(!0)))}return v.mutationQueue.addMutationBatch(V,b,J,y)}).next(W=>{N=W;const J=W.applyToLocalDocumentSet(A,B);return v.documentOverlayCache.saveOverlays(V,W.batchId,J)})}).then(()=>({batchId:N.batchId,changes:Sie(A)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(p,y,v){let b=p.Wa[p.currentUser.toKey()];b||(b=new ms(fr)),b=b.insert(y,v),p.Wa[p.currentUser.toKey()]=b}(a,l.batchId,i),await ER(a,l.changes),await tN(a.remoteStore)}catch(l){const d=u4(l,"Failed to persist write");i.reject(d)}}async function rse(n,e){const i=Jn(n);try{const a=await o3e(i.localStore,e);e.targetChanges.forEach((l,d)=>{const p=i.Ua.get(d);p&&(di(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?di(p.Ba):l.removedDocuments.size>0&&(di(p.Ba),p.Ba=!1))}),await ER(i,a,e)}catch(a){await G0(a)}}function dJ(n,e,i){const a=Jn(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,p)=>{const y=p.view.sa(e);y.snapshot&&l.push(y.snapshot)}),function(p,y){const v=Jn(p);v.onlineState=y;let b=!1;v.queries.forEach((w,A)=>{for(const N of A.ta)N.sa(y)&&(b=!0)}),b&&f4(v)}(a.eventManager,e),l.length&&a.La.p_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function q3e(n,e,i){const a=Jn(n);a.sharedClientState.updateQueryState(e,"rejected",i);const l=a.Ua.get(e),d=l&&l.key;if(d){let p=new ms(yn.comparator);p=p.insert(d,$a.newNoDocument(d,Kn.min()));const y=Cr().add(d),v=new Q1(Kn.min(),new Map,new ms(fr),p,y);await rse(a,v),a.$a=a.$a.remove(d),a.Ua.delete(e),g4(a)}else await FV(a.localStore,e,!1).then(()=>WV(a,e,i)).catch(G0)}async function Y3e(n,e){const i=Jn(n),a=e.batch.batchId;try{const l=await s3e(i.localStore,e);sse(i,a,null),ise(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await ER(i,l)}catch(l){await G0(l)}}async function X3e(n,e,i){const a=Jn(n);try{const l=await function(p,y){const v=Jn(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return v.mutationQueue.lookupMutationBatch(b,y).next(A=>(di(A!==null),w=A.keys(),v.mutationQueue.removeMutationBatch(b,A))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,w,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>v.localDocuments.getDocuments(b,w))})}(a.localStore,e);sse(a,e,i),ise(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),await ER(a,l)}catch(l){await G0(l)}}function ise(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function sse(n,e,i){const a=Jn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(e);d&&(i?d.reject(i):d.resolve(),l=l.remove(e)),a.Wa[a.currentUser.toKey()]=l}}function WV(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.qa.get(e))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(a=>{n.Ka.containsKey(a)||ose(n,a)})}function ose(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(s4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),g4(n))}function hJ(n,e,i){for(const a of i)a instanceof ese?(n.Ka.addReference(a.key,e),J3e(n,a)):a instanceof tse?(Zt(m4,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,e),n.Ka.containsKey(a.key)||ose(n,a.key)):Wn()}function J3e(n,e){const i=e.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(Zt(m4,"New document in limbo: "+i),n.Qa.add(a),g4(n))}function g4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new yn(Ui.fromString(e)),a=n.za.next();n.Ua.set(a,new j3e(i)),n.$a=n.$a.insert(i,a),qie(n.remoteStore,new fg(rf(K1(i.path)),a,"TargetPurposeLimboResolution",z1.ae))}}async function ER(n,e,i){const a=Jn(n),l=[],d=[],p=[];a.ka.isEmpty()||(a.ka.forEach((y,v)=>{p.push(a.Ha(v,e,i).then(b=>{var w;if((b||i)&&a.isPrimaryClient){const A=b?!b.fromCache:(w=i==null?void 0:i.targetChanges.get(v.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(v.targetId,A?"current":"not-current")}if(b){l.push(b);const A=r4.Yi(v.targetId,b);d.push(A)}}))}),await Promise.all(p),a.La.p_(l),await async function(v,b){const w=Jn(v);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",A=>wt.forEach(b,N=>wt.forEach(N.Hi,V=>w.persistence.referenceDelegate.addReference(A,N.targetId,V)).next(()=>wt.forEach(N.Ji,V=>w.persistence.referenceDelegate.removeReference(A,N.targetId,V)))))}catch(A){if(!H0(A))throw A;Zt(i4,"Failed to update sequence numbers: "+A)}for(const A of b){const N=A.targetId;if(!A.fromCache){const V=w.Ts.get(N),F=V.snapshotVersion,B=V.withLastLimboFreeSnapshotVersion(F);w.Ts=w.Ts.insert(N,B)}}}(a.localStore,d))}async function Q3e(n,e){const i=Jn(n);if(!i.currentUser.isEqual(e)){Zt(m4,"User change. New user:",e.toKey());const a=await Gie(i.localStore,e);i.currentUser=e,function(d,p){d.Ga.forEach(y=>{y.forEach(v=>{v.reject(new Ht(yt.CANCELLED,p))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await ER(i,a.Rs)}}function Z3e(n,e){const i=Jn(n),a=i.Ua.get(e);if(a&&a.Ba)return Cr().add(a.key);{let l=Cr();const d=i.qa.get(e);if(!d)return l;for(const p of d){const y=i.ka.get(p);l=l.unionWith(y.view.Sa)}return l}}function ase(n){const e=Jn(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=rse.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Z3e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=q3e.bind(null,e),e.La.p_=M3e.bind(null,e.eventManager),e.La.Ja=U3e.bind(null,e.eventManager),e}function e5e(n){const e=Jn(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Y3e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=X3e.bind(null,e),e}class e1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Z1(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return i3e(this.persistence,new t3e,e.initialUser,this.serializer)}Xa(e){return new zie(n4.ri,this.serializer)}Za(e){return new d3e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}e1.provider={build:()=>new e1};class t5e extends e1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){di(this.persistence.referenceDelegate instanceof Qk);const a=this.persistence.referenceDelegate.garbageCollector;return new j4e(a,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?tl.withCacheSize(this.cacheSizeBytes):tl.DEFAULT;return new zie(a=>Qk.ri(a,i),this.serializer)}}class zV{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>dJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=Q3e.bind(null,this.syncEngine),await D3e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new L3e}()}createDatastore(e){const i=Z1(e.databaseInfo.databaseId),a=function(d){return new g3e(d)}(e.databaseInfo);return function(d,p,y,v){return new v3e(d,p,y,v)}(e.authCredentials,e.appCheckCredentials,a,i)}createRemoteStore(e){return function(a,l,d,p,y){return new b3e(a,l,d,p,y)}(this.localStore,this.datastore,e.asyncQueue,i=>dJ(this.syncEngine,i,0),function(){return sJ.D()?new sJ:new h3e}())}createSyncEngine(e,i){return function(l,d,p,y,v,b,w){const A=new B3e(l,d,p,y,v,b);return w&&(A.ja=!0),A}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const d=Jn(l);Zt(Fy,"RemoteStore shutting down."),d.W_.add(5),await yR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}zV.provider={build:()=>new zV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):jp("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Og="FirestoreClient";class n5e{constructor(e,i,a,l,d){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=Ha.UNAUTHENTICATED,this.clientId=tie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async p=>{Zt(Og,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(a,p=>(Zt(Og,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Dp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const a=u4(i,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function oU(n,e){n.asyncQueue.verifyOperationInProgress(),Zt(Og,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Gie(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function fJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await r5e(n);Zt(Og,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(a=>aJ(e.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>aJ(e.remoteStore,l)),n._onlineComponents=e}async function r5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Zt(Og,"Using user provided OfflineComponentProvider");try{await oU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===yt.FAILED_PRECONDITION||l.code===yt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;b0("Error using user provided cache. Falling back to memory cache: "+i),await oU(n,new e1)}}else Zt(Og,"Using default OfflineComponentProvider"),await oU(n,new t5e(void 0));return n._offlineComponents}async function cse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Zt(Og,"Using user provided OnlineComponentProvider"),await fJ(n,n._uninitializedComponentsProvider._online)):(Zt(Og,"Using default OnlineComponentProvider"),await fJ(n,new zV))),n._onlineComponents}function i5e(n){return cse(n).then(e=>e.syncEngine)}async function t1(n){const e=await cse(n),i=e.eventManager;return i.onListen=W3e.bind(null,e.syncEngine),i.onUnlisten=H3e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=z3e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=$3e.bind(null,e.syncEngine),i}function s5e(n,e,i={}){const a=new Dp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,y,v,b){const w=new _4({next:N=>{w.su(),p.enqueueAndForget(()=>h4(d,A));const V=N.docs.has(y);!V&&N.fromCache?b.reject(new Ht(yt.UNAVAILABLE,"Failed to get document because the client is offline.")):V&&N.fromCache&&v&&v.source==="server"?b.reject(new Ht(yt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new p4(K1(y.path),w,{includeMetadataChanges:!0,Ta:!0});return d4(d,A)}(await t1(n),n.asyncQueue,e,i,a)),a.promise}function o5e(n,e,i={}){const a=new Dp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,y,v,b){const w=new _4({next:N=>{w.su(),p.enqueueAndForget(()=>h4(d,A)),N.fromCache&&v.source==="server"?b.reject(new Ht(yt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(N)},error:N=>b.reject(N)}),A=new p4(y,w,{includeMetadataChanges:!0,Ta:!0});return d4(d,A)}(await t1(n),n.asyncQueue,e,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lse(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function use(n,e,i){if(!i)throw new Ht(yt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function a5e(n,e,i,a){if(e===!0&&a===!0)throw new Ht(yt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function mJ(n){if(!yn.isDocumentKey(n))throw new Ht(yt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function gJ(n){if(yn.isDocumentKey(n))throw new Ht(yt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function nN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Wn()}function Vl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Ht(yt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=nN(n);throw new Ht(yt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dse="firestore.googleapis.com",_J=!0;class yJ{constructor(e){var i,a;if(e.host===void 0){if(e.ssl!==void 0)throw new Ht(yt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=dse,this.ssl=_J}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:_J;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Wie;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<V4e)throw new Ht(yt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}a5e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lse((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Ht(yt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Ht(yt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Ht(yt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class rN{constructor(e,i,a,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ht(yt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Ht(yt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yJ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new mje;switch(a.type){case"firstParty":return new Eje(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Ht(yt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=pJ.get(i);a&&(Zt("ComponentProvider","Removing Datastore"),pJ.delete(i),a.terminate())}(this),Promise.resolve()}}function c5e(n,e,i,a={}){var l;const d=(n=Vl(n,rN))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),y=`${e}:${i}`;d.host!==dse&&d.host!==y&&b0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:y,ssl:!1,emulatorOptions:a});if(!Up(v,p)&&(n._setSettings(v),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=Ha.MOCK_USER;else{b=ire(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const A=a.mockUserToken.sub||a.mockUserToken.user_id;if(!A)throw new Ht(yt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new Ha(A)}n._authCredentials=new gje(new Zre(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Gp(this.firestore,e,this._query)}}class qa{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _g(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new qa(this.firestore,e,this._key)}}class _g extends Gp{constructor(e,i,a){super(e,i,K1(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new qa(this.firestore,null,new yn(e))}withConverter(e){return new _g(this.firestore,e,this._path)}}function jy(n,e,...i){if(n=Vi(n),use("collection","path",e),n instanceof rN){const a=Ui.fromString(e,...i);return gJ(a),new _g(n,null,a)}{if(!(n instanceof qa||n instanceof _g))throw new Ht(yt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ui.fromString(e,...i));return gJ(a),new _g(n.firestore,null,a)}}function Pi(n,e,...i){if(n=Vi(n),arguments.length===1&&(e=tie.newId()),use("doc","path",e),n instanceof rN){const a=Ui.fromString(e,...i);return mJ(a),new qa(n,null,new yn(a))}{if(!(n instanceof qa||n instanceof _g))throw new Ht(yt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(Ui.fromString(e,...i));return mJ(a),new qa(n.firestore,n instanceof _g?n.converter:null,new yn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EJ="AsyncQueue";class vJ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new $ie(this,"async_queue_retry"),this.Su=()=>{const a=sU();a&&Zt(EJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=e;const i=sU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=sU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Dp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!H0(e))throw e;Zt(EJ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(a=>{this.gu=a,this.pu=!1;const l=function(p){let y=p.message||"";return p.stack&&(y=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),y}(a);throw jp("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=i,i}enqueueAfterDelay(e,i,a){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=l4.createAndSchedule(this,e,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Wn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function SJ(n){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class kg extends rN{constructor(e,i,a,l){super(e,i,a,l),this.type="firestore",this._queue=new vJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vJ(e),this._firestoreClient=void 0,await e}}}function GV(n,e){const i=typeof n=="object"?n:Mj(),a=typeof n=="string"?n:$k,l=F1(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=tre("firestore");d&&c5e(l,...d)}return l}function iN(n){if(n._terminated)throw new Ht(yt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||l5e(n),n._firestoreClient}function l5e(n){var e,i,a;const l=n._freezeSettings(),d=function(y,v,b,w){return new xje(y,v,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,lse(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new n5e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new k0(ga.fromBase64String(e))}catch(i){throw new Ht(yt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new k0(ga.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Ht(yt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Ht(yt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Ht(yt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return fr(this._lat,e._lat)||fr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5e=/^__.*__$/;class d5e{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return this.fieldMask!==null?new Ug(e,this.data,this.fieldMask,i,this.fieldTransforms):new gR(e,this.data,i,this.fieldTransforms)}}class hse{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new Ug(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function fse(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wn()}}class oN{constructor(e,i,a,l,d,p){this.settings=e,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new oN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.$u(e),l}Uu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return n1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(fse(this.Lu)&&u5e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class h5e{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=a||Z1(e)}ju(e,i,a,l=!1){return new oN({Lu:e,methodName:i,zu:a,path:pa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function SR(n){const e=n._freezeSettings(),i=Z1(n._databaseId);return new h5e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function pse(n,e,i,a,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,e,i,l);b4("Data must be an object, but it was:",p,a);const y=_se(a,p);let v,b;if(d.merge)v=new Dl(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const w=[];for(const A of d.mergeFields){const N=HV(e,A,i);if(!p.contains(N))throw new Ht(yt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Ese(w,N)||w.push(N)}v=new Dl(w),b=p.fieldTransforms.filter(A=>v.covers(A.field))}else v=null,b=p.fieldTransforms;return new d5e(new rl(y),v,b)}class aN extends vR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof aN}}function mse(n,e,i){return new oN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class v4 extends vR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=mse(this,e,!0),a=this.Hu.map(d=>Xy(d,i)),l=new I0(a);return new Aie(e.path,l)}isEqual(e){return e instanceof v4&&Up(this.Hu,e.Hu)}}class S4 extends vR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=mse(this,e,!0),a=this.Hu.map(d=>Xy(d,i)),l=new A0(a);return new Aie(e.path,l)}isEqual(e){return e instanceof S4&&Up(this.Hu,e.Hu)}}function f5e(n,e,i,a){const l=n.ju(1,e,i);b4("Data must be an object, but it was:",l,a);const d=[],p=rl.empty();Mg(a,(v,b)=>{const w=T4(e,v,i);b=Vi(b);const A=l.Uu(w);if(b instanceof aN)d.push(w);else{const N=Xy(b,A);N!=null&&(d.push(w),p.set(w,N))}});const y=new Dl(d);return new hse(p,y,l.fieldTransforms)}function p5e(n,e,i,a,l,d){const p=n.ju(1,e,i),y=[HV(e,a,i)],v=[l];if(d.length%2!=0)throw new Ht(yt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)y.push(HV(e,d[N])),v.push(d[N+1]);const b=[],w=rl.empty();for(let N=y.length-1;N>=0;--N)if(!Ese(b,y[N])){const V=y[N];let F=v[N];F=Vi(F);const B=p.Uu(V);if(F instanceof aN)b.push(V);else{const W=Xy(F,B);W!=null&&(b.push(V),w.set(V,W))}}const A=new Dl(b);return new hse(w,A,p.fieldTransforms)}function gse(n,e,i,a=!1){return Xy(i,n.ju(a?4:3,e))}function Xy(n,e){if(yse(n=Vi(n)))return b4("Unsupported field value:",e,n),_se(n,e);if(n instanceof vR)return function(a,l){if(!fse(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(a,l){const d=[];let p=0;for(const y of a){let v=Xy(y,l.Ku(p));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),p++}return{arrayValue:{values:d}}}(n,e)}return function(a,l){if((a=Vi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return r4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=go.fromDate(a);return{timestampValue:Jk(l.serializer,d)}}if(a instanceof go){const d=new go(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Jk(l.serializer,d)}}if(a instanceof y4)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof k0)return{bytesValue:Lie(l.serializer,a._byteString)};if(a instanceof qa){const d=l.databaseId,p=a.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:e4(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof E4)return function(p,y){return{mapValue:{fields:{[lie]:{stringValue:uie},[Kk]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw y.Wu("VectorValues must only contain numeric values.");return Jj(y.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${nN(a)}`)}(n,e)}function _se(n,e){const i={};return rie(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mg(n,(a,l)=>{const d=Xy(l,e.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function yse(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof go||n instanceof y4||n instanceof k0||n instanceof qa||n instanceof vR||n instanceof E4)}function b4(n,e,i){if(!yse(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=nN(i);throw a==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+a)}}function HV(n,e,i){if((e=Vi(e))instanceof sN)return e._internalPath;if(typeof e=="string")return T4(n,e);throw n1("Field path arguments must be of type string or ",n,!1,void 0,i)}const m5e=new RegExp("[~\\*/\\[\\]]");function T4(n,e,i){if(e.search(m5e)>=0)throw n1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new sN(...e.split("."))._internalPath}catch{throw n1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function n1(n,e,i,a,l){const d=a&&!a.isEmpty(),p=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(d||p)&&(v+=" (found",d&&(v+=` in field ${a}`),p&&(v+=` in document ${l}`),v+=")"),new Ht(yt.INVALID_ARGUMENT,y+n+v)}function Ese(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4{constructor(e,i,a,l,d){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new qa(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new g5e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(cN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class g5e extends w4{data(){return super.data()}}function cN(n,e){return typeof e=="string"?T4(n,e):e instanceof sN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vse(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Ht(yt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class C4{}class R4 extends C4{}function $V(n,e,...i){let a=[];e instanceof C4&&a.push(e),a=a.concat(i),function(d){const p=d.filter(v=>v instanceof I4).length,y=d.filter(v=>v instanceof lN).length;if(p>1||p>0&&y>0)throw new Ht(yt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class lN extends R4{constructor(e,i,a){super(),this._field=e,this._op=i,this._value=a,this.type="where"}static _create(e,i,a){return new lN(e,i,a)}_apply(e){const i=this._parse(e);return Sse(e._query,i),new Gp(e.firestore,e.converter,DV(e._query,i))}_parse(e){const i=SR(e.firestore);return function(d,p,y,v,b,w,A){let N;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new Ht(yt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){wJ(A,w);const F=[];for(const B of A)F.push(TJ(v,d,B));N={arrayValue:{values:F}}}else N=TJ(v,d,A)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||wJ(A,w),N=gse(y,p,A,w==="in"||w==="not-in");return no.create(b,w,N)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function bJ(n,e,i){const a=e,l=cN("where",n);return lN._create(l,a,i)}class I4 extends C4{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new I4(e,i)}_parse(e){const i=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Md.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,d){let p=l;const y=d.getFlattenedFilters();for(const v of y)Sse(p,v),p=DV(p,v)}(e._query,i),new Gp(e.firestore,e.converter,DV(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class A4 extends R4{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new A4(e,i)}_apply(e){const i=function(l,d,p){if(l.startAt!==null)throw new Ht(yt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Ht(yt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new BC(d,p)}(e._query,this._field,this._direction);return new Gp(e.firestore,e.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new Ky(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function _5e(n,e="asc"){const i=e,a=cN("orderBy",n);return A4._create(a,i)}class P4 extends R4{constructor(e,i,a){super(),this.type=e,this._docOrFields=i,this._inclusive=a}static _create(e,i,a){return new P4(e,i,a)}_apply(e){const i=E5e(e,this.type,this._docOrFields,this._inclusive);return new Gp(e.firestore,e.converter,function(l,d){return new Ky(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(e._query,i))}}function y5e(...n){return P4._create("startAt",n,!0)}function E5e(n,e,i,a){if(i[0]=Vi(i[0]),i[0]instanceof w4)return function(d,p,y,v,b){if(!v)throw new Ht(yt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const w=[];for(const A of o0(d))if(A.field.isKeyField())w.push(qk(p,v.key));else{const N=v.data.field(A.field);if(H1(N))throw new Ht(yt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+A.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const V=A.field.canonicalString();throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${V}' (used as the orderBy) does not exist.`)}w.push(N)}return new R0(w,b)}(n._query,n.firestore._databaseId,e,i[0]._document,a);{const l=SR(n.firestore);return function(p,y,v,b,w,A){const N=p.explicitOrderBy;if(w.length>N.length)throw new Ht(yt.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const V=[];for(let F=0;F<w.length;F++){const B=w[F];if(N[F].field.isKeyField()){if(typeof B!="string")throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof B}`);if(!Xj(p)&&B.indexOf("/")!==-1)throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${B}' contains a slash.`);const W=p.path.child(Ui.fromString(B));if(!yn.isDocumentKey(W))throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${W}' is not because it contains an odd number of segments.`);const J=new yn(W);V.push(qk(y,J))}else{const W=gse(v,b,B);V.push(W)}}return new R0(V,A)}(n._query,n.firestore._databaseId,l,e,i,a)}}function TJ(n,e,i){if(typeof(i=Vi(i))=="string"){if(i==="")throw new Ht(yt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Xj(e)&&i.indexOf("/")!==-1)throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child(Ui.fromString(i));if(!yn.isDocumentKey(a))throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return qk(n,new yn(a))}if(i instanceof qa)return qk(n,i._key);throw new Ht(yt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nN(i)}.`)}function wJ(n,e){if(!Array.isArray(n)||n.length===0)throw new Ht(yt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Sse(n,e){const i=function(l,d){for(const p of l)for(const y of p.getFlattenedFilters())if(d.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Ht(yt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ht(yt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class v5e{convertValue(e,i="none"){switch(Ag(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Hs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Ig(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Wn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const a={};return Mg(e,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(e){var i,a,l;const d=(l=(a=(i=e.fields)===null||i===void 0?void 0:i[Kk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(p=>Hs(p.doubleValue));return new E4(d)}convertGeoPoint(e){return new y4(Hs(e.latitude),Hs(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=$1(e);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(VC(e));default:return null}}convertTimestamp(e){const i=Rg(e);return new go(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=Ui.fromString(e);di(Bie(a));const l=new FC(a.get(1),a.get(3)),d=new yn(a.popFirst(5));return l.isEqual(i)||jp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bse(n,e,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Tse extends w4{constructor(e,i,a,l,d,p){super(e,i,a,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new mk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(cN("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class mk extends Tse{data(e={}){return super.data(e)}}class wse{constructor(e,i,a,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new Kw(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new mk(this._firestore,this._userDataWriter,a.key,a,new Kw(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Ht(yt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(y=>{const v=new mk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Kw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>d||y.type!==3).map(y=>{const v=new mk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new Kw(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return y.type!==0&&(b=p.indexOf(y.doc.key),p=p.delete(y.doc.key)),y.type!==1&&(p=p.add(y.doc),w=p.indexOf(y.doc.key)),{type:S5e(y.type),doc:v,oldIndex:b,newIndex:w}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function S5e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(n){n=Vl(n,qa);const e=Vl(n.firestore,kg);return s5e(iN(e),n._key).then(i=>Rse(e,n,i))}class O4 extends v5e{constructor(e){super(),this.firestore=e}convertBytes(e){return new k0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new qa(this.firestore,null,i)}}function WC(n){n=Vl(n,Gp);const e=Vl(n.firestore,kg),i=iN(e),a=new O4(e);return vse(n._query),o5e(i,n._query).then(l=>new wse(e,a,n,l))}function r1(n,e,i){n=Vl(n,qa);const a=Vl(n.firestore,kg),l=bse(n.converter,e,i);return k4(a,[pse(SR(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,xd.none())])}function Ec(n,e,i,...a){n=Vl(n,qa);const l=Vl(n.firestore,kg),d=SR(l);let p;return p=typeof(e=Vi(e))=="string"||e instanceof sN?p5e(d,"updateDoc",n._key,e,i,a):f5e(d,"updateDoc",n._key,e),k4(l,[p.toMutation(n._key,xd.exists(!0))])}function b5e(n,e){const i=Vl(n.firestore,kg),a=Pi(n),l=bse(n.converter,e);return k4(i,[pse(SR(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,xd.exists(!1))]).then(()=>a)}function Cse(n,...e){var i,a,l;n=Vi(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||SJ(e[p])||(d=e[p],p++);const y={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(SJ(e[p])){const A=e[p];e[p]=(i=A.next)===null||i===void 0?void 0:i.bind(A),e[p+1]=(a=A.error)===null||a===void 0?void 0:a.bind(A),e[p+2]=(l=A.complete)===null||l===void 0?void 0:l.bind(A)}let v,b,w;if(n instanceof qa)b=Vl(n.firestore,kg),w=K1(n._key.path),v={next:A=>{e[p]&&e[p](Rse(b,n,A))},error:e[p+1],complete:e[p+2]};else{const A=Vl(n,Gp);b=Vl(A.firestore,kg),w=A._query;const N=new O4(b);v={next:V=>{e[p]&&e[p](new wse(b,N,A,V))},error:e[p+1],complete:e[p+2]},vse(n._query)}return function(N,V,F,B){const W=new _4(B),J=new p4(V,W,F);return N.asyncQueue.enqueueAndForget(async()=>d4(await t1(N),J)),()=>{W.su(),N.asyncQueue.enqueueAndForget(async()=>h4(await t1(N),J))}}(iN(b),w,y,v)}function k4(n,e){return function(a,l){const d=new Dp;return a.asyncQueue.enqueueAndForget(async()=>K3e(await i5e(a),l,d)),d.promise}(iN(n),e)}function Rse(n,e,i){const a=i.docs.get(e._key),l=new O4(n);return new Tse(n,l,e._key,a,new Kw(i.hasPendingWrites,i.fromCache),e.converter)}function T5e(...n){return new v4("arrayUnion",n)}function w5e(...n){return new S4("arrayRemove",n)}(function(e,i=!0){(function(l){z0=l})($y),Ly(new wg("firestore",(a,{instanceIdentifier:l,options:d})=>{const p=a.getProvider("app").getImmediate(),y=new kg(new _je(a.getProvider("auth-internal")),new vje(p,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Ht(yt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new FC(b.options.projectId,w)}(p,l),p);return d=Object.assign({useFetchStreams:i},d),y._setSettings(d),y},"PUBLIC").setMultipleInstances(!0)),ef(RX,IX,e),ef(RX,IX,"esm2017")})();var C5e="firebase",R5e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ef(C5e,R5e,"app");const I5e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!1);console.log("import.meta.env:",I5e);const ig={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:ig.apiKey?`${ig.apiKey.substring(0,5)}...`:"missing",authDomain:ig.authDomain,projectId:ig.projectId,storageBucket:ig.storageBucket,messagingSenderId:ig.messagingSenderId?"present":"missing",appId:ig.appId?"present":"missing"});const Ise=are(ig),Ase=$re(Ise),ri=GV(Ise),Ud=async n=>{try{he.log("userFirestore: Get user Profile data for user ID: "+n);const e=Pi(ri,"users",n),i=await ll(e);return i.exists()?(he.log("userFirestore: Found Profile for : "+i.data().Nickname),i.data()):(he.error("userFirestore: user profile document not found"),null)}catch(e){throw he.error("userFirestore: Error fetching user profile data:",e),e}},A5e=async(n,e,i)=>{try{he.log("userFirestore: Registering new user with email:",n);const l=(await QVe(Ase,n,e)).user;await CV(l),he.log("userFirestore: Verification email sent to:",n);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...i};he.log("userFirestore: Creating user document with data:",d);const p=Pi(ri,"users",l.uid);return await r1(p,d),he.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw he.error("userFirestore: Error creating user:",a),a}},Pse=async(n,e)=>{try{he.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Pi(ri,"users",n);await Ec(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),he.log("userFirestore: rpmURL updated successfully.")}catch(i){throw he.error("userFirestore: Error updating rpmURL:",i),i}},P5e=async(n,e)=>{try{const i=await Ud(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return he.error("userFirestore: Error checking group membership:",i),!1}},O5e=(n,e)=>(he.log(`OVERRIDE: isSpaceOwner check for user ${n==null?void 0:n.uid} and space ${e} - Returning true`),!0),k5e=(n,e)=>{if(e==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning true`),!0;if(e==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${e} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning false`),!1},N5e=async(n,e)=>O5e(n,e),Ose=async(n,e)=>k5e(n,e),D5e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Nd={sendUserToUnity:"sendUserToUnity"};class x5e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const a=this.events[e];a?(a.forEach(l=>{l(i)}),he.log(`EventBus: Published event '${e}'`)):he.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const a=(l=this.events[e])==null?void 0:l.indexOf(i);a>-1&&this.events[e].splice(a,1)}}const Dd=new x5e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kse="firebasestorage.googleapis.com",Nse="storageBucket",L5e=2*60*1e3,M5e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls extends hf{constructor(e,i,a=0){super(aU(e),`Firebase Storage: ${i} (${aU(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ls.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return aU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var xs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(xs||(xs={}));function aU(n){return"storage/"+n}function N4(){const n="An unknown error occurred, please check the error payload for server response.";return new Ls(xs.UNKNOWN,n)}function U5e(n){return new Ls(xs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function V5e(n){return new Ls(xs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function F5e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ls(xs.UNAUTHENTICATED,n)}function j5e(){return new Ls(xs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function B5e(n){return new Ls(xs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function W5e(){return new Ls(xs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function z5e(){return new Ls(xs.CANCELED,"User canceled the upload/download.")}function G5e(n){return new Ls(xs.INVALID_URL,"Invalid URL '"+n+"'.")}function H5e(n){return new Ls(xs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function $5e(){return new Ls(xs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Nse+"' property when initializing the app?")}function K5e(){return new Ls(xs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function q5e(){return new Ls(xs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Y5e(n){return new Ls(xs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function KV(n){return new Ls(xs.INVALID_ARGUMENT,n)}function Dse(){return new Ls(xs.APP_DELETED,"The Firebase app was deleted.")}function X5e(n){return new Ls(xs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function hC(n,e){return new Ls(xs.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function _w(n){throw new Ls(xs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let a;try{a=xl.makeFromUrl(e,i)}catch{return new xl(e,"")}if(a.path==="")return a;throw H5e(e)}static makeFromUrl(e,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const p="(/(.*))?$",y=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const w="v[A-Za-z0-9_]+",A=i.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",V=new RegExp(`^https?://${A}/${w}/b/${l}/o${N}`,"i"),F={bucket:1,path:3},B=i===kse?"(?:storage.googleapis.com|storage.cloud.google.com)":i,W="([^?#]*)",J=new RegExp(`^https?://${B}/${l}/${W}`,"i"),te=[{regex:y,indices:v,postModify:d},{regex:V,indices:F,postModify:b},{regex:J,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<te.length;ce++){const oe=te[ce],_e=oe.regex.exec(e);if(_e){const ne=_e[oe.indices.bucket];let ee=_e[oe.indices.path];ee||(ee=""),a=new xl(ne,ee),oe.postModify(a);break}}if(a==null)throw G5e(e);return a}}class J5e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q5e(n,e,i){let a=1,l=null,d=null,p=!1,y=0;function v(){return y===2}let b=!1;function w(...W){b||(b=!0,e.apply(null,W))}function A(W){l=setTimeout(()=>{l=null,n(V,v())},W)}function N(){d&&clearTimeout(d)}function V(W,...J){if(b){N();return}if(W){N(),w.call(null,W,...J);return}if(v()||p){N(),w.call(null,W,...J);return}a<64&&(a*=2);let te;y===1?(y=2,te=0):te=(a+Math.random())*1e3,A(te)}let F=!1;function B(W){F||(F=!0,N(),!b&&(l!==null?(W||(y=2),clearTimeout(l),A(0)):W||(y=1)))}return A(0),d=setTimeout(()=>{p=!0,B(!0)},i),B}function Z5e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eBe(n){return n!==void 0}function tBe(n){return typeof n=="object"&&!Array.isArray(n)}function D4(n){return typeof n=="string"||n instanceof String}function CJ(n){return x4()&&n instanceof Blob}function x4(){return typeof Blob<"u"}function RJ(n,e,i,a){if(a<e)throw KV(`Invalid value for '${n}'. Expected ${e} or greater.`);if(a>i)throw KV(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(n,e,i){let a=e;return i==null&&(a=`https://${e}`),`${i}://${a}/v0${n}`}function xse(n){const e=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=e(a)+"="+e(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Ay;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Ay||(Ay={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nBe(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rBe{constructor(e,i,a,l,d,p,y,v,b,w,A,N=!0){this.url_=e,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=A,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((V,F)=>{this.resolve_=V,this.reject_=F,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new LO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const y=d.getErrorCode()===Ay.NO_ERROR,v=d.getStatus();if(!y||nBe(v,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===Ay.ABORT;a(!1,new LO(!1,null,w));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new LO(b,d))})},i=(a,l)=>{const d=this.resolve_,p=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());eBe(v)?d(v):d()}catch(v){p(v)}else if(y!==null){const v=N4();v.serverResponse=y.getErrorText(),this.errorCallback_?p(this.errorCallback_(y,v)):p(v)}else if(l.canceled){const v=this.appDelete_?Dse():z5e();p(v)}else{const v=W5e();p(v)}};this.canceled_?i(!1,new LO(!1,null,!0)):this.backoffId_=Q5e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Z5e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class LO{constructor(e,i,a){this.wasSuccessCode=e,this.connection=i,this.canceled=!!a}}function iBe(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function sBe(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function oBe(n,e){e&&(n["X-Firebase-GMPID"]=e)}function aBe(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function cBe(n,e,i,a,l,d,p=!0){const y=xse(n.urlParams),v=n.url+y,b=Object.assign({},n.headers);return oBe(b,e),iBe(b,i),sBe(b,d),aBe(b,a),new rBe(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function uBe(...n){const e=lBe();if(e!==void 0){const i=new e;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(x4())return new Blob(n);throw new Ls(xs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function dBe(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hBe(n){if(typeof atob>"u")throw Y5e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $h={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class cU{constructor(e,i){this.data=e,this.contentType=i||null}}function fBe(n,e){switch(n){case $h.RAW:return new cU(Lse(e));case $h.BASE64:case $h.BASE64URL:return new cU(Mse(n,e));case $h.DATA_URL:return new cU(mBe(e),gBe(e))}throw N4()}function Lse(n){const e=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const d=a,p=n.charCodeAt(++i);a=65536|(d&1023)<<10|p&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function pBe(n){let e;try{e=decodeURIComponent(n)}catch{throw hC($h.DATA_URL,"Malformed data URL.")}return Lse(e)}function Mse(n,e){switch(n){case $h.BASE64:{const l=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(l||d)throw hC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case $h.BASE64URL:{const l=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(l||d)throw hC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=hBe(e)}catch(l){throw l.message.includes("polyfill")?l:hC(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class Use{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw hC($h.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=_Be(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function mBe(n){const e=new Use(n);return e.base64?Mse($h.BASE64,e.rest):pBe(e.rest)}function gBe(n){return new Use(n).contentType}function _Be(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dg{constructor(e,i){let a=0,l="";CJ(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(CJ(this.data_)){const a=this.data_,l=dBe(a,e,i);return l===null?null:new dg(l)}else{const a=new Uint8Array(this.data_.buffer,e,i-e);return new dg(a,!0)}}static getBlob(...e){if(x4()){const i=e.map(a=>a instanceof dg?a.data_:a);return new dg(uBe.apply(null,i))}else{const i=e.map(p=>D4(p)?fBe($h.RAW,p).data:p.data_);let a=0;i.forEach(p=>{a+=p.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(p=>{for(let y=0;y<p.length;y++)l[d++]=p[y]}),new dg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vse(n){let e;try{e=JSON.parse(n)}catch{return null}return tBe(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yBe(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function EBe(n,e){const i=e.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function Fse(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vBe(n,e){return e}class fc{constructor(e,i,a,l){this.server=e,this.local=i||e,this.writable=!!a,this.xform=l||vBe}}let MO=null;function SBe(n){return!D4(n)||n.length<2?n:Fse(n)}function jse(){if(MO)return MO;const n=[];n.push(new fc("bucket")),n.push(new fc("generation")),n.push(new fc("metageneration")),n.push(new fc("name","fullPath",!0));function e(d,p){return SBe(p)}const i=new fc("name");i.xform=e,n.push(i);function a(d,p){return p!==void 0?Number(p):p}const l=new fc("size");return l.xform=a,n.push(l),n.push(new fc("timeCreated")),n.push(new fc("updated")),n.push(new fc("md5Hash",null,!0)),n.push(new fc("cacheControl",null,!0)),n.push(new fc("contentDisposition",null,!0)),n.push(new fc("contentEncoding",null,!0)),n.push(new fc("contentLanguage",null,!0)),n.push(new fc("contentType",null,!0)),n.push(new fc("metadata","customMetadata",!0)),MO=n,MO}function bBe(n,e){function i(){const a=n.bucket,l=n.fullPath,d=new xl(a,l);return e._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function TBe(n,e,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const p=i[d];a[p.local]=p.xform(a,e[p.server])}return bBe(a,n),a}function Bse(n,e,i){const a=Vse(e);return a===null?null:TBe(n,a,i)}function wBe(n,e,i,a){const l=Vse(e);if(l===null||!D4(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,A=n.fullPath,N="/b/"+p(w)+"/o/"+p(A),V=uN(N,i,a),F=xse({alt:"media",token:b});return V+F})[0]}function CBe(n,e){const i={},a=e.length;for(let l=0;l<a;l++){const d=e[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class L4{constructor(e,i,a,l){this.url=e,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wse(n){if(!n)throw N4()}function RBe(n,e){function i(a,l){const d=Bse(n,l,e);return Wse(d!==null),d}return i}function IBe(n,e){function i(a,l){const d=Bse(n,l,e);return Wse(d!==null),wBe(d,l,n.host,n._protocol)}return i}function zse(n){function e(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=j5e():l=F5e():i.getStatus()===402?l=V5e(n.bucket):i.getStatus()===403?l=B5e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return e}function Gse(n){const e=zse(n);function i(a,l){let d=e(a,l);return a.getStatus()===404&&(d=U5e(n.path)),d.serverResponse=l.serverResponse,d}return i}function ABe(n,e,i){const a=e.fullServerUrl(),l=uN(a,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,y=new L4(l,d,IBe(n,i),p);return y.errorHandler=Gse(e),y}function PBe(n,e){const i=e.fullServerUrl(),a=uN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(v,b){}const y=new L4(a,l,p,d);return y.successCodes=[200,204],y.errorHandler=Gse(e),y}function OBe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function kBe(n,e,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=e.size(),a.contentType||(a.contentType=OBe(null,e)),a}function NBe(n,e,i,a,l){const d=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function y(){let te="";for(let ce=0;ce<2;ce++)te=te+Math.random().toString().slice(2);return te}const v=y();p["Content-Type"]="multipart/related; boundary="+v;const b=kBe(e,a,l),w=CBe(b,i),A="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,N=`\r
--`+v+"--",V=dg.getBlob(A,a,N);if(V===null)throw K5e();const F={name:b.fullPath},B=uN(d,n.host,n._protocol),W="POST",J=n.maxUploadRetryTime,$=new L4(B,W,RBe(n,i),J);return $.urlParams=F,$.headers=p,$.body=V.uploadData(),$.errorHandler=zse(e),$}class DBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ay.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ay.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ay.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,a,l){if(this.sent_)throw _w("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw _w("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw _w("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw _w("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw _w("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class xBe extends DBe{initXhr(){this.xhr_.responseType="text"}}function M4(){return new xBe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e,i){this._service=e,i instanceof xl?this._location=i:this._location=xl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new By(e,i)}get root(){const e=new xl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Fse(this._location.path)}get storage(){return this._service}get parent(){const e=yBe(this._location.path);if(e===null)return null;const i=new xl(this._location.bucket,e);return new By(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw X5e(e)}}function LBe(n,e,i){n._throwIfRoot("uploadBytes");const a=NBe(n.storage,n._location,jse(),new dg(e,!0),i);return n.storage.makeRequestWithTokens(a,M4).then(l=>({metadata:l,ref:n}))}function MBe(n){n._throwIfRoot("getDownloadURL");const e=ABe(n.storage,n._location,jse());return n.storage.makeRequestWithTokens(e,M4).then(i=>{if(i===null)throw q5e();return i})}function UBe(n){n._throwIfRoot("deleteObject");const e=PBe(n.storage,n._location);return n.storage.makeRequestWithTokens(e,M4)}function VBe(n,e){const i=EBe(n._location.path,e),a=new xl(n._location.bucket,i);return new By(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FBe(n){return/^[A-Za-z]+:\/\//.test(n)}function jBe(n,e){return new By(n,e)}function Hse(n,e){if(n instanceof U4){const i=n;if(i._bucket==null)throw $5e();const a=new By(i,i._bucket);return e!=null?Hse(a,e):a}else return e!==void 0?VBe(n,e):n}function BBe(n,e){if(e&&FBe(e)){if(n instanceof U4)return jBe(n,e);throw KV("To use ref(service, url), the first argument must be a Storage instance.")}else return Hse(n,e)}function IJ(n,e){const i=e==null?void 0:e[Nse];return i==null?null:xl.makeFromBucketSpec(i,n)}function WBe(n,e,i,a={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:ire(l,n.app.options.projectId))}class U4{constructor(e,i,a,l,d){this.app=e,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=kse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=L5e,this._maxUploadRetryTime=M5e,this._requests=new Set,l!=null?this._bucket=xl.makeFromBucketSpec(l,this._host):this._bucket=IJ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=xl.makeFromBucketSpec(this._url,e):this._bucket=IJ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){RJ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){RJ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Nl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new By(this,e)}_makeRequest(e,i,a,l,d=!0){if(this._deleted)return new J5e(Dse());{const p=cBe(e,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,a,l).getPromise()}}const AJ="@firebase/storage",PJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $se="storage";function V4(n,e,i){return n=Vi(n),LBe(n,e,i)}function dN(n){return n=Vi(n),MBe(n)}function F4(n){return n=Vi(n),UBe(n)}function Jy(n,e){return n=Vi(n),BBe(n,e)}function Qy(n=Mj(),e){n=Vi(n);const a=F1(n,$se).getImmediate({identifier:e}),l=tre("storage");return l&&zBe(a,...l),a}function zBe(n,e,i,a={}){WBe(n,e,i,a)}function GBe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new U4(i,a,l,e,$y)}function HBe(){Ly(new wg($se,GBe,"PUBLIC").setMultipleInstances(!0)),ef(AJ,PJ,""),ef(AJ,PJ,"esm2017")}HBe();const gk=async n=>{const e=Qy(),i=Jy(e,n);try{return await dN(i)}catch(a){throw he.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let Wy={};const yg=async n=>{try{const e=Pi(ri,"spaces",n),i=await ll(e);if(i.exists()){let a=i.data();const l=a.name,d=a.description;if(a.webglBuildId){const p=Pi(ri,"webglBuilds",a.webglBuildId),y=await ll(p);if(y.exists()){const v=y.data();a={...a,...v,name:l||v.name,description:d||v.description}}else he.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await $Be(a),a=KBe(a),console.log("Space data:",a),he.log(`spacesFirestore: Caching space data for: ${n}`),Wy[n]=a,a}else return he.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw he.error("spacesFirestore: Error fetching item data:",e),e}},$Be=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await gk(l))});return await Promise.all(i),n},KBe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:e,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let lU={};const Kse=async n=>{he.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(lU[n])return he.log("spacesFirestore: Returning cached videos for space:",n),lU[n];const e=jy(ri,`spaces/${n}/videos`),i=await WC(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),lU[n]=a,a}catch(e){throw he.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},qBe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=Qy(),a=Date.now(),l=e.name.split(".").pop(),d=`logo_${a}.${l}`,p=Jy(i,`spaces/${n}/logo/${d}`);he.log(`Uploading logo for space ${n}`);const y=await V4(p,e),v=await dN(y.ref),b=Pi(ri,"spaces",n);return await Ec(b,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),he.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw he.error("Error uploading space logo:",i),i}},YBe=async n=>{try{const e=Pi(ri,"spaces",n),i=await ll(e);if(!i.exists())return he.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=Qy(),d=Jy(l,a.logoGsUrl);try{await F4(d),he.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(p){he.warn(`Could not delete logo file from storage: ${p.message}`)}}return await Ec(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),he.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw he.error("Error deleting space logo:",e),e}},XBe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=Qy(),a=Date.now(),l=e.name.split(".").pop(),d=`background_${a}.${l}`,p=Jy(i,`spaces/${n}/background/${d}`);he.log(`Uploading background for space ${n}`);const y=await V4(p,e),v=await dN(y.ref),b=Pi(ri,"spaces",n);return await Ec(b,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),he.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw he.error("Error uploading space background:",i),i}},JBe=async n=>{try{const e=Pi(ri,"spaces",n),i=await ll(e);if(!i.exists())return he.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=Qy(),d=Jy(l,a.backgroundGsUrl);try{await F4(d),he.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(p){he.warn(`Could not delete background file from storage: ${p.message}`)}}return await Ec(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),he.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw he.error("Error deleting space background:",e),e}},QBe=async(n,e)=>{try{he.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=Pi(ri,"spaces",n),a=await ll(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Ec(i,d),Wy[n]&&delete Wy[n],he.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw he.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},ZBe=async(n,e)=>{try{he.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=Pi(ri,"spaces",n);if(!(await ll(i)).exists())throw new Error(`Space with ID ${n} not found`);await Ec(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),Wy[n]&&delete Wy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),he.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw he.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},qV=async(n,e)=>{try{he.log(`spacesFirestore: Updating HLS stream for space: ${n}`,e);const i=Pi(ri,"spaces",n);if(!(await ll(i)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:p=!0,rtmpUrl:y="",streamKey:v=""}=e,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:y,streamKey:v,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await Ec(i,b),Wy[n]&&delete Wy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:y,streamKey:v}})),he.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(i){throw he.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,i),i}},qse=async n=>{try{he.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const e=Pi(ri,"spaces",n),i=await ll(e);if(!i.exists())return he.warn(`spacesFirestore: Space with ID ${n} not found`),null;const a=i.data();return a.HLSStreamURL?(he.log(`spacesFirestore: Found HLS stream for space: ${n}`,a.HLSStreamURL),a.HLSStreamURL):(he.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(e){throw he.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,e),e}},Fo=D.createContext(null),hN=({children:n})=>{const[e,i]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),p=$re(),y=$=>$?$.Nickname?$.Nickname:`${$.firstName} ${$.lastName}`:"Anon";D.useEffect(()=>{const $=nFe(p,async te=>{if(he.log("UserProvider: Firebase onAuthStateChanged() fired"),te)try{const ce=await Ud(te.uid),oe=y(ce),_e={uid:te.uid,email:te.email,emailVerified:te.emailVerified,...ce,displayName:oe};console.log(_e),i(_e),a.current=_e,A(_e)}catch(ce){he.error("UserProvider: Error fetching user profile data:",ce)}else i(null),a.current=null;d(!1)});return()=>{$&&$()}},[]);const v=async($,te,ce)=>{try{const{firstName:oe,lastName:_e}=ce,ne=`${oe}${_e.charAt(0).toUpperCase()}`,ee={...ce,Nickname:ne,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},Q=await A5e($,te,ee),se=y(ee),fe={uid:Q.uid,email:Q.email,...ee,displayName:se};return i(fe),a.current=fe,he.log("UserProvider: User registered successfully with groups:",ee.groups),fe}catch(oe){throw he.error("UserProvider: Error creating user:",oe),oe}},b=async($,te)=>{try{const ce=await ZVe(p,$,te);if(!ce.user.emailVerified)throw await CV(ce.user),he.log("UserProvider: Verification email sent again to:",$),new Error("Please verify your email before signing in. A new verification email has been sent.");const oe=await Ud(ce.user.uid),_e=y(oe),ne={uid:ce.user.uid,email:ce.user.email,emailVerified:ce.user.emailVerified,...oe,displayName:_e};i(ne),A(ne)}catch(ce){throw he.error("UserProvider: Error signing in:",ce),ce}},w=async()=>{try{await rFe(p),i(null),he.log("UserProvider: User signed out.")}catch($){throw he.error("UserProvider: Error signing out:",$),$}},A=()=>{const $=a.current;if($){const te=N($);he.log("UserProvider: sendUserToUnity() using the eventBus",te),Dd.publish(Nd.sendUserToUnity,te)}else he.log("UserProvider: No current user to send to Unity.")},N=$=>{const te={};return[...D5e,"uid"].forEach(oe=>{$.hasOwnProperty(oe)&&(te[oe]=$[oe])}),te},V=async $=>!e||!e.uid?!1:await Ose(e.uid,$),F=async $=>{if(!e||!e.uid)return!1;try{const te=await yg($);if(te.usersAllowed.includes(e.uid)||te.userAdmin.includes(e.uid)||te.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const oe=`space_${$}_owners`,_e=`space_${$}_hosts`;if(e.groups.includes(oe)||e.groups.includes(_e))return he.log(`UserProvider: User ${e.uid} has access to space ${$} as owner/host`),!0}return te.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(te){return he.error("UserProvider: Error verifying user access to space:",te),!1}},B=async $=>{if(!e||!e.uid)return!1;try{return(await yg($)).userAdmin.includes(e.uid)}catch(te){return he.error("UserProvider: Error verifying user admin status for space:",te),!1}},W=async $=>{if(!e||!e.uid)return!1;try{return(await yg($)).usersModerators.includes(e.uid)}catch(te){return he.error("UserProvider: Error verifying user moderator status for space:",te),!1}},J=async()=>{try{const $=p.currentUser;return $&&!$.emailVerified?(await CV($),he.log("UserProvider: Verification email resent to:",$.email),!0):!1}catch($){throw he.error("UserProvider: Error resending verification email:",$),$}};return C.jsx(Fo.Provider,{value:{user:e,loading:l,register:v,signIn:b,signOut:w,sendUserToUnity:A,isUserInGroup:V,userHasAccessToSpace:F,userIsAdminOfSpace:B,userIsModeratorOfSpace:W,resendVerificationEmail:J},children:n})},Yse=D.createContext(),Vd=()=>D.useContext(Yse),j4=({children:n})=>{const[e,i]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=D.useCallback(v=>{a.current=v},[]),y=D.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),i(!0);return}catch(A){console.error("iOS fullscreen error:",A)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),i(!0);return}}catch(A){console.error("iOS fallback fullscreen error:",A)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(A){console.error("Android fullscreen error:",A)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),C.jsx(Yse.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:a,setFullscreenRef:p,isMobile:l},children:C.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},e6e=Dg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),t6e=Dg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),n6e=Dg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Xse=Dg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),OJ=Dg({displayName:"EmailIcon",path:C.jsxs("g",{fill:"currentColor",children:[C.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),C.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),r6e=Dg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),i6e=Dg({displayName:"QuestionOutlineIcon",path:C.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[C.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),C.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),C.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),s6e=Dg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var bR=n=>n.type==="checkbox",Ey=n=>n instanceof Date,pc=n=>n==null;const Jse=n=>typeof n=="object";var Ks=n=>!pc(n)&&!Array.isArray(n)&&Jse(n)&&!Ey(n),o6e=n=>Ks(n)&&n.target?bR(n.target)?n.target.checked:n.target.value:n,a6e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,c6e=(n,e)=>n.has(a6e(e)),l6e=n=>{const e=n.constructor&&n.constructor.prototype;return Ks(e)&&e.hasOwnProperty("isPrototypeOf")},B4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Au(n){let e;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(B4&&(n instanceof Blob||a))&&(i||Ks(n)))if(e=i?[]:{},!i&&!l6e(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Au(n[l]));else return n;return e}var fN=n=>Array.isArray(n)?n.filter(Boolean):[],Zs=n=>n===void 0,an=(n,e,i)=>{if(!e||!Ks(n))return i;const a=fN(e.split(/[,[\].]+?/)).reduce((l,d)=>pc(l)?l:l[d],n);return Zs(a)||a===n?Zs(n[e])?i:n[e]:a},Vh=n=>typeof n=="boolean",W4=n=>/^\w*$/.test(n),Qse=n=>fN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Qi=(n,e,i)=>{let a=-1;const l=W4(e)?[e]:Qse(e),d=l.length,p=d-1;for(;++a<d;){const y=l[a];let v=i;if(a!==p){const b=n[y];v=Ks(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const kJ={BLUR:"blur",FOCUS_OUT:"focusout"},Od={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},dp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ui.createContext(null);var u6e=(n,e,i,a=!0)=>{const l={defaultValues:e._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return e._proxyFormState[p]!==Od.all&&(e._proxyFormState[p]=!a||Od.all),n[p]}});return l},el=n=>Ks(n)&&!Object.keys(n).length,d6e=(n,e,i,a)=>{i(n);const{name:l,...d}=n;return el(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(p=>e[p]===Od.all)},_k=n=>Array.isArray(n)?n:[n];function h6e(n){const e=ui.useRef(n);e.current=n,ui.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var Kh=n=>typeof n=="string",f6e=(n,e,i,a,l)=>Kh(n)?(a&&e.watch.add(n),an(i,n,l)):Array.isArray(n)?n.map(d=>(a&&e.watch.add(d),an(i,d))):(a&&(e.watchAll=!0),i),p6e=(n,e,i,a,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},NJ=n=>({isOnSubmit:!n||n===Od.onSubmit,isOnBlur:n===Od.onBlur,isOnChange:n===Od.onChange,isOnAll:n===Od.all,isOnTouch:n===Od.onTouched}),DJ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const fC=(n,e,i,a)=>{for(const l of i||Object.keys(n)){const d=an(n,l);if(d){const{_f:p,...y}=d;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!a)return!0;if(p.ref&&e(p.ref,p.name)&&!a)return!0;if(fC(y,e))break}else if(Ks(y)&&fC(y,e))break}}};var m6e=(n,e,i)=>{const a=_k(an(n,i));return Qi(a,"root",e[i]),Qi(n,i,a),n},z4=n=>n.type==="file",zh=n=>typeof n=="function",i1=n=>{if(!B4)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},yk=n=>Kh(n),G4=n=>n.type==="radio",s1=n=>n instanceof RegExp;const xJ={value:!1,isValid:!1},LJ={value:!0,isValid:!0};var Zse=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Zs(n[0].attributes.value)?Zs(n[0].value)||n[0].value===""?LJ:{value:n[0].value,isValid:!0}:LJ:xJ}return xJ};const MJ={isValid:!1,value:null};var eoe=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,MJ):MJ;function UJ(n,e,i="validate"){if(yk(n)||Array.isArray(n)&&n.every(yk)||Vh(n)&&!n)return{type:i,message:yk(n)?n:"",ref:e}}var bS=n=>Ks(n)&&!s1(n)?n:{value:n,message:""},VJ=async(n,e,i,a,l,d)=>{const{ref:p,refs:y,required:v,maxLength:b,minLength:w,min:A,max:N,pattern:V,validate:F,name:B,valueAsNumber:W,mount:J}=n._f,$=an(i,B);if(!J||e.has(B))return{};const te=y?y[0]:p,ce=pe=>{l&&te.reportValidity&&(te.setCustomValidity(Vh(pe)?"":pe||""),te.reportValidity())},oe={},_e=G4(p),ne=bR(p),ee=_e||ne,Q=(W||z4(p))&&Zs(p.value)&&Zs($)||i1(p)&&p.value===""||$===""||Array.isArray($)&&!$.length,se=p6e.bind(null,B,a,oe),fe=(pe,ue,Me,He=dp.maxLength,nt=dp.minLength)=>{const we=pe?ue:Me;oe[B]={type:pe?He:nt,message:we,ref:p,...se(pe?He:nt,we)}};if(d?!Array.isArray($)||!$.length:v&&(!ee&&(Q||pc($))||Vh($)&&!$||ne&&!Zse(y).isValid||_e&&!eoe(y).isValid)){const{value:pe,message:ue}=yk(v)?{value:!!v,message:v}:bS(v);if(pe&&(oe[B]={type:dp.required,message:ue,ref:te,...se(dp.required,ue)},!a))return ce(ue),oe}if(!Q&&(!pc(A)||!pc(N))){let pe,ue;const Me=bS(N),He=bS(A);if(!pc($)&&!isNaN($)){const nt=p.valueAsNumber||$&&+$;pc(Me.value)||(pe=nt>Me.value),pc(He.value)||(ue=nt<He.value)}else{const nt=p.valueAsDate||new Date($),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Re=p.type=="time",ve=p.type=="week";Kh(Me.value)&&$&&(pe=Re?we($)>we(Me.value):ve?$>Me.value:nt>new Date(Me.value)),Kh(He.value)&&$&&(ue=Re?we($)<we(He.value):ve?$<He.value:nt<new Date(He.value))}if((pe||ue)&&(fe(!!pe,Me.message,He.message,dp.max,dp.min),!a))return ce(oe[B].message),oe}if((b||w)&&!Q&&(Kh($)||d&&Array.isArray($))){const pe=bS(b),ue=bS(w),Me=!pc(pe.value)&&$.length>+pe.value,He=!pc(ue.value)&&$.length<+ue.value;if((Me||He)&&(fe(Me,pe.message,ue.message),!a))return ce(oe[B].message),oe}if(V&&!Q&&Kh($)){const{value:pe,message:ue}=bS(V);if(s1(pe)&&!$.match(pe)&&(oe[B]={type:dp.pattern,message:ue,ref:p,...se(dp.pattern,ue)},!a))return ce(ue),oe}if(F){if(zh(F)){const pe=await F($,i),ue=UJ(pe,te);if(ue&&(oe[B]={...ue,...se(dp.validate,ue.message)},!a))return ce(ue.message),oe}else if(Ks(F)){let pe={};for(const ue in F){if(!el(pe)&&!a)break;const Me=UJ(await F[ue]($,i),te,ue);Me&&(pe={...Me,...se(ue,Me.message)},ce(Me.message),a&&(oe[B]=pe))}if(!el(pe)&&(oe[B]={ref:te,...pe},!a))return oe}}return ce(!0),oe};function g6e(n,e){const i=e.slice(0,-1).length;let a=0;for(;a<i;)n=Zs(n)?a++:n[e[a++]];return n}function _6e(n){for(const e in n)if(n.hasOwnProperty(e)&&!Zs(n[e]))return!1;return!0}function mo(n,e){const i=Array.isArray(e)?e:W4(e)?[e]:Qse(e),a=i.length===1?n:g6e(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(Ks(a)&&el(a)||Array.isArray(a)&&_6e(a))&&mo(n,i.slice(0,-1)),n}var uU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},YV=n=>pc(n)||!Jse(n);function hg(n,e){if(YV(n)||YV(e))return n===e;if(Ey(n)&&Ey(e))return n.getTime()===e.getTime();const i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const p=e[l];if(Ey(d)&&Ey(p)||Ks(d)&&Ks(p)||Array.isArray(d)&&Array.isArray(p)?!hg(d,p):d!==p)return!1}}return!0}var toe=n=>n.type==="select-multiple",y6e=n=>G4(n)||bR(n),dU=n=>i1(n)&&n.isConnected,noe=n=>{for(const e in n)if(zh(n[e]))return!0;return!1};function o1(n,e={}){const i=Array.isArray(n);if(Ks(n)||i)for(const a in n)Array.isArray(n[a])||Ks(n[a])&&!noe(n[a])?(e[a]=Array.isArray(n[a])?[]:{},o1(n[a],e[a])):pc(n[a])||(e[a]=!0);return e}function roe(n,e,i){const a=Array.isArray(n);if(Ks(n)||a)for(const l in n)Array.isArray(n[l])||Ks(n[l])&&!noe(n[l])?Zs(e)||YV(i[l])?i[l]=Array.isArray(n[l])?o1(n[l],[]):{...o1(n[l])}:roe(n[l],pc(e)?{}:e[l],i[l]):i[l]=!hg(n[l],e[l]);return i}var yw=(n,e)=>roe(n,e,o1(e)),ioe=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:a})=>Zs(n)?n:e?n===""?NaN:n&&+n:i&&Kh(n)?new Date(n):a?a(n):n;function hU(n){const e=n.ref;return z4(e)?e.files:G4(e)?eoe(n.refs).value:toe(e)?[...e.selectedOptions].map(({value:i})=>i):bR(e)?Zse(n.refs).value:ioe(Zs(e.value)?n.ref.value:e.value,n)}var E6e=(n,e,i,a)=>{const l={};for(const d of n){const p=an(e,d);p&&Qi(l,d,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},Ew=n=>Zs(n)?n:s1(n)?n.source:Ks(n)?s1(n.value)?n.value.source:n.value:n;const FJ="AsyncFunction";var v6e=n=>!!n&&!!n.validate&&!!(zh(n.validate)&&n.validate.constructor.name===FJ||Ks(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===FJ)),S6e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function jJ(n,e,i){const a=an(n,i);if(a||W4(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),p=an(e,d),y=an(n,d);if(p&&!Array.isArray(p)&&i!==d)return{name:i};if(y&&y.type)return{name:d,error:y};l.pop()}return{name:i}}var b6e=(n,e,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,T6e=(n,e)=>!fN(an(n,e)).length&&mo(n,e);const w6e={mode:Od.onSubmit,reValidateMode:Od.onChange,shouldFocusError:!0};function C6e(n={}){let e={...w6e,...n},i={submitCount:0,isDirty:!1,isLoading:zh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},l=Ks(e.defaultValues)||Ks(e.values)?Au(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Au(l),p={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},A={values:uU(),array:uU(),state:uU()},N=NJ(e.mode),V=NJ(e.reValidateMode),F=e.criteriaMode===Od.all,B=Ce=>Fe=>{clearTimeout(b),b=setTimeout(Ce,Fe)},W=async Ce=>{if(!e.disabled&&(w.isValid||Ce)){const Fe=e.resolver?el((await ee()).errors):await se(a,!0);Fe!==i.isValid&&A.state.next({isValid:Fe})}},J=(Ce,Fe)=>{!e.disabled&&(w.isValidating||w.validatingFields)&&((Ce||Array.from(y.mount)).forEach(We=>{We&&(Fe?Qi(i.validatingFields,We,Fe):mo(i.validatingFields,We))}),A.state.next({validatingFields:i.validatingFields,isValidating:!el(i.validatingFields)}))},$=(Ce,Fe=[],We,at,vt=!0,St=!0)=>{if(at&&We&&!e.disabled){if(p.action=!0,St&&Array.isArray(an(a,Ce))){const Gt=We(an(a,Ce),at.argA,at.argB);vt&&Qi(a,Ce,Gt)}if(St&&Array.isArray(an(i.errors,Ce))){const Gt=We(an(i.errors,Ce),at.argA,at.argB);vt&&Qi(i.errors,Ce,Gt),T6e(i.errors,Ce)}if(w.touchedFields&&St&&Array.isArray(an(i.touchedFields,Ce))){const Gt=We(an(i.touchedFields,Ce),at.argA,at.argB);vt&&Qi(i.touchedFields,Ce,Gt)}w.dirtyFields&&(i.dirtyFields=yw(l,d)),A.state.next({name:Ce,isDirty:pe(Ce,Fe),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Qi(d,Ce,Fe)},te=(Ce,Fe)=>{Qi(i.errors,Ce,Fe),A.state.next({errors:i.errors})},ce=Ce=>{i.errors=Ce,A.state.next({errors:i.errors,isValid:!1})},oe=(Ce,Fe,We,at)=>{const vt=an(a,Ce);if(vt){const St=an(d,Ce,Zs(We)?an(l,Ce):We);Zs(St)||at&&at.defaultChecked||Fe?Qi(d,Ce,Fe?St:hU(vt._f)):He(Ce,St),p.mount&&W()}},_e=(Ce,Fe,We,at,vt)=>{let St=!1,Gt=!1;const fn={name:Ce};if(!e.disabled){const Ln=!!(an(a,Ce)&&an(a,Ce)._f&&an(a,Ce)._f.disabled);if(!We||at){w.isDirty&&(Gt=i.isDirty,i.isDirty=fn.isDirty=pe(),St=Gt!==fn.isDirty);const cn=Ln||hg(an(l,Ce),Fe);Gt=!!(!Ln&&an(i.dirtyFields,Ce)),cn||Ln?mo(i.dirtyFields,Ce):Qi(i.dirtyFields,Ce,!0),fn.dirtyFields=i.dirtyFields,St=St||w.dirtyFields&&Gt!==!cn}if(We){const cn=an(i.touchedFields,Ce);cn||(Qi(i.touchedFields,Ce,We),fn.touchedFields=i.touchedFields,St=St||w.touchedFields&&cn!==We)}St&&vt&&A.state.next(fn)}return St?fn:{}},ne=(Ce,Fe,We,at)=>{const vt=an(i.errors,Ce),St=w.isValid&&Vh(Fe)&&i.isValid!==Fe;if(e.delayError&&We?(v=B(()=>te(Ce,We)),v(e.delayError)):(clearTimeout(b),v=null,We?Qi(i.errors,Ce,We):mo(i.errors,Ce)),(We?!hg(vt,We):vt)||!el(at)||St){const Gt={...at,...St&&Vh(Fe)?{isValid:Fe}:{},errors:i.errors,name:Ce};i={...i,...Gt},A.state.next(Gt)}},ee=async Ce=>{J(Ce,!0);const Fe=await e.resolver(d,e.context,E6e(Ce||y.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return J(Ce),Fe},Q=async Ce=>{const{errors:Fe}=await ee(Ce);if(Ce)for(const We of Ce){const at=an(Fe,We);at?Qi(i.errors,We,at):mo(i.errors,We)}else i.errors=Fe;return Fe},se=async(Ce,Fe,We={valid:!0})=>{for(const at in Ce){const vt=Ce[at];if(vt){const{_f:St,...Gt}=vt;if(St){const fn=y.array.has(St.name),Ln=vt._f&&v6e(vt._f);Ln&&w.validatingFields&&J([at],!0);const cn=await VJ(vt,y.disabled,d,F,e.shouldUseNativeValidation&&!Fe,fn);if(Ln&&w.validatingFields&&J([at]),cn[St.name]&&(We.valid=!1,Fe))break;!Fe&&(an(cn,St.name)?fn?m6e(i.errors,cn,St.name):Qi(i.errors,St.name,cn[St.name]):mo(i.errors,St.name))}!el(Gt)&&await se(Gt,Fe,We)}}return We.valid},fe=()=>{for(const Ce of y.unMount){const Fe=an(a,Ce);Fe&&(Fe._f.refs?Fe._f.refs.every(We=>!dU(We)):!dU(Fe._f.ref))&&Qe(Ce)}y.unMount=new Set},pe=(Ce,Fe)=>!e.disabled&&(Ce&&Fe&&Qi(d,Ce,Fe),!hg(Te(),l)),ue=(Ce,Fe,We)=>f6e(Ce,y,{...p.mount?d:Zs(Fe)?l:Kh(Ce)?{[Ce]:Fe}:Fe},We,Fe),Me=Ce=>fN(an(p.mount?d:l,Ce,e.shouldUnregister?an(l,Ce,[]):[])),He=(Ce,Fe,We={})=>{const at=an(a,Ce);let vt=Fe;if(at){const St=at._f;St&&(!St.disabled&&Qi(d,Ce,ioe(Fe,St)),vt=i1(St.ref)&&pc(Fe)?"":Fe,toe(St.ref)?[...St.ref.options].forEach(Gt=>Gt.selected=vt.includes(Gt.value)):St.refs?bR(St.ref)?St.refs.length>1?St.refs.forEach(Gt=>(!Gt.defaultChecked||!Gt.disabled)&&(Gt.checked=Array.isArray(vt)?!!vt.find(fn=>fn===Gt.value):vt===Gt.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(Gt=>Gt.checked=Gt.value===vt):z4(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||A.values.next({name:Ce,values:{...d}})))}(We.shouldDirty||We.shouldTouch)&&_e(Ce,vt,We.shouldTouch,We.shouldDirty,!0),We.shouldValidate&&Ne(Ce)},nt=(Ce,Fe,We)=>{for(const at in Fe){const vt=Fe[at],St=`${Ce}.${at}`,Gt=an(a,St);(y.array.has(Ce)||Ks(vt)||Gt&&!Gt._f)&&!Ey(vt)?nt(St,vt,We):He(St,vt,We)}},we=(Ce,Fe,We={})=>{const at=an(a,Ce),vt=y.array.has(Ce),St=Au(Fe);Qi(d,Ce,St),vt?(A.array.next({name:Ce,values:{...d}}),(w.isDirty||w.dirtyFields)&&We.shouldDirty&&A.state.next({name:Ce,dirtyFields:yw(l,d),isDirty:pe(Ce,St)})):at&&!at._f&&!pc(St)?nt(Ce,St,We):He(Ce,St,We),DJ(Ce,y)&&A.state.next({...i}),A.values.next({name:p.mount?Ce:void 0,values:{...d}})},Re=async Ce=>{p.mount=!0;const Fe=Ce.target;let We=Fe.name,at=!0;const vt=an(a,We),St=()=>Fe.type?hU(vt._f):o6e(Ce),Gt=fn=>{at=Number.isNaN(fn)||Ey(fn)&&isNaN(fn.getTime())||hg(fn,an(d,We,fn))};if(vt){let fn,Ln;const cn=St(),dr=Ce.type===kJ.BLUR||Ce.type===kJ.FOCUS_OUT,_a=!S6e(vt._f)&&!e.resolver&&!an(i.errors,We)&&!vt._f.deps||b6e(dr,an(i.touchedFields,We),i.isSubmitted,V,N),Vt=DJ(We,y,dr);Qi(d,We,cn),dr?(vt._f.onBlur&&vt._f.onBlur(Ce),v&&v(0)):vt._f.onChange&&vt._f.onChange(Ce);const on=_e(We,cn,dr,!1),Wi=!el(on)||Vt;if(!dr&&A.values.next({name:We,type:Ce.type,values:{...d}}),_a)return w.isValid&&(e.mode==="onBlur"&&dr?W():dr||W()),Wi&&A.state.next({name:We,...Vt?{}:on});if(!dr&&Vt&&A.state.next({...i}),e.resolver){const{errors:gs}=await ee([We]);if(Gt(cn),at){const Ms=jJ(i.errors,a,We),ii=jJ(gs,a,Ms.name||We);fn=ii.error,We=ii.name,Ln=el(gs)}}else J([We],!0),fn=(await VJ(vt,y.disabled,d,F,e.shouldUseNativeValidation))[We],J([We]),Gt(cn),at&&(fn?Ln=!1:w.isValid&&(Ln=await se(a,!0)));at&&(vt._f.deps&&Ne(vt._f.deps),ne(We,Ln,fn,on))}},ve=(Ce,Fe)=>{if(an(i.errors,Fe)&&Ce.focus)return Ce.focus(),1},Ne=async(Ce,Fe={})=>{let We,at;const vt=_k(Ce);if(e.resolver){const St=await Q(Zs(Ce)?Ce:vt);We=el(St),at=Ce?!vt.some(Gt=>an(St,Gt)):We}else Ce?(at=(await Promise.all(vt.map(async St=>{const Gt=an(a,St);return await se(Gt&&Gt._f?{[St]:Gt}:Gt)}))).every(Boolean),!(!at&&!i.isValid)&&W()):at=We=await se(a);return A.state.next({...!Kh(Ce)||w.isValid&&We!==i.isValid?{}:{name:Ce},...e.resolver||!Ce?{isValid:We}:{},errors:i.errors}),Fe.shouldFocus&&!at&&fC(a,ve,Ce?vt:y.mount),at},Te=Ce=>{const Fe={...p.mount?d:l};return Zs(Ce)?Fe:Kh(Ce)?an(Fe,Ce):Ce.map(We=>an(Fe,We))},be=(Ce,Fe)=>({invalid:!!an((Fe||i).errors,Ce),isDirty:!!an((Fe||i).dirtyFields,Ce),error:an((Fe||i).errors,Ce),isValidating:!!an(i.validatingFields,Ce),isTouched:!!an((Fe||i).touchedFields,Ce)}),Ae=Ce=>{Ce&&_k(Ce).forEach(Fe=>mo(i.errors,Fe)),A.state.next({errors:Ce?i.errors:{}})},Ue=(Ce,Fe,We)=>{const at=(an(a,Ce,{_f:{}})._f||{}).ref,vt=an(i.errors,Ce)||{},{ref:St,message:Gt,type:fn,...Ln}=vt;Qi(i.errors,Ce,{...Ln,...Fe,ref:at}),A.state.next({name:Ce,errors:i.errors,isValid:!1}),We&&We.shouldFocus&&at&&at.focus&&at.focus()},Ge=(Ce,Fe)=>zh(Ce)?A.values.subscribe({next:We=>Ce(ue(void 0,Fe),We)}):ue(Ce,Fe,!0),Qe=(Ce,Fe={})=>{for(const We of Ce?_k(Ce):y.mount)y.mount.delete(We),y.array.delete(We),Fe.keepValue||(mo(a,We),mo(d,We)),!Fe.keepError&&mo(i.errors,We),!Fe.keepDirty&&mo(i.dirtyFields,We),!Fe.keepTouched&&mo(i.touchedFields,We),!Fe.keepIsValidating&&mo(i.validatingFields,We),!e.shouldUnregister&&!Fe.keepDefaultValue&&mo(l,We);A.values.next({values:{...d}}),A.state.next({...i,...Fe.keepDirty?{isDirty:pe()}:{}}),!Fe.keepIsValid&&W()},tt=({disabled:Ce,name:Fe,field:We,fields:at})=>{(Vh(Ce)&&p.mount||Ce||y.disabled.has(Fe))&&(Ce?y.disabled.add(Fe):y.disabled.delete(Fe),_e(Fe,hU(We?We._f:an(at,Fe)._f),!1,!1,!0))},ht=(Ce,Fe={})=>{let We=an(a,Ce);const at=Vh(Fe.disabled)||Vh(e.disabled);return Qi(a,Ce,{...We||{},_f:{...We&&We._f?We._f:{ref:{name:Ce}},name:Ce,mount:!0,...Fe}}),y.mount.add(Ce),We?tt({field:We,disabled:Vh(Fe.disabled)?Fe.disabled:e.disabled,name:Ce}):oe(Ce,!0,Fe.value),{...at?{disabled:Fe.disabled||e.disabled}:{},...e.progressive?{required:!!Fe.required,min:Ew(Fe.min),max:Ew(Fe.max),minLength:Ew(Fe.minLength),maxLength:Ew(Fe.maxLength),pattern:Ew(Fe.pattern)}:{},name:Ce,onChange:Re,onBlur:Re,ref:vt=>{if(vt){ht(Ce,Fe),We=an(a,Ce);const St=Zs(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Gt=y6e(St),fn=We._f.refs||[];if(Gt?fn.find(Ln=>Ln===St):St===We._f.ref)return;Qi(a,Ce,{_f:{...We._f,...Gt?{refs:[...fn.filter(dU),St,...Array.isArray(an(l,Ce))?[{}]:[]],ref:{type:St.type,name:Ce}}:{ref:St}}}),oe(Ce,!1,void 0,St)}else We=an(a,Ce,{}),We._f&&(We._f.mount=!1),(e.shouldUnregister||Fe.shouldUnregister)&&!(c6e(y.array,Ce)&&p.action)&&y.unMount.add(Ce)}}},Ze=()=>e.shouldFocusError&&fC(a,ve,y.mount),Ct=Ce=>{Vh(Ce)&&(A.state.next({disabled:Ce}),fC(a,(Fe,We)=>{const at=an(a,We);at&&(Fe.disabled=at._f.disabled||Ce,Array.isArray(at._f.refs)&&at._f.refs.forEach(vt=>{vt.disabled=at._f.disabled||Ce}))},0,!1))},un=(Ce,Fe)=>async We=>{let at;We&&(We.preventDefault&&We.preventDefault(),We.persist&&We.persist());let vt=Au(d);if(y.disabled.size)for(const St of y.disabled)Qi(vt,St,void 0);if(A.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:Gt}=await ee();i.errors=St,vt=Gt}else await se(a);if(mo(i.errors,"root"),el(i.errors)){A.state.next({errors:{}});try{await Ce(vt,We)}catch(St){at=St}}else Fe&&await Fe({...i.errors},We),Ze(),setTimeout(Ze);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:el(i.errors)&&!at,submitCount:i.submitCount+1,errors:i.errors}),at)throw at},Lt=(Ce,Fe={})=>{an(a,Ce)&&(Zs(Fe.defaultValue)?we(Ce,Au(an(l,Ce))):(we(Ce,Fe.defaultValue),Qi(l,Ce,Au(Fe.defaultValue))),Fe.keepTouched||mo(i.touchedFields,Ce),Fe.keepDirty||(mo(i.dirtyFields,Ce),i.isDirty=Fe.defaultValue?pe(Ce,Au(an(l,Ce))):pe()),Fe.keepError||(mo(i.errors,Ce),w.isValid&&W()),A.state.next({...i}))},nn=(Ce,Fe={})=>{const We=Ce?Au(Ce):l,at=Au(We),vt=el(Ce),St=vt?l:at;if(Fe.keepDefaultValues||(l=We),!Fe.keepValues){if(Fe.keepDirtyValues){const Gt=new Set([...y.mount,...Object.keys(yw(l,d))]);for(const fn of Array.from(Gt))an(i.dirtyFields,fn)?Qi(St,fn,an(d,fn)):we(fn,an(St,fn))}else{if(B4&&Zs(Ce))for(const Gt of y.mount){const fn=an(a,Gt);if(fn&&fn._f){const Ln=Array.isArray(fn._f.refs)?fn._f.refs[0]:fn._f.ref;if(i1(Ln)){const cn=Ln.closest("form");if(cn){cn.reset();break}}}}a={}}d=e.shouldUnregister?Fe.keepDefaultValues?Au(l):{}:Au(St),A.array.next({values:{...St}}),A.values.next({values:{...St}})}y={mount:Fe.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!w.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,p.watch=!!e.shouldUnregister,A.state.next({submitCount:Fe.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:Fe.keepDirty?i.isDirty:!!(Fe.keepDefaultValues&&!hg(Ce,l)),isSubmitted:Fe.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?yw(l,d):i.dirtyFields:Fe.keepDefaultValues&&Ce?yw(l,Ce):Fe.keepDirty?i.dirtyFields:{},touchedFields:Fe.keepTouched?i.touchedFields:{},errors:Fe.keepErrors?i.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},kn=(Ce,Fe)=>nn(zh(Ce)?Ce(d):Ce,Fe);return{control:{register:ht,unregister:Qe,getFieldState:be,handleSubmit:un,setError:Ue,_executeSchema:ee,_getWatch:ue,_getDirty:pe,_updateValid:W,_removeUnmounted:fe,_updateFieldArray:$,_updateDisabledField:tt,_getFieldArray:Me,_reset:nn,_resetDefaultValues:()=>zh(e.defaultValues)&&e.defaultValues().then(Ce=>{kn(Ce,e.resetOptions),A.state.next({isLoading:!1})}),_updateFormState:Ce=>{i={...i,...Ce}},_disableForm:Ct,_subjects:A,_proxyFormState:w,_setErrors:ce,get _fields(){return a},get _formValues(){return d},get _state(){return p},set _state(Ce){p=Ce},get _defaultValues(){return l},get _names(){return y},set _names(Ce){y=Ce},get _formState(){return i},set _formState(Ce){i=Ce},get _options(){return e},set _options(Ce){e={...e,...Ce}}},trigger:Ne,register:ht,handleSubmit:un,watch:Ge,setValue:we,getValues:Te,reset:kn,resetField:Lt,clearErrors:Ae,unregister:Qe,setError:Ue,setFocus:(Ce,Fe={})=>{const We=an(a,Ce),at=We&&We._f;if(at){const vt=at.refs?at.refs[0]:at.ref;vt.focus&&(vt.focus(),Fe.shouldSelect&&zh(vt.select)&&vt.select())}},getFieldState:be}}function soe(n={}){const e=ui.useRef(void 0),i=ui.useRef(void 0),[a,l]=ui.useState({isDirty:!1,isValidating:!1,isLoading:zh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:zh(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...C6e(n),formState:a});const d=e.current.control;return d._options=n,h6e({subject:d._subjects.state,next:p=>{d6e(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ui.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),ui.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==a.isDirty&&d._subjects.state.next({isDirty:p})}},[d,a.isDirty]),ui.useEffect(()=>{n.values&&!hg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),ui.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),ui.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ui.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),e.current.formState=u6e(a,d),e.current}const pN=(n,e="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),he.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){he.error(`Failed to disable Unity input for ${e}:`,l)}},a=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),he.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):he.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){he.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,e])};function mN({mode:n,label:e,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:y}}=soe(),{register:v}=D.useContext(Fo),b=Gl(),{fullscreenRef:w}=Vd(),[A,N]=D.useState(!1),[V,F]=D.useState(!1),B=a!==void 0?a:A,W=l||(()=>N(!1));pN(B);const J=async ce=>{const{email:oe,password:_e,confirmPassword:ne,...ee}=ce;if(_e!==ne){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}F(!0);try{const Q=await v(oe,_e,ee);he.log("User: Registration process complete."),W(),b({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(Q){he.error("User: Registration Error:",Q),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{F(!1)}},$=()=>{l?l():N(!A)},te=n==="link"?C.jsx(ku,{variant:"header",onClick:$,children:e}):C.jsx(Br,{onClick:$,...i,children:e});return C.jsxs(C.Fragment,{children:[!a&&te,C.jsxs(Lo,{isOpen:B,onClose:W,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Vo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Mo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:ce=>{ce.stopPropagation()},children:[C.jsxs(yc,{p:8,textAlign:"center",children:[C.jsx(Mk,{size:"lg",mb:2,children:"Create Account"}),C.jsx(ot,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),C.jsx(ma,{color:"gray.400"}),C.jsx(Uo,{px:8,children:C.jsx("form",{onSubmit:p(J),children:C.jsxs(ti,{spacing:4,children:[C.jsxs($r,{isInvalid:y.companyName,isRequired:!0,children:[C.jsx(Ai,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),C.jsx(pp,{children:y.companyName&&y.companyName.message})]}),C.jsxs(ei,{gap:4,w:"100%",children:[C.jsxs($r,{isInvalid:y.firstName,isRequired:!0,children:[C.jsx(Ai,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),C.jsx(pp,{children:y.firstName&&y.firstName.message})]}),C.jsxs($r,{isInvalid:y.lastName,isRequired:!0,children:[C.jsx(Ai,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),C.jsx(pp,{children:y.lastName&&y.lastName.message})]})]}),C.jsxs($r,{isInvalid:y.email,isRequired:!0,children:[C.jsx(Ai,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),C.jsx(pp,{children:y.email&&y.email.message})]}),C.jsxs(ei,{gap:4,w:"100%",children:[C.jsxs($r,{isInvalid:y.password,isRequired:!0,children:[C.jsx(Ai,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),C.jsx(pp,{children:y.password&&y.password.message})]}),C.jsxs($r,{isInvalid:y.confirmPassword,isRequired:!0,children:[C.jsx(Ai,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),C.jsx(pp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),C.jsx($r,{children:C.jsx(Ai,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),C.jsx($r,{children:C.jsx(Ai,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),C.jsxs(Tg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Br,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(J),isLoading:V,loadingText:"Creating Account",children:"Create Account"}),C.jsxs(ot,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",C.jsx(ku,{color:"blue.400",onClick:()=>{W(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}mN.propTypes={mode:_r.oneOf(["button","link"]),label:_r.string,buttonProps:_r.object,isOpen:_r.bool,onClose:_r.func};function gN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(Fo),{fullscreenRef:d}=Vd(),p=Gl(),{register:y,handleSubmit:v,formState:{errors:b,isSubmitting:w}}=soe({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[A,N]=D.useState(a),[V,F]=D.useState(!1),[B,W]=D.useState(!1),[J,$]=D.useState(""),[te,ce]=D.useState(!1);pN(A||B),D.useEffect(()=>{const fe=()=>{N(!0)};return window.addEventListener("openSignInModal",fe),()=>{window.removeEventListener("openSignInModal",fe)}},[]);const oe=async fe=>{try{await l(fe.email,fe.password),he.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(pe){he.error("User: SignIn Error:",pe);const ue=pe.message||"An error occurred while logging in. Please check your credentials.",Me=ue.includes("verify your email");p({title:Me?"Email Verification Required":"Error",description:ue,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},_e=async()=>{if(!J){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ce(!0),await JVe(Ase,J),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),W(!1)}catch(fe){he.error("User: Reset Password Error:",fe),p({title:"Error",description:fe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ce(!1)}},ne=()=>N(fe=>!fe),ee=()=>{N(!1),F(!0)},Q=()=>{W(!0)},se=n==="link"?C.jsx(ku,{variant:"header",onClick:ne,children:e}):C.jsx(Br,{onClick:ne,...i,children:e});return C.jsxs(C.Fragment,{children:[se,C.jsxs(Lo,{isOpen:A,onClose:ne,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Vo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsx("form",{onSubmit:v(oe),children:C.jsxs(Mo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:fe=>{fe.stopPropagation()},children:[C.jsxs(yc,{p:8,textAlign:"center",children:[C.jsx(Mk,{size:"lg",mb:2,children:"Welcome Back"}),C.jsx(ot,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),C.jsx(ma,{color:"gray.400"}),C.jsx(Uo,{px:8,pb:8,children:C.jsxs(ti,{spacing:4,children:[C.jsxs($r,{isInvalid:b.email,children:[C.jsxs(t0,{children:[C.jsx(sC,{pointerEvents:"none",children:C.jsx(OJ,{color:"gray.500"})}),C.jsx(Ai,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("email",{required:"Email is required."})})]}),C.jsx(pp,{children:b.email&&b.email.message})]}),C.jsxs($r,{isInvalid:b.password,children:[C.jsxs(t0,{children:[C.jsx(sC,{pointerEvents:"none",children:C.jsx(n6e,{color:"gray.500"})}),C.jsx(Ai,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...y("password",{required:"Password is required."})})]}),C.jsx(pp,{children:b.password&&b.password.message})]}),C.jsx(mt,{alignSelf:"flex-end",children:C.jsx(ku,{color:"blue.400",fontSize:"sm",onClick:Q,children:"Forgot Password?"})})]})}),C.jsxs(Tg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Br,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),C.jsxs(ot,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",C.jsx(ku,{color:"blue.400",onClick:ee,children:"Sign Up"})]})]})]})})]}),C.jsxs(Lo,{isOpen:B,onClose:()=>W(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[C.jsx(Vo,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),C.jsxs(Mo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:fe=>{fe.stopPropagation()},children:[C.jsxs(yc,{p:8,textAlign:"center",children:[C.jsx(Mk,{size:"lg",mb:2,children:"Reset Password"}),C.jsx(ot,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),C.jsx(ma,{color:"gray.400"}),C.jsx(Uo,{px:8,pb:4,children:C.jsx($r,{children:C.jsxs(t0,{children:[C.jsx(sC,{pointerEvents:"none",children:C.jsx(OJ,{color:"gray.500"})}),C.jsx(Ai,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:J,onChange:fe=>$(fe.target.value)})]})})}),C.jsxs(Tg,{px:8,pb:8,flexDirection:"column",gap:4,children:[C.jsx(Br,{colorScheme:"blue",size:"lg",width:"100%",onClick:_e,isLoading:te,loadingText:"Sending",children:"Send Reset Link"}),C.jsxs(ot,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",C.jsx(ku,{color:"blue.400",onClick:()=>W(!1),children:"Back to Sign In"})]})]})]})]}),C.jsx(mN,{mode:"link",isOpen:V,onClose:()=>F(!1)})]})}gN.propTypes={mode:_r.oneOf(["button","link"]),label:_r.string,buttonProps:_r.object,initialIsOpen:_r.bool};function H4({mode:n="button",label:e="Sign Out"}){const i=Gl(),{signOut:a}=D.useContext(Fo),{fullscreenRef:l}=Vd(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?C.jsx(ku,{variant:"header",onClick:d,style:{cursor:"pointer"},children:e}):null;return C.jsx(C.Fragment,{children:p})}H4.propTypes={mode:_r.oneOf(["button","link"]),label:_r.string};const N0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,$4=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=a.target.closest("canvas")||a.target.closest("#webgl-root"),y=document.activeElement===d;!l&&(p||y)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},ooe=()=>{document.body.classList.remove("unity-focused")};function a1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?$4():ooe(),new Promise(e=>{try{const i=N0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),XV(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function XV(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const a=()=>{i++;const l=N0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function R6e(){const n=N0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function py(n=!0){return console.log("Focusing Unity canvas"),n?$4():ooe(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){a1(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function kd(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),$4(),new Promise(e=>{try{if(n)a1(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=N0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=N0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),a1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function I6e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function A6e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=a1,window.focusUnity=py,window.blockUnityKeyboardInput=kd,window.hasUnityKeyboardFocus=R6e,window.getUnityInstance=N0,window.registerUnityInstance=I6e,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),XV(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),XV(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),kd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(A6e,0);const P6e=({isOpen:n,onClose:e,user:i,profileImageUrl:a})=>{const[l,d]=D.useState(!1),[p,y]=D.useState({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[v,b]=D.useState(!1),[w,A]=D.useState(!1),N=Gl(),{sendUserToUnity:V}=D.useContext(Fo),F=D.useRef(null);D.useEffect(()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),D.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),kd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),kd(!1).then(()=>{setTimeout(()=>{py(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),kd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),D.useEffect(()=>{if(l&&F.current){const ce=()=>{F.current.focus(),A(!0),kd(!0)};ce();const oe=setTimeout(ce,100),_e=setTimeout(ce,300);return()=>{clearTimeout(oe),clearTimeout(_e)}}else A(!1)},[l]);const B=()=>{d(!1),A(!1),e()},W=ce=>{const{name:oe,value:_e}=ce.target;y(ne=>({...ne,[oe]:_e}))},J=async()=>{if(p.Nickname.trim()===""){N({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const ce=Pi(ri,"users",i.uid),oe=Cse(ce,_e=>{_e.exists()&&_e.data().Nickname===p.Nickname&&(V(),oe())});await Ec(ce,{...p,lastUpdated:new Date().toISOString()}),await updateUser(),y({Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),N({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(ce){N({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",ce)}finally{b(!1)}},$=()=>C.jsxs(ti,{spacing:4,align:"stretch",w:"100%",children:[C.jsx(ei,{direction:"column",align:"center",gap:2,children:C.jsx(ot,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname})}),C.jsxs(ti,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[C.jsxs(ei,{direction:"column",children:[C.jsx(ot,{color:"gray.400",fontSize:"sm",children:"Company"}),C.jsx(ot,{children:i.companyName||"Not specified"})]}),C.jsxs(ei,{direction:"column",children:[C.jsx(ot,{color:"gray.400",fontSize:"sm",children:"Full Name"}),C.jsx(ot,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),C.jsxs(ei,{direction:"column",children:[C.jsx(ot,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),C.jsx(ot,{children:i.linkedInProfile||"Not specified"})]})]}),C.jsx(Br,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),te=()=>C.jsxs(ti,{spacing:4,align:"stretch",w:"100%",children:[C.jsxs($r,{children:[C.jsx(Gs,{color:"gray.400",fontSize:"sm",children:"Nickname"}),C.jsx(Ai,{ref:F,name:"Nickname",value:p.Nickname,onChange:W,onFocus:()=>{A(!0),kd(!0)},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs($r,{children:[C.jsx(Gs,{color:"gray.400",fontSize:"sm",children:"Company Name"}),C.jsx(Ai,{name:"companyName",value:p.companyName,onChange:W,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(ei,{gap:4,children:[C.jsxs($r,{children:[C.jsx(Gs,{color:"gray.400",fontSize:"sm",children:"First Name"}),C.jsx(Ai,{name:"firstName",value:p.firstName,onChange:W,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs($r,{children:[C.jsx(Gs,{color:"gray.400",fontSize:"sm",children:"Last Name"}),C.jsx(Ai,{name:"lastName",value:p.lastName,onChange:W,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),C.jsxs($r,{children:[C.jsx(Gs,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),C.jsx(Ai,{name:"linkedInProfile",value:p.linkedInProfile,onChange:W,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),C.jsxs(ei,{gap:2,justify:"flex-end",mt:2,children:[C.jsx(Br,{onClick:()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),C.jsx(Br,{onClick:J,colorScheme:"blue",size:"sm",isLoading:v,children:"Save Changes"})]})]});return C.jsxs(Lo,{isOpen:n,onClose:B,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[C.jsx(Vo,{backdropFilter:"blur(10px)"}),C.jsxs(Mo,{bg:"gray.800",color:"white",children:[C.jsx(yc,{children:"Profile"}),C.jsx(ma,{}),C.jsx(Uo,{pb:6,children:C.jsxs(ti,{spacing:6,children:[C.jsx(jl,{src:a,size:"2xl",borderRadius:"full"}),l?te():$()]})})]})]})},UO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},aoe=()=>{var w;const{user:n,updateUser:e}=D.useContext(Fo),[i,a]=D.useState(!0),{isOpen:l,onOpen:d,onClose:p}=of();D.useEffect(()=>{const A=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(A)},[]);const y=()=>{p(),e()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(w=n==null?void 0:n.groups)==null?void 0:w.includes("disruptiveAdmin");return i?null:C.jsx(ei,{align:"center",gap:"4",children:n?C.jsxs(C.Fragment,{children:[C.jsx(P6e,{isOpen:l,onClose:y,user:n,profileImageUrl:v}),C.jsxs(sR,{children:[C.jsx(oR,{as:mt,cursor:"pointer",children:C.jsx(ei,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:C.jsxs(ei,{align:"center",gap:"3",children:[C.jsx(mt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:C.jsx(jl,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),C.jsx(ot,{color:"white",fontWeight:"medium",children:n.Nickname}),C.jsx(mt,{display:"flex",alignItems:"center",height:"28px",children:C.jsx(Xse,{color:"white",w:4,h:4})})]})})}),C.jsx(zl,{children:C.jsxs(aR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[C.jsxs(mt,{p:4,display:"flex",alignItems:"center",gap:3,children:[C.jsx(jl,{src:v,size:"md",borderRadius:"full"}),C.jsx(ot,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),C.jsx(Qh,{borderColor:"gray.700"}),b&&C.jsx(Pd,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),C.jsx(Pd,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),C.jsx(Qh,{borderColor:"gray.700"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),C.jsx(Pd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:C.jsx(H4,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):C.jsxs(C.Fragment,{children:[C.jsx(mN,{mode:"button",label:"Register",buttonProps:{...UO,width:["100%","auto"]},customButton:C.jsxs(Br,{...UO,children:[C.jsx(mt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),C.jsx(gN,{mode:"button",label:"Sign In",buttonProps:{...UO,width:["100%","auto"]},customButton:C.jsxs(Br,{...UO,children:[C.jsx(mt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},fU=document.getElementById("header-auth-root");if(fU){const n=fU.getAttribute("data-theme")||"default",e=()=>{const[i,a]=D.useState(null);return D.useEffect(()=>{DC(n).then(a)},[]),i?C.jsx(A1,{theme:i,children:C.jsx(hN,{children:C.jsx(j4,{children:C.jsx(aoe,{})})})}):C.jsx("div",{children:"Loading theme..."})};l1.createRoot(fU).render(C.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var pU={},vw={},Sw={},BJ;function O6e(){if(BJ)return Sw;BJ=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.useUnityCanvasId=void 0;var n=xu(),e=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return d};return Sw.useUnityCanvasId=a,Sw}var hp={},bw={},WJ;function coe(){if(WJ)return bw;WJ=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(bw.UnityLoaderStatus=n={})),bw}var Tw={},zJ;function K4(){return zJ||(zJ=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.isBrowserEnvironment=void 0,Tw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Tw}var GJ;function k6e(){if(GJ)return hp;GJ=1;var n=hp&&hp.__awaiter||function(p,y,v,b){function w(A){return A instanceof v?A:new v(function(N){N(A)})}return new(v||(v=Promise))(function(A,N){function V(W){try{B(b.next(W))}catch(J){N(J)}}function F(W){try{B(b.throw(W))}catch(J){N(J)}}function B(W){W.done?A(W.value):w(W.value).then(V,F)}B((b=b.apply(p,y||[])).next())})},e=hp&&hp.__generator||function(p,y){var v={label:0,sent:function(){if(A[0]&1)throw A[1];return A[1]},trys:[],ops:[]},b,w,A,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=V(0),N.throw=V(1),N.return=V(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function V(B){return function(W){return F([B,W])}}function F(B){if(b)throw new TypeError("Generator is already executing.");for(;N&&(N=0,B[0]&&(v=0)),v;)try{if(b=1,w&&(A=B[0]&2?w.return:B[0]?w.throw||((A=w.return)&&A.call(w),0):w.next)&&!(A=A.call(w,B[1])).done)return A;switch(w=0,A&&(B=[B[0]&2,A.value]),B[0]){case 0:case 1:A=B;break;case 4:return v.label++,{value:B[1],done:!1};case 5:v.label++,w=B[1],B=[0];continue;case 7:B=v.ops.pop(),v.trys.pop();continue;default:if(A=v.trys,!(A=A.length>0&&A[A.length-1])&&(B[0]===6||B[0]===2)){v=0;continue}if(B[0]===3&&(!A||B[1]>A[0]&&B[1]<A[3])){v.label=B[1];break}if(B[0]===6&&v.label<A[1]){v.label=A[1],A=B;break}if(A&&v.label<A[2]){v.label=A[2],v.ops.push(B);break}A[2]&&v.ops.pop(),v.trys.pop();continue}B=y.call(p,v)}catch(W){B=[6,W],w=0}finally{b=A=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(hp,"__esModule",{value:!0}),hp.useUnityInstance=void 0;var i=xu(),a=coe(),l=K4(),d=function(p,y,v,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,A;return e(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==a.UnityLoaderStatus.Loaded||y===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(y,v,b.setLoadingProgression)];case 2:return w=N.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return A=N.sent(),b.setUnityInstance(null),b.setInitialisationError(A),[3,4];case 4:return[2]}})})})()},[p,y,v,b])};return hp.useUnityInstance=d,hp}var ww={},HJ;function N6e(){if(HJ)return ww;HJ=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.useUnityArguments=void 0;var n=xu(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return ww.useUnityArguments=e,ww}var Cw={},$J;function D6e(){if($J)return Cw;$J=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.useUnityLoader=void 0;var n=xu(),e=K4(),i=coe(),a=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),p=d[0],y=d[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){y(i.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):y(v.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(w){return y(w.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),p};return Cw.useUnityLoader=a,Cw}var KJ;function x6e(){if(KJ)return vw;KJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.Unity=void 0;var n=xu(),e=xu(),i=O6e(),a=k6e(),l=N6e(),d=D6e(),p=(0,e.forwardRef)(function(y,v){var b=(0,e.useRef)(null),w=(0,i.useUnityCanvasId)(y),A=(0,l.useUnityArguments)(y),N=(0,d.useUnityLoader)(y.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,b.current,A,y.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:y.style,className:y.className,tabIndex:y.tabIndex})});return vw.Unity=p,vw}var fp={},Rw={},qJ;function loe(){if(qJ)return Rw;qJ=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Rw.errorMessages=n,Rw}var ay={},YJ;function L6e(){if(YJ)return ay;YJ=1;var n=ay&&ay.__spreadArray||function(y,v,b){if(b||arguments.length===2)for(var w=0,A=v.length,N;w<A;w++)(N||!(w in v))&&(N||(N=Array.prototype.slice.call(v,0,w)),N[w]=v[w]);return y.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(ay,"__esModule",{value:!0}),ay.useEventSystem=void 0;var e=xu(),i=loe(),a=K4(),l=[],d=function(y){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var w=void 0;return l.forEach(function(A){w=A.apply(void 0,n([y],v,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var y=(0,e.useRef)([]),v=(0,e.useCallback)(function(A,N){y.current=n(n([],y.current,!0),[{eventName:A,callback:N}],!1)},[y]),b=(0,e.useCallback)(function(A,N){y.current=y.current.filter(function(V){return V.eventName!==A&&V.callback!==N})},[y]),w=(0,e.useCallback)(function(A){for(var N=[],V=1;V<arguments.length;V++)N[V-1]=arguments[V];var F=y.current.find(function(B){return B.eventName===A});if(typeof F>"u"){console.warn(i.errorMessages.noEventListener,{eventName:A});return}return F.callback.apply(F,N)},[y]);return(0,e.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:v,removeEventListener:b}};return ay.useEventSystem=p,ay}var Iw={},XJ;function M6e(){if(XJ)return Iw;XJ=1,Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.useNullableState=void 0;var n=xu(),e=function(i){return(0,n.useState)(i||null)};return Iw.useNullableState=e,Iw}var JJ;function U6e(){if(JJ)return fp;JJ=1;var n=fp&&fp.__awaiter||function(y,v,b,w){function A(N){return N instanceof b?N:new b(function(V){V(N)})}return new(b||(b=Promise))(function(N,V){function F(J){try{W(w.next(J))}catch($){V($)}}function B(J){try{W(w.throw(J))}catch($){V($)}}function W(J){J.done?N(J.value):A(J.value).then(F,B)}W((w=w.apply(y,v||[])).next())})},e=fp&&fp.__generator||function(y,v){var b={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},w,A,N,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=F(0),V.throw=F(1),V.return=F(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function F(W){return function(J){return B([W,J])}}function B(W){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,W[0]&&(b=0)),b;)try{if(w=1,A&&(N=W[0]&2?A.return:W[0]?A.throw||((N=A.return)&&N.call(A),0):A.next)&&!(N=N.call(A,W[1])).done)return N;switch(A=0,N&&(W=[W[0]&2,N.value]),W[0]){case 0:case 1:N=W;break;case 4:return b.label++,{value:W[1],done:!1};case 5:b.label++,A=W[1],W=[0];continue;case 7:W=b.ops.pop(),b.trys.pop();continue;default:if(N=b.trys,!(N=N.length>0&&N[N.length-1])&&(W[0]===6||W[0]===2)){b=0;continue}if(W[0]===3&&(!N||W[1]>N[0]&&W[1]<N[3])){b.label=W[1];break}if(W[0]===6&&b.label<N[1]){b.label=N[1],N=W;break}if(N&&b.label<N[2]){b.label=N[2],b.ops.push(W);break}N[2]&&b.ops.pop(),b.trys.pop();continue}W=v.call(y,b)}catch(J){W=[6,J],A=0}finally{w=N=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}};Object.defineProperty(fp,"__esModule",{value:!0}),fp.useUnityContext=void 0;var i=xu(),a=loe(),l=L6e(),d=M6e(),p=function(y){var v=(0,d.useNullableState)(),b=v[0],w=v[1],A=(0,i.useState)(0),N=A[0],V=A[1],F=(0,i.useState)(!1),B=F[0],W=F[1],J=(0,d.useNullableState)(),$=J[0],te=J[1],ce=(0,l.useEventSystem)(),oe=(0,i.useRef)({setLoadingProgression:V,setInitialisationError:te,setUnityInstance:w,setIsLoaded:W,unityConfig:y}),_e=(0,i.useCallback)(function(pe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(pe===!0?1:0)},[b]),ne=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),ee=(0,i.useCallback)(function(pe,ue,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(pe,ue,Me)},[b]),Q=(0,i.useCallback)(function(pe,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(pe,ue)},[b]),se=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),fe=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var pe;return e(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=b.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,se()]);case 1:return ue.sent(),pe.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){W(N===1)},[N]),{unityProvider:oe.current,loadingProgression:N,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:_e,requestPointerLock:ne,sendMessage:ee,takeScreenshot:Q,unload:se,UNSAFE__detachAndUnloadImmediate:fe,addEventListener:ce.addEventListener,removeEventListener:ce.removeEventListener}};return fp.useUnityContext=p,fp}var QJ;function V6e(){return QJ||(QJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=x6e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=U6e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(pU)),pU}var uoe=V6e();const Rd="[UnityProvider]",JV=D.createContext(),F6e=({spaceID:n,children:e,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:y,showDisruptiveLogo:v})=>{he.log(`${Rd} Initializing with spaceID:`,n),he.log(`${Rd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:F,error:B}=uoe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),W={unityProvider:b,loadingProgression:w,isLoaded:A,sendMessage:N,addEventListener:V,removeEventListener:F,error:B,spaceID:n},J=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const _e=()=>{document.hidden?(he.log(`${Rd} Page hidden, starting keep-alive`),te()):(he.log(`${Rd} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",_e),()=>{document.removeEventListener("visibilitychange",_e),ce()}},[]),D.useEffect(()=>{const _e=()=>{$.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",_e),window.addEventListener("keydown",_e),window.addEventListener("touchstart",_e),()=>{window.removeEventListener("mousemove",_e),window.removeEventListener("keydown",_e),window.removeEventListener("touchstart",_e)}},[N]);const te=()=>{J.current||(J.current=setInterval(()=>{A&&document.hidden&&(N("WebGLInputManager","KeepAlive"),he.debug(`${Rd} Sent keep-alive message`))},1e4))},ce=()=>{J.current&&(clearInterval(J.current),J.current=null)};D.useEffect(()=>(he.log(`${Rd} Component mounted`),()=>{he.log(`${Rd} Component unmounting`),ce()}),[]),D.useEffect(()=>{he.log(`${Rd} Loading progress:`,w)},[w]),D.useEffect(()=>{A&&(he.log(`${Rd} Unity instance loaded for:`,n),document.hidden&&te())},[A,n]),D.useEffect(()=>{B&&he.error(`${Rd} Unity error:`,B)},[B]),he.log(`${Rd} Rendering provider with instance:`,W),D.useEffect(()=>{he.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const oe=[];if(i||oe.push("loaderUrl"),a||oe.push("dataUrl"),l||oe.push("frameworkUrl"),d||oe.push("codeUrl"),oe.length>0)return he.error(`UnityProvider: Missing required Unity build URLs: ${oe.join(", ")}`),C.jsx(JV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${oe.join(", ")}`),spaceID:n},children:e});try{return D.useEffect(()=>{he.log("UnityProvider: Unity context created:",b),b?he.log("UnityProvider: Unity provider is available"):he.error("UnityProvider: Unity provider is not available"),A?he.log("UnityProvider: Unity is loaded"):he.log("UnityProvider: Unity is not loaded yet")},[b,A]),C.jsx(JV.Provider,{value:W,children:e})}catch(_e){return he.error("UnityProvider: Error creating Unity context:",_e),C.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[C.jsx("h3",{children:"Unity Error"}),C.jsxs("p",{children:["Error creating Unity context: ",_e.message]}),C.jsx("p",{children:"Please check the console for more details."})]})}},Xa=()=>D.useContext(JV),Hp=()=>{const{sendMessage:n,isLoaded:e}=Xa(),i=D.useRef([]),a=D.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:d,data:p}=i.current.shift();he.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(y){he.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:d,data:p});break}}},[n,e]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,p)=>{he.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:p}),a()},[a])},ff=()=>{const{addEventListener:n,removeEventListener:e}=Xa();return D.useCallback((i,a)=>{const l=d=>{he.log(i+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(y){he.warn("Failed to parse JSON data from Unity message:",y)}a(p)};return n(i,l),()=>{e(i,l)}},[n,e])},j6e=()=>{const[n,e]=D.useState(!1),i=ff();return D.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{he.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},B6e=n=>{const[e,i]=D.useState(null),a=ff(),{spaceID:l}=Xa();return D.useEffect(()=>{let p=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){he.error("Game object name is missing in Unity event data.");return}const A=await Kse(l);he.log("SPACES VIDEOS",A);const N=A.find(V=>V.id===w);N&&p?(i(N.url),he.log("Video URL set to:",N.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{p=!1,v()}},[a,l,n]),[e,()=>{i(null)}]},W6e=()=>{const n=ff(),{sendUserToUnity:e}=D.useContext(Fo);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{he.log("React: Request from Unity to send user data"),e()});return()=>{a()}},[n,e]),!0},z6e=()=>{const{spaceID:n}=Xa(),e=Hp(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{he.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){he.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}he.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Kse(n),p=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),F=["640x360","295x166"];let B=null;for(let W of F){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||N.thumbnail_url},y=d.map(async b=>{const w=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),v=await Promise.all(y);he.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:w})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){he.error("Error fetching thumbnails:",d)}})()},[e,n,i])},G6e=()=>{const[n,e]=D.useState(null),i=ff();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof p=="string"?JSON.parse(p):p;e({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},doe=()=>{const[n,e]=D.useState([]),i=ff();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(he.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=V=>{if(a){he.log("UpdatePlayerList unity message received.");try{let F=[];if(typeof V=="object"&&V!==null?F=V.players||[]:F=JSON.parse(V).players||[],Array.isArray(F)){const B=Array.from(new Map(F.map(W=>[W.playerId,W])).values());e(B),l&&(clearTimeout(l),l=null)}}catch(F){he.error("Error handling player list data:",F),l||(l=setTimeout(d,1e3))}}},y=()=>{he.log("Player disconnected, requesting fresh player list"),d()},v=()=>{he.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",p),w=i("PlayerDisconnected",y),A=i("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof A=="function"&&A(),clearInterval(N)}},[i]),n},hoe=()=>{const[n,e]=D.useState({}),[i,a]=D.useState(!1),[l,d]=D.useState(null),[p,y]=D.useState(0),v=Hp(),b=ff(),{spaceID:w,sendMessage:A,isLoaded:N}=Xa(),V=D.useCallback((J,$)=>{if(!J)return;he.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${$}`);const te={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J};if(v("SetHLSStream",te),N&&A)try{he.log("useHLSStream: Sending with ReactIncomingEvent approach"),A("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(te)})),he.log("useHLSStream: Sending with direct HLSStream approach"),A("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J})),he.log("useHLSStream: Sending with most direct approach possible"),A("LiveProjector","SetStreamUrl",J),A("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:J}))}catch(ce){he.error("useHLSStream: Error with direct message:",ce)}else he.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,A,N]);D.useEffect(()=>{w&&F(w)},[w]);const F=async J=>{try{if(!J){he.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),he.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const $=await qse(J);if($&&$.streamUrl)if(he.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,$),d($),N)he.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{V($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{he.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),V($.streamUrl,$.playerIndex||"0")},2e3);else{he.warn("useHLSStream: Unity is not loaded yet, will try again later");const te=setInterval(()=>{N&&(he.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),V($.streamUrl,$.playerIndex||"0"),clearInterval(te))},1e3);setTimeout(()=>{clearInterval(te)},3e4)}else he.log(`useHLSStream: No saved stream found for space ${J}`),d(null)}catch($){he.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,$)}finally{a(!1)}},B=D.useCallback(async()=>{w&&(he.log(`useHLSStream: Forcing reload of stream data for space ${w}`),y(J=>J+1),await F(w))},[w]),W=D.useCallback(async(J,$=0,te={})=>{try{if(!J||!J.trim()){he.error("useHLSStream: Invalid stream URL");return}a(!0),he.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,J);const{enabled:ce=!0,rtmpUrl:oe="",streamKey:_e="",skipSendToUnity:ne=!1}=te;if(ne||V(J,$),w)try{const ee={streamUrl:J,playerIndex:$.toString(),enabled:ce,rtmpUrl:oe,streamKey:_e,updatedAt:new Date().toISOString()};he.log(`useHLSStream: Saving stream URL to Firebase for space ${w}`,ee),await qV(w,ee),d(ee)}catch(ee){throw he.error(`useHLSStream: Error saving stream URL to Firebase for space ${w}`,ee),ee}else he.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[V,w]);return D.useEffect(()=>{const $=b("SetHLSStream",te=>{if(te)try{he.log("useHLSStream: Received player status update",te);const{identifier:ce,playerIndex:oe,isReady:_e,isPlaying:ne}=te,ee=`${ce}_${oe}`;e(Q=>({...Q,[ee]:{identifier:ce,playerIndex:oe,isReady:_e,isPlaying:ne}}))}catch(ce){he.error("useHLSStream: Error handling player status update",ce)}});return()=>{$()}},[b]),D.useEffect(()=>{if(l&&l.streamUrl){he.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{V(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,V,p]),D.useEffect(()=>{const J=$=>{if($.detail){if(he.log("useHLSStream: Received stream update event",$.detail),w===$.detail.spaceId)he.log(`useHLSStream: Stream update is for our space ${w}, loading stream data`),F(w);else if($.detail.streamUrl){he.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const te=$.detail.playerIndex||"0";V($.detail.streamUrl,te),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[w,V]),{setHLSStreamUrl:W,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:B}},ZJ=async(n,e,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=a;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=Qy(),b=Date.now(),w=i.name.split(".").pop(),A=`${e}_${b}.${w}`,N=Jy(v,`spaces/${n}/mediaScreens/${A}`);he.log(`Uploading image for media screen ${e} in space ${n}`);const V=await V4(N,i);y=await dN(V.ref);const F=Pi(ri,`spaces/${n}/mediaScreens`,e);await r1(F,{imageUrl:y,gsUrl:`gs://${V.ref.bucket}/${V.ref.fullPath}`,fileName:A,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){y=p;const v=Pi(ri,`spaces/${n}/mediaScreens`,e);await r1(v,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return he.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${d})`),y}catch(l){throw he.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},q4=async n=>{he.log(`Getting media screen images for space: ${n}`);try{const e=jy(ri,`spaces/${n}/mediaScreens`),i=await WC(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(e){throw he.error("Error fetching media screen images from Firestore:",e),e}},Cp=async(n,e)=>{try{const i=Pi(ri,`spaces/${n}/mediaScreens`,e),a=await ll(i);return a.exists()?{id:a.id,...a.data()}:(he.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw he.error("Error fetching media screen image:",i),i}},H6e=async(n,e)=>{try{const i=await Cp(n,e);if(!i)return he.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=Qy(),d=Jy(l,i.gsUrl);try{await F4(d),he.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){he.warn(`Could not delete file from storage: ${p.message}`)}}const a=Pi(ri,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await Ec(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),he.log(`Successfully removed video for media screen ${e}`)):(await Ec(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),he.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw he.error("Error deleting media screen image:",i),i}},$6e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Cp(n,e);if(!a||!a.imageUrl&&!a.videoUrl)return he.warn(`No media screen content found with ID: ${e} to update`),!1;const l=Pi(ri,`spaces/${n}/mediaScreens`,e);return await Ec(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),he.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(a){throw he.error("Error updating media screen display mode:",a),a}},K6e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},foe=()=>{const{spaceID:n}=Xa(),e=Hp(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{he.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){he.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}he.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await q4(n);he.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:w}=p;let A=null;(!b||!w)&&(A=v?K6e(v):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:A,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),he.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&w&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),he.log(`Set display mode to video for screen ${y}`))})}catch(d){he.error("Error fetching media screen images:",d)}})()},[e,n,i])},q6e=n=>({opacity:1});function Y6e(){const{loadingProgression:n,isLoaded:e,error:i}=Xa(),{user:a}=D.useContext(Fo),[l,d]=D.useState(!1),[p,y]=D.useState(!1),[v,b]=D.useState(!1),[w,A]=D.useState(!1),N=D.useRef(!1),V=D.useRef(!1),F=D.useRef(null),B=D.useRef(null),W=D.useRef(null),J=ff(),$=D.useRef(null),te=D.useRef(null),ce=D.useRef(null),oe=D.useRef(null);D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const ee=document.createElement("style");return ee.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(ee),$.current=ee,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const ee=()=>{const Q=document.getElementById("unity-canvas"),se=document.getElementById("unity-container");Q&&(F.current=Q,console.log("LoaderProgress: Found Unity canvas"),Q.style.zIndex="1"),se&&(B.current=se,console.log("LoaderProgress: Found Unity container"),se.style.zIndex="1"),Q&&se&&ce.current&&(clearInterval(ce.current),ce.current=null)};return ee(),ce.current=setInterval(ee,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),D.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),V.current=!0,A(!0));const Q=J("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0}),se=setTimeout(()=>{V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Q(),clearTimeout(se)}},[J]),D.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0));const ee=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",ee);const Q=J("PlayerInstantiated",ee),se=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),V.current=!0,A(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",ee),Q(),clearTimeout(se)}},[J]),D.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:v}),w&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),te.current&&clearTimeout(te.current),te.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),W.current&&(W.current.style.opacity="0",W.current.style.pointerEvents="none",setTimeout(()=>{W.current&&(W.current.style.display="none")},1500))},2e3)),()=>{te.current&&clearTimeout(te.current)}),[w,v]),D.useEffect(()=>(oe.current=setInterval(()=>{var ee,Q;console.log("LoaderProgress: Debug interval",{isLoaded:e,isFirstSceneLoaded:V.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(ee=F.current)==null?void 0:ee.style.zIndex,loaderZIndex:(Q=W.current)==null?void 0:Q.style.zIndex})},5e3),()=>{oe.current&&clearInterval(oe.current)}),[e]),D.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:e,isFirstSceneLoaded:w,isPlayerInstantiated:v,loadingProgression:n})},[e,w,v,n]);const _e=()=>e?e&&!w&&!v?"Scene initializing":w&&!v?"Player initializing":"Ready":"World loading",ne=()=>e?e&&!w&&!v?85:w&&!v?95:100:n*80;return C.jsx(C.Fragment,{children:l?C.jsx(mt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:C.jsxs(ti,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[C.jsx(ot,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),C.jsx(ot,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),C.jsx(Br,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>y(!0),children:"Sign In"})]})}):C.jsx(mt,{ref:W,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:C.jsxs(ei,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[C.jsx(ot,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),C.jsx(ot,{fontSize:"sm",children:_e()}),C.jsx(S0,{value:ne(),size:"lg",width:"100%",marginY:2})]})})})}function X6e(){const{user:n}=D.useContext(Fo);return C.jsx("div",{children:n!==null?C.jsx("div",{children:C.jsx(H4,{})}):C.jsxs("div",{children:[C.jsx(mN,{}),C.jsx(gN,{})]})})}function J6e(){const{fullscreenRef:n}=Vd(),[e,i]=D.useState(!1),a=()=>{i(!e)};return C.jsxs(C.Fragment,{children:[C.jsx(kp,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:C.jsx(xo,{"aria-label":"Controller Help",icon:C.jsx(i6e,{}),onClick:a,variant:"iconButton"})}),C.jsxs(Lo,{isOpen:e,onClose:a,size:"md",portalProps:{containerRef:n},children:[C.jsx(Vo,{}),C.jsxs(Mo,{children:[C.jsx(yc,{children:"Notes"}),C.jsx(ma,{}),C.jsx(Uo,{children:C.jsx(ot,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),C.jsx(Tg,{children:C.jsx(Br,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var poe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},eQ=ui.createContext&&ui.createContext(poe),Eg=function(){return Eg=Object.assign||function(n){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Eg.apply(this,arguments)},Q6e=function(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function moe(n){return n&&n.map(function(e,i){return ui.createElement(e.tag,Eg({key:i},e.attr),moe(e.child))})}function Rr(n){return function(e){return ui.createElement(Z6e,Eg({attr:Eg({},n.attr)},e),moe(n.child))}}function Z6e(n){var e=function(i){var a=n.attr,l=n.size,d=n.title,p=Q6e(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),ui.createElement("svg",Eg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,p,{className:v,style:Eg(Eg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),d&&ui.createElement("title",null,d),n.children)};return eQ!==void 0?ui.createElement(eQ.Consumer,null,function(i){return e(i)}):e(poe)}function goe(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function eWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function tQ(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function nQ(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function QV(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function tWe(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function nWe(n){return Rr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function rWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function _oe(n){return Rr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function iWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function sWe(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function ZV(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function eF(n){return Rr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function oWe(n){return Rr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function aWe(n){return Rr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function cWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function tF(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function lWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function uWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function dWe(n){return Rr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function hWe(n){return Rr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function fWe(n){return Rr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function yoe({open:n,onClose:e}){const i=D.useRef(null),a=Hp(),{user:l}=D.useContext(Fo),d=v=>{i.current&&!i.current.contains(v.target)&&e()},p=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Pse(l.uid,w),e()}catch(A){console.error("Error updating RPM URL:",A)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&C.jsx(zl,{children:C.jsx(mt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:C.jsx(mt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:C.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function pWe({isOpen:n,onClose:e}){const[i,a]=D.useState(!1),[l,d]=D.useState(null),{user:p}=D.useContext(Fo),y=Hp(),v=F=>{F.stopPropagation(),a(!0)},b=()=>{a(!1),e()},w=async F=>{if(d(F),p&&p.uid)try{await Pse(p.uid,F.url),y("AvatarUrlFromReact",{url:F.url}),e()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},A=tIe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",V=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return C.jsxs(C.Fragment,{children:[C.jsx(zl,{children:C.jsxs(Lo,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[C.jsx(Vo,{bg:"rgba(0, 0, 0, 0.7)"}),C.jsxs(Mo,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(yc,{fontSize:"lg",children:"Customise Your Avatar"}),C.jsx(ma,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),C.jsx(Uo,{pb:4,children:C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsx(ot,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),C.jsxs(sne,{columns:5,spacing:2,children:[C.jsx(mt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:A,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:C.jsxs(ti,{spacing:1,children:[C.jsx(xn,{as:aWe,boxSize:4}),C.jsx(ot,{fontSize:"xs",children:"Create Custom Avatar"})]})}),V.map(F=>C.jsxs(mt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===F.id?"blue.400":A,borderRadius:"lg",overflow:"hidden",onClick:()=>w(F),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[C.jsx(Hh,{src:F.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:F.name,width:"100%",height:"100%",objectFit:"cover"}),C.jsx(mt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:C.jsx(ot,{fontSize:"xs",children:F.name})})]},F.id))]})]})})]})]})}),i&&C.jsx(yoe,{open:i,onClose:b})]})}function mWe(){const{fullscreenRef:n}=Vd(),[e,i]=D.useState(!1),[a,l]=D.useState(!1),[d,p]=D.useState(!1),[y,v]=D.useState(!1),{user:b}=D.useContext(Fo),[w,A]=D.useState(null),[N,V]=D.useState(!0),F=($,te)=>!$||!te?"?":`${$.charAt(0)}${te.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){V(!0);try{const $=await Ud(b.uid);A({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{V(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>l(!a),J=()=>{l(!1),B()};return e?C.jsxs(C.Fragment,{children:[C.jsx(kp,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:C.jsxs(mt,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:"pointer",onClick:W,children:[C.jsx(jl,{src:N||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?F(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&C.jsx(mt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:C.jsx(ot,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),C.jsx(pWe,{isOpen:a,onClose:J})]}):null}function gWe(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function _We(n){return Rr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function yWe(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:a}=Vd(),l=Gl();D.useEffect(()=>{const p=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return C.jsx(kp,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:C.jsx(xo,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?C.jsx(gWe,{}):C.jsx(_We,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const rQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function EWe(){const{isOpen:n,onOpen:e,onClose:i}=of(),{fullscreenRef:a}=Vd(),[l,d]=B6e(!1);D.useEffect(()=>{he.log("VideoPlayer: Current video URL:",l),l&&(he.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const p=()=>{he.log("VideoPlayer: Closing modal"),d(),i()};return C.jsx(zl,{containerRef:a,children:C.jsxs(Lo,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[C.jsx(Vo,{bg:"rgba(0, 0, 0, 0.8)"}),C.jsxs(Mo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[C.jsx(ma,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Uo,{p:0,width:"100%",children:l&&C.jsx(mt,{style:rQ.iframeContainer,children:C.jsx("iframe",{src:l,style:rQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function vWe({isOpen:n,onClose:e,playerName:i,playerId:a,uid:l}){const[d,p]=D.useState(null),[y,v]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(v(!0),w(null),!l){he.warn("NameplateModal: No UID provided for player:",i),w("No user ID available for this player"),v(!1);return}try{he.log("NameplateModal: Fetching profile for UID:",l);const N=await Ud(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(N){he.error("Error fetching profile data:",N),w("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),C.jsxs(Lo,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[C.jsx(Vo,{backdropFilter:"blur(10px)"}),C.jsxs(Mo,{bg:"gray.900",color:"white",borderRadius:"xl",children:[C.jsx(yc,{children:"Player Info"}),C.jsx(ma,{}),C.jsx(Uo,{pb:6,children:y?C.jsx(bte,{py:8,children:C.jsx(uf,{size:"xl",color:"blue.400"})}):b?C.jsxs(Ep,{status:"warning",variant:"solid",borderRadius:"md",children:[C.jsx(vp,{}),b]}):C.jsxs(ti,{spacing:4,align:"center",children:[C.jsx(jl,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsxs(ti,{spacing:1,children:[C.jsx(ot,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&C.jsxs(ot,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),C.jsxs(ot,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&C.jsxs(C.Fragment,{children:[C.jsx(Qh,{borderColor:"whiteAlpha.300"}),C.jsxs(vi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&C.jsx(ku,{href:d.linkedinUrl,isExternal:!0,children:C.jsx(xo,{icon:C.jsx(goe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&C.jsx(ku,{href:d.websiteUrl,isExternal:!0,children:C.jsx(xo,{icon:C.jsx(_oe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const SWe=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[a]=MDe("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const Re=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Re);d(Ne),Ne&&he.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const p=a||l,y=doe(),[v,b]=D.useState(!1),[w,A]=D.useState([]),[N,V]=D.useState(!1),[F,B]=D.useState({}),[W,J]=D.useState({}),[$,te]=D.useState(null),[ce,oe]=D.useState(!1),_e=Gl(),ne=window.currentUser||{},Q=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const Re=(window.location.pathname||"").split("/"),ve=Re[Re.length-1];if(ve&&ve.length>5)return ve;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const ve=await yg(Q);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),oe(!0)):oe(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const Re=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),oe(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Re),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Re)}},[Q]),D.useEffect(()=>{const we={};y.forEach(Re=>{if(Re.uid){if(Re.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Re.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Ne=ve.find(Te=>String(Te.uid)===String(Re.uid));if(Ne)we[Re.uid]=Ne.uid;else{const Te=ve.find(be=>typeof be.uid=="string"&&be.uid.includes(Re.uid));if(Te)we[Re.uid]=Te.uid;else{const be=ve.find(Ae=>typeof Re.uid=="string"&&Re.uid.includes(String(Ae.uid)));if(be)we[Re.uid]=be.uid;else{const Ae=ve.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Re.isLocalPlayer&&(we[Re.uid]=Ae[0].uid)}}}}}}),J(we)},[y]);const se=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&V(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Re={};we.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(Re[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(Re)!==JSON.stringify(F)&&B(Re)}};D.useEffect(()=>{const we=setInterval(se,500),Re=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&V(ve.detail.enabled)};return window.addEventListener("VoiceToggled",Re),se(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Re)}},[]),D.useEffect(()=>{const we=()=>{he.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(he.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),D.useEffect(()=>{(async()=>{const Re=await Promise.all(y.map(async ve=>{if(ve.uid)try{const Ne=await Ud(ve.uid);let Te=null;if(Ne.groups){const be=`space_${Q}_owners`,Ae=`space_${Q}_hosts`;Ne.groups.includes(be)?Te="owner":Ne.groups.includes(Ae)&&(Te="host")}return ue({uid:ve.uid})&&te(Te),{...ve,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(Ne){return he.error(`Error fetching data for player ${ve.playerName}:`,Ne),ve}return ve}));A(Re)})()},[y,Q]);const fe=[...w].sort((we,Re)=>we.isLocalPlayer?-1:Re.isLocalPlayer?1:0),pe=()=>{he.log("UnityPlayerList: Toggling visibility"),e&&e()},ue=we=>!!(we.isLocalPlayer||ne&&ne.uid&&we.uid===ne.uid),Me=we=>{try{if(ue(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(F[we.uid])return!0;const Re=W[we.uid];if(Re&&F[Re])return!0;const ve=parseInt(we.uid);if(!isNaN(ve)&&F[ve])return!0}return!1}catch(Re){return console.error("Error in hasActiveMic:",Re),!1}},He=({player:we})=>{const Re=we.role;return Re==="owner"?C.jsxs(vi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[C.jsx(xn,{as:QV,color:"green.400",boxSize:5}),C.jsx(Sp,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Re==="host"?C.jsxs(vi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[C.jsx(xn,{as:tF,color:"purple.400",boxSize:5}),C.jsx(Sp,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},nt=(we,Re)=>{switch(console.log(`Action "${we}" performed on player: ${Re.playerName}`),we){case"mute":_e({title:"Player Muted",description:`${Re.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":_e({title:"Player Kicked",description:`${Re.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":_e({title:"Player Promoted",description:`${Re.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return C.jsxs(mt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!p?"visible":"hidden",role:"group",children:[C.jsx(mt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:C.jsx(xo,{icon:C.jsx(r6e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:pe,_hover:{opacity:.8}})}),C.jsxs(ot,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),C.jsx(mt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:C.jsx(ti,{align:"stretch",spacing:1,width:"100%",children:fe.map((we,Re)=>{const ve=ue(we),Ne=!ce&&Me(we);return C.jsx(mt,{children:C.jsxs(Nne,{placement:"left",trigger:"hover",children:[C.jsx(Une,{children:C.jsxs(vi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[C.jsx(jl,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsx(ot,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&C.jsx(xn,{as:QV,color:"green.400",boxSize:2.5}),we.role==="host"&&C.jsx(xn,{as:tF,color:"purple.400",boxSize:2.5}),C.jsx(Lk,{}),$==="owner"&&C.jsxs(sR,{closeOnSelect:!0,placement:"bottom-end",children:[C.jsx(oR,{as:xo,"aria-label":"Options",icon:C.jsx(nWe,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),C.jsxs(aR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[C.jsx(Pd,{icon:C.jsx(hWe,{}),onClick:()=>nt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ce,children:"Mute Player"}),C.jsx(Pd,{icon:C.jsx(lWe,{}),onClick:()=>nt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),C.jsx(yne,{borderColor:"whiteAlpha.300"}),C.jsx(Pd,{icon:C.jsx(eWe,{}),onClick:()=>nt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ce&&(Ne?C.jsx(mt,{color:"green.400",children:C.jsx(eF,{})}):C.jsx(mt,{color:"red.400",children:C.jsx(ZV,{})})),ve&&C.jsx(ot,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),C.jsx(Mne,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:C.jsx(xne,{children:C.jsxs(ti,{align:"center",spacing:3,children:[C.jsx(jl,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),C.jsx(ot,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),C.jsx(He,{player:we}),we.firstName&&C.jsxs(ot,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),C.jsxs(vi,{spacing:4,pt:2,children:[we.linkedInProfile&&C.jsx(ku,{href:we.linkedInProfile,isExternal:!0,children:C.jsx(xo,{icon:C.jsx(goe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&C.jsx(ku,{href:we.websiteUrl,isExternal:!0,children:C.jsx(xo,{icon:C.jsx(_oe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ce&&C.jsx(xo,{icon:Ne?C.jsx(eF,{}):C.jsx(ZV,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ce&&C.jsx(xo,{icon:C.jsx(dWe,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Re)})})})]})};var Ek={exports:{}},bWe=Ek.exports,iQ;function TWe(){return iQ||(iQ=1,function(n,e){(function(i,a){n.exports=a()})(bWe,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in t)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(t)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof my<"u"?my:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=function(t){try{return!!t()}catch{return!0}},p=!d(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=p,v=Function.prototype,b=v.call,w=y&&v.bind.bind(b,b),A=y?w:function(t){return function(){return b.apply(t,arguments)}},N=A({}.isPrototypeOf),V=function(t){return t&&t.Math==Math&&t},F=V(typeof globalThis=="object"&&globalThis)||V(typeof window=="object"&&window)||V(typeof self=="object"&&self)||V(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),B=p,W=Function.prototype,J=W.apply,$=W.call,te=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(J):function(){return $.apply(J,arguments)}),ce=A,oe=ce({}.toString),_e=ce("".slice),ne=function(t){return _e(oe(t),8,-1)},ee=ne,Q=A,se=function(t){if(ee(t)==="Function")return Q(t)},fe=typeof document=="object"&&document.all,pe={all:fe,IS_HTMLDDA:fe===void 0&&fe!==void 0},ue=pe.all,Me=pe.IS_HTMLDDA?function(t){return typeof t=="function"||t===ue}:function(t){return typeof t=="function"},He={},nt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=p,Re=Function.prototype.call,ve=we?Re.bind(Re):function(){return Re.apply(Re,arguments)},Ne={},Te={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ae=be&&!Te.call({1:2},1);Ne.f=Ae?function(t){var r=be(this,t);return!!r&&r.enumerable}:Te;var Ue,Ge,Qe=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},tt=d,ht=ne,Ze=Object,Ct=A("".split),un=tt(function(){return!Ze("z").propertyIsEnumerable(0)})?function(t){return ht(t)=="String"?Ct(t,""):Ze(t)}:Ze,Lt=function(t){return t==null},nn=Lt,kn=TypeError,Kt=function(t){if(nn(t))throw kn("Can't call method on "+t);return t},zn=un,Bt=Kt,Ce=function(t){return zn(Bt(t))},Fe=Me,We=pe.all,at=pe.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Fe(t)||t===We}:function(t){return typeof t=="object"?t!==null:Fe(t)},vt={},St=vt,Gt=F,fn=Me,Ln=function(t){return fn(t)?t:void 0},cn=function(t,r){return arguments.length<2?Ln(St[t])||Ln(Gt[t]):St[t]&&St[t][r]||Gt[t]&&Gt[t][r]},dr=typeof navigator<"u"&&String(navigator.userAgent)||"",_a=F,Vt=dr,on=_a.process,Wi=_a.Deno,gs=on&&on.versions||Wi&&Wi.version,Ms=gs&&gs.v8;Ms&&(Ge=(Ue=Ms.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!Ge&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(Ge=+Ue[1]);var ii=Ge,Pt=ii,wn=d,ir=F.String,xi=!!Object.getOwnPropertySymbols&&!wn(function(){var t=Symbol();return!ir(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Pt&&Pt<41}),Sc=xi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",as=cn,ya=Me,Eo=N,Ea=Object,va=Sc?function(t){return typeof t=="symbol"}:function(t){var r=as("Symbol");return ya(r)&&Eo(r.prototype,Ea(t))},ro=String,_s=function(t){try{return ro(t)}catch{return"Object"}},cs=Me,jo=_s,zi=TypeError,ys=function(t){if(cs(t))return t;throw zi(jo(t)+" is not a function")},Ja=ys,Uu=Lt,bc=function(t,r){var s=t[r];return Uu(s)?void 0:Ja(s)},Sa=ve,ba=Me,jd=at,Vg=TypeError,Vu={exports:{}},pf=F,qs=Object.defineProperty,Fu=function(t,r){try{qs(pf,t,{value:r,configurable:!0,writable:!0})}catch{pf[t]=r}return r},Ta="__core-js_shared__",Bd=F[Ta]||Fu(Ta,{}),Wd=Bd;(Vu.exports=function(t,r){return Wd[t]||(Wd[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qa=Vu.exports,zd=Kt,ju=Object,Bo=function(t){return ju(zd(t))},Gd=Bo,Wr=A({}.hasOwnProperty),Si=Object.hasOwn||function(t,r){return Wr(Gd(t),r)},Tc=A,ul=0,wa=Math.random(),mf=Tc(1 .toString),Hd=function(t){return"Symbol("+(t===void 0?"":t)+")_"+mf(++ul+wa,36)},Hl=Qa,vo=Si,$p=Hd,io=xi,gf=Sc,dl=F.Symbol,$d=Hl("wks"),Kd=gf?dl.for||dl:dl&&dl.withoutSetter||$p,pr=function(t){return vo($d,t)||($d[t]=io&&vo(dl,t)?dl[t]:Kd("Symbol."+t)),$d[t]},$l=ve,Kl=at,Bu=va,Za=bc,Wo=function(t,r){var s,o;if(ba(s=t.toString)&&!jd(o=Sa(s,t))||ba(s=t.valueOf)&&!jd(o=Sa(s,t)))return o;throw Vg("Can't convert object to primitive value")},Wu=TypeError,hl=pr("toPrimitive"),ql=function(t,r){if(!Kl(t)||Bu(t))return t;var s,o=Za(t,hl);if(o){if(s=$l(o,t,r),!Kl(s)||Bu(s))return s;throw Wu("Can't convert object to primitive value")}return Wo(t)},Kr=va,ec=function(t){var r=ql(t,"string");return Kr(r)?r:r+""},sr=at,wc=F.document,Kp=sr(wc)&&sr(wc.createElement),Yl=function(t){return Kp?wc.createElement(t):{}},qd=Yl,_f=!nt&&!d(function(){return Object.defineProperty(qd("div"),"a",{get:function(){return 7}}).a!=7}),qp=nt,yf=ve,zo=Ne,ls=Qe,Go=Ce,Ho=ec,Xl=Si,$o=_f,Ko=Object.getOwnPropertyDescriptor;He.f=qp?Ko:function(t,r){if(t=Go(t),r=Ho(r),$o)try{return Ko(t,r)}catch{}if(Xl(t,r))return ls(!yf(zo.f,t,r),t[r])};var Yp=d,Cc=Me,Es=/#|\.prototype\./,zu=function(t,r){var s=fl[Ef(t)];return s==Xp||s!=Jl&&(Cc(r)?Yp(r):!!r)},Ef=zu.normalize=function(t){return String(t).replace(Es,".").toLowerCase()},fl=zu.data={},Jl=zu.NATIVE="N",Xp=zu.POLYFILL="P",Ca=zu,Ra=ys,pl=p,Se=se(se.bind),De=function(t,r){return Ra(t),r===void 0?t:pl?Se(t,r):function(){return t.apply(r,arguments)}},et={},Xt=nt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),qn=at,vr=String,zr=TypeError,ln=function(t){if(qn(t))return t;throw zr(vr(t)+" is not an object")},Lr=nt,bi=_f,Us=Xt,qo=ln,Yo=ec,Gu=TypeError,es=Object.defineProperty,ml=Object.getOwnPropertyDescriptor,Yd="enumerable",Rc="configurable",Fg="writable";et.f=Lr?Us?function(t,r,s){if(qo(t),r=Yo(r),qo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Fg in s&&!s[Fg]){var o=ml(t,r);o&&o[Fg]&&(t[r]=s.value,s={configurable:Rc in s?s[Rc]:o[Rc],enumerable:Yd in s?s[Yd]:o[Yd],writable:!1})}return es(t,r,s)}:es:function(t,r,s){if(qo(t),r=Yo(r),qo(s),bi)try{return es(t,r,s)}catch{}if("get"in s||"set"in s)throw Gu("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var Jp=et,Hu=Qe,Xo=nt?function(t,r,s){return Jp.f(t,r,Hu(1,s))}:function(t,r,s){return t[r]=s,t},Ql=F,Qp=te,jg=se,Zy=Me,Zp=He.f,em=Ca,$u=vt,Ku=De,qu=Xo,Bg=Si,eE=function(t){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,o)}return new t(s,o,c)}return Qp(t,this,arguments)};return r.prototype=t.prototype,r},Vn=function(t,r){var s,o,c,u,h,m,_,E,S,R=t.target,P=t.global,k=t.stat,G=t.proto,U=P?Ql:k?Ql[R]:(Ql[R]||{}).prototype,j=P?$u:$u[R]||qu($u,R,{})[R],q=j.prototype;for(u in r)o=!(s=em(P?u:R+(k?".":"#")+u,t.forced))&&U&&Bg(U,u),m=j[u],o&&(_=t.dontCallGetSet?(S=Zp(U,u))&&S.value:U[u]),h=o&&_?_:r[u],o&&typeof m==typeof h||(E=t.bind&&o?Ku(h,Ql):t.wrap&&o?eE(h):G&&Zy(h)?jg(h):h,(t.sham||h&&h.sham||m&&m.sham)&&qu(E,"sham",!0),qu(j,u,E),G&&(Bg($u,c=R+"Prototype")||qu($u,c,{}),qu($u[c],u,h),t.real&&q&&(s||!q[u])&&qu(q,u,h)))},tm=Math.ceil,Jo=Math.floor,tE=Math.trunc||function(t){var r=+t;return(r>0?Jo:tm)(r)},nE=tE,Ic=function(t){var r=+t;return r!=r||r===0?0:nE(r)},I=Ic,z=Math.max,Z=Math.min,me=function(t,r){var s=I(t);return s<0?z(s+r,0):Z(s,r)},Ke=Ic,ct=Math.min,Mt=function(t){return t>0?ct(Ke(t),9007199254740991):0},qr=Mt,hi=function(t){return qr(t.length)},Sr=Ce,Ys=me,vs=hi,tc=function(t){return function(r,s,o){var c,u=Sr(r),h=vs(u),m=Ys(o,h);if(t&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((t||m in u)&&u[m]===s)return t||m||0;return!t&&-1}},Qo={includes:tc(!0),indexOf:tc(!1)},vf=Qo.includes;Vn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(t){return vf(this,t,arguments.length>1?arguments[1]:void 0)}});var nm=vt,nc=function(t){return nm[t+"Prototype"]},TR=nc("Array").includes,wR=at,rm=ne,yN=pr("match"),CR=function(t){var r;return wR(t)&&((r=t[yN])!==void 0?!!r:rm(t)=="RegExp")},EN=CR,RR=TypeError,K0={};K0[pr("toStringTag")]="z";var Sf=String(K0)==="[object z]",Wg=Sf,vN=Me,bf=ne,SN=pr("toStringTag"),IR=Object,q0=bf(function(){return arguments}())=="Arguments",Ac=Wg?bf:function(t){var r,s,o;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=IR(t),SN))=="string"?s:q0?bf(r):(o=bf(r))=="Object"&&vN(r.callee)?"Arguments":o},AR=Ac,PR=String,Ia=function(t){if(AR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return PR(t)},bN=pr("match"),TN=Vn,wN=function(t){if(EN(t))throw RR("The method doesn't accept regular expressions");return t},CN=Kt,OR=Ia,gl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[bN]=!1,"/./"[t](r)}catch{}}return!1},zg=A("".indexOf);TN({target:"String",proto:!0,forced:!gl("includes")},{includes:function(t){return!!~zg(OR(CN(this)),OR(wN(t)),arguments.length>1?arguments[1]:void 0)}});var kR=nc("String").includes,Y0=N,NR=TR,DR=kR,Gg=Array.prototype,X0=String.prototype,RN=function(t){var r=t.includes;return t===Gg||Y0(Gg,t)&&r===Gg.includes?NR:typeof t=="string"||t===X0||Y0(X0,t)&&r===X0.includes?DR:r},st=l(RN),J0=ys,Hg=Bo,Q0=un,xR=hi,rE=TypeError,im=function(t){return function(r,s,o,c){J0(s);var u=Hg(r),h=Q0(u),m=xR(u),_=t?m-1:0,E=t?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=E;break}if(_+=E,t?_<0:m<=_)throw rE("Reduce of empty array with no initial value")}for(;t?_>=0:m>_;_+=E)_ in h&&(c=s(c,h[_],_,u));return c}},Z0={left:im(!1)},LR=d,Tf=function(t,r){var s=[][t];return!!s&&LR(function(){s.call(null,r||function(){return 1},1)})},wf=typeof process<"u"&&ne(process)=="process",MR=Z0.left;Vn({target:"Array",proto:!0,forced:!wf&&ii>79&&ii<83||!Tf("reduce")},{reduce:function(t){var r=arguments.length;return MR(this,t,r,r>1?arguments[1]:void 0)}});var UR=nc("Array").reduce,VR=N,FR=UR,iE=Array.prototype,Xd=function(t){var r=t.reduce;return t===iE||VR(iE,t)&&r===iE.reduce?FR:r},sE=Xd,rc=l(sE),IN=ne,$g=Array.isArray||function(t){return IN(t)=="Array"},Kg=Vn,AN=$g,jR=A([].reverse),eb=[1,2];Kg({target:"Array",proto:!0,forced:String(eb)===String(eb.reverse())},{reverse:function(){return AN(this)&&(this.length=this.length),jR(this)}});var Oi=nc("Array").reverse,tb=N,oE=Oi,Cf=Array.prototype,BR=function(t){var r=t.reverse;return t===Cf||tb(Cf,t)&&r===Cf.reverse?oE:r},aE=BR,sm=l(aE),cE=Hd,Rf=Qa("keys"),qg=function(t){return Rf[t]||(Rf[t]=cE(t))},PN=!d(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),ON=Si,WR=Me,lE=Bo,uE=PN,dE=qg("IE_PROTO"),Yg=Object,nb=Yg.prototype,Xg=uE?Yg.getPrototypeOf:function(t){var r=lE(t);if(ON(r,dE))return r[dE];var s=r.constructor;return WR(s)&&r instanceof s?s.prototype:r instanceof Yg?nb:null},kN=A,zR=ys,NN=Me,DN=String,rb=TypeError,Jd=function(t,r,s){try{return kN(zR(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},GR=ln,om=function(t){if(typeof t=="object"||NN(t))return t;throw rb("Can't set "+DN(t)+" as a prototype")},Zl=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=Jd(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return GR(o),om(c),r?t(o,c):o.__proto__=c,o}}():void 0),Qd={},Pc={},Jg=Si,xN=Ce,LN=Qo.indexOf,If=Pc,am=A([].push),Af=function(t,r){var s,o=xN(t),c=0,u=[];for(s in o)!Jg(If,s)&&Jg(o,s)&&am(u,s);for(;r.length>c;)Jg(o,s=r[c++])&&(~LN(u,s)||am(u,s));return u},cm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ib=Af,lm=cm.concat("length","prototype");Qd.f=Object.getOwnPropertyNames||function(t){return ib(t,lm)};var Oc={};Oc.f=Object.getOwnPropertySymbols;var ki=cn,Ti=Qd,Zd=Oc,So=ln,Aa=A([].concat),Pf=ki("Reflect","ownKeys")||function(t){var r=Ti.f(So(t)),s=Zd.f;return s?Aa(r,s(t)):r},Of=Si,Pa=Pf,hE=He,HR=et,fE={},pE=Af,$R=cm,kc=Object.keys||function(t){return pE(t,$R)},mE=nt,sb=Xt,KR=et,MN=ln,eh=Ce,um=kc;fE.f=mE&&!sb?Object.defineProperties:function(t,r){MN(t);for(var s,o=eh(r),c=um(r),u=c.length,h=0;u>h;)KR.f(t,s=c[h++],o[s]);return t};var Yu,Qg=cn("document","documentElement"),gE=ln,Nc=fE,ic=cm,kf=Pc,Xu=Qg,Ju=Yl,Qu="prototype",_E="script",yE=qg("IE_PROTO"),Zg=function(){},Oa=function(t){return"<"+_E+">"+t+"</"+_E+">"},ka=function(t){t.write(Oa("")),t.close();var r=t.parentWindow.Object;return t=null,r},fi=function(){try{Yu=new ActiveXObject("htmlfile")}catch{}var t,r,s;fi=typeof document<"u"?document.domain&&Yu?ka(Yu):(r=Ju("iframe"),s="java"+_E+":",r.style.display="none",Xu.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(Oa("document.F=Object")),t.close(),t.F):ka(Yu);for(var o=ic.length;o--;)delete fi[Qu][ic[o]];return fi()};kf[yE]=!0;var Zo=Object.create||function(t,r){var s;return t!==null?(Zg[Qu]=gE(t),s=new Zg,Zg[Qu]=null,s[yE]=t):s=fi(),r===void 0?s:Nc.f(s,r)},qR=at,YR=Xo,EE=Error,ob=A("".replace),XR=String(EE("zxcasd").stack),e_=/\n\s*at [^:]*:[^\n]*/,JR=e_.test(XR),dm=Qe,ab=!d(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",dm(1,7)),t.stack!==7)}),UN=Xo,t_=function(t,r){if(JR&&typeof t=="string"&&!EE.prepareStackTrace)for(;r--;)t=ob(t,e_,"");return t},vE=ab,cb=Error.captureStackTrace,th={},hm=th,QR=pr("iterator"),SE=Array.prototype,n_=function(t){return t!==void 0&&(hm.Array===t||SE[QR]===t)},fm=Ac,bE=bc,lb=Lt,ub=th,db=pr("iterator"),Zu=function(t){if(!lb(t))return bE(t,db)||bE(t,"@@iterator")||ub[fm(t)]},Dc=ve,Nf=ys,hb=ln,ZR=_s,ed=Zu,nh=TypeError,r_=function(t,r){var s=arguments.length<2?ed(t):r;if(Nf(s))return hb(Dc(s,t));throw nh(ZR(t)+" is not iterable")},eI=ve,eu=ln,rh=bc,i_=function(t,r,s){var o,c;eu(t);try{if(!(o=rh(t,"return"))){if(r==="throw")throw s;return s}o=eI(o,t)}catch(u){c=!0,o=u}if(r==="throw")throw s;if(c)throw o;return eu(o),s},tI=De,TE=ve,nI=ln,s_=_s,tu=n_,o_=hi,pm=N,Df=r_,fb=Zu,xf=i_,rI=TypeError,mm=function(t,r){this.stopped=t,this.result=r},Li=mm.prototype,ih=function(t,r,s){var o,c,u,h,m,_,E,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),k=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),U=tI(r,S),j=function(Y){return o&&xf(o,"normal",Y),new mm(!0,Y)},q=function(Y){return R?(nI(Y),G?U(Y[0],Y[1],j):U(Y[0],Y[1])):G?U(Y,j):U(Y)};if(P)o=t.iterator;else if(k)o=t;else{if(!(c=fb(t)))throw rI(s_(t)+" is not iterable");if(tu(c)){for(u=0,h=o_(t);h>u;u++)if((m=q(t[u]))&&pm(Li,m))return m;return new mm(!1)}o=Df(t,c)}for(_=P?t.next:o.next;!(E=TE(_,o)).done;){try{m=q(E.value)}catch(Y){xf(o,"throw",Y)}if(typeof m=="object"&&m&&pm(Li,m))return m}return new mm(!1)},pb=Ia,mb=Vn,wE=N,gb=Xg,nu=Zl,Gi=function(t,r,s){for(var o=Pa(r),c=HR.f,u=hE.f,h=0;h<o.length;h++){var m=o[h];Of(t,m)||s&&Of(s,m)||c(t,m,u(r,m))}},Ss=Zo,bs=Xo,gm=Qe,a_=function(t,r){qR(r)&&"cause"in r&&YR(t,"cause",r.cause)},c_=function(t,r,s,o){vE&&(cb?cb(t,r):UN(t,"stack",t_(s,o)))},VN=ih,bo=function(t,r){return t===void 0?arguments.length<2?"":r:pb(t)},_b=pr("toStringTag"),_m=Error,yb=[].push,ea=function(t,r){var s,o=wE(Na,this);nu?s=nu(_m(),o?gb(this):Na):(s=o?this:Ss(Na),bs(s,_b,"Error")),r!==void 0&&bs(s,"message",bo(r)),c_(s,ea,s.stack,1),arguments.length>2&&a_(s,arguments[2]);var c=[];return VN(t,yb,{that:c}),bs(s,"errors",c),s};nu?nu(ea,_m):Gi(ea,_m,{name:!0});var Na=ea.prototype=Ss(_m.prototype,{constructor:gm(1,ea),message:gm(1,""),name:gm(1,"AggregateError")});mb({global:!0},{AggregateError:ea});var sh,Lf,ym,iI=Me,Eb=F.WeakMap,sI=iI(Eb)&&/native code/.test(String(Eb)),vb=F,oI=at,aI=Xo,CE=Si,RE=Bd,l_=qg,cI=Pc,u_="Object already initialized",Em=vb.TypeError,lI=vb.WeakMap;if(sI||RE.state){var xc=RE.state||(RE.state=new lI);xc.get=xc.get,xc.has=xc.has,xc.set=xc.set,sh=function(t,r){if(xc.has(t))throw Em(u_);return r.facade=t,xc.set(t,r),r},Lf=function(t){return xc.get(t)||{}},ym=function(t){return xc.has(t)}}else{var Mf=l_("state");cI[Mf]=!0,sh=function(t,r){if(CE(t,Mf))throw Em(u_);return r.facade=t,aI(t,Mf,r),r},Lf=function(t){return CE(t,Mf)?t[Mf]:{}},ym=function(t){return CE(t,Mf)}}var oh,Sb,bb,td={set:sh,get:Lf,has:ym,enforce:function(t){return ym(t)?Lf(t):sh(t,{})},getterFor:function(t){return function(r){var s;if(!oI(r)||(s=Lf(r)).type!==t)throw Em("Incompatible receiver, "+t+" required");return s}}},IE=nt,uI=Si,Tb=Function.prototype,FN=IE&&Object.getOwnPropertyDescriptor,wb=uI(Tb,"name"),dI={PROPER:wb&&(function(){}).name==="something",CONFIGURABLE:wb&&(!IE||IE&&FN(Tb,"name").configurable)},jN=Xo,nd=function(t,r,s,o){return o&&o.enumerable?t[r]=s:jN(t,r,s),t},hI=d,fI=Me,AE=at,BN=Zo,pI=Xg,WN=nd,sc=pr("iterator"),PE=!1;[].keys&&("next"in(bb=[].keys())?(Sb=pI(pI(bb)))!==Object.prototype&&(oh=Sb):PE=!0);var OE=!AE(oh)||hI(function(){var t={};return oh[sc].call(t)!==t});fI((oh=OE?{}:BN(oh))[sc])||WN(oh,sc,function(){return this});var Cb={IteratorPrototype:oh,BUGGY_SAFARI_ITERATORS:PE},mI=Ac,gI=Sf?{}.toString:function(){return"[object "+mI(this)+"]"},Rb=Sf,vm=et.f,Ib=Xo,Ab=Si,zN=gI,Pb=pr("toStringTag"),rd=function(t,r,s,o){if(t){var c=s?t:t.prototype;Ab(c,Pb)||vm(c,Pb,{configurable:!0,value:r}),o&&!Rb&&Ib(c,"toString",zN)}},_I=Cb.IteratorPrototype,yI=Zo,EI=Qe,GN=rd,Da=th,ta=function(){return this},kE=function(t,r,s,o){var c=r+" Iterator";return t.prototype=yI(_I,{next:EI(+!o,s)}),GN(t,c,!1,!0),Da[c]=ta,t},vI=Vn,SI=ve,bI=dI,TI=kE,Ob=Xg,wI=rd,NE=nd,kb=th,CI=Cb,Nb=bI.PROPER,Sm=CI.BUGGY_SAFARI_ITERATORS,DE=pr("iterator"),xE="keys",Uf="values",RI="entries",II=function(){return this},LE=function(t,r,s,o,c,u,h){TI(s,r,o);var m,_,E,S=function(q){if(q===c&&U)return U;if(!Sm&&q in k)return k[q];switch(q){case xE:case Uf:case RI:return function(){return new s(this,q)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,k=t.prototype,G=k[DE]||k["@@iterator"]||c&&k[c],U=!Sm&&G||S(c),j=r=="Array"&&k.entries||G;if(j&&(m=Ob(j.call(new t)))!==Object.prototype&&m.next&&(wI(m,R,!0,!0),kb[R]=II),Nb&&c==Uf&&G&&G.name!==Uf&&(P=!0,U=function(){return SI(G,this)}),c)if(_={values:S(Uf),keys:u?U:S(xE),entries:S(RI)},h)for(E in _)(Sm||P||!(E in k))&&NE(k,E,_[E]);else vI({target:r,proto:!0,forced:Sm||P},_);return h&&k[DE]!==U&&NE(k,DE,U,{}),kb[r]=U,_},ME=function(t,r){return{value:t,done:r}},UE=Ce,ru=th,AI=td;et.f;var PI=LE,VE=ME,Db="Array Iterator",OI=AI.set,d_=AI.getterFor(Db);PI(Array,"Array",function(t,r){OI(this,{type:Db,target:UE(t),index:0,kind:r})},function(){var t=d_(this),r=t.target,s=t.kind,o=t.index++;return!r||o>=r.length?(t.target=void 0,VE(void 0,!0)):VE(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),ru.Arguments=ru.Array;var To=et,FE=function(t,r,s){return To.f(t,r,s)},HN=cn,jE=FE,wo=nt,kI=pr("species"),Qt=N,bm=TypeError,h_=function(t,r){if(Qt(r,t))return t;throw bm("Incorrect invocation")},NI=Me,xb=Bd,f_=A(Function.toString);NI(xb.inspectSource)||(xb.inspectSource=function(t){return f_(t)});var p_=xb.inspectSource,Lb=A,DI=d,Mb=Me,xI=Ac,Ub=p_,BE=function(){},so=[],Lc=cn("Reflect","construct"),iu=/^\s*(?:class|function)\b/,LI=Lb(iu.exec),MI=!iu.exec(BE),na=function(t){if(!Mb(t))return!1;try{return Lc(BE,so,t),!0}catch{return!1}},Vb=function(t){if(!Mb(t))return!1;switch(xI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return MI||!!LI(iu,Ub(t))}catch{return!0}};Vb.sham=!0;var xa,Tm,Fb,WE,m_=!Lc||DI(function(){var t;return na(na.call)||!na(Object)||!na(function(){t=!0})||t})?Vb:na,UI=m_,$N=_s,zE=TypeError,GE=ln,Mc=function(t){if(UI(t))return t;throw zE($N(t)+" is not a constructor")},Ir=Lt,Xs=pr("species"),ts=function(t,r){var s,o=GE(t).constructor;return o===void 0||Ir(s=GE(o)[Xs])?r:Mc(s)},Ts=A([].slice),oc=TypeError,_l=function(t,r){if(t<r)throw oc("Not enough arguments");return t},ws=/(?:ipad|iphone|ipod).*applewebkit/i.test(dr),oo=F,Vf=te,HE=De,$E=Me,g_=Si,ra=d,KE=Qg,wm=Ts,su=Yl,qE=_l,jb=ws,ah=wf,Cm=oo.setImmediate,ou=oo.clearImmediate,YE=oo.process,Ff=oo.Dispatch,Bb=oo.Function,__=oo.MessageChannel,XE=oo.String,ao=0,Uc={},Vc="onreadystatechange";ra(function(){xa=oo.location});var Co=function(t){if(g_(Uc,t)){var r=Uc[t];delete Uc[t],r()}},JE=function(t){return function(){Co(t)}},QE=function(t){Co(t.data)},ZE=function(t){oo.postMessage(XE(t),xa.protocol+"//"+xa.host)};Cm&&ou||(Cm=function(t){qE(arguments.length,1);var r=$E(t)?t:Bb(t),s=wm(arguments,1);return Uc[++ao]=function(){Vf(r,void 0,s)},Tm(ao),ao},ou=function(t){delete Uc[t]},ah?Tm=function(t){YE.nextTick(JE(t))}:Ff&&Ff.now?Tm=function(t){Ff.now(JE(t))}:__&&!jb?(WE=(Fb=new __).port2,Fb.port1.onmessage=QE,Tm=HE(WE.postMessage,WE)):oo.addEventListener&&$E(oo.postMessage)&&!oo.importScripts&&xa&&xa.protocol!=="file:"&&!ra(ZE)?(Tm=ZE,oo.addEventListener("message",QE,!1)):Tm=Vc in su("script")?function(t){KE.appendChild(su("script"))[Vc]=function(){KE.removeChild(this),Co(t)}}:function(t){setTimeout(JE(t),0)});var ev={set:Cm,clear:ou},id=function(){this.head=null,this.tail=null};id.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var jf,y_,sd,E_,ch,Wb=id,VI=/ipad|iphone|ipod/i.test(dr)&&typeof Pebble<"u",zb=/web0s(?!.*chrome)/i.test(dr),au=F,FI=De,KN=He.f,tv=ev.set,jI=Wb,Bf=ws,qN=VI,Rm=zb,nv=wf,Hi=au.MutationObserver||au.WebKitMutationObserver,BI=au.document,Gb=au.process,rv=au.Promise,WI=KN(au,"queueMicrotask"),iv=WI&&WI.value;if(!iv){var v_=new jI,sv=function(){var t,r;for(nv&&(t=Gb.domain)&&t.exit();r=v_.get();)try{r()}catch(s){throw v_.head&&jf(),s}t&&t.enter()};Bf||nv||Rm||!Hi||!BI?!qN&&rv&&rv.resolve?((E_=rv.resolve(void 0)).constructor=rv,ch=FI(E_.then,E_),jf=function(){ch(sv)}):nv?jf=function(){Gb.nextTick(sv)}:(tv=FI(tv,au),jf=function(){tv(sv)}):(y_=!0,sd=BI.createTextNode(""),new Hi(sv).observe(sd,{characterData:!0}),jf=function(){sd.data=y_=!y_}),iv=function(t){v_.head||jf(),v_.add(t)}}var ac=iv,lh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Wf=F.Promise,od=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",ov=!od&&!wf&&typeof window=="object"&&typeof document=="object",zf=F,uh=Wf,Hb=Me,$b=Ca,YN=p_,Kb=pr,XN=ov,zI=od,av=ii,S_=uh&&uh.prototype,cv=Kb("species"),qb=Hb(zf.PromiseRejectionEvent),Yb=$b("Promise",function(){var t=YN(uh),r=t!==String(uh);if(!r&&av===66||!S_.catch||!S_.finally)return!0;if(!av||av<51||!/native code/.test(t)){var s=new uh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[cv]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(XN||zI)&&!qb}),b_={CONSTRUCTOR:Yb,REJECTION_EVENT:qb},yl={},lv=ys,uv=TypeError,Xb=function(t){var r,s;this.promise=new t(function(o,c){if(r!==void 0||s!==void 0)throw uv("Bad Promise constructor");r=o,s=c}),this.resolve=lv(r),this.reject=lv(s)};yl.f=function(t){return new Xb(t)};var Im,Jb,JN=Vn,Gf=wf,dh=F,ad=ve,QN=nd,dv=rd,f=function(t){var r=HN(t);wo&&r&&!r[kI]&&jE(r,kI,{configurable:!0,get:function(){return this}})},g=ys,T=Me,O=at,M=h_,H=ts,ae=ev.set,Ie=ac,Le=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},rt=lh,At=Wb,Ot=td,It=Wf,qt=b_,en=yl,tn="Promise",ns=qt.CONSTRUCTOR,Ye=qt.REJECTION_EVENT,Ve=Ot.getterFor(tn),Je=Ot.set,Dt=It&&It.prototype,rn=It,pn=Dt,En=dh.TypeError,Nn=dh.document,Cs=dh.process,br=en.f,hh=br,ZN=!!(Nn&&Nn.createEvent&&dh.dispatchEvent),J4="unhandledrejection",Q4=function(t){var r;return!(!O(t)||!T(r=t.then))&&r},Z4=function(t,r){var s,o,c,u=r.value,h=r.state==1,m=h?t.ok:t.fail,_=t.resolve,E=t.reject,S=t.domain;try{m?(h||(r.rejection===2&&Moe(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===t.promise?E(En("Promise-chain cycle")):(o=Q4(s))?ad(o,s,_,E):_(s)):E(u)}catch(R){S&&!c&&S.exit(),E(R)}},e3=function(t,r){t.notified||(t.notified=!0,Ie(function(){for(var s,o=t.reactions;s=o.get();)Z4(s,t);t.notified=!1,r&&!t.rejection&&Loe(t)}))},t3=function(t,r,s){var o,c;ZN?((o=Nn.createEvent("Event")).promise=r,o.reason=s,o.initEvent(t,!1,!0),dh.dispatchEvent(o)):o={promise:r,reason:s},!Ye&&(c=dh["on"+t])?c(o):t===J4&&Le("Unhandled promise rejection",s)},Loe=function(t){ad(ae,dh,function(){var r,s=t.facade,o=t.value;if(n3(t)&&(r=rt(function(){Gf?Cs.emit("unhandledRejection",o,s):t3(J4,s,o)}),t.rejection=Gf||n3(t)?2:1,r.error))throw r.value})},n3=function(t){return t.rejection!==1&&!t.parent},Moe=function(t){ad(ae,dh,function(){var r=t.facade;Gf?Cs.emit("rejectionHandled",r):t3("rejectionhandled",r,t.value)})},hv=function(t,r,s){return function(o){t(r,o,s)}},fv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,e3(t,!0))},eD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw En("Promise can't be resolved itself");var o=Q4(r);o?Ie(function(){var c={done:!1};try{ad(o,r,hv(eD,c,t),hv(fv,c,t))}catch(u){fv(c,u,t)}}):(t.value=r,t.state=1,e3(t,!1))}catch(c){fv({done:!1},c,t)}}};ns&&(pn=(rn=function(t){M(this,pn),g(t),ad(Im,this);var r=Ve(this);try{t(hv(eD,r),hv(fv,r))}catch(s){fv(r,s)}}).prototype,(Im=function(t){Je(this,{type:tn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=QN(pn,"then",function(t,r){var s=Ve(this),o=br(H(this,rn));return s.parent=!0,o.ok=!T(t)||t,o.fail=T(r)&&r,o.domain=Gf?Cs.domain:void 0,s.state==0?s.reactions.add(o):Ie(function(){Z4(o,s)}),o.promise}),Jb=function(){var t=new Im,r=Ve(t);this.promise=t,this.resolve=hv(eD,r),this.reject=hv(fv,r)},en.f=br=function(t){return t===rn||t===void 0?new Jb(t):hh(t)}),JN({global:!0,wrap:!0,forced:ns},{Promise:rn}),dv(rn,tn,!1,!0),f(tn);var r3=pr("iterator"),i3=!1;try{var Uoe=0,s3={next:function(){return{done:!!Uoe++}},return:function(){i3=!0}};s3[r3]=function(){return this},Array.from(s3,function(){throw 2})}catch{}var Voe=Wf,Foe=function(t,r){if(!i3)return!1;var s=!1;try{var o={};o[r3]=function(){return{next:function(){return{done:s=!0}}}},t(o)}catch{}return s},GI=b_.CONSTRUCTOR||!Foe(function(t){Voe.all(t).then(void 0,function(){})}),joe=ve,Boe=ys,Woe=yl,zoe=lh,Goe=ih;Vn({target:"Promise",stat:!0,forced:GI},{all:function(t){var r=this,s=Woe.f(r),o=s.resolve,c=s.reject,u=zoe(function(){var h=Boe(r.resolve),m=[],_=0,E=1;Goe(t,function(S){var R=_++,P=!1;E++,joe(h,r,S).then(function(k){P||(P=!0,m[R]=k,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),s.promise}});var Hoe=Vn,$oe=b_.CONSTRUCTOR;Wf&&Wf.prototype,Hoe({target:"Promise",proto:!0,forced:$oe,real:!0},{catch:function(t){return this.then(void 0,t)}});var Koe=ve,qoe=ys,Yoe=yl,Xoe=lh,Joe=ih;Vn({target:"Promise",stat:!0,forced:GI},{race:function(t){var r=this,s=Yoe.f(r),o=s.reject,c=Xoe(function(){var u=qoe(r.resolve);Joe(t,function(h){Koe(u,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var Qoe=ve,Zoe=yl;Vn({target:"Promise",stat:!0,forced:b_.CONSTRUCTOR},{reject:function(t){var r=Zoe.f(this);return Qoe(r.reject,void 0,t),r.promise}});var eae=ln,tae=at,nae=yl,o3=function(t,r){if(eae(t),tae(r)&&r.constructor===t)return r;var s=nae.f(t);return(0,s.resolve)(r),s.promise},rae=Vn,iae=Wf,sae=b_.CONSTRUCTOR,oae=o3,aae=cn("Promise"),cae=!sae;rae({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return oae(cae&&this===aae?iae:this,t)}});var lae=ve,uae=ys,dae=yl,hae=lh,fae=ih;Vn({target:"Promise",stat:!0,forced:GI},{allSettled:function(t){var r=this,s=dae.f(r),o=s.resolve,c=s.reject,u=hae(function(){var h=uae(r.resolve),m=[],_=0,E=1;fae(t,function(S){var R=_++,P=!1;E++,lae(h,r,S).then(function(k){P||(P=!0,m[R]={status:"fulfilled",value:k},--E||o(m))},function(k){P||(P=!0,m[R]={status:"rejected",reason:k},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),s.promise}});var pae=ve,mae=ys,gae=cn,_ae=yl,yae=lh,Eae=ih,a3="No one promise resolved";Vn({target:"Promise",stat:!0,forced:GI},{any:function(t){var r=this,s=gae("AggregateError"),o=_ae.f(r),c=o.resolve,u=o.reject,h=yae(function(){var m=mae(r.resolve),_=[],E=0,S=1,R=!1;Eae(t,function(P){var k=E++,G=!1;S++,pae(m,r,P).then(function(U){G||R||(R=!0,c(U))},function(U){G||R||(G=!0,_[k]=U,--S||u(new s(_,a3)))})}),--S||u(new s(_,a3))});return h.error&&u(h.value),o.promise}});var vae=Vn,tD=Wf,Sae=d,bae=cn,Tae=Me,wae=ts,c3=o3,Cae=tD&&tD.prototype;vae({target:"Promise",proto:!0,real:!0,forced:!!tD&&Sae(function(){Cae.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=wae(this,bae("Promise")),s=Tae(t);return this.then(s?function(o){return c3(r,t()).then(function(){return o})}:t,s?function(o){return c3(r,t()).then(function(){throw o})}:t)}});var nD=A,Rae=Ic,Iae=Ia,Aae=Kt,Pae=nD("".charAt),l3=nD("".charCodeAt),Oae=nD("".slice),u3=function(t){return function(r,s){var o,c,u=Iae(Aae(r)),h=Rae(s),m=u.length;return h<0||h>=m?t?"":void 0:(o=l3(u,h))<55296||o>56319||h+1===m||(c=l3(u,h+1))<56320||c>57343?t?Pae(u,h):o:t?Oae(u,h,h+2):c-56320+(o-55296<<10)+65536}},rD={codeAt:u3(!1),charAt:u3(!0)},kae=rD.charAt,Nae=Ia,d3=td,Dae=LE,h3=ME,f3="String Iterator",xae=d3.set,Lae=d3.getterFor(f3);Dae(String,"String",function(t){xae(this,{type:f3,string:Nae(t),index:0})},function(){var t,r=Lae(this),s=r.string,o=r.index;return o>=s.length?h3(void 0,!0):(t=kae(s,o),r.index+=t.length,h3(t,!1))});var Mae=vt.Promise,Uae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Vae=F,Fae=Ac,jae=Xo,p3=th,m3=pr("toStringTag");for(var iD in Uae){var g3=Vae[iD],sD=g3&&g3.prototype;sD&&Fae(sD)!==m3&&jae(sD,m3,iD),p3[iD]=p3.Array}var _3=Mae,ut=l(_3),Bae=nc("Array").values,Wae=Ac,zae=Si,Gae=N,Hae=Bae,oD=Array.prototype,$ae={DOMTokenList:!0,NodeList:!0},Kae=function(t){var r=t.values;return t===oD||Gae(oD,t)&&r===oD.values||zae($ae,Wae(t))?Hae:r},Fc=l(Kae),qae=d,Yae=pr("iterator"),aD=!qae(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Yae]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Xae=nd,Jae=ec,Qae=et,Zae=Qe,HI=function(t,r,s){var o=Jae(r);o in t?Qae.f(t,o,Zae(0,s)):t[o]=s},y3=me,ece=hi,tce=HI,nce=Array,rce=Math.max,cD=function(t,r,s){for(var o=ece(t),c=y3(r,o),u=y3(s===void 0?o:s,o),h=nce(rce(u-c,0)),m=0;c<u;c++,m++)tce(h,m,t[c]);return h.length=m,h},E3=cD,ice=Math.floor,lD=function(t,r){var s=t.length,o=ice(s/2);return s<8?sce(t,r):oce(t,lD(E3(t,0,o),r),lD(E3(t,o),r),r)},sce=function(t,r){for(var s,o,c=t.length,u=1;u<c;){for(o=u,s=t[u];o&&r(t[o-1],s)>0;)t[o]=t[--o];o!==u++&&(t[o]=s)}return t},oce=function(t,r,s,o){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)t[h+m]=h<c&&m<u?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},v3=lD,uD=Vn,pv=F,$I=ve,fh=A,mv=nt,S3=aD,b3=nd,ace=FE,cce=function(t,r,s){for(var o in r)s&&s.unsafe&&t[o]?t[o]=r[o]:Xae(t,o,r[o],s);return t},lce=rd,uce=kE,dD=td,T3=h_,hD=Me,dce=Si,hce=De,fce=Ac,pce=ln,w3=at,cc=Ia,mce=Zo,C3=Qe,fD=r_,gce=Zu,gv=_l,_ce=v3,yce=pr("iterator"),Qb="URLSearchParams",R3=Qb+"Iterator",I3=dD.set,cu=dD.getterFor(Qb),Ece=dD.getterFor(R3),vce=Object.getOwnPropertyDescriptor,pD=function(t){if(!mv)return pv[t];var r=vce(pv,t);return r&&r.value},A3=pD("fetch"),KI=pD("Request"),Zb=pD("Headers"),mD=KI&&KI.prototype,P3=Zb&&Zb.prototype,Sce=pv.RegExp,bce=pv.TypeError,O3=pv.decodeURIComponent,Tce=pv.encodeURIComponent,wce=fh("".charAt),k3=fh([].join),T_=fh([].push),gD=fh("".replace),Cce=fh([].shift),N3=fh([].splice),D3=fh("".split),Rce=fh("".slice),Ice=/\+/g,x3=Array(4),Ace=function(t){return x3[t-1]||(x3[t-1]=Sce("((?:%[\\da-f]{2}){"+t+"})","gi"))},Pce=function(t){try{return O3(t)}catch{return t}},L3=function(t){var r=gD(t,Ice," "),s=4;try{return O3(r)}catch{for(;s;)r=gD(r,Ace(s--),Pce);return r}},Oce=/[!'()~]|%20/g,kce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Nce=function(t){return kce[t]},M3=function(t){return gD(Tce(t),Oce,Nce)},_D=uce(function(t,r){I3(this,{type:R3,iterator:fD(cu(t).entries),kind:r})},"Iterator",function(){var t=Ece(this),r=t.kind,s=t.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),U3=function(t){this.entries=[],this.url=null,t!==void 0&&(w3(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?wce(t,0)==="?"?Rce(t,1):t:cc(t)))};U3.prototype={type:Qb,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,o,c,u,h,m,_=gce(t);if(_)for(s=(r=fD(t,_)).next;!(o=$I(s,r)).done;){if(u=(c=fD(pce(o.value))).next,(h=$I(u,c)).done||(m=$I(u,c)).done||!$I(u,c).done)throw bce("Expected sequence with length 2");T_(this.entries,{key:cc(h.value),value:cc(m.value)})}else for(var E in t)dce(t,E)&&T_(this.entries,{key:E,value:cc(t[E])})},parseQuery:function(t){if(t)for(var r,s,o=D3(t,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=D3(r,"="),T_(this.entries,{key:L3(Cce(s)),value:L3(k3(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],o=0;o<r.length;)t=r[o++],T_(s,M3(t.key)+"="+M3(t.value));return k3(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var qI=function(){T3(this,_v);var t=I3(this,new U3(arguments.length>0?arguments[0]:void 0));mv||(this.size=t.entries.length)},_v=qI.prototype;if(cce(_v,{append:function(t,r){var s=cu(this);gv(arguments.length,2),T_(s.entries,{key:cc(t),value:cc(r)}),mv||this.length++,s.updateURL()},delete:function(t){for(var r=cu(this),s=gv(arguments.length,1),o=r.entries,c=cc(t),u=s<2?void 0:arguments[1],h=u===void 0?u:cc(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(N3(o,m,1),h!==void 0)break}mv||(this.size=o.length),r.updateURL()},get:function(t){var r=cu(this).entries;gv(arguments.length,1);for(var s=cc(t),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(t){var r=cu(this).entries;gv(arguments.length,1);for(var s=cc(t),o=[],c=0;c<r.length;c++)r[c].key===s&&T_(o,r[c].value);return o},has:function(t){for(var r=cu(this).entries,s=gv(arguments.length,1),o=cc(t),c=s<2?void 0:arguments[1],u=c===void 0?c:cc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var s=cu(this);gv(arguments.length,1);for(var o,c=s.entries,u=!1,h=cc(t),m=cc(r),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?N3(c,_--,1):(u=!0,o.value=m));u||T_(c,{key:h,value:m}),mv||(this.size=c.length),s.updateURL()},sort:function(){var t=cu(this);_ce(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=cu(this).entries,o=hce(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new _D(this,"keys")},values:function(){return new _D(this,"values")},entries:function(){return new _D(this,"entries")}},{enumerable:!0}),b3(_v,yce,_v.entries,{}),b3(_v,"toString",function(){return cu(this).serialize()},{enumerable:!0}),mv&&ace(_v,"size",{get:function(){return cu(this).entries.length},configurable:!0,enumerable:!0}),lce(qI,Qb),uD({global:!0,forced:!S3},{URLSearchParams:qI}),!S3&&hD(Zb)){var Dce=fh(P3.has),xce=fh(P3.set),V3=function(t){if(w3(t)){var r,s=t.body;if(fce(s)===Qb)return r=t.headers?new Zb(t.headers):new Zb,Dce(r,"content-type")||xce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),mce(t,{body:C3(0,cc(s)),headers:C3(0,r)})}return t};if(hD(A3)&&uD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return A3(t,arguments.length>1?V3(arguments[1]):{})}}),hD(KI)){var yD=function(t){return T3(this,mD),new KI(t,arguments.length>1?V3(arguments[1]):{})};mD.constructor=yD,yD.prototype=mD,uD({global:!0,dontCallGetSet:!0,forced:!0},{Request:yD})}}var lu,Lce={URLSearchParams:qI,getState:cu},Mce=vt.URLSearchParams,F3=nt,Uce=A,Vce=ve,Fce=d,ED=kc,jce=Oc,Bce=Ne,Wce=Bo,zce=un,yv=Object.assign,j3=Object.defineProperty,Gce=Uce([].concat),Hce=!yv||Fce(function(){if(F3&&yv({b:1},yv(j3({},"a",{enumerable:!0,get:function(){j3(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return t[s]=7,o.split("").forEach(function(c){r[c]=c}),yv({},t)[s]!=7||ED(yv({},r)).join("")!=o})?function(t,r){for(var s=Wce(t),o=arguments.length,c=1,u=jce.f,h=Bce.f;o>c;)for(var m,_=zce(arguments[c++]),E=u?Gce(ED(_),u(_)):ED(_),S=E.length,R=0;S>R;)m=E[R++],F3&&!Vce(h,_,m)||(s[m]=_[m]);return s}:yv,$ce=ln,Kce=i_,qce=De,Yce=ve,Xce=Bo,Jce=function(t,r,s,o){try{return o?r($ce(s)[0],s[1]):r(s)}catch(c){Kce(t,"throw",c)}},Qce=n_,Zce=m_,ele=hi,B3=HI,tle=r_,nle=Zu,W3=Array,w_=A,vD=2147483647,rle=/[^\0-\u007E]/,z3=/[.\u3002\uFF0E\uFF61]/g,G3="Overflow: input needs wider integers to process",H3=RangeError,ile=w_(z3.exec),Ev=Math.floor,SD=String.fromCharCode,$3=w_("".charCodeAt),K3=w_([].join),Am=w_([].push),sle=w_("".replace),ole=w_("".split),ale=w_("".toLowerCase),q3=function(t){return t+22+75*(t<26)},cle=function(t,r,s){var o=0;for(t=s?Ev(t/700):t>>1,t+=Ev(t/r);t>455;)t=Ev(t/35),o+=36;return Ev(o+36*t/(t+38))},lle=function(t){var r=[];t=function(q){for(var Y=[],le=0,ye=q.length;le<ye;){var Ee=$3(q,le++);if(Ee>=55296&&Ee<=56319&&le<ye){var ge=$3(q,le++);(64512&ge)==56320?Am(Y,((1023&Ee)<<10)+(1023&ge)+65536):(Am(Y,Ee),le--)}else Am(Y,Ee)}return Y}(t);var s,o,c=t.length,u=128,h=0,m=72;for(s=0;s<t.length;s++)(o=t[s])<128&&Am(r,SD(o));var _=r.length,E=_;for(_&&Am(r,"-");E<c;){var S=vD;for(s=0;s<t.length;s++)(o=t[s])>=u&&o<S&&(S=o);var R=E+1;if(S-u>Ev((vD-h)/R))throw H3(G3);for(h+=(S-u)*R,u=S,s=0;s<t.length;s++){if((o=t[s])<u&&++h>vD)throw H3(G3);if(o==u){for(var P=h,k=36;;){var G=k<=m?1:k>=m+26?26:k-m;if(P<G)break;var U=P-G,j=36-G;Am(r,SD(q3(G+U%j))),P=Ev(U/j),k+=36}Am(r,SD(q3(P))),m=cle(h,R,E==_),h=0,E++}}h++,u++}return K3(r,"")},ule=Vn,bD=nt,dle=aD,TD=F,Y3=De,uu=A,YI=nd,du=FE,hle=h_,wD=Si,CD=Hce,vv=function(t){var r=Xce(t),s=Zce(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=qce(c,o>2?arguments[2]:void 0));var h,m,_,E,S,R,P=nle(r),k=0;if(!P||this===W3&&Qce(P))for(h=ele(r),m=s?new this(h):W3(h);h>k;k++)R=u?c(r[k],k):r[k],B3(m,k,R);else for(S=(E=tle(r,P)).next,m=s?new this:[];!(_=Yce(S,E)).done;k++)R=u?Jce(E,c,[_.value,k],!0):_.value,B3(m,k,R);return m.length=k,m},cd=cD,fle=rD.codeAt,ple=function(t){var r,s,o=[],c=ole(sle(ale(t),z3,"."),".");for(r=0;r<c.length;r++)s=c[r],Am(o,ile(rle,s)?"xn--"+lle(s):s);return K3(o,".")},Hf=Ia,mle=rd,gle=_l,X3=Lce,J3=td,_le=J3.set,XI=J3.getterFor("URL"),yle=X3.URLSearchParams,Ele=X3.getState,eT=TD.URL,RD=TD.TypeError,JI=TD.parseInt,vle=Math.floor,Q3=Math.pow,hu=uu("".charAt),ld=uu(/./.exec),tT=uu([].join),Sle=uu(1 .toString),ble=uu([].pop),Sv=uu([].push),ID=uu("".replace),Tle=uu([].shift),wle=uu("".split),nT=uu("".slice),QI=uu("".toLowerCase),Cle=uu([].unshift),AD="Invalid scheme",C_="Invalid host",Z3="Invalid port",e5=/[a-z]/i,Rle=/[\d+-.a-z]/i,PD=/\d/,Ile=/^0x/i,Ale=/^[0-7]+$/,Ple=/^\d+$/,t5=/^[\da-f]+$/i,Ole=/[\0\t\n\r #%/:<>?@[\\\]^|]/,kle=/[\0\t\n\r #/:<>?@[\\\]^|]/,Nle=/^[\u0000-\u0020]+/,Dle=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,xle=/[\t\n\r]/g,rT=function(t){var r,s,o,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Cle(r,t%256),t=vle(t/256);return tT(r,".")}if(typeof t=="object"){for(r="",o=function(u){for(var h=null,m=1,_=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=_,m=E),_=null,E=0):(_===null&&(_=S),++E);return E>m&&(h=_,m=E),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=Sle(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},ZI={},n5=CD({},ZI,{" ":1,'"':1,"<":1,">":1,"`":1}),r5=CD({},n5,{"#":1,"?":1,"{":1,"}":1}),OD=CD({},r5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Pm=function(t,r){var s=fle(t,0);return s>32&&s<127&&!wD(r,t)?t:encodeURIComponent(t)},eA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},iT=function(t,r){var s;return t.length==2&&ld(e5,hu(t,0))&&((s=hu(t,1))==":"||!r&&s=="|")},i5=function(t){var r;return t.length>1&&iT(nT(t,0,2))&&(t.length==2||(r=hu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Lle=function(t){return t==="."||QI(t)==="%2e"},kD={},s5={},ND={},o5={},a5={},DD={},c5={},l5={},tA={},nA={},xD={},LD={},MD={},UD={},u5={},VD={},bv={},ph={},d5={},R_={},$f={},FD=function(t,r,s){var o,c,u,h=Hf(t);if(r){if(c=this.parse(h))throw RD(c);this.searchParams=null}else{if(s!==void 0&&(o=new FD(s,!0)),c=this.parse(h,null,o))throw RD(c);(u=Ele(new yle)).bindURL(this),this.searchParams=u}};FD.prototype={type:"URL",parse:function(t,r,s){var o,c,u,h,m,_=this,E=r||kD,S=0,R="",P=!1,k=!1,G=!1;for(t=Hf(t),r||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,t=ID(t,Nle,""),t=ID(t,Dle,"$1")),t=ID(t,xle,""),o=vv(t);S<=o.length;){switch(c=o[S],E){case kD:if(!c||!ld(e5,c)){if(r)return AD;E=ND;continue}R+=QI(c),E=s5;break;case s5:if(c&&(ld(Rle,c)||c=="+"||c=="-"||c=="."))R+=QI(c);else{if(c!=":"){if(r)return AD;R="",E=ND,S=0;continue}if(r&&(_.isSpecial()!=wD(eA,R)||R=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=R,r)return void(_.isSpecial()&&eA[_.scheme]==_.port&&(_.port=null));R="",_.scheme=="file"?E=UD:_.isSpecial()&&s&&s.scheme==_.scheme?E=o5:_.isSpecial()?E=l5:o[S+1]=="/"?(E=a5,S++):(_.cannotBeABaseURL=!0,Sv(_.path,""),E=d5)}break;case ND:if(!s||s.cannotBeABaseURL&&c!="#")return AD;if(s.cannotBeABaseURL&&c=="#"){_.scheme=s.scheme,_.path=cd(s.path),_.query=s.query,_.fragment="",_.cannotBeABaseURL=!0,E=$f;break}E=s.scheme=="file"?UD:DD;continue;case o5:if(c!="/"||o[S+1]!="/"){E=DD;continue}E=tA,S++;break;case a5:if(c=="/"){E=nA;break}E=ph;continue;case DD:if(_.scheme=s.scheme,c==lu)_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query=s.query;else if(c=="/"||c=="\\"&&_.isSpecial())E=c5;else if(c=="?")_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query="",E=R_;else{if(c!="#"){_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.path.length--,E=ph;continue}_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,_.path=cd(s.path),_.query=s.query,_.fragment="",E=$f}break;case c5:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=s.username,_.password=s.password,_.host=s.host,_.port=s.port,E=ph;continue}E=nA}else E=tA;break;case l5:if(E=tA,c!="/"||hu(R,S+1)!="/")continue;S++;break;case tA:if(c!="/"&&c!="\\"){E=nA;continue}break;case nA:if(c=="@"){P&&(R="%40"+R),P=!0,u=vv(R);for(var U=0;U<u.length;U++){var j=u[U];if(j!=":"||G){var q=Pm(j,OD);G?_.password+=q:_.username+=q}else G=!0}R=""}else if(c==lu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(P&&R=="")return"Invalid authority";S-=vv(R).length+1,R="",E=xD}else R+=c;break;case xD:case LD:if(r&&_.scheme=="file"){E=VD;continue}if(c!=":"||k){if(c==lu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&R=="")return C_;if(r&&R==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(R))return h;if(R="",E=bv,r)return;continue}c=="["?k=!0:c=="]"&&(k=!1),R+=c}else{if(R=="")return C_;if(h=_.parseHost(R))return h;if(R="",E=MD,r==LD)return}break;case MD:if(!ld(PD,c)){if(c==lu||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||r){if(R!=""){var Y=JI(R,10);if(Y>65535)return Z3;_.port=_.isSpecial()&&Y===eA[_.scheme]?null:Y,R=""}if(r)return;E=bv;continue}return Z3}R+=c;break;case UD:if(_.scheme="file",c=="/"||c=="\\")E=u5;else{if(!s||s.scheme!="file"){E=ph;continue}if(c==lu)_.host=s.host,_.path=cd(s.path),_.query=s.query;else if(c=="?")_.host=s.host,_.path=cd(s.path),_.query="",E=R_;else{if(c!="#"){i5(tT(cd(o,S),""))||(_.host=s.host,_.path=cd(s.path),_.shortenPath()),E=ph;continue}_.host=s.host,_.path=cd(s.path),_.query=s.query,_.fragment="",E=$f}}break;case u5:if(c=="/"||c=="\\"){E=VD;break}s&&s.scheme=="file"&&!i5(tT(cd(o,S),""))&&(iT(s.path[0],!0)?Sv(_.path,s.path[0]):_.host=s.host),E=ph;continue;case VD:if(c==lu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&iT(R))E=ph;else if(R==""){if(_.host="",r)return;E=bv}else{if(h=_.parseHost(R))return h;if(_.host=="localhost"&&(_.host=""),r)return;R="",E=bv}continue}R+=c;break;case bv:if(_.isSpecial()){if(E=ph,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=lu&&(E=ph,c!="/"))continue}else _.fragment="",E=$f;else _.query="",E=R_;break;case ph:if(c==lu||c=="/"||c=="\\"&&_.isSpecial()||!r&&(c=="?"||c=="#")){if((m=QI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||Sv(_.path,"")):Lle(R)?c=="/"||c=="\\"&&_.isSpecial()||Sv(_.path,""):(_.scheme=="file"&&!_.path.length&&iT(R)&&(_.host&&(_.host=""),R=hu(R,0)+":"),Sv(_.path,R)),R="",_.scheme=="file"&&(c==lu||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)Tle(_.path);c=="?"?(_.query="",E=R_):c=="#"&&(_.fragment="",E=$f)}else R+=Pm(c,r5);break;case d5:c=="?"?(_.query="",E=R_):c=="#"?(_.fragment="",E=$f):c!=lu&&(_.path[0]+=Pm(c,ZI));break;case R_:r||c!="#"?c!=lu&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":Pm(c,ZI)):(_.fragment="",E=$f);break;case $f:c!=lu&&(_.fragment+=Pm(c,n5))}S++}},parseHost:function(t){var r,s,o;if(hu(t,0)=="["){if(hu(t,t.length-1)!="]"||(r=function(c){var u,h,m,_,E,S,R,P=[0,0,0,0,0,0,0,0],k=0,G=null,U=0,j=function(){return hu(c,U)};if(j()==":"){if(hu(c,1)!=":")return;U+=2,G=++k}for(;j();){if(k==8)return;if(j()!=":"){for(u=h=0;h<4&&ld(t5,j());)u=16*u+JI(j(),16),U++,h++;if(j()=="."){if(h==0||(U-=h,k>6))return;for(m=0;j();){if(_=null,m>0){if(!(j()=="."&&m<4))return;U++}if(!ld(PD,j()))return;for(;ld(PD,j());){if(E=JI(j(),10),_===null)_=E;else{if(_==0)return;_=10*_+E}if(_>255)return;U++}P[k]=256*P[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(j()==":"){if(U++,!j())return}else if(j())return;P[k++]=u}else{if(G!==null)return;U++,G=++k}}if(G!==null)for(S=k-G,k=7;k!=0&&S>0;)R=P[k],P[k--]=P[G+S-1],P[G+--S]=R;else if(k!=8)return;return P}(nT(t,1,-1)),!r))return C_;this.host=r}else if(this.isSpecial()){if(t=ple(t),ld(Ole,t)||(r=function(c){var u,h,m,_,E,S,R,P=wle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=P[m])=="")return c;if(E=10,_.length>1&&hu(_,0)=="0"&&(E=ld(Ile,_)?16:8,_=nT(_,E==8?1:2)),_==="")S=0;else{if(!ld(E==10?Ple:E==8?Ale:t5,_))return c;S=JI(_,E)}Sv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=Q3(256,5-u))return null}else if(S>255)return null;for(R=ble(h),m=0;m<h.length;m++)R+=h[m]*Q3(256,3-m);return R}(t),r===null))return C_;this.host=r}else{if(ld(kle,t))return C_;for(r="",s=vv(t),o=0;o<s.length;o++)r+=Pm(s[o],ZI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return wD(eA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&iT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,o=t.password,c=t.host,u=t.port,h=t.path,m=t.query,_=t.fragment,E=r+":";return c!==null?(E+="//",t.includesCredentials()&&(E+=s+(o?":"+o:"")+"@"),E+=rT(c),u!==null&&(E+=":"+u)):r=="file"&&(E+="//"),E+=t.cannotBeABaseURL?h[0]:h.length?"/"+tT(h,"/"):"",m!==null&&(E+="?"+m),_!==null&&(E+="#"+_),E},setHref:function(t){var r=this.parse(t);if(r)throw RD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Tv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+rT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Hf(t)+":",kD)},getUsername:function(){return this.username},setUsername:function(t){var r=vv(Hf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Pm(r[s],OD)}},getPassword:function(){return this.password},setPassword:function(t){var r=vv(Hf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Pm(r[s],OD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?rT(t):rT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,xD)},getHostname:function(){var t=this.host;return t===null?"":rT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,LD)},getPort:function(){var t=this.port;return t===null?"":Hf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Hf(t))==""?this.port=null:this.parse(t,MD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+tT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,bv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Hf(t))==""?this.query=null:(hu(t,0)=="?"&&(t=nT(t,1)),this.query="",this.parse(t,R_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Hf(t))!=""?(hu(t,0)=="#"&&(t=nT(t,1)),this.fragment="",this.parse(t,$f)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Tv=function(t){var r=hle(this,lc),s=gle(arguments.length,1)>1?arguments[1]:void 0,o=_le(r,new FD(t,!1,s));bD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},lc=Tv.prototype,fu=function(t,r){return{get:function(){return XI(this)[t]()},set:r&&function(s){return XI(this)[r](s)},configurable:!0,enumerable:!0}};if(bD&&(du(lc,"href",fu("serialize","setHref")),du(lc,"origin",fu("getOrigin")),du(lc,"protocol",fu("getProtocol","setProtocol")),du(lc,"username",fu("getUsername","setUsername")),du(lc,"password",fu("getPassword","setPassword")),du(lc,"host",fu("getHost","setHost")),du(lc,"hostname",fu("getHostname","setHostname")),du(lc,"port",fu("getPort","setPort")),du(lc,"pathname",fu("getPathname","setPathname")),du(lc,"search",fu("getSearch","setSearch")),du(lc,"searchParams",fu("getSearchParams")),du(lc,"hash",fu("getHash","setHash"))),YI(lc,"toJSON",function(){return XI(this).serialize()},{enumerable:!0}),YI(lc,"toString",function(){return XI(this).serialize()},{enumerable:!0}),eT){var h5=eT.createObjectURL,f5=eT.revokeObjectURL;h5&&YI(Tv,"createObjectURL",Y3(h5,eT)),f5&&YI(Tv,"revokeObjectURL",Y3(f5,eT))}mle(Tv,"URL"),ule({global:!0,forced:!dle,sham:!bD},{URL:Tv});var Mle=Vn,Ule=d,Vle=_l,p5=Ia,Fle=aD,m5=cn("URL");Mle({target:"URL",stat:!0,forced:!(Fle&&Ule(function(){m5.canParse()}))},{canParse:function(t){var r=Vle(arguments.length,1),s=p5(t),o=r<2||arguments[1]===void 0?void 0:p5(arguments[1]);try{return!!new m5(s,o)}catch{return!1}}});var rA=l(vt.URL);let g5=!0,_5=!0;function iA(t,r,s){const o=t.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function I_(t,r,s){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const _=E=>{const S=s(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const _=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function jle(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(g5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ble(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(_5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function y5(){if(typeof window=="object"){if(g5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jD(t,r){_5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function E5(t){return Object.prototype.toString.call(t)==="[object Object]"}function v5(t){var r;return E5(t)?rc(r=Object.keys(t)).call(r,function(s,o){const c=E5(t[o]),u=c?v5(t[o]):t[o],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[o]:u})},{}):t}function BD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?BD(t,t.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{BD(t,t.get(c),s)})}))}function S5(t,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===o&&m.trackId===h.id&&BD(t,m,c)})}),c}const b5=y5;function T5(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const E=typeof h[_]=="object"?h[_]:{ideal:h[_]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(E.ideal!==void 0){m.optional=m.optional||[];let R={};typeof E.ideal=="number"?(R[S("min",_)]=E.ideal,m.optional.push(R),R={},R[S("max",_)]=E.ideal,m.optional.push(R)):(R[S("",_)]=E.ideal,m.optional.push(R))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=E.exact):["min","max"].forEach(R=>{E[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,_)]=E[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(E,S,R){S in E&&!(R in E)&&(E[R]=E[S],delete E[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const E=r.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(k=>k.kind==="videoinput")).find(k=>S.some(G=>{var U;return st(U=k.label.toLowerCase()).call(U,G)}));return!P&&R.length&&st(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=_.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),b5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return b5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,_){c(h,E=>{s.webkitGetUserMedia(E,m,S=>{_&&_(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(E=>{if(_.audio&&!E.getAudioTracks().length||_.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>ut.reject(u(E))))}}}function w5(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function C5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else I_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function R5(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=r(this,h),this._senders.push(_)),_};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function I5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const _={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(R=>{S[R]=E.stat(R)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return r.apply(this,[m,s])}return new ut((m,_)=>{r.apply(this,[function(E){m(h(u(E)))},_])}).then(o,c)}}function A5(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>S5(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),I_(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>S5(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===s&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||o&&c?ut.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ut.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function P5(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function O5(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return P5(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const _=s.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(E=>this._reverseStreams[E.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(E=>{if(this.getSenders().find(R=>R.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const E=new t.MediaStream(_.getTracks());this._streams[_.id]=E,this._reverseStreams[E.id]=_,_=E}o.apply(this,[_])};const c=t.RTCPeerConnection.prototype.removeStream;function u(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(k.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}t.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},t.RTCPeerConnection.prototype.addTrack=function(_,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[E.id];if(P)P.addTrack(_),ut.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([_]);this._streams[E.id]=k,this._reverseStreams[k.id]=E,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const E=t.RTCPeerConnection.prototype[_],S={[_](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[P=>{const k=u(this,P);R[0].apply(null,[k])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):E.apply(this,arguments).then(P=>u(this,P))}};t.RTCPeerConnection.prototype[_]=S[_]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,E){let S=E.sdp;return Object.keys(_._reverseStreams||[]).forEach(R=>{const P=_._reverseStreams[R],k=_._streams[P.id];S=S.replace(new RegExp(P.id,"g"),k.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),t.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>_.track===R)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function WD(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function k5(t,r){I_(t,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var N5=Object.freeze({__proto__:null,fixNegotiationNeeded:k5,shimAddTrackRemoveTrack:O5,shimAddTrackRemoveTrackWithNative:P5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:R5,shimGetStats:I5,shimGetUserMedia:T5,shimMediaStream:w5,shimOnTrack:C5,shimPeerConnection:WD,shimSenderReceiverGetStats:A5});function D5(t,r){const s=t&&t.navigator,o=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){jD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function x5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zD(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(_=>{_.type=s[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(u,h)}}function L5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ut.resolve(new Map)}}function M5(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),I_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function U5(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){jD("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&st(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function V5(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function F5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function j5(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function B5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function W5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var z5=Object.freeze({__proto__:null,shimAddTransceiver:F5,shimCreateAnswer:W5,shimCreateOffer:B5,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ut.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:j5,shimGetUserMedia:D5,shimOnTrack:x5,shimPeerConnection:zD,shimRTCDataChannel:V5,shimReceiverGetStats:M5,shimRemoveStream:U5,shimSenderGetStats:L5});function G5(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),st(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?st(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{st(o).call(o,c.track)&&this.removeTrack(c)})})}}function H5(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),st(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function $5(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return E?(R.then(_,E),ut.resolve()):R},r.createAnswer=function(_,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return E?(R.then(_,E),ut.resolve()):R};let m=function(_,E,S){const R=c.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R};r.setLocalDescription=m,m=function(_,E,S){const R=u.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R},r.setRemoteDescription=m,m=function(_,E,S){const R=h.apply(this,[_]);return S?(R.then(E,S),ut.resolve()):R},r.addIceCandidate=m}function K5(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(q5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function q5(t){return t&&t.video!==void 0?Object.assign({},t,{video:v5(t.video)}):t}function Y5(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(jD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function X5(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function J5(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function Q5(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Z5=Object.freeze({__proto__:null,shimAudioContext:Q5,shimCallbacksAPI:$5,shimConstraints:q5,shimCreateOfferLegacy:J5,shimGetUserMedia:K5,shimLocalStreamsAPI:G5,shimRTCIceServerUrls:Y5,shimRemoteStreamsAPI:H5,shimTrackEventTransceiver:X5}),eB=`	
\v\f\r \u2028\u2029\uFEFF`,Wle=Kt,zle=Ia,GD=eB,tB=A("".replace),Gle=RegExp("^["+GD+"]+"),Hle=RegExp("(^|[^"+GD+"])["+GD+"]+$"),$le=function(t){return function(r){var s=zle(Wle(r));return 1&t&&(s=tB(s,Gle,"")),2&t&&(s=tB(s,Hle,"$1")),s}},Kle={trim:$le(3)},qle=dI.PROPER,Yle=d,nB=eB,Xle=Kle.trim;Vn({target:"String",proto:!0,forced:function(t){return Yle(function(){return!!nB[t]()||""[t]()!==""||qle&&nB[t].name!==t})}("trim")},{trim:function(){return Xle(this)}});var Jle=nc("String").trim,Qle=N,Zle=Jle,HD=String.prototype,eue=function(t){var r=t.trim;return typeof t=="string"||t===HD||Qle(HD,t)&&r===HD.trim?Zle:r},co=l(eue),rB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const u=s.type;return o.push("typ"),o.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},u=s.indexOf(":",o);return u>-1?(c.attribute=s.substring(o+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],u=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(_){const E=r.parseRtpMap(_),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),_=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(E=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(P.parameters.apt,10)};_&&E&&(k.rtx={ssrc:E}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let u;const h=o!==void 0?o:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(rB);var iB=rB.exports,wv=l(iB),tue=i({__proto__:null,default:wv},[iB]);function sA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=wv.parseCandidate(s.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,I_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function $D(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||I_(t,"icecandidate",r=>{if(r.candidate){const s=wv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function oA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const _=wv.splitSections(m.sdp);return _.shift(),_.some(E=>{const S=wv.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const E=parseInt(_[1],10);return E!=E?-1:E},c=function(m){let _=65536;return r.browser==="firefox"&&(_=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),_},u=function(m,_){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=wv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&_!==-1&&(E=2147483637),E},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),_=c(m),E=u(arguments[0],m);let S;S=_===0&&E===0?Number.POSITIVE_INFINITY:_===0||E===0?Math.max(_,E):Math.min(_,E);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function aA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},I_(t,"datachannel",o=>(r(o.channel,o.target),o))}function KD(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function qD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>co(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function cA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ut.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ut.resolve())})}function lA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var nue=Object.freeze({__proto__:null,removeExtmapAllowMixed:qD,shimAddIceCandidateNullOrEmpty:cA,shimConnectionState:KD,shimMaxMessageSize:oA,shimParameterlessSetLocalDescription:lA,shimRTCIceCandidate:sA,shimRTCIceCandidateRelayProtocol:$D,shimSendThrowTypeError:aA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=y5,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=iA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=iA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=iA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:o,commonShim:nue,extractVersion:iA,disableLog:jle,disableWarnings:Ble,sdp:tue};switch(o.browser){case"chrome":if(!N5||!WD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=N5,cA(t,o),lA(t),T5(t,o),w5(t),WD(t,o),C5(t),O5(t,o),R5(t),I5(t),A5(t),k5(t,o),sA(t),$D(t),KD(t),oA(t,o),aA(t),qD(t,o);break;case"firefox":if(!z5||!zD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=z5,cA(t,o),lA(t),D5(t,o),zD(t,o),x5(t),U5(t),L5(t),M5(t),V5(t),F5(t),j5(t),B5(t),W5(t),sA(t),KD(t),oA(t,o),aA(t);break;case"safari":if(!Z5||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=Z5,cA(t,o),lA(t),Y5(t),J5(t),$5(t),G5(t),H5(t),X5(t),K5(t),Q5(t),sA(t),$D(t),oA(t,o),aA(t),qD(t,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var sB=_s,rue=TypeError,oB=dr.match(/firefox\/(\d+)/i),iue=!!oB&&+oB[1],sue=/MSIE|Trident/.test(dr),aB=dr.match(/AppleWebKit\/(\d+)\./),oue=!!aB&&+aB[1],aue=Vn,cB=A,cue=ys,lue=Bo,lB=hi,uue=function(t,r){if(!delete t[r])throw rue("Cannot delete property "+sB(r)+" of "+sB(t))},uB=Ia,YD=d,due=v3,hue=Tf,dB=iue,fue=sue,hB=ii,fB=oue,Om=[],pB=cB(Om.sort),pue=cB(Om.push),mue=YD(function(){Om.sort(void 0)}),gue=YD(function(){Om.sort(null)}),_ue=hue("sort"),mB=!YD(function(){if(hB)return hB<70;if(!(dB&&dB>3)){if(fue)return!0;if(fB)return fB<603;var t,r,s,o,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)Om.push({k:r+o,v:s})}for(Om.sort(function(u,h){return h.v-u.v}),o=0;o<Om.length;o++)r=Om[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});aue({target:"Array",proto:!0,forced:mue||!gue||!_ue||!mB},{sort:function(t){t!==void 0&&cue(t);var r=lue(this);if(mB)return t===void 0?pB(r):pB(r,t);var s,o,c=[],u=lB(r);for(o=0;o<u;o++)o in r&&pue(c,r[o]);for(due(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:uB(m)>uB(_)?1:-1}}(t)),s=lB(c),o=0;o<s;)r[o]=c[o++];for(;o<u;)uue(r,o++);return r}});var yue=nc("Array").sort,Eue=N,vue=yue,XD=Array.prototype,Sue=function(t){var r=t.sort;return t===XD||Eue(XD,t)&&r===XD.sort?vue:r},sT=l(Sue),JD=F;Vn({global:!0,forced:JD.globalThis!==JD},{globalThis:JD});var gB=l(F),QD={exports:{}};(function(t,r){(function(s,o){var c="function",u="undefined",h="object",m="string",_="major",E="model",S="name",R="type",P="vendor",k="version",G="architecture",U="console",j="mobile",q="tablet",Y="smarttv",le="wearable",ye="embedded",Ee="Amazon",ge="Apple",ke="ASUS",qe="BlackBerry",dt="Browser",pt="Chrome",vn="Firefox",Sn="Google",ur="Huawei",ai="LG",Hr="Microsoft",ua="Motorola",je="Opera",it="Samsung",Tt="Sharp",ze="Sony",L="Xiaomi",ie="Zebra",de="Facebook",Xe="Chromium OS",Yt="Mac OS",rr=function(Ii){for(var Xi={},Tr=0;Tr<Ii.length;Tr++)Xi[Ii[Tr].toUpperCase()]=Ii[Tr];return Xi},Yi=function(Ii,Xi){return typeof Ii===m&&ja(Xi).indexOf(ja(Ii))!==-1},ja=function(Ii){return Ii.toLowerCase()},lp=function(Ii,Xi){if(typeof Ii===m)return Ii=Ii.replace(/^\s\s*/,""),typeof Xi===u?Ii:Ii.substring(0,350)},iy=function(Ii,Xi){for(var Tr,hc,Dh,ci,Bn,Ba,Qm=0;Qm<Xi.length&&!Bn;){var Td=Xi[Qm],z$=Xi[Qm+1];for(Tr=hc=0;Tr<Td.length&&!Bn&&Td[Tr];)if(Bn=Td[Tr++].exec(Ii))for(Dh=0;Dh<z$.length;Dh++)Ba=Bn[++hc],typeof(ci=z$[Dh])===h&&ci.length>0?ci.length===2?typeof ci[1]==c?this[ci[0]]=ci[1].call(this,Ba):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==c||ci[1].exec&&ci[1].test?this[ci[0]]=Ba?Ba.replace(ci[1],ci[2]):o:this[ci[0]]=Ba?ci[1].call(this,Ba,ci[2]):o:ci.length===4&&(this[ci[0]]=Ba?ci[3].call(this,Ba.replace(ci[1],ci[2])):o):this[ci]=Ba||o;Qm+=2}},cw=function(Ii,Xi){for(var Tr in Xi)if(typeof Xi[Tr]===h&&Xi[Tr].length>0){for(var hc=0;hc<Xi[Tr].length;hc++)if(Yi(Xi[Tr][hc],Ii))return Tr==="?"?o:Tr}else if(Yi(Xi[Tr],Ii))return Tr==="?"?o:Tr;return Ii},oO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},aO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+dt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+dt],k],[/\bfocus\/([\w\.]+)/i],[k,[S,vn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+dt]],[/fxios\/([-\w\.]+)/i],[k,[S,vn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+dt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+dt],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,de],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,pt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,pt+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+dt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,cw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,vn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,ja]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",ja]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,ja]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[P,it],[R,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[P,it],[R,j]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[P,ge],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[P,ge],[R,q]],[/(macintosh);/i],[E,[P,ge]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[P,Tt],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[P,ur],[R,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[P,ur],[R,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[P,L],[R,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[P,L],[R,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[P,"OPPO"],[R,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[P,"Vivo"],[R,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[P,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[P,ua],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[P,ua],[R,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[P,ai],[R,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[P,ai],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[P,"Lenovo"],[R,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[P,"Nokia"],[R,j]],[/(pixel c)\b/i],[E,[P,Sn],[R,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[P,Sn],[R,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[P,ze],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[P,ze],[R,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[P,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[P,Ee],[R,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[E,P,[R,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[P,qe],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[P,ke],[R,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[P,ke],[R,j]],[/(nexus 9)/i],[E,[P,"HTC"],[R,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[E,/_/g," "],[R,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[P,"Acer"],[R,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[P,"Meizu"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,E,[R,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,E,[R,q]],[/(surface duo)/i],[E,[P,Hr],[R,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[P,"Fairphone"],[R,j]],[/(u304aa)/i],[E,[P,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[E,[P,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[E,[P,"RCA"],[R,q]],[/\b(venue[\d ]{2,7}) b/i],[E,[P,"Dell"],[R,q]],[/\b(q(?:mv|ta)\w+) b/i],[E,[P,"Verizon"],[R,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[P,"Barnes & Noble"],[R,q]],[/\b(tm\d{3}\w+) b/i],[E,[P,"NuVision"],[R,q]],[/\b(k88) b/i],[E,[P,"ZTE"],[R,q]],[/\b(nx\d{3}j) b/i],[E,[P,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[E,[P,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[E,[P,"Swiss"],[R,q]],[/\b((zeki)?tb.*\b) b/i],[E,[P,"Zeki"],[R,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],E,[R,q]],[/\b(ns-?\w{0,9}) b/i],[E,[P,"Insignia"],[R,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[P,"NextBook"],[R,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],E,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],E,[R,j]],[/\b(ph-1) /i],[E,[P,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[P,"Envizen"],[R,q]],[/\b(trio[-\w\. ]+) b/i],[E,[P,"MachSpeed"],[R,q]],[/\btu_(1491) b/i],[E,[P,"Rotor"],[R,q]],[/(shield[\w ]+) b/i],[E,[P,"Nvidia"],[R,q]],[/(sprint) (\w+)/i],[P,E,[R,j]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[P,Hr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[P,ie],[R,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[P,ie],[R,j]],[/smart-tv.+(samsung)/i],[P,[R,Y]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[P,it],[R,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ai],[R,Y]],[/(apple) ?tv/i],[P,[E,ge+" TV"],[R,Y]],[/crkey/i],[[E,pt+"cast"],[P,Sn],[R,Y]],[/droid.+aft(\w)( bui|\))/i],[E,[P,Ee],[R,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[P,Tt],[R,Y]],[/(bravia[\w ]+)( bui|\))/i],[E,[P,ze],[R,Y]],[/(mitv-\w{5}) bui/i],[E,[P,L],[R,Y]],[/Hbbtv.*(technisat) (.*);/i],[P,E,[R,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,lp],[E,lp],[R,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,E,[R,U]],[/droid.+; (shield) bui/i],[E,[P,"Nvidia"],[R,U]],[/(playstation [345portablevi]+)/i],[E,[P,ze],[R,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[P,Hr],[R,U]],[/((pebble))app/i],[P,E,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[P,ge],[R,le]],[/droid.+; (glass) \d/i],[E,[P,Sn],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[E,[P,ie],[R,le]],[/(quest( 2| pro)?)/i],[E,[P,de],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[R,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,cw,oO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,cw,oO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Yt],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,qe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,vn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,pt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Xe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},Pl=function(Ii,Xi){if(typeof Ii===h&&(Xi=Ii,Ii=o),!(this instanceof Pl))return new Pl(Ii,Xi).getResult();var Tr=typeof s!==u&&s.navigator?s.navigator:o,hc=Ii||(Tr&&Tr.userAgent?Tr.userAgent:""),Dh=Tr&&Tr.userAgentData?Tr.userAgentData:o,ci=Xi?function(Bn,Ba){var Qm={};for(var Td in Bn)Ba[Td]&&Ba[Td].length%2==0?Qm[Td]=Ba[Td].concat(Bn[Td]):Qm[Td]=Bn[Td];return Qm}(aO,Xi):aO;return this.getBrowser=function(){var Bn={};return Bn[S]=o,Bn[k]=o,iy.call(Bn,hc,ci.browser),Bn[_]=function(Ba){return typeof Ba===m?Ba.replace(/[^\d\.]/g,"").split(".")[0]:o}(Bn[k]),Tr&&Tr.brave&&typeof Tr.brave.isBrave==c&&(Bn[S]="Brave"),Bn},this.getCPU=function(){var Bn={};return Bn[G]=o,iy.call(Bn,hc,ci.cpu),Bn},this.getDevice=function(){var Bn={};return Bn[P]=o,Bn[E]=o,Bn[R]=o,iy.call(Bn,hc,ci.device),!Bn[R]&&Dh&&Dh.mobile&&(Bn[R]=j),Bn[E]=="Macintosh"&&Tr&&typeof Tr.standalone!==u&&Tr.maxTouchPoints&&Tr.maxTouchPoints>2&&(Bn[E]="iPad",Bn[R]=q),Bn},this.getEngine=function(){var Bn={};return Bn[S]=o,Bn[k]=o,iy.call(Bn,hc,ci.engine),Bn},this.getOS=function(){var Bn={};return Bn[S]=o,Bn[k]=o,iy.call(Bn,hc,ci.os),!Bn[S]&&Dh&&Dh.platform!="Unknown"&&(Bn[S]=Dh.platform.replace(/chrome os/i,Xe).replace(/macos/i,Yt)),Bn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return hc},this.setUA=function(Bn){return hc=typeof Bn===m&&Bn.length>350?lp(Bn,350):Bn,this},this.setUA(hc),this};Pl.VERSION="0.7.34",Pl.BROWSER=rr([S,k,_]),Pl.CPU=rr([G]),Pl.DEVICE=rr([E,P,R,U,j,Y,q,le,ye]),Pl.ENGINE=Pl.OS=rr([S,k]),t.exports&&(r=t.exports=Pl),r.UAParser=Pl;var Jm=typeof s!==u&&(s.jQuery||s.Zepto);if(Jm&&!Jm.ua){var sy=new Pl;Jm.ua=sy.getResult(),Jm.ua.get=function(){return sy.getUA()},Jm.ua.set=function(Ii){sy.setUA(Ii);var Xi=sy.getResult();for(var Tr in Xi)Jm.ua[Tr]=Xi[Tr]}}})(typeof window=="object"?window:a)})(QD,QD.exports);var bue=l(QD.exports),Tue=Ac,wue=Si,Cue=Lt,Rue=th,Iue=pr("iterator"),Aue=Object,Pue=function(t){if(Cue(t))return!1;var r=Aue(t);return r[Iue]!==void 0||"@@iterator"in r||wue(Rue,Tue(r))},Oue=l(Pue),_B=ev.clear;Vn({global:!0,bind:!0,forced:F.clearImmediate!==_B},{clearImmediate:_B});var kue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",yB=F,Nue=te,Due=Me,xue=kue,Lue=dr,Mue=Ts,Uue=_l,Vue=yB.Function,Fue=/MSIE .\./.test(Lue)||xue&&function(){var t=yB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),jue=Vn,EB=F,vB=ev.set,Bue=function(t,r){var s=1;return Fue?function(o,c){var u=Uue(arguments.length,1)>s,h=Due(o)?o:Vue(o),m=u?Mue(arguments,s):[],_=u?function(){Nue(h,this,m)}:h;return t(_)}:t},SB=EB.setImmediate?Bue(vB):vB;jue({global:!0,bind:!0,forced:EB.setImmediate!==SB},{setImmediate:SB});var bB=l(vt.setImmediate),Wue=Vn,zue=ac,Gue=ys,Hue=_l,$ue=wf,Kue=F.process;Wue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Hue(arguments.length,1),Gue(t);var r=$ue&&Kue.domain;zue(r?r.bind(t):t)}});var TB=l(vt.queueMicrotask);function wB(t,r){return function(){return t.apply(r,arguments)}}const{toString:que}=Object.prototype,{getPrototypeOf:ZD}=Object,uA=(ex=Object.create(null),t=>{const r=que.call(t);return ex[r]||(ex[r]=r.slice(8,-1).toLowerCase())});var ex;const ud=t=>(t=t.toLowerCase(),r=>uA(r)===t),dA=t=>r=>typeof r===t,{isArray:Cv}=Array,oT=dA("undefined"),CB=ud("ArrayBuffer"),Yue=dA("string"),El=dA("function"),RB=dA("number"),hA=t=>t!==null&&typeof t=="object",fA=t=>{if(uA(t)!=="object")return!1;const r=ZD(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Oue(t))},Xue=ud("Date"),Jue=ud("File"),Que=ud("Blob"),Zue=ud("FileList"),ede=ud("URLSearchParams"),[tde,nde,rde,ide]=["ReadableStream","Request","Response","Headers"].map(ud);function aT(t,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Cv(t))for(s=0,o=t.length;s<o;s++)r.call(null,t[s],s,t);else{const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,t[m],m,t)}}function IB(t,r){r=r.toLowerCase();const s=Object.keys(t);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const A_=gB!==void 0?gB:typeof self<"u"?self:typeof window<"u"?window:my,AB=t=>!oT(t)&&t!==A_,sde=(tx=typeof Uint8Array<"u"&&ZD(Uint8Array),t=>tx&&t instanceof tx);var tx;const ode=ud("HTMLFormElement"),PB=(t=>{let{hasOwnProperty:r}=t;return(s,o)=>r.call(s,o)})(Object.prototype),ade=ud("RegExp"),OB=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),o={};aT(s,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(o[u]=h||c)}),Object.defineProperties(t,o)},nx="abcdefghijklmnopqrstuvwxyz",kB="0123456789",NB={DIGIT:kB,ALPHA:nx,ALPHA_DIGIT:nx+nx.toUpperCase()+kB},cde=ud("AsyncFunction"),DB=(xB=typeof bB=="function",LB=El(A_.postMessage),xB?bB:LB?(rx="axios@".concat(Math.random()),pA=[],A_.addEventListener("message",t=>{let{source:r,data:s}=t;r===A_&&s===rx&&pA.length&&pA.shift()()},!1),t=>{pA.push(t),A_.postMessage(rx,"*")}):t=>setTimeout(t));var xB,LB,rx,pA;const lde=TB!==void 0?TB.bind(A_):typeof process<"u"&&process.nextTick||DB;var lt={isArray:Cv,isArrayBuffer:CB,isBuffer:function(t){return t!==null&&!oT(t)&&t.constructor!==null&&!oT(t.constructor)&&El(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||El(t.append)&&((r=uA(t))==="formdata"||r==="object"&&El(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&CB(t.buffer),r},isString:Yue,isNumber:RB,isBoolean:t=>t===!0||t===!1,isObject:hA,isPlainObject:fA,isReadableStream:tde,isRequest:nde,isResponse:rde,isHeaders:ide,isUndefined:oT,isDate:Xue,isFile:Jue,isBlob:Que,isRegExp:ade,isFunction:El,isStream:t=>hA(t)&&El(t.pipe),isURLSearchParams:ede,isTypedArray:sde,isFileList:Zue,forEach:aT,merge:function t(){const{caseless:r}=AB(this)&&this||{},s={},o=(c,u)=>{const h=r&&IB(s,u)||u;fA(s[h])&&fA(c)?s[h]=t(s[h],c):fA(c)?s[h]=t({},c):Cv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&aT(arguments[c],o);return s},extend:function(t,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return aT(r,(c,u)=>{s&&El(c)?t[u]=wB(c,s):t[u]=c},{allOwnKeys:o}),t},trim:t=>co(t)?co(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,o)=>{t.prototype=Object.create(r.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,o)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],o&&!o(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&ZD(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:uA,kindOfTest:ud,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const o=t.indexOf(r,s);return o!==-1&&o===s},toArray:t=>{if(!t)return null;if(Cv(t))return t;let r=t.length;if(!RB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const o=[];for(;(s=t.exec(r))!==null;)o.push(s);return o},isHTMLForm:ode,hasOwnProperty:PB,hasOwnProp:PB,reduceDescriptors:OB,freezeMethods:t=>{OB(t,(r,s)=>{if(El(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=t[s];El(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},o=c=>{c.forEach(u=>{s[u]=!0})};return Cv(t)?o(t):o(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:IB,global:A_,isContextDefined:AB,ALPHABET:NB,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:NB.ALPHA_DIGIT,s="";const{length:o}=r;for(;t--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(t){return!!(t&&El(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(o,c)=>{if(hA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=Cv(o)?[]:{};return aT(o,(h,m)=>{const _=s(h,c+1);!oT(_)&&(u[m]=_)}),r[c]=void 0,u}}return o};return s(t,0)},isAsyncFn:cde,isThenable:t=>t&&(hA(t)||El(t))&&El(t.then)&&El(t.catch),setImmediate:DB,asap:lde};function tr(t,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}lt.inherits(tr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const MB=tr.prototype,UB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{UB[t]={value:t}}),Object.defineProperties(tr,UB),Object.defineProperty(MB,"isAxiosError",{value:!0}),tr.from=(t,r,s,o,c,u)=>{const h=Object.create(MB);return lt.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),tr.call(h,t.message,r,s,o,c),h.cause=t,h.name=t.name,u&&Object.assign(h,u),h};function ix(t){return lt.isPlainObject(t)||lt.isArray(t)}function VB(t){return lt.endsWith(t,"[]")?t.slice(0,-2):t}function FB(t,r,s){return t?t.concat(r).map(function(o,c){return o=VB(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const ude=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function mA(t,r,s){if(!lt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=lt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!lt.isUndefined(k[P])})).metaTokens,c=s.visitor||E,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(r);if(!lt.isFunction(c))throw new TypeError("visitor must be a function");function _(P){if(P===null)return"";if(lt.isDate(P))return P.toISOString();if(!m&&lt.isBlob(P))throw new tr("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(P)||lt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function E(P,k,G){let U=P;if(P&&!G&&typeof P=="object"){if(lt.endsWith(k,"{}"))k=o?k:k.slice(0,-2),P=JSON.stringify(P);else if(lt.isArray(P)&&function(j){return lt.isArray(j)&&!j.some(ix)}(P)||(lt.isFileList(P)||lt.endsWith(k,"[]"))&&(U=lt.toArray(P)))return k=VB(k),U.forEach(function(j,q){!lt.isUndefined(j)&&j!==null&&r.append(h===!0?FB([k],q,u):h===null?k:k+"[]",_(j))}),!1}return!!ix(P)||(r.append(FB(G,k,u),_(P)),!1)}const S=[],R=Object.assign(ude,{defaultVisitor:E,convertValue:_,isVisitable:ix});if(!lt.isObject(t))throw new TypeError("data must be an object");return function P(k,G){if(!lt.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(k),lt.forEach(k,function(U,j){(!(lt.isUndefined(U)||U===null)&&c.call(r,U,lt.isString(j)?co(j).call(j):j,G,R))===!0&&P(U,G?G.concat(j):[j])}),S.pop()}}(t),r}function jB(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function sx(t,r){this._pairs=[],t&&mA(t,this,r)}const BB=sx.prototype;function dde(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function WB(t,r,s){if(!r)return t;const o=s&&s.encode||dde;lt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):lt.isURLSearchParams(r)?r.toString():new sx(r,s).toString(o),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}BB.append=function(t,r){this._pairs.push([t,r])},BB.toString=function(t){const r=t?function(s){return t.call(this,s,jB)}:jB;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var zB=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(r){r!==null&&t(r)})}},GB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},HB={exports:{}},hde=Vn,fde=nt,$B=et.f;hde({target:"Object",stat:!0,forced:Object.defineProperty!==$B,sham:!fde},{defineProperty:$B});var KB=vt.Object,pde=HB.exports=function(t,r,s){return KB.defineProperty(t,r,s)};KB.defineProperty.sham&&(pde.sham=!0);var qB=l(HB.exports),mde=TypeError,YB=$g,gde=m_,_de=at,yde=pr("species"),XB=Array,Ede=function(t){var r;return YB(t)&&(r=t.constructor,(gde(r)&&(r===XB||YB(r.prototype))||_de(r)&&(r=r[yde])===null)&&(r=void 0)),r===void 0?XB:r},JB=function(t,r){return new(Ede(t))(r===0?0:r)},vde=d,Sde=ii,bde=pr("species"),QB=function(t){return Sde>=51||!vde(function(){var r=[];return(r.constructor={})[bde]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Tde=Vn,wde=d,Cde=$g,Rde=at,Ide=Bo,Ade=hi,ZB=function(t){if(t>9007199254740991)throw mde("Maximum allowed index exceeded");return t},e6=HI,Pde=JB,Ode=QB,kde=ii,t6=pr("isConcatSpreadable"),Nde=kde>=51||!wde(function(){var t=[];return t[t6]=!1,t.concat()[0]!==t}),Dde=function(t){if(!Rde(t))return!1;var r=t[t6];return r!==void 0?!!r:Cde(t)};Tde({target:"Array",proto:!0,forced:!Nde||!Ode("concat")},{concat:function(t){var r,s,o,c,u,h=Ide(this),m=Pde(h,0),_=0;for(r=-1,o=arguments.length;r<o;r++)if(Dde(u=r===-1?h:arguments[r]))for(c=Ade(u),ZB(_+c),s=0;s<c;s++,_++)s in u&&e6(m,_,u[s]);else ZB(_+1),e6(m,_++,u);return m.length=_,m}});var n6={},xde=ne,Lde=Ce,r6=Qd.f,Mde=cD,i6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n6.f=function(t){return i6&&xde(t)=="Window"?function(r){try{return r6(r)}catch{return Mde(i6)}}(t):r6(Lde(t))};var Rv={},Ude=pr;Rv.f=Ude;var s6=vt,Vde=Si,Fde=Rv,jde=et.f,Rs=function(t){var r=s6.Symbol||(s6.Symbol={});Vde(r,t)||jde(r,t,{value:Fde.f(t)})},Bde=ve,Wde=cn,zde=pr,Gde=nd,o6=function(){var t=Wde("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,o=zde("toPrimitive");r&&!r[o]&&Gde(r,o,function(c){return Bde(s,this)},{})},Hde=De,$de=un,Kde=Bo,qde=hi,Yde=JB,a6=A([].push),Xde=function(t){var r=t==1,s=t==2,o=t==3,c=t==4,u=t==6,h=t==7,m=t==5||u;return function(_,E,S,R){for(var P,k,G=Kde(_),U=$de(G),j=Hde(E,S),q=qde(U),Y=0,le=R||Yde,ye=r?le(_,q):s||h?le(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=j(P=U[Y],Y,G),t))if(r)ye[Y]=k;else if(k)switch(t){case 3:return!0;case 5:return P;case 6:return Y;case 2:a6(ye,P)}else switch(t){case 4:return!1;case 7:a6(ye,P)}return u?-1:o||c?c:ye}},c6={forEach:Xde(0)},gA=Vn,ox=F,ax=ve,Jde=A,Iv=nt,Av=xi,Qde=d,Ro=Si,Zde=N,cx=ln,_A=Ce,lx=ec,ehe=Ia,ux=Qe,cT=Zo,l6=kc,the=Qd,u6=n6,nhe=Oc,d6=He,h6=et,rhe=fE,f6=Ne,p6=nd,ihe=FE,dx=Qa,m6=Pc,g6=Hd,she=pr,ohe=Rv,ahe=Rs,che=o6,lhe=rd,_6=td,yA=c6.forEach,jc=qg("hidden"),EA="Symbol",lT="prototype",uhe=_6.set,y6=_6.getterFor(EA),dd=Object[lT],P_=ox.Symbol,vA=P_&&P_[lT],dhe=ox.TypeError,hx=ox.QObject,E6=d6.f,O_=h6.f,v6=u6.f,hhe=f6.f,S6=Jde([].push),Kf=dx("symbols"),uT=dx("op-symbols"),fhe=dx("wks"),fx=!hx||!hx[lT]||!hx[lT].findChild,px=Iv&&Qde(function(){return cT(O_({},"a",{get:function(){return O_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var o=E6(dd,r);o&&delete dd[r],O_(t,r,s),o&&t!==dd&&O_(dd,r,o)}:O_,mx=function(t,r){var s=Kf[t]=cT(vA);return uhe(s,{type:EA,tag:t,description:r}),Iv||(s.description=r),s},SA=function(t,r,s){t===dd&&SA(uT,r,s),cx(t);var o=lx(r);return cx(s),Ro(Kf,o)?(s.enumerable?(Ro(t,jc)&&t[jc][o]&&(t[jc][o]=!1),s=cT(s,{enumerable:ux(0,!1)})):(Ro(t,jc)||O_(t,jc,ux(1,{})),t[jc][o]=!0),px(t,o,s)):O_(t,o,s)},gx=function(t,r){cx(t);var s=_A(r),o=l6(s).concat(C6(s));return yA(o,function(c){Iv&&!ax(b6,s,c)||SA(t,c,s[c])}),t},b6=function(t){var r=lx(t),s=ax(hhe,this,r);return!(this===dd&&Ro(Kf,r)&&!Ro(uT,r))&&(!(s||!Ro(this,r)||!Ro(Kf,r)||Ro(this,jc)&&this[jc][r])||s)},T6=function(t,r){var s=_A(t),o=lx(r);if(s!==dd||!Ro(Kf,o)||Ro(uT,o)){var c=E6(s,o);return!c||!Ro(Kf,o)||Ro(s,jc)&&s[jc][o]||(c.enumerable=!0),c}},w6=function(t){var r=v6(_A(t)),s=[];return yA(r,function(o){Ro(Kf,o)||Ro(m6,o)||S6(s,o)}),s},C6=function(t){var r=t===dd,s=v6(r?uT:_A(t)),o=[];return yA(s,function(c){!Ro(Kf,c)||r&&!Ro(dd,c)||S6(o,Kf[c])}),o};Av||(P_=function(){if(Zde(vA,this))throw dhe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?ehe(arguments[0]):void 0,r=g6(t),s=function(o){this===dd&&ax(s,uT,o),Ro(this,jc)&&Ro(this[jc],r)&&(this[jc][r]=!1),px(this,r,ux(1,o))};return Iv&&fx&&px(dd,r,{configurable:!0,set:s}),mx(r,t)},p6(vA=P_[lT],"toString",function(){return y6(this).tag}),p6(P_,"withoutSetter",function(t){return mx(g6(t),t)}),f6.f=b6,h6.f=SA,rhe.f=gx,d6.f=T6,the.f=u6.f=w6,nhe.f=C6,ohe.f=function(t){return mx(she(t),t)},Iv&&ihe(vA,"description",{configurable:!0,get:function(){return y6(this).description}})),gA({global:!0,wrap:!0,forced:!Av,sham:!Av},{Symbol:P_}),yA(l6(fhe),function(t){ahe(t)}),gA({target:EA,stat:!0,forced:!Av},{useSetter:function(){fx=!0},useSimple:function(){fx=!1}}),gA({target:"Object",stat:!0,forced:!Av,sham:!Iv},{create:function(t,r){return r===void 0?cT(t):gx(cT(t),r)},defineProperty:SA,defineProperties:gx,getOwnPropertyDescriptor:T6}),gA({target:"Object",stat:!0,forced:!Av},{getOwnPropertyNames:w6}),che(),lhe(P_,EA),m6[jc]=!0;var R6=xi&&!!Symbol.for&&!!Symbol.keyFor,phe=Vn,mhe=cn,ghe=Si,_he=Ia,I6=Qa,yhe=R6,_x=I6("string-to-symbol-registry"),Ehe=I6("symbol-to-string-registry");phe({target:"Symbol",stat:!0,forced:!yhe},{for:function(t){var r=_he(t);if(ghe(_x,r))return _x[r];var s=mhe("Symbol")(r);return _x[r]=s,Ehe[s]=r,s}});var vhe=Vn,She=Si,bhe=va,The=_s,whe=R6,A6=Qa("symbol-to-string-registry");vhe({target:"Symbol",stat:!0,forced:!whe},{keyFor:function(t){if(!bhe(t))throw TypeError(The(t)+" is not a symbol");if(She(A6,t))return A6[t]}});var P6=$g,Che=Me,O6=ne,Rhe=Ia,k6=A([].push),Ihe=Vn,N6=cn,D6=te,Ahe=ve,dT=A,x6=d,L6=Me,M6=va,U6=Ts,Phe=function(t){if(Che(t))return t;if(P6(t)){for(var r=t.length,s=[],o=0;o<r;o++){var c=t[o];typeof c=="string"?k6(s,c):typeof c!="number"&&O6(c)!="Number"&&O6(c)!="String"||k6(s,Rhe(c))}var u=s.length,h=!0;return function(m,_){if(h)return h=!1,_;if(P6(this))return _;for(var E=0;E<u;E++)if(s[E]===m)return _}}},Ohe=xi,khe=String,km=N6("JSON","stringify"),bA=dT(/./.exec),V6=dT("".charAt),Nhe=dT("".charCodeAt),Dhe=dT("".replace),xhe=dT(1 .toString),Lhe=/[\uD800-\uDFFF]/g,F6=/^[\uD800-\uDBFF]$/,j6=/^[\uDC00-\uDFFF]$/,B6=!Ohe||x6(function(){var t=N6("Symbol")();return km([t])!="[null]"||km({a:t})!="{}"||km(Object(t))!="{}"}),W6=x6(function(){return km("\uDF06\uD834")!=='"\\udf06\\ud834"'||km("\uDEAD")!=='"\\udead"'}),Mhe=function(t,r){var s=U6(arguments),o=Phe(r);if(L6(o)||t!==void 0&&!M6(t))return s[1]=function(c,u){if(L6(o)&&(u=Ahe(o,this,khe(c),u)),!M6(u))return u},D6(km,null,s)},Uhe=function(t,r,s){var o=V6(s,r-1),c=V6(s,r+1);return bA(F6,t)&&!bA(j6,c)||bA(j6,t)&&!bA(F6,o)?"\\u"+xhe(Nhe(t,0),16):t};km&&Ihe({target:"JSON",stat:!0,forced:B6||W6},{stringify:function(t,r,s){var o=U6(arguments),c=D6(B6?Mhe:km,null,o);return W6&&typeof c=="string"?Dhe(c,Lhe,Uhe):c}});var z6=Oc,Vhe=Bo;Vn({target:"Object",stat:!0,forced:!xi||d(function(){z6.f(1)})},{getOwnPropertySymbols:function(t){var r=z6.f;return r?r(Vhe(t)):[]}}),Rs("asyncIterator"),Rs("hasInstance"),Rs("isConcatSpreadable"),Rs("iterator"),Rs("match"),Rs("matchAll"),Rs("replace"),Rs("search"),Rs("species"),Rs("split");var Fhe=o6;Rs("toPrimitive"),Fhe();var jhe=cn,Bhe=rd;Rs("toStringTag"),Bhe(jhe("Symbol"),"Symbol"),Rs("unscopables"),rd(F.JSON,"JSON",!0);var Whe=vt.Symbol,zhe=pr,Ghe=et.f,G6=zhe("metadata"),H6=Function.prototype;H6[G6]===void 0&&Ghe(H6,G6,{value:null}),Rs("dispose"),Rs("metadata");var Hhe=Whe;Rs("asyncDispose");var $he=A,yx=cn("Symbol"),Khe=yx.keyFor,qhe=$he(yx.prototype.valueOf),$6=yx.isRegisteredSymbol||function(t){try{return Khe(qhe(t))!==void 0}catch{return!1}};Vn({target:"Symbol",stat:!0},{isRegisteredSymbol:$6});for(var Yhe=Qa,K6=cn,Xhe=A,Jhe=va,Qhe=pr,TA=K6("Symbol"),q6=TA.isWellKnownSymbol,Y6=K6("Object","getOwnPropertyNames"),Zhe=Xhe(TA.prototype.valueOf),X6=Yhe("wks"),Ex=0,J6=Y6(TA),efe=J6.length;Ex<efe;Ex++)try{var Q6=J6[Ex];Jhe(TA[Q6])&&Qhe(Q6)}catch{}var Z6=function(t){if(q6&&q6(t))return!0;try{for(var r=Zhe(t),s=0,o=Y6(X6),c=o.length;s<c;s++)if(X6[o[s]]==r)return!0}catch{}return!1};Vn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Z6}),Rs("matcher"),Rs("observable"),Vn({target:"Symbol",stat:!0},{isRegistered:$6}),Vn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:Z6}),Rs("metadataKey"),Rs("patternMatch"),Rs("replaceAll");var Pv=l(Hhe),eW=l(Rv.f("iterator"));function hT(t){return hT=typeof Pv=="function"&&typeof eW=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Pv=="function"&&r.constructor===Pv&&r!==Pv.prototype?"symbol":typeof r},hT(t)}var tfe=l(Rv.f("toPrimitive"));function nfe(t){var r=function(s,o){if(hT(s)!=="object"||s===null)return s;var c=s[tfe];if(c!==void 0){var u=c.call(s,o);if(hT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(t,"string");return hT(r)==="symbol"?r:String(r)}function K(t,r,s){return(r=nfe(r))in t?qB(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var tW=l(Mce),rfe={isBrowser:!0,classes:{URLSearchParams:tW!==void 0?tW:sx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const vx=typeof window<"u"&&typeof document<"u",Sx=typeof navigator=="object"&&navigator||void 0,ife=vx&&(!Sx||["ReactNative","NativeScript","NS"].indexOf(Sx.product)<0),sfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ofe=vx&&window.location.href||"http://localhost";function nW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function rW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?nW(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):nW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var La=rW(rW({},Object.freeze({__proto__:null,hasBrowserEnv:vx,hasStandardBrowserEnv:ife,hasStandardBrowserWebWorkerEnv:sfe,navigator:Sx,origin:ofe})),rfe),afe=ln,cfe=ve,lfe=Si,ufe=N,dfe=function(){var t=afe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},iW=RegExp.prototype,sW=function(t){var r=t.flags;return r!==void 0||"flags"in iW||lfe(t,"flags")||!ufe(iW,t)?r:cfe(dfe,t)},hfe=rD.charAt,oW=ve,ffe=ln,pfe=Me,mfe=ne,gfe=/./.exec,_fe=TypeError,yfe=Vn,aW=ve,cW=se,Efe=kE,wA=ME,lW=Kt,uW=Mt,fT=Ia,vfe=ln,Sfe=Lt,bfe=ne,Tfe=CR,dW=sW,wfe=bc,Cfe=d,Rfe=ts,Ife=function(t,r,s){return r+(s?hfe(t,r).length:1)},Afe=function(t,r){var s=t.exec;if(pfe(s)){var o=oW(s,t,r);return o!==null&&ffe(o),o}if(mfe(t)==="RegExp")return oW(gfe,t,r);throw _fe("RegExp#exec called on incompatible receiver")},hW=td,Pfe=pr("matchAll"),fW="RegExp String",pW=fW+" Iterator",Ofe=hW.set,kfe=hW.getterFor(pW),Nfe=TypeError,bx=cW("".indexOf),CA=cW("".matchAll),Tx=!!CA&&!Cfe(function(){CA("a",/./)}),Dfe=Efe(function(t,r,s,o){Ofe(this,{type:pW,regexp:t,string:r,global:s,unicode:o,done:!1})},fW,function(){var t=kfe(this);if(t.done)return wA(void 0,!0);var r=t.regexp,s=t.string,o=Afe(r,s);return o===null?(t.done=!0,wA(void 0,!0)):t.global?(fT(o[0])===""&&(r.lastIndex=Ife(s,uW(r.lastIndex),t.unicode)),wA(o,!1)):(t.done=!0,wA(o,!1))}),mW=function(t){var r,s,o,c=vfe(this),u=fT(t),h=Rfe(c,RegExp),m=fT(dW(c));return r=new h(h===RegExp?c.source:c,m),s=!!~bx(m,"g"),o=!!~bx(m,"u"),r.lastIndex=uW(c.lastIndex),new Dfe(r,u,s,o)};yfe({target:"String",proto:!0,forced:Tx},{matchAll:function(t){var r,s,o,c,u=lW(this);if(Sfe(t)){if(Tx)return CA(u,t)}else{if(Tfe(t)&&(r=fT(lW(dW(t))),!~bx(r,"g")))throw Nfe("`.matchAll` does not allow non-global regexes");if(Tx)return CA(u,t);if((o=wfe(t,Pfe))===void 0&&bfe(t)=="RegExp"&&(o=mW),o)return aW(o,t,u)}return s=fT(u),c=new RegExp(t,"g"),aW(mW,c,s)}});var xfe=nc("String").matchAll,Lfe=N,Mfe=xfe,wx=String.prototype,Ufe=function(t){var r=t.matchAll;return typeof t=="string"||t===wx||Lfe(wx,t)&&r===wx.matchAll?Mfe:r},Vfe=l(Ufe);function gW(t){function r(s,o,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=s.length;return h=!h&&lt.isArray(c)?c.length:h,_?(lt.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&lt.isObject(c[h])||(c[h]=[]),r(s,o,c[h],u)&&lt.isArray(c[h])&&(c[h]=function(E){const S={},R=Object.keys(E);let P;const k=R.length;let G;for(P=0;P<k;P++)G=R[P],S[G]=E[G];return S}(c[h])),!m)}if(lt.isFormData(t)&&lt.isFunction(t.entries)){const s={};return lt.forEachEntry(t,(o,c)=>{r(function(u){return Vfe(lt).call(lt,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const Cx={transitional:GB,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=lt.isObject(t);if(c&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return o?JSON.stringify(gW(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return mA(h,new La.classes.URLSearchParams,Object.assign({visitor:function(_,E,S,R){return La.isNode&&lt.isBuffer(_)?(this.append(E,_.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((u=lt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return mA(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,_){if(lt.isString(h))try{return(m||JSON.parse)(h),co(lt).call(lt,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(_||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||Cx.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(u){if(c)throw u.name==="SyntaxError"?tr.from(u,tr.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:La.classes.FormData,Blob:La.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],t=>{Cx.headers[t]={}});var Rx=Cx;const Ffe=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),_W=Symbol("internals");function pT(t){var r;return t&&co(r=String(t)).call(r).toLowerCase()}function RA(t){return t===!1||t==null?t:lt.isArray(t)?t.map(RA):String(t)}function Ix(t,r,s,o,c){return lt.isFunction(o)?o.call(this,r,s):(c&&(r=s),lt.isString(r)?lt.isString(o)?r.indexOf(o)!==-1:lt.isRegExp(o)?o.test(r):void 0:void 0)}class IA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function u(_,E,S){const R=pT(E);if(!R)throw new Error("header name must be a non-empty string");const P=lt.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||E]=RA(_))}const h=(_,E)=>lt.forEach(_,(S,R)=>u(S,R,E));if(lt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(lt.isString(r)&&(r=co(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(co(m=r).call(m)))h((_=>{const E={};let S,R,P;return _&&_.split(`
`).forEach(function(k){var G,U;P=k.indexOf(":"),S=co(G=k.substring(0,P)).call(G).toLowerCase(),R=co(U=k.substring(P+1)).call(U),!S||E[S]&&Ffe[S]||(S==="set-cookie"?E[S]?E[S].push(R):E[S]=[R]:E[S]=E[S]?E[S]+", "+R:R)}),E})(r),s);else if(lt.isHeaders(r))for(const[_,E]of r.entries())u(E,_,o);else r!=null&&u(s,r,o);var m;return this}get(r,s){if(r=pT(r)){const o=lt.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(lt.isFunction(s))return s.call(this,c,o);if(lt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=pT(r)){const o=lt.findKey(this,r);return!(!o||this[o]===void 0||s&&!Ix(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function u(h){if(h=pT(h)){const m=lt.findKey(o,h);!m||s&&!Ix(0,o[m],m,s)||(delete o[m],c=!0)}}return lt.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const u=s[o];r&&!Ix(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,o={};return lt.forEach(this,(c,u)=>{var h;const m=lt.findKey(o,u);if(m)return s[m]=RA(c),void delete s[u];const _=r?function(E){return co(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):co(h=String(u)).call(h);_!==u&&delete s[u],s[_]=RA(c),o[_]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return lt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&lt.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[_W]=this[_W]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=pT(u);s[h]||(function(m,_){const E=lt.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(R,P,k){return this[S].call(this,_,R,P,k)},configurable:!0})})}(o,u),s[h]=!0)}return lt.isArray(r)?r.forEach(c):c(r),this}}IA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),lt.reduceDescriptors(IA.prototype,(t,r)=>{let{value:s}=t,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),lt.freezeMethods(IA);var hd=IA;function Ax(t,r){const s=this||Rx,o=r||s,c=hd.from(o.headers);let u=o.data;return lt.forEach(t,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function yW(t){return!(!t||!t.__CANCEL__)}function Ov(t,r,s){tr.call(this,t??"canceled",tr.ERR_CANCELED,r,s),this.name="CanceledError"}function EW(t,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new tr("Request failed with status code "+s.status,[tr.ERR_BAD_REQUEST,tr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}lt.inherits(Ov,tr,{__CANCEL__:!0});const AA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let E,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const k=Date.now(),G=_[R];E||(E=k),m[S]=P,_[S]=k;let U=R,j=0;for(;U!==S;)j+=m[U++],U%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),k-E<h)return;const q=G&&k-G;return q?Math.round(1e3*j/q):void 0}}(50,250);return function(u,h){let m,_,E=0,S=1e3/h;const R=function(P){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,P)};return[function(){const P=Date.now(),k=P-E;for(var G=arguments.length,U=new Array(G),j=0;j<G;j++)U[j]=arguments[j];k>=S?R(U,P):(m=U,_||(_=setTimeout(()=>{_=null,R(m)},S-k)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,E=c(_);o=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},vW=(t,r)=>{const s=t!=null;return[o=>r[0]({lengthComputable:s,total:t,loaded:o}),r[1]]},SW=t=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return lt.asap(()=>t(...s))};var jfe=La.hasStandardBrowserEnv?((t,r)=>s=>(s=new rA(s,La.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new rA(La.origin),La.navigator&&/(msie|trident)/i.test(La.navigator.userAgent)):()=>!0,Bfe=La.hasStandardBrowserEnv?{write(t,r,s,o,c,u){const h=[t+"="+encodeURIComponent(r)];lt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),lt.isString(o)&&h.push("path="+o),lt.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bW(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(t,r):r}function TW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const wW=t=>t instanceof hd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?TW(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):TW(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t):t;function k_(t,r){r=r||{};const s={};function o(E,S,R,P){return lt.isPlainObject(E)&&lt.isPlainObject(S)?lt.merge.call({caseless:P},E,S):lt.isPlainObject(S)?lt.merge({},S):lt.isArray(S)?S.slice():S}function c(E,S,R,P){return lt.isUndefined(S)?lt.isUndefined(E)?void 0:o(void 0,E,0,P):o(E,S,0,P)}function u(E,S){if(!lt.isUndefined(S))return o(void 0,S)}function h(E,S){return lt.isUndefined(S)?lt.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,R){return R in r?o(E,S):R in t?o(void 0,E):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,R)=>c(wW(E),wW(S),0,!0)};return lt.forEach(Object.keys(Object.assign({},t,r)),function(E){const S=_[E]||c,R=S(t[E],r[E],E);lt.isUndefined(R)&&S!==m||(s[E]=R)}),s}var CW=t=>{const r=k_({},t);let s,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=r;if(r.headers=m=hd.from(m),r.url=WB(bW(r.baseURL,r.url),t.params,t.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),lt.isFormData(o)){if(La.hasStandardBrowserEnv||La.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...S]=s?s.split(";").map(R=>co(R).call(R)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(La.hasStandardBrowserEnv&&(c&&lt.isFunction(c)&&(c=c(r)),c||c!==!1&&jfe(r.url))){const E=u&&h&&Bfe.read(h);E&&m.set(u,E)}return r},Wfe=typeof XMLHttpRequest<"u"&&function(t){return new ut(function(r,s){const o=CW(t);let c=o.data;const u=hd.from(o.headers).normalize();let h,m,_,E,S,{responseType:R,onUploadProgress:P,onDownloadProgress:k}=o;function G(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function j(){if(!U)return;const Y=hd.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());EW(function(le){r(le),G()},function(le){s(le),G()},{data:R&&R!=="text"&&R!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:t,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=j:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(j)},U.onabort=function(){U&&(s(new tr("Request aborted",tr.ECONNABORTED,t,U)),U=null)},U.onerror=function(){s(new tr("Network Error",tr.ERR_NETWORK,t,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||GB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),s(new tr(Y,le.clarifyTimeoutError?tr.ETIMEDOUT:tr.ECONNABORTED,t,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&lt.forEach(u.toJSON(),function(Y,le){U.setRequestHeader(le,Y)}),lt.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),R&&R!=="json"&&(U.responseType=o.responseType),k&&([_,S]=AA(k,!0),U.addEventListener("progress",_)),P&&U.upload&&([m,E]=AA(P),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(s(!Y||Y.type?new Ov(null,t,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return le&&le[1]||""}(o.url);q&&La.protocols.indexOf(q)===-1?s(new tr("Unsupported protocol "+q+":",tr.ERR_BAD_REQUEST,t)):U.send(c||null)})},zfe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof tr?S:new Ov(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new tr("timeout ".concat(r," of ms exceeded"),tr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),t=null)};t.forEach(E=>E.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>lt.asap(m),_}},Gfe=_3,Hfe=yl;Vn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=Hfe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var $fe=yl,Kfe=lh;Vn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=$fe.f(this),s=Kfe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var Px=l(Gfe),RW=Rv.f("asyncIterator"),qfe=l(RW);function Ox(t,r){this.v=t,this.k=r}function mT(t){var r,s;function o(u,h){try{var m=t[u](h),_=m.value,E=_ instanceof Ox;Px.resolve(E?_.v:_).then(function(S){if(E){var R=u==="return"?"return":"next";if(!_.k||S.done)return o(R,S);S=t[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(u,h){return new Px(function(m,_){var E={key:u,arg:h,resolve:m,reject:_,next:null};s?s=s.next=E:(r=s=E,o(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function vl(t){return function(){return new mT(t.apply(this,arguments))}}function Cn(t){return new Ox(t,0)}function PA(t){var r={},s=!1;function o(c,u){return s=!0,{done:!1,value:new Ox(u=new Px(function(h){h(t[c](u))}),1)}}return r[Pv!==void 0&&eW||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}mT.prototype[typeof Pv=="function"&&qfe||"@@asyncIterator"]=function(){return this},mT.prototype.next=function(t){return this._invoke("next",t)},mT.prototype.throw=function(t){return this._invoke("throw",t)},mT.prototype.return=function(t){return this._invoke("return",t)};var kx=l(RW);function Nx(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=kx,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new OA(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function OA(t){function r(s){if(Object(s)!==s)return ut.reject(new TypeError(s+" is not an object."));var o=s.done;return ut.resolve(s.value).then(function(c){return{value:c,done:o}})}return OA=function(s){this.s=s,this.n=s.next},OA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ut.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ut.reject(s):r(o.apply(this.s,arguments))}},new OA(t)}const Yfe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let o,c=0;for(;c<s;)o=c+r,yield t.slice(c,o),c=o},Xfe=function(){var t=vl(function*(r,s){var o,c=!1,u=!1;try{for(var h,m=Nx(Jfe(r));c=!(h=yield Cn(m.next())).done;c=!1){const _=h.value;yield*PA(Nx(Yfe(_,s)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield Cn(m.return()))}finally{if(u)throw o}}});return function(r,s){return t.apply(this,arguments)}}(),Jfe=function(){var t=vl(function*(r){if(r[kx])return void(yield*PA(Nx(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield Cn(s.read());if(o)break;yield c}}finally{yield Cn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),IW=(t,r,s,o)=>{const c=Xfe(t,r);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:E,value:S}=await c.next();if(E)return m(),void _.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}_.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function AW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function PW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?AW(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):AW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const kA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",OW=kA&&typeof ReadableStream=="function",Qfe=kA&&(typeof TextEncoder=="function"?(kW=new TextEncoder,t=>kW.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var kW;const NW=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!t(...s)}catch{return!1}},Zfe=OW&&NW(()=>{let t=!1;const r=new Request(La.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),Dx=OW&&NW(()=>lt.isReadableStream(new Response("").body)),NA={stream:Dx&&(t=>t.body)};var DW;kA&&(DW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!NA[t]&&(NA[t]=lt.isFunction(DW[t])?r=>r[t]():(r,s)=>{throw new tr("Response type '".concat(t,"' is not supported"),tr.ERR_NOT_SUPPORT,s)})}));const epe=async(t,r)=>{const s=lt.toFiniteNumber(t.getContentLength());return s??(async o=>o==null?0:lt.isBlob(o)?o.size:lt.isSpecCompliantForm(o)?(await new Request(La.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:lt.isArrayBufferView(o)||lt.isArrayBuffer(o)?o.byteLength:(lt.isURLSearchParams(o)&&(o+=""),lt.isString(o)?(await Qfe(o)).byteLength:void 0))(r)};var tpe=kA&&(async t=>{let{url:r,method:s,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:E,headers:S,withCredentials:R="same-origin",fetchOptions:P}=CW(t);E=E?(E+"").toLowerCase():"text";let k,G=zfe([c,u&&u.toAbortSignal()],h);const U=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(_&&Zfe&&s!=="get"&&s!=="head"&&(j=await epe(S,o))!==0){let Ee,ge=new Request(r,{method:"POST",body:o,duplex:"half"});if(lt.isFormData(o)&&(Ee=ge.headers.get("content-type"))&&S.setContentType(Ee),ge.body){const[ke,qe]=vW(j,AA(SW(_)));o=IW(ge.body,65536,ke,qe)}}lt.isString(R)||(R=R?"include":"omit");const q="credentials"in Request.prototype;k=new Request(r,PW(PW({},P),{},{signal:G,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?R:void 0}));let Y=await fetch(k);const le=Dx&&(E==="stream"||E==="response");if(Dx&&(m||le&&U)){const Ee={};["status","statusText","headers"].forEach(dt=>{Ee[dt]=Y[dt]});const ge=lt.toFiniteNumber(Y.headers.get("content-length")),[ke,qe]=m&&vW(ge,AA(SW(m),!0))||[];Y=new Response(IW(Y.body,65536,ke,()=>{qe&&qe(),U&&U()}),Ee)}E=E||"text";let ye=await NA[lt.findKey(NA,E)||"text"](Y,t);return!le&&U&&U(),await new ut((Ee,ge)=>{EW(Ee,ge,{data:ye,headers:hd.from(Y.headers),status:Y.status,statusText:Y.statusText,config:t,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new tr("Network Error",tr.ERR_NETWORK,t,k),{cause:q.cause||q}):tr.from(q,q&&q.code,t,k)}});const xx={http:null,xhr:Wfe,fetch:tpe};lt.forEach(xx,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const xW=t=>"- ".concat(t),npe=t=>lt.isFunction(t)||t===null||t===!1;var LW={getAdapter:t=>{t=lt.isArray(t)?t:[t];const{length:r}=t;let s,o;const c={};for(let u=0;u<r;u++){let h;if(s=t[u],o=s,!npe(s)&&(o=xx[(h=String(s)).toLowerCase()],o===void 0))throw new tr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new tr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(xW).join(`
`):" "+xW(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:xx};function Lx(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ov(null,t)}function MW(t){return Lx(t),t.headers=hd.from(t.headers),t.data=Ax.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),LW.getAdapter(t.adapter||Rx.adapter)(t).then(function(r){return Lx(t),r.data=Ax.call(t,t.transformResponse,r),r.headers=hd.from(r.headers),r},function(r){return yW(r)||(Lx(t),r&&r.response&&(r.response.data=Ax.call(t,t.transformResponse,r.response),r.response.headers=hd.from(r.response.headers))),ut.reject(r)})}const UW="1.7.9",DA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{DA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const VW={};DA.transitional=function(t,r,s){function o(c,u){return"[Axios v"+UW+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(t===!1)throw new tr(o(u," has been removed"+(r?" in "+r:"")),tr.ERR_DEPRECATED);return r&&!VW[u]&&(VW[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},DA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var xA={assertOptions:function(t,r,s){if(typeof t!="object")throw new tr("options must be an object",tr.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=t[u],_=m===void 0||h(m,u,t);if(_!==!0)throw new tr("option "+u+" must be "+_,tr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new tr("Unknown option "+u,tr.ERR_BAD_OPTION)}},validators:DA};const mh=xA.validators;let LA=class{constructor(t){this.defaults=t,this.interceptors={request:new zB,response:new zB}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=k_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&xA.assertOptions(s,{silentJSONParsing:mh.transitional(mh.boolean),forcedJSONParsing:mh.transitional(mh.boolean),clarifyTimeoutError:mh.transitional(mh.boolean)},!1),o!=null&&(lt.isFunction(o)?r.paramsSerializer={serialize:o}:xA.assertOptions(o,{encode:mh.function,serialize:mh.function},!0)),xA.assertOptions(r,{baseUrl:mh.spelling("baseURL"),withXsrfToken:mh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&lt.merge(c.common,c[r.method]);c&&lt.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=hd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let E;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,R=0;if(!m){const k=[MW.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,E=ut.resolve(r);R<S;)E=E.then(k[R++],k[R++]);return E}S=h.length;let P=r;for(R=0;R<S;){const k=h[R++],G=h[R++];try{P=k(P)}catch(U){G.call(this,U);break}}try{E=MW.call(this,P)}catch(k){return ut.reject(k)}for(R=0,S=_.length;R<S;)E=E.then(_[R++],_[R++]);return E}getUri(t){return WB(bW((t=k_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(t){LA.prototype[t]=function(r,s){return this.request(k_(s||{},{method:t,url:r,data:(s||{}).data}))}}),lt.forEach(["post","put","patch"],function(t){function r(s){return function(o,c,u){return this.request(k_(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}LA.prototype[t]=r(),LA.prototype[t+"Form"]=r(!0)});var MA=LA;class Mx{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new ut(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new ut(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Ov(c,u,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new Mx(function(o){r=o}),cancel:r}}}var rpe=Mx;const Ux={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ux).forEach(t=>{let[r,s]=t;Ux[s]=r});var ipe=Ux;const Js=function t(r){const s=new MA(r),o=wB(MA.prototype.request,s);return lt.extend(o,MA.prototype,s,{allOwnKeys:!0}),lt.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return t(k_(r,c))},o}(Rx);Js.Axios=MA,Js.CanceledError=Ov,Js.CancelToken=rpe,Js.isCancel=yW,Js.VERSION=UW,Js.toFormData=mA,Js.AxiosError=tr,Js.Cancel=Js.CanceledError,Js.all=function(t){return ut.all(t)},Js.spread=function(t){return function(r){return t.apply(null,r)}},Js.isAxiosError=function(t){return lt.isObject(t)&&t.isAxiosError===!0},Js.mergeConfig=k_,Js.AxiosHeaders=hd,Js.formToJSON=t=>gW(lt.isHTMLForm(t)?new FormData(t):t),Js.getAdapter=LW.getAdapter,Js.HttpStatusCode=ipe,Js.default=Js;var ia=Js;const spe=()=>{};function gT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:spe};return t.promise=new ut((r,s)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(o))}}),t}const UA=new Map,VA=new Map,gh=new Map;let $i=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Fn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const FW=new bue;let fd=FW.getResult(),Vx=null;function Rn(t){if(!Vx){fd=FW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Fn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Fn.CHROME;case"Safari":case"Mobile Safari":return Fn.SAFARI;case"Edge":return Fn.EDGE;case"Firefox":return Fn.FIREFOX;case"QQ":case"QQBrowser":return Fn.QQ;case"Opera":return Fn.OPERA;case"WeChat":return Fn.WECHAT;default:return m.browser.name||""}}(fd),s=jW(fd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(fd),c=fd.os.version,u=jW(fd,!1),h=fd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h};Vx={name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h}}return Vx}function jW(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function FA(){return Rn().os}function BW(){const t=Rn();return"".concat(t.os," ").concat(t.osVersion)}function jA(){const t=Rn();return!!(fd.engine.name==="WebKit"&&t.os===$i.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Fn.SAFARI||Io()&&t.name!==Fn.SAFARI)}function qf(){return Rn().name===Fn.CHROME}function Is(){return Rn().name===Fn.SAFARI}function WW(){return Rn().name===Fn.EDGE}function Mr(){return Rn().name===Fn.FIREFOX}function Io(){return Rn().os===$i.IOS}function _T(t){const r=Rn();return!(r.name!==Fn.CHROME||!r.osVersion)&&Number(r.version)>=t}function zW(t){const r=Rn();return!(r.name!==Fn.CHROME||!r.osVersion)&&Number(r.version)<t}function Fx(t,r,s){const o=Rn();return!(o.name!==t||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function jx(t){const r=Rn();return!(r.name!==Fn.EDGE||!r.osVersion)&&Number(r.version)>=t}function GW(t){const r=Rn();return!(r.name!==Fn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function HW(t,r,s){const o=Rn();if(o.os!==$i.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function $W(t,r,s){const o=Rn();if(o.name!==Fn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function Bx(t){const r=Rn();return!(r.name!==Fn.OPERA||!r.osVersion)&&Number(r.version)>=t}function KW(){const t=Rn();if(t.os!==$i.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function kv(){const t=Rn();if(t.os!==$i.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function Wx(){const t=Rn();if(t.os!==$i.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function qW(){const t=Rn();if(t.os!==$i.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function pu(){return Is()&&navigator.maxTouchPoints>0}function YW(){return Rn().name===Fn.WECHAT}function XW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function zx(){const t=FA();return function(){const{deviceType:r}=Rn();return r==="mobile"||r==="tablet"}()||t===$i.ANDROID||t===$i.IOS||t===$i.HARMONY_OS}function Yf(){const t=Rn();return t.name!==Fn.EDGE&&t.name!==Fn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function BA(){return FA()===$i.ANDROID}function yT(){const t=Rn();return BA()&&(t.name===Fn.CHROME||t.name===Fn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function JW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function gt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?JW(Object(s),!0).forEach(function(o){$t(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):JW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function $t(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let X=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),xe=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),$t(this,"code",void 0),$t(this,"message",void 0),$t(this,"data",void 0),$t(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Xf(t,r){if(typeof t!="boolean")throw new xe(X.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Mi(t,r,s){if(!st(s).call(s,t))throw new xe(X.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function nr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new xe(X.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function Gx(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new xe(X.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&nr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&nr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&nr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&nr(t.ideal,"".concat(r,".ideal"),1,1/0)}else nr(t,r,1,1/0)}function us(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new xe(X.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!QW(t,s,o,c))throw new xe(X.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Jf(t,r){if(!Array.isArray(t))throw new xe(X.INVALID_PARAMS,"".concat(r," should be an array"))}function Ur(t){return t==null}function QW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}var ET=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(ET||{}),Hx=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(Hx||{});const ZW=new class{constructor(){$t(this,"_clientSize",null),$t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$t(this,"getStyle",t=>window.getComputedStyle(t,null)),$t(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const o=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||st(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(_=>{var E;const S=_.split("(")[0];return st(E=["brightness","blur","opacity"]).call(E,S)}).map(_=>{const[E,S]=_.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[E,S]=_;switch(E){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),$t(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,o=!0;const c=h=>r(h);let u=t;for(;u&&o;)c(u)||(s=!1,o=!1),u=u.parentElement,u||(o=!1);return s}),$t(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),$t(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:o,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),$t(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),$t(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),$t(this,"checkCoverForAPoint",(t,r,s)=>{const o=this.elementFromPoint(t,r);return o!==null&&o!==s}),$t(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:o}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let E=0;E<5;E++){const S=(s*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,R=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:R})}return[...h]}),$t(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),$t(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),$t(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,E,S;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(_=r<u?r:u,s<0)E=0;else{if(!(s<c))return!1;E=s}if(o<0)return!1;S=o<c?o:c;const R=_-m,P=S-E;return this.checkSizeIsVisible(R,P,h)}),$t(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),$t(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(ET.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(ET.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ET.SIZE)}}return this.returnHiddenResult(ET.STYLE)}return this.returnHiddenResult(Hx.UNMOUNTED)}return this.returnHiddenResult(Hx.INVALID_HTML_ELEMENT)}),$t(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function $x(t){return new TextEncoder().encode(t)}const e8=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},Kx=async t=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",$x(t)),16);let Nr=class{constructor(){$t(this,"_events",{}),$t(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},vT=null;function t8(){if(vT)return vT;if(window.electron)return vT=window.electron;if(!window.require)return null;try{return vT=window.require("electron"),vT}catch{return null}}let wi=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Vr=function(t){return t.TRACER="tracer",t}({});function n8(t){return nr(t.timeout,"config.timeout",0,1e5),nr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),nr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),nr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let ope=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Gn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function ST(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function r8(t){return us(t.turnServerURL,"turnServerURL"),us(t.username,"username"),us(t.password,"password"),t.udpport&&nr(t.udpport,"udpport",1,99999,!0),t.forceturn&&Xf(t.forceturn,"forceturn"),t.security&&Xf(t.security,"security"),t.tcpport&&nr(t.tcpport,"tcpport",1,99999,!0),!0}function qx(t){return t.level!==void 0&&Mi(t.level,"level",[1,2,3]),t.delay!==void 0&&nr(t.delay,"delay",0,3e3,!0),!0}let mn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),As=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),uc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Nv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Ps(t,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return t.getListeners(r).length===0?ut.reject(new xe(X.UNEXPECTED_ERROR,"can not emit promise")):new ut((u,h)=>{t.emit(r,...o,u,h)})}function ar(t,r){if(t.getListeners(r).length===0)return ut.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Ps(t,r,...o)}function Bc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return bT(t,r,...o)}function bT(t,r){let s=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new xe(X.UNEXPECTED_ERROR,"handler is not sync");return s}const pi=new class extends Nr{set networkState(t){this.emit(Nv.NETWORK_STATE_CHANGE,t,this._networkState),t===uc.ONLINE?this.emit(Nv.ONLINE):t===uc.OFFLINE&&(this.onlineWaiter=new ut(r=>{this.once(Nv.ONLINE,()=>{this.onlineWaiter=void 0,r(uc.ONLINE)})}),this.emit(Nv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===uc.ONLINE}constructor(){super(),$t(this,"_moduleName","network-indicator"),$t(this,"_networkState",uc.ONLINE),$t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=uc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=uc.OFFLINE})}};function WA(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Dv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function zA(t){ut!==void 0?ut.resolve().then(t):setTimeout(t,0)}function Fr(t){return JSON.parse(JSON.stringify(t))}function N_(t){try{return Fr(t)}catch{return t}}const i8={};function Nm(t,r){i8[r]||(i8[r]=!0,t())}function D_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Dm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function s8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function o8(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=rc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function _h(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function a8(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?_h(s):s.size}),r+138}function ape(t){const r=new xe(X.TIMEOUT,"timeout");return new ut((s,o)=>{window.setTimeout(()=>o(r),t)})}function ds(t){return new ut(r=>{window.setTimeout(r,t)})}function cr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+cr(t-s.length,"")}function x_(){return cr(32,"").toUpperCase()}const GA=()=>{},c8=new class{constructor(){$t(this,"fnMap",new Map)}throttleByKey(t,r,s,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,gt(gt({},m),{},{fn:t,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(r);_&&_.fn(..._.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:u,skipFn:o})}}},l8=c8.throttleByKey.bind(c8);function u8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function Yx(t,r){if(!u8(t)||!u8(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let o=0;o<r.length;o++)s[o]=Yx(t[o],r[o]);return s}{const s=gt({},t);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(t,o)?s[o]=Yx(t[o],r[o]):s[o]=r[o]);return s}}function d8(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let o=0;for(;t>0&&(s[o]=255&t,t>>=8,o++,o!==r););return s}function Xx(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function h8(t){const r="0123456789abcdef";function s(le){let ye,Ee="";for(ye=0;ye<=3;ye++)Ee+=r.charAt(le>>8*ye+4&15)+r.charAt(le>>8*ye&15);return Ee}function o(le,ye){const Ee=(65535&le)+(65535&ye);return(le>>16)+(ye>>16)+(Ee>>16)<<16|65535&Ee}function c(le,ye,Ee,ge,ke,qe){return o(function(dt,pt){return dt<<pt|dt>>>32-pt}(o(o(ye,le),o(ge,qe)),ke),Ee)}function u(le,ye,Ee,ge,ke,qe,dt){return c(ye&Ee|~ye&ge,le,ye,ke,qe,dt)}function h(le,ye,Ee,ge,ke,qe,dt){return c(ye&ge|Ee&~ge,le,ye,ke,qe,dt)}function m(le,ye,Ee,ge,ke,qe,dt){return c(ye^Ee^ge,le,ye,ke,qe,dt)}function _(le,ye,Ee,ge,ke,qe,dt){return c(Ee^(ye|~ge),le,ye,ke,qe,dt)}const E=function(le){let ye;const Ee=1+(le.length+8>>6),ge=new Array(16*Ee);for(ye=0;ye<16*Ee;ye++)ge[ye]=0;for(ye=0;ye<le.length;ye++)ge[ye>>2]|=le.charCodeAt(ye)<<ye%4*8;return ge[ye>>2]|=128<<ye%4*8,ge[16*Ee-2]=8*le.length,ge}(t);let S,R,P,k,G,U=1732584193,j=-271733879,q=-1732584194,Y=271733878;for(S=0;S<E.length;S+=16)R=U,P=j,k=q,G=Y,U=u(U,j,q,Y,E[S+0],7,-680876936),Y=u(Y,U,j,q,E[S+1],12,-389564586),q=u(q,Y,U,j,E[S+2],17,606105819),j=u(j,q,Y,U,E[S+3],22,-1044525330),U=u(U,j,q,Y,E[S+4],7,-176418897),Y=u(Y,U,j,q,E[S+5],12,1200080426),q=u(q,Y,U,j,E[S+6],17,-1473231341),j=u(j,q,Y,U,E[S+7],22,-45705983),U=u(U,j,q,Y,E[S+8],7,1770035416),Y=u(Y,U,j,q,E[S+9],12,-1958414417),q=u(q,Y,U,j,E[S+10],17,-42063),j=u(j,q,Y,U,E[S+11],22,-1990404162),U=u(U,j,q,Y,E[S+12],7,1804603682),Y=u(Y,U,j,q,E[S+13],12,-40341101),q=u(q,Y,U,j,E[S+14],17,-1502002290),j=u(j,q,Y,U,E[S+15],22,1236535329),U=h(U,j,q,Y,E[S+1],5,-165796510),Y=h(Y,U,j,q,E[S+6],9,-1069501632),q=h(q,Y,U,j,E[S+11],14,643717713),j=h(j,q,Y,U,E[S+0],20,-373897302),U=h(U,j,q,Y,E[S+5],5,-701558691),Y=h(Y,U,j,q,E[S+10],9,38016083),q=h(q,Y,U,j,E[S+15],14,-660478335),j=h(j,q,Y,U,E[S+4],20,-405537848),U=h(U,j,q,Y,E[S+9],5,568446438),Y=h(Y,U,j,q,E[S+14],9,-1019803690),q=h(q,Y,U,j,E[S+3],14,-187363961),j=h(j,q,Y,U,E[S+8],20,1163531501),U=h(U,j,q,Y,E[S+13],5,-1444681467),Y=h(Y,U,j,q,E[S+2],9,-51403784),q=h(q,Y,U,j,E[S+7],14,1735328473),j=h(j,q,Y,U,E[S+12],20,-1926607734),U=m(U,j,q,Y,E[S+5],4,-378558),Y=m(Y,U,j,q,E[S+8],11,-2022574463),q=m(q,Y,U,j,E[S+11],16,1839030562),j=m(j,q,Y,U,E[S+14],23,-35309556),U=m(U,j,q,Y,E[S+1],4,-1530992060),Y=m(Y,U,j,q,E[S+4],11,1272893353),q=m(q,Y,U,j,E[S+7],16,-155497632),j=m(j,q,Y,U,E[S+10],23,-1094730640),U=m(U,j,q,Y,E[S+13],4,681279174),Y=m(Y,U,j,q,E[S+0],11,-358537222),q=m(q,Y,U,j,E[S+3],16,-722521979),j=m(j,q,Y,U,E[S+6],23,76029189),U=m(U,j,q,Y,E[S+9],4,-640364487),Y=m(Y,U,j,q,E[S+12],11,-421815835),q=m(q,Y,U,j,E[S+15],16,530742520),j=m(j,q,Y,U,E[S+2],23,-995338651),U=_(U,j,q,Y,E[S+0],6,-198630844),Y=_(Y,U,j,q,E[S+7],10,1126891415),q=_(q,Y,U,j,E[S+14],15,-1416354905),j=_(j,q,Y,U,E[S+5],21,-57434055),U=_(U,j,q,Y,E[S+12],6,1700485571),Y=_(Y,U,j,q,E[S+3],10,-1894986606),q=_(q,Y,U,j,E[S+10],15,-1051523),j=_(j,q,Y,U,E[S+1],21,-2054922799),U=_(U,j,q,Y,E[S+8],6,1873313359),Y=_(Y,U,j,q,E[S+15],10,-30611744),q=_(q,Y,U,j,E[S+6],15,-1560198380),j=_(j,q,Y,U,E[S+13],21,1309151649),U=_(U,j,q,Y,E[S+4],6,-145523070),Y=_(Y,U,j,q,E[S+11],10,-1120210379),q=_(q,Y,U,j,E[S+2],15,718787259),j=_(j,q,Y,U,E[S+9],21,-343485551),U=o(U,R),j=o(j,P),q=o(q,k),Y=o(Y,G);return s(U)+s(j)+s(q)+s(Y)}let cpe=1,f8=console,Vs=class{static setLogger(t){f8=t}constructor(t,r){$t(this,"id",void 0),$t(this,"lockingPromise",ut.resolve()),$t(this,"locks",0),$t(this,"name",""),$t(this,"lockId",void 0),this.lockId=cpe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");f8.debug("".concat(s," ").concat(o))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new ut(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function xv(t,r){return function(s,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(o));try{for(var _=arguments.length,E=new Array(_),S=0;S<_;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const Ci={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Jx(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function pd(t,r,s,o){const c=Object.assign({},Ci,o);let u=c.timeout;const h=async()=>{await function(E){return new ut(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new ut(async(E,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new xe(X.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return E(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return _.cancel=()=>m=!0,_}let HA,p8=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:rc(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},$A=0,Qx=0;function Zx(t,r,s,o){return new ut((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),$A+=_h(r.data)):s&&(r.data.size?$A+=r.data.size:r.data instanceof FormData?$A+=a8(r.data):$A+=_h(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ia.request(r).then(h=>{typeof h.data=="string"?Qx+=_h(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Qx+=h.data.byteLength:Qx+=_h(JSON.stringify(h.data)),c(h.data)}).catch(h=>{ia.isCancel(h)?u(new xe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new xe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new xe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new xe(X.NETWORK_ERROR,h.message))})})}async function lpe(t,r){const s=new Blob([r.data],{type:"buffer"});return await Zx(t,gt(gt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const m8=()=>window.isSecureContext!==void 0;function mu(t){if(Array.isArray(t))return t.map(s=>s);if(!g8(t))return t;const r={};for(const s in t){const o=t[s];g8(o)||Array.isArray(o)?r[s]=mu(o):r[s]=o}return r}function g8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let eL=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const yh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},TT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:yh,remoteCandidate:yh},updateInterval:0},_8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},y8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},E8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},v8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let tL=class{constructor(t,r){$t(this,"onFirstVideoReceived",void 0),$t(this,"onFirstVideoDecoded",void 0),$t(this,"onFirstAudioReceived",void 0),$t(this,"onFirstVideoDecodedTimeout",void 0),$t(this,"onFirstAudioDecoded",void 0),$t(this,"onSelectedLocalCandidateChanged",void 0),$t(this,"onSelectedRemoteCandidateChanged",void 0),$t(this,"videoIsReady",!1),$t(this,"videoIsReady2",{}),$t(this,"pc",void 0),$t(this,"options",void 0),$t(this,"intervalTimer",void 0),$t(this,"stats",mu(TT)),$t(this,"isFirstVideoReceived",{}),$t(this,"isFirstVideoDecoded",{}),$t(this,"isFirstAudioReceived",{}),$t(this,"isFirstAudioDecoded",{}),$t(this,"isFirstVideoDecodedTimeout",{}),$t(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ut(t=>{t({local:gt({},yh),remote:gt({},yh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of s)t[m].forEach((_,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,R=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||R<=0?0:R/(S+R)});t.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},upe=class extends tL{constructor(){super(...arguments),$t(this,"_stats",TT),$t(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=mu(TT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const o=st(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=mu(y8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=mu(_8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:gt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=mu(v8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=mu(E8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ut((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},wT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),KA=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),nL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Wc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Lv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Lv||{});function CT(t,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Lv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const _=Number(t[o]);if(typeof _!="number")return;const E=h-_;return E?(u-m)/E*c:void 0}let S8=class extends tL{constructor(){super(...arguments),$t(this,"_stats",TT),$t(this,"report",void 0),$t(this,"lastDecodeVideoReceiverStats",new Map),$t(this,"lastVideoFramesRecv",new Map),$t(this,"lastVideoFramesSent",new Map),$t(this,"lastVideoFramesDecode",new Map),$t(this,"lastVideoFramesOutput",new Map),$t(this,"lastVideoJBDelay",new Map),$t(this,"lastAudioJBDelay",new Map),$t(this,"mediaBytesSent",new Map),$t(this,"mediaBytesRetransmit",new Map),$t(this,"mediaBytesTargetEncode",new Map),$t(this,"lastDecodeAudioReceiverStats",new Map),$t(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=mu(TT),this.report.forEach(t=>{switch(t.type){case Wc.OUTBOUND:case Wc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,o=!r&&!("frameWidth"in t);t.type===Wc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===Wc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case Wc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Wc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:gt({},yh),remote:gt({},yh)};return t.forEach(s=>{let o;if(s.type===Wc.TRANSPORT&&(o=t.get(s.selectedCandidatePairId)),s.type===Wc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=t.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=t.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Wc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Wc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Wc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(gt({},r),gt({},this.stats.selectedCandidatePair.localCandidate)),t.type===Wc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(gt({},r),gt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);r||(r=mu(v8),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=CT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Lv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,gt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=mu(_8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=CT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=CT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Lv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=CT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Lv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=CT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Lv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:gt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);r||(r=mu(y8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const o=new eL(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const c=new eL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const c=new eL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-o.lastFrameCount,u=t.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const o=this.findRemoteStatsId(t.ssrc,Wc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=mu(E8),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Wc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const o=Array.from(Fc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return o?o.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:t.framesSent;if(typeof _!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),R==null){const P=Date.now(),k=this.lastVideoFramesSent.get(s.ssrc);k&&P-k.lts>=800?(R=Math.round((_-k.count)/((P-k.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:P,rate:R})):k?R=k.rate:this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:P,rate:0})}s.sentFrame={width:E,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var o,c,u,h,m;const _=r?this.report.get(r):void 0,E=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:t.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:t.frameHeight,P=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),U=Date.now();s.framesReceivedCount=E;let j=0;G&&U-G.lts>=800?(j=Math.round((E-G.count)/((U-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:U,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:U,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:j||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&k){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=G.jitterBufferMs;const j=k-G.jitterBufferEmittedCount;j>0&&(U=1e3*(P-G.jitterBufferDelay)/j),s.jitterBufferMs=U,s.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:k,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(t,r,s){var o,c,u,h,m,_,E;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,j=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:t==null?void 0:t.totalSamplesDuration,q=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),k&&G){const le=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=le.jitterBufferMs;const Ee=G-le.jitterBufferEmittedCount;Ee>0&&(ye=1e3*(k-le.jitterBufferDelay)/Ee),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=U;let Y=1920;j&&P&&(Y=P/j/50,s.receivedFrames=Math.round(P/Y)),q&&(s.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},dpe=class extends tL{updateStats(){return ut.resolve()}};function rL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new upe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new S8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ut||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(t)?new S8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new dpe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const b8="websdk_ng_install_id";function iL(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let t=window.localStorage.getItem(b8);return t||(t=x_(),window.localStorage.setItem(b8,t)),Qn("INSTALL_ID",t),t}catch{return}}const Sl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),sL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let L_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Os=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Os;const qA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},oL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},aL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",cL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},yr=gt(gt(gt({},cL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:oL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},qA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Qn(t,r,s){var o,c,u;st(o=Object.keys(yr)).call(o,t)&&(!s&&st(c=Object.keys(md)).call(c,t)||(yr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(yr.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(yr.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,yr.USE_NEW_NETWORK_CONFIG=u,u&&(yr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],yr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],yr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],yr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],yr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",yr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",yr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(yr.ENABLE_INSTANT_VIDEO=!0,yr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(yr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(yr.NEW_TURN_MODE||(yr.NEW_TURN_MODE=4))))}function re(t){return yr[t]}sL||(yr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],yr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],yr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],yr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],yr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],yr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],yr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",yr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",yr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",yr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",yr.AREAS=["NORTH_AMERICA","OVERSEA"]);let T8=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const md={};var gn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(gn||{});let YA=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const w8=128,hpe=96,C8=1e3,Mv=10;let fpe=0;var R8=(()=>{var t={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>dt,Printer:()=>ai,parse:()=>it,print:()=>Tt});const h=`
`,m="".concat("\r").concat(h),_=" ";let E;function S(ze){return ze>="0"&&ze<="9"}function R(ze){return ze>="!"&&ze<="~"}function P(ze){return R(ze)||ze>=""&&ze<=""}function k(ze){return ze==="!"||ze>="#"&&ze<="'"||ze>="*"&&ze<="+"||ze>="-"&&ze<="."||ze>="0"&&ze<="9"||ze>="A"&&ze<="Z"||ze>="^"&&ze<="~"}function G(ze){return ze>="1"&&ze<="9"}function U(ze){return ze>="A"&&ze<="Z"||ze>="a"&&ze<="z"}function j(ze){return ze==="d"||ze==="h"||ze==="m"||ze==="s"}function q(ze){return ze>""&&ze<"	"||ze>"\v"&&ze<"\f"||ze>""&&ze<""}function Y(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function le(ze){return S(ze)||U(ze)||ze==="+"||ze==="/"||ze==="-"||ze==="_"}function ye(ze){return U(ze)||S(ze)||ze==="+"||ze==="/"}function Ee(ze,L){var ie=Object.keys(ze);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(ze);L&&(de=de.filter(function(Xe){return Object.getOwnPropertyDescriptor(ze,Xe).enumerable})),ie.push.apply(ie,de)}return ie}function ge(ze){for(var L=1;L<arguments.length;L++){var ie=arguments[L]!=null?arguments[L]:{};L%2?Ee(Object(ie),!0).forEach(function(de){ke(ze,de,ie[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ze,Object.getOwnPropertyDescriptors(ie)):Ee(Object(ie)).forEach(function(de){Object.defineProperty(ze,de,Object.getOwnPropertyDescriptor(ie,de))})}return ze}function ke(ze,L,ie){return L in ze?Object.defineProperty(ze,L,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[L]=ie,ze}(function(ze){ze.VERSION="v",ze.ORIGIN="o",ze.SESSION_NAME="s",ze.INFORMATION="i",ze.URI="u",ze.EMAIL="e",ze.PHONE="p",ze.CONNECTION="c",ze.BANDWIDTH="b",ze.TIME="t",ze.REPEAT="r",ze.ZONE_ADJUSTMENTS="z",ze.KEY="k",ze.ATTRIBUTE="a",ze.MEDIA="m"})(E||(E={}));class qe{consumeText(L,ie){let de=ie;for(;de<L.length;){const Xe=L[de];if(Xe==="\0"||Xe==="\r"||Xe===h)break;de+=1}if(de-ie==0)throw new Error("Invalid text, at ".concat(L));return de}consumeUnicastAddress(L,ie,de){return this.consumeTill(L,ie,_)}consumeOneOrMore(L,ie,de){let Xe=ie;for(;de(L[Xe]);)Xe++;if(Xe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Xe}consumeSpace(L,ie){if(L[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(L,ie){let de=ie;for(let Xe=0;Xe<4;Xe++)if(de=this.consumeDecimalUChar(L,de),Xe!==3){if(L[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(L,ie){let de=ie;for(let Yt=0;Yt<3&&S(L[de]);Yt++,de++);if(de-ie==0)throw new Error("Invalid decimal uchar.");const Xe=parseInt(L.slice(ie,de));if(Xe>=0&&Xe<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(L,ie){let de=this.consumeHexpart(L,ie);return L[de]===":"&&(de+=1,de=this.consumeIP4Address(L,de)),de}consumeHexpart(L,ie){let de=ie;if(L[de]===":"&&L[de+1]===":"){de+=2;try{de=this.consumeHexseq(L,de)}catch{}return de}if(de=this.consumeHexseq(L,de),L[de]===":"&&L[de+1]===":"){de+=2;try{de=this.consumeHexseq(L,de)}catch{}return de}return de}consumeHexseq(L,ie){let de=ie;for(;de=this.consumeHex4(L,de),L[de]===":"&&L[de+1]!==":";)de+=1;return de}consumeHex4(L,ie){let de=0;for(;de<4;de++)if(!((Xe=L[ie+de])>="0"&&Xe<="9"||Xe>="a"&&Xe<="f"||Xe>="A"&&Xe<="F")){if(de===0)throw new Error("Invalid hex 4");break}var Xe;return ie+de}consumeFQDN(L,ie){let de=ie;for(;S(L[de])||U(L[de])||L[de]==="-"||L[de]===".";)de+=1;if(de-ie<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(L,ie){return this.consumeOneOrMore(L,ie,P)}consumeMulticastAddress(L,ie,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(L,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(L,ie);default:try{return this.consumeFQDN(L,ie)}catch{return this.consumeExtnAddr(L,ie)}}}consumeIP6MulticastAddress(L,ie){const de=this.consumeHexpart(L,ie);return L[de]==="/"?this.consumeInteger(L,de+1):de}consumeIP4MulticastAddress(L,ie){let de=ie+3;const Xe=L.slice(ie,de),Yt=parseInt(Xe);if(Yt<224||Yt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let rr=0;rr<3;rr++){if(L[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(L,de)}return L[de]==="/"&&(de+=1),de=this.consumeTTL(L,de),L[de]==="/"&&(de=this.consumeInteger(L,de)),de}consumeInteger(L,ie){if(!G(L[ie]))throw new Error("Invalid integer.");for(ie+=1;S(L[ie]);)ie+=1;return ie}consumeTTL(L,ie){if(L[ie]==="0")return ie+1;if(!G(L[ie]))throw new Error("Invalid TTL.");ie+=1;for(let de=0;de<2&&S(L[ie]);de++)ie+=1;return ie}consumeToken(L,ie){return this.consumeOneOrMore(L,ie,k)}consumeTime(L,ie){let de=ie;if(L[de]==="0")return de+1;for(G(L[de])&&(de+=1);S(L[de]);)de++;if(de-ie<10)throw new Error("Invalid time");return de}consumeAddress(L,ie){return this.consumeTill(L,ie,_)}consumeTypedTime(L,ie){let de=ie;return de=this.consumeOneOrMore(L,de,S),j(L[de])?de+1:de}consumeRepeatInterval(L,ie){if(!G(L[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(L[ie]);)ie+=1;return j(L[ie])&&(ie+=1),ie}consumePort(L,ie){return this.consumeOneOrMore(L,ie,S)}consume(L,ie,de){for(let Xe=0;Xe<de.length;Xe++){if(ie+Xe>=L.length)throw new Error("consume exceeding value length");if(L[ie+Xe]!==de[Xe])throw new Error("consume ".concat(de," failed at ").concat(Xe))}return ie+de.length}consumeTill(L,ie,de){let Xe=ie;for(;Xe<L.length&&(typeof de!="string"||L[Xe]!==de)&&(typeof de!="function"||!de(L[Xe]));)Xe++;return Xe}}class dt extends qe{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(L){const ie=this.probeEOL(L);this.records=L.split(ie).filter(sy=>!!co(sy).call(sy)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),Xe=this.parseOrigin(),Yt=this.parseSessionName(),rr=this.parseInformation(),Yi=this.parseUri(),ja=this.parseEmail(),lp=this.parsePhone(),iy=this.parseConnection(),cw=this.parseBandWidth(),oO=this.parseTimeFields(),aO=this.parseKey(),Pl=this.parseSessionAttribute(),Jm=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:Xe,sessionName:Yt,information:rr,uri:Yi,emails:ja,phones:lp,connection:iy,bandwidths:cw,timeFields:oO,key:aO,attributes:Pl,mediaDescriptions:Jm}}getCurrentRecord(){const L=this.records[this.currentLine];if(!L)throw new Error("Record doesn't exit.");return L}probeEOL(L){for(let ie=0;ie<L.length;ie++)if(L[ie]===h)return L[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(L,ie){if(L.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=L[0];if(L[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:L.slice(2),line:ie,cur:0}}parseSessionAttribute(){const L=new vn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==E.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(ie,Xe=>k(Xe)&&Xe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,de.attValue=this.extractOneOrMore(ie,q)),L.parse(de),this.currentLine++}return L.digest()}parseMediaAttributes(L){const ie=new Sn(L);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==E.ATTRIBUTE)break;const Xe={attField:this.extractOneOrMore(de,Yt=>k(Yt)&&Yt!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,Xe.attValue=this.extractOneOrMore(de,q)),ie.parse(Xe),this.currentLine++}return ie.digest()}parseKey(){const L=this.getCurrentRecord();if(L.type===E.KEY){if(L.value==="prompt"||L.value==="clear:"||L.value==="base64:"||L.value==="uri:")return L.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const L=this.getCurrentRecord();if(L.type===E.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const de=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);let Xe=!1;L.value[L.cur]==="-"&&(Xe=!0,L.cur+=1);const Yt=this.extract(L,this.consumeTypedTime);ie.push({time:de,typedTime:Yt,back:Xe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const L=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.REPEAT)break;{const de=this.extract(ie,this.consumeRepeatInterval),Xe=this.parseTypedTime(ie);L.push({repeatInterval:de,typedTimes:Xe}),this.currentLine++}}return L}parseTypedTime(L){const ie=[];for(;;)try{this.consumeSpaceForRecord(L),ie.push(this.extract(L,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const L=this.getCurrentRecord(),ie=this.extract(L,this.consumeTime);this.consumeSpaceForRecord(L);const de=this.extract(L,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:de}}parseBandWidth(){const L=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==E.BANDWIDTH)break;{const de=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Xe=this.extractOneOrMore(ie,S);L.push({bwtype:de,bandwidth:Xe}),this.currentLine++}}return L}parseVersion(){const L=this.getCurrentRecord();if(L.type!==E.VERSION)throw new Error("first sdp record must be version");const ie=L.value.slice(0,this.consumeOneOrMore(L.value,0,S));if(ie.length!==L.value.length)throw new Error('invalid proto version, "v='.concat(L.value,'"'));return this.currentLine++,ie}parseOrigin(){const L=this.getCurrentRecord();if(L.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(L,P);this.consumeSpaceForRecord(L);const de=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const Xe=this.extractOneOrMore(L,S);this.consumeSpaceForRecord(L);const Yt=this.extractOneOrMore(L,k);this.consumeSpaceForRecord(L);const rr=this.extractOneOrMore(L,k);this.consumeSpaceForRecord(L);const Yi=this.extract(L,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:de,sessVersion:Xe,nettype:Yt,addrtype:rr,unicastAddress:Yi}}parseSessionName(){const L=this.getCurrentRecord();if(L.type===E.SESSION_NAME){const ie=this.extract(L,this.consumeText);return this.currentLine++,ie}}parseInformation(){const L=this.getCurrentRecord();if(L.type!==E.INFORMATION)return;const ie=this.extract(L,this.consumeText);return this.currentLine++,ie}parseUri(){const L=this.getCurrentRecord();if(L.type===E.URI)return this.currentLine++,L.value}parseEmail(){const L=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.EMAIL)break;L.push(ie.value),this.currentLine++}return L}parsePhone(){const L=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==E.PHONE)break;L.push(ie.value),this.currentLine++}return L}parseConnection(){const L=this.getCurrentRecord();if(L.type===E.CONNECTION){const ie=this.extractOneOrMore(L,k);this.consumeSpaceForRecord(L);const de=this.extractOneOrMore(L,k);this.consumeSpaceForRecord(L);const Xe=this.extract(L,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:de,address:Xe}}}parseMedia(){const L=this.getCurrentRecord(),ie=this.extract(L,this.consumeToken);this.consumeSpaceForRecord(L);let de=this.extract(L,this.consumePort);L.value[L.cur]==="/"&&(L.cur+=1,de+=this.extract(L,this.consumeInteger)),this.consumeSpaceForRecord(L);const Xe=[];for(Xe.push(this.extract(L,this.consumeToken));L.value[L.cur]==="/";)L.cur+=1,Xe.push(this.extract(L,this.consumeToken));if(Xe.length===0)throw new Error("Invalid proto");const Yt=this.parseFmt(L);return this.currentLine++,{mediaType:ie,port:de,protos:Xe,fmts:Yt}}parseTimeFields(){const L=[];for(;this.getCurrentRecord().type===E.TIME;){const ie=this.parseTime(),de=this.parseRepeat(),Xe=this.parseZone();L.push({time:ie,repeats:de,zones:Xe})}return L}parseMediaDescription(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ie=this.parseMedia(),de=this.parseInformation(),Xe=this.parseConnections(),Yt=this.parseBandWidth(),rr=this.parseKey(),Yi=this.parseMediaAttributes(ie);L.push({media:ie,information:de,connections:Xe,bandwidths:Yt,key:rr,attributes:Yi})}return L}parseConnections(){const L=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)L.push(this.parseConnection());return L}parseFmt(L){const ie=[];for(;;)try{this.consumeSpaceForRecord(L),ie.push(this.extract(L,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(L,ie){for(var de=arguments.length,Xe=new Array(de>2?de-2:0),Yt=2;Yt<de;Yt++)Xe[Yt-2]=arguments[Yt];const rr=ie.call(this,L.value,L.cur,...Xe),Yi=L.value.slice(L.cur,rr);return L.cur=rr,Yi}extractOneOrMore(L,ie){const de=this.consumeOneOrMore(L.value,L.cur,ie),Xe=L.value.slice(L.cur,de);return L.cur=de,Xe}consumeSpaceForRecord(L){if(L.value[L.cur]!==_)throw new Error("Invalid space at ".concat(L.cur,"."));L.cur+=1}}class pt extends qe{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(L,ie,de){const Xe=this.consumeOneOrMore(L.attValue,L._cur,ie),Yt=L.attValue.slice(L._cur,Xe),[rr,Yi]=de||[];if(typeof rr=="number"&&Yt.length<rr)throw new Error("error in length, should be more or equal than ".concat(rr," characters."));if(typeof Yi=="number"&&Yt.length>Yi)throw new Error("error in length, should be less or equal than ".concat(Yi," characters."));return L._cur=Xe,Yt}consumeAttributeSpace(L){if(L.attValue[L._cur]!==_)throw new Error("Invalid space at ".concat(L._cur,"."));L._cur+=1}extract(L,ie){if(!L.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,Xe=new Array(de>2?de-2:0),Yt=2;Yt<de;Yt++)Xe[Yt-2]=arguments[Yt];const rr=ie.call(this,L.attValue,L._cur,...Xe),Yi=L.attValue.slice(L._cur,rr);return L._cur=rr,Yi}atEnd(L){if(!L.attValue)throw new Error;return L._cur>=L.attValue.length}peekChar(L){if(!L.attValue)throw new Error;return L.attValue[L._cur]}peek(L,ie){if(!L.attValue)throw new Error;for(let de=0;de<ie.length;de++)if(ie[de]!==L.attValue[L._cur+de])return!1;return!0}parseIceUfrag(L){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(L,Y,[4,256])}parseIcePwd(L){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(L,Y,[22,256])}parseIceOptions(L){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(L);){ie.push(this.extractOneOrMore(L,Y));try{this.consumeAttributeSpace(L)}catch(de){if(this.atEnd(L))break;throw de}}this.attributes.iceOptions=ie}parseFingerprint(L){const ie=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:de})}parseExtmap(L){const ie=this.extractOneOrMore(L,S);let de;this.peekChar(L)==="/"&&(this.extract(L,this.consume,"/"),de=this.extract(L,this.consumeToken)),this.consumeAttributeSpace(L);const Xe=this.extract(L,this.consumeTill,_),Yt=ge(ge({entry:parseInt(ie,10)},de&&{direction:de}),{},{extensionName:Xe});this.peekChar(L)===_&&(this.consumeAttributeSpace(L),Yt.extensionAttributes=this.extract(L,this.consumeTill)),this.attributes.extmaps.push(Yt)}parseSetup(L){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(L,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class vn extends pt{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"group":this.parseGroup(L);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"fingerprint":this.parseFingerprint(L);break;case"setup":this.parseSetup(L);break;case"tls-id":this.parseTlsId(L);break;case"identity":this.parseIdentity(L);break;case"extmap":this.parseExtmap(L);break;case"msid-semantic":this.parseMsidSemantic(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ie){throw console.error("parsing session attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ie}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(L){const ie=this.extract(L,this.consumeToken),de=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;)this.consumeAttributeSpace(L),de.push(this.extract(L,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(L){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(L,le)}parseIdentity(L){const ie=this.extractOneOrMore(L,ye),de=[];for(;!this.atEnd(L)&&this.peekChar(L)===_;){this.consumeAttributeSpace(L);const Xe=this.extract(L,this.consumeToken);this.extract(L,this.consume,"=");const Yt=this.extractOneOrMore(L,rr=>rr!==_&&q(rr));de.push({name:Xe,value:Yt})}this.attributes.identities.push({assertionValue:ie,extensions:de})}parseMsidSemantic(L){this.peekChar(L)===_&&this.consumeAttributeSpace(L);const ie={semantic:this.extract(L,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(L)}catch{break}if(this.peekChar(L)==="*"){this.extract(L,this.consume,"*"),ie.applyForAll=!0;break}{const de=this.extract(L,this.consumeTill,_);ie.identifierList.push(de)}}this.attributes.msidSemantic=ie}}class Sn extends pt{constructor(L){super(),ke(this,"attributes",void 0),L.protos.indexOf("RTP")!==-1||L.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(L){if(this.digested)throw new Error("already digested");try{switch(L.attField){case"extmap":this.parseExtmap(L);break;case"setup":this.parseSetup(L);break;case"ice-ufrag":this.parseIceUfrag(L);break;case"ice-pwd":this.parseIcePwd(L);break;case"ice-options":this.parseIceOptions(L);break;case"candidate":this.parseCandidate(L);break;case"remote-candidate":this.parseRemoteCandidate(L);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(L);break;case"rtpmap":this.parseRtpmap(L);break;case"ptime":this.parsePtime(L);break;case"maxptime":this.parseMaxPtime(L);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(L);break;case"ssrc":this.parseSSRC(L);break;case"fmtp":this.parseFmtp(L);break;case"rtcp-fb":this.parseRtcpFb(L);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(L);break;case"mid":this.parseMid(L);break;case"msid":this.parseMsid(L);break;case"imageattr":this.parseImageAttr(L);break;case"rid":this.parseRid(L);break;case"simulcast":this.parseSimulcast(L);break;case"sctp-port":this.parseSctpPort(L);break;case"max-message-size":this.parseMaxMessageSize(L);break;case"ssrc-group":this.parseSSRCGroup(L);break;default:L.ignored=!0,this.attributes.unrecognized.push(L)}}catch(ie){throw console.error("parsing media attribute ".concat(L.attField,' error, "a=').concat(L.attField,":").concat(L.attValue,'"')),ie}if(!L.ignored&&L.attValue&&!this.atEnd(L))throw new Error("attribute parsing error")}parseCandidate(L){const ie=this.extractOneOrMore(L,Y,[1,32]);this.consumeAttributeSpace(L);const de=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const Xe=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const Yt=this.extractOneOrMore(L,S,[1,10]);this.consumeAttributeSpace(L);const rr=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Yi=this.extract(L,this.consumePort);this.consumeAttributeSpace(L),this.extract(L,this.consume,"typ"),this.consumeAttributeSpace(L);const ja={foundation:ie,componentId:de,transport:Xe,priority:Yt,connectionAddress:rr,port:Yi,type:this.extract(L,this.consumeToken),extension:{}};for(this.peek(L," raddr")&&(this.extract(L,this.consume," raddr"),this.consumeAttributeSpace(L),ja.relAddr=this.extract(L,this.consumeAddress)),this.peek(L," rport")&&(this.extract(L,this.consume," rport"),this.consumeAttributeSpace(L),ja.relPort=this.extract(L,this.consumePort));this.peekChar(L)===_;){this.consumeAttributeSpace(L);const lp=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L),ja.extension[lp]=this.extractOneOrMore(L,R)}this.attributes.candidates.push(ja)}parseRemoteCandidate(L){const ie=[];for(;;){const de=this.extractOneOrMore(L,S,[1,5]);this.consumeAttributeSpace(L);const Xe=this.extract(L,this.consumeAddress);this.consumeAttributeSpace(L);const Yt=this.extract(L,this.consumePort);ie.push({componentId:de,connectionAddress:Xe,port:Yt});try{this.consumeAttributeSpace(L)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(L){const ie=this.extract(L,this.consumeToken);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,"/");this.extract(L,this.consume,"/");const Xe={encodingName:de,clockRate:this.extractOneOrMore(L,S)};this.atEnd(L)||this.peekChar(L)!=="/"||(this.extract(L,this.consume,"/"),Xe.encodingParameters=parseInt(this.extract(L,this.consumeTill),10));const Yt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));Yt?Yt.rtpMap=Xe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Xe,rtcpFeedbacks:[]})}parsePtime(L){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(L,this.consumeTill)}parseMaxPtime(L){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(L,this.consumeTill)}parseDirection(L){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=L.attField}parseSSRC(L){const ie=this.extractOneOrMore(L,S);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,":");let Xe;this.peekChar(L)===":"&&(this.extract(L,this.consume,":"),Xe=this.extract(L,this.consumeTill));const Yt=this.attributes.ssrcs.find(rr=>rr.ssrcId===parseInt(ie,10));Yt?Yt.attributes[de]=Xe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[de]:Xe}})}parseFmtp(L){const ie=this.extract(L,this.consumeTill,_);this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill),Xe={};de.split(";").forEach(rr=>{let[Yi,ja]=rr.split("=");Yi=co(Yi).call(Yi);const lp=typeof ja=="string"?co(ja).call(ja):null;typeof Yi=="string"&&Yi.length>0&&(Xe[Yi]=lp)});const Yt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));Yt?Yt.fmtp={parameters:Xe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Xe}})}parseFmtParameters(L){const ie={},de=this.extract(L,this.consumeTill,"=");L._cur++;const Xe=this.extract(L,this.consumeTill,";");for(ie[de]=Xe;L.attValue[L._cur]===";";){const Yt=this.extract(L,this.consumeTill,"=");L._cur++;const rr=this.extract(L,this.consumeTill,";");ie[Yt]=rr}return ie}parseRtcpFb(L){let ie="";ie=this.peekChar(L)==="*"?this.extract(L,this.consume,"*"):this.extract(L,this.consumeTill,_),this.consumeAttributeSpace(L);const de=this.extract(L,this.consumeTill,_);let Xe;if(de==="trr-int")Xe={type:de,interval:this.extract(L,this.consumeTill)};else{const Yt={type:de};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),Yt.parameter=this.extract(L,this.consumeToken),this.peekChar(L)===_&&(Yt.additional=this.extract(L,this.consumeTill))),Xe=Yt}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Xe);else{const Yt=this.attributes.payloads.find(rr=>rr.payloadType===parseInt(ie,10));Yt?Yt.rtcpFeedbacks.push(Xe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Xe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(L){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(L,this.consumePort)};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),ie.netType=this.extractOneOrMore(L,k),this.consumeAttributeSpace(L),ie.addressType=this.extractOneOrMore(L,k),this.consumeAttributeSpace(L),ie.address=this.extract(L,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(L){const ie={id:this.extractOneOrMore(L,k,[1,64])};this.peekChar(L)===_&&(this.consumeAttributeSpace(L),ie.appdata=this.extractOneOrMore(L,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(L){this.attributes.imageattr.push(L.attValue)}parseRid(L){const ie=this.extractOneOrMore(L,Xe=>U(Xe)||S(Xe)||Xe==="_"||Xe==="-");this.consumeAttributeSpace(L);const de={id:ie,direction:this.extract(L,this.consumeToken),params:[]};if(this.peekChar(L)===_){if(this.consumeAttributeSpace(L),this.peek(L,"pt=")){this.extract(L,this.consume,"pt=");const Xe=[];for(;;){const Yt=this.extract(L,this.consumeToken);Xe.push(Yt);try{this.extract(L,this.consume,",")}catch{break}}de.payloads=Xe,this.peekChar(L)===_&&this.extract(L,this.consume,_)}for(;;){const Xe=this.extract(L,this.consumeToken);switch(Xe){case"depend":{const Yt={type:Xe,rids:this.extract(L,this.consume,"=").split(",")};de.params.push(Yt);break}default:{const Yt={type:Xe};this.peekChar(L)==="="&&(this.extract(L,this.consume,"="),Yt.val=this.extract(L,this.consumeTill,";")),de.params.push(Yt)}}try{this.extract(L,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(L){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=L.attValue,this.extract(L,this.consumeTill)}parseSctpPort(L){this.attributes.sctpPort=this.extractOneOrMore(L,S,[1,5])}parseMaxMessageSize(L){this.attributes.maxMessageSize=this.extractOneOrMore(L,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(L){this.attributes.mid=this.extract(L,this.consumeToken)}parseSSRCGroup(L){const ie=this.extract(L,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(L);const Xe=this.extract(L,this.consumeInteger);de.push(parseInt(Xe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:de})}}function ur(ze,L,ie){return L in ze?Object.defineProperty(ze,L,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ze[L]=ie,ze}class ai{constructor(){ur(this,"eol",m)}print(L,ie){let de="";return ie&&(this.eol=ie),de+=this.printVersion(L.version),de+=this.printOrigin(L.origin),de+=this.printSessionName(L.sessionName),de+=this.printInformation(L.information),de+=this.printUri(L.uri),de+=this.printEmail(L.emails),de+=this.printPhone(L.phones),de+=this.printConnection(L.connection),de+=this.printBandwidth(L.bandwidths),de+=this.printTimeFields(L.timeFields),de+=this.printKey(L.key),de+=this.printSessionAttributes(L.attributes),de+=this.printMediaDescription(L.mediaDescriptions),de}printVersion(L){return"v=".concat(L).concat(this.eol)}printOrigin(L){return"o=".concat(L.username," ").concat(L.sessId," ").concat(L.sessVersion," ").concat(L.nettype," ").concat(L.addrtype," ").concat(L.unicastAddress).concat(this.eol)}printSessionName(L){return L?"s=".concat(L).concat(this.eol):""}printInformation(L){return L?"i=".concat(L).concat(this.eol):""}printUri(L){return L?"u=".concat(L).concat(this.eol):""}printEmail(L){let ie="";for(const de of L)ie+="e=".concat(de).concat(this.eol);return ie}printPhone(L){let ie="";for(const de of L)ie+="e=".concat(de).concat(this.eol);return ie}printConnection(L){return L?"c=".concat(L.nettype," ").concat(L.addrtype," ").concat(L.address).concat(this.eol):""}printBandwidth(L){let ie="";for(const de of L)ie+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return ie}printTimeFields(L){let ie="";for(const de of L){ie+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const Xe of de.repeats)ie+="r=".concat(Xe.repeatInterval," ").concat(Xe.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(ie+="z=",ie+="z=".concat(de.zoneAdjustments.map(Xe=>"".concat(Xe.time," ").concat(Xe.back?"-":""," ").concat(Xe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(L){return L?"k=".concat(L).concat(this.eol):""}printAttributes(L){let ie="";for(const de of L)ie+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return ie}printMediaDescription(L){let ie="";for(const de of L)ie+=this.printMedia(de.media),ie+=this.printInformation(de.information),ie+=this.printConnections(de.connections),ie+=this.printBandwidth(de.bandwidths),ie+=this.printKey(de.key),ie+=this.printMediaAttributes(de);return ie}printConnections(L){let ie="";for(const de of L)ie+=this.printConnection(de);return ie}printMedia(L){return"m=".concat(L.mediaType," ").concat(L.port," ").concat(L.protos.join("/")," ").concat(L.fmts.join(" ")).concat(this.eol)}printSessionAttributes(L){return new ua(this.eol).print(L)}printMediaAttributes(L){return new je(this.eol).print(L)}}class Hr{constructor(L){ur(this,"eol",void 0),this.eol=L}printIceUfrag(L){return L===void 0?"":"a=ice-ufrag:".concat(L).concat(this.eol)}printIcePwd(L){return L===void 0?"":"a=ice-pwd:".concat(L).concat(this.eol)}printIceOptions(L){return L===void 0?"":"a=ice-options:".concat(L.join(_)).concat(this.eol)}printFingerprints(L){return L.length>0?L.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(L){return L.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(L){return L===void 0?"":"a=setup:".concat(L).concat(this.eol)}printUnrecognized(L){return L.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class ua extends Hr{print(L){let ie="";return ie+=this.printGroups(L.groups),ie+=this.printMsidSemantic(L.msidSemantic),ie+=this.printIceLite(L.iceLite),ie+=this.printIceUfrag(L.iceUfrag),ie+=this.printIcePwd(L.icePwd),ie+=this.printIceOptions(L.iceOptions),ie+=this.printFingerprints(L.fingerprints),ie+=this.printSetup(L.setup),ie+=this.printTlsId(L.tlsId),ie+=this.printIdentity(L.identities),ie+=this.printExtmap(L.extmaps),ie+=this.printUnrecognized(L.unrecognized),ie}printGroups(L){let ie="";return L.length>0&&(ie+=L.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(Xe=>"".concat(_).concat(Xe)).join("")).concat(this.eol)).join("")),ie}printIceLite(L){return L===void 0?"":"a=ice-lite"+this.eol}printTlsId(L){return L?"a=tls-id:".concat(L).concat(this.eol):""}printIdentity(L){return L.length===0?"":L.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(de=>"".concat(_).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(L){if(!L)return"";let ie="a=msid-semantic:".concat(L.semantic);return L.applyForAll?ie+="".concat(_,"*"):L.identifierList.length>0&&(ie+=L.identifierList.map(de=>"".concat(_).concat(de))),ie+this.eol}}class je extends Hr{print(L){const ie=L.attributes;let de="";return de+=this.printRTCP(ie.rtcp),de+=this.printIceUfrag(ie.iceUfrag),de+=this.printIcePwd(ie.icePwd),de+=this.printIceOptions(ie.iceOptions),de+=this.printCandidates(ie.candidates),de+=this.printRemoteCandidatesList(ie.remoteCandidatesList),de+=this.printEndOfCandidates(ie.endOfCandidates),de+=this.printFingerprints(ie.fingerprints),de+=this.printSetup(ie.setup),de+=this.printMid(ie.mid),de+=this.printExtmap(ie.extmaps),de+=this.printRTPRelated(ie),de+=this.printPtime(ie.ptime),de+=this.printMaxPtime(ie.maxPtime),de+=this.printDirection(ie.direction),de+=this.printSSRCGroups(ie.ssrcGroups),de+=this.printSSRC(ie.ssrcs),de+=this.printRTCPMux(ie.rtcpMux),de+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),de+=this.printRTCPRsize(ie.rtcpRsize),de+=this.printMSId(ie.msids),de+=this.printImageattr(ie.imageattr),de+=this.printRid(ie.rids),de+=this.printSimulcast(ie.simulcast),de+=this.printSCTPPort(ie.sctpPort),de+=this.printMaxMessageSize(ie.maxMessageSize),de+=this.printUnrecognized(ie.unrecognized),de}printCandidates(L){return L.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(de=>"".concat(_).concat(de).concat(_).concat(ie.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(L){return L.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(L){return L===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(L){if(!L.payloads)return"";const ie=L.payloads;let de="";de+=L.rtcpFeedbackWildcards.map(Xe=>this.printRTCPFeedback("*",Xe)).join("");for(const Xe of ie)de+=this.printRtpMap(Xe.payloadType,Xe.rtpMap),de+=this.printFmtp(Xe.payloadType,Xe.fmtp),de+=Xe.rtcpFeedbacks.map(Yt=>this.printRTCPFeedback(Xe.payloadType,Yt)).join("");return de}printFmtp(L,ie){if(!ie)return"";const de=Object.keys(ie.parameters);return de.length===1&&ie.parameters[de[0]]===null?"a=fmtp:".concat(L).concat(_).concat(de[0]).concat(this.eol):"a=fmtp:".concat(L).concat(_).concat(Object.keys(ie.parameters).map(Xe=>"".concat(Xe,"=").concat(ie.parameters[Xe])).join(";")).concat(this.eol)}printRtpMap(L,ie){return ie?"a=rtpmap:".concat(L).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(L,ie){let de="a=rtcp-fb:".concat(L).concat(_),Xe=ie;return Xe.type==="trr-int"?de+="ttr-int".concat(_).concat(Xe.interval):(de+="".concat(Xe.type),Xe.parameter&&(de+="".concat(_).concat(Xe.parameter),Xe.additional&&(de+="".concat(_).concat(Xe.additional)))),de+this.eol}printPtime(L){return L===void 0?"":"a=ptime:".concat(L).concat(this.eol)}printMaxPtime(L){return L===void 0?"":"a=maxptime:".concat(L).concat(this.eol)}printDirection(L){return L===void 0?"":"a=".concat(L).concat(this.eol)}printSSRC(L){return L.map(ie=>Object.keys(ie.attributes).map(de=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(de).concat(ie.attributes[de]?":".concat(ie.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(L){return L===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(L){return L===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(L){return L===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(L){if(L===void 0)return"";let ie="a=rtcp:".concat(L.port);return L.netType&&(ie+="".concat(_).concat(L.netType)),L.addressType&&(ie+="".concat(_).concat(L.addressType)),L.address&&(ie+="".concat(_).concat(L.address)),ie+this.eol}printMSId(L){return L.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(L){return L.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(L){return L.map(ie=>{let de="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(de+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(de+="".concat(_).concat(ie.params.map(Xe=>Xe.type==="depend"?"depend=".concat(Xe.rids.join(",")):"".concat(Xe.type,"=").concat(Xe.val)).join(";"))),de+this.eol}).join("")}printSimulcast(L){return L===void 0?"":"a=simulcast:".concat(L).concat(this.eol)}printSCTPPort(L){return L===void 0?"":"a=sctp-port:".concat(L).concat(this.eol)}printMaxMessageSize(L){return L===void 0?"":"a=max-message-size:".concat(L).concat(this.eol)}printMid(L){return L===void 0?"":"a=mid:".concat(L).concat(this.eol)}printSSRCGroups(L){return L.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(de=>"".concat(_).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function it(ze){return new dt().parse(ze)}function Tt(ze,L){return new ai().print(ze,L)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return t[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var u in c)s.o(c,u)&&!s.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Ma(t){return R8.parse(t)}function xm(t,r){return R8.print(t,r)}var ppe=nc("Array").keys,mpe=Ac,gpe=Si,_pe=N,ype=ppe,lL=Array.prototype,Epe={DOMTokenList:!0,NodeList:!0},vpe=function(t){var r=t.keys;return t===lL||_pe(lL,t)&&r===lL.keys||gpe(Epe,mpe(t))?ype:r},zc=l(vpe);function I8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I8(Object(s),!0).forEach(function(o){jr(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):I8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function jr(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const A8=new class extends Nr{constructor(){super(...arguments),jr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Spe{constructor(r){jr(this,"logger",void 0),jr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function uL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function P8(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const bl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},XA=Date.now(),RT=t=>{for(const r in bl)if(Object.prototype.hasOwnProperty.call(bl,r)&&bl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){jr(this,"proxyServerURL",void 0),jr(this,"logLevel",bl.DEBUG),jr(this,"uploadState","collecting"),jr(this,"uploadLogWaitingList",[]),jr(this,"uploadLogUploadingList",[]),jr(this,"uploadErrorCount",0),jr(this,"currentLogID",0),jr(this,"url",void 0),jr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[bl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[bl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[bl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[bl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[bl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Qn("UPLOAD_LOG",!0)}disableLogUpload(){Qn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Spe(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-XA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-XA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=uL()+" Agora-SDK [".concat(RT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=uL()+" %cAgora-SDK [".concat(RT(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case bl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case bl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case bl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case bl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-XA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-XA);const o=Math.max(0,Math.min(4,r[0]));r[0]=uL()+" Agora-SDK [".concat(RT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(t){if(!re("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=P8()+" Agora-SDK [".concat(RT(t),"]:"):s[0]=P8()+" Agora-SDK [".concat(RT(t),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Sl,process_id:re("PROCESS_ID"),payload:JSON.stringify(t)};return pd(async()=>{const s=await ia.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),A8.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var O8;function bpe(t){return us(t.reportId,"params.reportId",0,100,!1),us(t.category,"params.category",0,100,!1),us(t.event,"params.event",0,100,!1),us(t.label,"params.label",0,100,!1),nr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(O8={}).FREE="free",O8.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Tpe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Ki=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Ar=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let wpe=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ut(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];let S=_;if(t.argsMap)try{S=t.argsMap(this,..._)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(t.report||Rt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:Vr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,_);return P instanceof ut?P.then(k=>(R.onSuccess(t.reportResult&&k),k)).catch(k=>{throw R.onError(k),k}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Rt=new class{constructor(){jr(this,"baseInfoMap",new Map),jr(this,"proxyServer",void 0),jr(this,"eventUploadTimer",void 0),jr(this,"setSessionIdTimer",void 0),jr(this,"url",void 0),jr(this,"sids",new Set),jr(this,"backupUrl",void 0),jr(this,"_appId",void 0),jr(this,"_aid",0),jr(this,"keyEventUploadPendingItems",[]),jr(this,"normalEventUploadPendingItems",[]),jr(this,"apiInvokeUploadPendingItems",[]),jr(this,"apiInvokeCount",0),jr(this,"apiInvokeLoggedCount",0),jr(this,"ltsList",[]),jr(this,"lastSendNormalEventTime",Date.now()),jr(this,"customReportCounterTimer",void 0),jr(this,"customReportCount",0),jr(this,"extApiInvoke",async t=>{for(const r of t){const s=sn(sn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Vr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function E(k,G){if(m){let U="[apiInvoke-".concat(_,"]");r.id&&(U+="[".concat(r.id,"]")),r.name&&(U+="[".concat(r.name,"]")),x.info("".concat(U," ").concat(k),k==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let R=!1;ds(r.timeout).then(()=>{R||(this.sendApiInvoke(sn(sn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const P=new xe(X.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(sn(sn({},S()),{},{success:!0},r.reportResult&&{result:k})),E("onSuccess"),k};return s?l8(G,r.name+"Success",s,()=>R=!0):G()},onError:k=>{const G=()=>{if(R)throw k;R=!0,this.sendApiInvoke(sn(sn({},S()),{},{success:!1,error:k})),E("onFailure",k.toString())};return s?l8(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),o=this.createBaseInfo(t,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:sL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientRole:S}=r,R=Date.now(),P=sn(sn({},o),{},{eventType:Ki.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:aL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:Sl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:E,clientType:st(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:Ar.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{role:r.role,eventType:Ki.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Ar.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Ki.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Ar.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=r,E=c-(u&&h?h:s.startTime),S=sn(sn({},o),{},{eventType:Ki.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:E,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:iL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:Ar.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(_){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,P,{eventType:Ki.REJOIN_GATEWAY});this.send({type:Ar.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=Date.now(),c=sn(sn({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:Ar.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Ki.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Ar.PUBLISH,data:u},!0)}subscribe(t,r,s){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,u=Date.now(),h=sn(sn({},c),{},{eventType:Ki.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Ar.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...zc(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn({},u),{},{eventType:Ki.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Ar.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Ki.AB_TEST,lts:c});this.send({type:Ar.AB_TEST,data:u},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Ki.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Ar.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Ki.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Ar.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Ki.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Ar.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Ki.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ar.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Ki.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Ar.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Ar.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const E=_h(JSON.stringify(u));let S=0;const R=[];let P=0;for(let k=0;k<_.length;k++)P+=_.charCodeAt(k)<=127?1:3,P<=m-E||(R[R.length]=gt(gt({},u),{},{[h]:_.substring(S,k)}),S=k,P=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(R[R.length]=gt(gt({},u),{},{[h]:_.substring(S)})),R})(sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Ar.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Ar.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Ar.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Ar.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new xe(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:Ar.USER_ANALYTICS,data:sn(sn({sid:t},c),{},{lts:s})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new xe(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=re("NOT_REPORT_EVENT");if(t.tag&&st(r)&&st(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:u}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof xe){const{code:_,message:E}=t.error;h=_||E||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:o,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Ar.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],o=[];for(;t.length;){const u=t.shift();s.length<20?s.push(u):o.push(u)}t.push(...o);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),sT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&s.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){pi.networkState===uc.OFFLINE&&await ut.race([pi.onlineWaiter,ds(2*Ci.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=$x(JSON.stringify(h.data)),_=new ArrayBuffer(5),E=(R=>{let P=0;return Object.entries(Ar).forEach(k=>{let[G,U]=k;U===R.type&&(P=wpe[G])}),P})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=e8(u,new Uint8Array(_)),u=e8(u,m)}),u},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await Zx(o,{timeout:1e4,data:r(t),headers:sn(sn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(t[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:o};pi.networkState===uc.OFFLINE&&await ut.race([pi.onlineWaiter,ds(2*Ci.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{r?await lpe(h,{timeout:1e4,data:c}):await Zx(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Tpe);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Vr.TRACER}).onSuccess()}};A8.on("REPORT_LOG_UPLOAD",t=>{t.networkState=pi.networkState,Rt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Vr.TRACER}).onSuccess("logUploadError")});class Oe extends xe{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),jr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const hs={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Dn(){return hs}function k8(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(qf()||WW())&&!zx())}function N8(){return!hs.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Yf()}let fs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Uv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function In(t,r,s,o,c){return{width:t,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function gu(t,r,s,o,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function dL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Cpe={"90p":In(160,90),"90p_1":In(160,90),"120p":In(160,120,15,30,65),"120p_1":In(160,120,15,30,65),"120p_3":In(120,120,15,30,50),"120p_4":In(212,120),"180p":In(320,180,15,30,140),"180p_1":In(320,180,15,30,140),"180p_3":In(180,180,15,30,100),"180p_4":In(240,180,15,30,120),"240p":In(320,240,15,40,200),"240p_1":In(320,240,15,40,200),"240p_3":In(240,240,15,40,140),"240p_4":In(424,240,15,40,220),"360p":In(640,360,15,80,400),"360p_1":In(640,360,15,80,400),"360p_3":In(360,360,15,80,260),"360p_4":In(640,360,30,80,600),"360p_6":In(360,360,30,80,400),"360p_7":In(480,360,15,80,320),"360p_8":In(480,360,30,80,490),"360p_9":In(640,360,15,80,800),"360p_10":In(640,360,24,80,800),"360p_11":In(640,360,24,80,1e3),"480p":In(640,480,15,100,500),"480p_1":In(640,480,15,100,500),"480p_2":In(640,480,30,100,1e3),"480p_3":In(480,480,15,100,400),"480p_4":In(640,480,30,100,750),"480p_6":In(480,480,30,100,600),"480p_8":In(848,480,15,100,610),"480p_9":In(848,480,30,100,930),"480p_10":In(640,480,10,100,400),"720p":In(1280,720,15,120,1130),"720p_auto":In(1280,720,30,900,3e3),"720p_1":In(1280,720,15,120,1130),"720p_2":In(1280,720,30,120,2e3),"720p_3":In(1280,720,30,120,1710),"720p_5":In(960,720,15,120,910),"720p_6":In(960,720,30,120,1380),"1080p":In(1920,1080,15,120,2080),"1080p_1":In(1920,1080,15,120,2080),"1080p_2":In(1920,1080,30,120,3e3),"1080p_3":In(1920,1080,30,120,3150),"1080p_5":In(1920,1080,60,120,4780),"1440p":In(2560,1440,30,120,4850),"1440p_1":In(2560,1440,30,120,4850),"1440p_2":In(2560,1440,60,120,7350),"4k":In(3840,2160,30,120,8910),"4k_1":In(3840,2160,30,120,8910),"4k_3":In(3840,2160,60,120,13500)},Rpe={"480p":gu(640,480,5),"480p_1":gu(640,480,5),"480p_2":gu(640,480,30),"480p_3":gu(640,480,15),"720p":gu(1280,720,5),"720p_auto":In(1280,720,30,900,3e3),"720p_1":gu(1280,720,5),"720p_2":gu(1280,720,30),"720p_3":gu(1280,720,15),"1080p":gu(1920,1080,5),"1080p_1":gu(1920,1080,5),"1080p_2":gu(1920,1080,30),"1080p_3":gu(1920,1080,15)},Ipe={"1SL1TL":dL(1,1),"3SL3TL":dL(3,3),"2SL3TL":dL(2,3)};function Eh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Cpe[t]):t}function hL(t){return typeof t=="string"?Object.assign({},Rpe[t]):t}function JA(t){return typeof t=="string"?Object.assign({},Ipe[t]):t}const Ape={speech_low_quality:Uv(16e3,!1),speech_standard:Uv(32e3,!1,18),music_standard:Uv(48e3,!1),standard_stereo:Uv(48e3,!0,56),high_quality:Uv(48e3,!1,128),high_quality_stereo:Uv(48e3,!0,192)};function QA(t){return typeof t=="string"?Object.assign({},Ape[t]):t}const Vv=[];function D8(t){return Mi(t,"mediaSource",["screen","window","application"]),!0}let Et=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),lr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Fv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Ppe=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Ope=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),M_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),jv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Bv=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Wv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Gc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const fL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},pL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},x8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},kpe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},L8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ao=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Hc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),IT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),U_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),lo=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),vh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const mL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ZA=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function M8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Pr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M8(Object(s),!0).forEach(function(o){Pe(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Pe(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function An(t,r,s,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=rc(u=sm(h=s.slice()).call(h)).call(u,function(_,E){return E(t,r,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class U8 extends Nr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(M_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||cr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){st(Vv).call(Vv,o)||Vv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Nm(()=>{var s;Rt.reportApiInvoke(null,{name:wi.GET_MEDIA_STREAM_TRACK,options:[],tag:Vr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Fv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Vv.indexOf(r);s!==-1&&Vv.splice(s,1)}(this),this.emit(jv.CLOSED),this.removeAllListeners(M_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Fv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(M_.TRANSCEIVER_UPDATED,r,s)}}class zv extends U8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Vs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Et.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,Et.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),Xf(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new xe(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new xe(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ut.resolve([])}}const V8=window.AudioContext||window.webkitAudioContext;let $c=null;const Zn=new class extends Nr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(fs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):($c&&await $c.suspend(),this.emit(fs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Gv(){if(!$c){if(function(){if(!V8)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Pr({},re("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),$c=new V8(t),Zn.curState=$c.state,$c.onstatechange=()=>{Zn.prevState=Zn.curState,Zn.curState=$c?$c.state:void 0;const{prevState:r,curState:s}=Zn,o=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",_=Rn().osVersion;(Io()||pu())&&u&&c&&(x.info("ios".concat(_,"-interruption-start")),Zn.emit(fs.IOS_INTERRUPTION_START)),(Io()||pu())&&(h||m)&&o&&(x.info("ios".concat(_,"-interruption-end")),Zn.emit(fs.IOS_INTERRUPTION_END)),r!==s&&Zn.emit(fs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=$c)===null||r===void 0?void 0:r.currentTime;Zn.currentTime!==s?(Zn.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),Zn.currentTimeStuckAt=void 0),Zn.currentTime=s):(s!==Zn.currentTimeStuckAt&&(Rt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Vr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),Zn.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){r.state==="running"?_(!1):Io()||pu()?r.state==="suspended"&&(_(!0),U&&r.resume().then(E,E)):r.state!=="closed"&&(_(!0),U&&r.resume().then(E,E))}function _(U){if(c!==U){c=U;for(let j=0,q=s;j<q.length;j+=1){const Y=q[j];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function R(U){if(!h)if(o.paused)if(U){let j;P(!1),h=!0;try{j=o.play(),j?j.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else P(!0);else P(!1)}function P(U){if(u!==U){u=U;for(let j=0,q=s;j<q.length;j++){const Y=q[j];U?window.addEventListener(Y,G,{capture:!0,passive:!0}):window.removeEventListener(Y,G,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,R(!1)}function G(){R(!0)}if(Io()){const U=r.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=j.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,R(!0)}Zn.on(fs.STATE_CHANGE,function(){m(!0)}),m(!1)}($c)}(),!$c)throw new xe(X.NOT_SUPPORTED,"can not create audio context");return $c}return $c}function V_(t){if(function(){if(gL!==null)return gL;const o=Gv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),gL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(o,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),st(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),r.call(t,o,c,u)):r.call(t,o,c)),t},t.disconnect=(o,c,u)=>{s.call(t),o?WA(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let gL=null;function _L(t,r){let s=!1;const o=1/r;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*o)}else{const c=Gv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),t(c.currentTime)};h()}return()=>{s=!0}}class F8{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Gv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Io()||pu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=rc(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class j8 extends Nr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Gv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),V_(this.outputNode),this.volumeLevelAnalyser=new F8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Gc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Dn().webAudioMediaStreamDest)throw new xe(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&zA(()=>{Zn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Io()||pu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ds(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class B8 extends j8{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),V_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),V_(this.outputNode),this.emit(Gc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new xe(X.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),V_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));V_(_),this.originVolumeLevelAnalyser=new F8,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Rn();s&&h.os===$i.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Zn.on(fs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),V_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Gc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),Zn.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));V_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function W8(t,r,s){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Npe(t,r){const s=await z8(t.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ut((m,_)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const j=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const le=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},j.appendChild(Y),j.appendChild(le)}k.appendChild(j),k.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(E),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Y.thumbnail;try{const{width:Ee}=ye.getSize();Ee>1920&&(ye=ye.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},P.appendChild(le)}})})}(s,r);return await W8(o,t,c)}async function z8(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=t8();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new xe(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ut((u,h)=>{s.desktopCapturer.getSources({types:r},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new xe(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const yL=new Vs("safari");let G8=!1,H8=!1;async function Kc(t,r){let s=0,o=null;for(;s<2;)try{o=await Dpe(t,r,s>0);break}catch(c){if(c instanceof xe)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=eP(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await ds(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new xe(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Dpe(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new xe(X.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=Dn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(t8())t.screen.sourceId?Hv(c,await W8(t.screen.sourceId,t.screen,!!t.screenAudio)):Hv(c,await Npe(t.screen,!!t.screenAudio));else if(qf()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new xe(X.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new ut((k,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void G(new xe(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),G(new xe(X.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,Hv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var u;t.screen.mediaSource&&D8(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:G,systemAudio:U,preferCurrentTab:j}=t.screen,q={selfBrowserSurface:k,surfaceSwitching:G,systemAudio:U,preferCurrentTab:j};!k&&delete q.selfBrowserSurface,!G&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!j&&delete q.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:q})),Hv(c,await navigator.mediaDevices.getDisplayMedia(Pr({video:P,audio:t.screenAudio},q)))}else{if(!Mr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new xe(X.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&D8(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Hv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let _={video:t.video,audio:t.audio},E=re("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),_=Yx(_,E)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(_)),Rn();let S,R=null;(Is()||Io()||jA())&&(R=await yL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(P){throw R&&R(),P}return _.audio&&(G8=!0),_.video&&(H8=!0),Hv(c,S),R&&R(),c}function eP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new xe(X.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new xe(X.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new xe(X.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new xe(X.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new xe(X.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new xe(X.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new xe(X.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Hv(t,r){const s=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&t.removeTrack(o),t.addTrack(u)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const qc=new class extends Nr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(U_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",IT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(BA()||FA()===$i.HARMONY_OS)&&Yf())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new xe(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,E=null;if(!s&&(u||h)){if(yL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await yL.lock())(),x.debug("[device manager] GUM unlock")),G8&&(u=!1,this.isAccessMicrophonePermission=!0),H8&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=eP(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(S){const R=eP(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=eP(S.name||S.code||S,S.message);if(R.code===X.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),_&&_.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,_=null,E=null,new xe(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new xe(X.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=IT.INITING;try{await this.updateDevicesInfo(),this.state=IT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=IT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new xe(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==IT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(U_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(U_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let EL=!1;const Yc=new class extends Nr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function $8(){if(Rn(),!EL){const t=r=>{r.preventDefault(),EL=!1,yT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};EL=!0,yT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Yc.onAutoplayFailed?Yc.onAutoplayFailed():Yc.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Yc.emit("autoplay-failed")}}function K8(t,r,s,o){if(!t)return;const c=Rt.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=Pr(Pr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Yc.onAutoplayFailed||Yc.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Rt.send({type:Ar.AUTOPLAY_FAILED,data:m},!0)}const xpe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],sa=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(Zn.curState==="running")return kv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),Zn.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Zn.on(fs.STATE_CHANGE,()=>{Io()&&Zn.prevState==="suspended"&&Zn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(o){throw new xe(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,lo.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&K8(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),zA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),$8()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){xpe.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(t),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new ut(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{yT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function si(){return function(t,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new xe(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof ut?new ut((_,E)=>{m.then(_).catch(E)}):m}),s}}class q8 extends Nr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new xe(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new xe(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Ao.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ao.ON_TRACK,void 0)}}class Y8 extends Nr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Ps(this,Hc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),ar(this,Hc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),ar(this,Hc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ut&&(o=await o),r.push(Pr(Pr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class X8 extends Nr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new xe(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new xe(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ao.ON_TRACK,void 0),this.emit(Ao.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Ao.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Ao.ON_NODE,this.inputNode))}}class J8 extends Nr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return Ps(this,Hc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),ar(this,Hc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),ar(this,Hc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Fc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(X.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ut&&(o=await o),r.push(Pr(Pr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class vL extends Nr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new Lpe}setVolume(){}createOutputTrack(){throw new xe(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Lpe{disconnect(){}connect(){}}function Q8(t){return new ut((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Io()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Mr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(GA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function tP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Eh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!XW()&&s.frameRate&&(r.frameRate=s.frameRate),WW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Mr()&&(r.frameRate={ideal:30,max:30}),r}function Z8(t){const r={};return XW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,qf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function ez(t){const r=Z8(t);if(t.encoderConfig){const s=QA(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),BA()&&(r.sampleRate=void 0),r}const Mpe=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=Xx(h),m=Xx(m),u=Xx(u);const{max:_,min:E}=function(k,G,U){const j=200*Math.pow(U/15,.6)*Math.pow(k*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=re("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||_,bitrateMin:R||E,scaleResolutionDownBy:1,scale:0}},tz=async(t,r,s)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let R=0;R<E.length;R+=2)S.push(parseInt(E.slice(R,R+2),16));return Uint8Array.from(S)}(h8(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(t.buffer,r,s),SL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ut((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await nz(c);s({buffer:u,width:r.width,height:r.height})}else o(new xe(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},nz=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var rz,iz,sz,oz,az,cz,lz,uz,dz,hz,fz,pz,mz,gz,_z,yz,Ez,vz,Dr,Sz,bz,Tz,wz,Cz,Rz,Sh,Iz,Az,Pz,Oz,kz,Nz,Dz,xz,Lz,Mz,Uz,Vz,Fz,ks;let Gr=(rz=Ut({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),iz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),sz=si(),oz=xv("LocalAudioTrack","_enabledMutex"),az=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),cz=si(),lz=xv("LocalAudioTrack","_enabledMutex"),uz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),dz=si(),hz=si(),fz=si(),pz=Ut({argsMap:t=>[t.getTrackId()]}),mz=si(),gz=Ut({argsMap:t=>[t.getTrackId()]}),_z=si(),yz=Ut({argsMap:t=>[t.getTrackId()]}),Ez=Ut({argsMap:(t,r)=>[t.getTrackId(),r.name]}),vz=Ut({argsMap:t=>[t.getTrackId()]}),An((Dr=class extends zv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,o){super(t,s),Pe(this,"trackMediaType",Wv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new vL,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Is()&&!$c?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){nr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&sa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,ar(this,Et.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!k8())throw new xe(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await ar(this,Et.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await ar(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ar(this,Et.NEED_MUTE_TRACK,this):await ar(this,Et.NEED_UNMUTE_TRACK,this))}getStats(){return Nm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Bc(this,Et.GET_STATS)||Pr({},fL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Gc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Gc.ON_AUDIO_BUFFER),this._source.on(Gc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?sa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,Et.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ut.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new xe(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new xe(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Ao.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await ar(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,Et.NEED_REPLACE_TRACK,this))}),t.on(Ao.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Ao.ON_TRACK),t.removeAllListeners(Ao.ON_NODE)}bindProcessorContextEvents(t){t.on(Hc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Hc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof vL&&(this._trackSource=new B8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new J8(this._source.context,this.getTrackId(),"local"),r=new X8(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Gc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(sa.stop(this.getTrackId()),this._source.play()),ar(this,Et.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[rz],Object.getOwnPropertyDescriptor(Dr.prototype,"setVolume"),Dr.prototype),An(Dr.prototype,"setPlaybackDevice",[iz,sz],Object.getOwnPropertyDescriptor(Dr.prototype,"setPlaybackDevice"),Dr.prototype),An(Dr.prototype,"setEnabled",[oz,az,cz],Object.getOwnPropertyDescriptor(Dr.prototype,"setEnabled"),Dr.prototype),An(Dr.prototype,"setMuted",[lz,uz,dz],Object.getOwnPropertyDescriptor(Dr.prototype,"setMuted"),Dr.prototype),An(Dr.prototype,"getStats",[hz],Object.getOwnPropertyDescriptor(Dr.prototype,"getStats"),Dr.prototype),An(Dr.prototype,"setAudioFrameCallback",[fz],Object.getOwnPropertyDescriptor(Dr.prototype,"setAudioFrameCallback"),Dr.prototype),An(Dr.prototype,"play",[pz,mz],Object.getOwnPropertyDescriptor(Dr.prototype,"play"),Dr.prototype),An(Dr.prototype,"stop",[gz,_z],Object.getOwnPropertyDescriptor(Dr.prototype,"stop"),Dr.prototype),An(Dr.prototype,"close",[yz],Object.getOwnPropertyDescriptor(Dr.prototype,"close"),Dr.prototype),An(Dr.prototype,"pipe",[Ez],Object.getOwnPropertyDescriptor(Dr.prototype,"pipe"),Dr.prototype),An(Dr.prototype,"unpipe",[vz],Object.getOwnPropertyDescriptor(Dr.prototype,"unpipe"),Dr.prototype),Dr),nP=(Sz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),bz=si(),Tz=xv("MicrophoneAudioTrack","_enabledMutex"),wz=Ut({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),Cz=si(),Rz=Ut({argsMap:t=>[t.getTrackId()]}),An((Sh=class extends Gr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,o){super(t,r.encoderConfig?QA(r.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(kv()||Wx())&&Zn.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await qc.getDeviceById(t),s={};s.audio=Pr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await Kc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Kc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await qc.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),re("AUTO_RESET_AUDIO_ROUTE")&&(Io()||pu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await ar(this,Et.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Pr({},this._constraints),u=qc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await Kc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await ar(this,Et.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(kv()||Wx())&&Zn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Io()||pu())&&this._enabled&&!this._isClosed&&Zn.duringInterruption){const t=async()=>{Zn.off(fs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Zn.on(fs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=qc.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await Kc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Hc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Hc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Sz,bz],Object.getOwnPropertyDescriptor(Sh.prototype,"setDevice"),Sh.prototype),An(Sh.prototype,"setEnabled",[Tz,wz,Cz],Object.getOwnPropertyDescriptor(Sh.prototype,"setEnabled"),Sh.prototype),An(Sh.prototype,"close",[Rz],Object.getOwnPropertyDescriptor(Sh.prototype,"close"),Sh.prototype),Sh),Upe=(Iz=Ut({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),Az=si(),Pz=Ut({argsMap:t=>[t.getTrackId()]}),Oz=si(),kz=Ut({argsMap:t=>[t.getTrackId()]}),Nz=si(),Dz=Ut({argsMap:t=>[t.getTrackId()]}),xz=si(),Lz=Ut({argsMap:t=>[t.getTrackId()]}),Mz=si(),Uz=Ut({argsMap:t=>[t.getTrackId()]}),Vz=Ut({argsMap:t=>[t.getTrackId()]}),Fz=si(),An((ks=class extends Gr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,o){super(r.createOutputTrack(),s,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Gc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(jv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){nr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[Iz,Az],Object.getOwnPropertyDescriptor(ks.prototype,"startProcessAudioBuffer"),ks.prototype),An(ks.prototype,"pauseProcessAudioBuffer",[Pz,Oz],Object.getOwnPropertyDescriptor(ks.prototype,"pauseProcessAudioBuffer"),ks.prototype),An(ks.prototype,"seekAudioBuffer",[kz,Nz],Object.getOwnPropertyDescriptor(ks.prototype,"seekAudioBuffer"),ks.prototype),An(ks.prototype,"resumeProcessAudioBuffer",[Dz,xz],Object.getOwnPropertyDescriptor(ks.prototype,"resumeProcessAudioBuffer"),ks.prototype),An(ks.prototype,"stopProcessAudioBuffer",[Lz,Mz],Object.getOwnPropertyDescriptor(ks.prototype,"stopProcessAudioBuffer"),ks.prototype),An(ks.prototype,"close",[Uz],Object.getOwnPropertyDescriptor(ks.prototype,"close"),ks.prototype),An(ks.prototype,"setAudioBufferPlaybackSpeed",[Vz,Fz],Object.getOwnPropertyDescriptor(ks.prototype,"setAudioBufferPlaybackSpeed"),ks.prototype),ks);class Ni extends Gr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Gv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,cr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}WA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Ni?s.emit(M_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Vpe extends j8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Gc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const jz=new Map;class bL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",vh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",lo.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Zn.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BW())),qW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=lo.PLAYING;break;case"loadeddata":if(this.videoState=vh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=lo.CANPLAY;break;case"stalled":this.videoElementStatus=lo.STALLED;break;case"suspend":this.videoElementStatus=lo.SUSPEND;break;case"pause":this.videoElementStatus=lo.PAUSED,Io()||pu()||Is()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=lo.WAITING;break;case"abort":this.videoElementStatus=lo.ABORT;break;case"ended":this.videoElementStatus=lo.ENDED;break;case"emptied":this.videoElementStatus=lo.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=lo.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Qf.lastVisibleTime<Qf.lastHiddenTime||u<Qf.lastHiddenTime||u<Qf.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BW())),qW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),Zn.on(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.on(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&K8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Rn();if((o.name==="Safari"&&Number(o.version)===15||kv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ut((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await nz(m);u({buffer:_,width:o.width,height:o.height})}else h(new xe(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await SL(r)}destroy(){this.renderStats=void 0,Zn.off(fs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Zn.off(fs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=vh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=lo.INIT,!this.videoElementCheckInterval&&(Bz.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=lo.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===vh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=vh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(E,S)=>{if(this.videoElementStatus===lo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===vh.VideoStateStarting&&(this.videoState=vh.VideoStateDecoding),this.videoState===vh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===vh.VideoStateFrozen&&(this.videoState=vh.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Qf.lastVisibleTime>=Qf.lastHiddenTime&&u.timestamp>Qf.lastVisibleTime&&u.timestamp>Qf.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=Pr(Pr({},S),{},{timestamp:E})}var R,P;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,_))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),BA()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Rn();o.name==="Safari"&&Number(o.version)===15||kv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Mr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Mr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Bz.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=lo.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,yT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};yT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),$8()}}const Bz=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Wz extends bL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await SL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,hG,bn,fG,pG,mG,gG,_G,yG,EG,vG,Xc;let Er=(zz=Ut({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),Gz=si(),Hz=Ut({argsMap:t=>[t.getTrackId()]}),$z=xv("LocalVideoTrack","_enabledMutex"),Kz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),qz=si(),Yz=xv("LocalVideoTrack","_enabledMutex"),Xz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),Jz=si(),Qz=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),Zz=si(),eG=si(),tG=Ut({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),nG=si(),rG=si(),iG=si(),sG=si(),oG=si(),aG=si(),cG=si(),lG=Ut({argsMap:(t,r)=>[t.getTrackId(),r.name]}),uG=Ut({argsMap:t=>[t.getTrackId()]}),dG=Ut({argsMap:t=>[t.getTrackId()]}),hG=Ut({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),bn=class Eoe extends zv{get videoHeight(){if(Is()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Is()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",Wv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Is()){const{width:m,height:_}=r.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(lr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Fx(Fn.CHROME,115)&&FA().indexOf("Windows")!==-1){const m=function(_,E){if("VideoFrame"in window&&"TransformStream"in window&&Dn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),R=new MediaStreamTrackGenerator({kind:"video"});let P,k,G=Date.now();const U=()=>{j&&(clearInterval(j),j=void 0),P&&(P.close(),P=void 0),_.stop(),k=void 0,R.removeEventListener("ended",U)};let j=window.setInterval(()=>{if(k&&P&&Date.now()-G>1e3)try{R.readyState==="live"?k.enqueue(P.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,le)=>{R.readyState==="live"?(k=le,G=Date.now(),P===void 0?(P=Y,le.enqueue(Y.clone())):(le.enqueue(P),P=Y)):Y.close()}});return R.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(lr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Y8(this.getTrackId(),"local"),this._processorDestination=new q8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Pr(Pr(Pr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new bL(o):this._player=new Wz(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(jv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await ar(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ar(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await ar(this,Et.NEED_MUTE_TRACK,this):await ar(this,Et.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Eh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=tP({encoderConfig:r});(Is()||Io()||pu())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new xe(X.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Nm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Bc(this,Et.GET_STATS)||Pr({},pL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await SL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await ar(this,Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){Q8(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(GA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new xe(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Eh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,E,S,R,P){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const j=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*E/640/360,.75));P=k==="STANDARD_BITRATE"?4*j:2*j,R=(G=R)!==null&&G!==void 0?G:j}else{var U;R=(U=R)!==null&&U!==void 0?U:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=ZW.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const E=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:wi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new xe(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new xe(X.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Pr(Pr({},o),Eh(r))),o=N_(o);const c=cr(8,"track-video-cloned-"),u=new Eoe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,N_(this._scalabilityMode),this._optimizationMode,c,N_(this._hints));return r&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new xe(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new xe(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Nm(()=>{Rt.reportApiInvoke(null,{name:wi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Vr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new xe(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Ao.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await ar(this,Et.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ar(this,Et.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ao.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hc.REQUEST_CONSTRAINTS)}},An(bn.prototype,"play",[zz,Gz],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),An(bn.prototype,"stop",[Hz],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),An(bn.prototype,"setEnabled",[$z,Kz,qz],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),An(bn.prototype,"setMuted",[Yz,Xz,Jz],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),An(bn.prototype,"setEncoderConfiguration",[Qz,Zz],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),An(bn.prototype,"getStats",[eG],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),An(bn.prototype,"setBeautyEffect",[tG,nG],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),An(bn.prototype,"getCurrentFrameData",[rG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),An(bn.prototype,"getCurrentFrameImage",[iG],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),An(bn.prototype,"setBitrateLimit",[sG],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),An(bn.prototype,"setOptimizationMode",[oG],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),An(bn.prototype,"setScalabiltyMode",[aG],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),An(bn.prototype,"updateMediaStreamTrackResolution",[cG],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),An(bn.prototype,"pipe",[lG],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),An(bn.prototype,"unpipe",[uG],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),An(bn.prototype,"close",[dG],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),An(bn.prototype,"replaceTrack",[hG],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),TL=(fG=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),pG=si(),mG=xv("CameraVideoTrack","_enabledMutex"),gG=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),_G=si(),yG=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),EG=si(),vG=Ut({argsMap:t=>[t.getTrackId()]}),Xc=class voe extends Er{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,u,h){super(r,Eh(s.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(kv()||Wx())&&!function(){const m=Rn();if(m.os!==$i.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&YW()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=Eh(this._config.encoderConfig),Zn.on(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Zn.on(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await qc.getDeviceById(r),o={};o.video=Pr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Kc(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Kc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await qc.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Pr(Pr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Kc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Kc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Pr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Kc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await ar(this,Et.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await ar(this,Et.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Eh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=Fr(this._config);o.encoderConfig=r;const c=tP(o);(Is()||Io()||pu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new xe(X.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(lr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ar(this,Et.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Io()||pu())&&this._enabled&&!this._isClosed&&Zn.duringInterruption){const r=async()=>{Zn.off(fs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Zn.on(fs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(jv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=qc.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await Kc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Zn.off(fs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Zn.off(fs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Pr(Pr({},o),Eh(r))),o=N_(o);const c=cr(8,"track-cam-cloned-"),u=new voe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,N_(Pr(Pr({},this._config),{},{encoderConfig:o})),N_(this._constraints),N_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Hc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(Hc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},An(Xc.prototype,"setDevice",[fG,pG],Object.getOwnPropertyDescriptor(Xc.prototype,"setDevice"),Xc.prototype),An(Xc.prototype,"setEnabled",[mG,gG,_G],Object.getOwnPropertyDescriptor(Xc.prototype,"setEnabled"),Xc.prototype),An(Xc.prototype,"setEncoderConfiguration",[yG,EG],Object.getOwnPropertyDescriptor(Xc.prototype,"setEncoderConfiguration"),Xc.prototype),An(Xc.prototype,"close",[vG],Object.getOwnPropertyDescriptor(Xc.prototype,"close"),Xc.prototype),Xc);function wL(t,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Pr(Pr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var SG,bG,TG,wG,Tl,CG,RG,IG,AG,PG,OG,uo;class kG extends U8{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(cr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let $v=(SG=Ut({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),bG=Ut({argsMap:t=>[t.getTrackId()]}),TG=Ut({argsMap:(t,r)=>[t.getTrackId(),r.name]}),wG=Ut({argsMap:t=>[t.getTrackId()]}),An((Tl=class extends kG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==lo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Wv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Y8(this.getTrackId(),"remote"),this.processorDestination=new q8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Nm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Bc(this,Et.GET_STATS)||Pr({},L8)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Pr(Pr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new bL(s):this._player=new Wz(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Bv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Bv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Bv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Q8(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(GA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=ZW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:wi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new xe(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new xe(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ao.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ao.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(M_.SEI_RECEIVED,t)}}).prototype,"play",[SG],Object.getOwnPropertyDescriptor(Tl.prototype,"play"),Tl.prototype),An(Tl.prototype,"stop",[bG],Object.getOwnPropertyDescriptor(Tl.prototype,"stop"),Tl.prototype),An(Tl.prototype,"pipe",[TG],Object.getOwnPropertyDescriptor(Tl.prototype,"pipe"),Tl.prototype),An(Tl.prototype,"unpipe",[wG],Object.getOwnPropertyDescriptor(Tl.prototype,"unpipe"),Tl.prototype),Tl),Kv=(CG=Ut({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),RG=Ut({argsMap:(t,r)=>[t.getTrackId(),r]}),IG=Ut({argsMap:t=>[t.getTrackId()]}),AG=Ut({argsMap:t=>[t.getTrackId()]}),PG=Ut({argsMap:(t,r)=>[t.getTrackId(),r.name]}),OG=Ut({argsMap:t=>[t.getTrackId()]}),An((uo=class extends kG{get isPlaying(){return this._useAudioElement?sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"trackMediaType",Wv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new vL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new B8(t,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Gc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Bv.FIRST_FRAME_DECODED)}),this.processorContext=new J8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new X8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Gc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Gc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Gc.ON_AUDIO_BUFFER),this._source.on(Gc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?sa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!k8())throw new xe(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await sa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Nm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Bc(this,Et.GET_STATS)||Pr({},x8)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?sa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new xe(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new xe(X.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new xe(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ao.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ao.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ao.ON_TRACK),this.processorDestination.removeAllListeners(Ao.ON_NODE)}}).prototype,"setVolume",[CG],Object.getOwnPropertyDescriptor(uo.prototype,"setVolume"),uo.prototype),An(uo.prototype,"setPlaybackDevice",[RG],Object.getOwnPropertyDescriptor(uo.prototype,"setPlaybackDevice"),uo.prototype),An(uo.prototype,"play",[IG],Object.getOwnPropertyDescriptor(uo.prototype,"play"),uo.prototype),An(uo.prototype,"stop",[AG],Object.getOwnPropertyDescriptor(uo.prototype,"stop"),uo.prototype),An(uo.prototype,"pipe",[PG],Object.getOwnPropertyDescriptor(uo.prototype,"pipe"),uo.prototype),An(uo.prototype,"unpipe",[OG],Object.getOwnPropertyDescriptor(uo.prototype,"unpipe"),uo.prototype),uo);const Qf=new class extends Nr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class NG extends Nr{constructor(r,s){super(),Pe(this,"trackMediaType",Wv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ut((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new xe(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new xe(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new xe(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[ZA.OPEN,ZA.CLOSE,ZA.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Fpe extends NG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(ZA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class jpe extends NG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function rP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>rA.revokeObjectURL(t),0),new Worker(rA.createObjectURL(t))}const DG=71,CL=1,RL=2,IL=1,xG=2;var Zf=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Zf||{});function LG(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==DG)return;const o=t.getUint16(1),c=CL+RL+o,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:u};let m=CL+RL;for(;m<c;){const _=t.getUint8(m),E=t.getUint16(m+IL),S=IL+xG;if(_===Zf.AUDIO_LEVEL){let R=t.getUint8(m+S);for(let P=1;P<E;P++)R=R<<8|t.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:r?127^R>>1:127&R})}else if(_===Zf.METADATA||_===Zf.AUDIO_64_BIT_PTS){const R=new Uint8Array(E);for(let P=0;P<E;P++)R[P]=t.getUint8(m+S+P);h.tlv.push({tag:_,length:E,value:R})}m+=S+E}return h}const iP=new Map,sP=127,F_=1e-10,AL=139/13,oP=new Map;function PL(t,r,s){const o="".concat(t,"-").concat(r,"-").concat(s);let c=0;return oP.has(o)?c=oP.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let E=1;for(let S=h,R=1;S>m;S--,R++)E=E*S/R;return E}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,oP.set(o,c)),c<F_&&(c=F_),c}function MG(t,r,s){const o=r.length,c=t.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let E=m+c;m<E;m++)t[m]>s&&_++;r[h]!==_&&(r[h]=_,u=!0)}return u}window.cache=oP;let Bpe=0;class UG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",F_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",F_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",F_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Bpe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+AL;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<o&&(h=0);const m=Math.floor(h/AL);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return MG(this.mediums,this.longs,4)}computeMediums(){return MG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=PL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=PL(this.longs[0],10,47),this.longSpeechActivityScore>F_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=PL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(sm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>sP&&(o=sP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+AL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>sP&&(s=sP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Wpe{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class OL{constructor(r,s,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class zpe extends Nr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(s,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new UG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==r;)++_;return new OL(c,_,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new OL(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new OL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Wpe(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Fc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const _=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let j=0;j<_.length;++j){const q=m==null?F_:m.getSpeechActivityScore(j);_[j]=Math.log(P.getSpeechActivityScore(j)/q)}const k=_[0],G=_[1],U=_[2];k>3&&G>2&&U>0&&G>E&&(E=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of Fc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const qv=new Map;let gd=null,aP=null;const VG=3;let j_=[];const _d=new Map,cP=new Map;class Gpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(_d.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],u=[];return Array.from(Fc(_d).call(_d)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(Fc(_d).call(_d)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(Fc(_d).call(_d)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let lP;function FG(t){const r=_d.get(t);r&&(_d.delete(t),r.clearTimer())}const uP=new Map,Hpe=new Map;function $pe(t,r,s){let o=new Uint8Array(t,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const dP=new Map,AT=new Map;(function(){const t=Rn();hs.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),hs.getStreamFromExtension=t.name===Fn.CHROME&&Number(t.version)>34,hs.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),hs.supportMinBitrate=t.name===Fn.CHROME||t.name===Fn.EDGE,hs.supportSetRtpSenderParameters=function(){const r=Rn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Yf()||!(!Is()&&!jA())||r.name===Fn.FIREFOX&&Number(r.version)>=64)}(),t.name===Fn.SAFARI&&(Number(t.version)>=14?hs.supportDualStream=!0:hs.supportDualStream=!1),hs.webAudioMediaStreamDest=function(){const r=Rn();return!(r.name===Fn.SAFARI&&Number(r.version)<12)}(),hs.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",hs.supportWebGL=typeof WebGLRenderingContext<"u",hs.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Yf()||(hs.webAudioWithAEC=!0),hs.supportShareAudio=function(){const r=Rn();return(r.os===$i.WIN_10||r.os===$i.WIN_81||r.os===$i.WIN_7||r.os===$i.LINUX||r.os===$i.MAC_OS||r.os===$i.CHROMIUM_OS)&&r.name===Fn.CHROME&&Number(r.version)>=74}(),hs.supportDataChannel=!!(_T(76)||function(r){const s=Rn();return!(s.name!==Fn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||GW(14)),hs.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Mr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),hs.supportWebRTCEncodedTransform=function(){const r=Rn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),hs.supportWebRTCInsertableStream=function(){const r=Rn();return(r.name===Fn.CHROME||r.name===Fn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),hs.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,hs.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,zA(()=>{hs.supportDualStreamEncoding=function(){const r=Rn();return!!re("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",hs)})})();const Kpe=["CHINA","GLOBAL"],jG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],B_=[],Yv=[];function W_(t,r){return!!r&&B_.some(s=>s.uid===t&&s.channelName===r)}function kL(){return Yv.length>0}var qpe=c6.forEach,BG=Tf("forEach")?[].forEach:function(t){return qpe(this,t,arguments.length>1?arguments[1]:void 0)};Vn({target:"Array",proto:!0,forced:[].forEach!=BG},{forEach:BG});var Ype=nc("Array").forEach,Xpe=Ac,Jpe=Si,Qpe=N,Zpe=Ype,NL=Array.prototype,eme={DOMTokenList:!0,NodeList:!0},tme=function(t){var r=t.forEach;return t===NL||Qpe(NL,t)&&r===NL.forEach||Jpe(eme,Xpe(t))?Zpe:r},nme=l(tme),rme=Bo,WG=kc;Vn({target:"Object",stat:!0,forced:d(function(){WG(1)})},{keys:function(t){return WG(rme(t))}});var zG=l(vt.Object.keys),ime=l(sE),sme=l(aE),ome=Vn,GG=$g,ame=m_,cme=at,HG=me,lme=hi,ume=Ce,dme=HI,hme=pr,fme=Ts,pme=QB("slice"),mme=hme("species"),DL=Array,gme=Math.max;ome({target:"Array",proto:!0,forced:!pme},{slice:function(t,r){var s,o,c,u=ume(this),h=lme(u),m=HG(t,h),_=HG(r===void 0?h:r,h);if(GG(u)&&(s=u.constructor,(ame(s)&&(s===DL||GG(s.prototype))||cme(s)&&(s=s[mme])===null)&&(s=void 0),s===DL||s===void 0))return fme(u,m,_);for(o=new(s===void 0?DL:s)(gme(_-m,0)),c=0;m<_;m++,c++)m in u&&dme(o,c,u[m]);return o.length=c,o}});var _me=nc("Array").slice,yme=N,Eme=_me,xL=Array.prototype,vme=function(t){var r=t.slice;return t===xL||yme(xL,t)&&r===xL.slice?Eme:r},Sme=l(vme);function bt(t,r,s,o,c){var u,h,m,_={};return nme(u=zG(o)).call(u,function(E){_[E]=o[E]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=ime(h=sme(m=Sme(s).call(s)).call(m)).call(h,function(E,S){return S(t,r,E)||E},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(qB(t,r,_),_=null),_}let hP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),LL=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),_u=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Po=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),xt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),hr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),zt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),jt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),PT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),_n=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Oo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Jt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function fP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function pP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||QW(t,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ep=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const bme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},ML={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function UL(t,r){us(t.url,"".concat(r,".url"),1,1e3,!1),Ur(t.x)||nr(t.x,"".concat(r,".x"),0,1e4),Ur(t.y)||nr(t.y,"".concat(r,".y"),0,1e4),Ur(t.width)||nr(t.width,"".concat(r,".width"),0,1e4),Ur(t.height)||nr(t.height,"".concat(r,".height"),0,1e4),Ur(t.zOrder)||nr(t.zOrder,"".concat(r,".zOrder"),0,255),Ur(t.alpha)||nr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Tme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Lm=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),VL=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Di=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function $G(t){if(!t.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&us(t.token,"info.token",1,2047),pP(t.uid),fP(t.channelName),!0}let ko=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),tp=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ua=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Xv=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),$n=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),rs=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),mP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),qi=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),jn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const KG=[jn.AFRICA,jn.ASIA,jn.CHINA,jn.EUROPE,jn.GLOBAL,jn.INDIA,jn.JAPAN,jn.NORTH_AMERICA,jn.OCEANIA,jn.OVERSEA,jn.SOUTH_AMERICA];let Fs=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const gP={CHINA:{},ASIA:{CODE:Fs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Fs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Fs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Fs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Fs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Fs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Fs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Fs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Fs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Fs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Fs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Fs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Fs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};sL&&(gP.CHINA={CODE:Fs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let OT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function qG(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class YG extends Nr{constructor(r,s){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class XG extends YG{constructor(r,s){super(r,s),K(this,"establishPromise",void 0)}}let _t=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),js=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),np=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const JG=["disconnected","failed"];let $e=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Hn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),kt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),yu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Eu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),is=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),QG=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),bh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),wl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),yd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Jv=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),oi=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Qv=function(t){return t.ABORT="abort",t}({}),Mm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),wme=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Cme={[hP.ACCESS_POINT]:{[Po.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Po.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Po.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Po.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Po.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Po.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Po.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[hP.UNILBS]:{[_u.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[_u.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[_u.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[_u.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[_u.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[_u.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[_u.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[_u.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[_u.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[_u.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[_u.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[_u.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[hP.STRING_UID_ALLOCATOR]:{[LL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[LL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[LL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Zv(t){const r=Cme[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===hP.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Rme={[xt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[xt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[xt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[xt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[xt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[xt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[xt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[xt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[xt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[xt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[xt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[xt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[xt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[xt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[xt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[xt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[xt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[xt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[xt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[xt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[xt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[xt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[xt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[xt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[xt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[xt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[xt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[xt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[xt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[xt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[xt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[xt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[xt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[xt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[xt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[xt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[xt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[xt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[xt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[xt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[xt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[xt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[xt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[xt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[xt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[xt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[xt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[xt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[xt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[xt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[xt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[xt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[xt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[xt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[xt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[xt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[xt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[xt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[xt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[xt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[xt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[xt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function kT(t){return Rme[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function ZG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function FL(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ZG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ZG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function eH(t,r){if(typeof t=="string")return t;const{proxy:s,host:o,port:c}=t;if(r){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Ime=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Ame=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Pme=/wss:\/\/(.+):([0-9]+)\/?/,Ome=/wss:\/\/(.[^\/]+)\/?/;let kme=0;class Nme{constructor(r,s){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++kme,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var k;return st(k=r.host).call(k,P)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(P=>{_.push(eH(FL(FL({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=FL({},r);if(s&&m){const k=c.find(G=>G!==m);k&&(P.host=P.host.replace(m,k))}_.push(eH(P,s))}try{_.forEach(P=>{const k=new WebSocket(P);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const E=gT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==P&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,E.resolve(P)},P.onclose=k=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),E.reject({code:k.code,reason:mP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=k=>this.logger("".concat(P.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(E.isResolved)return S();Rn().os===$i.MAC_OS&&Mr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{E.resolve(P)}).catch(P=>{this.isNormalPortFailed&&E.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,_;return[,h,m,_]=u.match(Ime)||[],h||([,m,_]=u.match(Ame)||[]),m&&_||([,m,_]=u.match(Pme)||[]),m&&_||([,m]=u.match(Ome)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function tH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class nH extends Nr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;st(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Jt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Jt.CONNECTED):this._state==="closed"?this.emit(Jt.CLOSED):this._state==="failed"&&this.emit(Jt.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var k=arguments[P]!=null?arguments[P]:{};P%2?tH(Object(k),!0).forEach(function(G){K(R,G,k[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(k)):tH(Object(k)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(k,G))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Vs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=s,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);uc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),pi.on(Nv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===uc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=gT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(QG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Jt.CLOSED,()=>{c.reject(new xe(X.WS_DISCONNECT))}),this.once(Jt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new xe(X.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new xe(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=gT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new xe(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Bc(this,Jt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new xe(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Jt.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=re("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const _=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const R=this.state==="closed",P=S instanceof xe,k=P&&S.code===X.WS_ABORT,G=P&&S.code===X.WS_ERR,U=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),R||G?(o.reject(R?new xe(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new xe(X.WS_ERR,"init websocket failed: ".concat(U))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||pi.isOnline||!pi.onlineWaiter||(this.onlineReconnectListener=pi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=Jx(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ut.race([ds(h),this.onlineReconnectListener||new ut(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Jt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ps(this,Jt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&st(m).call(m,"dynamic key expired")?(this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class jL extends nH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=gT(),c=function(h,m){return new Nme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new xe(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class NT extends nH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new ut((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new xe(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const E=r.indexOf("?h="),S=m.find(G=>E!==-1?st(r).call(r,G,E):st(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(U=>{const j=E===-1?r.replace(S,U):r.substr(0,E)+r.substr(E).replace(S,U),q=new WebSocket(j);q.binaryType="arraybuffer",h.push(q),x.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},s),h.forEach(U=>{U.onopen=()=>{if(u)return;const j=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(q=>q!==U).forEach(q=>{x.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=j=>{_=j,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=j=>{x.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(j.data))}}),ds(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(R){var k;let G;x.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(U){const j=new xe(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}G.onopen=()=>{o(G)},G.onclose=U=>{c(U)},G.onmessage=U=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(U.data))},ds(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Dme extends Nr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===hr.CONNECTED?this.emit(zt.WS_CONNECTED):r===hr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===hr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",hr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new p8(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gn.UID_BANNED);break;case 15:this.close(Gn.IP_BANNED);break;case 16:this.close(Gn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case xt.ERR_LICENSE_MISSING:this.close(Gn.LICENSE_MISSING);break;case xt.ERR_LICENSE_EXPIRED:this.close(Gn.LICENSE_EXPIRED);break;case xt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gn.LICENSE_MINUTES_EXCEEDED);break;case xt.ERR_LICENSE_PERIOD_INVALID:this.close(Gn.LICENSE_PERIOD_INVALID);break;case xt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gn.LICENSE_MULTIPLE_SDK_SERVICE);break;case xt.ERR_LICENSE_ILLEGAL:this.close(Gn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new jL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hr.CONNECTED&&this.reconnect("retry",As.OFFLINE)})}async request(r,s,o,c){const u=cr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,_=()=>new ut((G,U)=>{if(this.connectionState===hr.CONNECTED)return G();const j=()=>{this.off(zt.WS_CLOSED,q),G()},q=()=>{this.off(zt.WS_CONNECTED,j),U(new Oe(X.WS_ABORT))};this.once(zt.WS_CONNECTED,j),this.once(zt.WS_CLOSED,q),r!==jt.PUBLISH&&r!==jt.PUBLISH_DATASTREAM&&r!==jt.SUBSCRIBE&&r!==jt.SUBSCRIBE_DATASTREAM&&r!==jt.UNSUBSCRIBE&&r!==jt.UNSUBSCRIBE_DATASTREAM&&r!==jt.UNPUBLISH&&r!==jt.UNPUBLISH_DATASTREAM&&r!==jt.CONTROL&&r!==jt.RESTART_ICE||this.once(zt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),r!==jt.PUBLISH&&r!==jt.RESTART_ICE||this.once(zt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==hr.CONNECTING&&this.connectionState!==hr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new ut((G,U)=>{let j=!1;const q=(le,ye)=>{j=!0,G({isSuccess:le==="success",message:ye||{}}),this.off(zt.WS_CLOSED,Y),this.off(zt.WS_RECONNECTING,Y),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,Y),this.off(zt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(zt.WS_CLOSED,Y),this.once(zt.WS_RECONNECTING,Y),ds(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(G){if(this.connectionState===hr.CLOSED||r===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=kT(R),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===xt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===xt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ut(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(PT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,c=>o(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=hr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Gn.LEAVE,this.connectionState=hr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await Ps(this,zt.REQUEST_JOIN_INFO),s=await this.request(jt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,mP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=bT(this,zt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(jt.REJOIN,r);return!!s&&(this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(_n.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(_n.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(_n.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(_n.MUTE_AUDIO,{uid:o.uid}):this.emit(_n.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(_n.MUTE_VIDEO,{uid:o.uid}):this.emit(_n.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(_n.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(_n.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(_n.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(_n.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=kT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(zt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gn.UID_BANNED),void this.close()):void this.reconnect(s.action,As.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(PT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Jt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Jt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Jt.CLOSED,()=>{this.connectionState=hr.CLOSED}),this.websocket.on(Jt.FAILED,()=>{this._disconnectedReason=Gn.NETWORK_ERROR,this.connectionState=hr.CLOSED}),this.websocket.on(Jt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===hr.CONNECTED?this.connectionState=hr.RECONNECTING:this.connectionState=hr.CONNECTING}),this.websocket.on(Jt.WILL_RECONNECT,(r,s,o)=>{const c=bT(this,zt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=mP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(zt.REPORT_JOIN_GATEWAY,s||mP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(zt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Jt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",As.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===X.UNEXPECTED_RESPONSE&&r.data.code===xt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Gn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Jt.REQUEST_NEW_URLS,(r,s)=>{Ps(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(QG.PRE_CONNECT_PC,()=>{this.emit(zt.PRE_CONNECT_PC)})}}let xme=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),mi=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function rH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function _P(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):rH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Um(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function BL(t,r){t.addresses||(t.addresses=[]);const s=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:k}=R;return{address:"".concat(P,":").concat(k)}});const E=re("GATEWAY_DOMAINS");let S=E[1]&&st(_).call(_,E[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:k,ip:G}=R;if(P)return{address:"".concat(P,".").concat(E[S++%E.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(G),j=U?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(k):"".concat(G,":").concat(k);return U||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:k,address:j}})}(t.addresses,r),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const E=co(c=m[_]).call(c);s[_]&&E&&(s[_].ip6=E)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function dc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function iH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(dc(r.width),"x").concat(dc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function sH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function DT(t,r){let s,o,c;switch(r){case mi.CHOOSE_SERVER:o=4096,c="choose server";break;case mi.CLOUD_PROXY:o=1048576,c="proxy";break;case mi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case mi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>_P(_P({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:_P(_P({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!s)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function oH(t,r){return await ut.all(t.addresses.map(async s=>({address:re("USE_TURN_IP")?s.ip:Um(s.ip),tcpport:s.port,udpport:s.port,username:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Os.username,password:r&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Kx(r.toString()):Os.password})))}function WL(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(dc(t.height),dc(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Vm(t){let{candidateType:r,relayProtocol:s,type:o,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function yP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(r){return r in KA}(t)?t:KA.L1T3}const aH={[_t.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_t.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function EP(t,r,s){r.forEach(o=>{var c;const u=aH[t].find(m=>{var _;let{key:E}=m;return st(_=o.extensionName).call(_,E)});if(!u)return;const h=s.find(m=>{let{extensionName:_}=m;return st(_).call(_,u.key)});h&&st(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function eS(t,r){r.forEach(s=>{var o;const c=aH[t].find(u=>{var h;let{key:m}=u;return st(h=s.extensionName).call(h,m)});st(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function cH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||st(t).call(t,"abs-send-time")}function vP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||st(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function lH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function uH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?lH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function xT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=r,{useXR:E}=s;let S=[],R=[],P=[],k=[],G=!1,U=!1;if(Ma(t).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||G||(R=q.attributes.payloads,k=q.attributes.extmaps,G=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,P=q.attributes.extmaps,U=!0))}),!k||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),E&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),R=R.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return st(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=R.filter(Y=>{var le;return st(_).call(_,((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=q.concat(c?[]:HL(q,R))}const j=re("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(q=>!(q.rtpMap&&st(j).call(j,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:k}}function Fm(t){const r=Ma(t);let s,o;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function dH(t,r){const s=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function hH(t,r,s){const{cname:o}=t;let c=[];r&&(c=fH(r)),c.length===0&&(c=t.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=bP(t.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{E.push({kind:_t.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:_t.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:E}}function fH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function z_(t,r,s){const o=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=cr(8,"track-"),E={ssrcId:h,attributes:uH({label:_,mslabel:s=s||cr(10,""),msid:"".concat(s," ").concat(_)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:uH({label:_,mslabel:s,msid:"".concat(s," ").concat(_)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function tS(t,r){r instanceof Gr&&t.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Mr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function zL(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function GL(t,r){var s;if(!(r instanceof Er&&r._encoderConfig&&r._hints.indexOf(lr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Dn().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Dn().supportMinBitrate&&!st(s=r._hints).call(s,lr.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;st(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function pH(t){if(t.media.mediaType!=="video")return;const r=Rn();if(r.name!==Fn.SAFARI&&r.os!==$i.IOS)return;const s=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function SP(t,r,s){if(!r)return;let o,c;if(t.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=o.find(h=>vP(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(_=>vP(_.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>vP(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>cH(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(_=>_.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,E){return E.filter(S=>!!_.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(E=>E.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>cH(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function mH(t,r,s){if(Mr()||t.media.mediaType!=="video"||!(r instanceof Er)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!re("SIMULCAST")||s==="vp9"&&re("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Fr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Fr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function gH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=xT(E,m,_,"sendonly"),R=xT(E,m,_,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vu(S,R,"videoExtensions",P,k,G),vu(S,R,"videoCodecs",P,k,G),vu(S,R,"audioExtensions",P,k,G),vu(S,R,"audioCodecs",P,k,G),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],j=[];G.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var ye,Ee;const ge=G.videoCodecs[Y+1],ke=ge&&SH(q,ge),qe=(ye=q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],dt=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!qe||qe!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&dt!==re("FIRST_PACKETIZATION_MODE")?ke?j.push([q,ge]):j.push([q]):ke?U.push([q,ge]):U.push([q])}}),U.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((q,Y)=>{var le;if(((le=q.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const ye=SH(q,G.videoCodecs[Y+1]),Ee=U.shift()||j.shift()||[];Ee.length>0&&(ye?G.videoCodecs.splice(Y,2,...Ee):G.videoCodecs.splice(Y,1,...Ee))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>{var Y,le;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((le=q.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:k,sendrecv:G}}(t,r,o);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function _H(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=xT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vu(t,r,"videoExtensions",s,o,c),vu(t,r,"videoCodecs",s,o,c),vu(t,r,"audioExtensions",s,o,c),vu(t,r,"audioCodecs",s,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function vu(t,r,s,o,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((_,E)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,_)=>{h.indexOf(_)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((_,E)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,_)=>{h.indexOf(_)===-1&&c[s].push(m)})}}function bP(t){const{send:r,recv:s,sendrecv:o}=t;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...o.audioCodecs],u.videoCodecs=[...s.videoCodecs,...o.videoCodecs],u.audioExtensions=[...s.audioExtensions,...o.audioExtensions],u.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function nS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function LT(t,r,s,o){let c=[];if(t===_t.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(s.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";st(S).call(S,o)?u.push(E):st(S).call(S,"vp9")?h.push(E):st(S).call(S,"vp8")?m.push(E):st(S).call(S,"h264")&&_.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):_.length!==0&&(u=_,E="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=HL(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return st(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function HL(t,r){const s=t.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&st(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function MT(t,r,s){const o=r.toString(),c=EH(o,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:o});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=yH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function yH(t,r,s){const o=Ma(t),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!st(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&nS(u),c&&st(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),xm(o)}function EH(t,r,s,o){if(re("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?c=>{EH(c,"answer",s==="local"?"remote":"local",o)}:void 0}function vH(t){const r=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>st(t).call(t,s))}function SH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function bH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Cl(t,r){return typeof re(t)===r?re(t):void 0}function Lme(){try{const t=re("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?bH(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):bH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const TH={};function jm(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),TH[t.name]=t}function rp(t){const r=TH[t];if(!r)throw new xe(X.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function wH(t,r){return rp("DataStream").create(t,r)}function TP(){return rp("InterceptFrame").create()}function CH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ip(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?CH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):CH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const $L=new Map;class Mme extends Nr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(rs.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(rs.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:ip(ip({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=rp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Dme(ip(ip({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=$L.get(r.cname);if(u||(u=new Map,$L.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new Oe(X.UID_CONFLICT);throw Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,k]=R.split(":"),G={host:P,port:k};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(E)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var _;throw x.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:((_=E.data)===null||_===void 0?void 0:_.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(rs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:sH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:sH(this._statsCollector.trafficStats.B_dnq)}):this.emit(rs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Gn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==hr.CONNECTED||await function(o,c){return c===1/0?o:ut.race([o,ape(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==Gn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===xt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===xt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(s=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===xt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===xt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===xt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===xt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(jt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(o=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ip({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=$L.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Os.username,password:Os.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ip(ip({},Os),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&zA(()=>{this.emit(rs.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(rs.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,st(Yv).call(Yv,c)||Yv.push(c);const u=!(Mr()||zW(87)||N8())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!N8()&&Cl("ENABLE_PREALLOC_PC","boolean"),m=Lme(),_=_T(87)||function(){const S=Rn();if(S.name!==Fn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),E=ip({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Sl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:ip({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&Fx(Fn.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Cl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Cl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Cl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Cl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Cl("USE_XR","boolean"),enableLossbasedBwe:Cl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:Cl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Cl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Cl("PUBLISH_TWCC","boolean"),enableSubTWCC:Cl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Cl("USE_PUB_RTX","boolean"),enableSubRTX:Cl("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(zt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(zt.WS_RECONNECTING,r=>{this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||As.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Rt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(zt.WS_CLOSED,r=>{let s;switch(r){case Gn.LEAVE:s=As.LEAVE;break;case Gn.UID_BANNED:case Gn.IP_BANNED:case Gn.CHANNEL_BANNED:case Gn.SERVER_ERROR:s=As.SERVER_ERROR;break;case Gn.FALLBACK:s=As.FALLBACK;break;case Gn.LICENSE_MISSING:case Gn.LICENSE_EXPIRED:case Gn.LICENSE_MINUTES_EXCEEDED:case Gn.LICENSE_PERIOD_INVALID:case Gn.LICENSE_MULTIPLE_SDK_SERVICE:case Gn.LICENSE_ILLEGAL:case Gn.TOKEN_EXPIRE:s=r;break;default:s=As.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+As.NETWORK_ERROR)),this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Gn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Gn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(zt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));Qn("EVENT_REPORT_DOMAIN",r[1]),Qn("EVENT_REPORT_BACKUP_DOMAIN",r[1]),Qn("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(_n.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(zt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ps(this,rs.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(zt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Fr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;E.length>0&&(E=[E[R%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Ps(this,rs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(E){s(E)}}),this.signal.on(zt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(zt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(zt.IS_P2P_DISCONNECTED,r=>{r(bT(this,rs.IS_P2P_DISCONNECTED))}),this.signal.on(zt.DISCONNECT_P2P,()=>{this.emit(rs.DISCONNECT_P2P)}),this.signal.on(zt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(zt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(zt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(rs.JOIN_RESPONSE,r,s)}),this.signal.on(zt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=fH(r);this.emit(rs.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(zt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(jt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===$n.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===$n.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===_t.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===_t.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(jt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||As.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let wP=0,KL=0;function Ed(t,r,s,o){return new ut((c,u)=>{r.timeout=r.timeout||re("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),wP+=_h(r.data)):s&&(r.data.size?wP+=r.data.size:r.data instanceof FormData?wP+=a8(r.data):wP+=_h(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ia.request(r).then(h=>{typeof h.data=="string"?KL+=_h(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?KL+=h.data.byteLength:KL+=_h(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{ia.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(je){var it=0;return function(){return it<je.length?{done:!1,value:je[it++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,it,Tt){return je==Array.prototype||je==Object.prototype||(je[it]=Tt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var it=0;it<je.length;++it){var Tt=je[it];if(Tt&&Tt.Math==Math)return Tt}throw Error("Cannot find global object")}(this);function u(je,it){if(it)e:{var Tt=c;je=je.split(".");for(var ze=0;ze<je.length-1;ze++){var L=je[ze];if(!(L in Tt))break e;Tt=Tt[L]}(it=it(ze=Tt[je=je[je.length-1]]))!=ze&&it!=null&&s(Tt,je,{configurable:!0,writable:!0,value:it})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var it=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return it?it.call(je):{next:r(je)}}if(u("Symbol",function(je){function it(L,ie){this.A=L,s(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;it.prototype.toString=function(){return this.A};var Tt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ze=0;return function L(ie){if(this instanceof L)throw new TypeError("Symbol is not a constructor");return new it(Tt+(ie||"")+"_"+ze++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var it="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Tt=0;Tt<it.length;Tt++){var ze=c[it[Tt]];typeof ze=="function"&&typeof ze.prototype[je]!="function"&&s(ze.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var E={};try{E.__proto__={a:!0},_=E.a;break e}catch{}_=!1}o=_?function(je,it){if(je.__proto__=it,je.__proto__!==it)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,it){return je.h=3,{value:it}}function G(je){this.g=new R,this.G=je}function U(je,it,Tt,ze){try{var L=it.call(je.g.j,Tt);if(!(L instanceof Object))throw new TypeError("Iterator result "+L+" is not an object");if(!L.done)return je.g.m=!1,L;var ie=L.value}catch(de){return je.g.j=null,je.g.s(de),j(je)}return je.g.j=null,ze.call(je.g,ie),j(je)}function j(je){for(;je.g.h;)try{var it=je.G(je.g);if(it)return je.g.m=!1,{value:it.value,done:!1}}catch(Tt){je.g.v=void 0,je.g.s(Tt)}if(je.g.m=!1,je.g.l){if(it=je.g.l,je.g.l=null,it.F)throw it.D;return{value:it.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(it){return je.o(it)},this.throw=function(it){return je.s(it)},this.return=function(it){return function(Tt,ze){P(Tt.g);var L=Tt.g.j;return L?U(Tt,"return"in L?L.return:function(ie){return{value:ie,done:!0}},ze,Tt.g.return):(Tt.g.return(ze),j(Tt))}(je,it)},this[Symbol.iterator]=function(){return this}}function Y(je,it){return it=new q(new G(it)),S&&je.prototype&&S(it,je.prototype),it}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},G.prototype.o=function(je){return P(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),j(this))},G.prototype.s=function(je){return P(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),j(this))},u("Array.prototype.entries",function(je){return je||function(){return function(it,Tt){it instanceof String&&(it+="");var ze=0,L=!1,ie={next:function(){if(!L&&ze<it.length){var de=ze++;return{value:Tt(de,it[de]),done:!1}}return L=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(it,Tt){return[it,Tt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(je,it){for(var Tt=0;Tt<je.length;Tt++)it(je[Tt])},ye=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Ee=function(je,it,Tt){return it instanceof Blob?(Tt=Tt!==void 0?Tt+"":typeof it.name=="string"?it.name:"blob",it.name===Tt&&Object.prototype.toString.call(it)!=="[object Blob]"||(it=new File([it],Tt)),[String(je),it]):[String(je),String(it)]},ge=function(je,it){if(je.length<it)throw new TypeError(it+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,qe=ke.FormData,dt=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,pt=ke.Request&&ke.fetch,vn=ke.navigator&&ke.navigator.sendBeacon,Sn=ke.Element&&ke.Element.prototype,ur=ke.Symbol&&Symbol.toStringTag;ur&&(Blob.prototype[ur]||(Blob.prototype[ur]="Blob"),"File"in ke&&!File.prototype[ur]&&(File.prototype[ur]="File"));try{new File([],"")}catch{ke.File=function(it,Tt,ze){return it=new Blob(it,ze||{}),Object.defineProperties(it,{name:{value:Tt},lastModified:{value:+(ze&&ze.lastModified!==void 0?new Date(ze.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ur&&Object.defineProperty(it,ur,{value:"File"}),it}}var ai=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Hr=function(je){this.i=[];var it=this;je&&le(je.elements,function(Tt){if(Tt.name&&!Tt.disabled&&Tt.type!=="submit"&&Tt.type!=="button"&&!Tt.matches("form fieldset[disabled] *"))if(Tt.type==="file"){var ze=Tt.files&&Tt.files.length?Tt.files:[new File([],"",{type:"application/octet-stream"})];le(ze,function(L){it.append(Tt.name,L)})}else Tt.type==="select-multiple"||Tt.type==="select-one"?le(Tt.options,function(L){!L.disabled&&L.selected&&it.append(Tt.name,L.value)}):Tt.type==="checkbox"||Tt.type==="radio"?Tt.checked&&it.append(Tt.name,Tt.value):(ze=Tt.type==="textarea"?ye(Tt.value):Tt.value,it.append(Tt.name,ze))})};if((t=Hr.prototype).append=function(je,it,Tt){ge(arguments,2),this.i.push(Ee(je,it,Tt))},t.delete=function(je){ge(arguments,1);var it=[];je=String(je),le(this.i,function(Tt){Tt[0]!==je&&it.push(Tt)}),this.i=it},t.entries=function je(){var it,Tt=this;return Y(je,function(ze){if(ze.h==1&&(it=0),ze.h!=3)return it<Tt.i.length?ze=k(ze,Tt.i[it]):(ze.h=0,ze=void 0),ze;it++,ze.h=2})},t.forEach=function(je,it){ge(arguments,1);for(var Tt=m(this),ze=Tt.next();!ze.done;ze=Tt.next()){var L=m(ze.value);ze=L.next().value,L=L.next().value,je.call(it,L,ze,this)}},t.get=function(je){ge(arguments,1);var it=this.i;je=String(je);for(var Tt=0;Tt<it.length;Tt++)if(it[Tt][0]===je)return it[Tt][1];return null},t.getAll=function(je){ge(arguments,1);var it=[];return je=String(je),le(this.i,function(Tt){Tt[0]===je&&it.push(Tt[1])}),it},t.has=function(je){ge(arguments,1),je=String(je);for(var it=0;it<this.i.length;it++)if(this.i[it][0]===je)return!0;return!1},t.keys=function je(){var it,Tt,ze,L,ie=this;return Y(je,function(de){if(de.h==1&&(it=m(ie),Tt=it.next()),de.h!=3)return Tt.done?void(de.h=0):(ze=Tt.value,L=m(ze),k(de,L.next().value));Tt=it.next(),de.h=2})},t.set=function(je,it,Tt){ge(arguments,2),je=String(je);var ze=[],L=Ee(je,it,Tt),ie=!0;le(this.i,function(de){de[0]===je?ie&&(ie=!ze.push(L)):ze.push(de)}),ie&&ze.push(L),this.i=ze},t.values=function je(){var it,Tt,ze,L,ie=this;return Y(je,function(de){if(de.h==1&&(it=m(ie),Tt=it.next()),de.h!=3)return Tt.done?void(de.h=0):(ze=Tt.value,(L=m(ze)).next(),k(de,L.next().value));Tt=it.next(),de.h=2})},Hr.prototype._asNative=function(){for(var je=new qe,it=m(this),Tt=it.next();!Tt.done;Tt=it.next()){var ze=m(Tt.value);Tt=ze.next().value,ze=ze.next().value,je.append(Tt,ze)}return je},Hr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),it=[],Tt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ze,L){return typeof ze=="string"?it.push(Tt+ai(ye(L))+`"\r
\r
`+ye(ze)+`\r
`):it.push(Tt+ai(ye(L))+'"; filename="'+ai(ze.name)+`"\r
Content-Type: `+(ze.type||"application/octet-stream")+`\r
\r
`,ze,`\r
`)}),it.push("--"+je+"--"),new Blob(it,{type:"multipart/form-data; boundary="+je})},Hr.prototype[Symbol.iterator]=function(){return this.entries()},Hr.prototype.toString=function(){return"[object FormData]"},Sn&&!Sn.matches&&(Sn.matches=Sn.matchesSelector||Sn.mozMatchesSelector||Sn.msMatchesSelector||Sn.oMatchesSelector||Sn.webkitMatchesSelector||function(je){for(var it=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--it&&je.item(it)!==this;);return-1<it}),ur&&(Hr.prototype[ur]="FormData"),dt){var ua=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,it){ua.call(this,je,it),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Hr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),dt.call(this,je)):dt.call(this,je)}}pt&&(ke.fetch=function(je,it){return it&&it.body&&it.body instanceof Hr&&(it.body=it.body._blob()),pt.call(this,je,it)}),vn&&(ke.navigator.sendBeacon=function(je,it){return it instanceof Hr&&(it=it._asNative()),vn.call(this,je,it)}),ke.FormData=Hr}})();const UT=()=>{const t=re("AREAS");return t.length===0&&t.push(jn.GLOBAL),rc(t).call(t,(r,s,o)=>{const c=RH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},RH=t=>t===jn.OVERSEA?"".concat(Fs.ASIA,",").concat(Fs.EUROPE,",").concat(Fs.AFRICA,",").concat(Fs.NORTH_AMERICA,",").concat(Fs.SOUTH_AMERICA,",").concat(Fs.OCEANIA):Fs[t],Ume=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const o=gP[s],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},CP={GLOBAL:{ASIA:[jn.CHINA,jn.JAPAN,jn.INDIA,jn.KOREA,jn.HKMC],EUROPE:[],NORTH_AMERICA:[jn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},RP=Object.keys(CP[jn.GLOBAL]),qL=[jn.CHINA,jn.NORTH_AMERICA,jn.EUROPE,jn.ASIA,jn.JAPAN,jn.INDIA,jn.OCEANIA,jn.SOUTH_AMERICA,jn.AFRICA,jn.KOREA,jn.HKMC,jn.US],Vme=function(t,r){let s=[];if(st(t).call(t,jn.GLOBAL)){const u=[jn.GLOBAL,jn.OVERSEA],h=Object.keys(gP);if(r===jn.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===jn.CHINA)s=[jn.OVERSEA];else if(c=r,st(RP).call(RP,c)){const m=(o=r,CP[jn.GLOBAL][o]||[]),_=[...u,r,...m];s=h.filter(E=>!st(_).call(_,E))}else if(function(m){let _=!1;return RP.forEach(E=>{var S;st(S=CP[jn.GLOBAL][E]).call(S,m)&&(_=!0)}),_}(r)){const m=function(E){let S;return RP.forEach(R=>{var P;st(P=CP[jn.GLOBAL][R]).call(P,E)&&(S=R)}),S}(r),_=[...u,m,r];s=h.filter(E=>!st(_).call(_,E))}else s=t;s=function(m){const _=[];return qL.forEach(E=>{st(m).call(m,E)&&_.push(E)}),_.concat(m.filter(E=>!st(qL).call(qL,E)))}(s)}else s=t;var o,c;return s};function IH(t){var r,s;if(!t&&st(r=re("AREAS")).call(r,jn.EXTENSIONS))return x.debug("update area from ap : reset"),void YL(Kpe,!0);if(!st(s=re("AREAS")).call(s,jn.GLOBAL)||!t)return;let o=gP.EXTENSIONS;o&&(o={CODE:RH(jn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),o),Qn("AREAS",[jn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Qn(c,o[c][0]):Qn(c,o[c])}))}function YL(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Rt.reportApiInvoke(null,{name:wi.SET_AREA,options:t,tag:Vr.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!st(KG).call(KG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Vme(m,h):m}if(!r){if(md.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(st(o).call(o,jn.GLOBAL)&&re("AREAS")===jn.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}Qn("AREAS",o,r);const c=Ume(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Qn(u,c[u][0]):Qn(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function AH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Th(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?AH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):AH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let XL=1;function Fme(t,r,s,o,c){XL+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:XL,requestId:XL,version:Sl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,_,E=t[0];return pd(async()=>{m=Date.now();const S=await Ed(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw x.error(k.toString()),k}const R=JSON.parse(S.json_body);if(R.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:_});throw x.error(k.toString()),k}if(!R.servers||R.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:_});throw x.error(k.toString()),k}const P=function(k,G){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:k.workerToken,vid:k.vid}}(R,r);return re("LIVE_STREAMING_ADDRESS")&&(P.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),Th(Th({},P),{},{responseTime:_})},(S,R)=>(Rt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:_,serverIp:t[R%t.length]}),!1),(S,R)=>(Rt.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:_,serverIp:t[R%t.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=t[(R+1)%t.length],!0)),c)}let JL=1;function PH(t,r,s,o){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,_=Date.now();let E;const S=r.role,[R,P]=ZL(r,u,[mi.CHOOSE_SERVER]);let k=pi.networkState;return pd(async()=>{k&&pi.networkState===uc.OFFLINE&&pi.onlineWaiter&&await ut.race([pi.onlineWaiter,ds(o&&o.maxRetryTimeout||Ci.maxRetryTimeout)]),k=pi.networkState;const{data:G,headers:U}=await Ed(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=U.http3==="1"?1:-1,Rt.reportResourceTiming(c,m),kH(G,c,r,_,[mi.CHOOSE_SERVER],E);const j=DT(G,mi.CHOOSE_SERVER);return QL(j),BL(j,c)},G=>(G&&Rt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(U=>U.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==X.OPERATION_ABORTED&&(G.code===X.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Rt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function OH(t,r,s,o){let c,{url:u,areaCode:h,serviceIds:m}=t;const _=Date.now(),E=r.role,[S,R]=ZL(r,h,m);let P;return pd(async()=>{P&&pi.networkState===uc.OFFLINE&&pi.onlineWaiter&&await ut.race([pi.onlineWaiter,ds(o&&o.maxRetryTimeout||Ci.maxRetryTimeout)]),P=pi.networkState;const{data:k,headers:G}=await Ed(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Rt.reportResourceTiming(u,r.sid),kH(k,u,r,_,m,c);const U=DT(k,mi.CHOOSE_SERVER),j=DT(k,r.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK);return QL(U),{gatewayInfo:BL(U,u),proxyInfo:j,url:u}},k=>(k.gatewayInfo&&Rt.joinChooseServer(r.sid,{role:E,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&Rt.joinWebProxyAP(r.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(Rt.joinWebProxyAP(r.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const kH=(t,r,s,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=s,E=[],S=R=>{R.flag===4096?Rt.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Rt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:_,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};E.push(k),S(k)}if(P!==0){const k=Zv(P),G={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):E.push(G),S(G)}}),E.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!E.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(E.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},QL=t=>{var r,s,o,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(re("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?IH(t.detail[23].toLowerCase()):IH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const E=co(u=m[_]).call(u);t.addresses[_]&&m&&(t.addresses[_].fingerprint=E)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,E;const S=(_=(E=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:S}});t.addresses=h}},jme=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const o=Zv(s.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},ZL=(t,r,s)=>{const o=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Th(Th(Th({6:t.stringUid,11:r,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Bme=(t,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let rS=0;function iS(t){return ut.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const VT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let _,E=0;const S=async()=>{const R=(()=>{const P=h*m,k=P+m;return s.slice(P,k).map(o)})();u&&u.push(...R);try{_=await iS(R)}catch(P){if(E+=m,h++,!(E>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),_},NH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=t;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function eM(t,r,s,o){return{gatewayInfo:await async function(u,h,m,_){let E=null;const S=[],R=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:UT()})),G=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(j=>j.url)}),U=await VT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),PH(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),U},P=async()=>{if(await ds(1e3),E!==null)return E;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:UT()})),G=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(j=>j.url)}),U=await VT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),PH(j,u,h,m)),allFailedhandler:j=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},G),U};try{return E=await iS([R(),P()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),E}catch(k){throw k[0]}}(t,r,s,o)}}async function DH(t,r,s,o,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await eM(t,r,s,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:k}=await MH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||Os.tcpport,udpport:U.udpport||Os.udpport,username:U.username||Os.username,password:U.password||Os.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=t.uid)!==null&&h!==void 0?h:P.uid,j="glb:".concat(U.toString()),q=await Kx(j),Y=k.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||Os.tcpport,udpport:le.udpport||Os.udpport,username:j,password:q,forceturn:!1,security:!0}));G.push(...Y)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await eM(t,r,s,c)}const{proxyInfo:m,gatewayInfo:_}=await MH(t,r,s,c),E={gatewayInfo:_},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Os.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Os.udpport,username:P.username||Os.username,password:P.password||Os.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:_.uid,k="glb:".concat(P.toString()),G=await Kx(k),U=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Os.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Os.udpport,username:k,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return t.turnServer={mode:"manual",servers:S},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),E}async function xH(t,r,s,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(_=>"https://".concat(r.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(E,S,R,P,k){const G=Date.now(),U={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=E[0];const q=await pd(()=>Ed(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,le)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),Rt.reqUserAccount(U.sid,{lts:G,success:!1,serverAddr:j,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return Rt.reqUserAccount(U.sid,{lts:G,success:!0,serverAddr:j,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const ye=Zv(Y.code);return ye.retry&&(j=E[(le+1)%E.length]),Rt.reqUserAccount(U.sid,{lts:G,success:!1,serverAddr:j,stringUid:U.string_uid,uid:Y.uid,errorCode:ye.desc,extend:U}),ye.retry},(Y,le)=>Y.code!==X.OPERATION_ABORTED&&(Rt.reqUserAccount(U.sid,{lts:G,success:!1,serverAddr:j,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),j=E[(le+1)%E.length],!0),k);if(q.code!==0){const Y=Zv(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,t,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Wme(t,r,s){const o=re("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await NH({referenceList:c,asyncMapHandler:h=>async function(m,_,E,S){const R=Date.now(),P={sid:E.sid,opid:10,appid:E.appId,string_uid:_};try{const k=await Ed(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const G=Zv(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:k.uid,elapse:Date.now()-R}}catch(k){throw k}}(h,t,r,s),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function zme(t,r,s){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(E,S,R,P){const k=Rn(),G={flag:64,cipher_method:0,features:Th(Th(Th(Th(Th({install_id:iL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:Sl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:xme.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return pd(()=>Ed(E,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,P)}(_,t,r,s));let u=null,h=null,m={};try{u=await iS(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),Rt.reportApiInvoke(t.sid,{name:wi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const E=_.test_tags,S=Object.keys(E),R={};return S.forEach(P=>{var k;const G=co(k=P.slice(4)).call(k),U=JSON.parse(E[P]),j=U[1];R[G]={tag:U[0]||"",value:j}}),R}(u)}catch{}return m}async function LH(t,r){const s=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:UT(),serviceIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK]}));try{return await NH({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let _,{url:E,areaCode:S,serviceIds:R}=u;const P=Date.now(),[k,G]=ZL(h,S,R);let U=pi.networkState;try{U&&pi.networkState===uc.OFFLINE&&pi.onlineWaiter&&await ut.race([pi.onlineWaiter,ds(Ci.maxRetryTimeout)]),U=pi.networkState;const{data:j,headers:q}=await Ed(E,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(Ee=>{const ge=[];if(Ee.response_body.forEach(ke=>{const qe=ke.buffer.code;if(ke.uri===23&&qe===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const dt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:ke.buffer.flag};ge.push(dt)}if(qe!==0){const dt=Zv(qe),pt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,dt.desc,{desc:dt.desc,retry:dt.retry,csIp:Ee.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?x.warning(pt.error.toString()):ge.push(pt)}}),ge.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ge.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!ge.find(ke=>ke.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(ge.map(ke=>{var qe;return ke==null||(qe=ke.error)===null||qe===void 0||(qe=qe.data)===null||qe===void 0?void 0:qe.desc}).filter(ke=>!!ke))]})})(j);const le=DT(j,mi.CHOOSE_SERVER),ye=DT(j,mi.CLOUD_PROXY_FALLBACK);return QL(le),{gatewayInfo:BL(le,E),proxyInfo:ye,opid:G,requestTime:P,url:E,isHttp3:_,elapse:Date.now()-P}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function MH(t,r,s,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,G,U)=>{let j=U||c;return Array.isArray(j)&&(j=G%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((j,q)=>{let Y;return Y=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:UT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(j=>j.url)}),U=await VT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),OH(j,t,r,s)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),U},E=async()=>{if(await ds(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((j,q)=>{let Y;return Y=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:UT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(j=>j.url)}),U=await VT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),OH(j,t,r,s)),allFailedhandler:j=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),U};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await iS([_(),E()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!R)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];st(c).call(c,k)&&(t.proxyServer=k,x.setProxyServer(k),Rt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await oH(R,S.uid)},h}async function Gme(t,r,s){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Sl,cname:m.cname,uid:m.uid.toString(),requestId:JL,seq:JL};JL+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return pd(async()=>{const P=await Ed(h,{data:R,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const k=JSON.parse(P.json_body);if(k.code!==200){const G=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw x.error(G.toString()),G}if(!k.servers||k.servers.length===0){const G=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==X.OPERATION_ABORTED&&P.code!==X.UNEXPECTED_RESPONSE||P.data&&P.data.retry),E)}(u,t,r,s));try{const u=await iS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Hme(t,r,s){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await ds(1e3),o!==null)?o:await VT({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(E,S,R,P){const[k]=Bme(S,[mi.CHOOSE_SERVER]);let G=pi.networkState;return pd(async()=>{G&&pi.networkState===uc.OFFLINE&&pi.onlineWaiter&&await ut.race([pi.onlineWaiter,ds(P&&P.maxRetryTimeout||Ci.maxRetryTimeout)]),G=pi.networkState;const U=await Ed(E,{data:k,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return jme(U,E)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),P)}(_,t,r,s)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await iS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function UH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function tM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):UH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class $me extends Nr{get isSuccess(){return!!this.configs}constructor(r,s){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Vs("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Rt.reportApiInvoke(null,{options:void 0,name:wi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Vr.TRACER}).onSuccess(JSON.stringify(md))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await zme(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=sT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const k=P.__priority,G=h[S-1],U=c[G].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const j=R;h[S]=h[S-1],h[S-1]=j}}else{const j=R;h[S]=h[S-1],h[S-1]=j}}}const m=Date.now();let _={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(_[E]=c[E])}),_}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(X.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){qG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(OT.UPDATE_BITRATE_LIMIT,r):this.emit(OT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&tM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,E=r[u].value,S=r[u].tag;let R=0;_?_===T8.REALTIME&&(R=1):Object.keys(E).some(P=>Object.prototype.hasOwnProperty.call(cL,P)||!kL()&&Object.prototype.hasOwnProperty.call(qA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:E}=u;this.store.sessionId&&Rt.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=tM(tM({value:m[S]},_&&{expires:_}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&qG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const _=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:R,expires:P}=m[E];P&&P<=_||((R===T8.REALTIME||Object.prototype.hasOwnProperty.call(cL,E))&&(md[E]=S,yr[E]=S,x.debug("Update realtime parameters from config distribute",E,S)),R||kL()||!Object.prototype.hasOwnProperty.call(qA,E)||(md[E]=S,yr[E]=S,x.debug("Update gateway parameters from config distribute",E,S)))})}catch(_){x.error("Error update config immediately: ".concat(m),_.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(yr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(yr[o],c)||(md[o]=c,yr[o]=c,this.emit(OT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class Kme extends Nr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=st(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",VH[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",VH[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Ni&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=dc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Ni&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const VH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Bs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function FH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function G_(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?FH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):FH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class FT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",KA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Kme,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||G_({},fL)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||G_({},pL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:R}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?Bs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Bs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=G_({},pL),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.videoSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case $e.LocalAudioTrack:{const h=c,m=G_({},fL),_=r.getStats(),E=r.getLocalMedia(o);if(_){const S=_.audioSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=s;const E=m,S=h,R=_,P=G_({},x8),k=G_({},L8),G=G_({},kpe),{audioTrack:U,videoTrack:j,audioSSRC:q,videoSSRC:Y}=r.getRemoteMedia(u);let le;le=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=le)===null||o===void 0?void 0:o.audioRecv.find(qe=>qe.ssrc===q),Ee=(c=le)===null||c===void 0?void 0:c.videoRecv.find(qe=>qe.ssrc===Y),ge=this.trafficStats&&this.trafficStats.peer_delay.find(qe=>qe.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):U&&(P.receiveLevel=Math.round(32767*U.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=E?8*Math.max(0,P.receiveBytes-E.receiveBytes):0,P.totalDuration=E?E.totalDuration+1:1,P.totalFreezeTime=E?E.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&FT.isRemoteAudioFreeze(U)&&(P.totalFreezeTime+=1)),Ee){var ke;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(k.codecType=Ee.codec),k.receiveBytes=Ee.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,k.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(k.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(k.receiveFrameRate=Ee.receivedFrame.frameRate,k.receiveResolutionHeight=Ee.receivedFrame.height,k.receiveResolutionWidth=Ee.receivedFrame.width):j&&(k.receiveResolutionHeight=j._videoHeight||0,k.receiveResolutionWidth=j._videoWidth||0),Ee.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(Ee.framesRateFirefox)),k.receivePackets=Ee.packets,k.receivePacketsLost=Ee.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const qe=S?S.totalFreezeTime:0,dt=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=Ee.totalFreezesDuration)!==null&&ke!==void 0?ke:qe||0,k.receiveDelay=Ee.jitterBufferMs||0;const pt=!!Y&&r.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&j&&pt&&FT.isRemoteVideoFreeze(j,Ee,R)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-qe)/(k.totalDuration-dt),1))}ge&&(P.end2EndDelay=ge.B_ad,k.end2EndDelay=ge.B_vd,P.transportDelay=ge.B_ed,k.transportDelay=ge.B_ed,P.currentPacketLossRate=ge.B_ealr4/100,k.currentPacketLossRate=ge.B_evlr4/100,G.uplinkNetworkQuality=ge.B_punq?ge.B_punq:0,G.downlinkNetworkQuality=ge.B_pdnq?ge.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:k,videoPcStats:Ee,networkStats:G}),U&&this.exceptionMonitor.setRemoteAudioStats(U,P),j&&this.exceptionMonitor.setRemoteVideoStats(j,k)})}}class jH{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){$G(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){$G(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){fP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function BH(t){if(!(t instanceof jH))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Bm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function WH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function zH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?WH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):WH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const jT="9",GH=4e4;function HH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?HH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):HH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var sS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(sS||{});const IP=new Map;function $H(t,r,s,o){let{scale:c}=t;if(c===0&&o===sS.UP||c>=r.length-1&&o===sS.DOWN)return t;let u=sp(sp({},t),{},{scale:o===sS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=sp(sp({},u),r[c].motion);break;case"maintain-resolution":u=sp(sp({},u),r[c].detail);break;case"balanced":u=sp(sp({},u),r[c].balanced)}return u}function KH(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:qH(r)};IP.set(t,s)}else IP.delete(t)}function qH(t){const r=sp({},t),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Ee}=oL,ge=Math.min(r.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(k,1)*ge),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u}}];for(let qe=1;qe<=_;qe++){const dt={bwe_up:Math.round(Math.pow(R,qe)*s),bwe_down:Math.round(Math.pow(P,qe+1)*s),fps_up:Math.round(Math.pow(G,qe)*ge),fps_down:Math.round(Math.pow(k,qe+1)*ge)},pt={scaleResolutionDownBy:c/Math.pow(q,qe),frameRate:Math.max(Math.round(Math.pow(j,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,qe)*s),S),bitrateMin:Math.max(Math.round(Math.pow(U,qe)*u),E)},vn={scaleResolutionDownBy:c/Math.pow(Y,qe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,qe)*s),S),bitrateMin:Math.max(Math.round(Math.pow(le,qe)*u),E)},Sn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,qe)*s),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,qe)*u),E)};ke.push({scale:qe,threshold:dt,balanced:pt,motion:vn,detail:Sn})}return ke}function qme(t,r,s,o,c,u){const h=IP.get(t)||{overUse:0,underUse:0,adaptationList:qH(c)},{adaptationList:m}=h;IP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:E}=oL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(k,G,U,j){if(G>=U.length)return!1;let{threshold:{fps_down:q}}=U[G];return re("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(r,S,m,u)&&(h.overUse++,P=wT.CPU,h.overUse>_)||typeof s=="number"&&s>0&&function(k,G,U){if(G>=U.length)return!1;const{threshold:{bwe_down:j}}=U[G];return k<j}(s,S,m)&&(h.overUse++,P=wT.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,R=$H(o,m,u,sS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(k,G,U,j){if(G===0)return;let{threshold:{fps_up:q}}=U[G];return re("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(r,S,m,u)&&function(k,G,U){if(G===0)return;const{threshold:{bwe_up:j}}=U[G];return k>j}(s,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,R=$H(o,m,u,sS.UP),R.scale===0&&(P=wT.NONE))),[R,P])}function YH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function nM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?YH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):YH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Yme(t){var r;return!!re("ENABLE_AG_ADAPTATION")&&!!(t instanceof TL||st(r=t._hints).call(r,lr.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=Rn();if(o.os!==$i.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&HW(17,4)||GW(14)&&$W(17,4,!0)))}const AP=new Map;function PP(t,r){const s=AP.get(t);if(s){const{timer:o}=s;window.clearTimeout(o),AP.delete(t)}r.qualityLimitationReason=wT.NONE,KH(t)}function Xme(t,r){var s;let o;switch(r){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(s=t._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return o}function rM(t){const r=Dn();if(t.some(s=>s._bypassWebAudio))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function iM(t,r){rM(t);const s=new Ni;return t.forEach(o=>s.addAudioTrack(o)),s}const Jme=!Dn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Yf();function OP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return Jme?(s={spec:r,store:t},rp("PlanBConnection").create(s)):new wh(r,t)}function sM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function XH(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(ST(t.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Tn;function JH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function vd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?JH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):JH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let wh=(Tn=class dy extends XG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return st(s=Object.keys(YA)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"id",cr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:re("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",wT.NONE),K(this,"isFirstConnected",!1),this.store=s,this.forceTurn=XH(r),this.mutex=new Vs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(dy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=rL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Fm(o.sdp),u=await gH({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=bP(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:KA.L1T3}]});const E=await _.createOffer();if(!E.sdp)return void _.close();const S=Ma(E.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&vH(o.sdp)&&(h=Fr(u),(s=h).send&&(eS(_t.VIDEO,s.send.videoExtensions),eS(_t.AUDIO,s.send.audioExtensions)),s.recv&&(eS(_t.VIDEO,s.recv.videoExtensions),eS(_t.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(eS(_t.VIDEO,s.sendrecv.videoExtensions),eS(_t.AUDIO,s.sendrecv.audioExtensions))),vd(vd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new xe(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&vH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(EP(_t.VIDEO,s.send.videoExtensions,o.send.videoExtensions),EP(_t.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(EP(_t.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),EP(_t.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Fr(this._localCapabilities)}get rtpCapabilities(){return Fr(this._rtpCapabilities)}get candidates(){return Fr(this._candidates)}get iceParameters(){return Fr(this._iceParameters)}get dtlsParameters(){return Fr(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=Fr(E);const{iceParameters:R,dtlsParameters:P,candidates:k,rtpCapabilities:G,setup:U,localCapabilities:j,cname:q}=E;this._rtpCapabilities=G,this._candidates=k,this._originCandidates=Fr(k),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=j,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,k=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<E;U++){const j=2*U+2e4,q=2*U+GH,{ssrcs:Y,ssrcGroups:le}=z_([{ssrcId:j}],this.cname),{ssrcs:ye,ssrcGroups:Ee}=z_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:jT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:jT,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return xm(this.sessionDesc)}send(E,S,R,P){const{ssrcs:k,ssrcGroups:G}=z_(S,this.cname,re("SYNC_GROUP")?R:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Mr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),P&&(P.twcc||P.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(U,P),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(E,k);let q;return j===-1||j===1&&(Is()||function(){const Y=Rn();return!(Y.name!==Fn.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&qf())||j===0&&re("USE_SUB_RTX")||KW()?(q=this.createOrRecycleSendMedia(E,k,G,"sendonly",P),this.updateBundleMids()):(q=Fr(this.sessionDesc.mediaDescriptions[j]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(q,P)),Mr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(k=>{let{kind:G,ssrcMsg:U,mslabel:j}=k;return this.send(G,U,j)}),R=[];let P=!1;return S.forEach(k=>{let{mid:G,needExchangeSDP:U}=k;U&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Mr()||KW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>st(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(E,S,R,P){E.forEach((k,G)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||Ma((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=E;const P=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const U=k.videoCodecs.filter(j=>{var q,Y;return(q=j.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];G.media.fmts=U.map(j=>j.payloadType.toString(10)),G.attributes.payloads=U,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(U=>U.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:j}=z_([{ssrcId:GH,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=U,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const U=k.audioCodecs.filter(j=>{var q,Y;return(q=j.rtpMap)===null||q===void 0?void 0:st(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];G.media.fmts=U.map(j=>j.payloadType.toString(10)),G.attributes.payloads=U,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(U=>U.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,nS(G),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:j}=z_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=U,G.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(zH(zH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(E){case js.TCP_RELAY:this._candidates=R;break;case js.UDP_TCP_RELAY:case js.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(E){E=Fr(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let R=0;R<E;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===E&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Mr()){if(P){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!k||k!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:jT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,R,P,k,G){const U=E._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,q=LT(U,j,this.localCapabilities.send,U===_t.VIDEO?P:k),Y=U===_t.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let ye={media:{mediaType:U,port:jT,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};ye=this.mungRecvMediaDsec(ye,E,G);const Ee=this.findFirstClosedMedia(U);if(Ee){const ge=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[ge]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(E,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ee;return st(Ee=Object.keys(YA)).call(Ee,ye)}))],k=new Set(S);if(P.every(ye=>k.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>S.some(Ee=>{var ge;return st(ge=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(ge,Ee)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const U=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(U)),E.length===0)j=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&st(E).call(E,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),j.length!==E.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const ye=HL(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,le=LT(_t.VIDEO,Y,q,R);return j.forEach(ye=>{const Ee=le.map(ge=>ge.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",le),ye.attributes.payloads=le,ye.media.fmts=Ee}),!0}createOrRecycleSendMedia(E,S,R,P,k){const G=this.rtpCapabilities.send,U=E===_t.VIDEO?G.videoCodecs:G.audioCodecs,j=E===_t.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:E,port:jT,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const le=this.findFirstClosedMedia(E);if(le){const ye=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[ye]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,R){const P=Fr(E);return zL(P),tS(P,S),GL(P,S),pH(P),SP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(E,S){const R=Fr(E);return SP(R,S,this.localCapabilities.recv),nS(R),R}updateRecvMedia(E,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===E);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>Mr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}(vd(vd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=yH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=r;if(Array.isArray(_)&&_.length>0){const{mids:E}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,R)=>{this.preSSRCMap.set(_[R].ssrcId,S)}),await MT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await MT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return vl(function*(){const u=yield Cn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=yP();r.forEach(j=>{const q=c.peerConnection.addTransceiver(j._mediaStreamTrack,vd({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),j._updateRtpTransceiver(q)}),Mr()&&re("SIMULCAST")===!0&&(yield Cn(c.applySimulcastForFirefox(h,r)));const _=yield Cn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(_.sdp,r,E),R=Ma(S),P=E.map(j=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===j);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return dH(q,re("USE_PUB_RTX"))});let k;try{k=yield P}catch(j){k=[],c.remoteSDP.receive(r,s,o,k);const q=c.remoteSDP.toString();throw yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Cn(c.stopSending(E,!0)),j}c.remoteSDP.receive(r,s,o,k);const G=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.applySimulcastEncodings(h,r)),yield Cn(c.applySendEncodings(h,r)),U==null||U(G),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((j,q)=>{const Y=E[q];return{localSSRC:P[q],id:Y,transceiver:j}})}catch(h){throw h instanceof xe?h:new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof xe?o:new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof xe?s:new xe(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var E;PP(this.id+_.mid,this),_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await MT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await MT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return vl(function*(){const o=yield Cn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Dn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||s.forceTurn;if(r===js.RELAY&&!c)return;if(c&&!u){const R=r===js.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield Cn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Fm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;s.remoteSDP.restartICE(_);const E=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Cn(s.peerConnection.setLocalDescription(h)),S==null||S(E),yield Cn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(js.TCP_RELAY),await MT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{PP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return vd(vd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Mr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:vd(vd({},yh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:vd(vd({},yh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(ST(r.turnServer.servers)?s.iceServers=r.turnServer.servers:re("NEW_TURN_MODE")&&s.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...dy.newTurnServerConfigToIceServers(r.turnServer.servers)),re("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...dy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Dn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Um(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Um(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Um(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,j){return U.getTransceivers().find(q=>q.sender.track===j||q.receiver.track===j)}(this.peerConnection,r._mediaStreamTrack),_=Mpe(r);if(Yme(r)&&m&&s&&_&&this.getLocalVideoStats&&st(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const U=u.degradationPreference||(st(E=r._hints).call(E,lr.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,q,Y,le,ye,Ee){if(PP(j,Y),ye(q),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let ge=-1;KH(j,q);const ke=window.setInterval(()=>{const dt=AP.get(j);if(!re("ENABLE_AG_ADAPTATION")||!dt)return PP(j,Y),void ye(q);const pt=Ee();if(pt.sendPackets>0&&pt.OutgoingAvailableBandwidth>0){if(ge===-1)return void(ge=Date.now());if(Date.now()-ge<1e3)return;const vn=pt.sendFrameRate,Sn=pt.OutgoingAvailableBandwidth,[ur,ai]=qme(j,vn,Sn,dt.adaptationConfig,q,le);ai&&(Y.qualityLimitationReason=ai),ur&&dt.adaptationConfig.scale!==ur.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(vn,", bwe ").concat(Sn,", switch from ").concat(dt.adaptationConfig.scale," to ").concat(ur.scale," ")),dt.adaptationConfig=nM(nM({},dt.adaptationConfig),ur),ye(ur))}},re("CHECK_LOCAL_STATS_INTERVAL")),qe=nM({},q);AP.set(j,{timer:ke,adaptationConfig:qe,originConfig:q,adaptationFunc:ye}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(le))})(this.id+m.mid,_,this,U,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:U,frameRate:j,scaleResolutionDownBy:q}=r._encoderConfig;U&&(h.maxBitrate=1e3*U),(st(S=r._hints).call(S,lr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=dc(j)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:R}=re("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),re("DSCP_TYPE")&&Yf()){var P;const U=re("DSCP_TYPE");st(P=["very-low","low","medium","high"]).call(P,U)&&(h.networkPriority=U)}const k=s.getParameters(),G=(c=k.encodings)===null||c===void 0?void 0:c[0];Mr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(k,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await s.setParameters(k),await async function(U,j,q){try{var Y;if(!Dn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const le={},ye={},Ee=j.getParameters(),ge=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];ye.scalabilityMode=yP(q),ge&&Object.assign(ge,ye),Object.assign(Ee,le),await j.setParameters(Ee),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(le){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,s,re("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Dn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=dc(m)),_&&_>=1&&st(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Dn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ma(r);return s.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(tS(_,u),mH(_,u,this.store.codec))}),xm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=s[_];if(S instanceof Er&&!st(o=S._hints).call(o,lr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,s){if(!Mr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Er&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(s=r._hints).call(s,lr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(re("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Dn().supportPCSetConfiguration){const s=dy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},bt(Tn.prototype,"updateRemoteRTPCapabilities",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteRTPCapabilities"),Tn.prototype),bt(Tn.prototype,"connect",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"connect"),Tn.prototype),bt(Tn.prototype,"updateRemoteConnect",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"updateRemoteConnect"),Tn.prototype),bt(Tn.prototype,"createDataChannels",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"createDataChannels"),Tn.prototype),bt(Tn.prototype,"receive",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"receive"),Tn.prototype),bt(Tn.prototype,"batchReceive",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"batchReceive"),Tn.prototype),bt(Tn.prototype,"stopReceiving",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"stopReceiving"),Tn.prototype),bt(Tn.prototype,"muteRemote",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"muteRemote"),Tn.prototype),bt(Tn.prototype,"unmuteRemote",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteRemote"),Tn.prototype),bt(Tn.prototype,"muteLocal",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"muteLocal"),Tn.prototype),bt(Tn.prototype,"unmuteLocal",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"unmuteLocal"),Tn.prototype),bt(Tn.prototype,"close",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),bt(Tn.prototype,"updateEncoderConfig",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"updateEncoderConfig"),Tn.prototype),bt(Tn.prototype,"updateSendParameters",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"updateSendParameters"),Tn.prototype),bt(Tn.prototype,"replaceTrack",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),bt(Tn.prototype,"updateAdaptation",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"updateAdaptation"),Tn.prototype),bt(Tn.prototype,"getRemoteSSRC",[oa],Object.getOwnPropertyDescriptor(Tn.prototype,"getRemoteSSRC"),Tn.prototype),Tn);function oa(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}function oM(t,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=dc(r.width),o.height=dc(r.height);const c=dc(r.framerate||15);document.body.append(s),document.body.append(o);let u=t._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=o.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=Dn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,s.srcObject=new MediaStream([u]))},o.stopCapture=_L(()=>o.startCapture&&o.startCapture(),c);const E=_.stop;return _.stop=()=>{E.call(_),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},_}var kP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(kP||{}),gi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(gi||{}),H_=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(H_||{}),_i=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(_i||{}),$_=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}($_||{}),QH=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(QH||{}),Ch=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Ch||{}),aa=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(aa||{}),ZH=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(ZH||{}),ca=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ca||{}),NP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(NP||{});const K_=1e3,q_=6,DP=3,Qme=Math.max(q_,DP);function Ft(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function e9(t){const r={[ca.CONN_TYPE]:0,[ca.RTT]:t.rtt,[ca.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[ca.CONN_TYPE]=1),s==="tcp"&&(r[ca.CONN_TYPE]=3),s==="tls"&&(r[ca.CONN_TYPE]=4);break}case"srflx":r[ca.CONN_TYPE]=2;break;case"unknown":r[ca.CONN_TYPE]=5;break;default:r[ca.CONN_TYPE]=0}return r}function t9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class n9 extends Nr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%DP==0,o=r%q_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,s);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);E&&(m.inbound=E)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[NP.RTC_PEER_CONNECTION_STATE]=nL[_]):m.misc=[{addition:{[NP.RTC_PEER_CONNECTION_STATE]:nL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[NP.RTC_PEER_CONNECTION_STATE]:nL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Qme+1&&(r=1)},K_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[ca.RTT]:r.rtt,[ca.CONN_TYPE]:void 0,[ca.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=e9(r);if(this.store.useP2P){if(s){const u=e9(s);c[ca.CONN_TYPE]+=u[ca.CONN_TYPE]<<3}c[ca.CONN_TYPE]+=110}else c[ca.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(E=>{let[S,{track:R,ssrcs:P}]=E;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(j,q,Y,le,ye,Ee){const ge=q.videoSend.find(pt=>pt.ssrc===j);if(!ge)return;const ke={},{sentFrame:qe,inputFrame:dt}=ge;if(Ee&&(Ft(ke,gi.QP_SUM,ge.qpSumPerFrame),dt&&qe)){const pt=dt.frameRate,vn=qe.frameRate;ke[gi.FREEZE]=function(Sn,ur){let ai=!0;return ai=!(Sn<=5)&&(Sn<=10?ur<3:Sn<=20?ur<4:ur<5),ai}(pt,vn)?1:0}if(ye){switch(qe&&(Ft(ke,gi.HEIGHT,qe.height),Ft(ke,gi.WIDTH,qe.width),Ft(ke,gi.FRAME_RATE,qe.frameRate)),ke[gi.DISABLED]=le._originMediaStreamTrack&&!le._originMediaStreamTrack.enabled||le._mediaStreamTrack&&!le._mediaStreamTrack.enabled?1:0,ge.adaptionChangeReason){case"none":ke[gi.ADAPTATION]=0;break;case"cpu":ke[gi.ADAPTATION]=1;break;case"bandwidth":ke[gi.ADAPTATION]=2;break;case"other":ke[gi.ADAPTATION]=3}let pt=0;ge.adaptionChangeReason&&(pt+=t9(ge.adaptionChangeReason)),q.qualityLimitationReason&&(pt+=t9(q.qualityLimitationReason)<<3),ke[gi.ADAPTATION]=pt,ke[gi.PLAYER_STATUS]=mL[le._player?le._player.videoElementStatus:"uninit"],Ft(ke,gi.NACKS,ge.nacksCount),Ft(ke,gi.PLIS,ge.plisCount),Ft(ke,gi.FIRS,ge.firsCount),Ft(ke,gi.AVG_ENCODE,ge.avgEncodeMs),Ft(ke,gi.HUGE_FRAME_SENT,ge.hugeFramesSent),Ft(ke,gi.BYTES_RETRANSMIT,ge.retransmittedBytesSent),Ft(ke,gi.PACKAGES_RETRANSMIT,ge.retransmittedPacketsSent),Ft(ke,gi.KEY_FRAMES_ENCODED,ge.keyFramesEncoded);const vn=Y&&Y.videoSend.find(Sn=>Sn.ssrc===j);if(vn){let Sn=ye?K_:K_*q_;vn.timestamp&&ge.timestamp&&(Sn=ge.timestamp-vn.timestamp),vn.packets!=null&&ge.packets!=null&&Ft(ke,gi.PACKAGE_RATE,1e3*(ge.packets-vn.packets)/Sn),ge.packetsLost!=null&&vn.packetsLost!=null&&Ft(ke,gi.PACKAGE_LOST,ge.packetsLost-vn.packetsLost),vn.bytes!=null&&ge.bytes!=null&&Ft(ke,gi.BITRATE,8*(ge.bytes-vn.bytes)/Sn)}}return ke}(P[0].ssrcId,r,s,R,o,c),G=R&&function(j,q,Y,le){const ye=q.videoSend.find(ge=>ge.ssrc===j);if(!ye)return null;const Ee={};if(le){const ge=ye.inputFrame,ke=ge&&ge.height||Y.videoHeight||0,qe=ge&&ge.width||Y.videoWidth||0,dt=ge&&ge.frameRate||0;Ft(Ee,kP.HEIGHT,ke),Ft(Ee,kP.WIDTH,qe),Ft(Ee,kP.FRAME_RATE,dt)}return Ee}(P[0].ssrcId,r,R,o),U=function(j,q){const Y={};return q&&(Ft(Y,gi.RETRANSMIT,j.bitrate.retransmit),Ft(Y,gi.TARGET_ENCODED,j.bitrate.targetEncoded),Ft(Y,gi.ACTUAL_ENCODED,j.bitrate.actualEncoded),Ft(Y,gi.TRANSMIT,j.bitrate.transmit),Ft(Y,gi.BANDWIDTH,j.sendBandwidth)),Y}(r,o);m=Object.assign({},k,G,U)}else _=function(k,G,U,j){const q=G.videoSend.find(le=>le.ssrc===k);if(!q)return;const Y={};if(j){const le=q.sentFrame;if(le&&(Ft(Y,H_.HEIGHT,le.height),Ft(Y,H_.WIDTH,le.width),Ft(Y,H_.FRAME_RATE,le.frameRate)),U){const ye=U.videoSend.find(Ee=>Ee.ssrc===k);if(ye){let Ee=K_*q_;ye.timestamp&&q.timestamp&&(Ee=q.timestamp-ye.timestamp),ye.packets!=null&&q.packets!=null&&Ft(Y,H_.PACKAGE_RATE,1e3*(q.packets-ye.packets)/Ee),q.packetsLost!=null&&ye.packetsLost!=null&&Ft(Y,H_.PACKAGE_LOST,q.packetsLost-ye.packetsLost),ye.bytes!=null&&q.bytes!=null&&Ft(Y,H_.BITRATE,8*(q.bytes-ye.bytes)/Ee)}}}return Y}(P[0].ssrcId,r,s,o);break;case $e.LocalAudioTrack:h=R&&function(k,G,U,j,q){const Y=G.audioSend.find(ye=>ye.ssrc===k);if(!Y)return;const le={};if(q){le[Ch.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const ye=100*j._source.getAccurateVolumeLevel(),Ee=Y.inputLevel;if(Ee!=null){const ke=Math.ceil(50*Math.log10(100*Ee+1));Ft(le,Ch.LEVEL,ke)}Ft(le,QH.PCM_LEVEL,ye),Ft(le,Ch.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(le,Ch.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(le,Ch.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(le,Ch.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),le[Ch.FREEZE]=0;const ge=U&&U.audioSend.find(ke=>ke.ssrc===k);if(ge){let ke=K_*q_;ge.timestamp&&Y.timestamp&&(ke=Y.timestamp-ge.timestamp),ge.bytes!=null&&Y.bytes!=null&&Ft(le,Ch.BITRATE,8*(Y.bytes-ge.bytes)/ke),ge.packets!=null&&Y.packets!=null&&Ft(le,Ch.PACKAGE_RATE,1e3*(Y.packets-ge.packets)/ke)}}return le}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:_,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,E]=m;const S={peer:_.uid};if(E.has(_t.VIDEO)&&_.videoTrack){const R=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,P=_.videoTrack?function(k,G,U,j,q,Y,le,ye){const Ee=G.videoRecv.find(Sn=>Sn.ssrc===k);if(!Ee)return;const ge={},{receivedFrame:ke,outputFrame:qe,decodeFrameRate:dt}=Ee,pt=U&&U.videoRecv.find(Sn=>Sn.ssrc===k);if(Ft(ge,$_.FRAME_RATE_DECODE,dt),Ee.framesRateFirefox&&Ft(ge,_i.FRAME_RATE,Ee.framesRateFirefox),ke&&Ft(ge,_i.FRAME_RATE,ke.frameRate),Ft(ge,_i.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(ge,_i.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(ge,_i.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(ge,_i.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(ge,_i.AVG_DECODE,Ee.avgDecodeMs),Ft(ge,_i.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(ge,_i.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(ge,_i.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(ge,_i.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),pt){const Sn=G.timestamp-U.timestamp||K_*(ye?q_:le?DP:1);Ee.packetsLost!=null&&pt.packetsLost!=null&&Ft(ge,_i.PACKAGE_LOST,Ee.packetsLost-pt.packetsLost),pt.bytes!=null&&Ee.bytes!=null&&Ft(ge,_i.BITRATE,8*(Ee.bytes-pt.bytes)/Sn),pt.packets!=null&&Ee.packets!=null&&Ft(ge,_i.PACKAGE_RATE,1e3*(Ee.packets-pt.packets)/Sn)}if(ye&&(Ft(ge,_i.QP_SUM,Ee.qpSumPerFrame),ge[_i.FREEZE]=q&&FT.isRemoteVideoFreeze(j,Ee,pt)?1:0),le){var vn;ke?(Ft(ge,_i.HEIGHT,ke.height),Ft(ge,_i.WIDTH,ke.width)):j&&(Ft(ge,_i.HEIGHT,j._videoHeight||0),Ft(ge,_i.WIDTH,j._videoWidth||0)),qe&&Ft(ge,$_.FRAME_RATE_OUTPUT,qe.frameRate);const Sn=(vn=j._player)===null||vn===void 0?void 0:vn.rendFrameRate.toFixed(0);if(Sn&&Ft(ge,$_.FRAME_RATE_RENDER,+Sn),Ft(ge,_i.JITTER_BUFFER,Ee.jitterBufferMs),Ft(ge,_i.CURRENT_DELAY,Ee.currentDelayMs),Ft(ge,_i.FIRS,Ee.firsCount),Ft(ge,_i.NACKS,Ee.nacksCount),Ft(ge,_i.PLIS,Ee.plisCount),j){ge[_i.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const ur=j._player;if(ur){const{freezeTimeCounterList:ai,renderFreezeAccTime:Hr,videoElementStatus:ua}=ur;if(ai&&ai.length>0&&Ft(ge,$_.FREEZE_TIME,ai.splice(0,1)[0]),Y&&Qf.visibility==="visible"&&ua===lo.PLAYING&&Dn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Hr);ur.renderFreezeAccTime=Math.max(0,Hr-je),Ft(ge,$_.FREEZE_TIME_RENDER,je)}if(typeof Ee.totalFreezesDuration=="number"){const je=pt&&pt.totalFreezesDuration?Ee.totalFreezesDuration-pt.totalFreezesDuration:Ee.totalFreezesDuration;Ft(ge,$_.FREEZE_DURATION,1e3*je)}}}if(ge[_i.PLAYER_STATUS]=mL[j._player?j._player.videoElementStatus:"uninit"],pt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const ur=Ee.totalInterFrameDelay-pt.totalInterFrameDelay,ai=Ee.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,Hr=Ee.framesDecodeCount-pt.framesDecodeCount,ua=ur/Hr*1e3,je=Math.round(1e3*Math.sqrt((ai-Math.pow(ur,2)/Hr)/Hr));!isNaN(je)&&ua+je>Math.max(3*ua,ua+150)&&(ge[_i.I_FRAME_DELAY]=je)}}return ge}(_._videoSSRC,r,s,_.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(E.has(_t.AUDIO)&&_.audioTrack){const R=_.audioTrack?function(P,k,G,U,j,q){const Y=k.audioRecv.find(ge=>ge.ssrc===P);if(!Y)return;const le={},ye=G&&G.audioRecv.find(ge=>ge.ssrc===P);if(Ft(le,aa.JITTER,Y.jitterMs),Ft(le,aa.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(le,aa.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(le,aa.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(le,aa.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),ye){const ge=k.timestamp-G.timestamp||K_*(q?q_:j?DP:1);Y.packets!=null&&ye.packets!=null&&Ft(le,aa.PACKAGE_RATE,1e3*(Y.packets-ye.packets)/ge),j&&ye.bytes!=null&&Y.bytes!=null&&Ft(le,aa.BITRATE,8*(Y.bytes-ye.bytes)/ge),Y.packetsLost!=null&&ye.packetsLost!=null&&Ft(le,aa.PACKAGE_LOST,Y.packetsLost-ye.packetsLost)}if(q){const{receivedFrames:ge,droppedFrames:ke}=Y;ge!=null&&ke!=null&&(le[aa.FREEZE]=(Ee=ge)===0||100*ke/Ee>20?1:0)}var Ee;if(j){const ge=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const qe=Math.ceil(50*Math.log10(100*ke+1));Ft(le,ZH.LEVEL,qe)}if(Ft(le,aa.PCM_LEVEL,ge),U&&(le[aa.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(le,aa.JITTER_BUFFER,Y.jitterBufferMs),Ft(le,aa.CURRENT_DELAY,Y.jitterBufferMs),le[aa.PLAYER_STATUS]=mL[sa.getPlayerState(U.getTrackId())],ye){const qe=Y.concealedSamples-ye.concealedSamples;qe>0&&Ft(le,aa.CONCEALED_SAMPLES,qe);const dt=Y.totalSamplesReceived-ye.totalSamplesReceived;dt>0&&Ft(le,aa.TOTAL_SAMPLES_RECEIVED,dt)}}return le}(_._audioSSRC,r,s,_.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof nP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(PT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(_t.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(_t.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(_t.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(_t.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const R={};for(const{id:U,value:j,level:q,direction:Y}of E){var P;const le=(P=S.get(U))!==null&&P!==void 0?P:0,ye=j===2?le+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var k,G;S.set(U,ye),R[U]?(j===2&&(R[U].value=j),q>R[U].level&&(R[U].level=q),Y==="remote"&&(R[U].remoteUidCount+=1),R[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):R[U]={value:j,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(G=S.get(U))!==null&&G!==void 0?G:0}}return Object.keys(R).map(U=>{const{level:j,value:q,totalTs:Y}=R[U];return{id:U,level:j,value:q,totalTs:Y}})}(c,r);const m=Date.now(),_=m>s?m:s+1;this.requestUpload&&this.requestUpload(PT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Zme=re("ICE_RESTART_INTERVAL");let xP=new Map,oS=new Map,Wm=[js.UDP_TCP_RELAY,js.TCP_RELAY,js.RELAY],aM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dn().supportPCSetConfiguration;function r9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=xP.get(t.id);s&&(window.clearTimeout(s),xP.delete(t.id));const o=oS.get(t.id);r&&o&&o.index===Wm.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),oS.delete(t.id))}function i9(t,r,s){if(xP.size===0&&oS.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(R=>R===S).length!==_.filter(R=>R===S).length)return!1}return!0}(Wm,re("RESTART_SEQUENCE"))&&(Wm=re("RESTART_SEQUENCE").filter(m=>{var _;if(st(_=Object.values(js)).call(_,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Wm.join(" => ")))),aM=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Dn().supportPCSetConfiguration),Wm.length===0)return void s();let o,{index:c=0,type:u}=oS.get(t.id)||{};if(aM&&u===js.RELAY)return void s();let h=u&&c>=Wm.length-1;if(aM)u=js.RELAY;else{if(h)return void s();u?(c++,u=Wm[c]):(u=Wm[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),oS.set(t.id,{index:c,type:u}),o=window.setTimeout(()=>i9(t,r,s),Zme),xP.set(t.id,o)}var hn;function s9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Rh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?s9(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):s9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function o9(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=kx,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new LP(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function LP(t){function r(s){if(Object(s)!==s)return ut.reject(new TypeError(s+" is not an object."));var o=s.done;return ut.resolve(s.value).then(function(c){return{value:c,done:o}})}return LP=function(s){this.s=s,this.n=s.next},LP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ut.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ut.reject(s):r(o.apply(this.s,arguments))}},new LP(t)}let BT=(hn=class extends Nr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(kt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Hn.Disconnected),K(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?np.FIRST_CONNECTION:np.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Hn.Connected)return void c(new xe(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createMuteMessage(h);await ar(this,kt.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Hn.Connected)return void c(new xe(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(E.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=oM(s,bT(this,kt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new ut((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const _=this.createUnmuteMessage(h);await ar(this,kt.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==s||this.state!==Hn.Connected)return void o();const{id:E,track:S}=_;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(kt.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Hn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(s,o,c,u)=>{if(!this.connection||this.state!==Hn.Connected)return void o();const h=iM([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(E){c(E)}finally{var _;(_=m)===null||_===void 0||_()}}),K(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!E||this.state!==Hn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const S=E[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ut((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new n9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Vs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Dn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Yf(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&Dn().supportPCSetConfiguration&&zx(),this.shouldForwardP2PCreation&&(this.connection=OP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Hn.New,this._forceTurn=XH(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=OP(this.store,t),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new xe(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?np.FIRST_CONNECTION:np.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new xe(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Hn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Hn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return st(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof wh){if(Rt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!st(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>st(t).call(t,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof wh&&this.connection.peerConnectionState!=="closed"&&st(t=[Hn.New,Hn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Hn.Connected){if(this.state===Hn.Disconnected)throw new xe(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var o;st(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var o=this;return vl(function*(){const c=yield Cn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&st(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Hn.Connected||h){if(o.state===Hn.Disconnected)throw new xe(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const _=t.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Bs.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Cn(o.tryToUnmuteAudio(t)));yield*PA(o9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return vl(function*(){r.forEach(P=>{let{track:k,type:G}=P;const U=Date.now();s.store.publish(k.getTrackId(),G===$e.LocalAudioTrack?"audio":"video",U)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:k}=P;return k}),c=yield Cn(t.send(o,s.store.codec,s.store.audioCodec)),u=(yield Cn(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===X.WS_ABORT&&r.forEach(k=>{let{track:G}=k;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const _=s.mapPubResToRemoteConfig(h,m,o),E=(yield Cn(c.next(_))).value;if(s.state===Hn.Disconnected)throw new xe(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),R=re("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const k=P.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:U}=TP();P.trackMediaType===_t.VIDEO?await G(k.sender,P):P.trackMediaType===_t.AUDIO&&await U(k.sender,{metadata:R?()=>{const j=P.metadata.shift();return j&&j.value}:void 0})}),r.forEach(P=>{let{type:k}=P;s.statsCollector.addLocalStats(k)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:k,type:G}=P;const U=Date.now();s.store.publish(k.getTrackId(),G===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Er))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=WL(u,h)),m.maxFramerate=u.framerate?dc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,o);if(o._encoderConfig||(o._encoderConfig={}),r!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=dc(m.width)),m.height&&(_.height=dc(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=_L(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},dc(m.framerate)))})(u,t)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var r=this;return vl(function*(){if(!r.connection||r.state!==Hn.Connected)return;const s=yield Cn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new xe(X.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has($e.LocalVideoLowTrack))throw new xe(X.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:$e.LocalVideoLowTrack}];if(yield*PA(o9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get($e.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Cn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ps(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==_t.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==_t.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Ps(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===_t.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(kt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Hn.Connected)return void t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Hn.Connected)return void t.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Hn.Connected)return;const t=this.localTrackMap.get($e.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[$e.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Hn.Connected)throw new xe(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===t.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(o=>o.id)}async subscribe(t,r,s,o,c){var u;if(!this.connection||this.state!==Hn.Connected)throw new xe(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,_;const E=this.connection.getPreMedia(s);if(E)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),_=E.transceiver,h=E.track,m=E.id;else if(c){const P=c.find(G=>{let{stream_type:U}=G;return U===r});if(!P)throw new xe(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const k=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof wh&&(_=k.transceiver),h=k.track,m=k.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(t._uintid),void 0);this.connection instanceof wh&&(_=P.transceiver),h=P.track,m=P.id}if(r===_t.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new Kv(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),_&&t._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new $v(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),_&&t._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(t,t._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:k}=TP();r==_t.VIDEO?await P(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(G=>{var U;return(U=t._videoTrack)===null||U===void 0?void 0:U._onSei(G)})}):r==_t.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(kt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(t);S?S.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:k,kind:G}=P;return k.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Hn.Connected)throw new xe(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:E,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:G}=TP();u==_t.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(U)})}):u==_t.AUDIO&&await G(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(kt.AudioMetadata,U)}})}if(u===_t.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Kv(_,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new $v(_,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:G}=TP();u==_t.VIDEO?await k(S.receiver,{onSei:U=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(U)}}):u==_t.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(k=>{let{user:G,kind:U}=k;return G.uid===c.uid&&u===U});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(kt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return r!==void 0?m.uid===t.uid&&r===_:m.uid===t.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Hn.Connected||s||o.forEach(h=>{let{kind:m}=h;var _;if(m===_t.AUDIO)(_=t._audioTrack)===null||_===void 0||_._destroy(),t._audioTrack=void 0;else if(m===_t.VIDEO){var E;(E=t._videoTrack)===null||E===void 0||E._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Hn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var E,S;if(_===_t.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===_t.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===_t.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(t);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return u!==void 0?_.uid===c.uid&&u===E:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),r=r.concat(h)}if(!this.connection||this.state!==Hn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===_t.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===_t.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const s=rc(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===_t.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===_t.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===_t.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(t){return!this.connection||this.state!==Hn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===_t.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get($e.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ni){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(_=>_ instanceof Gr),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(_=>_ instanceof Er);Rt.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===_t.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===_t.VIDEO,audio:o===_t.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Vs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=OP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get($e.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Hn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get($e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get($e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Er||r&&r.track instanceof Gr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(zc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=sT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Hn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=OP(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case $e.LocalVideoTrack:st(r=o._hints).call(r,lr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(zc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(zc(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((t instanceof Bm?t.uid:t)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Bm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return vl(function*(){if(!r.connection||r.state!==Hn.Connected)return;const s=yield Cn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Cn(r.connection.restartICE(t));const u=yield Cn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(sM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case js.UDP_TCP_RELAY:r._pcStatsUploadType=np.UDP_TCP_RESTART;break;case js.TCP_RELAY:r._pcStatsUploadType=np.TCP_RESTART;break;case js.RELAY:r._pcStatsUploadType=np.RELAY_RESTART;break;default:r._pcStatsUploadType=np.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalAudioTrack),o=t.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(k=>k.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Bc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(lr.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(k&&G){const U=(1e3*k-G)/(1e3*k);return jG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Bc(this,kt.NeedSignalRTT),E=t.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ut((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Hn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!o)return;const c=o[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ut((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(t,r,s){const o=[],c=this.getAllTracks();t=Dv(t=t.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of t){if(_ instanceof Er&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,s);o.push({track:E,type:$e.LocalVideoLowTrack})}if(_ instanceof Gr)if(m){const E=m.track;if(E instanceof Ni)rM([_]),E.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=iM([E,_]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof Ni?(rM([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&Dn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=iM(u?[_,u]:[_]):u=_}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:$e.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Dv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Gr){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=Dv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Dv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Et.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ni?t.trackList.forEach(s=>{s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.off(Et.GET_STATS,this.handleGetLocalVideoStats),s.off(Et.GET_RTC_STATS,this.handleGetRTCStats),s.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ni?t.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Et.GET_STATS,this.handleGetLocalAudioStats),t.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Et.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof $v&&r.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Kv&&r.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(_t.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(_t.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,h,{track:m,type:_}=s;switch(_){case $e.LocalAudioTrack:u=$n.Audio,h={dtx:m instanceof nP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=st(c=m._hints).call(c,lr.SCREEN_TRACK)?$n.Screen:$n.High,h=Rh(Rh({},iH(m)),{},{codec:this.store.codec,svc_mode:yP()});break;case $e.LocalVideoLowTrack:u=$n.Low,h=Rh(Rh({},iH(m)),{},{codec:this.store.codec,svc_mode:yP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof wh&&!Mr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof wh&&r9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=np.DISCONNECTED_OR_FAILED,Bc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Rt.reportApiInvoke(this.store.sessionId,{name:wi.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Vr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&t instanceof wh&&!Mr()&&!this._forceTurn){if(st(JG).call(JG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{sM(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Bc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,c))},o=()=>{sM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{i9(t,s,o)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Bc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(kt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Vr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Bv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_AUDIO_DECODE,Ar.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_AUDIO_RECEIVED,Ar.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_VIDEO_RECEIVED,Ar.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vm(s))," -> ").concat(JSON.stringify(Vm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vm(s))," -> ").concat(JSON.stringify(Vm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Rh(Rh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof wh&&function(r){oS.delete(r.id),r9(r)}(t),t.close(),this.emit(kt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Gr&&(s==null?void 0:s.track)instanceof Ni)return s.track.isActive||r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Gr&&(s==null?void 0:s.track)instanceof Ni)return s.track.isActive&&r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case _t.VIDEO:return void(o._videoSSRC&&r.push({stream_type:_t.VIDEO,ssrcId:o._videoSSRC}));case _t.AUDIO:return void(o._audioSSRC&&r.push({stream_type:_t.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let u=r.get(o);c===_t.VIDEO?u|=qi.Video:u|=qi.Audio,r.set(o,u)}else c===_t.VIDEO?r.set(o,qi.Video):r.set(o,qi.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(_=>{let{stream_type:E}=_;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=s[c]._hints;(st(_).call(_,lr.SCREEN_TRACK)||st(_).call(_,lr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Gr){var r;const o=this.filterTobeUnmutedTracks(t[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await ar(this,kt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(kt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(kt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ds(Jx(this.dtlsFailedCount,Ci)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ps(this,kt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Er)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Er).length>1)throw new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Gr).length>1&&(t.some(r=>r instanceof Gr&&r._bypassWebAudio)||!Dn().webAudioMediaStreamDest))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Er&&this.pendingLocalTracks.some(s=>s instanceof Er))throw new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Gr&&this.pendingLocalTracks.some(s=>s instanceof Gr)&&(!Dn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Gr&&s._bypassWebAudio)))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding,c=Rh(Rh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?t._mediaStreamTrack.clone():oM(t,c);const h=cr(8,"track-low-"),m=new Er(u,Rh(Rh({},o&&{scaleResolutionDownBy:WL(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(M_.TRANSCEIVER_UPDATED,_=>{t._updateRtpTransceiver(_,Fv.LOW_STREAM)}),m._hints.push(lr.LOW_STREAM),st(s=t._hints).call(s,lr.SCREEN_TRACK)&&m._hints.push(lr.SCREEN_LOW_TRACK),t.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),t.addListener(Et.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof wh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:k}=await this.connection.getSelectedCandidatePair();Rt.pcStats(this.store.sessionId,{startTime:_,eventElapse:t-_||0,iceconnectionsate:E,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(zc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Ki.FIRST_VIDEO_DECODE,Ar.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===$e.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Fv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},bt(hn.prototype,"startP2PConnection",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"startP2PConnection"),hn.prototype),bt(hn.prototype,"connect",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"connect"),hn.prototype),bt(hn.prototype,"updateRemoteRTPCapabilities",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"updateRemoteRTPCapabilities"),hn.prototype),bt(hn.prototype,"publishDataChannel",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"publishDataChannel"),hn.prototype),bt(hn.prototype,"unpublish",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unpublish"),hn.prototype),bt(hn.prototype,"unpublishDataChannel",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishDataChannel"),hn.prototype),bt(hn.prototype,"unpublishLowStream",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishLowStream"),hn.prototype),bt(hn.prototype,"subscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"subscribeDataChannel"),hn.prototype),bt(hn.prototype,"subscribe",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"subscribe"),hn.prototype),bt(hn.prototype,"massSubscribe",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"massSubscribe"),hn.prototype),bt(hn.prototype,"unsubscribe",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribe"),hn.prototype),bt(hn.prototype,"unsubscribeDataChannel",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribeDataChannel"),hn.prototype),bt(hn.prototype,"massUnsubscribe",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"massUnsubscribe"),hn.prototype),bt(hn.prototype,"muteRemote",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),bt(hn.prototype,"unmuteRemote",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),bt(hn.prototype,"hasRemoteMediaWithLock",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"hasRemoteMediaWithLock"),hn.prototype),bt(hn.prototype,"disconnectForReconnect",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"disconnectForReconnect"),hn.prototype),bt(hn.prototype,"updateBitrateLimit",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"updateBitrateLimit"),hn.prototype),bt(hn.prototype,"remoteMediaSsrcChanged",[ho],Object.getOwnPropertyDescriptor(hn.prototype,"remoteMediaSsrcChanged"),hn.prototype),hn);function ho(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}function a9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function c9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a9(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const ege=Date.now(),tge=20,cM=new Map,MP=new Map;async function l9(t){const r=cM.get(t),s=Array.isArray(r)&&r[r.length-1],o=MP.get(t);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const u=s.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),u9(s.context,c),m=0):m=Math.min(m,tge),setTimeout(()=>r.length&&l9(t),m)}function u9(t,r){t.safeEmit(mn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function nge(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return u9(s,{uid:t.uid,payload:t.payload});const o="".concat(s.id,"-").concat(t.uid),c=cM.get(o)||[],u=c.findIndex(E=>t.sendTs>=E.sendTs),h=c9(c9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),cM.set(o,c);let m=!1;var _;MP.has(o)?m=!((_=MP.get(o))===null||_===void 0||!_.isSyncing):MP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||l9(o)}const rge=Rn().name;function d9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function h9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?d9(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d9(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const aS="websdk_ng_cache_parameter",ige=re("MAX_PRELOAD_ASYNC_LENGTH"),sge=1e4,Y_=new Map,X_=[];let lM=null,uM=0,dM=0;const UP=new Map,oge=function(t,r){const s=[];let o=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ut(async(_,E)=>{s.push(async()=>{try{const S=await t(...h);_(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(f9,ige),hM=ia.CancelToken.source();async function f9(t,r,s,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!Dn().supportWebCrypto)return void Nm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new xe(X.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&us(s,"token",1,2047),us(t,"appid",1,2047),fP(r),o&&pP(o);const h=x_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:t,cname:r,token:s||t,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,E;typeof o=="string"?(m.stringUid=o,[E,_]=await ut.all([Wme(o,{sid:h,appId:t},hM.token),LH(h9(h9({},m),{},{token:s||t,uid:0}),hM.token)]),m.uid=E.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await LH(m,hM.token));const S={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:_};await async function(R){let P;try{R.uid&&m9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const k=E9(R),G=await async function(j,q){try{const Y=await window.crypto.subtle.importKey("raw",s8(q),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,D_(window.btoa(JSON.stringify(j))));return Dm(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!G)return;P=y9(aS);const U=P?JSON.parse(P):[];U.push({[k]:G}),U.length>re("AP_CACHE_NUM")&&U.shift(),VP(aS,JSON.stringify(U))}catch(k){x.warn("Error caching server parameters:",k.message),VP(aS,"")}}(S),uM++}catch(h){throw dM++,function(m){lM||(lM=window.setTimeout(()=>{let E="";UP.forEach((S,R)=>{E+="".concat(R,": ").concat(S," ;")}),Rt.reportApiInvoke(null,{name:wi.PRELOAD,options:{success:uM,failed:dM,err:E}}).onError(m),uM=0,dM=0,UP.clear(),lM=null},sge));const _=UP.get(m.code)||0;UP.set(m.code,_+1)}(h),h}}async function p9(t){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const r=m9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",s8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,D_(o));return JSON.parse(window.atob(Dm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<re("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function m9(t){let r;try{if(r=y9(aS),!r)return;const s=JSON.parse(r),o=E9(t),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(s,h=>o in h);if(c===-1)return;const u=s.splice(c,1)[0];return VP(aS,JSON.stringify(s)),u[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),VP(aS,"")}}function fM(t){if(t){let r=Y_.get(t);r&&(window.clearTimeout(r),r=null,Y_.delete(t)),st(X_).call(X_,t)||t.cloudProxyServer!=="disabled"||X_.push(t)}if(Y_.size<re("AP_CACHE_NUM")&&X_.length>0){const r=X_.shift();Y_.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await oge(s,o,c,h,m,u),Y_.has(r)&&fM(r)}catch(_){x.warn("update preload failed",_.message),g9(r)}},re("AP_UPDATE_INTERVAL")))}}function g9(t){const r=X_.indexOf(t);r!==-1&&X_.splice(r,1);let s=Y_.get(t);s&&(window.clearTimeout(s),s=null,Y_.delete(t),fM())}function _9(t,r){const s=t.sua,o=t.ap;r&&s&&Rt.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Rt.reportResourceTiming(t.ap.url,t.sid),Rt.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK].toString()}),Rt.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function y9(t){return window.atob(window.localStorage.getItem(t)||"")}function VP(t,r){window.localStorage.setItem(t,window.btoa(r))}function E9(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),h8(r)}function age(t){let r=function(){const s=uge.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(yi(o,10),zm(o,c));let u=s.cid;u!==void 0&&(yi(o,16),yi(o,u));let h=s.cname;h!==void 0&&(yi(o,26),zm(o,h));let m=s.deviceId;m!==void 0&&(yi(o,34),zm(o,m));let _=s.elapse;_!==void 0&&(yi(o,40),Gm(o,_));let E=s.fileSize;E!==void 0&&(yi(o,48),Gm(o,cS(E)));let S=s.height;S!==void 0&&(yi(o,56),Gm(o,cS(S)));let R=s.jpg;R!==void 0&&(yi(o,66),yi(o,R.length),S9(o,R));let P=s.networkType;P!==void 0&&(yi(o,72),Gm(o,cS(P)));let k=s.osType;k!==void 0&&(yi(o,80),Gm(o,cS(k)));let G=s.requestId;G!==void 0&&(yi(o,90),zm(o,G));let U=s.sdkVersion;U!==void 0&&(yi(o,98),zm(o,U));let j=s.sequence;j!==void 0&&(yi(o,104),Gm(o,cS(j)));let q=s.sid;q!==void 0&&(yi(o,114),zm(o,q));let Y=s.timestamp;Y!==void 0&&(yi(o,120),Gm(o,Y));let le=s.uid;le!==void 0&&(yi(o,128),yi(o,le));let ye=s.vid;ye!==void 0&&(yi(o,136),yi(o,ye));let Ee=s.width;Ee!==void 0&&(yi(o,144),Gm(o,cS(Ee)));let ge=s.service;ge!==void 0&&(yi(o,152),yi(o,ge));let ke=s.callbackData;ke!==void 0&&(yi(o,162),yi(o,ke.length),S9(o,ke));let qe=s.ticket;qe!==void 0&&(yi(o,170),zm(o,qe));let dt=s.vendorConfigs;dt!==void 0&&(yi(o,178),zm(o,dt))}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function cge(t){return function(s){let o={};e:for(;!dge(s);){let c=WT(s);switch(c>>>3){case 0:break e;case 1:o.code=WT(s);break;case 2:o.msg=b9(s,WT(s));break;case 3:o.requestId=b9(s,WT(s));break;case 4:o.timestamp=hge(s,!1);break;default:lge(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function lge(t,r){switch(r){case 0:for(;128&Su(t););break;case 2:pM(t,WT(t));break;case 5:pM(t,4);break;case 1:pM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function cS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let uge=[];function pM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function dge(t){return t.offset>=t.limit}function FP(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function v9(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function S9(t,r){let s=FP(t,r.length);t.bytes.set(r,s)}function b9(t,r){let s=v9(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+s+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function zm(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}yi(t,o);let c=FP(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Su(t){return t.bytes[v9(t,1)]}function T9(t,r){let s=FP(t,1);t.bytes[s]=r}function WT(t){let r,s=0,o=0;do r=Su(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function yi(t,r){for(r>>>=0;r>=128;)T9(t,127&r|128),r>>>=7;T9(t,r)}function hge(t,r){let s,o=0,c=0,u=0;return s=Su(t),o=127&s,128&s&&(s=Su(t),o|=(127&s)<<7,128&s&&(s=Su(t),o|=(127&s)<<14,128&s&&(s=Su(t),o|=(127&s)<<21,128&s&&(s=Su(t),c=127&s,128&s&&(s=Su(t),c|=(127&s)<<7,128&s&&(s=Su(t),c|=(127&s)<<14,128&s&&(s=Su(t),c|=(127&s)<<21,128&s&&(s=Su(t),u=127&s,128&s&&(s=Su(t),u|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Gm(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=FP(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const w9={},C9={},jP=4294967296,fge=jP*jP,pge=fge/2;I9(0,!0);const R9=I9(0),mge=zT(0,-2147483648,!1),gge=zT(-1,2147483647,!1);function I9(t,r){let s,o,c;return r?(c=0<=(t>>>=0)&&t<256)&&(o=C9[t],o)?o:(s=zT(t,0,!0),c&&(C9[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(o=w9[t],o)?o:(s=zT(t,t<0?-1:0,!1),c&&(w9[t]=s),s)}function zT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function A9(t,r){if(isNaN(t))return R9;{if(t<=-9223372036854776e3)return mge;if(t+1>=pge)return gge}return t<0?R9:zT(t%jP|0,t/jP|0,r)}function P9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class mM extends Nr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(yd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",wl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ia.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==wl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===wl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=cr(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new NT("worker-"+this._moderationId,Ci),this.on(yd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Jv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(yd.STATE_CHANGE,Jv.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ut((c,u)=>{this.on(yd.CONNECTION_STATE_CHANGE,(h,m)=>{h===wl.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===wl.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,E,S,R){let{appId:P,areaCode:k,cname:G,sid:U,token:j,uid:q}=E;rS++;const Y="moderation_plugin",le={service_name:Y,json_body:JSON.stringify({appId:P,areaCode:k,cname:G,command:"allocateEdge",requestId:rS,seq:rS,sid:U,appToken:j,ts:Date.now(),uid:q+""})};let ye,Ee,ge=_[0];return pd(async()=>{ye=Date.now();const ke=await Ed(ge,{data:le,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ye,ke.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:Ee});throw x.error(pt.toString()),pt}const qe=JSON.parse(ke.json_body);if(qe.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(qe.code,", reason: ").concat(qe.reason),{code:qe.code,responseTime:Ee});throw x.error(pt.toString()),pt}if(!qe.servers||!Array.isArray(qe.servers)||qe.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:qe.code,responseTime:Ee});throw x.error(pt.toString()),pt}if(!qe.servers.some(pt=>!!pt.wss)){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:qe.code,responseTime:Ee});throw x.error(pt.toString()),pt}const dt=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:qe.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(dt,":").concat(Sn,"/moderation")}).filter(pt=>!!pt),workerToken:qe.workerToken,vid:qe.vid,ticket:qe.appTicket,responseTime:Ee}},(ke,qe)=>(Rt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:qe===0,responseTime:Ee,serverIp:_[qe%_.length]}),!1),(ke,qe)=>(Rt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:Ee,serverIp:_[qe%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(ge=_[(qe+1)%_.length],!0)),R)}(c,r,s,o);this.emit(yd.STATE_CHANGE,Jv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(yd.STATE_CHANGE,Jv.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Jt.CONNECTED,async()=>{this.emit(yd.STATE_CHANGE,Jv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=wl.CONNECTED}),this._workerConnection.on(Jt.CLOSED,()=>{this.connectionState=wl.CLOSED}),this._workerConnection.on(Jt.FAILED,()=>{this.connectionState=wl.CLOSED}),this._workerConnection.on(Jt.RECONNECTING,()=>{this.connectionState=this.connectionState===wl.CONNECTED?wl.RECONNECTING:wl.CONNECTING}),this._workerConnection.on(Jt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=cge(new Uint8Array(r.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Rt.reportApiInvoke(this._connectInfo.sid||null,{name:wi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Vr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Jt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Jt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Bc(this,yd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await tz(S,o,c),P=this._sequence+"-"+u+"-"+_+"-"+E+"-"+cr(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:mM.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:A9(E),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const G=age(k);if(G.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(j){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?P9(Object(Y),!0).forEach(function(le){K(j,le,Y[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(Y)):P9(Object(Y)).forEach(function(le){Object.defineProperty(j,le,Object.getOwnPropertyDescriptor(Y,le))})}return j}({},k);delete U.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return G}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ia.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=wl.CLOSED,this.emit(yd.STATE_CHANGE,Jv.CLOSED)}}function O9(t){if(nr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const _ge={name:"ImageModeration",create:function(t){let{config:r}=t;return O9(r),new mM(r)}};var k9,N9,D9,x9,L9,M9,U9,V9,F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,e7,t7,n7,r7,i7,s7,o7,a7,c7,l7,u7,d7,h7,f7,p7,m7,g7,_7,ft;function y7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function bu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?y7(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):y7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}Vs.setLogger(x);let yge=(k9=Ut(),N9=Ut({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof zv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),D9=Ut({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Wv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),x9=Ut({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),L9=Ut({argsMap:(t,r,s)=>[r,s]}),M9=Ut({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),U9=Ut({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),V9=Ut({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),F9=Ut(),j9=Ut(),B9=Ut(),W9=Ut(),z9=Ut(),G9=Ut(),H9=Ut(),$9=Ut(),K9=Ut(),q9=Ut(),Y9=Ut(),X9=Ut(),J9=Ut(),Q9=Ut(),Z9=Ut(),e7=Ut({argsMap:(t,r)=>[r]}),t7=Ut(),n7=Ut(),r7=Ut(),i7=Ut(),s7=Ut(),o7=Ut(),a7=Ut(),c7=Ut(),l7=Ut({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),u7=Ut(),d7=Ut(),h7=Ut(),f7=Ut(),p7=Ut(),m7=Ut(),g7=Ut({reportResult:!0}),_7=Ut(),ft=class extends Nr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",ia.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(mn.USER_JOINED,u));else{const h=new Bm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(mn.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:WA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(mn.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,E,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const R=this._users.find(k=>k.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=_||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),E&&(R._audioOrtc=E)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),E&&(R._videoOrtc=E)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,R,c)),c==="video"?Rt.onGatewayStream(this._sessionId,Ki.ON_ADD_VIDEO_STREAM,Ar.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:R._videoSSRC}):Rt.onGatewayStream(this._sessionId,Ki.ON_ADD_AUDIO_STREAM,Ar.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(k=>{if(k&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof BT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(k=>{x.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),K(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(mn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof BT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Rt.onGatewayStream(this._sessionId,Ki.ON_REMOVE_STREAM,Ar.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,u,R)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return _!==E?!_&&E?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(mn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(mn.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&W_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(mn.USER_INFO_UPDATED,c,R)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(_!==E){if(!_&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(mn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(mn.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(mn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(mn.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!E&&(x.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(mn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=t,this._clientId=r||cr(5,"client-"),this.store=new class{constructor(c,u,h,m){$t(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:L_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case gn.SET_SESSION_ID:return gt(gt({},u),{},{sessionId:h.sessionId});case gn.SET_P2P_ID:return gt(gt({},u),{},{p2pId:h.p2pId});case gn.SET_UID:return gt(gt({},u),{},{uid:h.uid});case gn.SET_INT_UID:return gt(gt({},u),{},{intUid:h.intUid});case gn.SET_PUB_ID:return gt(gt({},u),{},{pubId:h.pubId});case gn.KEY_METRIC_CLIENT_CREATED:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{clientCreated:h.metric})});case gn.KEY_METRIC_JOIN_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinStart:h.metric})});case gn.AVOID_JOIN_START:return gt(gt({},u),{},{avoidJoinStart:h.avoidJoinStart});case gn.KEY_METRIC_JOIN_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinEnd:h.metric})});case gn.KEY_METRIC_REQUEST_AP_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{requestAPStart:h.metric})});case gn.KEY_METRIC_REQUEST_AP_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case gn.KEY_METRIC_JOIN_GATEWAY_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case gn.KEY_METRIC_PEER_CONNECTION_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case gn.KEY_METRIC_DESCRIPTION_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{descriptionStart:h.metric})});case gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case gn.KEY_METRIC_ICE_CONNECTION_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case gn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(E=>E.trackId===h.metric.trackId);return _!==-1?(m[_]=gt(gt({},m[_]),h.metric),gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{publish:[...m]})})):gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case gn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return _!==-1?(m[_]=gt(gt({},m[_]),h.metric),gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{subscribe:[...m]})})):gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case gn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case gn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=gt(gt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case gn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case gn.SET_USE_P2P:return gt(gt({},u),{},{useP2P:h.val});case gn.SET_TRANSPORT_TYPE:return gt(gt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:gn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:gn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:gn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:gn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:gn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:gn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:gn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:gn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:gn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:gn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:gn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:gn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:gn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:gn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:gn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:gn.KEY_METRIC_PUBLISH,metric:gt(gt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,E,S){this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:gt(gt(gt(gt(gt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:gn.KEY_METRIC_SUBSCRIBE,metric:gt(gt(gt({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:gt(gt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:gn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:gn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:gn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:gn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Vs("client-leave",this._clientId),this._publishMutex=new Vs("client-publish",this._clientId),this._renewTokenMutex=new Vs("client-renewtoken",this._clientId),this._subscribeMutex=new Vs("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Sl," build: ").concat(aL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{qx(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new FT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(mn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(E=>E.uid===c);_&&Rt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Mme(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Ci,httpRetryConfig:t.httpRetryConfig||Ci,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new $me(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},rp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new BT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Qn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Qn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof jL&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,E,S){UA.get(_)||UA.set(_,[]),VA.get(_)||VA.set(_,E),gh.get(_)||gh.set(_,0);const R=UA.get(_),P=VA.get(_);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(gh.get(_)===P){const q=gT();R.push(q),await q.promise}gh.set(_,gh.get(_)+1);for(var k=arguments.length,G=new Array(k>3?k-3:0),U=3;U<k;U++)G[U-3]=arguments[U];const j=await S(...G);return gh.set(_,gh.get(_)-1),gh.get(_)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),gh.get(_)===0&&(UA.set(_,[]),VA.set(_,0),gh.set(_,0)),j}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,o,c)}async join(t,r,s,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(HA||HA||(HA=(window.location.protocol.split(":")[0]||"").toUpperCase(),HA))==="HTTPS",m=m8()?window.isSecureContext:"Browser Not Support";(!m8()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Rt.setAppId(t);try{if(!s&&s!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&us(s,"token",1,2047),us(t,"appid",1,2047),fP(r),o&&pP(o),c&&us(c,"optionalInfo",1,2047)}catch(U){throw Rt.reportApiInvoke(x_(),{name:wi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Rt.reportApiInvoke(x_(),{name:wi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await p9({appId:t,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(_==null?void 0:_.sid)||x_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=Rt.reportApiInvoke(E,{id:this._clientId,name:wi.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Vr.TRACER}),R=bu(bu(bu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async U=>{const j=function(ye){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ge=new Uint8Array(new ArrayBuffer(Ee.length));for(let ke=0;ke<Ee.length;ke+=1)ge[ke]=Ee.charCodeAt(ke);return ge}(),q=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=$x(U),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(ye){let Ee="";for(let ge=0;ge<ye.length;ge+=1)Ee+=String.fromCharCode(ye[ge]);return window.btoa(Ee)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,j=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(R.appId+this._encryptionSecret+this._encryptionSecret):U.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256,ge=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:C8,hash:"SHA-256",salt:le},ye,Ee+hpe);return new Uint8Array(ge).subarray(Ee/8)}(this._encryptionMode,j,D_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,le){const ye=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:C8,hash:"SHA-256",salt:le},ye,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,j,D_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Rt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const j=R.cloudProxyServer;if(st(k=["proxy3","proxy4","proxy5"]).call(k,j)){const Ee=re("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(Rt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),_){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(_.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await oH(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(ge=>({turnServerURL:ge.address,tcpport:ge.tcpport||Os.tcpport,udpport:ge.udpport||Os.udpport,username:ge.username||Os.username,password:ge.password||Os.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}_9(_,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,U]=await ut.all([xH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,this.store),DH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,U.gatewayInfo.uid=Ee,U.gatewayInfo.res.uid=Ee}else U=await DH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(OT.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(OT.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=s||t;const q=U.gatewayInfo,Y=R.uid?R.uid:q.uid;this._joinInfo=bu(bu({},R),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(le),this._appId=t,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,st(B_).call(B_,G)||B_.push(G),this._cloudProxyServerMode==="disabled"&&Dn().supportWebCrypto&&re("ENABLE_PRELOAD")&&fM(this._joinInfo),le}catch(U){const j=Array.isArray(U)?U[0]:U;throw j&&j.code===X.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Is()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=B_.indexOf(r);s!==-1&&B_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Gn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof zv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof zv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Er&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(t){nr(t.id,"id",0,65535,!0),Xf(t.ordered,"ordered"),us(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return wH(c,!1)}(t),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await ut.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof zv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Bm)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");t=o}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Mi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===_t.AUDIO,o=r===_t.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:E}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===t);S||(S=new Bm(t,E||t),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=E||t),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var s;if(nr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&st(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),_;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,s){if(Mi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Mi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===t)){const E=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),E}if(!t.hasAudio&&!t.hasVideo){const E=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),E}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const E=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?_t.AUDIO:_t.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const S=r==="audio"?t._audioSSRC:t._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?_t.AUDIO:_t.VIDEO,ssrcId:c}),Bs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,t,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?t._audioTrack:t._videoTrack;if(!E)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),E),E}finally{_()}}async massSubscribe(t){if(Jf(t,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:_,mediaType:E}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(E)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:_,mediaType:E}=m;return{user:_,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=t.length-1;_>=0;_--){const E=t[_],{user:S,mediaType:R}=E;if(Mi(R,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,t.splice(_,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[_].error=U,t.splice(_,1);continue}const k=qi.Video|qi.LwoVideo,G=s.get(S);if(G){if(R==="video"?G&k:G&qi.Audio){t.splice(_,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,G|(R==="video"?k:qi.Audio))}else s.set(S,R==="video"?k:qi.Audio)}for(let _=t.length-1;_>=0;_--){const E=t[_],{user:S,mediaType:R}=E,P=qi.Video|qi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const k=s.get(S);s.set(S,R==="video"?k^P:k^qi.Audio),t.splice(_,1)}}this.store.massSubscribe(t.map(_=>({userId:_.user.uid,type:_.mediaType})),r);let m=rc(h=Array.from(s.entries())).call(h,(_,E)=>{let[S,R]=E;if(R===0)return _;const P={stream_id:S.uid,stream_type:R};return R&qi.Audio&&(P.audio_ssrc=S._audioSSRC),R&qi.Video&&(P.video_ssrc=S._videoSSRC),_.push(P),_},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(E=>{let{user:S,mediaType:R}=E;return{user:S,mediaType:R,ssrcId:R===_t.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===_t.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:k,error_code:G}=S;(P||k||G)&&_.set(R,{video_error_code:P,audio_error_code:k,error_code:G})})}if(Array.from(_.entries()).length>0){const E=[];Array.from(_.entries()).forEach(S=>{let[R,P]=S;const k=this.remoteUsers.find(G=>G.uid===R);if(k){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=_t.VIDEO:P.audio_error_code&&(G=_t.AUDIO),E.push({user:k,mediaType:G})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=_.get(E.user.uid);if(S){const R=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(R){const P=kT(R);x.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(P.desc)),E.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;Rt.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===_t.VIDEO,audio:E.mediaType===_t.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===_t.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(E=>{let{user:S,mediaType:R}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(t),_}}finally{u(),o()}}async unsubscribe(t,r,s){if(!(t instanceof Bm)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Mi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&WA(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&nr(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=t._dataChannels;if(o===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,o);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(Jf(t,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:o,mediaType:c}=t[s];if(!o){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Mi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(s,1);continue}const h=qi.Video|qi.LwoVideo;if(r.has(o)){const m=r.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&qi.Audio;break;default:_=m&(qi.Audio|h)}if(_){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(o,m|qi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|qi.Audio|h)}else c?c==="audio"?r.set(o,qi.Audio):c==="video"&&r.set(o,h):r.set(o,qi.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===X.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new xe(X.INVALID_PARAMS);Ur(s.width)||Gx(s.width,"streamParameter.width"),Ur(s.height)||Gx(s.height,"streamParameter.height"),Ur(s.framerate)||Gx(s.framerate,"streamParameter.framerate"),Ur(s.bitrate)||nr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,$e.LocalVideoLowTrack)}async enableDualStream(){if(!Dn().supportDualStream)throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(o){Mi(o,"role",["audience","host"])}(t),r&&qx(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",As.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&qx(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(us(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Rt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(ST(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>r8(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(us(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");Rt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");Jf(t.accessPoints.serverList,"accessPoints.serverList"),us(t.accessPoints.domain,"accessPoints.domain");const r=(P,k)=>{nr(P,k,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Qn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Qn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Qn("WEBCS_DOMAIN",h),Qn("WEBCS_DOMAIN_BACKUP_LIST",h),Qn("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Jf(t.report.hostname,"report.hostname"),Qn("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Qn("EVENT_REPORT_DOMAIN",u[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),Qn("STATS_COLLECTOR_PORT",m),t.report?Qn("ENABLE_EVENT_REPORT",!0):Qn("ENABLE_EVENT_REPORT",!1);let _="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Jf(t.log.hostname,"log.hostname"),_=t.log.hostname[0]):_=u[0];let E=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),E=t.log.port),Qn("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let S=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Jf(t.cds.hostname,"cds.hostname"),S=t.cds.hostname):S=u;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),Qn("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),t.cds?Qn("ENABLE_CONFIG_DISTRIBUTE",!0):Qn("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(Jf(t,"serverList"),us(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Qn("WEBCS_DOMAIN",t),Qn("WEBCS_DOMAIN_BACKUP_LIST",t),Qn("GATEWAY_DOMAINS",[r]),Qn("EVENT_REPORT_DOMAIN",t[0]),Qn("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Qn("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Mi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Mi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Mi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,o){(function(u){Mi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),us(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(st(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Xf(o,"encryptDataStream"),!st(c).call(c,t))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Dm(s))}async renewToken(t){if(us(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Hme(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(mn.VOLUME_INDICATOR,t)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const s=r?ep.TRANSCODE:ep.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(ep.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await ut.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){BH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){BH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof BT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,t.payload=await async function(c,u,h){var m;const _=rc(m=Array.from(h)).call(m,(U,j)=>U+j,0),E={serverTs:0,seq:fpe++,length:h.length,checkSum:_},S=new Uint8Array(d8(_,2)),R=new ArrayBuffer(Mv),P=new DataView(R);P.setUint32(0,E.serverTs),P.setUint16(4,E.seq),P.setUint16(6,E.length),P.setUint16(8,E.checkSum);const k=16-h.length%16;h=o8(h,new Uint8Array(k));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:w8,additionalData:S},u,h);return o8(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:Dm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-ege},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Dm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(bpe),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await Rt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Mi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Mi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(Xf(r,"apRTM"),nr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=Yv.indexOf(t);r!==-1&&Yv.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ia.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&g9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Rt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Vs("client-publish",this._clientId),this._subscribeMutex=new Vs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const o=t||x_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Rt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Rt.sessionInit(this._sessionId,bu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Er&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===X.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===X.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},rp("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:wi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Vr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:wi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Vr.TRACER}).onSuccess(),this.safeEmit(mn.LIVE_STREAMING_WARNING,c,u)},s.on(VL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,E,S){const R=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(P=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Fme(R,m,_,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,Ci).then(u).catch(h)}),s};return t===ep.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},rp("ChannelMediaRelay").create(t));o.on("state",c=>{c===Ua.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(mn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(mn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:o}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:E,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),st(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!_,maxRetransmits:E,metadata:S},k=function(G){return wH(G,!0)}(P);R._dataChannels.push(k),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(mn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(mn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(S=>S.id===u.stream_id);E&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(S=>{if(_._dataChannels=_._dataChannels.filter(R=>R!==E),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(mn.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(mn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(rs.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=s||u||kL()||!Object.prototype.hasOwnProperty.call(qA,o)||(md[o]=c,yr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(rs.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(rs.CONNECTION_STATE_CHANGE,(t,r,s)=>{var o;if(s===Gn.FALLBACK)return;const c=()=>{this.safeEmit(mn.CONNECTION_STATE_CHANGE,t,r,s)};if(Rt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:wi.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Vr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,_t.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,_t.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(rs.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await p9(bu(bu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,_9(o),this._joinInfo.preload=!0):(s=await eM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ci,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),t(c)}catch(s){r(s)}}),this._gateway.on(rs.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(mn.NETWORK_QUALITY,t)}),this._gateway.on(rs.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(mn.STREAM_TYPE_CHANGED,t,r),Rt.reportApiInvoke(this._sessionId,{name:wi.STREAM_TYPE_CHANGE,options:[t,r],tag:Vr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(rs.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(rs.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(t)),r(o)}catch(o){s(o)}}),this._gateway.on(rs.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=hH(t.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(rs.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(_n.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(_n.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(_n.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(_n.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(_n.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(_n.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(_n.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(_n.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(_n.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,_t.AUDIO,!0)),this._gateway.signal.on(_n.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,_t.AUDIO,!1)),this._gateway.signal.on(_n.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,_t.VIDEO,!0)),this._gateway.signal.on(_n.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,_t.VIDEO,!1)),this._gateway.signal.on(_n.RECEIVE_METADATA,t=>{const r=D_(t.metadata);this.safeEmit(mn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(_n.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=D_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&st(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Mv)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Mv));s=await async function(u,h,m){const _=m.subarray(0,Mv),E=_.slice(8,Mv),S=(E[0]<<8)+E[1],R=(_[6]<<8)+_[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:w8,additionalData:new Uint8Array(d8(S,2))},h,m.subarray(Mv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),nge(bu(bu({},t),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(_n.ON_CRYPT_ERROR,()=>{Nm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(mn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Gn.TOKEN_EXPIRE),this.safeEmit(mn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(_n.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(mn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(_n.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(_n.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(_n.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(zt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const u=c.some(_=>{let{stream_type:E}=_;return E===$n.Audio}),h=c.some(_=>{let{stream_type:E}=_;return E!==$n.Audio}),m=c.some(_=>{let{stream_type:E}=_;return E===$n.Screen||E===$n.ScreenLow});r.state==="offer"&&Rt.publish(this._joinInfo.sid,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(_=>{let{stream_type:E}=_;return E===$n.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:E}=_;return E!==$n.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:r&&Rt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:r.stream_type===_t.AUDIO,video:r.stream_type===_t.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(_n.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(_n.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;re("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!W_(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of t.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Bm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(mn.USER_JOINED,c)));const u=qi.Audio&o.stream_type,h=(qi.Video|qi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(mn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(mn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(mn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(mn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(mn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(_n.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof BT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return st(o=Object.keys(YA)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(_n.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(t,r,s)=>{const{uid:o}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(oi.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(zt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(oi.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===$n.Audio?_t.AUDIO:_t.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(oi.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case Mm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,_t.VIDEO,!0);break;case Mm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,_t.AUDIO,!0);break;case Mm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,_t.VIDEO,!1);break;case Mm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,_t.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=t;o!==Oo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(oi.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(kt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:o}=t;r(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,t,o===Oo.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(kt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(kt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,t,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.StateChange,(t,r)=>{r===Hn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(mn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(kt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===X.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(kt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(kt.RequestRePublishDataChannel,(t,r,s)=>{ut.all(t.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(kt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:o,kind:c}of t)c===_t.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(kt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(kt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(kt.MediaReconnectStart,t=>{this.safeEmit(mn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(kt.MediaReconnectEnd,t=>{this.safeEmit(mn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(kt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(kt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(kt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(kt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=hH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(kt.P2PLost,()=>{this.safeEmit(mn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(kt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(kt.ConnectionTypeChange,t=>{this.safeEmit(mn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(kt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(kt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(kt.AudioMetadata,t=>{this.safeEmit(mn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},rp("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:E}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:E?Number(E):0},Ci)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(is.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(mn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===yu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(mn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(is.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(mn.CONTENT_INSPECT_RESULT,r,s)}),t.on(is.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(Xf(t,"enabled"),t){if(!r)throw new Oe(X.INVALID_PARAMS,"config is required");if(O9(r),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},rp("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:E,vid:S?Number(S):0},Ci)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(t){t.on(yd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(mn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===wl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(yd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Mi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Xf(t,"enabled"),Qn("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},bt(ft.prototype,"leave",[k9],Object.getOwnPropertyDescriptor(ft.prototype,"leave"),ft.prototype),bt(ft.prototype,"publish",[N9],Object.getOwnPropertyDescriptor(ft.prototype,"publish"),ft.prototype),bt(ft.prototype,"unpublish",[D9],Object.getOwnPropertyDescriptor(ft.prototype,"unpublish"),ft.prototype),bt(ft.prototype,"subscribe",[x9],Object.getOwnPropertyDescriptor(ft.prototype,"subscribe"),ft.prototype),bt(ft.prototype,"presubscribe",[L9],Object.getOwnPropertyDescriptor(ft.prototype,"presubscribe"),ft.prototype),bt(ft.prototype,"massSubscribe",[M9],Object.getOwnPropertyDescriptor(ft.prototype,"massSubscribe"),ft.prototype),bt(ft.prototype,"unsubscribe",[U9],Object.getOwnPropertyDescriptor(ft.prototype,"unsubscribe"),ft.prototype),bt(ft.prototype,"massUnsubscribe",[V9],Object.getOwnPropertyDescriptor(ft.prototype,"massUnsubscribe"),ft.prototype),bt(ft.prototype,"setLowStreamParameter",[F9],Object.getOwnPropertyDescriptor(ft.prototype,"setLowStreamParameter"),ft.prototype),bt(ft.prototype,"enableDualStream",[j9],Object.getOwnPropertyDescriptor(ft.prototype,"enableDualStream"),ft.prototype),bt(ft.prototype,"disableDualStream",[B9],Object.getOwnPropertyDescriptor(ft.prototype,"disableDualStream"),ft.prototype),bt(ft.prototype,"setClientRole",[W9],Object.getOwnPropertyDescriptor(ft.prototype,"setClientRole"),ft.prototype),bt(ft.prototype,"_setClientRoleOptions",[z9],Object.getOwnPropertyDescriptor(ft.prototype,"_setClientRoleOptions"),ft.prototype),bt(ft.prototype,"setProxyServer",[G9],Object.getOwnPropertyDescriptor(ft.prototype,"setProxyServer"),ft.prototype),bt(ft.prototype,"setTurnServer",[H9],Object.getOwnPropertyDescriptor(ft.prototype,"setTurnServer"),ft.prototype),bt(ft.prototype,"setLicense",[$9],Object.getOwnPropertyDescriptor(ft.prototype,"setLicense"),ft.prototype),bt(ft.prototype,"startProxyServer",[K9],Object.getOwnPropertyDescriptor(ft.prototype,"startProxyServer"),ft.prototype),bt(ft.prototype,"stopProxyServer",[q9],Object.getOwnPropertyDescriptor(ft.prototype,"stopProxyServer"),ft.prototype),bt(ft.prototype,"setLocalAccessPointsV2",[Y9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPointsV2"),ft.prototype),bt(ft.prototype,"setLocalAccessPoints",[X9],Object.getOwnPropertyDescriptor(ft.prototype,"setLocalAccessPoints"),ft.prototype),bt(ft.prototype,"setRemoteDefaultVideoStreamType",[J9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteDefaultVideoStreamType"),ft.prototype),bt(ft.prototype,"setRemoteVideoStreamType",[Q9],Object.getOwnPropertyDescriptor(ft.prototype,"setRemoteVideoStreamType"),ft.prototype),bt(ft.prototype,"setStreamFallbackOption",[Z9],Object.getOwnPropertyDescriptor(ft.prototype,"setStreamFallbackOption"),ft.prototype),bt(ft.prototype,"setEncryptionConfig",[e7],Object.getOwnPropertyDescriptor(ft.prototype,"setEncryptionConfig"),ft.prototype),bt(ft.prototype,"renewToken",[t7],Object.getOwnPropertyDescriptor(ft.prototype,"renewToken"),ft.prototype),bt(ft.prototype,"enableAudioVolumeIndicator",[n7],Object.getOwnPropertyDescriptor(ft.prototype,"enableAudioVolumeIndicator"),ft.prototype),bt(ft.prototype,"startLiveStreaming",[r7],Object.getOwnPropertyDescriptor(ft.prototype,"startLiveStreaming"),ft.prototype),bt(ft.prototype,"setLiveTranscoding",[i7],Object.getOwnPropertyDescriptor(ft.prototype,"setLiveTranscoding"),ft.prototype),bt(ft.prototype,"stopLiveStreaming",[s7],Object.getOwnPropertyDescriptor(ft.prototype,"stopLiveStreaming"),ft.prototype),bt(ft.prototype,"startChannelMediaRelay",[o7],Object.getOwnPropertyDescriptor(ft.prototype,"startChannelMediaRelay"),ft.prototype),bt(ft.prototype,"updateChannelMediaRelay",[a7],Object.getOwnPropertyDescriptor(ft.prototype,"updateChannelMediaRelay"),ft.prototype),bt(ft.prototype,"stopChannelMediaRelay",[c7],Object.getOwnPropertyDescriptor(ft.prototype,"stopChannelMediaRelay"),ft.prototype),bt(ft.prototype,"sendCustomReportMessage",[l7],Object.getOwnPropertyDescriptor(ft.prototype,"sendCustomReportMessage"),ft.prototype),bt(ft.prototype,"pickSVCLayer",[u7],Object.getOwnPropertyDescriptor(ft.prototype,"pickSVCLayer"),ft.prototype),bt(ft.prototype,"setRTMConfig",[d7],Object.getOwnPropertyDescriptor(ft.prototype,"setRTMConfig"),ft.prototype),bt(ft.prototype,"enableContentInspect",[h7],Object.getOwnPropertyDescriptor(ft.prototype,"enableContentInspect"),ft.prototype),bt(ft.prototype,"disableContentInspect",[f7],Object.getOwnPropertyDescriptor(ft.prototype,"disableContentInspect"),ft.prototype),bt(ft.prototype,"setImageModeration",[p7],Object.getOwnPropertyDescriptor(ft.prototype,"setImageModeration"),ft.prototype),bt(ft.prototype,"setP2PTransport",[m7],Object.getOwnPropertyDescriptor(ft.prototype,"setP2PTransport"),ft.prototype),bt(ft.prototype,"getJoinChannelServiceRecords",[g7],Object.getOwnPropertyDescriptor(ft.prototype,"getJoinChannelServiceRecords"),ft.prototype),bt(ft.prototype,"setPublishAudioFilterEnabled",[_7],Object.getOwnPropertyDescriptor(ft.prototype,"setPublishAudioFilterEnabled"),ft.prototype),ft);class GT{constructor(r,s){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),GT.count+=1,this.id=GT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ut(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Oe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var E7,BP;K(GT,"count",0);const Ege=window.AudioContext||window.webkitAudioContext,vge=new(E7=Ut({report:Rt}),bt((BP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ege);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new GT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Rn().name!==Fn.SAFARI}}).prototype,"processExternalMediaAEC",[E7],Object.getOwnPropertyDescriptor(BP.prototype,"processExternalMediaAEC"),BP.prototype),BP);function v7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function S7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v7(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const gM=window||document;function b7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!gM)return;const s=Ri._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(Ri.onSecurityPolicyViolation||Ri.getListeners(bh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>st(u).call(u,h))&&(Ri.onSecurityPolicyViolation&&typeof Ri.onSecurityPolicyViolation=="function"&&Ri.onSecurityPolicyViolation(c),Ri.getListeners(bh.SECURITY_POLICY_VIOLATION).length>0&&Ri.safeEmit(bh.SECURITY_POLICY_VIOLATION,c))};s&&gM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ri.getListeners(bh.SECURITY_POLICY_VIOLATION).length>0)&&gM.addEventListener("securitypolicyviolation",o),Ri._cspEventHandlerPointer=o}var Sge=N,bge=sW,T7=RegExp.prototype,Tge=function(t){return t===T7||Sge(T7,t)?bge(t):t.flags},fo=l(Tge);function lS(t){let r=t.length;for(;--r>=0;)t[r]=0}const _M=256,w7=286,HT=30,$T=15,yM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),WP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),wge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),op=new Array(576);lS(op);const KT=new Array(60);lS(KT);const qT=new Array(512);lS(qT);const YT=new Array(256);lS(YT);const EM=new Array(29);lS(EM);const zP=new Array(HT);function vM(t,r,s,o,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=t&&t.length}let R7,I7,A7;function SM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}lS(zP);const P7=t=>t<256?qT[t]:qT[256+(t>>>7)],XT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Jc=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,XT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Ih=(t,r,s)=>{Jc(t,s[2*r],s[2*r+1])},O7=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},k7=(t,r,s)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=$T;c++)h=h+s[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=O7(o[m]++,m))}},N7=t=>{let r;for(r=0;r<w7;r++)t.dyn_ltree[2*r]=0;for(r=0;r<HT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},D7=t=>{t.bi_valid>8?XT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},x7=(t,r,s,o)=>{const c=2*r,u=2*s;return t[c]<t[u]||t[c]===t[u]&&o[r]<=o[s]},bM=(t,r,s)=>{const o=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&x7(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!x7(r,o,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=o},L7=(t,r,s)=>{let o,c,u,h,m=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+m++],o+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],o===0?Ih(t,c,r):(u=YT[c],Ih(t,u+_M+1,r),h=yM[u],h!==0&&(c-=EM[u],Jc(t,c,h)),o--,u=P7(o),Ih(t,u,s),h=WP[u],h!==0&&(o-=zP[u],Jc(t,o,h)));while(m<t.sym_next);Ih(t,256,r)},TM=(t,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,_,E=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(t.heap[++t.heap_len]=E=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)_=t.heap[++t.heap_len]=E<2?++E:0,s[2*_]=1,t.depth[_]=0,t.opt_len--,c&&(t.static_len-=o[2*_+1]);for(r.max_code=E,h=t.heap_len>>1;h>=1;h--)bM(t,s,h);_=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],bM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*_]=s[2*h]+s[2*m],t.depth[_]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=_,t.heap[1]=_++,bM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((S,R)=>{const P=R.dyn_tree,k=R.max_code,G=R.stat_desc.static_tree,U=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,q=R.stat_desc.extra_base,Y=R.stat_desc.max_length;let le,ye,Ee,ge,ke,qe,dt=0;for(ge=0;ge<=$T;ge++)S.bl_count[ge]=0;for(P[2*S.heap[S.heap_max]+1]=0,le=S.heap_max+1;le<573;le++)ye=S.heap[le],ge=P[2*P[2*ye+1]+1]+1,ge>Y&&(ge=Y,dt++),P[2*ye+1]=ge,ye>k||(S.bl_count[ge]++,ke=0,ye>=q&&(ke=j[ye-q]),qe=P[2*ye],S.opt_len+=qe*(ge+ke),U&&(S.static_len+=qe*(G[2*ye+1]+ke)));if(dt!==0){do{for(ge=Y-1;S.bl_count[ge]===0;)ge--;S.bl_count[ge]--,S.bl_count[ge+1]+=2,S.bl_count[Y]--,dt-=2}while(dt>0);for(ge=Y;ge!==0;ge--)for(ye=S.bl_count[ge];ye!==0;)Ee=S.heap[--le],Ee>k||(P[2*Ee+1]!==ge&&(S.opt_len+=(ge-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=ge),ye--)}})(t,r),k7(s,E,t.bl_count)},M7=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<_&&c===h||(m<E?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4))},U7=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,_=7,E=4;for(h===0&&(_=138,E=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<_&&c===h)){if(m<E)do Ih(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Ih(t,c,t.bl_tree),m--),Ih(t,16,t.bl_tree),Jc(t,m-3,2)):m<=10?(Ih(t,17,t.bl_tree),Jc(t,m-3,3)):(Ih(t,18,t.bl_tree),Jc(t,m-11,7));m=0,u=c,h===0?(_=138,E=3):c===h?(_=6,E=3):(_=7,E=4)}};let V7=!1;const F7=(t,r,s,o)=>{Jc(t,0+(o?1:0),3),D7(t),XT(t,s),XT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var Cge=t=>{V7||((()=>{let r,s,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(EM[c]=o,r=0;r<1<<yM[c];r++)YT[o++]=c;for(YT[o-1]=c,u=0,c=0;c<16;c++)for(zP[c]=u,r=0;r<1<<WP[c];r++)qT[u++]=c;for(u>>=7;c<HT;c++)for(zP[c]=u<<7,r=0;r<1<<WP[c]-7;r++)qT[256+u++]=c;for(s=0;s<=$T;s++)h[s]=0;for(r=0;r<=143;)op[2*r+1]=8,r++,h[8]++;for(;r<=255;)op[2*r+1]=9,r++,h[9]++;for(;r<=279;)op[2*r+1]=7,r++,h[7]++;for(;r<=287;)op[2*r+1]=8,r++,h[8]++;for(k7(op,287,h),r=0;r<HT;r++)KT[2*r+1]=5,KT[2*r]=O7(r,5);R7=new vM(op,yM,257,w7,$T),I7=new vM(KT,WP,0,HT,$T),A7=new vM(new Array(0),wge,0,19,7)})(),V7=!0),t.l_desc=new SM(t.dyn_ltree,R7),t.d_desc=new SM(t.dyn_dtree,I7),t.bl_desc=new SM(t.bl_tree,A7),t.bi_buf=0,t.bi_valid=0,N7(t)},Rge=(t,r,s,o)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let _,E=4093624447;for(_=0;_<=31;_++,E>>>=1)if(1&E&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<_M;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(t)),TM(t,t.l_desc),TM(t,t.d_desc),h=(m=>{let _;for(M7(m,m.dyn_ltree,m.l_desc.max_code),M7(m,m.dyn_dtree,m.d_desc.max_code),TM(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*C7[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?F7(t,r,s,o):t.strategy===4||u===c?(Jc(t,2+(o?1:0),3),L7(t,op,KT)):(Jc(t,4+(o?1:0),3),((m,_,E,S)=>{let R;for(Jc(m,_-257,5),Jc(m,E-1,5),Jc(m,S-4,4),R=0;R<S;R++)Jc(m,m.bl_tree[2*C7[R]+1],3);U7(m,m.dyn_ltree,_-1),U7(m,m.dyn_dtree,E-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),L7(t,t.dyn_ltree,t.dyn_dtree)),N7(t),o&&D7(t)},Ige=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(YT[s]+_M+1)]++,t.dyn_dtree[2*P7(r)]++),t.sym_next===t.sym_end),Age=t=>{Jc(t,2,3),Ih(t,256,op),(r=>{r.bi_valid===16?(XT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},Pge={_tr_init:Cge,_tr_stored_block:F7,_tr_flush_block:Rge,_tr_tally:Ige,_tr_align:Age},JT=(t,r,s,o)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const Oge=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var No=(t,r,s,o)=>{const c=Oge,u=o+s;t^=-1;for(let h=o;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},J_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},GP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:kge,_tr_stored_block:wM,_tr_flush_block:Nge,_tr_tally:Hm,_tr_align:Dge}=Pge,{Z_NO_FLUSH:$m,Z_PARTIAL_FLUSH:xge,Z_FULL_FLUSH:Lge,Z_FINISH:Tu,Z_BLOCK:j7,Z_OK:la,Z_STREAM_END:B7,Z_STREAM_ERROR:Ah,Z_DATA_ERROR:Mge,Z_BUF_ERROR:CM,Z_DEFAULT_COMPRESSION:Uge,Z_FILTERED:Vge,Z_HUFFMAN_ONLY:HP,Z_RLE:Fge,Z_FIXED:jge,Z_DEFAULT_STRATEGY:Bge,Z_UNKNOWN:Wge,Z_DEFLATED:$P}=GP,RM=286,zge=30,Gge=19,Hge=2*RM+1,$ge=15,Q_=258,Ph=262,uS=42,Z_=113,QT=666,ey=(t,r)=>(t.msg=J_[r],r),W7=t=>2*t-(t>4?9:0),Km=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Kge=t=>{let r,s,o,c=t.w_size;r=t.hash_size,o=r;do s=t.head[--o],t.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=t.prev[--o],t.prev[o]=s>=c?s-c:0;while(--r)};let qm=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Rl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Il=(t,r)=>{Nge(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Rl(t.strm)},Yr=(t,r)=>{t.pending_buf[t.pending++]=r},ZT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},IM=(t,r,s,o)=>{let c=t.avail_in;return c>o&&(c=o),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=JT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=No(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},z7=(t,r)=>{let s,o,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const _=t.strstart>t.w_size-Ph?t.strstart-(t.w_size-Ph):0,E=t.window,S=t.w_mask,R=t.prev,P=t.strstart+Q_;let k=E[u+h-1],G=E[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,E[s+h]===G&&E[s+h-1]===k&&E[s]===E[u]&&E[++s]===E[u+1]){u+=2,s++;do;while(E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&u<P);if(o=Q_-(P-u),u=P-Q_,o>h){if(t.match_start=r,h=o,o>=m)break;k=E[u+h-1],G=E[u+h]}}while((r=R[r&S])>_&&--c!=0);return h<=t.lookahead?h:t.lookahead},dS=t=>{const r=t.w_size;let s,o,c;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Ph)&&(t.window.set(t.window.subarray(r,r+r-o),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Kge(t),o+=r),t.strm.avail_in===0)break;if(s=IM(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=qm(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=qm(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Ph&&t.strm.avail_in!==0)},G7=(t,r)=>{let s,o,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,o=t.strstart-t.block_start,s>o+t.strm.avail_in&&(s=o+t.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==Tu||r===$m||s!==o+t.strm.avail_in)))break;h=r===Tu&&s===o+t.strm.avail_in?1:0,wM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Rl(t.strm),o&&(o>s&&(o=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,s-=o),s&&(IM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==$m&&r!==Tu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(IM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,o=t.strstart-t.block_start,(o>=u||(o||r===Tu)&&r!==$m&&t.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===Tu&&t.strm.avail_in===0&&s===o?1:0,wM(t,t.block_start,s,h),t.block_start+=s,Rl(t.strm)),h?3:1)},AM=(t,r)=>{let s,o;for(;;){if(t.lookahead<Ph){if(dS(t),t.lookahead<Ph&&r===$m)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=qm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Ph&&(t.match_length=z7(t,s)),t.match_length>=3)if(o=Hm(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=qm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=qm(t,t.ins_h,t.window[t.strstart+1]);else o=Hm(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(Il(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Tu?(Il(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Il(t,!1),t.strm.avail_out===0)?1:2},hS=(t,r)=>{let s,o,c;for(;;){if(t.lookahead<Ph){if(dS(t),t.lookahead<Ph&&r===$m)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=qm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Ph&&(t.match_length=z7(t,s),t.match_length<=5&&(t.strategy===Vge||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,o=Hm(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=qm(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(Il(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=Hm(t,0,t.window[t.strstart-1]),o&&Il(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=Hm(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Tu?(Il(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Il(t,!1),t.strm.avail_out===0)?1:2};function Oh(t,r,s,o,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const ew=[new Oh(0,0,0,0,G7),new Oh(4,4,8,4,AM),new Oh(4,5,16,8,AM),new Oh(4,6,32,32,AM),new Oh(4,4,16,16,hS),new Oh(8,16,32,32,hS),new Oh(8,16,128,128,hS),new Oh(8,32,128,256,hS),new Oh(32,128,258,1024,hS),new Oh(32,258,258,4096,hS)];function qge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Hge),this.dyn_dtree=new Uint16Array(2*(2*zge+1)),this.bl_tree=new Uint16Array(2*(2*Gge+1)),Km(this.dyn_ltree),Km(this.dyn_dtree),Km(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array($ge+1),this.heap=new Uint16Array(2*RM+1),Km(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*RM+1),Km(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const tw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==uS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==Z_&&r.status!==QT?1:0},H7=t=>{if(tw(t))return ey(t,Ah);t.total_in=t.total_out=0,t.data_type=Wge;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?uS:Z_,t.adler=r.wrap===2?0:1,r.last_flush=-2,kge(r),la},$7=t=>{const r=H7(t);return r===la&&(s=>{s.window_size=2*s.w_size,Km(s.head),s.max_lazy_match=ew[s.level].max_lazy,s.good_match=ew[s.level].good_length,s.nice_match=ew[s.level].nice_length,s.max_chain_length=ew[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},K7=(t,r,s,o,c,u)=>{if(!t)return Ah;let h=1;if(r===Uge&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==$P||o<8||o>15||r<0||r>9||u<0||u>jge||o===8&&h!==1)return ey(t,Ah);o===8&&(o=9);const m=new qge;return t.state=m,m.strm=t,m.status=uS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,$7(t)};var Yge=(t,r)=>{if(tw(t)||r>j7||r<0)return t?ey(t,Ah):Ah;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===QT&&r!==Tu)return ey(t,t.avail_out===0?CM:Ah);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Rl(t),t.avail_out===0)return s.last_flush=-1,la}else if(t.avail_in===0&&W7(r)<=W7(o)&&r!==Tu)return ey(t,CM);if(s.status===QT&&t.avail_in!==0)return ey(t,CM);if(s.status===uS&&s.wrap===0&&(s.status=Z_),s.status===uS){let c=$P+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=HP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,ZT(s,c),s.strstart!==0&&(ZT(s,t.adler>>>16),ZT(s,65535&t.adler)),t.adler=1,s.status=Z_,Rl(t),s.pending!==0)return s.last_flush=-1,la}if(s.status===57){if(t.adler=0,Yr(s,31),Yr(s,139),Yr(s,8),s.gzhead)Yr(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Yr(s,255&s.gzhead.time),Yr(s,s.gzhead.time>>8&255),Yr(s,s.gzhead.time>>16&255),Yr(s,s.gzhead.time>>24&255),Yr(s,s.level===9?2:s.strategy>=HP||s.level<2?4:0),Yr(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Yr(s,255&s.gzhead.extra.length),Yr(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=No(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Yr(s,0),Yr(s,0),Yr(s,0),Yr(s,0),Yr(s,0),Yr(s,s.level===9?2:s.strategy>=HP||s.level<2?4:0),Yr(s,3),s.status=Z_,Rl(t),s.pending!==0)return s.last_flush=-1,la}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=No(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Rl(t),s.pending!==0)return s.last_flush=-1,la;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(t.adler=No(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=No(t.adler,s.pending_buf,s.pending-u,u)),Rl(t),s.pending!==0)return s.last_flush=-1,la;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Yr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=No(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=No(t.adler,s.pending_buf,s.pending-u,u)),Rl(t),s.pending!==0)return s.last_flush=-1,la;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Yr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=No(t.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Rl(t),s.pending!==0))return s.last_flush=-1,la;Yr(s,255&t.adler),Yr(s,t.adler>>8&255),t.adler=0}if(s.status=Z_,Rl(t),s.pending!==0)return s.last_flush=-1,la}if(t.avail_in!==0||s.lookahead!==0||r!==$m&&s.status!==QT){let c=s.level===0?G7(s,r):s.strategy===HP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(dS(u),u.lookahead===0)){if(h===$m)return 1;break}if(u.match_length=0,m=Hm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Il(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Tu?(Il(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Il(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===Fge?((u,h)=>{let m,_,E,S;const R=u.window;for(;;){if(u.lookahead<=Q_){if(dS(u),u.lookahead<=Q_&&h===$m)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,_=R[E],_===R[++E]&&_===R[++E]&&_===R[++E])){S=u.strstart+Q_;do;while(_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&_===R[++E]&&E<S);u.match_length=Q_-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Hm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Hm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Il(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Tu?(Il(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Il(u,!1),u.strm.avail_out===0)?1:2})(s,r):ew[s.level].func(s,r);if(c!==3&&c!==4||(s.status=QT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),la;if(c===2&&(r===xge?Dge(s):r!==j7&&(wM(s,0,0,!1),r===Lge&&(Km(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Rl(t),t.avail_out===0))return s.last_flush=-1,la}return r!==Tu?la:s.wrap<=0?B7:(s.wrap===2?(Yr(s,255&t.adler),Yr(s,t.adler>>8&255),Yr(s,t.adler>>16&255),Yr(s,t.adler>>24&255),Yr(s,255&t.total_in),Yr(s,t.total_in>>8&255),Yr(s,t.total_in>>16&255),Yr(s,t.total_in>>24&255)):(ZT(s,t.adler>>>16),ZT(s,65535&t.adler)),Rl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?la:B7)},Xge=(t,r)=>{let s=r.length;if(tw(t))return Ah;const o=t.state,c=o.wrap;if(c===2||c===1&&o.status!==uS||o.lookahead)return Ah;if(c===1&&(t.adler=JT(t.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(Km(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(r.subarray(s-o.w_size,s),0),r=_,s=o.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,dS(o);o.lookahead>=3;){let _=o.strstart,E=o.lookahead-2;do o.ins_h=qm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--E);o.strstart=_,o.lookahead=2,dS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,o.wrap=c,la},nw={deflateInit:(t,r)=>K7(t,r,$P,15,8,Bge),deflateInit2:K7,deflateReset:$7,deflateResetKeep:H7,deflateSetHeader:(t,r)=>tw(t)||t.state.wrap!==2?Ah:(t.state.gzhead=r,la),deflate:Yge,deflateEnd:t=>{if(tw(t))return Ah;const r=t.state.status;return t.state=null,r===Z_?ey(t,Mge):la},deflateSetDictionary:Xge,deflateInfo:"pako deflate (from Nodeca project)"};const Jge=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var KP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)Jge(s,o)&&(t[o]=s[o])}}return t},flattenChunks:t=>{let r=0;for(let o=0,c=t.length;o<c;o++)r+=t[o].length;const s=new Uint8Array(r);for(let o=0,c=0,u=t.length;o<u;o++){let h=t[o];s.set(h,c),c+=h.length}return s}};let q7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{q7=!1}const rw=new Uint8Array(256);for(let t=0;t<256;t++)rw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;rw[254]=rw[254]=1;var iw={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,o,c,u,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let o,c;const u=new Array(2*s);for(c=0,o=0;o<s;){let h=t[o++];if(h<128){u[c++]=h;continue}let m=rw[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&t[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&q7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let E=0;E<m;E++)_+=String.fromCharCode(h[E]);return _})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+rw[t[s]]>r?s:r}},Y7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const X7=Object.prototype.toString,{Z_NO_FLUSH:Qge,Z_SYNC_FLUSH:Zge,Z_FULL_FLUSH:e_e,Z_FINISH:t_e,Z_OK:qP,Z_STREAM_END:n_e,Z_DEFAULT_COMPRESSION:r_e,Z_DEFAULT_STRATEGY:i_e,Z_DEFLATED:s_e}=GP;function YP(t){this.options=KP.assign({level:r_e,method:s_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:i_e},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y7,this.strm.avail_out=0;let s=nw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==qP)throw new Error(J_[s]);if(r.header&&nw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?iw.string2buf(r.dictionary):X7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=nw.deflateSetDictionary(this.strm,o),s!==qP)throw new Error(J_[s]);this._dict_set=!0}}function o_e(t,r){const s=new YP(r);if(s.push(t,!0),s.err)throw s.msg||J_[s.err];return s.result}YP.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?t_e:Qge,typeof t=="string"?s.input=iw.string2buf(t):X7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(u===Zge||u===e_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=nw.deflate(s,u),c===n_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=nw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===qP;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},YP.prototype.onData=function(t){this.chunks.push(t)},YP.prototype.onEnd=function(t){t===qP&&(this.result=KP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var a_e={deflate:o_e};const XP=16209;var c_e=function(t,r){let s,o,c,u,h,m,_,E,S,R,P,k,G,U,j,q,Y,le,ye,Ee,ge,ke,qe,dt;const pt=t.state;s=t.next_in,qe=t.input,o=s+(t.avail_in-5),c=t.next_out,dt=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=pt.dmax,_=pt.wsize,E=pt.whave,S=pt.wnext,R=pt.window,P=pt.hold,k=pt.bits,G=pt.lencode,U=pt.distcode,j=(1<<pt.lenbits)-1,q=(1<<pt.distbits)-1;e:do{k<15&&(P+=qe[s++]<<k,k+=8,P+=qe[s++]<<k,k+=8),Y=G[P&j];t:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,le===0)dt[c++]=65535&Y;else{if(!(16&le)){if((64&le)==0){Y=G[(65535&Y)+(P&(1<<le)-1)];continue t}if(32&le){pt.mode=16191;break e}t.msg="invalid literal/length code",pt.mode=XP;break e}ye=65535&Y,le&=15,le&&(k<le&&(P+=qe[s++]<<k,k+=8),ye+=P&(1<<le)-1,P>>>=le,k-=le),k<15&&(P+=qe[s++]<<k,k+=8,P+=qe[s++]<<k,k+=8),Y=U[P&q];n:for(;;){if(le=Y>>>24,P>>>=le,k-=le,le=Y>>>16&255,!(16&le)){if((64&le)==0){Y=U[(65535&Y)+(P&(1<<le)-1)];continue n}t.msg="invalid distance code",pt.mode=XP;break e}if(Ee=65535&Y,le&=15,k<le&&(P+=qe[s++]<<k,k+=8,k<le&&(P+=qe[s++]<<k,k+=8)),Ee+=P&(1<<le)-1,Ee>m){t.msg="invalid distance too far back",pt.mode=XP;break e}if(P>>>=le,k-=le,le=c-u,Ee>le){if(le=Ee-le,le>E&&pt.sane){t.msg="invalid distance too far back",pt.mode=XP;break e}if(ge=0,ke=R,S===0){if(ge+=_-le,le<ye){ye-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,ke=dt}}else if(S<le){if(ge+=_+S-le,le-=S,le<ye){ye-=le;do dt[c++]=R[ge++];while(--le);if(ge=0,S<ye){le=S,ye-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,ke=dt}}}else if(ge+=S-le,le<ye){ye-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,ke=dt}for(;ye>2;)dt[c++]=ke[ge++],dt[c++]=ke[ge++],dt[c++]=ke[ge++],ye-=3;ye&&(dt[c++]=ke[ge++],ye>1&&(dt[c++]=ke[ge++]))}else{ge=c-Ee;do dt[c++]=dt[ge++],dt[c++]=dt[ge++],dt[c++]=dt[ge++],ye-=3;while(ye>2);ye&&(dt[c++]=dt[ge++],ye>1&&(dt[c++]=dt[ge++]))}break}}break}}while(s<o&&c<h);ye=k>>3,s-=ye,k-=ye<<3,P&=(1<<k)-1,t.next_in=s,t.next_out=c,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=c<h?h-c+257:257-(c-h),pt.hold=P,pt.bits=k};const JP=15,l_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),u_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),d_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var sw=(t,r,s,o,c,u,h,m)=>{const _=m.bits;let E,S,R,P,k,G,U=0,j=0,q=0,Y=0,le=0,ye=0,Ee=0,ge=0,ke=0,qe=0,dt=null;const pt=new Uint16Array(16),vn=new Uint16Array(16);let Sn,ur,ai,Hr=null;for(U=0;U<=JP;U++)pt[U]=0;for(j=0;j<o;j++)pt[r[s+j]]++;for(le=_,Y=JP;Y>=1&&pt[Y]===0;Y--);if(le>Y&&(le=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&pt[q]===0;q++);for(le<q&&(le=q),ge=1,U=1;U<=JP;U++)if(ge<<=1,ge-=pt[U],ge<0)return-1;if(ge>0&&(t===0||Y!==1))return-1;for(vn[1]=0,U=1;U<JP;U++)vn[U+1]=vn[U]+pt[U];for(j=0;j<o;j++)r[s+j]!==0&&(h[vn[r[s+j]]++]=j);if(t===0?(dt=Hr=h,G=20):t===1?(dt=l_e,Hr=u_e,G=257):(dt=d_e,Hr=h_e,G=0),qe=0,j=0,U=q,k=u,ye=le,Ee=0,R=-1,ke=1<<le,P=ke-1,t===1&&ke>852||t===2&&ke>592)return 1;for(;;){Sn=U-Ee,h[j]+1<G?(ur=0,ai=h[j]):h[j]>=G?(ur=Hr[h[j]-G],ai=dt[h[j]-G]):(ur=96,ai=0),E=1<<U-Ee,S=1<<ye,q=S;do S-=E,c[k+(qe>>Ee)+S]=Sn<<24|ur<<16|ai|0;while(S!==0);for(E=1<<U-1;qe&E;)E>>=1;if(E!==0?(qe&=E-1,qe+=E):qe=0,j++,--pt[U]==0){if(U===Y)break;U=r[s+h[j]]}if(U>le&&(qe&P)!==R){for(Ee===0&&(Ee=le),k+=q,ye=U-Ee,ge=1<<ye;ye+Ee<Y&&(ge-=pt[ye+Ee],!(ge<=0));)ye++,ge<<=1;if(ke+=1<<ye,t===1&&ke>852||t===2&&ke>592)return 1;R=qe&P,c[R]=le<<24|ye<<16|k-u|0}}return qe!==0&&(c[k+qe]=U-Ee<<24|64<<16|0),m.bits=le,0};const{Z_FINISH:J7,Z_BLOCK:f_e,Z_TREES:QP,Z_OK:ty,Z_STREAM_END:p_e,Z_NEED_DICT:m_e,Z_STREAM_ERROR:wu,Z_DATA_ERROR:Q7,Z_MEM_ERROR:Z7,Z_BUF_ERROR:g_e,Z_DEFLATED:e$}=GP,ZP=16180,eO=16190,ap=16191,PM=16192,OM=16194,tO=16199,nO=16200,kM=16206,ss=16209,t$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function __e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ny=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<ZP||r.mode>16211?1:0},n$=t=>{if(ny(t))return wu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=ZP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ty},r$=t=>{if(ny(t))return wu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,n$(t)},i$=(t,r)=>{let s;if(ny(t))return wu;const o=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?wu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,r$(t))},s$=(t,r)=>{if(!t)return wu;const s=new __e;t.state=s,s.strm=t,s.window=null,s.mode=ZP;const o=i$(t,r);return o!==ty&&(t.state=null),o};let NM,DM,o$=!0;const y_e=t=>{if(o$){NM=new Int32Array(512),DM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(sw(1,t.lens,0,288,NM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;sw(2,t.lens,0,32,DM,0,t.work,{bits:5}),o$=!1}t.lencode=NM,t.lenbits=9,t.distcode=DM,t.distbits=5},a$=(t,r,s,o)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(s-o,s-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(s-o,s),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var E_e=(t,r)=>{let s,o,c,u,h,m,_,E,S,R,P,k,G,U,j,q,Y,le,ye,Ee,ge,ke,qe=0;const dt=new Uint8Array(4);let pt,vn;const Sn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ny(t)||!t.output||!t.input&&t.avail_in!==0)return wu;s=t.state,s.mode===ap&&(s.mode=PM),h=t.next_out,c=t.output,_=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,E=s.hold,S=s.bits,R=m,P=_,ke=ty;e:for(;;)switch(s.mode){case ZP:if(s.wrap===0){s.mode=PM;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,dt[0]=255&E,dt[1]=E>>>8&255,s.check=No(s.check,dt,2,0),E=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",s.mode=ss;break}if((15&E)!==e$){t.msg="unknown compression method",s.mode=ss;break}if(E>>>=4,S-=4,ge=8+(15&E),s.wbits===0&&(s.wbits=ge),ge>15||ge>s.wbits){t.msg="invalid window size",s.mode=ss;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&E?16189:ap,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.flags=E,(255&fo(s))!==e$){t.msg="unknown compression method",s.mode=ss;break}if(57344&fo(s)){t.msg="unknown header flags set",s.mode=ss;break}s.head&&(s.head.text=E>>8&1),512&fo(s)&&4&s.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,s.check=No(s.check,dt,2,0)),E=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.time=E),512&fo(s)&&4&s.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,dt[2]=E>>>16&255,dt[3]=E>>>24&255,s.check=No(s.check,dt,4,0)),E=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&fo(s)&&4&s.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,s.check=No(s.check,dt,2,0)),E=0,S=0,s.mode=16184;case 16184:if(1024&fo(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length=E,s.head&&(s.head.extra_len=E),512&fo(s)&&4&s.wrap&&(dt[0]=255&E,dt[1]=E>>>8&255,s.check=No(s.check,dt,2,0)),E=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&fo(s)&&(k=s.length,k>m&&(k=m),k&&(s.head&&(ge=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(u,u+k),ge)),512&fo(s)&&4&s.wrap&&(s.check=No(s.check,o,k,u)),m-=k,u+=k,s.length-=k),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&fo(s)){if(m===0)break e;k=0;do ge=o[u+k++],s.head&&ge&&s.length<65536&&(s.head.name+=String.fromCharCode(ge));while(ge&&k<m);if(512&fo(s)&&4&s.wrap&&(s.check=No(s.check,o,k,u)),m-=k,u+=k,ge)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&fo(s)){if(m===0)break e;k=0;do ge=o[u+k++],s.head&&ge&&s.length<65536&&(s.head.comment+=String.fromCharCode(ge));while(ge&&k<m);if(512&fo(s)&&4&s.wrap&&(s.check=No(s.check,o,k,u)),m-=k,u+=k,ge)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&fo(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ss;break}E=0,S=0}s.head&&(s.head.hcrc=fo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=ap;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}t.adler=s.check=t$(E),E=0,S=0,s.mode=eO;case eO:if(s.havedict===0)return t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,m_e;t.adler=s.check=1,s.mode=ap;case ap:if(r===f_e||r===QP)break e;case PM:if(s.last){E>>>=7&S,S-=7&S,s.mode=kM;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(s.last=1&E,E>>>=1,S-=1,3&E){case 0:s.mode=16193;break;case 1:if(y_e(s),s.mode=tO,r===QP){E>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ss}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ss;break}if(s.length=65535&E,E=0,S=0,s.mode=OM,r===QP)break e;case OM:s.mode=16195;case 16195:if(k=s.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,s.length-=k;break}s.mode=ap;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.nlen=257+(31&E),E>>>=5,S-=5,s.ndist=1+(31&E),E>>>=5,S-=5,s.ncode=4+(15&E),E>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ss;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.lens[Sn[s.have++]]=7&E,E>>>=3,S-=3}for(;s.have<19;)s.lens[Sn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,pt={bits:s.lenbits},ke=sw(0,s.lens,0,19,s.lencode,0,s.work,pt),s.lenbits=pt.bits,ke){t.msg="invalid code lengths set",s.mode=ss;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;qe=s.lencode[E&(1<<s.lenbits)-1],j=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Y<16)E>>>=j,S-=j,s.lens[s.have++]=Y;else{if(Y===16){for(vn=j+2;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=j,S-=j,s.have===0){t.msg="invalid bit length repeat",s.mode=ss;break}ge=s.lens[s.have-1],k=3+(3&E),E>>>=2,S-=2}else if(Y===17){for(vn=j+3;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ge=0,k=3+(7&E),E>>>=3,S-=3}else{for(vn=j+7;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=j,S-=j,ge=0,k=11+(127&E),E>>>=7,S-=7}if(s.have+k>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ss;break}for(;k--;)s.lens[s.have++]=ge}}if(s.mode===ss)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ss;break}if(s.lenbits=9,pt={bits:s.lenbits},ke=sw(1,s.lens,0,s.nlen,s.lencode,0,s.work,pt),s.lenbits=pt.bits,ke){t.msg="invalid literal/lengths set",s.mode=ss;break}if(s.distbits=6,s.distcode=s.distdyn,pt={bits:s.distbits},ke=sw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,pt),s.distbits=pt.bits,ke){t.msg="invalid distances set",s.mode=ss;break}if(s.mode=tO,r===QP)break e;case tO:s.mode=nO;case nO:if(m>=6&&_>=258){t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,c_e(t,P),h=t.next_out,c=t.output,_=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,E=s.hold,S=s.bits,s.mode===ap&&(s.back=-1);break}for(s.back=0;qe=s.lencode[E&(1<<s.lenbits)-1],j=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(le=j,ye=q,Ee=Y;qe=s.lencode[Ee+((E&(1<<le+ye)-1)>>le)],j=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(le+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=le,S-=le,s.back+=le}if(E>>>=j,S-=j,s.back+=j,s.length=Y,q===0){s.mode=16205;break}if(32&q){s.back=-1,s.mode=ap;break}if(64&q){t.msg="invalid literal/length code",s.mode=ss;break}s.extra=15&q,s.mode=16201;case 16201:if(s.extra){for(vn=s.extra;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;qe=s.distcode[E&(1<<s.distbits)-1],j=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&q)==0){for(le=j,ye=q,Ee=Y;qe=s.distcode[Ee+((E&(1<<le+ye)-1)>>le)],j=qe>>>24,q=qe>>>16&255,Y=65535&qe,!(le+j<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=le,S-=le,s.back+=le}if(E>>>=j,S-=j,s.back+=j,64&q){t.msg="invalid distance code",s.mode=ss;break}s.offset=Y,s.extra=15&q,s.mode=16203;case 16203:if(s.extra){for(vn=s.extra;S<vn;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ss;break}s.mode=16204;case 16204:if(_===0)break e;if(k=P-_,s.offset>k){if(k=s.offset-k,k>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ss;break}k>s.wnext?(k-=s.wnext,G=s.wsize-k):G=s.wnext-k,k>s.length&&(k=s.length),U=s.window}else U=c,G=h-s.offset,k=s.length;k>_&&(k=_),_-=k,s.length-=k;do c[h++]=U[G++];while(--k);s.length===0&&(s.mode=nO);break;case 16205:if(_===0)break e;c[h++]=s.length,_--,s.mode=nO;break;case kM:if(s.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(P-=_,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=fo(s)?No(s.check,c,P,h-P):JT(s.check,c,P,h-P)),P=_,4&s.wrap&&(fo(s)?E:t$(E))!==s.check){t.msg="incorrect data check",s.mode=ss;break}E=0,S=0}s.mode=16207;case 16207:if(s.wrap&&fo(s)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ss;break}E=0,S=0}s.mode=16208;case 16208:ke=p_e;break e;case ss:ke=Q7;break e;case 16210:return Z7;default:return wu}return t.next_out=h,t.avail_out=_,t.next_in=u,t.avail_in=m,s.hold=E,s.bits=S,(s.wsize||P!==t.avail_out&&s.mode<ss&&(s.mode<kM||r!==J7))&&a$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=fo(s)?No(s.check,c,P,t.next_out-P):JT(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===ap?128:0)+(s.mode===tO||s.mode===OM?256:0),(R===0&&P===0||r===J7)&&ke===ty&&(ke=g_e),ke},cp={inflateReset:r$,inflateReset2:i$,inflateResetKeep:n$,inflateInit:t=>s$(t,15),inflateInit2:s$,inflate:E_e,inflateEnd:t=>{if(ny(t))return wu;let r=t.state;return r.window&&(r.window=null),t.state=null,ty},inflateGetHeader:(t,r)=>{if(ny(t))return wu;const s=t.state;return(2&s.wrap)==0?wu:(s.head=r,r.done=!1,ty)},inflateSetDictionary:(t,r)=>{const s=r.length;let o,c,u;return ny(t)?wu:(o=t.state,o.wrap!==0&&o.mode!==eO?wu:o.mode===eO&&(c=1,c=JT(c,r,s,0),c!==o.check)?Q7:(u=a$(t,r,s,s),u?(o.mode=16210,Z7):(o.havedict=1,ty)))},inflateInfo:"pako inflate (from Nodeca project)"},v_e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const c$=Object.prototype.toString,{Z_NO_FLUSH:S_e,Z_FINISH:b_e,Z_OK:ow,Z_STREAM_END:xM,Z_NEED_DICT:LM,Z_STREAM_ERROR:T_e,Z_DATA_ERROR:l$,Z_MEM_ERROR:w_e}=GP;function rO(t){this.options=KP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Y7,this.strm.avail_out=0;let s=cp.inflateInit2(this.strm,r.windowBits);if(s!==ow)throw new Error(J_[s]);if(this.header=new v_e,cp.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=iw.string2buf(r.dictionary):c$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=cp.inflateSetDictionary(this.strm,r.dictionary),s!==ow)))throw new Error(J_[s])}function C_e(t,r){const s=new rO(r);if(s.push(t),s.err)throw s.msg||J_[s.err];return s.result}rO.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?b_e:S_e,c$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),u=cp.inflate(s,h),u===LM&&c&&(u=cp.inflateSetDictionary(s,c),u===ow?u=cp.inflate(s,h):u===l$&&(u=LM));s.avail_in>0&&u===xM&&s.state.wrap>0&&t[s.next_in]!==0;)cp.inflateReset(s),u=cp.inflate(s,h);switch(u){case T_e:case l$:case LM:case w_e:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===xM))if(this.options.to==="string"){let _=iw.utf8border(s.output,s.next_out),E=s.next_out-_,S=iw.buf2string(s.output,_);s.next_out=E,s.avail_out=o-E,E&&s.output.set(s.output.subarray(_,_+E),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==ow||m!==0){if(u===xM)return u=cp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},rO.prototype.onData=function(t){this.chunks.push(t)},rO.prototype.onEnd=function(t){t===ow&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=KP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var R_e={inflate:C_e};const{deflate:I_e}=a_e,{inflate:A_e}=R_e;var P_e=I_e,O_e=A_e,u$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(u$||{});class k_e{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let _=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(_=(1&new DataView(E.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,s),m.setUint8(_++,o),c.forEach(E=>{s?(m.setUint8(_++,E.id),m.setUint8(_++,E.length),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength):(m.setUint8(_++,E.id|E.length<<4),h.set(new Uint8Array(E.data),_),_+=E.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const u=s.getUint8(o);o++;const h=c===u$.TWO_BYTE,m=[],_=new DataView(r,2);let E=0;for(;E<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=_.getUint8(E),E++,R=_.getUint8(E),E++):(S=15&_.getUint8(E),R=_.getUint8(E)>>4,E++),R>0&&(P=_.buffer.slice(E+2,E+2+R),E+=P.byteLength),m.push({id:S,length:R,data:P})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return O_e(new Uint8Array(r))}compress(r){return P_e(new Uint8Array(r))}}const N_e={name:"DataStream",create:(t,r)=>{const s=r?new Fpe(t):new jpe(t);return s.useDataStream(new k_e),s}};class D_e extends Nr{constructor(r,s,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new NT("cross-channel-".concat(this.clientId),o),this.ws.on(Jt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Jt.CONNECTED,this.onOpen),this.ws.on(Jt.ON_MESSAGE,this.onMessage),this.ws.on(Jt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new ut((s,o)=>{const c=window.setTimeout(()=>{o(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(X.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const s=()=>new ut((h,m)=>{this.ws.once(Jt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(Jt.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new ut((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(Jt.RECONNECTING,_),this.ws.once(Jt.CLOSED,_),this.once("req_".concat(o),h),ds(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Jt.RECONNECTING,_),this.ws.off(Jt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Jt.REQUEST_NEW_URLS),this.ws.on(Jt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class x_e extends Nr{set state(r){r!==this._state&&(r!==Ua.RELAY_STATE_FAILURE&&(this.errorCode=Xv.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",ia.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Ua.RELAY_STATE_IDLE),K(this,"errorCode",Xv.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",tp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",tp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Xv.SRC_TOKEN_EXPIRED,this.state=Ua.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Xv.DEST_TOKEN_EXPIRED,this.state=Ua.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",tp.NETWORK_DISCONNECTED),this.state=Ua.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ua.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=Xv.SERVER_CONNECTION_LOST,this.state=Ua.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=x_(),this.signal=new D_e(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ua.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=Ua.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ua.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ua.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const s=this.genMessage(ko.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ua.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ia.CancelToken.source(),this.state=Ua.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Gme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",tp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(ko.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(ko.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ko.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",tp.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(ko.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ko.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",tp.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(ko.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",tp.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ua.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(ko.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",tp.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(ko.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Sl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(r){case ko.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ko.SetSourceChannel:if(_=s&&s.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case ko.SetSourceUserId:if(_=s&&s.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case ko.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case ko.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ko.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ko.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ko.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case ko.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const L_e={name:"ChannelMediaRelay",create:function(t){return new x_e(t.joinInfo,t.clientId,t.websocketRetryConfig||Ci,t.httpRetryConfig||Ci,t.resolution)}};function d$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function aw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?d$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class M_e extends Nr{constructor(r,s,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Rt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===ep.TRANSCODE?1:2}),this.emit(Lm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new NT("live-streaming",o),this.websocket.on(Jt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Jt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Jt.REQUEST_NEW_URLS,(u,h)=>{Ps(this,Lm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Jt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=aw({command:r,sdkVersion:Sl==="4.23.2"?"0.0.1":Sl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new ut((P,k)=>{this.websocket.once(Jt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(Jt.CONNECTED,P)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new ut((P,k)=>{const G=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(Jt.RECONNECTING,G),this.websocket.once(Jt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{P(U)})});c&&Rt.workerEvent(this.spec.sid,aw(aw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await E}catch(P){if(this.websocket.state==="closed")throw P;return await _(),await this.request(r,s,o)}return c&&Rt.workerEvent(this.spec.sid,aw(aw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Sl==="4.23.2"?"0.0.1":Sl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Di.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Di.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Di.LIVE_STREAM_RESPONSE_BAD_STREAM:case Di.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Di.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Di.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Di.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Lm.WARNING,s,r.serverResponse.url)}case Di.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Lm.WARNING,s,r.serverResponse.url)}case Di.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Di.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Di.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Lm.WARNING,s,r.serverResponse.url)}case Di.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Di.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Di.LIVE_STREAM_RESPONSE_WORKER_LOST:case Di.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Di.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Di.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(GA)},6e3)}}function h$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Va(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?h$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class U_e extends Nr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ci,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ci;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Vs("live-streaming")),K(this,"cancelToken",ia.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Va(Va({},Tme),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Va(Va(Va({},bme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Ur(h.width)||nr(h.width,"config.width",0,1e4),Ur(h.height)||nr(h.height,"config.height",0,1e4),Ur(h.videoBitrate)||nr(h.videoBitrate,"config.videoBitrate",1,1e6),Ur(h.videoFrameRate)||nr(h.videoFrameRate,"config.videoFrameRate"),Ur(h.lowLatency)||Xf(h.lowLatency,"config.lowLatency"),Ur(h.audioSampleRate)||Mi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ur(h.audioBitrate)||nr(h.audioBitrate,"config.audioBitrate",1,128),Ur(h.audioChannels)||Mi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ur(h.videoGop)||nr(h.videoGop,"config.videoGop"),Ur(h.videoCodecProfile)||Mi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ur(h.userCount)||nr(h.userCount,"config.userCount",0,17),Ur(h.backgroundColor)||nr(h.backgroundColor,"config.backgroundColor",0,16777215),Ur(h.userConfigExtraInfo)||us(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Ur(h.transcodingUsers)&&(Jf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{pP(m.uid),Ur(m.x)||nr(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Ur(m.y)||nr(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Ur(m.width)||nr(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Ur(m.height)||nr(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Ur(m.zOrder)||nr(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Ur(m.alpha)||nr(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Ur(h.watermark)||UL(h.watermark,"watermark"),Ur(h.backgroundImage)||UL(h.backgroundImage,"backgroundImage"),h.images&&!Ur(h.images)&&(Jf(h.images,"config.images"),h.images.forEach((m,_)=>{UL(m,"images[".concat(_,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>Va(Va(Va({},ML),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(Va(Va(Va({},ML),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(Va(Va(Va({},ML),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Va({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?ut.resolve(h.uid):xH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ut.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Fc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===ep.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case ep.TRANSCODE:c.transcodingConfig=Va({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ut((E,S)=>{ds(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),_=await ut.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===ep.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new ut((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===ep.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(Fc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ia.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Ps(this,VL.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new M_e(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Lm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Lm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Lm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ps(this,VL.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Di.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Di.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Di.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Di.LIVE_STREAM_RESPONSE_WORKER_LOST:case Di.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Fc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{x.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const V_e={name:"LiveStreaming",create:function(t){return new U_e(t.joinInfo,t.websocketRetryConfig||Ci,t.httpRetryConfig||Ci)}};function F_e(t){let r=m$();return function(s,o){let c=s.appId;c!==void 0&&(Yn(o,10),kh(o,c));let u=s.cid;u!==void 0&&(Yn(o,16),Yn(o,u));let h=s.cname;h!==void 0&&(Yn(o,26),kh(o,h));let m=s.deviceId;m!==void 0&&(Yn(o,34),kh(o,m));let _=s.elapse;_!==void 0&&(Yn(o,40),Ym(o,_));let E=s.fileSize;E!==void 0&&(Yn(o,48),Ym(o,fS(E)));let S=s.height;S!==void 0&&(Yn(o,56),Ym(o,fS(S)));let R=s.jpg;R!==void 0&&(Yn(o,66),Yn(o,R.length),function(ua,je){let it=pS(ua,je.length);ua.bytes.set(je,it)}(o,R));let P=s.networkType;P!==void 0&&(Yn(o,72),Ym(o,fS(P)));let k=s.osType;k!==void 0&&(Yn(o,80),Ym(o,fS(k)));let G=s.requestId;G!==void 0&&(Yn(o,90),kh(o,G));let U=s.sdkVersion;U!==void 0&&(Yn(o,98),kh(o,U));let j=s.sequence;j!==void 0&&(Yn(o,104),Ym(o,fS(j)));let q=s.sid;q!==void 0&&(Yn(o,114),kh(o,q));let Y=s.timestamp;Y!==void 0&&(Yn(o,120),Ym(o,Y));let le=s.uid;le!==void 0&&(Yn(o,128),Yn(o,le));let ye=s.vid;ye!==void 0&&(Yn(o,136),Yn(o,ye));let Ee=s.width;Ee!==void 0&&(Yn(o,144),Ym(o,fS(Ee)));let ge=s.service;ge!==void 0&&(Yn(o,152),Yn(o,ge));let ke=s.callbackData;ke!==void 0&&(Yn(o,162),kh(o,ke));let qe=s.jpgEncryption;qe!==void 0&&(Yn(o,168),Yn(o,qe));let dt=s.requestType;dt!==void 0&&(Yn(o,176),Yn(o,dt));let pt=s.scorePorn;pt!==void 0&&(Yn(o,185),jM(o,pt));let vn=s.scoreSexy;vn!==void 0&&(Yn(o,193),jM(o,vn));let Sn=s.scoreNeutral;Sn!==void 0&&(Yn(o,201),jM(o,Sn));let ur=s.scene;ur!==void 0&&(Yn(o,208),Yn(o,ur));let ai=s.ossFilePrefix;ai!==void 0&&(Yn(o,218),kh(o,ai));let Hr=s.serviceVendor;if(Hr!==void 0)for(let ua of Hr){Yn(o,226);let je=m$();W_e(ua,je),Yn(o,je.limit),$_e(o,je),H_e(je)}}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function j_e(t){return function(s){let o={};e:for(;!g$(s);){let c=Nh(s);switch(c>>>3){case 0:break e;case 1:o.code=Nh(s);break;case 2:o.msg=_$(s,Nh(s));break;case 3:{let u=z_e(s);o.data=B_e(s),s.limit=u;break}default:f$(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function B_e(t){let r={};e:for(;!g$(t);){let s=Nh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=_$(t,Nh(t));break;case 2:r.requestType=Nh(t)>>>0;break;case 3:r.scorePorn=FM(t);break;case 4:r.scoreSexy=FM(t);break;case 5:r.scoreNeutral=FM(t);break;case 6:r.requestScene=Nh(t)>>>0;break;case 7:r.scene=Nh(t)>>>0;break;default:f$(t,7&s)}}return r}function W_e(t,r){let s=t.service;s!==void 0&&(Yn(r,8),Yn(r,s));let o=t.vendor;o!==void 0&&(Yn(r,16),Yn(r,o));let c=t.token;c!==void 0&&(Yn(r,26),kh(r,c));let u=t.callbackUrl;u!==void 0&&(Yn(r,34),kh(r,u))}function z_e(t){let r=Nh(t),s=t.limit;return t.limit=t.offset+r,s}function f$(t,r){switch(r){case 0:for(;128&y$(t););break;case 2:UM(t,Nh(t));break;case 5:UM(t,4);break;case 1:UM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let G_e=new Float32Array(1);new Uint8Array(G_e.buffer);let MM=new Float64Array(1),Fa=new Uint8Array(MM.buffer);function fS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let p$=[];function m$(){const t=p$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function H_e(t){p$.push(t)}function UM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function g$(t){return t.offset>=t.limit}function pS(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function VM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function _$(t,r){let s=VM(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let _,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(_=c[m+s+1],(192&_)!=128?h+=u:(R=(31&P)<<6|63&_,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],(49344&(_|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&_)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(_=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(_|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&_)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function kh(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Yn(t,o);let c=pS(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function $_e(t,r){let s=pS(t,r.limit),o=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+s]=c[u]}function y$(t){return t.bytes[VM(t,1)]}function E$(t,r){let s=pS(t,1);t.bytes[s]=r}function FM(t){let r=VM(t,8),s=t.bytes;return Fa[0]=s[r++],Fa[1]=s[r++],Fa[2]=s[r++],Fa[3]=s[r++],Fa[4]=s[r++],Fa[5]=s[r++],Fa[6]=s[r++],Fa[7]=s[r++],MM[0]}function jM(t,r){let s=pS(t,8),o=t.bytes;MM[0]=r,o[s++]=Fa[0],o[s++]=Fa[1],o[s++]=Fa[2],o[s++]=Fa[3],o[s++]=Fa[4],o[s++]=Fa[5],o[s++]=Fa[6],o[s++]=Fa[7]}function Nh(t){let r,s=0,o=0;do r=y$(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function Yn(t,r){for(r>>>=0;r>=128;)E$(t,127&r|128),r>>>=7;E$(t,r)}function Ym(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=pS(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function v$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const K_e=new Map([["moderation",1],["supervise",2]]);class q_e extends Nr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(is.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=rc(s=r.map(o=>K_e.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",yu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ia.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==yu.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===yu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=cr(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new NT("worker-manager-"+this._inspectId,Ci),this.on(is.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Eu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new NT("worker-"+this._inspectId,Ci),this.handleWorkerEvents()}async init(r,s){this.emit(is.STATE_CHANGE,Eu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ut((c,u)=>{this.on(is.CONNECTION_STATE_CHANGE,(h,m)=>{m===yu.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,E,S){let{appId:R,areaCode:P,cname:k,sid:G,token:U,uid:j}=_;rS++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:R,areaCode:P,cname:k,command:"allocateEdge",requestId:rS,seq:rS,sid:G,token:U,ts:Date.now(),uid:j+""})};let le,ye,Ee=m[0];return pd(async()=>{le=Date.now();const ge=await Ed(Ee,{data:Y,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-le,ge.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ge.code,{retry:!0,responseTime:ye});throw x.error(pt.toString()),pt}const ke=JSON.parse(ge.json_body);if(ke.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:ye});throw x.error(pt.toString()),pt}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:ye});throw x.error(pt.toString()),pt}const qe=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),dt=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(pt=>{let{address:vn,wss:Sn}=pt;if(vn&&Sn)return"wss://".concat(vn.replace(/\./g,"-"),".").concat(qe,":").concat(dt||Sn)}).filter(pt=>!!pt),workerToken:ke.workerToken,vid:ke.vid,responseTime:ye}},(ge,ke)=>(Rt.apworkerEvent(G,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(ge.addressList),firstSuccess:ke===0,responseTime:ye,serverIp:m[ke%m.length]}),!1),(ge,ke)=>(Rt.apworkerEvent(G,{success:!1,sc:ge.data&&ge.data.code||200,serviceName:q,responseTime:ye,serverIp:m[ke%m.length]}),!!(ge.code!==X.OPERATION_ABORTED&&ge.code!==X.UNEXPECTED_RESPONSE||ge.data&&ge.data.retry)&&(Ee=m[(ke+1)%m.length],!0)),S)}(c,r,s,o);this.emit(is.STATE_CHANGE,Eu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(is.STATE_CHANGE,Eu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Jt.CONNECTED,async()=>{this.emit(is.STATE_CHANGE,Eu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Jt.CLOSED,()=>{this._innerConnectionState<Eu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Jt.FAILED,()=>{this._innerConnectionState<Eu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Jt.RECONNECTING,()=>{this._innerConnectionState<Eu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Jt.ON_MESSAGE,async r=>{this.emit(is.STATE_CHANGE,Eu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(is.STATE_CHANGE,Eu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(is.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Jt.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(Jt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Jt.CONNECTED,async()=>{this.emit(is.STATE_CHANGE,Eu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=yu.CONNECTED}),this.workerConnection.on(Jt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=j_e(new Uint8Array(r.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(is.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=rc(s=Object.keys(c)).call(s,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(is.INSPECT_RESULT,h)}else this.emit(is.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(is.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(is.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Jt.CLOSED,()=>{this.connectionState=yu.CLOSED}),this.workerConnection.on(Jt.FAILED,()=>{this.connectionState=yu.CLOSED}),this.workerConnection.on(Jt.RECONNECTING,()=>{this.connectionState=this.connectionState===yu.CONNECTED?yu.RECONNECTING:yu.CONNECTING}),this.workerConnection.on(Jt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Jt.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(is.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Bc(this,is.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(is.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(is.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await tz(S,o,c),P=this.sequence+"-"+u+"-"+_+"-"+E+"-"+cr(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:A9(E),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=F_e(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(q){for(var Y=1;Y<arguments.length;Y++){var le=arguments[Y]!=null?arguments[Y]:{};Y%2?v$(Object(le),!0).forEach(function(ye){K(q,ye,le[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(le)):v$(Object(le)).forEach(function(ye){Object.defineProperty(q,ye,Object.getOwnPropertyDescriptor(le,ye))})}return q}({},k);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return U}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ia.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=yu.CLOSED,this.emit(is.STATE_CHANGE,Eu.CLOSED)}}const Y_e={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var u;if(!st(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new q_e(r)}};var S$=l(vt.Object.getOwnPropertySymbols),X_e=Vn,J_e=Qo.indexOf,Q_e=Tf,BM=se([].indexOf),b$=!!BM&&1/BM([1],1,-0)<0;X_e({target:"Array",proto:!0,forced:b$||!Q_e("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return b$?BM(this,t,r)||0:J_e(this,t,r)}});var Z_e=nc("Array").indexOf,eye=N,tye=Z_e,WM=Array.prototype,nye=function(t){var r=t.indexOf;return t===WM||eye(WM,t)&&r===WM.indexOf?tye:r},T$=l(nye);function rye(t,r){if(t==null)return{};var s,o,c=function(h,m){if(h==null)return{};var _,E,S={},R=zG(h);for(E=0;E<R.length;E++)_=R[E],T$(m).call(m,_)>=0||(S[_]=h[_]);return S}(t,r);if(S$){var u=S$(t);for(o=0;o<u.length;o++)s=u[o],T$(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let w$=class{get localCapabilities(){return Fr(this._localCapabilities)}get rtpCapabilities(){return Fr(this._rtpCapabilities)}get candidates(){return Fr(this._candidates)}get iceParameters(){return Fr(this._iceParameters)}get dtlsParameters(){return Fr(this._dtlsParameters)}constructor(t){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),t=Fr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:E}=t;let S;this.setup=m,S=h===Oo.RECEIVE_ONLY?Ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===Oo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Oo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===Oo.RECEIVE_ONLY?c.send.videoCodecs:LT(_t.VIDEO,R,P,_),G=h===Oo.RECEIVE_ONLY?c.send.audioCodecs:LT(_t.AUDIO,R,P,E);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=r.iceUfrag,U.attributes.icePwd=r.icePwd,U.attributes.fingerprints=s.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(j=>j.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=R.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=G.map(j=>j.payloadType.toString(10)),U.attributes.payloads=G,U.attributes.extmaps=R.audioExtensions,nS(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return xm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=z_(r,this.cname,re("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Mr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(t,u,o);let E;return _===-1?(E=this.createOrRecycleSendMedia(t,u,h,"sendonly",o,c),this.updateBundleMids()):(E=Fr(this.sessionDesc.mediaDescriptions[_]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(E,c)),Mr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const o=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Fr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(t),E={foundation:r??"",componentId:"1",transport:s??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,o,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=LT(u,h,this.localCapabilities.send,u===_t.AUDIO?c:o),_=u===_t.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,t);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>st(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>st(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Mr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Fr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,o,c,u){const h=this.rtpCapabilities.send,m=t===_t.VIDEO?h.videoCodecs:h.audioCodecs,_=t===_t.VIDEO?h.videoExtensions:h.audioExtensions;Mr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(t);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(t,r,s){const o=Fr(t);return zL(o),tS(o,r),GL(o,r),pH(o),SP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(t,r){const s=Fr(t);return SP(s,r,this.localCapabilities.recv),nS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Mr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const iye=["sdp"];var mr;function C$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Xm(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?C$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):C$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let R$=(mr=class AS extends YG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Vs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(AS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Oo.SEND_ONLY,this.name=this.direction===Oo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=rL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await gH();if(this.localCapabilities=bP(s),r){const{sdp:o}=r,c=rye(r,iye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=xT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vu(R,S,"videoExtensions",P,k,G),vu(R,S,"videoCodecs",P,k,G),vu(R,S,"audioExtensions",P,k,G),vu(R,S,"audioCodecs",P,k,G),re("RAISE_H264_BASELINE_PRIORITY")){const U=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const j=G.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<U){x.debug("raising H264 baseline profile priority");const q=G.videoCodecs[U];G.videoCodecs.splice(U,1),G.videoCodecs.splice(j,0,q)}j!==-1&&re("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:k,sendrecv:G}}({},{},o);this.remoteSDP=new w$({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Fm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await _H({},{},h.sdp);this.localCapabilities=bP(_);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),Xm(Xm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Fm(o.sdp);return this.initialOffer=o,Xm(Xm({},c),{},{sdp:o.sdp})}}catch(s){throw new xe(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,u=await _H({},{},s);this.remoteSDP=new w$({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new xe(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return vl(function*(){const u=yield Cn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((j,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(Y),j._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(le=>le.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),j._updateRtpTransceiver(Y)}}),Mr()&&re("SIMULCAST")===!0&&(yield Cn(c.applySimulcastForFirefox(h,r)));const _=m.map(j=>j.mid),E=yield Cn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,_),R=Ma(S),P=_.map(j=>{const q=R.mediaDescriptions.find(Y=>Y.attributes.mid===j);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return dH(q,re("USE_PUB_RTX"))}),k=h.map((j,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}});yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(j){const q=c.remoteSDP.toString();throw yield Cn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield Cn(c.stopSending(_,!0)),j}yield Cn(c.applySimulcastEncodings(h,r)),yield Cn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(G),yield Cn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((j,q)=>{const Y=_[q];return{localSSRC:P[q],id:Y}})}catch(h){throw h instanceof xe?h:new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>r.indexOf(_.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var E;_.direction="inactive",(E=_.stop)===null||E===void 0||E.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const _=this.remoteSDP.toString(),E=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===L_.Auto&&(this.store.p2pTransport=L_.SdRtn,Dn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(AS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Dn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(AS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Fm(s.sdp);return this.store.descriptionStart(),this.direction===Oo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Oo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Fm(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Mr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:Xm(Xm({},yh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Xm(Xm({},yh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;st(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(ST(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...AS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...AS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),st(u=[L_.Relay,L_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&Dn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(s){case L_.SdRtn:const m=r.filter(E=>{var S;return st(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(Um(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(Um(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case L_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Um(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Um(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Dn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),st(h=r._hints).call(h,lr.LOW_STREAM)&&(R&&(u.maxFramerate=dc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(re("DSCP_TYPE")&&Yf()){var m;const S=re("DSCP_TYPE");st(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=s.getParameters(),E=(o=_.encodings)===null||o===void 0?void 0:o[0];Mr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(_,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await s.setParameters(_)}async applySendEncodings(r,s){try{if(!Dn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Er&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ma(r);return s.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(E=>E.attributes.mid===m);_&&(tS(_,u),mH(_,u,this.store.codec))}),xm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let _=0;_<r.length;_++){var o,c,u,h,m;const E=r[_],S=s[_];if(S instanceof Er&&!st(o=S._hints).call(o,lr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,R))}}}async applySimulcastEncodings(r,s){if(!Mr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Er&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Er&&re("SIMULCAST")&&this.store.codec==="vp8"&&!st(s=r._hints).call(s,lr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(re("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Ma(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),st(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Ma(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&o===_t.AUDIO&&u.media.mediaType==="audio"&&nS(u),xm(c)}},bt(mr.prototype,"establish",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"establish"),mr.prototype),bt(mr.prototype,"connect",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"connect"),mr.prototype),bt(mr.prototype,"receive",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"receive"),mr.prototype),bt(mr.prototype,"mockReceive",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"mockReceive"),mr.prototype),bt(mr.prototype,"stopReceiving",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"stopReceiving"),mr.prototype),bt(mr.prototype,"restartICE",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"restartICE"),mr.prototype),bt(mr.prototype,"close",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"close"),mr.prototype),bt(mr.prototype,"updateEncoderConfig",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"updateEncoderConfig"),mr.prototype),bt(mr.prototype,"updateSendParameters",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"updateSendParameters"),mr.prototype),bt(mr.prototype,"replaceTrack",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"replaceTrack"),mr.prototype),bt(mr.prototype,"muteLocal",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"muteLocal"),mr.prototype),bt(mr.prototype,"unmuteLocal",[Cu],Object.getOwnPropertyDescriptor(mr.prototype,"unmuteLocal"),mr.prototype),mr);function Cu(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}let Sd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var I$,A$,P$,O$,k$,N$,D$,x$,L$,M$,U$,Or;function V$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function iO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?V$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):V$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let sye=(I$=bd(Sd.SEND_ONLY),A$=bd(Sd.SEND_ONLY),P$=bd(),O$=bd(Sd.RECEIVE_ONLY),k$=bd(Sd.RECEIVE_ONLY),N$=bd(Sd.RECEIVE_ONLY),D$=bd(Sd.RECEIVE_ONLY),x$=bd(Sd.RECEIVE_ONLY),L$=bd(Sd.RECEIVE_ONLY),M$=bd(),U$=bd(Sd.RECEIVE_ONLY),Or=class extends Nr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(kt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Hn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Hn.Connected)return void c(new xe(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(s);if(_.length===0)return void o();const E=_.find(k=>k[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:G}]=k;return G}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(_);await ar(this,kt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?Mm.MUTE_LOCAL_VIDEO:Mm.MUTE_LOCAL_AUDIO;await ar(this,kt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Hn.Connected)return void c(new xe(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),_=s.trackMediaType==="video"?Mm.UNMUTE_LOCAL_VIDEO:Mm.UNMUTE_LOCAL_AUDIO;await ar(this,kt.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==s||this.state!==Hn.Connected)return void o();const{id:E,track:S}=_;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(kt.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Hn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==Hn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===$e.LocalVideoTrack&&Dn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ut((P,k)=>{this.handleReplaceTrack(S.track,P,k,!0)})}}o()}catch(E){c(E)}finally{var _;(_=h)===null||_===void 0||_()}}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new n9(t),this.bindStatsUploaderEvents(),this.sendMutex=new Vs("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Vs("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new R$(t,this.store,Oo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Hn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new R$(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new xe(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Hn.Connected}async addRemoteCandidate(t,r){if(r===Oo.RECEIVE_ONLY){if(!this.sendConnection)throw new xe(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new xe(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var o=this;return vl(function*(){const c=yield Cn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Hn.Connected){o.throwIfTrackTypeNotMatch(t);const E=t.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,Bs.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(t,r,s);if(u.length===0)return void(yield Cn(o.tryToUnmuteAudio(t)));u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield Cn(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield Cn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(E){throw h.throw(E),(E==null?void 0:E.code)===X.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),E}yield Cn(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Hn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!st(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Hn.Connected)return s&&s[1].track.close(),o;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Xme(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{ar(this,kt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{ar(this,kt.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return vl(function*(){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ps(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,o){var c;if(!this.recvConnection)throw new xe(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),o);r===_t.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new Kv(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new $v(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const _=this.remoteUserMap.get(t);_?_.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===t.uid&&r===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(kt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,o){if(!this.recvConnection)throw new xe(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),o)}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(u=>{let{kind:h}=u;var m;if(h===_t.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===_t.VIDEO){var _;(_=t._videoTrack)===null||_===void 0||_._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,E;if(m===_t.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===_t.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===_t.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;ar(this,kt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[_t.VIDEO,_t.AUDIO].forEach(o=>{s.has(o)?ar(this,kt.RequestP2PUnmuteRemote,o):ar(this,kt.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new xe(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===_t.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get($e.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Ni){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===$e.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(_=>_ instanceof Gr),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(_=>_ instanceof Er);Rt.publish(this.store.sessionId,{eventElapse:Bs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(lr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===_t.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===_t.VIDEO,audio:o===_t.AUDIO,peerid:s.uid,subscribeRequestid:o===_t.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Bs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Vs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Vs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get($e.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ni){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Hn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get($e.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get($e.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Er||r&&r.track instanceof Gr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(zc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get($e.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=sT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Hn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case $e.LocalVideoTrack:st(r=o._hints).call(r,lr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ni?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(zc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(kt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Bm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,o;if(t===Oo.SEND_ONLY){if(!this.sendConnection)throw new xe(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new xe(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Ps(this,kt.RequestP2PRestartICE,{direction:Oo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalAudioTrack),o=t.videoSend.find(k=>{var G;return k.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(k=>{var G;return k.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const u=Bc(this,kt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,E=(_&&u?(_+u)/2:_||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(lr.SCREEN_TRACK)===-1){const k=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(k&&G){const U=(1e3*k-G)/(1e3*k);return jG[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const _=Bc(this,kt.NeedSignalRTT),E=t.rtt,S=(E&&_?(E+_)/2:E||_)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let k=.7*P*100/50+.3*S/1500;R&&(k=.6*P*100/50+.2*S/1500+.2*R/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ut((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const o=[],c=Dn(),u=this.getAllTracks();t=Dv(t=t.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of t){if(_ instanceof Er&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(_,s);o.push({track:E,type:$e.LocalVideoLowTrack})}if(_ instanceof Gr){const E=this.localTrackMap.get($e.LocalAudioTrack);if(E){if(!(E.track instanceof Ni))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===$e.LocalAudioTrack});if(!(S.track instanceof Ni))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ni||_._bypassWebAudio)o.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ni;S.addAudioTrack(_),o.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Dv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof Gr){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ni?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([$e.LocalAudioTrack,c]),c.track.close())):r.push([$e.LocalAudioTrack,c])}if(o instanceof Er){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;r.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&r.push([$e.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.addListener(Et.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Ni?t.trackList.forEach(s=>{s.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Et.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case $e.LocalVideoTrack:s.off(Et.GET_STATS,this.handleGetLocalVideoStats),s.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Et.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Et.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Ni?t.trackList.forEach(r=>{r.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Et.GET_STATS,this.handleGetLocalAudioStats),r.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Et.GET_STATS,this.handleGetLocalAudioStats),t.off(Et.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Et.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Et.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Et.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Et.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof $v&&r.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Kv&&r.addListener(Et.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Et.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(_t.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(_t.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,{track:h,type:m}=s;switch(m){case $e.LocalAudioTrack:u=$n.Audio;break;case $e.LocalVideoTrack:u=st(c=h._hints).call(c,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:u=$n.Low}return{kind:m===$e.LocalAudioTrack?_t.AUDIO:_t.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(kt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),st(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await ds(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Vr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Bv.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_AUDIO_DECODE,Ar.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_AUDIO_RECEIVED,Ar.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(zc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Ki.FIRST_VIDEO_RECEIVED,Ar.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(kt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Vm(s))," -> ").concat(JSON.stringify(Vm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Vm(s))," -> ").concat(JSON.stringify(Vm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(kt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Oo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Oo.SEND_ONLY?this.restartICE(t):Ps(this,kt.RequestP2PRestartICE,{direction:Oo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Gr&&(s==null?void 0:s.track)instanceof Ni)return s.track.isActive||r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get($e.LocalAudioTrack);if(t instanceof Gr&&(s==null?void 0:s.track)instanceof Ni)return s.track.isActive&&r.push([$e.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===$e.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&r.push([$e.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case $e.LocalAudioTrack:o=$n.Audio;break;case $e.LocalVideoTrack:o=st(s=u._hints).call(s,lr.SCREEN_TRACK)?$n.Screen:$n.High;break;case $e.LocalVideoLowTrack:o=$n.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case _t.VIDEO:return void(o._videoSSRC&&r.push({stream_type:_t.VIDEO,ssrcId:o._videoSSRC}));case _t.AUDIO:return void(o._audioSSRC&&r.push({stream_type:_t.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get($e.LocalVideoTrack),s=this.localTrackMap.get($e.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Gr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await ar(this,kt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(kt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(kt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ds(Jx(this.dtlsFailedCount,Ci)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Er)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Er).length>1)throw new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Gr).length>1&&(t.some(r=>r instanceof Gr&&r._bypassWebAudio)||!Dn().webAudioMediaStreamDest))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Er&&this.pendingLocalTracks.some(s=>s instanceof Er))throw new xe(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Gr&&this.pendingLocalTracks.some(s=>s instanceof Gr)&&(!Dn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Gr&&s._bypassWebAudio)))throw new xe(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&Dn().supportDualStreamEncoding,o=iO(iO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():oM(t,o);const u=cr(8,"track-low-"),h=new Er(c,iO(iO({},s&&{scaleResolutionDownBy:WL(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(M_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Fv.LOW_STREAM)}),h._hints.push(lr.LOW_STREAM),t.addListener(Et.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(zc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Ki.FIRST_VIDEO_DECODE,Ar.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Bs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new xe(X.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new xe(X.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new xe(X.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new xe(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new xe(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new xe(X.NOT_SUPPORTED)}async preConnect(t){throw new xe(X.NOT_SUPPORTED)}getEstablishParams(){throw new xe(X.NOT_SUPPORTED)}async reSubscribe(t){throw new xe(X.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new xe(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===$e.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Fv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},bt(Or.prototype,"p2pConnect",[I$],Object.getOwnPropertyDescriptor(Or.prototype,"p2pConnect"),Or.prototype),bt(Or.prototype,"unpublish",[A$],Object.getOwnPropertyDescriptor(Or.prototype,"unpublish"),Or.prototype),bt(Or.prototype,"unpublishLowStream",[P$],Object.getOwnPropertyDescriptor(Or.prototype,"unpublishLowStream"),Or.prototype),bt(Or.prototype,"subscribe",[O$],Object.getOwnPropertyDescriptor(Or.prototype,"subscribe"),Or.prototype),bt(Or.prototype,"mockSubscribe",[k$],Object.getOwnPropertyDescriptor(Or.prototype,"mockSubscribe"),Or.prototype),bt(Or.prototype,"unsubscribe",[N$],Object.getOwnPropertyDescriptor(Or.prototype,"unsubscribe"),Or.prototype),bt(Or.prototype,"muteRemote",[D$],Object.getOwnPropertyDescriptor(Or.prototype,"muteRemote"),Or.prototype),bt(Or.prototype,"unmuteRemote",[x$],Object.getOwnPropertyDescriptor(Or.prototype,"unmuteRemote"),Or.prototype),bt(Or.prototype,"hasRemoteMediaWithLock",[L$],Object.getOwnPropertyDescriptor(Or.prototype,"hasRemoteMediaWithLock"),Or.prototype),bt(Or.prototype,"disconnectForReconnect",[M$],Object.getOwnPropertyDescriptor(Or.prototype,"disconnectForReconnect"),Or.prototype),bt(Or.prototype,"remoteMediaSsrcChanged",[U$],Object.getOwnPropertyDescriptor(Or.prototype,"remoteMediaSsrcChanged"),Or.prototype),Or);function bd(t){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case Sd.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_()}}case Sd.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{_(),E()}}}},o}}class ry extends Nr{constructor(r,s){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===hr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,u){var h,m,_;if(this.userMap.size===0)return;const E=Array.from(Fc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:cr(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(E)};re("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(jt.DATA_STREAM,{payload:Dm(this.encoder.encode(P))})});const R=new ut((P,k)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Qv.ABORT,j),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?k(new xe(X.INVALID_REMOTE_USER)):k(new xe(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{G&&window.clearTimeout(G),this.off(Qv.ABORT,j),o&&P()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new xe(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(Qv.ABORT,j),this.once("res-@".concat(c,"_ack"),U);const q=(le,ye)=>{Y=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),U),this.off(Qv.ABORT,j),le==="success"?P(ye):k(new xe(X.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),ds(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===X.TIMEOUT)return await this.send(r,s,o,c,u);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==oi.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(_n.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,R=(h=c.get(E))!==null&&h!==void 0?h:[];if(R.push(r),c.has(E)||c.set(E,R),R.length!==S)return;{const P=sT(R).call(R,(k,G)=>k.index-G.index).map(k=>k.payload).join("");c.delete(E),(r=JSON.parse(P))._uid=o}}const{_type:m,token:_}=r;if(st(s=[oi.ACK,oi.CHECK]).call(s,m))return m===oi.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(r);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:cr(6,""),token:this.token,_type:oi.CHECK};re("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(jt.DATA_STREAM,{payload:Dm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:oi.ACK,token:this.token};re("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(jt.DATA_STREAM,{payload:Dm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(oi.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=E;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===_&&(this.receiveMessage(r),h.delete(_),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:u}=r;if(re("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==oi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(o,h,u);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:h.uid=u,Ps(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case oi.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(s),m?"success":"failed",_);break}}}}splitMessage(r){if(r.length<ry.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=cr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const _={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>ry.MAX_MESSAGE_SIZE?h-=50:(s.push(_),r=r.slice(h))}return s.map(_=>JSON.stringify(_))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ps(this.signal,oi.CALL,void 0),s=await this.send(oi.CALL,r);this.signal.emit(zt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(Qv.ABORT),this.signal.emit(_n.ON_USER_OFFLINE,{uid:o.uid,reason:wme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=cr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Qv.ABORT)}}K(ry,"MAX_SIZE",1),K(ry,"MAX_MESSAGE_SIZE",1024);class oye extends Nr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===hr.CONNECTED?this.emit(zt.WS_CONNECTED):r===hr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===hr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",hr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new p8(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case _n.ON_DATA_STREAM:return void this.handleDataStream(c._message);case _n.MUTE_AUDIO:case _n.MUTE_VIDEO:case _n.ON_P2P_LOST:case _n.ON_USER_ONLINE:return;case _n.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===_n.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===_n.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Gn.UID_BANNED);break;case 15:this.close(Gn.IP_BANNED);break;case 16:this.close(Gn.CHANNEL_BANNED)}if(c._type===_n.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case xt.ERR_LICENSE_MISSING:this.close(Gn.LICENSE_MISSING);break;case xt.ERR_LICENSE_EXPIRED:this.close(Gn.LICENSE_EXPIRED);break;case xt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Gn.LICENSE_MINUTES_EXCEEDED);break;case xt.ERR_LICENSE_PERIOD_INVALID:this.close(Gn.LICENSE_PERIOD_INVALID);break;case xt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Gn.LICENSE_MULTIPLE_SDK_SERVICE);break;case xt.ERR_LICENSE_ILLEGAL:this.close(Gn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new jL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===hr.CONNECTED&&this.reconnect("retry",As.OFFLINE)}),this.p2pToken=cr(6,""),this._external_signal=new ry(this,this.p2pToken)}async request(r,s,o,c){const u=cr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,_=()=>new ut((G,U)=>{if(this.connectionState===hr.CONNECTED)return G();const j=()=>{this.off(zt.WS_CLOSED,q),G()},q=()=>{this.off(zt.WS_CONNECTED,j),U(new xe(X.WS_ABORT))};this.once(zt.WS_CONNECTED,j),this.once(zt.WS_CLOSED,q)});if(this.connectionState!==hr.CONNECTING&&this.connectionState!==hr.RECONNECTING||r===jt.JOIN||r===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const E=new ut((G,U)=>{let j=!1;const q=(le,ye)=>{j=!0,G({isSuccess:le==="success",message:ye||{}}),this.off(zt.WS_CLOSED,Y),this.off(zt.WS_RECONNECTING,Y),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),q);const Y=()=>{U(new xe(X.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,Y),this.off(zt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(zt.WS_CLOSED,Y),this.once(zt.WS_RECONNECTING,Y),ds(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(G){if(this.connectionState===hr.CLOSED||r===jt.LEAVE)throw new xe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===jt.JOIN||r===jt.REJOIN?null:(await _(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=kT(R),k=new xe(X.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===xt.ERR_TOO_MANY_BROADCASTERS?((r===jt.JOIN||r===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):P.action==="failed"?k.throw():P.action==="quit"?(this.initError=k,this.close(),k.throw()):(R===xt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",As.MULTI_IP)):this.reconnect(P.action,As.SERVER_ERROR),r===jt.JOIN||r===jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ut(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(PT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==hr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,()=>o(this.initError||new xe(X.WS_ABORT))),this.connectionState=hr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Gn.LEAVE,this.connectionState=hr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=cr(6,""),this._external_signal.clear(),this._external_signal=new ry(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await Ps(this,zt.REQUEST_JOIN_INFO),s=await this.request(jt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=hr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=D_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||st(s=Object.values(oi)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(_n.ON_DATA_STREAM,r)}catch{this.emit(_n.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=kT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Gn.UID_BANNED),void this.close()):void this.reconnect(s.action,As.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=re("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",As.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Jt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Jt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Jt.CLOSED,()=>{this.connectionState=hr.CLOSED}),this.websocket.on(Jt.FAILED,()=>{this._disconnectedReason=Gn.NETWORK_ERROR,this.connectionState=hr.CLOSED}),this.websocket.on(Jt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===hr.CONNECTED?this.connectionState=hr.RECONNECTING:this.connectionState=hr.CONNECTING}),this.websocket.on(Jt.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Jt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof xe&&r.code===X.UNEXPECTED_RESPONSE&&r.data.code===xt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",As.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",As.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Jt.REQUEST_NEW_URLS,(r,s)=>{Ps(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const aye={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new sye(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new oye(s,r)}};function F$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function j$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):F$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class cye{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=Fr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:E}=r,S=Ma(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Fr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let k=u.videoCodecs.filter(G=>{var U,j;return(U=G.rtpMap)===null||U===void 0?void 0:st(j=U.encodingName.toLowerCase()).call(j,_)});k.length===0&&(k=u.videoCodecs),P.attributes.payloads=k,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return xm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:u}=z_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===_t.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{st(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;st(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(j$(j$({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case js.TCP_RELAY:this.candidates=o;break;case js.UDP_TCP_RELAY:case js.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Fr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=Fr(r);return tS(o,s),GL(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===_t.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(s,o))}}mungMediaDesc(r){const s=Fr(r);return zL(s),function(o){const c=o.attributes.extmaps.find(u=>vP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var or;function B$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?B$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):B$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let lye=(or=class qw extends XG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return st(s=Object.keys(YA)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=s,this.mutex=new Vs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(qw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=rL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Mr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Fm(r.sdp),o=xT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,sO(sO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new xe(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cye(sO(sO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new xe(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return vl(function*(){const c=yield Cn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Cn(o.peerConnection.createOffer()),m=Ma(h.sdp),_=r.map(P=>{const k=P._mediaStreamTrack,G=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,j,q){const Y=U.attributes.ssrcs.filter(ye=>ye.attributes.label===j),le=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&Y.length>1){const ye=le.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:q?ye.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(G,k.id,o.useRTX)});let E;try{E=yield _}catch(P){throw u.forEach(k=>{Is()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,E);const R=o.remoteSDP.toString();return yield Cn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Cn(o.applySendEncodings(u,r)),yield Cn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,k)=>{const G=P._mediaStreamTrack.id;return{localSSRC:_[k],id:G}})}catch(u){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{Is()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new ut((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=G=>{const U=Rn();if((U.name==="Safari"&&Number(U.version)===11||Io())&&G.track.id!==u&&G.streams[0].id===h){var j;const q=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(q)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(Is()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(Is()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return vl(function*(){const o=yield Cn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Dn().supportPCSetConfiguration;if(r===js.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),S=r===js.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,s.peerConnection.setConfiguration(E))}r!==js.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield Cn(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Fm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const _=s.remoteSDP.toString();yield Cn(s.peerConnection.setLocalDescription(u)),yield Cn(s.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new xe(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new xe(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(ST(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...qw.turnServerConfigToIceServers(r.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...qw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Dn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Er)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Yf()){var h;const E=re("DSCP_TYPE");st(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=s.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Dn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Ma(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&tS(m,c)}),xm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:E}=r[h];return new ut((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=G=>{const U=Rn();if(U.name==="Safari"&&Number(U.version)===11&&G.track.id!==m&&G.streams[0].id===_){var j;const q=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:q,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ut.all(s)}catch(s){throw new xe(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Dn().supportPCSetConfiguration){const s=qw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},bt(or.prototype,"connect",[Al],Object.getOwnPropertyDescriptor(or.prototype,"connect"),or.prototype),bt(or.prototype,"stopSending",[Al],Object.getOwnPropertyDescriptor(or.prototype,"stopSending"),or.prototype),bt(or.prototype,"receive",[Al],Object.getOwnPropertyDescriptor(or.prototype,"receive"),or.prototype),bt(or.prototype,"stopReceiving",[Al],Object.getOwnPropertyDescriptor(or.prototype,"stopReceiving"),or.prototype),bt(or.prototype,"muteRemote",[Al],Object.getOwnPropertyDescriptor(or.prototype,"muteRemote"),or.prototype),bt(or.prototype,"unmuteRemote",[Al],Object.getOwnPropertyDescriptor(or.prototype,"unmuteRemote"),or.prototype),bt(or.prototype,"muteLocal",[Al],Object.getOwnPropertyDescriptor(or.prototype,"muteLocal"),or.prototype),bt(or.prototype,"unmuteLocal",[Al],Object.getOwnPropertyDescriptor(or.prototype,"unmuteLocal"),or.prototype),bt(or.prototype,"close",[Al],Object.getOwnPropertyDescriptor(or.prototype,"close"),or.prototype),bt(or.prototype,"updateEncoderConfig",[Al],Object.getOwnPropertyDescriptor(or.prototype,"updateEncoderConfig"),or.prototype),bt(or.prototype,"updateSendParameters",[Al],Object.getOwnPropertyDescriptor(or.prototype,"updateSendParameters"),or.prototype),bt(or.prototype,"replaceTrack",[Al],Object.getOwnPropertyDescriptor(or.prototype,"replaceTrack"),or.prototype),bt(or.prototype,"getRemoteSSRC",[Al],Object.getOwnPropertyDescriptor(or.prototype,"getRemoteSSRC"),or.prototype),or);function Al(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},s}const uye={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new lye(s,r)}},dye={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(iP.has(t)||!t.track)return;const s={track:t.track};if(qf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const _=r.metadata&&r.metadata();_?function(E,S){const{chunk:R,controller:P}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?Zf.AUDIO_64_BIT_PTS:Zf.METADATA;R.data=function(G,U,j){const q=j.byteLength,Y=q+IL+xG,le=CL+RL+Y,ye=new ArrayBuffer(G.byteLength+le),Ee=new DataView(ye);Ee.setUint8(0,DG),Ee.setUint16(1,Y),Ee.setUint8(3,U),Ee.setUint16(4,q);for(let ke=0;ke<q;ke++)Ee.setUint8(6+ke,j[ke]);const ge=new Uint8Array(Ee.buffer);return ge.set(new Uint8Array(G),le),ge.buffer}(R.data,k,E),P.enqueue(R)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=rP(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=iP.get(t);if(c){iP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}iP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(uP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(qf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");Fx(Fn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)),r.enableTopn?function(_,E,S){var R;const P=LG(new DataView(E.data));if(!P)return S.enqueue(E);const k=_.track.id;Hpe.set(k,_.track);const G=(R=P.tlv.find(ye=>ye.tag===Zf.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let U=0;typeof G=="number"&&(U=127-G);const j=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(ye,Ee){let ge=qv.get(ye);if(ge||(ge=function(ke){const qe=new UG;return qv.set(ke,qe),gd||(gd=new zpe(re("TOPN_SILENCE_THRESHOLD")||500),gd.on("ActiveSpeakerChanged",dt=>{dt!=null&&(aP=dt)})),gd.addSpeakers([qe]),qe}(ye)),qv.size<=VG)return{selected:!0,speaker:ge};if(!gd)throw new Error("no active speaker detector");return gd.levelChanged(ge.id,Ee),j_=gd.loudest.map(ke=>ke.id),aP&&!st(j_).call(j_,aP)&&j_.length>=VG&&j_.pop(),{selected:st(j_).call(j_,ge.id)||ge.id===aP,speaker:ge}}(_,j),le=function(ye,Ee,ge){const ke=_d.get(ye)||new Gpe(ye,Ee);return ke.score=ge,_d.set(ye,ke),function(qe){if(cP.set(qe,!0),!lP)return void(lP=Date.now());const dt=Date.now();dt-lP>1e3&&(cP.get(qe)?cP.set(qe,!1):(FG(qe),cP.delete(qe)),lP=dt)}(ye),ke}(k,_.track,Y.energyScore);le.addSample(q),le.active&&(E.data=P.frame.buffer,S.enqueue(E))}(t,h,m):r.enableMetadata?function(_,E,S){const R=LG(new DataView(_.data));if(!R)return E.enqueue(_);const P=R.tlv.find(k=>k.tag===Zf.METADATA||k.tag===Zf.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),_.data=R.frame.buffer,E.enqueue(_)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=rP(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){t.track.removeEventListener("ended",o),function(c){const u=uP.get(c);if(u){(function(_){const E=qv.get(_);E&&(qv.delete(_),gd&&(gd.removeSpeakers([E]),qv.size===0&&(gd.destroy(),gd=null)))})(c),FG(c.track.id),uP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){x.warning(_&&_.message)}}}(t)}uP.set(t,s),t.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(t,r){if(!Dn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(dP.has(t)||!t.track)return;const s={track:t.track};if(qf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){s.controller||(s.controller=_),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const E=u.shift();E&&(m.data=function(S,R){const P=function(Y){const le=Y.length;let ye=[],Ee=0;for(;Ee<le;)Ee+2<le&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(ye.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(ye.push(Y[Ee]),Ee++);return new Uint8Array(ye)}(R),k=P.length,G=Math.floor(k/255),U=k%255,j=new Uint8Array(6+G+1+k+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let q=0;for(;q<G;)j[6+q]=255,q++;return j[6+q]=U,q++,j.set(P,6+q),j.set(new Uint8Array(S),6+q+k),j.buffer}(m.data,E)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Is())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=rP(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=dP.get(t);if(c){dP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}dP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Dn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(AT.has(t)){const c=AT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(qf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const _=function(E){const S=new DataView(E.data);let R=0;for(;R+4<E.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,k=0,G=0;for(;(G=S.getUint8(P++))===255;)k+=255;k+=G;const U=$pe(E.data,P,k);return new Uint8Array(U)}R++}return null}(h);_&&s.onSei&&s.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Is()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=rP(),u=new MessageChannel;await new ut(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new ut(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&t.track&&((_=t.track)===null||_===void 0?void 0:_.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(c){const u=AT.get(c);if(u){AT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){x.warning(_&&_.message)}}})(t)}AT.set(t,s),t.track.addEventListener("ended",o)}},hye={name:"InterceptFrame",create:()=>dye};iL(),Qn("PROCESS_ID","process-".concat(cr(8,""),"-").concat(cr(4,""),"-").concat(cr(4,""),"-").concat(cr(4,""),"-").concat(cr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(yr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;md[o]=c,yr[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(md.AREAS)&&md.AREAS.length>0&&YL(md.AREAS,!0);const W$=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),Qn(t,r,s)};jm(L_e,!1),jm(V_e,!1),jm(_ge,!1),jm(Y_e,!1),jm(N_e,!1),jm(aye,!1),jm(uye,!1),jm(hye,!1);const Ri=function(t){const r=new Nr,s=t,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===bh.SECURITY_POLICY_VIOLATION&&b7(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return S7(S7({},s),o)}({__TRACK_LIST__:Vv,VERSION:Sl,BUILD:aL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:W$,getParameter:re,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return Dn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(X.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Rt.reportApiInvoke(null,{name:wi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Vr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&zx()&&zW(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const o=Rn();o.name===Fn.CHROME&&Number(o.version)>=58&&(fd.engine.name!=="WebKit"||function(){const u=Rn();if(jA()){if(u.os===$i.MAC_OS)return!0;if(u.os===$i.IOS){const h=fd.os.version&&fd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Fn.FIREFOX&&Number(o.version)>=56||o.name===Fn.OPERA&&Number(o.version)>=45||o.name===Fn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Io()||pu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||YW()||Rn().name===Fn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return qc.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return qc.getRecordingDevices(t)},getCameras:function(t){return qc.getCamerasDevices(t)},getElectronScreenSources:z8,getPlaybackDevices:function(t){return qc.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=cr(5,"client-"),o=Rt.reportApiInvoke(null,{id:s,name:wi.CREATE_CLIENT,options:[r],tag:Vr.TRACER});try{(function(c){Mi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Mi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Mi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&us(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&r8(c.turnServer),c.httpRetryConfig!==void 0&&n8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&n8(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(HW(16,0)||$W(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),Qn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new yge(bu(bu({forceWaitGatewayResponse:!0},r),{},{role:st(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=re("CAMERA_CAPTURE_CONFIG"),s=cr(8,"track-cam-"),o=Rt.reportApiInvoke(null,{id:s,tag:Vr.TRACER,name:wi.CREATE_CAM_VIDEO_TRACK,options:[Pr({},t),r]});r&&(t.encoderConfig=r);const c=tP(t);let u=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{u=(await Kc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new xe(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}t.optimizationMode&&wL(s,u,t,Eh(t.encoderConfig));const h=new TL(u,t,c,t.scalabiltyMode?JA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=cr(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:wi.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),o=new Er(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?JA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[lr.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",t,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return Z8(P)}(r):void 0;s&&(r="auto");const o=cr(8,"track-scr-v-"),c=Rt.reportApiInvoke(null,{id:o,tag:Vr.TRACER,name:wi.CREATE_SCREEN_VIDEO_TRACK,options:[Pr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(P){const k={};P.screenSourceType&&(k.mediaSource=P.screenSourceType),P.extensionId&&qf()&&(k.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:U,surfaceSwitching:j,systemAudio:q,preferCurrentTab:Y}=P;(_T(107)||jx(107)||Bx(93))&&(G&&(Mi(G,"displaySurface",["browser","window","monitor"]),k.displaySurface=G),U?(Mi(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",j&&(Mi(j,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=j)),(_T(105)||jx(105)||Bx(91))&&q&&(Mi(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(_T(94)||jx(94)||Bx(80))&&Y&&(k.preferCurrentTab=!0),P.electronScreenSourceId&&(k.sourceId=P.electronScreenSourceId);const le=P.encoderConfig?hL(P.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(k.mandatory.maxFrameRate=le.frameRate,k.mandatory.minFrameRate=le.frameRate):(k.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,k.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),k.frameRate=le.frameRate),le.width&&(k.width=le.width),le.height&&(k.height=le.height)),k}(t);let h=null,m=null;const _=Dn();if(!_.supportShareAudio&&r==="enable"){const P=new xe(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",o);const E=_.supportShareAudio&&r!=="disable";try{const P=await Kc({screen:u,screenAudio:E?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new xe(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new xe(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(wL(o,h,t,t.encoderConfig&&hL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const S=new Er(h,t.encoderConfig?hL(t.encoderConfig):{},t.scalabiltyMode?JA(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[lr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Gr(m,void 0,cr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=re("CAMERA_CAPTURE_CONFIG"),o=cr(8,"track-mic-"),c=cr(8,"track-cam-"),u=Rt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Vr.TRACER,name:wi.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=tP(r),m=ez(t);let _=null,E=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await Kc({audio:m,video:h},"".concat(o,"-").concat(c));_=P.getAudioTracks()[0],E=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!_||!E){const P=new xe(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&wL(c,E,r,Eh(r.encoderConfig));const S=new nP(_,t,m,o),R=new TL(E,r,h,r.scalabiltyMode?JA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=cr(8,"track-mic-"),s=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:wi.CREATE_MIC_AUDIO_TRACK,options:[t]}),o=ez(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Kc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new xe(X.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new nP(c,t,o,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(t){const r=cr(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:Vr.TRACER,name:wi.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),o=new Gr(t.mediaStreamTrack,t.encoderConfig?QA(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:o}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=cr(8,"track-buf-"),m=Rt.reportApiInvoke(null,{id:h,tag:Vr.TRACER,name:wi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new xe(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let k=null;if(typeof R=="string"){const U=jz.get(R);if(U)return x.debug("use cached audio resource: ",R),U;try{k=(await pd(()=>ia.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new xe(X.FETCH_AUDIO_FILE_FAILED,j.toString())}}else k=await new ut((j,q)=>{const Y=new FileReader;Y.onload=le=>{le.target?j(le.target.result):q(new xe(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new xe(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(R)});const G=await function(U){const j=Gv();return new ut((q,Y)=>{j.decodeAudioData(U,le=>{q(le)},le=>{Y(new xe(X.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(k);return typeof R=="string"&&P&&jz.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const E=new Vpe(c),S=new Upe(_,E,o?QA(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",t);Qn("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){re("USE_NEW_LOG")?Qn("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Qn("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new jH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:wi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Gr||t instanceof Kv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Gr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ut(_=>{const E=setInterval(()=>{const S=t.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(E);const k=R,G={duration:P,deviceLabel:o,maxVolumeLevel:u,result:k};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),_(k)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:Vr.TRACER,name:wi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Er||t instanceof $v)){const R=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Er?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Is()||jA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const R=Date.now();m=await function(P,k,G,U){let j,q=0,Y=null;return new ut((le,ye)=>{function Ee(){q>U&&j&&(j(),le(q));const ge=G.getContext("2d");if(!ge){const dt=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(dt.toString()),void ye(dt)}ge.drawImage(P,0,0,160,120);const ke=ge.getImageData(0,0,G.width,G.height),qe=Math.floor(ke.data.length/3);if(Y){for(let dt=0;dt<qe;dt+=3)if(ke.data[dt]!==Y[dt])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{j&&(j(),le(q))},k),j=_L(()=>{Ee()},30)})}(u,r,h,4),_=Date.now()-R}catch(R){throw s.onError(R),R}rge===Fn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:E};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),E},setArea:YL,audioElementPlayCenter:sa,resumeAudioContext:function(){sa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){vge.processExternalMediaAEC(t)},registerExtensions:function(t){const r=re("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!st(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=Rt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),W$("PLUGIN_INFO",r)},ChannelMediaRelayError:Xv,ChannelMediaRelayEvent:tp,ChannelMediaRelayState:Ua,RemoteStreamFallbackType:Ope,RemoteStreamType:Ppe,ConnectionDisconnectedReason:Gn,AudienceLatencyLevelType:ope,AREAS:jn,preload:async function(t,r,s,o){return f9(t,r,s,o)}});return Object.defineProperties(Ri,{onAudioAutoplayFailed:{get:()=>Yc.onAudioAutoplayFailed,set:t=>{Yc.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Yc.onAutoplayFailed,set:t=>{Yc.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ri._onSecurityPolicyViolation,set(t){Ri._onSecurityPolicyViolation=t,b7(t)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?B_:[]}}),qc.on(U_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Ri.onCameraChanged&&Ri.onCameraChanged(t),Ri.safeEmit(bh.CAMERA_CHANGED,t)}),qc.on(U_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Ri.onMicrophoneChanged&&Ri.onMicrophoneChanged(t),Ri.safeEmit(bh.MICROPHONE_CHANGED,t)}),qc.on(U_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Ri.onPlaybackDeviceChanged&&Ri.onPlaybackDeviceChanged(t),Ri.safeEmit(bh.PLAYBACK_DEVICE_CHANGED,t)}),sa.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),Yc.onAudioAutoplayFailed&&Yc.onAudioAutoplayFailed()},Zn.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),Yc.onAudioAutoplayFailed&&Yc.onAudioAutoplayFailed(),Ri.safeEmit(bh.AUTOPLAY_FAILED)}),Zn.on(fs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Ri.onAudioContextStateChanged&&Ri.onAudioContextStateChanged(t,r),Ri.safeEmit(bh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),pi.on(Nv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ri),Ri})}(Ek)),Ek.exports}var wWe=TWe();const zC=Gy(wWe),CWe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc"},Soe="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Soe);console.log("AgoraProvider: import.meta.env:",CWe);const RWe=zC.createClient({mode:"rtc",codec:"vp8"});let Aw=null;const boe=D.createContext(null),Toe=({children:n,appId:e=Soe,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:y=()=>{}})=>{console.log("AgoraProvider: appId prop:",e);const[v,b]=D.useState(!1),[w,A]=D.useState(!1),[N,V]=D.useState([]),[F,B]=D.useState(null),[W,J]=D.useState(null),[$,te]=D.useState(null),[ce,oe]=D.useState(!1),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1),[se,fe]=D.useState(null),[pe,ue]=D.useState(!1),Me=Gl(),He=D.useRef(RWe),nt=D.useRef({appId:e,channel:i,uid:l,enabled:d}),we=D.useRef(!1),Re=D.useRef(null);D.useRef(null),D.useEffect(()=>{nt.current={appId:e,channel:i,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:e,channel:i,uid:l,enabled:d})},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:e,channel:i,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",i),J(i)},[i]),D.useEffect(()=>{if(!He.current)return;const tt=ht=>{console.log(`Connection state changed to: ${ht}`),ht==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):ht==="CONNECTED"&&(b(!0),B(null))};return He.current.on("connection-state-change",tt),()=>{He.current.off("connection-state-change",tt)}},[]),D.useEffect(()=>{if(!i||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:i,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",i,"with UID",l);const tt=async(Lt,nn)=>{console.log("AgoraProvider: User published:",Lt.uid,nn);try{await He.current.subscribe(Lt,nn),console.log("AgoraProvider: Subscribed to user:",Lt.uid,"mediaType:",nn),nn==="audio"&&(Lt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Lt.uid)),V(kn=>kn.some(Kt=>Kt.uid===Lt.uid)?kn:[...kn,Lt])}catch(kn){console.error("AgoraProvider: Error subscribing to user:",kn)}},ht=(Lt,nn)=>{console.log("AgoraProvider: User unpublished:",Lt.uid,nn),nn==="audio"&&Lt.audioTrack&&(Lt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Lt.uid))},Ze=Lt=>{console.log("AgoraProvider: User joined:",Lt.uid),V(nn=>nn.some(kn=>kn.uid===Lt.uid)?nn:[...nn,Lt])},Ct=Lt=>{console.log("AgoraProvider: User left:",Lt.uid),V(nn=>nn.filter(kn=>kn.uid!==Lt.uid))};He.current.on("user-published",tt),He.current.on("user-unpublished",ht),He.current.on("user-joined",Ze),He.current.on("user-left",Ct);const un=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Re.current===i){console.log("AgoraProvider: Already joined to channel",i),oe(!0),y(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Re.current&&Re.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(Lt){console.error("AgoraProvider: Error leaving channel:",Lt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),oe(!0),Re.current=i,Aw=i,y(He.current);return}console.log("AgoraProvider: Joining channel",i,"current joined channel:",Re.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(Lt){console.error("AgoraProvider: Error during initialization:",Lt)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),un(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",tt),He.current.off("user-unpublished",ht),He.current.off("user-joined",Ze),He.current.off("user-left",Ct)}},[i,d,l,y,v]);const ve=async()=>{if(!d||$)return $;console.log("Initializing microphone");try{const tt=await zC.createMicrophoneAudioTrack();return await tt.setMuted(p),te(tt),console.log("Microphone initialized successfully"),tt}catch(tt){return console.error("Error initializing microphone:",tt),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(i)try{const Ct=await yg(i);Ct&&Ct.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),ue(!0),v&&await Te()):ue(!1)}catch(Ze){console.error("AgoraProvider: Error checking if voice is disabled:",Ze)}})();const ht=Ze=>{Ze.detail&&typeof Ze.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Ze.detail.voiceDisabled),ue(Ze.detail.voiceDisabled),Ze.detail.voiceDisabled&&v?Te():!Ze.detail.voiceDisabled&&!v&&d&&i&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",ht),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ht)}},[i,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!i)return console.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",i,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:_e,connectionState:He.current.connectionState,joinedChannel:Re.current}),v&&Re.current===i)return console.log("AgoraProvider: Already joined to channel:",i),!0;if(_e)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(tt){console.error("AgoraProvider: Error leaving channel:",tt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),oe(!0),Re.current=i,Aw=i,y(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),ne(!0),new Promise(tt=>{const ht=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(ht),b(!0),ne(!1),oe(!0),Re.current=i,Aw=i,y(He.current),tt(!0))},500);setTimeout(()=>{clearInterval(ht),console.log("AgoraProvider: Connection timeout, considering join failed"),ne(!1),tt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",i,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",e,"Type:",typeof e,"Length:",e.length),!e||e.trim()===""){const ht="AgoraProvider: App ID is empty or invalid";return console.error(ht),B(ht),ne(!1),!1}ne(!0);const tt=l||Math.floor(Math.random()*1e6);return await He.current.join(e,i,a,tt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),b(!0),ne(!1),oe(!0),Re.current=i,Aw=i,y(He.current),!0}catch(tt){return console.error("AgoraProvider: Error joining channel:",tt),B(`Error joining channel: ${tt.toString()}`),ne(!1),!1}},Te=async()=>{if(v)try{$&&await He.current.unpublish($),await He.current.leave(),Aw=null,Re.current=null,console.log("Left channel successfully"),b(!1),V([])}catch(tt){console.error("Error leaving channel:",tt),B(tt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&i&&(!v||Re.current!==i)&&Ne()},[d,i,v]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(tt){return console.error("Error checking microphone status:",tt),!1}};D.useEffect(()=>{const tt=()=>{const Ze=be();Ze!==w&&(console.log("Syncing microphone state:",{actualStatus:Ze,currentState:w}),A(Ze),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ze}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ze,window.agoraClient.microphoneTrack=$))};$&&tt();const ht=setInterval(tt,1e3);return()=>{clearInterval(ht)}},[$,w]);const Ae=async()=>{var tt;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ht=w!==void 0?w:$?!$.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ht,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),ht;const Ze=!ht;if(console.log("AgoraProvider: New voice state will be:",Ze),ht){if($)try{console.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(Ct){return console.error("Error muting track:",Ct),ht}}else if($)try{He.current&&v&&!((tt=He.current.localTracks)!=null&&tt.includes($))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish($),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(Ct){return console.error("Error unmuting track:",Ct),ht}return A(Ze),Ze}catch(ht){return console.error("AgoraProvider: Error toggling voice:",ht),w}},Ue=async tt=>{try{te(tt),console.log("Microphone track updated successfully")}catch(ht){throw console.error("Error updating microphone track:",ht),ht}},Ge=async()=>{if(!He.current||!i)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ee)return console.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await He.current.unpublish(se),se.forEach(tt=>tt.close())):(await He.current.unpublish(se),se.close()),fe(null)),Q(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const tt=await zC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",tt),tt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(tt),tt.close(),fe(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(tt),fe(tt),Q(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=tt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(tt){return console.error("AgoraProvider: Error creating screen track:",tt),Q(!1),fe(null),!1}}catch(tt){return console.error("AgoraProvider: Error toggling screen share:",tt),Q(!1),fe(null),!1}};D.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const tt=Ze=>{console.log("AgoraProvider: Received ToggleScreenShare event"),Ge().then(Ct=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!0,Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1,ee)})},ht=Ze=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(Ct=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",tt),window.addEventListener("JoinVoiceChat",ht),()=>{window.removeEventListener("ToggleScreenShare",tt),window.removeEventListener("JoinVoiceChat",ht),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Qe={client:He.current,isJoined:v,isVoiceEnabled:w,users:N,error:F,channel:W,appId:e,toggleVoice:Ae,leaveChannel:Te,joinChannel:Ne,microphoneTrack:$,isReady:ce,createMicrophoneTrack:Ue,isScreenSharing:ee,screenTrack:se,toggleScreenShare:Ge,voiceDisabled:pe};return C.jsx(boe.Provider,{value:Qe,children:n})},woe=()=>{const n=D.useContext(boe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Toe.propTypes={children:_r.node.isRequired,appId:_r.string.isRequired,channel:_r.string.isRequired,token:_r.string,uid:_r.oneOfType([_r.string,_r.number])};const IWe=()=>{var we,Re;const{client:n,isVoiceEnabled:e,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:p,channel:y,appId:v,toggleVoice:b,joinChannel:w,leaveChannel:A,createMicrophoneTrack:N,isScreenSharing:V,screenTrack:F,toggleScreenShare:B,voiceDisabled:W}=woe(),[J,$]=D.useState(e!==void 0?e:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[te,ce]=D.useState(V!==void 0?V:((Re=window.agoraClient)==null?void 0:Re.isScreenSharing)||!1),[oe,_e]=D.useState(W!==void 0?W:!1),[ne,ee]=D.useState(!0);D.useEffect(()=>{var ve;e!==void 0?$(e):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[e,d]),D.useEffect(()=>{var ve;V!==void 0?ce(V):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[V]),D.useEffect(()=>{W!==void 0&&_e(W)},[W]);const Q=D.useRef({isVoiceEnabled:J,isScreenSharing:te,isJoined:i,users:a,error:l,isReady:p,channel:y,appId:v,voiceDisabled:oe});D.useEffect(()=>{Q.current={isVoiceEnabled:J,isScreenSharing:te,isJoined:i,users:a,error:l,isReady:p,channel:y,appId:v,voiceDisabled:oe}},[J,te,i,a,l,p,y,v,oe]),D.useEffect(()=>{const ve=setTimeout(()=>{ee(!1)},5e3);return()=>clearTimeout(ve)},[]),D.useEffect(()=>{p&&ee(!1)},[p]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:J,contextIsScreenSharing:V,localScreenSharing:te,isJoined:i,users:a.length,error:l,isReady:p,channel:y,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!F})},[e,J,V,te,i,a,l,p,y,v,d,F]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const ve=await b();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)$(ve);else{const Ne=!J;$(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ve!==void 0?ve:!J}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),J}},fe=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",te);const ve=await B();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)ce(ve);else{const Ne=!te;ce(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ve!==void 0?ve:!te}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),te}},pe=async()=>{J&&d&&await se()},ue=async()=>{!J&&d&&await se()},Me=ve=>a.some(Ne=>{var Te;return Ne.uid===ve&&((Te=Ne.audioTrack)==null?void 0:Te.isPlaying)}),He=D.useCallback(()=>{if(!d||!J)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,J]);return{isVoiceEnabled:J,isScreenSharing:te,isJoined:i,users:a,error:l,toggleVoice:se,toggleScreenShare:fe,mute:pe,unmute:ue,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:F,isLoading:ne,channel:y,appId:v,joinChannel:w,leaveChannel:A,client:n,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(J&&await n.unpublish(d),await d.close());const Ne=await zC.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});N&&await N(Ne),J&&await n.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:oe}},AWe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:y,joinChannel:v,channel:b,client:w,voiceDisabled:A}=IWe(),[N,V]=D.useState(!1),[F,B]=D.useState(!1);D.useEffect(()=>{const $=()=>{he.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(he.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:y,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:F,voiceDisabled:A})},[d,y,b,w,F,A]);const W=async()=>{if(!(N||A)){V(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:y});try{if(!y&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(te){te.message&&te.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",te)}console.log("VoiceButton: Toggling voice state from:",d);const $=await p();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{V(!1)}}},J=()=>A?"Voice chat is disabled for this space":F?N?"Processing...":y?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!F||A?null:C.jsx(kp,{label:J(),placement:e,hasArrow:!0,children:C.jsxs(mt,{position:"relative",cursor:"pointer",onClick:W,children:[C.jsx(jl,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?C.jsx(eF,{color:"white"}):C.jsx(ZV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&C.jsx(mt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:C.jsx(uf,{size:"sm",color:"white"})})]})})},PWe=ui.createContext({user:null}),OWe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=woe(),[p,y]=D.useState([]),[v,b]=D.useState(!1),[w,A]=D.useState(!0);D.useRef({});const N=D.useRef(null);D.useRef(null);const{user:V}=D.useContext(PWe)||{user:null},[F,B]=D.useState({}),W=D.useRef(a),[J,$]=D.useState(null),{isOpen:te,onOpen:ce,onClose:oe}=of(),[_e,ne]=D.useState(!1),ee=D.useRef(null),Q=D.useRef(null);D.useEffect(()=>{W.current=a},[a]),D.useEffect(()=>{if(!e||!i){b(!1);return}const Me=setTimeout(()=>{A(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const He=e.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")b(!0),A(!1);else{b(!1);const nt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(b(!0),A(!1)):b(!1)};return e.on("connection-state-change",nt),()=>{e.off("connection-state-change",nt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[e,i]),D.useEffect(()=>{const Me=async()=>{const He={...F};let nt=!1;for(const we of p){if(F[we.uid])continue;let Re=null,ve=we.uid;if(typeof ve=="string"&&(ve.includes("-")?(Re=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(Re=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Ne=await Ud(ve);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,nt=!0):Re?(console.log("Using extracted name for user ID:",ve,"Name:",Re),He[we.uid]=Re,nt=!0):(He[we.uid]="User",nt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Re?(He[we.uid]=Re,nt=!0):(He[we.uid]="User",nt=!0)}else Re?(He[we.uid]=Re,nt=!0):(He[we.uid]="User",nt=!0)}nt&&B(He)};p.length>0&&Me()},[p,F]),D.useEffect(()=>{if(!e||!i||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Re)=>{if(console.log("User published:",we.uid,Re,we),Re==="video"){console.log("Remote video track detected:",we.uid);try{await e.subscribe(we,Re),console.log("Subscribed to remote video track:",we.uid),y(ve=>ve.some(Ne=>Ne.uid===we.uid)?ve:[...ve,we])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},He=(we,Re)=>{if(console.log("User unpublished:",we.uid,Re),Re==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(y(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&W.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),W.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},nt=we=>{console.log("User left:",we.uid);const Re=p.find(ve=>ve.uid===we.uid);if(Re&&Re.videoTrack)try{Re.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(y(ve=>ve.filter(Ne=>Ne.uid!==we.uid)),l&&W.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),W.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return e.on("user-published",Me),e.on("user-unpublished",He),e.on("user-left",nt),()=>{e.off("user-published",Me),e.off("user-unpublished",He),e.off("user-left",nt)}},[e,i,v,p,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&W.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),W.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[p,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),D.useEffect(()=>()=>{if(p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[p,a]);const se=()=>{console.log("Stopping local screen share"),d()},fe=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&V&&(Me===V.uid||Me===(e==null?void 0:e.uid))?n||"You":F[Me]?F[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),pe=Me=>{console.log("Opening modal for remote screen",Me),$(Me),ce()},ue=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ce()};return D.useEffect(()=>{te&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&W.current)try{console.log("Playing local screen in modal"),W.current.play("modal-screen-container"),ne(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),ne(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):te||(ne(!1),$(null),setTimeout(()=>{if(l&&W.current)try{W.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}p.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[te,J,l,p]),!v||w&&p.length===0&&!l||p.length===0&&!l?null:C.jsxs(C.Fragment,{children:[!te&&C.jsxs(mt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ee,children:[l&&a&&C.jsxs(mt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[C.jsx(mt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),C.jsx(mt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(Me=>{const He=F[Me.uid]||fe(Me.uid);return C.jsxs(mt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(Me),children:[C.jsx(mt,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),C.jsx(mt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),te&&C.jsx(mt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:oe,children:C.jsxs(mt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!_e&&C.jsxs(mt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[C.jsx(uf,{size:"xl"}),C.jsx(ot,{mt:4,children:"Loading screen share..."})]}),C.jsx(mt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),C.jsx(mt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:oe,children:""}),C.jsx(mt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${F[J==null?void 0:J.uid]||fe(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&C.jsx(mt,{position:"absolute",bottom:4,right:4,children:C.jsx(Br,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},kWe=({onClose:n})=>{const e=Gl(),[i,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),w=()=>{v()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),e(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),e({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function NWe({open:n,onClose:e}){const[i,a]=D.useState(0);return C.jsxs(Lo,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[C.jsx(Vo,{backdropFilter:"blur(4px)"}),C.jsxs(Mo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[C.jsx(yc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),C.jsx(ma,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(Uo,{p:0,display:"flex",children:C.jsxs(cR,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[C.jsxs(lR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:sWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Movement"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:oWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Camera"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:rWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Actions"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:iWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Tips"})]})]}),C.jsxs(U1,{flexGrow:1,display:"flex",flexDirection:"column",children:[C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),C.jsxs(ei,{wrap:"wrap",gap:3,children:[C.jsx(Ol,{keyLabel:"W",description:"Move Forward"}),C.jsx(Ol,{keyLabel:"A",description:"Move Left"}),C.jsx(Ol,{keyLabel:"S",description:"Move Backward"}),C.jsx(Ol,{keyLabel:"D",description:"Move Right"}),C.jsx(Ol,{keyLabel:"Shift",description:"Run"}),C.jsx(Ol,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),C.jsxs(ei,{wrap:"wrap",gap:3,children:[C.jsx(Ol,{keyLabel:"Mouse",description:"Look Around"}),C.jsx(Ol,{keyLabel:"Click + Drag",description:"Rotate Camera"}),C.jsx(Ol,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),C.jsxs(ei,{wrap:"wrap",gap:3,children:[C.jsx(Ol,{keyLabel:"E",description:"Interact"}),C.jsx(Ol,{keyLabel:"F",description:"Emote Menu"}),C.jsx(Ol,{keyLabel:"T",description:"Chat"}),C.jsx(Ol,{keyLabel:"M",description:"Mute Mic"})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),C.jsxs(ti,{align:"stretch",spacing:2,children:[C.jsx(ot,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),C.jsx(ot,{fontSize:"xs",children:" Press ESC to access settings"}),C.jsx(ot,{fontSize:"xs",children:" Click on players to view their profile"}),C.jsx(ot,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Ol=({keyLabel:n,description:e})=>C.jsx(mt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:C.jsxs(vi,{spacing:2,children:[C.jsx(mt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),C.jsx(ot,{fontSize:"xs",children:e})]})}),DWe=()=>{const[n,e]=D.useState([]),[i,a]=D.useState(""),[l,d]=D.useState(0),[p,y]=D.useState(100),[v,b]=D.useState(100),[w,A]=D.useState(!0),[N,V]=D.useState(!0),[F,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const oe=await zC.getMicrophones();e(oe),oe.length>0&&a(oe[0].deviceId)}catch(oe){console.error("Error getting audio devices:",oe)}})()},[]),D.useEffect(()=>{const ce=setInterval(()=>{d(F?Math.random()*50:0)},100);return()=>clearInterval(ce)},[F]);const W=ce=>{const oe=ce.target.value;a(oe),console.log("Microphone changed to:",oe)},J=ce=>{y(ce),console.log("Microphone volume set to:",ce)},$=ce=>{b(ce),console.log("Speaker volume set to:",ce)},te=()=>{B(!F)};return C.jsxs(ti,{spacing:6,align:"stretch",children:[C.jsxs($r,{children:[C.jsxs(Gs,{children:["Microphone",C.jsx(Sp,{ml:2,colorScheme:F?"green":"red",children:F?"Enabled":"Muted"})]}),C.jsxs(Fne,{value:i,onChange:W,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ce=>C.jsx("option",{value:ce.deviceId,children:ce.label||`Microphone ${ce.deviceId.slice(0,5)}...`},ce.deviceId)),n.length===0&&C.jsx("option",{value:"",children:"No microphones found"})]})]}),C.jsxs(mt,{children:[C.jsx(ot,{mb:2,children:"Microphone Level"}),C.jsx(S0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),C.jsxs($r,{children:[C.jsxs(Gs,{children:["Microphone Volume: ",p,"%"]}),C.jsxs(fV,{value:p,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(mV,{bg:"gray.700",children:C.jsx(gV,{})}),C.jsx(pV,{boxSize:6})]})]}),C.jsxs($r,{children:[C.jsxs(Gs,{children:["Speaker Volume: ",v,"%"]}),C.jsxs(fV,{value:v,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[C.jsx(mV,{bg:"gray.700",children:C.jsx(gV,{})}),C.jsx(pV,{boxSize:6})]})]}),C.jsxs($r,{display:"flex",alignItems:"center",children:[C.jsx(Gs,{mb:"0",children:"Microphone Enabled"}),C.jsx(Op,{isChecked:F,onChange:te,colorScheme:"green",size:"lg"})]}),C.jsxs($r,{display:"flex",alignItems:"center",children:[C.jsx(Gs,{mb:"0",children:"Echo Cancellation"}),C.jsx(Op,{isChecked:w,onChange:()=>A(!w),colorScheme:"green",size:"lg"})]}),C.jsxs($r,{display:"flex",alignItems:"center",children:[C.jsx(Gs,{mb:"0",children:"Noise Suppression"}),C.jsx(Op,{isChecked:N,onChange:()=>V(!N),colorScheme:"green",size:"lg"})]}),C.jsxs(Ep,{status:"info",borderRadius:"md",children:[C.jsx(vp,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function xWe({open:n,onClose:e,containerRef:i}){return C.jsx(zl,{containerRef:i,children:C.jsxs(Lo,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[C.jsx(Vo,{}),C.jsxs(Mo,{bg:"gray.900",color:"white",borderRadius:"lg",children:[C.jsx(yc,{children:"Settings"}),C.jsx(ma,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),C.jsx(Uo,{children:C.jsxs(cR,{variant:"enclosed",children:[C.jsxs(lR,{mb:4,children:[C.jsx(mc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),C.jsx(mc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),C.jsxs(U1,{children:[C.jsx(kl,{children:C.jsx(mt,{p:4,bg:"gray.800",borderRadius:"md",children:C.jsx(DWe,{})})}),C.jsx(kl,{children:C.jsx(mt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function LWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function MWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function c0(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Coe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function UWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function VWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function FWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function pC(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function nF(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function sQ(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function zS(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function jWe(n){return Rr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const BWe=async()=>{try{he.log("tagsFirestore: Fetching all tags");const n=jy(ri,"tags"),e=await WC(n),i=[];return e.forEach(a=>{i.push({id:a.id,...a.data()})}),i}catch(n){throw he.error("tagsFirestore: Error fetching tags:",n),n}},WWe=async n=>{try{he.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=Pi(ri,"tags",n),i=await ll(e);return i.exists()?{id:i.id,...i.data()}:(he.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw he.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},zWe=async({id:n,name:e,color:i,description:a})=>{try{he.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const p=Pi(ri,"tags",n);await r1(p,l),d=n}else{const p=jy(ri,"tags");d=(await b5e(p,l)).id}return{id:d,...l}}catch(l){throw he.error("tagsFirestore: Error creating tag:",l),l}},GWe=async(n,e)=>{try{he.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=Pi(ri,"tags",e);if(!(await ll(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=Pi(ri,"spaces",n);return await Ec(l,{tags:T5e(e)}),!0}catch(i){throw he.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},HWe=async(n,e)=>{try{he.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=Pi(ri,"spaces",n);return await Ec(i,{tags:w5e(e)}),!0}catch(i){throw he.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},$We=async n=>{try{he.log(`tagsFirestore: Getting tags for space ${n}`);const e=Pi(ri,"spaces",n),i=await ll(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const p of l){const y=await WWe(p);y&&d.push(y)}return d}catch(e){throw he.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},KWe=async()=>{he.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const a of n){he.log(`tagsFirestore: Processing tag: ${a.name}`);const l=Pi(ri,"tags",a.id);(await ll(l)).exists()?(he.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),i++):(await zWe(a),e++,he.log(`tagsFirestore: Created tag: ${a.name}`))}return he.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw he.error("tagsFirestore: Error initializing default tags:",e),e}},Roe=({spaceID:n})=>{const[e,i]=D.useState([]),[a,l]=D.useState([]),[d,p]=D.useState(!0),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(null),{isOpen:V,onOpen:F,onClose:B}=of(),W=Gl(),{user:J}=D.useContext(Fo),$=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));D.useEffect(()=>{te()},[n]);const te=async()=>{p(!0);try{let Q=[];try{Q=await BWe(),i(Q)}catch(se){he.error("SpaceTagsManager: Error loading available tags:",se),i([]),W({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await $We(n);l(se)}catch(se){he.error("SpaceTagsManager: Error loading space tags:",se),l([]),W({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){he.error("SpaceTagsManager: Error in loadTags:",Q),W({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ce=async()=>{w(!0),N(null);try{const Q=await KWe();console.log("Tag initialization result:",Q),N(Q),W({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await te()}catch(Q){he.error("SpaceTagsManager: Error initializing tags:",Q),N(!1),W({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{w(!1)}},oe=async Q=>{if(!(!n||!Q)){v(!0);try{await GWe(n,Q);const se=e.find(fe=>fe.id===Q);se&&l(fe=>[...fe,se]),W({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){he.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,se),W({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},_e=async Q=>{if(!(!n||!Q)){v(!0);try{await HWe(n,Q),l(se=>se.filter(fe=>fe.id!==Q)),W({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){he.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,se),W({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ne=()=>{const Q=a.map(se=>se.id);return e.filter(se=>!Q.includes(se.id))},ee=ne().length===0;return C.jsxs(mt,{children:[C.jsx(ei,{mb:3,justifyContent:"space-between",alignItems:"center",children:C.jsxs(vi,{spacing:2,ml:"auto",children:[$&&C.jsx(Br,{size:"xs",leftIcon:C.jsx(t6e,{}),onClick:F,variant:"outline",colorScheme:"purple",children:"Admin"}),C.jsxs(sR,{children:[C.jsx(oR,{as:Br,size:"xs",leftIcon:C.jsx(e6e,{}),rightIcon:C.jsx(Xse,{}),isDisabled:d||y||ee,children:ee?"No Available Tags":"Add Tag"}),C.jsx(aR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:ne().length>0?ne().map(Q=>C.jsx(Pd,{onClick:()=>oe(Q.id),icon:C.jsx(mt,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):C.jsx(Pd,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?C.jsx(ei,{justify:"center",py:4,children:C.jsx(uf,{size:"sm",color:"blue.300"})}):e.length===0?C.jsx(mt,{children:C.jsxs(ot,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?C.jsx(ot,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):C.jsx(Xne,{spacing:2,children:a.map(Q=>C.jsx(Dj,{children:C.jsxs(Hne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[C.jsx(mt,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),C.jsx($ne,{children:Q.name}),C.jsx(qne,{onClick:()=>_e(Q.id),isDisabled:y})]})},Q.id))}),C.jsxs(Lo,{isOpen:V,onClose:B,size:"md",children:[C.jsx(Vo,{backdropFilter:"blur(4px)"}),C.jsxs(Mo,{bg:"gray.800",color:"white",children:[C.jsx(yc,{fontSize:"md",children:"Tag System Administration"}),C.jsx(ma,{}),C.jsxs(Uo,{children:[C.jsx(ot,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),A&&C.jsxs(Ep,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[C.jsx(vp,{}),C.jsxs(ot,{fontSize:"sm",children:["Tags initialized. Created: ",C.jsx("b",{children:A.created}),", Skipped: ",C.jsx("b",{children:A.skipped})]})]}),C.jsx(Br,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),C.jsx(Tg,{children:C.jsx(Br,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};Roe.propTypes={spaceID:_r.string.isRequired};const qWe=({isOpen:n,onClose:e})=>{const{spaceID:i}=Xa(),[a,l]=D.useState(0),[d,p]=D.useState(""),[y,v]=D.useState(""),[b,w]=D.useState(!1),[A,N]=D.useState(null),[V,F]=D.useState(null),[B,W]=D.useState(!1),[J,$]=D.useState(0),[te,ce]=D.useState(null),oe=D.useRef(null),[_e,ne]=D.useState(null),[ee,Q]=D.useState(null),[se,fe]=D.useState(!1),[pe,ue]=D.useState(0),[Me,He]=D.useState(null),nt=D.useRef(null),[we,Re]=D.useState([]),[ve,Ne]=D.useState([]),[Te,be]=D.useState(!1),[Ae,Ue]=D.useState(!1),[Ge,Qe]=D.useState(!0),[tt,ht]=D.useState(!1),[Ze,Ct]=D.useState(!1),[un,Lt]=D.useState(""),[nn,kn]=D.useState(""),[Kt,zn]=D.useState(""),[Bt,Ce]=D.useState(!1),{setHLSStreamUrl:Fe,savedStreamData:We}=hoe(),at=Gl();D.useEffect(()=>{n&&i&&vt()},[n,i]);const vt=async()=>{try{const Pt=await yg(i);Pt.logoUrl&&ce(Pt.logoUrl),Pt.backgroundUrl&&He(Pt.backgroundUrl),Pt.voiceDisabled!==void 0&&Ue(Pt.voiceDisabled),Pt.accessibleToAllUsers!==void 0&&Qe(Pt.accessibleToAllUsers),p(Pt.name||""),v(Pt.description||"");try{const wn=await qse(i);if(wn){Lt(wn.streamUrl||""),kn(wn.rtmpUrl||""),zn(wn.streamKey||"");const ir=wn.enabled===!0;Ct(ir),he.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:ir,rawValue:wn.enabled})}else Ct(!1),he.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(wn){if(he.error("Error fetching stream data directly:",wn),We){Lt(We.streamUrl||""),kn(We.rtmpUrl||""),zn(We.streamKey||"");const ir=We.enabled===!0;Ct(ir),he.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:ir,rawValue:We.enabled})}else Ct(!1),he.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}St(Pt)}catch(Pt){he.error("Error fetching space data:",Pt),at({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{if(We){if(!Bt){Lt(We.streamUrl||""),kn(We.rtmpUrl||""),zn(We.streamKey||"");const Pt=We.enabled===!0;Ct(Pt),he.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Pt,rawValue:We.enabled})}}else n&&!Bt&&he.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[We,Bt,n]);const St=async Pt=>{if(i&&n){be(!0);try{const wn=GV(),ir=`space_${i}_owners`,xi=$V(jy(wn,"users"),bJ("groups","array-contains",ir)),Sc=await WC(xi),as=[];for(const ro of Sc.docs){const _s=ro.data(),cs=await Ud(ro.id);as.push({uid:ro.id,email:_s.email,displayName:_s.displayName||cs.Nickname||"Unknown User",photoURL:_s.photoURL||cs.photoURL,firstName:cs.firstName,lastName:cs.lastName})}Re(as);const ya=`space_${i}_hosts`,Eo=$V(jy(wn,"users"),bJ("groups","array-contains",ya)),Ea=await WC(Eo),va=[];for(const ro of Ea.docs){const _s=ro.data(),cs=await Ud(ro.id);va.push({uid:ro.id,email:_s.email,displayName:_s.displayName||cs.Nickname||"Unknown User",photoURL:_s.photoURL||cs.photoURL,firstName:cs.firstName,lastName:cs.lastName})}Ne(va)}catch(wn){he.error("Error fetching space users:",wn),at({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}}};D.useEffect(()=>{i&&n&&a===4&&St()},[i,n,a]);const Gt=Pt=>{const wn=Pt.target.files[0];if(wn){if(!wn.type.startsWith("image/")){at({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(wn);const ir=new FileReader;ir.onloadend=()=>{F(ir.result)},ir.readAsDataURL(wn)}},fn=Pt=>{const wn=Pt.target.files[0];if(wn){if(!wn.type.startsWith("image/")){at({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}ne(wn);const ir=new FileReader;ir.onloadend=()=>{Q(ir.result)},ir.readAsDataURL(wn)}},Ln=async()=>{if(!A){at({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{W(!0);const Pt=setInterval(()=>{$(ir=>{const xi=ir+10;return xi>=90?90:xi})},300),wn=await qBe(i,A);clearInterval(Pt),$(100),ce(wn),at({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),F(null),$(0),W(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:wn}}))}catch(Pt){console.error("Error uploading logo:",Pt),at({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),W(!1),$(0)}},cn=async()=>{if(!_e){at({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{fe(!0);const Pt=setInterval(()=>{ue(ir=>{const xi=ir+10;return xi>=90?90:xi})},300),wn=await XBe(i,_e);clearInterval(Pt),ue(100),He(wn),at({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{ne(null),Q(null),ue(0),fe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:wn}}))}catch(Pt){console.error("Error uploading background:",Pt),at({title:"Upload failed",description:Pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),fe(!1),ue(0)}},dr=async()=>{if(te)try{W(!0),await YBe(i),ce(null),at({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),W(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Pt){console.error("Error deleting logo:",Pt),at({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),W(!1)}},_a=async()=>{if(Me)try{fe(!0),await JBe(i),He(null),at({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),fe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Pt){console.error("Error deleting background:",Pt),at({title:"Deletion failed",description:Pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),fe(!1)}},Vt=()=>{oe.current&&oe.current.click()},on=()=>{nt.current&&nt.current.click()},Wi=async()=>{ht(!0);try{await QBe(i,{voiceDisabled:!Ae}),Ue(!Ae),at({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){he.error("Error updating voice settings:",Pt),at({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{ht(!1)}},gs=async()=>{ht(!0);try{await ZBe(i,!Ge),Qe(!Ge),at({title:"Settings Updated",description:`Space is now ${Ge?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Pt){he.error("Error updating accessibility settings:",Pt),at({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{ht(!1)}},Ms=async()=>{if(i){w(!0);try{const Pt=GV(),wn=Pi(Pt,"spaces",i);await Ec(wn,{name:d,description:y}),at({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:y}}))}catch(Pt){he.error("Error updating space details:",Pt),at({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}}},ii=async()=>{if(i){Ce(!0);try{const Pt={enabled:Ze,streamUrl:un,rtmpUrl:nn,streamKey:Kt,playerIndex:"0",updatedAt:new Date().toISOString()};he.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ze,url:un,hasRtmp:!!nn,hasKey:!!Kt});try{await qV(i,Pt),he.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(wn){throw he.error("SpaceManageModal: Error updating stream settings directly in Firebase:",wn),wn}await Fe(un,0,{enabled:Ze,rtmpUrl:nn,streamKey:Kt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ze,spaceId:i}})),at({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ze?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{vt()},500)}catch(Pt){he.error("Error updating stream settings:",Pt),at({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Ce(!1)}}};return C.jsxs(Lo,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[C.jsx(Vo,{backdropFilter:"blur(4px)"}),C.jsxs(Mo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[C.jsx(yc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),C.jsx(ma,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(Uo,{p:0,display:"flex",overflow:"hidden",children:C.jsxs(cR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[C.jsxs(lR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:Coe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Details"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:c0,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Logo"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:MWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Background"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:VWe,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Settings"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:sQ,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Users"})]}),C.jsxs(mc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[C.jsx(xn,{as:zS,mb:1}),C.jsx(ot,{fontSize:"xs",children:"Stream"})]})]}),C.jsxs(U1,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"xs",children:"Space Name"}),C.jsx(Ai,{value:d,onChange:Pt=>p(Pt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"xs",children:"Description"}),C.jsx(Yne,{value:y,onChange:Pt=>v(Pt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"xs",children:"Space Tags"}),C.jsx(mt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?C.jsx(Roe,{spaceID:i}):C.jsxs(Ep,{status:"warning",variant:"subtle",borderRadius:"md",children:[C.jsx(vp,{}),C.jsx(jS,{fontSize:"sm",children:"Space ID missing"}),C.jsx(BS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),C.jsx(Br,{colorScheme:"blue",size:"sm",onClick:Ms,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),C.jsx(ot,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(te||V)&&C.jsxs(ei,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[te&&C.jsxs(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ot,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),C.jsx(Hh,{src:te,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Br,{mt:3,colorScheme:"red",leftIcon:C.jsx(xn,{as:pC}),onClick:dr,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),V&&C.jsxs(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ot,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Hh,{src:V,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"xs",children:"Upload New Logo"}),C.jsx(Ai,{type:"file",accept:"image/*",onChange:Gt,ref:oe,display:"none"}),B&&C.jsxs(mt,{mt:3,mb:3,children:[C.jsxs(ot,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),C.jsx(S0,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(vi,{mt:3,spacing:3,children:[C.jsx(Br,{colorScheme:"blue",leftIcon:C.jsx(xn,{as:c0}),onClick:Vt,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Br,{colorScheme:"green",leftIcon:C.jsx(xn,{as:nF}),onClick:Ln,isLoading:B,loadingText:"Uploading...",isDisabled:!A||B,size:"sm",children:"Upload"})]}),C.jsx(ZU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),C.jsx(ot,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||ee)&&C.jsxs(ei,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&C.jsxs(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ot,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),C.jsx(Hh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),C.jsx(Br,{mt:3,colorScheme:"red",leftIcon:C.jsx(xn,{as:pC}),onClick:_a,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),ee&&C.jsxs(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[C.jsx(ot,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),C.jsx(Hh,{src:ee,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"xs",children:"Upload New Background"}),C.jsx(Ai,{type:"file",accept:"image/*",onChange:fn,ref:nt,display:"none"}),se&&C.jsxs(mt,{mt:3,mb:3,children:[C.jsxs(ot,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),C.jsx(S0,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),C.jsxs(vi,{mt:3,spacing:3,children:[C.jsx(Br,{colorScheme:"blue",leftIcon:C.jsx(xn,{as:c0}),onClick:on,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),C.jsx(Br,{colorScheme:"green",leftIcon:C.jsx(xn,{as:nF}),onClick:cn,isLoading:se,loadingText:"Uploading...",isDisabled:!_e||se,size:"sm",children:"Upload"})]}),C.jsx(ZU,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),C.jsx(ot,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(vi,{justify:"space-between",align:"center",children:[C.jsxs(mt,{children:[C.jsxs(vi,{mb:1,spacing:2,children:[C.jsxs(mt,{position:"relative",w:"16px",h:"16px",children:[C.jsx(xn,{as:jWe,color:Ae?"red.400":"green.400"}),Ae&&C.jsx(mt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),C.jsx(Op,{isChecked:!Ae,onChange:Wi,colorScheme:"green",size:"md",isDisabled:tt})]})}),C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(vi,{justify:"space-between",align:"center",children:[C.jsxs(mt,{children:[C.jsxs(vi,{mb:1,spacing:2,children:[C.jsx(mt,{position:"relative",w:"16px",h:"16px",children:C.jsx(xn,{as:sQ,color:Ge?"green.400":"red.400"})}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.800",children:Ge?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),C.jsx(ot,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),C.jsx(Op,{isChecked:Ge,onChange:gs,colorScheme:"green",size:"md",isDisabled:tt})]})}),C.jsxs(Ep,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[C.jsx(vp,{color:"blue.300"}),C.jsxs(mt,{children:[C.jsx(jS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(BS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),C.jsx(ot,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Te?C.jsx(ei,{justify:"center",align:"center",h:"200px",children:C.jsx(uf,{color:"blue.300"})}):C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsxs(mt,{children:[C.jsxs(vi,{mb:2,children:[C.jsx(xn,{as:LWe,color:"green.400"}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",children:"Owners"}),C.jsx(Sp,{colorScheme:"green",ml:2,children:we.length})]}),C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):C.jsx(ti,{spacing:1,align:"stretch",children:we.map(Pt=>C.jsxs(vi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(jl,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),C.jsxs(mt,{children:[C.jsx(ot,{fontSize:"xs",children:Pt.displayName}),C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),C.jsx(Lk,{}),C.jsx(Sp,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Pt.uid))})})]}),C.jsxs(mt,{children:[C.jsxs(vi,{mb:2,children:[C.jsx(xn,{as:FWe,color:"purple.400"}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),C.jsx(Sp,{colorScheme:"purple",ml:2,children:ve.length})]}),C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):C.jsx(ti,{spacing:1,align:"stretch",children:ve.map(Pt=>C.jsxs(vi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[C.jsx(jl,{size:"xs",src:Pt.photoURL,name:Pt.displayName}),C.jsxs(mt,{children:[C.jsx(ot,{fontSize:"xs",children:Pt.displayName}),C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.600",children:Pt.firstName&&Pt.lastName?`${Pt.firstName} ${Pt.lastName}`:"Full name not available"})]}),C.jsx(Lk,{}),C.jsx(Sp,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Pt.uid))})})]}),C.jsx(Qh,{borderColor:"whiteAlpha.200"}),C.jsxs(Ep,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[C.jsx(vp,{color:"blue.300",boxSize:4}),C.jsxs(mt,{children:[C.jsx(jS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),C.jsx(BS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),C.jsxs(kl,{p:4,display:"flex",flexDirection:"column",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:C.jsxs(vi,{justify:"space-between",align:"center",children:[C.jsx(mt,{children:C.jsxs(vi,{mb:1,spacing:2,children:[C.jsx(mt,{position:"relative",w:"16px",h:"16px",children:C.jsx(xn,{as:zS,color:Ze?"green.400":"red.400"})}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),C.jsx(Op,{isChecked:Ze,onChange:async()=>{const Pt=!Ze;Ct(Pt),Ce(!0);try{he.log("SpaceManageModal: Auto-saving streaming enabled state:",Pt);const wn={enabled:Pt,streamUrl:un||"",rtmpUrl:nn||"",streamKey:Kt||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await qV(i,wn),he.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(ir){throw he.error("SpaceManageModal: Error updating streaming state directly in Firebase:",ir),ir}await Fe(un,0,{enabled:Pt,rtmpUrl:nn,streamKey:Kt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Pt,spaceId:i}})),at({title:"Streaming "+(Pt?"Enabled":"Disabled"),description:`Streaming is now ${Pt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(wn){he.error("Error auto-saving streaming state:",wn),Ct(!Pt),at({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Ce(!1),setTimeout(()=>{vt()},500)}},colorScheme:"green",size:"md",isDisabled:Bt})]})}),C.jsxs(mt,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),C.jsxs($r,{mb:4,children:[C.jsx(Gs,{fontSize:"xs",children:"Stream URL"}),C.jsx(Ai,{value:un,onChange:Pt=>Lt(Pt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt})]}),C.jsx(Qh,{my:3,borderColor:"whiteAlpha.200"}),C.jsx(ot,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),C.jsxs($r,{mb:3,children:[C.jsx(Gs,{fontSize:"xs",children:"RTMP URL"}),C.jsx(Ai,{value:nn,onChange:Pt=>kn(Pt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt})]}),C.jsxs($r,{mb:3,children:[C.jsx(Gs,{fontSize:"xs",children:"Stream Key"}),C.jsx(Ai,{value:Kt,onChange:Pt=>zn(Pt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Bt,type:"password"})]})]}),C.jsx(Br,{colorScheme:"blue",size:"sm",onClick:ii,isLoading:Bt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ze?"inline-flex":"none",children:"Save Stream Settings"}),C.jsxs(Ep,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[C.jsx(vp,{color:"blue.300"}),C.jsxs(mt,{children:[C.jsx(jS,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),C.jsx(BS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},YWe=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Vd(),[a,l]=D.useState(!0),[d,p]=D.useState(!1),[y,v]=D.useState(!1),[b,w]=D.useState(!1),[A,N]=D.useState(!1),[V,F]=D.useState(!1),[B,W]=D.useState(null),[J,$]=D.useState(!1),[te,ce]=D.useState(!1),[oe,_e]=D.useState(!1),[ne,ee]=D.useState(!1),Q=Gl(),{user:se}=D.useContext(Fo),fe=(se==null?void 0:se.Nickname)||"Unknown",[pe,ue]=D.useState(!1),Me=async()=>{if(se!=null&&se.uid&&e)try{const be=await Ud(se.uid);let Ae=!1,Ue=!1;if(be.groups){const Qe=`space_${e}_owners`,tt=`space_${e}_hosts`;Ae=be.groups.includes(Qe),Ue=be.groups.includes(tt)}const Ge=await Ose(se.uid,"disruptiveAdmin");if(ee(Ge),W({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ce(Ae||Ge),_e(Ue),!Ae&&!Ge&&J){$(!1);const Qe=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Qe),Q({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ce(!1),_e(!1),ee(!1)}else ce(!1),_e(!1),ee(!1)};D.useEffect(()=>{Me()},[se==null?void 0:se.uid,e,J]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),ue(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!y),nt=()=>w(!b),we=()=>{F(!V),Ne()},Re=()=>{N(!1),Me()},ve=be=>{be.stopPropagation(),typeof n=="function"&&(he.log("CanvasMainMenu: Toggling player list"),n())},Ne=()=>{p(!1)},Te=be=>{if(be.stopPropagation(),!te){Q({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!J;$(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),Q({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return C.jsxs(C.Fragment,{children:[C.jsxs(sR,{isOpen:d,onClose:()=>p(!1),children:[C.jsx(oR,{as:xo,icon:C.jsx(s6e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),C.jsx(zl,{containerRef:i,children:C.jsx(aR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:C.jsxs(ti,{align:"stretch",spacing:4,children:[C.jsxs(vi,{children:[C.jsx(jl,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),C.jsxs(ti,{align:"start",spacing:0,children:[C.jsxs(vi,{children:[C.jsx(ot,{fontWeight:"bold",children:fe}),te&&!ne&&C.jsx(kp,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(mt,{display:"inline-block",children:C.jsx(xn,{as:QV,color:"green.400",boxSize:3})})}),!te&&oe&&!ne&&C.jsx(kp,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(mt,{display:"inline-block",children:C.jsx(xn,{as:tF,color:"purple.400",boxSize:3})})}),ne&&C.jsx(kp,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:C.jsx(mt,{display:"inline-block",children:C.jsx(xn,{as:cWe,color:"blue.400",boxSize:3})})})]}),C.jsx(ot,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),C.jsxs(vi,{spacing:4,justify:"center",children:[C.jsx(xo,{icon:C.jsx(uWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),te&&C.jsx(xo,{icon:C.jsx(tWe,{}),variant:"ghost",colorScheme:J?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),C.jsx(xo,{icon:C.jsx(mt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),C.jsx(xo,{icon:C.jsx(mt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),C.jsx(Qh,{borderColor:"whiteAlpha.300"}),C.jsxs(ti,{align:"stretch",spacing:2,children:[te&&C.jsxs(vi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[C.jsx(ot,{fontSize:"md",children:"Edit Mode"}),C.jsx(Op,{id:"edit-mode-toggle",isChecked:J,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:J?"green.500":"black"}}})]}),te&&C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),se&&e&&!pe&&C.jsx(kWe,{onClose:Ne}),C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:nt,children:"Controls"}),C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),C.jsx(ot,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&C.jsx(NWe,{open:b,onClose:nt}),y&&C.jsx(xWe,{open:y,onClose:He}),A&&C.jsx(yoe,{open:A,onClose:Re}),C.jsx(qWe,{isOpen:V,onClose:we})]})},XWe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=Xa(),d=Hp(),p=Gl(),y=D.useRef(null),v=D.useRef(null),b=D.useRef(),[w,A]=D.useState(null),[N,V]=D.useState(""),[F,B]=D.useState(!1),[W,J]=D.useState(0),[$,te]=D.useState(null),[ce,oe]=D.useState(!0),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1),[se,fe]=D.useState(0),[pe,ue]=D.useState("image"),[Me,He]=D.useState(""),[nt,we]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&i&&l){oe(!0);try{const Ct=await Cp(l,i);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){te(Ct);const un=Ct.mediaType==="video";ue(un?"video":"image"),we(Ct.displayAsVideo||!1),un&&Ct.videoUrl&&(He(Ct.videoUrl),fe(1))}else te(null)}catch(Ct){he.error("Error fetching existing image:",Ct),te(null)}finally{oe(!1)}}})()},[n,i,l]),D.useEffect(()=>{n||(A(null),V(""),J(0),He(""))},[n]);const Re=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!0)},[]),ve=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),Q(!1)},[]),Ne=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation()},[]),Te=D.useCallback(Ze=>{if(Ze.preventDefault(),Ze.stopPropagation(),Q(!1),Ze.dataTransfer.files&&Ze.dataTransfer.files.length>0){const Ct=Ze.dataTransfer.files[0];be(Ct)}},[]);D.useEffect(()=>{const Ze=v.current;if(Ze)return Ze.addEventListener("dragenter",Re),Ze.addEventListener("dragleave",ve),Ze.addEventListener("dragover",Ne),Ze.addEventListener("drop",Te),()=>{Ze.removeEventListener("dragenter",Re),Ze.removeEventListener("dragleave",ve),Ze.removeEventListener("dragover",Ne),Ze.removeEventListener("drop",Te)}},[Re,ve,Ne,Te]);const be=Ze=>{if(!Ze)return;if(!Ze.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}A(Ze);const Ct=new FileReader;Ct.onloadend=()=>{V(Ct.result)},Ct.readAsDataURL(Ze)},Ae=Ze=>{const Ct=Ze.target.files[0];be(Ct)},Ue=async Ze=>{const Ct=Ze.target.checked;if(we(Ct),$)try{await $6e(l,i,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),te({...$,displayAsVideo:Ct}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),he.log(`Updated display mode for media screen ${i} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:Ct})}catch(un){he.error("Error updating display mode:",un),p({title:"Update failed",description:un.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!Ct)}},Ge=async()=>{if(pe==="image"&&!w){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!Me){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Ze=setInterval(()=>{J(nn=>{const kn=nn+10;return kn>=90?90:kn})},300);let Ct;pe==="image"?Ct=await ZJ(l,i,w,{mediaType:pe,displayAsVideo:nt}):(Ct=Me,await ZJ(l,i,null,{mediaType:"video",directUrl:Me,displayAsVideo:nt})),clearInterval(Ze),J(100);let un=null,Lt=null;pe==="image"?(un=nt?null:Ct,Lt=($==null?void 0:$.videoUrl)||null):(un=!nt&&($!=null&&$.imageUrl)?$.imageUrl:null,Lt=Ct),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:un,videoUrl:Lt,mediaType:pe,displayAsVideo:nt}),he.log(`Uploaded and sent ${pe} for media screen ${i} (display as video: ${nt})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:pe==="image"?Ct:$==null?void 0:$.imageUrl,videoUrl:pe==="video"?Ct:$==null?void 0:$.videoUrl,mediaType:pe,displayAsVideo:nt}),p({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{A(null),V(""),B(!1),J(0),e()},1e3)}catch(Ze){he.error(`Error uploading ${pe}:`,Ze),p({title:"Upload failed",description:Ze.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1),J(0)}},Qe=async()=>{ne(!1);try{B(!0),await H6e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:pe==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:pe==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),he.log(`Deleted ${pe} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),p({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),te(null),B(!1),He(""),we(!1),setTimeout(()=>{e()},500)}catch(Ze){he.error(`Error deleting ${pe}:`,Ze),p({title:"Deletion failed",description:Ze.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},tt=()=>{F||(A(null),V(""),J(0),e())},ht=Ze=>{fe(Ze),ue(Ze===0?"image":"video")};return C.jsxs(C.Fragment,{children:[C.jsxs(Lo,{isOpen:n,onClose:tt,size:"xl",children:[C.jsx(Vo,{backdropFilter:"blur(10px)"}),C.jsxs(Mo,{bg:"gray.800",color:"white",maxW:"900px",children:[C.jsx(yc,{children:"Media Screen Content"}),C.jsx(ma,{isDisabled:F}),C.jsxs(mt,{px:6,pb:2,children:[C.jsxs(ei,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[C.jsxs(vi,{spacing:4,children:[C.jsx(ot,{fontWeight:"medium",children:"Display as:"}),C.jsxs(vi,{spacing:2,children:[C.jsx(xn,{as:c0,color:nt?"gray.400":"green.300"}),C.jsx(Op,{colorScheme:"purple",size:"md",isChecked:nt,onChange:Ue}),C.jsx(xn,{as:zS,color:nt?"purple.300":"gray.400"})]})]}),C.jsx(Sp,{colorScheme:nt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:nt?"Video Output":"Image Output"})]}),C.jsxs(ot,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",C.jsx("strong",{children:i})]}),C.jsx(ot,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),C.jsx(Qh,{mb:4})]}),C.jsx(Uo,{children:C.jsxs(ei,{children:[C.jsx(cR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:ht,h:"100%",minW:"120px",mr:4,children:C.jsxs(lR,{children:[C.jsxs(mc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[C.jsx(xn,{as:c0,mr:2})," Image"]}),C.jsxs(mc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[C.jsx(xn,{as:zS,mr:2})," Video"]})]})}),C.jsx(mt,{flex:"1",children:ce?C.jsx(ei,{justify:"center",align:"center",h:"150px",children:C.jsx(uf,{size:"xl",color:"blue.400"})}):C.jsxs(C.Fragment,{children:[C.jsx(mt,{children:se===0?C.jsxs(ti,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&pe==="image"&&C.jsxs(mt,{children:[C.jsx(ot,{fontWeight:"semibold",mb:2,children:"Current Image:"}),C.jsxs(ei,{children:[C.jsx(mt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:C.jsx(Hh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),C.jsxs(ti,{align:"flex-start",spacing:2,children:[C.jsxs(ot,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(ot,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Br,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(xn,{as:pC}),onClick:()=>ne(!0),isDisabled:F,children:"Delete"})]})]}),C.jsx(Qh,{my:4})]}),C.jsx(ot,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),C.jsxs(mt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:ee?"blue.400":"gray.500",bg:ee?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>y.current.click(),children:[N?C.jsx(mt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:C.jsx(Hh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):C.jsxs(ti,{spacing:2,children:[C.jsx(xn,{as:nF,boxSize:"24px",color:"gray.400"}),C.jsx(ot,{children:"Drag and drop an image here, or click to browse"}),C.jsx(ot,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),C.jsx(Ai,{type:"file",accept:"image/*",onChange:Ae,ref:y,display:"none"})]}),w&&C.jsxs(ot,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):C.jsxs(ti,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&pe==="video"&&C.jsxs(mt,{children:[C.jsx(ot,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),C.jsxs(ei,{children:[C.jsx(mt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:C.jsx(ot,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),C.jsxs(ti,{align:"flex-start",spacing:2,children:[C.jsxs(ot,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),C.jsxs(ot,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),C.jsx(Br,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:C.jsx(xn,{as:pC}),onClick:()=>ne(!0),isDisabled:F,children:"Delete"})]})]}),C.jsx(Qh,{my:4})]}),C.jsx(ot,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&pe==="video"?"Replace with new video:":"Add video URL:"}),C.jsx(mt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:C.jsxs(vi,{children:[C.jsx(xn,{as:Coe,color:"blue.300"}),C.jsx(ot,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),C.jsxs($r,{children:[C.jsx(Gs,{fontSize:"sm",children:"Video URL"}),C.jsx(Ai,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Ze=>He(Ze.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),C.jsx(ot,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),C.jsxs(mt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[C.jsxs(vi,{children:[C.jsx(xn,{as:zS,color:"blue.300"}),C.jsx(ot,{fontWeight:"medium",children:"Video Support"})]}),C.jsx(ot,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),C.jsx(ot,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&C.jsxs(mt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[C.jsxs(vi,{mb:2,children:[C.jsx(xn,{as:UWe,color:"blue.300"}),C.jsx(ot,{fontWeight:"medium",children:"URL Preview"})]}),C.jsx(ot,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),C.jsx(ot,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),F&&C.jsxs(mt,{mt:4,children:[C.jsxs(ot,{mb:2,children:["Uploading: ",W,"%"]}),C.jsx(S0,{value:W,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),C.jsxs(Tg,{children:[C.jsx(Br,{variant:"ghost",mr:3,onClick:tt,isDisabled:F,children:"Cancel"}),C.jsx(Br,{colorScheme:"blue",onClick:Ge,isLoading:F,loadingText:"Uploading",isDisabled:pe==="image"&&!w||pe==="video"&&!Me||F||ce,leftIcon:C.jsx(xn,{as:pe==="image"?c0:zS}),size:"lg",px:6,children:pe==="image"?"Upload Image":"Save Video URL"})]})]})]}),C.jsx(TMe,{isOpen:_e,leastDestructiveRef:b,onClose:()=>ne(!1),children:C.jsx(Vo,{children:C.jsxs(wMe,{bg:"gray.800",color:"white",children:[C.jsxs(yc,{fontSize:"lg",fontWeight:"bold",children:["Delete ",pe==="video"?"Video":"Image"]}),C.jsxs(Uo,{children:["Are you sure you want to delete this ",pe,"? This will revert the media screen to its blank state."]}),C.jsxs(Tg,{children:[C.jsx(Br,{ref:b,onClick:()=>ne(!1),children:"Cancel"}),C.jsx(Br,{colorScheme:"red",onClick:Qe,ml:3,leftIcon:C.jsx(xn,{as:pC}),children:"Delete"})]})]})})})]})},JWe=n=>{const[e,i]=D.useState(null),[a,l]=D.useState(""),[d,p]=D.useState(null),[y,v]=D.useState(!1),b=ff(),{spaceID:w}=Xa(),A=D.useCallback(F=>{var B,W;try{if(!F)return null;if(F.includes("youtube.com")||F.includes("youtu.be")){let J="";return F.includes("youtube.com/watch")?J=new URLSearchParams(new URL(F).search).get("v"):F.includes("youtu.be/")&&(J=F.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:F}if(F.includes("vimeo.com")){if(F.includes("player.vimeo.com/video"))return F;const J=(W=(B=F.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:W.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:F}return F}catch(J){return he.error("Error converting to embed URL:",J),F}},[]),N=D.useCallback(()=>{setTimeout(()=>{v(!1),he.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let F=!0,B=null;const J=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:te,videoUrl:ce}=$||{};if(!te){he.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${te}, setting ID but not playing video`),he.log("Edit mode is active, setting media screen ID but not playing video"),p(te);return}if(v(!0),B=setTimeout(()=>{F&&(he.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),F)try{const oe=A(ce);console.log(`Setting video URL to: ${oe} (original: ${ce})`),i(oe),l(`Media Screen ${te}`),p(te),he.log("Media screen video URL set directly from event:",oe)}catch(oe){he.error("Error setting video URL from direct URL:",oe)}finally{N(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${te}`);try{const oe=await Cp(w,te);if(console.log("Media screen data from Firestore:",oe),!oe||!oe.videoUrl){he.error("No video URL found for media screen:",te),N(),clearTimeout(B);return}if(!oe.displayAsVideo){he.log("Media screen is not set to display as video:",te),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(B);return}if(F)try{const _e=A(oe.videoUrl);console.log(`Setting video URL to: ${_e} (original: ${oe.videoUrl})`),i(_e),l(oe.title||`Media Screen ${te}`),p(te),he.log("Media screen video URL set to:",_e)}catch(_e){he.error("Error setting video URL from Firestore:",_e)}finally{N(),clearTimeout(B)}}catch(oe){he.error(`Error fetching media screen data for ${te}:`,oe),N(),clearTimeout(B)}}catch(te){he.error("Error handling media screen video play:",te),console.error("Error handling media screen video play:",te),N(),clearTimeout(B)}});return()=>{F=!1,B&&clearTimeout(B),J()}},[b,w,n,A,N]);const V=D.useCallback(()=>{i(null),l(""),p(null),v(!1),he.log("Video player state reset")},[]);return[e,a,d,V,y]},QWe=()=>{const{spaceID:n}=Xa(),e=Hp(),i=ff(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){he.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{he.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return he.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,A=await fetch(w);if(!A.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${A.statusText}`);const N=await A.json(),V=N.thumbnail_url.replace(/_\d+x\d+/,""),F=["640x360","295x166"];let B=null;for(let W of F){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){he.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||N.thumbnail_url}catch(w){return he.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const A=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(A,{method:"HEAD"})).ok)return A}catch(N){he.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,N)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},v=D.useCallback(async b=>{try{if(!n||!b)return;he.log(`Refreshing thumbnail for media screen ${b}`);const w=await Cp(n,b);if(!w){he.log(`No media screen found with ID ${b}`);return}if(he.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){he.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const A=await d(w.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:A}),he.log(`Sent refreshed thumbnail for media screen ${b}: ${A}`)}catch(w){he.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,e]);D.useEffect(()=>{if(!a){he.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}he.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=i("SetMediaScreenThumbnail",async A=>{try{const{mediaScreenId:N,thumbnailUrl:V}=A;V==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{w()}},[i,v,a]),D.useEffect(()=>{if(!a){he.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}he.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");he.log("Fetching media screens for thumbnails...");const A=await q4(n);he.log("All media screens:",A);const N=A.filter(B=>B.displayAsVideo&&B.videoUrl);if(he.log("Media screens set to display as videos:",N),N.length===0){he.log("No media screens set to display as videos found.");return}he.log(`Found ${N.length} media screens set to display as videos.`);const V=N.map(async B=>{try{const W=await d(B.videoUrl);return he.log(`Fetched thumbnail for ${B.id}: ${W}`),{mediaScreenId:B.id,thumbnailUrl:W}}catch(W){return he.error(`Error processing thumbnail for media screen ${B.id}:`,W),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),F=await Promise.all(V);he.log("Fetched Media Screen Thumbnails",F),F.forEach(({mediaScreenId:B,thumbnailUrl:W})=>{e("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:W}),he.log(`Sent thumbnail to Unity for media screen ${B}: ${W}`)})}catch(A){he.error("Error fetching media screen thumbnails:",A)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[e,n,d,a])},oQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},ZWe=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),e8e=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Vd();return pN(a,`video-modal-${i}`),D.useEffect(()=>{if(a){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),C.jsxs(C.Fragment,{children:[C.jsx(ZWe,{}),C.jsxs(Lo,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[C.jsx(Vo,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),C.jsxs(Mo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[C.jsx(ma,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Uo,{p:0,width:"100%",children:n?C.jsx(mt,{className:"iframe-container",style:oQ.iframeContainer,children:C.jsx("iframe",{className:"video-iframe",src:n,style:oQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):C.jsxs(ei,{direction:"column",align:"center",justify:"center",h:"400px",children:[C.jsx(uf,{size:"xl",mb:4}),C.jsx(ot,{children:"Unable to load video"}),C.jsx(ot,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Ws=(...n)=>{},t8e=()=>{const{isOpen:n,onOpen:e,onClose:i}=of(),[a,l]=D.useState(null),[d,p]=D.useState("image"),y=D.useRef(null);pN(n,"image-viewer-modal");const v=D.useCallback(A=>{A.stopPropagation()},[]);return D.useEffect(()=>{if(n&&y.current){const A=y.current;A.addEventListener("mousemove",v),A.addEventListener("mousedown",v),A.addEventListener("mouseup",v),A.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{A.removeEventListener("mousemove",v),A.removeEventListener("mousedown",v),A.removeEventListener("mouseup",v),A.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(A,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${A} and original media type: ${N}`);const V=typeof A=="string"&&(A.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||A.includes("firebasestorage")&&!A.includes("video")),F=V?"image":N;console.log(`[DEBUG] Detected URL as ${V?"image":"non-image"}, using media type: ${F}`),l(A),p(F),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:y,preventPropagation:v}},n8e=()=>C.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),mU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),Ws(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},r8e=()=>{const{spaceID:n}=Xa(),[e,i]=D.useState(!1),[a,l]=D.useState([]),[d,p]=D.useState(null),{isOpen:y,onOpen:v,onClose:b}=of(),[w,A]=D.useState({}),[N,V]=D.useState(0);D.useRef(null);const F=Hp(),{fullscreenRef:B}=Vd(),W=ff(),[J,$]=D.useState(!1),{isOpen:te,currentImageUrl:ce,currentMediaType:oe,openImageViewer:_e,closeImageViewer:ne,modalContentRef:ee,preventPropagation:Q}=t8e(),[se,fe,pe,ue,Me]=JWe(e),{isOpen:He,onOpen:nt,onClose:we}=of();QWe(),foe(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const Re=D.useCallback(be=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===be);if(Ae){const Ue=Ae.imageUrl,Ge=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:Ge,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ce){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===be)),{screen:Ae||{mediaScreenId:be},imageUrl:ce,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return n&&be&&Cp(n,be).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(Qe=>Qe.mediaScreenId===be)?Ue.map(Qe=>Qe.mediaScreenId===be?{...Qe,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Qe):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${be}:`,Ae)}),console.warn("No screen data found for:",be),null},[a,ce,n,l]),ve=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${e}`),p(be),e)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),v();else{const Ae=Re(be);if(Ae){if(console.log(`[DEBUG] Screen data for ${be}:`,Ae),Ws("Screen data details:",{mediaScreenId:be,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&pe===be)return;if(Ae.displayAsVideo&&Ae.videoUrl)Ws(`Opening video player for: ${Ae.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){Ws(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const Ge=mU(Ae.imageUrl);_e(Ge,Ae.mediaType||"image")}else n&&Cp(n,be).then(Ge=>{if(Ge){if(Ge.displayAsVideo&&Ge.videoUrl)Ws(`Opening video player for: ${Ge.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ge.videoUrl});else if(Ge.imageUrl){Ws(`Opening viewer modal with image: ${Ge.imageUrl}`);const Qe=mU(Ge.imageUrl);_e(Qe,Ge.mediaType||"image")}l(Qe=>Array.isArray(Qe)&&Qe.some(ht=>ht.mediaScreenId===be)?Qe.map(ht=>ht.mediaScreenId===be?{...ht,...Ge,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:ht):[...Array.isArray(Qe)?Qe:[],{...Ge,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ge=>{console.error(`Error fetching media screen data for ${be}:`,Ge)})}else n&&Cp(n,be).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)Ws(`Opening video player for: ${Ue.videoUrl}`),F("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){Ws(`Opening viewer modal with image: ${Ue.imageUrl}`);const Ge=mU(Ue.imageUrl);_e(Ge,Ue.mediaType||"image")}l(Ge=>Array.isArray(Ge)&&Ge.some(tt=>tt.mediaScreenId===be)?Ge.map(tt=>tt.mediaScreenId===be?{...tt,...Ue,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:tt):[...Array.isArray(Ge)?Ge:[],{...Ue,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${be}:`,Ue)})}},[e,v,Re,He,pe,F,_e,n]);D.useEffect(()=>{if(!J)return;const be=async()=>{if(n)try{const Ue=await q4(n),Ge={};Ue.forEach(Qe=>{Qe.id&&Qe.imageUrl&&(Ge[Qe.id]=Qe.imageUrl)}),l(Qe=>Qe.map(tt=>{const ht=!!Ge[tt.mediaScreenId],Ze=Ge[tt.mediaScreenId],Ct=tt.mediaType||"image";return{...tt,hasImage:ht,imageUrl:Ze,mediaType:Ct}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};be();let Ae=null;return e&&(Ae=setInterval(be,5e3)),()=>{Ae&&clearInterval(Ae)}},[n,e,N,J]);const Ne=be=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Ue,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),be.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(Ge=>Ge.mediaScreenId===be.mediaScreenId)?Ae.map(Ge=>Ge.mediaScreenId===be.mediaScreenId?{...Ge,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:Ge):[...Ae,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Ae=>{const Ue=Ae.detail.enabled;i(Ue),Ue?F("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):F("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[F]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ae=JSON.parse(be),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),ve(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),D.useEffect(()=>{const be=Ge=>{try{const Qe=JSON.parse(Ge.detail);he.log(`MediaScreen registered: ${Qe.mediaScreenId}`),Ws("MediaScreen registered from Unity:",Qe),l(ht=>ht.some(Ct=>Ct.mediaScreenId===Qe.mediaScreenId)?ht.map(Ct=>Ct.mediaScreenId===Qe.mediaScreenId?{...Ct,...Qe,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...ht,{...Qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&F("SetMediaScreenEditMode",{mediaScreenId:Qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const tt=Qe.mediaScreenId;tt&&Cp(n,tt).then(ht=>{ht&&(Ws(`Media screen data for ${tt}:`,ht),ht.displayAsVideo&&ht.videoUrl&&(Ws(`Media screen ${tt} should display as video, sending null imageUrl`),F("SetMediaScreenImage",{mediaScreenId:tt,imageUrl:null,displayAsVideo:!0})))}).catch(ht=>{console.error(`Error fetching media screen data for ${tt}:`,ht)})}catch(Qe){console.error("Error handling MediaScreen registration:",Qe)}},Ae=Ge=>{try{Ws("MediaScreenClick event received:",Ge);let Qe;if(typeof Ge=="string")Qe=Ge,Ws("MediaScreenClick: Direct call with ID:",Qe);else{Ws("MediaScreenClick: Event from Unity:",Ge),Ws("MediaScreenClick: Event detail:",Ge.detail);try{Qe=JSON.parse(Ge.detail).mediaScreenId,Ws("MediaScreenClick: Parsed mediaScreenId:",Qe)}catch(tt){if(console.error("MediaScreenClick: Error parsing event detail:",tt),Ge.detail&&Ge.detail.mediaScreenId)Qe=Ge.detail.mediaScreenId,Ws("MediaScreenClick: Using direct mediaScreenId from detail:",Qe);else throw new Error("Could not extract mediaScreenId from event")}}he.log(`MediaScreen clicked: ${Qe}`),Ws("MediaScreen clicked:",Qe),ve(Qe)}catch(Qe){console.error("Error handling MediaScreen click:",Qe)}},Ue=Ge=>{if(Ge.detail&&Ge.detail.eventName==="RegisterMediaScreen")be({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="MediaScreenClick")Ae({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="SetMediaScreenImage")try{const Qe=JSON.parse(Ge.detail.eventData);Qe.mediaScreenId&&(Ws("SetMediaScreenImage event received:",Qe),l(tt=>Array.isArray(tt)&&tt.some(Ze=>Ze.mediaScreenId===Qe.mediaScreenId)?tt.map(Ze=>Ze.mediaScreenId===Qe.mediaScreenId?{...Ze,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(tt)?tt:[],{mediaScreenId:Qe.mediaScreenId,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Qe){console.error("Error handling SetMediaScreenImage event:",Qe)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[e,v,F,a,te,He,_e,ve,n]),D.useEffect(()=>{const be=Ae=>{try{Ws("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(Ge){console.error("Error parsing MediaScreenClick event detail:",Ge);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}Ws(`Direct handler: Processing click for media screen ${Ue}`),ve(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[ve]),D.useEffect(()=>{se&&nt()},[se,nt]);const Te=()=>{ue(),we()};return D.useEffect(()=>{const Ae=W("RegisterMediaScreen",Ue=>{try{if(he.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){he.warn("RegisterMediaScreen event received with invalid data");return}const Ge=Ue.mediaScreenId;he.log(`Media screen registered directly: ${Ge}`),l(Qe=>Qe.some(ht=>ht.mediaScreenId===Ge)?Qe.map(ht=>ht.mediaScreenId===Ge?{...ht,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:ht):[...Qe,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&F("SetMediaScreenEditMode",{mediaScreenId:Ge,enabled:!0,showUploadIcon:!0})}catch(Ge){console.error("Error handling direct RegisterMediaScreen event:",Ge)}});return()=>{Ae()}},[W,e,F]),D.useEffect(()=>{const Ae=W("MediaScreenClick",Ue=>{try{if(he.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){he.warn("MediaScreenClick event received with invalid data");return}const Ge=Ue.mediaScreenId;he.log(`Media screen clicked directly: ${Ge}`),ve(Ge)}catch(Ge){console.error("Error handling direct MediaScreenClick event:",Ge)}});return()=>{Ae()}},[W,ve]),D.useEffect(()=>{e&&pe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${pe}`),p(pe),v(),ue())},[e,pe,v,ue]),C.jsxs(C.Fragment,{children:[C.jsx(XWe,{isOpen:y,onClose:b,mediaScreenId:d,onImageChange:Ne}),C.jsx(n8e,{}),C.jsx(zl,{containerRef:B,children:C.jsxs(Lo,{isOpen:te,onClose:ne,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[C.jsx(Vo,{bg:"rgba(0, 0, 0, 0.8)",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q}),C.jsxs(Mo,{ref:ee,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[C.jsx(ma,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),C.jsx(Uo,{p:0,width:"100%",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ce?C.jsx(mt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:oe==="image"?C.jsx(Hh,{src:ce,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ce),onError:be=>console.error("Error loading image:",be,ce),onClick:Q}):C.jsxs(mt,{width:"100%",textAlign:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[C.jsx(ot,{mb:4,fontSize:"lg",children:"Video URL:"}),C.jsx(ot,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ce}),C.jsx(ot,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):C.jsx(ei,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:C.jsx(ot,{children:"No image available"})})})]})]})}),C.jsx(e8e,{videoUrl:se,videoTitle:fe,mediaScreenId:pe,isOpen:He,onClose:Te})]})},Ioe=({backgroundUrl:n=null,containerRef:e})=>{const[i,a]=D.useState(!1),[l,d]=D.useState(n),p=D.useRef(null),y=D.useRef(null);return D.useEffect(()=>{const v=b=>{const{backgroundUrl:w}=b.detail;d(w),p.current&&(w?(p.current.style.backgroundImage=`url('${w}')`,p.current.style.display="block",y.current&&(y.current.style.display="block")):(p.current.style.display="none",y.current&&(y.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),D.useEffect(()=>{d(n),p.current&&n!==l&&(p.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!e||!e.current)return;const v=document.createElement("div");p.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");y.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),e.current.appendChild(v),e.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",b.style.opacity="0",setTimeout(()=>{e.current&&e.current.contains(v)&&e.current.removeChild(v),e.current&&e.current.contains(b)&&e.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Dd.subscribe(Nd.playerInstantiated,w);const A=()=>w();window.addEventListener("PlayerInstantiated",A);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Dd.unsubscribe(Nd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",A),clearTimeout(N),e.current&&e.current.contains(v)&&e.current.removeChild(v),e.current&&e.current.contains(b)&&e.current.removeChild(b)}}},[l,e]),null};Ioe.propTypes={backgroundUrl:_r.string,containerRef:_r.shape({current:_r.instanceOf(Element)})};const Aoe=({containerRef:n})=>{const{spaceID:e}=Xa(),[i,a]=D.useState(!1),[l,d]=D.useState(!1),[p,y]=D.useState(0),[v,b]=D.useState("Initialising World"),[w,A]=D.useState(null),N=D.useRef(null),V=D.useRef(null),F=D.useRef(null),B=D.useRef(null);D.useEffect(()=>(he.log("PersistentLoader: Component mounted with spaceID:",e),he.log("PersistentLoader: Container ref:",n),()=>{he.log("PersistentLoader: Component unmounting")}),[]);const{error:W}=Xa(),[J,$]=D.useState(!1);return D.useEffect(()=>{W&&(he.error("PersistentLoader: Unity error detected:",W),$(!0),setTimeout(()=>{if(N.current){const te=N.current.querySelector("div:first-child");te&&(te.textContent="Reconnecting...")}},3e3))},[W]),D.useEffect(()=>{(async()=>{if(e){he.log(`PersistentLoader: Fetching logo for space ${e}`);try{const ce=await yg(e);ce&&ce.logoUrl?(he.log(`PersistentLoader: Found logo URL: ${ce.logoUrl}`),A(ce.logoUrl)):he.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(ce){he.error("PersistentLoader: Error fetching space logo:",ce)}}else he.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),D.useEffect(()=>{const te=ce=>{const{logoUrl:oe}=ce.detail;he.log(`PersistentLoader: Logo update event received with URL: ${oe}`),A(oe),V.current?oe?(he.log("PersistentLoader: Updating logo element with new URL"),V.current.src=oe,F.current.style.display="flex"):(he.log("PersistentLoader: Hiding logo element (no URL)"),F.current.style.display="none"):he.warn("PersistentLoader: Logo ref is null during update")};return he.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",te),()=>{he.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",te)}},[]),D.useEffect(()=>{if(!n||!n.current){he.error("PersistentLoader: Container ref is null or has no current property");return}he.log("PersistentLoader: Creating loader elements");const te=document.createElement("div");if(N.current=te,Object.assign(te.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){he.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");F.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const nt=document.createElement("img");V.current=nt,nt.src=w,nt.alt="Space Logo",nt.style.maxHeight="100px",nt.style.maxWidth="100%",nt.style.objectFit="contain",nt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(nt),n.current.appendChild(He),he.log("PersistentLoader: Logo container added to main container")}else he.log("PersistentLoader: No logo URL available, skipping logo creation");const ce=document.createElement("style");ce.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(ce),he.log("PersistentLoader: Animation styles added to document head");const oe=document.createElement("div");oe.style.fontSize="16px",oe.style.fontWeight="bold",oe.style.textAlign="center",oe.style.marginBottom="16px",oe.style.color="#ffffff",oe.textContent="Initialising World";const _e=document.createElement("div");_e.style.width="100%",_e.style.height="12px",_e.style.backgroundColor="rgba(255, 255, 255, 0.2)",_e.style.borderRadius="6px",_e.style.overflow="hidden",_e.style.position="relative",_e.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const ne=document.createElement("div");ne.style.height="100%",ne.style.width="0%",ne.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",ne.style.backgroundSize="200% 200%",ne.style.animation="progress-glow 2s ease infinite",ne.style.transition="width 0.5s ease-out",ne.style.borderRadius="6px",ne.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",_e.appendChild(ne);const ee=document.createElement("div");ee.style.marginTop="8px",ee.style.fontSize="14px",ee.style.fontWeight="bold",ee.style.color="#ffffff",ee.textContent="0%",te.appendChild(oe),te.appendChild(_e),te.appendChild(ee),n.current.appendChild(te),he.log("PersistentLoader: Loader element added to container");const Q=He=>{y(He),ne.style.width=`${Math.round(He*100)}%`,ee.textContent=`${Math.round(He*100)}%`,he.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},se=He=>{b(He),oe.textContent=He,he.log(`PersistentLoader: Loading stage updated to "${He}"`)},fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];J&&(fe[0].stage="Connecting to Space",fe[1].stage="Reconnecting...",fe[2].stage="Please Wait"),se(fe[0].stage),Q(.05);const pe=He=>{const nt=He.detail.progress;he.log(`PersistentLoader: Progress event received with value: ${nt}`),Q(nt),nt<.33?se(fe[0].stage):nt<.66?se(fe[1].stage):se(fe[2].stage)},ue=()=>{he.log("PersistentLoader: First scene loaded event received"),a(!0),se(fe[1].stage),Q(.66)},Me=()=>{if(he.log("PersistentLoader: Player instantiated event received"),B.current&&(clearInterval(B.current),he.log("PersistentLoader: Progress interval cleared")),d(!0),se(fe[2].stage),Q(1),J){he.log("PersistentLoader: Keeping loader visible due to Unity error");return}te.style.opacity="0",F.current&&(F.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(te)?(n.current.removeChild(te),he.log("PersistentLoader: Loader element removed after fade")):he.warn("PersistentLoader: Could not remove loader element (not found in container)"),F.current&&n.current&&n.current.contains(F.current)?(n.current.removeChild(F.current),he.log("PersistentLoader: Logo container removed after fade")):F.current&&he.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)he.log("PersistentLoader: Player was already instantiated"),Me();else{he.log("PersistentLoader: Subscribing to playerInstantiated event"),Dd.subscribe(Nd.playerInstantiated,Me);const He=()=>Me();he.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),he.log("PersistentLoader: Adding firstSceneLoaded event listener"),Dd.subscribe(Nd.firstSceneLoaded,ue),he.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",pe),B.current=setInterval(()=>{l||y(we=>{const Re=Math.min(we+.01,.95);return ne.style.width=`${Math.round(Re*100)}%`,ee.textContent=`${Math.round(Re*100)}%`,Re<.33&&v!==fe[0].stage?se(fe[0].stage):Re>=.33&&Re<.66&&v!==fe[1].stage?se(fe[1].stage):Re>=.66&&v!==fe[2].stage&&se(fe[2].stage),Re})},500);const nt=setTimeout(()=>{he.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{he.log("PersistentLoader: Cleaning up event listeners"),Dd.unsubscribe(Nd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Dd.unsubscribe(Nd.firstSceneLoaded,ue),window.removeEventListener("UnityProgress",pe),clearInterval(B.current),clearTimeout(nt),n.current&&n.current.contains(te)&&(n.current.removeChild(te),he.log("PersistentLoader: Loader element removed during cleanup")),F.current&&n.current&&n.current.contains(F.current)&&(n.current.removeChild(F.current),he.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Aoe.propTypes={containerRef:_r.shape({current:_r.instanceOf(Element)})};const i8e=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[a,l]=D.useState(!1),[d,p]=D.useState(!1),{savedStreamData:y,reloadStreamData:v}=hoe(),{spaceID:b}=Xa(),{user:w}=D.useContext(Fo),A=Gl(),[N,V]=D.useState(!1),F=lK((y==null?void 0:y.rtmpUrl)||""),B=lK((y==null?void 0:y.streamKey)||"");D.useEffect(()=>{if(b){he.log("LiveStreamButton: Forcing reload of stream data"),v();const $=()=>{he.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,v]),D.useEffect(()=>{(async()=>{if(!(w!=null&&w.uid)||!b){V(!1);return}try{const te=await P5e(w.uid,"disruptiveAdmin"),ce=await N5e(w,b);V(te||ce)}catch(te){he.error("Error checking user permissions:",te),V(!1)}})()},[w==null?void 0:w.uid,b]),D.useEffect(()=>{he.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:N,isPlayerReady:d})},[y,N,d]),D.useEffect(()=>{const $=()=>{he.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(he.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!N||(y==null?void 0:y.enabled)!==!0?(he.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!N,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):C.jsxs(C.Fragment,{children:[C.jsx(kp,{label:"Live Stream Info",placement:e,hasArrow:!0,children:C.jsx(jl,{size:n,borderRadius:"full",bg:"black",icon:C.jsx(fWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:W})}),C.jsxs(Lo,{isOpen:a,onClose:J,isCentered:!0,size:"md",children:[C.jsx(Vo,{backdropFilter:"blur(4px)"}),C.jsxs(Mo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[C.jsx(yc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),C.jsx(ma,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),C.jsx(Uo,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?C.jsxs(mt,{children:[C.jsx(ot,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),C.jsxs(mt,{mb:4,children:[C.jsx(ot,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),C.jsx(ei,{children:C.jsxs(t0,{size:"sm",children:[C.jsx(Ai,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),C.jsx(Dk,{children:C.jsx(xo,{"aria-label":"Copy RTMP URL",icon:F.hasCopied?C.jsx(tQ,{}):C.jsx(nQ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),A({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsxs(mt,{mb:4,children:[C.jsx(ot,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),C.jsx(ei,{children:C.jsxs(t0,{size:"sm",children:[C.jsx(Ai,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),C.jsx(Dk,{children:C.jsx(xo,{"aria-label":"Copy Stream Key",icon:B.hasCopied?C.jsx(tQ,{}):C.jsx(nQ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),A({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),C.jsx(ot,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):C.jsxs(mt,{textAlign:"center",p:4,children:[C.jsx(ot,{color:"white",children:"No stream configuration found for this space."}),C.jsx(ot,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},s8e="a2a7f4eb05284449b1063eb71d8301dc",gU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),Y4=D.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:a,error:l}=Xa(),d=j6e();W6e();const p=Hp(),y=q6e(d),{user:v}=D.useContext(Fo),[b,w]=D.useState(!1),[A,N]=D.useState(window.devicePixelRatio),[V,F]=G6e();doe().find(Ne=>Ne.isLocalPlayer);const[W,J]=D.useState(!0),[$,te]=D.useState(!0),[ce,oe]=D.useState(!1),[_e,ne]=D.useState(!1),[ee,Q]=D.useState(!1);D.useEffect(()=>{ee?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),kd(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!_e&&kd(!1).then(()=>{setTimeout(()=>{py(!0)},100)}))},[ee,a,_e]);const se=n.spaceID||"default",fe=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||se;return console.log("WebGLRenderer: Using session ID:",be),be},[se]),[pe,ue]=D.useState(null);D.useEffect(()=>{v!=null&&v.uid&&Ud(v.uid).then(Ne=>{ue(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),D.useEffect(()=>{if(l||!v){he.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{ne(!0),Q(!0)},1e3);return()=>clearTimeout(Ne)}else ne(!1)},[l,v]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),te(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),te(!0)),Dd.subscribe(Nd.playerInstantiated,Ne);const Te=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),te(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Dd.unsubscribe(Nd.playerInstantiated,Ne),clearTimeout(Te)}},[$]),D.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),Q(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),Q(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",Te)}},[]),D.useEffect(()=>{Q(V!==null)},[V]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),he.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):he.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,i]),D.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==se&&(Ne.setAttribute("data-space-id",se),console.log(`WebGLRenderer: Set data-space-id attribute to ${se}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[se]),D.useEffect(()=>{const Ne=()=>{const Ae=gU();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ee||py(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const Te=setTimeout(Ne,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",be),()=>{clearTimeout(Te),window.removeEventListener("unityReady",be)}},[a,ee]);const Me=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ee||py(!0)},[ee]);D.useEffect(()=>{if(a&&i){const Ne=gU();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,i,Me]),D.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=Te=>{if(ee){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=gU();if(be&&(Te.target===be||be.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ee||py(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!ee&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),py(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,i,ee]),D.useEffect(()=>{const Ne=Te=>{he.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",Te)};return Dd.subscribe(Nd.sendUserToUnity,Ne),()=>Dd.unsubscribe(Nd.sendUserToUnity,Ne)},[p]);const{setFullscreenRef:He,fullscreenRef:nt}=Vd();D.useEffect(()=>{He(e.current)},[e,He]);const we=()=>{J(!W)},Re=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:$,showVoiceChat:Re,sessionId:fe}),D.useEffect(()=>{const Ne=Te=>{oe(Te.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),foe(),z6e();const ve=D.useRef(null);return C.jsxs(mt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&C.jsx(Ioe,{backgroundUrl:n.urlLoadingBackground,containerRef:ve}),!_e&&C.jsx(Aoe,{containerRef:ve}),_e&&C.jsx(mt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:C.jsx(gN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),C.jsx(bF,{containerRef:nt.current?nt:document.body,children:C.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[C.jsxs(mt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&C.jsx(X6e,{}),v&&C.jsx(i8e,{size:"md"}),Re&&C.jsxs(Toe,{appId:s8e,channel:fe,uid:v==null?void 0:v.uid,enabled:!0,children:[C.jsx(AWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),C.jsx(OWe,{userNickname:pe==null?void 0:pe.Nickname})]}),C.jsx(mWe,{}),C.jsx(mt,{position:"relative",zIndex:"9999",children:C.jsx(YWe,{onTogglePlayerList:we,spaceID:se})})]}),C.jsxs(mt,{ref:ve,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[C.jsx(mt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),C.jsx(mt,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?C.jsx(uoe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:A,tabIndex:1}):C.jsx(mt,{width:"100%",height:"100%"})}),C.jsx(mt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:C.jsx(Y6e,{})})]}),C.jsx(mt,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&C.jsx(Hh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),C.jsx(mt,{...y,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),C.jsxs(mt,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&C.jsx(J6e,{}),C.jsx(yWe,{})]}),C.jsx(EWe,{}),C.jsx(vWe,{isOpen:V!==null,onClose:()=>{console.log(" Closing nameplate modal"),F()},playerName:(V==null?void 0:V.playerName)||"Unknown Player",playerId:(V==null?void 0:V.playerId)||"Unknown ID"}),C.jsx(SWe,{isVisible:W,onToggleVisibility:J,spaceID:se}),C.jsx(r8e,{})]})})]})});Y4.displayName="WebGLRenderer";Y4.propTypes={settings:_r.shape({urlLoadingBackground:_r.string,showAuthButton:_r.bool,showDisruptiveLogo:_r.bool,urlDisruptiveLogo:_r.string,showHelpButton:_r.bool,enableVoiceChat:_r.bool,spaceID:_r.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(he.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),he.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const X4=({spaceID:n,overrideSettings:e})=>{const i=D.useRef(null),[a,l]=D.useState(!0),[d,p]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[y,v]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await yg(n);if(w){p(V=>({...V,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const A=await gk(y.urlDisruptiveLogo);let N="";if(w.backgroundUrl)N=w.backgroundUrl;else if(w.backgroundGsUrl)try{N=await gk(w.backgroundGsUrl)}catch(V){he.warn("WebGLLoader: Error fetching background from GS URL:",V)}else if(w.gsUrlLoadingBackground)try{N=await gk(w.gsUrlLoadingBackground)}catch(V){he.warn("WebGLLoader: Error fetching background from legacy GS URL:",V)}v(V=>({...V,urlLoadingBackground:N,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:A,spaceID:n,...e||{}})),l(!1)}else he.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){he.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,y.urlDisruptiveLogo,e]),D.useEffect(()=>{a||(he.log("WebGLLoader: Unity config from Firebase",d),he.log("WebGLLoader: Space settings from Firebase",y))},[a]),C.jsx(C.Fragment,{children:a?C.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):C.jsx(F6e,{...d,children:C.jsx(Y4,{ref:i,settings:y})})})};X4.propTypes={spaceID:_r.string.isRequired,overrideSettings:_r.object};function aQ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{DC(i).then(d)},[]),l?C.jsx(A1,{theme:l,children:C.jsx(hN,{children:C.jsx(j4,{children:C.jsx(X4,{spaceID:e})})})}):C.jsx("div",{children:"Loading theme..."})};try{l1.createRoot(n).render(C.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aQ):aQ());const o8e=(n,e)=>{try{const i=jy(ri,`spaces/${n}/chatMessages`),a=new Date,l=$V(i,_5e("timestamp","asc"),y5e(a));return Cse(l,d=>{const p=[];d.docChanges().forEach(y=>{if(y.type==="added"){const v=y.doc.data();console.log("Firestore document data:",v),p.push({id:y.doc.id,...v})}}),p.length>0&&e(p)})}catch(i){throw he.error("Error subscribing to space chat messages:",i),i}};function Fd(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function zy(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const Poe=6048e5,a8e=864e5;let c8e={};function _N(){return c8e}function GC(n,e){var y,v,b,w;const i=_N(),a=(e==null?void 0:e.weekStartsOn)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.weekStartsOn)??i.weekStartsOn??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.weekStartsOn)??0,l=Fd(n),d=l.getDay(),p=(d<a?7:0)+d-a;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function c1(n){return GC(n,{weekStartsOn:1})}function Ooe(n){const e=Fd(n),i=e.getFullYear(),a=zy(n,0);a.setFullYear(i+1,0,4),a.setHours(0,0,0,0);const l=c1(a),d=zy(n,0);d.setFullYear(i,0,4),d.setHours(0,0,0,0);const p=c1(d);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function cQ(n){const e=Fd(n);return e.setHours(0,0,0,0),e}function lQ(n){const e=Fd(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function l8e(n,e){const i=cQ(n),a=cQ(e),l=+i-lQ(i),d=+a-lQ(a);return Math.round((l-d)/a8e)}function u8e(n){const e=Ooe(n),i=zy(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),c1(i)}function d8e(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function h8e(n){if(!d8e(n)&&typeof n!="number")return!1;const e=Fd(n);return!isNaN(Number(e))}function f8e(n){const e=Fd(n),i=zy(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const p8e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},m8e=(n,e,i)=>{let a;const l=p8e[n];return typeof l=="string"?a=l:e===1?a=l.one:a=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};function _U(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const g8e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},_8e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},y8e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},E8e={date:_U({formats:g8e,defaultWidth:"full"}),time:_U({formats:_8e,defaultWidth:"full"}),dateTime:_U({formats:y8e,defaultWidth:"full"})},v8e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},S8e=(n,e,i,a)=>v8e[n];function Pw(n){return(e,i)=>{const a=i!=null&&i.context?String(i.context):"standalone";let l;if(a==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,y=i!=null&&i.width?String(i.width):p;l=n.formattingValues[y]||n.formattingValues[p]}else{const p=n.defaultWidth,y=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[y]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(e):e;return l[d]}}const b8e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},T8e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},w8e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},C8e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},R8e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},I8e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},A8e=(n,e)=>{const i=Number(n),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},P8e={ordinalNumber:A8e,era:Pw({values:b8e,defaultWidth:"wide"}),quarter:Pw({values:T8e,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Pw({values:w8e,defaultWidth:"wide"}),day:Pw({values:C8e,defaultWidth:"wide"}),dayPeriod:Pw({values:R8e,defaultWidth:"wide",formattingValues:I8e,defaultFormattingWidth:"wide"})};function Ow(n){return(e,i={})=>{const a=i.width,l=a&&n.matchPatterns[a]||n.matchPatterns[n.defaultMatchWidth],d=e.match(l);if(!d)return null;const p=d[0],y=a&&n.parsePatterns[a]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(y)?k8e(y,A=>A.test(p)):O8e(y,A=>A.test(p));let b;b=n.valueCallback?n.valueCallback(v):v,b=i.valueCallback?i.valueCallback(b):b;const w=e.slice(p.length);return{value:b,rest:w}}}function O8e(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function k8e(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function N8e(n){return(e,i={})=>{const a=e.match(n.matchPattern);if(!a)return null;const l=a[0],d=e.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=i.valueCallback?i.valueCallback(p):p;const y=e.slice(l.length);return{value:p,rest:y}}}const D8e=/^(\d+)(th|st|nd|rd)?/i,x8e=/\d+/i,L8e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},M8e={any:[/^b/i,/^(a|c)/i]},U8e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},V8e={any:[/1/i,/2/i,/3/i,/4/i]},F8e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},j8e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},B8e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},W8e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},z8e={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},G8e={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},H8e={ordinalNumber:N8e({matchPattern:D8e,parsePattern:x8e,valueCallback:n=>parseInt(n,10)}),era:Ow({matchPatterns:L8e,defaultMatchWidth:"wide",parsePatterns:M8e,defaultParseWidth:"any"}),quarter:Ow({matchPatterns:U8e,defaultMatchWidth:"wide",parsePatterns:V8e,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Ow({matchPatterns:F8e,defaultMatchWidth:"wide",parsePatterns:j8e,defaultParseWidth:"any"}),day:Ow({matchPatterns:B8e,defaultMatchWidth:"wide",parsePatterns:W8e,defaultParseWidth:"any"}),dayPeriod:Ow({matchPatterns:z8e,defaultMatchWidth:"any",parsePatterns:G8e,defaultParseWidth:"any"})},$8e={code:"en-US",formatDistance:m8e,formatLong:E8e,formatRelative:S8e,localize:P8e,match:H8e,options:{weekStartsOn:0,firstWeekContainsDate:1}};function K8e(n){const e=Fd(n);return l8e(e,f8e(e))+1}function q8e(n){const e=Fd(n),i=+c1(e)-+u8e(e);return Math.round(i/Poe)+1}function koe(n,e){var w,A,N,V;const i=Fd(n),a=i.getFullYear(),l=_N(),d=(e==null?void 0:e.firstWeekContainsDate)??((A=(w=e==null?void 0:e.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??l.firstWeekContainsDate??((V=(N=l.locale)==null?void 0:N.options)==null?void 0:V.firstWeekContainsDate)??1,p=zy(n,0);p.setFullYear(a+1,0,d),p.setHours(0,0,0,0);const y=GC(p,e),v=zy(n,0);v.setFullYear(a,0,d),v.setHours(0,0,0,0);const b=GC(v,e);return i.getTime()>=y.getTime()?a+1:i.getTime()>=b.getTime()?a:a-1}function Y8e(n,e){var y,v,b,w;const i=_N(),a=(e==null?void 0:e.firstWeekContainsDate)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.firstWeekContainsDate)??i.firstWeekContainsDate??((w=(b=i.locale)==null?void 0:b.options)==null?void 0:w.firstWeekContainsDate)??1,l=koe(n,e),d=zy(n,0);return d.setFullYear(l,0,a),d.setHours(0,0,0,0),GC(d,e)}function X8e(n,e){const i=Fd(n),a=+GC(i,e)-+Y8e(i,e);return Math.round(a/Poe)+1}function Ei(n,e){const i=n<0?"-":"",a=Math.abs(n).toString().padStart(e,"0");return i+a}const ng={y(n,e){const i=n.getFullYear(),a=i>0?i:1-i;return Ei(e==="yy"?a%100:a,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ei(i+1,2)},d(n,e){return Ei(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ei(n.getHours()%12||12,e.length)},H(n,e){return Ei(n.getHours(),e.length)},m(n,e){return Ei(n.getMinutes(),e.length)},s(n,e){return Ei(n.getSeconds(),e.length)},S(n,e){const i=e.length,a=n.getMilliseconds(),l=Math.trunc(a*Math.pow(10,i-3));return Ei(l,e.length)}},TS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},uQ={G:function(n,e,i){const a=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const a=n.getFullYear(),l=a>0?a:1-a;return i.ordinalNumber(l,{unit:"year"})}return ng.y(n,e)},Y:function(n,e,i,a){const l=koe(n,a),d=l>0?l:1-l;if(e==="YY"){const p=d%100;return Ei(p,2)}return e==="Yo"?i.ordinalNumber(d,{unit:"year"}):Ei(d,e.length)},R:function(n,e){const i=Ooe(n);return Ei(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ei(i,e.length)},Q:function(n,e,i){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(a);case"QQ":return Ei(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,e,i){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(a);case"qq":return Ei(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,e,i){const a=n.getMonth();switch(e){case"M":case"MM":return ng.M(n,e);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(n,e,i){const a=n.getMonth();switch(e){case"L":return String(a+1);case"LL":return Ei(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(n,e,i,a){const l=X8e(n,a);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ei(l,e.length)},I:function(n,e,i){const a=q8e(n);return e==="Io"?i.ordinalNumber(a,{unit:"week"}):Ei(a,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):ng.d(n,e)},D:function(n,e,i){const a=K8e(n);return e==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):Ei(a,e.length)},E:function(n,e,i){const a=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(n,e,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return Ei(d,2);case"eo":return i.ordinalNumber(d,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,a){const l=n.getDay(),d=(l-a.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return Ei(d,e.length);case"co":return i.ordinalNumber(d,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const a=n.getDay(),l=a===0?7:a;switch(e){case"i":return String(l);case"ii":return Ei(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const a=n.getHours();let l;switch(a===12?l=TS.noon:a===0?l=TS.midnight:l=a/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const a=n.getHours();let l;switch(a>=17?l=TS.evening:a>=12?l=TS.afternoon:a>=4?l=TS.morning:l=TS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let a=n.getHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return ng.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):ng.H(n,e)},K:function(n,e,i){const a=n.getHours()%12;return e==="Ko"?i.ordinalNumber(a,{unit:"hour"}):Ei(a,e.length)},k:function(n,e,i){let a=n.getHours();return a===0&&(a=24),e==="ko"?i.ordinalNumber(a,{unit:"hour"}):Ei(a,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):ng.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):ng.s(n,e)},S:function(n,e){return ng.S(n,e)},X:function(n,e,i){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return hQ(a);case"XXXX":case"XX":return hy(a);case"XXXXX":case"XXX":default:return hy(a,":")}},x:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"x":return hQ(a);case"xxxx":case"xx":return hy(a);case"xxxxx":case"xxx":default:return hy(a,":")}},O:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+dQ(a,":");case"OOOO":default:return"GMT"+hy(a,":")}},z:function(n,e,i){const a=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+dQ(a,":");case"zzzz":default:return"GMT"+hy(a,":")}},t:function(n,e,i){const a=Math.trunc(n.getTime()/1e3);return Ei(a,e.length)},T:function(n,e,i){const a=n.getTime();return Ei(a,e.length)}};function dQ(n,e=""){const i=n>0?"-":"+",a=Math.abs(n),l=Math.trunc(a/60),d=a%60;return d===0?i+String(l):i+String(l)+e+Ei(d,2)}function hQ(n,e){return n%60===0?(n>0?"-":"+")+Ei(Math.abs(n)/60,2):hy(n,e)}function hy(n,e=""){const i=n>0?"-":"+",a=Math.abs(n),l=Ei(Math.trunc(a/60),2),d=Ei(a%60,2);return i+l+e+d}const fQ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Noe=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},J8e=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],a=i[1],l=i[2];if(!l)return fQ(n,e);let d;switch(a){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",fQ(a,e)).replace("{{time}}",Noe(l,e))},Q8e={p:Noe,P:J8e},Z8e=/^D+$/,eze=/^Y+$/,tze=["D","DD","YY","YYYY"];function nze(n){return Z8e.test(n)}function rze(n){return eze.test(n)}function ize(n,e,i){const a=sze(n,e,i);if(console.warn(a),tze.includes(n))throw new RangeError(a)}function sze(n,e,i){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${a} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const oze=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,aze=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,cze=/^'([^]*?)'?$/,lze=/''/g,uze=/[a-zA-Z]/;function dze(n,e,i){var w,A,N,V;const a=_N(),l=a.locale??$8e,d=a.firstWeekContainsDate??((A=(w=a.locale)==null?void 0:w.options)==null?void 0:A.firstWeekContainsDate)??1,p=a.weekStartsOn??((V=(N=a.locale)==null?void 0:N.options)==null?void 0:V.weekStartsOn)??0,y=Fd(n);if(!h8e(y))throw new RangeError("Invalid time value");let v=e.match(aze).map(F=>{const B=F[0];if(B==="p"||B==="P"){const W=Q8e[B];return W(F,l.formatLong)}return F}).join("").match(oze).map(F=>{if(F==="''")return{isToken:!1,value:"'"};const B=F[0];if(B==="'")return{isToken:!1,value:hze(F)};if(uQ[B])return{isToken:!0,value:F};if(B.match(uze))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:F}});l.localize.preprocessor&&(v=l.localize.preprocessor(y,v));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return v.map(F=>{if(!F.isToken)return F.value;const B=F.value;(rze(B)||nze(B))&&ize(B,e,String(n));const W=uQ[B[0]];return W(y,B,l.localize,b)}).join("")}function hze(n){const e=n.match(cze);return e?e[1].replace(lze,"'"):n}const fze=lf(mt),Doe=({name:n,timestamp:e,text:i,isCurrentUser:a})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:a});const l=e&&e.toDate?dze(e.toDate(),"HH:mm"):"Invalid date";return C.jsxs(fze,{display:"flex",flexDirection:"column",alignItems:a?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[C.jsxs(mt,{w:"auto",maxW:"80%",bg:a?"secondary.500":"primary.200",color:a?"white":"black",p:"10px",borderRadius:"10px",alignSelf:a?"flex-end":"flex-start",wordBreak:"break-word",children:[C.jsx(ot,{fontWeight:"bold",children:n}),C.jsx(ot,{children:i})]}),C.jsx(ot,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:a?"right":"left",children:l})]})};Doe.propTypes={name:_r.string.isRequired,timestamp:_r.object,text:_r.string.isRequired,isCurrentUser:_r.bool.isRequired};const pze=({spaceID:n})=>{const[e,i]=D.useState([]),{user:a}=D.useContext(Fo),l=D.useRef(null);return D.useEffect(()=>{const d=o8e(n,p=>{console.log("New messages received:",p),i(y=>[...y,...p]),he.log("Messages updated:",p)});return()=>d()},[n]),D.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),C.jsxs(mt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(d=>{const p=d.uid===(a==null?void 0:a.uid);return C.jsx(Doe,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),C.jsx("div",{ref:l})]})},mze=({spaceID:n})=>{},xoe=({spaceID:n})=>{const{user:e}=D.useContext(Fo);return e?C.jsxs(mt,{children:[C.jsx(mt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:C.jsx(pze,{spaceID:n})}),C.jsx(mt,{mt:"8px",children:C.jsx(mze,{spaceID:n})})]}):(console.log("No user found, returning login message"),C.jsx(mt,{children:C.jsx(ot,{children:"Please log in to view the chat."})}))},VO=document.getElementById("chat-root");if(VO){const n=VO.getAttribute("data-space-id"),e=VO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=D.useState(null);return D.useEffect(()=>{DC(e).then(l)},[]),a?C.jsx(A1,{theme:a,children:C.jsx(hN,{children:C.jsx(xoe,{spaceID:n})})}):C.jsx("div",{children:"Loading theme..."})};l1.createRoot(VO).render(C.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class gze extends D.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?C.jsx(mt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:C.jsx(ot,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const FO=document.getElementById("root");if(FO){const n=FO.getAttribute("data-space-id"),e=FO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=D.useState(null);return D.useEffect(()=>{DC(e).then(l);const d=()=>{document.hidden||DC(e).then(l)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]),a?C.jsx(A1,{theme:a,children:C.jsx(hN,{children:C.jsx(j4,{children:C.jsxs(ti,{spacing:4,align:"stretch",children:[C.jsxs(ei,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[C.jsx(ot,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),C.jsx(mt,{zIndex:"100",position:"relative",children:C.jsx(aoe,{})})]}),C.jsx(eV,{maxW:"container.xl",p:0,zIndex:"1",children:C.jsx(_te,{ratio:16/9,bg:"blue.100",m:0,children:C.jsx(mt,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:C.jsx(gze,{children:C.jsx(X4,{spaceID:n})})})})}),C.jsx(eV,{maxW:"container.xl",p:0,children:C.jsx(xoe,{spaceID:n})})]})})})}):C.jsx("div",{children:"Loading theme..."})};l1.createRoot(FO).render(C.jsx(i,{}))}else console.error("Root element 'root' not found.");export{Mye as a,cSe as b,ji as c,sSe as d,yze as e,_ze as f,Jve as g,Nu as i,Gh as m,oRe as t};
