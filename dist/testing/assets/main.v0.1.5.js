function BEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $g(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zM={exports:{}},jT={},WM={exports:{}},Lr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QK;function zEe(){if(QK)return Lr;QK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),p=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),w=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),R=Symbol.iterator;function N(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=R&&Ee[R]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,F={};function z(Ee,Ne,je){this.props=Ee,this.context=Ne,this.refs=F,this.updater=je||M}z.prototype.isReactComponent={},z.prototype.setState=function(Ee,Ne){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ne,"setState")},z.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function q(){}q.prototype=z.prototype;function K(Ee,Ne,je){this.props=Ee,this.context=Ne,this.refs=F,this.updater=je||M}var re=K.prototype=new q;re.constructor=K,D(re,z.prototype),re.isPureReactComponent=!0;var ce=Array.isArray,se=Object.prototype.hasOwnProperty,ge={current:null},X={key:!0,ref:!0,__self:!0,__source:!0};function J(Ee,Ne,je){var qe,at={},_t=null,ut=null;if(Ne!=null)for(qe in Ne.ref!==void 0&&(ut=Ne.ref),Ne.key!==void 0&&(_t=""+Ne.key),Ne)se.call(Ne,qe)&&!X.hasOwnProperty(qe)&&(at[qe]=Ne[qe]);var vt=arguments.length-2;if(vt===1)at.children=je;else if(1<vt){for(var it=Array(vt),wt=0;wt<vt;wt++)it[wt]=arguments[wt+2];at.children=it}if(Ee&&Ee.defaultProps)for(qe in vt=Ee.defaultProps,vt)at[qe]===void 0&&(at[qe]=vt[qe]);return{$$typeof:n,type:Ee,key:_t,ref:ut,props:at,_owner:ge.current}}function te(Ee,Ne){return{$$typeof:n,type:Ee.type,key:Ne,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function ne(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===n}function de(Ee){var Ne={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(je){return Ne[je]})}var pe=/\/+/g;function he(Ee,Ne){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?de(""+Ee.key):Ne.toString(36)}function ve(Ee,Ne,je,qe,at){var _t=typeof Ee;(_t==="undefined"||_t==="boolean")&&(Ee=null);var ut=!1;if(Ee===null)ut=!0;else switch(_t){case"string":case"number":ut=!0;break;case"object":switch(Ee.$$typeof){case n:case e:ut=!0}}if(ut)return ut=Ee,at=at(ut),Ee=qe===""?"."+he(ut,0):qe,ce(at)?(je="",Ee!=null&&(je=Ee.replace(pe,"$&/")+"/"),ve(at,Ne,je,"",function(wt){return wt})):at!=null&&(ne(at)&&(at=te(at,je+(!at.key||ut&&ut.key===at.key?"":(""+at.key).replace(pe,"$&/")+"/")+Ee)),Ne.push(at)),1;if(ut=0,qe=qe===""?".":qe+":",ce(Ee))for(var vt=0;vt<Ee.length;vt++){_t=Ee[vt];var it=qe+he(_t,vt);ut+=ve(_t,Ne,je,it,at)}else if(it=N(Ee),typeof it=="function")for(Ee=it.call(Ee),vt=0;!(_t=Ee.next()).done;)_t=_t.value,it=qe+he(_t,vt++),ut+=ve(_t,Ne,je,it,at);else if(_t==="object")throw Ne=String(Ee),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.");return ut}function Te(Ee,Ne,je){if(Ee==null)return Ee;var qe=[],at=0;return ve(Ee,qe,"","",function(_t){return Ne.call(je,_t,at++)}),qe}function Fe(Ee){if(Ee._status===-1){var Ne=Ee._result;Ne=Ne(),Ne.then(function(je){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=je)},function(je){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=je)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ne)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var be={current:null},Re={transition:null},Ae={ReactCurrentDispatcher:be,ReactCurrentBatchConfig:Re,ReactCurrentOwner:ge};function xe(){throw Error("act(...) is not supported in production builds of React.")}return Lr.Children={map:Te,forEach:function(Ee,Ne,je){Te(Ee,function(){Ne.apply(this,arguments)},je)},count:function(Ee){var Ne=0;return Te(Ee,function(){Ne++}),Ne},toArray:function(Ee){return Te(Ee,function(Ne){return Ne})||[]},only:function(Ee){if(!ne(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},Lr.Component=z,Lr.Fragment=i,Lr.Profiler=l,Lr.PureComponent=K,Lr.StrictMode=o,Lr.Suspense=v,Lr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ae,Lr.act=xe,Lr.cloneElement=function(Ee,Ne,je){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var qe=D({},Ee.props),at=Ee.key,_t=Ee.ref,ut=Ee._owner;if(Ne!=null){if(Ne.ref!==void 0&&(_t=Ne.ref,ut=ge.current),Ne.key!==void 0&&(at=""+Ne.key),Ee.type&&Ee.type.defaultProps)var vt=Ee.type.defaultProps;for(it in Ne)se.call(Ne,it)&&!X.hasOwnProperty(it)&&(qe[it]=Ne[it]===void 0&&vt!==void 0?vt[it]:Ne[it])}var it=arguments.length-2;if(it===1)qe.children=je;else if(1<it){vt=Array(it);for(var wt=0;wt<it;wt++)vt[wt]=arguments[wt+2];qe.children=vt}return{$$typeof:n,type:Ee.type,key:at,ref:_t,props:qe,_owner:ut}},Lr.createContext=function(Ee){return Ee={$$typeof:p,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:u,_context:Ee},Ee.Consumer=Ee},Lr.createElement=J,Lr.createFactory=function(Ee){var Ne=J.bind(null,Ee);return Ne.type=Ee,Ne},Lr.createRef=function(){return{current:null}},Lr.forwardRef=function(Ee){return{$$typeof:y,render:Ee}},Lr.isValidElement=ne,Lr.lazy=function(Ee){return{$$typeof:C,_payload:{_status:-1,_result:Ee},_init:Fe}},Lr.memo=function(Ee,Ne){return{$$typeof:w,type:Ee,compare:Ne===void 0?null:Ne}},Lr.startTransition=function(Ee){var Ne=Re.transition;Re.transition={};try{Ee()}finally{Re.transition=Ne}},Lr.unstable_act=xe,Lr.useCallback=function(Ee,Ne){return be.current.useCallback(Ee,Ne)},Lr.useContext=function(Ee){return be.current.useContext(Ee)},Lr.useDebugValue=function(){},Lr.useDeferredValue=function(Ee){return be.current.useDeferredValue(Ee)},Lr.useEffect=function(Ee,Ne){return be.current.useEffect(Ee,Ne)},Lr.useId=function(){return be.current.useId()},Lr.useImperativeHandle=function(Ee,Ne,je){return be.current.useImperativeHandle(Ee,Ne,je)},Lr.useInsertionEffect=function(Ee,Ne){return be.current.useInsertionEffect(Ee,Ne)},Lr.useLayoutEffect=function(Ee,Ne){return be.current.useLayoutEffect(Ee,Ne)},Lr.useMemo=function(Ee,Ne){return be.current.useMemo(Ee,Ne)},Lr.useReducer=function(Ee,Ne,je){return be.current.useReducer(Ee,Ne,je)},Lr.useRef=function(Ee){return be.current.useRef(Ee)},Lr.useState=function(Ee){return be.current.useState(Ee)},Lr.useSyncExternalStore=function(Ee,Ne,je){return be.current.useSyncExternalStore(Ee,Ne,je)},Lr.useTransition=function(){return be.current.useTransition()},Lr.version="18.3.1",Lr}var ZK;function Zf(){return ZK||(ZK=1,WM.exports=zEe()),WM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eq;function WEe(){if(eq)return jT;eq=1;var n=Zf(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function p(y,v,w){var C,R={},N=null,M=null;w!==void 0&&(N=""+w),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(M=v.ref);for(C in v)o.call(v,C)&&!u.hasOwnProperty(C)&&(R[C]=v[C]);if(y&&y.defaultProps)for(C in v=y.defaultProps,v)R[C]===void 0&&(R[C]=v[C]);return{$$typeof:e,type:y,key:N,ref:M,props:R,_owner:l.current}}return jT.Fragment=i,jT.jsx=p,jT.jsxs=p,jT}var tq;function GEe(){return tq||(tq=1,zM.exports=WEe()),zM.exports}var S=GEe(),O=Zf();const bi=$g(O),nq=BEe({__proto__:null,default:bi},[O]);var V1={},GM={exports:{}},ll={},HM={exports:{}},$M={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rq;function HEe(){return rq||(rq=1,function(n){function e(Re,Ae){var xe=Re.length;Re.push(Ae);e:for(;0<xe;){var Ee=xe-1>>>1,Ne=Re[Ee];if(0<l(Ne,Ae))Re[Ee]=Ae,Re[xe]=Ne,xe=Ee;else break e}}function i(Re){return Re.length===0?null:Re[0]}function o(Re){if(Re.length===0)return null;var Ae=Re[0],xe=Re.pop();if(xe!==Ae){Re[0]=xe;e:for(var Ee=0,Ne=Re.length,je=Ne>>>1;Ee<je;){var qe=2*(Ee+1)-1,at=Re[qe],_t=qe+1,ut=Re[_t];if(0>l(at,xe))_t<Ne&&0>l(ut,at)?(Re[Ee]=ut,Re[_t]=xe,Ee=_t):(Re[Ee]=at,Re[qe]=xe,Ee=qe);else if(_t<Ne&&0>l(ut,xe))Re[Ee]=ut,Re[_t]=xe,Ee=_t;else break e}}return Ae}function l(Re,Ae){var xe=Re.sortIndex-Ae.sortIndex;return xe!==0?xe:Re.id-Ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var p=Date,y=p.now();n.unstable_now=function(){return p.now()-y}}var v=[],w=[],C=1,R=null,N=3,M=!1,D=!1,F=!1,z=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Re){for(var Ae=i(w);Ae!==null;){if(Ae.callback===null)o(w);else if(Ae.startTime<=Re)o(w),Ae.sortIndex=Ae.expirationTime,e(v,Ae);else break;Ae=i(w)}}function ce(Re){if(F=!1,re(Re),!D)if(i(v)!==null)D=!0,Fe(se);else{var Ae=i(w);Ae!==null&&be(ce,Ae.startTime-Re)}}function se(Re,Ae){D=!1,F&&(F=!1,q(J),J=-1),M=!0;var xe=N;try{for(re(Ae),R=i(v);R!==null&&(!(R.expirationTime>Ae)||Re&&!de());){var Ee=R.callback;if(typeof Ee=="function"){R.callback=null,N=R.priorityLevel;var Ne=Ee(R.expirationTime<=Ae);Ae=n.unstable_now(),typeof Ne=="function"?R.callback=Ne:R===i(v)&&o(v),re(Ae)}else o(v);R=i(v)}if(R!==null)var je=!0;else{var qe=i(w);qe!==null&&be(ce,qe.startTime-Ae),je=!1}return je}finally{R=null,N=xe,M=!1}}var ge=!1,X=null,J=-1,te=5,ne=-1;function de(){return!(n.unstable_now()-ne<te)}function pe(){if(X!==null){var Re=n.unstable_now();ne=Re;var Ae=!0;try{Ae=X(!0,Re)}finally{Ae?he():(ge=!1,X=null)}}else ge=!1}var he;if(typeof K=="function")he=function(){K(pe)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,Te=ve.port2;ve.port1.onmessage=pe,he=function(){Te.postMessage(null)}}else he=function(){z(pe,0)};function Fe(Re){X=Re,ge||(ge=!0,he())}function be(Re,Ae){J=z(function(){Re(n.unstable_now())},Ae)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){D||M||(D=!0,Fe(se))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return N},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Re){switch(N){case 1:case 2:case 3:var Ae=3;break;default:Ae=N}var xe=N;N=Ae;try{return Re()}finally{N=xe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,Ae){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var xe=N;N=Re;try{return Ae()}finally{N=xe}},n.unstable_scheduleCallback=function(Re,Ae,xe){var Ee=n.unstable_now();switch(typeof xe=="object"&&xe!==null?(xe=xe.delay,xe=typeof xe=="number"&&0<xe?Ee+xe:Ee):xe=Ee,Re){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=xe+Ne,Re={id:C++,callback:Ae,priorityLevel:Re,startTime:xe,expirationTime:Ne,sortIndex:-1},xe>Ee?(Re.sortIndex=xe,e(w,Re),i(v)===null&&Re===i(w)&&(F?(q(J),J=-1):F=!0,be(ce,xe-Ee))):(Re.sortIndex=Ne,e(v,Re),D||M||(D=!0,Fe(se))),Re},n.unstable_shouldYield=de,n.unstable_wrapCallback=function(Re){var Ae=N;return function(){var xe=N;N=Ae;try{return Re.apply(this,arguments)}finally{N=xe}}}}($M)),$M}var iq;function $Ee(){return iq||(iq=1,HM.exports=HEe()),HM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sq;function KEe(){if(sq)return ll;sq=1;var n=Zf(),e=$Ee();function i(f){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)_+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(f,_){p(f,_),p(f+"Capture",_)}function p(f,_){for(l[f]=_,f=0;f<_.length;f++)o.add(_[f])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,w=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},R={};function N(f){return v.call(R,f)?!0:v.call(C,f)?!1:w.test(f)?R[f]=!0:(C[f]=!0,!1)}function M(f,_,T,x){if(T!==null&&T.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return x?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function D(f,_,T,x){if(_===null||typeof _>"u"||M(f,_,T,x))return!0;if(x)return!1;if(T!==null)switch(T.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function F(f,_,T,x,V,$,fe){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=x,this.attributeNamespace=V,this.mustUseProperty=T,this.propertyName=f,this.type=_,this.sanitizeURL=$,this.removeEmptyString=fe}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){z[f]=new F(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var _=f[0];z[_]=new F(_,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){z[f]=new F(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){z[f]=new F(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){z[f]=new F(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){z[f]=new F(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){z[f]=new F(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){z[f]=new F(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){z[f]=new F(f,5,!1,f.toLowerCase(),null,!1,!1)});var q=/[\-:]([a-z])/g;function K(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var _=f.replace(q,K);z[_]=new F(_,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var _=f.replace(q,K);z[_]=new F(_,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var _=f.replace(q,K);z[_]=new F(_,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){z[f]=new F(f,1,!1,f.toLowerCase(),null,!1,!1)}),z.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){z[f]=new F(f,1,!1,f.toLowerCase(),null,!0,!0)});function re(f,_,T,x){var V=z.hasOwnProperty(_)?z[_]:null;(V!==null?V.type!==0:x||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(D(_,T,V,x)&&(T=null),x||V===null?N(_)&&(T===null?f.removeAttribute(_):f.setAttribute(_,""+T)):V.mustUseProperty?f[V.propertyName]=T===null?V.type===3?!1:"":T:(_=V.attributeName,x=V.attributeNamespace,T===null?f.removeAttribute(_):(V=V.type,T=V===3||V===4&&T===!0?"":""+T,x?f.setAttributeNS(x,_,T):f.setAttribute(_,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ge=Symbol.for("react.portal"),X=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),te=Symbol.for("react.profiler"),ne=Symbol.for("react.provider"),de=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),ve=Symbol.for("react.suspense_list"),Te=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),be=Symbol.for("react.offscreen"),Re=Symbol.iterator;function Ae(f){return f===null||typeof f!="object"?null:(f=Re&&f[Re]||f["@@iterator"],typeof f=="function"?f:null)}var xe=Object.assign,Ee;function Ne(f){if(Ee===void 0)try{throw Error()}catch(T){var _=T.stack.trim().match(/\n( *(at )?)/);Ee=_&&_[1]||""}return`
`+Ee+f}var je=!1;function qe(f,_){if(!f||je)return"";je=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(lt){var x=lt}Reflect.construct(f,[],_)}else{try{_.call()}catch(lt){x=lt}f.call(_.prototype)}else{try{throw Error()}catch(lt){x=lt}f()}}catch(lt){if(lt&&x&&typeof lt.stack=="string"){for(var V=lt.stack.split(`
`),$=x.stack.split(`
`),fe=V.length-1,ke=$.length-1;1<=fe&&0<=ke&&V[fe]!==$[ke];)ke--;for(;1<=fe&&0<=ke;fe--,ke--)if(V[fe]!==$[ke]){if(fe!==1||ke!==1)do if(fe--,ke--,0>ke||V[fe]!==$[ke]){var Ve=`
`+V[fe].replace(" at new "," at ");return f.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",f.displayName)),Ve}while(1<=fe&&0<=ke);break}}}finally{je=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?Ne(f):""}function at(f){switch(f.tag){case 5:return Ne(f.type);case 16:return Ne("Lazy");case 13:return Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 2:case 15:return f=qe(f.type,!1),f;case 11:return f=qe(f.type.render,!1),f;case 1:return f=qe(f.type,!0),f;default:return""}}function _t(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case X:return"Fragment";case ge:return"Portal";case te:return"Profiler";case J:return"StrictMode";case he:return"Suspense";case ve:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case de:return(f.displayName||"Context")+".Consumer";case ne:return(f._context.displayName||"Context")+".Provider";case pe:var _=f.render;return f=f.displayName,f||(f=_.displayName||_.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Te:return _=f.displayName||null,_!==null?_:_t(f.type)||"Memo";case Fe:_=f._payload,f=f._init;try{return _t(f(_))}catch{}}return null}function ut(f){var _=f.type;switch(f.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=_.render,f=f.displayName||f.name||"",_.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _t(_);case 8:return _===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function vt(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function it(f){var _=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function wt(f){var _=it(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,_),x=""+f[_];if(!f.hasOwnProperty(_)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var V=T.get,$=T.set;return Object.defineProperty(f,_,{configurable:!0,get:function(){return V.call(this)},set:function(fe){x=""+fe,$.call(this,fe)}}),Object.defineProperty(f,_,{enumerable:T.enumerable}),{getValue:function(){return x},setValue:function(fe){x=""+fe},stopTracking:function(){f._valueTracker=null,delete f[_]}}}}function $t(f){f._valueTracker||(f._valueTracker=wt(f))}function dt(f){if(!f)return!1;var _=f._valueTracker;if(!_)return!0;var T=_.getValue(),x="";return f&&(x=it(f)?f.checked?"true":"false":f.value),f=x,f!==T?(_.setValue(f),!0):!1}function mt(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function ct(f,_){var T=_.checked;return xe({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Ft(f,_){var T=_.defaultValue==null?"":_.defaultValue,x=_.checked!=null?_.checked:_.defaultChecked;T=vt(_.value!=null?_.value:T),f._wrapperState={initialChecked:x,initialValue:T,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function sn(f,_){_=_.checked,_!=null&&re(f,"checked",_,!1)}function Ht(f,_){sn(f,_);var T=vt(_.value),x=_.type;if(T!=null)x==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(x==="submit"||x==="reset"){f.removeAttribute("value");return}_.hasOwnProperty("value")?De(f,_.type,T):_.hasOwnProperty("defaultValue")&&De(f,_.type,vt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(f.defaultChecked=!!_.defaultChecked)}function we(f,_,T){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var x=_.type;if(!(x!=="submit"&&x!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+f._wrapperState.initialValue,T||_===f.value||(f.value=_),f.defaultValue=_}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function De(f,_,T){(_!=="number"||mt(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var $e=Array.isArray;function kt(f,_,T,x){if(f=f.options,_){_={};for(var V=0;V<T.length;V++)_["$"+T[V]]=!0;for(T=0;T<f.length;T++)V=_.hasOwnProperty("$"+f[T].value),f[T].selected!==V&&(f[T].selected=V),V&&x&&(f[T].defaultSelected=!0)}else{for(T=""+vt(T),_=null,V=0;V<f.length;V++){if(f[V].value===T){f[V].selected=!0,x&&(f[V].defaultSelected=!0);return}_!==null||f[V].disabled||(_=f[V])}_!==null&&(_.selected=!0)}}function At(f,_){if(_.dangerouslySetInnerHTML!=null)throw Error(i(91));return xe({},_,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Tt(f,_){var T=_.value;if(T==null){if(T=_.children,_=_.defaultValue,T!=null){if(_!=null)throw Error(i(92));if($e(T)){if(1<T.length)throw Error(i(93));T=T[0]}_=T}_==null&&(_=""),T=_}f._wrapperState={initialValue:vt(T)}}function Ut(f,_){var T=vt(_.value),x=vt(_.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),_.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),x!=null&&(f.defaultValue=""+x)}function Sn(f){var _=f.textContent;_===f._wrapperState.initialValue&&_!==""&&_!==null&&(f.value=_)}function Pn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hn(f,_){return f==null||f==="http://www.w3.org/1999/xhtml"?Pn(_):f==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Rt,Zn=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,T,x,V){MSApp.execUnsafeLocalFunction(function(){return f(_,T,x,V)})}:f}(function(f,_){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=_;else{for(Rt=Rt||document.createElement("div"),Rt.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=Rt.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;_.firstChild;)f.appendChild(_.firstChild)}});function Dt(f,_){if(_){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=_;return}}f.textContent=_}var Xt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vr=["Webkit","ms","Moz","O"];Object.keys(Xt).forEach(function(f){Vr.forEach(function(_){_=_+f.charAt(0).toUpperCase()+f.substring(1),Xt[_]=Xt[f]})});function Oi(f,_,T){return _==null||typeof _=="boolean"||_===""?"":T||typeof _!="number"||_===0||Xt.hasOwnProperty(f)&&Xt[f]?(""+_).trim():_+"px"}function li(f,_){f=f.style;for(var T in _)if(_.hasOwnProperty(T)){var x=T.indexOf("--")===0,V=Oi(T,_[T],x);T==="float"&&(T="cssFloat"),x?f.setProperty(T,V):f[T]=V}}var Ni=xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Es(f,_){if(_){if(Ni[f]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(i(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(i(61))}if(_.style!=null&&typeof _.style!="object")throw Error(i(62))}}function Yo(f,_){if(f.indexOf("-")===-1)return typeof _.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qi=null;function xi(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Kn=null,ps=null,ha=null;function Xo(f){if(f=f_(f)){if(typeof Kn!="function")throw Error(i(280));var _=f.stateNode;_&&(_=OE(_),Kn(f.stateNode,f.type,_))}}function go(f){ps?ha?ha.push(f):ha=[f]:ps=f}function ld(){if(ps){var f=ps,_=ha;if(ha=ps=null,Xo(f),_)for(f=0;f<_.length;f++)Xo(_[f])}}function Jo(f,_){return f(_)}function ud(){}var fc=!1;function Ao(f,_,T){if(fc)return f(_,T);fc=!0;try{return Jo(f,_,T)}finally{fc=!1,(ps!==null||ha!==null)&&(ud(),ld())}}function wr(f,_){var T=f.stateNode;if(T===null)return null;var x=OE(T);if(x===null)return null;T=x[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(f=f.type,x=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!x;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,_,typeof T));return T}var uu=!1;if(y)try{var pa={};Object.defineProperty(pa,"passive",{get:function(){uu=!0}}),window.addEventListener("test",pa,pa),window.removeEventListener("test",pa,pa)}catch{uu=!1}function Ba(f,_,T,x,V,$,fe,ke,Ve){var lt=Array.prototype.slice.call(arguments,3);try{_.apply(T,lt)}catch(xt){this.onError(xt)}}var Vc=!1,Qo=null,Zo=!1,dd=null,gh={onError:function(f){Vc=!0,Qo=f}};function Tl(f,_,T,x,V,$,fe,ke,Ve){Vc=!1,Qo=null,Ba.apply(gh,arguments)}function _h(f,_,T,x,V,$,fe,ke,Ve){if(Tl.apply(this,arguments),Vc){if(Vc){var lt=Qo;Vc=!1,Qo=null}else throw Error(i(198));Zo||(Zo=!0,dd=lt)}}function xs(f){var _=f,T=f;if(f.alternate)for(;_.return;)_=_.return;else{f=_;do _=f,(_.flags&4098)!==0&&(T=_.return),f=_.return;while(f)}return _.tag===3?T:null}function pt(f){if(f.tag===13){var _=f.memoizedState;if(_===null&&(f=f.alternate,f!==null&&(_=f.memoizedState)),_!==null)return _.dehydrated}return null}function rn(f){if(xs(f)!==f)throw Error(i(188))}function kr(f){var _=f.alternate;if(!_){if(_=xs(f),_===null)throw Error(i(188));return _!==f?null:f}for(var T=f,x=_;;){var V=T.return;if(V===null)break;var $=V.alternate;if($===null){if(x=V.return,x!==null){T=x;continue}break}if(V.child===$.child){for($=V.child;$;){if($===T)return rn(V),f;if($===x)return rn(V),_;$=$.sibling}throw Error(i(188))}if(T.return!==x.return)T=V,x=$;else{for(var fe=!1,ke=V.child;ke;){if(ke===T){fe=!0,T=V,x=$;break}if(ke===x){fe=!0,x=V,T=$;break}ke=ke.sibling}if(!fe){for(ke=$.child;ke;){if(ke===T){fe=!0,T=$,x=V;break}if(ke===x){fe=!0,x=$,T=V;break}ke=ke.sibling}if(!fe)throw Error(i(189))}}if(T.alternate!==x)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:_}function Di(f){return f=kr(f),f!==null?mc(f):null}function mc(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var _=mc(f);if(_!==null)return _;f=f.sibling}return null}var _o=e.unstable_scheduleCallback,Cl=e.unstable_cancelCallback,yh=e.unstable_shouldYield,Ks=e.unstable_requestPaint,Gr=e.unstable_now,Eh=e.unstable_getCurrentPriorityLevel,Hr=e.unstable_ImmediatePriority,fa=e.unstable_UserBlockingPriority,Yi=e.unstable_NormalPriority,vs=e.unstable_LowPriority,ri=e.unstable_IdlePriority,Fc=null,ma=null;function jp(f){if(ma&&typeof ma.onCommitFiberRoot=="function")try{ma.onCommitFiberRoot(Fc,f,void 0,(f.current.flags&128)===128)}catch{}}var Po=Math.clz32?Math.clz32:Rl,Bp=Math.log,nm=Math.LN2;function Rl(f){return f>>>=0,f===0?32:31-(Bp(f)/nm|0)|0}var du=64,vh=4194304;function Or(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function hd(f,_){var T=f.pendingLanes;if(T===0)return 0;var x=0,V=f.suspendedLanes,$=f.pingedLanes,fe=T&268435455;if(fe!==0){var ke=fe&~V;ke!==0?x=Or(ke):($&=fe,$!==0&&(x=Or($)))}else fe=T&~V,fe!==0?x=Or(fe):$!==0&&(x=Or($));if(x===0)return 0;if(_!==0&&_!==x&&(_&V)===0&&(V=x&-x,$=_&-_,V>=$||V===16&&($&4194240)!==0))return _;if((x&4)!==0&&(x|=T&16),_=f.entangledLanes,_!==0)for(f=f.entanglements,_&=x;0<_;)T=31-Po(_),V=1<<T,x|=f[T],_&=~V;return x}function pd(f,_){switch(f){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function za(f,_){for(var T=f.suspendedLanes,x=f.pingedLanes,V=f.expirationTimes,$=f.pendingLanes;0<$;){var fe=31-Po($),ke=1<<fe,Ve=V[fe];Ve===-1?((ke&T)===0||(ke&x)!==0)&&(V[fe]=pd(ke,_)):Ve<=_&&(f.expiredLanes|=ke),$&=~ke}}function ga(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function fd(){var f=du;return du<<=1,(du&4194240)===0&&(du=64),f}function Il(f){for(var _=[],T=0;31>T;T++)_.push(f);return _}function hu(f,_,T){f.pendingLanes|=_,_!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,_=31-Po(_),f[_]=T}function ui(f,_){var T=f.pendingLanes&~_;f.pendingLanes=_,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=_,f.mutableReadLanes&=_,f.entangledLanes&=_,_=f.entanglements;var x=f.eventTimes;for(f=f.expirationTimes;0<T;){var V=31-Po(T),$=1<<V;_[V]=0,x[V]=-1,f[V]=-1,T&=~$}}function pu(f,_){var T=f.entangledLanes|=_;for(f=f.entanglements;T;){var x=31-Po(T),V=1<<x;V&_|f[x]&_&&(f[x]|=_),T&=~V}}var fr=0;function Al(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var Sh,bh,fu,rm,zp,Wp=!1,_a=[],Ss=null,ya=null,Ea=null,mu=new Map,va=new Map,Wa=[],Gp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jc(f,_){switch(f){case"focusin":case"focusout":Ss=null;break;case"dragenter":case"dragleave":ya=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":mu.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":va.delete(_.pointerId)}}function Ds(f,_,T,x,V,$){return f===null||f.nativeEvent!==$?(f={blockedOn:_,domEventName:T,eventSystemFlags:x,nativeEvent:$,targetContainers:[V]},_!==null&&(_=f_(_),_!==null&&bh(_)),f):(f.eventSystemFlags|=x,_=f.targetContainers,V!==null&&_.indexOf(V)===-1&&_.push(V),f)}function Zg(f,_,T,x,V){switch(_){case"focusin":return Ss=Ds(Ss,f,_,T,x,V),!0;case"dragenter":return ya=Ds(ya,f,_,T,x,V),!0;case"mouseover":return Ea=Ds(Ea,f,_,T,x,V),!0;case"pointerover":var $=V.pointerId;return mu.set($,Ds(mu.get($)||null,f,_,T,x,V)),!0;case"gotpointercapture":return $=V.pointerId,va.set($,Ds(va.get($)||null,f,_,T,x,V)),!0}return!1}function Pl(f){var _=Hp(f.target);if(_!==null){var T=xs(_);if(T!==null){if(_=T.tag,_===13){if(_=pt(T),_!==null){f.blockedOn=_,zp(f.priority,function(){fu(T)});return}}else if(_===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function kl(f){if(f.blockedOn!==null)return!1;for(var _=f.targetContainers;0<_.length;){var T=Fr(f.domEventName,f.eventSystemFlags,_[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var x=new T.constructor(T.type,T);qi=x,T.target.dispatchEvent(x),qi=null}else return _=f_(T),_!==null&&bh(_),f.blockedOn=T,!1;_.shift()}return!0}function gu(f,_,T){kl(f)&&T.delete(_)}function im(){Wp=!1,Ss!==null&&kl(Ss)&&(Ss=null),ya!==null&&kl(ya)&&(ya=null),Ea!==null&&kl(Ea)&&(Ea=null),mu.forEach(gu),va.forEach(gu)}function gc(f,_){f.blockedOn===_&&(f.blockedOn=null,Wp||(Wp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,im)))}function Sa(f){function _(V){return gc(V,f)}if(0<_a.length){gc(_a[0],f);for(var T=1;T<_a.length;T++){var x=_a[T];x.blockedOn===f&&(x.blockedOn=null)}}for(Ss!==null&&gc(Ss,f),ya!==null&&gc(ya,f),Ea!==null&&gc(Ea,f),mu.forEach(_),va.forEach(_),T=0;T<Wa.length;T++)x=Wa[T],x.blockedOn===f&&(x.blockedOn=null);for(;0<Wa.length&&(T=Wa[0],T.blockedOn===null);)Pl(T),T.blockedOn===null&&Wa.shift()}var Ol=ce.ReactCurrentBatchConfig,Ce=!0;function Me(f,_,T,x){var V=fr,$=Ol.transition;Ol.transition=null;try{fr=1,qt(f,_,T,x)}finally{fr=V,Ol.transition=$}}function ot(f,_,T,x){var V=fr,$=Ol.transition;Ol.transition=null;try{fr=4,qt(f,_,T,x)}finally{fr=V,Ol.transition=$}}function qt(f,_,T,x){if(Ce){var V=Fr(f,_,T,x);if(V===null)fb(f,_,x,sr,T),jc(f,x);else if(Zg(V,f,_,T,x))x.stopPropagation();else if(jc(f,x),_&4&&-1<Gp.indexOf(f)){for(;V!==null;){var $=f_(V);if($!==null&&Sh($),$=Fr(f,_,T,x),$===null&&fb(f,_,x,sr,T),$===V)break;V=$}V!==null&&x.stopPropagation()}else fb(f,_,x,null,T)}}var sr=null;function Fr(f,_,T,x){if(sr=null,f=xi(x),f=Hp(f),f!==null)if(_=xs(f),_===null)f=null;else if(T=_.tag,T===13){if(f=pt(_),f!==null)return f;f=null}else if(T===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;f=null}else _!==f&&(f=null);return sr=f,null}function ii(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Eh()){case Hr:return 1;case fa:return 4;case Yi:case vs:return 16;case ri:return 536870912;default:return 16}default:return 16}}var er=null,tr=null,Li=null;function qs(){if(Li)return Li;var f,_=tr,T=_.length,x,V="value"in er?er.value:er.textContent,$=V.length;for(f=0;f<T&&_[f]===V[f];f++);var fe=T-f;for(x=1;x<=fe&&_[T-x]===V[$-x];x++);return Li=V.slice(f,1<x?1-x:void 0)}function Bc(f){var _=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&_===13&&(f=13)):f=_,f===10&&(f=13),32<=f||f===13?f:0}function ko(){return!0}function _u(){return!1}function Ls(f){function _(T,x,V,$,fe){this._reactName=T,this._targetInst=V,this.type=x,this.nativeEvent=$,this.target=fe,this.currentTarget=null;for(var ke in f)f.hasOwnProperty(ke)&&(T=f[ke],this[ke]=T?T($):$[ke]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?ko:_u,this.isPropagationStopped=_u,this}return xe(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=ko)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=ko)},persist:function(){},isPersistent:ko}),_}var _c={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sm=Ls(_c),zc=xe({},_c,{view:0,detail:0}),e_=Ls(zc),wh,md,Th,yc=xe({},zc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Eu,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==Th&&(Th&&f.type==="mousemove"?(wh=f.screenX-Th.screenX,md=f.screenY-Th.screenY):md=wh=0,Th=f),wh)},movementY:function(f){return"movementY"in f?f.movementY:md}}),yu=Ls(yc),t_=xe({},yc,{dataTransfer:0}),yE=Ls(t_),om=xe({},zc,{relatedTarget:0}),am=Ls(om),EE=xe({},_c,{animationName:0,elapsedTime:0,pseudoElement:0}),Ga=Ls(EE),vE=xe({},_c,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),gd=Ls(vE),n_=xe({},_c,{data:0}),r_=Ls(n_),Gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ba={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bE(f){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(f):(f=SE[f])?!!_[f]:!1}function Eu(){return bE}var P=xe({},zc,{key:function(f){if(f.key){var _=Gn[f.key]||f.key;if(_!=="Unidentified")return _}return f.type==="keypress"?(f=Bc(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?ba[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Eu,charCode:function(f){return f.type==="keypress"?Bc(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Bc(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),H=Ls(P),ie=xe({},yc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Se=Ls(ie),Ye=xe({},zc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Eu}),ht=Ls(Ye),Kt=xe({},_c,{propertyName:0,elapsedTime:0,pseudoElement:0}),si=Ls(Kt),Ys=xe({},yc,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),dr=Ls(Ys),yo=[9,13,27,32],Ms=y&&"CompositionEvent"in window,Wc=null;y&&"documentMode"in document&&(Wc=document.documentMode);var Ha=y&&"TextEvent"in window&&!Wc,_d=y&&(!Ms||Wc&&8<Wc&&11>=Wc),cm=" ",rI=!1;function iI(f,_){switch(f){case"keyup":return yo.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ec(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var lm=!1;function cx(f,_){switch(f){case"compositionend":return Ec(_);case"keypress":return _.which!==32?null:(rI=!0,cm);case"textInput":return f=_.data,f===cm&&rI?null:f;default:return null}}function lx(f,_){if(lm)return f==="compositionend"||!Ms&&iI(f,_)?(f=qs(),Li=tr=er=null,lm=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return _d&&_.locale!=="ko"?null:_.data;default:return null}}var ux={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ib(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _==="input"?!!ux[f.type]:_==="textarea"}function sI(f,_,T,x){go(x),_=u_(_,"onChange"),0<_.length&&(T=new sm("onChange","change",null,T,x),f.push({event:T,listeners:_}))}var i_=null,um=null;function sb(f){gI(f,0)}function wE(f){var _=_m(f);if(dt(_))return f}function dx(f,_){if(f==="change")return _}var s_=!1;if(y){var ob;if(y){var ab="oninput"in document;if(!ab){var oI=document.createElement("div");oI.setAttribute("oninput","return;"),ab=typeof oI.oninput=="function"}ob=ab}else ob=!1;s_=ob&&(!document.documentMode||9<document.documentMode)}function yd(){i_&&(i_.detachEvent("onpropertychange",aI),um=i_=null)}function aI(f){if(f.propertyName==="value"&&wE(um)){var _=[];sI(_,um,f,xi(f)),Ao(sb,_)}}function hx(f,_,T){f==="focusin"?(yd(),i_=_,um=T,i_.attachEvent("onpropertychange",aI)):f==="focusout"&&yd()}function $a(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return wE(um)}function px(f,_){if(f==="click")return wE(_)}function fx(f,_){if(f==="input"||f==="change")return wE(_)}function mx(f,_){return f===_&&(f!==0||1/f===1/_)||f!==f&&_!==_}var Nl=typeof Object.is=="function"?Object.is:mx;function dm(f,_){if(Nl(f,_))return!0;if(typeof f!="object"||f===null||typeof _!="object"||_===null)return!1;var T=Object.keys(f),x=Object.keys(_);if(T.length!==x.length)return!1;for(x=0;x<T.length;x++){var V=T[x];if(!v.call(_,V)||!Nl(f[V],_[V]))return!1}return!0}function cI(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function lI(f,_){var T=cI(f);f=0;for(var x;T;){if(T.nodeType===3){if(x=f+T.textContent.length,f<=_&&x>=_)return{node:T,offset:_-f};f=x}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=cI(T)}}function uI(f,_){return f&&_?f===_?!0:f&&f.nodeType===3?!1:_&&_.nodeType===3?uI(f,_.parentNode):"contains"in f?f.contains(_):f.compareDocumentPosition?!!(f.compareDocumentPosition(_)&16):!1:!1}function cb(){for(var f=window,_=mt();_ instanceof f.HTMLIFrameElement;){try{var T=typeof _.contentWindow.location.href=="string"}catch{T=!1}if(T)f=_.contentWindow;else break;_=mt(f.document)}return _}function lb(f){var _=f&&f.nodeName&&f.nodeName.toLowerCase();return _&&(_==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||_==="textarea"||f.contentEditable==="true")}function gx(f){var _=cb(),T=f.focusedElem,x=f.selectionRange;if(_!==T&&T&&T.ownerDocument&&uI(T.ownerDocument.documentElement,T)){if(x!==null&&lb(T)){if(_=x.start,f=x.end,f===void 0&&(f=_),"selectionStart"in T)T.selectionStart=_,T.selectionEnd=Math.min(f,T.value.length);else if(f=(_=T.ownerDocument||document)&&_.defaultView||window,f.getSelection){f=f.getSelection();var V=T.textContent.length,$=Math.min(x.start,V);x=x.end===void 0?$:Math.min(x.end,V),!f.extend&&$>x&&(V=x,x=$,$=V),V=lI(T,$);var fe=lI(T,x);V&&fe&&(f.rangeCount!==1||f.anchorNode!==V.node||f.anchorOffset!==V.offset||f.focusNode!==fe.node||f.focusOffset!==fe.offset)&&(_=_.createRange(),_.setStart(V.node,V.offset),f.removeAllRanges(),$>x?(f.addRange(_),f.extend(fe.node,fe.offset)):(_.setEnd(fe.node,fe.offset),f.addRange(_)))}}for(_=[],f=T;f=f.parentNode;)f.nodeType===1&&_.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<_.length;T++)f=_[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var ub=y&&"documentMode"in document&&11>=document.documentMode,Ch=null,db=null,tt=null,hb=!1;function dI(f,_,T){var x=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;hb||Ch==null||Ch!==mt(x)||(x=Ch,"selectionStart"in x&&lb(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),tt&&dm(tt,x)||(tt=x,x=u_(db,"onSelect"),0<x.length&&(_=new sm("onSelect","select",null,_,T),f.push({event:_,listeners:x}),_.target=Ch)))}function TE(f,_){var T={};return T[f.toLowerCase()]=_.toLowerCase(),T["Webkit"+f]="webkit"+_,T["Moz"+f]="moz"+_,T}var hm={animationend:TE("Animation","AnimationEnd"),animationiteration:TE("Animation","AnimationIteration"),animationstart:TE("Animation","AnimationStart"),transitionend:TE("Transition","TransitionEnd")},CE={},pb={};y&&(pb=document.createElement("div").style,"AnimationEvent"in window||(delete hm.animationend.animation,delete hm.animationiteration.animation,delete hm.animationstart.animation),"TransitionEvent"in window||delete hm.transitionend.transition);function RE(f){if(CE[f])return CE[f];if(!hm[f])return f;var _=hm[f],T;for(T in _)if(_.hasOwnProperty(T)&&T in pb)return CE[f]=_[T];return f}var hI=RE("animationend"),pI=RE("animationiteration"),o_=RE("animationstart"),pm=RE("transitionend"),fI=new Map,mI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xl(f,_){fI.set(f,_),u(_,[f])}for(var a_=0;a_<mI.length;a_++){var fm=mI[a_],_x=fm.toLowerCase(),yx=fm[0].toUpperCase()+fm.slice(1);xl(_x,"on"+yx)}xl(hI,"onAnimationEnd"),xl(pI,"onAnimationIteration"),xl(o_,"onAnimationStart"),xl("dblclick","onDoubleClick"),xl("focusin","onFocus"),xl("focusout","onBlur"),xl(pm,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var c_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ex=new Set("cancel close invalid load scroll toggle".split(" ").concat(c_));function IE(f,_,T){var x=f.type||"unknown-event";f.currentTarget=T,_h(x,_,void 0,f),f.currentTarget=null}function gI(f,_){_=(_&4)!==0;for(var T=0;T<f.length;T++){var x=f[T],V=x.event;x=x.listeners;e:{var $=void 0;if(_)for(var fe=x.length-1;0<=fe;fe--){var ke=x[fe],Ve=ke.instance,lt=ke.currentTarget;if(ke=ke.listener,Ve!==$&&V.isPropagationStopped())break e;IE(V,ke,lt),$=Ve}else for(fe=0;fe<x.length;fe++){if(ke=x[fe],Ve=ke.instance,lt=ke.currentTarget,ke=ke.listener,Ve!==$&&V.isPropagationStopped())break e;IE(V,ke,lt),$=Ve}}}if(Zo)throw f=dd,Zo=!1,dd=null,f}function Mi(f,_){var T=_[yb];T===void 0&&(T=_[yb]=new Set);var x=f+"__bubble";T.has(x)||(_I(_,f,2,!1),T.add(x))}function Ka(f,_,T){var x=0;_&&(x|=4),_I(T,f,x,_)}var AE="_reactListening"+Math.random().toString(36).slice(2);function Ed(f){if(!f[AE]){f[AE]=!0,o.forEach(function(T){T!=="selectionchange"&&(Ex.has(T)||Ka(T,!1,f),Ka(T,!0,f))});var _=f.nodeType===9?f:f.ownerDocument;_===null||_[AE]||(_[AE]=!0,Ka("selectionchange",!1,_))}}function _I(f,_,T,x){switch(ii(_)){case 1:var V=Me;break;case 4:V=ot;break;default:V=qt}T=V.bind(null,_,T,f),V=void 0,!uu||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(V=!0),x?V!==void 0?f.addEventListener(_,T,{capture:!0,passive:V}):f.addEventListener(_,T,!0):V!==void 0?f.addEventListener(_,T,{passive:V}):f.addEventListener(_,T,!1)}function fb(f,_,T,x,V){var $=x;if((_&1)===0&&(_&2)===0&&x!==null)e:for(;;){if(x===null)return;var fe=x.tag;if(fe===3||fe===4){var ke=x.stateNode.containerInfo;if(ke===V||ke.nodeType===8&&ke.parentNode===V)break;if(fe===4)for(fe=x.return;fe!==null;){var Ve=fe.tag;if((Ve===3||Ve===4)&&(Ve=fe.stateNode.containerInfo,Ve===V||Ve.nodeType===8&&Ve.parentNode===V))return;fe=fe.return}for(;ke!==null;){if(fe=Hp(ke),fe===null)return;if(Ve=fe.tag,Ve===5||Ve===6){x=$=fe;continue e}ke=ke.parentNode}}x=x.return}Ao(function(){var lt=$,xt=xi(T),Lt=[];e:{var Nt=fI.get(f);if(Nt!==void 0){var on=sm,pn=f;switch(f){case"keypress":if(Bc(T)===0)break e;case"keydown":case"keyup":on=H;break;case"focusin":pn="focus",on=am;break;case"focusout":pn="blur",on=am;break;case"beforeblur":case"afterblur":on=am;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":on=yu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":on=yE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":on=ht;break;case hI:case pI:case o_:on=Ga;break;case pm:on=si;break;case"scroll":on=e_;break;case"wheel":on=dr;break;case"copy":case"cut":case"paste":on=gd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":on=Se}var mn=(_&4)!==0,is=!mn&&f==="scroll",Je=mn?Nt!==null?Nt+"Capture":null:Nt;mn=[];for(var Be=lt,nt;Be!==null;){nt=Be;var jt=nt.stateNode;if(nt.tag===5&&jt!==null&&(nt=jt,Je!==null&&(jt=wr(Be,Je),jt!=null&&mn.push(l_(Be,jt,nt)))),is)break;Be=Be.return}0<mn.length&&(Nt=new on(Nt,pn,null,T,xt),Lt.push({event:Nt,listeners:mn}))}}if((_&7)===0){e:{if(Nt=f==="mouseover"||f==="pointerover",on=f==="mouseout"||f==="pointerout",Nt&&T!==qi&&(pn=T.relatedTarget||T.fromElement)&&(Hp(pn)||pn[vd]))break e;if((on||Nt)&&(Nt=xt.window===xt?xt:(Nt=xt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,on?(pn=T.relatedTarget||T.toElement,on=lt,pn=pn?Hp(pn):null,pn!==null&&(is=xs(pn),pn!==is||pn.tag!==5&&pn.tag!==6)&&(pn=null)):(on=null,pn=lt),on!==pn)){if(mn=yu,jt="onMouseLeave",Je="onMouseEnter",Be="mouse",(f==="pointerout"||f==="pointerover")&&(mn=Se,jt="onPointerLeave",Je="onPointerEnter",Be="pointer"),is=on==null?Nt:_m(on),nt=pn==null?Nt:_m(pn),Nt=new mn(jt,Be+"leave",on,T,xt),Nt.target=is,Nt.relatedTarget=nt,jt=null,Hp(xt)===lt&&(mn=new mn(Je,Be+"enter",pn,T,xt),mn.target=nt,mn.relatedTarget=is,jt=mn),is=jt,on&&pn)t:{for(mn=on,Je=pn,Be=0,nt=mn;nt;nt=mm(nt))Be++;for(nt=0,jt=Je;jt;jt=mm(jt))nt++;for(;0<Be-nt;)mn=mm(mn),Be--;for(;0<nt-Be;)Je=mm(Je),nt--;for(;Be--;){if(mn===Je||Je!==null&&mn===Je.alternate)break t;mn=mm(mn),Je=mm(Je)}mn=null}else mn=null;on!==null&&yI(Lt,Nt,on,mn,!1),pn!==null&&is!==null&&yI(Lt,is,pn,mn,!0)}}e:{if(Nt=lt?_m(lt):window,on=Nt.nodeName&&Nt.nodeName.toLowerCase(),on==="select"||on==="input"&&Nt.type==="file")var gn=dx;else if(ib(Nt))if(s_)gn=fx;else{gn=$a;var kn=hx}else(on=Nt.nodeName)&&on.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(gn=px);if(gn&&(gn=gn(f,lt))){sI(Lt,gn,T,xt);break e}kn&&kn(f,Nt,lt),f==="focusout"&&(kn=Nt._wrapperState)&&kn.controlled&&Nt.type==="number"&&De(Nt,"number",Nt.value)}switch(kn=lt?_m(lt):window,f){case"focusin":(ib(kn)||kn.contentEditable==="true")&&(Ch=kn,db=lt,tt=null);break;case"focusout":tt=db=Ch=null;break;case"mousedown":hb=!0;break;case"contextmenu":case"mouseup":case"dragend":hb=!1,dI(Lt,T,xt);break;case"selectionchange":if(ub)break;case"keydown":case"keyup":dI(Lt,T,xt)}var On;if(Ms)e:{switch(f){case"compositionstart":var Un="onCompositionStart";break e;case"compositionend":Un="onCompositionEnd";break e;case"compositionupdate":Un="onCompositionUpdate";break e}Un=void 0}else lm?iI(f,T)&&(Un="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Un="onCompositionStart");Un&&(_d&&T.locale!=="ko"&&(lm||Un!=="onCompositionStart"?Un==="onCompositionEnd"&&lm&&(On=qs()):(er=xt,tr="value"in er?er.value:er.textContent,lm=!0)),kn=u_(lt,Un),0<kn.length&&(Un=new r_(Un,f,null,T,xt),Lt.push({event:Un,listeners:kn}),On?Un.data=On:(On=Ec(T),On!==null&&(Un.data=On)))),(On=Ha?cx(f,T):lx(f,T))&&(lt=u_(lt,"onBeforeInput"),0<lt.length&&(xt=new r_("onBeforeInput","beforeinput",null,T,xt),Lt.push({event:xt,listeners:lt}),xt.data=On))}gI(Lt,_)})}function l_(f,_,T){return{instance:f,listener:_,currentTarget:T}}function u_(f,_){for(var T=_+"Capture",x=[];f!==null;){var V=f,$=V.stateNode;V.tag===5&&$!==null&&(V=$,$=wr(f,T),$!=null&&x.unshift(l_(f,$,V)),$=wr(f,_),$!=null&&x.push(l_(f,$,V))),f=f.return}return x}function mm(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function yI(f,_,T,x,V){for(var $=_._reactName,fe=[];T!==null&&T!==x;){var ke=T,Ve=ke.alternate,lt=ke.stateNode;if(Ve!==null&&Ve===x)break;ke.tag===5&&lt!==null&&(ke=lt,V?(Ve=wr(T,$),Ve!=null&&fe.unshift(l_(T,Ve,ke))):V||(Ve=wr(T,$),Ve!=null&&fe.push(l_(T,Ve,ke)))),T=T.return}fe.length!==0&&f.push({event:_,listeners:fe})}var vx=/\r\n?/g,mb=/\u0000|\uFFFD/g;function EI(f){return(typeof f=="string"?f:""+f).replace(vx,`
`).replace(mb,"")}function d_(f,_,T){if(_=EI(_),EI(f)!==_&&T)throw Error(i(425))}function h_(){}var gb=null,PE=null;function gm(f,_){return f==="textarea"||f==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var _b=typeof setTimeout=="function"?setTimeout:void 0,Sx=typeof clearTimeout=="function"?clearTimeout:void 0,vI=typeof Promise=="function"?Promise:void 0,bx=typeof queueMicrotask=="function"?queueMicrotask:typeof vI<"u"?function(f){return vI.resolve(null).then(f).catch(wx)}:_b;function wx(f){setTimeout(function(){throw f})}function kE(f,_){var T=_,x=0;do{var V=T.nextSibling;if(f.removeChild(T),V&&V.nodeType===8)if(T=V.data,T==="/$"){if(x===0){f.removeChild(V),Sa(_);return}x--}else T!=="$"&&T!=="$?"&&T!=="$!"||x++;T=V}while(T);Sa(_)}function vu(f){for(;f!=null;f=f.nextSibling){var _=f.nodeType;if(_===1||_===3)break;if(_===8){if(_=f.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return f}function SI(f){f=f.previousSibling;for(var _=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(_===0)return f;_--}else T==="/$"&&_++}f=f.previousSibling}return null}var Rh=Math.random().toString(36).slice(2),Su="__reactFiber$"+Rh,p_="__reactProps$"+Rh,vd="__reactContainer$"+Rh,yb="__reactEvents$"+Rh,Tx="__reactListeners$"+Rh,Cx="__reactHandles$"+Rh;function Hp(f){var _=f[Su];if(_)return _;for(var T=f.parentNode;T;){if(_=T[vd]||T[Su]){if(T=_.alternate,_.child!==null||T!==null&&T.child!==null)for(f=SI(f);f!==null;){if(T=f[Su])return T;f=SI(f)}return _}f=T,T=f.parentNode}return null}function f_(f){return f=f[Su]||f[vd],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function _m(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function OE(f){return f[p_]||null}var Eb=[],Sd=-1;function Dl(f){return{current:f}}function Ti(f){0>Sd||(f.current=Eb[Sd],Eb[Sd]=null,Sd--)}function Ui(f,_){Sd++,Eb[Sd]=f.current,f.current=_}var Ih={},ea=Dl(Ih),wa=Dl(!1),Ah=Ih;function Ph(f,_){var T=f.type.contextTypes;if(!T)return Ih;var x=f.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===_)return x.__reactInternalMemoizedMaskedChildContext;var V={},$;for($ in T)V[$]=_[$];return x&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=_,f.__reactInternalMemoizedMaskedChildContext=V),V}function qa(f){return f=f.childContextTypes,f!=null}function NE(){Ti(wa),Ti(ea)}function ym(f,_,T){if(ea.current!==Ih)throw Error(i(168));Ui(ea,_),Ui(wa,T)}function bI(f,_,T){var x=f.stateNode;if(_=_.childContextTypes,typeof x.getChildContext!="function")return T;x=x.getChildContext();for(var V in x)if(!(V in _))throw Error(i(108,ut(f)||"Unknown",V));return xe({},T,x)}function xE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||Ih,Ah=ea.current,Ui(ea,f),Ui(wa,wa.current),!0}function wI(f,_,T){var x=f.stateNode;if(!x)throw Error(i(169));T?(f=bI(f,_,Ah),x.__reactInternalMemoizedMergedChildContext=f,Ti(wa),Ti(ea),Ui(ea,f)):Ti(wa),Ui(wa,T)}var bd=null,DE=!1,vb=!1;function Sb(f){bd===null?bd=[f]:bd.push(f)}function Rx(f){DE=!0,Sb(f)}function kh(){if(!vb&&bd!==null){vb=!0;var f=0,_=fr;try{var T=bd;for(fr=1;f<T.length;f++){var x=T[f];do x=x(!0);while(x!==null)}bd=null,DE=!1}catch(V){throw bd!==null&&(bd=bd.slice(f+1)),_o(Hr,kh),V}finally{fr=_,vb=!1}}return null}var Em=[],Oh=0,LE=null,ME=0,Ta=[],Gc=0,$p=null,wd=1,Td="";function Kp(f,_){Em[Oh++]=ME,Em[Oh++]=LE,LE=f,ME=_}function TI(f,_,T){Ta[Gc++]=wd,Ta[Gc++]=Td,Ta[Gc++]=$p,$p=f;var x=wd;f=Td;var V=32-Po(x)-1;x&=~(1<<V),T+=1;var $=32-Po(_)+V;if(30<$){var fe=V-V%5;$=(x&(1<<fe)-1).toString(32),x>>=fe,V-=fe,wd=1<<32-Po(_)+V|T<<V|x,Td=$+f}else wd=1<<$|T<<V|x,Td=f}function vm(f){f.return!==null&&(Kp(f,1),TI(f,1,0))}function UE(f){for(;f===LE;)LE=Em[--Oh],Em[Oh]=null,ME=Em[--Oh],Em[Oh]=null;for(;f===$p;)$p=Ta[--Gc],Ta[Gc]=null,Td=Ta[--Gc],Ta[Gc]=null,wd=Ta[--Gc],Ta[Gc]=null}var vc=null,Sc=null,zi=!1,Ll=null;function CI(f,_){var T=Yc(5,null,null,0);T.elementType="DELETED",T.stateNode=_,T.return=f,_=f.deletions,_===null?(f.deletions=[T],f.flags|=16):_.push(T)}function RI(f,_){switch(f.tag){case 5:var T=f.type;return _=_.nodeType!==1||T.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(f.stateNode=_,vc=f,Sc=vu(_.firstChild),!0):!1;case 6:return _=f.pendingProps===""||_.nodeType!==3?null:_,_!==null?(f.stateNode=_,vc=f,Sc=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(T=$p!==null?{id:wd,overflow:Td}:null,f.memoizedState={dehydrated:_,treeContext:T,retryLane:1073741824},T=Yc(18,null,null,0),T.stateNode=_,T.return=f,f.child=T,vc=f,Sc=null,!0):!1;default:return!1}}function m_(f){return(f.mode&1)!==0&&(f.flags&128)===0}function g_(f){if(zi){var _=Sc;if(_){var T=_;if(!RI(f,_)){if(m_(f))throw Error(i(418));_=vu(T.nextSibling);var x=vc;_&&RI(f,_)?CI(x,T):(f.flags=f.flags&-4097|2,zi=!1,vc=f)}}else{if(m_(f))throw Error(i(418));f.flags=f.flags&-4097|2,zi=!1,vc=f}}}function bb(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;vc=f}function Sm(f){if(f!==vc)return!1;if(!zi)return bb(f),zi=!0,!1;var _;if((_=f.tag!==3)&&!(_=f.tag!==5)&&(_=f.type,_=_!=="head"&&_!=="body"&&!gm(f.type,f.memoizedProps)),_&&(_=Sc)){if(m_(f))throw wb(),Error(i(418));for(;_;)CI(f,_),_=vu(_.nextSibling)}if(bb(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,_=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(_===0){Sc=vu(f.nextSibling);break e}_--}else T!=="$"&&T!=="$!"&&T!=="$?"||_++}f=f.nextSibling}Sc=null}}else Sc=vc?vu(f.stateNode.nextSibling):null;return!0}function wb(){for(var f=Sc;f;)f=vu(f.nextSibling)}function qp(){Sc=vc=null,zi=!1}function bm(f){Ll===null?Ll=[f]:Ll.push(f)}var __=ce.ReactCurrentBatchConfig;function y_(f,_,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var x=T.stateNode}if(!x)throw Error(i(147,f));var V=x,$=""+f;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===$?_.ref:(_=function(fe){var ke=V.refs;fe===null?delete ke[$]:ke[$]=fe},_._stringRef=$,_)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function VE(f,_){throw f=Object.prototype.toString.call(_),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":f))}function Tb(f){var _=f._init;return _(f._payload)}function II(f){function _(Je,Be){if(f){var nt=Je.deletions;nt===null?(Je.deletions=[Be],Je.flags|=16):nt.push(Be)}}function T(Je,Be){if(!f)return null;for(;Be!==null;)_(Je,Be),Be=Be.sibling;return null}function x(Je,Be){for(Je=new Map;Be!==null;)Be.key!==null?Je.set(Be.key,Be):Je.set(Be.index,Be),Be=Be.sibling;return Je}function V(Je,Be){return Je=Wh(Je,Be),Je.index=0,Je.sibling=null,Je}function $(Je,Be,nt){return Je.index=nt,f?(nt=Je.alternate,nt!==null?(nt=nt.index,nt<Be?(Je.flags|=2,Be):nt):(Je.flags|=2,Be)):(Je.flags|=1048576,Be)}function fe(Je){return f&&Je.alternate===null&&(Je.flags|=2),Je}function ke(Je,Be,nt,jt){return Be===null||Be.tag!==6?(Be=fv(nt,Je.mode,jt),Be.return=Je,Be):(Be=V(Be,nt),Be.return=Je,Be)}function Ve(Je,Be,nt,jt){var gn=nt.type;return gn===X?xt(Je,Be,nt.props.children,jt,nt.key):Be!==null&&(Be.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===Fe&&Tb(gn)===Be.type)?(jt=V(Be,nt.props),jt.ref=y_(Je,Be,nt),jt.return=Je,jt):(jt=Dm(nt.type,nt.key,nt.props,null,Je.mode,jt),jt.ref=y_(Je,Be,nt),jt.return=Je,jt)}function lt(Je,Be,nt,jt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==nt.containerInfo||Be.stateNode.implementation!==nt.implementation?(Be=Lm(nt,Je.mode,jt),Be.return=Je,Be):(Be=V(Be,nt.children||[]),Be.return=Je,Be)}function xt(Je,Be,nt,jt,gn){return Be===null||Be.tag!==7?(Be=Gh(nt,Je.mode,jt,gn),Be.return=Je,Be):(Be=V(Be,nt),Be.return=Je,Be)}function Lt(Je,Be,nt){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=fv(""+Be,Je.mode,nt),Be.return=Je,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case se:return nt=Dm(Be.type,Be.key,Be.props,null,Je.mode,nt),nt.ref=y_(Je,null,Be),nt.return=Je,nt;case ge:return Be=Lm(Be,Je.mode,nt),Be.return=Je,Be;case Fe:var jt=Be._init;return Lt(Je,jt(Be._payload),nt)}if($e(Be)||Ae(Be))return Be=Gh(Be,Je.mode,nt,null),Be.return=Je,Be;VE(Je,Be)}return null}function Nt(Je,Be,nt,jt){var gn=Be!==null?Be.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return gn!==null?null:ke(Je,Be,""+nt,jt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case se:return nt.key===gn?Ve(Je,Be,nt,jt):null;case ge:return nt.key===gn?lt(Je,Be,nt,jt):null;case Fe:return gn=nt._init,Nt(Je,Be,gn(nt._payload),jt)}if($e(nt)||Ae(nt))return gn!==null?null:xt(Je,Be,nt,jt,null);VE(Je,nt)}return null}function on(Je,Be,nt,jt,gn){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return Je=Je.get(nt)||null,ke(Be,Je,""+jt,gn);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case se:return Je=Je.get(jt.key===null?nt:jt.key)||null,Ve(Be,Je,jt,gn);case ge:return Je=Je.get(jt.key===null?nt:jt.key)||null,lt(Be,Je,jt,gn);case Fe:var kn=jt._init;return on(Je,Be,nt,kn(jt._payload),gn)}if($e(jt)||Ae(jt))return Je=Je.get(nt)||null,xt(Be,Je,jt,gn,null);VE(Be,jt)}return null}function pn(Je,Be,nt,jt){for(var gn=null,kn=null,On=Be,Un=Be=0,Zs=null;On!==null&&Un<nt.length;Un++){On.index>Un?(Zs=On,On=null):Zs=On.sibling;var Xr=Nt(Je,On,nt[Un],jt);if(Xr===null){On===null&&(On=Zs);break}f&&On&&Xr.alternate===null&&_(Je,On),Be=$(Xr,Be,Un),kn===null?gn=Xr:kn.sibling=Xr,kn=Xr,On=Zs}if(Un===nt.length)return T(Je,On),zi&&Kp(Je,Un),gn;if(On===null){for(;Un<nt.length;Un++)On=Lt(Je,nt[Un],jt),On!==null&&(Be=$(On,Be,Un),kn===null?gn=On:kn.sibling=On,kn=On);return zi&&Kp(Je,Un),gn}for(On=x(Je,On);Un<nt.length;Un++)Zs=on(On,Je,Un,nt[Un],jt),Zs!==null&&(f&&Zs.alternate!==null&&On.delete(Zs.key===null?Un:Zs.key),Be=$(Zs,Be,Un),kn===null?gn=Zs:kn.sibling=Zs,kn=Zs);return f&&On.forEach(function(Iu){return _(Je,Iu)}),zi&&Kp(Je,Un),gn}function mn(Je,Be,nt,jt){var gn=Ae(nt);if(typeof gn!="function")throw Error(i(150));if(nt=gn.call(nt),nt==null)throw Error(i(151));for(var kn=gn=null,On=Be,Un=Be=0,Zs=null,Xr=nt.next();On!==null&&!Xr.done;Un++,Xr=nt.next()){On.index>Un?(Zs=On,On=null):Zs=On.sibling;var Iu=Nt(Je,On,Xr.value,jt);if(Iu===null){On===null&&(On=Zs);break}f&&On&&Iu.alternate===null&&_(Je,On),Be=$(Iu,Be,Un),kn===null?gn=Iu:kn.sibling=Iu,kn=Iu,On=Zs}if(Xr.done)return T(Je,On),zi&&Kp(Je,Un),gn;if(On===null){for(;!Xr.done;Un++,Xr=nt.next())Xr=Lt(Je,Xr.value,jt),Xr!==null&&(Be=$(Xr,Be,Un),kn===null?gn=Xr:kn.sibling=Xr,kn=Xr);return zi&&Kp(Je,Un),gn}for(On=x(Je,On);!Xr.done;Un++,Xr=nt.next())Xr=on(On,Je,Un,Xr.value,jt),Xr!==null&&(f&&Xr.alternate!==null&&On.delete(Xr.key===null?Un:Xr.key),Be=$(Xr,Be,Un),kn===null?gn=Xr:kn.sibling=Xr,kn=Xr);return f&&On.forEach(function(Wx){return _(Je,Wx)}),zi&&Kp(Je,Un),gn}function is(Je,Be,nt,jt){if(typeof nt=="object"&&nt!==null&&nt.type===X&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case se:e:{for(var gn=nt.key,kn=Be;kn!==null;){if(kn.key===gn){if(gn=nt.type,gn===X){if(kn.tag===7){T(Je,kn.sibling),Be=V(kn,nt.props.children),Be.return=Je,Je=Be;break e}}else if(kn.elementType===gn||typeof gn=="object"&&gn!==null&&gn.$$typeof===Fe&&Tb(gn)===kn.type){T(Je,kn.sibling),Be=V(kn,nt.props),Be.ref=y_(Je,kn,nt),Be.return=Je,Je=Be;break e}T(Je,kn);break}else _(Je,kn);kn=kn.sibling}nt.type===X?(Be=Gh(nt.props.children,Je.mode,jt,nt.key),Be.return=Je,Je=Be):(jt=Dm(nt.type,nt.key,nt.props,null,Je.mode,jt),jt.ref=y_(Je,Be,nt),jt.return=Je,Je=jt)}return fe(Je);case ge:e:{for(kn=nt.key;Be!==null;){if(Be.key===kn)if(Be.tag===4&&Be.stateNode.containerInfo===nt.containerInfo&&Be.stateNode.implementation===nt.implementation){T(Je,Be.sibling),Be=V(Be,nt.children||[]),Be.return=Je,Je=Be;break e}else{T(Je,Be);break}else _(Je,Be);Be=Be.sibling}Be=Lm(nt,Je.mode,jt),Be.return=Je,Je=Be}return fe(Je);case Fe:return kn=nt._init,is(Je,Be,kn(nt._payload),jt)}if($e(nt))return pn(Je,Be,nt,jt);if(Ae(nt))return mn(Je,Be,nt,jt);VE(Je,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,Be!==null&&Be.tag===6?(T(Je,Be.sibling),Be=V(Be,nt),Be.return=Je,Je=Be):(T(Je,Be),Be=fv(nt,Je.mode,jt),Be.return=Je,Je=Be),fe(Je)):T(Je,Be)}return is}var wm=II(!0),Cb=II(!1),FE=Dl(null),jE=null,Tm=null,Rb=null;function Ib(){Rb=Tm=jE=null}function Ab(f){var _=FE.current;Ti(FE),f._currentValue=_}function BE(f,_,T){for(;f!==null;){var x=f.alternate;if((f.childLanes&_)!==_?(f.childLanes|=_,x!==null&&(x.childLanes|=_)):x!==null&&(x.childLanes&_)!==_&&(x.childLanes|=_),f===T)break;f=f.return}}function Ml(f,_){jE=f,Rb=Tm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&_)!==0&&(Xa=!0),f.firstContext=null)}function Hc(f){var _=f._currentValue;if(Rb!==f)if(f={context:f,memoizedValue:_,next:null},Tm===null){if(jE===null)throw Error(i(308));Tm=f,jE.dependencies={lanes:0,firstContext:f}}else Tm=Tm.next=f;return _}var Yp=null;function Pb(f){Yp===null?Yp=[f]:Yp.push(f)}function kb(f,_,T,x){var V=_.interleaved;return V===null?(T.next=T,Pb(_)):(T.next=V.next,V.next=T),_.interleaved=T,Cd(f,x)}function Cd(f,_){f.lanes|=_;var T=f.alternate;for(T!==null&&(T.lanes|=_),T=f,f=f.return;f!==null;)f.childLanes|=_,T=f.alternate,T!==null&&(T.childLanes|=_),T=f,f=f.return;return T.tag===3?T.stateNode:null}var Rd=!1;function Ob(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AI(f,_){f=f.updateQueue,_.updateQueue===f&&(_.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function Id(f,_){return{eventTime:f,lane:_,tag:0,payload:null,callback:null,next:null}}function Ul(f,_,T){var x=f.updateQueue;if(x===null)return null;if(x=x.shared,(Tr&2)!==0){var V=x.pending;return V===null?_.next=_:(_.next=V.next,V.next=_),x.pending=_,Cd(f,T)}return V=x.interleaved,V===null?(_.next=_,Pb(x)):(_.next=V.next,V.next=_),x.interleaved=_,Cd(f,T)}function zE(f,_,T){if(_=_.updateQueue,_!==null&&(_=_.shared,(T&4194240)!==0)){var x=_.lanes;x&=f.pendingLanes,T|=x,_.lanes=T,pu(f,T)}}function PI(f,_){var T=f.updateQueue,x=f.alternate;if(x!==null&&(x=x.updateQueue,T===x)){var V=null,$=null;if(T=T.firstBaseUpdate,T!==null){do{var fe={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};$===null?V=$=fe:$=$.next=fe,T=T.next}while(T!==null);$===null?V=$=_:$=$.next=_}else V=$=_;T={baseState:x.baseState,firstBaseUpdate:V,lastBaseUpdate:$,shared:x.shared,effects:x.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=_:f.next=_,T.lastBaseUpdate=_}function WE(f,_,T,x){var V=f.updateQueue;Rd=!1;var $=V.firstBaseUpdate,fe=V.lastBaseUpdate,ke=V.shared.pending;if(ke!==null){V.shared.pending=null;var Ve=ke,lt=Ve.next;Ve.next=null,fe===null?$=lt:fe.next=lt,fe=Ve;var xt=f.alternate;xt!==null&&(xt=xt.updateQueue,ke=xt.lastBaseUpdate,ke!==fe&&(ke===null?xt.firstBaseUpdate=lt:ke.next=lt,xt.lastBaseUpdate=Ve))}if($!==null){var Lt=V.baseState;fe=0,xt=lt=Ve=null,ke=$;do{var Nt=ke.lane,on=ke.eventTime;if((x&Nt)===Nt){xt!==null&&(xt=xt.next={eventTime:on,lane:0,tag:ke.tag,payload:ke.payload,callback:ke.callback,next:null});e:{var pn=f,mn=ke;switch(Nt=_,on=T,mn.tag){case 1:if(pn=mn.payload,typeof pn=="function"){Lt=pn.call(on,Lt,Nt);break e}Lt=pn;break e;case 3:pn.flags=pn.flags&-65537|128;case 0:if(pn=mn.payload,Nt=typeof pn=="function"?pn.call(on,Lt,Nt):pn,Nt==null)break e;Lt=xe({},Lt,Nt);break e;case 2:Rd=!0}}ke.callback!==null&&ke.lane!==0&&(f.flags|=64,Nt=V.effects,Nt===null?V.effects=[ke]:Nt.push(ke))}else on={eventTime:on,lane:Nt,tag:ke.tag,payload:ke.payload,callback:ke.callback,next:null},xt===null?(lt=xt=on,Ve=Lt):xt=xt.next=on,fe|=Nt;if(ke=ke.next,ke===null){if(ke=V.shared.pending,ke===null)break;Nt=ke,ke=Nt.next,Nt.next=null,V.lastBaseUpdate=Nt,V.shared.pending=null}}while(!0);if(xt===null&&(Ve=Lt),V.baseState=Ve,V.firstBaseUpdate=lt,V.lastBaseUpdate=xt,_=V.shared.interleaved,_!==null){V=_;do fe|=V.lane,V=V.next;while(V!==_)}else $===null&&(V.shared.lanes=0);rf|=fe,f.lanes=fe,f.memoizedState=Lt}}function kI(f,_,T){if(f=_.effects,_.effects=null,f!==null)for(_=0;_<f.length;_++){var x=f[_],V=x.callback;if(V!==null){if(x.callback=null,x=T,typeof V!="function")throw Error(i(191,V));V.call(x)}}}var E_={},bu=Dl(E_),Xp=Dl(E_),v_=Dl(E_);function Nh(f){if(f===E_)throw Error(i(174));return f}function Nb(f,_){switch(Ui(v_,_),Ui(Xp,f),Ui(bu,E_),f=_.nodeType,f){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:hn(null,"");break;default:f=f===8?_.parentNode:_,_=f.namespaceURI||null,f=f.tagName,_=hn(_,f)}Ti(bu),Ui(bu,_)}function Jp(){Ti(bu),Ti(Xp),Ti(v_)}function OI(f){Nh(v_.current);var _=Nh(bu.current),T=hn(_,f.type);_!==T&&(Ui(Xp,f),Ui(bu,T))}function xb(f){Xp.current===f&&(Ti(bu),Ti(Xp))}var ns=Dl(0);function GE(f){for(var _=f;_!==null;){if(_.tag===13){var T=_.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Db=[];function Lb(){for(var f=0;f<Db.length;f++)Db[f]._workInProgressVersionPrimary=null;Db.length=0}var S_=ce.ReactCurrentDispatcher,Mb=ce.ReactCurrentBatchConfig,Qp=0,Xi=null,Xs=null,bs=null,b_=!1,Ad=!1,w_=0,Ix=0;function ta(){throw Error(i(321))}function Ub(f,_){if(_===null)return!1;for(var T=0;T<_.length&&T<f.length;T++)if(!Nl(f[T],_[T]))return!1;return!0}function Cm(f,_,T,x,V,$){if(Qp=$,Xi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,S_.current=f===null||f.memoizedState===null?Px:jI,f=T(x,V),Ad){$=0;do{if(Ad=!1,w_=0,25<=$)throw Error(i(301));$+=1,bs=Xs=null,_.updateQueue=null,S_.current=kx,f=T(x,V)}while(Ad)}if(S_.current=Im,_=Xs!==null&&Xs.next!==null,Qp=0,bs=Xs=Xi=null,b_=!1,_)throw Error(i(300));return f}function Vb(){var f=w_!==0;return w_=0,f}function Vl(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bs===null?Xi.memoizedState=bs=f:bs=bs.next=f,bs}function Ya(){if(Xs===null){var f=Xi.alternate;f=f!==null?f.memoizedState:null}else f=Xs.next;var _=bs===null?Xi.memoizedState:bs.next;if(_!==null)bs=_,Xs=f;else{if(f===null)throw Error(i(310));Xs=f,f={memoizedState:Xs.memoizedState,baseState:Xs.baseState,baseQueue:Xs.baseQueue,queue:Xs.queue,next:null},bs===null?Xi.memoizedState=bs=f:bs=bs.next=f}return bs}function Zp(f,_){return typeof _=="function"?_(f):_}function Fb(f){var _=Ya(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var x=Xs,V=x.baseQueue,$=T.pending;if($!==null){if(V!==null){var fe=V.next;V.next=$.next,$.next=fe}x.baseQueue=V=$,T.pending=null}if(V!==null){$=V.next,x=x.baseState;var ke=fe=null,Ve=null,lt=$;do{var xt=lt.lane;if((Qp&xt)===xt)Ve!==null&&(Ve=Ve.next={lane:0,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null}),x=lt.hasEagerState?lt.eagerState:f(x,lt.action);else{var Lt={lane:xt,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null};Ve===null?(ke=Ve=Lt,fe=x):Ve=Ve.next=Lt,Xi.lanes|=xt,rf|=xt}lt=lt.next}while(lt!==null&&lt!==$);Ve===null?fe=x:Ve.next=ke,Nl(x,_.memoizedState)||(Xa=!0),_.memoizedState=x,_.baseState=fe,_.baseQueue=Ve,T.lastRenderedState=x}if(f=T.interleaved,f!==null){V=f;do $=V.lane,Xi.lanes|=$,rf|=$,V=V.next;while(V!==f)}else V===null&&(T.lanes=0);return[_.memoizedState,T.dispatch]}function jb(f){var _=Ya(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var x=T.dispatch,V=T.pending,$=_.memoizedState;if(V!==null){T.pending=null;var fe=V=V.next;do $=f($,fe.action),fe=fe.next;while(fe!==V);Nl($,_.memoizedState)||(Xa=!0),_.memoizedState=$,_.baseQueue===null&&(_.baseState=$),T.lastRenderedState=$}return[$,x]}function NI(){}function xI(f,_){var T=Xi,x=Ya(),V=_(),$=!Nl(x.memoizedState,V);if($&&(x.memoizedState=V,Xa=!0),x=x.queue,KE(LI.bind(null,T,x,f),[f]),x.getSnapshot!==_||$||bs!==null&&bs.memoizedState.tag&1){if(T.flags|=2048,Pd(9,T_.bind(null,T,x,V,_),void 0,null),Js===null)throw Error(i(349));(Qp&30)!==0||DI(T,_,V)}return V}function DI(f,_,T){f.flags|=16384,f={getSnapshot:_,value:T},_=Xi.updateQueue,_===null?(_={lastEffect:null,stores:null},Xi.updateQueue=_,_.stores=[f]):(T=_.stores,T===null?_.stores=[f]:T.push(f))}function T_(f,_,T,x){_.value=T,_.getSnapshot=x,ef(_)&&HE(f)}function LI(f,_,T){return T(function(){ef(_)&&HE(f)})}function ef(f){var _=f.getSnapshot;f=f.value;try{var T=_();return!Nl(f,T)}catch{return!0}}function HE(f){var _=Cd(f,1);_!==null&&Tc(_,f,1,-1)}function C_(f){var _=Vl();return typeof f=="function"&&(f=f()),_.memoizedState=_.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zp,lastRenderedState:f},_.queue=f,f=f.dispatch=tf.bind(null,Xi,f),[_.memoizedState,f]}function Pd(f,_,T,x){return f={tag:f,create:_,destroy:T,deps:x,next:null},_=Xi.updateQueue,_===null?(_={lastEffect:null,stores:null},Xi.updateQueue=_,_.lastEffect=f.next=f):(T=_.lastEffect,T===null?_.lastEffect=f.next=f:(x=T.next,T.next=f,f.next=x,_.lastEffect=f)),f}function R_(){return Ya().memoizedState}function $E(f,_,T,x){var V=Vl();Xi.flags|=f,V.memoizedState=Pd(1|_,T,void 0,x===void 0?null:x)}function I_(f,_,T,x){var V=Ya();x=x===void 0?null:x;var $=void 0;if(Xs!==null){var fe=Xs.memoizedState;if($=fe.destroy,x!==null&&Ub(x,fe.deps)){V.memoizedState=Pd(_,T,$,x);return}}Xi.flags|=f,V.memoizedState=Pd(1|_,T,$,x)}function MI(f,_){return $E(8390656,8,f,_)}function KE(f,_){return I_(2048,8,f,_)}function UI(f,_){return I_(4,2,f,_)}function VI(f,_){return I_(4,4,f,_)}function qE(f,_){if(typeof _=="function")return f=f(),_(f),function(){_(null)};if(_!=null)return f=f(),_.current=f,function(){_.current=null}}function YE(f,_,T){return T=T!=null?T.concat([f]):null,I_(4,4,qE.bind(null,_,f),T)}function Bb(){}function FI(f,_){var T=Ya();_=_===void 0?null:_;var x=T.memoizedState;return x!==null&&_!==null&&Ub(_,x[1])?x[0]:(T.memoizedState=[f,_],f)}function zb(f,_){var T=Ya();_=_===void 0?null:_;var x=T.memoizedState;return x!==null&&_!==null&&Ub(_,x[1])?x[0]:(f=f(),T.memoizedState=[f,_],f)}function XE(f,_,T){return(Qp&21)===0?(f.baseState&&(f.baseState=!1,Xa=!0),f.memoizedState=T):(Nl(T,_)||(T=fd(),Xi.lanes|=T,rf|=T,f.baseState=!0),_)}function Ax(f,_){var T=fr;fr=T!==0&&4>T?T:4,f(!0);var x=Mb.transition;Mb.transition={};try{f(!1),_()}finally{fr=T,Mb.transition=x}}function Fl(){return Ya().memoizedState}function Rm(f,_,T){var x=Fh(f);if(T={lane:x,action:T,hasEagerState:!1,eagerState:null,next:null},Wb(f))Gb(_,T);else if(T=kb(f,_,T,x),T!==null){var V=Ra();Tc(T,f,x,V),xh(T,_,x)}}function tf(f,_,T){var x=Fh(f),V={lane:x,action:T,hasEagerState:!1,eagerState:null,next:null};if(Wb(f))Gb(_,V);else{var $=f.alternate;if(f.lanes===0&&($===null||$.lanes===0)&&($=_.lastRenderedReducer,$!==null))try{var fe=_.lastRenderedState,ke=$(fe,T);if(V.hasEagerState=!0,V.eagerState=ke,Nl(ke,fe)){var Ve=_.interleaved;Ve===null?(V.next=V,Pb(_)):(V.next=Ve.next,Ve.next=V),_.interleaved=V;return}}catch{}finally{}T=kb(f,_,V,x),T!==null&&(V=Ra(),Tc(T,f,x,V),xh(T,_,x))}}function Wb(f){var _=f.alternate;return f===Xi||_!==null&&_===Xi}function Gb(f,_){Ad=b_=!0;var T=f.pending;T===null?_.next=_:(_.next=T.next,T.next=_),f.pending=_}function xh(f,_,T){if((T&4194240)!==0){var x=_.lanes;x&=f.pendingLanes,T|=x,_.lanes=T,pu(f,T)}}var Im={readContext:Hc,useCallback:ta,useContext:ta,useEffect:ta,useImperativeHandle:ta,useInsertionEffect:ta,useLayoutEffect:ta,useMemo:ta,useReducer:ta,useRef:ta,useState:ta,useDebugValue:ta,useDeferredValue:ta,useTransition:ta,useMutableSource:ta,useSyncExternalStore:ta,useId:ta,unstable_isNewReconciler:!1},Px={readContext:Hc,useCallback:function(f,_){return Vl().memoizedState=[f,_===void 0?null:_],f},useContext:Hc,useEffect:MI,useImperativeHandle:function(f,_,T){return T=T!=null?T.concat([f]):null,$E(4194308,4,qE.bind(null,_,f),T)},useLayoutEffect:function(f,_){return $E(4194308,4,f,_)},useInsertionEffect:function(f,_){return $E(4,2,f,_)},useMemo:function(f,_){var T=Vl();return _=_===void 0?null:_,f=f(),T.memoizedState=[f,_],f},useReducer:function(f,_,T){var x=Vl();return _=T!==void 0?T(_):_,x.memoizedState=x.baseState=_,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:_},x.queue=f,f=f.dispatch=Rm.bind(null,Xi,f),[x.memoizedState,f]},useRef:function(f){var _=Vl();return f={current:f},_.memoizedState=f},useState:C_,useDebugValue:Bb,useDeferredValue:function(f){return Vl().memoizedState=f},useTransition:function(){var f=C_(!1),_=f[0];return f=Ax.bind(null,f[1]),Vl().memoizedState=f,[_,f]},useMutableSource:function(){},useSyncExternalStore:function(f,_,T){var x=Xi,V=Vl();if(zi){if(T===void 0)throw Error(i(407));T=T()}else{if(T=_(),Js===null)throw Error(i(349));(Qp&30)!==0||DI(x,_,T)}V.memoizedState=T;var $={value:T,getSnapshot:_};return V.queue=$,MI(LI.bind(null,x,$,f),[f]),x.flags|=2048,Pd(9,T_.bind(null,x,$,T,_),void 0,null),T},useId:function(){var f=Vl(),_=Js.identifierPrefix;if(zi){var T=Td,x=wd;T=(x&~(1<<32-Po(x)-1)).toString(32)+T,_=":"+_+"R"+T,T=w_++,0<T&&(_+="H"+T.toString(32)),_+=":"}else T=Ix++,_=":"+_+"r"+T.toString(32)+":";return f.memoizedState=_},unstable_isNewReconciler:!1},jI={readContext:Hc,useCallback:FI,useContext:Hc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:UI,useLayoutEffect:VI,useMemo:zb,useReducer:Fb,useRef:R_,useState:function(){return Fb(Zp)},useDebugValue:Bb,useDeferredValue:function(f){var _=Ya();return XE(_,Xs.memoizedState,f)},useTransition:function(){var f=Fb(Zp)[0],_=Ya().memoizedState;return[f,_]},useMutableSource:NI,useSyncExternalStore:xI,useId:Fl,unstable_isNewReconciler:!1},kx={readContext:Hc,useCallback:FI,useContext:Hc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:UI,useLayoutEffect:VI,useMemo:zb,useReducer:jb,useRef:R_,useState:function(){return jb(Zp)},useDebugValue:Bb,useDeferredValue:function(f){var _=Ya();return Xs===null?_.memoizedState=f:XE(_,Xs.memoizedState,f)},useTransition:function(){var f=jb(Zp)[0],_=Ya().memoizedState;return[f,_]},useMutableSource:NI,useSyncExternalStore:xI,useId:Fl,unstable_isNewReconciler:!1};function $c(f,_){if(f&&f.defaultProps){_=xe({},_),f=f.defaultProps;for(var T in f)_[T]===void 0&&(_[T]=f[T]);return _}return _}function JE(f,_,T,x){_=f.memoizedState,T=T(x,_),T=T==null?_:xe({},_,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var QE={isMounted:function(f){return(f=f._reactInternals)?xs(f)===f:!1},enqueueSetState:function(f,_,T){f=f._reactInternals;var x=Ra(),V=Fh(f),$=Id(x,V);$.payload=_,T!=null&&($.callback=T),_=Ul(f,$,V),_!==null&&(Tc(_,f,V,x),zE(_,f,V))},enqueueReplaceState:function(f,_,T){f=f._reactInternals;var x=Ra(),V=Fh(f),$=Id(x,V);$.tag=1,$.payload=_,T!=null&&($.callback=T),_=Ul(f,$,V),_!==null&&(Tc(_,f,V,x),zE(_,f,V))},enqueueForceUpdate:function(f,_){f=f._reactInternals;var T=Ra(),x=Fh(f),V=Id(T,x);V.tag=2,_!=null&&(V.callback=_),_=Ul(f,V,x),_!==null&&(Tc(_,f,x,T),zE(_,f,x))}};function kd(f,_,T,x,V,$,fe){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(x,$,fe):_.prototype&&_.prototype.isPureReactComponent?!dm(T,x)||!dm(V,$):!0}function BI(f,_,T){var x=!1,V=Ih,$=_.contextType;return typeof $=="object"&&$!==null?$=Hc($):(V=qa(_)?Ah:ea.current,x=_.contextTypes,$=(x=x!=null)?Ph(f,V):Ih),_=new _(T,$),f.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=QE,f.stateNode=_,_._reactInternals=f,x&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=V,f.__reactInternalMemoizedMaskedChildContext=$),_}function zI(f,_,T,x){f=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(T,x),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(T,x),_.state!==f&&QE.enqueueReplaceState(_,_.state,null)}function Hb(f,_,T,x){var V=f.stateNode;V.props=T,V.state=f.memoizedState,V.refs={},Ob(f);var $=_.contextType;typeof $=="object"&&$!==null?V.context=Hc($):($=qa(_)?Ah:ea.current,V.context=Ph(f,$)),V.state=f.memoizedState,$=_.getDerivedStateFromProps,typeof $=="function"&&(JE(f,_,$,T),V.state=f.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(_=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),_!==V.state&&QE.enqueueReplaceState(V,V.state,null),WE(f,T,V,x),V.state=f.memoizedState),typeof V.componentDidMount=="function"&&(f.flags|=4194308)}function Am(f,_){try{var T="",x=_;do T+=at(x),x=x.return;while(x);var V=T}catch($){V=`
Error generating stack: `+$.message+`
`+$.stack}return{value:f,source:_,stack:V,digest:null}}function ZE(f,_,T){return{value:f,source:null,stack:T??null,digest:_??null}}function $b(f,_){try{console.error(_.value)}catch(T){setTimeout(function(){throw T})}}var Kb=typeof WeakMap=="function"?WeakMap:Map;function qb(f,_,T){T=Id(-1,T),T.tag=3,T.payload={element:null};var x=_.value;return T.callback=function(){ra||(ra=!0,pw=x),$b(f,_)},T}function WI(f,_,T){T=Id(-1,T),T.tag=3;var x=f.type.getDerivedStateFromError;if(typeof x=="function"){var V=_.value;T.payload=function(){return x(V)},T.callback=function(){$b(f,_)}}var $=f.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(T.callback=function(){$b(f,_),typeof x!="function"&&(Uh===null?Uh=new Set([this]):Uh.add(this));var fe=_.stack;this.componentDidCatch(_.value,{componentStack:fe!==null?fe:""})}),T}function Yb(f,_,T){var x=f.pingCache;if(x===null){x=f.pingCache=new Kb;var V=new Set;x.set(_,V)}else V=x.get(_),V===void 0&&(V=new Set,x.set(_,V));V.has(T)||(V.add(T),f=aA.bind(null,f,_,T),_.then(f,f))}function GI(f){do{var _;if((_=f.tag===13)&&(_=f.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return f;f=f.return}while(f!==null);return null}function HI(f,_,T,x,V){return(f.mode&1)===0?(f===_?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(_=Id(-1,1),_.tag=2,Ul(T,_,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=V,f)}var Ox=ce.ReactCurrentOwner,Xa=!1;function Ca(f,_,T,x){_.child=f===null?Cb(_,null,T,x):wm(_,f.child,T,x)}function $I(f,_,T,x,V){T=T.render;var $=_.ref;return Ml(_,V),x=Cm(f,_,T,x,$,V),T=Vb(),f!==null&&!Xa?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~V,Od(f,_,V)):(zi&&T&&vm(_),_.flags|=1,Ca(f,_,x,V),_.child)}function KI(f,_,T,x,V){if(f===null){var $=T.type;return typeof $=="function"&&!ww($)&&$.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(_.tag=15,_.type=$,Xb(f,_,$,x,V)):(f=Dm(T.type,null,x,_,_.mode,V),f.ref=_.ref,f.return=_,_.child=f)}if($=f.child,(f.lanes&V)===0){var fe=$.memoizedProps;if(T=T.compare,T=T!==null?T:dm,T(fe,x)&&f.ref===_.ref)return Od(f,_,V)}return _.flags|=1,f=Wh($,x),f.ref=_.ref,f.return=_,_.child=f}function Xb(f,_,T,x,V){if(f!==null){var $=f.memoizedProps;if(dm($,x)&&f.ref===_.ref)if(Xa=!1,_.pendingProps=x=$,(f.lanes&V)!==0)(f.flags&131072)!==0&&(Xa=!0);else return _.lanes=f.lanes,Od(f,_,V)}return Jb(f,_,T,x,V)}function wu(f,_,T){var x=_.pendingProps,V=x.children,$=f!==null?f.memoizedState:null;if(x.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ui(Pm,wc),wc|=T;else{if((T&1073741824)===0)return f=$!==null?$.baseLanes|T:T,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:f,cachePool:null,transitions:null},_.updateQueue=null,Ui(Pm,wc),wc|=f,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=$!==null?$.baseLanes:T,Ui(Pm,wc),wc|=x}else $!==null?(x=$.baseLanes|T,_.memoizedState=null):x=T,Ui(Pm,wc),wc|=x;return Ca(f,_,V,T),_.child}function qI(f,_){var T=_.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(_.flags|=512,_.flags|=2097152)}function Jb(f,_,T,x,V){var $=qa(T)?Ah:ea.current;return $=Ph(_,$),Ml(_,V),T=Cm(f,_,T,x,$,V),x=Vb(),f!==null&&!Xa?(_.updateQueue=f.updateQueue,_.flags&=-2053,f.lanes&=~V,Od(f,_,V)):(zi&&x&&vm(_),_.flags|=1,Ca(f,_,T,V),_.child)}function YI(f,_,T,x,V){if(qa(T)){var $=!0;xE(_)}else $=!1;if(Ml(_,V),_.stateNode===null)nv(f,_),BI(_,T,x),Hb(_,T,x,V),x=!0;else if(f===null){var fe=_.stateNode,ke=_.memoizedProps;fe.props=ke;var Ve=fe.context,lt=T.contextType;typeof lt=="object"&&lt!==null?lt=Hc(lt):(lt=qa(T)?Ah:ea.current,lt=Ph(_,lt));var xt=T.getDerivedStateFromProps,Lt=typeof xt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";Lt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(ke!==x||Ve!==lt)&&zI(_,fe,x,lt),Rd=!1;var Nt=_.memoizedState;fe.state=Nt,WE(_,x,fe,V),Ve=_.memoizedState,ke!==x||Nt!==Ve||wa.current||Rd?(typeof xt=="function"&&(JE(_,T,xt,x),Ve=_.memoizedState),(ke=Rd||kd(_,T,ke,x,Nt,Ve,lt))?(Lt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(_.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=x,_.memoizedState=Ve),fe.props=x,fe.state=Ve,fe.context=lt,x=ke):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),x=!1)}else{fe=_.stateNode,AI(f,_),ke=_.memoizedProps,lt=_.type===_.elementType?ke:$c(_.type,ke),fe.props=lt,Lt=_.pendingProps,Nt=fe.context,Ve=T.contextType,typeof Ve=="object"&&Ve!==null?Ve=Hc(Ve):(Ve=qa(T)?Ah:ea.current,Ve=Ph(_,Ve));var on=T.getDerivedStateFromProps;(xt=typeof on=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(ke!==Lt||Nt!==Ve)&&zI(_,fe,x,Ve),Rd=!1,Nt=_.memoizedState,fe.state=Nt,WE(_,x,fe,V);var pn=_.memoizedState;ke!==Lt||Nt!==pn||wa.current||Rd?(typeof on=="function"&&(JE(_,T,on,x),pn=_.memoizedState),(lt=Rd||kd(_,T,lt,x,Nt,pn,Ve)||!1)?(xt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(x,pn,Ve),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(x,pn,Ve)),typeof fe.componentDidUpdate=="function"&&(_.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof fe.componentDidUpdate!="function"||ke===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||ke===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=1024),_.memoizedProps=x,_.memoizedState=pn),fe.props=x,fe.state=pn,fe.context=Ve,x=lt):(typeof fe.componentDidUpdate!="function"||ke===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||ke===f.memoizedProps&&Nt===f.memoizedState||(_.flags|=1024),x=!1)}return Qb(f,_,T,x,$,V)}function Qb(f,_,T,x,V,$){qI(f,_);var fe=(_.flags&128)!==0;if(!x&&!fe)return V&&wI(_,T,!1),Od(f,_,$);x=_.stateNode,Ox.current=_;var ke=fe&&typeof T.getDerivedStateFromError!="function"?null:x.render();return _.flags|=1,f!==null&&fe?(_.child=wm(_,f.child,null,$),_.child=wm(_,null,ke,$)):Ca(f,_,ke,$),_.memoizedState=x.state,V&&wI(_,T,!0),_.child}function XI(f){var _=f.stateNode;_.pendingContext?ym(f,_.pendingContext,_.pendingContext!==_.context):_.context&&ym(f,_.context,!1),Nb(f,_.containerInfo)}function JI(f,_,T,x,V){return qp(),bm(V),_.flags|=256,Ca(f,_,T,x),_.child}var A_={dehydrated:null,treeContext:null,retryLane:0};function Zb(f){return{baseLanes:f,cachePool:null,transitions:null}}function QI(f,_,T){var x=_.pendingProps,V=ns.current,$=!1,fe=(_.flags&128)!==0,ke;if((ke=fe)||(ke=f!==null&&f.memoizedState===null?!1:(V&2)!==0),ke?($=!0,_.flags&=-129):(f===null||f.memoizedState!==null)&&(V|=1),Ui(ns,V&1),f===null)return g_(_),f=_.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((_.mode&1)===0?_.lanes=1:f.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(fe=x.children,f=x.fallback,$?(x=_.mode,$=_.child,fe={mode:"hidden",children:fe},(x&1)===0&&$!==null?($.childLanes=0,$.pendingProps=fe):$=F_(fe,x,0,null),f=Gh(f,x,T,null),$.return=_,f.return=_,$.sibling=f,_.child=$,_.child.memoizedState=Zb(T),_.memoizedState=A_,f):ew(_,fe));if(V=f.memoizedState,V!==null&&(ke=V.dehydrated,ke!==null))return Nx(f,_,fe,x,ke,V,T);if($){$=x.fallback,fe=_.mode,V=f.child,ke=V.sibling;var Ve={mode:"hidden",children:x.children};return(fe&1)===0&&_.child!==V?(x=_.child,x.childLanes=0,x.pendingProps=Ve,_.deletions=null):(x=Wh(V,Ve),x.subtreeFlags=V.subtreeFlags&14680064),ke!==null?$=Wh(ke,$):($=Gh($,fe,T,null),$.flags|=2),$.return=_,x.return=_,x.sibling=$,_.child=x,x=$,$=_.child,fe=f.child.memoizedState,fe=fe===null?Zb(T):{baseLanes:fe.baseLanes|T,cachePool:null,transitions:fe.transitions},$.memoizedState=fe,$.childLanes=f.childLanes&~T,_.memoizedState=A_,x}return $=f.child,f=$.sibling,x=Wh($,{mode:"visible",children:x.children}),(_.mode&1)===0&&(x.lanes=T),x.return=_,x.sibling=null,f!==null&&(T=_.deletions,T===null?(_.deletions=[f],_.flags|=16):T.push(f)),_.child=x,_.memoizedState=null,x}function ew(f,_){return _=F_({mode:"visible",children:_},f.mode,0,null),_.return=f,f.child=_}function ev(f,_,T,x){return x!==null&&bm(x),wm(_,f.child,null,T),f=ew(_,_.pendingProps.children),f.flags|=2,_.memoizedState=null,f}function Nx(f,_,T,x,V,$,fe){if(T)return _.flags&256?(_.flags&=-257,x=ZE(Error(i(422))),ev(f,_,fe,x)):_.memoizedState!==null?(_.child=f.child,_.flags|=128,null):($=x.fallback,V=_.mode,x=F_({mode:"visible",children:x.children},V,0,null),$=Gh($,V,fe,null),$.flags|=2,x.return=_,$.return=_,x.sibling=$,_.child=x,(_.mode&1)!==0&&wm(_,f.child,null,fe),_.child.memoizedState=Zb(fe),_.memoizedState=A_,$);if((_.mode&1)===0)return ev(f,_,fe,null);if(V.data==="$!"){if(x=V.nextSibling&&V.nextSibling.dataset,x)var ke=x.dgst;return x=ke,$=Error(i(419)),x=ZE($,x,void 0),ev(f,_,fe,x)}if(ke=(fe&f.childLanes)!==0,Xa||ke){if(x=Js,x!==null){switch(fe&-fe){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(x.suspendedLanes|fe))!==0?0:V,V!==0&&V!==$.retryLane&&($.retryLane=V,Cd(f,V),Tc(x,f,V,-1))}return Nm(),x=ZE(Error(i(421))),ev(f,_,fe,x)}return V.data==="$?"?(_.flags|=128,_.child=f.child,_=jx.bind(null,f),V._reactRetry=_,null):(f=$.treeContext,Sc=vu(V.nextSibling),vc=_,zi=!0,Ll=null,f!==null&&(Ta[Gc++]=wd,Ta[Gc++]=Td,Ta[Gc++]=$p,wd=f.id,Td=f.overflow,$p=_),_=ew(_,x.children),_.flags|=4096,_)}function ZI(f,_,T){f.lanes|=_;var x=f.alternate;x!==null&&(x.lanes|=_),BE(f.return,_,T)}function tv(f,_,T,x,V){var $=f.memoizedState;$===null?f.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:x,tail:T,tailMode:V}:($.isBackwards=_,$.rendering=null,$.renderingStartTime=0,$.last=x,$.tail=T,$.tailMode=V)}function tw(f,_,T){var x=_.pendingProps,V=x.revealOrder,$=x.tail;if(Ca(f,_,x.children,T),x=ns.current,(x&2)!==0)x=x&1|2,_.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=_.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&ZI(f,T,_);else if(f.tag===19)ZI(f,T,_);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===_)break e;for(;f.sibling===null;){if(f.return===null||f.return===_)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}x&=1}if(Ui(ns,x),(_.mode&1)===0)_.memoizedState=null;else switch(V){case"forwards":for(T=_.child,V=null;T!==null;)f=T.alternate,f!==null&&GE(f)===null&&(V=T),T=T.sibling;T=V,T===null?(V=_.child,_.child=null):(V=T.sibling,T.sibling=null),tv(_,!1,V,T,$);break;case"backwards":for(T=null,V=_.child,_.child=null;V!==null;){if(f=V.alternate,f!==null&&GE(f)===null){_.child=V;break}f=V.sibling,V.sibling=T,T=V,V=f}tv(_,!0,T,null,$);break;case"together":tv(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function nv(f,_){(_.mode&1)===0&&f!==null&&(f.alternate=null,_.alternate=null,_.flags|=2)}function Od(f,_,T){if(f!==null&&(_.dependencies=f.dependencies),rf|=_.lanes,(T&_.childLanes)===0)return null;if(f!==null&&_.child!==f.child)throw Error(i(153));if(_.child!==null){for(f=_.child,T=Wh(f,f.pendingProps),_.child=T,T.return=_;f.sibling!==null;)f=f.sibling,T=T.sibling=Wh(f,f.pendingProps),T.return=_;T.sibling=null}return _.child}function rv(f,_,T){switch(_.tag){case 3:XI(_),qp();break;case 5:OI(_);break;case 1:qa(_.type)&&xE(_);break;case 4:Nb(_,_.stateNode.containerInfo);break;case 10:var x=_.type._context,V=_.memoizedProps.value;Ui(FE,x._currentValue),x._currentValue=V;break;case 13:if(x=_.memoizedState,x!==null)return x.dehydrated!==null?(Ui(ns,ns.current&1),_.flags|=128,null):(T&_.child.childLanes)!==0?QI(f,_,T):(Ui(ns,ns.current&1),f=Od(f,_,T),f!==null?f.sibling:null);Ui(ns,ns.current&1);break;case 19:if(x=(T&_.childLanes)!==0,(f.flags&128)!==0){if(x)return tw(f,_,T);_.flags|=128}if(V=_.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Ui(ns,ns.current),x)break;return null;case 22:case 23:return _.lanes=0,wu(f,_,T)}return Od(f,_,T)}var iv,sv,P_,nw;iv=function(f,_){for(var T=_.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===_)break;for(;T.sibling===null;){if(T.return===null||T.return===_)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},sv=function(){},P_=function(f,_,T,x){var V=f.memoizedProps;if(V!==x){f=_.stateNode,Nh(bu.current);var $=null;switch(T){case"input":V=ct(f,V),x=ct(f,x),$=[];break;case"select":V=xe({},V,{value:void 0}),x=xe({},x,{value:void 0}),$=[];break;case"textarea":V=At(f,V),x=At(f,x),$=[];break;default:typeof V.onClick!="function"&&typeof x.onClick=="function"&&(f.onclick=h_)}Es(T,x);var fe;T=null;for(lt in V)if(!x.hasOwnProperty(lt)&&V.hasOwnProperty(lt)&&V[lt]!=null)if(lt==="style"){var ke=V[lt];for(fe in ke)ke.hasOwnProperty(fe)&&(T||(T={}),T[fe]="")}else lt!=="dangerouslySetInnerHTML"&&lt!=="children"&&lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&lt!=="autoFocus"&&(l.hasOwnProperty(lt)?$||($=[]):($=$||[]).push(lt,null));for(lt in x){var Ve=x[lt];if(ke=V!=null?V[lt]:void 0,x.hasOwnProperty(lt)&&Ve!==ke&&(Ve!=null||ke!=null))if(lt==="style")if(ke){for(fe in ke)!ke.hasOwnProperty(fe)||Ve&&Ve.hasOwnProperty(fe)||(T||(T={}),T[fe]="");for(fe in Ve)Ve.hasOwnProperty(fe)&&ke[fe]!==Ve[fe]&&(T||(T={}),T[fe]=Ve[fe])}else T||($||($=[]),$.push(lt,T)),T=Ve;else lt==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,ke=ke?ke.__html:void 0,Ve!=null&&ke!==Ve&&($=$||[]).push(lt,Ve)):lt==="children"?typeof Ve!="string"&&typeof Ve!="number"||($=$||[]).push(lt,""+Ve):lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&(l.hasOwnProperty(lt)?(Ve!=null&&lt==="onScroll"&&Mi("scroll",f),$||ke===Ve||($=[])):($=$||[]).push(lt,Ve))}T&&($=$||[]).push("style",T);var lt=$;(_.updateQueue=lt)&&(_.flags|=4)}},nw=function(f,_,T,x){T!==x&&(_.flags|=4)};function k_(f,_){if(!zi)switch(f.tailMode){case"hidden":_=f.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var x=null;T!==null;)T.alternate!==null&&(x=T),T=T.sibling;x===null?_||f.tail===null?f.tail=null:f.tail.sibling=null:x.sibling=null}}function Oo(f){var _=f.alternate!==null&&f.alternate.child===f.child,T=0,x=0;if(_)for(var V=f.child;V!==null;)T|=V.lanes|V.childLanes,x|=V.subtreeFlags&14680064,x|=V.flags&14680064,V.return=f,V=V.sibling;else for(V=f.child;V!==null;)T|=V.lanes|V.childLanes,x|=V.subtreeFlags,x|=V.flags,V.return=f,V=V.sibling;return f.subtreeFlags|=x,f.childLanes=T,_}function ov(f,_,T){var x=_.pendingProps;switch(UE(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oo(_),null;case 1:return qa(_.type)&&NE(),Oo(_),null;case 3:return x=_.stateNode,Jp(),Ti(wa),Ti(ea),Lb(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(f===null||f.child===null)&&(Sm(_)?_.flags|=4:f===null||f.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Ll!==null&&(mw(Ll),Ll=null))),sv(f,_),Oo(_),null;case 5:xb(_);var V=Nh(v_.current);if(T=_.type,f!==null&&_.stateNode!=null)P_(f,_,T,x,V),f.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!x){if(_.stateNode===null)throw Error(i(166));return Oo(_),null}if(f=Nh(bu.current),Sm(_)){x=_.stateNode,T=_.type;var $=_.memoizedProps;switch(x[Su]=_,x[p_]=$,f=(_.mode&1)!==0,T){case"dialog":Mi("cancel",x),Mi("close",x);break;case"iframe":case"object":case"embed":Mi("load",x);break;case"video":case"audio":for(V=0;V<c_.length;V++)Mi(c_[V],x);break;case"source":Mi("error",x);break;case"img":case"image":case"link":Mi("error",x),Mi("load",x);break;case"details":Mi("toggle",x);break;case"input":Ft(x,$),Mi("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!$.multiple},Mi("invalid",x);break;case"textarea":Tt(x,$),Mi("invalid",x)}Es(T,$),V=null;for(var fe in $)if($.hasOwnProperty(fe)){var ke=$[fe];fe==="children"?typeof ke=="string"?x.textContent!==ke&&($.suppressHydrationWarning!==!0&&d_(x.textContent,ke,f),V=["children",ke]):typeof ke=="number"&&x.textContent!==""+ke&&($.suppressHydrationWarning!==!0&&d_(x.textContent,ke,f),V=["children",""+ke]):l.hasOwnProperty(fe)&&ke!=null&&fe==="onScroll"&&Mi("scroll",x)}switch(T){case"input":$t(x),we(x,$,!0);break;case"textarea":$t(x),Sn(x);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(x.onclick=h_)}x=V,_.updateQueue=x,x!==null&&(_.flags|=4)}else{fe=V.nodeType===9?V:V.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Pn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=fe.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof x.is=="string"?f=fe.createElement(T,{is:x.is}):(f=fe.createElement(T),T==="select"&&(fe=f,x.multiple?fe.multiple=!0:x.size&&(fe.size=x.size))):f=fe.createElementNS(f,T),f[Su]=_,f[p_]=x,iv(f,_,!1,!1),_.stateNode=f;e:{switch(fe=Yo(T,x),T){case"dialog":Mi("cancel",f),Mi("close",f),V=x;break;case"iframe":case"object":case"embed":Mi("load",f),V=x;break;case"video":case"audio":for(V=0;V<c_.length;V++)Mi(c_[V],f);V=x;break;case"source":Mi("error",f),V=x;break;case"img":case"image":case"link":Mi("error",f),Mi("load",f),V=x;break;case"details":Mi("toggle",f),V=x;break;case"input":Ft(f,x),V=ct(f,x),Mi("invalid",f);break;case"option":V=x;break;case"select":f._wrapperState={wasMultiple:!!x.multiple},V=xe({},x,{value:void 0}),Mi("invalid",f);break;case"textarea":Tt(f,x),V=At(f,x),Mi("invalid",f);break;default:V=x}Es(T,V),ke=V;for($ in ke)if(ke.hasOwnProperty($)){var Ve=ke[$];$==="style"?li(f,Ve):$==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ve!=null&&Zn(f,Ve)):$==="children"?typeof Ve=="string"?(T!=="textarea"||Ve!=="")&&Dt(f,Ve):typeof Ve=="number"&&Dt(f,""+Ve):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(l.hasOwnProperty($)?Ve!=null&&$==="onScroll"&&Mi("scroll",f):Ve!=null&&re(f,$,Ve,fe))}switch(T){case"input":$t(f),we(f,x,!1);break;case"textarea":$t(f),Sn(f);break;case"option":x.value!=null&&f.setAttribute("value",""+vt(x.value));break;case"select":f.multiple=!!x.multiple,$=x.value,$!=null?kt(f,!!x.multiple,$,!1):x.defaultValue!=null&&kt(f,!!x.multiple,x.defaultValue,!0);break;default:typeof V.onClick=="function"&&(f.onclick=h_)}switch(T){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Oo(_),null;case 6:if(f&&_.stateNode!=null)nw(f,_,f.memoizedProps,x);else{if(typeof x!="string"&&_.stateNode===null)throw Error(i(166));if(T=Nh(v_.current),Nh(bu.current),Sm(_)){if(x=_.stateNode,T=_.memoizedProps,x[Su]=_,($=x.nodeValue!==T)&&(f=vc,f!==null))switch(f.tag){case 3:d_(x.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&d_(x.nodeValue,T,(f.mode&1)!==0)}$&&(_.flags|=4)}else x=(T.nodeType===9?T:T.ownerDocument).createTextNode(x),x[Su]=_,_.stateNode=x}return Oo(_),null;case 13:if(Ti(ns),x=_.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(zi&&Sc!==null&&(_.mode&1)!==0&&(_.flags&128)===0)wb(),qp(),_.flags|=98560,$=!1;else if($=Sm(_),x!==null&&x.dehydrated!==null){if(f===null){if(!$)throw Error(i(318));if($=_.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(i(317));$[Su]=_}else qp(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Oo(_),$=!1}else Ll!==null&&(mw(Ll),Ll=null),$=!0;if(!$)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=T,_):(x=x!==null,x!==(f!==null&&f.memoizedState!==null)&&x&&(_.child.flags|=8192,(_.mode&1)!==0&&(f===null||(ns.current&1)!==0?Qs===0&&(Qs=3):Nm())),_.updateQueue!==null&&(_.flags|=4),Oo(_),null);case 4:return Jp(),sv(f,_),f===null&&Ed(_.stateNode.containerInfo),Oo(_),null;case 10:return Ab(_.type._context),Oo(_),null;case 17:return qa(_.type)&&NE(),Oo(_),null;case 19:if(Ti(ns),$=_.memoizedState,$===null)return Oo(_),null;if(x=(_.flags&128)!==0,fe=$.rendering,fe===null)if(x)k_($,!1);else{if(Qs!==0||f!==null&&(f.flags&128)!==0)for(f=_.child;f!==null;){if(fe=GE(f),fe!==null){for(_.flags|=128,k_($,!1),x=fe.updateQueue,x!==null&&(_.updateQueue=x,_.flags|=4),_.subtreeFlags=0,x=T,T=_.child;T!==null;)$=T,f=x,$.flags&=14680066,fe=$.alternate,fe===null?($.childLanes=0,$.lanes=f,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=fe.childLanes,$.lanes=fe.lanes,$.child=fe.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=fe.memoizedProps,$.memoizedState=fe.memoizedState,$.updateQueue=fe.updateQueue,$.type=fe.type,f=fe.dependencies,$.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return Ui(ns,ns.current&1|2),_.child}f=f.sibling}$.tail!==null&&Gr()>Kc&&(_.flags|=128,x=!0,k_($,!1),_.lanes=4194304)}else{if(!x)if(f=GE(fe),f!==null){if(_.flags|=128,x=!0,T=f.updateQueue,T!==null&&(_.updateQueue=T,_.flags|=4),k_($,!0),$.tail===null&&$.tailMode==="hidden"&&!fe.alternate&&!zi)return Oo(_),null}else 2*Gr()-$.renderingStartTime>Kc&&T!==1073741824&&(_.flags|=128,x=!0,k_($,!1),_.lanes=4194304);$.isBackwards?(fe.sibling=_.child,_.child=fe):(T=$.last,T!==null?T.sibling=fe:_.child=fe,$.last=fe)}return $.tail!==null?(_=$.tail,$.rendering=_,$.tail=_.sibling,$.renderingStartTime=Gr(),_.sibling=null,T=ns.current,Ui(ns,x?T&1|2:T&1),_):(Oo(_),null);case 22:case 23:return U_(),x=_.memoizedState!==null,f!==null&&f.memoizedState!==null!==x&&(_.flags|=8192),x&&(_.mode&1)!==0?(wc&1073741824)!==0&&(Oo(_),_.subtreeFlags&6&&(_.flags|=8192)):Oo(_),null;case 24:return null;case 25:return null}throw Error(i(156,_.tag))}function xx(f,_){switch(UE(_),_.tag){case 1:return qa(_.type)&&NE(),f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 3:return Jp(),Ti(wa),Ti(ea),Lb(),f=_.flags,(f&65536)!==0&&(f&128)===0?(_.flags=f&-65537|128,_):null;case 5:return xb(_),null;case 13:if(Ti(ns),f=_.memoizedState,f!==null&&f.dehydrated!==null){if(_.alternate===null)throw Error(i(340));qp()}return f=_.flags,f&65536?(_.flags=f&-65537|128,_):null;case 19:return Ti(ns),null;case 4:return Jp(),null;case 10:return Ab(_.type._context),null;case 22:case 23:return U_(),null;case 24:return null;default:return null}}var O_=!1,No=!1,Dx=typeof WeakSet=="function"?WeakSet:Set,cn=null;function nf(f,_){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(x){rs(f,_,x)}else T.current=null}function rw(f,_,T){try{T()}catch(x){rs(f,_,x)}}var eA=!1;function Lx(f,_){if(gb=Ce,f=cb(),lb(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var x=T.getSelection&&T.getSelection();if(x&&x.rangeCount!==0){T=x.anchorNode;var V=x.anchorOffset,$=x.focusNode;x=x.focusOffset;try{T.nodeType,$.nodeType}catch{T=null;break e}var fe=0,ke=-1,Ve=-1,lt=0,xt=0,Lt=f,Nt=null;t:for(;;){for(var on;Lt!==T||V!==0&&Lt.nodeType!==3||(ke=fe+V),Lt!==$||x!==0&&Lt.nodeType!==3||(Ve=fe+x),Lt.nodeType===3&&(fe+=Lt.nodeValue.length),(on=Lt.firstChild)!==null;)Nt=Lt,Lt=on;for(;;){if(Lt===f)break t;if(Nt===T&&++lt===V&&(ke=fe),Nt===$&&++xt===x&&(Ve=fe),(on=Lt.nextSibling)!==null)break;Lt=Nt,Nt=Lt.parentNode}Lt=on}T=ke===-1||Ve===-1?null:{start:ke,end:Ve}}else T=null}T=T||{start:0,end:0}}else T=null;for(PE={focusedElem:f,selectionRange:T},Ce=!1,cn=_;cn!==null;)if(_=cn,f=_.child,(_.subtreeFlags&1028)!==0&&f!==null)f.return=_,cn=f;else for(;cn!==null;){_=cn;try{var pn=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(pn!==null){var mn=pn.memoizedProps,is=pn.memoizedState,Je=_.stateNode,Be=Je.getSnapshotBeforeUpdate(_.elementType===_.type?mn:$c(_.type,mn),is);Je.__reactInternalSnapshotBeforeUpdate=Be}break;case 3:var nt=_.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(jt){rs(_,_.return,jt)}if(f=_.sibling,f!==null){f.return=_.return,cn=f;break}cn=_.return}return pn=eA,eA=!1,pn}function Dh(f,_,T){var x=_.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var V=x=x.next;do{if((V.tag&f)===f){var $=V.destroy;V.destroy=void 0,$!==void 0&&rw(_,T,$)}V=V.next}while(V!==x)}}function av(f,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var T=_=_.next;do{if((T.tag&f)===f){var x=T.create;T.destroy=x()}T=T.next}while(T!==_)}}function iw(f){var _=f.ref;if(_!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof _=="function"?_(f):_.current=f}}function tA(f){var _=f.alternate;_!==null&&(f.alternate=null,tA(_)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(_=f.stateNode,_!==null&&(delete _[Su],delete _[p_],delete _[yb],delete _[Tx],delete _[Cx])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function sw(f){return f.tag===5||f.tag===3||f.tag===4}function nA(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||sw(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function ow(f,_,T){var x=f.tag;if(x===5||x===6)f=f.stateNode,_?T.nodeType===8?T.parentNode.insertBefore(f,_):T.insertBefore(f,_):(T.nodeType===8?(_=T.parentNode,_.insertBefore(f,T)):(_=T,_.appendChild(f)),T=T._reactRootContainer,T!=null||_.onclick!==null||(_.onclick=h_));else if(x!==4&&(f=f.child,f!==null))for(ow(f,_,T),f=f.sibling;f!==null;)ow(f,_,T),f=f.sibling}function N_(f,_,T){var x=f.tag;if(x===5||x===6)f=f.stateNode,_?T.insertBefore(f,_):T.appendChild(f);else if(x!==4&&(f=f.child,f!==null))for(N_(f,_,T),f=f.sibling;f!==null;)N_(f,_,T),f=f.sibling}var xo=null,bc=!1;function Lh(f,_,T){for(T=T.child;T!==null;)aw(f,_,T),T=T.sibling}function aw(f,_,T){if(ma&&typeof ma.onCommitFiberUnmount=="function")try{ma.onCommitFiberUnmount(Fc,T)}catch{}switch(T.tag){case 5:No||nf(T,_);case 6:var x=xo,V=bc;xo=null,Lh(f,_,T),xo=x,bc=V,xo!==null&&(bc?(f=xo,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):xo.removeChild(T.stateNode));break;case 18:xo!==null&&(bc?(f=xo,T=T.stateNode,f.nodeType===8?kE(f.parentNode,T):f.nodeType===1&&kE(f,T),Sa(f)):kE(xo,T.stateNode));break;case 4:x=xo,V=bc,xo=T.stateNode.containerInfo,bc=!0,Lh(f,_,T),xo=x,bc=V;break;case 0:case 11:case 14:case 15:if(!No&&(x=T.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){V=x=x.next;do{var $=V,fe=$.destroy;$=$.tag,fe!==void 0&&(($&2)!==0||($&4)!==0)&&rw(T,_,fe),V=V.next}while(V!==x)}Lh(f,_,T);break;case 1:if(!No&&(nf(T,_),x=T.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=T.memoizedProps,x.state=T.memoizedState,x.componentWillUnmount()}catch(ke){rs(T,_,ke)}Lh(f,_,T);break;case 21:Lh(f,_,T);break;case 22:T.mode&1?(No=(x=No)||T.memoizedState!==null,Lh(f,_,T),No=x):Lh(f,_,T);break;default:Lh(f,_,T)}}function rA(f){var _=f.updateQueue;if(_!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new Dx),_.forEach(function(x){var V=xm.bind(null,f,x);T.has(x)||(T.add(x),x.then(V,V))})}}function jl(f,_){var T=_.deletions;if(T!==null)for(var x=0;x<T.length;x++){var V=T[x];try{var $=f,fe=_,ke=fe;e:for(;ke!==null;){switch(ke.tag){case 5:xo=ke.stateNode,bc=!1;break e;case 3:xo=ke.stateNode.containerInfo,bc=!0;break e;case 4:xo=ke.stateNode.containerInfo,bc=!0;break e}ke=ke.return}if(xo===null)throw Error(i(160));aw($,fe,V),xo=null,bc=!1;var Ve=V.alternate;Ve!==null&&(Ve.return=null),V.return=null}catch(lt){rs(V,_,lt)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)cw(_,f),_=_.sibling}function cw(f,_){var T=f.alternate,x=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(jl(_,f),Tu(f),x&4){try{Dh(3,f,f.return),av(3,f)}catch(mn){rs(f,f.return,mn)}try{Dh(5,f,f.return)}catch(mn){rs(f,f.return,mn)}}break;case 1:jl(_,f),Tu(f),x&512&&T!==null&&nf(T,T.return);break;case 5:if(jl(_,f),Tu(f),x&512&&T!==null&&nf(T,T.return),f.flags&32){var V=f.stateNode;try{Dt(V,"")}catch(mn){rs(f,f.return,mn)}}if(x&4&&(V=f.stateNode,V!=null)){var $=f.memoizedProps,fe=T!==null?T.memoizedProps:$,ke=f.type,Ve=f.updateQueue;if(f.updateQueue=null,Ve!==null)try{ke==="input"&&$.type==="radio"&&$.name!=null&&sn(V,$),Yo(ke,fe);var lt=Yo(ke,$);for(fe=0;fe<Ve.length;fe+=2){var xt=Ve[fe],Lt=Ve[fe+1];xt==="style"?li(V,Lt):xt==="dangerouslySetInnerHTML"?Zn(V,Lt):xt==="children"?Dt(V,Lt):re(V,xt,Lt,lt)}switch(ke){case"input":Ht(V,$);break;case"textarea":Ut(V,$);break;case"select":var Nt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!$.multiple;var on=$.value;on!=null?kt(V,!!$.multiple,on,!1):Nt!==!!$.multiple&&($.defaultValue!=null?kt(V,!!$.multiple,$.defaultValue,!0):kt(V,!!$.multiple,$.multiple?[]:"",!1))}V[p_]=$}catch(mn){rs(f,f.return,mn)}}break;case 6:if(jl(_,f),Tu(f),x&4){if(f.stateNode===null)throw Error(i(162));V=f.stateNode,$=f.memoizedProps;try{V.nodeValue=$}catch(mn){rs(f,f.return,mn)}}break;case 3:if(jl(_,f),Tu(f),x&4&&T!==null&&T.memoizedState.isDehydrated)try{Sa(_.containerInfo)}catch(mn){rs(f,f.return,mn)}break;case 4:jl(_,f),Tu(f);break;case 13:jl(_,f),Tu(f),V=f.child,V.flags&8192&&($=V.memoizedState!==null,V.stateNode.isHidden=$,!$||V.alternate!==null&&V.alternate.memoizedState!==null||(hw=Gr())),x&4&&rA(f);break;case 22:if(xt=T!==null&&T.memoizedState!==null,f.mode&1?(No=(lt=No)||xt,jl(_,f),No=lt):jl(_,f),Tu(f),x&8192){if(lt=f.memoizedState!==null,(f.stateNode.isHidden=lt)&&!xt&&(f.mode&1)!==0)for(cn=f,xt=f.child;xt!==null;){for(Lt=cn=xt;cn!==null;){switch(Nt=cn,on=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:Dh(4,Nt,Nt.return);break;case 1:nf(Nt,Nt.return);var pn=Nt.stateNode;if(typeof pn.componentWillUnmount=="function"){x=Nt,T=Nt.return;try{_=x,pn.props=_.memoizedProps,pn.state=_.memoizedState,pn.componentWillUnmount()}catch(mn){rs(x,T,mn)}}break;case 5:nf(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){cv(Lt);continue}}on!==null?(on.return=Nt,cn=on):cv(Lt)}xt=xt.sibling}e:for(xt=null,Lt=f;;){if(Lt.tag===5){if(xt===null){xt=Lt;try{V=Lt.stateNode,lt?($=V.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(ke=Lt.stateNode,Ve=Lt.memoizedProps.style,fe=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null,ke.style.display=Oi("display",fe))}catch(mn){rs(f,f.return,mn)}}}else if(Lt.tag===6){if(xt===null)try{Lt.stateNode.nodeValue=lt?"":Lt.memoizedProps}catch(mn){rs(f,f.return,mn)}}else if((Lt.tag!==22&&Lt.tag!==23||Lt.memoizedState===null||Lt===f)&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===f)break e;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===f)break e;xt===Lt&&(xt=null),Lt=Lt.return}xt===Lt&&(xt=null),Lt.sibling.return=Lt.return,Lt=Lt.sibling}}break;case 19:jl(_,f),Tu(f),x&4&&rA(f);break;case 21:break;default:jl(_,f),Tu(f)}}function Tu(f){var _=f.flags;if(_&2){try{e:{for(var T=f.return;T!==null;){if(sw(T)){var x=T;break e}T=T.return}throw Error(i(160))}switch(x.tag){case 5:var V=x.stateNode;x.flags&32&&(Dt(V,""),x.flags&=-33);var $=nA(f);N_(f,$,V);break;case 3:case 4:var fe=x.stateNode.containerInfo,ke=nA(f);ow(f,ke,fe);break;default:throw Error(i(161))}}catch(Ve){rs(f,f.return,Ve)}f.flags&=-3}_&4096&&(f.flags&=-4097)}function Mx(f,_,T){cn=f,lw(f)}function lw(f,_,T){for(var x=(f.mode&1)!==0;cn!==null;){var V=cn,$=V.child;if(V.tag===22&&x){var fe=V.memoizedState!==null||O_;if(!fe){var ke=V.alternate,Ve=ke!==null&&ke.memoizedState!==null||No;ke=O_;var lt=No;if(O_=fe,(No=Ve)&&!lt)for(cn=V;cn!==null;)fe=cn,Ve=fe.child,fe.tag===22&&fe.memoizedState!==null?iA(V):Ve!==null?(Ve.return=fe,cn=Ve):iA(V);for(;$!==null;)cn=$,lw($),$=$.sibling;cn=V,O_=ke,No=lt}uw(f)}else(V.subtreeFlags&8772)!==0&&$!==null?($.return=V,cn=$):uw(f)}}function uw(f){for(;cn!==null;){var _=cn;if((_.flags&8772)!==0){var T=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:No||av(5,_);break;case 1:var x=_.stateNode;if(_.flags&4&&!No)if(T===null)x.componentDidMount();else{var V=_.elementType===_.type?T.memoizedProps:$c(_.type,T.memoizedProps);x.componentDidUpdate(V,T.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var $=_.updateQueue;$!==null&&kI(_,$,x);break;case 3:var fe=_.updateQueue;if(fe!==null){if(T=null,_.child!==null)switch(_.child.tag){case 5:T=_.child.stateNode;break;case 1:T=_.child.stateNode}kI(_,fe,T)}break;case 5:var ke=_.stateNode;if(T===null&&_.flags&4){T=ke;var Ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ve.autoFocus&&T.focus();break;case"img":Ve.src&&(T.src=Ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var lt=_.alternate;if(lt!==null){var xt=lt.memoizedState;if(xt!==null){var Lt=xt.dehydrated;Lt!==null&&Sa(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}No||_.flags&512&&iw(_)}catch(Nt){rs(_,_.return,Nt)}}if(_===f){cn=null;break}if(T=_.sibling,T!==null){T.return=_.return,cn=T;break}cn=_.return}}function cv(f){for(;cn!==null;){var _=cn;if(_===f){cn=null;break}var T=_.sibling;if(T!==null){T.return=_.return,cn=T;break}cn=_.return}}function iA(f){for(;cn!==null;){var _=cn;try{switch(_.tag){case 0:case 11:case 15:var T=_.return;try{av(4,_)}catch(Ve){rs(_,T,Ve)}break;case 1:var x=_.stateNode;if(typeof x.componentDidMount=="function"){var V=_.return;try{x.componentDidMount()}catch(Ve){rs(_,V,Ve)}}var $=_.return;try{iw(_)}catch(Ve){rs(_,$,Ve)}break;case 5:var fe=_.return;try{iw(_)}catch(Ve){rs(_,fe,Ve)}}}catch(Ve){rs(_,_.return,Ve)}if(_===f){cn=null;break}var ke=_.sibling;if(ke!==null){ke.return=_.return,cn=ke;break}cn=_.return}}var Ux=Math.ceil,Mh=ce.ReactCurrentDispatcher,lv=ce.ReactCurrentOwner,na=ce.ReactCurrentBatchConfig,Tr=0,Js=null,fs=null,Us=0,wc=0,Pm=Dl(0),Qs=0,km=null,rf=0,uv=0,dw=0,sf=null,ws=null,hw=0,Kc=1/0,Cu=null,ra=!1,pw=null,Uh=null,x_=!1,Vh=null,D_=0,Om=0,fw=null,L_=-1,dv=0;function Ra(){return(Tr&6)!==0?Gr():L_!==-1?L_:L_=Gr()}function Fh(f){return(f.mode&1)===0?1:(Tr&2)!==0&&Us!==0?Us&-Us:__.transition!==null?(dv===0&&(dv=fd()),dv):(f=fr,f!==0||(f=window.event,f=f===void 0?16:ii(f.type)),f)}function Tc(f,_,T,x){if(50<Om)throw Om=0,fw=null,Error(i(185));hu(f,T,x),((Tr&2)===0||f!==Js)&&(f===Js&&((Tr&2)===0&&(uv|=T),Qs===4&&jh(f,Us)),ia(f,x),T===1&&Tr===0&&(_.mode&1)===0&&(Kc=Gr()+500,DE&&kh()))}function ia(f,_){var T=f.callbackNode;za(f,_);var x=hd(f,f===Js?Us:0);if(x===0)T!==null&&Cl(T),f.callbackNode=null,f.callbackPriority=0;else if(_=x&-x,f.callbackPriority!==_){if(T!=null&&Cl(T),_===1)f.tag===0?Rx(hv.bind(null,f)):Sb(hv.bind(null,f)),bx(function(){(Tr&6)===0&&kh()}),T=null;else{switch(Al(x)){case 1:T=Hr;break;case 4:T=fa;break;case 16:T=Yi;break;case 536870912:T=ri;break;default:T=Yi}T=Sw(T,sA.bind(null,f))}f.callbackPriority=_,f.callbackNode=T}}function sA(f,_){if(L_=-1,dv=0,(Tr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(zh()&&f.callbackNode!==T)return null;var x=hd(f,f===Js?Us:0);if(x===0)return null;if((x&30)!==0||(x&f.expiredLanes)!==0||_)_=V_(f,x);else{_=x;var V=Tr;Tr|=2;var $=_w();(Js!==f||Us!==_)&&(Cu=null,Kc=Gr()+500,Nd(f,_));do try{Fx();break}catch(ke){gw(f,ke)}while(!0);Ib(),Mh.current=$,Tr=V,fs!==null?_=0:(Js=null,Us=0,_=Qs)}if(_!==0){if(_===2&&(V=ga(f),V!==0&&(x=V,_=M_(f,V))),_===1)throw T=km,Nd(f,0),jh(f,x),ia(f,Gr()),T;if(_===6)jh(f,x);else{if(V=f.current.alternate,(x&30)===0&&!oA(V)&&(_=V_(f,x),_===2&&($=ga(f),$!==0&&(x=$,_=M_(f,$))),_===1))throw T=km,Nd(f,0),jh(f,x),ia(f,Gr()),T;switch(f.finishedWork=V,f.finishedLanes=x,_){case 0:case 1:throw Error(i(345));case 2:qc(f,ws,Cu);break;case 3:if(jh(f,x),(x&130023424)===x&&(_=hw+500-Gr(),10<_)){if(hd(f,0)!==0)break;if(V=f.suspendedLanes,(V&x)!==x){Ra(),f.pingedLanes|=f.suspendedLanes&V;break}f.timeoutHandle=_b(qc.bind(null,f,ws,Cu),_);break}qc(f,ws,Cu);break;case 4:if(jh(f,x),(x&4194240)===x)break;for(_=f.eventTimes,V=-1;0<x;){var fe=31-Po(x);$=1<<fe,fe=_[fe],fe>V&&(V=fe),x&=~$}if(x=V,x=Gr()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*Ux(x/1960))-x,10<x){f.timeoutHandle=_b(qc.bind(null,f,ws,Cu),x);break}qc(f,ws,Cu);break;case 5:qc(f,ws,Cu);break;default:throw Error(i(329))}}}return ia(f,Gr()),f.callbackNode===T?sA.bind(null,f):null}function M_(f,_){var T=sf;return f.current.memoizedState.isDehydrated&&(Nd(f,_).flags|=256),f=V_(f,_),f!==2&&(_=ws,ws=T,_!==null&&mw(_)),f}function mw(f){ws===null?ws=f:ws.push.apply(ws,f)}function oA(f){for(var _=f;;){if(_.flags&16384){var T=_.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var x=0;x<T.length;x++){var V=T[x],$=V.getSnapshot;V=V.value;try{if(!Nl($(),V))return!1}catch{return!1}}}if(T=_.child,_.subtreeFlags&16384&&T!==null)T.return=_,_=T;else{if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function jh(f,_){for(_&=~dw,_&=~uv,f.suspendedLanes|=_,f.pingedLanes&=~_,f=f.expirationTimes;0<_;){var T=31-Po(_),x=1<<T;f[T]=-1,_&=~x}}function hv(f){if((Tr&6)!==0)throw Error(i(327));zh();var _=hd(f,0);if((_&1)===0)return ia(f,Gr()),null;var T=V_(f,_);if(f.tag!==0&&T===2){var x=ga(f);x!==0&&(_=x,T=M_(f,x))}if(T===1)throw T=km,Nd(f,0),jh(f,_),ia(f,Gr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=_,qc(f,ws,Cu),ia(f,Gr()),null}function of(f,_){var T=Tr;Tr|=1;try{return f(_)}finally{Tr=T,Tr===0&&(Kc=Gr()+500,DE&&kh())}}function Bh(f){Vh!==null&&Vh.tag===0&&(Tr&6)===0&&zh();var _=Tr;Tr|=1;var T=na.transition,x=fr;try{if(na.transition=null,fr=1,f)return f()}finally{fr=x,na.transition=T,Tr=_,(Tr&6)===0&&kh()}}function U_(){wc=Pm.current,Ti(Pm)}function Nd(f,_){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,Sx(T)),fs!==null)for(T=fs.return;T!==null;){var x=T;switch(UE(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&NE();break;case 3:Jp(),Ti(wa),Ti(ea),Lb();break;case 5:xb(x);break;case 4:Jp();break;case 13:Ti(ns);break;case 19:Ti(ns);break;case 10:Ab(x.type._context);break;case 22:case 23:U_()}T=T.return}if(Js=f,fs=f=Wh(f.current,null),Us=wc=_,Qs=0,km=null,dw=uv=rf=0,ws=sf=null,Yp!==null){for(_=0;_<Yp.length;_++)if(T=Yp[_],x=T.interleaved,x!==null){T.interleaved=null;var V=x.next,$=T.pending;if($!==null){var fe=$.next;$.next=V,x.next=fe}T.pending=x}Yp=null}return f}function gw(f,_){do{var T=fs;try{if(Ib(),S_.current=Im,b_){for(var x=Xi.memoizedState;x!==null;){var V=x.queue;V!==null&&(V.pending=null),x=x.next}b_=!1}if(Qp=0,bs=Xs=Xi=null,Ad=!1,w_=0,lv.current=null,T===null||T.return===null){Qs=1,km=_,fs=null;break}e:{var $=f,fe=T.return,ke=T,Ve=_;if(_=Us,ke.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var lt=Ve,xt=ke,Lt=xt.tag;if((xt.mode&1)===0&&(Lt===0||Lt===11||Lt===15)){var Nt=xt.alternate;Nt?(xt.updateQueue=Nt.updateQueue,xt.memoizedState=Nt.memoizedState,xt.lanes=Nt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var on=GI(fe);if(on!==null){on.flags&=-257,HI(on,fe,ke,$,_),on.mode&1&&Yb($,lt,_),_=on,Ve=lt;var pn=_.updateQueue;if(pn===null){var mn=new Set;mn.add(Ve),_.updateQueue=mn}else pn.add(Ve);break e}else{if((_&1)===0){Yb($,lt,_),Nm();break e}Ve=Error(i(426))}}else if(zi&&ke.mode&1){var is=GI(fe);if(is!==null){(is.flags&65536)===0&&(is.flags|=256),HI(is,fe,ke,$,_),bm(Am(Ve,ke));break e}}$=Ve=Am(Ve,ke),Qs!==4&&(Qs=2),sf===null?sf=[$]:sf.push($),$=fe;do{switch($.tag){case 3:$.flags|=65536,_&=-_,$.lanes|=_;var Je=qb($,Ve,_);PI($,Je);break e;case 1:ke=Ve;var Be=$.type,nt=$.stateNode;if(($.flags&128)===0&&(typeof Be.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(Uh===null||!Uh.has(nt)))){$.flags|=65536,_&=-_,$.lanes|=_;var jt=WI($,ke,_);PI($,jt);break e}}$=$.return}while($!==null)}Ew(T)}catch(gn){_=gn,fs===T&&T!==null&&(fs=T=T.return);continue}break}while(!0)}function _w(){var f=Mh.current;return Mh.current=Im,f===null?Im:f}function Nm(){(Qs===0||Qs===3||Qs===2)&&(Qs=4),Js===null||(rf&268435455)===0&&(uv&268435455)===0||jh(Js,Us)}function V_(f,_){var T=Tr;Tr|=2;var x=_w();(Js!==f||Us!==_)&&(Cu=null,Nd(f,_));do try{Vx();break}catch(V){gw(f,V)}while(!0);if(Ib(),Tr=T,Mh.current=x,fs!==null)throw Error(i(261));return Js=null,Us=0,Qs}function Vx(){for(;fs!==null;)yw(fs)}function Fx(){for(;fs!==null&&!yh();)yw(fs)}function yw(f){var _=lA(f.alternate,f,wc);f.memoizedProps=f.pendingProps,_===null?Ew(f):fs=_,lv.current=null}function Ew(f){var _=f;do{var T=_.alternate;if(f=_.return,(_.flags&32768)===0){if(T=ov(T,_,wc),T!==null){fs=T;return}}else{if(T=xx(T,_),T!==null){T.flags&=32767,fs=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Qs=6,fs=null;return}}if(_=_.sibling,_!==null){fs=_;return}fs=_=f}while(_!==null);Qs===0&&(Qs=5)}function qc(f,_,T){var x=fr,V=na.transition;try{na.transition=null,fr=1,vw(f,_,T,x)}finally{na.transition=V,fr=x}return null}function vw(f,_,T,x){do zh();while(Vh!==null);if((Tr&6)!==0)throw Error(i(327));T=f.finishedWork;var V=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var $=T.lanes|T.childLanes;if(ui(f,$),f===Js&&(fs=Js=null,Us=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||x_||(x_=!0,Sw(Yi,function(){return zh(),null})),$=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||$){$=na.transition,na.transition=null;var fe=fr;fr=1;var ke=Tr;Tr|=4,lv.current=null,Lx(f,T),cw(T,f),gx(PE),Ce=!!gb,PE=gb=null,f.current=T,Mx(T),Ks(),Tr=ke,fr=fe,na.transition=$}else f.current=T;if(x_&&(x_=!1,Vh=f,D_=V),$=f.pendingLanes,$===0&&(Uh=null),jp(T.stateNode),ia(f,Gr()),_!==null)for(x=f.onRecoverableError,T=0;T<_.length;T++)V=_[T],x(V.value,{componentStack:V.stack,digest:V.digest});if(ra)throw ra=!1,f=pw,pw=null,f;return(D_&1)!==0&&f.tag!==0&&zh(),$=f.pendingLanes,($&1)!==0?f===fw?Om++:(Om=0,fw=f):Om=0,kh(),null}function zh(){if(Vh!==null){var f=Al(D_),_=na.transition,T=fr;try{if(na.transition=null,fr=16>f?16:f,Vh===null)var x=!1;else{if(f=Vh,Vh=null,D_=0,(Tr&6)!==0)throw Error(i(331));var V=Tr;for(Tr|=4,cn=f.current;cn!==null;){var $=cn,fe=$.child;if((cn.flags&16)!==0){var ke=$.deletions;if(ke!==null){for(var Ve=0;Ve<ke.length;Ve++){var lt=ke[Ve];for(cn=lt;cn!==null;){var xt=cn;switch(xt.tag){case 0:case 11:case 15:Dh(8,xt,$)}var Lt=xt.child;if(Lt!==null)Lt.return=xt,cn=Lt;else for(;cn!==null;){xt=cn;var Nt=xt.sibling,on=xt.return;if(tA(xt),xt===lt){cn=null;break}if(Nt!==null){Nt.return=on,cn=Nt;break}cn=on}}}var pn=$.alternate;if(pn!==null){var mn=pn.child;if(mn!==null){pn.child=null;do{var is=mn.sibling;mn.sibling=null,mn=is}while(mn!==null)}}cn=$}}if(($.subtreeFlags&2064)!==0&&fe!==null)fe.return=$,cn=fe;else e:for(;cn!==null;){if($=cn,($.flags&2048)!==0)switch($.tag){case 0:case 11:case 15:Dh(9,$,$.return)}var Je=$.sibling;if(Je!==null){Je.return=$.return,cn=Je;break e}cn=$.return}}var Be=f.current;for(cn=Be;cn!==null;){fe=cn;var nt=fe.child;if((fe.subtreeFlags&2064)!==0&&nt!==null)nt.return=fe,cn=nt;else e:for(fe=Be;cn!==null;){if(ke=cn,(ke.flags&2048)!==0)try{switch(ke.tag){case 0:case 11:case 15:av(9,ke)}}catch(gn){rs(ke,ke.return,gn)}if(ke===fe){cn=null;break e}var jt=ke.sibling;if(jt!==null){jt.return=ke.return,cn=jt;break e}cn=ke.return}}if(Tr=V,kh(),ma&&typeof ma.onPostCommitFiberRoot=="function")try{ma.onPostCommitFiberRoot(Fc,f)}catch{}x=!0}return x}finally{fr=T,na.transition=_}}return!1}function pv(f,_,T){_=Am(T,_),_=qb(f,_,1),f=Ul(f,_,1),_=Ra(),f!==null&&(hu(f,1,_),ia(f,_))}function rs(f,_,T){if(f.tag===3)pv(f,f,T);else for(;_!==null;){if(_.tag===3){pv(_,f,T);break}else if(_.tag===1){var x=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Uh===null||!Uh.has(x))){f=Am(T,f),f=WI(_,f,1),_=Ul(_,f,1),f=Ra(),_!==null&&(hu(_,1,f),ia(_,f));break}}_=_.return}}function aA(f,_,T){var x=f.pingCache;x!==null&&x.delete(_),_=Ra(),f.pingedLanes|=f.suspendedLanes&T,Js===f&&(Us&T)===T&&(Qs===4||Qs===3&&(Us&130023424)===Us&&500>Gr()-hw?Nd(f,0):dw|=T),ia(f,_)}function cA(f,_){_===0&&((f.mode&1)===0?_=1:(_=vh,vh<<=1,(vh&130023424)===0&&(vh=4194304)));var T=Ra();f=Cd(f,_),f!==null&&(hu(f,_,T),ia(f,T))}function jx(f){var _=f.memoizedState,T=0;_!==null&&(T=_.retryLane),cA(f,T)}function xm(f,_){var T=0;switch(f.tag){case 13:var x=f.stateNode,V=f.memoizedState;V!==null&&(T=V.retryLane);break;case 19:x=f.stateNode;break;default:throw Error(i(314))}x!==null&&x.delete(_),cA(f,T)}var lA;lA=function(f,_,T){if(f!==null)if(f.memoizedProps!==_.pendingProps||wa.current)Xa=!0;else{if((f.lanes&T)===0&&(_.flags&128)===0)return Xa=!1,rv(f,_,T);Xa=(f.flags&131072)!==0}else Xa=!1,zi&&(_.flags&1048576)!==0&&TI(_,ME,_.index);switch(_.lanes=0,_.tag){case 2:var x=_.type;nv(f,_),f=_.pendingProps;var V=Ph(_,ea.current);Ml(_,T),V=Cm(null,_,x,f,V,T);var $=Vb();return _.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,qa(x)?($=!0,xE(_)):$=!1,_.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,Ob(_),V.updater=QE,_.stateNode=V,V._reactInternals=_,Hb(_,x,f,T),_=Qb(null,_,x,!0,$,T)):(_.tag=0,zi&&$&&vm(_),Ca(null,_,V,T),_=_.child),_;case 16:x=_.elementType;e:{switch(nv(f,_),f=_.pendingProps,V=x._init,x=V(x._payload),_.type=x,V=_.tag=Bx(x),f=$c(x,f),V){case 0:_=Jb(null,_,x,f,T);break e;case 1:_=YI(null,_,x,f,T);break e;case 11:_=$I(null,_,x,f,T);break e;case 14:_=KI(null,_,x,$c(x.type,f),T);break e}throw Error(i(306,x,""))}return _;case 0:return x=_.type,V=_.pendingProps,V=_.elementType===x?V:$c(x,V),Jb(f,_,x,V,T);case 1:return x=_.type,V=_.pendingProps,V=_.elementType===x?V:$c(x,V),YI(f,_,x,V,T);case 3:e:{if(XI(_),f===null)throw Error(i(387));x=_.pendingProps,$=_.memoizedState,V=$.element,AI(f,_),WE(_,x,null,T);var fe=_.memoizedState;if(x=fe.element,$.isDehydrated)if($={element:x,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},_.updateQueue.baseState=$,_.memoizedState=$,_.flags&256){V=Am(Error(i(423)),_),_=JI(f,_,x,T,V);break e}else if(x!==V){V=Am(Error(i(424)),_),_=JI(f,_,x,T,V);break e}else for(Sc=vu(_.stateNode.containerInfo.firstChild),vc=_,zi=!0,Ll=null,T=Cb(_,null,x,T),_.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(qp(),x===V){_=Od(f,_,T);break e}Ca(f,_,x,T)}_=_.child}return _;case 5:return OI(_),f===null&&g_(_),x=_.type,V=_.pendingProps,$=f!==null?f.memoizedProps:null,fe=V.children,gm(x,V)?fe=null:$!==null&&gm(x,$)&&(_.flags|=32),qI(f,_),Ca(f,_,fe,T),_.child;case 6:return f===null&&g_(_),null;case 13:return QI(f,_,T);case 4:return Nb(_,_.stateNode.containerInfo),x=_.pendingProps,f===null?_.child=wm(_,null,x,T):Ca(f,_,x,T),_.child;case 11:return x=_.type,V=_.pendingProps,V=_.elementType===x?V:$c(x,V),$I(f,_,x,V,T);case 7:return Ca(f,_,_.pendingProps,T),_.child;case 8:return Ca(f,_,_.pendingProps.children,T),_.child;case 12:return Ca(f,_,_.pendingProps.children,T),_.child;case 10:e:{if(x=_.type._context,V=_.pendingProps,$=_.memoizedProps,fe=V.value,Ui(FE,x._currentValue),x._currentValue=fe,$!==null)if(Nl($.value,fe)){if($.children===V.children&&!wa.current){_=Od(f,_,T);break e}}else for($=_.child,$!==null&&($.return=_);$!==null;){var ke=$.dependencies;if(ke!==null){fe=$.child;for(var Ve=ke.firstContext;Ve!==null;){if(Ve.context===x){if($.tag===1){Ve=Id(-1,T&-T),Ve.tag=2;var lt=$.updateQueue;if(lt!==null){lt=lt.shared;var xt=lt.pending;xt===null?Ve.next=Ve:(Ve.next=xt.next,xt.next=Ve),lt.pending=Ve}}$.lanes|=T,Ve=$.alternate,Ve!==null&&(Ve.lanes|=T),BE($.return,T,_),ke.lanes|=T;break}Ve=Ve.next}}else if($.tag===10)fe=$.type===_.type?null:$.child;else if($.tag===18){if(fe=$.return,fe===null)throw Error(i(341));fe.lanes|=T,ke=fe.alternate,ke!==null&&(ke.lanes|=T),BE(fe,T,_),fe=$.sibling}else fe=$.child;if(fe!==null)fe.return=$;else for(fe=$;fe!==null;){if(fe===_){fe=null;break}if($=fe.sibling,$!==null){$.return=fe.return,fe=$;break}fe=fe.return}$=fe}Ca(f,_,V.children,T),_=_.child}return _;case 9:return V=_.type,x=_.pendingProps.children,Ml(_,T),V=Hc(V),x=x(V),_.flags|=1,Ca(f,_,x,T),_.child;case 14:return x=_.type,V=$c(x,_.pendingProps),V=$c(x.type,V),KI(f,_,x,V,T);case 15:return Xb(f,_,_.type,_.pendingProps,T);case 17:return x=_.type,V=_.pendingProps,V=_.elementType===x?V:$c(x,V),nv(f,_),_.tag=1,qa(x)?(f=!0,xE(_)):f=!1,Ml(_,T),BI(_,x,V),Hb(_,x,V,T),Qb(null,_,x,!0,f,T);case 19:return tw(f,_,T);case 22:return wu(f,_,T)}throw Error(i(156,_.tag))};function Sw(f,_){return _o(f,_)}function bw(f,_,T,x){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yc(f,_,T,x){return new bw(f,_,T,x)}function ww(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Bx(f){if(typeof f=="function")return ww(f)?1:0;if(f!=null){if(f=f.$$typeof,f===pe)return 11;if(f===Te)return 14}return 2}function Wh(f,_){var T=f.alternate;return T===null?(T=Yc(f.tag,_,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=_,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,_=f.dependencies,T.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function Dm(f,_,T,x,V,$){var fe=2;if(x=f,typeof f=="function")ww(f)&&(fe=1);else if(typeof f=="string")fe=5;else e:switch(f){case X:return Gh(T.children,V,$,_);case J:fe=8,V|=8;break;case te:return f=Yc(12,T,_,V|2),f.elementType=te,f.lanes=$,f;case he:return f=Yc(13,T,_,V),f.elementType=he,f.lanes=$,f;case ve:return f=Yc(19,T,_,V),f.elementType=ve,f.lanes=$,f;case be:return F_(T,V,$,_);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ne:fe=10;break e;case de:fe=9;break e;case pe:fe=11;break e;case Te:fe=14;break e;case Fe:fe=16,x=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return _=Yc(fe,T,_,V),_.elementType=f,_.type=x,_.lanes=$,_}function Gh(f,_,T,x){return f=Yc(7,f,x,_),f.lanes=T,f}function F_(f,_,T,x){return f=Yc(22,f,x,_),f.elementType=be,f.lanes=T,f.stateNode={isHidden:!1},f}function fv(f,_,T){return f=Yc(6,f,null,_),f.lanes=T,f}function Lm(f,_,T){return _=Yc(4,f.children!==null?f.children:[],f.key,_),_.lanes=T,_.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},_}function Tw(f,_,T,x,V){this.tag=_,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Il(0),this.expirationTimes=Il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Il(0),this.identifierPrefix=x,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function Mm(f,_,T,x,V,$,fe,ke,Ve){return f=new Tw(f,_,T,ke,Ve),_===1?(_=1,$===!0&&(_|=8)):_=0,$=Yc(3,null,null,_),f.current=$,$.stateNode=f,$.memoizedState={element:x,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ob($),f}function mv(f,_,T){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:x==null?null:""+x,children:f,containerInfo:_,implementation:T}}function Cw(f){if(!f)return Ih;f=f._reactInternals;e:{if(xs(f)!==f||f.tag!==1)throw Error(i(170));var _=f;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(qa(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(qa(T))return bI(f,T,_)}return _}function af(f,_,T,x,V,$,fe,ke,Ve){return f=Mm(T,x,!0,f,V,$,fe,ke,Ve),f.context=Cw(null),T=f.current,x=Ra(),V=Fh(T),$=Id(x,V),$.callback=_??null,Ul(T,$,V),f.current.lanes=V,hu(f,V,x),ia(f,x),f}function Ru(f,_,T,x){var V=_.current,$=Ra(),fe=Fh(V);return T=Cw(T),_.context===null?_.context=T:_.pendingContext=T,_=Id($,fe),_.payload={element:f},x=x===void 0?null:x,x!==null&&(_.callback=x),f=Ul(V,_,fe),f!==null&&(Tc(f,V,fe,$),zE(f,V,fe)),fe}function gv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Um(f,_){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<_?T:_}}function Rw(f,_){Um(f,_),(f=f.alternate)&&Um(f,_)}function zx(){return null}var uA=typeof reportError=="function"?reportError:function(f){console.error(f)};function Iw(f){this._internalRoot=f}j_.prototype.render=Iw.prototype.render=function(f){var _=this._internalRoot;if(_===null)throw Error(i(409));Ru(f,_,null,null)},j_.prototype.unmount=Iw.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var _=f.containerInfo;Bh(function(){Ru(null,f,null,null)}),_[vd]=null}};function j_(f){this._internalRoot=f}j_.prototype.unstable_scheduleHydration=function(f){if(f){var _=rm();f={blockedOn:null,target:f,priority:_};for(var T=0;T<Wa.length&&_!==0&&_<Wa[T].priority;T++);Wa.splice(T,0,f),T===0&&Pl(f)}};function B_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function z_(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function dA(){}function hA(f,_,T,x,V){if(V){if(typeof x=="function"){var $=x;x=function(){var lt=gv(fe);$.call(lt)}}var fe=af(_,x,f,0,null,!1,!1,"",dA);return f._reactRootContainer=fe,f[vd]=fe.current,Ed(f.nodeType===8?f.parentNode:f),Bh(),fe}for(;V=f.lastChild;)f.removeChild(V);if(typeof x=="function"){var ke=x;x=function(){var lt=gv(Ve);ke.call(lt)}}var Ve=Mm(f,0,!1,null,null,!1,!1,"",dA);return f._reactRootContainer=Ve,f[vd]=Ve.current,Ed(f.nodeType===8?f.parentNode:f),Bh(function(){Ru(_,Ve,T,x)}),Ve}function _v(f,_,T,x,V){var $=T._reactRootContainer;if($){var fe=$;if(typeof V=="function"){var ke=V;V=function(){var Ve=gv(fe);ke.call(Ve)}}Ru(_,fe,f,V)}else fe=hA(T,_,f,V,x);return gv(fe)}Sh=function(f){switch(f.tag){case 3:var _=f.stateNode;if(_.current.memoizedState.isDehydrated){var T=Or(_.pendingLanes);T!==0&&(pu(_,T|1),ia(_,Gr()),(Tr&6)===0&&(Kc=Gr()+500,kh()))}break;case 13:Bh(function(){var x=Cd(f,1);if(x!==null){var V=Ra();Tc(x,f,1,V)}}),Rw(f,1)}},bh=function(f){if(f.tag===13){var _=Cd(f,134217728);if(_!==null){var T=Ra();Tc(_,f,134217728,T)}Rw(f,134217728)}},fu=function(f){if(f.tag===13){var _=Fh(f),T=Cd(f,_);if(T!==null){var x=Ra();Tc(T,f,_,x)}Rw(f,_)}},rm=function(){return fr},zp=function(f,_){var T=fr;try{return fr=f,_()}finally{fr=T}},Kn=function(f,_,T){switch(_){case"input":if(Ht(f,T),_=T.name,T.type==="radio"&&_!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<T.length;_++){var x=T[_];if(x!==f&&x.form===f.form){var V=OE(x);if(!V)throw Error(i(90));dt(x),Ht(x,V)}}}break;case"textarea":Ut(f,T);break;case"select":_=T.value,_!=null&&kt(f,!!T.multiple,_,!1)}},Jo=of,ud=Bh;var W_={usingClientEntryPoint:!1,Events:[f_,_m,OE,go,ld,of]},Ja={findFiberByHostInstance:Hp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pA={bundleType:Ja.bundleType,version:Ja.version,rendererPackageName:Ja.rendererPackageName,rendererConfig:Ja.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Di(f),f===null?null:f.stateNode},findFiberByHostInstance:Ja.findFiberByHostInstance||zx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yv.isDisabled&&yv.supportsFiber)try{Fc=yv.inject(pA),ma=yv}catch{}}return ll.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W_,ll.createPortal=function(f,_){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B_(_))throw Error(i(200));return mv(f,_,null,T)},ll.createRoot=function(f,_){if(!B_(f))throw Error(i(299));var T=!1,x="",V=uA;return _!=null&&(_.unstable_strictMode===!0&&(T=!0),_.identifierPrefix!==void 0&&(x=_.identifierPrefix),_.onRecoverableError!==void 0&&(V=_.onRecoverableError)),_=Mm(f,1,!1,null,null,T,!1,x,V),f[vd]=_.current,Ed(f.nodeType===8?f.parentNode:f),new Iw(_)},ll.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var _=f._reactInternals;if(_===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Di(_),f=f===null?null:f.stateNode,f},ll.flushSync=function(f){return Bh(f)},ll.hydrate=function(f,_,T){if(!z_(_))throw Error(i(200));return _v(null,f,_,!0,T)},ll.hydrateRoot=function(f,_,T){if(!B_(f))throw Error(i(405));var x=T!=null&&T.hydratedSources||null,V=!1,$="",fe=uA;if(T!=null&&(T.unstable_strictMode===!0&&(V=!0),T.identifierPrefix!==void 0&&($=T.identifierPrefix),T.onRecoverableError!==void 0&&(fe=T.onRecoverableError)),_=af(_,null,f,1,T??null,V,!1,$,fe),f[vd]=_.current,Ed(f),x)for(f=0;f<x.length;f++)T=x[f],V=T._getVersion,V=V(T._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[T,V]:_.mutableSourceEagerHydrationData.push(T,V);return new j_(_)},ll.render=function(f,_,T){if(!z_(_))throw Error(i(200));return _v(null,f,_,!1,T)},ll.unmountComponentAtNode=function(f){if(!z_(f))throw Error(i(40));return f._reactRootContainer?(Bh(function(){_v(null,null,f,!1,function(){f._reactRootContainer=null,f[vd]=null})}),!0):!1},ll.unstable_batchedUpdates=of,ll.unstable_renderSubtreeIntoContainer=function(f,_,T,x){if(!z_(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return _v(f,_,T,!1,x)},ll.version="18.3.1-next-f1338f8080-20240426",ll}var oq;function YZ(){if(oq)return GM.exports;oq=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),GM.exports=KEe(),GM.exports}var aq;function qEe(){if(aq)return V1;aq=1;var n=YZ();return V1.createRoot=n.createRoot,V1.hydrateRoot=n.hydrateRoot,V1}var YEe=qEe();const $O=$g(YEe);function XEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function KO(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function JEe(){return!!(globalThis!=null&&globalThis.document)}function XZ(n){return n.parentElement&&XZ(n.parentElement)?!0:n.hidden}function QEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function ZEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function eve(n){var e;return((e=JZ(n))==null?void 0:e.defaultView)??window}function JZ(n){return KO(n)?n.ownerDocument:document}function tve(n){return n.view??window}function nve(n){return JZ(n).activeElement}function rve(n){const e=tve(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function QZ(n){return!!n.touches}function ive(n){return QZ(n)&&n.touches.length>1}function sve(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function ove(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function ZZ(n,e="page"){return QZ(n)?sve(n,e):ove(n,e)}function ave(n){return e=>{const i=rve(e);(!i||i&&e.button===0)&&n(e)}}function cve(n,e=!1){function i(l){n(l,{point:ZZ(l)})}return e?ave(i):i}function yk(n,e,i,o){return XEe(n,e,cve(i,e==="pointerdown"),o)}function lve(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const lr=n=>n?"":void 0,Lf=n=>n?!0:void 0;function uve(n){return Array.isArray(n)}function ed(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!uve(n)}function dve(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function hve(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function gV(n){if(n==null)return n;const{unitless:e}=hve(n);return e||typeof n=="number"?`${n}px`:n}const eee=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,QF=n=>Object.fromEntries(Object.entries(n).sort(eee));function cq(n){const e=QF(n);return Object.assign(Object.values(e),e)}function pve(n){const e=Object.keys(QF(n));return new Set(e)}function lq(n){if(!n)return n;n=gV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function sC(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${gV(n)})`),e&&i.push("and",`(max-width: ${gV(e)})`),i.join(" ")}function fve(n){if(!n)return null;n.base=n.base??"0px";const e=cq(n),i=Object.entries(n).sort(eee).map(([u,p],y,v)=>{let[,w]=v[y+1]??[];return w=parseFloat(w)>0?lq(w):void 0,{_minW:lq(p),breakpoint:u,minW:p,maxW:w,maxWQuery:sC(null,w),minWQuery:sC(p),minMaxQuery:sC(p,w)}}),o=pve(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const p=Object.keys(u);return p.length>0&&p.every(y=>o.has(y))},asObject:QF(n),asArray:cq(n),details:i,get(u){return i.find(p=>p.breakpoint===u)},media:[null,...e.map(u=>sC(u)).slice(1)],toArrayValue(u){if(!ed(u))throw new Error("toArrayValue: value must be an object");const p=l.map(y=>u[y]??null);for(;dve(p)===null;)p.pop();return p},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((p,y,v)=>{const w=l[v];return w!=null&&y!=null&&(p[w]=y),p},{})}}}function tee(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function Mn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function qO(n){return O.Children.toArray(n).filter(e=>O.isValidElement(e))}function YO(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function mve(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function ki(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:p}=n,y=O.createContext(p);y.displayName=e;function v(){var C;const w=O.useContext(y);if(!w&&i){const R=new Error(u??mve(o,l));throw R.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,R,v),R}return w}return[y.Provider,v,y]}const En=(...n)=>n.filter(Boolean).join(" "),nee=n=>n.hasAttribute("tabindex"),gve=n=>nee(n)&&n.tabIndex===-1;function tO(n){if(!KO(n)||XZ(n)||ZEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():QEe(n)?!0:nee(n)}function _ve(n){return n?KO(n)&&tO(n)&&!gve(n):!1}const yve=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],Eve=yve.join(),vve=n=>n.offsetWidth>0&&n.offsetHeight>0;function ree(n){const e=Array.from(n.querySelectorAll(Eve));return e.unshift(n),e.filter(i=>tO(i)&&vve(i))}function Sve(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const bve=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,p);return y.set(l,v),v}},iee=bve(Sve),wve=n=>n.default||n;function ZF(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function Tve(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function ej(n,e){let i=Tve(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function _V(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function uq(n,e,i){return(n-e)*100/(i-e)}function Cve(n,e,i){return(i-e)*n+e}function dq(n,e,i){const o=Math.round((n-e)/i)*i+e,l=_V(i);return ej(o,l)}function Ek(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function H0(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function see(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function XO(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):ed(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const Rve=n=>typeof n=="function";function gl(n,...e){return Rve(n)?n(...e):n}function Ive(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function Ave(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function oee(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:KO(n)&&Ive(n)?n:oee(Ave(n))}function Pve(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function kve(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=p=>{const y={};for(let v=0;v<p.length;v++){const w=p[v];i[w]&&(Object.defineProperty(y,w,i[w]),delete i[w])}return y},u=p=>l(Array.isArray(p)?p:o.filter(p));return e.map(u).concat(l(o))}function hq(n,e,i={}){const{stop:o,getKey:l}=i;function u(p,y=[]){if(ed(p)||Array.isArray(p)){const v={};for(const[w,C]of Object.entries(p)){const R=(l==null?void 0:l(w))??w,N=[...y,R];if(o!=null&&o(p,N))return e(p,y);v[R]=u(C,N)}return v}return e(p,y)}return u(n)}var oC={exports:{}};oC.exports;var pq;function Ove(){return pq||(pq=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,p=9007199254740991,y="[object Arguments]",v="[object Array]",w="[object AsyncFunction]",C="[object Boolean]",R="[object Date]",N="[object Error]",M="[object Function]",D="[object GeneratorFunction]",F="[object Map]",z="[object Number]",q="[object Null]",K="[object Object]",re="[object Proxy]",ce="[object RegExp]",se="[object Set]",ge="[object String]",X="[object Undefined]",J="[object WeakMap]",te="[object ArrayBuffer]",ne="[object DataView]",de="[object Float32Array]",pe="[object Float64Array]",he="[object Int8Array]",ve="[object Int16Array]",Te="[object Int32Array]",Fe="[object Uint8Array]",be="[object Uint8ClampedArray]",Re="[object Uint16Array]",Ae="[object Uint32Array]",xe=/[\\^$.*+?()[\]{}|]/g,Ee=/^\[object .+?Constructor\]$/,Ne=/^(?:0|[1-9]\d*)$/,je={};je[de]=je[pe]=je[he]=je[ve]=je[Te]=je[Fe]=je[be]=je[Re]=je[Ae]=!0,je[y]=je[v]=je[te]=je[C]=je[ne]=je[R]=je[N]=je[M]=je[F]=je[z]=je[K]=je[ce]=je[se]=je[ge]=je[J]=!1;var qe=typeof Ny=="object"&&Ny&&Ny.Object===Object&&Ny,at=typeof self=="object"&&self&&self.Object===Object&&self,_t=qe||at||Function("return this")(),ut=e&&!e.nodeType&&e,vt=ut&&!0&&n&&!n.nodeType&&n,it=vt&&vt.exports===ut,wt=it&&qe.process,$t=function(){try{var Ce=vt&&vt.require&&vt.require("util").types;return Ce||wt&&wt.binding&&wt.binding("util")}catch{}}(),dt=$t&&$t.isTypedArray;function mt(Ce,Me,ot){switch(ot.length){case 0:return Ce.call(Me);case 1:return Ce.call(Me,ot[0]);case 2:return Ce.call(Me,ot[0],ot[1]);case 3:return Ce.call(Me,ot[0],ot[1],ot[2])}return Ce.apply(Me,ot)}function ct(Ce,Me){for(var ot=-1,qt=Array(Ce);++ot<Ce;)qt[ot]=Me(ot);return qt}function Ft(Ce){return function(Me){return Ce(Me)}}function sn(Ce,Me){return Ce==null?void 0:Ce[Me]}function Ht(Ce,Me){return function(ot){return Ce(Me(ot))}}var we=Array.prototype,De=Function.prototype,$e=Object.prototype,kt=_t["__core-js_shared__"],At=De.toString,Tt=$e.hasOwnProperty,Ut=function(){var Ce=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),Sn=$e.toString,Pn=At.call(Object),hn=RegExp("^"+At.call(Tt).replace(xe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rt=it?_t.Buffer:void 0,Zn=_t.Symbol,Dt=_t.Uint8Array;Rt&&Rt.allocUnsafe;var Xt=Ht(Object.getPrototypeOf,Object),Vr=Object.create,Oi=$e.propertyIsEnumerable,li=we.splice,Ni=Zn?Zn.toStringTag:void 0,Es=function(){try{var Ce=za(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),Yo=Rt?Rt.isBuffer:void 0,qi=Math.max,xi=Date.now,Kn=za(_t,"Map"),ps=za(Object,"create"),ha=function(){function Ce(){}return function(Me){if(!jc(Me))return{};if(Vr)return Vr(Me);Ce.prototype=Me;var ot=new Ce;return Ce.prototype=void 0,ot}}();function Xo(Ce){var Me=-1,ot=Ce==null?0:Ce.length;for(this.clear();++Me<ot;){var qt=Ce[Me];this.set(qt[0],qt[1])}}function go(){this.__data__=ps?ps(null):{},this.size=0}function ld(Ce){var Me=this.has(Ce)&&delete this.__data__[Ce];return this.size-=Me?1:0,Me}function Jo(Ce){var Me=this.__data__;if(ps){var ot=Me[Ce];return ot===o?void 0:ot}return Tt.call(Me,Ce)?Me[Ce]:void 0}function ud(Ce){var Me=this.__data__;return ps?Me[Ce]!==void 0:Tt.call(Me,Ce)}function fc(Ce,Me){var ot=this.__data__;return this.size+=this.has(Ce)?0:1,ot[Ce]=ps&&Me===void 0?o:Me,this}Xo.prototype.clear=go,Xo.prototype.delete=ld,Xo.prototype.get=Jo,Xo.prototype.has=ud,Xo.prototype.set=fc;function Ao(Ce){var Me=-1,ot=Ce==null?0:Ce.length;for(this.clear();++Me<ot;){var qt=Ce[Me];this.set(qt[0],qt[1])}}function wr(){this.__data__=[],this.size=0}function uu(Ce){var Me=this.__data__,ot=Ks(Me,Ce);if(ot<0)return!1;var qt=Me.length-1;return ot==qt?Me.pop():li.call(Me,ot,1),--this.size,!0}function pa(Ce){var Me=this.__data__,ot=Ks(Me,Ce);return ot<0?void 0:Me[ot][1]}function Ba(Ce){return Ks(this.__data__,Ce)>-1}function Vc(Ce,Me){var ot=this.__data__,qt=Ks(ot,Ce);return qt<0?(++this.size,ot.push([Ce,Me])):ot[qt][1]=Me,this}Ao.prototype.clear=wr,Ao.prototype.delete=uu,Ao.prototype.get=pa,Ao.prototype.has=Ba,Ao.prototype.set=Vc;function Qo(Ce){var Me=-1,ot=Ce==null?0:Ce.length;for(this.clear();++Me<ot;){var qt=Ce[Me];this.set(qt[0],qt[1])}}function Zo(){this.size=0,this.__data__={hash:new Xo,map:new(Kn||Ao),string:new Xo}}function dd(Ce){var Me=pd(this,Ce).delete(Ce);return this.size-=Me?1:0,Me}function gh(Ce){return pd(this,Ce).get(Ce)}function Tl(Ce){return pd(this,Ce).has(Ce)}function _h(Ce,Me){var ot=pd(this,Ce),qt=ot.size;return ot.set(Ce,Me),this.size+=ot.size==qt?0:1,this}Qo.prototype.clear=Zo,Qo.prototype.delete=dd,Qo.prototype.get=gh,Qo.prototype.has=Tl,Qo.prototype.set=_h;function xs(Ce){var Me=this.__data__=new Ao(Ce);this.size=Me.size}function pt(){this.__data__=new Ao,this.size=0}function rn(Ce){var Me=this.__data__,ot=Me.delete(Ce);return this.size=Me.size,ot}function kr(Ce){return this.__data__.get(Ce)}function Di(Ce){return this.__data__.has(Ce)}function mc(Ce,Me){var ot=this.__data__;if(ot instanceof Ao){var qt=ot.__data__;if(!Kn||qt.length<i-1)return qt.push([Ce,Me]),this.size=++ot.size,this;ot=this.__data__=new Qo(qt)}return ot.set(Ce,Me),this.size=ot.size,this}xs.prototype.clear=pt,xs.prototype.delete=rn,xs.prototype.get=kr,xs.prototype.has=Di,xs.prototype.set=mc;function _o(Ce,Me){var ot=ya(Ce),qt=!ot&&Ss(Ce),sr=!ot&&!qt&&va(Ce),Fr=!ot&&!qt&&!sr&&Pl(Ce),ii=ot||qt||sr||Fr,er=ii?ct(Ce.length,String):[],tr=er.length;for(var Li in Ce)ii&&(Li=="length"||sr&&(Li=="offset"||Li=="parent")||Fr&&(Li=="buffer"||Li=="byteLength"||Li=="byteOffset")||Il(Li,tr))||er.push(Li);return er}function Cl(Ce,Me,ot){(ot!==void 0&&!_a(Ce[Me],ot)||ot===void 0&&!(Me in Ce))&&Gr(Ce,Me,ot)}function yh(Ce,Me,ot){var qt=Ce[Me];(!(Tt.call(Ce,Me)&&_a(qt,ot))||ot===void 0&&!(Me in Ce))&&Gr(Ce,Me,ot)}function Ks(Ce,Me){for(var ot=Ce.length;ot--;)if(_a(Ce[ot][0],Me))return ot;return-1}function Gr(Ce,Me,ot){Me=="__proto__"&&Es?Es(Ce,Me,{configurable:!0,enumerable:!0,value:ot,writable:!0}):Ce[Me]=ot}var Eh=hd();function Hr(Ce){return Ce==null?Ce===void 0?X:q:Ni&&Ni in Object(Ce)?ga(Ce):Sh(Ce)}function fa(Ce){return Ds(Ce)&&Hr(Ce)==y}function Yi(Ce){if(!jc(Ce)||pu(Ce))return!1;var Me=Wa(Ce)?hn:Ee;return Me.test(Wp(Ce))}function vs(Ce){return Ds(Ce)&&Gp(Ce.length)&&!!je[Hr(Ce)]}function ri(Ce){if(!jc(Ce))return Al(Ce);var Me=fr(Ce),ot=[];for(var qt in Ce)qt=="constructor"&&(Me||!Tt.call(Ce,qt))||ot.push(qt);return ot}function Fc(Ce,Me,ot,qt,sr){Ce!==Me&&Eh(Me,function(Fr,ii){if(sr||(sr=new xs),jc(Fr))ma(Ce,Me,ii,ot,Fc,qt,sr);else{var er=qt?qt(fu(Ce,ii),Fr,ii+"",Ce,Me,sr):void 0;er===void 0&&(er=Fr),Cl(Ce,ii,er)}},gu)}function ma(Ce,Me,ot,qt,sr,Fr,ii){var er=fu(Ce,ot),tr=fu(Me,ot),Li=ii.get(tr);if(Li){Cl(Ce,ot,Li);return}var qs=Fr?Fr(er,tr,ot+"",Ce,Me,ii):void 0,Bc=qs===void 0;if(Bc){var ko=ya(tr),_u=!ko&&va(tr),Ls=!ko&&!_u&&Pl(tr);qs=tr,ko||_u||Ls?ya(er)?qs=er:mu(er)?qs=du(er):_u?(Bc=!1,qs=Bp(tr)):Ls?(Bc=!1,qs=Rl(tr)):qs=[]:Zg(tr)||Ss(tr)?(qs=er,Ss(er)?qs=kl(er):(!jc(er)||Wa(er))&&(qs=fd(tr))):Bc=!1}Bc&&(ii.set(tr,qs),sr(qs,tr,qt,Fr,ii),ii.delete(tr)),Cl(Ce,ot,qs)}function jp(Ce,Me){return rm(bh(Ce,Me,Sa),Ce+"")}var Po=Es?function(Ce,Me){return Es(Ce,"toString",{configurable:!0,enumerable:!1,value:gc(Me),writable:!0})}:Sa;function Bp(Ce,Me){return Ce.slice()}function nm(Ce){var Me=new Ce.constructor(Ce.byteLength);return new Dt(Me).set(new Dt(Ce)),Me}function Rl(Ce,Me){var ot=nm(Ce.buffer);return new Ce.constructor(ot,Ce.byteOffset,Ce.length)}function du(Ce,Me){var ot=-1,qt=Ce.length;for(Me||(Me=Array(qt));++ot<qt;)Me[ot]=Ce[ot];return Me}function vh(Ce,Me,ot,qt){var sr=!ot;ot||(ot={});for(var Fr=-1,ii=Me.length;++Fr<ii;){var er=Me[Fr],tr=void 0;tr===void 0&&(tr=Ce[er]),sr?Gr(ot,er,tr):yh(ot,er,tr)}return ot}function Or(Ce){return jp(function(Me,ot){var qt=-1,sr=ot.length,Fr=sr>1?ot[sr-1]:void 0,ii=sr>2?ot[2]:void 0;for(Fr=Ce.length>3&&typeof Fr=="function"?(sr--,Fr):void 0,ii&&hu(ot[0],ot[1],ii)&&(Fr=sr<3?void 0:Fr,sr=1),Me=Object(Me);++qt<sr;){var er=ot[qt];er&&Ce(Me,er,qt,Fr)}return Me})}function hd(Ce){return function(Me,ot,qt){for(var sr=-1,Fr=Object(Me),ii=qt(Me),er=ii.length;er--;){var tr=ii[++sr];if(ot(Fr[tr],tr,Fr)===!1)break}return Me}}function pd(Ce,Me){var ot=Ce.__data__;return ui(Me)?ot[typeof Me=="string"?"string":"hash"]:ot.map}function za(Ce,Me){var ot=sn(Ce,Me);return Yi(ot)?ot:void 0}function ga(Ce){var Me=Tt.call(Ce,Ni),ot=Ce[Ni];try{Ce[Ni]=void 0;var qt=!0}catch{}var sr=Sn.call(Ce);return qt&&(Me?Ce[Ni]=ot:delete Ce[Ni]),sr}function fd(Ce){return typeof Ce.constructor=="function"&&!fr(Ce)?ha(Xt(Ce)):{}}function Il(Ce,Me){var ot=typeof Ce;return Me=Me??p,!!Me&&(ot=="number"||ot!="symbol"&&Ne.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<Me}function hu(Ce,Me,ot){if(!jc(ot))return!1;var qt=typeof Me;return(qt=="number"?Ea(ot)&&Il(Me,ot.length):qt=="string"&&Me in ot)?_a(ot[Me],Ce):!1}function ui(Ce){var Me=typeof Ce;return Me=="string"||Me=="number"||Me=="symbol"||Me=="boolean"?Ce!=="__proto__":Ce===null}function pu(Ce){return!!Ut&&Ut in Ce}function fr(Ce){var Me=Ce&&Ce.constructor,ot=typeof Me=="function"&&Me.prototype||$e;return Ce===ot}function Al(Ce){var Me=[];if(Ce!=null)for(var ot in Object(Ce))Me.push(ot);return Me}function Sh(Ce){return Sn.call(Ce)}function bh(Ce,Me,ot){return Me=qi(Me===void 0?Ce.length-1:Me,0),function(){for(var qt=arguments,sr=-1,Fr=qi(qt.length-Me,0),ii=Array(Fr);++sr<Fr;)ii[sr]=qt[Me+sr];sr=-1;for(var er=Array(Me+1);++sr<Me;)er[sr]=qt[sr];return er[Me]=ot(ii),mt(Ce,this,er)}}function fu(Ce,Me){if(!(Me==="constructor"&&typeof Ce[Me]=="function")&&Me!="__proto__")return Ce[Me]}var rm=zp(Po);function zp(Ce){var Me=0,ot=0;return function(){var qt=xi(),sr=u-(qt-ot);if(ot=qt,sr>0){if(++Me>=l)return arguments[0]}else Me=0;return Ce.apply(void 0,arguments)}}function Wp(Ce){if(Ce!=null){try{return At.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function _a(Ce,Me){return Ce===Me||Ce!==Ce&&Me!==Me}var Ss=fa(function(){return arguments}())?fa:function(Ce){return Ds(Ce)&&Tt.call(Ce,"callee")&&!Oi.call(Ce,"callee")},ya=Array.isArray;function Ea(Ce){return Ce!=null&&Gp(Ce.length)&&!Wa(Ce)}function mu(Ce){return Ds(Ce)&&Ea(Ce)}var va=Yo||Ol;function Wa(Ce){if(!jc(Ce))return!1;var Me=Hr(Ce);return Me==M||Me==D||Me==w||Me==re}function Gp(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=p}function jc(Ce){var Me=typeof Ce;return Ce!=null&&(Me=="object"||Me=="function")}function Ds(Ce){return Ce!=null&&typeof Ce=="object"}function Zg(Ce){if(!Ds(Ce)||Hr(Ce)!=K)return!1;var Me=Xt(Ce);if(Me===null)return!0;var ot=Tt.call(Me,"constructor")&&Me.constructor;return typeof ot=="function"&&ot instanceof ot&&At.call(ot)==Pn}var Pl=dt?Ft(dt):vs;function kl(Ce){return vh(Ce,gu(Ce))}function gu(Ce){return Ea(Ce)?_o(Ce):ri(Ce)}var im=Or(function(Ce,Me,ot,qt){Fc(Ce,Me,ot,qt)});function gc(Ce){return function(){return Ce}}function Sa(Ce){return Ce}function Ol(){return!1}n.exports=im}(oC,oC.exports)),oC.exports}var Nve=Ove();const Sp=$g(Nve);function uo(n,e=[]){const i=O.useRef(n);return O.useEffect(()=>{i.current=n}),O.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Vy(n,e,i,o){const l=uo(i);return O.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function aee(n){const{isOpen:e,ref:i}=n,[o,l]=O.useState(e),[u,p]=O.useState(!1);return O.useEffect(()=>{u||(l(e),p(!0))},[e,u,o]),Vy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const v=eve(i.current),w=new v.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(w)}}}var KM,fq;function xve(){return fq||(fq=1,KM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),KM}var qM,mq;function Dve(){if(mq)return qM;mq=1;var n=xve(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,p)}function l(u,p){var y,v,w,C,R,N,M=!1;p||(p={}),y=p.debug||!1;try{w=n(),C=document.createRange(),R=document.getSelection(),N=document.createElement("span"),N.textContent=u,N.ariaHidden="true",N.style.all="unset",N.style.position="fixed",N.style.top=0,N.style.clip="rect(0, 0, 0, 0)",N.style.whiteSpace="pre",N.style.webkitUserSelect="text",N.style.MozUserSelect="text",N.style.msUserSelect="text",N.style.userSelect="text",N.addEventListener("copy",function(F){if(F.stopPropagation(),p.format)if(F.preventDefault(),typeof F.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=e[p.format]||e.default;window.clipboardData.setData(z,u)}else F.clipboardData.clearData(),F.clipboardData.setData(p.format,u);p.onCopy&&(F.preventDefault(),p.onCopy(F.clipboardData))}),document.body.appendChild(N),C.selectNodeContents(N),R.addRange(C);var D=document.execCommand("copy");if(!D)throw new Error("copy command was unsuccessful");M=!0}catch(F){y&&console.error("unable to copy using execCommand: ",F),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",u),p.onCopy&&p.onCopy(window.clipboardData),M=!0}catch(z){y&&console.error("unable to copy using clipboardData: ",z),y&&console.error("falling back to prompt"),v=o("message"in p?p.message:i),window.prompt(v,u)}}finally{R&&(typeof R.removeRange=="function"?R.removeRange(C):R.removeAllRanges()),N&&document.body.removeChild(N),w()}return M}return qM=l,qM}var Lve=Dve();const gq=$g(Lve);function _q(n,e={}){const[i,o]=O.useState(!1),[l,u]=O.useState(n);O.useEffect(()=>u(n),[n]);const{timeout:p=1500,...y}=typeof e=="number"?{timeout:e}:e,v=O.useCallback(w=>{const C=typeof w=="string"?w:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(gq(C,y))):o(gq(C,y))},[l,y]);return O.useEffect(()=>{let w=null;return i&&(w=window.setTimeout(()=>{o(!1)},p)),()=>{w&&window.clearTimeout(w)}},[p,i]),{value:l,setValue:u,onCopy:v,hasCopied:i}}function cee(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(N,M)=>N!==M}=n,u=uo(o),p=uo(l),[y,v]=O.useState(i),w=e!==void 0,C=w?e:y,R=uo(N=>{const D=typeof N=="function"?N(C):N;p(C,D)&&(w||v(D),u(D))},[w,u,C,p]);return[C,R]}function Mve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:p=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,w=uo(e),[C,R]=O.useState(()=>o==null?"":YM(o,u,i)??""),N=typeof l<"u",M=N?l:C,D=lee(mg(M),u),F=i??D,z=O.useCallback(ne=>{ne!==M&&(N||R(ne.toString()),w==null||w(ne.toString(),mg(ne)))},[w,N,M]),q=O.useCallback(ne=>{let de=ne;return v&&(de=Ek(de,p,y)),ej(de,F)},[F,v,y,p]),K=O.useCallback((ne=u)=>{let de;M===""?de=mg(ne):de=mg(M)+ne,de=q(de),z(de)},[q,u,z,M]),re=O.useCallback((ne=u)=>{let de;M===""?de=mg(-ne):de=mg(M)-ne,de=q(de),z(de)},[q,u,z,M]),ce=O.useCallback(()=>{let ne;o==null?ne="":ne=YM(o,u,i)??p,z(ne)},[o,i,u,z,p]),se=O.useCallback(ne=>{const de=YM(ne,u,F)??p;z(de)},[F,u,z,p]),ge=mg(M);return{isOutOfRange:ge>y||ge<p,isAtMax:ge===y,isAtMin:ge===p,precision:F,value:M,valueAsNumber:ge,update:z,reset:ce,increment:K,decrement:re,clamp:q,cast:se,setValue:R}}function mg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function lee(n,e){return Math.max(_V(e),_V(n))}function YM(n,e,i){const o=mg(n);if(Number.isNaN(o))return;const l=lee(o,e);return ej(o,i??l)}function sd(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=uo(i),p=uo(e),[y,v]=O.useState(n.defaultIsOpen||!1),w=o!==void 0?o:y,C=o!==void 0,R=O.useId(),N=l??`disclosure-${R}`,M=O.useCallback(()=>{C||v(!1),p==null||p()},[C,p]),D=O.useCallback(()=>{C||v(!0),u==null||u()},[C,u]),F=O.useCallback(()=>{w?M():D()},[w,D,M]);function z(K={}){return{...K,"aria-expanded":w,"aria-controls":N,onClick(re){var ce;(ce=K.onClick)==null||ce.call(K,re),F()}}}function q(K={}){return{...K,hidden:!w,id:N}}return{isOpen:w,onOpen:D,onClose:M,onToggle:F,isControlled:C,getButtonProps:z,getDisclosureProps:q}}const Cp=globalThis!=null&&globalThis.document?O.useLayoutEffect:O.useEffect,zf=(n,e)=>{const i=O.useRef(!1),o=O.useRef(!1);O.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),O.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function Uve(n){const e=n.current;if(!e)return!1;const i=nve(e);return!i||e.contains(i)?!1:!!_ve(i)}function uee(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;zf(()=>{if(!u||Uve(n))return;const p=(l==null?void 0:l.current)||n.current;let y;if(p)return y=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[u,n,l])}const Vve={preventScroll:!0,shouldFocus:!1};function Fve(n,e=Vve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,p=jve(n)?n.current:n,y=l&&u,v=O.useRef(y),w=O.useRef(u);Cp(()=>{!w.current&&u&&(v.current=y),w.current=u},[u,y]);const C=O.useCallback(()=>{if(!(!u||!p||!v.current)&&(v.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var R;(R=i.current)==null||R.focus({preventScroll:o})});else{const R=ree(p);R.length>0&&requestAnimationFrame(()=>{R[0].focus({preventScroll:o})})}},[u,o,p,i]);zf(()=>{C()},[C]),Vy(p,"transitionend",C)}function jve(n){return"current"in n}function Bve(n){return"current"in n}const dee=()=>typeof window<"u";function zve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const Wve=n=>dee()&&n.test(navigator.vendor),Gve=n=>dee()&&n.test(zve()),Hve=()=>Gve(/mac|iphone|ipad|ipod/i),$ve=()=>Hve()&&Wve(/apple/i);function Kve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Vy(l,"pointerdown",u=>{var w,C;if(!$ve()||!o)return;const p=((C=(w=u.composedPath)==null?void 0:w.call(u))==null?void 0:C[0])??u.target,v=(i??[e]).some(R=>{const N=Bve(R)?R.current:R;return(N==null?void 0:N.contains(p))||N===p});l().activeElement!==p&&v&&(u.preventDefault(),p.focus())})}function qve(n,e){const i=O.useId();return O.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function Yve(n,...e){const i=qve(n);return O.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function Xve(n,e){const i=uo(n);O.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function hee(n){const e=O.useRef(null);return e.current=n,e}function Jve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Ki(...n){return e=>{n.forEach(i=>{Jve(i,e)})}}function Qve(...n){return O.useMemo(()=>Ki(...n),n)}function pee(n){const{ref:e,handler:i,enabled:o=!0}=n,l=uo(i),p=O.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;O.useEffect(()=>{if(!o)return;const y=R=>{XM(R,e)&&(p.isPointerDown=!0)},v=R=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&XM(R,e)&&(p.isPointerDown=!1,l(R))},w=R=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&XM(R,e)&&(p.isPointerDown=!1,l(R))},C=fee(e.current);return C.addEventListener("mousedown",y,!0),C.addEventListener("mouseup",v,!0),C.addEventListener("touchstart",y,!0),C.addEventListener("touchend",w,!0),()=>{C.removeEventListener("mousedown",y,!0),C.removeEventListener("mouseup",v,!0),C.removeEventListener("touchstart",y,!0),C.removeEventListener("touchend",w,!0)}},[i,e,l,p,o])}function XM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!fee(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function fee(n){return(n==null?void 0:n.ownerDocument)??document}function Zve(n,e){const i=uo(n);O.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const mee=1/60*1e3,eSe=typeof performance<"u"?()=>performance.now():()=>Date.now(),gee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(eSe()),mee);function tSe(n){let e=[],i=[],o=0,l=!1,u=!1;const p=new WeakSet,y={schedule:(v,w=!1,C=!1)=>{const R=C&&l,N=R?e:i;return w&&p.add(v),N.indexOf(v)===-1&&(N.push(v),R&&l&&(o=e.length)),v},cancel:v=>{const w=i.indexOf(v);w!==-1&&i.splice(w,1),p.delete(v)},process:v=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let w=0;w<o;w++){const C=e[w];C(v),p.has(C)&&(y.schedule(C),n())}l=!1,u&&(u=!1,y.process(v))}};return y}const nSe=40;let yV=!0,KC=!1,EV=!1;const JS={delta:0,timestamp:0},CR=["read","update","preRender","render","postRender"],JO=CR.reduce((n,e)=>(n[e]=tSe(()=>KC=!0),n),{}),rSe=CR.reduce((n,e)=>{const i=JO[e];return n[e]=(o,l=!1,u=!1)=>(KC||oSe(),i.schedule(o,l,u)),n},{}),iSe=CR.reduce((n,e)=>(n[e]=JO[e].cancel,n),{});CR.reduce((n,e)=>(n[e]=()=>JO[e].process(JS),n),{});const sSe=n=>JO[n].process(JS),_ee=n=>{KC=!1,JS.delta=yV?mee:Math.max(Math.min(n-JS.timestamp,nSe),1),JS.timestamp=n,EV=!0,CR.forEach(sSe),EV=!1,KC&&(yV=!1,gee(_ee))},oSe=()=>{KC=!0,yV=!0,EV||gee(_ee)},yq=()=>JS;var aSe=Object.defineProperty,cSe=(n,e,i)=>e in n?aSe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Zd=(n,e,i)=>(cSe(n,typeof e!="symbol"?e+"":e,i),i);class lSe{constructor(e,i,o){if(Zd(this,"history",[]),Zd(this,"startEvent",null),Zd(this,"lastEvent",null),Zd(this,"lastEventInfo",null),Zd(this,"handlers",{}),Zd(this,"removeListeners",()=>{}),Zd(this,"threshold",3),Zd(this,"win"),Zd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=JM(this.lastEventInfo,this.history),v=this.startEvent!==null,w=pSe(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!w)return;const{timestamp:C}=yq();this.history.push({...y.point,timestamp:C});const{onStart:R,onMove:N}=this.handlers;v||(R==null||R(this.lastEvent,y),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,y)}),Zd(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,rSe.update(this.updatePoint,!0)}),Zd(this,"onPointerUp",(y,v)=>{const w=JM(v,this.history),{onEnd:C,onSessionEnd:R}=this.handlers;R==null||R(y,w),this.end(),!(!C||!this.startEvent)&&(C==null||C(y,w))}),this.win=e.view??window,ive(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:ZZ(e)},{timestamp:u}=yq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:p}=i;p==null||p(e,JM(l,this.history)),this.removeListeners=hSe(yk(this.win,"pointermove",this.onPointerMove),yk(this.win,"pointerup",this.onPointerUp),yk(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),iSe.update(this.updatePoint)}}function Eq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function JM(n,e){return{point:n.point,delta:Eq(n.point,e[e.length-1]),offset:Eq(n.point,e[0]),velocity:dSe(e,.1)}}const uSe=n=>n*1e3;function dSe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>uSe(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function hSe(...n){return e=>n.reduce((i,o)=>o(i),e)}function QM(n,e){return Math.abs(n-e)}function vq(n){return"x"in n&&"y"in n}function pSe(n,e){if(typeof n=="number"&&typeof e=="number")return QM(n,e);if(vq(n)&&vq(e)){const i=QM(n.x,e.x),o=QM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function fSe(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:p,threshold:y}=e,v=!!(i||o||l||u||p),w=O.useRef(null),C=hee({onSessionStart:u,onSessionEnd:p,onStart:o,onMove:i,onEnd(R,N){w.current=null,l==null||l(R,N)}});O.useEffect(()=>{var R;(R=w.current)==null||R.updateHandlers(C.current)}),O.useEffect(()=>{const R=n.current;if(!R||!v)return;function N(M){w.current=new lSe(M,C.current,y)}return yk(R,"pointerdown",N)},[n,v,C,y]),O.useEffect(()=>()=>{var R;(R=w.current)==null||R.end(),w.current=null},[])}const Vo={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},lp=n=>yee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Tf=n=>yee(e=>n(e,"~ &"),"[data-peer]",".peer"),yee=(n,...e)=>e.map(n).join(", "),QS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:lp(Vo.open),_groupClosed:lp(Vo.closed),_groupHover:lp(Vo.hover),_peerHover:Tf(Vo.hover),_groupFocus:lp(Vo.focus),_peerFocus:Tf(Vo.focus),_groupFocusVisible:lp(Vo.focusVisible),_peerFocusVisible:Tf(Vo.focusVisible),_groupActive:lp(Vo.active),_peerActive:Tf(Vo.active),_groupDisabled:lp(Vo.disabled),_peerDisabled:Tf(Vo.disabled),_groupInvalid:lp(Vo.invalid),_peerInvalid:Tf(Vo.invalid),_groupChecked:lp(Vo.checked),_peerChecked:Tf(Vo.checked),_groupFocusWithin:lp(Vo.focusWithin),_peerFocusWithin:Tf(Vo.focusWithin),_peerPlaceholderShown:Tf(Vo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},Eee=Object.keys(QS),mSe=n=>/!(important)?$/.test(n),Sq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,gSe=(n,e)=>i=>{const o=String(e),l=mSe(o),u=Sq(o),p=n?`${n}.${u}`:u;let y=ed(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return y=Sq(y),l?`${y} !important`:y};function tj(n){const{scale:e,transform:i,compose:o}=n;return(u,p)=>{const y=gSe(e,u)(p);let v=(i==null?void 0:i(y,p))??y;return o&&(v=o(v,p)),v}}const F1=(...n)=>e=>n.reduce((i,o)=>o(i),e);function qu(n,e){return i=>{const o={property:i,scale:n};return o.transform=tj({scale:n,transform:e}),o}}const _Se=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function ySe(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:_Se(e),transform:i?tj({scale:i,compose:o}):o}}const vee=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function ESe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...vee].join(" ")}function vSe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...vee].join(" ")}const SSe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},bSe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function wSe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const TSe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},vV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},CSe=new Set(Object.values(vV)),SV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),RSe=n=>n.trim();function ISe(n,e){if(n==null||SV.has(n))return n;if(!(bV(n)||SV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!u||!p)return n;const y=u.includes("-gradient")?u:`${u}-gradient`,[v,...w]=p.split(",").map(RSe).filter(Boolean);if((w==null?void 0:w.length)===0)return n;const C=v in vV?vV[v]:v;w.unshift(C);const R=w.map(N=>{if(CSe.has(N))return N;const M=N.indexOf(" "),[D,F]=M!==-1?[N.substr(0,M),N.substr(M+1)]:[N],z=bV(F)?F:F&&F.split(" "),q=`colors.${D}`,K=q in e.__cssMap?e.__cssMap[q].varRef:D;return z?[K,...Array.isArray(z)?z:[z]].join(" "):K});return`${y}(${R.join(", ")})`}const bV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),ASe=(n,e)=>ISe(n,e??{});function PSe(n){return/^var\(--.+\)$/.test(n)}const kSe=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},up=n=>e=>`${n}(${e})`,Yr={filter(n){return n!=="auto"?n:SSe},backdropFilter(n){return n!=="auto"?n:bSe},ring(n){return wSe(Yr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?ESe():n==="auto-gpu"?vSe():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=kSe(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(PSe(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:ASe,blur:up("blur"),opacity:up("opacity"),brightness:up("brightness"),contrast:up("contrast"),dropShadow:up("drop-shadow"),grayscale:up("grayscale"),hueRotate:n=>up("hue-rotate")(Yr.degree(n)),invert:up("invert"),saturate:up("saturate"),sepia:up("sepia"),bgImage(n){return n==null||bV(n)||SV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=TSe[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Ge={borderWidths:qu("borderWidths"),borderStyles:qu("borderStyles"),colors:qu("colors"),borders:qu("borders"),gradients:qu("gradients",Yr.gradient),radii:qu("radii",Yr.px),space:qu("space",F1(Yr.vh,Yr.px)),spaceT:qu("space",F1(Yr.vh,Yr.px)),degreeT(n){return{property:n,transform:Yr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:tj({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:qu("sizes",F1(Yr.vh,Yr.px)),sizesT:qu("sizes",F1(Yr.vh,Yr.fraction)),shadows:qu("shadows"),logical:ySe,blur:qu("blur",Yr.blur)},vk={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Yr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:Yr.bgClip}};Object.assign(vk,{bgImage:vk.backgroundImage,bgImg:vk.backgroundImage});const pi={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(pi,{rounded:pi.borderRadius,roundedTop:pi.borderTopRadius,roundedTopLeft:pi.borderTopLeftRadius,roundedTopRight:pi.borderTopRightRadius,roundedTopStart:pi.borderStartStartRadius,roundedTopEnd:pi.borderStartEndRadius,roundedBottom:pi.borderBottomRadius,roundedBottomLeft:pi.borderBottomLeftRadius,roundedBottomRight:pi.borderBottomRightRadius,roundedBottomStart:pi.borderEndStartRadius,roundedBottomEnd:pi.borderEndEndRadius,roundedLeft:pi.borderLeftRadius,roundedRight:pi.borderRightRadius,roundedStart:pi.borderInlineStartRadius,roundedEnd:pi.borderInlineEndRadius,borderStart:pi.borderInlineStart,borderEnd:pi.borderInlineEnd,borderTopStartRadius:pi.borderStartStartRadius,borderTopEndRadius:pi.borderStartEndRadius,borderBottomStartRadius:pi.borderEndStartRadius,borderBottomEndRadius:pi.borderEndEndRadius,borderStartRadius:pi.borderInlineStartRadius,borderEndRadius:pi.borderInlineEndRadius,borderStartWidth:pi.borderInlineStartWidth,borderEndWidth:pi.borderInlineEndWidth,borderStartColor:pi.borderInlineStartColor,borderEndColor:pi.borderInlineEndColor,borderStartStyle:pi.borderInlineStartStyle,borderEndStyle:pi.borderInlineEndStyle});const OSe={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},nO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Yr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(nO,{flexDir:nO.flexDirection});const Ju={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",Yr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Ju,{w:Ju.width,h:Ju.height,minW:Ju.minWidth,maxW:Ju.maxWidth,minH:Ju.minHeight,maxH:Ju.maxHeight,overscroll:Ju.overscrollBehavior,overscrollX:Ju.overscrollBehaviorX,overscrollY:Ju.overscrollBehaviorY});const NSe={filter:{transform:Yr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",Yr.brightness),contrast:Ge.propT("--chakra-contrast",Yr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",Yr.hueRotate),invert:Ge.propT("--chakra-invert",Yr.invert),saturate:Ge.propT("--chakra-saturate",Yr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",Yr.dropShadow),backdropFilter:{transform:Yr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",Yr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",Yr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",Yr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",Yr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",Yr.saturate)},xSe={ring:{transform:Yr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},DSe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Yr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},See={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function LSe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const MSe=n=>{const e=new WeakMap;return(o,l,u,p)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,p);return y.set(l,v),v}},USe=MSe(LSe),VSe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},FSe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},ZM=(n,e,i)=>{const o={},l=USe(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},jSe={srOnly:{transform(n){return n===!0?VSe:n==="focusable"?FSe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>ZM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>ZM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>ZM(e,n,i)}},TC={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(TC,{insetStart:TC.insetInlineStart,insetEnd:TC.insetInlineEnd});const wV={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(wV,{shadow:wV.boxShadow});const as={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(as,{m:as.margin,mt:as.marginTop,mr:as.marginRight,me:as.marginInlineEnd,marginEnd:as.marginInlineEnd,mb:as.marginBottom,ml:as.marginLeft,ms:as.marginInlineStart,marginStart:as.marginInlineStart,mx:as.marginX,my:as.marginY,p:as.padding,pt:as.paddingTop,py:as.paddingY,px:as.paddingX,pb:as.paddingBottom,pl:as.paddingLeft,ps:as.paddingInlineStart,paddingStart:as.paddingInlineStart,pr:as.paddingRight,pe:as.paddingInlineEnd,paddingEnd:as.paddingInlineEnd});const BSe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},zSe={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",Yr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},WSe={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},GSe={clipPath:!0,transform:Ge.propT("transform",Yr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},HSe={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},$Se={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},nj=Sp({},vk,pi,OSe,nO,Ju,NSe,xSe,DSe,See,jSe,TC,wV,as,BSe,zSe,WSe,GSe,HSe,$Se),KSe=Object.assign({},as,Ju,nO,See,TC),qSe=Object.keys(KSe),YSe=[...Object.keys(nj),...Eee],XSe={...nj,...QS},JSe=n=>n in XSe,QSe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const p in n){let y=gl(n[p],e);if(y==null)continue;if(y=ed(y)&&i(y)?o(y):y,!Array.isArray(y)){u[p]=y;continue}const v=y.slice(0,l.length).length;for(let w=0;w<v;w+=1){const C=l==null?void 0:l[w];if(!C){u[p]=y[w];continue}u[C]=u[C]||{},y[w]!=null&&(u[C][p]=y[w])}}return u};function ZSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function e0e(n){return/^var\(--.+\)$/.test(n)}const t0e=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!e0e(e),n0e=(n,e)=>{if(e==null)return e;const i=p=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[p])==null?void 0:v.varRef},o=p=>i(p)??p,[l,u]=ZSe(e);return e=i(l)??o(u)??o(e),e};function r0e(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,p=!1)=>{var C;const y=gl(u,o),v=QSe(y)(o);let w={};for(let R in v){const N=v[R];let M=gl(N,o);R in i&&(R=i[R]),t0e(R,M)&&(M=n0e(o,M));let D=e[R];if(D===!0&&(D={property:R}),ed(M)){w[R]=w[R]??{},w[R]=Sp({},w[R],l(M,!0));continue}let F=((C=D==null?void 0:D.transform)==null?void 0:C.call(D,M,o,y))??M;F=D!=null&&D.processResult?l(F,!0):F;const z=gl(D==null?void 0:D.property,o);if(!p&&(D!=null&&D.static)){const q=gl(D.static,o);w=Sp({},w,q)}if(z&&Array.isArray(z)){for(const q of z)w[q]=F;continue}if(z){z==="&"&&ed(F)?w=Sp({},w,F):w[z]=F;continue}if(ed(F)){w=Sp({},w,F);continue}w[R]=F}return w};return l}const bee=n=>e=>r0e({theme:e,pseudos:QS,configs:nj})(n);function AHe(n){return n}function PHe(n){return n}function es(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function i0e(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function s0e(n,e){if(Array.isArray(n))return n;if(ed(n))return e(n);if(n!=null)return[n]}function o0e(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function a0e(n){const e=n.__breakpoints;return function(o,l,u,p){var N,M;if(!e)return;const y={},v=s0e(u,e.toArrayValue);if(!v)return y;const w=v.length,C=w===1,R=!!o.parts;for(let D=0;D<w;D++){const F=e.details[D],z=e.details[o0e(v,D)],q=sC(F.minW,z==null?void 0:z._minW),K=gl((N=o[l])==null?void 0:N[v[D]],p);if(K){if(R){(M=o.parts)==null||M.forEach(re=>{Sp(y,{[re]:C?K[re]:{[q]:K[re]}})});continue}if(!R){C?Sp(y,K):y[q]=K;continue}y[q]=K}}return y}}function c0e(n){return e=>{const{variant:i,size:o,theme:l}=e,u=a0e(l);return Sp({},gl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Bi(n){return H0(n,["styleConfig","size","variant","colorScheme"])}function wee(n){return ed(n)&&n.reference?n.reference:String(n)}const QO=(n,...e)=>e.map(wee).join(` ${n} `).replace(/calc/g,""),bq=(...n)=>`calc(${QO("+",...n)})`,wq=(...n)=>`calc(${QO("-",...n)})`,TV=(...n)=>`calc(${QO("*",...n)})`,Tq=(...n)=>`calc(${QO("/",...n)})`,Cq=n=>{const e=wee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:TV(e,-1)},If=Object.assign(n=>({add:(...e)=>If(bq(n,...e)),subtract:(...e)=>If(wq(n,...e)),multiply:(...e)=>If(TV(n,...e)),divide:(...e)=>If(Tq(n,...e)),negate:()=>If(Cq(n)),toString:()=>n.toString()}),{add:bq,subtract:wq,multiply:TV,divide:Tq,negate:Cq});function l0e(n,e="-"){return n.replace(/\s+/g,e)}function u0e(n){const e=l0e(n.toString());return h0e(d0e(e))}function d0e(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function h0e(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function p0e(n,e=""){return[e,n].filter(Boolean).join("-")}function f0e(n,e){return`var(${n}${e?`, ${e}`:""})`}function m0e(n,e=""){return u0e(`--${p0e(n,e)}`)}function Wn(n,e,i){const o=m0e(n,i);return{variable:o,reference:f0e(o,e)}}function g0e(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=Wn(`${n}-${l}`,u);continue}i[o]=Wn(`${n}-${o}`)}return i}const _0e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function y0e(n){return see(n,_0e)}function E0e(n){return n.semanticTokens}function v0e(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function S0e(n){const e=y0e(n),i=E0e(n),o=u=>Eee.includes(u)||u==="default",l={};return hq(e,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!1,value:u})}),hq(i,(u,p)=>{u!=null&&(l[p.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function Rq(n,e){return Wn(String(n).replace(/\./g,"-"),void 0,e)}function b0e(n){var p;const e=S0e(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let o={};const l={};function u(y,v){const C=[String(y).split(".")[0],v].join(".");if(!e[C])return v;const{reference:N}=Rq(C,i);return N}for(const[y,v]of Object.entries(e)){const{isSemantic:w,value:C}=v,{variable:R,reference:N}=Rq(y,i);if(!w){if(y.startsWith("space")){const D=y.split("."),[F,...z]=D,q=`${F}.-${z.join(".")}`,K=If.negate(C),re=If.negate(N);l[q]={value:K,var:R,varRef:re}}o[R]=C,l[y]={value:C,var:R,varRef:N};continue}const M=ed(C)?C:{default:C};o=Sp(o,Object.entries(M).reduce((D,[F,z])=>{if(!z)return D;const q=u(y,`${z}`);if(F==="default")return D[R]=q,D;const K=(QS==null?void 0:QS[F])??F;return D[K]={[R]:q},D},{})),l[y]={value:N,var:R,varRef:N}}return{cssVars:o,cssMap:l}}function w0e(n){const e=v0e(n),{cssMap:i,cssVars:o}=b0e(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:fve(e.breakpoints)}),e}function yi(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const R of C)e[R]=v(R);return yi(n,e)}function u(...C){for(const R of C)R in e||(e[R]=v(R));return yi(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([R,N])=>[R,N.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([R,N])=>[R,N.className]))}function v(C){const M=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:M,selector:`.${M}`,toString:()=>C}}return{parts:l,toPart:v,extend:u,selectors:p,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const T0e=yi("accordion").parts("root","container","button","panel","icon"),C0e=yi("alert").parts("title","description","container","icon","spinner"),R0e=yi("avatar").parts("label","badge","container","excessLabel","group"),I0e=yi("breadcrumb").parts("link","item","container","separator");yi("button").parts();const A0e=yi("checkbox").parts("control","icon","container","label");yi("progress").parts("track","filledTrack","label");const P0e=yi("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),k0e=yi("editable").parts("preview","input","textarea"),O0e=yi("form").parts("container","requiredIndicator","helperText"),N0e=yi("formError").parts("text","icon"),x0e=yi("input").parts("addon","field","element","group"),D0e=yi("list").parts("container","item","icon"),L0e=yi("menu").parts("button","list","item","groupTitle","icon","command","divider"),M0e=yi("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),U0e=yi("numberinput").parts("root","field","stepperGroup","stepper");yi("pininput").parts("field");const V0e=yi("popover").parts("content","header","body","footer","popper","arrow","closeButton"),F0e=yi("progress").parts("label","filledTrack","track"),j0e=yi("radio").parts("container","control","label"),B0e=yi("select").parts("field","icon"),z0e=yi("slider").parts("container","track","thumb","filledTrack","mark"),W0e=yi("stat").parts("container","label","helpText","number","icon"),G0e=yi("switch").parts("container","track","thumb","label"),H0e=yi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),$0e=yi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),K0e=yi("tag").parts("container","label","closeButton"),q0e=yi("card").parts("container","header","body","footer");yi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Y0e,defineMultiStyleConfig:X0e}=es(T0e.keys),J0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Q0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Z0e={pt:"2",px:"4",pb:"5"},ebe={fontSize:"1.25em"},tbe=Y0e({container:J0e,button:Q0e,panel:Z0e,icon:ebe}),nbe=X0e({baseStyle:tbe});function xy(n,e,i){return Math.min(Math.max(n,i),e)}class rbe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var aC=rbe;function rj(n){if(typeof n!="string")throw new aC(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=dbe.test(n)?obe(n):n;const i=abe.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(y=>parseInt(qC(y,2),16)),parseInt(qC(p[3]||"f",2),16)/255]}const o=cbe.exec(e);if(o){const p=Array.from(o).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,16)),parseInt(p[3]||"ff",16)/255]}const l=lbe.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(y=>parseInt(y,10)),parseFloat(p[3]||"1")]}const u=ube.exec(e);if(u){const[p,y,v,w]=Array.from(u).slice(1).map(parseFloat);if(xy(0,100,y)!==y)throw new aC(n);if(xy(0,100,v)!==v)throw new aC(n);return[...hbe(p,y,v),Number.isNaN(w)?1:w]}throw new aC(n)}function ibe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const Iq=n=>parseInt(n.replace(/_/g,""),36),sbe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=Iq(e.substring(0,3)),o=Iq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function obe(n){const e=n.toLowerCase().trim(),i=sbe[ibe(e)];if(!i)throw new aC(n);return`#${i}`}const qC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),abe=new RegExp(`^#${qC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),cbe=new RegExp(`^#${qC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),lbe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${qC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ube=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,dbe=/^[a-z]+$/i,Aq=n=>Math.round(n*255),hbe=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(Aq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),p=u*(1-Math.abs(l%2-1));let y=0,v=0,w=0;l>=0&&l<1?(y=u,v=p):l>=1&&l<2?(y=p,v=u):l>=2&&l<3?(v=u,w=p):l>=3&&l<4?(v=p,w=u):l>=4&&l<5?(y=p,w=u):l>=5&&l<6&&(y=u,w=p);const C=o-u/2,R=y+C,N=v+C,M=w+C;return[R,N,M].map(Aq)};function pbe(n,e,i,o){return`rgba(${xy(0,255,n).toFixed()}, ${xy(0,255,e).toFixed()}, ${xy(0,255,i).toFixed()}, ${parseFloat(xy(0,1,o).toFixed(3))})`}function fbe(n,e){const[i,o,l,u]=rj(n);return pbe(i,o,l,u-e)}function mbe(n){const[e,i,o,l]=rj(n);let u=p=>{const y=xy(0,255,p).toString(16);return y.length===1?`0${y}`:y};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const gbe=n=>Object.keys(n).length===0;function _be(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Dc=(n,e,i)=>{const o=_be(n,`colors.${e}`,e);try{return mbe(o),o}catch{return i??"#000000"}},ybe=n=>{const[e,i,o]=rj(n);return(e*299+i*587+o*114)/1e3},Ebe=n=>e=>{const i=Dc(e,n);return ybe(i)<128?"dark":"light"},vbe=n=>e=>Ebe(n)(e)==="dark",y0=(n,e)=>i=>{const o=Dc(i,n);return fbe(o,1-e)};function Pq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const Sbe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function bbe(n){const e=Sbe();return!n||gbe(n)?e:n.string&&n.colors?Tbe(n.string,n.colors):n.string&&!n.colors?wbe(n.string):n.colors&&!n.string?Cbe(n.colors):e}function wbe(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function Tbe(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function Cbe(n){return n[Math.floor(Math.random()*n.length)]}function zn(n,e){return i=>i.colorMode==="dark"?e:n}function ij(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function Tee(n){return ed(n)&&n.reference?n.reference:String(n)}const ZO=(n,...e)=>e.map(Tee).join(` ${n} `).replace(/calc/g,""),kq=(...n)=>`calc(${ZO("+",...n)})`,Oq=(...n)=>`calc(${ZO("-",...n)})`,CV=(...n)=>`calc(${ZO("*",...n)})`,Nq=(...n)=>`calc(${ZO("/",...n)})`,xq=n=>{const e=Tee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:CV(e,-1)},Af=Object.assign(n=>({add:(...e)=>Af(kq(n,...e)),subtract:(...e)=>Af(Oq(n,...e)),multiply:(...e)=>Af(CV(n,...e)),divide:(...e)=>Af(Nq(n,...e)),negate:()=>Af(xq(n)),toString:()=>n.toString()}),{add:kq,subtract:Oq,multiply:CV,divide:Nq,negate:xq});function Rbe(n){return!Number.isInteger(parseFloat(n.toString()))}function Ibe(n,e="-"){return n.replace(/\s+/g,e)}function Cee(n){const e=Ibe(n.toString());return e.includes("\\.")?n:Rbe(n)?e.replace(".","\\."):n}function Abe(n,e=""){return[e,Cee(n)].filter(Boolean).join("-")}function Pbe(n,e){return`var(${Cee(n)}${e?`, ${e}`:""})`}function kbe(n,e=""){return`--${Abe(n,e)}`}function qo(n,e){const i=kbe(n,e==null?void 0:e.prefix);return{variable:i,reference:Pbe(i,Obe(e==null?void 0:e.fallback))}}function Obe(n){return n==null?void 0:n.reference}const{definePartsStyle:RR,defineMultiStyleConfig:Nbe}=es(C0e.keys),ru=Wn("alert-fg"),Wf=Wn("alert-bg"),xbe=RR({container:{bg:Wf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:ru.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:ru.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function sj(n){const{theme:e,colorScheme:i}=n,o=y0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const Dbe=RR(n=>{const{colorScheme:e}=n,i=sj(n);return{container:{[ru.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[ru.variable]:`colors.${e}.200`,[Wf.variable]:i.dark}}}}),Lbe=RR(n=>{const{colorScheme:e}=n,i=sj(n);return{container:{[ru.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[ru.variable]:`colors.${e}.200`,[Wf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:ru.reference}}}),Mbe=RR(n=>{const{colorScheme:e}=n,i=sj(n);return{container:{[ru.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[ru.variable]:`colors.${e}.200`,[Wf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:ru.reference}}}),Ube=RR(n=>{const{colorScheme:e}=n;return{container:{[ru.variable]:"colors.white",[Wf.variable]:`colors.${e}.600`,_dark:{[ru.variable]:"colors.gray.900",[Wf.variable]:`colors.${e}.200`},color:ru.reference}}}),Vbe={subtle:Dbe,"left-accent":Lbe,"top-accent":Mbe,solid:Ube},Fbe=Nbe({baseStyle:xbe,variants:Vbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),Ree={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},jbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Bbe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Iee={...Ree,...jbe,container:Bbe},zbe=n=>typeof n=="function";function Lc(n,...e){return zbe(n)?n(...e):n}const{definePartsStyle:Aee,defineMultiStyleConfig:Wbe}=es(R0e.keys),ZS=Wn("avatar-border-color"),CC=Wn("avatar-bg"),YC=Wn("avatar-font-size"),E0=Wn("avatar-size"),Gbe={borderRadius:"full",border:"0.2em solid",borderColor:ZS.reference,[ZS.variable]:"white",_dark:{[ZS.variable]:"colors.gray.800"}},Hbe={bg:CC.reference,fontSize:YC.reference,width:E0.reference,height:E0.reference,lineHeight:"1",[CC.variable]:"colors.gray.200",_dark:{[CC.variable]:"colors.whiteAlpha.400"}},$be=n=>{const{name:e,theme:i}=n,o=e?bbe({string:e}):"colors.gray.400",l=vbe(o)(i);let u="white";return l||(u="gray.800"),{bg:CC.reference,fontSize:YC.reference,color:u,borderColor:ZS.reference,verticalAlign:"top",width:E0.reference,height:E0.reference,"&:not([data-loaded])":{[CC.variable]:o},[ZS.variable]:"colors.white",_dark:{[ZS.variable]:"colors.gray.800"}}},Kbe={fontSize:YC.reference,lineHeight:"1"},qbe=Aee(n=>({badge:Lc(Gbe,n),excessLabel:Lc(Hbe,n),container:Lc($be,n),label:Kbe}));function dg(n){const e=n!=="100%"?Iee[n]:void 0;return Aee({container:{[E0.variable]:e??n,[YC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[E0.variable]:e??n,[YC.variable]:`calc(${e??n} / 2.5)`}})}const Ybe={"2xs":dg(4),xs:dg(6),sm:dg(8),md:dg(12),lg:dg(16),xl:dg(24),"2xl":dg(32),full:dg("100%")},Xbe=Wbe({baseStyle:qbe,sizes:Ybe,defaultProps:{size:"md"}}),ho=g0e("badge",["bg","color","shadow"]),Jbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:ho.bg.reference,color:ho.color.reference,boxShadow:ho.shadow.reference},Qbe=n=>{const{colorScheme:e,theme:i}=n,o=y0(`${e}.500`,.6)(i);return{[ho.bg.variable]:`colors.${e}.500`,[ho.color.variable]:"colors.white",_dark:{[ho.bg.variable]:o,[ho.color.variable]:"colors.whiteAlpha.800"}}},Zbe=n=>{const{colorScheme:e,theme:i}=n,o=y0(`${e}.200`,.16)(i);return{[ho.bg.variable]:`colors.${e}.100`,[ho.color.variable]:`colors.${e}.800`,_dark:{[ho.bg.variable]:o,[ho.color.variable]:`colors.${e}.200`}}},ewe=n=>{const{colorScheme:e,theme:i}=n,o=y0(`${e}.200`,.8)(i);return{[ho.color.variable]:`colors.${e}.500`,_dark:{[ho.color.variable]:o},[ho.shadow.variable]:`inset 0 0 0px 1px ${ho.color.reference}`}},twe={solid:Qbe,subtle:Zbe,outline:ewe},RC={baseStyle:Jbe,variants:twe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:nwe,definePartsStyle:rwe}=es(I0e.keys),eU=Wn("breadcrumb-link-decor"),iwe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:eU.reference,[eU.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[eU.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},swe=rwe({link:iwe}),owe=nwe({baseStyle:swe}),awe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},Pee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:zn("gray.800","whiteAlpha.900")(n),_hover:{bg:zn("gray.100","whiteAlpha.200")(n)},_active:{bg:zn("gray.200","whiteAlpha.300")(n)}};const o=y0(`${e}.200`,.12)(i),l=y0(`${e}.200`,.24)(i);return{color:zn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:zn(`${e}.50`,o)(n)},_active:{bg:zn(`${e}.100`,l)(n)}}},cwe=n=>{const{colorScheme:e}=n,i=zn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Lc(Pee,n)}},lwe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},uwe=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=zn("gray.100","whiteAlpha.200")(n);return{bg:y,color:zn("gray.800","whiteAlpha.900")(n),_hover:{bg:zn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:zn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=lwe[e]??{},p=zn(i,`${e}.200`)(n);return{bg:p,color:zn(o,"gray.800")(n),_hover:{bg:zn(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:zn(u,`${e}.400`)(n)}}},dwe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:zn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:zn(`${e}.700`,`${e}.500`)(n)}}},hwe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},pwe={ghost:Pee,outline:cwe,solid:uwe,link:dwe,unstyled:hwe},fwe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},mwe={baseStyle:awe,variants:pwe,sizes:fwe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Fy,defineMultiStyleConfig:gwe}=es(q0e.keys),rO=Wn("card-bg"),Mf=Wn("card-padding"),kee=Wn("card-shadow"),Sk=Wn("card-radius"),Oee=Wn("card-border-width","0"),Nee=Wn("card-border-color"),_we=Fy({container:{[rO.variable]:"colors.chakra-body-bg",backgroundColor:rO.reference,boxShadow:kee.reference,borderRadius:Sk.reference,color:"chakra-body-text",borderWidth:Oee.reference,borderColor:Nee.reference},body:{padding:Mf.reference,flex:"1 1 0%"},header:{padding:Mf.reference},footer:{padding:Mf.reference}}),ywe={sm:Fy({container:{[Sk.variable]:"radii.base",[Mf.variable]:"space.3"}}),md:Fy({container:{[Sk.variable]:"radii.md",[Mf.variable]:"space.5"}}),lg:Fy({container:{[Sk.variable]:"radii.xl",[Mf.variable]:"space.7"}})},Ewe={elevated:Fy({container:{[kee.variable]:"shadows.base",_dark:{[rO.variable]:"colors.gray.700"}}}),outline:Fy({container:{[Oee.variable]:"1px",[Nee.variable]:"colors.chakra-border-color"}}),filled:Fy({container:{[rO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Mf.variable]:0},header:{[Mf.variable]:0},footer:{[Mf.variable]:0}}},vwe=gwe({baseStyle:_we,variants:Ewe,sizes:ywe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:bk,defineMultiStyleConfig:Swe}=es(A0e.keys),IC=Wn("checkbox-size"),bwe=n=>{const{colorScheme:e}=n;return{w:IC.reference,h:IC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:zn(`${e}.500`,`${e}.200`)(n),borderColor:zn(`${e}.500`,`${e}.200`)(n),color:zn("white","gray.900")(n),_hover:{bg:zn(`${e}.600`,`${e}.300`)(n),borderColor:zn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:zn("gray.200","transparent")(n),bg:zn("gray.200","whiteAlpha.300")(n),color:zn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:zn(`${e}.500`,`${e}.200`)(n),borderColor:zn(`${e}.500`,`${e}.200`)(n),color:zn("white","gray.900")(n)},_disabled:{bg:zn("gray.100","whiteAlpha.100")(n),borderColor:zn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:zn("red.500","red.300")(n)}}},wwe={_disabled:{cursor:"not-allowed"}},Twe={userSelect:"none",_disabled:{opacity:.4}},Cwe={transitionProperty:"transform",transitionDuration:"normal"},Rwe=bk(n=>({icon:Cwe,container:wwe,control:Lc(bwe,n),label:Twe})),Iwe={sm:bk({control:{[IC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:bk({control:{[IC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:bk({control:{[IC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},_g=Swe({baseStyle:Rwe,sizes:Iwe,defaultProps:{size:"md",colorScheme:"blue"}}),AC=qo("close-button-size"),BT=qo("close-button-bg"),Awe={w:[AC.reference],h:[AC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[BT.variable]:"colors.blackAlpha.100",_dark:{[BT.variable]:"colors.whiteAlpha.100"}},_active:{[BT.variable]:"colors.blackAlpha.200",_dark:{[BT.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:BT.reference},Pwe={lg:{[AC.variable]:"sizes.10",fontSize:"md"},md:{[AC.variable]:"sizes.8",fontSize:"xs"},sm:{[AC.variable]:"sizes.6",fontSize:"2xs"}},kwe={baseStyle:Awe,sizes:Pwe,defaultProps:{size:"md"}},{variants:Owe,defaultProps:Nwe}=RC,xwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:ho.bg.reference,color:ho.color.reference,boxShadow:ho.shadow.reference},Dwe={baseStyle:xwe,variants:Owe,defaultProps:Nwe},Lwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Mwe={baseStyle:Lwe},Uwe={opacity:.6,borderColor:"inherit"},Vwe={borderStyle:"solid"},Fwe={borderStyle:"dashed"},jwe={solid:Vwe,dashed:Fwe},Bwe={baseStyle:Uwe,variants:jwe,defaultProps:{variant:"solid"}},{definePartsStyle:RV,defineMultiStyleConfig:zwe}=es(P0e.keys),tU=Wn("drawer-bg"),nU=Wn("drawer-box-shadow");function TS(n){return RV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Wwe={bg:"blackAlpha.600",zIndex:"modal"},Gwe={display:"flex",zIndex:"modal",justifyContent:"center"},Hwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[tU.variable]:"colors.white",[nU.variable]:"shadows.lg",_dark:{[tU.variable]:"colors.gray.700",[nU.variable]:"shadows.dark-lg"},bg:tU.reference,boxShadow:nU.reference}},$we={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Kwe={position:"absolute",top:"2",insetEnd:"3"},qwe={px:"6",py:"2",flex:"1",overflow:"auto"},Ywe={px:"6",py:"4"},Xwe=RV(n=>({overlay:Wwe,dialogContainer:Gwe,dialog:Lc(Hwe,n),header:$we,closeButton:Kwe,body:qwe,footer:Ywe})),Jwe={xs:TS("xs"),sm:TS("md"),md:TS("lg"),lg:TS("2xl"),xl:TS("4xl"),full:TS("full")},Qwe=zwe({baseStyle:Xwe,sizes:Jwe,defaultProps:{size:"xs"}}),{definePartsStyle:Zwe,defineMultiStyleConfig:eTe}=es(k0e.keys),tTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},nTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},rTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},iTe=Zwe({preview:tTe,input:nTe,textarea:rTe}),sTe=eTe({baseStyle:iTe}),{definePartsStyle:oTe,defineMultiStyleConfig:aTe}=es(O0e.keys),e0=Wn("form-control-color"),cTe={marginStart:"1",[e0.variable]:"colors.red.500",_dark:{[e0.variable]:"colors.red.300"},color:e0.reference},lTe={mt:"2",[e0.variable]:"colors.gray.600",_dark:{[e0.variable]:"colors.whiteAlpha.600"},color:e0.reference,lineHeight:"normal",fontSize:"sm"},uTe=oTe({container:{width:"100%",position:"relative"},requiredIndicator:cTe,helperText:lTe}),dTe=aTe({baseStyle:uTe}),{definePartsStyle:hTe,defineMultiStyleConfig:pTe}=es(N0e.keys),t0=Wn("form-error-color"),fTe={[t0.variable]:"colors.red.500",_dark:{[t0.variable]:"colors.red.300"},color:t0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},mTe={marginEnd:"0.5em",[t0.variable]:"colors.red.500",_dark:{[t0.variable]:"colors.red.300"},color:t0.reference},gTe=hTe({text:fTe,icon:mTe}),_Te=pTe({baseStyle:gTe}),yTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},ETe={baseStyle:yTe},vTe={fontFamily:"heading",fontWeight:"bold"},STe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},bTe={baseStyle:vTe,sizes:STe,defaultProps:{size:"xl"}},{definePartsStyle:Of,defineMultiStyleConfig:wTe}=es(x0e.keys),VS=Wn("input-height"),FS=Wn("input-font-size"),jS=Wn("input-padding"),BS=Wn("input-border-radius"),TTe=Of({addon:{height:VS.reference,fontSize:FS.reference,px:jS.reference,borderRadius:BS.reference},field:{width:"100%",height:VS.reference,fontSize:FS.reference,px:jS.reference,borderRadius:BS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),hg={lg:{[FS.variable]:"fontSizes.lg",[jS.variable]:"space.4",[BS.variable]:"radii.md",[VS.variable]:"sizes.12"},md:{[FS.variable]:"fontSizes.md",[jS.variable]:"space.4",[BS.variable]:"radii.md",[VS.variable]:"sizes.10"},sm:{[FS.variable]:"fontSizes.sm",[jS.variable]:"space.3",[BS.variable]:"radii.sm",[VS.variable]:"sizes.8"},xs:{[FS.variable]:"fontSizes.xs",[jS.variable]:"space.2",[BS.variable]:"radii.sm",[VS.variable]:"sizes.6"}},CTe={lg:Of({field:hg.lg,group:hg.lg}),md:Of({field:hg.md,group:hg.md}),sm:Of({field:hg.sm,group:hg.sm}),xs:Of({field:hg.xs,group:hg.xs})};function oj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||zn("blue.500","blue.300")(n),errorBorderColor:i||zn("red.500","red.300")(n)}}const RTe=Of(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=oj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:zn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,o),boxShadow:`0 0 0 1px ${Dc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Dc(e,i),boxShadow:`0 0 0 1px ${Dc(e,i)}`}},addon:{border:"1px solid",borderColor:zn("inherit","whiteAlpha.50")(n),bg:zn("gray.100","whiteAlpha.300")(n)}}}),ITe=Of(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=oj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:zn("gray.100","whiteAlpha.50")(n),_hover:{bg:zn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,o)},_focusVisible:{bg:"transparent",borderColor:Dc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:zn("gray.100","whiteAlpha.50")(n)}}}),ATe=Of(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=oj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Dc(e,o),boxShadow:`0px 1px 0px 0px ${Dc(e,o)}`},_focusVisible:{borderColor:Dc(e,i),boxShadow:`0px 1px 0px 0px ${Dc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),PTe=Of({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),kTe={outline:RTe,filled:ITe,flushed:ATe,unstyled:PTe},_i=wTe({baseStyle:TTe,sizes:CTe,variants:kTe,defaultProps:{size:"md",variant:"outline"}}),rU=Wn("kbd-bg"),OTe={[rU.variable]:"colors.gray.100",_dark:{[rU.variable]:"colors.whiteAlpha.100"},bg:rU.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},NTe={baseStyle:OTe},xTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},DTe={baseStyle:xTe},{defineMultiStyleConfig:LTe,definePartsStyle:MTe}=es(D0e.keys),UTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},VTe=MTe({icon:UTe}),FTe=LTe({baseStyle:VTe}),{defineMultiStyleConfig:jTe,definePartsStyle:BTe}=es(L0e.keys),dp=Wn("menu-bg"),iU=Wn("menu-shadow"),zTe={[dp.variable]:"#fff",[iU.variable]:"shadows.sm",_dark:{[dp.variable]:"colors.gray.700",[iU.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:dp.reference,boxShadow:iU.reference},WTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[dp.variable]:"colors.gray.100",_dark:{[dp.variable]:"colors.whiteAlpha.100"}},_active:{[dp.variable]:"colors.gray.200",_dark:{[dp.variable]:"colors.whiteAlpha.200"}},_expanded:{[dp.variable]:"colors.gray.100",_dark:{[dp.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:dp.reference},GTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},HTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},$Te={opacity:.6},KTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},qTe={transitionProperty:"common",transitionDuration:"normal"},YTe=BTe({button:qTe,list:zTe,item:WTe,groupTitle:GTe,icon:HTe,command:$Te,divider:KTe}),XTe=jTe({baseStyle:YTe}),{defineMultiStyleConfig:JTe,definePartsStyle:IV}=es(M0e.keys),sU=Wn("modal-bg"),oU=Wn("modal-shadow"),QTe={bg:"blackAlpha.600",zIndex:"modal"},ZTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},eCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[sU.variable]:"colors.white",[oU.variable]:"shadows.lg",_dark:{[sU.variable]:"colors.gray.700",[oU.variable]:"shadows.dark-lg"},bg:sU.reference,boxShadow:oU.reference}},tCe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},nCe={position:"absolute",top:"2",insetEnd:"3"},rCe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},iCe={px:"6",py:"4"},sCe=IV(n=>({overlay:QTe,dialogContainer:Lc(ZTe,n),dialog:Lc(eCe,n),header:tCe,closeButton:nCe,body:Lc(rCe,n),footer:iCe}));function eh(n){return IV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const oCe={xs:eh("xs"),sm:eh("sm"),md:eh("md"),lg:eh("lg"),xl:eh("xl"),"2xl":eh("2xl"),"3xl":eh("3xl"),"4xl":eh("4xl"),"5xl":eh("5xl"),"6xl":eh("6xl"),full:eh("full")},aCe=JTe({baseStyle:sCe,sizes:oCe,defaultProps:{size:"md"}}),xee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:cCe,definePartsStyle:Dee}=es(U0e.keys),aj=qo("number-input-stepper-width"),Lee=qo("number-input-input-padding"),lCe=Af(aj).add("0.5rem").toString(),aU=qo("number-input-bg"),cU=qo("number-input-color"),lU=qo("number-input-border-color"),uCe={[aj.variable]:"sizes.6",[Lee.variable]:lCe},dCe=n=>{var e;return((e=Lc(_i.baseStyle,n))==null?void 0:e.field)??{}},hCe={width:aj.reference},pCe={borderStart:"1px solid",borderStartColor:lU.reference,color:cU.reference,bg:aU.reference,[cU.variable]:"colors.chakra-body-text",[lU.variable]:"colors.chakra-border-color",_dark:{[cU.variable]:"colors.whiteAlpha.800",[lU.variable]:"colors.whiteAlpha.300"},_active:{[aU.variable]:"colors.gray.200",_dark:{[aU.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},fCe=Dee(n=>({root:uCe,field:Lc(dCe,n)??{},stepperGroup:hCe,stepper:pCe}));function j1(n){var u,p;const e=(u=_i.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((p=e.field)==null?void 0:p.fontSize)??"md",l=xee.fontSizes[o];return Dee({field:{...e.field,paddingInlineEnd:Lee.reference,verticalAlign:"top"},stepper:{fontSize:Af(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const mCe={xs:j1("xs"),sm:j1("sm"),md:j1("md"),lg:j1("lg")},gCe=cCe({baseStyle:fCe,sizes:mCe,variants:_i.variants,defaultProps:_i.defaultProps});var NZ;const _Ce={...(NZ=_i.baseStyle)==null?void 0:NZ.field,textAlign:"center"},yCe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var xZ;const ECe={outline:n=>{var e,i;return((i=Lc((e=_i.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Lc((e=_i.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Lc((e=_i.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((xZ=_i.variants)==null?void 0:xZ.unstyled.field)??{}},vCe={baseStyle:_Ce,sizes:yCe,variants:ECe,defaultProps:_i.defaultProps},{defineMultiStyleConfig:SCe,definePartsStyle:bCe}=es(V0e.keys),B1=qo("popper-bg"),wCe=qo("popper-arrow-bg"),Dq=qo("popper-arrow-shadow-color"),TCe={zIndex:"popover"},CCe={[B1.variable]:"colors.white",bg:B1.reference,[wCe.variable]:B1.reference,[Dq.variable]:"colors.gray.200",_dark:{[B1.variable]:"colors.gray.700",[Dq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},RCe={px:3,py:2,borderBottomWidth:"1px"},ICe={px:3,py:2},ACe={px:3,py:2,borderTopWidth:"1px"},PCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},kCe=bCe({popper:TCe,content:CCe,header:RCe,body:ICe,footer:ACe,closeButton:PCe}),OCe=SCe({baseStyle:kCe}),{defineMultiStyleConfig:NCe,definePartsStyle:cC}=es(F0e.keys),xCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=zn(Pq(),Pq("1rem","rgba(0,0,0,0.1)"))(n),p=zn(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${Dc(i,p)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:y}:{bgColor:p}}},DCe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},LCe=n=>({bg:zn("gray.100","whiteAlpha.300")(n)}),MCe=n=>({transitionProperty:"common",transitionDuration:"slow",...xCe(n)}),UCe=cC(n=>({label:DCe,filledTrack:MCe(n),track:LCe(n)})),VCe={xs:cC({track:{h:"1"}}),sm:cC({track:{h:"2"}}),md:cC({track:{h:"3"}}),lg:cC({track:{h:"4"}})},FCe=NCe({sizes:VCe,baseStyle:UCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:jCe,definePartsStyle:wk}=es(j0e.keys),BCe=n=>{var i;const e=(i=Lc(_g.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},zCe=wk(n=>{var e,i;return{label:(e=_g.baseStyle)==null?void 0:e.call(_g,n).label,container:(i=_g.baseStyle)==null?void 0:i.call(_g,n).container,control:BCe(n)}}),WCe={md:wk({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:wk({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:wk({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},GCe=jCe({baseStyle:zCe,sizes:WCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:HCe,definePartsStyle:$Ce}=es(B0e.keys),z1=Wn("select-bg");var DZ;const KCe={...(DZ=_i.baseStyle)==null?void 0:DZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:z1.reference,[z1.variable]:"colors.white",_dark:{[z1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:z1.reference}},qCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},YCe=$Ce({field:KCe,icon:qCe}),W1={paddingInlineEnd:"8"};var LZ,MZ,UZ,VZ,FZ,jZ,BZ,zZ;const XCe={lg:{...(LZ=_i.sizes)==null?void 0:LZ.lg,field:{...(MZ=_i.sizes)==null?void 0:MZ.lg.field,...W1}},md:{...(UZ=_i.sizes)==null?void 0:UZ.md,field:{...(VZ=_i.sizes)==null?void 0:VZ.md.field,...W1}},sm:{...(FZ=_i.sizes)==null?void 0:FZ.sm,field:{...(jZ=_i.sizes)==null?void 0:jZ.sm.field,...W1}},xs:{...(BZ=_i.sizes)==null?void 0:BZ.xs,field:{...(zZ=_i.sizes)==null?void 0:zZ.xs.field,...W1},icon:{insetEnd:"1"}}},JCe=HCe({baseStyle:YCe,sizes:XCe,variants:_i.variants,defaultProps:_i.defaultProps}),uU=Wn("skeleton-start-color"),dU=Wn("skeleton-end-color"),QCe={[uU.variable]:"colors.gray.100",[dU.variable]:"colors.gray.400",_dark:{[uU.variable]:"colors.gray.800",[dU.variable]:"colors.gray.600"},background:uU.reference,borderColor:dU.reference,opacity:.7,borderRadius:"sm"},ZCe={baseStyle:QCe},hU=Wn("skip-link-bg"),eRe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[hU.variable]:"colors.white",_dark:{[hU.variable]:"colors.gray.700"},bg:hU.reference}},tRe={baseStyle:eRe},{defineMultiStyleConfig:nRe,definePartsStyle:eN}=es(z0e.keys),Xy=Wn("slider-thumb-size"),XC=Wn("slider-track-size"),yg=Wn("slider-bg"),rRe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...ij({orientation:e,vertical:{h:"100%",px:If(Xy.reference).divide(2).toString()},horizontal:{w:"100%",py:If(Xy.reference).divide(2).toString()}})}},iRe=n=>({...ij({orientation:n.orientation,horizontal:{h:XC.reference},vertical:{w:XC.reference}}),overflow:"hidden",borderRadius:"sm",[yg.variable]:"colors.gray.200",_dark:{[yg.variable]:"colors.whiteAlpha.200"},_disabled:{[yg.variable]:"colors.gray.300",_dark:{[yg.variable]:"colors.whiteAlpha.300"}},bg:yg.reference}),sRe=n=>{const{orientation:e}=n;return{...ij({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Xy.reference,h:Xy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},oRe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[yg.variable]:`colors.${e}.500`,_dark:{[yg.variable]:`colors.${e}.200`},bg:yg.reference}},aRe=eN(n=>({container:rRe(n),track:iRe(n),thumb:sRe(n),filledTrack:oRe(n)})),cRe=eN({container:{[Xy.variable]:"sizes.4",[XC.variable]:"sizes.1"}}),lRe=eN({container:{[Xy.variable]:"sizes.3.5",[XC.variable]:"sizes.1"}}),uRe=eN({container:{[Xy.variable]:"sizes.2.5",[XC.variable]:"sizes.0.5"}}),dRe={lg:cRe,md:lRe,sm:uRe},hRe=nRe({baseStyle:aRe,sizes:dRe,defaultProps:{size:"md",colorScheme:"blue"}}),Oy=qo("spinner-size"),pRe={width:[Oy.reference],height:[Oy.reference]},fRe={xs:{[Oy.variable]:"sizes.3"},sm:{[Oy.variable]:"sizes.4"},md:{[Oy.variable]:"sizes.6"},lg:{[Oy.variable]:"sizes.8"},xl:{[Oy.variable]:"sizes.12"}},mRe={baseStyle:pRe,sizes:fRe,defaultProps:{size:"md"}},{defineMultiStyleConfig:gRe,definePartsStyle:Mee}=es(W0e.keys),_Re={fontWeight:"medium"},yRe={opacity:.8,marginBottom:"2"},ERe={verticalAlign:"baseline",fontWeight:"semibold"},vRe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},SRe=Mee({container:{},label:_Re,helpText:yRe,number:ERe,icon:vRe}),bRe={md:Mee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},wRe=gRe({baseStyle:SRe,sizes:bRe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:TRe,definePartsStyle:lC}=es(["stepper","step","title","description","indicator","separator","icon","number"]),Pf=Wn("stepper-indicator-size"),zS=Wn("stepper-icon-size"),WS=Wn("stepper-title-font-size"),uC=Wn("stepper-description-font-size"),zT=Wn("stepper-accent-color"),CRe=lC(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[zT.variable]:`colors.${n}.500`,_dark:{[zT.variable]:`colors.${n}.200`}},title:{fontSize:WS.reference,fontWeight:"medium"},description:{fontSize:uC.reference,color:"chakra-subtle-text"},number:{fontSize:WS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:zS.reference,height:zS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Pf.reference,height:Pf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:zT.reference},"&[data-status=complete]":{bg:zT.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:zT.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Pf.reference} - 8px)`,top:`calc(${Pf.reference} + 4px)`,insetStart:`calc(${Pf.reference} / 2 - 1px)`}}})),RRe=TRe({baseStyle:CRe,sizes:{xs:lC({stepper:{[Pf.variable]:"sizes.4",[zS.variable]:"sizes.3",[WS.variable]:"fontSizes.xs",[uC.variable]:"fontSizes.xs"}}),sm:lC({stepper:{[Pf.variable]:"sizes.6",[zS.variable]:"sizes.4",[WS.variable]:"fontSizes.sm",[uC.variable]:"fontSizes.xs"}}),md:lC({stepper:{[Pf.variable]:"sizes.8",[zS.variable]:"sizes.5",[WS.variable]:"fontSizes.md",[uC.variable]:"fontSizes.sm"}}),lg:lC({stepper:{[Pf.variable]:"sizes.10",[zS.variable]:"sizes.6",[WS.variable]:"fontSizes.lg",[uC.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:IRe,definePartsStyle:Tk}=es(G0e.keys),PC=qo("switch-track-width"),jy=qo("switch-track-height"),pU=qo("switch-track-diff"),ARe=Af.subtract(PC,jy),AV=qo("switch-thumb-x"),WT=qo("switch-bg"),PRe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[PC.reference],height:[jy.reference],transitionProperty:"common",transitionDuration:"fast",[WT.variable]:"colors.gray.300",_dark:{[WT.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[WT.variable]:`colors.${e}.500`,_dark:{[WT.variable]:`colors.${e}.200`}},bg:WT.reference}},kRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[jy.reference],height:[jy.reference],_checked:{transform:`translateX(${AV.reference})`}},ORe=Tk(n=>({container:{[pU.variable]:ARe,[AV.variable]:pU.reference,_rtl:{[AV.variable]:Af(pU).negate().toString()}},track:PRe(n),thumb:kRe})),NRe={sm:Tk({container:{[PC.variable]:"1.375rem",[jy.variable]:"sizes.3"}}),md:Tk({container:{[PC.variable]:"1.875rem",[jy.variable]:"sizes.4"}}),lg:Tk({container:{[PC.variable]:"2.875rem",[jy.variable]:"sizes.6"}})},xRe=IRe({baseStyle:ORe,sizes:NRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:DRe,definePartsStyle:n0}=es(H0e.keys),LRe=n0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),iO={"&[data-is-numeric=true]":{textAlign:"end"}},MRe=n0(n=>{const{colorScheme:e}=n;return{th:{color:zn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...iO},td:{borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...iO},caption:{color:zn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),URe=n0(n=>{const{colorScheme:e}=n;return{th:{color:zn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...iO},td:{borderBottom:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n),...iO},caption:{color:zn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:zn(`${e}.100`,`${e}.700`)(n)},td:{background:zn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),VRe={simple:MRe,striped:URe,unstyled:{}},FRe={sm:n0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:n0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:n0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},jRe=DRe({baseStyle:LRe,variants:VRe,sizes:FRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),pl=Wn("tabs-color"),sh=Wn("tabs-bg"),G1=Wn("tabs-border-color"),{defineMultiStyleConfig:BRe,definePartsStyle:Rp}=es($0e.keys),zRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},WRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},GRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},HRe={p:4},$Re=Rp(n=>({root:zRe(n),tab:WRe(n),tablist:GRe(n),tabpanel:HRe})),KRe={sm:Rp({tab:{py:1,px:4,fontSize:"sm"}}),md:Rp({tab:{fontSize:"md",py:2,px:4}}),lg:Rp({tab:{fontSize:"lg",py:3,px:4}})},qRe=Rp(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[pl.variable]:`colors.${e}.600`,_dark:{[pl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[sh.variable]:"colors.gray.200",_dark:{[sh.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:pl.reference,bg:sh.reference}}}),YRe=Rp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[G1.variable]:"transparent",_selected:{[pl.variable]:`colors.${e}.600`,[G1.variable]:"colors.white",_dark:{[pl.variable]:`colors.${e}.300`,[G1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:G1.reference},color:pl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),XRe=Rp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[sh.variable]:"colors.gray.50",_dark:{[sh.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[sh.variable]:"colors.white",[pl.variable]:`colors.${e}.600`,_dark:{[sh.variable]:"colors.gray.800",[pl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:pl.reference,bg:sh.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),JRe=Rp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Dc(i,`${e}.700`),bg:Dc(i,`${e}.100`)}}}}),QRe=Rp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[pl.variable]:"colors.gray.600",_dark:{[pl.variable]:"inherit"},_selected:{[pl.variable]:"colors.white",[sh.variable]:`colors.${e}.600`,_dark:{[pl.variable]:"colors.gray.800",[sh.variable]:`colors.${e}.300`}},color:pl.reference,bg:sh.reference}}}),ZRe=Rp({}),eIe={line:qRe,enclosed:YRe,"enclosed-colored":XRe,"soft-rounded":JRe,"solid-rounded":QRe,unstyled:ZRe},tIe=BRe({baseStyle:$Re,sizes:KRe,variants:eIe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:nIe,definePartsStyle:By}=es(K0e.keys),Lq=Wn("tag-bg"),Mq=Wn("tag-color"),fU=Wn("tag-shadow"),Ck=Wn("tag-min-height"),Rk=Wn("tag-min-width"),Ik=Wn("tag-font-size"),Ak=Wn("tag-padding-inline"),rIe={fontWeight:"medium",lineHeight:1.2,outline:0,[Mq.variable]:ho.color.reference,[Lq.variable]:ho.bg.reference,[fU.variable]:ho.shadow.reference,color:Mq.reference,bg:Lq.reference,boxShadow:fU.reference,borderRadius:"md",minH:Ck.reference,minW:Rk.reference,fontSize:Ik.reference,px:Ak.reference,_focusVisible:{[fU.variable]:"shadows.outline"}},iIe={lineHeight:1.2,overflow:"visible"},sIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},oIe=By({container:rIe,label:iIe,closeButton:sIe}),aIe={sm:By({container:{[Ck.variable]:"sizes.5",[Rk.variable]:"sizes.5",[Ik.variable]:"fontSizes.xs",[Ak.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:By({container:{[Ck.variable]:"sizes.6",[Rk.variable]:"sizes.6",[Ik.variable]:"fontSizes.sm",[Ak.variable]:"space.2"}}),lg:By({container:{[Ck.variable]:"sizes.8",[Rk.variable]:"sizes.8",[Ik.variable]:"fontSizes.md",[Ak.variable]:"space.3"}})},cIe={subtle:By(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.subtle(n)}}),solid:By(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.solid(n)}}),outline:By(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.outline(n)}})},lIe=nIe({variants:cIe,baseStyle:oIe,sizes:aIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var WZ;const uIe={...(WZ=_i.baseStyle)==null?void 0:WZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var GZ;const dIe={outline:n=>{var e;return((e=_i.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=_i.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=_i.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((GZ=_i.variants)==null?void 0:GZ.unstyled.field)??{}};var HZ,$Z,KZ,qZ;const hIe={xs:((HZ=_i.sizes)==null?void 0:HZ.xs.field)??{},sm:(($Z=_i.sizes)==null?void 0:$Z.sm.field)??{},md:((KZ=_i.sizes)==null?void 0:KZ.md.field)??{},lg:((qZ=_i.sizes)==null?void 0:qZ.lg.field)??{}},pIe={baseStyle:uIe,sizes:hIe,variants:dIe,defaultProps:{size:"md",variant:"outline"}},H1=qo("tooltip-bg"),mU=qo("tooltip-fg"),fIe=qo("popper-arrow-bg"),mIe={bg:H1.reference,color:mU.reference,[H1.variable]:"colors.gray.700",[mU.variable]:"colors.whiteAlpha.900",_dark:{[H1.variable]:"colors.gray.300",[mU.variable]:"colors.gray.900"},[fIe.variable]:H1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},gIe={baseStyle:mIe},_Ie={Accordion:nbe,Alert:Fbe,Avatar:Xbe,Badge:RC,Breadcrumb:owe,Button:mwe,Checkbox:_g,CloseButton:kwe,Code:Dwe,Container:Mwe,Divider:Bwe,Drawer:Qwe,Editable:sTe,Form:dTe,FormError:_Te,FormLabel:ETe,Heading:bTe,Input:_i,Kbd:NTe,Link:DTe,List:FTe,Menu:XTe,Modal:aCe,NumberInput:gCe,PinInput:vCe,Popover:OCe,Progress:FCe,Radio:GCe,Select:JCe,Skeleton:ZCe,SkipLink:tRe,Slider:hRe,Spinner:mRe,Stat:wRe,Switch:xRe,Table:jRe,Tabs:tIe,Tag:lIe,Textarea:pIe,Tooltip:gIe,Card:vwe,Stepper:RRe},yIe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},EIe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},vIe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},SIe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},bIe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},wIe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},TIe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},CIe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},RIe={property:wIe,easing:TIe,duration:CIe},IIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},AIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},PIe={breakpoints:EIe,zIndices:IIe,radii:SIe,blur:AIe,colors:vIe,...xee,sizes:Iee,shadows:bIe,space:Ree,borders:yIe,transition:RIe},kIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},OIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},NIe="ltr",xIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},DIe={semanticTokens:kIe,direction:NIe,...PIe,components:_Ie,styles:OIe,config:xIe};function LIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function MIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var UIe=function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(MIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=LIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),oc="-ms-",sO="-moz-",fi="-webkit-",Uee="comm",cj="rule",lj="decl",VIe="@import",Vee="@keyframes",FIe="@layer",jIe=Math.abs,tN=String.fromCharCode,BIe=Object.assign;function zIe(n,e){return La(n,0)^45?(((e<<2^La(n,0))<<2^La(n,1))<<2^La(n,2))<<2^La(n,3):0}function Fee(n){return n.trim()}function WIe(n,e){return(n=e.exec(n))?n[0]:n}function mi(n,e,i){return n.replace(e,i)}function PV(n,e){return n.indexOf(e)}function La(n,e){return n.charCodeAt(e)|0}function JC(n,e,i){return n.slice(e,i)}function fp(n){return n.length}function uj(n){return n.length}function $1(n,e){return e.push(n),n}function GIe(n,e){return n.map(e).join("")}var nN=1,v0=1,jee=0,wl=0,To=0,$0="";function rN(n,e,i,o,l,u,p){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:nN,column:v0,length:p,return:""}}function GT(n,e){return BIe(rN("",null,null,"",null,null,0),n,{length:-n.length},e)}function HIe(){return To}function $Ie(){return To=wl>0?La($0,--wl):0,v0--,To===10&&(v0=1,nN--),To}function iu(){return To=wl<jee?La($0,wl++):0,v0++,To===10&&(v0=1,nN++),To}function Ip(){return La($0,wl)}function Pk(){return wl}function IR(n,e){return JC($0,n,e)}function QC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Bee(n){return nN=v0=1,jee=fp($0=n),wl=0,[]}function zee(n){return $0="",n}function kk(n){return Fee(IR(wl-1,kV(n===91?n+2:n===40?n+1:n)))}function KIe(n){for(;(To=Ip())&&To<33;)iu();return QC(n)>2||QC(To)>3?"":" "}function qIe(n,e){for(;--e&&iu()&&!(To<48||To>102||To>57&&To<65||To>70&&To<97););return IR(n,Pk()+(e<6&&Ip()==32&&iu()==32))}function kV(n){for(;iu();)switch(To){case n:return wl;case 34:case 39:n!==34&&n!==39&&kV(To);break;case 40:n===41&&kV(n);break;case 92:iu();break}return wl}function YIe(n,e){for(;iu()&&n+To!==57;)if(n+To===84&&Ip()===47)break;return"/*"+IR(e,wl-1)+"*"+tN(n===47?n:iu())}function XIe(n){for(;!QC(Ip());)iu();return IR(n,wl)}function JIe(n){return zee(Ok("",null,null,null,[""],n=Bee(n),0,[0],n))}function Ok(n,e,i,o,l,u,p,y,v){for(var w=0,C=0,R=p,N=0,M=0,D=0,F=1,z=1,q=1,K=0,re="",ce=l,se=u,ge=o,X=re;z;)switch(D=K,K=iu()){case 40:if(D!=108&&La(X,R-1)==58){PV(X+=mi(kk(K),"&","&\f"),"&\f")!=-1&&(q=-1);break}case 34:case 39:case 91:X+=kk(K);break;case 9:case 10:case 13:case 32:X+=KIe(D);break;case 92:X+=qIe(Pk()-1,7);continue;case 47:switch(Ip()){case 42:case 47:$1(QIe(YIe(iu(),Pk()),e,i),v);break;default:X+="/"}break;case 123*F:y[w++]=fp(X)*q;case 125*F:case 59:case 0:switch(K){case 0:case 125:z=0;case 59+C:q==-1&&(X=mi(X,/\f/g,"")),M>0&&fp(X)-R&&$1(M>32?Vq(X+";",o,i,R-1):Vq(mi(X," ","")+";",o,i,R-2),v);break;case 59:X+=";";default:if($1(ge=Uq(X,e,i,w,C,l,y,re,ce=[],se=[],R),u),K===123)if(C===0)Ok(X,e,ge,ge,ce,u,R,y,se);else switch(N===99&&La(X,3)===110?100:N){case 100:case 108:case 109:case 115:Ok(n,ge,ge,o&&$1(Uq(n,ge,ge,0,0,l,y,re,l,ce=[],R),se),l,se,R,y,o?ce:se);break;default:Ok(X,ge,ge,ge,[""],se,0,y,se)}}w=C=M=0,F=q=1,re=X="",R=p;break;case 58:R=1+fp(X),M=D;default:if(F<1){if(K==123)--F;else if(K==125&&F++==0&&$Ie()==125)continue}switch(X+=tN(K),K*F){case 38:q=C>0?1:(X+="\f",-1);break;case 44:y[w++]=(fp(X)-1)*q,q=1;break;case 64:Ip()===45&&(X+=kk(iu())),N=Ip(),C=R=fp(re=X+=XIe(Pk())),K++;break;case 45:D===45&&fp(X)==2&&(F=0)}}return u}function Uq(n,e,i,o,l,u,p,y,v,w,C){for(var R=l-1,N=l===0?u:[""],M=uj(N),D=0,F=0,z=0;D<o;++D)for(var q=0,K=JC(n,R+1,R=jIe(F=p[D])),re=n;q<M;++q)(re=Fee(F>0?N[q]+" "+K:mi(K,/&\f/g,N[q])))&&(v[z++]=re);return rN(n,e,i,l===0?cj:y,v,w,C)}function QIe(n,e,i){return rN(n,e,i,Uee,tN(HIe()),JC(n,2,-2),0)}function Vq(n,e,i,o){return rN(n,e,i,lj,JC(n,0,o),JC(n,o+1,-1),o)}function r0(n,e){for(var i="",o=uj(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function ZIe(n,e,i,o){switch(n.type){case FIe:if(n.children.length)break;case VIe:case lj:return n.return=n.return||n.value;case Uee:return"";case Vee:return n.return=n.value+"{"+r0(n.children,o)+"}";case cj:n.value=n.props.join(",")}return fp(i=r0(n.children,o))?n.return=n.value+"{"+i+"}":""}function eAe(n){var e=uj(n);return function(i,o,l,u){for(var p="",y=0;y<e;y++)p+=n[y](i,o,l,u)||"";return p}}function tAe(n){return function(e){e.root||(e=e.return)&&n(e)}}var Fq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function Wee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var nAe=function(e,i,o){for(var l=0,u=0;l=u,u=Ip(),l===38&&u===12&&(i[o]=1),!QC(u);)iu();return IR(e,wl)},rAe=function(e,i){var o=-1,l=44;do switch(QC(l)){case 0:l===38&&Ip()===12&&(i[o]=1),e[o]+=nAe(wl-1,i,o);break;case 2:e[o]+=kk(l);break;case 4:if(l===44){e[++o]=Ip()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=tN(l)}while(l=iu());return e},iAe=function(e,i){return zee(rAe(Bee(e),i))},jq=new WeakMap,sAe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!jq.get(o))&&!l){jq.set(e,!0);for(var u=[],p=iAe(i,u),y=o.props,v=0,w=0;v<p.length;v++)for(var C=0;C<y.length;C++,w++)e.props[w]=u[v]?p[v].replace(/&\f/g,y[C]):y[C]+" "+p[v]}}},oAe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Gee(n,e){switch(zIe(n,e)){case 5103:return fi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return fi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return fi+n+sO+n+oc+n+n;case 6828:case 4268:return fi+n+oc+n+n;case 6165:return fi+n+oc+"flex-"+n+n;case 5187:return fi+n+mi(n,/(\w+).+(:[^]+)/,fi+"box-$1$2"+oc+"flex-$1$2")+n;case 5443:return fi+n+oc+"flex-item-"+mi(n,/flex-|-self/,"")+n;case 4675:return fi+n+oc+"flex-line-pack"+mi(n,/align-content|flex-|-self/,"")+n;case 5548:return fi+n+oc+mi(n,"shrink","negative")+n;case 5292:return fi+n+oc+mi(n,"basis","preferred-size")+n;case 6060:return fi+"box-"+mi(n,"-grow","")+fi+n+oc+mi(n,"grow","positive")+n;case 4554:return fi+mi(n,/([^-])(transform)/g,"$1"+fi+"$2")+n;case 6187:return mi(mi(mi(n,/(zoom-|grab)/,fi+"$1"),/(image-set)/,fi+"$1"),n,"")+n;case 5495:case 3959:return mi(n,/(image-set\([^]*)/,fi+"$1$`$1");case 4968:return mi(mi(n,/(.+:)(flex-)?(.*)/,fi+"box-pack:$3"+oc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+fi+n+n;case 4095:case 3583:case 4068:case 2532:return mi(n,/(.+)-inline(.+)/,fi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(fp(n)-1-e>6)switch(La(n,e+1)){case 109:if(La(n,e+4)!==45)break;case 102:return mi(n,/(.+:)(.+)-([^]+)/,"$1"+fi+"$2-$3$1"+sO+(La(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~PV(n,"stretch")?Gee(mi(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(La(n,e+1)!==115)break;case 6444:switch(La(n,fp(n)-3-(~PV(n,"!important")&&10))){case 107:return mi(n,":",":"+fi)+n;case 101:return mi(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+fi+(La(n,14)===45?"inline-":"")+"box$3$1"+fi+"$2$3$1"+oc+"$2box$3")+n}break;case 5936:switch(La(n,e+11)){case 114:return fi+n+oc+mi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return fi+n+oc+mi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return fi+n+oc+mi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return fi+n+oc+n+n}return n}var aAe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case lj:e.return=Gee(e.value,e.length);break;case Vee:return r0([GT(e,{value:mi(e.value,"@","@"+fi)})],l);case cj:if(e.length)return GIe(e.props,function(u){switch(WIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return r0([GT(e,{props:[mi(u,/:(read-\w+)/,":"+sO+"$1")]})],l);case"::placeholder":return r0([GT(e,{props:[mi(u,/:(plac\w+)/,":"+fi+"input-$1")]}),GT(e,{props:[mi(u,/:(plac\w+)/,":"+sO+"$1")]}),GT(e,{props:[mi(u,/:(plac\w+)/,oc+"input-$1")]})],l)}return""})}},cAe=[aAe],lAe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(F){var z=F.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=e.stylisPlugins||cAe,u={},p,y=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var z=F.getAttribute("data-emotion").split(" "),q=1;q<z.length;q++)u[z[q]]=!0;y.push(F)});var v,w=[sAe,oAe];{var C,R=[ZIe,tAe(function(F){C.insert(F)})],N=eAe(w.concat(l,R)),M=function(z){return r0(JIe(z),N)};v=function(z,q,K,re){C=K,M(z?z+"{"+q.styles+"}":q.styles),re&&(D.inserted[q.name]=!0)}}var D={key:i,sheet:new UIe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:v};return D.sheet.hydrate(y),D};function Jy(){return Jy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Jy.apply(null,arguments)}var gU={exports:{}},Si={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bq;function uAe(){if(Bq)return Si;Bq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,w=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,R=n?Symbol.for("react.suspense"):60113,N=n?Symbol.for("react.suspense_list"):60120,M=n?Symbol.for("react.memo"):60115,D=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,q=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function re(se){if(typeof se=="object"&&se!==null){var ge=se.$$typeof;switch(ge){case e:switch(se=se.type,se){case v:case w:case o:case u:case l:case R:return se;default:switch(se=se&&se.$$typeof,se){case y:case C:case D:case M:case p:return se;default:return ge}}case i:return ge}}}function ce(se){return re(se)===w}return Si.AsyncMode=v,Si.ConcurrentMode=w,Si.ContextConsumer=y,Si.ContextProvider=p,Si.Element=e,Si.ForwardRef=C,Si.Fragment=o,Si.Lazy=D,Si.Memo=M,Si.Portal=i,Si.Profiler=u,Si.StrictMode=l,Si.Suspense=R,Si.isAsyncMode=function(se){return ce(se)||re(se)===v},Si.isConcurrentMode=ce,Si.isContextConsumer=function(se){return re(se)===y},Si.isContextProvider=function(se){return re(se)===p},Si.isElement=function(se){return typeof se=="object"&&se!==null&&se.$$typeof===e},Si.isForwardRef=function(se){return re(se)===C},Si.isFragment=function(se){return re(se)===o},Si.isLazy=function(se){return re(se)===D},Si.isMemo=function(se){return re(se)===M},Si.isPortal=function(se){return re(se)===i},Si.isProfiler=function(se){return re(se)===u},Si.isStrictMode=function(se){return re(se)===l},Si.isSuspense=function(se){return re(se)===R},Si.isValidElementType=function(se){return typeof se=="string"||typeof se=="function"||se===o||se===w||se===u||se===l||se===R||se===N||typeof se=="object"&&se!==null&&(se.$$typeof===D||se.$$typeof===M||se.$$typeof===p||se.$$typeof===y||se.$$typeof===C||se.$$typeof===z||se.$$typeof===q||se.$$typeof===K||se.$$typeof===F)},Si.typeOf=re,Si}var zq;function dAe(){return zq||(zq=1,gU.exports=uAe()),gU.exports}var _U,Wq;function hAe(){if(Wq)return _U;Wq=1;var n=dAe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function p(D){return n.isMemo(D)?l:u[D.$$typeof]||e}var y=Object.defineProperty,v=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,R=Object.getPrototypeOf,N=Object.prototype;function M(D,F,z){if(typeof F!="string"){if(N){var q=R(F);q&&q!==N&&M(D,q,z)}var K=v(F);w&&(K=K.concat(w(F)));for(var re=p(D),ce=p(F),se=0;se<K.length;++se){var ge=K[se];if(!i[ge]&&!(z&&z[ge])&&!(ce&&ce[ge])&&!(re&&re[ge])){var X=C(F,ge);try{y(D,ge,X)}catch{}}}}return D}return _U=M,_U}var pAe=hAe();const fAe=$g(pAe);var mAe=!0;function Hee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var dj=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||mAe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},hj=function(e,i,o){dj(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function gAe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var _Ae={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},yAe=/[A-Z]|^ms/g,EAe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,$ee=function(e){return e.charCodeAt(1)===45},Gq=function(e){return e!=null&&typeof e!="boolean"},yU=Wee(function(n){return $ee(n)?n:n.replace(yAe,"-$&").toLowerCase()}),Hq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(EAe,function(o,l,u){return mp={name:l,styles:u,next:mp},l})}return _Ae[e]!==1&&!$ee(e)&&typeof i=="number"&&i!==0?i+"px":i};function ZC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return mp={name:l.name,styles:l.styles,next:mp},l.name;var u=i;if(u.styles!==void 0){var p=u.next;if(p!==void 0)for(;p!==void 0;)mp={name:p.name,styles:p.styles,next:mp},p=p.next;var y=u.styles+";";return y}return vAe(n,e,i)}case"function":{if(n!==void 0){var v=mp,w=i(n);return mp=v,ZC(n,e,w)}break}}var C=i;if(e==null)return C;var R=e[C];return R!==void 0?R:C}function vAe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=ZC(n,e,i[l])+";";else for(var u in i){var p=i[u];if(typeof p!="object"){var y=p;e!=null&&e[y]!==void 0?o+=u+"{"+e[y]+"}":Gq(y)&&(o+=yU(u)+":"+Hq(u,y)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var v=0;v<p.length;v++)Gq(p[v])&&(o+=yU(u)+":"+Hq(u,p[v])+";");else{var w=ZC(n,e,p);switch(u){case"animation":case"animationName":{o+=yU(u)+":"+w+";";break}default:o+=u+"{"+w+"}"}}}return o}var $q=/label:\s*([^\s;{]+)\s*(;|$)/g,mp;function iN(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";mp=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=ZC(i,e,u);else{var p=u;l+=p[0]}for(var y=1;y<n.length;y++)if(l+=ZC(i,e,n[y]),o){var v=u;l+=v[y]}$q.lastIndex=0;for(var w="",C;(C=$q.exec(l))!==null;)w+="-"+C[1];var R=gAe(l)+w;return{name:R,styles:l,next:mp}}var SAe=function(e){return e()},Kee=nq.useInsertionEffect?nq.useInsertionEffect:!1,qee=Kee||SAe,Kq=Kee||O.useLayoutEffect,pj=O.createContext(typeof HTMLElement<"u"?lAe({key:"css"}):null);pj.Provider;var bAe=function(){return O.useContext(pj)},fj=function(e){return O.forwardRef(function(i,o){var l=O.useContext(pj);return e(i,l,o)})},S0=O.createContext({}),wAe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Jy({},e,i)},TAe=Fq(function(n){return Fq(function(e){return wAe(n,e)})}),CAe=function(e){var i=O.useContext(S0);return e.theme!==i&&(i=TAe(i)(e.theme)),O.createElement(S0.Provider,{value:i},e.children)},mj={}.hasOwnProperty,OV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",RAe=function(e,i){var o={};for(var l in i)mj.call(i,l)&&(o[l]=i[l]);return o[OV]=e,o},IAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return dj(i,o,l),qee(function(){return hj(i,o,l)}),null},AAe=fj(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[OV],u=[o],p="";typeof n.className=="string"?p=Hee(e.registered,u,n.className):n.className!=null&&(p=n.className+" ");var y=iN(u,void 0,O.useContext(S0));p+=e.key+"-"+y.name;var v={};for(var w in n)mj.call(n,w)&&w!=="css"&&w!==OV&&(v[w]=n[w]);return v.className=p,i&&(v.ref=i),O.createElement(O.Fragment,null,O.createElement(IAe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),O.createElement(l,v))}),PAe=AAe,qq=function(e,i){var o=arguments;if(i==null||!mj.call(i,"css"))return O.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=PAe,u[1]=RAe(e,i);for(var p=2;p<l;p++)u[p]=o[p];return O.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(qq||(qq={}));var sN=fj(function(n,e){var i=n.styles,o=iN([i],void 0,O.useContext(S0)),l=O.useRef();return Kq(function(){var u=e.key+"-global",p=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",u),p.hydrate([v])),l.current=[p,y],function(){p.flush()}},[e]),Kq(function(){var u=l.current,p=u[0],y=u[1];if(y){u[1]=!1;return}if(o.next!==void 0&&hj(e,o.next,!0),p.tags.length){var v=p.tags[p.tags.length-1].nextElementSibling;p.before=v,p.flush()}e.insert("",o,p,!1)},[e,o.name]),null});function kAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return iN(e)}function AR(){var n=kAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const gj=O.createContext({});gj.displayName="ColorModeContext";function oN(){const n=O.useContext(gj);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Cg(n,e){const{colorMode:i}=oN();return i==="dark"?e:n}const K1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function OAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?K1.dark:K1.light),document.body.classList.remove(l?K1.light:K1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),p=y=>{l(y.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(p):u.addEventListener("change",p),()=>{typeof u.removeListener=="function"?u.removeListener(p):u.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const NAe="chakra-ui-color-mode";function xAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const DAe=xAe(NAe),Yq=()=>{},LAe=JEe()?O.useLayoutEffect:O.useEffect;function Xq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Yee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:p}={},colorModeManager:y=DAe}=e,v=bAe(),w=u==="dark"?"dark":"light",[C,R]=O.useState(()=>Xq(y,w)),[N,M]=O.useState(()=>Xq(y)),{getSystemTheme:D,setClassName:F,setDataset:z,addListener:q}=O.useMemo(()=>OAe({preventTransition:p,nonce:v==null?void 0:v.nonce}),[p,v==null?void 0:v.nonce]),K=u==="system"&&!C?N:C,re=O.useCallback(ge=>{const X=ge==="system"?D():ge;R(X),F(X==="dark"),z(X),y.set(X)},[y,D,F,z]);LAe(()=>{u==="system"&&M(D())},[]),O.useEffect(()=>{const ge=y.get();if(ge){re(ge);return}if(u==="system"){re("system");return}re(w)},[y,w,u,re]);const ce=O.useCallback(()=>{re(K==="dark"?"light":"dark")},[K,re]);O.useEffect(()=>{if(l)return q(re)},[l,q,re]);const se=O.useMemo(()=>({colorMode:i??K,toggleColorMode:i?Yq:ce,setColorMode:i?Yq:re,forced:i!==void 0}),[K,ce,re,i]);return S.jsx(gj.Provider,{value:se,children:o})};Yee.displayName="ColorModeProvider";const Xee=String.raw,Jee=Xee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,MAe=()=>S.jsx(sN,{styles:Jee}),UAe=({scope:n=""})=>S.jsx(sN,{styles:Xee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${Jee}
    `});function VAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=O.useMemo(()=>w0e(i),[i]);return S.jsxs(CAe,{theme:l,children:[S.jsx(FAe,{root:e}),o]})}function FAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(sN,{styles:i=>({[e]:i.__cssVars})})}ki({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function jAe(){const{colorMode:n}=oN();return S.jsx(sN,{styles:e=>{const i=iee(e,"styles.global"),o=gl(i,{theme:e,colorMode:n});return o?bee(o)(e):void 0}})}const[BAe,zAe]=ki({strict:!1,name:"PortalManagerContext"});function _j(n){const{children:e,zIndex:i}=n;return S.jsx(BAe,{value:{zIndex:i},children:e})}_j.displayName="PortalManager";const yj=O.createContext({getDocument(){return document},getWindow(){return window}});yj.displayName="EnvironmentContext";function WAe({defer:n}={}){const[,e]=O.useReducer(i=>i+1,0);return Cp(()=>{n&&e()},[n]),O.useContext(yj)}function Qee(n){const{children:e,environment:i,disabled:o}=n,l=O.useRef(null),u=O.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),p=!o||!i;return S.jsxs(yj.Provider,{value:u,children:[e,p&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Qee.displayName="EnvironmentProvider";const GAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:p={},environment:y,cssVarsRoot:v,disableEnvironment:w,disableGlobalStyle:C}=n,R=S.jsx(Qee,{environment:y,disabled:w,children:e});return S.jsx(VAe,{theme:p,cssVarsRoot:v,children:S.jsxs(Yee,{colorModeManager:i,options:p.config,children:[u?S.jsx(UAe,{scope:l}):S.jsx(MAe,{}),!C&&S.jsx(jAe,{}),o?S.jsx(_j,{zIndex:o,children:R}):R]})})},Ej=O.createContext({});function vj(n){const e=O.useRef(null);return e.current===null&&(e.current=n()),e.current}const PR=O.createContext(null),Sj=O.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class HAe extends O.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function $Ae({children:n,isPresent:e}){const i=O.useId(),o=O.useRef(null),l=O.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=O.useContext(Sj);return O.useInsertionEffect(()=>{const{width:p,height:y,top:v,left:w}=l.current;if(e||!o.current||!p||!y)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${w}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),S.jsx(HAe,{isPresent:e,childRef:o,sizeRef:l,children:O.cloneElement(n,{ref:o})})}const KAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:p})=>{const y=vj(qAe),v=O.useId(),w=O.useCallback(R=>{y.set(R,!0);for(const N of y.values())if(!N)return;o&&o()},[y,o]),C=O.useMemo(()=>({id:v,initial:e,isPresent:i,custom:l,onExitComplete:w,register:R=>(y.set(R,!1),()=>y.delete(R))}),u?[Math.random(),w]:[i,w]);return O.useMemo(()=>{y.forEach((R,N)=>y.set(N,!1))},[i]),O.useEffect(()=>{!i&&!y.size&&o&&o()},[i]),p==="popLayout"&&(n=S.jsx($Ae,{isPresent:i,children:n})),S.jsx(PR.Provider,{value:C,children:n})};function qAe(){return new Map}function bj(n=!0){const e=O.useContext(PR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=O.useId();O.useEffect(()=>{n&&l(u)},[n]);const p=O.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,p]:[!0]}function YAe(){return XAe(O.useContext(PR))}function XAe(n){return n===null?!0:n.isPresent}const q1=n=>n.key||"";function Jq(n){const e=[];return O.Children.forEach(n,i=>{O.isValidElement(i)&&e.push(i)}),e}const wj=typeof window<"u",Zee=wj?O.useLayoutEffect:O.useEffect,K0=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:p=!1})=>{const[y,v]=bj(p),w=O.useMemo(()=>Jq(n),[n]),C=p&&!y?[]:w.map(q1),R=O.useRef(!0),N=O.useRef(w),M=vj(()=>new Map),[D,F]=O.useState(w),[z,q]=O.useState(w);Zee(()=>{R.current=!1,N.current=w;for(let ce=0;ce<z.length;ce++){const se=q1(z[ce]);C.includes(se)?M.delete(se):M.get(se)!==!0&&M.set(se,!1)}},[z,C.length,C.join("-")]);const K=[];if(w!==D){let ce=[...w];for(let se=0;se<z.length;se++){const ge=z[se],X=q1(ge);C.includes(X)||(ce.splice(se,0,ge),K.push(ge))}u==="wait"&&K.length&&(ce=K),q(Jq(ce)),F(w);return}const{forceRender:re}=O.useContext(Ej);return S.jsx(S.Fragment,{children:z.map(ce=>{const se=q1(ce),ge=p&&!y?!1:w===z||C.includes(se),X=()=>{if(M.has(se))M.set(se,!0);else return;let J=!0;M.forEach(te=>{te||(J=!1)}),J&&(re==null||re(),q(N.current),p&&(v==null||v()),o&&o())};return S.jsx(KAe,{isPresent:ge,initial:!R.current||i?void 0:!1,custom:ge?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:ge?void 0:X,children:ce},se)})})},su=n=>n;let ete=su;function Tj(n){let e;return()=>(e===void 0&&(e=n()),e)}const b0=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},Uf=n=>n*1e3,Vf=n=>n/1e3,JAe={useManualTiming:!1};function QAe(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function y(w){u.has(w)&&(v.schedule(w),n()),w(p)}const v={schedule:(w,C=!1,R=!1)=>{const M=R&&o?e:i;return C&&u.add(w),M.has(w)||M.add(w),w},cancel:w=>{i.delete(w),u.delete(w)},process:w=>{if(p=w,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(y),e.clear(),o=!1,l&&(l=!1,v.process(w))}};return v}const Y1=["read","resolveKeyframes","update","preRender","render","postRender"],ZAe=40;function tte(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,p=Y1.reduce((q,K)=>(q[K]=QAe(u),q),{}),{read:y,resolveKeyframes:v,update:w,preRender:C,render:R,postRender:N}=p,M=()=>{const q=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(q-l.timestamp,ZAe),1),l.timestamp=q,l.isProcessing=!0,y.process(l),v.process(l),w.process(l),C.process(l),R.process(l),N.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(M))},D=()=>{i=!0,o=!0,l.isProcessing||n(M)};return{schedule:Y1.reduce((q,K)=>{const re=p[K];return q[K]=(ce,se=!1,ge=!1)=>(i||D(),re.schedule(ce,se,ge)),q},{}),cancel:q=>{for(let K=0;K<Y1.length;K++)p[Y1[K]].cancel(q)},state:l,steps:p}}const{schedule:ls,cancel:Lg,state:Na,steps:EU}=tte(typeof requestAnimationFrame<"u"?requestAnimationFrame:su,!0),nte=O.createContext({strict:!1}),Qq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},w0={};for(const n in Qq)w0[n]={isEnabled:e=>Qq[n].some(i=>!!e[i])};function ePe(n){for(const e in n)w0[e]={...w0[e],...n[e]}}const tPe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function oO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||tPe.has(n)}let rte=n=>!oO(n);function nPe(n){n&&(rte=e=>e.startsWith("on")?!oO(e):n(e))}try{nPe(require("@emotion/is-prop-valid").default)}catch{}function rPe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(rte(l)||i===!0&&oO(l)||!e&&!oO(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function iPe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const aN=O.createContext({});function eR(n){return typeof n=="string"||Array.isArray(n)}function cN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const Cj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Rj=["initial",...Cj];function lN(n){return cN(n.animate)||Rj.some(e=>eR(n[e]))}function ite(n){return!!(lN(n)||n.variants)}function sPe(n,e){if(lN(n)){const{initial:i,animate:o}=n;return{initial:i===!1||eR(i)?i:void 0,animate:eR(o)?o:void 0}}return n.inherit!==!1?e:{}}function oPe(n){const{initial:e,animate:i}=sPe(n,O.useContext(aN));return O.useMemo(()=>({initial:e,animate:i}),[Zq(e),Zq(i)])}function Zq(n){return Array.isArray(n)?n.join(" "):n}const aPe=Symbol.for("motionComponentSymbol");function GS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function cPe(n,e,i){return O.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):GS(i)&&(i.current=o))},[e])}const Ij=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),lPe="framerAppearId",ste="data-"+Ij(lPe),{schedule:Aj}=tte(queueMicrotask,!1),ote=O.createContext({});function uPe(n,e,i,o,l){var u,p;const{visualElement:y}=O.useContext(aN),v=O.useContext(nte),w=O.useContext(PR),C=O.useContext(Sj).reducedMotion,R=O.useRef(null);o=o||v.renderer,!R.current&&o&&(R.current=o(n,{visualState:e,parent:y,props:i,presenceContext:w,blockInitialAnimation:w?w.initial===!1:!1,reducedMotionConfig:C}));const N=R.current,M=O.useContext(ote);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&dPe(R.current,i,l,M);const D=O.useRef(!1);O.useInsertionEffect(()=>{N&&D.current&&N.update(i,w)});const F=i[ste],z=O.useRef(!!F&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,F))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,F)));return Zee(()=>{N&&(D.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),Aj.render(N.render),z.current&&N.animationState&&N.animationState.animateChanges())}),O.useEffect(()=>{N&&(!z.current&&N.animationState&&N.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var q;(q=window.MotionHandoffMarkAsComplete)===null||q===void 0||q.call(window,F)}),z.current=!1))}),N}function dPe(n,e,i,o){const{layoutId:l,layout:u,drag:p,dragConstraints:y,layoutScroll:v,layoutRoot:w}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:ate(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!p||y&&GS(y),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:v,layoutRoot:w})}function ate(n){if(n)return n.options.allowProjection!==!1?n.projection:ate(n.parent)}function hPe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,p;n&&ePe(n);function y(w,C){let R;const N={...O.useContext(Sj),...w,layoutId:pPe(w)},{isStatic:M}=N,D=oPe(w),F=o(w,M);if(!M&&wj){fPe();const z=mPe(N);R=z.MeasureLayout,D.visualElement=uPe(l,F,N,e,z.ProjectionNode)}return S.jsxs(aN.Provider,{value:D,children:[R&&D.visualElement?S.jsx(R,{visualElement:D.visualElement,...N}):null,i(l,w,cPe(F,D.visualElement,C),F,M,D.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(p=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&p!==void 0?p:""})`}`;const v=O.forwardRef(y);return v[aPe]=l,v}function pPe({layoutId:n}){const e=O.useContext(Ej).id;return e&&n!==void 0?e+"-"+n:n}function fPe(n,e){O.useContext(nte).strict}function mPe(n){const{drag:e,layout:i}=w0;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const gPe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Pj(n){return typeof n!="string"||n.includes("-")?!1:!!(gPe.indexOf(n)>-1||/[A-Z]/u.test(n))}function eY(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function kj(n,e,i,o){if(typeof e=="function"){const[l,u]=eY(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=eY(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const NV=n=>Array.isArray(n),_Pe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),yPe=n=>NV(n)?n[n.length-1]||0:n,uc=n=>!!(n&&n.getVelocity);function Nk(n){const e=uc(n)?n.get():n;return _Pe(e)?e.toValue():e}function EPe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const p={latestValues:vPe(o,l,u,n),renderState:e()};return i&&(p.onMount=y=>i({props:o,current:y,...p}),p.onUpdate=y=>i(y)),p}const cte=n=>(e,i)=>{const o=O.useContext(aN),l=O.useContext(PR),u=()=>EPe(n,e,o,l);return i?u():vj(u)};function vPe(n,e,i,o){const l={},u=o(n,{});for(const N in u)l[N]=Nk(u[N]);let{initial:p,animate:y}=n;const v=lN(n),w=ite(n);e&&w&&!v&&n.inherit!==!1&&(p===void 0&&(p=e.initial),y===void 0&&(y=e.animate));let C=i?i.initial===!1:!1;C=C||p===!1;const R=C?y:p;if(R&&typeof R!="boolean"&&!cN(R)){const N=Array.isArray(R)?R:[R];for(let M=0;M<N.length;M++){const D=kj(n,N[M]);if(D){const{transitionEnd:F,transition:z,...q}=D;for(const K in q){let re=q[K];if(Array.isArray(re)){const ce=C?re.length-1:0;re=re[ce]}re!==null&&(l[K]=re)}for(const K in F)l[K]=F[K]}}}return l}const q0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],lE=new Set(q0),lte=n=>e=>typeof e=="string"&&e.startsWith(n),ute=lte("--"),SPe=lte("var(--"),Oj=n=>SPe(n)?bPe.test(n.split("/*")[0].trim()):!1,bPe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,dte=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Gf=(n,e,i)=>i>e?e:i<n?n:i,Y0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},tR={...Y0,transform:n=>Gf(0,1,n)},X1={...Y0,default:1},kR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),gg=kR("deg"),Ap=kR("%"),$n=kR("px"),wPe=kR("vh"),TPe=kR("vw"),tY={...Ap,parse:n=>Ap.parse(n)/100,transform:n=>Ap.transform(n*100)},CPe={borderWidth:$n,borderTopWidth:$n,borderRightWidth:$n,borderBottomWidth:$n,borderLeftWidth:$n,borderRadius:$n,radius:$n,borderTopLeftRadius:$n,borderTopRightRadius:$n,borderBottomRightRadius:$n,borderBottomLeftRadius:$n,width:$n,maxWidth:$n,height:$n,maxHeight:$n,top:$n,right:$n,bottom:$n,left:$n,padding:$n,paddingTop:$n,paddingRight:$n,paddingBottom:$n,paddingLeft:$n,margin:$n,marginTop:$n,marginRight:$n,marginBottom:$n,marginLeft:$n,backgroundPositionX:$n,backgroundPositionY:$n},RPe={rotate:gg,rotateX:gg,rotateY:gg,rotateZ:gg,scale:X1,scaleX:X1,scaleY:X1,scaleZ:X1,skew:gg,skewX:gg,skewY:gg,distance:$n,translateX:$n,translateY:$n,translateZ:$n,x:$n,y:$n,z:$n,perspective:$n,transformPerspective:$n,opacity:tR,originX:tY,originY:tY,originZ:$n},nY={...Y0,transform:Math.round},Nj={...CPe,...RPe,zIndex:nY,size:$n,fillOpacity:tR,strokeOpacity:tR,numOctaves:nY},IPe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},APe=q0.length;function PPe(n,e,i){let o="",l=!0;for(let u=0;u<APe;u++){const p=q0[u],y=n[p];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(p.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const w=dte(y,Nj[p]);if(!v){l=!1;const C=IPe[p]||p;o+=`${C}(${w}) `}i&&(e[p]=w)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function xj(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let p=!1,y=!1;for(const v in e){const w=e[v];if(lE.has(v)){p=!0;continue}else if(ute(v)){l[v]=w;continue}else{const C=dte(w,Nj[v]);v.startsWith("origin")?(y=!0,u[v]=C):o[v]=C}}if(e.transform||(p||i?o.transform=PPe(e,n.transform,i):o.transform&&(o.transform="none")),y){const{originX:v="50%",originY:w="50%",originZ:C=0}=u;o.transformOrigin=`${v} ${w} ${C}`}}const kPe={offset:"stroke-dashoffset",array:"stroke-dasharray"},OPe={offset:"strokeDashoffset",array:"strokeDasharray"};function NPe(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?kPe:OPe;n[u.offset]=$n.transform(-o);const p=$n.transform(e),y=$n.transform(i);n[u.array]=`${p} ${y}`}function rY(n,e,i){return typeof n=="string"?n:$n.transform(e+i*n)}function xPe(n,e,i){const o=rY(e,n.x,n.width),l=rY(i,n.y,n.height);return`${o} ${l}`}function Dj(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:p,pathSpacing:y=1,pathOffset:v=0,...w},C,R){if(xj(n,w,R),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:N,style:M,dimensions:D}=n;N.transform&&(D&&(M.transform=N.transform),delete N.transform),D&&(l!==void 0||u!==void 0||M.transform)&&(M.transformOrigin=xPe(D,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(N.x=e),i!==void 0&&(N.y=i),o!==void 0&&(N.scale=o),p!==void 0&&NPe(N,p,y,v,!1)}const Lj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),hte=()=>({...Lj(),attrs:{}}),Mj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function pte(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const fte=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function mte(n,e,i,o){pte(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(fte.has(l)?l:Ij(l),e.attrs[l])}const aO={};function DPe(n){Object.assign(aO,n)}function gte(n,{layout:e,layoutId:i}){return lE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!aO[n]||n==="opacity")}function Uj(n,e,i){var o;const{style:l}=n,u={};for(const p in l)(uc(l[p])||e.style&&uc(e.style[p])||gte(p,n)||((o=i==null?void 0:i.getValue(p))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[p]=l[p]);return u}function _te(n,e,i){const o=Uj(n,e,i);for(const l in n)if(uc(n[l])||uc(e[l])){const u=q0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function LPe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const iY=["x","y","width","height","cx","cy","r"],MPe={useVisualState:cte({scrapeMotionValuesFromProps:_te,createRenderState:hte,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const y in l)if(lE.has(y)){u=!0;break}}if(!u)return;let p=!e;if(e)for(let y=0;y<iY.length;y++){const v=iY[y];n[v]!==e[v]&&(p=!0)}p&&ls.read(()=>{LPe(i,o),ls.render(()=>{Dj(o,l,Mj(i.tagName),n.transformTemplate),mte(i,o)})})}})},UPe={useVisualState:cte({scrapeMotionValuesFromProps:Uj,createRenderState:Lj})};function yte(n,e,i){for(const o in e)!uc(e[o])&&!gte(o,i)&&(n[o]=e[o])}function VPe({transformTemplate:n},e){return O.useMemo(()=>{const i=Lj();return xj(i,e,n),Object.assign({},i.vars,i.style)},[e])}function FPe(n,e){const i=n.style||{},o={};return yte(o,i,n),Object.assign(o,VPe(n,e)),o}function jPe(n,e){const i={},o=FPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function BPe(n,e,i,o){const l=O.useMemo(()=>{const u=hte();return Dj(u,e,Mj(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};yte(u,n.style,n),l.style={...u,...l.style}}return l}function zPe(n=!1){return(i,o,l,{latestValues:u},p)=>{const v=(Pj(i)?BPe:jPe)(o,u,p,i),w=rPe(o,typeof i=="string",n),C=i!==O.Fragment?{...w,...v,ref:l}:{},{children:R}=o,N=O.useMemo(()=>uc(R)?R.get():R,[R]);return O.createElement(i,{...C,children:N})}}function WPe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...Pj(o)?MPe:UPe,preloadedFeatures:n,useRender:zPe(l),createVisualElement:e,Component:o};return hPe(p)}}function Ete(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function uN(n,e,i){const o=n.getProps();return kj(o,e,i!==void 0?i:o.custom,n)}const GPe=Tj(()=>window.ScrollTimeline!==void 0);class HPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(GPe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class $Pe extends HPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function Vj(n,e){return n?n[e]||n.default||n:void 0}const xV=2e4;function vte(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<xV;)e+=i,o=n.next(e);return e>=xV?1/0:e}function Fj(n){return typeof n=="function"}function sY(n,e){n.timeline=e,n.onfinish=null}const jj=n=>Array.isArray(n)&&typeof n[0]=="number",KPe={linearEasing:void 0};function qPe(n,e){const i=Tj(n);return()=>{var o;return(o=KPe[e])!==null&&o!==void 0?o:i()}}const cO=qPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ste=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(b0(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function bte(n){return!!(typeof n=="function"&&cO()||!n||typeof n=="string"&&(n in DV||cO())||jj(n)||Array.isArray(n)&&n.every(bte))}const dC=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,DV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:dC([0,.65,.55,1]),circOut:dC([.55,0,1,.45]),backIn:dC([.31,.01,.66,-.59]),backOut:dC([.33,1.53,.69,.99])};function wte(n,e){if(n)return typeof n=="function"&&cO()?Ste(n,e):jj(n)?dC(n):Array.isArray(n)?n.map(i=>wte(i,e)||DV.easeOut):DV[n]}const rh={x:!1,y:!1};function Tte(){return rh.x||rh.y}function YPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function Cte(n,e){const i=YPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function oY(n){return e=>{e.pointerType==="touch"||Tte()||n(e)}}function XPe(n,e,i={}){const[o,l,u]=Cte(n,i),p=oY(y=>{const{target:v}=y,w=e(y);if(typeof w!="function"||!v)return;const C=oY(R=>{w(R),v.removeEventListener("pointerleave",C)});v.addEventListener("pointerleave",C,l)});return o.forEach(y=>{y.addEventListener("pointerenter",p,l)}),u}const Rte=(n,e)=>e?n===e?!0:Rte(n,e.parentElement):!1,Bj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,JPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function QPe(n){return JPe.has(n.tagName)||n.tabIndex!==-1}const hC=new WeakSet;function aY(n){return e=>{e.key==="Enter"&&n(e)}}function vU(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const ZPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=aY(()=>{if(hC.has(i))return;vU(i,"down");const l=aY(()=>{vU(i,"up")}),u=()=>vU(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function cY(n){return Bj(n)&&!Tte()}function e1e(n,e,i={}){const[o,l,u]=Cte(n,i),p=y=>{const v=y.currentTarget;if(!cY(y)||hC.has(v))return;hC.add(v);const w=e(y),C=(M,D)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",N),!(!cY(M)||!hC.has(v))&&(hC.delete(v),typeof w=="function"&&w(M,{success:D}))},R=M=>{C(M,i.useGlobalTarget||Rte(v,M.target))},N=M=>{C(M,!1)};window.addEventListener("pointerup",R,l),window.addEventListener("pointercancel",N,l)};return o.forEach(y=>{!QPe(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",p,l),y.addEventListener("focus",w=>ZPe(w,l),l)}),u}function t1e(n){return n==="x"||n==="y"?rh[n]?null:(rh[n]=!0,()=>{rh[n]=!1}):rh.x||rh.y?null:(rh.x=rh.y=!0,()=>{rh.x=rh.y=!1})}const Ite=new Set(["width","height","top","left","right","bottom",...q0]);let xk;function n1e(){xk=void 0}const Pp={now:()=>(xk===void 0&&Pp.set(Na.isProcessing||JAe.useManualTiming?Na.timestamp:performance.now()),xk),set:n=>{xk=n,queueMicrotask(n1e)}};function zj(n,e){n.indexOf(e)===-1&&n.push(e)}function Wj(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class Gj{constructor(){this.subscriptions=[]}add(e){return zj(this.subscriptions,e),()=>Wj(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const p=this.subscriptions[u];p&&p(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Ate(n,e){return e?n*(1e3/e):0}const lY=30,r1e=n=>!isNaN(parseFloat(n));class i1e{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=Pp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Pp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=r1e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Gj);const o=this.events[e].add(i);return e==="change"?()=>{o(),ls.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Pp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>lY)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,lY);return Ate(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function nR(n,e){return new i1e(n,e)}function s1e(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,nR(i))}function o1e(n,e){const i=uN(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const p in u){const y=yPe(u[p]);s1e(n,p,y)}}function a1e(n){return!!(uc(n)&&n.add)}function LV(n,e){const i=n.getValue("willChange");if(a1e(i))return i.add(e)}function Pte(n){return n.props[ste]}const kte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,c1e=1e-7,l1e=12;function u1e(n,e,i,o,l){let u,p,y=0;do p=e+(i-e)/2,u=kte(p,o,l)-n,u>0?i=p:e=p;while(Math.abs(u)>c1e&&++y<l1e);return p}function OR(n,e,i,o){if(n===e&&i===o)return su;const l=u=>u1e(u,0,1,n,i);return u=>u===0||u===1?u:kte(l(u),e,o)}const Ote=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Nte=n=>e=>1-n(1-e),xte=OR(.33,1.53,.69,.99),Hj=Nte(xte),Dte=Ote(Hj),Lte=n=>(n*=2)<1?.5*Hj(n):.5*(2-Math.pow(2,-10*(n-1))),$j=n=>1-Math.sin(Math.acos(n)),Mte=Nte($j),Ute=Ote($j),Vte=n=>/^0[^.\s]+$/u.test(n);function d1e(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Vte(n):!0}const kC=n=>Math.round(n*1e5)/1e5,Kj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function h1e(n){return n==null}const p1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,qj=(n,e)=>i=>!!(typeof i=="string"&&p1e.test(i)&&i.startsWith(n)||e&&!h1e(i)&&Object.prototype.hasOwnProperty.call(i,e)),Fte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,p,y]=o.match(Kj);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(p),alpha:y!==void 0?parseFloat(y):1}},f1e=n=>Gf(0,255,n),SU={...Y0,transform:n=>Math.round(f1e(n))},Dy={test:qj("rgb","red"),parse:Fte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+SU.transform(n)+", "+SU.transform(e)+", "+SU.transform(i)+", "+kC(tR.transform(o))+")"};function m1e(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const MV={test:qj("#"),parse:m1e,transform:Dy.transform},HS={test:qj("hsl","hue"),parse:Fte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+Ap.transform(kC(e))+", "+Ap.transform(kC(i))+", "+kC(tR.transform(o))+")"},ac={test:n=>Dy.test(n)||MV.test(n)||HS.test(n),parse:n=>Dy.test(n)?Dy.parse(n):HS.test(n)?HS.parse(n):MV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Dy.transform(n):HS.transform(n)},g1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function _1e(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(Kj))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(g1e))===null||i===void 0?void 0:i.length)||0)>0}const jte="number",Bte="color",y1e="var",E1e="var(",uY="${}",v1e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rR(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const y=e.replace(v1e,v=>(ac.test(v)?(o.color.push(u),l.push(Bte),i.push(ac.parse(v))):v.startsWith(E1e)?(o.var.push(u),l.push(y1e),i.push(v)):(o.number.push(u),l.push(jte),i.push(parseFloat(v))),++u,uY)).split(uY);return{values:i,split:y,indexes:o,types:l}}function zte(n){return rR(n).values}function Wte(n){const{split:e,types:i}=rR(n),o=e.length;return l=>{let u="";for(let p=0;p<o;p++)if(u+=e[p],l[p]!==void 0){const y=i[p];y===jte?u+=kC(l[p]):y===Bte?u+=ac.transform(l[p]):u+=l[p]}return u}}const S1e=n=>typeof n=="number"?0:n;function b1e(n){const e=zte(n);return Wte(n)(e.map(S1e))}const Mg={test:_1e,parse:zte,createTransformer:Wte,getAnimatableNone:b1e},w1e=new Set(["brightness","contrast","saturate","opacity"]);function T1e(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(Kj)||[];if(!o)return n;const l=i.replace(o,"");let u=w1e.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const C1e=/\b([a-z-]*)\(.*?\)/gu,UV={...Mg,getAnimatableNone:n=>{const e=n.match(C1e);return e?e.map(T1e).join(" "):n}},R1e={...Nj,color:ac,backgroundColor:ac,outlineColor:ac,fill:ac,stroke:ac,borderColor:ac,borderTopColor:ac,borderRightColor:ac,borderBottomColor:ac,borderLeftColor:ac,filter:UV,WebkitFilter:UV},Yj=n=>R1e[n];function Gte(n,e){let i=Yj(n);return i!==UV&&(i=Mg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const I1e=new Set(["auto","none","0"]);function A1e(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!I1e.has(u)&&rR(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=Gte(i,l)}const dY=n=>n===Y0||n===$n,hY=(n,e)=>parseFloat(n.split(", ")[e]),pY=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return hY(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?hY(u[1],n):0}},P1e=new Set(["x","y","z"]),k1e=q0.filter(n=>!P1e.has(n));function O1e(n){const e=[];return k1e.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const T0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:pY(4,13),y:pY(5,14)};T0.translateX=T0.x;T0.translateY=T0.y;const zy=new Set;let VV=!1,FV=!1;function Hte(){if(FV){const n=Array.from(zy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=O1e(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,p])=>{var y;(y=o.getValue(u))===null||y===void 0||y.set(p)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}FV=!1,VV=!1,zy.forEach(n=>n.complete()),zy.clear()}function $te(){zy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(FV=!0)})}function N1e(){$te(),Hte()}class Xj{constructor(e,i,o,l,u,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(zy.add(this),VV||(VV=!0,ls.read($te),ls.resolveKeyframes(Hte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const p=l==null?void 0:l.get(),y=e[e.length-1];if(p!==void 0)e[0]=p;else if(o&&i){const v=o.readValue(i,y);v!=null&&(e[0]=v)}e[0]===void 0&&(e[0]=y),l&&p===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),zy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,zy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Kte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),x1e=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function D1e(n){const e=x1e.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function qte(n,e,i=1){const[o,l]=D1e(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const p=u.trim();return Kte(p)?parseFloat(p):p}return Oj(l)?qte(l,e,i+1):l}const Yte=n=>e=>e.test(n),L1e={test:n=>n==="auto",parse:n=>n},Xte=[Y0,$n,Ap,gg,TPe,wPe,L1e],fY=n=>Xte.find(Yte(n));class Jte extends Xj{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let w=e[v];if(typeof w=="string"&&(w=w.trim(),Oj(w))){const C=qte(w,i.current);C!==void 0&&(e[v]=C),v===e.length-1&&(this.finalKeyframe=w)}}if(this.resolveNoneKeyframes(),!Ite.has(o)||e.length!==2)return;const[l,u]=e,p=fY(l),y=fY(u);if(p!==y)if(dY(p)&&dY(y))for(let v=0;v<e.length;v++){const w=e[v];typeof w=="string"&&(e[v]=parseFloat(w))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)d1e(e[l])&&o.push(l);o.length&&A1e(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=T0[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const p=l.length-1,y=l[p];l[p]=T0[o](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([v,w])=>{i.getValue(v).set(w)}),this.resolveNoneKeyframes()}}const mY=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Mg.test(n)||n==="0")&&!n.startsWith("url("));function M1e(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function U1e(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],p=mY(l,e),y=mY(u,e);return!p||!y?!1:M1e(n)||(i==="spring"||Fj(i))&&o}const V1e=n=>n!==null;function dN(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(V1e),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const F1e=40;class Qte{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:p="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Pp.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:p,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>F1e?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&N1e(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Pp.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:p,onComplete:y,onUpdate:v,isGenerator:w}=this.options;if(!w&&!U1e(e,o,l,u))if(p)this.options.duration=0;else{v&&v(dN(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ks=(n,e,i)=>n+(e-n)*i;function bU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function j1e({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,p=0;if(!e)l=u=p=i;else{const y=i<.5?i*(1+e):i+e-i*e,v=2*i-y;l=bU(v,y,n+1/3),u=bU(v,y,n),p=bU(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(p*255),alpha:o}}function lO(n,e){return i=>i>0?e:n}const wU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},B1e=[MV,Dy,HS],z1e=n=>B1e.find(e=>e.test(n));function gY(n){const e=z1e(n);if(!e)return!1;let i=e.parse(n);return e===HS&&(i=j1e(i)),i}const _Y=(n,e)=>{const i=gY(n),o=gY(e);if(!i||!o)return lO(n,e);const l={...i};return u=>(l.red=wU(i.red,o.red,u),l.green=wU(i.green,o.green,u),l.blue=wU(i.blue,o.blue,u),l.alpha=ks(i.alpha,o.alpha,u),Dy.transform(l))},W1e=(n,e)=>i=>e(n(i)),NR=(...n)=>n.reduce(W1e),jV=new Set(["none","hidden"]);function G1e(n,e){return jV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function H1e(n,e){return i=>ks(n,e,i)}function Jj(n){return typeof n=="number"?H1e:typeof n=="string"?Oj(n)?lO:ac.test(n)?_Y:q1e:Array.isArray(n)?Zte:typeof n=="object"?ac.test(n)?_Y:$1e:lO}function Zte(n,e){const i=[...n],o=i.length,l=n.map((u,p)=>Jj(u)(u,e[p]));return u=>{for(let p=0;p<o;p++)i[p]=l[p](u);return i}}function $1e(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=Jj(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function K1e(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const p=e.types[u],y=n.indexes[p][l[p]],v=(i=n.values[y])!==null&&i!==void 0?i:0;o[u]=v,l[p]++}return o}const q1e=(n,e)=>{const i=Mg.createTransformer(e),o=rR(n),l=rR(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?jV.has(n)&&!l.values.length||jV.has(e)&&!o.values.length?G1e(n,e):NR(Zte(K1e(o,l),l.values),i):lO(n,e)};function ene(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?ks(n,e,i):Jj(n)(n,e)}const Y1e=5;function tne(n,e,i){const o=Math.max(e-Y1e,0);return Ate(i-n(o),e-o)}const Gs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},yY=.001;function X1e({duration:n=Gs.duration,bounce:e=Gs.bounce,velocity:i=Gs.velocity,mass:o=Gs.mass}){let l,u,p=1-e;p=Gf(Gs.minDamping,Gs.maxDamping,p),n=Gf(Gs.minDuration,Gs.maxDuration,Vf(n)),p<1?(l=w=>{const C=w*p,R=C*n,N=C-i,M=BV(w,p),D=Math.exp(-R);return yY-N/M*D},u=w=>{const R=w*p*n,N=R*i+i,M=Math.pow(p,2)*Math.pow(w,2)*n,D=Math.exp(-R),F=BV(Math.pow(w,2),p);return(-l(w)+yY>0?-1:1)*((N-M)*D)/F}):(l=w=>{const C=Math.exp(-w*n),R=(w-i)*n+1;return-.001+C*R},u=w=>{const C=Math.exp(-w*n),R=(i-w)*(n*n);return C*R});const y=5/n,v=Q1e(l,u,y);if(n=Uf(n),isNaN(v))return{stiffness:Gs.stiffness,damping:Gs.damping,duration:n};{const w=Math.pow(v,2)*o;return{stiffness:w,damping:p*2*Math.sqrt(o*w),duration:n}}}const J1e=12;function Q1e(n,e,i){let o=i;for(let l=1;l<J1e;l++)o=o-n(o)/e(o);return o}function BV(n,e){return n*Math.sqrt(1-e*e)}const Z1e=["duration","bounce"],eke=["stiffness","damping","mass"];function EY(n,e){return e.some(i=>n[i]!==void 0)}function tke(n){let e={velocity:Gs.velocity,stiffness:Gs.stiffness,damping:Gs.damping,mass:Gs.mass,isResolvedFromDuration:!1,...n};if(!EY(n,eke)&&EY(n,Z1e))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*Gf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Gs.mass,stiffness:l,damping:u}}else{const i=X1e(n);e={...e,...i,mass:Gs.mass},e.isResolvedFromDuration=!0}return e}function nne(n=Gs.visualDuration,e=Gs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],y={done:!1,value:u},{stiffness:v,damping:w,mass:C,duration:R,velocity:N,isResolvedFromDuration:M}=tke({...i,velocity:-Vf(i.velocity||0)}),D=N||0,F=w/(2*Math.sqrt(v*C)),z=p-u,q=Vf(Math.sqrt(v/C)),K=Math.abs(z)<5;o||(o=K?Gs.restSpeed.granular:Gs.restSpeed.default),l||(l=K?Gs.restDelta.granular:Gs.restDelta.default);let re;if(F<1){const se=BV(q,F);re=ge=>{const X=Math.exp(-F*q*ge);return p-X*((D+F*q*z)/se*Math.sin(se*ge)+z*Math.cos(se*ge))}}else if(F===1)re=se=>p-Math.exp(-q*se)*(z+(D+q*z)*se);else{const se=q*Math.sqrt(F*F-1);re=ge=>{const X=Math.exp(-F*q*ge),J=Math.min(se*ge,300);return p-X*((D+F*q*z)*Math.sinh(J)+se*z*Math.cosh(J))/se}}const ce={calculatedDuration:M&&R||null,next:se=>{const ge=re(se);if(M)y.done=se>=R;else{let X=0;F<1&&(X=se===0?Uf(D):tne(re,se,ge));const J=Math.abs(X)<=o,te=Math.abs(p-ge)<=l;y.done=J&&te}return y.value=y.done?p:ge,y},toString:()=>{const se=Math.min(vte(ce),xV),ge=Ste(X=>ce.next(se*X).value,se,30);return se+"ms "+ge}};return ce}function vY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:p,min:y,max:v,restDelta:w=.5,restSpeed:C}){const R=n[0],N={done:!1,value:R},M=J=>y!==void 0&&J<y||v!==void 0&&J>v,D=J=>y===void 0?v:v===void 0||Math.abs(y-J)<Math.abs(v-J)?y:v;let F=i*e;const z=R+F,q=p===void 0?z:p(z);q!==z&&(F=q-R);const K=J=>-F*Math.exp(-J/o),re=J=>q+K(J),ce=J=>{const te=K(J),ne=re(J);N.done=Math.abs(te)<=w,N.value=N.done?q:ne};let se,ge;const X=J=>{M(N.value)&&(se=J,ge=nne({keyframes:[N.value,D(N.value)],velocity:tne(re,J,N.value),damping:l,stiffness:u,restDelta:w,restSpeed:C}))};return X(0),{calculatedDuration:null,next:J=>{let te=!1;return!ge&&se===void 0&&(te=!0,ce(J),X(J)),se!==void 0&&J>=se?ge.next(J-se):(!te&&ce(J),N)}}}const nke=OR(.42,0,1,1),rke=OR(0,0,.58,1),rne=OR(.42,0,.58,1),ike=n=>Array.isArray(n)&&typeof n[0]!="number",ske={linear:su,easeIn:nke,easeInOut:rne,easeOut:rke,circIn:$j,circInOut:Ute,circOut:Mte,backIn:Hj,backInOut:Dte,backOut:xte,anticipate:Lte},SY=n=>{if(jj(n)){ete(n.length===4);const[e,i,o,l]=n;return OR(e,i,o,l)}else if(typeof n=="string")return ske[n];return n};function oke(n,e,i){const o=[],l=i||ene,u=n.length-1;for(let p=0;p<u;p++){let y=l(n[p],n[p+1]);if(e){const v=Array.isArray(e)?e[p]||su:e;y=NR(v,y)}o.push(y)}return o}function ake(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(ete(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=oke(e,o,l),v=y.length,w=C=>{if(p&&C<n[0])return e[0];let R=0;if(v>1)for(;R<n.length-2&&!(C<n[R+1]);R++);const N=b0(n[R],n[R+1],C);return y[R](N)};return i?C=>w(Gf(n[0],n[u-1],C)):w}function cke(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=b0(0,e,o);n.push(ks(i,1,l))}}function lke(n){const e=[0];return cke(e,n.length-1),e}function uke(n,e){return n.map(i=>i*e)}function dke(n,e){return n.map(()=>e||rne).splice(0,n.length-1)}function uO({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=ike(o)?o.map(SY):SY(o),u={done:!1,value:e[0]},p=uke(i&&i.length===e.length?i:lke(e),n),y=ake(p,e,{ease:Array.isArray(l)?l:dke(e,l)});return{calculatedDuration:n,next:v=>(u.value=y(v),u.done=v>=n,u)}}const hke=n=>{const e=({timestamp:i})=>n(i);return{start:()=>ls.update(e,!0),stop:()=>Lg(e),now:()=>Na.isProcessing?Na.timestamp:Pp.now()}},pke={decay:vY,inertia:vY,tween:uO,keyframes:uO,spring:nne},fke=n=>n/100;class Qj extends Qte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,p=(l==null?void 0:l.KeyframeResolver)||Xj,y=(v,w)=>this.onKeyframesResolved(v,w);this.resolver=new p(u,y,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:p=0}=this.options,y=Fj(i)?i:pke[i]||uO;let v,w;y!==uO&&typeof e[0]!="number"&&(v=NR(fke,ene(e[0],e[1])),e=[0,100]);const C=y({...this.options,keyframes:e});u==="mirror"&&(w=y({...this.options,keyframes:[...e].reverse(),velocity:-p})),C.calculatedDuration===null&&(C.calculatedDuration=vte(C));const{calculatedDuration:R}=C,N=R+l,M=N*(o+1)-l;return{generator:C,mirroredGenerator:w,mapPercentToKeyframes:v,calculatedDuration:R,resolvedDuration:N,totalDuration:M}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:p,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:w,totalDuration:C,resolvedDuration:R}=o;if(this.startTime===null)return u.next(0);const{delay:N,repeat:M,repeatType:D,repeatDelay:F,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const q=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?q<0:q>C;this.currentTime=Math.max(q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let re=this.currentTime,ce=u;if(M){const J=Math.min(this.currentTime,C)/R;let te=Math.floor(J),ne=J%1;!ne&&J>=1&&(ne=1),ne===1&&te--,te=Math.min(te,M+1),!!(te%2)&&(D==="reverse"?(ne=1-ne,F&&(ne-=F/R)):D==="mirror"&&(ce=p)),re=Gf(0,1,ne)*R}const se=K?{done:!1,value:v[0]}:ce.next(re);y&&(se.value=y(se.value));let{done:ge}=se;!K&&w!==null&&(ge=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const X=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return X&&l!==void 0&&(se.value=dN(v,this.options,l)),z&&z(se.value),X&&this.finish(),se}get duration(){const{resolved:e}=this;return e?Vf(e.calculatedDuration):0}get time(){return Vf(this.currentTime)}set time(e){e=Uf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Vf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=hke,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const mke=new Set(["opacity","clipPath","filter","transform"]);function gke(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:p="loop",ease:y="easeInOut",times:v}={}){const w={[e]:i};v&&(w.offset=v);const C=wte(y,l);return Array.isArray(C)&&(w.easing=C),n.animate(w,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:p==="reverse"?"alternate":"normal"})}const _ke=Tj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),dO=10,yke=2e4;function Eke(n){return Fj(n.type)||n.type==="spring"||!bte(n.ease)}function vke(n,e){const i=new Qj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<yke;)o=i.sample(u),l.push(o.value),u+=dO;return{times:void 0,keyframes:l,duration:u-dO,ease:"linear"}}const ine={anticipate:Lte,backInOut:Dte,circInOut:Ute};function Ske(n){return n in ine}class bY extends Qte{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new Jte(u,(p,y)=>this.onKeyframesResolved(p,y),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:p,motionValue:y,name:v,startTime:w}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof u=="string"&&cO()&&Ske(u)&&(u=ine[u]),Eke(this.options)){const{onComplete:R,onUpdate:N,motionValue:M,element:D,...F}=this.options,z=vke(e,F);e=z.keyframes,e.length===1&&(e[1]=e[0]),o=z.duration,l=z.times,u=z.ease,p="keyframes"}const C=gke(y.owner.current,v,e,{...this.options,duration:o,times:l,ease:u});return C.startTime=w??this.calcStartTime(),this.pendingTimeline?(sY(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:R}=this.options;y.set(dN(e,this.options,i)),R&&R(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:p,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Vf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Vf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=Uf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return su;const{animation:o}=i;sY(o,e)}return su}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:p,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:w,onUpdate:C,onComplete:R,element:N,...M}=this.options,D=new Qj({...M,keyframes:o,duration:l,type:u,ease:p,times:y,isGenerator:!0}),F=Uf(this.time);w.setWithVelocity(D.sample(F-dO).value,D.sample(F).value,dO)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:p,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:w}=i.owner.getProps();return _ke()&&o&&mke.has(o)&&!v&&!w&&!l&&u!=="mirror"&&p!==0&&y!=="inertia"}}const bke={type:"spring",stiffness:500,damping:25,restSpeed:10},wke=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),Tke={type:"keyframes",duration:.8},Cke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Rke=(n,{keyframes:e})=>e.length>2?Tke:lE.has(n)?n.startsWith("scale")?wke(e[1]):bke:Cke;function Ike({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:p,repeatDelay:y,from:v,elapsed:w,...C}){return!!Object.keys(C).length}const Zj=(n,e,i,o={},l,u)=>p=>{const y=Vj(o,n)||{},v=y.delay||o.delay||0;let{elapsed:w=0}=o;w=w-Uf(v);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-w,onUpdate:N=>{e.set(N),y.onUpdate&&y.onUpdate(N)},onComplete:()=>{p(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:u?void 0:l};Ike(y)||(C={...C,...Rke(n,C)}),C.duration&&(C.duration=Uf(C.duration)),C.repeatDelay&&(C.repeatDelay=Uf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let R=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(R=!0)),R&&!u&&e.get()!==void 0){const N=dN(C.keyframes,y);if(N!==void 0)return ls.update(()=>{C.onUpdate(N),C.onComplete()}),new $Pe([])}return!u&&bY.supports(C)?new bY(C):new Qj(C)};function Ake({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function sne(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:p=n.getDefaultTransition(),transitionEnd:y,...v}=e;o&&(p=o);const w=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const R in v){const N=n.getValue(R,(u=n.latestValues[R])!==null&&u!==void 0?u:null),M=v[R];if(M===void 0||C&&Ake(C,R))continue;const D={delay:i,...Vj(p||{},R)};let F=!1;if(window.MotionHandoffAnimation){const q=Pte(n);if(q){const K=window.MotionHandoffAnimation(q,R,ls);K!==null&&(D.startTime=K,F=!0)}}LV(n,R),N.start(Zj(R,N,M,n.shouldReduceMotion&&Ite.has(R)?{type:!1}:D,n,F));const z=N.animation;z&&w.push(z)}return y&&Promise.all(w).then(()=>{ls.update(()=>{y&&o1e(n,y)})}),w}function zV(n,e,i={}){var o;const l=uN(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const p=l?()=>Promise.all(sne(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(w=0)=>{const{delayChildren:C=0,staggerChildren:R,staggerDirection:N}=u;return Pke(n,e,C+w,R,N,i)}:()=>Promise.resolve(),{when:v}=u;if(v){const[w,C]=v==="beforeChildren"?[p,y]:[y,p];return w().then(()=>C())}else return Promise.all([p(),y(i.delay)])}function Pke(n,e,i=0,o=0,l=1,u){const p=[],y=(n.variantChildren.size-1)*o,v=l===1?(w=0)=>w*o:(w=0)=>y-w*o;return Array.from(n.variantChildren).sort(kke).forEach((w,C)=>{w.notify("AnimationStart",e),p.push(zV(w,e,{...u,delay:i+v(C)}).then(()=>w.notify("AnimationComplete",e)))}),Promise.all(p)}function kke(n,e){return n.sortNodePosition(e)}function Oke(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>zV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=zV(n,e,i);else{const l=typeof e=="function"?uN(n,e,i.custom):e;o=Promise.all(sne(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const Nke=Rj.length;function one(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?one(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<Nke;i++){const o=Rj[i],l=n.props[o];(eR(l)||l===!1)&&(e[o]=l)}return e}const xke=[...Cj].reverse(),Dke=Cj.length;function Lke(n){return e=>Promise.all(e.map(({animation:i,options:o})=>Oke(n,i,o)))}function Mke(n){let e=Lke(n),i=wY(),o=!0;const l=v=>(w,C)=>{var R;const N=uN(n,C,v==="exit"?(R=n.presenceContext)===null||R===void 0?void 0:R.custom:void 0);if(N){const{transition:M,transitionEnd:D,...F}=N;w={...w,...F,...D}}return w};function u(v){e=v(n)}function p(v){const{props:w}=n,C=one(n.parent)||{},R=[],N=new Set;let M={},D=1/0;for(let z=0;z<Dke;z++){const q=xke[z],K=i[q],re=w[q]!==void 0?w[q]:C[q],ce=eR(re),se=q===v?K.isActive:null;se===!1&&(D=z);let ge=re===C[q]&&re!==w[q]&&ce;if(ge&&o&&n.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...M},!K.isActive&&se===null||!re&&!K.prevProp||cN(re)||typeof re=="boolean")continue;const X=Uke(K.prevProp,re);let J=X||q===v&&K.isActive&&!ge&&ce||z>D&&ce,te=!1;const ne=Array.isArray(re)?re:[re];let de=ne.reduce(l(q),{});se===!1&&(de={});const{prevResolvedValues:pe={}}=K,he={...pe,...de},ve=be=>{J=!0,N.has(be)&&(te=!0,N.delete(be)),K.needsAnimating[be]=!0;const Re=n.getValue(be);Re&&(Re.liveStyle=!1)};for(const be in he){const Re=de[be],Ae=pe[be];if(M.hasOwnProperty(be))continue;let xe=!1;NV(Re)&&NV(Ae)?xe=!Ete(Re,Ae):xe=Re!==Ae,xe?Re!=null?ve(be):N.add(be):Re!==void 0&&N.has(be)?ve(be):K.protectedKeys[be]=!0}K.prevProp=re,K.prevResolvedValues=de,K.isActive&&(M={...M,...de}),o&&n.blockInitialAnimation&&(J=!1),J&&(!(ge&&X)||te)&&R.push(...ne.map(be=>({animation:be,options:{type:q}})))}if(N.size){const z={};N.forEach(q=>{const K=n.getBaseTarget(q),re=n.getValue(q);re&&(re.liveStyle=!0),z[q]=K??null}),R.push({animation:z})}let F=!!R.length;return o&&(w.initial===!1||w.initial===w.animate)&&!n.manuallyAnimateOnMount&&(F=!1),o=!1,F?e(R):Promise.resolve()}function y(v,w){var C;if(i[v].isActive===w)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(N=>{var M;return(M=N.animationState)===null||M===void 0?void 0:M.setActive(v,w)}),i[v].isActive=w;const R=p(v);for(const N in i)i[N].protectedKeys={};return R}return{animateChanges:p,setActive:y,setAnimateFunction:u,getState:()=>i,reset:()=>{i=wY(),o=!0}}}function Uke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!Ete(e,n):!1}function Ty(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function wY(){return{animate:Ty(!0),whileInView:Ty(),whileHover:Ty(),whileTap:Ty(),whileDrag:Ty(),whileFocus:Ty(),exit:Ty()}}class Kg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Vke extends Kg{constructor(e){super(e),e.animationState||(e.animationState=Mke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();cN(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let Fke=0;class jke extends Kg{constructor(){super(...arguments),this.id=Fke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Bke={animation:{Feature:Vke},exit:{Feature:jke}};function iR(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function xR(n){return{point:{x:n.pageX,y:n.pageY}}}const zke=n=>e=>Bj(e)&&n(e,xR(e));function OC(n,e,i,o){return iR(n,e,zke(i),o)}const TY=(n,e)=>Math.abs(n-e);function Wke(n,e){const i=TY(n.x,e.x),o=TY(n.y,e.y);return Math.sqrt(i**2+o**2)}class ane{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const R=CU(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,M=Wke(R.offset,{x:0,y:0})>=3;if(!N&&!M)return;const{point:D}=R,{timestamp:F}=Na;this.history.push({...D,timestamp:F});const{onStart:z,onMove:q}=this.handlers;N||(z&&z(this.lastMoveEvent,R),this.startEvent=this.lastMoveEvent),q&&q(this.lastMoveEvent,R)},this.handlePointerMove=(R,N)=>{this.lastMoveEvent=R,this.lastMoveEventInfo=TU(N,this.transformPagePoint),ls.update(this.updatePoint,!0)},this.handlePointerUp=(R,N)=>{this.end();const{onEnd:M,onSessionEnd:D,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=CU(R.type==="pointercancel"?this.lastMoveEventInfo:TU(N,this.transformPagePoint),this.history);this.startEvent&&M&&M(R,z),D&&D(R,z)},!Bj(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const p=xR(e),y=TU(p,this.transformPagePoint),{point:v}=y,{timestamp:w}=Na;this.history=[{...v,timestamp:w}];const{onSessionStart:C}=i;C&&C(e,CU(y,this.history)),this.removeListeners=NR(OC(this.contextWindow,"pointermove",this.handlePointerMove),OC(this.contextWindow,"pointerup",this.handlePointerUp),OC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Lg(this.updatePoint)}}function TU(n,e){return e?{point:e(n.point)}:n}function CY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function CU({point:n},e){return{point:n,delta:CY(n,cne(e)),offset:CY(n,Gke(e)),velocity:Hke(e,.1)}}function Gke(n){return n[0]}function cne(n){return n[n.length-1]}function Hke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=cne(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Uf(e)));)i--;if(!o)return{x:0,y:0};const u=Vf(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const p={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const lne=1e-4,$ke=1-lne,Kke=1+lne,une=.01,qke=0-une,Yke=0+une;function au(n){return n.max-n.min}function Xke(n,e,i){return Math.abs(n-e)<=i}function RY(n,e,i,o=.5){n.origin=o,n.originPoint=ks(e.min,e.max,n.origin),n.scale=au(i)/au(e),n.translate=ks(i.min,i.max,n.origin)-n.originPoint,(n.scale>=$ke&&n.scale<=Kke||isNaN(n.scale))&&(n.scale=1),(n.translate>=qke&&n.translate<=Yke||isNaN(n.translate))&&(n.translate=0)}function NC(n,e,i,o){RY(n.x,e.x,i.x,o?o.originX:void 0),RY(n.y,e.y,i.y,o?o.originY:void 0)}function IY(n,e,i){n.min=i.min+e.min,n.max=n.min+au(e)}function Jke(n,e,i){IY(n.x,e.x,i.x),IY(n.y,e.y,i.y)}function AY(n,e,i){n.min=e.min-i.min,n.max=n.min+au(e)}function xC(n,e,i){AY(n.x,e.x,i.x),AY(n.y,e.y,i.y)}function Qke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?ks(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?ks(i,n,o.max):Math.min(n,i)),n}function PY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function Zke(n,{top:e,left:i,bottom:o,right:l}){return{x:PY(n.x,i,l),y:PY(n.y,e,o)}}function kY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function eOe(n,e){return{x:kY(n.x,e.x),y:kY(n.y,e.y)}}function tOe(n,e){let i=.5;const o=au(n),l=au(e);return l>o?i=b0(e.min,e.max-o,n.min):o>l&&(i=b0(n.min,n.max-l,e.min)),Gf(0,1,i)}function nOe(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const WV=.35;function rOe(n=WV){return n===!1?n=0:n===!0&&(n=WV),{x:OY(n,"left","right"),y:OY(n,"top","bottom")}}function OY(n,e,i){return{min:NY(n,e),max:NY(n,i)}}function NY(n,e){return typeof n=="number"?n:n[e]||0}const xY=()=>({translate:0,scale:1,origin:0,originPoint:0}),$S=()=>({x:xY(),y:xY()}),DY=()=>({min:0,max:0}),oo=()=>({x:DY(),y:DY()});function Qu(n){return[n("x"),n("y")]}function dne({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function iOe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function sOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function RU(n){return n===void 0||n===1}function GV({scale:n,scaleX:e,scaleY:i}){return!RU(n)||!RU(e)||!RU(i)}function Ry(n){return GV(n)||hne(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function hne(n){return LY(n.x)||LY(n.y)}function LY(n){return n&&n!=="0%"}function hO(n,e,i){const o=n-i,l=e*o;return i+l}function MY(n,e,i,o,l){return l!==void 0&&(n=hO(n,l,o)),hO(n,i,o)+e}function HV(n,e=0,i=1,o,l){n.min=MY(n.min,e,i,o,l),n.max=MY(n.max,e,i,o,l)}function pne(n,{x:e,y:i}){HV(n.x,e.translate,e.scale,e.originPoint),HV(n.y,i.translate,i.scale,i.originPoint)}const UY=.999999999999,VY=1.0000000000001;function oOe(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,p;for(let y=0;y<l;y++){u=i[y],p=u.projectionDelta;const{visualElement:v}=u.options;v&&v.props.style&&v.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&qS(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,pne(n,p)),o&&Ry(u.latestValues)&&qS(n,u.latestValues))}e.x<VY&&e.x>UY&&(e.x=1),e.y<VY&&e.y>UY&&(e.y=1)}function KS(n,e){n.min=n.min+e,n.max=n.max+e}function FY(n,e,i,o,l=.5){const u=ks(n.min,n.max,l);HV(n,e,i,u,o)}function qS(n,e){FY(n.x,e.x,e.scaleX,e.scale,e.originX),FY(n.y,e.y,e.scaleY,e.scale,e.originY)}function fne(n,e){return dne(sOe(n.getBoundingClientRect(),e))}function aOe(n,e,i){const o=fne(n,i),{scroll:l}=e;return l&&(KS(o.x,l.offset.x),KS(o.y,l.offset.y)),o}const mne=({current:n})=>n?n.ownerDocument.defaultView:null,cOe=new WeakMap;class lOe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=oo(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:R}=this.getProps();R?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(xR(C).point)},u=(C,R)=>{const{drag:N,dragPropagation:M,onDragStart:D}=this.getProps();if(N&&!M&&(this.openDragLock&&this.openDragLock(),this.openDragLock=t1e(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Qu(z=>{let q=this.getAxisMotionValue(z).get()||0;if(Ap.test(q)){const{projection:K}=this.visualElement;if(K&&K.layout){const re=K.layout.layoutBox[z];re&&(q=au(re)*(parseFloat(q)/100))}}this.originPoint[z]=q}),D&&ls.postRender(()=>D(C,R)),LV(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},p=(C,R)=>{const{dragPropagation:N,dragDirectionLock:M,onDirectionLock:D,onDrag:F}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:z}=R;if(M&&this.currentDirection===null){this.currentDirection=uOe(z),this.currentDirection!==null&&D&&D(this.currentDirection);return}this.updateAxis("x",R.point,z),this.updateAxis("y",R.point,z),this.visualElement.render(),F&&F(C,R)},y=(C,R)=>this.stop(C,R),v=()=>Qu(C=>{var R;return this.getAnimationState(C)==="paused"&&((R=this.getAxisMotionValue(C).animation)===null||R===void 0?void 0:R.play())}),{dragSnapToOrigin:w}=this.getProps();this.panSession=new ane(e,{onSessionStart:l,onStart:u,onMove:p,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:w,contextWindow:mne(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&ls.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!J1(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let p=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(p=Qke(p,this.constraints[e],this.elastic[e])),u.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&GS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=Zke(l.layoutBox,i):this.constraints=!1,this.elastic=rOe(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Qu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=nOe(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!GS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=aOe(o,l.root,this.visualElement.getTransformPagePoint());let p=eOe(l.layout.layoutBox,u);if(i){const y=i(iOe(p));this.hasMutatedConstraints=!!y,y&&(p=dne(y))}return p}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:p,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},w=Qu(C=>{if(!J1(C,i,this.currentDirection))return;let R=v&&v[C]||{};p&&(R={min:0,max:0});const N=l?200:1e6,M=l?40:1e7,D={type:"inertia",velocity:o?e[C]:0,bounceStiffness:N,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...u,...R};return this.startAxisValueAnimation(C,D)});return Promise.all(w).then(y)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return LV(this.visualElement,e),o.start(Zj(e,o,0,i,this.visualElement,!1))}stopAnimation(){Qu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Qu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Qu(i=>{const{drag:o}=this.getProps();if(!J1(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:y}=l.layout.layoutBox[i];u.set(e[i]-ks(p,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!GS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Qu(p=>{const y=this.getAxisMotionValue(p);if(y&&this.constraints!==!1){const v=y.get();l[p]=tOe({min:v,max:v},this.constraints[p])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Qu(p=>{if(!J1(p,e,null))return;const y=this.getAxisMotionValue(p),{min:v,max:w}=this.constraints[p];y.set(ks(v,w,l[p]))})}addListeners(){if(!this.visualElement.current)return;cOe.set(this.visualElement,this);const e=this.visualElement.current,i=OC(e,"pointerdown",v=>{const{drag:w,dragListener:C=!0}=this.getProps();w&&C&&this.start(v)}),o=()=>{const{dragConstraints:v}=this.getProps();GS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ls.read(o);const p=iR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(Qu(C=>{const R=this.getAxisMotionValue(C);R&&(this.originPoint[C]+=v[C].translate,R.set(R.get()+v[C].translate))}),this.visualElement.render())});return()=>{p(),i(),u(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:p=WV,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:p,dragMomentum:y}}}function J1(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function uOe(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class dOe extends Kg{constructor(e){super(e),this.removeGroupControls=su,this.removeListeners=su,this.controls=new lOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||su}unmount(){this.removeGroupControls(),this.removeListeners()}}const jY=n=>(e,i)=>{n&&ls.postRender(()=>n(e,i))};class hOe extends Kg{constructor(){super(...arguments),this.removePointerDownListener=su}onPointerDown(e){this.session=new ane(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:mne(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:jY(e),onStart:jY(i),onMove:o,onEnd:(u,p)=>{delete this.session,l&&ls.postRender(()=>l(u,p))}}}mount(){this.removePointerDownListener=OC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Dk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function BY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const HT={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if($n.test(n))n=parseFloat(n);else return n;const i=BY(n,e.target.x),o=BY(n,e.target.y);return`${i}% ${o}%`}},pOe={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Mg.parse(n);if(l.length>5)return o;const u=Mg.createTransformer(n),p=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,v=i.y.scale*e.y;l[0+p]/=y,l[1+p]/=v;const w=ks(y,v,.5);return typeof l[2+p]=="number"&&(l[2+p]/=w),typeof l[3+p]=="number"&&(l[3+p]/=w),u(l)}};class fOe extends O.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;DPe(mOe),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),Dk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,p=o.projection;return p&&(p.isPresent=u,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?p.promote():p.relegate()||ls.postRender(()=>{const y=p.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Aj.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function gne(n){const[e,i]=bj(),o=O.useContext(Ej);return S.jsx(fOe,{...n,layoutGroup:o,switchLayoutGroup:O.useContext(ote),isPresent:e,safeToRemove:i})}const mOe={borderRadius:{...HT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:HT,borderTopRightRadius:HT,borderBottomLeftRadius:HT,borderBottomRightRadius:HT,boxShadow:pOe};function gOe(n,e,i){const o=uc(n)?n:nR(n);return o.start(Zj("",o,e,i)),o.animation}function _Oe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const yOe=(n,e)=>n.depth-e.depth;class EOe{constructor(){this.children=[],this.isDirty=!1}add(e){zj(this.children,e),this.isDirty=!0}remove(e){Wj(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(yOe),this.isDirty=!1,this.children.forEach(e)}}function vOe(n,e){const i=Pp.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(Lg(o),n(u-e))};return ls.read(o,!0),()=>Lg(o)}const _ne=["TopLeft","TopRight","BottomLeft","BottomRight"],SOe=_ne.length,zY=n=>typeof n=="string"?parseFloat(n):n,WY=n=>typeof n=="number"||$n.test(n);function bOe(n,e,i,o,l,u){l?(n.opacity=ks(0,i.opacity!==void 0?i.opacity:1,wOe(o)),n.opacityExit=ks(e.opacity!==void 0?e.opacity:1,0,TOe(o))):u&&(n.opacity=ks(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let p=0;p<SOe;p++){const y=`border${_ne[p]}Radius`;let v=GY(e,y),w=GY(i,y);if(v===void 0&&w===void 0)continue;v||(v=0),w||(w=0),v===0||w===0||WY(v)===WY(w)?(n[y]=Math.max(ks(zY(v),zY(w),o),0),(Ap.test(w)||Ap.test(v))&&(n[y]+="%")):n[y]=w}(e.rotate||i.rotate)&&(n.rotate=ks(e.rotate||0,i.rotate||0,o))}function GY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const wOe=yne(0,.5,Mte),TOe=yne(.5,.95,su);function yne(n,e,i){return o=>o<n?0:o>e?1:i(b0(n,e,o))}function HY(n,e){n.min=e.min,n.max=e.max}function Yu(n,e){HY(n.x,e.x),HY(n.y,e.y)}function $Y(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function KY(n,e,i,o,l){return n-=e,n=hO(n,1/i,o),l!==void 0&&(n=hO(n,1/l,o)),n}function COe(n,e=0,i=1,o=.5,l,u=n,p=n){if(Ap.test(e)&&(e=parseFloat(e),e=ks(p.min,p.max,e/100)-p.min),typeof e!="number")return;let y=ks(u.min,u.max,o);n===u&&(y-=e),n.min=KY(n.min,e,i,y,l),n.max=KY(n.max,e,i,y,l)}function qY(n,e,[i,o,l],u,p){COe(n,e[i],e[o],e[l],e.scale,u,p)}const ROe=["x","scaleX","originX"],IOe=["y","scaleY","originY"];function YY(n,e,i,o){qY(n.x,e,ROe,i?i.x:void 0,o?o.x:void 0),qY(n.y,e,IOe,i?i.y:void 0,o?o.y:void 0)}function XY(n){return n.translate===0&&n.scale===1}function Ene(n){return XY(n.x)&&XY(n.y)}function JY(n,e){return n.min===e.min&&n.max===e.max}function AOe(n,e){return JY(n.x,e.x)&&JY(n.y,e.y)}function QY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function vne(n,e){return QY(n.x,e.x)&&QY(n.y,e.y)}function ZY(n){return au(n.x)/au(n.y)}function eX(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class POe{constructor(){this.members=[]}add(e){zj(this.members,e),e.scheduleRender()}remove(e){if(Wj(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function kOe(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||u||p)&&(o=`translate3d(${l}px, ${u}px, ${p}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:w,rotate:C,rotateX:R,rotateY:N,skewX:M,skewY:D}=i;w&&(o=`perspective(${w}px) ${o}`),C&&(o+=`rotate(${C}deg) `),R&&(o+=`rotateX(${R}deg) `),N&&(o+=`rotateY(${N}deg) `),M&&(o+=`skewX(${M}deg) `),D&&(o+=`skewY(${D}deg) `)}const y=n.x.scale*e.x,v=n.y.scale*e.y;return(y!==1||v!==1)&&(o+=`scale(${y}, ${v})`),o||"none"}const Iy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},pC=typeof window<"u"&&window.MotionDebug!==void 0,IU=["","X","Y","Z"],OOe={visibility:"hidden"},tX=1e3;let NOe=0;function AU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function Sne(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Pte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",ls,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&Sne(o)}function bne({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(p={},y=e==null?void 0:e()){this.id=NOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,pC&&(Iy.totalNodes=Iy.resolvedTargetDeltas=Iy.recalculatedProjection=0),this.nodes.forEach(LOe),this.nodes.forEach(jOe),this.nodes.forEach(BOe),this.nodes.forEach(MOe),pC&&window.MotionDebug.record(Iy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new EOe)}addEventListener(p,y){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new Gj),this.eventHandlers.get(p).add(y)}notifyListeners(p,...y){const v=this.eventHandlers.get(p);v&&v.notify(...y)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=_Oe(p),this.instance=p;const{layoutId:v,layout:w,visualElement:C}=this.options;if(C&&!C.current&&C.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(w||v)&&(this.isLayoutDirty=!0),n){let R;const N=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,R&&R(),R=vOe(N,250),Dk.hasAnimatedSinceResize&&(Dk.hasAnimatedSinceResize=!1,this.nodes.forEach(rX))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&C&&(v||w)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:N,hasRelativeTargetChanged:M,layout:D})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||C.getDefaultTransition()||$Oe,{onLayoutAnimationStart:z,onLayoutAnimationComplete:q}=C.getProps(),K=!this.targetLayout||!vne(this.targetLayout,D)||M,re=!N&&M;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(R,re);const ce={...Vj(F,"layout"),onPlay:z,onComplete:q};(C.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else N||rX(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=D})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Lg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(zOe),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Sne(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const R=this.path[C];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(nX);return}this.isUpdating||this.nodes.forEach(VOe),this.isUpdating=!1,this.nodes.forEach(FOe),this.nodes.forEach(xOe),this.nodes.forEach(DOe),this.clearAllSnapshots();const y=Pp.now();Na.delta=Gf(0,1e3/60,y-Na.timestamp),Na.timestamp=y,Na.isProcessing=!0,EU.update.process(Na),EU.preRender.process(Na),EU.render.process(Na),Na.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Aj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(UOe),this.sharedNodes.forEach(WOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ls.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ls.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=oo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(y=!1),y){const v=o(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!Ene(this.projectionDelta),v=this.getTransformTemplate(),w=v?v(this.latestValues,""):void 0,C=w!==this.prevTransformTemplateValue;p&&(y||Ry(this.latestValues)||C)&&(l(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return p&&(v=this.removeTransform(v)),KOe(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:y}=this.options;if(!y)return oo();const v=y.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(qOe))){const{scroll:C}=this.root;C&&(KS(v.x,C.offset.x),KS(v.y,C.offset.y))}return v}removeElementScroll(p){var y;const v=oo();if(Yu(v,p),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let w=0;w<this.path.length;w++){const C=this.path[w],{scroll:R,options:N}=C;C!==this.root&&R&&N.layoutScroll&&(R.wasRoot&&Yu(v,p),KS(v.x,R.offset.x),KS(v.y,R.offset.y))}return v}applyTransform(p,y=!1){const v=oo();Yu(v,p);for(let w=0;w<this.path.length;w++){const C=this.path[w];!y&&C.options.layoutScroll&&C.scroll&&C!==C.root&&qS(v,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Ry(C.latestValues)&&qS(v,C.latestValues)}return Ry(this.latestValues)&&qS(v,this.latestValues),v}removeTransform(p){const y=oo();Yu(y,p);for(let v=0;v<this.path.length;v++){const w=this.path[v];if(!w.instance||!Ry(w.latestValues))continue;GV(w.latestValues)&&w.updateSnapshot();const C=oo(),R=w.measurePageBox();Yu(C,R),YY(y,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,C)}return Ry(this.latestValues)&&YY(y,this.latestValues),y}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Na.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const w=!!this.resumingFrom||this!==v;if(!(p||w&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:N}=this.options;if(!(!this.layout||!(R||N))){if(this.resolvedRelativeTargetAt=Na.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=oo(),this.relativeTargetOrigin=oo(),xC(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=oo(),this.targetWithTransforms=oo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Jke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Yu(this.target,this.layout.layoutBox),pne(this.target,this.targetDelta)):Yu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=oo(),this.relativeTargetOrigin=oo(),xC(this.relativeTargetOrigin,this.target,M.target),Yu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}pC&&Iy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||GV(this.parent.latestValues)||hne(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let w=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(w=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(w=!1),this.resolvedRelativeTargetAt===Na.timestamp&&(w=!1),w)return;const{layout:C,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||R))return;Yu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,M=this.treeScale.y;oOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=oo());const{target:D}=y;if(!D){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():($Y(this.prevProjectionDelta.x,this.projectionDelta.x),$Y(this.prevProjectionDelta.y,this.projectionDelta.y)),NC(this.projectionDelta,this.layoutCorrected,D,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==M||!eX(this.projectionDelta.x,this.prevProjectionDelta.x)||!eX(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",D)),pC&&Iy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),p){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=$S(),this.projectionDelta=$S(),this.projectionDeltaWithTransform=$S()}setAnimationOrigin(p,y=!1){const v=this.snapshot,w=v?v.latestValues:{},C={...this.latestValues},R=$S();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const N=oo(),M=v?v.source:void 0,D=this.layout?this.layout.source:void 0,F=M!==D,z=this.getStack(),q=!z||z.members.length<=1,K=!!(F&&!q&&this.options.crossfade===!0&&!this.path.some(HOe));this.animationProgress=0;let re;this.mixTargetDelta=ce=>{const se=ce/1e3;iX(R.x,p.x,se),iX(R.y,p.y,se),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(xC(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),GOe(this.relativeTarget,this.relativeTargetOrigin,N,se),re&&AOe(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=oo()),Yu(re,this.relativeTarget)),F&&(this.animationValues=C,bOe(C,w,this.latestValues,se,K,q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Lg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ls.update(()=>{Dk.hasAnimatedSinceResize=!0,this.currentAnimation=gOe(0,tX,{...p,onUpdate:y=>{this.mixTargetDelta(y),p.onUpdate&&p.onUpdate(y)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(tX),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:y,target:v,layout:w,latestValues:C}=p;if(!(!y||!v||!w)){if(this!==p&&this.layout&&w&&wne(this.options.animationType,this.layout.layoutBox,w.layoutBox)){v=this.target||oo();const R=au(this.layout.layoutBox.x);v.x.min=p.target.x.min,v.x.max=v.x.min+R;const N=au(this.layout.layoutBox.y);v.y.min=p.target.y.min,v.y.max=v.y.min+N}Yu(y,v),qS(y,C),NC(this.projectionDeltaWithTransform,this.layoutCorrected,y,C)}}registerSharedNode(p,y){this.sharedNodes.has(p)||this.sharedNodes.set(p,new POe),this.sharedNodes.get(p).add(y);const w=y.options.initialPromotionConfig;y.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(y):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:y}=this.options;return y?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:y}=this.options;return y?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:y,preserveFollowOpacity:v}={}){const w=this.getStack();w&&w.promote(this,v),p&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let y=!1;const{latestValues:v}=p;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const w={};v.z&&AU("z",p,w,this.animationValues);for(let C=0;C<IU.length;C++)AU(`rotate${IU[C]}`,p,w,this.animationValues),AU(`skew${IU[C]}`,p,w,this.animationValues);p.render();for(const C in w)p.setStaticValue(C,w[C]),this.animationValues&&(this.animationValues[C]=w[C]);p.scheduleRender()}getProjectionStyles(p){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return OOe;const w={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,w.opacity="",w.pointerEvents=Nk(p==null?void 0:p.pointerEvents)||"",w.transform=C?C(this.latestValues,""):"none",w;const R=this.getLead();if(!this.projectionDelta||!this.layout||!R.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=Nk(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!Ry(this.latestValues)&&(F.transform=C?C({},""):"none",this.hasProjected=!1),F}const N=R.animationValues||R.latestValues;this.applyTransformsToTarget(),w.transform=kOe(this.projectionDeltaWithTransform,this.treeScale,N),C&&(w.transform=C(N,w.transform));const{x:M,y:D}=this.projectionDelta;w.transformOrigin=`${M.origin*100}% ${D.origin*100}% 0`,R.animationValues?w.opacity=R===this?(v=(y=N.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:w.opacity=R===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const F in aO){if(N[F]===void 0)continue;const{correct:z,applyTo:q}=aO[F],K=w.transform==="none"?N[F]:z(N[F],R);if(q){const re=q.length;for(let ce=0;ce<re;ce++)w[q[ce]]=K}else w[F]=K}return this.options.layoutId&&(w.pointerEvents=R===this?Nk(p==null?void 0:p.pointerEvents)||"":"none"),w}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var y;return(y=p.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(nX),this.root.sharedNodes.clear()}}}function xOe(n){n.updateLayout()}function DOe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,p=i.source!==n.layout.source;u==="size"?Qu(R=>{const N=p?i.measuredBox[R]:i.layoutBox[R],M=au(N);N.min=o[R].min,N.max=N.min+M}):wne(u,i.layoutBox,o)&&Qu(R=>{const N=p?i.measuredBox[R]:i.layoutBox[R],M=au(o[R]);N.max=N.min+M,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[R].max=n.relativeTarget[R].min+M)});const y=$S();NC(y,o,i.layoutBox);const v=$S();p?NC(v,n.applyTransform(l,!0),i.measuredBox):NC(v,o,i.layoutBox);const w=!Ene(y);let C=!1;if(!n.resumeFrom){const R=n.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:N,layout:M}=R;if(N&&M){const D=oo();xC(D,i.layoutBox,N.layoutBox);const F=oo();xC(F,o,M.layoutBox),vne(D,F)||(C=!0),R.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=D,n.relativeParent=R)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:w,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function LOe(n){pC&&Iy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function MOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function UOe(n){n.clearSnapshot()}function nX(n){n.clearMeasurements()}function VOe(n){n.isLayoutDirty=!1}function FOe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function rX(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function jOe(n){n.resolveTargetDelta()}function BOe(n){n.calcProjection()}function zOe(n){n.resetSkewAndRotation()}function WOe(n){n.removeLeadSnapshot()}function iX(n,e,i){n.translate=ks(e.translate,0,i),n.scale=ks(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function sX(n,e,i,o){n.min=ks(e.min,i.min,o),n.max=ks(e.max,i.max,o)}function GOe(n,e,i,o){sX(n.x,e.x,i.x,o),sX(n.y,e.y,i.y,o)}function HOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const $Oe={duration:.45,ease:[.4,0,.1,1]},oX=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),aX=oX("applewebkit/")&&!oX("chrome/")?Math.round:su;function cX(n){n.min=aX(n.min),n.max=aX(n.max)}function KOe(n){cX(n.x),cX(n.y)}function wne(n,e,i){return n==="position"||n==="preserve-aspect"&&!Xke(ZY(e),ZY(i),.2)}function qOe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const YOe=bne({attachResizeListener:(n,e)=>iR(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),PU={current:void 0},Tne=bne({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!PU.current){const n=new YOe({});n.mount(window),n.setOptions({layoutScroll:!0}),PU.current=n}return PU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),XOe={pan:{Feature:hOe},drag:{Feature:dOe,ProjectionNode:Tne,MeasureLayout:gne}};function lX(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&ls.postRender(()=>u(e,xR(e)))}class JOe extends Kg{mount(){const{current:e}=this.node;e&&(this.unmount=XPe(e,i=>(lX(this.node,i,"Start"),o=>lX(this.node,o,"End"))))}unmount(){}}class QOe extends Kg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=NR(iR(this.node.current,"focus",()=>this.onFocus()),iR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function uX(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&ls.postRender(()=>u(e,xR(e)))}class ZOe extends Kg{mount(){const{current:e}=this.node;e&&(this.unmount=e1e(e,i=>(uX(this.node,i,"Start"),(o,{success:l})=>uX(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const $V=new WeakMap,kU=new WeakMap,eNe=n=>{const e=$V.get(n.target);e&&e(n)},tNe=n=>{n.forEach(eNe)};function nNe({root:n,...e}){const i=n||document;kU.has(i)||kU.set(i,{});const o=kU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(tNe,{root:n,...e})),o[l]}function rNe(n,e,i){const o=nNe(e);return $V.set(n,i),o.observe(n),()=>{$V.delete(n),o.unobserve(n)}}const iNe={some:0,all:1};class sNe extends Kg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,p={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:iNe[l]},y=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:C,onViewportLeave:R}=this.node.getProps(),N=w?C:R;N&&N(v)};return rNe(this.node.current,p,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(oNe(e,i))&&this.startObserver()}unmount(){}}function oNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const aNe={inView:{Feature:sNe},tap:{Feature:ZOe},focus:{Feature:QOe},hover:{Feature:JOe}},cNe={layout:{ProjectionNode:Tne,MeasureLayout:gne}},KV={current:null},Cne={current:!1};function lNe(){if(Cne.current=!0,!!wj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>KV.current=n.matches;n.addListener(e),e()}else KV.current=!1}const uNe=[...Xte,ac,Mg],dNe=n=>uNe.find(Yte(n)),dX=new WeakMap;function hNe(n,e,i){for(const o in e){const l=e[o],u=i[o];if(uc(l))n.addValue(o,l);else if(uc(u))n.addValue(o,nR(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const p=n.getValue(o);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(o);n.addValue(o,nR(p!==void 0?p:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const hX=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class pNe{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:p},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Xj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=Pp.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,ls.render(this.render,!1,!0))};const{latestValues:v,renderState:w,onUpdate:C}=p;this.onUpdate=C,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=w,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!u,this.isControllingVariants=lN(i),this.isVariantNode=ite(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:R,...N}=this.scrapeMotionValuesFromProps(i,{},this);for(const M in N){const D=N[M];v[M]!==void 0&&uc(D)&&D.set(v[M],!1)}}mount(e){this.current=e,dX.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),Cne.current||lNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:KV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){dX.delete(this.current),this.projection&&this.projection.unmount(),Lg(this.notifyUpdate),Lg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=lE.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&ls.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in w0){const i=w0[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):oo()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<hX.length;o++){const l=hX[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,p=e[u];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=hNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=nR(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Kte(l)||Vte(l))?l=parseFloat(l):!dNe(l)&&Mg.test(i)&&(l=Gte(e,i)),this.setBaseTarget(e,uc(l)?l.get():l)),uc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const p=kj(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!uc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Gj),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Rne extends pNe{constructor(){super(...arguments),this.KeyframeResolver=Jte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;uc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function fNe(n){return window.getComputedStyle(n)}class mNe extends Rne{constructor(){super(...arguments),this.type="html",this.renderInstance=pte}readValueFromInstance(e,i){if(lE.has(i)){const o=Yj(i);return o&&o.default||0}else{const o=fNe(e),l=(ute(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return fne(e,i)}build(e,i,o){xj(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return Uj(e,i,o)}}class gNe extends Rne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=oo}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(lE.has(i)){const o=Yj(i);return o&&o.default||0}return i=fte.has(i)?i:Ij(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return _te(e,i,o)}build(e,i,o){Dj(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){mte(e,i,o,l)}mount(e){this.isSVGTag=Mj(e.tagName),super.mount(e)}}const _Ne=(n,e)=>Pj(n)?new gNe(e):new mNe(e,{allowProjection:n!==O.Fragment}),yNe=WPe({...Bke,...aNe,...XOe,...cNe},_Ne),Up=iPe(yNe),ENe=(n,e)=>n.find(i=>i.id===e);function pX(n,e){const i=Ine(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function Ine(n,e){for(const[i,o]of Object.entries(n))if(ENe(o,e))return i}function vNe(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function SNe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:p}}var bNe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,wNe=Wee(function(n){return bNe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),TNe=wNe,CNe=function(e){return e!=="theme"},fX=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?TNe:CNe},mX=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(p){return e.__emotion_forwardProp(p)&&u(p)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},RNe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return dj(i,o,l),qee(function(){return hj(i,o,l)}),null},INe=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,p;i!==void 0&&(u=i.label,p=i.target);var y=mX(e,i,o),v=y||fX(l),w=!v("as");return function(){var C=arguments,R=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&R.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)R.push.apply(R,C);else{var N=C[0];R.push(N[0]);for(var M=C.length,D=1;D<M;D++)R.push(C[D],N[D])}var F=fj(function(z,q,K){var re=w&&z.as||l,ce="",se=[],ge=z;if(z.theme==null){ge={};for(var X in z)ge[X]=z[X];ge.theme=O.useContext(S0)}typeof z.className=="string"?ce=Hee(q.registered,se,z.className):z.className!=null&&(ce=z.className+" ");var J=iN(R.concat(se),q.registered,ge);ce+=q.key+"-"+J.name,p!==void 0&&(ce+=" "+p);var te=w&&y===void 0?fX(re):v,ne={};for(var de in z)w&&de==="as"||te(de)&&(ne[de]=z[de]);return ne.className=ce,K&&(ne.ref=K),O.createElement(O.Fragment,null,O.createElement(RNe,{cache:q,serialized:J,isStringTag:typeof re=="string"}),O.createElement(re,ne))});return F.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=e.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=R,F.__emotion_forwardProp=y,Object.defineProperty(F,"toString",{value:function(){return"."+p}}),F.withComponent=function(z,q){var K=n(z,Jy({},i,q,{shouldForwardProp:mX(F,q,!0)}));return K.apply(void 0,R)},F}},ANe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],qV=INe.bind(null);ANe.forEach(function(n){qV[n]=qV(n)});const PNe=new Set([...YSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),kNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function ONe(n){return(kNe.has(n)||!PNe.has(n))&&n[0]!=="_"}const NNe=wve(qV),xNe=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...p}=e,[y]=kve(p,JSe),v=gl(n,e),w=lve({},l,v,YO(y),u),C=bee(w)(e.theme);return o?[C,o]:C};function OU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=ONe);const l=xNe({baseStyle:i}),u=NNe(n,o)(l);return O.forwardRef(function(v,w){const{children:C,...R}=v,{colorMode:N,forced:M}=oN(),D=M?N:void 0;return O.createElement(u,{ref:w,"data-theme":D,...R},C)})}function DNe(){const n=new Map;return new Proxy(OU,{apply(e,i,o){return OU(...o)},get(e,i){return n.has(i)||n.set(i,OU(i)),n.get(i)}})}const Mt=DNe(),LNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Ane=O.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:p="bottom",duration:y=5e3,containerStyle:v,motionVariants:w=LNe,toastSpacing:C="0.5rem"}=n,[R,N]=O.useState(y),M=YAe();zf(()=>{M||o==null||o()},[M]),zf(()=>{N(y)},[y]);const D=()=>N(null),F=()=>N(y),z=()=>{M&&l()};O.useEffect(()=>{M&&u&&l()},[M,u,l]),Zve(z,R);const q=O.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...v}),[v,C]),K=O.useMemo(()=>vNe(p),[p]);return S.jsx(Up.div,{layout:!0,className:"chakra-toast",variants:w,initial:"initial",animate:"animate",exit:"exit",onHoverStart:D,onHoverEnd:F,custom:{position:p},style:K,children:S.jsx(Mt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:q,children:gl(i,{id:e,onClose:z})})})});Ane.displayName="ToastComponent";function Bt(n){return O.forwardRef(n)}var NU,gX;function MNe(){if(gX)return NU;gX=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,p){if(u===p)return!0;if(u&&p&&typeof u=="object"&&typeof p=="object"){if(u.constructor!==p.constructor)return!1;var y,v,w;if(Array.isArray(u)){if(y=u.length,y!=p.length)return!1;for(v=y;v--!==0;)if(!l(u[v],p[v]))return!1;return!0}var C;if(e&&u instanceof Map&&p instanceof Map){if(u.size!==p.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!p.has(v.value[0]))return!1;for(C=u.entries();!(v=C.next()).done;)if(!l(v.value[1],p.get(v.value[0])))return!1;return!0}if(i&&u instanceof Set&&p instanceof Set){if(u.size!==p.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!p.has(v.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(p)){if(y=u.length,y!=p.length)return!1;for(v=y;v--!==0;)if(u[v]!==p[v])return!1;return!0}if(u.constructor===RegExp)return u.source===p.source&&u.flags===p.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof p.valueOf=="function")return u.valueOf()===p.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof p.toString=="function")return u.toString()===p.toString();if(w=Object.keys(u),y=w.length,y!==Object.keys(p).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(p,w[v]))return!1;if(n&&u instanceof Element)return!1;for(v=y;v--!==0;)if(!((w[v]==="_owner"||w[v]==="__v"||w[v]==="__o")&&u.$$typeof)&&!l(u[w[v]],p[w[v]]))return!1;return!0}return u!==u&&p!==p}return NU=function(p,y){try{return l(p,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},NU}var UNe=MNe();const VNe=$g(UNe);function X0(){const n=O.useContext(S0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Pne(){const n=oN(),e=X0();return{...n,theme:e}}function FNe(n,e,i){if(e==null)return e;const o=l=>{var u,p;return(p=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:p.value};return o(e)??o(i)??i}function jNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const p=l.filter(Boolean),y=o.map((v,w)=>{const C=`${n}.${v}`;return FNe(u,C,p[w]??v)});return Array.isArray(e)?y:y[0]}}function kne(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=Pne(),p=n?iee(l,`components.${n}`):void 0,y=i||p,v=Sp({theme:l,colorMode:u},(y==null?void 0:y.defaultProps)??{},YO(H0(o,["children"])),(C,R)=>C?void 0:R),w=O.useRef({});if(y){const R=c0e(y)(v);VNe(w.current,R)||(w.current=R)}return w.current}function lu(n,e={}){return kne(n,e)}function Fa(n,e={}){return kne(n,e)}const _X={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},yn=Bt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:p,className:y,__css:v,...w}=n,C=En("chakra-icon",y),R=lu("Icon",n),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...R},M={ref:e,focusable:u,className:C,__css:N},D=o??_X.viewBox;if(i&&typeof i!="string")return S.jsx(Mt.svg,{as:i,...M,...w});const F=p??_X.path;return S.jsx(Mt.svg,{verticalAlign:"middle",viewBox:D,...M,...w,children:F})});yn.displayName="Icon";function BNe(n){return S.jsx(yn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function zNe(n){return S.jsx(yn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function yX(n){return S.jsx(yn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const WNe=AR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),cd=Bt((n,e)=>{const i=lu("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:p="transparent",className:y,...v}=Bi(n),w=En("chakra-spinner",y),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${WNe} ${u} linear infinite`,...i};return S.jsx(Mt.div,{ref:e,__css:C,className:w,...v,children:o&&S.jsx(Mt.span,{srOnly:!0,children:o})})});cd.displayName="Spinner";const[GNe,e5]=ki({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[HNe,t5]=ki({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),One={info:{icon:zNe,colorScheme:"blue"},warning:{icon:yX,colorScheme:"orange"},success:{icon:BNe,colorScheme:"green"},error:{icon:yX,colorScheme:"red"},loading:{icon:cd,colorScheme:"blue"}};function $Ne(n){return One[n].colorScheme}function KNe(n){return One[n].icon}const Ig=Bt(function(e,i){const{status:o="info",addRole:l=!0,...u}=Bi(e),p=e.colorScheme??$Ne(o),y=Fa("Alert",{...e,colorScheme:p}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return S.jsx(GNe,{value:{status:o},children:S.jsx(HNe,{value:y,children:S.jsx(Mt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:En("chakra-alert",e.className),__css:v})})})});Ig.displayName="Alert";function Ag(n){const{status:e}=e5(),i=KNe(e),o=t5(),l=e==="loading"?o.spinner:o.icon;return S.jsx(Mt.span,{display:"inherit","data-status":e,...n,className:En("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}Ag.displayName="AlertIcon";const DC=Bt(function(e,i){const o=t5(),{status:l}=e5();return S.jsx(Mt.div,{ref:i,"data-status":l,...e,className:En("chakra-alert__title",e.className),__css:o.title})});DC.displayName="AlertTitle";const LC=Bt(function(e,i){const{status:o}=e5(),l=t5(),u={display:"inline",...l.description};return S.jsx(Mt.div,{ref:i,"data-status":o,...e,className:En("chakra-alert__desc",e.className),__css:u})});LC.displayName="AlertDescription";function qNe(n){return S.jsx(yn,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const n5=Bt(function(e,i){const o=lu("CloseButton",e),{children:l,isDisabled:u,__css:p,...y}=Bi(e),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(Mt.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...v,...o,...p},...y,children:l||S.jsx(qNe,{width:"1em",height:"1em"})})});n5.displayName="CloseButton";const YNe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:p,description:y,colorScheme:v,icon:w}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return S.jsxs(Ig,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[S.jsx(Ag,{children:w}),S.jsxs(Mt.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(DC,{id:C==null?void 0:C.title,children:l}),y&&S.jsx(LC,{id:C==null?void 0:C.description,display:"block",children:y})]}),u&&S.jsx(n5,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Nne(n={}){const{render:e,toastComponent:i=YNe}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const XNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},_p=JNe(XNe);function JNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(p=>({...p,[u]:p[u].filter(y=>y.id!=l)}))},notify:(l,u)=>{const p=QNe(l,u),{position:y,id:v}=p;return o(w=>{const R=y.includes("top")?[p,...w[y]??[]]:[...w[y]??[],p];return{...w,[y]:R}}),v},update:(l,u)=>{l&&o(p=>{const y={...p},{position:v,index:w}=pX(y,l);return v&&w!==-1&&(y[v][w]={...y[v][w],...u,message:Nne(u)}),y})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,w)=>(v[w]=u[w].map(C=>({...C,requestClose:!0})),v),{...u}))},close:l=>{o(u=>{const p=Ine(u,l);return p?{...u,[p]:u[p].map(y=>y.id==l?{...y,requestClose:!0}:y)}:u})},isActive:l=>!!pX(_p.getState(),l).position}}let EX=0;function QNe(n,e={}){EX+=1;const i=e.id??EX,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>_p.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var xne=YZ();const[Dne,ZNe]=ki({strict:!1,name:"PortalContext"}),r5="chakra-portal",exe=".chakra-portal",txe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),nxe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=O.useState(null),u=O.useRef(null),[,p]=O.useState({});O.useEffect(()=>p({}),[]);const y=ZNe(),v=zAe();Cp(()=>{if(!o)return;const C=o.ownerDocument,R=e?y??C.body:C.body;if(!R)return;u.current=C.createElement("div"),u.current.className=r5,R.appendChild(u.current),p({});const N=u.current;return()=>{R.contains(N)&&R.removeChild(N)}},[o]);const w=v!=null&&v.zIndex?S.jsx(txe,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return u.current?xne.createPortal(S.jsx(Dne,{value:u.current,children:w}),u.current):S.jsx("span",{ref:C=>{C&&l(C)}})},rxe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),p=O.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=r5),v},[l]),[,y]=O.useState({});return Cp(()=>y({}),[]),Cp(()=>{if(!(!p||!u))return u.appendChild(p),()=>{u.removeChild(p)}},[p,u]),u&&p?xne.createPortal(S.jsx(Dne,{value:o?p:null,children:e}),p):null};function Mc(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?S.jsx(rxe,{containerRef:i,...o}):S.jsx(nxe,{...o})}Mc.className=r5;Mc.selector=exe;Mc.displayName="Portal";const[ixe,sxe]=ki({name:"ToastOptionsContext",strict:!1}),oxe=n=>{const e=O.useSyncExternalStore(_p.subscribe,_p.getState,_p.getState),{motionVariants:i,component:o=Ane,portalProps:l,animatePresenceProps:u}=n,y=Object.keys(e).map(v=>{const w=e[v];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:SNe(v),children:S.jsx(K0,{...u,initial:!1,children:w.map(C=>S.jsx(o,{motionVariants:i,...C},C.id))})},v)});return S.jsx(Mc,{...l,children:y})},axe=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return S.jsxs(GAe,{theme:o,...u,children:[S.jsx(ixe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(oxe,{...l})]})},hN=axe(DIe);function vX(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const cxe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function SX(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function bX(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const xU=typeof window<"u"?O.useLayoutEffect:O.useEffect,wX=n=>n;var lxe=Object.defineProperty,uxe=(n,e,i)=>e in n?lxe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Ws=(n,e,i)=>(uxe(n,typeof e!="symbol"?e+"":e,i),i);class dxe{constructor(){Ws(this,"descendants",new Map),Ws(this,"register",e=>{if(e!=null)return cxe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Ws(this,"unregister",e=>{this.descendants.delete(e);const i=vX(Array.from(this.descendants.keys()));this.assignIndex(i)}),Ws(this,"destroy",()=>{this.descendants.clear()}),Ws(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),Ws(this,"count",()=>this.descendants.size),Ws(this,"enabledCount",()=>this.enabledValues().length),Ws(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),Ws(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Ws(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Ws(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Ws(this,"first",()=>this.item(0)),Ws(this,"firstEnabled",()=>this.enabledItem(0)),Ws(this,"last",()=>this.item(this.descendants.size-1)),Ws(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Ws(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Ws(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Ws(this,"next",(e,i=!0)=>{const o=SX(e,this.count(),i);return this.item(o)}),Ws(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=SX(l,this.enabledCount(),i);return this.enabledItem(u)}),Ws(this,"prev",(e,i=!0)=>{const o=bX(e,this.count()-1,i);return this.item(o)}),Ws(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=bX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),Ws(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=vX(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function Lne(){const[n,e]=ki({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=O.useRef(new dxe);return xU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[p,y]=O.useState(-1),v=O.useRef(null);xU(()=>()=>{v.current&&u.unregister(v.current)},[]),xU(()=>{if(!v.current)return;const C=Number(v.current.dataset.index);p!=C&&!Number.isNaN(C)&&y(C)});const w=wX(l?u.register(l):u.register);return{descendants:u,index:p,enabledIndex:u.enabledIndexOf(v.current),register:Ki(w,v)}}]}const TX={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Wy={enter:{duration:.2,ease:TX.easeOut},exit:{duration:.1,ease:TX.easeIn}},Gy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},Mne=Bt(function(n,e){const{ratio:i=4/3,children:o,className:l,...u}=n,p=O.Children.only(o),y=En("chakra-aspect-ratio",l);return S.jsx(Mt.div,{ref:e,position:"relative",className:y,_before:{height:0,content:'""',display:"block",paddingBottom:XO(i,v=>`${1/v*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...u,children:p})});Mne.displayName="AspectRatio";const[hxe,pxe]=ki({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function fxe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function Une(n){const{name:e,getInitials:i,...o}=n,l=pxe();return S.jsx(Mt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}Une.displayName="AvatarName";const Vne=n=>S.jsxs(Mt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Fne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:p,sizes:y,ignoreFallback:v}=n,[w,C]=O.useState("pending");O.useEffect(()=>{C(i?"loading":"pending")},[i]);const R=O.useRef(null),N=O.useCallback(()=>{if(!i)return;M();const D=new Image;D.src=i,p&&(D.crossOrigin=p),o&&(D.srcset=o),y&&(D.sizes=y),e&&(D.loading=e),D.onload=F=>{M(),C("loaded"),l==null||l(F)},D.onerror=F=>{M(),C("failed"),u==null||u(F)},R.current=D},[i,p,o,y,l,u,e]),M=()=>{R.current&&(R.current.onload=null,R.current.onerror=null,R.current=null)};return Cp(()=>{if(!v)return w==="loading"&&N(),()=>{M()}},[w,N,v]),v?"loaded":w}const mxe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function jne(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:p,borderRadius:y,loading:v,iconLabel:w,icon:C=S.jsx(Vne,{}),ignoreFallback:R,referrerPolicy:N,crossOrigin:M}=n,F=Fne({src:e,onError:o,crossOrigin:M,ignoreFallback:R})==="loaded";return!e||!F?p?S.jsx(Une,{className:"chakra-avatar__initials",getInitials:u,name:p}):O.cloneElement(C,{role:"img","aria-label":w}):S.jsx(Mt.img,{src:e,srcSet:i,alt:p??w,onLoad:l,referrerPolicy:N,crossOrigin:M??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}jne.displayName="AvatarImage";const gxe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},yl=Bt((n,e)=>{const i=Fa("Avatar",n),[o,l]=O.useState(!1),{src:u,srcSet:p,name:y,showBorder:v,borderRadius:w="full",onError:C,onLoad:R,getInitials:N=fxe,icon:M=S.jsx(Vne,{}),iconLabel:D=" avatar",loading:F,children:z,borderColor:q,ignoreFallback:K,crossOrigin:re,referrerPolicy:ce,...se}=Bi(n),ge={borderRadius:w,borderWidth:v?"2px":void 0,...gxe,...i.container};return q&&(ge.borderColor=q),S.jsx(Mt.span,{ref:e,...se,className:En("chakra-avatar",n.className),"data-loaded":lr(o),__css:ge,children:S.jsxs(hxe,{value:i,children:[S.jsx(jne,{src:u,srcSet:p,loading:F,onLoad:Mn(R,()=>{l(!0)}),onError:C,getInitials:N,name:y,borderRadius:w,icon:M,iconLabel:D,ignoreFallback:K,crossOrigin:re,referrerPolicy:ce}),z]})})});yl.displayName="Avatar";const ih=Bt(function(e,i){const o=lu("Badge",e),{className:l,...u}=Bi(e);return S.jsx(Mt.span,{ref:i,className:En("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});ih.displayName="Badge";const st=Mt("div");st.displayName="Box";const[OHe,_xe]=ki({strict:!1,name:"ButtonGroupContext"});function fC(n){const{children:e,className:i,...o}=n,l=O.isValidElement(e)?O.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=En("chakra-button__icon",i);return S.jsx(Mt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}fC.displayName="ButtonIcon";function YV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=S.jsx(cd,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:p,...y}=n,v=En("chakra-button__spinner",u),w=i==="start"?"marginEnd":"marginStart",C=O.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[w]:e?o:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,w,o]);return S.jsx(Mt.div,{className:v,...y,__css:C,children:l})}YV.displayName="ButtonSpinner";function yxe(n){const[e,i]=O.useState(!n);return{ref:O.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const In=Bt((n,e)=>{const i=_xe(),o=lu("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:p,children:y,leftIcon:v,rightIcon:w,loadingText:C,iconSpacing:R="0.5rem",type:N,spinner:M,spinnerPlacement:D="start",className:F,as:z,shouldWrapChildren:q,...K}=Bi(n),re=O.useMemo(()=>{const X={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:X}}},[o,i]),{ref:ce,type:se}=yxe(z),ge={rightIcon:w,leftIcon:v,iconSpacing:R,children:y,shouldWrapChildren:q};return S.jsxs(Mt.button,{disabled:l||u,ref:Qve(e,ce),as:z,type:N??se,"data-active":lr(p),"data-loading":lr(u),__css:re,className:En("chakra-button",F),...K,children:[u&&D==="start"&&S.jsx(YV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:R,children:M}),u?C||S.jsx(Mt.span,{opacity:0,children:S.jsx(CX,{...ge})}):S.jsx(CX,{...ge}),u&&D==="end"&&S.jsx(YV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:R,children:M})]})});In.displayName="Button";function CX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(fC,{marginEnd:l,children:e}),o,i&&S.jsx(fC,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(fC,{marginEnd:l,children:e}),o,i&&S.jsx(fC,{marginStart:l,children:i})]})}const xc=Bt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...p}=n,y=i||o,v=O.isValidElement(y)?O.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return S.jsx(In,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...p,children:v})});xc.displayName="IconButton";const Bne=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Bne.displayName="Center";const Exe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:o="both",...l}=e;return S.jsx(Mt.div,{ref:i,__css:Exe[o],...l,position:"absolute"})});var vxe=()=>typeof document<"u",RX=!1,DR=null,Qy=!1,XV=!1,JV=new Set;function i5(n,e){JV.forEach(i=>i(n,e))}var Sxe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function bxe(n){return!(n.metaKey||!Sxe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function IX(n){Qy=!0,bxe(n)&&(DR="keyboard",i5("keyboard",n))}function CS(n){if(DR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Qy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;i5("pointer",n)}}function wxe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function Txe(n){wxe(n)&&(Qy=!0,DR="virtual")}function Cxe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Qy&&!XV&&(DR="virtual",i5("virtual",n)),Qy=!1,XV=!1)}function Rxe(){Qy=!1,XV=!0}function AX(){return DR!=="pointer"}function Ixe(){if(!vxe()||RX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Qy=!0,n.apply(this,i)},document.addEventListener("keydown",IX,!0),document.addEventListener("keyup",IX,!0),document.addEventListener("click",Txe,!0),window.addEventListener("focus",Cxe,!0),window.addEventListener("blur",Rxe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",CS,!0),document.addEventListener("pointermove",CS,!0),document.addEventListener("pointerup",CS,!0)):(document.addEventListener("mousedown",CS,!0),document.addEventListener("mousemove",CS,!0),document.addEventListener("mouseup",CS,!0)),RX=!0}function Axe(n){Ixe(),n(AX());const e=()=>n(AX());return JV.add(e),()=>{JV.delete(e)}}const[Pxe,zne]=ki({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[kxe,J0]=ki({strict:!1,name:"FormControlContext"});function Oxe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...p}=n,y=O.useId(),v=e||`field-${y}`,w=`${v}-label`,C=`${v}-feedback`,R=`${v}-helptext`,[N,M]=O.useState(!1),[D,F]=O.useState(!1),[z,q]=O.useState(!1),K=O.useCallback((X={},J=null)=>({id:R,...X,ref:Ki(J,te=>{te&&F(!0)})}),[R]),re=O.useCallback((X={},J=null)=>({...X,ref:J,"data-focus":lr(z),"data-disabled":lr(l),"data-invalid":lr(o),"data-readonly":lr(u),id:X.id!==void 0?X.id:w,htmlFor:X.htmlFor!==void 0?X.htmlFor:v}),[v,l,z,o,u,w]),ce=O.useCallback((X={},J=null)=>({id:C,...X,ref:Ki(J,te=>{te&&M(!0)}),"aria-live":"polite"}),[C]),se=O.useCallback((X={},J=null)=>({...X,...p,ref:J,role:"group","data-focus":lr(z),"data-disabled":lr(l),"data-invalid":lr(o),"data-readonly":lr(u)}),[p,l,z,o,u]),ge=O.useCallback((X={},J=null)=>({...X,ref:J,role:"presentation","aria-hidden":!0,children:X.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!z,onFocus:()=>q(!0),onBlur:()=>q(!1),hasFeedbackText:N,setHasFeedbackText:M,hasHelpText:D,setHasHelpText:F,id:v,labelId:w,feedbackId:C,helpTextId:R,htmlProps:p,getHelpTextProps:K,getErrorMessageProps:ce,getRootProps:se,getLabelProps:re,getRequiredIndicatorProps:ge}}const Sr=Bt(function(e,i){const o=Fa("Form",e),l=Bi(e),{getRootProps:u,htmlProps:p,...y}=Oxe(l),v=En("chakra-form-control",e.className);return S.jsx(kxe,{value:y,children:S.jsx(Pxe,{value:o,children:S.jsx(Mt.div,{...u({},i),className:v,__css:o.container})})})});Sr.displayName="FormControl";const Hy=Bt(function(e,i){const o=J0(),l=zne(),u=En("chakra-form__helper-text",e.className);return S.jsx(Mt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});Hy.displayName="FormHelperText";function s5(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=o5(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":Lf(i),"aria-required":Lf(l),"aria-readonly":Lf(o)}}function o5(n){const e=J0(),{id:i,disabled:o,readOnly:l,required:u,isRequired:p,isInvalid:y,isReadOnly:v,isDisabled:w,onFocus:C,onBlur:R,...N}=n,M=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&M.push(e.feedbackId),e!=null&&e.hasHelpText&&M.push(e.helpTextId),{...N,"aria-describedby":M.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??w??(e==null?void 0:e.isDisabled),isReadOnly:l??v??(e==null?void 0:e.isReadOnly),isRequired:u??p??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:Mn(e==null?void 0:e.onFocus,C),onBlur:Mn(e==null?void 0:e.onBlur,R)}}const Nxe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function xxe(n={}){const e=o5(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:p,onBlur:y,onFocus:v,"aria-describedby":w}=e,{defaultChecked:C,isChecked:R,isFocusable:N,onChange:M,isIndeterminate:D,name:F,value:z,tabIndex:q=void 0,"aria-label":K,"aria-labelledby":re,"aria-invalid":ce,...se}=n,ge=H0(se,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),X=uo(M),J=uo(y),te=uo(v),[ne,de]=O.useState(!1),[pe,he]=O.useState(!1),[ve,Te]=O.useState(!1),[Fe,be]=O.useState(!1);O.useEffect(()=>Axe(de),[]);const Re=O.useRef(null),[Ae,xe]=O.useState(!0),[Ee,Ne]=O.useState(!!C),je=R!==void 0,qe=je?R:Ee,at=O.useCallback(Ft=>{if(o||i){Ft.preventDefault();return}je||Ne(qe?Ft.currentTarget.checked:D?!0:Ft.currentTarget.checked),X==null||X(Ft)},[o,i,qe,je,D,X]);Cp(()=>{Re.current&&(Re.current.indeterminate=!!D)},[D]),zf(()=>{i&&he(!1)},[i,he]),Cp(()=>{const Ft=Re.current;if(!(Ft!=null&&Ft.form))return;const sn=()=>{Ne(!!C)};return Ft.form.addEventListener("reset",sn),()=>{var Ht;return(Ht=Ft.form)==null?void 0:Ht.removeEventListener("reset",sn)}},[]);const _t=i&&!N,ut=O.useCallback(Ft=>{Ft.key===" "&&be(!0)},[be]),vt=O.useCallback(Ft=>{Ft.key===" "&&be(!1)},[be]);Cp(()=>{if(!Re.current)return;Re.current.checked!==qe&&Ne(Re.current.checked)},[Re.current]);const it=O.useCallback((Ft={},sn=null)=>{const Ht=we=>{pe&&we.preventDefault(),be(!0)};return{...Ft,ref:sn,"data-active":lr(Fe),"data-hover":lr(ve),"data-checked":lr(qe),"data-focus":lr(pe),"data-focus-visible":lr(pe&&ne),"data-indeterminate":lr(D),"data-disabled":lr(i),"data-invalid":lr(u),"data-readonly":lr(o),"aria-hidden":!0,onMouseDown:Mn(Ft.onMouseDown,Ht),onMouseUp:Mn(Ft.onMouseUp,()=>be(!1)),onMouseEnter:Mn(Ft.onMouseEnter,()=>Te(!0)),onMouseLeave:Mn(Ft.onMouseLeave,()=>Te(!1))}},[Fe,qe,i,pe,ne,ve,D,u,o]),wt=O.useCallback((Ft={},sn=null)=>({...Ft,ref:sn,"data-active":lr(Fe),"data-hover":lr(ve),"data-checked":lr(qe),"data-focus":lr(pe),"data-focus-visible":lr(pe&&ne),"data-indeterminate":lr(D),"data-disabled":lr(i),"data-invalid":lr(u),"data-readonly":lr(o)}),[Fe,qe,i,pe,ne,ve,D,u,o]),$t=O.useCallback((Ft={},sn=null)=>({...ge,htmlFor:Ae?p:void 0,...Ft,ref:Ki(sn,Ht=>{Ht&&xe(Ht.tagName==="LABEL")}),onClick:Mn(Ft.onClick,()=>{var Ht;Ae||((Ht=Re.current)==null||Ht.click(),requestAnimationFrame(()=>{var we;(we=Re.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":lr(i),"data-checked":lr(qe),"data-invalid":lr(u)}),[ge,i,qe,u,Ae,p]),dt=O.useCallback((Ft={},sn=null)=>({...Ft,ref:Ki(Re,sn),type:"checkbox",name:F,value:z,id:p,tabIndex:q,onChange:Mn(Ft.onChange,at),onBlur:Mn(Ft.onBlur,J,()=>he(!1)),onFocus:Mn(Ft.onFocus,te,()=>he(!0)),onKeyDown:Mn(Ft.onKeyDown,ut),onKeyUp:Mn(Ft.onKeyUp,vt),required:l,checked:qe,disabled:_t,readOnly:o,"aria-label":K,"aria-labelledby":re,"aria-invalid":ce?!!ce:u,"aria-describedby":w,"aria-disabled":i,"aria-checked":D?"mixed":qe,style:Nxe}),[F,z,p,q,at,J,te,ut,vt,l,qe,_t,o,K,re,ce,u,w,i,D]),mt=O.useCallback((Ft={},sn=null)=>({...Ft,ref:sn,onMouseDown:Mn(Ft.onMouseDown,Dxe),"data-disabled":lr(i),"data-checked":lr(qe),"data-invalid":lr(u)}),[qe,i,u]);return{state:{isInvalid:u,isFocused:pe,isChecked:qe,isActive:Fe,isHovered:ve,isIndeterminate:D,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:$t,getCheckboxProps:it,getIndicatorProps:wt,getInputProps:dt,getLabelProps:mt,htmlProps:ge}}function Dxe(n){n.preventDefault(),n.stopPropagation()}const QV=Bt(function(e,i){const{className:o,centerContent:l,...u}=Bi(e),p=lu("Container",e);return S.jsx(Mt.div,{ref:i,className:En("chakra-container",o),...u,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});QV.displayName="Container";const Ug=Bt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:p,borderWidth:y,borderStyle:v,borderColor:w,...C}=lu("Divider",e),{className:R,orientation:N="horizontal",__css:M,...D}=Bi(e),F={vertical:{borderLeftWidth:o||p||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||y||"1px",width:"100%"}};return S.jsx(Mt.hr,{ref:i,"aria-orientation":N,...D,__css:{...C,border:"0",borderColor:w,borderStyle:v,...F[N],...M},className:En("chakra-divider",R)})});Ug.displayName="Divider";const Mr=Bt(function(e,i){const{direction:o,align:l,justify:u,wrap:p,basis:y,grow:v,shrink:w,...C}=e,R={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:p,flexBasis:y,flexGrow:v,flexShrink:w};return S.jsx(Mt.div,{ref:i,__css:R,...C})});Mr.displayName="Flex";function Lxe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var DU={exports:{}},LU,PX;function Mxe(){if(PX)return LU;PX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return LU=n,LU}var MU,kX;function Uxe(){if(kX)return MU;kX=1;var n=Mxe();function e(){}function i(){}return i.resetWarningCache=e,MU=function(){function o(p,y,v,w,C,R){if(R!==n){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},MU}var OX;function Vxe(){return OX||(OX=1,DU.exports=Uxe()()),DU.exports}var Fxe=Vxe();const Tn=$g(Fxe);var ZV="data-focus-lock",Wne="data-focus-lock-disabled",jxe="data-no-focus-lock",Bxe="data-autofocus-inside",zxe="data-no-autofocus";function UU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Wxe(n,e){var i=O.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var Gxe=typeof window<"u"?O.useLayoutEffect:O.useEffect,NX=new WeakMap;function Gne(n,e){var i=Wxe(null,function(o){return n.forEach(function(l){return UU(l,o)})});return Gxe(function(){var o=NX.get(i);if(o){var l=new Set(o),u=new Set(n),p=i.current;l.forEach(function(y){u.has(y)||UU(y,null)}),u.forEach(function(y){l.has(y)||UU(y,p)})}NX.set(i,n)},[n]),i}var VU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},yp=function(){return yp=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},yp.apply(this,arguments)};function LR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function Hxe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function Hne(n){return n}function $ne(n,e){e===void 0&&(e=Hne);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var p=e(u,o);return i.push(p),function(){i=i.filter(function(y){return y!==p})}},assignSyncMedium:function(u){for(o=!0;i.length;){var p=i;i=[],p.forEach(u)}i={push:function(y){return u(y)},filter:function(){return i}}},assignMedium:function(u){o=!0;var p=[];if(i.length){var y=i;i=[],y.forEach(u),p=i}var v=function(){var C=p;p=[],C.forEach(u)},w=function(){return Promise.resolve().then(v)};w(),i={push:function(C){p.push(C),w()},filter:function(C){return p=p.filter(C),i}}}};return l}function a5(n,e){return e===void 0&&(e=Hne),$ne(n,e)}function Kne(n){n===void 0&&(n={});var e=$ne(null);return e.options=yp({async:!0,ssr:!1},n),e}var qne=function(n){var e=n.sideCar,i=LR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return O.createElement(o,yp({},i))};qne.isSideCarExport=!0;function $xe(n,e){return n.useMedium(e),qne}var Yne=a5({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Xne=a5(),Kxe=a5(),qxe=Kne({async:!0,ssr:typeof document<"u"}),Yxe=O.createContext(void 0),Xxe=[],c5=O.forwardRef(function(e,i){var o,l=O.useState(),u=l[0],p=l[1],y=O.useRef(),v=O.useRef(!1),w=O.useRef(null),C=O.useState({}),R=C[1],N=e.children,M=e.disabled,D=M===void 0?!1:M,F=e.noFocusGuards,z=F===void 0?!1:F,q=e.persistentFocus,K=q===void 0?!1:q,re=e.crossFrame,ce=re===void 0?!0:re,se=e.autoFocus,ge=se===void 0?!0:se;e.allowTextSelection;var X=e.group,J=e.className,te=e.whiteList,ne=e.hasPositiveIndices,de=e.shards,pe=de===void 0?Xxe:de,he=e.as,ve=he===void 0?"div":he,Te=e.lockProps,Fe=Te===void 0?{}:Te,be=e.sideCar,Re=e.returnFocus,Ae=Re===void 0?!1:Re,xe=e.focusOptions,Ee=e.onActivation,Ne=e.onDeactivation,je=O.useState({}),qe=je[0],at=O.useCallback(function(sn){var Ht=sn.captureFocusRestore;if(!w.current){var we,De=(we=document)==null?void 0:we.activeElement;w.current=De,De!==document.body&&(w.current=Ht(De))}y.current&&Ee&&Ee(y.current),v.current=!0,R()},[Ee]),_t=O.useCallback(function(){v.current=!1,Ne&&Ne(y.current),R()},[Ne]),ut=O.useCallback(function(sn){var Ht=w.current;if(Ht){var we=(typeof Ht=="function"?Ht():Ht)||document.body,De=typeof Ae=="function"?Ae(we):Ae;if(De){var $e=typeof De=="object"?De:void 0;w.current=null,sn?Promise.resolve().then(function(){return we.focus($e)}):we.focus($e)}}},[Ae]),vt=O.useCallback(function(sn){v.current&&Yne.useMedium(sn)},[]),it=Xne.useMedium,wt=O.useCallback(function(sn){y.current!==sn&&(y.current=sn,p(sn))},[]),$t=Jy((o={},o[Wne]=D&&"disabled",o[ZV]=X,o),Fe),dt=z!==!0,mt=dt&&z!=="tail",ct=Gne([i,wt]),Ft=O.useMemo(function(){return{observed:y,shards:pe,enabled:!D,active:v.current}},[D,v.current,pe,u]);return bi.createElement(O.Fragment,null,dt&&[bi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:D?-1:0,style:VU}),ne?bi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:D?-1:1,style:VU}):null],!D&&bi.createElement(be,{id:qe,sideCar:qxe,observed:u,disabled:D,persistentFocus:K,crossFrame:ce,autoFocus:ge,whiteList:te,shards:pe,onActivation:at,onDeactivation:_t,returnFocus:ut,focusOptions:xe,noFocusGuards:z}),bi.createElement(ve,Jy({ref:ct},$t,{className:J,onBlur:it,onFocus:vt}),bi.createElement(Yxe.Provider,{value:Ft},N)),mt&&bi.createElement("div",{"data-focus-guard":!0,tabIndex:D?-1:0,style:VU}))});c5.propTypes={};function eF(n,e){return eF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},eF(n,e)}function Jxe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,eF(n,e)}function sR(n){"@babel/helpers - typeof";return sR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sR(n)}function Qxe(n,e){if(sR(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(sR(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Zxe(n){var e=Qxe(n,"string");return sR(e)=="symbol"?e:e+""}function eDe(n,e,i){return(e=Zxe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function tDe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],p;function y(){p=n(u.map(function(w){return w.props})),e(p)}var v=function(w){Jxe(C,w);function C(){return w.apply(this,arguments)||this}C.peek=function(){return p};var R=C.prototype;return R.componentDidMount=function(){u.push(this),y()},R.componentDidUpdate=function(){y()},R.componentWillUnmount=function(){var M=u.indexOf(this);u.splice(M,1),y()},R.render=function(){return bi.createElement(l,this.props)},C}(O.PureComponent);return eDe(v,"displayName","SideEffect("+i(l)+")"),v}}var Vp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Zy=function(n){return Array.isArray(n)?n:[n]},Jne=function(n){return Array.isArray(n)?n[0]:n},nDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Qne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Zne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},rDe=function(n){return n.hasAttribute("inert")},iDe=function(n,e){return!n||Zne(n)||!nDe(n)&&!rDe(n)&&e(Qne(n))},ere=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=iDe(e,ere.bind(void 0,n));return n.set(e,o),o},sDe=function(n,e){return n&&!Zne(n)?cDe(n)?e(Qne(n)):!1:!0},tre=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=sDe(e,tre.bind(void 0,n));return n.set(e,o),o},nre=function(n){return n.dataset},oDe=function(n){return n.tagName==="BUTTON"},rre=function(n){return n.tagName==="INPUT"},ire=function(n){return rre(n)&&n.type==="radio"},aDe=function(n){return!((rre(n)||oDe(n))&&(n.type==="hidden"||n.disabled))},cDe=function(n){var e=n.getAttribute(zxe);return![!0,"true",""].includes(e)},l5=function(n){var e;return!!(n&&(!((e=nre(n))===null||e===void 0)&&e.focusGuard))},tF=function(n){return!l5(n)},lDe=function(n){return!!n},uDe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},dDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},u5=function(n,e,i){return Vp(n).map(function(o,l){var u=dDe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(uDe)},hDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],d5=hDe.join(","),pDe="".concat(d5,", [data-focus-guard]"),sre=function(n,e){return Vp((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?pDe:d5)?[o]:[],sre(o))},[])},fDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?C0([n.contentDocument.body],e):[n]},C0=function(n,e){return n.reduce(function(i,o){var l,u=sre(o,e),p=(l=[]).concat.apply(l,u.map(function(y){return fDe(y,e)}));return i.concat(p,o.parentNode?Vp(o.parentNode.querySelectorAll(d5)).filter(function(y){return y===o}):[])},[])},mDe=function(n){var e=n.querySelectorAll("[".concat(Bxe,"]"));return Vp(e).map(function(i){return C0([i])}).reduce(function(i,o){return i.concat(o)},[])},h5=function(n,e){return Vp(n).filter(function(i){return ere(e,i)}).filter(function(i){return aDe(i)})},xX=function(n,e){return e===void 0&&(e=new Map),Vp(n).filter(function(i){return tre(e,i)})},p5=function(n,e,i){return u5(h5(C0(n,i),e),!0,i)},oR=function(n,e){return u5(h5(C0(n),e),!1)},gDe=function(n,e){return h5(mDe(n),e)},$y=function(n,e){return n.shadowRoot?$y(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Vp(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?$y(l,e):!1}return $y(i,e)})},_De=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(p,y){return!e.has(y)})},ore=function(n){return n.parentNode?ore(n.parentNode):n},f5=function(n){var e=Zy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(ZV);return i.push.apply(i,l?_De(Vp(ore(o).querySelectorAll("[".concat(ZV,'="').concat(l,'"]:not([').concat(Wne,'="disabled"])')))):[o]),i},[])},yDe=function(n){try{return n()}catch{return}},aR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?aR(e.shadowRoot):e instanceof HTMLIFrameElement&&yDe(function(){return e.contentWindow.document})?aR(e.contentWindow.document):e}},EDe=function(n,e){return n===e},vDe=function(n,e){return!!Vp(n.querySelectorAll("iframe")).some(function(i){return EDe(i,e)})},are=function(n,e){return e===void 0&&(e=aR(Jne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:f5(n).some(function(i){return $y(i,e)||vDe(i,e)})},SDe=function(n){n===void 0&&(n=document);var e=aR(n);return e?Vp(n.querySelectorAll("[".concat(jxe,"]"))).some(function(i){return $y(i,e)}):!1},bDe=function(n,e){return e.filter(ire).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},m5=function(n,e){return ire(n)&&n.name?bDe(n,e):n},wDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(m5(i,n))}),n.filter(function(i){return e.has(i)})},DX=function(n){return n[0]&&n.length>1?m5(n[0],n):n[0]},LX=function(n,e){return n.indexOf(m5(e,n))},nF="NEW_FOCUS",TDe=function(n,e,i,o,l){var u=n.length,p=n[0],y=n[u-1],v=l5(o);if(!(o&&n.indexOf(o)>=0)){var w=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):w,R=l?n.indexOf(l):-1;if(w===-1)return R!==-1?R:nF;if(R===-1)return nF;var N=w-C,M=i.indexOf(p),D=i.indexOf(y),F=wDe(i),z=o!==void 0?F.indexOf(o):-1,q=l?F.indexOf(l):z,K=F.filter(function(J){return J.tabIndex>=0}),re=o!==void 0?K.indexOf(o):-1,ce=l?K.indexOf(l):re,se=re>=0&&ce>=0?ce-re:q-z;if(!N&&R>=0||e.length===0)return R;var ge=LX(n,e[0]),X=LX(n,e[e.length-1]);if(w<=M&&v&&Math.abs(N)>1)return X;if(w>=D&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(se)>1)return R;if(w<=M)return X;if(w>D)return ge;if(N)return Math.abs(N)>1?R:(u+R+N)%u}},CDe=function(n){return function(e){var i,o=(i=nre(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},MX=function(n,e,i){var o=n.map(function(u){var p=u.node;return p}),l=xX(o.filter(CDe(i)));return l&&l.length?DX(l):DX(xX(e))},rF=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&rF(n.parentNode.host||n.parentNode,e),e},FU=function(n,e){for(var i=rF(n),o=rF(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},cre=function(n,e,i){var o=Zy(n),l=Zy(e),u=o[0],p=!1;return l.filter(Boolean).forEach(function(y){p=FU(p||y,y)||p,i.filter(Boolean).forEach(function(v){var w=FU(u,v);w&&(!p||$y(w,p)?p=w:p=FU(w,p))})}),p},UX=function(n,e){return n.reduce(function(i,o){return i.concat(gDe(o,e))},[])},RDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(lDe)},IDe=function(n,e){var i=aR(Zy(n).length>0?document:Jne(n).ownerDocument),o=f5(n).filter(tF),l=cre(i||n,n,o),u=new Map,p=oR(o,u),y=p.filter(function(D){var F=D.node;return tF(F)});if(y[0]){var v=oR([l],u).map(function(D){var F=D.node;return F}),w=RDe(v,y),C=w.map(function(D){var F=D.node;return F}),R=w.filter(function(D){var F=D.tabIndex;return F>=0}).map(function(D){var F=D.node;return F}),N=TDe(C,R,v,i,e);if(N===nF){var M=MX(p,R,UX(o,u))||MX(p,C,UX(o,u));if(M)return{node:M};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:w[N]}},ADe=function(n){var e=f5(n).filter(tF),i=cre(n,n,e),o=u5(C0([i],!0),!0,!0),l=C0(e,!1);return o.map(function(u){var p=u.node,y=u.index;return{node:p,index:y,lockItem:l.indexOf(p)>=0,guard:l5(p)}})},g5=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},jU=0,BU=!1,lre=function(n,e,i){i===void 0&&(i={});var o=IDe(n,e);if(!BU&&o){if(jU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),BU=!0,setTimeout(function(){BU=!1},1);return}jU++,g5(o.node,i.focusOptions),jU--}};function $T(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var PDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:$T(i),parent:$T(i.parentElement),left:$T(i.previousElementSibling),right:$T(i.nextElementSibling)}),i=i.parentElement;return{element:$T(n),stack:e,ownerDocument:n.ownerDocument}},kDe=function(n){var e,i,o,l,u;if(n)for(var p=n.stack,y=n.ownerDocument,v=new Map,w=0,C=p;w<C.length;w++){var R=C[w],N=(e=R.parent)===null||e===void 0?void 0:e.call(R);if(N&&y.contains(N)){for(var M=(i=R.left)===null||i===void 0?void 0:i.call(R),D=R.current(),F=N.contains(D)?D:void 0,z=(o=R.right)===null||o===void 0?void 0:o.call(R),q=p5([N],v),K=(u=(l=F??(M==null?void 0:M.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&u!==void 0?u:M;K;){for(var re=0,ce=q;re<ce.length;re++){var se=ce[re];if(K!=null&&K.contains(se.node))return se.node}K=K.nextElementSibling}if(q.length)return q[0].node}}},ure=function(n){var e=PDe(n);return function(){return kDe(e)}},ODe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Zy(e);if(o.every(function(p){return!$y(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?p5(o,new Map):oR(o,new Map),u=l.findIndex(function(p){var y=p.node;return y===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},NDe=function(n,e){var i=e?p5(Zy(n),new Map):oR(Zy(n),new Map);return{first:i[0],last:i[i.length-1]}},xDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},dre=function(n,e,i){e===void 0&&(e={});var o=xDe(e),l=ODe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&g5(u.node,o.focusOptions)}},DDe=function(n,e){e===void 0&&(e={}),dre(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},LDe=function(n,e){e===void 0&&(e={}),dre(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},hre=function(n,e,i){var o,l=NDe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&g5(u.node,e.focusOptions)},MDe=function(n,e){e===void 0&&(e={}),hre(n,e,"first")},UDe=function(n,e){e===void 0&&(e={}),hre(n,e,"last")};function _5(n){setTimeout(n,1)}var VDe=function(e){return e&&"current"in e?e.current:e},pre=function(){return document&&document.activeElement===document.body},FDe=function(){return pre()||SDe()},i0=null,ul=null,VX=function(){return null},s0=null,cR=!1,y5=!1,jDe=function(){return!0},BDe=function(e){return(i0.whiteList||jDe)(e)},zDe=function(e,i){s0={observerNode:e,portaledElement:i}},WDe=function(e){return s0&&s0.portaledElement===e};function FX(n,e,i,o){var l=null,u=n;do{var p=o[u];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var GDe=function(e){return e?!!cR:cR==="meanwhile"},HDe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},$De=function(e,i){return i.some(function(o){return HDe(e,o,o)})},fre=function(e){return oR(e,new Map)},KDe=function(e){return!fre([e.parentNode]).some(function(i){return i.node===e})},pO=function(){var e=!1;if(i0){var i=i0,o=i.observed,l=i.persistentFocus,u=i.autoFocus,p=i.shards,y=i.crossFrame,v=i.focusOptions,w=i.noFocusGuards,C=o||s0&&s0.portaledElement;if(pre()&&ul&&ul!==document.body&&(!document.body.contains(ul)||KDe(ul))){var R=VX();R&&R.focus()}var N=document&&document.activeElement;if(C){var M=[C].concat(p.map(VDe).filter(Boolean)),D=function(){if(!GDe(y)||!w||!ul||y5)return!1;var re=fre(M),ce=re.findIndex(function(se){var ge=se.node;return ge===ul});return ce===0||ce===re.length-1};if((!N||BDe(N))&&(l||D()||!FDe()||!ul&&u)&&(C&&!(are(M)||N&&$De(N,M)||WDe(N))&&(document&&!ul&&N&&!u?(N.blur&&N.blur(),document.body.focus()):(e=lre(M,ul,{focusOptions:v}),s0={})),ul=document&&document.activeElement,ul!==document.body&&(VX=ure(ul)),cR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,z=ADe(M),q=z.map(function(K){var re=K.node;return re}).indexOf(F);q>-1&&(z.filter(function(K){var re=K.guard,ce=K.node;return re&&ce.dataset.focusAutoGuard}).forEach(function(K){var re=K.node;return re.removeAttribute("tabIndex")}),FX(q,z.length,1,z),FX(q,-1,-1,z))}}}return e},mre=function(e){pO()&&e&&(e.stopPropagation(),e.preventDefault())},E5=function(){return _5(pO)},qDe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||zDe(o,i)},YDe=function(){return null},gre=function(){y5=!0},_re=function(){y5=!1,cR="just",_5(function(){cR="meanwhile"})},XDe=function(){document.addEventListener("focusin",mre),document.addEventListener("focusout",E5),window.addEventListener("focus",gre),window.addEventListener("blur",_re)},JDe=function(){document.removeEventListener("focusin",mre),document.removeEventListener("focusout",E5),window.removeEventListener("focus",gre),window.removeEventListener("blur",_re)};function QDe(n){return n.filter(function(e){var i=e.disabled;return!i})}var yre={moveFocusInside:lre,focusInside:are,focusNextElement:DDe,focusPrevElement:LDe,focusFirstElement:MDe,focusLastElement:UDe,captureFocusRestore:ure};function ZDe(n){var e=n.slice(-1)[0];e&&!i0&&XDe();var i=i0,o=i&&e&&e.id===i.id;i0=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(ul=null,(!o||i.observed!==e.observed)&&e.onActivation(yre),pO(),_5(pO)):(JDe(),ul=null)}Yne.assignSyncMedium(qDe);Xne.assignMedium(E5);Kxe.assignMedium(function(n){return n(yre)});const eLe=tDe(QDe,ZDe)(YDe);var iF=O.forwardRef(function(e,i){return bi.createElement(c5,Jy({sideCar:eLe,ref:i},e))}),Ere=c5.propTypes||{};Ere.sideCar;Lxe(Ere,["sideCar"]);iF.propTypes={};const tLe=iF.default??iF,vre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:p,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:w}=n,C=O.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&ree(o.current).length===0&&requestAnimationFrame(()=>{var D;(D=o.current)==null||D.focus()})},[e,o]),R=O.useCallback(()=>{var M;(M=i==null?void 0:i.current)==null||M.focus()},[i]),N=l&&!i;return S.jsx(tLe,{crossFrame:w,persistentFocus:v,autoFocus:y,disabled:p,onActivation:C,onDeactivation:R,returnFocus:N,children:u})};vre.displayName="FocusLock";const[nLe,rLe]=ki({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),gp=Bt((n,e)=>{const i=Fa("FormError",n),o=Bi(n),l=J0();return l!=null&&l.isInvalid?S.jsx(nLe,{value:i,children:S.jsx(Mt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:En("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});gp.displayName="FormErrorMessage";const iLe=Bt((n,e)=>{const i=rLe(),o=J0();if(!(o!=null&&o.isInvalid))return null;const l=En("chakra-form__error-icon",n.className);return S.jsx(yn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});iLe.displayName="FormErrorIcon";const gi=Bt(function(e,i){const o=lu("FormLabel",e),l=Bi(e),{className:u,children:p,requiredIndicator:y=S.jsx(Sre,{}),optionalIndicator:v=null,...w}=l,C=J0(),R=(C==null?void 0:C.getLabelProps(w,i))??{ref:i,...w};return S.jsxs(Mt.label,{...R,className:En("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[p,C!=null&&C.isRequired?y:v]})});gi.displayName="FormLabel";const Sre=Bt(function(e,i){const o=J0(),l=zne();if(!(o!=null&&o.isRequired))return null;const u=En("chakra-form__required-indicator",e.className);return S.jsx(Mt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});Sre.displayName="RequiredIndicator";const v5=Bt(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:p,column:y,row:v,autoFlow:w,autoRows:C,templateRows:R,autoColumns:N,templateColumns:M,...D}=e,F={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:p,gridAutoColumns:N,gridColumn:y,gridRow:v,gridAutoFlow:w,gridAutoRows:C,gridTemplateRows:R,gridTemplateColumns:M};return S.jsx(Mt.div,{ref:i,__css:F,...D})});v5.displayName="Grid";const bre=Bt(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:p,minChildWidth:y,...v}=e,w=X0(),C=y?oLe(y,w):aLe(o);return S.jsx(v5,{ref:i,gap:p,columnGap:l,rowGap:u,templateColumns:C,...v})});bre.displayName="SimpleGrid";function sLe(n){return typeof n=="number"?`${n}px`:n}function oLe(n,e){return XO(n,i=>{const o=jNe("sizes",i,sLe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function aLe(n){return XO(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function qg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=O.Children.toArray(n.path),p=Bt((y,v)=>S.jsx(yn,{ref:v,viewBox:e,...l,...y,children:u.length?u:S.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=o,p}const sF=Bt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...p}=e;return S.jsx("img",{width:o,height:l,ref:i,alt:u,...p})});sF.displayName="NativeImage";const bp=Bt(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:p,align:y,fit:v,loading:w,ignoreFallback:C,crossOrigin:R,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:M,...D}=e,F=o!==void 0||l!==void 0,z=w!=null||C||!F,q=Fne({...e,crossOrigin:R,ignoreFallback:z}),K=mxe(q,N),re={ref:i,objectFit:v,objectPosition:y,...z?D:H0(D,["onError","onLoad"])};return K?l||S.jsx(Mt.img,{as:sF,className:"chakra-image__placeholder",src:o,...re}):S.jsx(Mt.img,{as:sF,src:u,srcSet:p,crossOrigin:R,loading:w,referrerPolicy:M,className:"chakra-image",...re})});bp.displayName="Image";const ci=Bt(function(e,i){const{htmlSize:o,...l}=e,u=Fa("Input",l),p=Bi(l),y=s5(p),v=En("chakra-input",e.className);return S.jsx(Mt.input,{size:o,...y,__css:u.field,ref:i,className:v})});ci.displayName="Input";ci.id="Input";const[cLe,wre]=ki({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Pg=Bt(function(e,i){const o=Fa("Input",e),{children:l,className:u,...p}=Bi(e),y=En("chakra-input__group",u),v={},w=qO(l),C=o.field;w.forEach(N=>{o&&(C&&N.type.id==="InputLeftElement"&&(v.paddingStart=C.height??C.h),C&&N.type.id==="InputRightElement"&&(v.paddingEnd=C.height??C.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const R=w.map(N=>{var D,F;const M=YO({size:((D=N.props)==null?void 0:D.size)||e.size,variant:((F=N.props)==null?void 0:F.variant)||e.variant});return N.type.id!=="Input"?O.cloneElement(N,M):O.cloneElement(N,Object.assign(M,v,N.props))});return S.jsx(Mt.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...p,children:S.jsx(cLe,{value:o,children:R})})});Pg.displayName="InputGroup";const lLe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},uLe=Mt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),S5=Bt(function(e,i){const{placement:o="left",...l}=e,u=lLe[o]??{},p=wre();return S.jsx(uLe,{ref:i,...l,__css:{...p.addon,...u}})});S5.displayName="InputAddon";const pN=Bt(function(e,i){return S.jsx(S5,{ref:i,placement:"left",...e,className:En("chakra-input__left-addon",e.className)})});pN.displayName="InputLeftAddon";pN.id="InputLeftAddon";const Tre=Bt(function(e,i){return S.jsx(S5,{ref:i,placement:"right",...e,className:En("chakra-input__right-addon",e.className)})});Tre.displayName="InputRightAddon";Tre.id="InputRightAddon";const dLe=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),fN=Bt(function(e,i){const{placement:o="left",...l}=e,u=wre(),p=u.field,v={[o==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...u.element};return S.jsx(dLe,{ref:i,__css:v,...l})});fN.id="InputElement";fN.displayName="InputElement";const MC=Bt(function(e,i){const{className:o,...l}=e,u=En("chakra-input__left-element",o);return S.jsx(fN,{ref:i,placement:"left",className:u,...l})});MC.id="InputLeftElement";MC.displayName="InputLeftElement";const fO=Bt(function(e,i){const{className:o,...l}=e,u=En("chakra-input__right-element",o);return S.jsx(fN,{ref:i,placement:"right",className:u,...l})});fO.id="InputRightElement";fO.displayName="InputRightElement";const eu=Bt(function(e,i){const o=lu("Link",e),{className:l,isExternal:u,...p}=Bi(e);return S.jsx(Mt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:En("chakra-link",l),...p,__css:o})});eu.displayName="Link";const[hLe,Cre]=ki({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),mN=Bt(function(e,i){const o=Fa("List",e),{children:l,styleType:u="none",stylePosition:p,spacing:y,...v}=Bi(e),w=qO(l),R=y?{["& > *:not(style) ~ *:not(style)"]:{mt:y}}:{};return S.jsx(hLe,{value:o,children:S.jsx(Mt.ul,{ref:i,listStyleType:u,listStylePosition:p,role:"list",__css:{...o.container,...R},...v,children:w})})});mN.displayName="List";const pLe=Bt((n,e)=>{const{as:i,...o}=n;return S.jsx(mN,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});pLe.displayName="OrderedList";const fLe=Bt(function(e,i){const{as:o,...l}=e;return S.jsx(mN,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});fLe.displayName="UnorderedList";const Rre=Bt(function(e,i){const o=Cre();return S.jsx(Mt.li,{ref:i,...e,__css:o.item})});Rre.displayName="ListItem";const mLe=Bt(function(e,i){const o=Cre();return S.jsx(yn,{ref:i,role:"presentation",...e,__css:o.icon})});mLe.displayName="ListIcon";function gLe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=WAe(),u=Array.isArray(n)?n:[n];let p=Array.isArray(o)?o:[o];p=p.filter(w=>w!=null);const[y,v]=O.useState(()=>u.map((w,C)=>({media:w,matches:i?!!p[C]:l().matchMedia(w).matches})));return O.useEffect(()=>{const w=l();v(u.map(N=>({media:N,matches:w.matchMedia(N).matches})));const C=u.map(N=>w.matchMedia(N)),R=N=>{v(M=>M.slice().map(D=>D.media===N.media?{...D,matches:N.matches}:D))};return C.forEach(N=>{typeof N.addListener=="function"?N.addListener(R):N.addEventListener("change",R)}),()=>{C.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(R):N.removeEventListener("change",R)})}},[l]),y.map(w=>w.matches)}function _Le(n,e,i,o){if(e==null)return o;if(!o)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function yLe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function ELe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=O.useState([]),u=O.useRef(void 0),p=()=>{u.current&&(clearTimeout(u.current),u.current=null)},y=()=>{p(),u.current=setTimeout(()=>{l([]),u.current=null},e)};O.useEffect(()=>p,[]);function v(w){return C=>{if(C.key==="Backspace"){const R=[...o];R.pop(),l(R);return}if(yLe(C)){const R=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(R),w(R.join("")),y()}}}return v}var El="top",od="bottom",ad="right",vl="left",b5="auto",MR=[El,od,ad,vl],R0="start",lR="end",vLe="clippingParents",Ire="viewport",KT="popper",SLe="reference",jX=MR.reduce(function(n,e){return n.concat([e+"-"+R0,e+"-"+lR])},[]),Are=[].concat(MR,[b5]).reduce(function(n,e){return n.concat([e,e+"-"+R0,e+"-"+lR])},[]),bLe="beforeRead",wLe="read",TLe="afterRead",CLe="beforeMain",RLe="main",ILe="afterMain",ALe="beforeWrite",PLe="write",kLe="afterWrite",OLe=[bLe,wLe,TLe,CLe,RLe,ILe,ALe,PLe,kLe];function Lp(n){return n?(n.nodeName||"").toLowerCase():null}function cu(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function eE(n){var e=cu(n).Element;return n instanceof e||n instanceof Element}function td(n){var e=cu(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function w5(n){if(typeof ShadowRoot>"u")return!1;var e=cu(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function NLe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!td(u)||!Lp(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(p){var y=l[p];y===!1?u.removeAttribute(p):u.setAttribute(p,y===!0?"":y)}))})}function xLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},p=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),y=p.reduce(function(v,w){return v[w]="",v},{});!td(l)||!Lp(l)||(Object.assign(l.style,y),Object.keys(u).forEach(function(v){l.removeAttribute(v)}))})}}const DLe={name:"applyStyles",enabled:!0,phase:"write",fn:NLe,effect:xLe,requires:["computeStyles"]};function kp(n){return n.split("-")[0]}var Ky=Math.max,mO=Math.min,I0=Math.round;function oF(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Pre(){return!/^((?!chrome|android).)*safari/i.test(oF())}function A0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&td(n)&&(l=n.offsetWidth>0&&I0(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&I0(o.height)/n.offsetHeight||1);var p=eE(n)?cu(n):window,y=p.visualViewport,v=!Pre()&&i,w=(o.left+(v&&y?y.offsetLeft:0))/l,C=(o.top+(v&&y?y.offsetTop:0))/u,R=o.width/l,N=o.height/u;return{width:R,height:N,top:C,right:w+R,bottom:C+N,left:w,x:w,y:C}}function T5(n){var e=A0(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function kre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&w5(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Hf(n){return cu(n).getComputedStyle(n)}function LLe(n){return["table","td","th"].indexOf(Lp(n))>=0}function Yg(n){return((eE(n)?n.ownerDocument:n.document)||window.document).documentElement}function gN(n){return Lp(n)==="html"?n:n.assignedSlot||n.parentNode||(w5(n)?n.host:null)||Yg(n)}function BX(n){return!td(n)||Hf(n).position==="fixed"?null:n.offsetParent}function MLe(n){var e=/firefox/i.test(oF()),i=/Trident/i.test(oF());if(i&&td(n)){var o=Hf(n);if(o.position==="fixed")return null}var l=gN(n);for(w5(l)&&(l=l.host);td(l)&&["html","body"].indexOf(Lp(l))<0;){var u=Hf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function UR(n){for(var e=cu(n),i=BX(n);i&&LLe(i)&&Hf(i).position==="static";)i=BX(i);return i&&(Lp(i)==="html"||Lp(i)==="body"&&Hf(i).position==="static")?e:i||MLe(n)||e}function C5(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function UC(n,e,i){return Ky(n,mO(e,i))}function ULe(n,e,i){var o=UC(n,e,i);return o>i?i:o}function Ore(){return{top:0,right:0,bottom:0,left:0}}function Nre(n){return Object.assign({},Ore(),n)}function xre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var VLe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Nre(typeof e!="number"?e:xre(e,MR))};function FLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,p=i.modifiersData.popperOffsets,y=kp(i.placement),v=C5(y),w=[vl,ad].indexOf(y)>=0,C=w?"height":"width";if(!(!u||!p)){var R=VLe(l.padding,i),N=T5(u),M=v==="y"?El:vl,D=v==="y"?od:ad,F=i.rects.reference[C]+i.rects.reference[v]-p[v]-i.rects.popper[C],z=p[v]-i.rects.reference[v],q=UR(u),K=q?v==="y"?q.clientHeight||0:q.clientWidth||0:0,re=F/2-z/2,ce=R[M],se=K-N[C]-R[D],ge=K/2-N[C]/2+re,X=UC(ce,ge,se),J=v;i.modifiersData[o]=(e={},e[J]=X,e.centerOffset=X-ge,e)}}function jLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||kre(e.elements.popper,l)&&(e.elements.arrow=l))}const BLe={name:"arrow",enabled:!0,phase:"main",fn:FLe,effect:jLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function P0(n){return n.split("-")[1]}var zLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function WLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:I0(i*l)/l||0,y:I0(o*l)/l||0}}function zX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,p=n.offsets,y=n.position,v=n.gpuAcceleration,w=n.adaptive,C=n.roundOffsets,R=n.isFixed,N=p.x,M=N===void 0?0:N,D=p.y,F=D===void 0?0:D,z=typeof C=="function"?C({x:M,y:F}):{x:M,y:F};M=z.x,F=z.y;var q=p.hasOwnProperty("x"),K=p.hasOwnProperty("y"),re=vl,ce=El,se=window;if(w){var ge=UR(i),X="clientHeight",J="clientWidth";if(ge===cu(i)&&(ge=Yg(i),Hf(ge).position!=="static"&&y==="absolute"&&(X="scrollHeight",J="scrollWidth")),ge=ge,l===El||(l===vl||l===ad)&&u===lR){ce=od;var te=R&&ge===se&&se.visualViewport?se.visualViewport.height:ge[X];F-=te-o.height,F*=v?1:-1}if(l===vl||(l===El||l===od)&&u===lR){re=ad;var ne=R&&ge===se&&se.visualViewport?se.visualViewport.width:ge[J];M-=ne-o.width,M*=v?1:-1}}var de=Object.assign({position:y},w&&zLe),pe=C===!0?WLe({x:M,y:F},cu(i)):{x:M,y:F};if(M=pe.x,F=pe.y,v){var he;return Object.assign({},de,(he={},he[ce]=K?"0":"",he[re]=q?"0":"",he.transform=(se.devicePixelRatio||1)<=1?"translate("+M+"px, "+F+"px)":"translate3d("+M+"px, "+F+"px, 0)",he))}return Object.assign({},de,(e={},e[ce]=K?F+"px":"",e[re]=q?M+"px":"",e.transform="",e))}function GLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,p=u===void 0?!0:u,y=i.roundOffsets,v=y===void 0?!0:y,w={placement:kp(e.placement),variation:P0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,zX(Object.assign({},w,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,zX(Object.assign({},w,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const HLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:GLe,data:{}};var Q1={passive:!0};function $Le(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,p=o.resize,y=p===void 0?!0:p,v=cu(e.elements.popper),w=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&w.forEach(function(C){C.addEventListener("scroll",i.update,Q1)}),y&&v.addEventListener("resize",i.update,Q1),function(){u&&w.forEach(function(C){C.removeEventListener("scroll",i.update,Q1)}),y&&v.removeEventListener("resize",i.update,Q1)}}const KLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:$Le,data:{}};var qLe={left:"right",right:"left",bottom:"top",top:"bottom"};function Lk(n){return n.replace(/left|right|bottom|top/g,function(e){return qLe[e]})}var YLe={start:"end",end:"start"};function WX(n){return n.replace(/start|end/g,function(e){return YLe[e]})}function R5(n){var e=cu(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function I5(n){return A0(Yg(n)).left+R5(n).scrollLeft}function XLe(n,e){var i=cu(n),o=Yg(n),l=i.visualViewport,u=o.clientWidth,p=o.clientHeight,y=0,v=0;if(l){u=l.width,p=l.height;var w=Pre();(w||!w&&e==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:u,height:p,x:y+I5(n),y:v}}function JLe(n){var e,i=Yg(n),o=R5(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Ky(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Ky(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-o.scrollLeft+I5(n),v=-o.scrollTop;return Hf(l||i).direction==="rtl"&&(y+=Ky(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:p,x:y,y:v}}function A5(n){var e=Hf(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function Dre(n){return["html","body","#document"].indexOf(Lp(n))>=0?n.ownerDocument.body:td(n)&&A5(n)?n:Dre(gN(n))}function VC(n,e){var i;e===void 0&&(e=[]);var o=Dre(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=cu(o),p=l?[u].concat(u.visualViewport||[],A5(o)?o:[]):o,y=e.concat(p);return l?y:y.concat(VC(gN(p)))}function aF(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function QLe(n,e){var i=A0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function GX(n,e,i){return e===Ire?aF(XLe(n,i)):eE(e)?QLe(e,i):aF(JLe(Yg(n)))}function ZLe(n){var e=VC(gN(n)),i=["absolute","fixed"].indexOf(Hf(n).position)>=0,o=i&&td(n)?UR(n):n;return eE(o)?e.filter(function(l){return eE(l)&&kre(l,o)&&Lp(l)!=="body"}):[]}function e2e(n,e,i,o){var l=e==="clippingParents"?ZLe(n):[].concat(e),u=[].concat(l,[i]),p=u[0],y=u.reduce(function(v,w){var C=GX(n,w,o);return v.top=Ky(C.top,v.top),v.right=mO(C.right,v.right),v.bottom=mO(C.bottom,v.bottom),v.left=Ky(C.left,v.left),v},GX(n,p,o));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function Lre(n){var e=n.reference,i=n.element,o=n.placement,l=o?kp(o):null,u=o?P0(o):null,p=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,v;switch(l){case El:v={x:p,y:e.y-i.height};break;case od:v={x:p,y:e.y+e.height};break;case ad:v={x:e.x+e.width,y};break;case vl:v={x:e.x-i.width,y};break;default:v={x:e.x,y:e.y}}var w=l?C5(l):null;if(w!=null){var C=w==="y"?"height":"width";switch(u){case R0:v[w]=v[w]-(e[C]/2-i[C]/2);break;case lR:v[w]=v[w]+(e[C]/2-i[C]/2);break}}return v}function uR(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,p=u===void 0?n.strategy:u,y=i.boundary,v=y===void 0?vLe:y,w=i.rootBoundary,C=w===void 0?Ire:w,R=i.elementContext,N=R===void 0?KT:R,M=i.altBoundary,D=M===void 0?!1:M,F=i.padding,z=F===void 0?0:F,q=Nre(typeof z!="number"?z:xre(z,MR)),K=N===KT?SLe:KT,re=n.rects.popper,ce=n.elements[D?K:N],se=e2e(eE(ce)?ce:ce.contextElement||Yg(n.elements.popper),v,C,p),ge=A0(n.elements.reference),X=Lre({reference:ge,element:re,placement:l}),J=aF(Object.assign({},re,X)),te=N===KT?J:ge,ne={top:se.top-te.top+q.top,bottom:te.bottom-se.bottom+q.bottom,left:se.left-te.left+q.left,right:te.right-se.right+q.right},de=n.modifiersData.offset;if(N===KT&&de){var pe=de[l];Object.keys(ne).forEach(function(he){var ve=[ad,od].indexOf(he)>=0?1:-1,Te=[El,od].indexOf(he)>=0?"y":"x";ne[he]+=pe[Te]*ve})}return ne}function t2e(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,p=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,w=v===void 0?Are:v,C=P0(o),R=C?y?jX:jX.filter(function(D){return P0(D)===C}):MR,N=R.filter(function(D){return w.indexOf(D)>=0});N.length===0&&(N=R);var M=N.reduce(function(D,F){return D[F]=uR(n,{placement:F,boundary:l,rootBoundary:u,padding:p})[kp(F)],D},{});return Object.keys(M).sort(function(D,F){return M[D]-M[F]})}function n2e(n){if(kp(n)===b5)return[];var e=Lk(n);return[WX(n),e,WX(e)]}function r2e(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!0:p,v=i.fallbackPlacements,w=i.padding,C=i.boundary,R=i.rootBoundary,N=i.altBoundary,M=i.flipVariations,D=M===void 0?!0:M,F=i.allowedAutoPlacements,z=e.options.placement,q=kp(z),K=q===z,re=v||(K||!D?[Lk(z)]:n2e(z)),ce=[z].concat(re).reduce(function(qe,at){return qe.concat(kp(at)===b5?t2e(e,{placement:at,boundary:C,rootBoundary:R,padding:w,flipVariations:D,allowedAutoPlacements:F}):at)},[]),se=e.rects.reference,ge=e.rects.popper,X=new Map,J=!0,te=ce[0],ne=0;ne<ce.length;ne++){var de=ce[ne],pe=kp(de),he=P0(de)===R0,ve=[El,od].indexOf(pe)>=0,Te=ve?"width":"height",Fe=uR(e,{placement:de,boundary:C,rootBoundary:R,altBoundary:N,padding:w}),be=ve?he?ad:vl:he?od:El;se[Te]>ge[Te]&&(be=Lk(be));var Re=Lk(be),Ae=[];if(u&&Ae.push(Fe[pe]<=0),y&&Ae.push(Fe[be]<=0,Fe[Re]<=0),Ae.every(function(qe){return qe})){te=de,J=!1;break}X.set(de,Ae)}if(J)for(var xe=D?3:1,Ee=function(at){var _t=ce.find(function(ut){var vt=X.get(ut);if(vt)return vt.slice(0,at).every(function(it){return it})});if(_t)return te=_t,"break"},Ne=xe;Ne>0;Ne--){var je=Ee(Ne);if(je==="break")break}e.placement!==te&&(e.modifiersData[o]._skip=!0,e.placement=te,e.reset=!0)}}const i2e={name:"flip",enabled:!0,phase:"main",fn:r2e,requiresIfExists:["offset"],data:{_skip:!1}};function HX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function $X(n){return[El,ad,od,vl].some(function(e){return n[e]>=0})}function s2e(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,p=uR(e,{elementContext:"reference"}),y=uR(e,{altBoundary:!0}),v=HX(p,o),w=HX(y,l,u),C=$X(v),R=$X(w);e.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:w,isReferenceHidden:C,hasPopperEscaped:R},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":R})}const o2e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:s2e};function a2e(n,e,i){var o=kp(n),l=[vl,El].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=u[0],y=u[1];return p=p||0,y=(y||0)*l,[vl,ad].indexOf(o)>=0?{x:y,y:p}:{x:p,y}}function c2e(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,p=Are.reduce(function(C,R){return C[R]=a2e(R,e.rects,u),C},{}),y=p[e.placement],v=y.x,w=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=w),e.modifiersData[o]=p}const l2e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:c2e};function u2e(n){var e=n.state,i=n.name;e.modifiersData[i]=Lre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const d2e={name:"popperOffsets",enabled:!0,phase:"read",fn:u2e,data:{}};function h2e(n){return n==="x"?"y":"x"}function p2e(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,p=i.altAxis,y=p===void 0?!1:p,v=i.boundary,w=i.rootBoundary,C=i.altBoundary,R=i.padding,N=i.tether,M=N===void 0?!0:N,D=i.tetherOffset,F=D===void 0?0:D,z=uR(e,{boundary:v,rootBoundary:w,padding:R,altBoundary:C}),q=kp(e.placement),K=P0(e.placement),re=!K,ce=C5(q),se=h2e(ce),ge=e.modifiersData.popperOffsets,X=e.rects.reference,J=e.rects.popper,te=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,ne=typeof te=="number"?{mainAxis:te,altAxis:te}:Object.assign({mainAxis:0,altAxis:0},te),de=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,pe={x:0,y:0};if(ge){if(u){var he,ve=ce==="y"?El:vl,Te=ce==="y"?od:ad,Fe=ce==="y"?"height":"width",be=ge[ce],Re=be+z[ve],Ae=be-z[Te],xe=M?-J[Fe]/2:0,Ee=K===R0?X[Fe]:J[Fe],Ne=K===R0?-J[Fe]:-X[Fe],je=e.elements.arrow,qe=M&&je?T5(je):{width:0,height:0},at=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ore(),_t=at[ve],ut=at[Te],vt=UC(0,X[Fe],qe[Fe]),it=re?X[Fe]/2-xe-vt-_t-ne.mainAxis:Ee-vt-_t-ne.mainAxis,wt=re?-X[Fe]/2+xe+vt+ut+ne.mainAxis:Ne+vt+ut+ne.mainAxis,$t=e.elements.arrow&&UR(e.elements.arrow),dt=$t?ce==="y"?$t.clientTop||0:$t.clientLeft||0:0,mt=(he=de==null?void 0:de[ce])!=null?he:0,ct=be+it-mt-dt,Ft=be+wt-mt,sn=UC(M?mO(Re,ct):Re,be,M?Ky(Ae,Ft):Ae);ge[ce]=sn,pe[ce]=sn-be}if(y){var Ht,we=ce==="x"?El:vl,De=ce==="x"?od:ad,$e=ge[se],kt=se==="y"?"height":"width",At=$e+z[we],Tt=$e-z[De],Ut=[El,vl].indexOf(q)!==-1,Sn=(Ht=de==null?void 0:de[se])!=null?Ht:0,Pn=Ut?At:$e-X[kt]-J[kt]-Sn+ne.altAxis,hn=Ut?$e+X[kt]+J[kt]-Sn-ne.altAxis:Tt,Rt=M&&Ut?ULe(Pn,$e,hn):UC(M?Pn:At,$e,M?hn:Tt);ge[se]=Rt,pe[se]=Rt-$e}e.modifiersData[o]=pe}}const f2e={name:"preventOverflow",enabled:!0,phase:"main",fn:p2e,requiresIfExists:["offset"]};function m2e(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function g2e(n){return n===cu(n)||!td(n)?R5(n):m2e(n)}function _2e(n){var e=n.getBoundingClientRect(),i=I0(e.width)/n.offsetWidth||1,o=I0(e.height)/n.offsetHeight||1;return i!==1||o!==1}function y2e(n,e,i){i===void 0&&(i=!1);var o=td(e),l=td(e)&&_2e(e),u=Yg(e),p=A0(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(o||!o&&!i)&&((Lp(e)!=="body"||A5(u))&&(y=g2e(e)),td(e)?(v=A0(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):u&&(v.x=I5(u))),{x:p.left+y.scrollLeft-v.x,y:p.top+y.scrollTop-v.y,width:p.width,height:p.height}}function E2e(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var p=[].concat(u.requires||[],u.requiresIfExists||[]);p.forEach(function(y){if(!i.has(y)){var v=e.get(y);v&&l(v)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function v2e(n){var e=E2e(n);return OLe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function S2e(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function b2e(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var KX={placement:"bottom",modifiers:[],strategy:"absolute"};function qX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function w2e(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?KX:l;return function(y,v,w){w===void 0&&(w=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},KX,u),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},R=[],N=!1,M={state:C,setOptions:function(q){var K=typeof q=="function"?q(C.options):q;F(),C.options=Object.assign({},u,C.options,K),C.scrollParents={reference:eE(y)?VC(y):y.contextElement?VC(y.contextElement):[],popper:VC(v)};var re=v2e(b2e([].concat(o,C.options.modifiers)));return C.orderedModifiers=re.filter(function(ce){return ce.enabled}),D(),M.update()},forceUpdate:function(){if(!N){var q=C.elements,K=q.reference,re=q.popper;if(qX(K,re)){C.rects={reference:y2e(K,UR(re),C.options.strategy==="fixed"),popper:T5(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ne){return C.modifiersData[ne.name]=Object.assign({},ne.data)});for(var ce=0;ce<C.orderedModifiers.length;ce++){if(C.reset===!0){C.reset=!1,ce=-1;continue}var se=C.orderedModifiers[ce],ge=se.fn,X=se.options,J=X===void 0?{}:X,te=se.name;typeof ge=="function"&&(C=ge({state:C,options:J,name:te,instance:M})||C)}}}},update:S2e(function(){return new Promise(function(z){M.forceUpdate(),z(C)})}),destroy:function(){F(),N=!0}};if(!qX(y,v))return M;M.setOptions(w).then(function(z){!N&&w.onFirstUpdate&&w.onFirstUpdate(z)});function D(){C.orderedModifiers.forEach(function(z){var q=z.name,K=z.options,re=K===void 0?{}:K,ce=z.effect;if(typeof ce=="function"){var se=ce({state:C,name:q,instance:M,options:re}),ge=function(){};R.push(se||ge)}})}function F(){R.forEach(function(z){return z()}),R=[]}return M}}var T2e=[KLe,d2e,HLe,DLe,l2e,i2e,f2e,BLe,o2e],C2e=w2e({defaultModifiers:T2e});const RS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Co={arrowShadowColor:RS("--popper-arrow-shadow-color"),arrowSize:RS("--popper-arrow-size","8px"),arrowSizeHalf:RS("--popper-arrow-size-half"),arrowBg:RS("--popper-arrow-bg"),transformOrigin:RS("--popper-transform-origin"),arrowOffset:RS("--popper-arrow-offset")};function R2e(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const I2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},A2e=n=>I2e[n],YX={scroll:!0,resize:!0};function P2e(n){let e;return typeof n=="object"?e={enabled:!0,options:{...YX,...n}}:e={enabled:n,options:YX},e}const k2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},O2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{XX(n)},effect:({state:n})=>()=>{XX(n)}},XX=n=>{n.elements.popper.style.setProperty(Co.transformOrigin.var,A2e(n.placement))},N2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{x2e(n)}},x2e=n=>{var i;if(!n.placement)return;const e=D2e(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Co.arrowSize.varRef,height:Co.arrowSize.varRef,zIndex:-1});const o={[Co.arrowSizeHalf.var]:`calc(${Co.arrowSize.varRef} / 2 - 1px)`,[Co.arrowOffset.var]:`calc(${Co.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},D2e=n=>{if(n.startsWith("top"))return{property:"bottom",value:Co.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Co.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Co.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Co.arrowOffset.varRef}},L2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{JX(n)},effect:({state:n})=>()=>{JX(n)}},JX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=R2e(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Co.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},M2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},U2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function V2e(n,e="ltr"){var o;const i=((o=M2e[n])==null?void 0:o[e])||n;return e==="ltr"?i:U2e[n]??i}function P5(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:p=!0,offset:y,gutter:v=8,flip:w=!0,boundary:C="clippingParents",preventOverflow:R=!0,matchWidth:N,direction:M="ltr"}=n,D=O.useRef(null),F=O.useRef(null),z=O.useRef(null),q=V2e(o,M),K=O.useRef(()=>{}),re=O.useCallback(()=>{var ne;!e||!D.current||!F.current||((ne=K.current)==null||ne.call(K),z.current=C2e(D.current,F.current,{placement:q,modifiers:[L2e,N2e,O2e,{...k2e,enabled:!!N},{name:"eventListeners",...P2e(p)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!w,options:{padding:8}},{name:"preventOverflow",enabled:!!R,options:{boundary:C}},...i??[]],strategy:l}),z.current.forceUpdate(),K.current=z.current.destroy)},[q,e,i,N,p,u,y,v,w,R,C,l]);O.useEffect(()=>()=>{var ne;!D.current&&!F.current&&((ne=z.current)==null||ne.destroy(),z.current=null)},[]);const ce=O.useCallback(ne=>{D.current=ne,re()},[re]),se=O.useCallback((ne={},de=null)=>({...ne,ref:Ki(ce,de)}),[ce]),ge=O.useCallback(ne=>{F.current=ne,re()},[re]),X=O.useCallback((ne={},de=null)=>({...ne,ref:Ki(ge,de),style:{...ne.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),J=O.useCallback((ne={},de=null)=>{const{size:pe,shadowColor:he,bg:ve,style:Te,...Fe}=ne;return{...Fe,ref:de,"data-popper-arrow":"",style:F2e(ne)}},[]),te=O.useCallback((ne={},de=null)=>({...ne,ref:de,"data-popper-arrow-inner":""}),[]);return{update(){var ne;(ne=z.current)==null||ne.update()},forceUpdate(){var ne;(ne=z.current)==null||ne.forceUpdate()},transformOrigin:Co.transformOrigin.varRef,referenceRef:ce,popperRef:ge,getPopperProps:X,getArrowProps:J,getArrowInnerProps:te,getReferenceProps:se}}function F2e(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function j2e(){const n=O.useRef(new Map),e=n.current,i=O.useCallback((l,u,p,y)=>{n.current.set(p,{type:u,el:l,options:y}),l.addEventListener(u,p,y)},[]),o=O.useCallback((l,u,p,y)=>{l.removeEventListener(u,p,y),n.current.delete(p)},[]);return O.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function zU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function Mre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:p,onMouseUp:y,onClick:v,onKeyDown:w,onKeyUp:C,tabIndex:R,onMouseOver:N,onMouseLeave:M,...D}=n,[F,z]=O.useState(!0),[q,K]=O.useState(!1),re=j2e(),ce=be=>{be&&be.tagName!=="BUTTON"&&z(!1)},se=F?R:R||0,ge=i&&!o,X=O.useCallback(be=>{if(i){be.stopPropagation(),be.preventDefault();return}be.currentTarget.focus(),v==null||v(be)},[i,v]),J=O.useCallback(be=>{q&&zU(be)&&(be.preventDefault(),be.stopPropagation(),K(!1),re.remove(document,"keyup",J,!1))},[q,re]),te=O.useCallback(be=>{if(w==null||w(be),i||be.defaultPrevented||be.metaKey||!zU(be.nativeEvent)||F)return;const Re=l&&be.key==="Enter";u&&be.key===" "&&(be.preventDefault(),K(!0)),Re&&(be.preventDefault(),be.currentTarget.click()),re.add(document,"keyup",J,!1)},[i,F,w,l,u,re,J]),ne=O.useCallback(be=>{if(C==null||C(be),i||be.defaultPrevented||be.metaKey||!zU(be.nativeEvent)||F)return;u&&be.key===" "&&(be.preventDefault(),K(!1),be.currentTarget.click())},[u,F,i,C]),de=O.useCallback(be=>{be.button===0&&(K(!1),re.remove(document,"mouseup",de,!1))},[re]),pe=O.useCallback(be=>{if(be.button!==0)return;if(i){be.stopPropagation(),be.preventDefault();return}F||K(!0),be.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",de,!1),p==null||p(be)},[i,F,p,re,de]),he=O.useCallback(be=>{be.button===0&&(F||K(!1),y==null||y(be))},[y,F]),ve=O.useCallback(be=>{if(i){be.preventDefault();return}N==null||N(be)},[i,N]),Te=O.useCallback(be=>{q&&(be.preventDefault(),K(!1)),M==null||M(be)},[q,M]),Fe=Ki(e,ce);return F?{...D,ref:Fe,type:"button","aria-disabled":ge?void 0:i,disabled:ge,onClick:X,onMouseDown:p,onMouseUp:y,onKeyUp:C,onKeyDown:w,onMouseOver:N,onMouseLeave:M}:{...D,ref:Fe,role:"button","data-active":lr(q),"aria-disabled":i?"true":void 0,tabIndex:ge?void 0:se,onClick:X,onMouseDown:pe,onMouseUp:he,onKeyUp:ne,onKeyDown:te,onMouseOver:ve,onMouseLeave:Te}}const[B2e,z2e,W2e,G2e]=Lne(),[H2e,VR]=ki({strict:!1,name:"MenuContext"});function Ure(n){return(n==null?void 0:n.ownerDocument)??document}function $2e(n){return Ure(n).activeElement===n}function K2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:p,isOpen:y,defaultIsOpen:v,onClose:w,onOpen:C,placement:R="bottom-start",lazyBehavior:N="unmount",direction:M,computePositionOnMount:D=!1,...F}=n,z=O.useRef(null),q=O.useRef(null),K=O.useRef(!0),re=W2e(),ce=O.useCallback(()=>{requestAnimationFrame(()=>{var je;(je=z.current)==null||je.focus({preventScroll:!1})})},[]),se=O.useCallback(()=>{const je=setTimeout(()=>{var qe,at;if(l)(qe=l.current)==null||qe.focus();else if(!re.count())(at=z.current)==null||at.focus({preventScroll:!1});else{const _t=re.firstEnabled();_t&&ve(_t.index)}});Ae.current.add(je)},[re,l]),ge=O.useCallback(()=>{const je=setTimeout(()=>{var qe;if(!re.count())(qe=z.current)==null||qe.focus({preventScroll:!1});else{const at=re.lastEnabled();at&&ve(at.index)}});Ae.current.add(je)},[re]),X=O.useCallback(()=>{C==null||C(),u?se():ce()},[u,se,ce,C]),{isOpen:J,onOpen:te,onClose:ne,onToggle:de}=sd({isOpen:y,defaultIsOpen:v,onClose:w,onOpen:X});pee({enabled:J&&o,ref:z,handler:je=>{var at,_t,ut;const qe=((_t=(at=je.composedPath)==null?void 0:at.call(je))==null?void 0:_t[0])??je.target;(ut=q.current)!=null&&ut.contains(qe)||ne()}});const pe=P5({...F,enabled:J||D,placement:R,direction:M}),[he,ve]=O.useState(-1);uee(z,{focusRef:q,visible:J,shouldFocus:!0});const Te=aee({isOpen:J,ref:z}),[Fe,be]=Yve(e,"menu-button","menu-list"),Re=O.useCallback(()=>{te(),ce()},[te,ce]),Ae=O.useRef(new Set([]));O.useEffect(()=>{const je=Ae.current;return()=>{je.forEach(qe=>clearTimeout(qe)),je.clear()}},[]),zf(()=>{var je;J||(ve(-1),(je=z.current)==null||je.scrollTo(0,0))},[J]),zf(()=>{J&&he===-1&&ce()},[he,J]),O.useEffect(()=>{var qe;if(!J)return;const je=re.item(he);(qe=je==null?void 0:je.node)==null||qe.focus({preventScroll:!K.current})},[re,he,J]);const xe=O.useCallback(()=>{te(),se()},[se,te]),Ee=O.useCallback(()=>{K.current=!0,te(),ge()},[te,ge]),Ne=O.useCallback(()=>{var ut,vt;const je=Ure(z.current),qe=(ut=z.current)==null?void 0:ut.contains(je.activeElement);if(!(J&&!qe))return;const _t=(vt=re.item(he))==null?void 0:vt.node;_t==null||_t.focus({preventScroll:!K.current})},[J,he,re]);return{openAndFocusMenu:Re,openAndFocusFirstItem:xe,openAndFocusLastItem:Ee,onTransitionEnd:Ne,unstable__animationState:Te,descendants:re,popper:pe,buttonId:Fe,menuId:be,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:J,onToggle:de,onOpen:te,onClose:ne,menuRef:z,buttonRef:q,focusedIndex:he,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:ve,isLazy:p,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function q2e(n={},e=null){const i=VR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:p,scrollIntoViewRef:y}=i,v=O.useCallback(w=>{const C=w.key,N={Enter:u,ArrowDown:u,ArrowUp:p}[C];N&&(y.current=!0,w.preventDefault(),w.stopPropagation(),N(w))},[u,p,y]);return{...n,ref:Ki(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":lr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Mn(n.onClick,o),onKeyDown:Mn(n.onKeyDown,v)}}function cF(n){var e;return Q2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function Y2e(n={},e=null){const i=VR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:p,onClose:y,menuId:v,isLazy:w,lazyBehavior:C,scrollIntoViewRef:R,unstable__animationState:N}=i,M=z2e(),D=ELe({preventDefault:K=>K.key!==" "&&cF(K.target)}),F=O.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const re=K.key,se={Tab:X=>X.preventDefault(),Escape:X=>{X.stopPropagation(),y()},ArrowDown:()=>{R.current=!0;const X=M.nextEnabled(o)??M.firstEnabled();X&&l(X.index)},ArrowUp:()=>{R.current=!0;const X=M.prevEnabled(o)??M.firstEnabled();X&&l(X.index)}}[re];if(se){K.preventDefault(),se(K);return}const ge=D(X=>{const J=_Le(M.values(),X,te=>{var ne;return((ne=te==null?void 0:te.node)==null?void 0:ne.textContent)??""},M.item(o));if(J){const te=M.indexOf(J.node);l(te)}});cF(K.target)&&ge(K)},[M,o,D,y,l,R]),z=O.useRef(!1);p&&(z.current=!0);const q=ZF({wasSelected:z.current,enabled:w,mode:C,isSelected:N.present});return{...n,ref:Ki(u,e),children:q?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Mn(n.onKeyDown,F)}}function X2e(n={}){const{popper:e,isOpen:i}=VR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function J2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:p,isDisabled:y,isFocusable:v,closeOnSelect:w,type:C,...R}=n,N=VR(),{setFocusedIndex:M,focusedIndex:D,closeOnSelect:F,onClose:z,menuId:q,scrollIntoViewRef:K}=N,re=O.useRef(null),ce=`${q}-menuitem-${O.useId()}`,{index:se,register:ge}=G2e({disabled:y&&!v}),X=O.useCallback(ve=>{i==null||i(ve),!y&&(K.current=!1,M(se))},[M,se,y,i,K]),J=O.useCallback(ve=>{o==null||o(ve),re.current&&!$2e(re.current)&&X(ve)},[X,o]),te=O.useCallback(ve=>{l==null||l(ve),!y&&M(-1)},[M,y,l]),ne=O.useCallback(ve=>{u==null||u(ve),cF(ve.currentTarget)&&(w??F)&&z()},[z,u,F,w]),de=O.useCallback(ve=>{p==null||p(ve),M(se)},[M,p,se]),pe=se===D,he=Mre({onClick:ne,onFocus:de,onMouseEnter:X,onMouseMove:J,onMouseLeave:te,ref:Ki(ge,re,e),isDisabled:y,isFocusable:v});return{...R,...he,type:C??he.type,id:ce,role:"menuitem",tabIndex:pe?0:-1}}function Q2e(n){if(!Z2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function Z2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[eMe,FR]=ki({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),jR=n=>{const{children:e}=n,i=Fa("Menu",n),o=Bi(n),{direction:l}=X0(),{descendants:u,...p}=K2e({...o,direction:l}),y=O.useMemo(()=>p,[p]),{isOpen:v,onClose:w,forceUpdate:C}=y;return S.jsx(B2e,{value:u,children:S.jsx(H2e,{value:y,children:S.jsx(eMe,{value:i,children:gl(e,{isOpen:v,onClose:w,forceUpdate:C})})})})};jR.displayName="Menu";const tMe=Bt((n,e)=>{const i=FR();return S.jsx(Mt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),BR=Bt((n,e)=>{const{children:i,as:o,...l}=n,u=q2e(l,e),p=o||tMe;return S.jsx(p,{...u,className:En("chakra-menu__menu-button",n.className),children:S.jsx(Mt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});BR.displayName="MenuButton";const Vre=Bt((n,e)=>{const i=FR();return S.jsx(Mt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Vre.displayName="MenuCommand";const Fre=n=>{const{className:e,children:i,...o}=n,l=FR(),u=O.Children.only(i),p=O.isValidElement(u)?O.cloneElement(u,{focusable:"false","aria-hidden":!0,className:En("chakra-menu__icon",u.props.className)}):null,y=En("chakra-menu__icon-wrapper",e);return S.jsx(Mt.span,{className:y,...o,__css:l.icon,children:p})};Fre.displayName="MenuIcon";const nMe=Bt((n,e)=>{const{type:i,...o}=n,l=FR(),u=o.as||i?i??void 0:"button",p=O.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(Mt.button,{ref:e,type:u,...o,__css:p})}),Ep=Bt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:p,...y}=n,v=J2e(y,e),C=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return S.jsxs(nMe,{...v,className:En("chakra-menu__menuitem",v.className),children:[i&&S.jsx(Fre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&S.jsx(Vre,{marginStart:u,children:l})]})});Ep.displayName="MenuItem";const rMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},iMe=Mt(Up.div),zR=Bt(function(e,i){var N;const{rootProps:o,motionProps:l,...u}=e,{isOpen:p,onTransitionEnd:y,unstable__animationState:v}=VR(),w=Y2e(u,i),C=X2e(o),R=FR();return S.jsx(Mt.div,{...C,__css:{zIndex:e.zIndex??((N=R.list)==null?void 0:N.zIndex)},children:S.jsx(iMe,{variants:rMe,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...R.list},...l,...w,className:En("chakra-menu__menu-list",w.className),onUpdate:y,onAnimationComplete:tee(v.onComplete,w.onAnimationComplete)})})});zR.displayName="MenuList";var sMe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},IS=new WeakMap,Z1=new WeakMap,ek={},WU=0,jre=function(n){return n&&(n.host||jre(n.parentNode))},oMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=jre(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},aMe=function(n,e,i,o){var l=oMe(e,Array.isArray(n)?n:[n]);ek[i]||(ek[i]=new WeakMap);var u=ek[i],p=[],y=new Set,v=new Set(l),w=function(R){!R||y.has(R)||(y.add(R),w(R.parentNode))};l.forEach(w);var C=function(R){!R||v.has(R)||Array.prototype.forEach.call(R.children,function(N){if(y.has(N))C(N);else try{var M=N.getAttribute(o),D=M!==null&&M!=="false",F=(IS.get(N)||0)+1,z=(u.get(N)||0)+1;IS.set(N,F),u.set(N,z),p.push(N),F===1&&D&&Z1.set(N,!0),z===1&&N.setAttribute(i,"true"),D||N.setAttribute(o,"true")}catch(q){console.error("aria-hidden: cannot operate on ",N,q)}})};return C(e),y.clear(),WU++,function(){p.forEach(function(R){var N=IS.get(R)-1,M=u.get(R)-1;IS.set(R,N),u.set(R,M),N||(Z1.has(R)||R.removeAttribute(o),Z1.delete(R)),M||R.removeAttribute(i)}),WU--,WU||(IS=new WeakMap,IS=new WeakMap,Z1=new WeakMap,ek={})}},cMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=sMe(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),aMe(o,l,i,"aria-hidden")):function(){return null}},lMe=Object.defineProperty,uMe=(n,e,i)=>e in n?lMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,dMe=(n,e,i)=>(uMe(n,e+"",i),i);class hMe{constructor(){dMe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const lF=new hMe;function Bre(n,e){const[i,o]=O.useState(0);return O.useEffect(()=>{const l=n.current;if(l){if(e){const u=lF.add(l);o(u)}return()=>{lF.remove(l),o(0)}}},[e,n]),i}function pMe(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:p=!0,onOverlayClick:y,onEsc:v}=n,w=O.useRef(null),C=O.useRef(null),[R,N,M]=mMe(o,"chakra-modal","chakra-modal--header","chakra-modal--body");fMe(w,e&&p);const D=Bre(w,e),F=O.useRef(null),z=O.useCallback(te=>{F.current=te.target},[]),q=O.useCallback(te=>{te.key==="Escape"&&(te.stopPropagation(),u&&(i==null||i()),v==null||v())},[u,i,v]),[K,re]=O.useState(!1),[ce,se]=O.useState(!1),ge=O.useCallback((te={},ne=null)=>({role:"dialog",...te,ref:Ki(ne,w),id:R,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":ce?M:void 0,onClick:Mn(te.onClick,de=>de.stopPropagation())}),[M,ce,R,N,K]),X=O.useCallback(te=>{te.stopPropagation(),F.current===te.target&&lF.isTopModal(w.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),J=O.useCallback((te={},ne=null)=>({...te,ref:Ki(ne,C),onClick:Mn(te.onClick,X),onKeyDown:Mn(te.onKeyDown,q),onMouseDown:Mn(te.onMouseDown,z)}),[q,z,X]);return{isOpen:e,onClose:i,headerId:N,bodyId:M,setBodyMounted:se,setHeaderMounted:re,dialogRef:w,overlayRef:C,getDialogProps:ge,getDialogContainerProps:J,index:D}}function fMe(n,e){const i=n.current;O.useEffect(()=>{if(!(!n.current||!e))return cMe(n.current)},[e,n,i])}function mMe(n,...e){const i=O.useId(),o=n||i;return O.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[gMe,Q0]=ki({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[_Me,tE]=ki({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),us=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:w,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:N,lockFocusAcrossFrames:M,animatePresenceProps:D,onCloseComplete:F}=e,z=Fa("Modal",e),K={...pMe(e),autoFocus:l,trapFocus:u,initialFocusRef:p,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:w,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:N,lockFocusAcrossFrames:M};return S.jsx(_Me,{value:K,children:S.jsx(gMe,{value:z,children:S.jsx(K0,{...D,onExitComplete:F,children:K.isOpen&&S.jsx(Mc,{...i,children:o})})})})};us.displayName="Modal";var Mk="right-scroll-bar-position",Uk="width-before-scroll-bar",yMe="with-scroll-bars-hidden",EMe="--removed-body-scroll-bar-size",zre=Kne(),GU=function(){},_N=O.forwardRef(function(n,e){var i=O.useRef(null),o=O.useState({onScrollCapture:GU,onWheelCapture:GU,onTouchMoveCapture:GU}),l=o[0],u=o[1],p=n.forwardProps,y=n.children,v=n.className,w=n.removeScrollBar,C=n.enabled,R=n.shards,N=n.sideCar,M=n.noIsolation,D=n.inert,F=n.allowPinchZoom,z=n.as,q=z===void 0?"div":z,K=n.gapMode,re=LR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=N,se=Gne([i,e]),ge=yp(yp({},re),l);return O.createElement(O.Fragment,null,C&&O.createElement(ce,{sideCar:zre,removeScrollBar:w,shards:R,noIsolation:M,inert:D,setCallbacks:u,allowPinchZoom:!!F,lockRef:i,gapMode:K}),p?O.cloneElement(O.Children.only(y),yp(yp({},ge),{ref:se})):O.createElement(q,yp({},ge,{className:v,ref:se}),y))});_N.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};_N.classNames={fullWidth:Uk,zeroRight:Mk};var vMe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function SMe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=vMe();return e&&n.setAttribute("nonce",e),n}function bMe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function wMe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var TMe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=SMe())&&(bMe(e,i),wMe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},CMe=function(){var n=TMe();return function(e,i){O.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Wre=function(){var n=CMe(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},RMe={left:0,top:0,right:0,gap:0},HU=function(n){return parseInt(n||"",10)||0},IMe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[HU(i),HU(o),HU(l)]},AMe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return RMe;var e=IMe(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},PMe=Wre(),o0="data-scroll-locked",kMe=function(n,e,i,o){var l=n.left,u=n.top,p=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(yMe,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(y,"px ").concat(o,`;
  }
  body[`).concat(o0,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Mk,` {
    right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(Uk,` {
    margin-right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(Mk," .").concat(Mk,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(Uk," .").concat(Uk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(o0,`] {
    `).concat(EMe,": ").concat(y,`px;
  }
`)},QX=function(){var n=parseInt(document.body.getAttribute(o0)||"0",10);return isFinite(n)?n:0},OMe=function(){O.useEffect(function(){return document.body.setAttribute(o0,(QX()+1).toString()),function(){var n=QX()-1;n<=0?document.body.removeAttribute(o0):document.body.setAttribute(o0,n.toString())}},[])},NMe=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;OMe();var u=O.useMemo(function(){return AMe(l)},[l]);return O.createElement(PMe,{styles:kMe(u,!e,l,i?"":"!important")})},uF=!1;if(typeof window<"u")try{var tk=Object.defineProperty({},"passive",{get:function(){return uF=!0,!0}});window.addEventListener("test",tk,tk),window.removeEventListener("test",tk,tk)}catch{uF=!1}var AS=uF?{passive:!1}:!1,xMe=function(n){return n.tagName==="TEXTAREA"},Gre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!xMe(n)&&i[e]==="visible")},DMe=function(n){return Gre(n,"overflowY")},LMe=function(n){return Gre(n,"overflowX")},ZX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=Hre(n,o);if(l){var u=$re(n,o),p=u[1],y=u[2];if(p>y)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},MMe=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},UMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},Hre=function(n,e){return n==="v"?DMe(e):LMe(e)},$re=function(n,e){return n==="v"?MMe(e):UMe(e)},VMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},FMe=function(n,e,i,o,l){var u=VMe(n,window.getComputedStyle(e).direction),p=u*o,y=i.target,v=e.contains(y),w=!1,C=p>0,R=0,N=0;do{var M=$re(n,y),D=M[0],F=M[1],z=M[2],q=F-z-u*D;(D||q)&&Hre(n,y)&&(R+=q,N+=D),y instanceof ShadowRoot?y=y.host:y=y.parentNode}while(!v&&y!==document.body||v&&(e.contains(y)||e===y));return(C&&Math.abs(R)<1||!C&&Math.abs(N)<1)&&(w=!0),w},nk=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},eJ=function(n){return[n.deltaX,n.deltaY]},tJ=function(n){return n&&"current"in n?n.current:n},jMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},BMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},zMe=0,PS=[];function WMe(n){var e=O.useRef([]),i=O.useRef([0,0]),o=O.useRef(),l=O.useState(zMe++)[0],u=O.useState(Wre)[0],p=O.useRef(n);O.useEffect(function(){p.current=n},[n]),O.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=Hxe([n.lockRef.current],(n.shards||[]).map(tJ),!0).filter(Boolean);return F.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=O.useCallback(function(F,z){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!p.current.allowPinchZoom;var q=nk(F),K=i.current,re="deltaX"in F?F.deltaX:K[0]-q[0],ce="deltaY"in F?F.deltaY:K[1]-q[1],se,ge=F.target,X=Math.abs(re)>Math.abs(ce)?"h":"v";if("touches"in F&&X==="h"&&ge.type==="range")return!1;var J=ZX(X,ge);if(!J)return!0;if(J?se=X:(se=X==="v"?"h":"v",J=ZX(X,ge)),!J)return!1;if(!o.current&&"changedTouches"in F&&(re||ce)&&(o.current=se),!se)return!0;var te=o.current||se;return FMe(te,z,F,te==="h"?re:ce)},[]),v=O.useCallback(function(F){var z=F;if(!(!PS.length||PS[PS.length-1]!==u)){var q="deltaY"in z?eJ(z):nk(z),K=e.current.filter(function(se){return se.name===z.type&&(se.target===z.target||z.target===se.shadowParent)&&jMe(se.delta,q)})[0];if(K&&K.should){z.cancelable&&z.preventDefault();return}if(!K){var re=(p.current.shards||[]).map(tJ).filter(Boolean).filter(function(se){return se.contains(z.target)}),ce=re.length>0?y(z,re[0]):!p.current.noIsolation;ce&&z.cancelable&&z.preventDefault()}}},[]),w=O.useCallback(function(F,z,q,K){var re={name:F,delta:z,target:q,should:K,shadowParent:GMe(q)};e.current.push(re),setTimeout(function(){e.current=e.current.filter(function(ce){return ce!==re})},1)},[]),C=O.useCallback(function(F){i.current=nk(F),o.current=void 0},[]),R=O.useCallback(function(F){w(F.type,eJ(F),F.target,y(F,n.lockRef.current))},[]),N=O.useCallback(function(F){w(F.type,nk(F),F.target,y(F,n.lockRef.current))},[]);O.useEffect(function(){return PS.push(u),n.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:N}),document.addEventListener("wheel",v,AS),document.addEventListener("touchmove",v,AS),document.addEventListener("touchstart",C,AS),function(){PS=PS.filter(function(F){return F!==u}),document.removeEventListener("wheel",v,AS),document.removeEventListener("touchmove",v,AS),document.removeEventListener("touchstart",C,AS)}},[]);var M=n.removeScrollBar,D=n.inert;return O.createElement(O.Fragment,null,D?O.createElement(u,{styles:BMe(l)}):null,M?O.createElement(NMe,{gapMode:n.gapMode}):null)}function GMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const HMe=$xe(zre,WMe);var Kre=O.forwardRef(function(n,e){return O.createElement(_N,yp({},n,{ref:e,sideCar:HMe}))});Kre.classNames=_N.classNames;function $Me(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:p,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:w,lockFocusAcrossFrames:C,isOpen:R}=tE(),[N,M]=bj();O.useEffect(()=>{!N&&M&&setTimeout(M)},[N,M]);const D=Bre(o,R);return S.jsx(vre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:o,lockFocusAcrossFrames:C,children:S.jsx(Kre,{removeScrollBar:!w,allowPinchZoom:p,enabled:D===1&&u,forwardProps:!0,children:n.children})})}const KMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Gy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,u),...l?{...p,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...p,...o==null?void 0:o.exit}}}}},mC={initial:"initial",animate:"enter",exit:"exit",variants:KMe},qMe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:p,offsetX:y=0,offsetY:v=8,transition:w,transitionEnd:C,delay:R,animatePresenceProps:N,...M}=e,D=o?l&&o:!0,F=l||o?"enter":"exit",z={offsetX:y,offsetY:v,reverse:u,transition:w,transitionEnd:C,delay:R};return S.jsx(K0,{...N,custom:z,children:D&&S.jsx(Up.div,{ref:i,className:En("chakra-offset-slide",p),custom:z,...mC,animate:F,...M})})});qMe.displayName="SlideFade";const YMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??Gy.exit(Wy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Gy.enter(Wy.enter,i),transitionEnd:n==null?void 0:n.enter})},qre={initial:"exit",animate:"enter",exit:"exit",variants:YMe},XMe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:p=.95,className:y,transition:v,transitionEnd:w,delay:C,animatePresenceProps:R,...N}=e,M=o?l&&o:!0,D=l||o?"enter":"exit",F={initialScale:p,reverse:u,transition:v,transitionEnd:w,delay:C};return S.jsx(K0,{...R,custom:F,children:M&&S.jsx(Up.div,{ref:i,className:En("chakra-offset-slide",y),...qre,animate:D,custom:F,...N})})});XMe.displayName="ScaleFade";const JMe={slideInBottom:{...mC,custom:{offsetY:16,reverse:!0}},slideInRight:{...mC,custom:{offsetX:16,reverse:!0}},slideInTop:{...mC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...mC,custom:{offsetX:-16,reverse:!0}},scale:{...qre,custom:{initialScale:.95,reverse:!0}},none:{}},QMe=Mt(Up.section),ZMe=n=>JMe[n||"none"],Yre=O.forwardRef((n,e)=>{const{preset:i,motionProps:o=ZMe(i),...l}=n;return S.jsx(QMe,{ref:e,...o,...l})});Yre.displayName="ModalTransition";const ds=Bt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...p}=n,{getDialogProps:y,getDialogContainerProps:v}=tE(),w=y(p,e),C=v(l),R=En("chakra-modal__content",i),N=Q0(),M={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},D={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:F}=tE();return S.jsx($Me,{children:S.jsx(Mt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:D,children:S.jsx(Yre,{preset:F,motionProps:u,className:R,...w,__css:M,children:o})})})});ds.displayName="ModalContent";const ys=Bt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=tE();O.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=En("chakra-modal__body",i),y=Q0();return S.jsx(Mt.div,{ref:e,className:p,id:l,...o,__css:y.body})});ys.displayName="ModalBody";const Os=Bt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=tE(),p=En("chakra-modal__close-btn",o),y=Q0();return S.jsx(n5,{ref:e,__css:y.closeButton,className:p,onClick:Mn(i,v=>{v.stopPropagation(),u()}),...l})});Os.displayName="ModalCloseButton";const uh=Bt((n,e)=>{const{className:i,...o}=n,l=En("chakra-modal__footer",i),u=Q0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return S.jsx(Mt.footer,{ref:e,...o,__css:p,className:l})});uh.displayName="ModalFooter";const fo=Bt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=tE();O.useEffect(()=>(u(!0),()=>u(!1)),[u]);const p=En("chakra-modal__header",i),y=Q0(),v={flex:0,...y.header};return S.jsx(Mt.header,{ref:e,className:p,id:l,...o,__css:v})});fo.displayName="ModalHeader";const eUe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Gy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Gy.exit(Wy.exit,i),transitionEnd:e==null?void 0:e.exit})},Xre={initial:"exit",animate:"enter",exit:"exit",variants:eUe},tUe=O.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:p,transitionEnd:y,delay:v,animatePresenceProps:w,...C}=e,R=l||o?"enter":"exit",N=o?l&&o:!0,M={transition:p,transitionEnd:y,delay:v};return S.jsx(K0,{...w,custom:M,children:N&&S.jsx(Up.div,{ref:i,className:En("chakra-fade",u),custom:M,...Xre,animate:R,...C})})});tUe.displayName="Fade";const nUe=Mt(Up.div),hs=Bt((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,p=En("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...Q0().overlay},{motionPreset:w}=tE(),R=l||(w==="none"?{}:Xre);return S.jsx(nUe,{...R,__css:v,ref:e,className:p,...u})});hs.displayName="ModalOverlay";function rUe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(us,{...i,initialFocusRef:e})}const iUe=Bt((n,e)=>S.jsx(ds,{ref:e,role:"alertdialog",...n})),sUe=n=>S.jsx(yn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),oUe=n=>S.jsx(yn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function nJ(n,e,i,o){O.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],p=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&u.includes(v.attributeName)&&i(v)});return p.observe(n.current,{attributes:!0,attributeFilter:u}),()=>p.disconnect()})}const aUe=50,rJ=300;function cUe(n,e){const[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(!0),v=O.useRef(null),w=()=>clearTimeout(v.current);Xve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?aUe:null);const C=O.useCallback(()=>{p&&n(),v.current=setTimeout(()=>{y(!1),o(!0),u("increment")},rJ)},[n,p]),R=O.useCallback(()=>{p&&e(),v.current=setTimeout(()=>{y(!1),o(!0),u("decrement")},rJ)},[e,p]),N=O.useCallback(()=>{y(!0),o(!1),w()},[]);return O.useEffect(()=>()=>w(),[]),{up:C,down:R,stop:N,isSpinning:i}}const lUe=/^[Ee0-9+\-.]$/;function uUe(n){return lUe.test(n)}function dUe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function hUe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:p=1,isReadOnly:y,isDisabled:v,isRequired:w,isInvalid:C,pattern:R="[0-9]*(.[0-9]+)?",inputMode:N="decimal",allowMouseWheel:M,id:D,onChange:F,precision:z,name:q,"aria-describedby":K,"aria-label":re,"aria-labelledby":ce,onFocus:se,onBlur:ge,onInvalid:X,getAriaValueText:J,isValidCharacter:te,format:ne,parse:de,...pe}=n,he=uo(se),ve=uo(ge),Te=uo(X),Fe=uo(te??uUe),be=uo(J),Re=Mve(n),{update:Ae,increment:xe,decrement:Ee}=Re,[Ne,je]=O.useState(!1),qe=!(y||v),at=O.useRef(null),_t=O.useRef(null),ut=O.useRef(null),vt=O.useRef(null),it=O.useCallback(Rt=>Rt.split("").filter(Fe).join(""),[Fe]),wt=O.useCallback(Rt=>(de==null?void 0:de(Rt))??Rt,[de]),$t=O.useCallback(Rt=>((ne==null?void 0:ne(Rt))??Rt).toString(),[ne]);zf(()=>{(Re.valueAsNumber>u||Re.valueAsNumber<l)&&(Te==null||Te("rangeOverflow",$t(Re.value),Re.valueAsNumber))},[Re.valueAsNumber,Re.value,$t,Te]),Cp(()=>{if(!at.current)return;if(at.current.value!=Re.value){const Zn=wt(at.current.value);Re.setValue(it(Zn))}},[wt,it]);const dt=O.useCallback((Rt=p)=>{qe&&xe(Rt)},[xe,qe,p]),mt=O.useCallback((Rt=p)=>{qe&&Ee(Rt)},[Ee,qe,p]),ct=cUe(dt,mt);nJ(ut,"disabled",ct.stop,ct.isSpinning),nJ(vt,"disabled",ct.stop,ct.isSpinning);const Ft=O.useCallback(Rt=>{if(Rt.nativeEvent.isComposing)return;const Dt=wt(Rt.currentTarget.value);Ae(it(Dt)),_t.current={start:Rt.currentTarget.selectionStart,end:Rt.currentTarget.selectionEnd}},[Ae,it,wt]),sn=O.useCallback(Rt=>{var Zn;he==null||he(Rt),_t.current&&(Rt.currentTarget.selectionStart=_t.current.start??((Zn=Rt.currentTarget.value)==null?void 0:Zn.length),Rt.currentTarget.selectionEnd=_t.current.end??Rt.currentTarget.selectionStart)},[he]),Ht=O.useCallback(Rt=>{if(Rt.nativeEvent.isComposing)return;dUe(Rt,Fe)||Rt.preventDefault();const Zn=we(Rt)*p,Dt=Rt.key,Vr={ArrowUp:()=>dt(Zn),ArrowDown:()=>mt(Zn),Home:()=>Ae(l),End:()=>Ae(u)}[Dt];Vr&&(Rt.preventDefault(),Vr(Rt))},[Fe,p,dt,mt,Ae,l,u]),we=Rt=>{let Zn=1;return(Rt.metaKey||Rt.ctrlKey)&&(Zn=.1),Rt.shiftKey&&(Zn=10),Zn},De=O.useMemo(()=>{const Rt=be==null?void 0:be(Re.value);if(Rt!=null)return Rt;const Zn=Re.value.toString();return Zn||void 0},[Re.value,be]),$e=O.useCallback(()=>{let Rt=Re.value;if(Re.value==="")return;/^[eE]/.test(Re.value.toString())?Re.setValue(""):(Re.valueAsNumber<l&&(Rt=l),Re.valueAsNumber>u&&(Rt=u),Re.cast(Rt))},[Re,u,l]),kt=O.useCallback(()=>{je(!1),i&&$e()},[i,je,$e]),At=O.useCallback(()=>{e&&requestAnimationFrame(()=>{var Rt;(Rt=at.current)==null||Rt.focus()})},[e]),Tt=O.useCallback(Rt=>{Rt.preventDefault(),ct.up(),At()},[At,ct]),Ut=O.useCallback(Rt=>{Rt.preventDefault(),ct.down(),At()},[At,ct]);Vy(()=>at.current,"wheel",Rt=>{var Oi;const Dt=(((Oi=at.current)==null?void 0:Oi.ownerDocument)??document).activeElement===at.current;if(!M||!Dt)return;Rt.preventDefault();const Xt=we(Rt)*p,Vr=Math.sign(Rt.deltaY);Vr===-1?dt(Xt):Vr===1&&mt(Xt)},{passive:!1});const Sn=O.useCallback((Rt={},Zn=null)=>{const Dt=v||o&&Re.isAtMax;return{...Rt,ref:Ki(Zn,ut),role:"button",tabIndex:-1,onPointerDown:Mn(Rt.onPointerDown,Xt=>{Xt.button!==0||Dt||Tt(Xt)}),onPointerLeave:Mn(Rt.onPointerLeave,ct.stop),onPointerUp:Mn(Rt.onPointerUp,ct.stop),disabled:Dt,"aria-disabled":Lf(Dt)}},[Re.isAtMax,o,Tt,ct.stop,v]),Pn=O.useCallback((Rt={},Zn=null)=>{const Dt=v||o&&Re.isAtMin;return{...Rt,ref:Ki(Zn,vt),role:"button",tabIndex:-1,onPointerDown:Mn(Rt.onPointerDown,Xt=>{Xt.button!==0||Dt||Ut(Xt)}),onPointerLeave:Mn(Rt.onPointerLeave,ct.stop),onPointerUp:Mn(Rt.onPointerUp,ct.stop),disabled:Dt,"aria-disabled":Lf(Dt)}},[Re.isAtMin,o,Ut,ct.stop,v]),hn=O.useCallback((Rt={},Zn=null)=>({name:q,inputMode:N,type:"text",pattern:R,"aria-labelledby":ce,"aria-label":re,"aria-describedby":K,id:D,disabled:v,role:"spinbutton",...Rt,readOnly:Rt.readOnly??y,"aria-readonly":Rt.readOnly??y,"aria-required":Rt.required??w,required:Rt.required??w,ref:Ki(at,Zn),value:$t(Re.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(Re.valueAsNumber)?void 0:Re.valueAsNumber,"aria-invalid":Lf(C??Re.isOutOfRange),"aria-valuetext":De,autoComplete:"off",autoCorrect:"off",onChange:Mn(Rt.onChange,Ft),onKeyDown:Mn(Rt.onKeyDown,Ht),onFocus:Mn(Rt.onFocus,sn,()=>je(!0)),onBlur:Mn(Rt.onBlur,ve,kt)}),[q,N,R,ce,re,$t,K,D,v,w,y,C,Re.value,Re.valueAsNumber,Re.isOutOfRange,l,u,De,Ft,Ht,sn,ve,kt]);return{value:$t(Re.value),valueAsNumber:Re.valueAsNumber,isFocused:Ne,isDisabled:v,isReadOnly:y,getIncrementButtonProps:Sn,getDecrementButtonProps:Pn,getInputProps:hn,htmlProps:pe}}const[pUe,yN]=ki({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[fUe,k5]=ki({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),jo=Bt(function(e,i){const o=Fa("NumberInput",e),l=Bi(e),u=o5(l),{htmlProps:p,...y}=hUe(u),v=O.useMemo(()=>y,[y]);return S.jsx(fUe,{value:v,children:S.jsx(pUe,{value:o,children:S.jsx(Mt.div,{...p,ref:i,className:En("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});jo.displayName="NumberInput";const Bo=Bt(function(e,i){const o=yN();return S.jsx(Mt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Bo.displayName="NumberInputStepper";const zo=Bt(function(e,i){const{getInputProps:o}=k5(),l=o(e,i),u=yN();return S.jsx(Mt.input,{...l,className:En("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});zo.displayName="NumberInputField";const Jre=Mt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Wo=Bt(function(e,i){const o=yN(),{getDecrementButtonProps:l}=k5(),u=l(e,i);return S.jsx(Jre,{...u,__css:o.stepper,children:e.children??S.jsx(sUe,{})})});Wo.displayName="NumberDecrementStepper";const Go=Bt(function(e,i){const{getIncrementButtonProps:o}=k5(),l=o(e,i),u=yN();return S.jsx(Jre,{...l,__css:u.stepper,children:e.children??S.jsx(oUe,{})})});Go.displayName="NumberIncrementStepper";const[mUe,EN]=ki({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[gUe,Qre]=ki({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),kS={click:"click",hover:"hover"};function _Ue(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:p=!0,arrowSize:y,arrowShadowColor:v,trigger:w=kS.click,openDelay:C=200,closeDelay:R=200,isLazy:N,lazyBehavior:M="unmount",computePositionOnMount:D,...F}=n,{isOpen:z,onClose:q,onOpen:K,onToggle:re}=sd(n),[ce,se]=O.useState(u);O.useEffect(()=>se(u),[u]);const ge=O.useRef(null),X=O.useRef(null),J=O.useRef(null),te=O.useRef(!1),ne=O.useRef(!1);z&&(ne.current=!0);const[de,pe]=O.useState(!1),[he,ve]=O.useState(!1),Te=O.useId(),Fe=l??Te,[be,Re,Ae,xe]=["popover-trigger","popover-content","popover-header","popover-body"].map(Ht=>`${Ht}-${Fe}`),{referenceRef:Ee,getArrowProps:Ne,getPopperProps:je,getArrowInnerProps:qe,forceUpdate:at}=P5({...F,enabled:z||!!D}),_t=aee({isOpen:z,ref:J});Kve({enabled:z,ref:X}),uee(J,{focusRef:X,visible:z,shouldFocus:ce&&w===kS.click}),Fve(J,{focusRef:o,visible:z,shouldFocus:p&&w===kS.click}),pee({enabled:z&&e,ref:J,handler(Ht){var De;const we=((De=Ht.composedPath)==null?void 0:De.call(Ht)[0])??[Ht.target];rk(X.current,we)||(we&&se(!tO(we)),q())}});const ut=ZF({wasSelected:ne.current,enabled:N,mode:M,isSelected:_t.present}),vt=O.useCallback((Ht={},we=null)=>{const De={...Ht,style:{...Ht.style,transformOrigin:Co.transformOrigin.varRef,[Co.arrowSize.var]:y?`${y}px`:void 0,[Co.arrowShadowColor.var]:v},ref:Ki(J,we),children:ut?Ht.children:null,id:Re,tabIndex:-1,role:"dialog",onKeyDown:Mn(Ht.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),q())}),onBlur:Mn(Ht.onBlur,$e=>{const kt=iJ($e),At=rk(J.current,kt),Tt=rk(X.current,kt),Ut=!At&&!Tt;kt&&se(!tO(kt)),z&&e&&Ut&&q()}),"aria-labelledby":de?Ae:void 0,"aria-describedby":he?xe:void 0};return w===kS.hover&&(De.role="tooltip",De.onMouseEnter=Mn(Ht.onMouseEnter,()=>{te.current=!0}),De.onMouseLeave=Mn(Ht.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(te.current=!1,setTimeout(()=>q(),R))})),De},[ut,Re,de,Ae,he,xe,w,i,q,z,e,R,v,y]),it=O.useCallback((Ht={},we=null)=>je({...Ht,style:{visibility:z?"visible":"hidden",...Ht.style}},we),[z,je]),wt=O.useCallback((Ht,we=null)=>({...Ht,ref:Ki(we,ge,Ee)}),[ge,Ee]),$t=O.useRef(void 0),dt=O.useRef(void 0),mt=O.useCallback(Ht=>{ge.current==null&&Ee(Ht)},[Ee]),ct=O.useCallback((Ht={},we=null)=>{const De={...Ht,ref:Ki(X,we,mt),id:be,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":Re};return w===kS.click&&(De.onClick=Mn(Ht.onClick,re)),w===kS.hover&&(De.onFocus=Mn(Ht.onFocus,()=>{$t.current===void 0&&K()}),De.onBlur=Mn(Ht.onBlur,$e=>{const kt=iJ($e),At=!rk(J.current,kt);z&&e&&At&&q()}),De.onKeyDown=Mn(Ht.onKeyDown,$e=>{$e.key==="Escape"&&q()}),De.onMouseEnter=Mn(Ht.onMouseEnter,()=>{te.current=!0,$t.current=window.setTimeout(()=>K(),C)}),De.onMouseLeave=Mn(Ht.onMouseLeave,()=>{te.current=!1,$t.current&&(clearTimeout($t.current),$t.current=void 0),dt.current=window.setTimeout(()=>{te.current===!1&&q()},R)})),De},[be,z,Re,w,mt,re,K,e,q,C,R]);O.useEffect(()=>()=>{$t.current&&clearTimeout($t.current),dt.current&&clearTimeout(dt.current)},[]);const Ft=O.useCallback((Ht={},we=null)=>({...Ht,id:Ae,ref:Ki(we,De=>{pe(!!De)})}),[Ae]),sn=O.useCallback((Ht={},we=null)=>({...Ht,id:xe,ref:Ki(we,De=>{ve(!!De)})}),[xe]);return{forceUpdate:at,isOpen:z,onAnimationComplete:_t.onComplete,onClose:q,getAnchorProps:wt,getArrowProps:Ne,getArrowInnerProps:qe,getPopoverPositionerProps:it,getPopoverProps:vt,getTriggerProps:ct,getHeaderProps:Ft,getBodyProps:sn}}function rk(n,e){return n===e||(n==null?void 0:n.contains(e))}function iJ(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Zre(n){const e=Fa("Popover",n),{children:i,...o}=Bi(n),l=X0(),u=_Ue({...o,direction:l.direction});return S.jsx(mUe,{value:u,children:S.jsx(gUe,{value:e,children:gl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}Zre.displayName="Popover";function eie(n){var i;const e=O.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const tie=Bt(function(e,i){const{getBodyProps:o}=EN(),l=Qre();return S.jsx(Mt.div,{...o(e,i),className:En("chakra-popover__body",e.className),__css:l.body})});tie.displayName="PopoverBody";function yUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const EUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},vUe=Mt(Up.section),nie=Bt(function(e,i){const{variants:o=EUe,...l}=e,{isOpen:u}=EN();return S.jsx(vUe,{ref:i,variants:yUe(o),initial:!1,animate:u?"enter":"exit",...l})});nie.displayName="PopoverTransition";const rie=Bt(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:p,getPopoverPositionerProps:y,onAnimationComplete:v}=EN(),w=Qre(),C={position:"relative",display:"flex",flexDirection:"column",...w.content};return S.jsx(Mt.div,{...y(o),__css:w.popper,className:"chakra-popover__popper",children:S.jsx(nie,{...l,...p(u,i),onAnimationComplete:tee(v,u.onAnimationComplete),className:En("chakra-popover__content",e.className),__css:C})})});rie.displayName="PopoverContent";function iie(n){const e=O.Children.only(n.children),{getTriggerProps:i}=EN();return S.jsx(S.Fragment,{children:O.cloneElement(e,i(e.props,eie(e)))})}iie.displayName="PopoverTrigger";function SUe(n,e,i){return(n-e)*100/(i-e)}AR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});AR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const bUe=AR({"0%":{left:"-40%"},"100%":{left:"100%"}}),wUe=AR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function TUe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:p,role:y="progressbar"}=n,v=SUe(e,i,o);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,v):l})(),role:y},percent:v,value:e}}const[CUe,RUe]=ki({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),IUe=Bt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:p,...y}=n,v=TUe({value:l,min:i,max:o,isIndeterminate:u,role:p}),C={height:"100%",...RUe().filledTrack};return S.jsx(Mt.div,{ref:e,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:C})}),qy=Bt((n,e)=>{var X;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:p,children:y,borderRadius:v,isIndeterminate:w,"aria-label":C,"aria-labelledby":R,"aria-valuetext":N,title:M,role:D,...F}=Bi(n),z=Fa("Progress",n),q=v??((X=z.track)==null?void 0:X.borderRadius),K={animation:`${wUe} 1s linear infinite`},se={...!w&&u&&p&&K,...w&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${bUe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...z.track};return S.jsx(Mt.div,{ref:e,borderRadius:q,__css:ge,...F,children:S.jsxs(CUe,{value:z,children:[S.jsx(IUe,{"aria-label":C,"aria-labelledby":R,"aria-valuetext":N,min:o,max:l,value:i,isIndeterminate:w,css:se,borderRadius:q,title:M,role:D}),y]})})});qy.displayName="Progress";const sie=Bt(function(e,i){const{children:o,placeholder:l,className:u,...p}=e;return S.jsxs(Mt.select,{...p,ref:i,className:En("chakra-select",u),children:[l&&S.jsx("option",{value:"",children:l}),o]})});sie.displayName="SelectField";const oie=Bt((n,e)=>{var re;const i=Fa("Select",n),{rootProps:o,placeholder:l,icon:u,color:p,height:y,h:v,minH:w,minHeight:C,iconColor:R,iconSize:N,...M}=Bi(n),[D,F]=Pve(M,qSe),z=s5(F),q={width:"100%",height:"fit-content",position:"relative",color:p},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(re=i.field)==null?void 0:re._focus}};return S.jsxs(Mt.div,{className:"chakra-select__wrapper",__css:q,...D,...o,children:[S.jsx(sie,{ref:e,height:v??y,minH:w??C,placeholder:l,...z,__css:K,children:n.children}),S.jsx(aie,{"data-disabled":lr(z.disabled),...(R||p)&&{color:R||p},__css:i.icon,...N&&{fontSize:N},children:u})]})});oie.displayName="Select";const AUe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),PUe=Mt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),aie=n=>{const{children:e=S.jsx(AUe,{}),...i}=n,o=O.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(PUe,{...i,className:"chakra-select__icon-wrapper",children:O.isValidElement(e)?o:null})};aie.displayName="SelectIcon";function $U(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function kUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=M=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...$U({orientation:e,vertical:{bottom:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...$U({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,o?100-i[0]:i[0]],w=y?v:i;let C=w[0];!y&&o&&(C=100-C);const R=Math.abs(w[w.length-1]-w[0]),N={...p,...$U({orientation:e,vertical:o?{height:`${R}%`,top:`${C}%`}:{height:`${R}%`,bottom:`${C}%`},horizontal:o?{width:`${R}%`,right:`${C}%`}:{width:`${R}%`,left:`${C}%`}})};return{trackStyle:p,innerTrackStyle:N,rootStyle:u,getThumbStyle:l}}function OUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function NUe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:p,direction:y="ltr",orientation:v="horizontal",id:w,isDisabled:C,isReadOnly:R,onChangeStart:N,onChangeEnd:M,step:D=1,getAriaValueText:F,"aria-valuetext":z,"aria-label":q,"aria-labelledby":K,name:re,focusThumbOnChange:ce=!0,...se}=n,ge=uo(N),X=uo(M),J=uo(F),te=OUe({isReversed:p,direction:y,orientation:v}),[ne,de]=cee({value:l,defaultValue:u??DUe(e,i),onChange:o}),[pe,he]=O.useState(!1),[ve,Te]=O.useState(!1),Fe=!(C||R),be=(i-e)/10,Re=D||(i-e)/100,Ae=Ek(ne,e,i),xe=i-Ae+e,Ne=uq(te?xe:Ae,e,i),je=v==="vertical",qe=hee({min:e,max:i,step:D,isDisabled:C,value:Ae,isInteractive:Fe,isReversed:te,isVertical:je,eventSource:null,focusThumbOnChange:ce,orientation:v}),at=O.useRef(null),_t=O.useRef(null),ut=O.useRef(null),vt=O.useId(),it=w??vt,[wt,$t]=[`slider-thumb-${it}`,`slider-track-${it}`],dt=O.useCallback(Dt=>{var xi;if(!at.current)return;const Xt=qe.current;Xt.eventSource="pointer";const Vr=at.current.getBoundingClientRect(),{clientX:Oi,clientY:li}=((xi=Dt.touches)==null?void 0:xi[0])??Dt,Ni=je?Vr.bottom-li:Oi-Vr.left,Es=je?Vr.height:Vr.width;let Yo=Ni/Es;te&&(Yo=1-Yo);let qi=Cve(Yo,Xt.min,Xt.max);return Xt.step&&(qi=parseFloat(dq(qi,Xt.min,Xt.step))),qi=Ek(qi,Xt.min,Xt.max),qi},[je,te,qe]),mt=O.useCallback(Dt=>{const Xt=qe.current;Xt.isInteractive&&(Dt=parseFloat(dq(Dt,Xt.min,Re)),Dt=Ek(Dt,Xt.min,Xt.max),de(Dt))},[Re,de,qe]),ct=O.useMemo(()=>({stepUp(Dt=Re){const Xt=te?Ae-Dt:Ae+Dt;mt(Xt)},stepDown(Dt=Re){const Xt=te?Ae+Dt:Ae-Dt;mt(Xt)},reset(){mt(u||0)},stepTo(Dt){mt(Dt)}}),[mt,te,Ae,Re,u]),Ft=O.useCallback(Dt=>{const Xt=qe.current,Oi={ArrowRight:()=>ct.stepUp(),ArrowUp:()=>ct.stepUp(),ArrowLeft:()=>ct.stepDown(),ArrowDown:()=>ct.stepDown(),PageUp:()=>ct.stepUp(be),PageDown:()=>ct.stepDown(be),Home:()=>mt(Xt.min),End:()=>mt(Xt.max)}[Dt.key];Oi&&(Dt.preventDefault(),Dt.stopPropagation(),Oi(Dt),Xt.eventSource="keyboard")},[ct,mt,be,qe]),sn=(J==null?void 0:J(Ae))??z,{getThumbStyle:Ht,rootStyle:we,trackStyle:De,innerTrackStyle:$e}=O.useMemo(()=>{const Dt=qe.current;return kUe({isReversed:te,orientation:Dt.orientation,thumbPercents:[Ne]})},[te,Ne,qe]),kt=O.useCallback(()=>{qe.current.focusThumbOnChange&&setTimeout(()=>{var Xt;return(Xt=_t.current)==null?void 0:Xt.focus()})},[qe]);zf(()=>{const Dt=qe.current;kt(),Dt.eventSource==="keyboard"&&(X==null||X(Dt.value))},[Ae,X]);function At(Dt){const Xt=dt(Dt);Xt!=null&&Xt!==qe.current.value&&de(Xt)}fSe(ut,{onPanSessionStart(Dt){const Xt=qe.current;Xt.isInteractive&&(he(!0),kt(),At(Dt),ge==null||ge(Xt.value))},onPanSessionEnd(){const Dt=qe.current;Dt.isInteractive&&(he(!1),X==null||X(Dt.value))},onPan(Dt){qe.current.isInteractive&&At(Dt)}});const Tt=O.useCallback((Dt={},Xt=null)=>({...Dt,...se,ref:Ki(Xt,ut),tabIndex:-1,"aria-disabled":Lf(C),"data-focused":lr(ve),style:{...Dt.style,...we}}),[se,C,ve,we]),Ut=O.useCallback((Dt={},Xt=null)=>({...Dt,ref:Ki(Xt,at),id:$t,"data-disabled":lr(C),style:{...Dt.style,...De}}),[C,$t,De]),Sn=O.useCallback((Dt={},Xt=null)=>({...Dt,ref:Xt,style:{...Dt.style,...$e}}),[$e]),Pn=O.useCallback((Dt={},Xt=null)=>({...Dt,ref:Ki(Xt,_t),role:"slider",tabIndex:Fe?0:void 0,id:wt,"data-active":lr(pe),"aria-valuetext":sn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Ae,"aria-orientation":v,"aria-disabled":Lf(C),"aria-readonly":Lf(R),"aria-label":q,"aria-labelledby":q?void 0:K,style:{...Dt.style,...Ht(0)},onKeyDown:Mn(Dt.onKeyDown,Ft),onFocus:Mn(Dt.onFocus,()=>Te(!0)),onBlur:Mn(Dt.onBlur,()=>Te(!1))}),[Fe,wt,pe,sn,e,i,Ae,v,C,R,q,K,Ht,Ft]),hn=O.useCallback((Dt,Xt=null)=>{const Vr=!(Dt.value<e||Dt.value>i),Oi=Ae>=Dt.value,li=uq(Dt.value,e,i),Ni={position:"absolute",pointerEvents:"none",...xUe({orientation:v,vertical:{bottom:te?`${100-li}%`:`${li}%`},horizontal:{left:te?`${100-li}%`:`${li}%`}})};return{...Dt,ref:Xt,role:"presentation","aria-hidden":!0,"data-disabled":lr(C),"data-invalid":lr(!Vr),"data-highlighted":lr(Oi),style:{...Dt.style,...Ni}}},[C,te,i,e,v,Ae]),Rt=O.useCallback((Dt={},Xt=null)=>({...Dt,ref:Xt,type:"hidden",value:Ae,name:re}),[re,Ae]);return{state:{value:Ae,isFocused:ve,isDragging:pe},actions:ct,getRootProps:Tt,getTrackProps:Ut,getInnerTrackProps:Sn,getThumbProps:Pn,getMarkerProps:hn,getInputProps:Rt}}function xUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function DUe(n,e){return e<n?n:n+(e-n)/2}const[LUe,vN]=ki({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[MUe,SN]=ki({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),a0=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=Fa("Slider",i),l=Bi(i),{direction:u}=X0();l.direction=u;const{getInputProps:p,getRootProps:y,...v}=NUe(l),w=y(),C=p({},e);return S.jsx(LUe,{value:v,children:S.jsx(MUe,{value:o,children:S.jsxs(Mt.div,{...w,className:En("chakra-slider",i.className),__css:o.container,children:[i.children,S.jsx("input",{...C})]})})})});a0.displayName="Slider";const c0=Bt((n,e)=>{const{getThumbProps:i}=vN(),o=SN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:En("chakra-slider__thumb",n.className),__css:o.thumb})});c0.displayName="SliderThumb";const l0=Bt((n,e)=>{const{getTrackProps:i}=vN(),o=SN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:En("chakra-slider__track",n.className),__css:o.track})});l0.displayName="SliderTrack";const u0=Bt((n,e)=>{const{getInnerTrackProps:i}=vN(),o=SN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:En("chakra-slider__filled-track",n.className),__css:o.filledTrack})});u0.displayName="SliderFilledTrack";const UUe=Bt((n,e)=>{const{getMarkerProps:i}=vN(),o=SN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:En("chakra-slider__marker",n.className),__css:o.mark})});UUe.displayName="SliderMark";const d0=Mt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});d0.displayName="Spacer";const cie=n=>S.jsx(Mt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});cie.displayName="StackItem";function VUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":XO(i,l=>o[l])}}const O5=Bt((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:p="0.5rem",wrap:y,children:v,divider:w,className:C,shouldWrapChildren:R,...N}=n,M=i?"row":o??"column",D=O.useMemo(()=>VUe({spacing:p,direction:M}),[p,M]),F=!!w,z=!R&&!F,q=O.useMemo(()=>{const re=qO(v);return z?re:re.map((ce,se)=>{const ge=typeof ce.key<"u"?ce.key:se,X=se+1===re.length,te=R?S.jsx(cie,{children:ce},ge):ce;if(!F)return te;const ne=O.cloneElement(w,{__css:D}),de=X?null:ne;return S.jsxs(O.Fragment,{children:[te,de]},ge)})},[w,D,F,z,R,v]),K=En("chakra-stack",C);return S.jsx(Mt.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:M,flexWrap:y,gap:F?void 0:p,className:K,...N,children:q})});O5.displayName="Stack";const Bn=Bt((n,e)=>S.jsx(O5,{align:"center",...n,direction:"row",ref:e}));Bn.displayName="HStack";const Rr=Bt((n,e)=>S.jsx(O5,{align:"center",...n,direction:"column",ref:e}));Rr.displayName="VStack";const oh=Bt(function(e,i){const o=Fa("Switch",e),{spacing:l="0.5rem",children:u,...p}=Bi(e),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:w,getRootProps:C,getLabelProps:R}=xxe(p),N=O.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),M=O.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),D=O.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return S.jsxs(Mt.label,{...C(),className:En("chakra-switch",e.className),__css:N,children:[S.jsx("input",{className:"chakra-switch__input",...v({},i)}),S.jsx(Mt.span,{...w(),className:"chakra-switch__track",__css:M,children:S.jsx(Mt.span,{__css:o.thumb,className:"chakra-switch__thumb",...y()})}),u&&S.jsx(Mt.span,{className:"chakra-switch__label",...R(),__css:D,children:u})]})});oh.displayName="Switch";const[FUe,jUe,BUe,zUe]=Lne();function WUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:p="unmount",orientation:y="horizontal",direction:v="ltr",...w}=n,[C,R]=O.useState(e??0),[N,M]=cee({defaultValue:e??0,value:o,onChange:i});O.useEffect(()=>{o!=null&&R(o)},[o]);const D=BUe(),F=O.useId();return{id:`tabs-${n.id??F}`,selectedIndex:N,focusedIndex:C,setSelectedIndex:M,setFocusedIndex:R,isManual:l,isLazy:u,lazyBehavior:p,orientation:y,descendants:D,direction:v,htmlProps:w}}const[GUe,bN]=ki({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function HUe(n){const{focusedIndex:e,orientation:i,direction:o}=bN(),l=jUe(),u=O.useCallback(p=>{const y=()=>{var re;const K=l.nextEnabled(e);K&&((re=K.node)==null||re.focus())},v=()=>{var re;const K=l.prevEnabled(e);K&&((re=K.node)==null||re.focus())},w=()=>{var re;const K=l.firstEnabled();K&&((re=K.node)==null||re.focus())},C=()=>{var re;const K=l.lastEnabled();K&&((re=K.node)==null||re.focus())},R=i==="horizontal",N=i==="vertical",M=p.key,D=o==="ltr"?"ArrowLeft":"ArrowRight",F=o==="ltr"?"ArrowRight":"ArrowLeft",q={[D]:()=>R&&v(),[F]:()=>R&&y(),ArrowDown:()=>N&&y(),ArrowUp:()=>N&&v(),Home:w,End:C}[M];q&&(p.preventDefault(),q(p))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Mn(n.onKeyDown,u)}}function $Ue(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:p,setFocusedIndex:y,selectedIndex:v}=bN(),{index:w,register:C}=zUe({disabled:e&&!i}),R=w===v,N=()=>{l(w)},M=()=>{y(w),!u&&!(e&&i)&&l(w)};return{...Mre({...o,ref:Ki(C,n.ref),isDisabled:e,isFocusable:i,onClick:Mn(n.onClick,N)}),id:lie(p,w),role:"tab",tabIndex:R?0:-1,type:"button","aria-selected":R,"aria-controls":uie(p,w),onFocus:e?void 0:Mn(n.onFocus,M)}}const[KUe,qUe]=ki({});function YUe(n){const e=bN(),{id:i,selectedIndex:o}=e,u=qO(n.children).map((p,y)=>O.createElement(KUe,{key:p.key??y,value:{isSelected:y===o,id:uie(i,y),tabId:lie(i,y),selectedIndex:o}},p));return{...n,children:u}}function XUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=bN(),{isSelected:u,id:p,tabId:y}=qUe(),v=O.useRef(!1);u&&(v.current=!0);const w=ZF({wasSelected:v.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:w?e:null,role:"tabpanel","aria-labelledby":y,hidden:!u,id:p}}function lie(n,e){return`${n}--tab-${e}`}function uie(n,e){return`${n}--tabpanel-${e}`}const[JUe,wN]=ki({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),k0=Bt(function(e,i){const o=Fa("Tabs",e),{children:l,className:u,...p}=Bi(e),{htmlProps:y,descendants:v,...w}=WUe(p),C=O.useMemo(()=>w,[w]),{isFitted:R,...N}=y,M={position:"relative",...o.root};return S.jsx(FUe,{value:v,children:S.jsx(GUe,{value:C,children:S.jsx(JUe,{value:o,children:S.jsx(Mt.div,{className:En("chakra-tabs",u),ref:i,...N,__css:M,children:l})})})})});k0.displayName="Tabs";const xa=Bt(function(e,i){const o=wN(),l=$Ue({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return S.jsx(Mt.button,{...l,className:En("chakra-tabs__tab",e.className),__css:u})});xa.displayName="Tab";const O0=Bt(function(e,i){const o=HUe({...e,ref:i}),l=wN(),u={display:"flex",...l.tablist};return S.jsx(Mt.div,{...o,className:En("chakra-tabs__tablist",e.className),__css:u})});O0.displayName="TabList";const Oc=Bt(function(e,i){const o=XUe({...e,ref:i}),l=wN();return S.jsx(Mt.div,{outline:"0",...o,className:En("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Oc.displayName="TabPanel";const dR=Bt(function(e,i){const o=YUe(e),l=wN();return S.jsx(Mt.div,{...o,width:"100%",ref:i,className:En("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});dR.displayName="TabPanels";const[QUe,die]=ki({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),hie=Bt((n,e)=>{const i=Fa("Tag",n),o=Bi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return S.jsx(QUe,{value:i,children:S.jsx(Mt.span,{ref:e,...o,__css:l})})});hie.displayName="Tag";const pie=Bt((n,e)=>{const i=die();return S.jsx(Mt.span,{ref:e,noOfLines:1,...n,__css:i.label})});pie.displayName="TagLabel";const ZUe=Bt((n,e)=>S.jsx(yn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));ZUe.displayName="TagLeftIcon";const eVe=Bt((n,e)=>S.jsx(yn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));eVe.displayName="TagRightIcon";const fie=n=>S.jsx(yn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:S.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});fie.displayName="TagCloseIcon";const mie=Bt((n,e)=>{const{isDisabled:i,children:o,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...die().closeButton};return S.jsx(Mt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:o||S.jsx(fie,{})})});mie.displayName="TagCloseButton";const tVe=["h","minH","height","minHeight"],gie=Bt((n,e)=>{const i=lu("Textarea",n),{className:o,rows:l,...u}=Bi(n),p=s5(u),y=l?H0(i,tVe):i;return S.jsx(Mt.textarea,{ref:e,rows:l,...p,className:En("chakra-textarea",o),__css:y})});gie.displayName="Textarea";function nVe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function rVe(n,e){const i=l=>({...e,...l,position:nVe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),p=Nne(u);return _p.notify(p,u)};return o.update=(l,u)=>{_p.update(l,i(u))},o.promise=(l,u)=>{const p=o({...u.loading,status:"loading",duration:null});l.then(y=>o.update(p,{status:"success",duration:5e3,...gl(u.success,y)})).catch(y=>o.update(p,{status:"error",duration:5e3,...gl(u.error,y)}))},o.closeAll=_p.closeAll,o.close=_p.close,o.isActive=_p.isActive,o}function ja(n){const{theme:e}=Pne(),i=sxe();return O.useMemo(()=>rVe(e.direction,{...i,...n}),[n,e.direction,i])}const iVe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},dF=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},Vk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function sVe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:p=l,closeOnEsc:y=!0,onOpen:v,onClose:w,placement:C,id:R,isOpen:N,defaultIsOpen:M,arrowSize:D=10,arrowShadowColor:F,arrowPadding:z,modifiers:q,isDisabled:K,gutter:re,offset:ce,direction:se,...ge}=n,{isOpen:X,onOpen:J,onClose:te}=sd({isOpen:N,defaultIsOpen:M,onOpen:v,onClose:w}),{referenceRef:ne,getPopperProps:de,getArrowInnerProps:pe,getArrowProps:he}=P5({enabled:X,placement:C,arrowPadding:z,modifiers:q,gutter:re,offset:ce,direction:se}),ve=O.useId(),Fe=`tooltip-${R??ve}`,be=O.useRef(null),Re=O.useRef(void 0),Ae=O.useCallback(()=>{Re.current&&(clearTimeout(Re.current),Re.current=void 0)},[]),xe=O.useRef(void 0),Ee=O.useCallback(()=>{xe.current&&(clearTimeout(xe.current),xe.current=void 0)},[]),Ne=O.useCallback(()=>{Ee(),te()},[te,Ee]),je=oVe(be,Ne),qe=O.useCallback(()=>{if(!K&&!Re.current){X&&je();const dt=Vk(be);Re.current=dt.setTimeout(J,e)}},[je,K,X,J,e]),at=O.useCallback(()=>{Ae();const dt=Vk(be);xe.current=dt.setTimeout(Ne,i)},[i,Ne,Ae]),_t=O.useCallback(()=>{X&&o&&at()},[o,at,X]),ut=O.useCallback(()=>{X&&p&&at()},[p,at,X]),vt=O.useCallback(dt=>{X&&dt.key==="Escape"&&at()},[X,at]);Vy(()=>dF(be),"keydown",y?vt:void 0),Vy(()=>{if(!u)return null;const dt=be.current;if(!dt)return null;const mt=oee(dt);return mt.localName==="body"?Vk(be):mt},"scroll",()=>{X&&u&&Ne()},{passive:!0,capture:!0}),O.useEffect(()=>{K&&(Ae(),X&&te())},[K,X,te,Ae]),O.useEffect(()=>()=>{Ae(),Ee()},[Ae,Ee]),Vy(()=>be.current,"pointerleave",at);const it=O.useCallback((dt={},mt=null)=>({...dt,ref:Ki(be,mt,ne),onPointerEnter:Mn(dt.onPointerEnter,Ft=>{Ft.pointerType!=="touch"&&qe()}),onClick:Mn(dt.onClick,_t),onPointerDown:Mn(dt.onPointerDown,ut),onFocus:Mn(dt.onFocus,qe),onBlur:Mn(dt.onBlur,at),"aria-describedby":X?Fe:void 0}),[qe,at,ut,X,Fe,_t,ne]),wt=O.useCallback((dt={},mt=null)=>de({...dt,style:{...dt.style,[Co.arrowSize.var]:D?`${D}px`:void 0,[Co.arrowShadowColor.var]:F}},mt),[de,D,F]),$t=O.useCallback((dt={},mt=null)=>{const ct={...dt.style,position:"relative",transformOrigin:Co.transformOrigin.varRef};return{ref:mt,...ge,...dt,id:Fe,role:"tooltip",style:ct}},[ge,Fe]);return{isOpen:X,show:qe,hide:at,getTriggerProps:it,getTooltipProps:$t,getTooltipPositionerProps:wt,getArrowProps:he,getArrowInnerProps:pe}}const KU="chakra-ui:close-tooltip";function oVe(n,e){return O.useEffect(()=>{const i=dF(n);return i.addEventListener(KU,e),()=>i.removeEventListener(KU,e)},[e,n]),()=>{const i=dF(n),o=Vk(n);i.dispatchEvent(new o.CustomEvent(KU))}}const aVe=Mt(Up.div),Ff=Bt((n,e)=>{const i=lu("Tooltip",n),o=Bi(n),l=X0(),{children:u,label:p,shouldWrapChildren:y,"aria-label":v,hasArrow:w,bg:C,portalProps:R,background:N,backgroundColor:M,bgColor:D,motionProps:F,animatePresenceProps:z,...q}=o,K=N??M??C??D;if(K){i.bg=K;const ne=i0e(l,"colors",K);i[Co.arrowBg.var]=ne}const re=sVe({...q,direction:l.direction}),ce=!O.isValidElement(u)||y;let se;if(ce)se=S.jsx(Mt.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:u});else{const ne=O.Children.only(u);se=O.cloneElement(ne,re.getTriggerProps(ne.props,eie(ne)))}const ge=!!v,X=re.getTooltipProps({},e),J=ge?H0(X,["role","id"]):X,te=see(X,["role","id"]);return p?S.jsxs(S.Fragment,{children:[se,S.jsx(K0,{...z,children:re.isOpen&&S.jsx(Mc,{...R,children:S.jsx(Mt.div,{...re.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(aVe,{variants:iVe,initial:"exit",animate:"enter",exit:"exit",...F,...J,__css:i,children:[p,ge&&S.jsx(Mt.span,{srOnly:!0,...te,children:v}),w&&S.jsx(Mt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(Mt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:u})});Ff.displayName="Tooltip";const hR=Bt(function(e,i){const o=lu("Heading",e),{className:l,...u}=Bi(e);return S.jsx(Mt.h2,{ref:i,className:En("chakra-heading",e.className),...u,__css:o})});hR.displayName="Heading";const Ke=Bt(function(e,i){const o=lu("Text",e),{className:l,align:u,decoration:p,casing:y,...v}=Bi(e),w=YO({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(Mt.p,{ref:i,className:En("chakra-text",e.className),...w,...v,__css:o})});Ke.displayName="Text";const _ie=Bt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:p,justify:y,direction:v,align:w,className:C,shouldWrapChildren:R,...N}=e,M=O.useMemo(()=>R?O.Children.map(p,(D,F)=>S.jsx(N5,{children:D},F)):p,[p,R]);return S.jsx(Mt.div,{ref:i,className:En("chakra-wrap",C),...N,children:S.jsx(Mt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:w,flexDirection:v,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:M})})});_ie.displayName="Wrap";const N5=Bt(function(e,i){const{className:o,...l}=e;return S.jsx(Mt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:En("chakra-wrap__listitem",o),...l})});N5.displayName="WrapItem";const cVe="modulepreload",lVe=function(n,e){return new URL(n,e).href},sJ={},qU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){let p=function(C){return Promise.all(C.map(R=>Promise.resolve(R).then(N=>({status:"fulfilled",value:N}),N=>({status:"rejected",reason:N}))))};const y=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),w=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));l=p(i.map(C=>{if(C=lVe(C,o),C in sJ)return;sJ[C]=!0;const R=C.endsWith(".css"),N=R?'[rel="stylesheet"]':"";if(!!o)for(let F=y.length-1;F>=0;F--){const z=y[F];if(z.href===C&&(!R||z.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${N}`))return;const D=document.createElement("link");if(D.rel=R?"stylesheet":cVe,R||(D.as="script"),D.crossOrigin="",D.href=C,w&&D.setAttribute("nonce",w),document.head.appendChild(D),R)return new Promise((F,z)=>{D.addEventListener("load",F),D.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${C}`)))})}))}function u(p){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=p,window.dispatchEvent(y),!y.defaultPrevented)throw p}return l.then(p=>{for(const y of p||[])y.status==="rejected"&&u(y.reason);return e().catch(u)})},ik=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},W={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${ik()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${ik()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${ik()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${ik()}] ${n}`)}};async function pR(n){let e;try{switch(n){case"default":e=await qU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await qU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return W.error("Failed to load theme:",i),e=await qU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const uVe=()=>{};var oJ={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yie=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},dVe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],p=n[i++],y=n[i++],v=((l&7)<<18|(u&63)<<12|(p&63)<<6|y&63)-65536;e[o++]=String.fromCharCode(55296+(v>>10)),e[o++]=String.fromCharCode(56320+(v&1023))}else{const u=n[i++],p=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|p&63)}}return e.join("")},Eie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],p=l+1<n.length,y=p?n[l+1]:0,v=l+2<n.length,w=v?n[l+2]:0,C=u>>2,R=(u&3)<<4|y>>4;let N=(y&15)<<2|w>>6,M=w&63;v||(M=64,p||(N=64)),o.push(i[C],i[R],i[N],i[M])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(yie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):dVe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const w=l<n.length?i[n.charAt(l)]:64;++l;const R=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||y==null||w==null||R==null)throw new hVe;const N=u<<2|y>>4;if(o.push(N),w!==64){const M=y<<4&240|w>>2;if(o.push(M),R!==64){const D=w<<6&192|R;o.push(D)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class hVe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const pVe=function(n){const e=yie(n);return Eie.encodeByteArray(e,!0)},gO=function(n){return pVe(n).replace(/\./g,"")},vie=function(n){try{return Eie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fVe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mVe=()=>fVe().__FIREBASE_DEFAULTS__,gVe=()=>{if(typeof process>"u"||typeof oJ>"u")return;const n=oJ.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},_Ve=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&vie(n[1]);return e&&JSON.parse(e)},TN=()=>{try{return uVe()||mVe()||gVe()||_Ve()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Sie=n=>{var e,i;return(i=(e=TN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},x5=n=>{const e=Sie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},bie=()=>{var n;return(n=TN())===null||n===void 0?void 0:n.config},wie=n=>{var e;return(e=TN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[gO(JSON.stringify(i)),gO(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function EVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(hc())}function vVe(){var n;const e=(n=TN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function SVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function TVe(){const n=hc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function CVe(){return!vVe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function RVe(){try{return typeof indexedDB=="object"}catch{return!1}}function IVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AVe="FirebaseError";class ph extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=AVe,Object.setPrototypeOf(this,ph.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,WR.prototype.create)}}class WR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],p=u?PVe(u,o):"Error",y=`${this.serviceName}: ${p} (${l}).`;return new ph(l,y,o)}}function PVe(n,e){return n.replace(kVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const kVe=/\{\$([^}]+)}/g;function OVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function $f(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],p=e[l];if(aJ(u)&&aJ(p)){if(!$f(u,p))return!1}else if(u!==p)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function aJ(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GR(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function gC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function _C(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function NVe(n,e){const i=new xVe(n,e);return i.subscribe.bind(i)}class xVe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");DVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=YU),l.error===void 0&&(l.error=YU),l.complete===void 0&&(l.complete=YU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function DVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function YU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pi(n){return n&&n._delegate?n._delegate:n}class Kf{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new yVe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(UVe(e))try{this.getOrInitializeService({instanceIdentifier:Ay})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Ay){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ay){return this.instances.has(e)}getOptions(e=Ay){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,p]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(u);o===y&&p.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const p=this.instances.get(l);return p&&e(p,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:MVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ay){return this.component?this.component.multipleInstances?e:Ay:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function MVe(n){return n===Ay?void 0:n}function UVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new LVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(zr||(zr={}));const FVe={debug:zr.DEBUG,verbose:zr.VERBOSE,info:zr.INFO,warn:zr.WARN,error:zr.ERROR,silent:zr.SILENT},jVe=zr.INFO,BVe={[zr.DEBUG]:"log",[zr.VERBOSE]:"log",[zr.INFO]:"info",[zr.WARN]:"warn",[zr.ERROR]:"error"},zVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=BVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class D5{constructor(e){this.name=e,this._logLevel=jVe,this._logHandler=zVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in zr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?FVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,zr.DEBUG,...e),this._logHandler(this,zr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,zr.VERBOSE,...e),this._logHandler(this,zr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,zr.INFO,...e),this._logHandler(this,zr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,zr.WARN,...e),this._logHandler(this,zr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,zr.ERROR,...e),this._logHandler(this,zr.ERROR,...e)}}const WVe=(n,e)=>e.some(i=>n instanceof i);let cJ,lJ;function GVe(){return cJ||(cJ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function HVe(){return lJ||(lJ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Cie=new WeakMap,hF=new WeakMap,Rie=new WeakMap,XU=new WeakMap,L5=new WeakMap;function $Ve(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",p)},u=()=>{i(kg(n.result)),l()},p=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&Cie.set(i,n)}).catch(()=>{}),L5.set(e,n),e}function KVe(n){if(hF.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",p),n.removeEventListener("abort",p)},u=()=>{i(),l()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",p),n.addEventListener("abort",p)});hF.set(n,e)}let pF={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return hF.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Rie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return kg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function qVe(n){pF=n(pF)}function YVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(JU(this),e,...i);return Rie.set(o,e.sort?e.sort():[e]),kg(o)}:HVe().includes(n)?function(...e){return n.apply(JU(this),e),kg(Cie.get(this))}:function(...e){return kg(n.apply(JU(this),e))}}function XVe(n){return typeof n=="function"?YVe(n):(n instanceof IDBTransaction&&KVe(n),WVe(n,GVe())?new Proxy(n,pF):n)}function kg(n){if(n instanceof IDBRequest)return $Ve(n);if(XU.has(n))return XU.get(n);const e=XVe(n);return e!==n&&(XU.set(n,e),L5.set(e,n)),e}const JU=n=>L5.get(n);function JVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const p=indexedDB.open(n,e),y=kg(p);return o&&p.addEventListener("upgradeneeded",v=>{o(kg(p.result),v.oldVersion,v.newVersion,kg(p.transaction),v)}),i&&p.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{u&&v.addEventListener("close",()=>u()),l&&v.addEventListener("versionchange",w=>l(w.oldVersion,w.newVersion,w))}).catch(()=>{}),y}const QVe=["get","getKey","getAll","getAllKeys","count"],ZVe=["put","add","delete","clear"],QU=new Map;function uJ(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(QU.get(e))return QU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=ZVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||QVe.includes(i)))return;const u=async function(p,...y){const v=this.transaction(p,l?"readwrite":"readonly");let w=v.store;return o&&(w=w.index(y.shift())),(await Promise.all([w[i](...y),l&&v.done]))[0]};return QU.set(e,u),u}qVe(n=>({...n,get:(e,i,o)=>uJ(e,i)||n.get(e,i,o),has:(e,i)=>!!uJ(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eFe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(tFe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function tFe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const fF="@firebase/app",dJ="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf=new D5("@firebase/app"),nFe="@firebase/app-compat",rFe="@firebase/analytics-compat",iFe="@firebase/analytics",sFe="@firebase/app-check-compat",oFe="@firebase/app-check",aFe="@firebase/auth",cFe="@firebase/auth-compat",lFe="@firebase/database",uFe="@firebase/data-connect",dFe="@firebase/database-compat",hFe="@firebase/functions",pFe="@firebase/functions-compat",fFe="@firebase/installations",mFe="@firebase/installations-compat",gFe="@firebase/messaging",_Fe="@firebase/messaging-compat",yFe="@firebase/performance",EFe="@firebase/performance-compat",vFe="@firebase/remote-config",SFe="@firebase/remote-config-compat",bFe="@firebase/storage",wFe="@firebase/storage-compat",TFe="@firebase/firestore",CFe="@firebase/vertexai",RFe="@firebase/firestore-compat",IFe="firebase",AFe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mF="[DEFAULT]",PFe={[fF]:"fire-core",[nFe]:"fire-core-compat",[iFe]:"fire-analytics",[rFe]:"fire-analytics-compat",[oFe]:"fire-app-check",[sFe]:"fire-app-check-compat",[aFe]:"fire-auth",[cFe]:"fire-auth-compat",[lFe]:"fire-rtdb",[uFe]:"fire-data-connect",[dFe]:"fire-rtdb-compat",[hFe]:"fire-fn",[pFe]:"fire-fn-compat",[fFe]:"fire-iid",[mFe]:"fire-iid-compat",[gFe]:"fire-fcm",[_Fe]:"fire-fcm-compat",[yFe]:"fire-perf",[EFe]:"fire-perf-compat",[vFe]:"fire-rc",[SFe]:"fire-rc-compat",[bFe]:"fire-gcs",[wFe]:"fire-gcs-compat",[TFe]:"fire-fst",[RFe]:"fire-fst-compat",[CFe]:"fire-vertex","fire-js":"fire-js",[IFe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O=new Map,kFe=new Map,gF=new Map;function hJ(n,e){try{n.container.addComponent(e)}catch(i){qf.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Vg(n){const e=n.name;if(gF.has(e))return qf.debug(`There were multiple attempts to register component ${e}.`),!1;gF.set(e,n);for(const i of _O.values())hJ(i,n);for(const i of kFe.values())hJ(i,n);return!0}function HR(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function fl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OFe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Og=new WR("app","Firebase",OFe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NFe{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Kf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Og.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE=AFe;function Iie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:mF,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Og.create("bad-app-name",{appName:String(l)});if(i||(i=bie()),!i)throw Og.create("no-options");const u=_O.get(l);if(u){if($f(i,u.options)&&$f(o,u.config))return u;throw Og.create("duplicate-app",{appName:l})}const p=new VVe(l);for(const v of gF.values())p.addComponent(v);const y=new NFe(i,o,p);return _O.set(l,y),y}function CN(n=mF){const e=_O.get(n);if(!e&&n===mF&&bie())return Iie();if(!e)throw Og.create("no-app",{appName:n});return e}function nd(n,e,i){var o;let l=(o=PFe[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),p=e.match(/\s|\//);if(u||p){const y=[`Unable to register library "${l}" with version "${e}":`];u&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&p&&y.push("and"),p&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qf.warn(y.join(" "));return}Vg(new Kf(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xFe="firebase-heartbeat-database",DFe=1,fR="firebase-heartbeat-store";let ZU=null;function Aie(){return ZU||(ZU=JVe(xFe,DFe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fR)}catch(i){console.warn(i)}}}}).catch(n=>{throw Og.create("idb-open",{originalErrorMessage:n.message})})),ZU}async function LFe(n){try{const i=(await Aie()).transaction(fR),o=await i.objectStore(fR).get(Pie(n));return await i.done,o}catch(e){if(e instanceof ph)qf.warn(e.message);else{const i=Og.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qf.warn(i.message)}}}async function pJ(n,e){try{const o=(await Aie()).transaction(fR,"readwrite");await o.objectStore(fR).put(e,Pie(n)),await o.done}catch(i){if(i instanceof ph)qf.warn(i.message);else{const o=Og.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});qf.warn(o.message)}}}function Pie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MFe=1024,UFe=30;class VFe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new jFe(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=fJ();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(p=>p.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>UFe){const p=BFe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){qf.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=fJ(),{heartbeatsToSend:o,unsentEntries:l}=FFe(this._heartbeatsCache.heartbeats),u=gO(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return qf.warn(i),""}}}function fJ(){return new Date().toISOString().substring(0,10)}function FFe(n,e=MFe){const i=[];let o=n.slice();for(const l of n){const u=i.find(p=>p.agent===l.agent);if(u){if(u.dates.push(l.date),mJ(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),mJ(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class jFe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return RVe()?IVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await LFe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return pJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function mJ(n){return gO(JSON.stringify({version:2,heartbeats:n})).length}function BFe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zFe(n){Vg(new Kf("platform-logger",e=>new eFe(e),"PRIVATE")),Vg(new Kf("heartbeat",e=>new VFe(e),"PRIVATE")),nd(fF,dJ,n),nd(fF,dJ,"esm2017"),nd("fire-js","")}zFe("");function kie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const WFe=kie,Oie=new WR("auth","Firebase",kie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yO=new D5("@firebase/auth");function GFe(n,...e){yO.logLevel<=zr.WARN&&yO.warn(`Auth (${uE}): ${n}`,...e)}function Fk(n,...e){yO.logLevel<=zr.ERROR&&yO.error(`Auth (${uE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(n,...e){throw M5(n,...e)}function Op(n,...e){return M5(n,...e)}function Nie(n,e,i){const o=Object.assign(Object.assign({},WFe()),{[e]:i});return new WR("auth","Firebase",o).create(e,{appName:n.name})}function jf(n){return Nie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function M5(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return Oie.create(n,...e)}function Yn(n,e,...i){if(!n)throw M5(e,...i)}function Nf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Fk(e),new Error(e)}function Yf(n,e){n||Nf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _F(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function HFe(){return gJ()==="http:"||gJ()==="https:"}function gJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Fe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(HFe()||bVe()||"connection"in navigator)?navigator.onLine:!0}function KFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R{constructor(e,i){this.shortDelay=e,this.longDelay=i,Yf(i>e,"Short delay should be less than long delay!"),this.isMobile=EVe()||wVe()}get(){return $Fe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U5(n,e){Yf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Nf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Nf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Nf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YFe=new $R(3e4,6e4);function em(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function tm(n,e,i,o,l={}){return Die(n,l,async()=>{let u={},p={};o&&(e==="GET"?p=o:u={body:JSON.stringify(o)});const y=GR(Object.assign({key:n.config.apiKey},p)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const w=Object.assign({method:e,headers:v},u);return SVe()||(w.referrerPolicy="no-referrer"),xie.fetch()(Lie(n,n.config.apiHost,i,y),w)})}async function Die(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},qFe),e);try{const l=new JFe(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await u.json();if("needConfirmation"in p)throw sk(n,"account-exists-with-different-credential",p);if(u.ok&&!("errorMessage"in p))return p;{const y=u.ok?p.errorMessage:p.error.message,[v,w]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw sk(n,"credential-already-in-use",p);if(v==="EMAIL_EXISTS")throw sk(n,"email-already-in-use",p);if(v==="USER_DISABLED")throw sk(n,"user-disabled",p);const C=o[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(w)throw Nie(n,C,w);dh(n,C)}}catch(l){if(l instanceof ph)throw l;dh(n,"network-request-failed",{message:String(l)})}}async function KR(n,e,i,o,l={}){const u=await tm(n,e,i,o,l);return"mfaPendingCredential"in u&&dh(n,"multi-factor-auth-required",{_serverResponse:u}),u}function Lie(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?U5(n.config,l):`${n.config.apiScheme}://${l}`}function XFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class JFe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(Op(this.auth,"network-request-failed")),YFe.get())})}}function sk(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=Op(n,e,o);return l.customData._tokenResponse=i,l}function _J(n){return n!==void 0&&n.enterprise!==void 0}class QFe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return XFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ZFe(n,e){return tm(n,"GET","/v2/recaptchaConfig",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eje(n,e){return tm(n,"POST","/v1/accounts:delete",e)}async function Mie(n,e){return tm(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function tje(n,e=!1){const i=Pi(n),o=await i.getIdToken(e),l=V5(o);Yn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,p=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:FC(eV(l.auth_time)),issuedAtTime:FC(eV(l.iat)),expirationTime:FC(eV(l.exp)),signInProvider:p||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function eV(n){return Number(n)*1e3}function V5(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return Fk("JWT malformed, contained fewer than 3 sections"),null;try{const l=vie(i);return l?JSON.parse(l):(Fk("Failed to decode base64 JWT payload"),null)}catch(l){return Fk("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function yJ(n){const e=V5(n);return Yn(e,"internal-error"),Yn(typeof e.exp<"u","internal-error"),Yn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mR(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof ph&&nje(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function nje({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rje{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yF{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=FC(this.lastLoginAt),this.creationTime=FC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function EO(n){var e;const i=n.auth,o=await n.getIdToken(),l=await mR(n,Mie(i,{idToken:o}));Yn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const p=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?Uie(u.providerUserInfo):[],y=sje(n.providerData,p),v=n.isAnonymous,w=!(n.email&&u.passwordHash)&&!(y!=null&&y.length),C=v?w:!1,R={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:y,metadata:new yF(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,R)}async function ije(n){const e=Pi(n);await EO(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sje(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function Uie(n){return n.map(e=>{var{providerId:i}=e,o=LR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oje(n,e){const i=await Die(n,{},async()=>{const o=GR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,p=Lie(n,l,"/v1/token",`key=${u}`),y=await n._getAdditionalHeaders();return y["Content-Type"]="application/x-www-form-urlencoded",xie.fetch()(p,{method:"POST",headers:y,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function aje(n,e){return tm(n,"POST","/v2/accounts:revokeToken",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Yn(e.idToken,"internal-error"),Yn(typeof e.idToken<"u","internal-error"),Yn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Yn(e.length!==0,"internal-error");const i=yJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Yn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await oje(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,p=new h0;return o&&(Yn(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),l&&(Yn(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),u&&(Yn(typeof u=="number","internal-error",{appName:e}),p.expirationTime=u),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new h0,this.toJSON())}_performRefresh(){return Nf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pg(n,e){Yn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class xf{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=LR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rje(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new yF(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await mR(this,this.stsTokenManager.getToken(this.auth,e));return Yn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return tje(this,e)}reload(){return ije(this)}_assign(e){this!==e&&(Yn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new xf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Yn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await EO(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(fl(this.auth.app))return Promise.reject(jf(this.auth));const e=await this.getIdToken();return await mR(this,eje(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,p,y,v,w,C;const R=(o=i.displayName)!==null&&o!==void 0?o:void 0,N=(l=i.email)!==null&&l!==void 0?l:void 0,M=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,D=(p=i.photoURL)!==null&&p!==void 0?p:void 0,F=(y=i.tenantId)!==null&&y!==void 0?y:void 0,z=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,q=(w=i.createdAt)!==null&&w!==void 0?w:void 0,K=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:re,emailVerified:ce,isAnonymous:se,providerData:ge,stsTokenManager:X}=i;Yn(re&&X,e,"internal-error");const J=h0.fromJSON(this.name,X);Yn(typeof re=="string",e,"internal-error"),pg(R,e.name),pg(N,e.name),Yn(typeof ce=="boolean",e,"internal-error"),Yn(typeof se=="boolean",e,"internal-error"),pg(M,e.name),pg(D,e.name),pg(F,e.name),pg(z,e.name),pg(q,e.name),pg(K,e.name);const te=new xf({uid:re,auth:e,email:N,emailVerified:ce,displayName:R,isAnonymous:se,photoURL:D,phoneNumber:M,tenantId:F,stsTokenManager:J,createdAt:q,lastLoginAt:K});return ge&&Array.isArray(ge)&&(te.providerData=ge.map(ne=>Object.assign({},ne))),z&&(te._redirectEventId=z),te}static async _fromIdTokenResponse(e,i,o=!1){const l=new h0;l.updateFromServerResponse(i);const u=new xf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await EO(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Yn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?Uie(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),y=new h0;y.updateFromIdToken(o);const v=new xf({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:p}),w={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new yF(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(v,w),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EJ=new Map;function Df(n){Yf(n instanceof Function,"Expected a class definition");let e=EJ.get(n);return e?(Yf(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,EJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Vie.type="NONE";const vJ=Vie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jk(n,e,i){return`firebase:${n}:${e}:${i}`}class p0{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=jk(this.userKey,l.apiKey,u),this.fullPersistenceKey=jk("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?xf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new p0(Df(vJ),e,o);const l=(await Promise.all(i.map(async w=>{if(await w._isAvailable())return w}))).filter(w=>w);let u=l[0]||Df(vJ);const p=jk(o,e.config.apiKey,e.name);let y=null;for(const w of i)try{const C=await w._get(p);if(C){const R=xf._fromJSON(e,C);w!==u&&(y=R),u=w;break}}catch{}const v=l.filter(w=>w._shouldAllowMigration);return!u._shouldAllowMigration||!v.length?new p0(u,e,o):(u=v[0],y&&await u._set(p,y.toJSON()),await Promise.all(i.map(async w=>{if(w!==u)try{await w._remove(p)}catch{}})),new p0(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Fie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Gie(e))return"Blackberry";if(Hie(e))return"Webos";if(jie(e))return"Safari";if((e.includes("chrome/")||Bie(e))&&!e.includes("edge/"))return"Chrome";if(Wie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function Fie(n=hc()){return/firefox\//i.test(n)}function jie(n=hc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Bie(n=hc()){return/crios\//i.test(n)}function zie(n=hc()){return/iemobile/i.test(n)}function Wie(n=hc()){return/android/i.test(n)}function Gie(n=hc()){return/blackberry/i.test(n)}function Hie(n=hc()){return/webos/i.test(n)}function F5(n=hc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function cje(n=hc()){var e;return F5(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function lje(){return TVe()&&document.documentMode===10}function $ie(n=hc()){return F5(n)||Wie(n)||Hie(n)||Gie(n)||/windows phone/i.test(n)||zie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kie(n,e=[]){let i;switch(n){case"Browser":i=SJ(hc());break;case"Worker":i=`${SJ(hc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${uE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((p,y)=>{try{const v=e(u);p(v)}catch(v){y(v)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dje(n,e={}){return tm(n,"GET","/v2/passwordPolicy",em(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hje=6;class pje{constructor(e){var i,o,l,u;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:hje,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,p,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(o=v.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(u=v.containsUppercaseLetter)!==null&&u!==void 0?u:!0),v.isValid&&(v.isValid=(p=v.containsNumericCharacter)!==null&&p!==void 0?p:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fje{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bJ(this),this.idTokenSubscription=new bJ(this),this.beforeStateQueue=new uje(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Oie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Df(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await p0.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Mie(this,{idToken:e}),o=await xf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(fl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(y,y))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!p||p===y)&&(v!=null&&v.user)&&(l=v.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Yn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await EO(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=KFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(fl(this.app))return Promise.reject(jf(this));const i=e?Pi(e):null;return i&&Yn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Yn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return fl(this.app)?Promise.reject(jf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return fl(this.app)?Promise.reject(jf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Df(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await dje(this),i=new pje(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new WR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await aje(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Df(e)||this._popupRedirectResolver;Yn(i,this,"argument-error"),this.redirectPersistenceManager=await p0.create(this,[Df(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let p=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Yn(y,this,"internal-error"),y.then(()=>{p||u(this.currentUser)}),typeof i=="function"){const v=e.addObserver(i,o,l);return()=>{p=!0,v()}}else{const v=e.addObserver(i);return()=>{p=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Yn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Kie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(fl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&GFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Xg(n){return Pi(n)}class bJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=NVe(i=>this.observer=i)}get next(){return Yn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function mje(n){RN=n}function qie(n){return RN.loadJS(n)}function gje(){return RN.recaptchaEnterpriseScript}function _je(){return RN.gapiScript}function yje(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class Eje{constructor(){this.enterprise=new vje}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class vje{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const Sje="recaptcha-enterprise",Yie="NO_RECAPTCHA";class bje{constructor(e){this.type=Sje,this.auth=Xg(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(p,y)=>{ZFe(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const w=new QFe(v);return u.tenantId==null?u._agentRecaptchaConfig=w:u._tenantRecaptchaConfigs[u.tenantId]=w,p(w.siteKey)}}).catch(v=>{y(v)})})}function l(u,p,y){const v=window.grecaptcha;_J(v)?v.enterprise.ready(()=>{v.enterprise.execute(u,{action:e}).then(w=>{p(w)}).catch(()=>{p(Yie)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Eje().execute("siteKey",{action:"verify"}):new Promise((u,p)=>{o(this.auth).then(y=>{if(!i&&_J(window.grecaptcha))l(y,u,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let v=gje();v.length!==0&&(v+=y),qie(v).then(()=>{l(y,u,p)}).catch(w=>{p(w)})}}).catch(y=>{p(y)})})}}async function wJ(n,e,i,o=!1,l=!1){const u=new bje(n);let p;if(l)p=Yie;else try{p=await u.verify(i)}catch{p=await u.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,w=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:w,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return o?Object.assign(y,{captchaResp:p}):Object.assign(y,{captchaResponse:p}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function vO(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await wJ(n,e,i,i==="getOobCode");return o(n,p)}else return o(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await wJ(n,e,i,i==="getOobCode");return o(n,y)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wje(n,e){const i=HR(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if($f(u,e??{}))return l;dh(l,"already-initialized")}return i.initialize({options:e})}function Tje(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Df);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function Cje(n,e,i){const o=Xg(n);Yn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=Xie(e),{host:p,port:y}=Rje(e),v=y===null?"":`:${y}`,w={url:`${u}//${p}${v}/`},C=Object.freeze({host:p,port:y,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Yn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Yn($f(w,o.config.emulator)&&$f(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=w,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,Ije()}function Xie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Rje(n){const e=Xie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:TJ(o.substr(u.length+1))}}else{const[u,p]=o.split(":");return{host:u,port:TJ(p)}}}function TJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Ije(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j5{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Nf("not implemented")}_getIdTokenResponse(e){return Nf("not implemented")}_linkToIdToken(e,i){return Nf("not implemented")}_getReauthenticationResolver(e){return Nf("not implemented")}}async function Aje(n,e){return tm(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pje(n,e){return KR(n,"POST","/v1/accounts:signInWithPassword",em(n,e))}async function Jie(n,e){return tm(n,"POST","/v1/accounts:sendOobCode",em(n,e))}async function kje(n,e){return Jie(n,e)}async function Oje(n,e){return Jie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nje(n,e){return KR(n,"POST","/v1/accounts:signInWithEmailLink",em(n,e))}async function xje(n,e){return KR(n,"POST","/v1/accounts:signInWithEmailLink",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR extends j5{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new gR(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new gR(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vO(e,i,"signInWithPassword",Pje);case"emailLink":return Nje(e,{email:this._email,oobCode:this._password});default:dh(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return vO(e,o,"signUpPassword",Aje);case"emailLink":return xje(e,{idToken:i,email:this._email,oobCode:this._password});default:dh(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f0(n,e){return KR(n,"POST","/v1/accounts:signInWithIdp",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dje="http://localhost";class nE extends j5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new nE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):dh("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=LR(i,["providerId","signInMethod"]);if(!o||!l)return null;const p=new nE(o,l);return p.idToken=u.idToken||void 0,p.accessToken=u.accessToken||void 0,p.secret=u.secret,p.nonce=u.nonce,p.pendingToken=u.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return f0(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,f0(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,f0(e,i)}buildRequest(){const e={requestUri:Dje,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=GR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lje(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Mje(n){const e=gC(_C(n)).link,i=e?gC(_C(e)).deep_link_id:null,o=gC(_C(n)).deep_link_id;return(o?gC(_C(o)).link:null)||o||i||e||n}class B5{constructor(e){var i,o,l,u,p,y;const v=gC(_C(e)),w=(i=v.apiKey)!==null&&i!==void 0?i:null,C=(o=v.oobCode)!==null&&o!==void 0?o:null,R=Lje((l=v.mode)!==null&&l!==void 0?l:null);Yn(w&&C&&R,"argument-error"),this.apiKey=w,this.operation=R,this.code=C,this.continueUrl=(u=v.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(p=v.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=Mje(e);try{return new B5(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(){this.providerId=Z0.PROVIDER_ID}static credential(e,i){return gR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=B5.parseLink(i);return Yn(o,"argument-error"),gR._fromEmailAndCode(e,o.code,o.tenantId)}}Z0.PROVIDER_ID="password";Z0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Z0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR extends Qie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends qR{constructor(){super("facebook.com")}static credential(e){return nE._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eg.credential(e.oauthAccessToken)}catch{return null}}}Eg.FACEBOOK_SIGN_IN_METHOD="facebook.com";Eg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends qR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return nE._fromParams({providerId:vg.PROVIDER_ID,signInMethod:vg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return vg.credentialFromTaggedObject(e)}static credentialFromError(e){return vg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return vg.credential(i,o)}catch{return null}}}vg.GOOGLE_SIGN_IN_METHOD="google.com";vg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends qR{constructor(){super("github.com")}static credential(e){return nE._fromParams({providerId:Sg.PROVIDER_ID,signInMethod:Sg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sg.credentialFromTaggedObject(e)}static credentialFromError(e){return Sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sg.credential(e.oauthAccessToken)}catch{return null}}}Sg.GITHUB_SIGN_IN_METHOD="github.com";Sg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg extends qR{constructor(){super("twitter.com")}static credential(e,i){return nE._fromParams({providerId:bg.PROVIDER_ID,signInMethod:bg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return bg.credentialFromTaggedObject(e)}static credentialFromError(e){return bg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return bg.credential(i,o)}catch{return null}}}bg.TWITTER_SIGN_IN_METHOD="twitter.com";bg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uje(n,e){return KR(n,"POST","/v1/accounts:signUp",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await xf._fromIdTokenResponse(e,o,l),p=CJ(o);return new rE({user:u,providerId:p,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=CJ(o);return new rE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function CJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO extends ph{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,SO.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new SO(e,i,o,l)}}function Zie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?SO._fromErrorAndOperation(n,u,e,o):u})}async function Vje(n,e,i=!1){const o=await mR(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return rE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fje(n,e,i=!1){const{auth:o}=n;if(fl(o.app))return Promise.reject(jf(o));const l="reauthenticate";try{const u=await mR(n,Zie(o,l,e,n),i);Yn(u.idToken,o,"internal-error");const p=V5(u.idToken);Yn(p,o,"internal-error");const{sub:y}=p;return Yn(n.uid===y,o,"user-mismatch"),rE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&dh(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ese(n,e,i=!1){if(fl(n.app))return Promise.reject(jf(n));const o="signIn",l=await Zie(n,o,e),u=await rE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function jje(n,e){return ese(Xg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tse(n){const e=Xg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Bje(n,e,i){const o=Xg(n);await vO(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Oje)}async function zje(n,e,i){if(fl(n.app))return Promise.reject(jf(n));const o=Xg(n),p=await vO(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Uje).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&tse(n),v}),y=await rE._fromIdTokenResponse(o,"signIn",p);return await o._updateCurrentUser(y.user),y}function Wje(n,e,i){return fl(n.app)?Promise.reject(jf(n)):jje(Pi(n),Z0.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&tse(n),o})}async function nse(n,e){const i=Pi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await kje(i.auth,l);u!==n.email&&await n.reload()}function Gje(n,e,i,o){return Pi(n).onIdTokenChanged(e,i,o)}function Hje(n,e,i){return Pi(n).beforeAuthStateChanged(e,i)}function $je(n,e,i,o){return Pi(n).onAuthStateChanged(e,i,o)}function Kje(n){return Pi(n).signOut()}const bO="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(bO,"1"),this.storage.removeItem(bO),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qje=1e3,Yje=10;class ise extends rse{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$ie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,y,v)=>{this.notifyListeners(p,v)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(o);!i&&this.localCache[o]===p||this.notifyListeners(o,p)},u=this.storage.getItem(o);lje()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,Yje):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},qje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}ise.type="LOCAL";const Xje=ise;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sse extends rse{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}sse.type="SESSION";const ose=sse;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jje(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new IN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const y=Array.from(p).map(async w=>w(i.origin,u)),v=await Jje(y);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:v})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}IN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z5(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qje{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,p;return new Promise((y,v)=>{const w=z5("",20);l.port1.start();const C=setTimeout(()=>{v(new Error("unsupported_event"))},o);p={messageChannel:l,onMessage(R){const N=R;if(N.data.eventId===w)switch(N.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),y(N.data.response);break;default:clearTimeout(C),clearTimeout(u),v(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:w,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Np(){return window}function Zje(n){Np().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ase(){return typeof Np().WorkerGlobalScope<"u"&&typeof Np().importScripts=="function"}async function e5e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function t5e(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function n5e(){return ase()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cse="firebaseLocalStorageDb",r5e=1,wO="firebaseLocalStorage",lse="fbase_key";class YR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function AN(n,e){return n.transaction([wO],e?"readwrite":"readonly").objectStore(wO)}function i5e(){const n=indexedDB.deleteDatabase(cse);return new YR(n).toPromise()}function EF(){const n=indexedDB.open(cse,r5e);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(wO,{keyPath:lse})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(wO)?e(o):(o.close(),await i5e(),e(await EF()))})})}async function RJ(n,e,i){const o=AN(n,!0).put({[lse]:e,value:i});return new YR(o).toPromise()}async function s5e(n,e){const i=AN(n,!1).get(e),o=await new YR(i).toPromise();return o===void 0?null:o.value}function IJ(n,e){const i=AN(n,!0).delete(e);return new YR(i).toPromise()}const o5e=800,a5e=3;class use{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await EF(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>a5e)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ase()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=IN._getInstance(n5e()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await e5e(),!this.activeServiceWorker)return;this.sender=new Qje(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||t5e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await EF();return await RJ(e,bO,"1"),await IJ(e,bO),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>RJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>s5e(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>IJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=AN(l,!1).getAll();return new YR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),o5e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}use.type="LOCAL";const c5e=use;new $R(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l5e(n,e){return e?Df(e):(Yn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5 extends j5{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return f0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return f0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return f0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function u5e(n){return ese(n.auth,new W5(n),n.bypassAuthState)}function d5e(n){const{auth:e,user:i}=n;return Yn(i,e,"internal-error"),Fje(i,new W5(n),n.bypassAuthState)}async function h5e(n){const{auth:e,user:i}=n;return Yn(i,e,"internal-error"),Vje(i,new W5(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dse{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:p,type:y}=e;if(p){this.reject(p);return}const v={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(w){this.reject(w)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return u5e;case"linkViaPopup":case"linkViaRedirect":return h5e;case"reauthViaPopup":case"reauthViaRedirect":return d5e;default:dh(this.auth,"internal-error")}}resolve(e){Yf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5e=new $R(2e3,1e4);class YS extends dse{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,YS.currentPopupAction&&YS.currentPopupAction.cancel(),YS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Yn(e,this.auth,"internal-error"),e}async onExecution(){Yf(this.filter.length===1,"Popup operations only handle one event");const e=z5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Op(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Op(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,YS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Op(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,p5e.get())};e()}}YS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5e="pendingRedirect",Bk=new Map;class m5e extends dse{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=Bk.get(this.auth._key());if(!e){try{const o=await g5e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}Bk.set(this.auth._key(),e)}return this.bypassAuthState||Bk.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function g5e(n,e){const i=E5e(e),o=y5e(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function _5e(n,e){Bk.set(n._key(),e)}function y5e(n){return Df(n._redirectPersistence)}function E5e(n){return jk(f5e,n.config.apiKey,n.name)}async function v5e(n,e,i=!1){if(fl(n.app))return Promise.reject(jf(n));const o=Xg(n),l=l5e(o,e),p=await new m5e(o,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S5e=10*60*1e3;class b5e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!w5e(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!hse(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(Op(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=S5e&&this.cachedEventUids.clear(),this.cachedEventUids.has(AJ(e))}saveEventToCache(e){this.cachedEventUids.add(AJ(e)),this.lastProcessedEventTime=Date.now()}}function AJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function hse({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function w5e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hse(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T5e(n,e={}){return tm(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C5e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,R5e=/^https?/;async function I5e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await T5e(n);for(const i of e)try{if(A5e(i))return}catch{}dh(n,"unauthorized-domain")}function A5e(n){const e=_F(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===o}if(!R5e.test(i))return!1;if(C5e.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5e=new $R(3e4,6e4);function PJ(){const n=Np().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function k5e(n){return new Promise((e,i)=>{var o,l,u;function p(){PJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{PJ(),i(Op(n,"network-request-failed"))},timeout:P5e.get()})}if(!((l=(o=Np().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=Np().gapi)===null||u===void 0)&&u.load)p();else{const y=yje("iframefcb");return Np()[y]=()=>{gapi.load?p():i(Op(n,"network-request-failed"))},qie(`${_je()}?onload=${y}`).catch(v=>i(v))}}).catch(e=>{throw zk=null,e})}let zk=null;function O5e(n){return zk=zk||k5e(n),zk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N5e=new $R(5e3,15e3),x5e="__/auth/iframe",D5e="emulator/auth/iframe",L5e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},M5e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function U5e(n){const e=n.config;Yn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?U5(e,D5e):`https://${n.config.authDomain}/${x5e}`,o={apiKey:e.apiKey,appName:n.name,v:uE},l=M5e.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${GR(o).slice(1)}`}async function V5e(n){const e=await O5e(n),i=Np().gapi;return Yn(i,n,"internal-error"),e.open({where:document.body,url:U5e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:L5e,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const p=Op(n,"network-request-failed"),y=Np().setTimeout(()=>{u(p)},N5e.get());function v(){Np().clearTimeout(y),l(o)}o.ping(v).then(v,()=>{u(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F5e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},j5e=500,B5e=600,z5e="_blank",W5e="http://localhost";class kJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function G5e(n,e,i,o=j5e,l=B5e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let y="";const v=Object.assign(Object.assign({},F5e),{width:o.toString(),height:l.toString(),top:u,left:p}),w=hc().toLowerCase();i&&(y=Bie(w)?z5e:i),Fie(w)&&(e=e||W5e,v.scrollbars="yes");const C=Object.entries(v).reduce((N,[M,D])=>`${N}${M}=${D},`,"");if(cje(w)&&y!=="_self")return H5e(e||"",y),new kJ(null);const R=window.open(e||"",y,C);Yn(R,n,"popup-blocked");try{R.focus()}catch{}return new kJ(R)}function H5e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $5e="__/auth/handler",K5e="emulator/auth/handler",q5e=encodeURIComponent("fac");async function OJ(n,e,i,o,l,u){Yn(n.config.authDomain,n,"auth-domain-config-required"),Yn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:uE,eventId:l};if(e instanceof Qie){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",OVe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,R]of Object.entries({}))p[C]=R}if(e instanceof qR){const C=e.getScopes().filter(R=>R!=="");C.length>0&&(p.scopes=C.join(","))}n.tenantId&&(p.tid=n.tenantId);const y=p;for(const C of Object.keys(y))y[C]===void 0&&delete y[C];const v=await n._getAppCheckToken(),w=v?`#${q5e}=${encodeURIComponent(v)}`:"";return`${Y5e(n)}?${GR(y).slice(1)}${w}`}function Y5e({config:n}){return n.emulator?U5(n,K5e):`https://${n.authDomain}/${$5e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tV="webStorageSupport";class X5e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ose,this._completeRedirectFn=v5e,this._overrideRedirectResult=_5e}async _openPopup(e,i,o,l){var u;Yf((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const p=await OJ(e,i,o,_F(),l);return G5e(e,p,z5())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await OJ(e,i,o,_F(),l);return Zje(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(Yf(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await V5e(e),o=new b5e(e);return i.register("authEvent",l=>(Yn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(tV,{type:tV},l=>{var u;const p=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[tV];p!==void 0&&i(!!p),dh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=I5e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return $ie()||jie()||F5()}}const J5e=X5e;var NJ="@firebase/auth",xJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q5e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Yn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z5e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function e3e(n){Vg(new Kf("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:p,authDomain:y}=o.options;Yn(p&&!p.includes(":"),"invalid-api-key",{appName:o.name});const v={apiKey:p,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Kie(n)},w=new fje(o,l,u,v);return Tje(w,i),w},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),Vg(new Kf("auth-internal",e=>{const i=Xg(e.getProvider("auth").getImmediate());return(o=>new Q5e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),nd(NJ,xJ,Z5e(n)),nd(NJ,xJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3e=5*60,n3e=wie("authIdTokenMaxAge")||t3e;let DJ=null;const r3e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>n3e)return;const l=i==null?void 0:i.token;DJ!==l&&(DJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function PN(n=CN()){const e=HR(n,"auth");if(e.isInitialized())return e.getImmediate();const i=wje(n,{popupRedirectResolver:J5e,persistence:[c5e,Xje,ose]}),o=wie("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const p=r3e(u.toString());Hje(i,p,()=>p(i.currentUser)),Gje(i,y=>p(y))}}const l=Sie("auth");return l&&Cje(i,`http://${l}`),i}function i3e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}mje({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=Op("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",i3e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});e3e("Browser");var LJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ng,pse;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(X,J){function te(){}te.prototype=J.prototype,X.D=J.prototype,X.prototype=new te,X.prototype.constructor=X,X.C=function(ne,de,pe){for(var he=Array(arguments.length-2),ve=2;ve<arguments.length;ve++)he[ve-2]=arguments[ve];return J.prototype[de].apply(ne,he)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(X,J,te){te||(te=0);var ne=Array(16);if(typeof J=="string")for(var de=0;16>de;++de)ne[de]=J.charCodeAt(te++)|J.charCodeAt(te++)<<8|J.charCodeAt(te++)<<16|J.charCodeAt(te++)<<24;else for(de=0;16>de;++de)ne[de]=J[te++]|J[te++]<<8|J[te++]<<16|J[te++]<<24;J=X.g[0],te=X.g[1],de=X.g[2];var pe=X.g[3],he=J+(pe^te&(de^pe))+ne[0]+3614090360&4294967295;J=te+(he<<7&4294967295|he>>>25),he=pe+(de^J&(te^de))+ne[1]+3905402710&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=de+(te^pe&(J^te))+ne[2]+606105819&4294967295,de=pe+(he<<17&4294967295|he>>>15),he=te+(J^de&(pe^J))+ne[3]+3250441966&4294967295,te=de+(he<<22&4294967295|he>>>10),he=J+(pe^te&(de^pe))+ne[4]+4118548399&4294967295,J=te+(he<<7&4294967295|he>>>25),he=pe+(de^J&(te^de))+ne[5]+1200080426&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=de+(te^pe&(J^te))+ne[6]+2821735955&4294967295,de=pe+(he<<17&4294967295|he>>>15),he=te+(J^de&(pe^J))+ne[7]+4249261313&4294967295,te=de+(he<<22&4294967295|he>>>10),he=J+(pe^te&(de^pe))+ne[8]+1770035416&4294967295,J=te+(he<<7&4294967295|he>>>25),he=pe+(de^J&(te^de))+ne[9]+2336552879&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=de+(te^pe&(J^te))+ne[10]+4294925233&4294967295,de=pe+(he<<17&4294967295|he>>>15),he=te+(J^de&(pe^J))+ne[11]+2304563134&4294967295,te=de+(he<<22&4294967295|he>>>10),he=J+(pe^te&(de^pe))+ne[12]+1804603682&4294967295,J=te+(he<<7&4294967295|he>>>25),he=pe+(de^J&(te^de))+ne[13]+4254626195&4294967295,pe=J+(he<<12&4294967295|he>>>20),he=de+(te^pe&(J^te))+ne[14]+2792965006&4294967295,de=pe+(he<<17&4294967295|he>>>15),he=te+(J^de&(pe^J))+ne[15]+1236535329&4294967295,te=de+(he<<22&4294967295|he>>>10),he=J+(de^pe&(te^de))+ne[1]+4129170786&4294967295,J=te+(he<<5&4294967295|he>>>27),he=pe+(te^de&(J^te))+ne[6]+3225465664&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=de+(J^te&(pe^J))+ne[11]+643717713&4294967295,de=pe+(he<<14&4294967295|he>>>18),he=te+(pe^J&(de^pe))+ne[0]+3921069994&4294967295,te=de+(he<<20&4294967295|he>>>12),he=J+(de^pe&(te^de))+ne[5]+3593408605&4294967295,J=te+(he<<5&4294967295|he>>>27),he=pe+(te^de&(J^te))+ne[10]+38016083&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=de+(J^te&(pe^J))+ne[15]+3634488961&4294967295,de=pe+(he<<14&4294967295|he>>>18),he=te+(pe^J&(de^pe))+ne[4]+3889429448&4294967295,te=de+(he<<20&4294967295|he>>>12),he=J+(de^pe&(te^de))+ne[9]+568446438&4294967295,J=te+(he<<5&4294967295|he>>>27),he=pe+(te^de&(J^te))+ne[14]+3275163606&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=de+(J^te&(pe^J))+ne[3]+4107603335&4294967295,de=pe+(he<<14&4294967295|he>>>18),he=te+(pe^J&(de^pe))+ne[8]+1163531501&4294967295,te=de+(he<<20&4294967295|he>>>12),he=J+(de^pe&(te^de))+ne[13]+2850285829&4294967295,J=te+(he<<5&4294967295|he>>>27),he=pe+(te^de&(J^te))+ne[2]+4243563512&4294967295,pe=J+(he<<9&4294967295|he>>>23),he=de+(J^te&(pe^J))+ne[7]+1735328473&4294967295,de=pe+(he<<14&4294967295|he>>>18),he=te+(pe^J&(de^pe))+ne[12]+2368359562&4294967295,te=de+(he<<20&4294967295|he>>>12),he=J+(te^de^pe)+ne[5]+4294588738&4294967295,J=te+(he<<4&4294967295|he>>>28),he=pe+(J^te^de)+ne[8]+2272392833&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=de+(pe^J^te)+ne[11]+1839030562&4294967295,de=pe+(he<<16&4294967295|he>>>16),he=te+(de^pe^J)+ne[14]+4259657740&4294967295,te=de+(he<<23&4294967295|he>>>9),he=J+(te^de^pe)+ne[1]+2763975236&4294967295,J=te+(he<<4&4294967295|he>>>28),he=pe+(J^te^de)+ne[4]+1272893353&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=de+(pe^J^te)+ne[7]+4139469664&4294967295,de=pe+(he<<16&4294967295|he>>>16),he=te+(de^pe^J)+ne[10]+3200236656&4294967295,te=de+(he<<23&4294967295|he>>>9),he=J+(te^de^pe)+ne[13]+681279174&4294967295,J=te+(he<<4&4294967295|he>>>28),he=pe+(J^te^de)+ne[0]+3936430074&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=de+(pe^J^te)+ne[3]+3572445317&4294967295,de=pe+(he<<16&4294967295|he>>>16),he=te+(de^pe^J)+ne[6]+76029189&4294967295,te=de+(he<<23&4294967295|he>>>9),he=J+(te^de^pe)+ne[9]+3654602809&4294967295,J=te+(he<<4&4294967295|he>>>28),he=pe+(J^te^de)+ne[12]+3873151461&4294967295,pe=J+(he<<11&4294967295|he>>>21),he=de+(pe^J^te)+ne[15]+530742520&4294967295,de=pe+(he<<16&4294967295|he>>>16),he=te+(de^pe^J)+ne[2]+3299628645&4294967295,te=de+(he<<23&4294967295|he>>>9),he=J+(de^(te|~pe))+ne[0]+4096336452&4294967295,J=te+(he<<6&4294967295|he>>>26),he=pe+(te^(J|~de))+ne[7]+1126891415&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=de+(J^(pe|~te))+ne[14]+2878612391&4294967295,de=pe+(he<<15&4294967295|he>>>17),he=te+(pe^(de|~J))+ne[5]+4237533241&4294967295,te=de+(he<<21&4294967295|he>>>11),he=J+(de^(te|~pe))+ne[12]+1700485571&4294967295,J=te+(he<<6&4294967295|he>>>26),he=pe+(te^(J|~de))+ne[3]+2399980690&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=de+(J^(pe|~te))+ne[10]+4293915773&4294967295,de=pe+(he<<15&4294967295|he>>>17),he=te+(pe^(de|~J))+ne[1]+2240044497&4294967295,te=de+(he<<21&4294967295|he>>>11),he=J+(de^(te|~pe))+ne[8]+1873313359&4294967295,J=te+(he<<6&4294967295|he>>>26),he=pe+(te^(J|~de))+ne[15]+4264355552&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=de+(J^(pe|~te))+ne[6]+2734768916&4294967295,de=pe+(he<<15&4294967295|he>>>17),he=te+(pe^(de|~J))+ne[13]+1309151649&4294967295,te=de+(he<<21&4294967295|he>>>11),he=J+(de^(te|~pe))+ne[4]+4149444226&4294967295,J=te+(he<<6&4294967295|he>>>26),he=pe+(te^(J|~de))+ne[11]+3174756917&4294967295,pe=J+(he<<10&4294967295|he>>>22),he=de+(J^(pe|~te))+ne[2]+718787259&4294967295,de=pe+(he<<15&4294967295|he>>>17),he=te+(pe^(de|~J))+ne[9]+3951481745&4294967295,X.g[0]=X.g[0]+J&4294967295,X.g[1]=X.g[1]+(de+(he<<21&4294967295|he>>>11))&4294967295,X.g[2]=X.g[2]+de&4294967295,X.g[3]=X.g[3]+pe&4294967295}o.prototype.u=function(X,J){J===void 0&&(J=X.length);for(var te=J-this.blockSize,ne=this.B,de=this.h,pe=0;pe<J;){if(de==0)for(;pe<=te;)l(this,X,pe),pe+=this.blockSize;if(typeof X=="string"){for(;pe<J;)if(ne[de++]=X.charCodeAt(pe++),de==this.blockSize){l(this,ne),de=0;break}}else for(;pe<J;)if(ne[de++]=X[pe++],de==this.blockSize){l(this,ne),de=0;break}}this.h=de,this.o+=J},o.prototype.v=function(){var X=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);X[0]=128;for(var J=1;J<X.length-8;++J)X[J]=0;var te=8*this.o;for(J=X.length-8;J<X.length;++J)X[J]=te&255,te/=256;for(this.u(X),X=Array(16),J=te=0;4>J;++J)for(var ne=0;32>ne;ne+=8)X[te++]=this.g[J]>>>ne&255;return X};function u(X,J){var te=y;return Object.prototype.hasOwnProperty.call(te,X)?te[X]:te[X]=J(X)}function p(X,J){this.h=J;for(var te=[],ne=!0,de=X.length-1;0<=de;de--){var pe=X[de]|0;ne&&pe==J||(te[de]=pe,ne=!1)}this.g=te}var y={};function v(X){return-128<=X&&128>X?u(X,function(J){return new p([J|0],0>J?-1:0)}):new p([X|0],0>X?-1:0)}function w(X){if(isNaN(X)||!isFinite(X))return R;if(0>X)return z(w(-X));for(var J=[],te=1,ne=0;X>=te;ne++)J[ne]=X/te|0,te*=4294967296;return new p(J,0)}function C(X,J){if(X.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(X.charAt(0)=="-")return z(C(X.substring(1),J));if(0<=X.indexOf("-"))throw Error('number format error: interior "-" character');for(var te=w(Math.pow(J,8)),ne=R,de=0;de<X.length;de+=8){var pe=Math.min(8,X.length-de),he=parseInt(X.substring(de,de+pe),J);8>pe?(pe=w(Math.pow(J,pe)),ne=ne.j(pe).add(w(he))):(ne=ne.j(te),ne=ne.add(w(he)))}return ne}var R=v(0),N=v(1),M=v(16777216);n=p.prototype,n.m=function(){if(F(this))return-z(this).m();for(var X=0,J=1,te=0;te<this.g.length;te++){var ne=this.i(te);X+=(0<=ne?ne:4294967296+ne)*J,J*=4294967296}return X},n.toString=function(X){if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(D(this))return"0";if(F(this))return"-"+z(this).toString(X);for(var J=w(Math.pow(X,6)),te=this,ne="";;){var de=ce(te,J).g;te=q(te,de.j(J));var pe=((0<te.g.length?te.g[0]:te.h)>>>0).toString(X);if(te=de,D(te))return pe+ne;for(;6>pe.length;)pe="0"+pe;ne=pe+ne}},n.i=function(X){return 0>X?0:X<this.g.length?this.g[X]:this.h};function D(X){if(X.h!=0)return!1;for(var J=0;J<X.g.length;J++)if(X.g[J]!=0)return!1;return!0}function F(X){return X.h==-1}n.l=function(X){return X=q(this,X),F(X)?-1:D(X)?0:1};function z(X){for(var J=X.g.length,te=[],ne=0;ne<J;ne++)te[ne]=~X.g[ne];return new p(te,~X.h).add(N)}n.abs=function(){return F(this)?z(this):this},n.add=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ne=0,de=0;de<=J;de++){var pe=ne+(this.i(de)&65535)+(X.i(de)&65535),he=(pe>>>16)+(this.i(de)>>>16)+(X.i(de)>>>16);ne=he>>>16,pe&=65535,he&=65535,te[de]=he<<16|pe}return new p(te,te[te.length-1]&-2147483648?-1:0)};function q(X,J){return X.add(z(J))}n.j=function(X){if(D(this)||D(X))return R;if(F(this))return F(X)?z(this).j(z(X)):z(z(this).j(X));if(F(X))return z(this.j(z(X)));if(0>this.l(M)&&0>X.l(M))return w(this.m()*X.m());for(var J=this.g.length+X.g.length,te=[],ne=0;ne<2*J;ne++)te[ne]=0;for(ne=0;ne<this.g.length;ne++)for(var de=0;de<X.g.length;de++){var pe=this.i(ne)>>>16,he=this.i(ne)&65535,ve=X.i(de)>>>16,Te=X.i(de)&65535;te[2*ne+2*de]+=he*Te,K(te,2*ne+2*de),te[2*ne+2*de+1]+=pe*Te,K(te,2*ne+2*de+1),te[2*ne+2*de+1]+=he*ve,K(te,2*ne+2*de+1),te[2*ne+2*de+2]+=pe*ve,K(te,2*ne+2*de+2)}for(ne=0;ne<J;ne++)te[ne]=te[2*ne+1]<<16|te[2*ne];for(ne=J;ne<2*J;ne++)te[ne]=0;return new p(te,0)};function K(X,J){for(;(X[J]&65535)!=X[J];)X[J+1]+=X[J]>>>16,X[J]&=65535,J++}function re(X,J){this.g=X,this.h=J}function ce(X,J){if(D(J))throw Error("division by zero");if(D(X))return new re(R,R);if(F(X))return J=ce(z(X),J),new re(z(J.g),z(J.h));if(F(J))return J=ce(X,z(J)),new re(z(J.g),J.h);if(30<X.g.length){if(F(X)||F(J))throw Error("slowDivide_ only works with positive integers.");for(var te=N,ne=J;0>=ne.l(X);)te=se(te),ne=se(ne);var de=ge(te,1),pe=ge(ne,1);for(ne=ge(ne,2),te=ge(te,2);!D(ne);){var he=pe.add(ne);0>=he.l(X)&&(de=de.add(te),pe=he),ne=ge(ne,1),te=ge(te,1)}return J=q(X,de.j(J)),new re(de,J)}for(de=R;0<=X.l(J);){for(te=Math.max(1,Math.floor(X.m()/J.m())),ne=Math.ceil(Math.log(te)/Math.LN2),ne=48>=ne?1:Math.pow(2,ne-48),pe=w(te),he=pe.j(J);F(he)||0<he.l(X);)te-=ne,pe=w(te),he=pe.j(J);D(pe)&&(pe=N),de=de.add(pe),X=q(X,he)}return new re(de,X)}n.A=function(X){return ce(this,X).h},n.and=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ne=0;ne<J;ne++)te[ne]=this.i(ne)&X.i(ne);return new p(te,this.h&X.h)},n.or=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ne=0;ne<J;ne++)te[ne]=this.i(ne)|X.i(ne);return new p(te,this.h|X.h)},n.xor=function(X){for(var J=Math.max(this.g.length,X.g.length),te=[],ne=0;ne<J;ne++)te[ne]=this.i(ne)^X.i(ne);return new p(te,this.h^X.h)};function se(X){for(var J=X.g.length+1,te=[],ne=0;ne<J;ne++)te[ne]=X.i(ne)<<1|X.i(ne-1)>>>31;return new p(te,X.h)}function ge(X,J){var te=J>>5;J%=32;for(var ne=X.g.length-te,de=[],pe=0;pe<ne;pe++)de[pe]=0<J?X.i(pe+te)>>>J|X.i(pe+te+1)<<32-J:X.i(pe+te);return new p(de,X.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,pse=o,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=w,p.fromString=C,Ng=p}).apply(typeof LJ<"u"?LJ:typeof self<"u"?self:typeof window<"u"?window:{});var ok=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var fse,yC,mse,Wk,vF,gse,_se,yse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,H,ie){return P==Array.prototype||P==Object.prototype||(P[H]=ie.value),P};function i(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof ok=="object"&&ok];for(var H=0;H<P.length;++H){var ie=P[H];if(ie&&ie.Math==Math)return ie}throw Error("Cannot find global object")}var o=i(this);function l(P,H){if(H)e:{var ie=o;P=P.split(".");for(var Se=0;Se<P.length-1;Se++){var Ye=P[Se];if(!(Ye in ie))break e;ie=ie[Ye]}P=P[P.length-1],Se=ie[P],H=H(Se),H!=Se&&H!=null&&e(ie,P,{configurable:!0,writable:!0,value:H})}}function u(P,H){P instanceof String&&(P+="");var ie=0,Se=!1,Ye={next:function(){if(!Se&&ie<P.length){var ht=ie++;return{value:H(ht,P[ht]),done:!1}}return Se=!0,{done:!0,value:void 0}}};return Ye[Symbol.iterator]=function(){return Ye},Ye}l("Array.prototype.values",function(P){return P||function(){return u(this,function(H,ie){return ie})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},y=this||self;function v(P){var H=typeof P;return H=H!="object"?H:P?Array.isArray(P)?"array":H:"null",H=="array"||H=="object"&&typeof P.length=="number"}function w(P){var H=typeof P;return H=="object"&&P!=null||H=="function"}function C(P,H,ie){return P.call.apply(P.bind,arguments)}function R(P,H,ie){if(!P)throw Error();if(2<arguments.length){var Se=Array.prototype.slice.call(arguments,2);return function(){var Ye=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ye,Se),P.apply(H,Ye)}}return function(){return P.apply(H,arguments)}}function N(P,H,ie){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:R,N.apply(null,arguments)}function M(P,H){var ie=Array.prototype.slice.call(arguments,1);return function(){var Se=ie.slice();return Se.push.apply(Se,arguments),P.apply(this,Se)}}function D(P,H){function ie(){}ie.prototype=H.prototype,P.aa=H.prototype,P.prototype=new ie,P.prototype.constructor=P,P.Qb=function(Se,Ye,ht){for(var Kt=Array(arguments.length-2),si=2;si<arguments.length;si++)Kt[si-2]=arguments[si];return H.prototype[Ye].apply(Se,Kt)}}function F(P){const H=P.length;if(0<H){const ie=Array(H);for(let Se=0;Se<H;Se++)ie[Se]=P[Se];return ie}return[]}function z(P,H){for(let ie=1;ie<arguments.length;ie++){const Se=arguments[ie];if(v(Se)){const Ye=P.length||0,ht=Se.length||0;P.length=Ye+ht;for(let Kt=0;Kt<ht;Kt++)P[Ye+Kt]=Se[Kt]}else P.push(Se)}}class q{constructor(H,ie){this.i=H,this.j=ie,this.h=0,this.g=null}get(){let H;return 0<this.h?(this.h--,H=this.g,this.g=H.next,H.next=null):H=this.i(),H}}function K(P){return/^[\s\xa0]*$/.test(P)}function re(){var P=y.navigator;return P&&(P=P.userAgent)?P:""}function ce(P){return ce[" "](P),P}ce[" "]=function(){};var se=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function ge(P,H,ie){for(const Se in P)H.call(ie,P[Se],Se,P)}function X(P,H){for(const ie in P)H.call(void 0,P[ie],ie,P)}function J(P){const H={};for(const ie in P)H[ie]=P[ie];return H}const te="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ne(P,H){let ie,Se;for(let Ye=1;Ye<arguments.length;Ye++){Se=arguments[Ye];for(ie in Se)P[ie]=Se[ie];for(let ht=0;ht<te.length;ht++)ie=te[ht],Object.prototype.hasOwnProperty.call(Se,ie)&&(P[ie]=Se[ie])}}function de(P){var H=1;P=P.split(":");const ie=[];for(;0<H&&P.length;)ie.push(P.shift()),H--;return P.length&&ie.push(P.join(":")),ie}function pe(P){y.setTimeout(()=>{throw P},0)}function he(){var P=Ae;let H=null;return P.g&&(H=P.g,P.g=P.g.next,P.g||(P.h=null),H.next=null),H}class ve{constructor(){this.h=this.g=null}add(H,ie){const Se=Te.get();Se.set(H,ie),this.h?this.h.next=Se:this.g=Se,this.h=Se}}var Te=new q(()=>new Fe,P=>P.reset());class Fe{constructor(){this.next=this.g=this.h=null}set(H,ie){this.h=H,this.g=ie,this.next=null}reset(){this.next=this.g=this.h=null}}let be,Re=!1,Ae=new ve,xe=()=>{const P=y.Promise.resolve(void 0);be=()=>{P.then(Ee)}};var Ee=()=>{for(var P;P=he();){try{P.h.call(P.g)}catch(ie){pe(ie)}var H=Te;H.j(P),100>H.h&&(H.h++,P.next=H.g,H.g=P)}Re=!1};function Ne(){this.s=this.s,this.C=this.C}Ne.prototype.s=!1,Ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function je(P,H){this.type=P,this.g=this.target=H,this.defaultPrevented=!1}je.prototype.h=function(){this.defaultPrevented=!0};var qe=function(){if(!y.addEventListener||!Object.defineProperty)return!1;var P=!1,H=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const ie=()=>{};y.addEventListener("test",ie,H),y.removeEventListener("test",ie,H)}catch{}return P}();function at(P,H){if(je.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var ie=this.type=P.type,Se=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=H,H=P.relatedTarget){if(se){e:{try{ce(H.nodeName);var Ye=!0;break e}catch{}Ye=!1}Ye||(H=null)}}else ie=="mouseover"?H=P.fromElement:ie=="mouseout"&&(H=P.toElement);this.relatedTarget=H,Se?(this.clientX=Se.clientX!==void 0?Se.clientX:Se.pageX,this.clientY=Se.clientY!==void 0?Se.clientY:Se.pageY,this.screenX=Se.screenX||0,this.screenY=Se.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:_t[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&at.aa.h.call(this)}}D(at,je);var _t={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),vt=0;function it(P,H,ie,Se,Ye){this.listener=P,this.proxy=null,this.src=H,this.type=ie,this.capture=!!Se,this.ha=Ye,this.key=++vt,this.da=this.fa=!1}function wt(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function $t(P){this.src=P,this.g={},this.h=0}$t.prototype.add=function(P,H,ie,Se,Ye){var ht=P.toString();P=this.g[ht],P||(P=this.g[ht]=[],this.h++);var Kt=mt(P,H,Se,Ye);return-1<Kt?(H=P[Kt],ie||(H.fa=!1)):(H=new it(H,this.src,ht,!!Se,Ye),H.fa=ie,P.push(H)),H};function dt(P,H){var ie=H.type;if(ie in P.g){var Se=P.g[ie],Ye=Array.prototype.indexOf.call(Se,H,void 0),ht;(ht=0<=Ye)&&Array.prototype.splice.call(Se,Ye,1),ht&&(wt(H),P.g[ie].length==0&&(delete P.g[ie],P.h--))}}function mt(P,H,ie,Se){for(var Ye=0;Ye<P.length;++Ye){var ht=P[Ye];if(!ht.da&&ht.listener==H&&ht.capture==!!ie&&ht.ha==Se)return Ye}return-1}var ct="closure_lm_"+(1e6*Math.random()|0),Ft={};function sn(P,H,ie,Se,Ye){if(Array.isArray(H)){for(var ht=0;ht<H.length;ht++)sn(P,H[ht],ie,Se,Ye);return null}return ie=Sn(ie),P&&P[ut]?P.K(H,ie,w(Se)?!!Se.capture:!1,Ye):Ht(P,H,ie,!1,Se,Ye)}function Ht(P,H,ie,Se,Ye,ht){if(!H)throw Error("Invalid event type");var Kt=w(Ye)?!!Ye.capture:!!Ye,si=Tt(P);if(si||(P[ct]=si=new $t(P)),ie=si.add(H,ie,Se,Kt,ht),ie.proxy)return ie;if(Se=we(),ie.proxy=Se,Se.src=P,Se.listener=ie,P.addEventListener)qe||(Ye=Kt),Ye===void 0&&(Ye=!1),P.addEventListener(H.toString(),Se,Ye);else if(P.attachEvent)P.attachEvent(kt(H.toString()),Se);else if(P.addListener&&P.removeListener)P.addListener(Se);else throw Error("addEventListener and attachEvent are unavailable.");return ie}function we(){function P(ie){return H.call(P.src,P.listener,ie)}const H=At;return P}function De(P,H,ie,Se,Ye){if(Array.isArray(H))for(var ht=0;ht<H.length;ht++)De(P,H[ht],ie,Se,Ye);else Se=w(Se)?!!Se.capture:!!Se,ie=Sn(ie),P&&P[ut]?(P=P.i,H=String(H).toString(),H in P.g&&(ht=P.g[H],ie=mt(ht,ie,Se,Ye),-1<ie&&(wt(ht[ie]),Array.prototype.splice.call(ht,ie,1),ht.length==0&&(delete P.g[H],P.h--)))):P&&(P=Tt(P))&&(H=P.g[H.toString()],P=-1,H&&(P=mt(H,ie,Se,Ye)),(ie=-1<P?H[P]:null)&&$e(ie))}function $e(P){if(typeof P!="number"&&P&&!P.da){var H=P.src;if(H&&H[ut])dt(H.i,P);else{var ie=P.type,Se=P.proxy;H.removeEventListener?H.removeEventListener(ie,Se,P.capture):H.detachEvent?H.detachEvent(kt(ie),Se):H.addListener&&H.removeListener&&H.removeListener(Se),(ie=Tt(H))?(dt(ie,P),ie.h==0&&(ie.src=null,H[ct]=null)):wt(P)}}}function kt(P){return P in Ft?Ft[P]:Ft[P]="on"+P}function At(P,H){if(P.da)P=!0;else{H=new at(H,this);var ie=P.listener,Se=P.ha||P.src;P.fa&&$e(P),P=ie.call(Se,H)}return P}function Tt(P){return P=P[ct],P instanceof $t?P:null}var Ut="__closure_events_fn_"+(1e9*Math.random()>>>0);function Sn(P){return typeof P=="function"?P:(P[Ut]||(P[Ut]=function(H){return P.handleEvent(H)}),P[Ut])}function Pn(){Ne.call(this),this.i=new $t(this),this.M=this,this.F=null}D(Pn,Ne),Pn.prototype[ut]=!0,Pn.prototype.removeEventListener=function(P,H,ie,Se){De(this,P,H,ie,Se)};function hn(P,H){var ie,Se=P.F;if(Se)for(ie=[];Se;Se=Se.F)ie.push(Se);if(P=P.M,Se=H.type||H,typeof H=="string")H=new je(H,P);else if(H instanceof je)H.target=H.target||P;else{var Ye=H;H=new je(Se,P),ne(H,Ye)}if(Ye=!0,ie)for(var ht=ie.length-1;0<=ht;ht--){var Kt=H.g=ie[ht];Ye=Rt(Kt,Se,!0,H)&&Ye}if(Kt=H.g=P,Ye=Rt(Kt,Se,!0,H)&&Ye,Ye=Rt(Kt,Se,!1,H)&&Ye,ie)for(ht=0;ht<ie.length;ht++)Kt=H.g=ie[ht],Ye=Rt(Kt,Se,!1,H)&&Ye}Pn.prototype.N=function(){if(Pn.aa.N.call(this),this.i){var P=this.i,H;for(H in P.g){for(var ie=P.g[H],Se=0;Se<ie.length;Se++)wt(ie[Se]);delete P.g[H],P.h--}}this.F=null},Pn.prototype.K=function(P,H,ie,Se){return this.i.add(String(P),H,!1,ie,Se)},Pn.prototype.L=function(P,H,ie,Se){return this.i.add(String(P),H,!0,ie,Se)};function Rt(P,H,ie,Se){if(H=P.i.g[String(H)],!H)return!0;H=H.concat();for(var Ye=!0,ht=0;ht<H.length;++ht){var Kt=H[ht];if(Kt&&!Kt.da&&Kt.capture==ie){var si=Kt.listener,Ys=Kt.ha||Kt.src;Kt.fa&&dt(P.i,Kt),Ye=si.call(Ys,Se)!==!1&&Ye}}return Ye&&!Se.defaultPrevented}function Zn(P,H,ie){if(typeof P=="function")ie&&(P=N(P,ie));else if(P&&typeof P.handleEvent=="function")P=N(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number(H)?-1:y.setTimeout(P,H||0)}function Dt(P){P.g=Zn(()=>{P.g=null,P.i&&(P.i=!1,Dt(P))},P.l);const H=P.h;P.h=null,P.m.apply(null,H)}class Xt extends Ne{constructor(H,ie){super(),this.m=H,this.l=ie,this.h=null,this.i=!1,this.g=null}j(H){this.h=arguments,this.g?this.i=!0:Dt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vr(P){Ne.call(this),this.h=P,this.g={}}D(Vr,Ne);var Oi=[];function li(P){ge(P.g,function(H,ie){this.g.hasOwnProperty(ie)&&$e(H)},P),P.g={}}Vr.prototype.N=function(){Vr.aa.N.call(this),li(this)},Vr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ni=y.JSON.stringify,Es=y.JSON.parse,Yo=class{stringify(P){return y.JSON.stringify(P,void 0)}parse(P){return y.JSON.parse(P,void 0)}};function qi(){}qi.prototype.h=null;function xi(P){return P.h||(P.h=P.i())}function Kn(){}var ps={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ha(){je.call(this,"d")}D(ha,je);function Xo(){je.call(this,"c")}D(Xo,je);var go={},ld=null;function Jo(){return ld=ld||new Pn}go.La="serverreachability";function ud(P){je.call(this,go.La,P)}D(ud,je);function fc(P){const H=Jo();hn(H,new ud(H))}go.STAT_EVENT="statevent";function Ao(P,H){je.call(this,go.STAT_EVENT,P),this.stat=H}D(Ao,je);function wr(P){const H=Jo();hn(H,new Ao(H,P))}go.Ma="timingevent";function uu(P,H){je.call(this,go.Ma,P),this.size=H}D(uu,je);function pa(P,H){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){P()},H)}function Ba(){this.g=!0}Ba.prototype.xa=function(){this.g=!1};function Vc(P,H,ie,Se,Ye,ht){P.info(function(){if(P.g)if(ht)for(var Kt="",si=ht.split("&"),Ys=0;Ys<si.length;Ys++){var dr=si[Ys].split("=");if(1<dr.length){var yo=dr[0];dr=dr[1];var Ms=yo.split("_");Kt=2<=Ms.length&&Ms[1]=="type"?Kt+(yo+"="+dr+"&"):Kt+(yo+"=redacted&")}}else Kt=null;else Kt=ht;return"XMLHTTP REQ ("+Se+") [attempt "+Ye+"]: "+H+`
`+ie+`
`+Kt})}function Qo(P,H,ie,Se,Ye,ht,Kt){P.info(function(){return"XMLHTTP RESP ("+Se+") [ attempt "+Ye+"]: "+H+`
`+ie+`
`+ht+" "+Kt})}function Zo(P,H,ie,Se){P.info(function(){return"XMLHTTP TEXT ("+H+"): "+gh(P,ie)+(Se?" "+Se:"")})}function dd(P,H){P.info(function(){return"TIMEOUT: "+H})}Ba.prototype.info=function(){};function gh(P,H){if(!P.g)return H;if(!H)return null;try{var ie=JSON.parse(H);if(ie){for(P=0;P<ie.length;P++)if(Array.isArray(ie[P])){var Se=ie[P];if(!(2>Se.length)){var Ye=Se[1];if(Array.isArray(Ye)&&!(1>Ye.length)){var ht=Ye[0];if(ht!="noop"&&ht!="stop"&&ht!="close")for(var Kt=1;Kt<Ye.length;Kt++)Ye[Kt]=""}}}}return Ni(ie)}catch{return H}}var Tl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},_h={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xs;function pt(){}D(pt,qi),pt.prototype.g=function(){return new XMLHttpRequest},pt.prototype.i=function(){return{}},xs=new pt;function rn(P,H,ie,Se){this.j=P,this.i=H,this.l=ie,this.R=Se||1,this.U=new Vr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new kr}function kr(){this.i=null,this.g="",this.h=!1}var Di={},mc={};function _o(P,H,ie){P.L=1,P.v=pu(ga(H)),P.m=ie,P.P=!0,Cl(P,null)}function Cl(P,H){P.F=Date.now(),Gr(P),P.A=ga(P.v);var ie=P.A,Se=P.R;Array.isArray(Se)||(Se=[String(Se)]),mu(ie.i,"t",Se),P.C=0,ie=P.j.J,P.h=new kr,P.g=n_(P.j,ie?H:null,!P.m),0<P.O&&(P.M=new Xt(N(P.Y,P,P.g),P.O)),H=P.U,ie=P.g,Se=P.ca;var Ye="readystatechange";Array.isArray(Ye)||(Ye&&(Oi[0]=Ye.toString()),Ye=Oi);for(var ht=0;ht<Ye.length;ht++){var Kt=sn(ie,Ye[ht],Se||H.handleEvent,!1,H.h||H);if(!Kt)break;H.g[Kt.key]=Kt}H=P.H?J(P.H):{},P.m?(P.u||(P.u="POST"),H["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,H)):(P.u="GET",P.g.ea(P.A,P.u,null,H)),fc(),Vc(P.i,P.u,P.A,P.l,P.R,P.m)}rn.prototype.ca=function(P){P=P.target;const H=this.M;H&&Li(P)==3?H.j():this.Y(P)},rn.prototype.Y=function(P){try{if(P==this.g)e:{const Ms=Li(this.g);var H=this.g.Ba();const Wc=this.g.Z();if(!(3>Ms)&&(Ms!=3||this.g&&(this.h.h||this.g.oa()||qs(this.g)))){this.J||Ms!=4||H==7||(H==8||0>=Wc?fc(3):fc(2)),Hr(this);var ie=this.g.Z();this.X=ie;t:if(yh(this)){var Se=qs(this.g);P="";var Ye=Se.length,ht=Li(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Yi(this),fa(this);var Kt="";break t}this.h.i=new y.TextDecoder}for(H=0;H<Ye;H++)this.h.h=!0,P+=this.h.i.decode(Se[H],{stream:!(ht&&H==Ye-1)});Se.length=0,this.h.g+=P,this.C=0,Kt=this.h.g}else Kt=this.g.oa();if(this.o=ie==200,Qo(this.i,this.u,this.A,this.l,this.R,Ms,ie),this.o){if(this.T&&!this.K){t:{if(this.g){var si,Ys=this.g;if((si=Ys.g?Ys.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(si)){var dr=si;break t}}dr=null}if(ie=dr)Zo(this.i,this.l,ie,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vs(this,ie);else{this.o=!1,this.s=3,wr(12),Yi(this),fa(this);break e}}if(this.P){ie=!0;let Ha;for(;!this.J&&this.C<Kt.length;)if(Ha=Ks(this,Kt),Ha==mc){Ms==4&&(this.s=4,wr(14),ie=!1),Zo(this.i,this.l,null,"[Incomplete Response]");break}else if(Ha==Di){this.s=4,wr(15),Zo(this.i,this.l,Kt,"[Invalid Chunk]"),ie=!1;break}else Zo(this.i,this.l,Ha,null),vs(this,Ha);if(yh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ms!=4||Kt.length!=0||this.h.h||(this.s=1,wr(16),ie=!1),this.o=this.o&&ie,!ie)Zo(this.i,this.l,Kt,"[Invalid Chunked Response]"),Yi(this),fa(this);else if(0<Kt.length&&!this.W){this.W=!0;var yo=this.j;yo.g==this&&yo.ba&&!yo.M&&(yo.j.info("Great, no buffering proxy detected. Bytes received: "+Kt.length),t_(yo),yo.M=!0,wr(11))}}else Zo(this.i,this.l,Kt,null),vs(this,Kt);Ms==4&&Yi(this),this.o&&!this.J&&(Ms==4?am(this.j,this):(this.o=!1,Gr(this)))}else Bc(this.g),ie==400&&0<Kt.indexOf("Unknown SID")?(this.s=3,wr(12)):(this.s=0,wr(13)),Yi(this),fa(this)}}}catch{}finally{}};function yh(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function Ks(P,H){var ie=P.C,Se=H.indexOf(`
`,ie);return Se==-1?mc:(ie=Number(H.substring(ie,Se)),isNaN(ie)?Di:(Se+=1,Se+ie>H.length?mc:(H=H.slice(Se,Se+ie),P.C=Se+ie,H)))}rn.prototype.cancel=function(){this.J=!0,Yi(this)};function Gr(P){P.S=Date.now()+P.I,Eh(P,P.I)}function Eh(P,H){if(P.B!=null)throw Error("WatchDog timer not null");P.B=pa(N(P.ba,P),H)}function Hr(P){P.B&&(y.clearTimeout(P.B),P.B=null)}rn.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(dd(this.i,this.A),this.L!=2&&(fc(),wr(17)),Yi(this),this.s=2,fa(this)):Eh(this,this.S-P)};function fa(P){P.j.G==0||P.J||am(P.j,P)}function Yi(P){Hr(P);var H=P.M;H&&typeof H.ma=="function"&&H.ma(),P.M=null,li(P.U),P.g&&(H=P.g,P.g=null,H.abort(),H.ma())}function vs(P,H){try{var ie=P.j;if(ie.G!=0&&(ie.g==P||Po(ie.h,P))){if(!P.K&&Po(ie.h,P)&&ie.G==3){try{var Se=ie.Da.g.parse(H)}catch{Se=null}if(Array.isArray(Se)&&Se.length==3){var Ye=Se;if(Ye[0]==0){e:if(!ie.u){if(ie.g)if(ie.g.F+3e3<P.F)om(ie),_c(ie);else break e;yu(ie),wr(18)}}else ie.za=Ye[1],0<ie.za-ie.T&&37500>Ye[2]&&ie.F&&ie.v==0&&!ie.C&&(ie.C=pa(N(ie.Za,ie),6e3));if(1>=jp(ie.h)&&ie.ca){try{ie.ca()}catch{}ie.ca=void 0}}else Ga(ie,11)}else if((P.K||ie.g==P)&&om(ie),!K(H))for(Ye=ie.Da.g.parse(H),H=0;H<Ye.length;H++){let dr=Ye[H];if(ie.T=dr[0],dr=dr[1],ie.G==2)if(dr[0]=="c"){ie.K=dr[1],ie.ia=dr[2];const yo=dr[3];yo!=null&&(ie.la=yo,ie.j.info("VER="+ie.la));const Ms=dr[4];Ms!=null&&(ie.Aa=Ms,ie.j.info("SVER="+ie.Aa));const Wc=dr[5];Wc!=null&&typeof Wc=="number"&&0<Wc&&(Se=1.5*Wc,ie.L=Se,ie.j.info("backChannelRequestTimeoutMs_="+Se)),Se=ie;const Ha=P.g;if(Ha){const _d=Ha.g?Ha.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_d){var ht=Se.h;ht.g||_d.indexOf("spdy")==-1&&_d.indexOf("quic")==-1&&_d.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Bp(ht,ht.h),ht.h=null))}if(Se.D){const cm=Ha.g?Ha.g.getResponseHeader("X-HTTP-Session-Id"):null;cm&&(Se.ya=cm,ui(Se.I,Se.D,cm))}}ie.G=3,ie.l&&ie.l.ua(),ie.ba&&(ie.R=Date.now()-P.F,ie.j.info("Handshake RTT: "+ie.R+"ms")),Se=ie;var Kt=P;if(Se.qa=gd(Se,Se.J?Se.ia:null,Se.W),Kt.K){nm(Se.h,Kt);var si=Kt,Ys=Se.L;Ys&&(si.I=Ys),si.B&&(Hr(si),Gr(si)),Se.g=Kt}else yc(Se);0<ie.i.length&&zc(ie)}else dr[0]!="stop"&&dr[0]!="close"||Ga(ie,7);else ie.G==3&&(dr[0]=="stop"||dr[0]=="close"?dr[0]=="stop"?Ga(ie,7):Ls(ie):dr[0]!="noop"&&ie.l&&ie.l.ta(dr),ie.v=0)}}fc(4)}catch{}}var ri=class{constructor(P,H){this.g=P,this.map=H}};function Fc(P){this.l=P||10,y.PerformanceNavigationTiming?(P=y.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ma(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function jp(P){return P.h?1:P.g?P.g.size:0}function Po(P,H){return P.h?P.h==H:P.g?P.g.has(H):!1}function Bp(P,H){P.g?P.g.add(H):P.h=H}function nm(P,H){P.h&&P.h==H?P.h=null:P.g&&P.g.has(H)&&P.g.delete(H)}Fc.prototype.cancel=function(){if(this.i=Rl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function Rl(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let H=P.i;for(const ie of P.g.values())H=H.concat(ie.D);return H}return F(P.i)}function du(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(v(P)){for(var H=[],ie=P.length,Se=0;Se<ie;Se++)H.push(P[Se]);return H}H=[],ie=0;for(Se in P)H[ie++]=P[Se];return H}function vh(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(v(P)||typeof P=="string"){var H=[];P=P.length;for(var ie=0;ie<P;ie++)H.push(ie);return H}H=[],ie=0;for(const Se in P)H[ie++]=Se;return H}}}function Or(P,H){if(P.forEach&&typeof P.forEach=="function")P.forEach(H,void 0);else if(v(P)||typeof P=="string")Array.prototype.forEach.call(P,H,void 0);else for(var ie=vh(P),Se=du(P),Ye=Se.length,ht=0;ht<Ye;ht++)H.call(void 0,Se[ht],ie&&ie[ht],P)}var hd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pd(P,H){if(P){P=P.split("&");for(var ie=0;ie<P.length;ie++){var Se=P[ie].indexOf("="),Ye=null;if(0<=Se){var ht=P[ie].substring(0,Se);Ye=P[ie].substring(Se+1)}else ht=P[ie];H(ht,Ye?decodeURIComponent(Ye.replace(/\+/g," ")):"")}}}function za(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof za){this.h=P.h,fd(this,P.j),this.o=P.o,this.g=P.g,Il(this,P.s),this.l=P.l;var H=P.i,ie=new _a;ie.i=H.i,H.g&&(ie.g=new Map(H.g),ie.h=H.h),hu(this,ie),this.m=P.m}else P&&(H=String(P).match(hd))?(this.h=!1,fd(this,H[1]||"",!0),this.o=fr(H[2]||""),this.g=fr(H[3]||"",!0),Il(this,H[4]),this.l=fr(H[5]||"",!0),hu(this,H[6]||"",!0),this.m=fr(H[7]||"")):(this.h=!1,this.i=new _a(null,this.h))}za.prototype.toString=function(){var P=[],H=this.j;H&&P.push(Al(H,bh,!0),":");var ie=this.g;return(ie||H=="file")&&(P.push("//"),(H=this.o)&&P.push(Al(H,bh,!0),"@"),P.push(encodeURIComponent(String(ie)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ie=this.s,ie!=null&&P.push(":",String(ie))),(ie=this.l)&&(this.g&&ie.charAt(0)!="/"&&P.push("/"),P.push(Al(ie,ie.charAt(0)=="/"?rm:fu,!0))),(ie=this.i.toString())&&P.push("?",ie),(ie=this.m)&&P.push("#",Al(ie,Wp)),P.join("")};function ga(P){return new za(P)}function fd(P,H,ie){P.j=ie?fr(H,!0):H,P.j&&(P.j=P.j.replace(/:$/,""))}function Il(P,H){if(H){if(H=Number(H),isNaN(H)||0>H)throw Error("Bad port number "+H);P.s=H}else P.s=null}function hu(P,H,ie){H instanceof _a?(P.i=H,Wa(P.i,P.h)):(ie||(H=Al(H,zp)),P.i=new _a(H,P.h))}function ui(P,H,ie){P.i.set(H,ie)}function pu(P){return ui(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function fr(P,H){return P?H?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function Al(P,H,ie){return typeof P=="string"?(P=encodeURI(P).replace(H,Sh),ie&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function Sh(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var bh=/[#\/\?@]/g,fu=/[#\?:]/g,rm=/[#\?]/g,zp=/[#\?@]/g,Wp=/#/g;function _a(P,H){this.h=this.g=null,this.i=P||null,this.j=!!H}function Ss(P){P.g||(P.g=new Map,P.h=0,P.i&&pd(P.i,function(H,ie){P.add(decodeURIComponent(H.replace(/\+/g," ")),ie)}))}n=_a.prototype,n.add=function(P,H){Ss(this),this.i=null,P=va(this,P);var ie=this.g.get(P);return ie||this.g.set(P,ie=[]),ie.push(H),this.h+=1,this};function ya(P,H){Ss(P),H=va(P,H),P.g.has(H)&&(P.i=null,P.h-=P.g.get(H).length,P.g.delete(H))}function Ea(P,H){return Ss(P),H=va(P,H),P.g.has(H)}n.forEach=function(P,H){Ss(this),this.g.forEach(function(ie,Se){ie.forEach(function(Ye){P.call(H,Ye,Se,this)},this)},this)},n.na=function(){Ss(this);const P=Array.from(this.g.values()),H=Array.from(this.g.keys()),ie=[];for(let Se=0;Se<H.length;Se++){const Ye=P[Se];for(let ht=0;ht<Ye.length;ht++)ie.push(H[Se])}return ie},n.V=function(P){Ss(this);let H=[];if(typeof P=="string")Ea(this,P)&&(H=H.concat(this.g.get(va(this,P))));else{P=Array.from(this.g.values());for(let ie=0;ie<P.length;ie++)H=H.concat(P[ie])}return H},n.set=function(P,H){return Ss(this),this.i=null,P=va(this,P),Ea(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[H]),this.h+=1,this},n.get=function(P,H){return P?(P=this.V(P),0<P.length?String(P[0]):H):H};function mu(P,H,ie){ya(P,H),0<ie.length&&(P.i=null,P.g.set(va(P,H),F(ie)),P.h+=ie.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],H=Array.from(this.g.keys());for(var ie=0;ie<H.length;ie++){var Se=H[ie];const ht=encodeURIComponent(String(Se)),Kt=this.V(Se);for(Se=0;Se<Kt.length;Se++){var Ye=ht;Kt[Se]!==""&&(Ye+="="+encodeURIComponent(String(Kt[Se]))),P.push(Ye)}}return this.i=P.join("&")};function va(P,H){return H=String(H),P.j&&(H=H.toLowerCase()),H}function Wa(P,H){H&&!P.j&&(Ss(P),P.i=null,P.g.forEach(function(ie,Se){var Ye=Se.toLowerCase();Se!=Ye&&(ya(this,Se),mu(this,Ye,ie))},P)),P.j=H}function Gp(P,H){const ie=new Ba;if(y.Image){const Se=new Image;Se.onload=M(Ds,ie,"TestLoadImage: loaded",!0,H,Se),Se.onerror=M(Ds,ie,"TestLoadImage: error",!1,H,Se),Se.onabort=M(Ds,ie,"TestLoadImage: abort",!1,H,Se),Se.ontimeout=M(Ds,ie,"TestLoadImage: timeout",!1,H,Se),y.setTimeout(function(){Se.ontimeout&&Se.ontimeout()},1e4),Se.src=P}else H(!1)}function jc(P,H){const ie=new Ba,Se=new AbortController,Ye=setTimeout(()=>{Se.abort(),Ds(ie,"TestPingServer: timeout",!1,H)},1e4);fetch(P,{signal:Se.signal}).then(ht=>{clearTimeout(Ye),ht.ok?Ds(ie,"TestPingServer: ok",!0,H):Ds(ie,"TestPingServer: server error",!1,H)}).catch(()=>{clearTimeout(Ye),Ds(ie,"TestPingServer: error",!1,H)})}function Ds(P,H,ie,Se,Ye){try{Ye&&(Ye.onload=null,Ye.onerror=null,Ye.onabort=null,Ye.ontimeout=null),Se(ie)}catch{}}function Zg(){this.g=new Yo}function Pl(P,H,ie){const Se=ie||"";try{Or(P,function(Ye,ht){let Kt=Ye;w(Ye)&&(Kt=Ni(Ye)),H.push(Se+ht+"="+encodeURIComponent(Kt))})}catch(Ye){throw H.push(Se+"type="+encodeURIComponent("_badmap")),Ye}}function kl(P){this.l=P.Ub||null,this.j=P.eb||!1}D(kl,qi),kl.prototype.g=function(){return new gu(this.l,this.j)},kl.prototype.i=function(P){return function(){return P}}({});function gu(P,H){Pn.call(this),this.D=P,this.o=H,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(gu,Pn),n=gu.prototype,n.open=function(P,H){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=H,this.readyState=1,Sa(this)},n.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const H={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&(H.body=P),(this.D||y).fetch(new Request(this.A,H)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gc(this)),this.readyState=0},n.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,Sa(this)),this.g&&(this.readyState=3,Sa(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;im(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function im(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}n.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var H=P.value?P.value:new Uint8Array(0);(H=this.v.decode(H,{stream:!P.done}))&&(this.response=this.responseText+=H)}P.done?gc(this):Sa(this),this.readyState==3&&im(this)}},n.Ra=function(P){this.g&&(this.response=this.responseText=P,gc(this))},n.Qa=function(P){this.g&&(this.response=P,gc(this))},n.ga=function(){this.g&&gc(this)};function gc(P){P.readyState=4,P.l=null,P.j=null,P.v=null,Sa(P)}n.setRequestHeader=function(P,H){this.u.append(P,H)},n.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],H=this.h.entries();for(var ie=H.next();!ie.done;)ie=ie.value,P.push(ie[0]+": "+ie[1]),ie=H.next();return P.join(`\r
`)};function Sa(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(gu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function Ol(P){let H="";return ge(P,function(ie,Se){H+=Se,H+=":",H+=ie,H+=`\r
`}),H}function Ce(P,H,ie){e:{for(Se in ie){var Se=!1;break e}Se=!0}Se||(ie=Ol(ie),typeof P=="string"?ie!=null&&encodeURIComponent(String(ie)):ui(P,H,ie))}function Me(P){Pn.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(Me,Pn);var ot=/^https?$/i,qt=["POST","PUT"];n=Me.prototype,n.Ha=function(P){this.J=P},n.ea=function(P,H,ie,Se){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);H=H?H.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xs.g(),this.v=this.o?xi(this.o):xi(xs),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(H,String(P),!0),this.B=!1}catch(ht){sr(this,ht);return}if(P=ie||"",ie=new Map(this.headers),Se)if(Object.getPrototypeOf(Se)===Object.prototype)for(var Ye in Se)ie.set(Ye,Se[Ye]);else if(typeof Se.keys=="function"&&typeof Se.get=="function")for(const ht of Se.keys())ie.set(ht,Se.get(ht));else throw Error("Unknown input type for opt_headers: "+String(Se));Se=Array.from(ie.keys()).find(ht=>ht.toLowerCase()=="content-type"),Ye=y.FormData&&P instanceof y.FormData,!(0<=Array.prototype.indexOf.call(qt,H,void 0))||Se||Ye||ie.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,Kt]of ie)this.g.setRequestHeader(ht,Kt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tr(this),this.u=!0,this.g.send(P),this.u=!1}catch(ht){sr(this,ht)}};function sr(P,H){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=H,P.m=5,Fr(P),er(P)}function Fr(P){P.A||(P.A=!0,hn(P,"complete"),hn(P,"error"))}n.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,hn(this,"complete"),hn(this,"abort"),er(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),er(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?ii(this):this.bb())},n.bb=function(){ii(this)};function ii(P){if(P.h&&typeof p<"u"&&(!P.v[1]||Li(P)!=4||P.Z()!=2)){if(P.u&&Li(P)==4)Zn(P.Ea,0,P);else if(hn(P,"readystatechange"),Li(P)==4){P.h=!1;try{const Kt=P.Z();e:switch(Kt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var H=!0;break e;default:H=!1}var ie;if(!(ie=H)){var Se;if(Se=Kt===0){var Ye=String(P.D).match(hd)[1]||null;!Ye&&y.self&&y.self.location&&(Ye=y.self.location.protocol.slice(0,-1)),Se=!ot.test(Ye?Ye.toLowerCase():"")}ie=Se}if(ie)hn(P,"complete"),hn(P,"success");else{P.m=6;try{var ht=2<Li(P)?P.g.statusText:""}catch{ht=""}P.l=ht+" ["+P.Z()+"]",Fr(P)}}finally{er(P)}}}}function er(P,H){if(P.g){tr(P);const ie=P.g,Se=P.v[0]?()=>{}:null;P.g=null,P.v=null,H||hn(P,"ready");try{ie.onreadystatechange=Se}catch{}}}function tr(P){P.I&&(y.clearTimeout(P.I),P.I=null)}n.isActive=function(){return!!this.g};function Li(P){return P.g?P.g.readyState:0}n.Z=function(){try{return 2<Li(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(P){if(this.g){var H=this.g.responseText;return P&&H.indexOf(P)==0&&(H=H.substring(P.length)),Es(H)}};function qs(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Bc(P){const H={};P=(P.g&&2<=Li(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let Se=0;Se<P.length;Se++){if(K(P[Se]))continue;var ie=de(P[Se]);const Ye=ie[0];if(ie=ie[1],typeof ie!="string")continue;ie=ie.trim();const ht=H[Ye]||[];H[Ye]=ht,ht.push(ie)}X(H,function(Se){return Se.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ko(P,H,ie){return ie&&ie.internalChannelParams&&ie.internalChannelParams[P]||H}function _u(P){this.Aa=0,this.i=[],this.j=new Ba,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ko("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ko("baseRetryDelayMs",5e3,P),this.cb=ko("retryDelaySeedMs",1e4,P),this.Wa=ko("forwardChannelMaxRetries",2,P),this.wa=ko("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new Fc(P&&P.concurrentRequestLimit),this.Da=new Zg,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=_u.prototype,n.la=8,n.G=1,n.connect=function(P,H,ie,Se){wr(0),this.W=P,this.H=H||{},ie&&Se!==void 0&&(this.H.OSID=ie,this.H.OAID=Se),this.F=this.X,this.I=gd(this,null,this.W),zc(this)};function Ls(P){if(sm(P),P.G==3){var H=P.U++,ie=ga(P.I);if(ui(ie,"SID",P.K),ui(ie,"RID",H),ui(ie,"TYPE","terminate"),md(P,ie),H=new rn(P,P.j,H),H.L=2,H.v=pu(ga(ie)),ie=!1,y.navigator&&y.navigator.sendBeacon)try{ie=y.navigator.sendBeacon(H.v.toString(),"")}catch{}!ie&&y.Image&&(new Image().src=H.v,ie=!0),ie||(H.g=n_(H.j,null),H.g.ea(H.v)),H.F=Date.now(),Gr(H)}vE(P)}function _c(P){P.g&&(t_(P),P.g.cancel(),P.g=null)}function sm(P){_c(P),P.u&&(y.clearTimeout(P.u),P.u=null),om(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&y.clearTimeout(P.s),P.s=null)}function zc(P){if(!ma(P.h)&&!P.s){P.s=!0;var H=P.Ga;be||xe(),Re||(be(),Re=!0),Ae.add(H,P),P.B=0}}function e_(P,H){return jp(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=H.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=pa(N(P.Ga,P,H),EE(P,P.B)),P.B++,!0)}n.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const Ye=new rn(this,this.j,P);let ht=this.o;if(this.S&&(ht?(ht=J(ht),ne(ht,this.S)):ht=this.S),this.m!==null||this.O||(Ye.H=ht,ht=null),this.P)e:{for(var H=0,ie=0;ie<this.i.length;ie++){t:{var Se=this.i[ie];if("__data__"in Se.map&&(Se=Se.map.__data__,typeof Se=="string")){Se=Se.length;break t}Se=void 0}if(Se===void 0)break;if(H+=Se,4096<H){H=ie;break e}if(H===4096||ie===this.i.length-1){H=ie+1;break e}}H=1e3}else H=1e3;H=Th(this,Ye,H),ie=ga(this.I),ui(ie,"RID",P),ui(ie,"CVER",22),this.D&&ui(ie,"X-HTTP-Session-Id",this.D),md(this,ie),ht&&(this.O?H="headers="+encodeURIComponent(String(Ol(ht)))+"&"+H:this.m&&Ce(ie,this.m,ht)),Bp(this.h,Ye),this.Ua&&ui(ie,"TYPE","init"),this.P?(ui(ie,"$req",H),ui(ie,"SID","null"),Ye.T=!0,_o(Ye,ie,null)):_o(Ye,ie,H),this.G=2}}else this.G==3&&(P?wh(this,P):this.i.length==0||ma(this.h)||wh(this))};function wh(P,H){var ie;H?ie=H.l:ie=P.U++;const Se=ga(P.I);ui(Se,"SID",P.K),ui(Se,"RID",ie),ui(Se,"AID",P.T),md(P,Se),P.m&&P.o&&Ce(Se,P.m,P.o),ie=new rn(P,P.j,ie,P.B+1),P.m===null&&(ie.H=P.o),H&&(P.i=H.D.concat(P.i)),H=Th(P,ie,1e3),ie.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Bp(P.h,ie),_o(ie,Se,H)}function md(P,H){P.H&&ge(P.H,function(ie,Se){ui(H,Se,ie)}),P.l&&Or({},function(ie,Se){ui(H,Se,ie)})}function Th(P,H,ie){ie=Math.min(P.i.length,ie);var Se=P.l?N(P.l.Na,P.l,P):null;e:{var Ye=P.i;let ht=-1;for(;;){const Kt=["count="+ie];ht==-1?0<ie?(ht=Ye[0].g,Kt.push("ofs="+ht)):ht=0:Kt.push("ofs="+ht);let si=!0;for(let Ys=0;Ys<ie;Ys++){let dr=Ye[Ys].g;const yo=Ye[Ys].map;if(dr-=ht,0>dr)ht=Math.max(0,Ye[Ys].g-100),si=!1;else try{Pl(yo,Kt,"req"+dr+"_")}catch{Se&&Se(yo)}}if(si){Se=Kt.join("&");break e}}}return P=P.i.splice(0,ie),H.D=P,Se}function yc(P){if(!P.g&&!P.u){P.Y=1;var H=P.Fa;be||xe(),Re||(be(),Re=!0),Ae.add(H,P),P.v=0}}function yu(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=pa(N(P.Fa,P),EE(P,P.v)),P.v++,!0)}n.Fa=function(){if(this.u=null,yE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=pa(N(this.ab,this),P)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,wr(10),_c(this),yE(this))};function t_(P){P.A!=null&&(y.clearTimeout(P.A),P.A=null)}function yE(P){P.g=new rn(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var H=ga(P.qa);ui(H,"RID","rpc"),ui(H,"SID",P.K),ui(H,"AID",P.T),ui(H,"CI",P.F?"0":"1"),!P.F&&P.ja&&ui(H,"TO",P.ja),ui(H,"TYPE","xmlhttp"),md(P,H),P.m&&P.o&&Ce(H,P.m,P.o),P.L&&(P.g.I=P.L);var ie=P.g;P=P.ia,ie.L=1,ie.v=pu(ga(H)),ie.m=null,ie.P=!0,Cl(ie,P)}n.Za=function(){this.C!=null&&(this.C=null,_c(this),yu(this),wr(19))};function om(P){P.C!=null&&(y.clearTimeout(P.C),P.C=null)}function am(P,H){var ie=null;if(P.g==H){om(P),t_(P),P.g=null;var Se=2}else if(Po(P.h,H))ie=H.D,nm(P.h,H),Se=1;else return;if(P.G!=0){if(H.o)if(Se==1){ie=H.m?H.m.length:0,H=Date.now()-H.F;var Ye=P.B;Se=Jo(),hn(Se,new uu(Se,ie)),zc(P)}else yc(P);else if(Ye=H.s,Ye==3||Ye==0&&0<H.X||!(Se==1&&e_(P,H)||Se==2&&yu(P)))switch(ie&&0<ie.length&&(H=P.h,H.i=H.i.concat(ie)),Ye){case 1:Ga(P,5);break;case 4:Ga(P,10);break;case 3:Ga(P,6);break;default:Ga(P,2)}}}function EE(P,H){let ie=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(ie*=2),ie*H}function Ga(P,H){if(P.j.info("Error code "+H),H==2){var ie=N(P.fb,P),Se=P.Xa;const Ye=!Se;Se=new za(Se||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||fd(Se,"https"),pu(Se),Ye?Gp(Se.toString(),ie):jc(Se.toString(),ie)}else wr(2);P.G=0,P.l&&P.l.sa(H),vE(P),sm(P)}n.fb=function(P){P?(this.j.info("Successfully pinged google.com"),wr(2)):(this.j.info("Failed to ping google.com"),wr(1))};function vE(P){if(P.G=0,P.ka=[],P.l){const H=Rl(P.h);(H.length!=0||P.i.length!=0)&&(z(P.ka,H),z(P.ka,P.i),P.h.i.length=0,F(P.i),P.i.length=0),P.l.ra()}}function gd(P,H,ie){var Se=ie instanceof za?ga(ie):new za(ie);if(Se.g!="")H&&(Se.g=H+"."+Se.g),Il(Se,Se.s);else{var Ye=y.location;Se=Ye.protocol,H=H?H+"."+Ye.hostname:Ye.hostname,Ye=+Ye.port;var ht=new za(null);Se&&fd(ht,Se),H&&(ht.g=H),Ye&&Il(ht,Ye),ie&&(ht.l=ie),Se=ht}return ie=P.D,H=P.ya,ie&&H&&ui(Se,ie,H),ui(Se,"VER",P.la),md(P,Se),Se}function n_(P,H,ie){if(H&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return H=P.Ca&&!P.pa?new Me(new kl({eb:ie})):new Me(P.pa),H.Ha(P.J),H}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function r_(){}n=r_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Gn(){}Gn.prototype.g=function(P,H){return new ba(P,H)};function ba(P,H){Pn.call(this),this.g=new _u(H),this.l=P,this.h=H&&H.messageUrlParams||null,P=H&&H.messageHeaders||null,H&&H.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=H&&H.initMessageHeaders||null,H&&H.messageContentType&&(P?P["X-WebChannel-Content-Type"]=H.messageContentType:P={"X-WebChannel-Content-Type":H.messageContentType}),H&&H.va&&(P?P["X-WebChannel-Client-Profile"]=H.va:P={"X-WebChannel-Client-Profile":H.va}),this.g.S=P,(P=H&&H.Sb)&&!K(P)&&(this.g.m=P),this.v=H&&H.supportsCrossDomainXhr||!1,this.u=H&&H.sendRawJson||!1,(H=H&&H.httpSessionIdParam)&&!K(H)&&(this.g.D=H,P=this.h,P!==null&&H in P&&(P=this.h,H in P&&delete P[H])),this.j=new Eu(this)}D(ba,Pn),ba.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ba.prototype.close=function(){Ls(this.g)},ba.prototype.o=function(P){var H=this.g;if(typeof P=="string"){var ie={};ie.__data__=P,P=ie}else this.u&&(ie={},ie.__data__=Ni(P),P=ie);H.i.push(new ri(H.Ya++,P)),H.G==3&&zc(H)},ba.prototype.N=function(){this.g.l=null,delete this.j,Ls(this.g),delete this.g,ba.aa.N.call(this)};function SE(P){ha.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var H=P.__sm__;if(H){e:{for(const ie in H){P=ie;break e}P=void 0}(this.i=P)&&(P=this.i,H=H!==null&&P in H?H[P]:void 0),this.data=H}else this.data=P}D(SE,ha);function bE(){Xo.call(this),this.status=1}D(bE,Xo);function Eu(P){this.g=P}D(Eu,r_),Eu.prototype.ua=function(){hn(this.g,"a")},Eu.prototype.ta=function(P){hn(this.g,new SE(P))},Eu.prototype.sa=function(P){hn(this.g,new bE)},Eu.prototype.ra=function(){hn(this.g,"b")},Gn.prototype.createWebChannel=Gn.prototype.g,ba.prototype.send=ba.prototype.o,ba.prototype.open=ba.prototype.m,ba.prototype.close=ba.prototype.close,yse=function(){return new Gn},_se=function(){return Jo()},gse=go,vF={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Tl.NO_ERROR=0,Tl.TIMEOUT=8,Tl.HTTP_ERROR=6,Wk=Tl,_h.COMPLETE="complete",mse=_h,Kn.EventType=ps,ps.OPEN="a",ps.CLOSE="b",ps.ERROR="c",ps.MESSAGE="d",Pn.prototype.listen=Pn.prototype.K,yC=Kn,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,fse=Me}).apply(typeof ok<"u"?ok:typeof self<"u"?self:typeof window<"u"?window:{});const MJ="@firebase/firestore",UJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}cc.UNAUTHENTICATED=new cc(null),cc.GOOGLE_CREDENTIALS=new cc("google-credentials-uid"),cc.FIRST_PARTY=new cc("first-party-uid"),cc.MOCK_USER=new cc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eb="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new D5("@firebase/firestore");function xS(){return iE.logLevel}function dn(n,...e){if(iE.logLevel<=zr.DEBUG){const i=e.map(G5);iE.debug(`Firestore (${eb}): ${n}`,...i)}}function Xf(n,...e){if(iE.logLevel<=zr.ERROR){const i=e.map(G5);iE.error(`Firestore (${eb}): ${n}`,...i)}}function N0(n,...e){if(iE.logLevel<=zr.WARN){const i=e.map(G5);iE.warn(`Firestore (${eb}): ${n}`,...i)}}function G5(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(n="Unexpected state"){const e=`FIRESTORE (${eb}) INTERNAL ASSERTION FAILED: `+n;throw Xf(e),new Error(e)}function wi(n,e){n||Qn()}function ur(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class en extends ph{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ese{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class s3e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(cc.UNAUTHENTICATED))}shutdown(){}}class o3e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class a3e{constructor(e){this.t=e,this.currentUser=cc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){wi(this.o===void 0);let o=this.i;const l=v=>this.i!==o?(o=this.i,i(v)):Promise.resolve();let u=new Bf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Bf,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const v=u;e.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},y=v=>{dn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(v=>y(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(dn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Bf)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(dn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(wi(typeof o.accessToken=="string"),new Ese(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return wi(e===null||typeof e=="string"),new cc(e)}}class c3e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=cc.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class l3e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new c3e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(cc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class VJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class u3e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,fl(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){wi(this.o===void 0);const o=u=>{u.error!=null&&dn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const p=u.token!==this.R;return this.R=u.token,dn("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>o(u))};const l=u=>{dn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):dn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new VJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(wi(typeof i.token=="string"),this.R=i.token,new VJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d3e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vse(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sse{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=d3e(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function Pr(n,e){return n<e?-1:n>e?1:0}function SF(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return Pr(o,l);{const u=vse(),p=h3e(u.encode(FJ(n,i)),u.encode(FJ(e,i)));return p!==0?p:Pr(o,l)}}i+=o>65535?2:1}return Pr(n.length,e.length)}function FJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function h3e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return Pr(n[i],e[i]);return Pr(n.length,e.length)}function x0(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jJ=-62135596800,BJ=1e6;class Ho{static now(){return Ho.fromMillis(Date.now())}static fromDate(e){return Ho.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*BJ);return new Ho(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new en(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new en(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<jJ)throw new en(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new en(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/BJ}_compareTo(e){return this.seconds===e.seconds?Pr(this.nanoseconds,e.nanoseconds):Pr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-jJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{static fromTimestamp(e){return new ar(e)}static min(){return new ar(new Ho(0,0))}static max(){return new ar(new Ho(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zJ="__name__";class hp{constructor(e,i,o){i===void 0?i=0:i>e.length&&Qn(),o===void 0?o=e.length-i:o>e.length-i&&Qn(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return hp.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof hp?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=hp.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return Pr(e.length,i.length)}static compareSegments(e,i){const o=hp.isNumericId(e),l=hp.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?hp.extractNumericId(e).compare(hp.extractNumericId(i)):SF(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ng.fromString(e.substring(4,e.length-2))}}class Zi extends hp{construct(e,i,o){return new Zi(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new en(bt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new Zi(i)}static emptyPath(){return new Zi([])}}const p3e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ma extends hp{construct(e,i,o){return new Ma(e,i,o)}static isValidIdentifier(e){return p3e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ma.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zJ}static keyField(){return new Ma([zJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new en(bt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let p=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new en(bt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new en(bt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=v,l+=2}else y==="`"?(p=!p,l++):y!=="."||p?(o+=y,l++):(u(),l++)}if(u(),p)throw new en(bt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ma(i)}static emptyPath(){return new Ma([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e){this.path=e}static fromPath(e){return new An(Zi.fromString(e))}static fromName(e){return new An(Zi.fromString(e).popFirst(5))}static empty(){return new An(Zi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Zi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Zi.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new An(new Zi(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _R=-1;function f3e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=ar.fromTimestamp(o===1e9?new Ho(i+1,0):new Ho(i,o));return new Fg(l,An.empty(),e)}function m3e(n){return new Fg(n.readTime,n.key,_R)}class Fg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Fg(ar.min(),An.empty(),_R)}static max(){return new Fg(ar.max(),An.empty(),_R)}}function g3e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=An.comparator(n.documentKey,e.documentKey),i!==0?i:Pr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _3e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class y3e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tb(n){if(n.code!==bt.FAILED_PRECONDITION||n.message!==_3e)throw n;dn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Qn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Ot((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Ot?i:Ot.resolve(i)}catch(i){return Ot.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Ot.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Ot.reject(i)}static resolve(e){return new Ot((i,o)=>{i(e)})}static reject(e){return new Ot((i,o)=>{o(e)})}static waitFor(e){return new Ot((i,o)=>{let l=0,u=0,p=!1;e.forEach(y=>{++l,y.next(()=>{++u,p&&u===l&&i()},v=>o(v))}),p=!0,u===l&&i()})}static or(e){let i=Ot.resolve(!1);for(const o of e)i=i.next(l=>l?Ot.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,u)=>{o.push(i.call(this,l,u))}),this.waitFor(o)}static mapArray(e,i){return new Ot((o,l)=>{const u=e.length,p=new Array(u);let y=0;for(let v=0;v<u;v++){const w=v;i(e[w]).next(C=>{p[w]=C,++y,y===u&&o(p)},C=>l(C))}})}static doWhile(e,i){return new Ot((o,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):o()};u()})}}function E3e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function nb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}kN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H5=-1;function ON(n){return n==null}function TO(n){return n===0&&1/n==-1/0}function v3e(n){return typeof n=="number"&&Number.isInteger(n)&&!TO(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse="";function S3e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=WJ(e)),e=b3e(n.get(i),e);return WJ(e)}function b3e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case bse:i+="";break;default:i+=u}}return i}function WJ(n){return n+bse+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Jg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function wse(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,i){this.comparator=e,this.root=i||Da.EMPTY}insert(e,i){return new Ns(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Da.BLACK,null,null))}remove(e){return new Ns(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Da.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ak(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ak(this.root,e,this.comparator,!1)}getReverseIterator(){return new ak(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ak(this.root,e,this.comparator,!0)}}class ak{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Da{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Da.RED,this.left=l??Da.EMPTY,this.right=u??Da.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Da(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Da.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Da.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Da.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Da.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Qn();const e=this.left.check();if(e!==this.right.check())throw Qn();return e+(this.isRed()?0:1)}}Da.EMPTY=null,Da.RED=!0,Da.BLACK=!1;Da.EMPTY=new class{constructor(){this.size=0}get key(){throw Qn()}get value(){throw Qn()}get color(){throw Qn()}get left(){throw Qn()}get right(){throw Qn()}copy(e,i,o,l,u){return this}insert(e,i,o){return new Da(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(e){this.comparator=e,this.data=new Ns(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new HJ(this.data.getIterator())}getIteratorFrom(e){return new HJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof $o)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new $o(this.comparator);return i.data=e,i}}class HJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e){this.fields=e,e.sort(Ma.comparator)}static empty(){return new tu([])}unionWith(e){let i=new $o(Ma.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new tu(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return x0(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tse extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new Tse("Invalid base64 string: "+u):u}}(e);return new Va(i)}static fromUint8Array(e){const i=function(l){let u="";for(let p=0;p<l.length;++p)u+=String.fromCharCode(l[p]);return u}(e);return new Va(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Pr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Va.EMPTY_BYTE_STRING=new Va("");const w3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jg(n){if(wi(!!n),typeof n=="string"){let e=0;const i=w3e.exec(n);if(wi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:ao(n.seconds),nanos:ao(n.nanos)}}function ao(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Bg(n){return typeof n=="string"?Va.fromBase64String(n):Va.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cse="server_timestamp",Rse="__type__",Ise="__previous_value__",Ase="__local_write_time__";function NN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Rse])===null||i===void 0?void 0:i.stringValue)===Cse}function xN(n){const e=n.mapValue.fields[Ise];return NN(e)?xN(e):e}function yR(n){const e=jg(n.mapValue.fields[Ase].timestampValue);return new Ho(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T3e{constructor(e,i,o,l,u,p,y,v,w){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=p,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=w}}const CO="(default)";class ER{constructor(e,i){this.projectId=e,this.database=i||CO}static empty(){return new ER("","")}get isDefaultDatabase(){return this.database===CO}isEqual(e){return e instanceof ER&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pse="__type__",C3e="__max__",ck={mapValue:{}},kse="__vector__",RO="value";function zg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?NN(n)?4:I3e(n)?9007199254740991:R3e(n)?10:11:Qn()}function Mp(n,e){if(n===e)return!0;const i=zg(n);if(i!==zg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return yR(n).isEqual(yR(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const p=jg(l.timestampValue),y=jg(u.timestampValue);return p.seconds===y.seconds&&p.nanos===y.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return Bg(l.bytesValue).isEqual(Bg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return ao(l.geoPointValue.latitude)===ao(u.geoPointValue.latitude)&&ao(l.geoPointValue.longitude)===ao(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return ao(l.integerValue)===ao(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const p=ao(l.doubleValue),y=ao(u.doubleValue);return p===y?TO(p)===TO(y):isNaN(p)&&isNaN(y)}return!1}(n,e);case 9:return x0(n.arrayValue.values||[],e.arrayValue.values||[],Mp);case 10:case 11:return function(l,u){const p=l.mapValue.fields||{},y=u.mapValue.fields||{};if(GJ(p)!==GJ(y))return!1;for(const v in p)if(p.hasOwnProperty(v)&&(y[v]===void 0||!Mp(p[v],y[v])))return!1;return!0}(n,e);default:return Qn()}}function vR(n,e){return(n.values||[]).find(i=>Mp(i,e))!==void 0}function D0(n,e){if(n===e)return 0;const i=zg(n),o=zg(e);if(i!==o)return Pr(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return Pr(n.booleanValue,e.booleanValue);case 2:return function(u,p){const y=ao(u.integerValue||u.doubleValue),v=ao(p.integerValue||p.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1}(n,e);case 3:return $J(n.timestampValue,e.timestampValue);case 4:return $J(yR(n),yR(e));case 5:return SF(n.stringValue,e.stringValue);case 6:return function(u,p){const y=Bg(u),v=Bg(p);return y.compareTo(v)}(n.bytesValue,e.bytesValue);case 7:return function(u,p){const y=u.split("/"),v=p.split("/");for(let w=0;w<y.length&&w<v.length;w++){const C=Pr(y[w],v[w]);if(C!==0)return C}return Pr(y.length,v.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,p){const y=Pr(ao(u.latitude),ao(p.latitude));return y!==0?y:Pr(ao(u.longitude),ao(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return KJ(n.arrayValue,e.arrayValue);case 10:return function(u,p){var y,v,w,C;const R=u.fields||{},N=p.fields||{},M=(y=R[RO])===null||y===void 0?void 0:y.arrayValue,D=(v=N[RO])===null||v===void 0?void 0:v.arrayValue,F=Pr(((w=M==null?void 0:M.values)===null||w===void 0?void 0:w.length)||0,((C=D==null?void 0:D.values)===null||C===void 0?void 0:C.length)||0);return F!==0?F:KJ(M,D)}(n.mapValue,e.mapValue);case 11:return function(u,p){if(u===ck.mapValue&&p===ck.mapValue)return 0;if(u===ck.mapValue)return 1;if(p===ck.mapValue)return-1;const y=u.fields||{},v=Object.keys(y),w=p.fields||{},C=Object.keys(w);v.sort(),C.sort();for(let R=0;R<v.length&&R<C.length;++R){const N=SF(v[R],C[R]);if(N!==0)return N;const M=D0(y[v[R]],w[C[R]]);if(M!==0)return M}return Pr(v.length,C.length)}(n.mapValue,e.mapValue);default:throw Qn()}}function $J(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Pr(n,e);const i=jg(n),o=jg(e),l=Pr(i.seconds,o.seconds);return l!==0?l:Pr(i.nanos,o.nanos)}function KJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=D0(i[l],o[l]);if(u)return u}return Pr(i.length,o.length)}function L0(n){return bF(n)}function bF(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=jg(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Bg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return An.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=bF(u);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const p of o)u?u=!1:l+=",",l+=`${p}:${bF(i.fields[p])}`;return l+"}"}(n.mapValue):Qn()}function Gk(n){switch(zg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=xN(n);return e?16+Gk(e):16;case 5:return 2*n.stringValue.length;case 6:return Bg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,u)=>l+Gk(u),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return Jg(o.fields,(u,p)=>{l+=u.length+Gk(p)}),l}(n.mapValue);default:throw Qn()}}function IO(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function wF(n){return!!n&&"integerValue"in n}function $5(n){return!!n&&"arrayValue"in n}function qJ(n){return!!n&&"nullValue"in n}function YJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Hk(n){return!!n&&"mapValue"in n}function R3e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Pse])===null||i===void 0?void 0:i.stringValue)===kse}function jC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Jg(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=jC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=jC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function I3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===C3e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e){this.value=e}static empty(){return new ml({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!Hk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=jC(i)}setAll(e){let i=Ma.emptyPath(),o={},l=[];e.forEach((p,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,o,l),o={},l=[],i=y.popLast()}p?o[y.lastSegment()]=jC(p):l.push(y.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());Hk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Mp(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];Hk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){Jg(i,(l,u)=>e[l]=u);for(const l of o)delete e[l]}clone(){return new ml(jC(this.value))}}function Ose(n){const e=[];return Jg(n.fields,(i,o)=>{const l=new Ma([i]);if(Hk(o)){const u=Ose(o.mapValue).fields;if(u.length===0)e.push(l);else for(const p of u)e.push(l.child(p))}else e.push(l)}),new tu(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,i,o,l,u,p,y){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=p,this.documentState=y}static newInvalidDocument(e){return new lc(e,0,ar.min(),ar.min(),ar.min(),ml.empty(),0)}static newFoundDocument(e,i,o,l){return new lc(e,1,i,ar.min(),o,l,0)}static newNoDocument(e,i){return new lc(e,2,i,ar.min(),ar.min(),ml.empty(),0)}static newUnknownDocument(e,i){return new lc(e,3,i,ar.min(),ar.min(),ml.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(ar.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ml.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ml.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ar.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof lc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new lc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M0{constructor(e,i){this.position=e,this.inclusive=i}}function XJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],p=n.position[l];if(u.field.isKeyField()?o=An.comparator(An.fromName(p.referenceValue),i.key):o=D0(p,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function JJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Mp(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,i="asc"){this.field=e,this.dir=i}}function A3e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nse{}class Ro extends Nse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new k3e(e,i,o):i==="array-contains"?new x3e(e,o):i==="in"?new D3e(e,o):i==="not-in"?new L3e(e,o):i==="array-contains-any"?new M3e(e,o):new Ro(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new O3e(e,o):new N3e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(D0(i,this.value)):i!==null&&zg(this.value)===zg(i)&&this.matchesComparison(D0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hh extends Nse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new hh(e,i)}matches(e){return xse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function xse(n){return n.op==="and"}function Dse(n){return P3e(n)&&xse(n)}function P3e(n){for(const e of n.filters)if(e instanceof hh)return!1;return!0}function TF(n){if(n instanceof Ro)return n.field.canonicalString()+n.op.toString()+L0(n.value);if(Dse(n))return n.filters.map(e=>TF(e)).join(",");{const e=n.filters.map(i=>TF(i)).join(",");return`${n.op}(${e})`}}function Lse(n,e){return n instanceof Ro?function(o,l){return l instanceof Ro&&o.op===l.op&&o.field.isEqual(l.field)&&Mp(o.value,l.value)}(n,e):n instanceof hh?function(o,l){return l instanceof hh&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((u,p,y)=>u&&Lse(p,l.filters[y]),!0):!1}(n,e):void Qn()}function Mse(n){return n instanceof Ro?function(i){return`${i.field.canonicalString()} ${i.op} ${L0(i.value)}`}(n):n instanceof hh?function(i){return i.op.toString()+" {"+i.getFilters().map(Mse).join(" ,")+"}"}(n):"Filter"}class k3e extends Ro{constructor(e,i,o){super(e,i,o),this.key=An.fromName(o.referenceValue)}matches(e){const i=An.comparator(e.key,this.key);return this.matchesComparison(i)}}class O3e extends Ro{constructor(e,i){super(e,"in",i),this.keys=Use("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class N3e extends Ro{constructor(e,i){super(e,"not-in",i),this.keys=Use("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Use(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>An.fromName(o.referenceValue))}class x3e extends Ro{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return $5(i)&&vR(i.arrayValue,this.value)}}class D3e extends Ro{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&vR(this.value.arrayValue,i)}}class L3e extends Ro{constructor(e,i){super(e,"not-in",i)}matches(e){if(vR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!vR(this.value.arrayValue,i)}}class M3e extends Ro{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!$5(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>vR(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3e{constructor(e,i=null,o=[],l=[],u=null,p=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=p,this.endAt=y,this.le=null}}function QJ(n,e=null,i=[],o=[],l=null,u=null,p=null){return new U3e(n,e,i,o,l,u,p)}function K5(n){const e=ur(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>TF(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(u){return u.field.canonicalString()+u.dir}(o)).join(","),ON(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>L0(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>L0(o)).join(",")),e.le=i}return e.le}function q5(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!A3e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Lse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!JJ(n.startAt,e.startAt)&&JJ(n.endAt,e.endAt)}function CF(n){return An.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,i=null,o=[],l=[],u=null,p="F",y=null,v=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=p,this.startAt=y,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function V3e(n,e,i,o,l,u,p,y){return new dE(n,e,i,o,l,u,p,y)}function DN(n){return new dE(n)}function ZJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Y5(n){return n.collectionGroup!==null}function m0(n){const e=ur(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let y=new $o(Ma.comparator);return p.filters.forEach(v=>{v.getFlattenedFilters().forEach(w=>{w.isInequality()&&(y=y.add(w.field))})}),y})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new SR(u,o))}),i.has(Ma.keyField().canonicalString())||e.he.push(new SR(Ma.keyField(),o))}return e.he}function xp(n){const e=ur(n);return e.Pe||(e.Pe=F3e(e,m0(n))),e.Pe}function F3e(n,e){if(n.limitType==="F")return QJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new SR(l.field,u)});const i=n.endAt?new M0(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new M0(n.startAt.position,n.startAt.inclusive):null;return QJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function RF(n,e){const i=n.filters.concat([e]);return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function AO(n,e,i){return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function LN(n,e){return q5(xp(n),xp(e))&&n.limitType===e.limitType}function Vse(n){return`${K5(xp(n))}|lt:${n.limitType}`}function DS(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>Mse(l)).join(", ")}]`),ON(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>L0(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>L0(l)).join(",")),`Target(${o})`}(xp(n))}; limitType=${n.limitType})`}function MN(n,e){return e.isFoundDocument()&&function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):An.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)}(n,e)&&function(o,l){for(const u of m0(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(p,y,v){const w=XJ(p,y,v);return p.inclusive?w<=0:w<0}(o.startAt,m0(o),l)||o.endAt&&!function(p,y,v){const w=XJ(p,y,v);return p.inclusive?w>=0:w>0}(o.endAt,m0(o),l))}(n,e)}function j3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Fse(n){return(e,i)=>{let o=!1;for(const l of m0(n)){const u=B3e(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function B3e(n,e,i){const o=n.field.isKeyField()?An.comparator(e.key,i.key):function(u,p,y){const v=p.data.field(u),w=y.data.field(u);return v!==null&&w!==null?D0(v,w):Qn()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Qn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Jg(this.inner,(i,o)=>{for(const[l,u]of o)e(l,u)})}isEmpty(){return wse(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z3e=new Ns(An.comparator);function Jf(){return z3e}const jse=new Ns(An.comparator);function EC(...n){let e=jse;for(const i of n)e=e.insert(i.key,i);return e}function Bse(n){let e=jse;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function Ly(){return BC()}function zse(){return BC()}function BC(){return new hE(n=>n.toString(),(n,e)=>n.isEqual(e))}const W3e=new Ns(An.comparator),G3e=new $o(An.comparator);function Wr(...n){let e=G3e;for(const i of n)e=e.add(i);return e}const H3e=new $o(Pr);function $3e(){return H3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X5(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:TO(e)?"-0":e}}function Wse(n){return{integerValue:""+n}}function K3e(n,e){return v3e(e)?Wse(e):X5(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(){this._=void 0}}function q3e(n,e,i){return n instanceof PO?function(l,u){const p={fields:{[Rse]:{stringValue:Cse},[Ase]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&NN(u)&&(u=xN(u)),u&&(p.fields[Ise]=u),{mapValue:p}}(i,e):n instanceof U0?Hse(n,e):n instanceof V0?$se(n,e):function(l,u){const p=Gse(l,u),y=eQ(p)+eQ(l.Ie);return wF(p)&&wF(l.Ie)?Wse(y):X5(l.serializer,y)}(n,e)}function Y3e(n,e,i){return n instanceof U0?Hse(n,e):n instanceof V0?$se(n,e):i}function Gse(n,e){return n instanceof kO?function(o){return wF(o)||function(u){return!!u&&"doubleValue"in u}(o)}(e)?e:{integerValue:0}:null}class PO extends UN{}class U0 extends UN{constructor(e){super(),this.elements=e}}function Hse(n,e){const i=Kse(e);for(const o of n.elements)i.some(l=>Mp(l,o))||i.push(o);return{arrayValue:{values:i}}}class V0 extends UN{constructor(e){super(),this.elements=e}}function $se(n,e){let i=Kse(e);for(const o of n.elements)i=i.filter(l=>!Mp(l,o));return{arrayValue:{values:i}}}class kO extends UN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function eQ(n){return ao(n.integerValue||n.doubleValue)}function Kse(n){return $5(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qse{constructor(e,i){this.field=e,this.transform=i}}function X3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof U0&&l instanceof U0||o instanceof V0&&l instanceof V0?x0(o.elements,l.elements,Mp):o instanceof kO&&l instanceof kO?Mp(o.Ie,l.Ie):o instanceof PO&&l instanceof PO}(n.transform,e.transform)}class J3e{constructor(e,i){this.version=e,this.transformResults=i}}class rd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new rd}static exists(e){return new rd(void 0,e)}static updateTime(e){return new rd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function $k(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class VN{}function Yse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new J5(n.key,rd.none()):new XR(n.key,n.data,rd.none());{const i=n.data,o=ml.empty();let l=new $o(Ma.comparator);for(let u of e.fields)if(!l.has(u)){let p=i.field(u);p===null&&u.length>1&&(u=u.popLast(),p=i.field(u)),p===null?o.delete(u):o.set(u,p),l=l.add(u)}return new Qg(n.key,o,new tu(l.toArray()),rd.none())}}function Q3e(n,e,i){n instanceof XR?function(l,u,p){const y=l.value.clone(),v=nQ(l.fieldTransforms,u,p.transformResults);y.setAll(v),u.convertToFoundDocument(p.version,y).setHasCommittedMutations()}(n,e,i):n instanceof Qg?function(l,u,p){if(!$k(l.precondition,u))return void u.convertToUnknownDocument(p.version);const y=nQ(l.fieldTransforms,u,p.transformResults),v=u.data;v.setAll(Xse(l)),v.setAll(y),u.convertToFoundDocument(p.version,v).setHasCommittedMutations()}(n,e,i):function(l,u,p){u.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function zC(n,e,i,o){return n instanceof XR?function(u,p,y,v){if(!$k(u.precondition,p))return y;const w=u.value.clone(),C=rQ(u.fieldTransforms,v,p);return w.setAll(C),p.convertToFoundDocument(p.version,w).setHasLocalMutations(),null}(n,e,i,o):n instanceof Qg?function(u,p,y,v){if(!$k(u.precondition,p))return y;const w=rQ(u.fieldTransforms,v,p),C=p.data;return C.setAll(Xse(u)),C.setAll(w),p.convertToFoundDocument(p.version,C).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(R=>R.field))}(n,e,i,o):function(u,p,y){return $k(u.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):y}(n,e,i)}function Z3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=Gse(o.transform,l||null);u!=null&&(i===null&&(i=ml.empty()),i.set(o.field,u))}return i||null}function tQ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&x0(o,l,(u,p)=>X3e(u,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class XR extends VN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Qg extends VN{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Xse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function nQ(n,e,i){const o=new Map;wi(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],p=u.transform,y=e.data.field(u.field);o.set(u.field,Y3e(p,y,i[l]))}return o}function rQ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,p=i.data.field(l.field);o.set(l.field,q3e(u,p,e))}return o}class J5 extends VN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class e4e extends VN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&Q3e(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=zC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=zC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=zse();return this.mutations.forEach(l=>{const u=e.get(l.key),p=u.overlayedDocument;let y=this.applyToLocalView(p,u.mutatedFields);y=i.has(l.key)?null:y;const v=Yse(p,y);v!==null&&o.set(l.key,v),p.isValidDocument()||p.convertToNoDocument(ar.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Wr())}isEqual(e){return this.batchId===e.batchId&&x0(this.mutations,e.mutations,(i,o)=>tQ(i,o))&&x0(this.baseMutations,e.baseMutations,(i,o)=>tQ(i,o))}}class Q5{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){wi(e.mutations.length===o.length);let l=function(){return W3e}();const u=e.mutations;for(let p=0;p<u.length;p++)l=l.insert(u[p].key,o[p].version);return new Q5(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bo,Zr;function i4e(n){switch(n){case bt.OK:return Qn();case bt.CANCELLED:case bt.UNKNOWN:case bt.DEADLINE_EXCEEDED:case bt.RESOURCE_EXHAUSTED:case bt.INTERNAL:case bt.UNAVAILABLE:case bt.UNAUTHENTICATED:return!1;case bt.INVALID_ARGUMENT:case bt.NOT_FOUND:case bt.ALREADY_EXISTS:case bt.PERMISSION_DENIED:case bt.FAILED_PRECONDITION:case bt.ABORTED:case bt.OUT_OF_RANGE:case bt.UNIMPLEMENTED:case bt.DATA_LOSS:return!0;default:return Qn()}}function Jse(n){if(n===void 0)return Xf("GRPC error has no .code"),bt.UNKNOWN;switch(n){case bo.OK:return bt.OK;case bo.CANCELLED:return bt.CANCELLED;case bo.UNKNOWN:return bt.UNKNOWN;case bo.DEADLINE_EXCEEDED:return bt.DEADLINE_EXCEEDED;case bo.RESOURCE_EXHAUSTED:return bt.RESOURCE_EXHAUSTED;case bo.INTERNAL:return bt.INTERNAL;case bo.UNAVAILABLE:return bt.UNAVAILABLE;case bo.UNAUTHENTICATED:return bt.UNAUTHENTICATED;case bo.INVALID_ARGUMENT:return bt.INVALID_ARGUMENT;case bo.NOT_FOUND:return bt.NOT_FOUND;case bo.ALREADY_EXISTS:return bt.ALREADY_EXISTS;case bo.PERMISSION_DENIED:return bt.PERMISSION_DENIED;case bo.FAILED_PRECONDITION:return bt.FAILED_PRECONDITION;case bo.ABORTED:return bt.ABORTED;case bo.OUT_OF_RANGE:return bt.OUT_OF_RANGE;case bo.UNIMPLEMENTED:return bt.UNIMPLEMENTED;case bo.DATA_LOSS:return bt.DATA_LOSS;default:return Qn()}}(Zr=bo||(bo={}))[Zr.OK=0]="OK",Zr[Zr.CANCELLED=1]="CANCELLED",Zr[Zr.UNKNOWN=2]="UNKNOWN",Zr[Zr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zr[Zr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zr[Zr.NOT_FOUND=5]="NOT_FOUND",Zr[Zr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zr[Zr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zr[Zr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zr[Zr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zr[Zr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zr[Zr.ABORTED=10]="ABORTED",Zr[Zr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zr[Zr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zr[Zr.INTERNAL=13]="INTERNAL",Zr[Zr.UNAVAILABLE=14]="UNAVAILABLE",Zr[Zr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s4e=new Ng([4294967295,4294967295],0);function iQ(n){const e=vse().encode(n),i=new pse;return i.update(e),new Uint8Array(i.digest())}function sQ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Ng([i,o],0),new Ng([l,u],0)]}class Z5{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new vC(`Invalid padding: ${i}`);if(o<0)throw new vC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new vC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new vC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Ng.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(Ng.fromNumber(o)));return l.compare(s4e)===1&&(l=new Ng([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=iQ(e),[o,l]=sQ(i);for(let u=0;u<this.hashCount;u++){const p=this.Ae(o,l,u);if(!this.Re(p))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),p=new Z5(u,l,i);return o.forEach(y=>p.insert(y)),p}insert(e){if(this.Ee===0)return;const i=iQ(e),[o,l]=sQ(i);for(let u=0;u<this.hashCount;u++){const p=this.Ae(o,l,u);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class vC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FN{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,JR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new FN(ar.min(),l,new Ns(Pr),Jf(),Wr())}}class JR{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new JR(o,i,Wr(),Wr(),Wr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class Qse{constructor(e,i){this.targetId=e,this.ge=i}}class Zse{constructor(e,i,o=Va.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class oQ{constructor(){this.pe=0,this.ye=aQ(),this.we=Va.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Wr(),i=Wr(),o=Wr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Qn()}}),new JR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=aQ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,wi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class o4e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Jf(),this.$e=lk(),this.Ue=lk(),this.Ke=new Ns(Pr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:Qn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(CF(u))if(o===0){const p=new An(u.path);this.ze(i,p,lc.newNoDocument(p,ar.min()))}else wi(o===1);else{const p=this.et(i);if(p!==o){const y=this.tt(e),v=y?this.nt(y,e,p):1;if(v!==0){this.Ye(i);const w=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,w)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let p,y;try{p=Bg(o).toUint8Array()}catch(v){if(v instanceof Tse)return N0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new Z5(p,l,u)}catch(v){return N0(v instanceof vC?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.Ee===0?null:y}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(u=>{const p=this.ke.it(),y=`projects/${p.projectId}/databases/${p.database}/documents/${u.path.canonicalString()}`;e.mightContain(y)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,p)=>{const y=this.Xe(p);if(y){if(u.current&&CF(y.target)){const v=new An(y.target.path);this._t(v).has(p)||this.ut(p,v)||this.ze(p,v,lc.newNoDocument(v,e))}u.ve&&(i.set(p,u.Fe()),u.Me())}});let o=Wr();this.Ue.forEach((u,p)=>{let y=!0;p.forEachWhile(v=>{const w=this.Xe(v);return!w||w.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)}),y&&(o=o.add(u))}),this.Qe.forEach((u,p)=>p.setReadTime(e));const l=new FN(e,i,this.Ke,this.Qe,o);return this.Qe=Jf(),this.$e=lk(),this.Ue=lk(),this.Ke=new Ns(Pr),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new oQ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new $o(Pr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new $o(Pr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||dn("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new oQ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function lk(){return new Ns(An.comparator)}function aQ(){return new Ns(An.comparator)}const a4e={asc:"ASCENDING",desc:"DESCENDING"},c4e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},l4e={and:"AND",or:"OR"};class u4e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function IF(n,e){return n.useProto3Json||ON(e)?e:{value:e}}function OO(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function eoe(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function d4e(n,e){return OO(n,e.toTimestamp())}function Dp(n){return wi(!!n),ar.fromTimestamp(function(i){const o=jg(i);return new Ho(o.seconds,o.nanos)}(n))}function e3(n,e){return AF(n,e).canonicalString()}function AF(n,e){const i=function(l){return new Zi(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function toe(n){const e=Zi.fromString(n);return wi(ooe(e)),e}function PF(n,e){return e3(n.databaseId,e.path)}function nV(n,e){const i=toe(e);if(i.get(1)!==n.databaseId.projectId)throw new en(bt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new en(bt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new An(roe(i))}function noe(n,e){return e3(n.databaseId,e)}function h4e(n){const e=toe(n);return e.length===4?Zi.emptyPath():roe(e)}function kF(n){return new Zi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function roe(n){return wi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function cQ(n,e,i){return{name:PF(n,e),fields:i.value.mapValue.fields}}function p4e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:Qn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(w,C){return w.useProto3Json?(wi(C===void 0||typeof C=="string"),Va.fromBase64String(C||"")):(wi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Va.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,y=p&&function(w){const C=w.code===void 0?bt.UNKNOWN:Jse(w.code);return new en(C,w.message||"")}(p);i=new Zse(o,l,u,y||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=nV(n,o.document.name),u=Dp(o.document.updateTime),p=o.document.createTime?Dp(o.document.createTime):ar.min(),y=new ml({mapValue:{fields:o.document.fields}}),v=lc.newFoundDocument(l,u,p,y),w=o.targetIds||[],C=o.removedTargetIds||[];i=new Kk(w,C,v.key,v)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=nV(n,o.document),u=o.readTime?Dp(o.readTime):ar.min(),p=lc.newNoDocument(l,u),y=o.removedTargetIds||[];i=new Kk([],y,p.key,p)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=nV(n,o.document),u=o.removedTargetIds||[];i=new Kk([],u,l,null)}else{if(!("filter"in e))return Qn();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,p=new r4e(l,u),y=o.targetId;i=new Qse(y,p)}}return i}function f4e(n,e){let i;if(e instanceof XR)i={update:cQ(n,e.key,e.value)};else if(e instanceof J5)i={delete:PF(n,e.key)};else if(e instanceof Qg)i={update:cQ(n,e.key,e.data),updateMask:w4e(e.fieldMask)};else{if(!(e instanceof e4e))return Qn();i={verify:PF(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(u,p){const y=p.transform;if(y instanceof PO)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof U0)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof V0)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof kO)return{fieldPath:p.field.canonicalString(),increment:y.Ie};throw Qn()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:d4e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Qn()}(n,e.precondition)),i}function m4e(n,e){return n&&n.length>0?(wi(e!==void 0),n.map(i=>function(l,u){let p=l.updateTime?Dp(l.updateTime):Dp(u);return p.isEqual(ar.min())&&(p=Dp(u)),new J3e(p,l.transformResults||[])}(i,e))):[]}function g4e(n,e){return{documents:[noe(n,e.path)]}}function _4e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=noe(n,l);const u=function(w){if(w.length!==0)return soe(hh.create(w,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const p=function(w){if(w.length!==0)return w.map(C=>function(N){return{field:LS(N.field),direction:v4e(N.dir)}}(C))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const y=IF(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=function(w){return{before:w.inclusive,values:w.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(w){return{before:!w.inclusive,values:w.position}}(e.endAt)),{ht:i,parent:l}}function y4e(n){let e=h4e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){wi(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=function(R){const N=ioe(R);return N instanceof hh&&Dse(N)?N.getFilters():[N]}(i.where));let p=[];i.orderBy&&(p=function(R){return R.map(N=>function(D){return new SR(MS(D.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(N))}(i.orderBy));let y=null;i.limit&&(y=function(R){let N;return N=typeof R=="object"?R.value:R,ON(N)?null:N}(i.limit));let v=null;i.startAt&&(v=function(R){const N=!!R.before,M=R.values||[];return new M0(M,N)}(i.startAt));let w=null;return i.endAt&&(w=function(R){const N=!R.before,M=R.values||[];return new M0(M,N)}(i.endAt)),V3e(e,l,p,u,y,"F",v,w)}function E4e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function ioe(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=MS(i.unaryFilter.field);return Ro.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=MS(i.unaryFilter.field);return Ro.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=MS(i.unaryFilter.field);return Ro.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=MS(i.unaryFilter.field);return Ro.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Qn()}}(n):n.fieldFilter!==void 0?function(i){return Ro.create(MS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return hh.create(i.compositeFilter.filters.map(o=>ioe(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Qn()}}(i.compositeFilter.op))}(n):Qn()}function v4e(n){return a4e[n]}function S4e(n){return c4e[n]}function b4e(n){return l4e[n]}function LS(n){return{fieldPath:n.canonicalString()}}function MS(n){return Ma.fromServerFormat(n.fieldPath)}function soe(n){return n instanceof Ro?function(i){if(i.op==="=="){if(YJ(i.value))return{unaryFilter:{field:LS(i.field),op:"IS_NAN"}};if(qJ(i.value))return{unaryFilter:{field:LS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(YJ(i.value))return{unaryFilter:{field:LS(i.field),op:"IS_NOT_NAN"}};if(qJ(i.value))return{unaryFilter:{field:LS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:LS(i.field),op:S4e(i.op),value:i.value}}}(n):n instanceof hh?function(i){const o=i.getFilters().map(l=>soe(l));return o.length===1?o[0]:{compositeFilter:{op:b4e(i.op),filters:o}}}(n):Qn()}function w4e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function ooe(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(e,i,o,l,u=ar.min(),p=ar.min(),y=Va.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(e){return new Rg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Rg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4e{constructor(e){this.Tt=e}}function C4e(n){const e=y4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?AO(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4e{constructor(){this.Tn=new I4e}addToCollectionParentIndex(e,i){return this.Tn.add(i),Ot.resolve()}getCollectionParents(e,i){return Ot.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Ot.resolve()}deleteFieldIndex(e,i){return Ot.resolve()}deleteAllFieldIndexes(e){return Ot.resolve()}createTargetIndexes(e,i){return Ot.resolve()}getDocumentsMatchingTarget(e,i){return Ot.resolve(null)}getIndexType(e,i){return Ot.resolve(0)}getFieldIndexes(e,i){return Ot.resolve([])}getNextCollectionGroupToUpdate(e){return Ot.resolve(null)}getMinOffset(e,i){return Ot.resolve(Fg.min())}getMinOffsetFromCollectionGroup(e,i){return Ot.resolve(Fg.min())}updateCollectionGroup(e,i,o){return Ot.resolve()}updateIndexEntries(e,i){return Ot.resolve()}}class I4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new $o(Zi.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new $o(Zi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},aoe=41943040;class hl{static withCacheSize(e){return new hl(e,hl.DEFAULT_COLLECTION_PERCENTILE,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */hl.DEFAULT_COLLECTION_PERCENTILE=10,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hl.DEFAULT=new hl(aoe,hl.DEFAULT_COLLECTION_PERCENTILE,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hl.DISABLED=new hl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new F0(0)}static Kn(){return new F0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uQ="LruGarbageCollector",A4e=1048576;function dQ([n,e],[i,o]){const l=Pr(n,i);return l===0?Pr(e,o):l}class P4e{constructor(e){this.Hn=e,this.buffer=new $o(dQ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();dQ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class k4e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){dn(uQ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){nb(i)?dn(uQ,"Ignoring IndexedDB error during garbage collection: ",i):await tb(i)}await this.er(3e5)})}}class O4e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return Ot.resolve(kN.ae);const o=new P4e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(dn("LruGarbageCollector","Garbage collection skipped; disabled"),Ot.resolve(lQ)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(dn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lQ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,u,p,y,v,w;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(R=>(R>this.params.maximumSequenceNumbersToCollect?(dn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${R}`),l=this.params.maximumSequenceNumbersToCollect):l=R,p=Date.now(),this.nthSequenceNumber(e,l))).next(R=>(o=R,y=Date.now(),this.removeTargets(e,o,i))).next(R=>(u=R,v=Date.now(),this.removeOrphanedDocuments(e,o))).next(R=>(w=Date.now(),xS()<=zr.DEBUG&&dn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-C}ms
	Determined least recently used ${l} in `+(y-p)+`ms
	Removed ${u} targets in `+(v-y)+`ms
	Removed ${R} documents in `+(w-v)+`ms
Total Duration: ${w-C}ms`),Ot.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:R})))}}function N4e(n,e){return new O4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x4e{constructor(){this.changes=new hE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,lc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?Ot.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&zC(o.mutation,l,tu.empty(),Ho.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Wr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Wr()){const l=Ly();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(u=>{let p=EC();return u.forEach((y,v)=>{p=p.insert(y,v.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const o=Ly();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Wr()))}populateOverlays(e,i,o){const l=[];return o.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((p,y)=>{i.set(p,y)})})}computeViews(e,i,o,l){let u=Jf();const p=BC(),y=function(){return BC()}();return i.forEach((v,w)=>{const C=o.get(w.key);l.has(w.key)&&(C===void 0||C.mutation instanceof Qg)?u=u.insert(w.key,w):C!==void 0?(p.set(w.key,C.mutation.getFieldMask()),zC(C.mutation,w,C.mutation.getFieldMask(),Ho.now())):p.set(w.key,tu.empty())}),this.recalculateAndSaveOverlays(e,u).next(v=>(v.forEach((w,C)=>p.set(w,C)),i.forEach((w,C)=>{var R;return y.set(w,new D4e(C,(R=p.get(w))!==null&&R!==void 0?R:null))}),y))}recalculateAndSaveOverlays(e,i){const o=BC();let l=new Ns((p,y)=>p-y),u=Wr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const y of p)y.keys().forEach(v=>{const w=i.get(v);if(w===null)return;let C=o.get(v)||tu.empty();C=y.applyToLocalView(w,C),o.set(v,C);const R=(l.get(y.batchId)||Wr()).add(v);l=l.insert(y.batchId,R)})}).next(()=>{const p=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),w=v.key,C=v.value,R=zse();C.forEach(N=>{if(!u.has(N)){const M=Yse(i.get(N),o.get(N));M!==null&&R.set(N,M),u=u.add(N)}}),p.push(this.documentOverlayCache.saveOverlays(e,w,R))}return Ot.waitFor(p)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(p){return An.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):Y5(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(u=>{const p=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):Ot.resolve(Ly());let y=_R,v=u;return p.next(w=>Ot.forEach(w,(C,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),u.get(C)?Ot.resolve():this.remoteDocumentCache.getEntry(e,C).next(N=>{v=v.insert(C,N)}))).next(()=>this.populateOverlays(e,w,u)).next(()=>this.computeViews(e,v,w,Wr())).next(C=>({batchId:y,changes:Bse(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new An(i)).next(o=>{let l=EC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let p=EC();return this.indexManager.getCollectionParents(e,u).next(y=>Ot.forEach(y,v=>{const w=function(R,N){return new dE(N,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)}(i,v.child(u));return this.getDocumentsMatchingCollectionQuery(e,w,o,l).next(C=>{C.forEach((R,N)=>{p=p.insert(R,N)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(p=>(u=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l))).next(p=>{u.forEach((v,w)=>{const C=w.getKey();p.get(C)===null&&(p=p.insert(C,lc.newInvalidDocument(C)))});let y=EC();return p.forEach((v,w)=>{const C=u.get(v);C!==void 0&&zC(C.mutation,w,tu.empty(),Ho.now()),MN(i,w)&&(y=y.insert(v,w))}),y})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Ot.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:Dp(l.createTime)}}(i)),Ot.resolve()}getNamedQuery(e,i){return Ot.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:C4e(l.bundledQuery),readTime:Dp(l.readTime)}}(i)),Ot.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U4e{constructor(){this.overlays=new Ns(An.comparator),this.Rr=new Map}getOverlay(e,i){return Ot.resolve(this.overlays.get(i))}getOverlays(e,i){const o=Ly();return Ot.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&o.set(l,u)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,u)=>{this.Et(e,i,u)}),Ot.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(o)),Ot.resolve()}getOverlaysForCollection(e,i,o){const l=Ly(),u=i.length+1,p=new An(i.child("")),y=this.overlays.getIteratorFrom(p);for(;y.hasNext();){const v=y.getNext().value,w=v.getKey();if(!i.isPrefixOf(w.path))break;w.path.length===u&&v.largestBatchId>o&&l.set(v.getKey(),v)}return Ot.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new Ns((w,C)=>w-C);const p=this.overlays.getIterator();for(;p.hasNext();){const w=p.getNext().value;if(w.getKey().getCollectionGroup()===i&&w.largestBatchId>o){let C=u.get(w.largestBatchId);C===null&&(C=Ly(),u=u.insert(w.largestBatchId,C)),C.set(w.getKey(),w)}}const y=Ly(),v=u.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((w,C)=>y.set(w,C)),!(y.size()>=l)););return Ot.resolve(y)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new n4e(i,o));let u=this.Rr.get(i);u===void 0&&(u=Wr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{constructor(){this.sessionToken=Va.EMPTY_BYTE_STRING}getSessionToken(e){return Ot.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Ot.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t3{constructor(){this.Vr=new $o(da.mr),this.gr=new $o(da.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new da(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new da(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new An(new Zi([])),o=new da(i,e),l=new da(i,e+1),u=[];return this.gr.forEachInRange([o,l],p=>{this.wr(p),u.push(p.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new An(new Zi([])),o=new da(i,e),l=new da(i,e+1);let u=Wr();return this.gr.forEachInRange([o,l],p=>{u=u.add(p.key)}),u}containsKey(e){const i=new da(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class da{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return An.comparator(e.key,i.key)||Pr(e.Cr,i.Cr)}static pr(e,i){return Pr(e.Cr,i.Cr)||An.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new $o(da.mr)}checkEmpty(e){return Ot.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new t4e(u,i,o,l);this.mutationQueue.push(p);for(const y of l)this.Mr=this.Mr.add(new da(y.key,u)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return Ot.resolve(p)}lookupMutationBatch(e,i){return Ot.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),u=l<0?0:l;return Ot.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Ot.resolve(this.mutationQueue.length===0?H5:this.Fr-1)}getAllMutationBatches(e){return Ot.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new da(i,0),l=new da(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([o,l],p=>{const y=this.Or(p.Cr);u.push(y)}),Ot.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new $o(Pr);return i.forEach(l=>{const u=new da(l,0),p=new da(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,p],y=>{o=o.add(y.Cr)})}),Ot.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;An.isDocumentKey(u)||(u=u.child(""));const p=new da(new An(u),0);let y=new $o(Pr);return this.Mr.forEachWhile(v=>{const w=v.key.path;return!!o.isPrefixOf(w)&&(w.length===l&&(y=y.add(v.Cr)),!0)},p),Ot.resolve(this.Br(y))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){wi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return Ot.forEach(i.mutations,l=>{const u=new da(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new da(i,0),l=this.Mr.firstAfterOrEqual(o);return Ot.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ot.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j4e{constructor(e){this.kr=e,this.docs=function(){return new Ns(An.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:p}),this.size+=p-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return Ot.resolve(o?o.document.mutableCopy():lc.newInvalidDocument(i))}getEntries(e,i){let o=Jf();return i.forEach(l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():lc.newInvalidDocument(l))}),Ot.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=Jf();const p=i.path,y=new An(p.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:w,value:{document:C}}=v.getNext();if(!p.isPrefixOf(w.path))break;w.path.length>p.length+1||g3e(m3e(C),o)<=0||(l.has(C.key)||MN(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return Ot.resolve(u)}getAllFromCollectionGroup(e,i,o,l){Qn()}qr(e,i){return Ot.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new B4e(this)}getSize(e){return Ot.resolve(this.size)}}class B4e extends x4e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),Ot.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4e{constructor(e){this.persistence=e,this.Qr=new hE(i=>K5(i),q5),this.lastRemoteSnapshotVersion=ar.min(),this.highestTargetId=0,this.$r=0,this.Ur=new t3,this.targetCount=0,this.Kr=F0.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),Ot.resolve()}getLastRemoteSnapshotVersion(e){return Ot.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ot.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Ot.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),Ot.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new F0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Ot.resolve()}updateTargetData(e,i){return this.zn(i),Ot.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Ot.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.Qr.forEach((p,y)=>{y.sequenceNumber<=i&&o.get(y.targetId)===null&&(this.Qr.delete(p),u.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)}),Ot.waitFor(u).next(()=>l)}getTargetCount(e){return Ot.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return Ot.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),Ot.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(p=>{u.push(l.markPotentiallyOrphaned(e,p))}),Ot.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),Ot.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return Ot.resolve(o)}containsKey(e,i){return Ot.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class coe{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new kN(0),this.zr=!1,this.zr=!0,this.jr=new V4e,this.referenceDelegate=e(this),this.Hr=new z4e(this),this.indexManager=new R4e,this.remoteDocumentCache=function(l){return new j4e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new T4e(i),this.Yr=new M4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new U4e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new F4e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){dn("MemoryPersistence","Starting transaction:",e);const l=new W4e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return Ot.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class W4e extends y3e{constructor(e){super(),this.currentSequenceNumber=e}}class n3{constructor(e){this.persistence=e,this.ti=new t3,this.ni=null}static ri(e){return new n3(e)}get ii(){if(this.ni)return this.ni;throw Qn()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),Ot.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),Ot.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Ot.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ot.forEach(this.ii,o=>{const l=An.fromPath(o);return this.si(e,l).next(u=>{u||i.removeEntry(l,ar.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Ot.or([()=>Ot.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class NO{constructor(e,i){this.persistence=e,this.oi=new hE(o=>S3e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=N4e(this,i)}static ri(e,i){return new NO(e,i)}Zr(){}Xr(e){return Ot.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return Ot.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(u=>u?Ot.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(y=>{y||(o++,u.removeEntry(p,ar.min()))})).next(()=>u.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Ot.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Ot.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Ot.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Ot.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Gk(e.data.value)),i}ar(e,i,o){return Ot.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Ot.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Wr(),l=Wr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new r3(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return CVe()?8:E3e(hc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.rs(e,i).next(p=>{u.result=p}).next(()=>{if(!u.result)return this.ss(e,i,l,o).next(p=>{u.result=p})}).next(()=>{if(u.result)return;const p=new G4e;return this._s(e,i,p).next(y=>{if(u.result=y,this.Xi)return this.us(e,i,p,y.size)})}).next(()=>u.result)}us(e,i,o,l){return o.documentReadCount<this.es?(xS()<=zr.DEBUG&&dn("QueryEngine","SDK will not create cache indexes for query:",DS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ot.resolve()):(xS()<=zr.DEBUG&&dn("QueryEngine","Query:",DS(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(xS()<=zr.DEBUG&&dn("QueryEngine","The SDK decides to create cache indexes for query:",DS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xp(i))):Ot.resolve())}rs(e,i){if(ZJ(i))return Ot.resolve(null);let o=xp(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=AO(i,null,"F"),o=xp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(u=>{const p=Wr(...u);return this.ns.getDocuments(e,p).next(y=>this.indexManager.getMinOffset(e,o).next(v=>{const w=this.cs(i,y);return this.ls(i,w,p,v.readTime)?this.rs(e,AO(i,null,"F")):this.hs(e,w,i,v)}))})))}ss(e,i,o,l){return ZJ(i)||l.isEqual(ar.min())?Ot.resolve(null):this.ns.getDocuments(e,o).next(u=>{const p=this.cs(i,u);return this.ls(i,p,o,l)?Ot.resolve(null):(xS()<=zr.DEBUG&&dn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),DS(i)),this.hs(e,p,i,f3e(l,_R)).next(y=>y))})}cs(e,i){let o=new $o(Fse(e));return i.forEach((l,u)=>{MN(e,u)&&(o=o.add(u))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,o){return xS()<=zr.DEBUG&&dn("QueryEngine","Using full collection scan to execute query:",DS(i)),this.ns.getDocumentsMatchingQuery(e,i,Fg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(u=>(i.forEach(p=>{u=u.insert(p.key,p)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i3="LocalStore",$4e=3e8;class K4e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new Ns(Pr),this.Is=new hE(u=>K5(u),q5),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new L4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function q4e(n,e,i,o){return new K4e(n,e,i,o)}async function loe(n,e){const i=ur(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(u=>{const p=[],y=[];let v=Wr();for(const w of l){p.push(w.batchId);for(const C of w.mutations)v=v.add(C.key)}for(const w of u){y.push(w.batchId);for(const C of w.mutations)v=v.add(C.key)}return i.localDocuments.getDocuments(o,v).next(w=>({Rs:w,removedBatchIds:p,addedBatchIds:y}))})})}function Y4e(n,e){const i=ur(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(y,v,w,C){const R=w.batch,N=R.keys();let M=Ot.resolve();return N.forEach(D=>{M=M.next(()=>C.getEntry(v,D)).next(F=>{const z=w.docVersions.get(D);wi(z!==null),F.version.compareTo(z)<0&&(R.applyToRemoteDocument(F,w),F.isValidDocument()&&(F.setReadTime(w.commitVersion),C.addEntry(F)))})}),M.next(()=>y.mutationQueue.removeMutationBatch(v,R))}(i,o,e,u).next(()=>u.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(y){let v=Wr();for(let w=0;w<y.mutationResults.length;++w)y.mutationResults[w].transformResults.length>0&&(v=v.add(y.batch.mutations[w].key));return v}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function uoe(n){const e=ur(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function X4e(n,e){const i=ur(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const y=[];e.targetChanges.forEach((C,R)=>{const N=l.get(R);if(!N)return;y.push(i.Hr.removeMatchingKeys(u,C.removedDocuments,R).next(()=>i.Hr.addMatchingKeys(u,C.addedDocuments,R)));let M=N.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?M=M.withResumeToken(Va.EMPTY_BYTE_STRING,ar.min()).withLastLimboFreeSnapshotVersion(ar.min()):C.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(C.resumeToken,o)),l=l.insert(R,M),function(F,z,q){return F.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=$4e?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(N,M,C)&&y.push(i.Hr.updateTargetData(u,M))});let v=Jf(),w=Wr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))}),y.push(J4e(u,p,e.documentUpdates).next(C=>{v=C.Vs,w=C.fs})),!o.isEqual(ar.min())){const C=i.Hr.getLastRemoteSnapshotVersion(u).next(R=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,o));y.push(C)}return Ot.waitFor(y).next(()=>p.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,v,w)).next(()=>v)}).then(u=>(i.Ts=l,u))}function J4e(n,e,i){let o=Wr(),l=Wr();return i.forEach(u=>o=o.add(u)),e.getEntries(n,o).next(u=>{let p=Jf();return i.forEach((y,v)=>{const w=u.get(y);v.isFoundDocument()!==w.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(ar.min())?(e.removeEntry(y,v.readTime),p=p.insert(y,v)):!w.isValidDocument()||v.version.compareTo(w.version)>0||v.version.compareTo(w.version)===0&&w.hasPendingWrites?(e.addEntry(v),p=p.insert(y,v)):dn(i3,"Ignoring outdated watch update for ",y,". Current version:",w.version," Watch version:",v.version)}),{Vs:p,fs:l}})}function Q4e(n,e){const i=ur(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=H5),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function Z4e(n,e){const i=ur(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(u=>u?(l=u,Ot.resolve(l)):i.Hr.allocateTargetId(o).next(p=>(l=new Rg(e,p,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function OF(n,e,i){const o=ur(n),l=o.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,p=>o.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!nb(p))throw p;dn(i3,`Failed to update sequence numbers for target ${e}: ${p}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function hQ(n,e,i){const o=ur(n);let l=ar.min(),u=Wr();return o.persistence.runTransaction("Execute query","readwrite",p=>function(v,w,C){const R=ur(v),N=R.Is.get(C);return N!==void 0?Ot.resolve(R.Ts.get(N)):R.Hr.getTargetData(w,C)}(o,p,xp(e)).next(y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(p,y.targetId).next(v=>{u=v})}).next(()=>o.Ps.getDocumentsMatchingQuery(p,e,i?l:ar.min(),i?u:Wr())).next(y=>(eBe(o,j3e(e),y),{documents:y,gs:u})))}function eBe(n,e,i){let o=n.Es.get(e)||ar.min();i.forEach((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)}),n.Es.set(e,o)}class pQ{constructor(){this.activeTargetIds=$3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class tBe{constructor(){this.ho=new pQ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new pQ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nBe{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fQ="ConnectivityMonitor";class mQ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){dn(fQ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){dn(fQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uk=null;function NF(){return uk===null?uk=function(){return 268435456+Math.round(2147483648*Math.random())}():uk++,"0x"+uk.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV="RestConnection",rBe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class iBe{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===CO?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,u){const p=NF(),y=this.bo(e,i.toUriEncodedString());dn(rV,`Sending RPC '${e}' ${p}:`,y,o);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,u),this.vo(e,y,v,o).then(w=>(dn(rV,`Received RPC '${e}' ${p}: `,w),w),w=>{throw N0(rV,`RPC '${e}' ${p} failed with error: `,w,"url: ",y,"request:",o),w})}Co(e,i,o,l,u,p){return this.So(e,i,o,l,u)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+eb}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),o&&o.headers.forEach((l,u)=>e[u]=l)}bo(e,i){const o=rBe[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sBe{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="WebChannelConnection";class oBe extends iBe{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const u=NF();return new Promise((p,y)=>{const v=new fse;v.setWithCredentials(!0),v.listenOnce(mse.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case Wk.NO_ERROR:const C=v.getResponseJson();dn(sc,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(C)),p(C);break;case Wk.TIMEOUT:dn(sc,`RPC '${e}' ${u} timed out`),y(new en(bt.DEADLINE_EXCEEDED,"Request time out"));break;case Wk.HTTP_ERROR:const R=v.getStatus();if(dn(sc,`RPC '${e}' ${u} failed with status:`,R,"response text:",v.getResponseText()),R>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const M=N==null?void 0:N.error;if(M&&M.status&&M.message){const D=function(z){const q=z.toLowerCase().replace(/_/g,"-");return Object.values(bt).indexOf(q)>=0?q:bt.UNKNOWN}(M.status);y(new en(D,M.message))}else y(new en(bt.UNKNOWN,"Server responded with status "+v.getStatus()))}else y(new en(bt.UNAVAILABLE,"Connection failed."));break;default:Qn()}}finally{dn(sc,`RPC '${e}' ${u} completed.`)}});const w=JSON.stringify(l);dn(sc,`RPC '${e}' ${u} sending request:`,l),v.send(i,"POST",w,o,15)})}Wo(e,i,o){const l=NF(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=yse(),y=_se(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},w=this.longPollingOptions.timeoutSeconds;w!==void 0&&(v.longPollingTimeout=Math.round(1e3*w)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,o),v.encodeInitMessageHeaders=!0;const C=u.join("");dn(sc,`Creating RPC '${e}' stream ${l}: ${C}`,v);const R=p.createWebChannel(C,v);let N=!1,M=!1;const D=new sBe({Fo:z=>{M?dn(sc,`Not sending because RPC '${e}' stream ${l} is closed:`,z):(N||(dn(sc,`Opening RPC '${e}' stream ${l} transport.`),R.open(),N=!0),dn(sc,`RPC '${e}' stream ${l} sending:`,z),R.send(z))},Mo:()=>R.close()}),F=(z,q,K)=>{z.listen(q,re=>{try{K(re)}catch(ce){setTimeout(()=>{throw ce},0)}})};return F(R,yC.EventType.OPEN,()=>{M||(dn(sc,`RPC '${e}' stream ${l} transport opened.`),D.Qo())}),F(R,yC.EventType.CLOSE,()=>{M||(M=!0,dn(sc,`RPC '${e}' stream ${l} transport closed`),D.Uo())}),F(R,yC.EventType.ERROR,z=>{M||(M=!0,N0(sc,`RPC '${e}' stream ${l} transport errored:`,z),D.Uo(new en(bt.UNAVAILABLE,"The operation could not be completed")))}),F(R,yC.EventType.MESSAGE,z=>{var q;if(!M){const K=z.data[0];wi(!!K);const re=K,ce=(re==null?void 0:re.error)||((q=re[0])===null||q===void 0?void 0:q.error);if(ce){dn(sc,`RPC '${e}' stream ${l} received error:`,ce);const se=ce.status;let ge=function(te){const ne=bo[te];if(ne!==void 0)return Jse(ne)}(se),X=ce.message;ge===void 0&&(ge=bt.INTERNAL,X="Unknown error status: "+se+" with message "+ce.message),M=!0,D.Uo(new en(ge,X)),R.close()}else dn(sc,`RPC '${e}' stream ${l} received:`,K),D.Ko(K)}}),F(y,gse.STAT_EVENT,z=>{z.stat===vF.PROXY?dn(sc,`RPC '${e}' stream ${l} detected buffering proxy`):z.stat===vF.NOPROXY&&dn(sc,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{D.$o()},0),D}}function iV(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(n){return new u4e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class doe{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&dn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gQ="PersistentStream";class hoe{constructor(e,i,o,l,u,p,y,v){this.Ti=e,this.n_=o,this.r_=l,this.connection=u,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new doe(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===bt.RESOURCE_EXHAUSTED?(Xf(i.toString()),Xf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===bt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new en(bt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return dn(gQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(dn(gQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class aBe extends hoe{constructor(e,i,o,l,u,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=p4e(this.serializer,e),o=function(u){if(!("targetChange"in u))return ar.min();const p=u.targetChange;return p.targetIds&&p.targetIds.length?ar.min():p.readTime?Dp(p.readTime):ar.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=kF(this.serializer),i.addTarget=function(u,p){let y;const v=p.target;if(y=CF(v)?{documents:g4e(u,v)}:{query:_4e(u,v).ht},y.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){y.resumeToken=eoe(u,p.resumeToken);const w=IF(u,p.expectedCount);w!==null&&(y.expectedCount=w)}else if(p.snapshotVersion.compareTo(ar.min())>0){y.readTime=OO(u,p.snapshotVersion.toTimestamp());const w=IF(u,p.expectedCount);w!==null&&(y.expectedCount=w)}return y}(this.serializer,e);const o=E4e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=kF(this.serializer),i.removeTarget=e,this.I_(i)}}class cBe extends hoe{constructor(e,i,o,l,u,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,p),this.serializer=u}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return wi(!!e.streamToken),this.lastStreamToken=e.streamToken,wi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){wi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=m4e(e.writeResults,e.commitTime),o=Dp(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=kF(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>f4e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lBe{}class uBe extends lBe{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new en(bt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,p])=>this.connection.So(e,AF(i,o),l,u,p)).catch(u=>{throw u.name==="FirebaseError"?(u.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new en(bt.UNKNOWN,u.toString())})}Co(e,i,o,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,y])=>this.connection.Co(e,AF(i,o),l,p,y,u)).catch(p=>{throw p.name==="FirebaseError"?(p.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new en(bt.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class dBe{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Xf(i),this.N_=!1):dn("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="RemoteStore";class hBe{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(p=>{o.enqueueAndForget(async()=>{pE(this)&&(dn(sE,"Restarting streams for network reachability change."),await async function(v){const w=ur(v);w.W_.add(4),await QR(w),w.j_.set("Unknown"),w.W_.delete(4),await BN(w)}(this))})}),this.j_=new dBe(o,l)}}async function BN(n){if(pE(n))for(const e of n.G_)await e(!0)}async function QR(n){for(const e of n.G_)await e(!1)}function poe(n,e){const i=ur(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),c3(i)?a3(i):rb(i).c_()&&o3(i,e))}function s3(n,e){const i=ur(n),o=rb(i);i.K_.delete(e),o.c_()&&foe(i,e),i.K_.size===0&&(o.c_()?o.P_():pE(i)&&i.j_.set("Unknown"))}function o3(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ar.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}rb(n).y_(e)}function foe(n,e){n.H_.Ne(e),rb(n).w_(e)}function a3(n){n.H_=new o4e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),rb(n).start(),n.j_.B_()}function c3(n){return pE(n)&&!rb(n).u_()&&n.K_.size>0}function pE(n){return ur(n).W_.size===0}function moe(n){n.H_=void 0}async function pBe(n){n.j_.set("Online")}async function fBe(n){n.K_.forEach((e,i)=>{o3(n,e)})}async function mBe(n,e){moe(n),c3(n)?(n.j_.q_(e),a3(n)):n.j_.set("Unknown")}async function gBe(n,e,i){if(n.j_.set("Online"),e instanceof Zse&&e.state===2&&e.cause)try{await async function(l,u){const p=u.cause;for(const y of u.targetIds)l.K_.has(y)&&(await l.remoteSyncer.rejectListen(y,p),l.K_.delete(y),l.H_.removeTarget(y))}(n,e)}catch(o){dn(sE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await xO(n,o)}else if(e instanceof Kk?n.H_.We(e):e instanceof Qse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(ar.min()))try{const o=await uoe(n.localStore);i.compareTo(o)>=0&&await function(u,p){const y=u.H_.ot(p);return y.targetChanges.forEach((v,w)=>{if(v.resumeToken.approximateByteSize()>0){const C=u.K_.get(w);C&&u.K_.set(w,C.withResumeToken(v.resumeToken,p))}}),y.targetMismatches.forEach((v,w)=>{const C=u.K_.get(v);if(!C)return;u.K_.set(v,C.withResumeToken(Va.EMPTY_BYTE_STRING,C.snapshotVersion)),foe(u,v);const R=new Rg(C.target,v,w,C.sequenceNumber);o3(u,R)}),u.remoteSyncer.applyRemoteEvent(y)}(n,i)}catch(o){dn(sE,"Failed to raise snapshot:",o),await xO(n,o)}}async function xO(n,e,i){if(!nb(e))throw e;n.W_.add(1),await QR(n),n.j_.set("Offline"),i||(i=()=>uoe(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{dn(sE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await BN(n)})}function goe(n,e){return e().catch(i=>xO(n,i,e))}async function zN(n){const e=ur(n),i=Wg(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:H5;for(;_Be(e);)try{const l=await Q4e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,yBe(e,l)}catch(l){await xO(e,l)}_oe(e)&&yoe(e)}function _Be(n){return pE(n)&&n.U_.length<10}function yBe(n,e){n.U_.push(e);const i=Wg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function _oe(n){return pE(n)&&!Wg(n).u_()&&n.U_.length>0}function yoe(n){Wg(n).start()}async function EBe(n){Wg(n).C_()}async function vBe(n){const e=Wg(n);for(const i of n.U_)e.b_(i.mutations)}async function SBe(n,e,i){const o=n.U_.shift(),l=Q5.from(o,e,i);await goe(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await zN(n)}async function bBe(n,e){e&&Wg(n).S_&&await async function(o,l){if(function(p){return i4e(p)&&p!==bt.ABORTED}(l.code)){const u=o.U_.shift();Wg(o).h_(),await goe(o,()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l)),await zN(o)}}(n,e),_oe(n)&&yoe(n)}async function _Q(n,e){const i=ur(n);i.asyncQueue.verifyOperationInProgress(),dn(sE,"RemoteStore received new credentials");const o=pE(i);i.W_.add(3),await QR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await BN(i)}async function wBe(n,e){const i=ur(n);e?(i.W_.delete(2),await BN(i)):e||(i.W_.add(2),await QR(i),i.j_.set("Unknown"))}function rb(n){return n.J_||(n.J_=function(i,o,l){const u=ur(i);return u.M_(),new aBe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:pBe.bind(null,n),No:fBe.bind(null,n),Lo:mBe.bind(null,n),p_:gBe.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),c3(n)?a3(n):n.j_.set("Unknown")):(await n.J_.stop(),moe(n))})),n.J_}function Wg(n){return n.Y_||(n.Y_=function(i,o,l){const u=ur(i);return u.M_(),new cBe(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:EBe.bind(null,n),Lo:bBe.bind(null,n),D_:vBe.bind(null,n),v_:SBe.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await zN(n)):(await n.Y_.stop(),n.U_.length>0&&(dn(sE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new Bf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const p=Date.now()+o,y=new l3(e,i,p,l,u);return y.start(o),y}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new en(bt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function u3(n,e){if(Xf("AsyncQueue",`${e}: ${n}`),nb(n))return new en(bt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g0{static emptySet(e){return new g0(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||An.comparator(i.key,o.key):(i,o)=>An.comparator(i.key,o.key),this.keyedMap=EC(),this.sortedSet=new Ns(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof g0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new g0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yQ{constructor(){this.Z_=new Ns(An.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Qn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class j0{constructor(e,i,o,l,u,p,y,v,w){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=p,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=w}static fromInitialDocuments(e,i,o,l,u){const p=[];return i.forEach(y=>{p.push({type:0,doc:y})}),new j0(e,i,g0.emptySet(i),p,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&LN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TBe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class CBe{constructor(){this.queries=EQ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=ur(i),u=l.queries;l.queries=EQ(),u.forEach((p,y)=>{for(const v of y.ta)v.onError(o)})})(this,new en(bt.ABORTED,"Firestore shutting down"))}}function EQ(){return new hE(n=>Vse(n),LN)}async function d3(n,e){const i=ur(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(o=2):(u=new TBe,o=e.ra()?0:1);try{switch(o){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const y=u3(p,`Initialization of query '${DS(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&p3(i)}async function h3(n,e){const i=ur(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const p=u.ta.indexOf(e);p>=0&&(u.ta.splice(p,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function RBe(n,e){const i=ur(n);let o=!1;for(const l of e){const u=l.query,p=i.queries.get(u);if(p){for(const y of p.ta)y.oa(l)&&(o=!0);p.ea=l}}o&&p3(i)}function IBe(n,e,i){const o=ur(n),l=o.queries.get(e);if(l)for(const u of l.ta)u.onError(i);o.queries.delete(e)}function p3(n){n.ia.forEach(e=>{e.next()})}var xF,vQ;(vQ=xF||(xF={}))._a="default",vQ.Cache="cache";class f3{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new j0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=j0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==xF.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eoe{constructor(e){this.key=e}}class voe{constructor(e){this.key=e}}class ABe{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Wr(),this.mutatedKeys=Wr(),this.ya=Fse(e),this.wa=new g0(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new yQ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,p=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,w=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,R)=>{const N=l.get(C),M=MN(this.query,R)?R:null,D=!!N&&this.mutatedKeys.has(N.key),F=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let z=!1;N&&M?N.data.isEqual(M.data)?D!==F&&(o.track({type:3,doc:M}),z=!0):this.va(N,M)||(o.track({type:2,doc:M}),z=!0,(v&&this.ya(M,v)>0||w&&this.ya(M,w)<0)&&(y=!0)):!N&&M?(o.track({type:0,doc:M}),z=!0):N&&!M&&(o.track({type:1,doc:N}),z=!0,(v||w)&&(y=!0)),z&&(M?(p=p.add(M),u=F?u.add(C):u.delete(C)):(p=p.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const C=this.query.limitType==="F"?p.last():p.first();p=p.delete(C.key),u=u.delete(C.key),o.track({type:1,doc:C})}return{wa:p,Da:o,ls:y,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((C,R)=>function(M,D){const F=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qn()}};return F(M)-F(D)}(C.type,R.type)||this.ya(C.doc,R.doc)),this.Ca(o),l=l!=null&&l;const y=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,w=v!==this.ga;return this.ga=v,p.length!==0||w?{snapshot:new j0(this.query,e.wa,u,p,e.mutatedKeys,v===0,w,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:y}:{Ma:y}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new yQ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Wr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new voe(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new Eoe(o))}),i}Oa(e){this.fa=e.gs,this.pa=Wr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return j0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const m3="SyncEngine";class PBe{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class kBe{constructor(e){this.key=e,this.Ba=!1}}class OBe{constructor(e,i,o,l,u,p){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new hE(y=>Vse(y),LN),this.qa=new Map,this.Qa=new Set,this.$a=new Ns(An.comparator),this.Ua=new Map,this.Ka=new t3,this.Wa={},this.Ga=new Map,this.za=F0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function NBe(n,e,i=!0){const o=Roe(n);let l;const u=o.ka.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await Soe(o,e,i,!0),l}async function xBe(n,e){const i=Roe(n);await Soe(i,e,!0,!1)}async function Soe(n,e,i,o){const l=await Z4e(n.localStore,xp(e)),u=l.targetId,p=n.sharedClientState.addLocalQueryTarget(u,i);let y;return o&&(y=await DBe(n,e,u,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&poe(n.remoteStore,l),y}async function DBe(n,e,i,o,l){n.Ha=(R,N,M)=>async function(F,z,q,K){let re=z.view.ba(q);re.ls&&(re=await hQ(F.localStore,z.query,!1).then(({documents:X})=>z.view.ba(X,re)));const ce=K&&K.targetChanges.get(z.targetId),se=K&&K.targetMismatches.get(z.targetId)!=null,ge=z.view.applyChanges(re,F.isPrimaryClient,ce,se);return bQ(F,z.targetId,ge.Ma),ge.snapshot}(n,R,N,M);const u=await hQ(n.localStore,e,!0),p=new ABe(e,u.gs),y=p.ba(u.documents),v=JR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),w=p.applyChanges(y,n.isPrimaryClient,v);bQ(n,i,w.Ma);const C=new PBe(e,i,p);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),w.snapshot}async function LBe(n,e,i){const o=ur(n),l=o.ka.get(e),u=o.qa.get(l.targetId);if(u.length>1)return o.qa.set(l.targetId,u.filter(p=>!LN(p,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await OF(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&s3(o.remoteStore,l.targetId),DF(o,l.targetId)}).catch(tb)):(DF(o,l.targetId),await OF(o.localStore,l.targetId,!0))}async function MBe(n,e){const i=ur(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),s3(i.remoteStore,o.targetId))}async function UBe(n,e,i){const o=GBe(n);try{const l=await function(p,y){const v=ur(p),w=Ho.now(),C=y.reduce((M,D)=>M.add(D.key),Wr());let R,N;return v.persistence.runTransaction("Locally write mutations","readwrite",M=>{let D=Jf(),F=Wr();return v.ds.getEntries(M,C).next(z=>{D=z,D.forEach((q,K)=>{K.isValidDocument()||(F=F.add(q))})}).next(()=>v.localDocuments.getOverlayedDocuments(M,D)).next(z=>{R=z;const q=[];for(const K of y){const re=Z3e(K,R.get(K.key).overlayedDocument);re!=null&&q.push(new Qg(K.key,re,Ose(re.value.mapValue),rd.exists(!0)))}return v.mutationQueue.addMutationBatch(M,w,q,y)}).next(z=>{N=z;const q=z.applyToLocalDocumentSet(R,F);return v.documentOverlayCache.saveOverlays(M,z.batchId,q)})}).then(()=>({batchId:N.batchId,changes:Bse(R)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(p,y,v){let w=p.Wa[p.currentUser.toKey()];w||(w=new Ns(Pr)),w=w.insert(y,v),p.Wa[p.currentUser.toKey()]=w}(o,l.batchId,i),await ZR(o,l.changes),await zN(o.remoteStore)}catch(l){const u=u3(l,"Failed to persist write");i.reject(u)}}async function boe(n,e){const i=ur(n);try{const o=await X4e(i.localStore,e);e.targetChanges.forEach((l,u)=>{const p=i.Ua.get(u);p&&(wi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?wi(p.Ba):l.removedDocuments.size>0&&(wi(p.Ba),p.Ba=!1))}),await ZR(i,o,e)}catch(o){await tb(o)}}function SQ(n,e,i){const o=ur(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((u,p)=>{const y=p.view.sa(e);y.snapshot&&l.push(y.snapshot)}),function(p,y){const v=ur(p);v.onlineState=y;let w=!1;v.queries.forEach((C,R)=>{for(const N of R.ta)N.sa(y)&&(w=!0)}),w&&p3(v)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function VBe(n,e,i){const o=ur(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),u=l&&l.key;if(u){let p=new Ns(An.comparator);p=p.insert(u,lc.newNoDocument(u,ar.min()));const y=Wr().add(u),v=new FN(ar.min(),new Map,new Ns(Pr),p,y);await boe(o,v),o.$a=o.$a.remove(u),o.Ua.delete(e),g3(o)}else await OF(o.localStore,e,!1).then(()=>DF(o,e,i)).catch(tb)}async function FBe(n,e){const i=ur(n),o=e.batch.batchId;try{const l=await Y4e(i.localStore,e);Toe(i,o,null),woe(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await ZR(i,l)}catch(l){await tb(l)}}async function jBe(n,e,i){const o=ur(n);try{const l=await function(p,y){const v=ur(p);return v.persistence.runTransaction("Reject batch","readwrite-primary",w=>{let C;return v.mutationQueue.lookupMutationBatch(w,y).next(R=>(wi(R!==null),C=R.keys(),v.mutationQueue.removeMutationBatch(w,R))).next(()=>v.mutationQueue.performConsistencyCheck(w)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(w,C,y)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(w,C)).next(()=>v.localDocuments.getDocuments(w,C))})}(o.localStore,e);Toe(o,e,i),woe(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await ZR(o,l)}catch(l){await tb(l)}}function woe(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Toe(n,e,i){const o=ur(n);let l=o.Wa[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function DF(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||Coe(n,o)})}function Coe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(s3(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),g3(n))}function bQ(n,e,i){for(const o of i)o instanceof Eoe?(n.Ka.addReference(o.key,e),BBe(n,o)):o instanceof voe?(dn(m3,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||Coe(n,o.key)):Qn()}function BBe(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(dn(m3,"New document in limbo: "+i),n.Qa.add(o),g3(n))}function g3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new An(Zi.fromString(e)),o=n.za.next();n.Ua.set(o,new kBe(i)),n.$a=n.$a.insert(i,o),poe(n.remoteStore,new Rg(xp(DN(i.path)),o,"TargetPurposeLimboResolution",kN.ae))}}async function ZR(n,e,i){const o=ur(n),l=[],u=[],p=[];o.ka.isEmpty()||(o.ka.forEach((y,v)=>{p.push(o.Ha(v,e,i).then(w=>{var C;if((w||i)&&o.isPrimaryClient){const R=w?!w.fromCache:(C=i==null?void 0:i.targetChanges.get(v.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(v.targetId,R?"current":"not-current")}if(w){l.push(w);const R=r3.Yi(v.targetId,w);u.push(R)}}))}),await Promise.all(p),o.La.p_(l),await async function(v,w){const C=ur(v);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",R=>Ot.forEach(w,N=>Ot.forEach(N.Hi,M=>C.persistence.referenceDelegate.addReference(R,N.targetId,M)).next(()=>Ot.forEach(N.Ji,M=>C.persistence.referenceDelegate.removeReference(R,N.targetId,M)))))}catch(R){if(!nb(R))throw R;dn(i3,"Failed to update sequence numbers: "+R)}for(const R of w){const N=R.targetId;if(!R.fromCache){const M=C.Ts.get(N),D=M.snapshotVersion,F=M.withLastLimboFreeSnapshotVersion(D);C.Ts=C.Ts.insert(N,F)}}}(o.localStore,u))}async function zBe(n,e){const i=ur(n);if(!i.currentUser.isEqual(e)){dn(m3,"User change. New user:",e.toKey());const o=await loe(i.localStore,e);i.currentUser=e,function(u,p){u.Ga.forEach(y=>{y.forEach(v=>{v.reject(new en(bt.CANCELLED,p))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await ZR(i,o.Rs)}}function WBe(n,e){const i=ur(n),o=i.Ua.get(e);if(o&&o.Ba)return Wr().add(o.key);{let l=Wr();const u=i.qa.get(e);if(!u)return l;for(const p of u){const y=i.ka.get(p);l=l.unionWith(y.view.Sa)}return l}}function Roe(n){const e=ur(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=boe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=WBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=VBe.bind(null,e),e.La.p_=RBe.bind(null,e.eventManager),e.La.Ja=IBe.bind(null,e.eventManager),e}function GBe(n){const e=ur(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=FBe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jBe.bind(null,e),e}class DO{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return q4e(this.persistence,new H4e,e.initialUser,this.serializer)}Xa(e){return new coe(n3.ri,this.serializer)}Za(e){return new tBe}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}DO.provider={build:()=>new DO};class HBe extends DO{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){wi(this.persistence.referenceDelegate instanceof NO);const o=this.persistence.referenceDelegate.garbageCollector;return new k4e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?hl.withCacheSize(this.cacheSizeBytes):hl.DEFAULT;return new coe(o=>NO.ri(o,i),this.serializer)}}class LF{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>SQ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=zBe.bind(null,this.syncEngine),await wBe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new CBe}()}createDatastore(e){const i=jN(e.databaseInfo.databaseId),o=function(u){return new oBe(u)}(e.databaseInfo);return function(u,p,y,v){return new uBe(u,p,y,v)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,u,p,y){return new hBe(o,l,u,p,y)}(this.localStore,this.datastore,e.asyncQueue,i=>SQ(this.syncEngine,i,0),function(){return mQ.D()?new mQ:new nBe}())}createSyncEngine(e,i){return function(l,u,p,y,v,w,C){const R=new OBe(l,u,p,y,v,w);return C&&(R.ja=!0),R}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=ur(l);dn(sE,"RemoteStore shutting down."),u.W_.add(5),await QR(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}LF.provider={build:()=>new LF};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Xf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg="FirestoreClient";class $Be{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=cc.UNAUTHENTICATED,this.clientId=Sse.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,async p=>{dn(Gg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(o,p=>(dn(Gg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=u3(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function sV(n,e){n.asyncQueue.verifyOperationInProgress(),dn(Gg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await loe(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function wQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await KBe(n);dn(Gg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>_Q(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>_Q(e.remoteStore,l)),n._onlineComponents=e}async function KBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){dn(Gg,"Using user provided OfflineComponentProvider");try{await sV(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===bt.FAILED_PRECONDITION||l.code===bt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;N0("Error using user provided cache. Falling back to memory cache: "+i),await sV(n,new DO)}}else dn(Gg,"Using default OfflineComponentProvider"),await sV(n,new HBe(void 0));return n._offlineComponents}async function Ioe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(dn(Gg,"Using user provided OnlineComponentProvider"),await wQ(n,n._uninitializedComponentsProvider._online)):(dn(Gg,"Using default OnlineComponentProvider"),await wQ(n,new LF))),n._onlineComponents}function qBe(n){return Ioe(n).then(e=>e.syncEngine)}async function LO(n){const e=await Ioe(n),i=e.eventManager;return i.onListen=NBe.bind(null,e.syncEngine),i.onUnlisten=LBe.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=xBe.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=MBe.bind(null,e.syncEngine),i}function YBe(n,e,i={}){const o=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(u,p,y,v,w){const C=new _3({next:N=>{C.su(),p.enqueueAndForget(()=>h3(u,R));const M=N.docs.has(y);!M&&N.fromCache?w.reject(new en(bt.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&N.fromCache&&v&&v.source==="server"?w.reject(new en(bt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):w.resolve(N)},error:N=>w.reject(N)}),R=new f3(DN(y.path),C,{includeMetadataChanges:!0,Ta:!0});return d3(u,R)}(await LO(n),n.asyncQueue,e,i,o)),o.promise}function XBe(n,e,i={}){const o=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(u,p,y,v,w){const C=new _3({next:N=>{C.su(),p.enqueueAndForget(()=>h3(u,R)),N.fromCache&&v.source==="server"?w.reject(new en(bt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):w.resolve(N)},error:N=>w.reject(N)}),R=new f3(y,C,{includeMetadataChanges:!0,Ta:!0});return d3(u,R)}(await LO(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aoe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Poe(n,e,i){if(!i)throw new en(bt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function JBe(n,e,i,o){if(e===!0&&o===!0)throw new en(bt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function CQ(n){if(!An.isDocumentKey(n))throw new en(bt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function RQ(n){if(An.isDocumentKey(n))throw new en(bt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function WN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Qn()}function Sl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new en(bt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=WN(n);throw new en(bt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const koe="firestore.googleapis.com",IQ=!0;class AQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new en(bt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=koe,this.ssl=IQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:IQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=aoe;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<A4e)throw new en(bt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}JBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Aoe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new en(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new en(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new en(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class GN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new en(bt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new en(bt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new s3e;switch(o.type){case"firstParty":return new l3e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new en(bt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=TQ.get(i);o&&(dn("ComponentProvider","Removing Datastore"),TQ.delete(i),o.terminate())}(this),Promise.resolve()}}function QBe(n,e,i,o={}){var l;const u=(n=Sl(n,GN))._getSettings(),p=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),y=`${e}:${i}`;u.host!==koe&&u.host!==y&&N0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},u),{host:y,ssl:!1,emulatorOptions:o});if(!$f(v,p)&&(n._setSettings(v),o.mockUserToken)){let w,C;if(typeof o.mockUserToken=="string")w=o.mockUserToken,C=cc.MOCK_USER;else{w=Tie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const R=o.mockUserToken.sub||o.mockUserToken.user_id;if(!R)throw new en(bt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new cc(R)}n._authCredentials=new o3e(new Ese(w,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new Fp(this.firestore,e,this._query)}}class dc{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new dc(this.firestore,e,this._key)}}class xg extends Fp{constructor(e,i,o){super(e,i,DN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new dc(this.firestore,null,new An(e))}withConverter(e){return new xg(this.firestore,e,this._path)}}function bl(n,e,...i){if(n=Pi(n),Poe("collection","path",e),n instanceof GN){const o=Zi.fromString(e,...i);return RQ(o),new xg(n,null,o)}{if(!(n instanceof dc||n instanceof xg))throw new en(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Zi.fromString(e,...i));return RQ(o),new xg(n.firestore,null,o)}}function br(n,e,...i){if(n=Pi(n),arguments.length===1&&(e=Sse.newId()),Poe("doc","path",e),n instanceof GN){const o=Zi.fromString(e,...i);return CQ(o),new dc(n,null,new An(o))}{if(!(n instanceof dc||n instanceof xg))throw new en(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Zi.fromString(e,...i));return CQ(o),new dc(n.firestore,n instanceof xg?n.converter:null,new An(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PQ="AsyncQueue";class kQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new doe(this,"async_queue_retry"),this.Su=()=>{const o=iV();o&&dn(PQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=iV();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=iV();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Bf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!nb(e))throw e;dn(PQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(p){let y=p.message||"";return p.stack&&(y=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),y}(o);throw Xf("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=l3.createAndSchedule(this,e,i,o,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&Qn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function OQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class Qf extends GN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new kQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new kQ(e),this._firestoreClient=void 0,await e}}}function qk(n,e){const i=typeof n=="object"?n:CN(),o=typeof n=="string"?n:CO,l=HR(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=x5("firestore");u&&QBe(l,...u)}return l}function HN(n){if(n._terminated)throw new en(bt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||ZBe(n),n._firestoreClient}function ZBe(n){var e,i,o;const l=n._freezeSettings(),u=function(y,v,w,C){return new T3e(y,v,w,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,Aoe(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new $Be(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new B0(Va.fromBase64String(e))}catch(i){throw new en(bt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new B0(Va.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $N{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new en(bt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ma(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new en(bt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new en(bt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Pr(this._lat,e._lat)||Pr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e6e=/^__.*__$/;class t6e{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new Qg(e,this.data,this.fieldMask,i,this.fieldTransforms):new XR(e,this.data,i,this.fieldTransforms)}}class Ooe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new Qg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Noe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qn()}}class KN{constructor(e,i,o,l,u,p){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new KN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return MO(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Noe(this.Lu)&&e6e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class n6e{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||jN(e)}ju(e,i,o,l=!1){return new KN({Lu:e,methodName:i,zu:o,path:Ma.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tI(n){const e=n._freezeSettings(),i=jN(n._databaseId);return new n6e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function xoe(n,e,i,o,l,u={}){const p=n.ju(u.merge||u.mergeFields?2:0,e,i,l);b3("Data must be an object, but it was:",p,o);const y=Moe(o,p);let v,w;if(u.merge)v=new tu(p.fieldMask),w=p.fieldTransforms;else if(u.mergeFields){const C=[];for(const R of u.mergeFields){const N=MF(e,R,i);if(!p.contains(N))throw new en(bt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);Voe(C,N)||C.push(N)}v=new tu(C),w=p.fieldTransforms.filter(R=>v.covers(R.field))}else v=null,w=p.fieldTransforms;return new t6e(new ml(y),v,w)}class qN extends eI{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qN}}function Doe(n,e,i){return new KN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class v3 extends eI{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Doe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new U0(o);return new qse(e.path,l)}isEqual(e){return e instanceof v3&&$f(this.Hu,e.Hu)}}class S3 extends eI{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=Doe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new V0(o);return new qse(e.path,l)}isEqual(e){return e instanceof S3&&$f(this.Hu,e.Hu)}}function r6e(n,e,i,o){const l=n.ju(1,e,i);b3("Data must be an object, but it was:",l,o);const u=[],p=ml.empty();Jg(o,(v,w)=>{const C=w3(e,v,i);w=Pi(w);const R=l.Uu(C);if(w instanceof qN)u.push(C);else{const N=fE(w,R);N!=null&&(u.push(C),p.set(C,N))}});const y=new tu(u);return new Ooe(p,y,l.fieldTransforms)}function i6e(n,e,i,o,l,u){const p=n.ju(1,e,i),y=[MF(e,o,i)],v=[l];if(u.length%2!=0)throw new en(bt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<u.length;N+=2)y.push(MF(e,u[N])),v.push(u[N+1]);const w=[],C=ml.empty();for(let N=y.length-1;N>=0;--N)if(!Voe(w,y[N])){const M=y[N];let D=v[N];D=Pi(D);const F=p.Uu(M);if(D instanceof qN)w.push(M);else{const z=fE(D,F);z!=null&&(w.push(M),C.set(M,z))}}const R=new tu(w);return new Ooe(C,R,p.fieldTransforms)}function Loe(n,e,i,o=!1){return fE(i,n.ju(o?4:3,e))}function fE(n,e){if(Uoe(n=Pi(n)))return b3("Unsupported field value:",e,n),Moe(n,e);if(n instanceof eI)return function(o,l){if(!Noe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const u=[];let p=0;for(const y of o){let v=fE(y,l.Ku(p));v==null&&(v={nullValue:"NULL_VALUE"}),u.push(v),p++}return{arrayValue:{values:u}}}(n,e)}return function(o,l){if((o=Pi(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return K3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=Ho.fromDate(o);return{timestampValue:OO(l.serializer,u)}}if(o instanceof Ho){const u=new Ho(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:OO(l.serializer,u)}}if(o instanceof y3)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof B0)return{bytesValue:eoe(l.serializer,o._byteString)};if(o instanceof dc){const u=l.databaseId,p=o.firestore._databaseId;if(!p.isEqual(u))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:e3(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof E3)return function(p,y){return{mapValue:{fields:{[Pse]:{stringValue:kse},[RO]:{arrayValue:{values:p.toArray().map(w=>{if(typeof w!="number")throw y.Wu("VectorValues must only contain numeric values.");return X5(y.serializer,w)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${WN(o)}`)}(n,e)}function Moe(n,e){const i={};return wse(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jg(n,(o,l)=>{const u=fE(l,e.qu(o));u!=null&&(i[o]=u)}),{mapValue:{fields:i}}}function Uoe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ho||n instanceof y3||n instanceof B0||n instanceof dc||n instanceof eI||n instanceof E3)}function b3(n,e,i){if(!Uoe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=WN(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function MF(n,e,i){if((e=Pi(e))instanceof $N)return e._internalPath;if(typeof e=="string")return w3(n,e);throw MO("Field path arguments must be of type string or ",n,!1,void 0,i)}const s6e=new RegExp("[~\\*/\\[\\]]");function w3(n,e,i){if(e.search(s6e)>=0)throw MO(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new $N(...e.split("."))._internalPath}catch{throw MO(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function MO(n,e,i,o,l){const u=o&&!o.isEmpty(),p=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(u||p)&&(v+=" (found",u&&(v+=` in field ${o}`),p&&(v+=` in document ${l}`),v+=")"),new en(bt.INVALID_ARGUMENT,y+n+v)}function Voe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T3{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new dc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new o6e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(YN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class o6e extends T3{data(){return super.data()}}function YN(n,e){return typeof e=="string"?w3(n,e):e instanceof $N?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Foe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new en(bt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class C3{}class XN extends C3{}function UO(n,e,...i){let o=[];e instanceof C3&&o.push(e),o=o.concat(i),function(u){const p=u.filter(v=>v instanceof R3).length,y=u.filter(v=>v instanceof JN).length;if(p>1||p>0&&y>0)throw new en(bt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class JN extends XN{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new JN(e,i,o)}_apply(e){const i=this._parse(e);return joe(e._query,i),new Fp(e.firestore,e.converter,RF(e._query,i))}_parse(e){const i=tI(e.firestore);return function(u,p,y,v,w,C,R){let N;if(w.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new en(bt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){DQ(R,C);const D=[];for(const F of R)D.push(xQ(v,u,F));N={arrayValue:{values:D}}}else N=xQ(v,u,R)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||DQ(R,C),N=Loe(y,p,R,C==="in"||C==="not-in");return Ro.create(w,C,N)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function NQ(n,e,i){const o=e,l=YN("where",n);return JN._create(l,o,i)}class R3 extends C3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new R3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:hh.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let p=l;const y=u.getFlattenedFilters();for(const v of y)joe(p,v),p=RF(p,v)}(e._query,i),new Fp(e.firestore,e.converter,RF(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class I3 extends XN{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new I3(e,i)}_apply(e){const i=function(l,u,p){if(l.startAt!==null)throw new en(bt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new en(bt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new SR(u,p)}(e._query,this._field,this._direction);return new Fp(e.firestore,e.converter,function(l,u){const p=l.explicitOrderBy.concat([u]);return new dE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function a6e(n,e="asc"){const i=e,o=YN("orderBy",n);return I3._create(o,i)}class A3 extends XN{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new A3(e,i,o)}_apply(e){return new Fp(e.firestore,e.converter,AO(e._query,this._limit,this._limitType))}}function c6e(n){return A3._create("limit",n,"F")}class P3 extends XN{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new P3(e,i,o)}_apply(e){const i=u6e(e,this.type,this._docOrFields,this._inclusive);return new Fp(e.firestore,e.converter,function(l,u){return new dE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)}(e._query,i))}}function l6e(...n){return P3._create("startAt",n,!0)}function u6e(n,e,i,o){if(i[0]=Pi(i[0]),i[0]instanceof T3)return function(u,p,y,v,w){if(!v)throw new en(bt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${y}().`);const C=[];for(const R of m0(u))if(R.field.isKeyField())C.push(IO(p,v.key));else{const N=v.data.field(R.field);if(NN(N))throw new en(bt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(N===null){const M=R.field.canonicalString();throw new en(bt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${M}' (used as the orderBy) does not exist.`)}C.push(N)}return new M0(C,w)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=tI(n.firestore);return function(p,y,v,w,C,R){const N=p.explicitOrderBy;if(C.length>N.length)throw new en(bt.INVALID_ARGUMENT,`Too many arguments provided to ${w}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const M=[];for(let D=0;D<C.length;D++){const F=C[D];if(N[D].field.isKeyField()){if(typeof F!="string")throw new en(bt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${w}(), but got a ${typeof F}`);if(!Y5(p)&&F.indexOf("/")!==-1)throw new en(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${w}() must be a plain document ID, but '${F}' contains a slash.`);const z=p.path.child(Zi.fromString(F));if(!An.isDocumentKey(z))throw new en(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${w}() must result in a valid document path, but '${z}' is not because it contains an odd number of segments.`);const q=new An(z);M.push(IO(y,q))}else{const z=Loe(v,w,F);M.push(z)}}return new M0(M,R)}(n._query,n.firestore._databaseId,l,e,i,o)}}function xQ(n,e,i){if(typeof(i=Pi(i))=="string"){if(i==="")throw new en(bt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Y5(e)&&i.indexOf("/")!==-1)throw new en(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Zi.fromString(i));if(!An.isDocumentKey(o))throw new en(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return IO(n,new An(o))}if(i instanceof dc)return IO(n,i._key);throw new en(bt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${WN(i)}.`)}function DQ(n,e){if(!Array.isArray(n)||n.length===0)throw new en(bt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function joe(n,e){const i=function(l,u){for(const p of l)for(const y of p.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new en(bt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new en(bt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class d6e{convertValue(e,i="none"){switch(zg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ao(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Bg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Qn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return Jg(e,(l,u)=>{o[l]=this.convertValue(u,i)}),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[RO].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(p=>ao(p.doubleValue));return new E3(u)}convertGeoPoint(e){return new y3(ao(e.latitude),ao(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=xN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(yR(e));default:return null}}convertTimestamp(e){const i=jg(e);return new Ho(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Zi.fromString(e);wi(ooe(o));const l=new ER(o.get(1),o.get(3)),u=new An(o.popFirst(5));return l.isEqual(i)||Xf(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Boe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zoe extends T3{constructor(e,i,o,l,u,p){super(e,i,o,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Yk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(YN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class Yk extends zoe{data(e={}){return super.data(e)}}class Woe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new SC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new Yk(this._firestore,this._userDataWriter,o.key,o,new SC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new en(bt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(y=>{const v=new Yk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new SC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(y=>u||y.type!==3).map(y=>{const v=new Yk(l._firestore,l._userDataWriter,y.doc.key,y.doc,new SC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let w=-1,C=-1;return y.type!==0&&(w=p.indexOf(y.doc.key),p=p.delete(y.doc.key)),y.type!==1&&(p=p.add(y.doc),C=p.indexOf(y.doc.key)),{type:h6e(y.type),doc:v,oldIndex:w,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function h6e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ko(n){n=Sl(n,dc);const e=Sl(n.firestore,Qf);return YBe(HN(e),n._key).then(i=>Hoe(e,n,i))}class k3 extends d6e{constructor(e){super(),this.firestore=e}convertBytes(e){return new B0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new dc(this.firestore,null,i)}}function id(n){n=Sl(n,Fp);const e=Sl(n.firestore,Qf),i=HN(e),o=new k3(e);return Foe(n._query),XBe(i,n._query).then(l=>new Woe(e,o,n,l))}function Hg(n,e,i){n=Sl(n,dc);const o=Sl(n.firestore,Qf),l=Boe(n.converter,e,i);return QN(o,[xoe(tI(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,rd.none())])}function mo(n,e,i,...o){n=Sl(n,dc);const l=Sl(n.firestore,Qf),u=tI(l);let p;return p=typeof(e=Pi(e))=="string"||e instanceof $N?i6e(u,"updateDoc",n._key,e,i,o):r6e(u,"updateDoc",n._key,e),QN(l,[p.toMutation(n._key,rd.exists(!0))])}function p6e(n){return QN(Sl(n.firestore,Qf),[new J5(n._key,rd.none())])}function f6e(n,e){const i=Sl(n.firestore,Qf),o=br(n),l=Boe(n.converter,e);return QN(i,[xoe(tI(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,rd.exists(!1))]).then(()=>o)}function Goe(n,...e){var i,o,l;n=Pi(n);let u={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||OQ(e[p])||(u=e[p],p++);const y={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(OQ(e[p])){const R=e[p];e[p]=(i=R.next)===null||i===void 0?void 0:i.bind(R),e[p+1]=(o=R.error)===null||o===void 0?void 0:o.bind(R),e[p+2]=(l=R.complete)===null||l===void 0?void 0:l.bind(R)}let v,w,C;if(n instanceof dc)w=Sl(n.firestore,Qf),C=DN(n._key.path),v={next:R=>{e[p]&&e[p](Hoe(w,n,R))},error:e[p+1],complete:e[p+2]};else{const R=Sl(n,Fp);w=Sl(R.firestore,Qf),C=R._query;const N=new k3(w);v={next:M=>{e[p]&&e[p](new Woe(w,N,R,M))},error:e[p+1],complete:e[p+2]},Foe(n._query)}return function(N,M,D,F){const z=new _3(F),q=new f3(M,z,D);return N.asyncQueue.enqueueAndForget(async()=>d3(await LO(N),q)),()=>{z.su(),N.asyncQueue.enqueueAndForget(async()=>h3(await LO(N),q))}}(HN(w),C,y,v)}function QN(n,e){return function(o,l){const u=new Bf;return o.asyncQueue.enqueueAndForget(async()=>UBe(await qBe(o),l,u)),u.promise}(HN(n),e)}function Hoe(n,e,i){const o=i.docs.get(e._key),l=new k3(n);return new zoe(n,l,e._key,o,new SC(i.hasPendingWrites,i.fromCache),e.converter)}function m6e(...n){return new v3("arrayUnion",n)}function $oe(...n){return new S3("arrayRemove",n)}(function(e,i=!0){(function(l){eb=l})(uE),Vg(new Kf("firestore",(o,{instanceIdentifier:l,options:u})=>{const p=o.getProvider("app").getImmediate(),y=new Qf(new a3e(o.getProvider("auth-internal")),new u3e(p,o.getProvider("app-check-internal")),function(w,C){if(!Object.prototype.hasOwnProperty.apply(w.options,["projectId"]))throw new en(bt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ER(w.options.projectId,C)}(p,l),p);return u=Object.assign({useFetchStreams:i},u),y._setSettings(u),y},"PUBLIC").setMultipleInstances(!0)),nd(MJ,UJ,e),nd(MJ,UJ,"esm2017")})();var g6e="firebase",_6e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nd(g6e,_6e,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y6e="type.googleapis.com/google.protobuf.Int64Value",E6e="type.googleapis.com/google.protobuf.UInt64Value";function Koe(n,e){const i={};for(const o in n)n.hasOwnProperty(o)&&(i[o]=e(n[o]));return i}function VO(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>VO(e));if(typeof n=="function"||typeof n=="object")return Koe(n,e=>VO(e));throw new Error("Data cannot be encoded in JSON: "+n)}function z0(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case y6e:case E6e:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>z0(e)):typeof n=="function"||typeof n=="object"?Koe(n,e=>z0(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O3="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LQ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _l extends ph{constructor(e,i,o){super(`${O3}/${e}`,i||""),this.details=o,Object.setPrototypeOf(this,_l.prototype)}}function v6e(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function FO(n,e){let i=v6e(n),o=i,l;try{const u=e&&e.error;if(u){const p=u.status;if(typeof p=="string"){if(!LQ[p])return new _l("internal","internal");i=LQ[p],o=p}const y=u.message;typeof y=="string"&&(o=y),l=u.details,l!==void 0&&(l=z0(l))}}catch{}return i==="ok"?null:new _l(i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S6e{constructor(e,i,o,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,fl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||o.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),o=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:o,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UF="us-central1",b6e=/^data: (.*?)(?:\n|$)/;function w6e(n){let e=null;return{promise:new Promise((i,o)=>{e=setTimeout(()=>{o(new _l("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class T6e{constructor(e,i,o,l,u=UF,p=(...y)=>fetch(...y)){this.app=e,this.fetchImpl=p,this.emulatorOrigin=null,this.contextProvider=new S6e(e,i,o,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(u);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=UF}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function C6e(n,e,i){n.emulatorOrigin=`http://${e}:${i}`}function R6e(n,e,i){const o=l=>A6e(n,e,l,{});return o.stream=(l,u)=>k6e(n,e,l,u),o}async function I6e(n,e,i,o){i["Content-Type"]="application/json";let l;try{l=await o(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function qoe(n,e){const i={},o=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken),i}function A6e(n,e,i,o){const l=n._url(e);return P6e(n,l,i,o)}async function P6e(n,e,i,o){i=VO(i);const l={data:i},u=await qoe(n,o),p=o.timeout||7e4,y=w6e(p),v=await Promise.race([I6e(e,l,u,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!v)throw new _l("cancelled","Firebase Functions instance was deleted.");const w=FO(v.status,v.json);if(w)throw w;if(!v.json)throw new _l("internal","Response is not valid JSON object.");let C=v.json.data;if(typeof C>"u"&&(C=v.json.result),typeof C>"u")throw new _l("internal","Response is missing data field.");return{data:z0(C)}}function k6e(n,e,i,o){const l=n._url(e);return O6e(n,l,i,o||{})}async function O6e(n,e,i,o){var l;i=VO(i);const u={data:i},p=await qoe(n,o);p["Content-Type"]="application/json",p.Accept="text/event-stream";let y;try{y=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:p,signal:o==null?void 0:o.signal})}catch(M){if(M instanceof Error&&M.name==="AbortError"){const F=new _l("cancelled","Request was cancelled.");return{data:Promise.reject(F),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(F)}}}}}}const D=FO(0,null);return{data:Promise.reject(D),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(D)}}}}}}let v,w;const C=new Promise((M,D)=>{v=M,w=D});(l=o==null?void 0:o.signal)===null||l===void 0||l.addEventListener("abort",()=>{const M=new _l("cancelled","Request was cancelled.");w(M)});const R=y.body.getReader(),N=N6e(R,v,w,o==null?void 0:o.signal);return{stream:{[Symbol.asyncIterator](){const M=N.getReader();return{async next(){const{value:D,done:F}=await M.read();return{value:D,done:F}},async return(){return await M.cancel(),{done:!0,value:void 0}}}}},data:C}}function N6e(n,e,i,o){const l=(p,y)=>{const v=p.match(b6e);if(!v)return;const w=v[1];try{const C=JSON.parse(w);if("result"in C){e(z0(C.result));return}if("message"in C){y.enqueue(z0(C.message));return}if("error"in C){const R=FO(0,C);y.error(R),i(R);return}}catch(C){if(C instanceof _l){y.error(C),i(C);return}}},u=new TextDecoder;return new ReadableStream({start(p){let y="";return v();async function v(){if(o!=null&&o.aborted){const w=new _l("cancelled","Request was cancelled");return p.error(w),i(w),Promise.resolve()}try{const{value:w,done:C}=await n.read();if(C){y.trim()&&l(y.trim(),p),p.close();return}if(o!=null&&o.aborted){const N=new _l("cancelled","Request was cancelled");p.error(N),i(N),await n.cancel();return}y+=u.decode(w,{stream:!0});const R=y.split(`
`);y=R.pop()||"";for(const N of R)N.trim()&&l(N.trim(),p);return v()}catch(w){const C=w instanceof _l?w:FO(0,null);p.error(C),i(C)}}},cancel(){return n.cancel()}})}const MQ="@firebase/functions",UQ="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x6e="auth-internal",D6e="app-check-internal",L6e="messaging-internal";function M6e(n){const e=(i,{instanceIdentifier:o})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(x6e),p=i.getProvider(L6e),y=i.getProvider(D6e);return new T6e(l,u,p,y,o)};Vg(new Kf(O3,e,"PUBLIC").setMultipleInstances(!0)),nd(MQ,UQ,n),nd(MQ,UQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U6e(n=CN(),e=UF){const o=HR(Pi(n),O3).getImmediate({identifier:e}),l=x5("functions");return l&&V6e(o,...l),o}function V6e(n,e,i){C6e(Pi(n),e,i)}function N3(n,e,i){return R6e(Pi(n),e)}M6e();const F6e=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],VF=F6e.filter(n=>!n.value);if(VF.length>0){const e=`Missing environment variables: ${VF.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;W.warn(e),console.warn(e)}const j6e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},B6e=VF.length>0;W.log(`Firebase initializing with ${B6e?"fallback":"environment"} configuration`);let dk,x3,Xn,ZN;try{dk=Iie(j6e),x3=PN(dk),Xn=qk(dk),ZN=U6e(dk),W.log("Firebase initialized successfully")}catch(n){W.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const Zu=n=>!0,VQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},bR=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return W.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();W.log(`userFirestore: Checking if username "${e}" is taken`);const i=bl(Xn,"users"),o=UO(i,c6e(100)),l=await id(o);let u=!1;return l.forEach(p=>{const y=p.data();y.username&&y.username.toLowerCase()===e&&(u=!0)}),W.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return W.error("userFirestore: Error checking username availability:",e),!0}},z6e=async(n,e)=>{let i=VQ(n,e),o=0;const l=10;for(;o<l;){if(!await bR(i))return i;i=VQ(n,e),o++}return i+Math.floor(Math.random()*100)},ou=async n=>{try{W.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=br(Xn,"users",n),i=await Ko(e);if(i.exists()){const o=i.data();return W.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return W.error("userFirestore: user profile document not found"),null}catch(e){throw W.error("userFirestore: Error fetching user public profile data:",e),e}},W6e=async(n,e,i)=>{try{if(W.log("userFirestore: Starting registerUser process"),W.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw W.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};W.log("userFirestore: Critical fields captured for registration"),W.log("userFirestore: Creating user auth record");const u=(await zje(x3,n,e)).user;await nse(u),W.log("userFirestore: Verification email sent"),W.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(M=>setTimeout(M,5e3));const p=br(Xn,"users",u.uid),y=await Ko(p);if(y.exists()){W.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const M=y.data(),D={};M.firstName||(D.firstName=o.firstName),M.lastName||(D.lastName=o.lastName),M.Nickname||(D.Nickname=o.Nickname),M.username||(D.username=o.username),M.companyName||(D.companyName=o.companyName),M.linkedInProfile||(D.linkedInProfile=o.linkedInProfile),M.rpmURL||(D.rpmURL=o.rpmURL),Object.keys(D).length>0&&(W.log("userFirestore: Updating document with fields:",Object.keys(D).join(", ")),await mo(p,{...D,lastUpdated:new Date}))}else{W.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Hg(p,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const M=br(Xn,"users",u.uid,"private","data");await Hg(M,{email:u.email,emailVerified:!1})}const v=await Ko(p);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let w=v.data();w.firstName||(w.firstName=o.firstName),w.lastName||(w.lastName=o.lastName),w.Nickname||(w.Nickname=o.Nickname),w.username||(w.username=o.username),w.companyName||(w.companyName=o.companyName);let C=!1,R={};for(const M in o)(!w[M]||w[M]==="")&&(R[M]=o[M],C=!0);(!w.groups||!w.groups.includes("users"))&&(R.groups=w.groups?[...w.groups,"users"]:["users"],C=!0,W.log("userFirestore: Adding user to users group")),C&&(W.log("userFirestore: Updating user document with missing fields"),W.log("userFirestore: Fields being updated:",Object.keys(R).join(", ")),await mo(p,R),w=(await Ko(p)).data());const N={...u,...w,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return W.log("userFirestore: Registration complete, returning user data"),W.log("userFirestore: Fields included in return data:",Object.keys(N).join(", ")),N}catch(o){throw W.error("userFirestore: Error creating user:",o),o}},Yoe=async(n,e)=>{try{W.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=br(Xn,"users",n);await mo(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),W.log("userFirestore: rpmURL updated successfully.")}catch(i){throw W.error("userFirestore: Error updating rpmURL:",i),i}},G6e=async(n,e)=>{try{const i=await ou(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return W.error("userFirestore: Error checking group membership:",i),!1}},H6e=async(n,e)=>{try{if(Zu(e),await bR(e))throw new Error("Username is already taken");const o=br(Xn,"users",n);return await mo(o,{username:e,lastUpdated:new Date}),W.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw W.error("userFirestore: Error updating username:",i),i}};var $6e={};const jO=()=>{const n=typeof process<"u"&&$6e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},K6e=(n,e)=>{if(!jO())return W.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},q6e=(n,e)=>{if(!jO())return W.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},D3=typeof jO=="function"?jO():!1;D3&&W.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const Y6e=async(n,e)=>{if(D3)return K6e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=PN().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],p=`space_${e}_owners`;if(u.includes(p))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return W.error("Error checking space owner permissions:",i),!1}},Xoe=async(n,e)=>{if(D3)return q6e();try{if(W.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return W.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await ou(n);if(W.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(W.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return W.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else W.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=PN().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if(W.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return W.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){W.error("userPermissions: Error checking token claims:",o)}}return W.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return W.error("userPermissions: Error checking if user belongs to group:",i),!1}},X6e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups","isGuest","guestSpaceId","guestSessionStart"],ch={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class J6e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),W.log(`EventBus: Published event '${e}'`)):W.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const lh=new J6e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Joe="firebasestorage.googleapis.com",Qoe="storageBucket",Q6e=2*60*1e3,Z6e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends ph{constructor(e,i,o=0){super(oV(e),`Firebase Storage: ${i} (${oV(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,$s.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return oV(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hs||(Hs={}));function oV(n){return"storage/"+n}function L3(){const n="An unknown error occurred, please check the error payload for server response.";return new $s(Hs.UNKNOWN,n)}function eze(n){return new $s(Hs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function tze(n){return new $s(Hs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function nze(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new $s(Hs.UNAUTHENTICATED,n)}function rze(){return new $s(Hs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ize(n){return new $s(Hs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function sze(){return new $s(Hs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function oze(){return new $s(Hs.CANCELED,"User canceled the upload/download.")}function aze(n){return new $s(Hs.INVALID_URL,"Invalid URL '"+n+"'.")}function cze(n){return new $s(Hs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function lze(){return new $s(Hs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Qoe+"' property when initializing the app?")}function uze(){return new $s(Hs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function dze(){return new $s(Hs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function hze(n){return new $s(Hs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function FF(n){return new $s(Hs.INVALID_ARGUMENT,n)}function Zoe(){return new $s(Hs.APP_DELETED,"The Firebase app was deleted.")}function pze(n){return new $s(Hs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function WC(n,e){return new $s(Hs.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function qT(n){throw new $s(Hs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=nu.makeFromUrl(e,i)}catch{return new nu(e,"")}if(o.path==="")return o;throw cze(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const p="(/(.*))?$",y=new RegExp("^gs://"+l+p,"i"),v={bucket:1,path:3};function w(ce){ce.path_=decodeURIComponent(ce.path)}const C="v[A-Za-z0-9_]+",R=i.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",M=new RegExp(`^https?://${R}/${C}/b/${l}/o${N}`,"i"),D={bucket:1,path:3},F=i===Joe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,z="([^?#]*)",q=new RegExp(`^https?://${F}/${l}/${z}`,"i"),re=[{regex:y,indices:v,postModify:u},{regex:M,indices:D,postModify:w},{regex:q,indices:{bucket:1,path:2},postModify:w}];for(let ce=0;ce<re.length;ce++){const se=re[ce],ge=se.regex.exec(e);if(ge){const X=ge[se.indices.bucket];let J=ge[se.indices.path];J||(J=""),o=new nu(X,J),se.postModify(o);break}}if(o==null)throw aze(e);return o}}class fze{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mze(n,e,i){let o=1,l=null,u=null,p=!1,y=0;function v(){return y===2}let w=!1;function C(...z){w||(w=!0,e.apply(null,z))}function R(z){l=setTimeout(()=>{l=null,n(M,v())},z)}function N(){u&&clearTimeout(u)}function M(z,...q){if(w){N();return}if(z){N(),C.call(null,z,...q);return}if(v()||p){N(),C.call(null,z,...q);return}o<64&&(o*=2);let re;y===1?(y=2,re=0):re=(o+Math.random())*1e3,R(re)}let D=!1;function F(z){D||(D=!0,N(),!w&&(l!==null?(z||(y=2),clearTimeout(l),R(0)):z||(y=1)))}return R(0),u=setTimeout(()=>{p=!0,F(!0)},i),F}function gze(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _ze(n){return n!==void 0}function yze(n){return typeof n=="object"&&!Array.isArray(n)}function M3(n){return typeof n=="string"||n instanceof String}function FQ(n){return U3()&&n instanceof Blob}function U3(){return typeof Blob<"u"}function jQ(n,e,i,o){if(o<e)throw FF(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw FF(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ex(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function eae(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var Yy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Yy||(Yy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eze(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vze{constructor(e,i,o,l,u,p,y,v,w,C,R,N=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=p,this.callback_=y,this.errorCallback_=v,this.timeout_=w,this.progressCallback_=C,this.connectionFactory_=R,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((M,D)=>{this.resolve_=M,this.reject_=D,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new hk(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const p=y=>{const v=y.loaded,w=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,w)};this.progressCallback_!==null&&u.addUploadProgressListener(p),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(p),this.pendingConnection_=null;const y=u.getErrorCode()===Yy.NO_ERROR,v=u.getStatus();if(!y||Eze(v,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===Yy.ABORT;o(!1,new hk(!1,null,C));return}const w=this.successCodes_.indexOf(v)!==-1;o(!0,new hk(w,u))})},i=(o,l)=>{const u=this.resolve_,p=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());_ze(v)?u(v):u()}catch(v){p(v)}else if(y!==null){const v=L3();v.serverResponse=y.getErrorText(),this.errorCallback_?p(this.errorCallback_(y,v)):p(v)}else if(l.canceled){const v=this.appDelete_?Zoe():oze();p(v)}else{const v=sze();p(v)}};this.canceled_?i(!1,new hk(!1,null,!0)):this.backoffId_=mze(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&gze(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class hk{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function Sze(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function bze(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function wze(n,e){e&&(n["X-Firebase-GMPID"]=e)}function Tze(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Cze(n,e,i,o,l,u,p=!0){const y=eae(n.urlParams),v=n.url+y,w=Object.assign({},n.headers);return wze(w,e),Sze(w,i),bze(w,u),Tze(w,o),new vze(v,n.method,w,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rze(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Ize(...n){const e=Rze();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(U3())return new Blob(n);throw new $s(Hs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Aze(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pze(n){if(typeof atob>"u")throw hze("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class aV{constructor(e,i){this.data=e,this.contentType=i||null}}function kze(n,e){switch(n){case wp.RAW:return new aV(tae(e));case wp.BASE64:case wp.BASE64URL:return new aV(nae(n,e));case wp.DATA_URL:return new aV(Nze(e),xze(e))}throw L3()}function tae(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,p=n.charCodeAt(++i);o=65536|(u&1023)<<10|p&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function Oze(n){let e;try{e=decodeURIComponent(n)}catch{throw WC(wp.DATA_URL,"Malformed data URL.")}return tae(e)}function nae(n,e){switch(n){case wp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw WC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case wp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw WC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Pze(e)}catch(l){throw l.message.includes("polyfill")?l:WC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class rae{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw WC(wp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=Dze(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function Nze(n){const e=new rae(n);return e.base64?nae(wp.BASE64,e.rest):Oze(e.rest)}function xze(n){return new rae(n).contentType}function Dze(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,i){let o=0,l="";FQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(FQ(this.data_)){const o=this.data_,l=Aze(o,e,i);return l===null?null:new wg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new wg(o,!0)}}static getBlob(...e){if(U3()){const i=e.map(o=>o instanceof wg?o.data_:o);return new wg(Ize.apply(null,i))}else{const i=e.map(p=>M3(p)?kze(wp.RAW,p).data:p.data_);let o=0;i.forEach(p=>{o+=p.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(p=>{for(let y=0;y<p.length;y++)l[u++]=p[y]}),new wg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iae(n){let e;try{e=JSON.parse(n)}catch{return null}return yze(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lze(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Mze(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function sae(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uze(n,e){return e}class kc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||Uze}}let pk=null;function Vze(n){return!M3(n)||n.length<2?n:sae(n)}function oae(){if(pk)return pk;const n=[];n.push(new kc("bucket")),n.push(new kc("generation")),n.push(new kc("metageneration")),n.push(new kc("name","fullPath",!0));function e(u,p){return Vze(p)}const i=new kc("name");i.xform=e,n.push(i);function o(u,p){return p!==void 0?Number(p):p}const l=new kc("size");return l.xform=o,n.push(l),n.push(new kc("timeCreated")),n.push(new kc("updated")),n.push(new kc("md5Hash",null,!0)),n.push(new kc("cacheControl",null,!0)),n.push(new kc("contentDisposition",null,!0)),n.push(new kc("contentEncoding",null,!0)),n.push(new kc("contentLanguage",null,!0)),n.push(new kc("contentType",null,!0)),n.push(new kc("metadata","customMetadata",!0)),pk=n,pk}function Fze(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new nu(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function jze(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const p=i[u];o[p.local]=p.xform(o,e[p.server])}return Fze(o,n),o}function aae(n,e,i){const o=iae(e);return o===null?null:jze(n,o,i)}function Bze(n,e,i,o){const l=iae(e);if(l===null||!M3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const p=encodeURIComponent;return u.split(",").map(w=>{const C=n.bucket,R=n.fullPath,N="/b/"+p(C)+"/o/"+p(R),M=ex(N,i,o),D=eae({alt:"media",token:w});return M+D})[0]}function zze(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class V3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cae(n){if(!n)throw L3()}function Wze(n,e){function i(o,l){const u=aae(n,l,e);return cae(u!==null),u}return i}function Gze(n,e){function i(o,l){const u=aae(n,l,e);return cae(u!==null),Bze(u,l,n.host,n._protocol)}return i}function lae(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=rze():l=nze():i.getStatus()===402?l=tze(n.bucket):i.getStatus()===403?l=ize(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function uae(n){const e=lae(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=eze(n.path)),u.serverResponse=l.serverResponse,u}return i}function Hze(n,e,i){const o=e.fullServerUrl(),l=ex(o,n.host,n._protocol),u="GET",p=n.maxOperationRetryTime,y=new V3(l,u,Gze(n,i),p);return y.errorHandler=uae(e),y}function $ze(n,e){const i=e.fullServerUrl(),o=ex(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function p(v,w){}const y=new V3(o,l,p,u);return y.successCodes=[200,204],y.errorHandler=uae(e),y}function Kze(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function qze(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=Kze(null,e)),o}function Yze(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function y(){let re="";for(let ce=0;ce<2;ce++)re=re+Math.random().toString().slice(2);return re}const v=y();p["Content-Type"]="multipart/related; boundary="+v;const w=qze(e,o,l),C=zze(w,i),R="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+v+`\r
Content-Type: `+w.contentType+`\r
\r
`,N=`\r
--`+v+"--",M=wg.getBlob(R,o,N);if(M===null)throw uze();const D={name:w.fullPath},F=ex(u,n.host,n._protocol),z="POST",q=n.maxUploadRetryTime,K=new V3(F,z,Wze(n,i),q);return K.urlParams=D,K.headers=p,K.body=M.uploadData(),K.errorHandler=lae(e),K}class Xze{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Yy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Yy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Yy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw qT("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw qT("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw qT("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw qT("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw qT("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class Jze extends Xze{initXhr(){this.xhr_.responseType="text"}}function F3(){return new Jze}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,i){this._service=e,i instanceof nu?this._location=i:this._location=nu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new oE(e,i)}get root(){const e=new nu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return sae(this._location.path)}get storage(){return this._service}get parent(){const e=Lze(this._location.path);if(e===null)return null;const i=new nu(this._location.bucket,e);return new oE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw pze(e)}}function Qze(n,e,i){n._throwIfRoot("uploadBytes");const o=Yze(n.storage,n._location,oae(),new wg(e,!0),i);return n.storage.makeRequestWithTokens(o,F3).then(l=>({metadata:l,ref:n}))}function Zze(n){n._throwIfRoot("getDownloadURL");const e=Hze(n.storage,n._location,oae());return n.storage.makeRequestWithTokens(e,F3).then(i=>{if(i===null)throw dze();return i})}function e8e(n){n._throwIfRoot("deleteObject");const e=$ze(n.storage,n._location);return n.storage.makeRequestWithTokens(e,F3)}function t8e(n,e){const i=Mze(n._location.path,e),o=new nu(n._location.bucket,i);return new oE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n8e(n){return/^[A-Za-z]+:\/\//.test(n)}function r8e(n,e){return new oE(n,e)}function dae(n,e){if(n instanceof j3){const i=n;if(i._bucket==null)throw lze();const o=new oE(i,i._bucket);return e!=null?dae(o,e):o}else return e!==void 0?t8e(n,e):n}function i8e(n,e){if(e&&n8e(e)){if(n instanceof j3)return r8e(n,e);throw FF("To use ref(service, url), the first argument must be a Storage instance.")}else return dae(n,e)}function BQ(n,e){const i=e==null?void 0:e[Qoe];return i==null?null:nu.makeFromBucketSpec(i,n)}function s8e(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:Tie(l,n.app.options.projectId))}class j3{constructor(e,i,o,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=Joe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Q6e,this._maxUploadRetryTime=Z6e,this._requests=new Set,l!=null?this._bucket=nu.makeFromBucketSpec(l,this._host):this._bucket=BQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=nu.makeFromBucketSpec(this._url,e):this._bucket=BQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(fl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new oE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new fze(Zoe());{const p=Cze(e,this._appId,o,l,i,this._firebaseVersion,u);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const zQ="@firebase/storage",WQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hae="storage";function B3(n,e,i){return n=Pi(n),Qze(n,e,i)}function tx(n){return n=Pi(n),Zze(n)}function z3(n){return n=Pi(n),e8e(n)}function mE(n,e){return n=Pi(n),i8e(n,e)}function gE(n=CN(),e){n=Pi(n);const o=HR(n,hae).getImmediate({identifier:e}),l=x5("storage");return l&&o8e(o,...l),o}function o8e(n,e,i,o={}){s8e(n,e,i,o)}function a8e(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new j3(i,o,l,e,uE)}function c8e(){Vg(new Kf(hae,a8e,"PUBLIC").setMultipleInstances(!0)),nd(zQ,WQ,""),nd(zQ,WQ,"esm2017")}c8e();const Xk=async n=>{const e=gE(),i=mE(e,n);try{return await tx(i)}catch(o){throw W.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let jF={};const Ua=async n=>{try{const e=br(Xn,"spaces",n),i=await Ko(e);if(i.exists()){let o=i.data();const l=o.name,u=o.description;if(o.webglBuildId){const p=br(Xn,"webglBuilds",o.webglBuildId),y=await Ko(p);if(y.exists()){const v=y.data();o={...o,...v,name:l||v.name,description:u||v.description}}else W.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await l8e(o),o=u8e(o),console.log("Space data:",o),W.log(`spacesFirestore: Caching space data for: ${n}`),jF[n]=o,o}else return W.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw W.error("spacesFirestore: Error fetching item data:",e),e}},l8e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await Xk(l))});return await Promise.all(i),n},u8e=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let cV={};const pae=async n=>{W.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(cV[n])return W.log("spacesFirestore: Returning cached videos for space:",n),cV[n];const e=bl(Xn,`spaces/${n}/videos`),i=await id(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),cV[n]=o,o}catch(e){throw W.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},d8e=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=gE(),o=Date.now(),l=e.name.split(".").pop(),u=`logo_${o}.${l}`,p=mE(i,`spaces/${n}/logo/${u}`);W.log(`Uploading logo for space ${n}`);const y=await B3(p,e),v=await tx(y.ref),w=br(Xn,"spaces",n);return await mo(w,{logoUrl:v,logoGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),W.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw W.error("Error uploading space logo:",i),i}},h8e=async n=>{try{const e=br(Xn,"spaces",n),i=await Ko(e);if(!i.exists())return W.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=gE(),u=mE(l,o.logoGsUrl);try{await z3(u),W.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(p){W.warn(`Could not delete logo file from storage: ${p.message}`)}}return await mo(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),W.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw W.error("Error deleting space logo:",e),e}},p8e=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=gE(),o=Date.now(),l=e.name.split(".").pop(),u=`background_${o}.${l}`,p=mE(i,`spaces/${n}/background/${u}`);W.log(`Uploading background for space ${n}`);const y=await B3(p,e),v=await tx(y.ref),w=br(Xn,"spaces",n);return await mo(w,{backgroundUrl:v,backgroundGsUrl:`gs://${y.ref.bucket}/${y.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${y.ref.bucket}/${y.ref.fullPath}`,updatedAt:new Date().toISOString()}),W.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw W.error("Error uploading space background:",i),i}},f8e=async n=>{try{const e=br(Xn,"spaces",n),i=await Ko(e);if(!i.exists())return W.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=gE(),u=mE(l,o.backgroundGsUrl);try{await z3(u),W.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(p){W.warn(`Could not delete background file from storage: ${p.message}`)}}return await mo(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),W.log(`Successfully removed background for space ${n}`),!0}catch(e){throw W.error("Error deleting space background:",e),e}},m8e=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=br(Xn,`spaces/${n}/BannedUsers`,e.uid),o=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,p])=>(p!==void 0&&(l[u]=p),l),{});await Hg(i,o);try{const l=br(Xn,"users",e.uid),u=await Ko(l);if(u.exists()){const p=u.data(),y=Array.isArray(p.groups)?p.groups:[],v=`space_${n}_banned`;y.includes(v)||await mo(l,{groups:[...y,v]})}}catch(l){W.error("spacesFirestore: failed to add banned group to user",l)}return W.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw W.error("spacesFirestore: Error adding banned user:",i),i}},GC=async(n,e)=>{try{W.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=br(Xn,"spaces",n);return await mo(i,{...e,updatedAt:new Date().toISOString()}),jF[n]&&delete jF[n],!0}catch(i){throw W.error("spacesFirestore: Error updating space settings:",i),i}},g8e=async(n,e)=>GC(n,{accessibleToAllUsers:e}),BF=async(n,e)=>GC(n,{HLSStreamURL:e}),fae=async n=>{try{const e=br(Xn,"spaces",n),i=await Ko(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw W.error("spacesFirestore: Error getting HLS stream:",e),e}},_8e=async(n,e)=>(W.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),y8e=async n=>(W.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),E8e=["https://models.readyplayer.me/682b6c39994f7261dd46350d.glb","https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb","https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb","https://models.readyplayer.me/67c884144c4878c55e515ff5.glb","https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb","https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb","https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb","https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb","https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb","https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb"],v8e=()=>Math.floor(1e3+Math.random()*9e3).toString(),S8e=()=>`Visitor_${v8e()}`,b8e=()=>E8e[0],w8e=()=>{const n=Date.now(),e=Math.floor(Math.random()*1e4);return`guest_${n}_${e}`},GQ=n=>{const e=w8e(),i=S8e(),o=b8e(),l=new Date().toISOString(),u={uid:e,email:null,emailVerified:!1,name:i,username:i,Nickname:i,displayName:i,firstName:"Guest",lastName:"User",companyName:"",linkedInProfile:"",rpmURL:o,groups:["guests"],created_on:l,isGuest:!0,guestSpaceId:n,guestSessionStart:l,height_cm:null};return W.log("guestUserGenerator: Created guest user:",{uid:e,username:i,rpmURL:o,spaceId:n}),W.log("guestUserGenerator: FULL guest user object:",u),W.log("guestUserGenerator: Environment check - window.location:",window.location.href),W.log("guestUserGenerator: Nickname field:",u.Nickname),W.log("guestUserGenerator: rpmURL field:",u.rpmURL),u},T8e=n=>n&&(n.isGuest===!0||n.uid&&n.uid.startsWith("guest_")),ts=O.createContext(null),mae=O.createContext(null),nx=({children:n})=>{const[e,i]=O.useState(null),o=O.useRef(null),[l,u]=O.useState(!0),[p,y]=O.useState(!1),[v,w]=O.useState(null),C=O.useRef(null),R=PN(),N=ve=>ve?ve.Nickname?ve.Nickname:`${ve.firstName} ${ve.lastName}`:"Anon",M=async()=>{try{const ve=D();if(!ve){W.log("UserProvider: No space ID found, skipping guest user creation");return}if(v&&v.guestSpaceId===ve){W.log("UserProvider: Guest user already exists for this space");return}try{const Fe=await Ua(ve);if(!Fe){W.log("UserProvider: Space data not found, denying guest access");return}if(!Fe.allowGuestUsers){W.log("UserProvider: Guest users explicitly not allowed for this space");return}W.log("UserProvider: Guest users confirmed allowed for space:",ve)}catch{W.log("UserProvider: Cannot verify space guest settings, denying guest access for security");return}const Te=GQ(ve);w(Te),C.current=Te,W.log("UserProvider: Created guest user:",Te.username),K(Te)}catch(ve){W.error("UserProvider: Error creating guest user:",ve)}},D=()=>{try{const ve=document.getElementById("webgl-root");if(ve){const Ee=ve.getAttribute("data-space-id");if(Ee)return W.log("UserProvider: Found space ID from webgl-root element:",Ee),Ee}const Te=window.location.href,Fe=window.location.pathname,be=window.location.search;W.log("UserProvider: No space ID in DOM element, trying URL extraction"),W.log("UserProvider: URL:",Te);const Re=Fe.match(/\/(w|embed)\/([^\/]+)/);if(Re)return W.log("UserProvider: Found space ID from path pattern:",Re[2]),Re[2];const Ae=new URLSearchParams(be),xe=Ae.get("spaceId")||Ae.get("space");return xe?(W.log("UserProvider: Found space ID from URL params:",xe),xe):Te.includes("localhost")||Te.includes("web.app")||Te.includes("firebaseapp.com")?(W.log("UserProvider: Using default space ID for development/hosting"),"SpacesMetaverse_SDK"):(W.log("UserProvider: No space ID found"),null)}catch(ve){return W.error("UserProvider: Error getting space ID:",ve),null}};O.useEffect(()=>{const ve=$je(R,async Te=>{if(W.log("UserProvider: Firebase onAuthStateChanged() fired"),Te)try{const Fe=await ou(Te.uid),be=N(Fe),Re={uid:Te.uid,email:Te.email,emailVerified:Te.emailVerified,...Fe,displayName:be};W.log(`UserProvider: User authenticated: ${Te.uid}`),i(Re),o.current=Re,K(Re)}catch(Fe){W.error("UserProvider: Error fetching user profile data:",Fe)}else i(null),o.current=null,await M();u(!1)});return()=>{ve&&ve()}},[]);const F=async(ve,Te,Fe)=>{try{y(!0),W.log("UserProvider: Starting registration process"),W.log("UserProvider: Registration includes fields:",Object.keys(Fe||{}).join(", "));const be={...Fe},Re=["firstName","lastName","username","companyName","linkedInProfile"],Ae=Re.filter(_t=>!be[_t]);Ae.length>0&&W.warn(`UserProvider: Registration missing fields: ${Ae.join(", ")}`);const xe=be.firstName&&be.lastName?`${be.firstName}${be.lastName.charAt(0).toUpperCase()}`:"";W.log("UserProvider: Generated default nickname for registration");const Ee={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:be.Nickname||xe,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...be};W.log("UserProvider: Prepared registration data with fields:",Object.keys(Ee).join(", "));const Ne=await W6e(ve,Te,Ee);W.log("UserProvider: Registration successful, received user data");const je=Re.filter(_t=>!Ne[_t]);je.length>0&&W.warn(`UserProvider: Returned user data missing fields: ${je.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(_t=>{Ne[_t]||(W.warn(`UserProvider: ${_t} is missing in returned data, using original value`),Ne[_t]=Ee[_t])});const at={uid:Ne.uid,email:Ne.email,...Ne,displayName:N(Ne)};return W.log("UserProvider: Created user object with fields:",Object.keys(at).join(", ")),i(at),o.current=at,W.log("UserProvider: User registered successfully with groups:",Ee.groups),await new Promise(_t=>setTimeout(_t,2e3)),y(!1),at}catch(be){throw y(!1),W.error("UserProvider: Error during registration:",be),be}},z=async(ve,Te,Fe)=>{try{if(W.log("UserProvider: Signing in user"),!Fe)throw new Error("CAPTCHA verification is required");const Re=(await Wje(R,ve,Te)).user;return W.log("UserProvider: User signed in successfully:",Re.email),Re}catch(be){throw W.error("UserProvider: Error signing in:",be),be}},q=async()=>{try{await Kje(R),i(null),W.log("UserProvider: User signed out.")}catch(ve){throw W.error("UserProvider: Error signing out:",ve),ve}},K=async(ve=null)=>{let Te=ve||o.current||C.current;if(!Te&&!ve&&(W.log("UserProvider: No user available, attempting to create guest user for Unity request"),await M(),Te=C.current),Te){const Fe=re(Te);W.log("UserProvider: sendUserToUnity() - Raw user data:",{uid:Te.uid,username:Te.username,Nickname:Te.Nickname,displayName:Te.displayName,rpmURL:Te.rpmURL,isGuest:Te.isGuest||!1}),W.log("UserProvider: sendUserToUnity() - Filtered data being sent to Unity:",Fe),Te.isGuest&&(W.log("UserProvider: GUEST USER - Verifying required fields:"),W.log("UserProvider: GUEST - Nickname in filtered data:",Fe.Nickname),W.log("UserProvider: GUEST - rpmURL in filtered data:",Fe.rpmURL),W.log("UserProvider: GUEST - uid in filtered data:",Fe.uid),(!Fe.Nickname||!Fe.rpmURL)&&(W.error("UserProvider: GUEST USER MISSING REQUIRED FIELDS!"),W.error("UserProvider: Missing Nickname:",!Fe.Nickname),W.error("UserProvider: Missing rpmURL:",!Fe.rpmURL))),lh.publish(ch.sendUserToUnity,Fe)}else W.log("UserProvider: No current user or guest user to send to Unity.")},re=ve=>{const Te={},Fe=[...X6e,"uid"];return W.log("UserProvider: Properties to send to Unity:",Fe),W.log("UserProvider: Available properties in user object:",Object.keys(ve)),Fe.forEach(be=>{ve.hasOwnProperty(be)?(Te[be]=ve[be],W.log(`UserProvider: Including field '${be}' with value:`,ve[be])):W.log(`UserProvider: Field '${be}' not found in user object`)}),W.log("UserProvider: Final filtered user object:",Te),Te},ce=async ve=>!e||!e.uid?!1:await Xoe(e.uid,ve),se=async ve=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${ve}_banned`)?!0:(await Ko(br(Xn,`spaces/${ve}/BannedUsers`,e.uid))).exists()}catch(Te){return Te.code!=="permission-denied"&&W.error("UserProvider: isUserBannedFromSpace error:",Te),!1}},ge=async ve=>{if(!e||!e.uid)return!1;try{if(await se(ve))return W.warn(`UserProvider: User ${e.uid} banned from ${ve}`),!1;const Te=await Ua(ve);if(Te.usersAllowed.includes(e.uid)||Te.userAdmin.includes(e.uid)||Te.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const be=`space_${ve}_owners`,Re=`space_${ve}_hosts`;if(e.groups.includes(be)||e.groups.includes(Re))return W.log(`UserProvider: User ${e.uid} has access to space ${ve} as owner/host`),!0}return Te.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Te){return W.error("UserProvider: Error verifying user access to space:",Te),!1}},X=async ve=>{if(!e||!e.uid)return!1;try{return(await Ua(ve)).userAdmin.includes(e.uid)}catch(Te){return W.error("UserProvider: Error verifying user admin status for space:",Te),!1}},J=async ve=>{if(!e||!e.uid)return!1;try{return(await Ua(ve)).usersModerators.includes(e.uid)}catch(Te){return W.error("UserProvider: Error verifying user moderator status for space:",Te),!1}},te=async()=>{try{const ve=R.currentUser;return ve&&!ve.emailVerified?(await nse(ve),W.log("UserProvider: Verification email resent to:",ve.email),!0):!1}catch(ve){throw W.error("UserProvider: Error resending verification email:",ve),ve}},ne=async()=>{try{const ve=R.currentUser;if(!ve)return W.warn("UserProvider: updateUser called but no current user exists"),null;W.log("UserProvider: Updating user data from Firestore");const Te=await ou(ve.uid);if(!Te)return W.error("UserProvider: Failed to fetch updated user profile"),null;const Fe=N(Te),be={uid:ve.uid,email:ve.email,emailVerified:ve.emailVerified,...Te,displayName:Fe};return W.log("UserProvider: User data updated with fields:",Object.keys(be).join(", ")),i(be),o.current=be,K(be),be}catch(ve){throw W.error("UserProvider: Error updating user data:",ve),ve}},de=()=>e||v,pe=async ve=>{try{const Te=GQ(ve);return w(Te),C.current=Te,K(Te),Te}catch(Te){throw W.error("UserProvider: Error creating manual guest user:",Te),Te}},he=()=>{w(null),C.current=null,W.log("UserProvider: Guest user cleared")};return S.jsx(mae.Provider,{value:{registrationInProgress:p},children:S.jsx(ts.Provider,{value:{user:e,guestUser:v,currentUser:de(),loading:l,register:F,signIn:z,signOut:q,sendUserToUnity:K,isUserInGroup:ce,userHasAccessToSpace:ge,userIsAdminOfSpace:X,userIsModeratorOfSpace:J,resendVerificationEmail:te,updateUser:ne,isUserBannedFromSpace:se,createGuestUser:pe,clearGuestUser:he,isGuestUser:ve=>T8e(ve||de())},children:n})})},C8e=()=>{const n=O.useContext(mae);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},gae=O.createContext(),fh=()=>O.useContext(gae),W3=({children:n})=>{const[e,i]=O.useState(!1),o=O.useRef(null),[l,u]=O.useState(!1);O.useEffect(()=>{const v=()=>{const w=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(w)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const p=O.useCallback(v=>{o.current=v},[]),y=O.useCallback(()=>{const v=o.current;if(!v)return;const w=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(R){console.error("iOS fullscreen error:",R)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(R){console.error("iOS fallback fullscreen error:",R)}}if(/Android/i.test(navigator.userAgent))try{w?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(R){console.error("Android fullscreen error:",R)}}try{w?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return O.useEffect(()=>{const v=()=>{const w=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!w)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),S.jsx(gae.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:o,setFullscreenRef:p,isMobile:l},children:S.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},R8e=qg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),I8e=qg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),A8e=qg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),_ae=qg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),HQ=qg({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),P8e=qg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),k8e=qg({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),O8e=qg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var nI=n=>n.type==="checkbox",My=n=>n instanceof Date,Nc=n=>n==null;const yae=n=>typeof n=="object";var po=n=>!Nc(n)&&!Array.isArray(n)&&yae(n)&&!My(n),N8e=n=>po(n)&&n.target?nI(n.target)?n.target.checked:n.target.value:n,x8e=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,D8e=(n,e)=>n.has(x8e(e)),L8e=n=>{const e=n.constructor&&n.constructor.prototype;return po(e)&&e.hasOwnProperty("isPrototypeOf")},G3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Xu(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(G3&&(n instanceof Blob||o))&&(i||po(n)))if(e=i?[]:{},!i&&!L8e(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Xu(n[l]));else return n;return e}var rx=n=>Array.isArray(n)?n.filter(Boolean):[],wo=n=>n===void 0,_n=(n,e,i)=>{if(!e||!po(n))return i;const o=rx(e.split(/[,[\].]+?/)).reduce((l,u)=>Nc(l)?l:l[u],n);return wo(o)||o===n?wo(n[e])?i:n[e]:o},pp=n=>typeof n=="boolean",H3=n=>/^\w*$/.test(n),Eae=n=>rx(n.replace(/["|']|\]/g,"").split(/\.|\[/)),cs=(n,e,i)=>{let o=-1;const l=H3(e)?[e]:Eae(e),u=l.length,p=u-1;for(;++o<u;){const y=l[o];let v=i;if(o!==p){const w=n[y];v=po(w)||Array.isArray(w)?w:isNaN(+l[o+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}return n};const $Q={BLUR:"blur",FOCUS_OUT:"focusout"},ah={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};bi.createContext(null);var M8e=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const p=u;return e._proxyFormState[p]!==ah.all&&(e._proxyFormState[p]=!o||ah.all),n[p]}});return l},dl=n=>po(n)&&!Object.keys(n).length,U8e=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return dl(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(p=>e[p]===ah.all)},Jk=n=>Array.isArray(n)?n:[n];function V8e(n){const e=bi.useRef(n);e.current=n,bi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var Tp=n=>typeof n=="string",F8e=(n,e,i,o,l)=>Tp(n)?(o&&e.watch.add(n),_n(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),_n(i,u))):(o&&(e.watchAll=!0),i),j8e=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},KQ=n=>({isOnSubmit:!n||n===ah.onSubmit,isOnBlur:n===ah.onBlur,isOnChange:n===ah.onChange,isOnAll:n===ah.all,isOnTouch:n===ah.onTouched}),qQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const HC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=_n(n,l);if(u){const{_f:p,...y}=u;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!o)return!0;if(p.ref&&e(p.ref,p.name)&&!o)return!0;if(HC(y,e))break}else if(po(y)&&HC(y,e))break}}};var B8e=(n,e,i)=>{const o=Jk(_n(n,i));return cs(o,"root",e[i]),cs(n,i,o),n},$3=n=>n.type==="file",vp=n=>typeof n=="function",BO=n=>{if(!G3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Qk=n=>Tp(n),K3=n=>n.type==="radio",zO=n=>n instanceof RegExp;const YQ={value:!1,isValid:!1},XQ={value:!0,isValid:!0};var vae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!wo(n[0].attributes.value)?wo(n[0].value)||n[0].value===""?XQ:{value:n[0].value,isValid:!0}:XQ:YQ}return YQ};const JQ={isValid:!1,value:null};var Sae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,JQ):JQ;function QQ(n,e,i="validate"){if(Qk(n)||Array.isArray(n)&&n.every(Qk)||pp(n)&&!n)return{type:i,message:Qk(n)?n:"",ref:e}}var OS=n=>po(n)&&!zO(n)?n:{value:n,message:""},ZQ=async(n,e,i,o,l,u)=>{const{ref:p,refs:y,required:v,maxLength:w,minLength:C,min:R,max:N,pattern:M,validate:D,name:F,valueAsNumber:z,mount:q}=n._f,K=_n(i,F);if(!q||e.has(F))return{};const re=y?y[0]:p,ce=pe=>{l&&re.reportValidity&&(re.setCustomValidity(pp(pe)?"":pe||""),re.reportValidity())},se={},ge=K3(p),X=nI(p),J=ge||X,te=(z||$3(p))&&wo(p.value)&&wo(K)||BO(p)&&p.value===""||K===""||Array.isArray(K)&&!K.length,ne=j8e.bind(null,F,o,se),de=(pe,he,ve,Te=Cf.maxLength,Fe=Cf.minLength)=>{const be=pe?he:ve;se[F]={type:pe?Te:Fe,message:be,ref:p,...ne(pe?Te:Fe,be)}};if(u?!Array.isArray(K)||!K.length:v&&(!J&&(te||Nc(K))||pp(K)&&!K||X&&!vae(y).isValid||ge&&!Sae(y).isValid)){const{value:pe,message:he}=Qk(v)?{value:!!v,message:v}:OS(v);if(pe&&(se[F]={type:Cf.required,message:he,ref:re,...ne(Cf.required,he)},!o))return ce(he),se}if(!te&&(!Nc(R)||!Nc(N))){let pe,he;const ve=OS(N),Te=OS(R);if(!Nc(K)&&!isNaN(K)){const Fe=p.valueAsNumber||K&&+K;Nc(ve.value)||(pe=Fe>ve.value),Nc(Te.value)||(he=Fe<Te.value)}else{const Fe=p.valueAsDate||new Date(K),be=xe=>new Date(new Date().toDateString()+" "+xe),Re=p.type=="time",Ae=p.type=="week";Tp(ve.value)&&K&&(pe=Re?be(K)>be(ve.value):Ae?K>ve.value:Fe>new Date(ve.value)),Tp(Te.value)&&K&&(he=Re?be(K)<be(Te.value):Ae?K<Te.value:Fe<new Date(Te.value))}if((pe||he)&&(de(!!pe,ve.message,Te.message,Cf.max,Cf.min),!o))return ce(se[F].message),se}if((w||C)&&!te&&(Tp(K)||u&&Array.isArray(K))){const pe=OS(w),he=OS(C),ve=!Nc(pe.value)&&K.length>+pe.value,Te=!Nc(he.value)&&K.length<+he.value;if((ve||Te)&&(de(ve,pe.message,he.message),!o))return ce(se[F].message),se}if(M&&!te&&Tp(K)){const{value:pe,message:he}=OS(M);if(zO(pe)&&!K.match(pe)&&(se[F]={type:Cf.pattern,message:he,ref:p,...ne(Cf.pattern,he)},!o))return ce(he),se}if(D){if(vp(D)){const pe=await D(K,i),he=QQ(pe,re);if(he&&(se[F]={...he,...ne(Cf.validate,he.message)},!o))return ce(he.message),se}else if(po(D)){let pe={};for(const he in D){if(!dl(pe)&&!o)break;const ve=QQ(await D[he](K,i),re,he);ve&&(pe={...ve,...ne(he,ve.message)},ce(ve.message),o&&(se[F]=pe))}if(!dl(pe)&&(se[F]={ref:re,...pe},!o))return se}}return ce(!0),se};function z8e(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=wo(n)?o++:n[e[o++]];return n}function W8e(n){for(const e in n)if(n.hasOwnProperty(e)&&!wo(n[e]))return!1;return!0}function Fo(n,e){const i=Array.isArray(e)?e:H3(e)?[e]:Eae(e),o=i.length===1?n:z8e(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(po(o)&&dl(o)||Array.isArray(o)&&W8e(o))&&Fo(n,i.slice(0,-1)),n}var lV=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},zF=n=>Nc(n)||!yae(n);function Tg(n,e){if(zF(n)||zF(e))return n===e;if(My(n)&&My(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const u=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const p=e[l];if(My(u)&&My(p)||po(u)&&po(p)||Array.isArray(u)&&Array.isArray(p)?!Tg(u,p):u!==p)return!1}}return!0}var bae=n=>n.type==="select-multiple",G8e=n=>K3(n)||nI(n),uV=n=>BO(n)&&n.isConnected,wae=n=>{for(const e in n)if(vp(n[e]))return!0;return!1};function WO(n,e={}){const i=Array.isArray(n);if(po(n)||i)for(const o in n)Array.isArray(n[o])||po(n[o])&&!wae(n[o])?(e[o]=Array.isArray(n[o])?[]:{},WO(n[o],e[o])):Nc(n[o])||(e[o]=!0);return e}function Tae(n,e,i){const o=Array.isArray(n);if(po(n)||o)for(const l in n)Array.isArray(n[l])||po(n[l])&&!wae(n[l])?wo(e)||zF(i[l])?i[l]=Array.isArray(n[l])?WO(n[l],[]):{...WO(n[l])}:Tae(n[l],Nc(e)?{}:e[l],i[l]):i[l]=!Tg(n[l],e[l]);return i}var YT=(n,e)=>Tae(n,e,WO(e)),Cae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>wo(n)?n:e?n===""?NaN:n&&+n:i&&Tp(n)?new Date(n):o?o(n):n;function dV(n){const e=n.ref;return $3(e)?e.files:K3(e)?Sae(n.refs).value:bae(e)?[...e.selectedOptions].map(({value:i})=>i):nI(e)?vae(n.refs).value:Cae(wo(e.value)?n.ref.value:e.value,n)}var H8e=(n,e,i,o)=>{const l={};for(const u of n){const p=_n(e,u);p&&cs(l,u,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},XT=n=>wo(n)?n:zO(n)?n.source:po(n)?zO(n.value)?n.value.source:n.value:n;const eZ="AsyncFunction";var $8e=n=>!!n&&!!n.validate&&!!(vp(n.validate)&&n.validate.constructor.name===eZ||po(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===eZ)),K8e=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function tZ(n,e,i){const o=_n(n,i);if(o||H3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),p=_n(e,u),y=_n(n,u);if(p&&!Array.isArray(p)&&i!==u)return{name:i};if(y&&y.type)return{name:u,error:y};l.pop()}return{name:i}}var q8e=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,Y8e=(n,e)=>!rx(_n(n,e)).length&&Fo(n,e);const X8e={mode:ah.onSubmit,reValidateMode:ah.onChange,shouldFocusError:!0};function J8e(n={}){let e={...X8e,...n},i={submitCount:0,isDirty:!1,isLoading:vp(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=po(e.defaultValues)||po(e.values)?Xu(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:Xu(l),p={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,w=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},R={values:lV(),array:lV(),state:lV()},N=KQ(e.mode),M=KQ(e.reValidateMode),D=e.criteriaMode===ah.all,F=we=>De=>{clearTimeout(w),w=setTimeout(we,De)},z=async we=>{if(!e.disabled&&(C.isValid||we)){const De=e.resolver?dl((await J()).errors):await ne(o,!0);De!==i.isValid&&R.state.next({isValid:De})}},q=(we,De)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((we||Array.from(y.mount)).forEach($e=>{$e&&(De?cs(i.validatingFields,$e,De):Fo(i.validatingFields,$e))}),R.state.next({validatingFields:i.validatingFields,isValidating:!dl(i.validatingFields)}))},K=(we,De=[],$e,kt,At=!0,Tt=!0)=>{if(kt&&$e&&!e.disabled){if(p.action=!0,Tt&&Array.isArray(_n(o,we))){const Ut=$e(_n(o,we),kt.argA,kt.argB);At&&cs(o,we,Ut)}if(Tt&&Array.isArray(_n(i.errors,we))){const Ut=$e(_n(i.errors,we),kt.argA,kt.argB);At&&cs(i.errors,we,Ut),Y8e(i.errors,we)}if(C.touchedFields&&Tt&&Array.isArray(_n(i.touchedFields,we))){const Ut=$e(_n(i.touchedFields,we),kt.argA,kt.argB);At&&cs(i.touchedFields,we,Ut)}C.dirtyFields&&(i.dirtyFields=YT(l,u)),R.state.next({name:we,isDirty:pe(we,De),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else cs(u,we,De)},re=(we,De)=>{cs(i.errors,we,De),R.state.next({errors:i.errors})},ce=we=>{i.errors=we,R.state.next({errors:i.errors,isValid:!1})},se=(we,De,$e,kt)=>{const At=_n(o,we);if(At){const Tt=_n(u,we,wo($e)?_n(l,we):$e);wo(Tt)||kt&&kt.defaultChecked||De?cs(u,we,De?Tt:dV(At._f)):Te(we,Tt),p.mount&&z()}},ge=(we,De,$e,kt,At)=>{let Tt=!1,Ut=!1;const Sn={name:we};if(!e.disabled){const Pn=!!(_n(o,we)&&_n(o,we)._f&&_n(o,we)._f.disabled);if(!$e||kt){C.isDirty&&(Ut=i.isDirty,i.isDirty=Sn.isDirty=pe(),Tt=Ut!==Sn.isDirty);const hn=Pn||Tg(_n(l,we),De);Ut=!!(!Pn&&_n(i.dirtyFields,we)),hn||Pn?Fo(i.dirtyFields,we):cs(i.dirtyFields,we,!0),Sn.dirtyFields=i.dirtyFields,Tt=Tt||C.dirtyFields&&Ut!==!hn}if($e){const hn=_n(i.touchedFields,we);hn||(cs(i.touchedFields,we,$e),Sn.touchedFields=i.touchedFields,Tt=Tt||C.touchedFields&&hn!==$e)}Tt&&At&&R.state.next(Sn)}return Tt?Sn:{}},X=(we,De,$e,kt)=>{const At=_n(i.errors,we),Tt=C.isValid&&pp(De)&&i.isValid!==De;if(e.delayError&&$e?(v=F(()=>re(we,$e)),v(e.delayError)):(clearTimeout(w),v=null,$e?cs(i.errors,we,$e):Fo(i.errors,we)),($e?!Tg(At,$e):At)||!dl(kt)||Tt){const Ut={...kt,...Tt&&pp(De)?{isValid:De}:{},errors:i.errors,name:we};i={...i,...Ut},R.state.next(Ut)}},J=async we=>{q(we,!0);const De=await e.resolver(u,e.context,H8e(we||y.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return q(we),De},te=async we=>{const{errors:De}=await J(we);if(we)for(const $e of we){const kt=_n(De,$e);kt?cs(i.errors,$e,kt):Fo(i.errors,$e)}else i.errors=De;return De},ne=async(we,De,$e={valid:!0})=>{for(const kt in we){const At=we[kt];if(At){const{_f:Tt,...Ut}=At;if(Tt){const Sn=y.array.has(Tt.name),Pn=At._f&&$8e(At._f);Pn&&C.validatingFields&&q([kt],!0);const hn=await ZQ(At,y.disabled,u,D,e.shouldUseNativeValidation&&!De,Sn);if(Pn&&C.validatingFields&&q([kt]),hn[Tt.name]&&($e.valid=!1,De))break;!De&&(_n(hn,Tt.name)?Sn?B8e(i.errors,hn,Tt.name):cs(i.errors,Tt.name,hn[Tt.name]):Fo(i.errors,Tt.name))}!dl(Ut)&&await ne(Ut,De,$e)}}return $e.valid},de=()=>{for(const we of y.unMount){const De=_n(o,we);De&&(De._f.refs?De._f.refs.every($e=>!uV($e)):!uV(De._f.ref))&&_t(we)}y.unMount=new Set},pe=(we,De)=>!e.disabled&&(we&&De&&cs(u,we,De),!Tg(Ee(),l)),he=(we,De,$e)=>F8e(we,y,{...p.mount?u:wo(De)?l:Tp(we)?{[we]:De}:De},$e,De),ve=we=>rx(_n(p.mount?u:l,we,e.shouldUnregister?_n(l,we,[]):[])),Te=(we,De,$e={})=>{const kt=_n(o,we);let At=De;if(kt){const Tt=kt._f;Tt&&(!Tt.disabled&&cs(u,we,Cae(De,Tt)),At=BO(Tt.ref)&&Nc(De)?"":De,bae(Tt.ref)?[...Tt.ref.options].forEach(Ut=>Ut.selected=At.includes(Ut.value)):Tt.refs?nI(Tt.ref)?Tt.refs.length>1?Tt.refs.forEach(Ut=>(!Ut.defaultChecked||!Ut.disabled)&&(Ut.checked=Array.isArray(At)?!!At.find(Sn=>Sn===Ut.value):At===Ut.value)):Tt.refs[0]&&(Tt.refs[0].checked=!!At):Tt.refs.forEach(Ut=>Ut.checked=Ut.value===At):$3(Tt.ref)?Tt.ref.value="":(Tt.ref.value=At,Tt.ref.type||R.values.next({name:we,values:{...u}})))}($e.shouldDirty||$e.shouldTouch)&&ge(we,At,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&xe(we)},Fe=(we,De,$e)=>{for(const kt in De){const At=De[kt],Tt=`${we}.${kt}`,Ut=_n(o,Tt);(y.array.has(we)||po(At)||Ut&&!Ut._f)&&!My(At)?Fe(Tt,At,$e):Te(Tt,At,$e)}},be=(we,De,$e={})=>{const kt=_n(o,we),At=y.array.has(we),Tt=Xu(De);cs(u,we,Tt),At?(R.array.next({name:we,values:{...u}}),(C.isDirty||C.dirtyFields)&&$e.shouldDirty&&R.state.next({name:we,dirtyFields:YT(l,u),isDirty:pe(we,Tt)})):kt&&!kt._f&&!Nc(Tt)?Fe(we,Tt,$e):Te(we,Tt,$e),qQ(we,y)&&R.state.next({...i}),R.values.next({name:p.mount?we:void 0,values:{...u}})},Re=async we=>{p.mount=!0;const De=we.target;let $e=De.name,kt=!0;const At=_n(o,$e),Tt=()=>De.type?dV(At._f):N8e(we),Ut=Sn=>{kt=Number.isNaN(Sn)||My(Sn)&&isNaN(Sn.getTime())||Tg(Sn,_n(u,$e,Sn))};if(At){let Sn,Pn;const hn=Tt(),Rt=we.type===$Q.BLUR||we.type===$Q.FOCUS_OUT,Zn=!K8e(At._f)&&!e.resolver&&!_n(i.errors,$e)&&!At._f.deps||q8e(Rt,_n(i.touchedFields,$e),i.isSubmitted,M,N),Dt=qQ($e,y,Rt);cs(u,$e,hn),Rt?(At._f.onBlur&&At._f.onBlur(we),v&&v(0)):At._f.onChange&&At._f.onChange(we);const Xt=ge($e,hn,Rt,!1),Vr=!dl(Xt)||Dt;if(!Rt&&R.values.next({name:$e,type:we.type,values:{...u}}),Zn)return C.isValid&&(e.mode==="onBlur"&&Rt?z():Rt||z()),Vr&&R.state.next({name:$e,...Dt?{}:Xt});if(!Rt&&Dt&&R.state.next({...i}),e.resolver){const{errors:Oi}=await J([$e]);if(Ut(hn),kt){const li=tZ(i.errors,o,$e),Ni=tZ(Oi,o,li.name||$e);Sn=Ni.error,$e=Ni.name,Pn=dl(Oi)}}else q([$e],!0),Sn=(await ZQ(At,y.disabled,u,D,e.shouldUseNativeValidation))[$e],q([$e]),Ut(hn),kt&&(Sn?Pn=!1:C.isValid&&(Pn=await ne(o,!0)));kt&&(At._f.deps&&xe(At._f.deps),X($e,Pn,Sn,Xt))}},Ae=(we,De)=>{if(_n(i.errors,De)&&we.focus)return we.focus(),1},xe=async(we,De={})=>{let $e,kt;const At=Jk(we);if(e.resolver){const Tt=await te(wo(we)?we:At);$e=dl(Tt),kt=we?!At.some(Ut=>_n(Tt,Ut)):$e}else we?(kt=(await Promise.all(At.map(async Tt=>{const Ut=_n(o,Tt);return await ne(Ut&&Ut._f?{[Tt]:Ut}:Ut)}))).every(Boolean),!(!kt&&!i.isValid)&&z()):kt=$e=await ne(o);return R.state.next({...!Tp(we)||C.isValid&&$e!==i.isValid?{}:{name:we},...e.resolver||!we?{isValid:$e}:{},errors:i.errors}),De.shouldFocus&&!kt&&HC(o,Ae,we?At:y.mount),kt},Ee=we=>{const De={...p.mount?u:l};return wo(we)?De:Tp(we)?_n(De,we):we.map($e=>_n(De,$e))},Ne=(we,De)=>({invalid:!!_n((De||i).errors,we),isDirty:!!_n((De||i).dirtyFields,we),error:_n((De||i).errors,we),isValidating:!!_n(i.validatingFields,we),isTouched:!!_n((De||i).touchedFields,we)}),je=we=>{we&&Jk(we).forEach(De=>Fo(i.errors,De)),R.state.next({errors:we?i.errors:{}})},qe=(we,De,$e)=>{const kt=(_n(o,we,{_f:{}})._f||{}).ref,At=_n(i.errors,we)||{},{ref:Tt,message:Ut,type:Sn,...Pn}=At;cs(i.errors,we,{...Pn,...De,ref:kt}),R.state.next({name:we,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&kt&&kt.focus&&kt.focus()},at=(we,De)=>vp(we)?R.values.subscribe({next:$e=>we(he(void 0,De),$e)}):he(we,De,!0),_t=(we,De={})=>{for(const $e of we?Jk(we):y.mount)y.mount.delete($e),y.array.delete($e),De.keepValue||(Fo(o,$e),Fo(u,$e)),!De.keepError&&Fo(i.errors,$e),!De.keepDirty&&Fo(i.dirtyFields,$e),!De.keepTouched&&Fo(i.touchedFields,$e),!De.keepIsValidating&&Fo(i.validatingFields,$e),!e.shouldUnregister&&!De.keepDefaultValue&&Fo(l,$e);R.values.next({values:{...u}}),R.state.next({...i,...De.keepDirty?{isDirty:pe()}:{}}),!De.keepIsValid&&z()},ut=({disabled:we,name:De,field:$e,fields:kt})=>{(pp(we)&&p.mount||we||y.disabled.has(De))&&(we?y.disabled.add(De):y.disabled.delete(De),ge(De,dV($e?$e._f:_n(kt,De)._f),!1,!1,!0))},vt=(we,De={})=>{let $e=_n(o,we);const kt=pp(De.disabled)||pp(e.disabled);return cs(o,we,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:we}},name:we,mount:!0,...De}}),y.mount.add(we),$e?ut({field:$e,disabled:pp(De.disabled)?De.disabled:e.disabled,name:we}):se(we,!0,De.value),{...kt?{disabled:De.disabled||e.disabled}:{},...e.progressive?{required:!!De.required,min:XT(De.min),max:XT(De.max),minLength:XT(De.minLength),maxLength:XT(De.maxLength),pattern:XT(De.pattern)}:{},name:we,onChange:Re,onBlur:Re,ref:At=>{if(At){vt(we,De),$e=_n(o,we);const Tt=wo(At.value)&&At.querySelectorAll&&At.querySelectorAll("input,select,textarea")[0]||At,Ut=G8e(Tt),Sn=$e._f.refs||[];if(Ut?Sn.find(Pn=>Pn===Tt):Tt===$e._f.ref)return;cs(o,we,{_f:{...$e._f,...Ut?{refs:[...Sn.filter(uV),Tt,...Array.isArray(_n(l,we))?[{}]:[]],ref:{type:Tt.type,name:we}}:{ref:Tt}}}),se(we,!1,void 0,Tt)}else $e=_n(o,we,{}),$e._f&&($e._f.mount=!1),(e.shouldUnregister||De.shouldUnregister)&&!(D8e(y.array,we)&&p.action)&&y.unMount.add(we)}}},it=()=>e.shouldFocusError&&HC(o,Ae,y.mount),wt=we=>{pp(we)&&(R.state.next({disabled:we}),HC(o,(De,$e)=>{const kt=_n(o,$e);kt&&(De.disabled=kt._f.disabled||we,Array.isArray(kt._f.refs)&&kt._f.refs.forEach(At=>{At.disabled=kt._f.disabled||we}))},0,!1))},$t=(we,De)=>async $e=>{let kt;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let At=Xu(u);if(y.disabled.size)for(const Tt of y.disabled)cs(At,Tt,void 0);if(R.state.next({isSubmitting:!0}),e.resolver){const{errors:Tt,values:Ut}=await J();i.errors=Tt,At=Ut}else await ne(o);if(Fo(i.errors,"root"),dl(i.errors)){R.state.next({errors:{}});try{await we(At,$e)}catch(Tt){kt=Tt}}else De&&await De({...i.errors},$e),it(),setTimeout(it);if(R.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:dl(i.errors)&&!kt,submitCount:i.submitCount+1,errors:i.errors}),kt)throw kt},dt=(we,De={})=>{_n(o,we)&&(wo(De.defaultValue)?be(we,Xu(_n(l,we))):(be(we,De.defaultValue),cs(l,we,Xu(De.defaultValue))),De.keepTouched||Fo(i.touchedFields,we),De.keepDirty||(Fo(i.dirtyFields,we),i.isDirty=De.defaultValue?pe(we,Xu(_n(l,we))):pe()),De.keepError||(Fo(i.errors,we),C.isValid&&z()),R.state.next({...i}))},mt=(we,De={})=>{const $e=we?Xu(we):l,kt=Xu($e),At=dl(we),Tt=At?l:kt;if(De.keepDefaultValues||(l=$e),!De.keepValues){if(De.keepDirtyValues){const Ut=new Set([...y.mount,...Object.keys(YT(l,u))]);for(const Sn of Array.from(Ut))_n(i.dirtyFields,Sn)?cs(Tt,Sn,_n(u,Sn)):be(Sn,_n(Tt,Sn))}else{if(G3&&wo(we))for(const Ut of y.mount){const Sn=_n(o,Ut);if(Sn&&Sn._f){const Pn=Array.isArray(Sn._f.refs)?Sn._f.refs[0]:Sn._f.ref;if(BO(Pn)){const hn=Pn.closest("form");if(hn){hn.reset();break}}}}o={}}u=e.shouldUnregister?De.keepDefaultValues?Xu(l):{}:Xu(Tt),R.array.next({values:{...Tt}}),R.values.next({values:{...Tt}})}y={mount:De.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!C.isValid||!!De.keepIsValid||!!De.keepDirtyValues,p.watch=!!e.shouldUnregister,R.state.next({submitCount:De.keepSubmitCount?i.submitCount:0,isDirty:At?!1:De.keepDirty?i.isDirty:!!(De.keepDefaultValues&&!Tg(we,l)),isSubmitted:De.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:At?{}:De.keepDirtyValues?De.keepDefaultValues&&u?YT(l,u):i.dirtyFields:De.keepDefaultValues&&we?YT(l,we):De.keepDirty?i.dirtyFields:{},touchedFields:De.keepTouched?i.touchedFields:{},errors:De.keepErrors?i.errors:{},isSubmitSuccessful:De.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},ct=(we,De)=>mt(vp(we)?we(u):we,De);return{control:{register:vt,unregister:_t,getFieldState:Ne,handleSubmit:$t,setError:qe,_executeSchema:J,_getWatch:he,_getDirty:pe,_updateValid:z,_removeUnmounted:de,_updateFieldArray:K,_updateDisabledField:ut,_getFieldArray:ve,_reset:mt,_resetDefaultValues:()=>vp(e.defaultValues)&&e.defaultValues().then(we=>{ct(we,e.resetOptions),R.state.next({isLoading:!1})}),_updateFormState:we=>{i={...i,...we}},_disableForm:wt,_subjects:R,_proxyFormState:C,_setErrors:ce,get _fields(){return o},get _formValues(){return u},get _state(){return p},set _state(we){p=we},get _defaultValues(){return l},get _names(){return y},set _names(we){y=we},get _formState(){return i},set _formState(we){i=we},get _options(){return e},set _options(we){e={...e,...we}}},trigger:xe,register:vt,handleSubmit:$t,watch:at,setValue:be,getValues:Ee,reset:ct,resetField:dt,clearErrors:je,unregister:_t,setError:qe,setFocus:(we,De={})=>{const $e=_n(o,we),kt=$e&&$e._f;if(kt){const At=kt.refs?kt.refs[0]:kt.ref;At.focus&&(At.focus(),De.shouldSelect&&vp(At.select)&&At.select())}},getFieldState:Ne}}function Rae(n={}){const e=bi.useRef(void 0),i=bi.useRef(void 0),[o,l]=bi.useState({isDirty:!1,isValidating:!1,isLoading:vp(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:vp(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...J8e(n),formState:o});const u=e.current.control;return u._options=n,V8e({subject:u._subjects.state,next:p=>{U8e(p,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),bi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),bi.useEffect(()=>{if(u._proxyFormState.isDirty){const p=u._getDirty();p!==o.isDirty&&u._subjects.state.next({isDirty:p})}},[u,o.isDirty]),bi.useEffect(()=>{n.values&&!Tg(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(p=>({...p}))):u._resetDefaultValues()},[n.values,u]),bi.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),bi.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),bi.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=M8e(o,u),e.current}var Q8e=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function WF(){return WF=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},WF.apply(this,arguments)}function Z8e(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function fk(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function eWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,GF(n,e)}function GF(n,e){return GF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},GF(n,e)}var ix=function(n){eWe(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(fk(o)),o.handleErrored=o.handleErrored.bind(fk(o)),o.handleChange=o.handleChange.bind(fk(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(fk(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,p){l.executionResolve=u,l.executionReject=p,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=Z8e(l,Q8e);return O.createElement("div",WF({},u,{ref:this.handleRecaptchaRef}))},e}(O.Component);ix.displayName="ReCAPTCHA";ix.propTypes={sitekey:Tn.string.isRequired,onChange:Tn.func,grecaptcha:Tn.object,theme:Tn.oneOf(["dark","light"]),type:Tn.oneOf(["image","audio"]),tabindex:Tn.number,onExpired:Tn.func,onErrored:Tn.func,size:Tn.oneOf(["compact","normal","invisible"]),stoken:Tn.string,hl:Tn.string,badge:Tn.oneOf(["bottomright","bottomleft","inline"]),isolated:Tn.bool};ix.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function HF(){return HF=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},HF.apply(this,arguments)}function tWe(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function nWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var th={},rWe=0;function iWe(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=function(y){nWe(v,y);function v(C,R){var N;return N=y.call(this,C,R)||this,N.state={},N.__scriptURL="",N}var w=v.prototype;return w.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+rWe++),this.__scriptLoaderID},w.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},w.asyncScriptLoaderHandleLoad=function(R){var N=this;this.setState(R,function(){return N.props.asyncScriptOnLoad&&N.props.asyncScriptOnLoad(N.state)})},w.asyncScriptLoaderTriggerOnScriptLoaded=function(){var R=th[this.__scriptURL];if(!R||!R.loaded)throw new Error("Script is not loaded.");for(var N in R.observers)R.observers[N](R);delete window[e.callbackName]},w.componentDidMount=function(){var R=this,N=this.setupScriptURL(),M=this.asyncScriptLoaderGetScriptLoaderID(),D=e,F=D.globalName,z=D.callbackName,q=D.scriptId;if(F&&typeof window[F]<"u"&&(th[N]={loaded:!0,observers:{}}),th[N]){var K=th[N];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[M]=function(X){return R.asyncScriptLoaderHandleLoad(X)};return}var re={};re[M]=function(X){return R.asyncScriptLoaderHandleLoad(X)},th[N]={loaded:!1,observers:re};var ce=document.createElement("script");ce.src=N,ce.async=!0;for(var se in e.attributes)ce.setAttribute(se,e.attributes[se]);q&&(ce.id=q);var ge=function(J){if(th[N]){var te=th[N],ne=te.observers;for(var de in ne)J(ne[de])&&delete ne[de]}};z&&typeof window<"u"&&(window[z]=function(){return R.asyncScriptLoaderTriggerOnScriptLoaded()}),ce.onload=function(){var X=th[N];X&&(X.loaded=!0,ge(function(J){return z?!1:(J(X),!0)}))},ce.onerror=function(){var X=th[N];X&&(X.errored=!0,ge(function(J){return J(X),!0}))},document.body.appendChild(ce)},w.componentWillUnmount=function(){var R=this.__scriptURL;if(e.removeOnUnmount===!0)for(var N=document.getElementsByTagName("script"),M=0;M<N.length;M+=1)N[M].src.indexOf(R)>-1&&N[M].parentNode&&N[M].parentNode.removeChild(N[M]);var D=th[R];D&&(delete D.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete th[R])},w.render=function(){var R=e.globalName,N=this.props;N.asyncScriptOnLoad;var M=N.forwardedRef,D=tWe(N,["asyncScriptOnLoad","forwardedRef"]);return R&&typeof window<"u"&&(D[R]=typeof window[R]<"u"?window[R]:void 0),D.ref=M,O.createElement(o,D)},v}(O.Component),p=O.forwardRef(function(y,v){return O.createElement(u,HF({},y,{forwardedRef:v}))});return p.displayName="AsyncScriptLoader("+l+")",p.propTypes={asyncScriptOnLoad:Tn.func},fAe(p,o)}}var $F="onloadcallback",sWe="grecaptcha";function KF(){return typeof window<"u"&&window.recaptchaOptions||{}}function oWe(){var n=KF(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+$F+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+$F+"&render=explicit"}const Iae=iWe(oWe,{callbackName:$F,globalName:sWe,attributes:KF().nonce?{nonce:KF().nonce}:{}})(ix),sx=(n,e="generic-modal")=>{O.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),W.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){W.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),W.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):W.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){W.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},Aae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,p]=O.useState((i==null?void 0:i.username)||""),[y,v]=O.useState((i==null?void 0:i.Nickname)||""),[w,C]=O.useState(!1),[R,N]=O.useState(null),[M,D]=O.useState(!1),F=ja(),z=ce=>!(!ce||ce.trim()===""||!/^[a-z0-9]{1,15}$/.test(ce)),q=async ce=>{var se,ge;if(!z(ce))return!ce||ce.trim()===""?N("Username cannot be empty"):N("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),N(null);try{let X=!1,J=0;const te=3;for(;J<te;)try{X=await bR(ce);break}catch(ne){if(W.error(`Attempt ${J+1}: Error checking username:`,ne),J++,J>=te)throw ne;await new Promise(de=>setTimeout(de,1e3))}return X?(N("Username is already taken"),!1):!0}catch(X){return W.error("Error checking username after retries:",X),X.code==="permission-denied"||(se=X.message)!=null&&se.includes("permissions")?N("Username check unavailable. Please try again or pick a unique name."):N("Error checking username availability. Please try again."),X.code==="permission-denied"||((ge=X.message)==null?void 0:ge.includes("permissions"))}finally{C(!1)}};O.useEffect(()=>{if(!u){N("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const ce=setTimeout(async()=>{await q(u)},500);return()=>clearTimeout(ce)}},[u]),O.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ce=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;v(ce)}},[i]);const K=async()=>{D(!0);try{if(!await q(u)){D(!1);return}if(y.length>15){N("Display Name must be at most 15 characters"),D(!1);return}Zu(y),W.log("UsernameConfirmation: Preparing to confirm user registration");const se=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",ge={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:y||se,email:i.email,password:i.password};W.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(ge).join(", ")),await o(ge),e()}catch(ce){W.error("Error during username confirmation:",ce),F({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{D(!1)}},re=()=>{M||e()};return S.jsxs(us,{isOpen:n,onClose:re,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!M,closeOnEsc:!M,children:[S.jsx(hs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ds,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[S.jsxs(fo,{children:[S.jsx(hR,{size:"lg",mb:2,children:"Customize Your Profile"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),S.jsx(Os,{color:"gray.400",isDisabled:M}),S.jsx(ys,{children:S.jsxs(Rr,{spacing:6,align:"stretch",children:[S.jsxs(Sr,{isInvalid:!!R,children:[S.jsx(gi,{children:"Username"}),S.jsxs(Pg,{children:[S.jsx(pN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ci,{placeholder:"username",value:u,onChange:ce=>p(ce.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),R?S.jsx(gp,{children:R}):S.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(Sr,{children:[S.jsx(gi,{children:"Nickname"}),S.jsx(ci,{placeholder:"Nickname",value:y,onChange:ce=>v(ce.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),S.jsx(Hy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),S.jsx(uh,{children:S.jsxs(Mr,{gap:3,width:"100%",children:[S.jsx(In,{variant:"outline",onClick:re,flex:"1",isDisabled:M,children:"Back"}),S.jsx(In,{colorScheme:"blue",onClick:K,isLoading:M||w,isDisabled:!!R||!u||M,flex:"2",children:"Finish"})]})})]})]})};Aae.propTypes={isOpen:Tn.bool.isRequired,onClose:Tn.func.isRequired,userData:Tn.object.isRequired,onConfirm:Tn.func.isRequired,fullscreenRef:Tn.object};const aWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function ox({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:p,formState:{errors:y}}=Rae(),{register:v}=O.useContext(ts),w=ja(),{fullscreenRef:C}=fh(),[R,N]=O.useState(!1),[M,D]=O.useState(!1),[F,z]=O.useState(null),q=O.useRef(null),[K,re]=O.useState(!1),[ce,se]=O.useState(null),[ge,X]=O.useState(!1),J=o!==void 0?o:R,te=l||(()=>N(!1));sx(J||K),O.useEffect(()=>{!J&&q.current&&(q.current.reset(),z(null))},[J]);const ne=Te=>{z(Te)},de=async Te=>{W.log("Register.jsx: Processing registration form submission");const{email:Fe,password:be,confirmPassword:Re,...Ae}=Te;if(W.log("Register.jsx: Registration data fields:",Object.keys(Ae).join(", ")),!F){w({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(be!==Re){w({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}Zu(Ae.firstName),Zu(Ae.lastName),Zu(Ae.companyName),D(!0);try{const xe=await z6e(Ae.firstName||"",Ae.lastName||""),Ee=Ae.firstName&&Ae.lastName?`${Ae.firstName}${Ae.lastName.charAt(0).toUpperCase()}`:"";Ee&&Zu(Ee),W.log("Register.jsx: Generated username and nickname for new user");const Ne={...Ae,firstName:Ae.firstName||"",lastName:Ae.lastName||"",companyName:Ae.companyName||"",linkedInProfile:Ae.linkedInProfile||"",email:Fe,password:be,username:xe,Nickname:Ee,captchaToken:F};W.log("Register.jsx: Prepared registration data with fields:",Object.keys(Ne).join(", ")),se(Ne),re(!0)}catch(xe){W.error("User: Registration Error:",xe);let Ee="An error occurred during registration. Please try again.",Ne=!1;xe.code==="auth/email-already-in-use"?(Ee="This email address is already registered. Please sign in instead.",Ne=!0):xe.code==="auth/invalid-email"?Ee="The email address is not valid. Please check and try again.":xe.code==="auth/weak-password"?Ee="The password is too weak. Please choose a stronger password.":xe.message&&(Ee=xe.message),w({title:"Registration Failed",description:S.jsxs(S.Fragment,{children:[Ee,Ne&&S.jsx(Ke,{mt:2,children:S.jsx(eu,{color:"blue.400",onClick:()=>{te(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1),q.current&&q.current.reset()}},pe=async Te=>{D(!0);try{W.log("Register.jsx: Completing registration with confirmed username");const{email:Fe,password:be,...Re}=Te,Ae={...Re,firstName:Re.firstName||"",lastName:Re.lastName||"",companyName:Re.companyName||"",linkedInProfile:Re.linkedInProfile||"",username:Re.username||"",Nickname:Re.Nickname||""};W.log("Register.jsx: Final registration data includes fields:",Object.keys(Ae).join(", "));const xe=await v(Fe,be,Ae);te(),re(!1),W.log("User: Registration process complete."),w({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),se(null),X(!1)}catch(Fe){W.error("User: Registration Error during final step:",Fe);let be="An error occurred during registration. Please try again.";Fe.code==="auth/email-already-in-use"?be="This email address is already in use. Please try another one.":Fe.message&&(be=Fe.message),w({title:"Registration Failed",description:be,status:"error",duration:5e3,isClosable:!0,position:"top"}),re(!1),se(null),X(!1)}finally{D(!1)}},he=()=>{l?l():N(!R)},ve=n==="link"?S.jsx(eu,{variant:"header",onClick:he,children:e}):S.jsx(In,{onClick:he,...i,children:e});return S.jsxs(S.Fragment,{children:[!o&&ve,S.jsxs(us,{isOpen:J&&!K,onClose:te,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(hs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ds,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Te=>{Te.stopPropagation()},children:[S.jsxs(fo,{p:8,textAlign:"center",children:[S.jsx(hR,{size:"lg",mb:2,color:"white",children:"Create Account"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{px:8,children:S.jsx("form",{onSubmit:p(de),children:S.jsxs(Rr,{spacing:4,children:[S.jsxs(Sr,{isInvalid:y.companyName,isRequired:!0,children:[S.jsx(ci,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:Te=>Te===""?"":Te})}),S.jsx(gp,{children:y.companyName&&y.companyName.message})]}),S.jsxs(Mr,{gap:4,w:"100%",children:[S.jsxs(Sr,{isInvalid:y.firstName,isRequired:!0,children:[S.jsx(ci,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:Te=>Te===""?"":Te})}),S.jsx(gp,{children:y.firstName&&y.firstName.message})]}),S.jsxs(Sr,{isInvalid:y.lastName,isRequired:!0,children:[S.jsx(ci,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:Te=>Te===""?"":Te})}),S.jsx(gp,{children:y.lastName&&y.lastName.message})]})]}),S.jsxs(Sr,{isInvalid:y.email,isRequired:!0,children:[S.jsx(ci,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(gp,{children:y.email&&y.email.message})]}),S.jsxs(Mr,{gap:4,w:"100%",children:[S.jsxs(Sr,{isInvalid:y.password,isRequired:!0,children:[S.jsx(ci,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(gp,{children:y.password&&y.password.message})]}),S.jsxs(Sr,{isInvalid:y.confirmPassword,isRequired:!0,children:[S.jsx(ci,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),S.jsx(gp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),S.jsx(Sr,{children:S.jsx(ci,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:Te=>Te===""?"":Te})})}),S.jsx(st,{width:"100%",display:"flex",justifyContent:"center",my:4,children:S.jsx(Iae,{ref:q,sitekey:aWe,onChange:ne,theme:"dark"})})]})})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(In,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(de),isLoading:M,loadingText:"Processing",isDisabled:!F,children:"Next: Set Your Username"}),S.jsxs(Ke,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(eu,{color:"blue.400",onClick:()=>{te(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&S.jsx(Aae,{isOpen:K,onClose:()=>re(!1),userData:ce,onConfirm:pe,fullscreenRef:C,isRegistering:ge})]})}ox.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,isOpen:Tn.bool,onClose:Tn.func};const cWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function W0({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l,createGuestUser:u}=O.useContext(ts),{fullscreenRef:p}=fh(),y=ja(),{register:v,handleSubmit:w,formState:{errors:C}}=Rae(),[R,N]=O.useState(!1),[M,D]=O.useState(o),[F,z]=O.useState(!1),[q,K]=O.useState(!1),[re,ce]=O.useState(""),[se,ge]=O.useState(!1),[X,J]=O.useState(null),[te,ne]=O.useState(!1),[de,pe]=O.useState(!1),he=O.useRef(null);sx(M||q),O.useEffect(()=>{M&&(async()=>{try{const qe=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(qe){const at=qe[2],_t=await Ua(at);ne((_t==null?void 0:_t.allowGuestUsers)||!1)}}catch(je){W.error("SignIn: Error checking guest access:",je),ne(!1)}})()},[M]),O.useEffect(()=>{const Ne=()=>{D(!0)};return window.addEventListener("openSignInModal",Ne),()=>{window.removeEventListener("openSignInModal",Ne)}},[]);const ve=Ne=>{J(Ne)},Te=async Ne=>{if(!X){y({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}N(!0);try{await l(Ne.email,Ne.password,X),W.log("User: Sign-in process complete."),D(!1),window.location.reload()}catch(je){W.error("User: SignIn Error:",je);const qe=je.message||"An error occurred while logging in. Please check your credentials.",at=qe.includes("verify your email");y({title:at?"Email Verification Required":"Error",description:qe,status:at?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:p.current})}finally{N(!1),he.current&&he.current.reset()}},Fe=async()=>{if(!re){y({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:p.current});return}try{ge(!0),await Bje(x3,re),y({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:p.current}),K(!1)}catch(Ne){W.error("User: Reset Password Error:",Ne),y({title:"Error",description:Ne.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:p.current})}finally{ge(!1)}},be=()=>D(Ne=>!Ne),Re=()=>{D(!1),z(!0)},Ae=()=>{K(!0)},xe=async()=>{try{pe(!0);const je=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(je){const qe=je[2];await u(qe),y({title:"Welcome, Guest!",description:"You're now entering as a guest user.",status:"success",duration:3e3,isClosable:!0,position:"top",container:p.current}),D(!1),window.location.reload()}}catch(Ne){W.error("SignIn: Error creating guest user:",Ne),y({title:"Error",description:"Failed to create guest user. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:p.current})}finally{pe(!1)}},Ee=n==="link"?S.jsx(eu,{variant:"header",onClick:be,children:e}):S.jsx(In,{onClick:be,...i,children:e});return S.jsxs(S.Fragment,{children:[Ee,S.jsxs(us,{isOpen:M,onClose:be,size:"md",portalProps:{containerRef:p},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(hs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:w(Te),children:S.jsxs(ds,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ne=>{Ne.stopPropagation()},children:[S.jsxs(fo,{p:8,textAlign:"center",children:[S.jsx(hR,{size:"lg",mb:2,color:"white",children:"Welcome Back"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{px:8,pb:8,children:S.jsxs(Rr,{spacing:4,children:[S.jsxs(Sr,{isInvalid:C.email,children:[S.jsxs(Pg,{children:[S.jsx(MC,{pointerEvents:"none",children:S.jsx(HQ,{color:"gray.500"})}),S.jsx(ci,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("email",{required:"Email is required."})})]}),S.jsx(gp,{children:C.email&&C.email.message})]}),S.jsxs(Sr,{isInvalid:C.password,children:[S.jsxs(Pg,{children:[S.jsx(MC,{pointerEvents:"none",children:S.jsx(A8e,{color:"gray.500"})}),S.jsx(ci,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("password",{required:"Password is required."})})]}),S.jsx(gp,{children:C.password&&C.password.message})]}),S.jsx(st,{alignSelf:"flex-end",children:S.jsx(eu,{color:"blue.400",fontSize:"sm",onClick:Ae,children:"Forgot Password?"})}),S.jsx(Mr,{width:"100%",justifyContent:"center",my:4,children:S.jsx(Iae,{ref:he,sitekey:cWe,onChange:ve,theme:"dark"})})]})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(In,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:R,loadingText:"Signing In",isDisabled:!X,children:"Sign In"}),te&&S.jsx(In,{colorScheme:"gray",variant:"outline",size:"lg",width:"100%",onClick:xe,isLoading:de,loadingText:"Creating Guest Account...",_hover:{bg:"gray.700"},children:"Continue as Guest"}),S.jsxs(Ke,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(eu,{color:"blue.400",onClick:Re,children:"Sign Up"})]})]})]})})]}),S.jsxs(us,{isOpen:q,onClose:()=>K(!1),size:"md",portalProps:{containerRef:p},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(hs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ds,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ne=>{Ne.stopPropagation()},children:[S.jsxs(fo,{p:8,textAlign:"center",children:[S.jsx(hR,{size:"lg",mb:2,color:"white",children:"Reset Password"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{px:8,pb:4,children:S.jsx(Sr,{children:S.jsxs(Pg,{children:[S.jsx(MC,{pointerEvents:"none",children:S.jsx(HQ,{color:"gray.500"})}),S.jsx(ci,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:re,onChange:Ne=>ce(Ne.target.value)})]})})}),S.jsxs(uh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(In,{colorScheme:"blue",size:"lg",width:"100%",onClick:Fe,isLoading:se,loadingText:"Sending",children:"Send Reset Link"}),S.jsxs(Ke,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",S.jsx(eu,{color:"blue.400",onClick:()=>K(!1),children:"Back to Sign In"})]})]})]})]}),S.jsx(ox,{mode:"link",isOpen:F,onClose:()=>z(!1)})]})}W0.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string,buttonProps:Tn.object,initialIsOpen:Tn.bool};function q3({mode:n="button",label:e="Sign Out"}){const i=ja(),{signOut:o}=O.useContext(ts),{fullscreenRef:l}=fh(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?S.jsx(eu,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:p})}q3.propTypes={mode:Tn.oneOf(["button","link"]),label:Tn.string};const G0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,Y3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=o.target.closest("canvas")||o.target.closest("#webgl-root"),y=document.activeElement===u;!l&&(p||y)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},Pae=()=>{document.body.classList.remove("unity-focused")};function GO(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?Y3():Pae(),new Promise(e=>{try{const i=G0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),qF(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function qF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=G0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(o,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function lWe(){const n=G0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function XS(n=!0){return console.log("Focusing Unity canvas"),n?Y3():Pae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){GO(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function kf(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),Y3(),new Promise(e=>{try{if(n)GO(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=G0();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=G0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),GO(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function uWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function dWe(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=GO,window.focusUnity=XS,window.blockUnityKeyboardInput=kf,window.hasUnityKeyboardFocus=lWe,window.getUnityInstance=G0,window.registerUnityInstance=uWe,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),qF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),qF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),kf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),kf(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),kf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(dWe,0);const hWe=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,u]=O.useState(!1),[p,y]=O.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState(""),[D,F]=O.useState(!1),z=ja(),{sendUserToUnity:q,updateUser:K}=O.useContext(ts),re=O.useRef(null);O.useEffect(()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),O.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),kf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),kf(!1).then(()=>{setTimeout(()=>{XS(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),kf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),O.useEffect(()=>{if(l&&re.current){const te=()=>{re.current.focus(),R(!0),kf(!0)};te();const ne=setTimeout(te,100),de=setTimeout(te,300);return()=>{clearTimeout(ne),clearTimeout(de)}}else R(!1)},[l]),O.useEffect(()=>{const ne=setTimeout(async()=>{if(p.username&&p.username!==(i==null?void 0:i.username)){F(!0),M("");try{if(!/^[a-z0-9]{1,15}$/.test(p.username)){M("Username must be 1-15 characters, lowercase letters and numbers only"),F(!1);return}Zu(p.username),await bR(p.username)&&M("Username is already taken")}catch(de){W.error("Error checking username:",de),M("Error checking username availability")}finally{F(!1)}}},500);return()=>clearTimeout(ne)},[p.username,i==null?void 0:i.username]);const ce=()=>{u(!1),R(!1),e()},se=te=>{const{name:ne,value:de}=te.target;if(ne==="username"){const pe=de.toLowerCase().replace(/[^a-z0-9]/g,"");y(he=>({...he,[ne]:pe}))}else y(pe=>({...pe,[ne]:de}))},ge=async()=>{if(p.Nickname.trim()===""){z({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(Zu(p.Nickname),p.firstName&&Zu(p.firstName),p.lastName&&Zu(p.lastName),p.companyName&&Zu(p.companyName),N){z({title:"Error",description:N,status:"error",duration:3e3,isClosable:!0});return}w(!0);try{if(p.username!==i.username&&(Zu(p.username),await bR(p.username))){M("Username is already taken"),z({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),w(!1);return}const te=br(Xn,"users",i.uid);if(p.username!==i.username)try{if(W.log("ProfileModal: Updating username from",i.username,"to",p.username),!await H6e(i.uid,p.username))throw new Error("Failed to update username");W.log("ProfileModal: Username updated successfully")}catch(ne){W.error("Error updating username:",ne),z({title:"Error",description:"Failed to update username: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),w(!1);return}W.log("ProfileModal: Updating user profile");try{const ne={Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile,username:p.username,lastUpdated:new Date().toISOString()};await mo(te,ne),W.log("ProfileModal: Profile updated successfully");const de=Goe(te,pe=>{if(pe.exists()&&pe.data().Nickname===p.Nickname){try{q()}catch(ve){W.error("Error sending user to Unity:",ve)}de()}},pe=>{W.error("Error in profile update listener:",pe)});try{await K()}catch(pe){W.error("Error updating user context:",pe)}y({Nickname:p.Nickname,username:p.username,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),z({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(ne){W.error("Error updating profile data:",ne),z({title:"Error",description:"Failed to update profile: "+(ne.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(te){W.error("Error in handleSave:",te),z({title:"Error",description:"An unexpected error occurred: "+(te.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{w(!1)}},X=()=>S.jsxs(Rr,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(Mr,{direction:"column",align:"center",gap:2,children:[S.jsx(Ke,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),S.jsxs(Ke,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),S.jsxs(Rr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[S.jsxs(Mr,{direction:"column",children:[S.jsx(Ke,{color:"gray.400",fontSize:"sm",children:"Company"}),S.jsx(Ke,{children:i.companyName||"Not specified"})]}),S.jsxs(Mr,{direction:"column",children:[S.jsx(Ke,{color:"gray.400",fontSize:"sm",children:"Full Name"}),S.jsx(Ke,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),S.jsxs(Mr,{direction:"column",children:[S.jsx(Ke,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),S.jsx(Ke,{children:i.linkedInProfile||"Not specified"})]})]}),S.jsx(In,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),J=()=>S.jsxs(Rr,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(Sr,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Display Name"}),S.jsx(ci,{ref:re,name:"Nickname",value:p.Nickname,onChange:se,onFocus:()=>{R(!0),kf(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),S.jsxs(Sr,{isInvalid:!!N,children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Username"}),S.jsxs(Pg,{children:[S.jsx(pN,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ci,{name:"username",value:p.username,onChange:se,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:D})]}),N&&S.jsx(Ke,{color:"red.400",fontSize:"sm",mt:1,children:N}),S.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(Sr,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Company Name"}),S.jsx(ci,{name:"companyName",value:p.companyName,onChange:se,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Mr,{gap:4,children:[S.jsxs(Sr,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"First Name"}),S.jsx(ci,{name:"firstName",value:p.firstName,onChange:se,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Sr,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"Last Name"}),S.jsx(ci,{name:"lastName",value:p.lastName,onChange:se,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),S.jsx(ci,{name:"linkedInProfile",value:p.linkedInProfile,onChange:se,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Mr,{gap:2,justify:"flex-end",mt:2,children:[S.jsx(In,{onClick:()=>{y({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1),M("")},variant:"outline",size:"sm",isDisabled:v,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),S.jsx(In,{onClick:ge,colorScheme:"blue",size:"sm",isLoading:v||D,isDisabled:!!N||D,children:"Save Changes"})]})]});return S.jsxs(us,{isOpen:n,onClose:ce,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Profile"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{pb:6,children:S.jsxs(Rr,{spacing:6,children:[S.jsx(yl,{src:o,size:"2xl",borderRadius:"full"}),l?J():X(),!l&&S.jsx(In,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},mk={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},kae=()=>{var C;const{user:n,updateUser:e}=O.useContext(ts),[i,o]=O.useState(!0),{isOpen:l,onOpen:u,onClose:p}=sd();O.useEffect(()=>{const R=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(R)},[]);const y=()=>{p(),e()},v=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,w=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:S.jsx(Mr,{align:"center",gap:"4",children:n?S.jsxs(S.Fragment,{children:[S.jsx(hWe,{isOpen:l,onClose:y,user:n,profileImageUrl:v}),S.jsxs(jR,{children:[S.jsx(BR,{as:st,cursor:"pointer",children:S.jsx(Mr,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:S.jsxs(Mr,{align:"center",gap:"3",children:[S.jsx(st,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(yl,{src:v,width:"100%",height:"100%",borderRadius:"full"})}),S.jsx(Ke,{color:"white",fontWeight:"medium",children:n.Nickname}),S.jsx(st,{display:"flex",alignItems:"center",height:"28px",children:S.jsx(_ae,{color:"white",w:4,h:4})})]})})}),S.jsx(Mc,{children:S.jsxs(zR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[S.jsxs(st,{p:4,display:"flex",alignItems:"center",gap:3,children:[S.jsx(yl,{src:v,size:"md",borderRadius:"full"}),S.jsx(Ke,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),S.jsx(Ug,{borderColor:"gray.700"}),w&&S.jsx(Ep,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),S.jsx(Ep,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),S.jsx(Ep,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),S.jsx(Ug,{borderColor:"gray.700"}),S.jsx(Ep,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),S.jsx(Ep,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:S.jsx(q3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx(ox,{mode:"button",label:"Register",buttonProps:{...mk,width:["100%","auto"]},customButton:S.jsxs(In,{...mk,children:[S.jsx(st,{as:"span",fontSize:"xl",children:""}),"Register"]})}),S.jsx(W0,{mode:"button",label:"Sign In",buttonProps:{...mk,width:["100%","auto"]},customButton:S.jsxs(In,{...mk,children:[S.jsx(st,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},pWe=()=>{const{registrationInProgress:n}=C8e();return n?S.jsxs(us,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[S.jsx(hs,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),S.jsx(ds,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsxs(Mr,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[S.jsx(cd,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),S.jsx(Ke,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),S.jsx(Ke,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},hV=document.getElementById("header-auth-root");if(hV){const n=hV.getAttribute("data-theme")||"default",e=()=>{const[i,o]=O.useState(null);return O.useEffect(()=>{pR(n).then(o)},[]),i?S.jsx(hN,{theme:i,children:S.jsx(nx,{children:S.jsxs(W3,{children:[S.jsx(kae,{}),S.jsx(pWe,{})]})})}):S.jsx("div",{children:"Loading theme..."})};$O.createRoot(hV).render(S.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var pV={},Rf={},JT={},nZ;function fWe(){if(nZ)return JT;nZ=1,Object.defineProperty(JT,"__esModule",{value:!0}),JT.useCanvasIdentifier=void 0;var n=Zf(),e=0,i="react-unity-webgl-canvas",o=function(l){var u=(0,n.useState)(0),p=u[0],y=u[1],v=(0,n.useCallback)(function(){y(function(C){return C+1})},[]);if(l!==void 0)return[l,v];var w=(0,n.useMemo)(function(){return[i,e].join("-")},[p]);return[w,v]};return JT.useCanvasIdentifier=o,JT}var QT={},ZT={},rZ;function Oae(){return rZ||(rZ=1,Object.defineProperty(ZT,"__esModule",{value:!0}),ZT.isBrowserEnvironment=void 0,ZT.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),ZT}var iZ;function mWe(){if(iZ)return QT;iZ=1,Object.defineProperty(QT,"__esModule",{value:!0}),QT.useUnityLoader=void 0;var n=Zf(),e=Oae(),i=function(o){var l=(0,n.useState)("Loading"),u=l[0],p=l[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(o===null){p("Idle");return}var y=window.document.querySelector('script[src="'.concat(o,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=o,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):p(y.getAttribute("data-status")==="loaded"?"Loaded":"Error");var v=function(w){return p(w.type==="load"?"Loaded":"Error")};return y.addEventListener("load",v),y.addEventListener("error",v),function(){y!==null&&(y.removeEventListener("load",v),y.removeEventListener("error",v),y.remove())}}},[o]),u};return QT.useUnityLoader=i,QT}var sZ;function gWe(){if(sZ)return Rf;sZ=1;var n=Rf&&Rf.__awaiter||function(p,y,v,w){function C(R){return R instanceof v?R:new v(function(N){N(R)})}return new(v||(v=Promise))(function(R,N){function M(z){try{F(w.next(z))}catch(q){N(q)}}function D(z){try{F(w.throw(z))}catch(q){N(q)}}function F(z){z.done?R(z.value):C(z.value).then(M,D)}F((w=w.apply(p,y||[])).next())})},e=Rf&&Rf.__generator||function(p,y){var v={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},w,C,R,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=M(0),N.throw=M(1),N.return=M(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function M(F){return function(z){return D([F,z])}}function D(F){if(w)throw new TypeError("Generator is already executing.");for(;N&&(N=0,F[0]&&(v=0)),v;)try{if(w=1,C&&(R=F[0]&2?C.return:F[0]?C.throw||((R=C.return)&&R.call(C),0):C.next)&&!(R=R.call(C,F[1])).done)return R;switch(C=0,R&&(F=[F[0]&2,R.value]),F[0]){case 0:case 1:R=F;break;case 4:return v.label++,{value:F[1],done:!1};case 5:v.label++,C=F[1],F=[0];continue;case 7:F=v.ops.pop(),v.trys.pop();continue;default:if(R=v.trys,!(R=R.length>0&&R[R.length-1])&&(F[0]===6||F[0]===2)){v=0;continue}if(F[0]===3&&(!R||F[1]>R[0]&&F[1]<R[3])){v.label=F[1];break}if(F[0]===6&&v.label<R[1]){v.label=R[1],R=F;break}if(R&&v.label<R[2]){v.label=R[2],v.ops.push(F);break}R[2]&&v.ops.pop(),v.trys.pop();continue}F=y.call(p,v)}catch(z){F=[6,z],C=0}finally{w=R=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.Unity=void 0;var i=Zf(),o=fWe(),l=mWe(),u=(0,i.forwardRef)(function(p,y){var v=(0,i.useState)(null),w=v[0],C=v[1],R=(0,i.useState)(null),N=R[0],M=R[1],D=(0,o.useCanvasIdentifier)(p.id),F=D[0],z=D[1],q=(0,l.useUnityLoader)(p.unityProvider.loaderUrl),K=(0,i.useCallback)(function(re){p.unityProvider.setLoadingProgression(re),re===1&&p.unityProvider.setIsLoaded(!0)},[p.unityProvider]);return(0,i.useEffect)(function(){var re=function(){return n(void 0,void 0,void 0,function(){var se,ge,X,J,te;return e(this,function(ne){switch(ne.label){case 0:if(!w||N||q!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),p.unityProvider.setUnityInstance(null),M(null),p.unityProvider.setLoadingProgression(0),(te=(J=p.unityProvider).setIsLoaded)===null||te===void 0||te.call(J,!1),p.unityProvider.setInitialisationError(void 0),z(),se={companyName:p.unityProvider.companyName,productName:p.unityProvider.productName,productVersion:p.unityProvider.productVersion,dataUrl:p.unityProvider.dataUrl,frameworkUrl:p.unityProvider.frameworkUrl,codeUrl:p.unityProvider.codeUrl,workerUrl:p.unityProvider.workerUrl,memoryUrl:p.unityProvider.memoryUrl,symbolsUrl:p.unityProvider.symbolsUrl,streamingAssetsUrl:p.unityProvider.streamingAssetsUrl,devicePixelRatio:p.devicePixelRatio,webglContextAttributes:p.unityProvider.webglContextAttributes,cacheControl:p.unityProvider.cacheControl,autoSyncPersistentDataPath:p.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:p.matchWebGLToCanvasSize,disabledCanvasEvents:p.disabledCanvasEvents},Object.keys(se).forEach(function(de){(se[de]===null||se[de]===void 0)&&delete se[de]}),ne.label=1;case 1:return ne.trys.push([1,3,,4]),[4,window.createUnityInstance(w,se,K)];case 2:return ge=ne.sent(),M(ge),p.unityProvider.setUnityInstance(ge),[3,4];case 3:return X=ne.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",X),p.unityProvider.setInitialisationError(X),[3,4];case 4:return[2]}})})},ce=function(){return n(void 0,void 0,void 0,function(){var se,ge,X;return e(this,function(J){switch(J.label){case 0:return!N||!w?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),p.unityProvider.setUnityInstance(null),M(null),p.unityProvider.setLoadingProgression(0),(X=(ge=p.unityProvider).setIsLoaded)===null||X===void 0||X.call(ge,!1),p.unityProvider.setInitialisationError(void 0),se=document.createElement("canvas"),se.id=w.id,se.setAttribute("react-unity-webgl-role","cleanup"),se.style.display="none",document.body.appendChild(se),N.Module.canvas=se,M(null),[4,N.Quit()]);case 1:return J.sent(),document.body.removeChild(se),[2]}})})};return re(),function(){ce()}},[w,N,q,p.unityProvider]),(0,i.useImperativeHandle)(y,function(){return w}),(0,i.createElement)("canvas",{ref:C,id:F,style:p.style,className:p.className,tabIndex:p.tabIndex})});return Rf.Unity=u,Rf}var eC={},Cy={},oZ;function _We(){if(oZ)return Cy;oZ=1;var n=Cy&&Cy.__spreadArray||function(p,y,v){if(v||arguments.length===2)for(var w=0,C=y.length,R;w<C;w++)(R||!(w in y))&&(R||(R=Array.prototype.slice.call(y,0,w)),R[w]=y[w]);return p.concat(R||Array.prototype.slice.call(y))};Object.defineProperty(Cy,"__esModule",{value:!0}),Cy.useEventSystem=void 0;var e=Zf(),i=Oae(),o=[],l=function(p){for(var y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var w=void 0;return o.forEach(function(C){w=C.apply(void 0,n([p],y,!1))}),w};i.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=l);var u=function(){var p=(0,e.useRef)([]),y=(0,e.useCallback)(function(C,R){p.current=n(n([],p.current,!0),[{eventName:C,callback:R}],!1)},[p]),v=(0,e.useCallback)(function(C,R){p.current=p.current.filter(function(N){return N.eventName!==C&&N.callback!==R})},[p]),w=(0,e.useCallback)(function(C){for(var R=[],N=1;N<arguments.length;N++)R[N-1]=arguments[N];var M=p.current.find(function(D){return D.eventName===C});if(!(typeof M>"u"))return M.callback.apply(M,R)},[p]);return(0,e.useEffect)(function(){return o.push(w),function(){o.splice(o.indexOf(w),1)}},[w]),{addEventListener:y,removeEventListener:v}};return Cy.useEventSystem=u,Cy}var aZ;function yWe(){if(aZ)return eC;aZ=1,Object.defineProperty(eC,"__esModule",{value:!0}),eC.useUnityContext=void 0;var n=Zf(),e=_We(),i=function(o){var l=(0,n.useState)(null),u=l[0],p=l[1],y=(0,n.useState)(0),v=y[0],w=y[1],C=(0,n.useState)(!1),R=C[0],N=C[1],M=(0,n.useState)(),D=M[0],F=M[1],z=(0,e.useEventSystem)(),q=(0,n.useRef)({companyName:o.companyName,productName:o.productName,productVersion:o.productVersion,codeUrl:o.codeUrl,dataUrl:o.dataUrl,frameworkUrl:o.frameworkUrl,loaderUrl:o.loaderUrl,memoryUrl:o.memoryUrl,symbolsUrl:o.symbolsUrl,streamingAssetsUrl:o.streamingAssetsUrl,workerUrl:o.workerUrl,webglContextAttributes:o.webglContextAttributes,cacheControl:o.cacheControl,autoSyncPersistentDataPath:o.autoSyncPersistentDataPath,setUnityInstance:p,setLoadingProgression:w,setIsLoaded:N,setInitialisationError:F}),K=(0,n.useCallback)(function(J){return u==null?void 0:u.SetFullscreen(J?1:0)},[u]),re=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Module.canvas)===null||J===void 0?void 0:J.requestPointerLock()},[u]),ce=(0,n.useCallback)(function(J,te,ne){return u==null?void 0:u.SendMessage(J,te,ne)},[u]),se=(0,n.useCallback)(function(J,te){var ne;return(ne=u==null?void 0:u.Module.canvas)===null||ne===void 0?void 0:ne.toDataURL(J,te)},[u]),ge=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Quit())!==null&&J!==void 0?J:Promise.reject()},[u]),X=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.GetMetricsInfo)===null||J===void 0?void 0:J.call(u)},[u]);return{unityProvider:q.current,loadingProgression:v,isLoaded:R,initialisationError:D,requestFullscreen:K,requestPointerLock:re,sendMessage:ce,takeScreenshot:se,unload:ge,getMetricsInfo:X,addEventListener:z.addEventListener,removeEventListener:z.removeEventListener,UNSAFE__unityInstance:u}};return eC.useUnityContext=i,eC}var tC={},cZ;function EWe(){if(cZ)return tC;cZ=1,Object.defineProperty(tC,"__esModule",{value:!0}),tC.useUnityMetricsInfo=void 0;var n=Zf(),e=function(i,o){var l=(0,n.useState)({}),u=l[0],p=l[1];return(0,n.useEffect)(function(){var y=setInterval(function(){var v=i();typeof v>"u"||p(v)},o.interval||1e3);return function(){clearInterval(y)}},[i,o.interval]),u};return tC.useUnityMetricsInfo=e,tC}var lZ;function vWe(){return lZ||(lZ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityMetricsInfo=n.useUnityContext=n.Unity=void 0;var e=gWe();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=yWe();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}});var o=EWe();Object.defineProperty(n,"useUnityMetricsInfo",{enumerable:!0,get:function(){return o.useUnityMetricsInfo}})}(pV)),pV}var Nae=vWe();const nh="[UnityProvider]",YF=O.createContext(),SWe=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:p,showLoginButton:y,showDisruptiveLogo:v})=>{W.log(`${nh} Initializing with spaceID:`,n),W.log(`${nh} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:w,loadingProgression:C,isLoaded:R,sendMessage:N,addEventListener:M,removeEventListener:D,error:F}=Nae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),z={unityProvider:w,loadingProgression:C,isLoaded:R,sendMessage:N,addEventListener:M,removeEventListener:D,error:F,spaceID:n},q=O.useRef(null),K=O.useRef(Date.now());O.useEffect(()=>{const ge=()=>{document.hidden?(W.log(`${nh} Page hidden, starting keep-alive`),re()):(W.log(`${nh} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),ce()}},[]),O.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const re=()=>{q.current||(q.current=setInterval(()=>{R&&document.hidden&&(N("WebGLInputManager","KeepAlive"),W.debug(`${nh} Sent keep-alive message`))},1e4))},ce=()=>{q.current&&(clearInterval(q.current),q.current=null)};O.useEffect(()=>(W.log(`${nh} Component mounted`),()=>{W.log(`${nh} Component unmounting`),ce()}),[]),O.useEffect(()=>{W.log(`${nh} Loading progress:`,C)},[C]),O.useEffect(()=>{R&&(W.log(`${nh} Unity instance loaded for:`,n),document.hidden&&re())},[R,n]),O.useEffect(()=>{F&&W.error(`${nh} Unity error:`,F)},[F]),W.log(`${nh} Rendering provider with instance:`,z),O.useEffect(()=>{W.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const se=[];if(i||se.push("loaderUrl"),o||se.push("dataUrl"),l||se.push("frameworkUrl"),u||se.push("codeUrl"),se.length>0)return W.error(`UnityProvider: Missing required Unity build URLs: ${se.join(", ")}`),S.jsx(YF.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${se.join(", ")}`),spaceID:n},children:e});try{return O.useEffect(()=>{W.log("UnityProvider: Unity context created:",w),w?W.log("UnityProvider: Unity provider is available"):W.error("UnityProvider: Unity provider is not available"),R?W.log("UnityProvider: Unity is loaded"):W.log("UnityProvider: Unity is not loaded yet")},[w,R]),S.jsx(YF.Provider,{value:z,children:e})}catch(ge){return W.error("UnityProvider: Error creating Unity context:",ge),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},Io=()=>O.useContext(YF),pc=()=>{const{sendMessage:n,isLoaded:e}=Io(),i=O.useRef([]),o=O.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:p}=i.current.shift();W.log("useSendUnityEvent: Processing queued event to Unity:",u,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(p)}))}catch(y){W.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:u,data:p});break}}},[n,e]);return O.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),O.useCallback((u,p)=>{W.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:p}),o()},[o])},Uc=()=>{const{addEventListener:n,removeEventListener:e}=Io();return O.useCallback((i,o)=>{const l=u=>{W.log(i+" unity message received.");let p=null;if(u)try{p=JSON.parse(u)}catch(y){W.warn("Failed to parse JSON data from Unity message:",y)}o(p)};return n(i,l),()=>{e(i,l)}},[n,e])},xae=()=>{const[n,e]=O.useState({}),[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(0),v=pc(),w=Uc(),{spaceID:C,sendMessage:R,isLoaded:N}=Io(),M=O.useCallback((q,K)=>{if(!q)return;W.log(`useHLSStream: Sending stream URL to Unity: ${q} for player ${K}`);const re={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:q};if(v("SetHLSStream",re),N&&R)try{W.log("useHLSStream: Sending with ReactIncomingEvent approach"),R("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(re)})),W.log("useHLSStream: Sending with direct HLSStream approach"),R("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:q})),W.log("useHLSStream: Sending with most direct approach possible"),R("LiveProjector","SetStreamUrl",q),R("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:q}))}catch(ce){W.error("useHLSStream: Error with direct message:",ce)}else W.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,R,N]);O.useEffect(()=>{C&&D(C)},[C]);const D=async q=>{try{if(!q){W.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),W.log(`useHLSStream: Loading stream from Firebase for space ${q}`);const K=await fae(q);if(K&&K.streamUrl)if(W.log(`useHLSStream: Loaded stream data from Firebase for space ${q}`,K),u(K),N)W.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{M(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{W.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),M(K.streamUrl,K.playerIndex||"0")},2e3);else{W.warn("useHLSStream: Unity is not loaded yet, will try again later");const re=setInterval(()=>{N&&(W.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),M(K.streamUrl,K.playerIndex||"0"),clearInterval(re))},1e3);setTimeout(()=>{clearInterval(re)},3e4)}else W.log(`useHLSStream: No saved stream found for space ${q}`),u(null)}catch(K){W.error(`useHLSStream: Error loading stream from Firebase for space ${q}`,K)}finally{o(!1)}},F=O.useCallback(async()=>{C&&(W.log(`useHLSStream: Forcing reload of stream data for space ${C}`),y(q=>q+1),await D(C))},[C]),z=O.useCallback(async(q,K=0,re={})=>{try{if(!q||!q.trim()){W.error("useHLSStream: Invalid stream URL");return}o(!0),W.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,q);const{enabled:ce=!0,rtmpUrl:se="",streamKey:ge="",skipSendToUnity:X=!1}=re;if(X||M(q,K),C)try{const J={streamUrl:q,playerIndex:K.toString(),enabled:ce,rtmpUrl:se,streamKey:ge,updatedAt:new Date().toISOString()};W.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,J),await BF(C,J),u(J)}catch(J){throw W.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,J),J}else W.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[M,C]);return O.useEffect(()=>{const K=w("SetHLSStream",re=>{if(re)try{W.log("useHLSStream: Received player status update",re);const{identifier:ce,playerIndex:se,isReady:ge,isPlaying:X}=re,J=`${ce}_${se}`;e(te=>({...te,[J]:{identifier:ce,playerIndex:se,isReady:ge,isPlaying:X}}))}catch(ce){W.error("useHLSStream: Error handling player status update",ce)}});return()=>{K()}},[w]),O.useEffect(()=>{if(l&&l.streamUrl){W.log("useHLSStream: Resending saved stream URL to Unity");const q=setTimeout(()=>{M(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(q)}},[l,n,M,p]),O.useEffect(()=>{const q=K=>{if(K.detail){if(W.log("useHLSStream: Received stream update event",K.detail),C===K.detail.spaceId)W.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),D(C);else if(K.detail.streamUrl){W.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const re=K.detail.playerIndex||"0";M(K.detail.streamUrl,re),u(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",q),window.addEventListener("SpaceStreamUpdated",q),()=>{window.removeEventListener("SpaceHLSStreamUpdated",q),window.removeEventListener("SpaceStreamUpdated",q)}},[C,M]),{setHLSStreamUrl:z,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:F}},bWe=()=>{const[n,e]=O.useState(!1),i=Uc();return O.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{W.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},wWe=()=>{const[n,e]=O.useState(null),i=Uc();return console.log(" Nameplate click hook initialized"),O.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const y=typeof p=="string"?JSON.parse(p):p;e({playerName:y.playerName,playerId:y.playerId,uid:y.uid,isLocalPlayer:y.isLocalPlayer}),console.log(" Processed nameplate data:",y)}catch(y){console.error(" Error processing nameplate data:",y)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},TWe=()=>{const n=Uc(),{sendUserToUnity:e}=O.useContext(ts);return O.useEffect(()=>{const o=n("RequestUserForUnity",async()=>{W.log("React: Request from Unity to send user data"),await e()});return()=>{o()}},[n,e]),!0},uZ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:p=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=gE(),w=Date.now(),C=i.name.split(".").pop(),R=`${e}_${w}.${C}`,N=mE(v,`spaces/${n}/mediaScreens/${R}`);W.log(`Uploading image for media screen ${e} in space ${n}`);const M=await B3(N,i);y=await tx(M.ref);const D=br(Xn,`spaces/${n}/mediaScreens`,e);await Hg(D,{imageUrl:y,gsUrl:`gs://${M.ref.bucket}/${M.ref.fullPath}`,fileName:R,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){y=p;const v=br(Xn,`spaces/${n}/mediaScreens`,e);await Hg(v,{videoUrl:p,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return W.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),y}catch(l){throw W.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},X3=async n=>{W.log(`Getting media screen images for space: ${n}`);try{const e=bl(Xn,`spaces/${n}/mediaScreens`),i=await id(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw W.error("Error fetching media screen images from Firestore:",e),e}},aE=async(n,e)=>{try{const i=br(Xn,`spaces/${n}/mediaScreens`,e),o=await Ko(i);return o.exists()?{id:o.id,...o.data()}:(W.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw W.error("Error fetching media screen image:",i),i}},CWe=async(n,e)=>{try{const i=await aE(n,e);if(!i)return W.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=gE(),u=mE(l,i.gsUrl);try{await z3(u),W.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){W.warn(`Could not delete file from storage: ${p.message}`)}}const o=br(Xn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await mo(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),W.log(`Successfully removed video for media screen ${e}`)):(await mo(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),W.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw W.error("Error deleting media screen image:",i),i}},RWe=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await aE(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return W.warn(`No media screen content found with ID: ${e} to update`),!1;const l=br(Xn,`spaces/${n}/mediaScreens`,e);return await mo(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),W.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw W.error("Error updating media screen display mode:",o),o}},IWe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Dae=()=>{const{spaceID:n}=Io(),e=pc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){W.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{W.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){W.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}W.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await X3(n);W.log("Fetched Media Screen Images",u),u.forEach(p=>{const{id:y,imageUrl:v,displayAsVideo:w,videoUrl:C}=p;let R=null;(!w||!C)&&(R=v?IWe(v):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:R,videoUrl:C||null,displayAsVideo:w||!1,timestamp:Date.now()}),W.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${w})`),w&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),W.log(`Set display mode to video for screen ${y}`))})}catch(u){W.error("Error fetching media screen images:",u)}})()},[e,n,i])},AWe=()=>{const{spaceID:n}=Io(),e=pc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){W.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{W.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){W.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}W.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await pae(n),p=async w=>{const C=`https://vimeo.com/api/oembed.json?url=${w}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch thumbnail: ${R.statusText}`);const N=await R.json(),M=N.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let F=null;for(let z of D){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${q}`,K)}}return F||N.thumbnail_url},y=u.map(async w=>{const C=await p(w.url);return{gameObjectName:w.id,thumbnailUrl:C}}),v=await Promise.all(y);W.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:w,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:w,thumbnailUrl:C})})}catch(u){W.error("Error fetching thumbnails:",u)}})()},[e,n,i])},Lae=()=>{const[n,e]=O.useState([]),i=Uc();return O.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&(W.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=M=>{if(o){W.log("UpdatePlayerList unity message received.");try{let D=[];if(typeof M=="object"&&M!==null?D=M.players||[]:D=JSON.parse(M).players||[],Array.isArray(D)){const F=Array.from(new Map(D.map(z=>[z.playerId,z])).values());e(F),l&&(clearTimeout(l),l=null)}}catch(D){W.error("Error handling player list data:",D),l||(l=setTimeout(u,1e3))}}},y=()=>{W.log("Player disconnected, requesting fresh player list"),u()},v=()=>{W.log("Player left, requesting fresh player list"),u()};u();const w=i("UpdatePlayerList",p),C=i("PlayerDisconnected",y),R=i("PlayerLeft",v),N=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof w=="function"&&w(),typeof C=="function"&&C(),typeof R=="function"&&R(),clearInterval(N)}},[i]),n},Mae=()=>{const n=pc(),e=O.useCallback((o,l,u,p,y,v)=>{const w=u||{x:0,y:1.5,z:0},C=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const N={portalId:o,prefabName:l||"PortalObjectPrefab",position:w,rotation:C,scale:R,initialImageUrl:v};return W.log("Sending portal placement to Unity:",N),n("PlacePortalPrefab",N),!0}catch(N){return W.error("Error placing portal:",N),!1}},[n]),i=O.useCallback((o,l,u,p,y,v)=>{const w=u||{x:0,y:1.5,z:0},C=p||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const N={portalId:o,prefabName:l||"PortalObjectPrefab",position:w,rotation:C,scale:R,initialImageUrl:v},M={eventName:"PlacePortalPrefab",data:JSON.stringify(N)};return W.log("Directly sending portal placement to Unity:",N),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(N){return W.error("Error directly placing portal:",N),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},Uae=()=>{const n=pc(),e=O.useCallback((o,l,u,p,y)=>{const v=u||{x:0,y:0,z:0},w=p||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:w,scale:C};return W.log("Sending seating hotspot placement to Unity:",R),n("SeatingHotspot",R),!0}catch(R){return W.error("Error placing seating hotspot:",R),!1}},[n]),i=O.useCallback((o,l,u,p,y)=>{const v=u||{x:0,y:0,z:0},w=p||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:w,scale:C},N={eventName:"SeatingHotspot",data:JSON.stringify(R)};return W.log("Directly sending seating hotspot placement to Unity:",R),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(N)),!0}catch(R){return W.error("Error directly placing seating hotspot:",R),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},PWe=N3(ZN,"trackAnalytics"),kWe=N3(ZN,"createAnalyticsSession"),OWe=N3(ZN,"endAnalyticsSession"),NWe=async(n,e={})=>{try{W.log(`Creating secure analytics session for space ${n}`);const i=await kWe({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return W.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw W.error("Error creating secure analytics session:",i),i}},xWe=async(n,e,i,o={})=>{try{W.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await PWe({spaceId:n,sessionId:e,eventType:i,eventData:{...o,timestamp:new Date().toISOString(),clientSide:!0}});return W.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw W.error("Error tracking secure analytics event:",l),l}},DWe=async(n,e)=>{try{if(W.log(`Ending secure analytics session: ${e} in space ${n}`),!n||!e)throw W.error("endAnalyticsSessionSecure: Missing required parameters",{spaceId:n,sessionId:e,spaceIdType:typeof n,sessionIdType:typeof e}),new Error(`Missing required parameters: spaceId=${n}, sessionId=${e}`);await OWe({spaceId:n,sessionId:e}),W.log(`Secure analytics session ended: ${e}`)}catch(i){throw W.error("Error ending secure analytics session:",i),i}},co={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change",VIDEO_CLICK:"react_video_click",VIDEO_CLOSE:"react_video_close",BUTTON_CLICK:"react_button_click",FORM_SUBMIT:"react_form_submit",ERROR_OCCURRED:"react_error_occurred"}},lo={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},LWe=async(n,e,i={})=>{try{return W.log(`Creating secure analytics session for user ${e} in space ${n}`),await NWe(n,i)}catch(o){throw W.error("Error creating analytics session:",o),o}},bC=async(n,e,i,o={})=>{try{return W.log(`Tracking secure analytics event: ${i} in space ${n}`),await xWe(n,e,i,o)}catch(l){throw W.error("Error tracking analytics event:",l),l}},dZ=async(n,e)=>{try{W.log(`Ending secure analytics session: ${e} in space ${n}`),await DWe(n,e)}catch(i){throw W.error("Error ending analytics session:",i),i}},MWe=async(n,e,i,o)=>bC(n,e,co.UNITY.VIDEO_PLAY,{userId:i,category:lo.MEDIA_INTERACTION,source:"unity",videoId:o.gameObjectName,videoUrl:o.videoUrl,spaceId:n,...o}),_E=(n,e={})=>{const{user:i}=O.useContext(ts),o=O.useRef(null),[l,u]=O.useState(!1),[p,y]=O.useState(!1),v=O.useRef(!1),w=O.useRef(!1),C=O.useRef(!1),R=O.useRef(!1),{autoStart:N=!0,sessionMetadata:M={},enableDebugLogs:D=!1}=e;O.useEffect(()=>(i&&n&&N&&!o.current&&!C.current&&F(),()=>{o.current&&!R.current&&(D&&W.log("Component unmounting, ending analytics session"),z())}),[i,n,N,D]),O.useEffect(()=>{const X=()=>{document.hidden&&o.current&&!R.current&&(D&&W.log("Page hidden, ending analytics session"),z())},J=()=>{o.current&&!R.current&&(D&&W.log("Page unloading, ending analytics session"),z())};return document.addEventListener("visibilitychange",X),window.addEventListener("beforeunload",J),()=>{document.removeEventListener("visibilitychange",X),window.removeEventListener("beforeunload",J)}},[D]);const F=O.useCallback(async()=>{if(!i||!n||o.current||C.current){D&&W.log("Analytics session already initializing or initialized, skipping");return}try{C.current=!0,y(!0);const X=await LWe(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...M});o.current=X,u(!0),v.current?D&&W.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await bC(n,X,co.REACT.SPACE_ENTER,{userId:i.uid,category:lo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),v.current=!0,D&&W.log(` Analytics: Space entry tracked for session ${X}`)),D&&W.log(`Analytics session initialized: ${X} for space ${n}`)}catch(X){W.error("Failed to initialize analytics session:",X),y(!1)}finally{C.current=!1}},[i,n,M,D]),z=O.useCallback(async()=>{if(D&&W.log("endSession called with:",{sessionId:o.current,spaceId:n,sessionIdType:typeof o.current,spaceIdType:typeof n}),!o.current||!n){D&&W.log("endSession: Missing required parameters, skipping",{sessionId:o.current,spaceId:n});return}if(R.current){D&&W.log("endSession: Already ending session, skipping duplicate call");return}try{R.current=!0,w.current?D&&W.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await bC(n,o.current,co.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:lo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),w.current=!0,D&&W.log(` Analytics: Space exit tracked for session ${o.current}`));const X=o.current;X&&n&&(await dZ(n,X),D&&W.log(`Analytics session ended: ${X}`)),o.current=null,u(!1),y(!1),v.current=!1,w.current=!1}catch(X){W.error("Failed to end analytics session:",X)}finally{R.current=!1}},[n,i==null?void 0:i.uid,D,bC,dZ]),q=O.useCallback(async(X,J={})=>{if(!o.current||!n||!p)return D&&W.warn("Cannot track event: No active analytics session"),null;try{const te=await bC(n,o.current,X,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...J});return D&&W.log(`Analytics event tracked: ${X}`,J),te}catch(te){return W.error("Failed to track analytics event:",te),null}},[n,i==null?void 0:i.uid,p,D]),K=O.useCallback(async X=>{if(!o.current||!n||!p)return D&&W.warn("Cannot track video play: No active analytics session"),null;try{const J=await MWe(n,o.current,i==null?void 0:i.uid,X);return D&&W.log("Video play event tracked:",X),J}catch(J){return W.error("Failed to track video play event:",J),null}},[n,i==null?void 0:i.uid,p,D]),re=O.useCallback(async(X,J={})=>q(X,{...J,source:"unity",category:J.category||lo.USER_BEHAVIOR}),[q]),ce=O.useCallback(async(X,J={})=>q(X,{...J,source:"react",category:J.category||lo.UI_INTERACTION}),[q]),se=O.useCallback(async(X,J,te={})=>{const ne=X==="open"?co.REACT.MODAL_OPEN:co.REACT.MODAL_CLOSE;return ce(ne,{modalName:J,action:X,category:lo.UI_INTERACTION,...te})},[ce]),ge=O.useCallback(async()=>{o.current&&await z(),await F()},[z,F]);return{isInitialized:l,isTracking:p,sessionId:o.current,track:q,trackVideoPlay:K,trackUnityEvent:re,trackReactEvent:ce,trackModal:se,initializeSession:F,endSession:z,restartSession:ge,isReady:l&&p&&o.current!==null}},UWe=n=>{const[e,i]=O.useState(null),{user:o}=O.useContext(ts),l=Uc(),{spaceID:u}=Io(),{trackUnityEvent:p,isReady:y}=_E(u,{enableDebugLogs:!0});return O.useEffect(()=>{let w=!0;const R=l("PlayVideo",async N=>{try{const{gameObjectName:M}=N;if(!M){W.error("Game object name is missing in Unity event data.");return}const D=await pae(u);W.log("SPACES VIDEOS",D);const F=D.find(z=>z.id===M);F&&w?(i(F.url),W.log("Video URL set to:",F.url),y&&o&&(p(co.UNITY.VIDEO_PLAY,{category:lo.MEDIA_INTERACTION,videoId:M,videoUrl:F.url,videoTitle:F.title||F.name||M,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:M,videoMetadata:F}}),W.log(" Analytics: Video play event tracked for:",M))):console.error("Video not found for game object:",M)}catch(M){console.error("Error fetching space videos:",M)}});return()=>{w=!1,R()}},[l,u,n]),[e,()=>{i(null)}]},VWe=()=>{const[n,e]=O.useState(null),[i,o]=O.useState(!1),[l,u]=O.useState(null),p=Uc(),y=pc();O.useEffect(()=>p("KickPlayerResult",R=>{W.log("KickPlayerResult event received:",R),R?(e(R),o(!1),R.success?u(null):u(R.errorMessage||"Failed to kick player")):(W.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[p]);const v=O.useCallback((C,R)=>{var N;try{if(!C){u("Player UID is required");return}o(!0),u(null),e(null);const M={uid:C,requestedBy:R||((N=window.currentUser)==null?void 0:N.uid)};W.log("Sending KickPlayer event to Unity:",M),y("KickPlayer",M)}catch(M){W.error("Error kicking player:",M),u(M.message||"Failed to send kick request"),o(!1)}},[y]),w=O.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:v,isKicking:i,kickResult:n,error:l,resetKickState:w}},FWe=n=>{const{placePortal:e}=Mae();O.useEffect(()=>{const i=async()=>{try{const o=bl(Xn,"spaces",n,"portals"),l=await id(o);if(l.empty){W.log("useSpacePortals: No portals found for space:",n);return}W.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const p=u.data();W.log(`useSpacePortals: Placing portal ${p.portalId} in Unity:`,p),e(p.portalId,p.prefabName,p.position,p.rotation,p.scale)})}catch(o){W.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)W.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{W.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Vae=async(n,e)=>{console.log(" fetchPortalAnalyticsData called with:",{spaceId:n,portalId:e});let i=null,o=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=br(Xn,"spaces",n,"portals",e);console.log(" Querying Firestore path:",`spaces/${n}/portals/${e}`);const p=await Ko(u);if(p.exists()){const y=p.data();i=y.targetSpaceId,o=y.targetSpaceName,console.log(" Portal data fetched from Firestore:",{targetSpaceId:i,targetSpaceName:o})}else{console.warn(" Portal document not found in Firestore for:",e);const y=e.split("_");y.length>=3&&(i=y[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const p=e.split("_");p.length>=3&&(i=p[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}const l={targetSpaceId:i,targetSpaceName:o};return console.log(" fetchPortalAnalyticsData returning:",l),l},jWe=()=>{const[n,e]=O.useState(null),{user:i}=O.useContext(ts),o=Uc(),{spaceID:l}=Io(),{trackUnityEvent:u,isReady:p}=_E(l,{enableDebugLogs:!0});return O.useEffect(()=>{console.log("Setting up portal click listener...");const w=o("PortalClicked",async C=>{console.log("Portal click event received:",C);try{const R=typeof C=="string"?JSON.parse(C):C;if(console.log("Parsed portal data:",R),e(R),p&&i&&R&&R.portalId)try{const{targetSpaceId:N,targetSpaceName:M}=await Vae(l,R.portalId);await u(co.UNITY.PORTAL_CLICK,{category:lo.NAVIGATION,portalId:R.portalId,targetSpaceId:N,targetSpaceName:M,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked for:",R.portalId,"targeting:",M||N)}catch(N){console.error(" Analytics: Error tracking portal click:",N);try{await u(co.UNITY.PORTAL_CLICK,{category:lo.NAVIGATION,portalId:R.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked (fallback) for:",R.portalId)}catch(M){console.error(" Analytics: Failed to track portal click even with fallback:",M)}}}catch(R){console.error("Error parsing portal click data:",R,"Data:",C)}});return()=>{console.log("Cleaning up portal click listener"),typeof w=="function"&&w()}},[o,p,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),e(null)},isAnalyticsReady:p,trackPortalClick:u}},BWe=()=>{const{user:n}=O.useContext(ts),e=Uc(),{spaceID:i}=Io(),{trackUnityEvent:o,isReady:l}=_E(i,{enableDebugLogs:!0});O.useEffect(()=>{console.log("Setting up portal navigation listener...");const p=e("PortalNavigate",async y=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const v=typeof y=="string"?JSON.parse(y):y;if(console.log("Portal data:",v),!v.portalId){console.error("Portal ID is missing from portal data");return}let w=null,C=null;try{const R=await Vae(i,v.portalId);w=R.targetSpaceId,C=R.targetSpaceName}catch(R){console.error("Error fetching portal analytics data:",R);const N=v.portalId.split("_");N.length>=3&&(w=N[2])}if(w){if(console.log("Navigating to space:",w,`(${C||"Unknown space name"})`),l&&n&&v)try{await o(co.UNITY.PORTAL_NAVIGATE,{category:lo.NAVIGATION,portalId:v.portalId,targetSpaceId:w,targetSpaceName:C,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",v.portalId,"",C||w)}catch(R){console.error(" Analytics: Error tracking portal navigation:",R)}window.location.href=`/?spaceId=${w}`}else console.error("Could not determine target space ID from portal:",v.portalId)}catch(v){console.error("Error handling portal navigation:",v)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof p=="function"&&p()}},[e,l,n,i,o])},zWe=n=>{const{placeCatalogueItem:e}=Uae();O.useEffect(()=>{const i=async()=>{try{const o=bl(Xn,"spaces",n,"catalogue"),l=await id(o);if(l.empty){W.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}W.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(u=>{const p=u.data();W.log(`useSpaceCatalogueItems: Placing item ${p.itemId} in Unity:`,p),e(p.itemId,p.glbUrl,p.position,p.rotation,p.scale)})}catch(o){W.error("useSpaceCatalogueItems: Error loading catalogue items:",o)}};if(window.unityInstance)W.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const o=()=>{W.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Fae=()=>{const[n,e]=O.useState(null),i=Uc();return O.useEffect(()=>{W.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async p=>{W.log(" Seating hotspot click event received from Unity:",p);try{const y=typeof p=="string"?JSON.parse(p):p;W.log(" Parsed Unity click data:",y);const v=y.hotspotId.split("_");if(v.length>=3){const w=v.slice(1,-1).join("_");W.log(" Extracted spaceId:",w);const C=br(Xn,"spaces",w,"catalogue",y.hotspotId);W.log(" Fetching from Firebase path:",`spaces/${w}/catalogue/${y.hotspotId}`);const R=await Ko(C);if(R.exists()){const N=R.data();W.log(" Fetched Firebase data:",N),W.log(" Firebase position:",N.position),W.log(" Unity position:",y.position);const M={...y,position:N.position||y.position,rotation:N.rotation||y.rotation,scale:N.scale||y.scale};W.log(" Combined data being set:",M),e(M)}else W.warn(" Item not found in Firebase:",y.hotspotId),e(y)}else W.error(" Invalid hotspot ID format:",y.hotspotId),e(y)}catch(y){W.error(" Error handling seating hotspot click:",y,"Data:",p)}});return()=>{W.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{W.log("Clearing clicked item state"),e(null)}}},WWe=n=>({opacity:1});function GWe(){const{loadingProgression:n,isLoaded:e,error:i,spaceID:o}=Io(),{user:l}=O.useContext(ts),[u,p]=O.useState(!1),[y,v]=O.useState(!1),[w,C]=O.useState(!1),[R,N]=O.useState(!1),M=O.useRef(!1),D=O.useRef(!1),F=O.useRef(null),z=O.useRef(null),q=O.useRef(null),K=Uc(),re=O.useRef(null),ce=O.useRef(null),se=O.useRef(null);O.useRef(null),O.useEffect(()=>{(async()=>{if(!l&&n===0)try{const te=await Ua(o);te&&te.allowGuestUsers===!0?(console.log("LoaderProgress: Guest users confirmed allowed, not showing sign-in prompt"),p(!1)):(console.log("LoaderProgress: Guest users not allowed or space data invalid, showing sign-in prompt"),p(!0))}catch(te){console.error("LoaderProgress: Cannot verify space guest access, showing sign-in prompt for security:",te),p(!0)}else p(!1)})()},[l,n,o]),O.useEffect(()=>{const J=document.createElement("style");return J.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(J),re.current=J,()=>{re.current&&document.head.removeChild(re.current)}},[]),O.useEffect(()=>{const J=()=>{const te=document.getElementById("unity-canvas"),ne=document.getElementById("unity-container");te&&(F.current=te,te.style.zIndex="1"),ne&&(z.current=ne,ne.style.zIndex="1"),te&&ne&&se.current&&(clearInterval(se.current),se.current=null)};return J(),se.current=setInterval(J,100),()=>{se.current&&(clearInterval(se.current),se.current=null)}},[]),O.useEffect(()=>{window.isFirstSceneLoaded&&(D.current=!0,N(!0));const te=K("FirstSceneLoaded",()=>{D.current=!0,N(!0),window.isFirstSceneLoaded=!0}),ne=setTimeout(()=>{D.current||(D.current=!0,N(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{te(),clearTimeout(ne)}},[K]),O.useEffect(()=>{window.isPlayerInstantiated&&(M.current=!0,C(!0),D.current||(D.current=!0,N(!0),window.isFirstSceneLoaded=!0));const J=()=>{M.current=!0,C(!0),D.current||(D.current=!0,N(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",J);const te=K("PlayerInstantiated",J),ne=setTimeout(()=>{M.current||(M.current=!0,C(!0),D.current||(D.current=!0,N(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",J),te(),clearTimeout(ne)}},[K]),O.useEffect(()=>(R&&w&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ce.current&&clearTimeout(ce.current),ce.current=setTimeout(()=>{F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="1",z.current.style.removeProperty("opacity")),q.current&&(q.current.style.opacity="0",q.current.style.pointerEvents="none",setTimeout(()=>{q.current&&(q.current.style.display="none")},1500))},2e3)),()=>{ce.current&&clearTimeout(ce.current)}),[R,w]);const ge=()=>e?e&&!R&&!w?"Scene initializing":R&&!w?"Player initializing":"Ready":"World loading",X=()=>e?e&&!R&&!w?85:R&&!w?95:100:n*80;return S.jsx(S.Fragment,{children:u?S.jsx(st,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(Rr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx(Ke,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx(Ke,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx(In,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>v(!0),children:"Sign In"})]})}):S.jsx(st,{ref:q,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(Mr,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx(Ke,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx(Ke,{fontSize:"sm",children:ge()}),S.jsx(qy,{value:X(),size:"lg",width:"100%",marginY:2})]})})})}function HWe(){const{user:n,currentUser:e,isGuestUser:i}=O.useContext(ts),[o,l]=O.useState(!1),[u,p]=O.useState(!1),[y,v]=O.useState(!0),[w,C]=O.useState(null);return O.useEffect(()=>{const N=(()=>{try{const M=document.getElementById("webgl-root");if(M){const K=M.getAttribute("data-space-id");if(K)return console.log("AuthenticationButton: Found space ID from webgl-root element:",K),K}const F=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(F)return console.log("AuthenticationButton: Found space ID from URL path:",F[2]),F[2];const z=new URLSearchParams(window.location.search),q=z.get("spaceId")||z.get("space");return q?(console.log("AuthenticationButton: Found space ID from URL params:",q),q):(console.log("AuthenticationButton: No space ID found in DOM or URL"),null)}catch(M){return console.error("AuthenticationButton: Error getting space ID:",M),null}})();console.log("AuthenticationButton: Setting space ID to:",N),C(N)},[]),O.useEffect(()=>{const R=async()=>{if(!w){console.log("AuthenticationButton: No space ID available, skipping guest access check");return}console.log("AuthenticationButton: Fetching space data for space ID:",w);try{const M=await Ua(w);console.log("AuthenticationButton: Raw space data received:",M),console.log("AuthenticationButton: Space data loaded:",{spaceId:w,allowGuestUsers:M==null?void 0:M.allowGuestUsers,hideGuestSignInButton:M==null?void 0:M.hideGuestSignInButton,showAuthButton:M==null?void 0:M.showAuthButton}),l((M==null?void 0:M.allowGuestUsers)||!1),p((M==null?void 0:M.hideGuestSignInButton)||!1),v((M==null?void 0:M.showAuthButton)!==void 0?M.showAuthButton:!0)}catch(M){console.error("AuthenticationButton: Error fetching space data:",M),console.log("AuthenticationButton: Cannot check guest access, defaulting to false"),l(!1),p(!1)}};R();const N=()=>{console.log("AuthenticationButton: Space settings changed, refreshing..."),R()};return window.addEventListener("SpaceSettingsChanged",N),()=>{window.removeEventListener("SpaceSettingsChanged",N)}},[w]),n&&e&&!i(e)?y?S.jsx("div",{children:S.jsx(q3,{})}):null:e&&i(e)?(console.log("AuthenticationButton: Guest user detected, hideGuestSignInButton:",u),u?(console.log("AuthenticationButton: Hiding sign-in button for guest user"),null):(console.log("AuthenticationButton: Showing sign-in button for guest user"),S.jsx("div",{children:S.jsx(W0,{mode:"button",label:"Sign In",buttonProps:{bg:"black",color:"white",borderRadius:"lg",_hover:{bg:"gray.800"},_active:{bg:"gray.900"}}})}))):o||!y?null:S.jsxs("div",{children:[S.jsx(ox,{}),S.jsx(W0,{})]})}function $We(){const{fullscreenRef:n}=fh(),[e,i]=O.useState(!1),o=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(xc,{"aria-label":"Controller Help",icon:S.jsx(k8e,{}),onClick:o,variant:"iconButton"})}),S.jsxs(us,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[S.jsx(hs,{}),S.jsxs(ds,{children:[S.jsx(fo,{children:"Notes"}),S.jsx(Os,{}),S.jsx(ys,{children:S.jsx(Ke,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(uh,{children:S.jsx(In,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var jae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},hZ=bi.createContext&&bi.createContext(jae),Dg=function(){return Dg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Dg.apply(this,arguments)},KWe=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function Bae(n){return n&&n.map(function(e,i){return bi.createElement(e.tag,Dg({key:i},e.attr),Bae(e.child))})}function Ur(n){return function(e){return bi.createElement(qWe,Dg({attr:Dg({},n.attr)},e),Bae(n.child))}}function qWe(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,p=KWe(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),bi.createElement("svg",Dg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,p,{className:v,style:Dg(Dg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),u&&bi.createElement("title",null,u),n.children)};return hZ!==void 0?bi.createElement(hZ.Consumer,null,function(i){return e(i)}):e(jae)}function zae(n){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function YWe(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function pZ(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function fZ(n){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function XF(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function XWe(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function JWe(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function QWe(n){return Ur({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function ZWe(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Wae(n){return Ur({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function eGe(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function tGe(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Gae(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function Hae(n){return Ur({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function nGe(n){return Ur({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function rGe(n){return Ur({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function iGe(n){return Ur({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function JF(n){return Ur({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function sGe(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function oGe(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function aGe(n){return Ur({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function $ae({open:n,onClose:e}){const i=O.useRef(null),o=pc(),{user:l}=O.useContext(ts),u=v=>{i.current&&!i.current.contains(v.target)&&e()},p=async v=>{const w=y(v);if((w==null?void 0:w.source)==="readyplayerme"&&(w.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),w.eventName==="v1.avatar.exported")){const C=w.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await Yoe(l.uid,C),e()}catch(R){console.error("Error updating RPM URL:",R)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return O.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",p)}),[n]),n&&S.jsx(Mc,{children:S.jsx(st,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:S.jsx(st,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function cGe({isOpen:n,onClose:e}){const[i,o]=O.useState(!1),[l,u]=O.useState(null),{user:p}=O.useContext(ts),y=pc(),v=D=>{D.stopPropagation(),o(!0)},w=()=>{o(!1),e()},C=async D=>{if(u(D),p&&p.uid)try{await Yoe(p.uid,D.url),y("AvatarUrlFromReact",{url:D.url}),e()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},R=Cg("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",M=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(Mc,{children:S.jsxs(us,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"900px",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Customise Your Avatar"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{pb:4,children:S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsx(Ke,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(bre,{columns:5,spacing:2,children:[S.jsx(st,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:R,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(Rr,{spacing:1,children:[S.jsx(yn,{as:rGe,boxSize:4}),S.jsx(Ke,{fontSize:"xs",children:"Create Custom Avatar"})]})}),M.map(D=>S.jsxs(st,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===D.id?"blue.400":R,borderRadius:"lg",overflow:"hidden",onClick:()=>C(D),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(bp,{src:D.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:D.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx(st,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx(Ke,{fontSize:"xs",children:D.name})})]},D.id))]})]})})]})]})}),i&&S.jsx($ae,{open:i,onClose:w})]})}function lGe(){const{fullscreenRef:n}=fh(),[e,i]=O.useState(!1),[o,l]=O.useState(!1),[u,p]=O.useState(!1),[y,v]=O.useState(!1),{user:w,currentUser:C,isGuestUser:R}=O.useContext(ts),[N,M]=O.useState(null),[D,F]=O.useState(!0),z=(se,ge)=>!se||!ge?"?":`${se.charAt(0)}${ge.charAt(0)}`.toUpperCase(),q=se=>{if(!se)return"G";if(se.startsWith("Visitor_")){const ge=se.split("_")[1];return`V${ge?ge.charAt(0):""}`}return se.charAt(0).toUpperCase()},K=async()=>{if(F(!0),w!=null&&w.uid)try{const se=await ou(w.uid);M({rpmURL:se.rpmURL?se.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:se.firstName,lastName:se.lastName,isGuest:!1})}catch(se){console.error("Error fetching profile data:",se)}else C&&R(C)&&M({rpmURL:C.rpmURL?C.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:"Guest",lastName:"User",username:C.username||C.Nickname,isGuest:!0});F(!1)};O.useEffect(()=>{K()},[w==null?void 0:w.uid,C==null?void 0:C.uid,C==null?void 0:C.rpmURL]),O.useEffect(()=>{const se=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",se),()=>{window.removeEventListener("PlayerInstantiated",se)}},[]);const re=()=>l(!o),ce=()=>{l(!1),K()};return e?S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:N!=null&&N.isGuest?"Guest Avatar":"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:S.jsxs(st,{position:"relative",onMouseEnter:()=>{p(!0),v(!0)},onMouseLeave:()=>{p(!1),v(!1)},cursor:N!=null&&N.isGuest?"default":"pointer",onClick:N!=null&&N.isGuest?void 0:re,children:[S.jsx(yl,{src:D||N==null?void 0:N.rpmURL,size:"md",borderRadius:"full",bg:"white",name:!D&&N?N.isGuest?q(N.username):z(N.firstName,N.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&!(N!=null&&N.isGuest)&&S.jsx(st,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx(Ke,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(cGe,{isOpen:o,onClose:ce})]}):null}function uGe(n){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function dGe(n){return Ur({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function hGe(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=fh(),l=ja();O.useEffect(()=>{const p=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(Ff,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(xc,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(uGe,{}):S.jsx(dGe,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const mZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function pGe(){const{isOpen:n,onOpen:e,onClose:i}=sd(),{fullscreenRef:o}=fh(),[l,u]=UWe(!1),{user:p}=O.useContext(ts),{spaceID:y}=Io(),{trackReactEvent:v,isReady:w}=_E(y,{enableDebugLogs:!0});O.useEffect(()=>{W.log("VideoPlayer: Current video URL:",l),l&&(W.log("VideoPlayer: Opening modal for video URL:",l),e(),w&&p&&(v(co.REACT.VIDEO_CLICK,{category:lo.MEDIA_INTERACTION,action:"video_player_open",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),W.log(" Analytics: Video click event tracked for modal open:",l)))},[l,e,v,w,p,y]);const C=()=>{W.log("VideoPlayer: Closing modal"),w&&p&&l&&(v(co.REACT.VIDEO_CLOSE,{category:lo.MEDIA_INTERACTION,action:"video_player_close",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),W.log(" Analytics: Video close event tracked for modal close:",l)),u(),i()};return S.jsx(Mc,{containerRef:o,children:S.jsxs(us,{isOpen:n,onClose:C,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(ds,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx(Os,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(ys,{p:0,width:"100%",children:l&&S.jsx(st,{style:mZ.iframeContainer,children:S.jsx("iframe",{src:l,style:mZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function fGe({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,p]=O.useState(null),[y,v]=O.useState(!0),[w,C]=O.useState(null);return O.useEffect(()=>{n&&(async()=>{if(v(!0),C(null),!l){W.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),v(!1);return}try{W.log("NameplateModal: Fetching profile for UID:",l);const N=await ou(l);N?p({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(N){W.error("Error fetching profile data:",N),C("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),S.jsxs(us,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(hs,{backdropFilter:"blur(10px)"}),S.jsxs(ds,{bg:"gray.900",color:"white",borderRadius:"xl",children:[S.jsx(fo,{children:"Player Info"}),S.jsx(Os,{}),S.jsx(ys,{pb:6,children:y?S.jsx(Bne,{py:8,children:S.jsx(cd,{size:"xl",color:"blue.400"})}):w?S.jsxs(Ig,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(Ag,{}),w]}):S.jsxs(Rr,{spacing:4,align:"center",children:[S.jsx(yl,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsxs(Rr,{spacing:1,children:[S.jsx(Ke,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&S.jsxs(Ke,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),S.jsxs(Ke,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&S.jsxs(S.Fragment,{children:[S.jsx(Ug,{borderColor:"whiteAlpha.300"}),S.jsxs(Bn,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&S.jsx(eu,{href:u.linkedinUrl,isExternal:!0,children:S.jsx(xc,{icon:S.jsx(zae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&S.jsx(eu,{href:u.websiteUrl,isExternal:!0,children:S.jsx(xc,{icon:S.jsx(Wae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const mGe=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=gLe("(max-width: 768px)"),[l,u]=O.useState(!1);O.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const p=o||l,y=Lae(),[v,w]=O.useState(!1),[C,R]=O.useState([]),[N,M]=O.useState(!1),[D,F]=O.useState({}),[z,q]=O.useState({}),[K,re]=O.useState(!1),ce=ja(),[se,ge]=O.useState(null),[X,J]=O.useState(null),{isOpen:te,onOpen:ne,onClose:de}=sd(),[pe,he]=O.useState(null),{isOpen:ve,onOpen:Te,onClose:Fe}=sd(),[be,Re]=O.useState(null),Ae=window.currentUser||{},Ee=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";O.useEffect(()=>{Ua(Ee).then(ct=>re(!!(ct!=null&&ct.voiceDisabled)))},[Ee]),O.useEffect(()=>{const ct=()=>w(!0);return window.addEventListener("PlayerInstantiated",ct),window.isPlayerInstantiated&&w(!0),()=>window.removeEventListener("PlayerInstantiated",ct)},[]),O.useEffect(()=>{const ct={};y.forEach(Ft=>{var sn;Ft.uid&&((sn=window.agoraClient)!=null&&sn.client)&&(ct[Ft.uid]=Ft.isLocalPlayer?window.agoraClient.client.uid:Ft.uid)}),q(ct)},[y]),O.useEffect(()=>{const ct=setInterval(()=>{var Ft;if(window.agoraClient){M(!!window.agoraClient.isVoiceEnabled);const sn={};(Ft=window.agoraClient.client)==null||Ft.remoteUsers.forEach(Ht=>{sn[Ht.uid]=!!Ht.audioTrack&&!Ht.audioTrack.muted}),F(sn)}},500);return()=>clearInterval(ct)},[]),O.useEffect(()=>{(async()=>{const Ft=await Promise.all(y.map(async sn=>{var Ht,we;if(!sn.uid)return sn;try{const De=await ou(sn.uid),$e=`space_${Ee}_owners`,kt=`space_${Ee}_hosts`,At=(Ht=De.groups)!=null&&Ht.includes($e)?"owner":(we=De.groups)!=null&&we.includes(kt)?"host":null,Tt=De.rpmURL?De.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...sn,...De,rpmURL:Tt,role:At}}catch{return sn}}));R(Ft)})()},[y,Ee]);const{kickPlayer:Ne,isKicking:je,kickResult:qe,error:at,resetKickState:_t}=VWe();O.useEffect(()=>{qe!=null&&qe.success&&(se||be)&&(se&&(ce({title:"Remove Successful",description:`${se} has been removed.`,status:"success",duration:3e3,isClosable:!0}),ge(null)),be&&(ce({title:"Ban Successful",description:`${be} has been banned.`,status:"success",duration:3e3,isClosable:!0}),Re(null)),_t()),at&&(ce({title:"Error",description:at,status:"error",duration:3e3,isClosable:!0}),ge(null),Re(null),_t())},[qe,at,se,be,ce,_t]);const ut=ct=>ct.isLocalPlayer||ct.uid===Ae.uid,vt=ct=>ut(ct)?N:D[z[ct.uid]],it=({role:ct})=>ct==="owner"?S.jsx(yn,{as:XF,color:"green.400",boxSize:3,ml:1}):ct==="host"?S.jsx(yn,{as:JF,color:"purple.400",boxSize:3,ml:1}):null,wt=({role:ct})=>ct==="owner"?S.jsxs(Bn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(yn,{as:XF,color:"green.300"}),S.jsx(ih,{colorScheme:"green",variant:"solid",children:"Owner"})]}):ct==="host"?S.jsxs(Bn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(yn,{as:JF,color:"purple.300"}),S.jsx(ih,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,$t=()=>{X&&(ge(X.playerName),Ne(X.uid,Ae.uid),de())},dt=async()=>{pe&&(Re(pe.playerName),await m8e(Ee,{uid:pe.uid,playerName:pe.playerName,bannedAt:new Date().toISOString(),...Ae.uid&&{bannedBy:Ae.uid}}),Ne(pe.uid,Ae.uid),Fe())},mt=(ct,Ft)=>{var Ht;if(!(((Ht=C.find(we=>we.isLocalPlayer))==null?void 0:Ht.role)==="owner"))return ce({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});ct==="remove"?(J(Ft),ne()):ct==="ban"&&(he(Ft),Te())};return S.jsxs(S.Fragment,{children:[S.jsxs(st,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!p?"visible":"hidden",role:"group",children:[S.jsx(st,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(xc,{icon:S.jsx(P8e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),S.jsxs(Ke,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),S.jsx(st,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(Rr,{align:"stretch",spacing:1,width:"100%",children:C.sort((ct,Ft)=>ct.isLocalPlayer?-1:Ft.isLocalPlayer?1:0).map((ct,Ft)=>{var De;const sn=ut(ct),Ht=((De=C.find($e=>$e.isLocalPlayer))==null?void 0:De.role)==="owner"&&!sn&&ct.role!=="owner",we=!K&&vt(ct);return S.jsx(st,{children:S.jsxs(Zre,{placement:"left",trigger:"hover",children:[S.jsx(iie,{children:S.jsxs(Bn,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[S.jsx(yl,{size:"xs",bg:"whiteAlpha.400",src:ct.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx(Ke,{fontSize:"xs",children:ct.playerName}),S.jsx(it,{role:ct.role}),S.jsx(d0,{}),!K&&(we?S.jsx(st,{color:"green.400",children:S.jsx(Hae,{})}):S.jsx(st,{color:"red.400",children:S.jsx(Gae,{})})),sn?S.jsx(Ke,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):Ht?S.jsxs(jR,{children:[S.jsx(BR,{as:xc,"aria-label":"Options",icon:S.jsx(QWe,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),S.jsxs(zR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[S.jsx(Ep,{icon:S.jsx(sGe,{}),onClick:()=>mt("remove",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),S.jsx(Ep,{icon:S.jsx(YWe,{}),onClick:()=>mt("ban",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),S.jsx(rie,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:S.jsx(tie,{children:S.jsxs(Rr,{align:"center",spacing:3,children:[S.jsx(yl,{size:"lg",src:ct.rpmURL}),S.jsx(Ke,{fontWeight:"bold",children:ct.playerName}),S.jsx(wt,{role:ct.role}),ct.firstName&&S.jsxs(Ke,{fontSize:"sm",color:"gray.300",children:[ct.firstName," ",ct.lastName]}),S.jsxs(Bn,{spacing:4,pt:2,children:[ct.linkedInProfile&&S.jsx(eu,{href:ct.linkedInProfile,isExternal:!0,children:S.jsx(yn,{as:zae})}),ct.websiteUrl&&S.jsx(eu,{href:ct.websiteUrl,isExternal:!0,children:S.jsx(yn,{as:Wae})})]})]})})})]})},Ft)})})})]}),S.jsxs(us,{isOpen:te,onClose:de,isCentered:!0,children:[S.jsx(hs,{}),S.jsxs(ds,{bg:"gray.800",color:"white",children:[S.jsx(fo,{children:"Confirm Removal"}),S.jsx(Os,{}),S.jsx(ys,{children:S.jsxs(Ke,{children:["Remove ",X==null?void 0:X.playerName," from the room?"]})}),S.jsxs(uh,{children:[S.jsx(In,{colorScheme:"red",onClick:$t,isLoading:je,mr:3,children:"Remove"}),S.jsx(In,{bg:"white",color:"gray.800",onClick:de,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),S.jsxs(us,{isOpen:ve,onClose:Fe,isCentered:!0,children:[S.jsx(hs,{}),S.jsxs(ds,{bg:"gray.800",color:"white",children:[S.jsx(fo,{children:"Confirm Ban"}),S.jsx(Os,{}),S.jsx(ys,{children:S.jsxs(Ke,{children:["Ban ",pe==null?void 0:pe.playerName," from the room? They will not be able to re-enter."]})}),S.jsxs(uh,{children:[S.jsx(In,{colorScheme:"red",onClick:dt,isLoading:je,mr:3,children:"Ban"}),S.jsx(In,{bg:"white",color:"gray.800",onClick:Fe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var Zk={exports:{}},gGe=Zk.exports,gZ;function _Ge(){return gZ||(gZ=1,function(n,e){(function(i,o){n.exports=o()})(gGe,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ny<"u"?Ny:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},p=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),y=p,v=Function.prototype,w=v.call,C=y&&v.bind.bind(w,w),R=y?C:function(t){return function(){return w.apply(t,arguments)}},N=R({}.isPrototypeOf),M=function(t){return t&&t.Math===Math&&t},D=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof o=="object"&&o)||M(typeof o=="object"&&o)||function(){return this}()||Function("return this")(),F=p,z=Function.prototype,q=z.apply,K=z.call,re=typeof Reflect=="object"&&Reflect.apply||(F?K.bind(q):function(){return K.apply(q,arguments)}),ce=R,se=ce({}.toString),ge=ce("".slice),X=function(t){return ge(se(t),8,-1)},J=X,te=R,ne=function(t){if(J(t)==="Function")return te(t)},de=typeof document=="object"&&document.all,pe=de===void 0&&de!==void 0?function(t){return typeof t=="function"||t===de}:function(t){return typeof t=="function"},he={},ve=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Te=p,Fe=Function.prototype.call,be=Te?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},Re={},Ae={}.propertyIsEnumerable,xe=Object.getOwnPropertyDescriptor,Ee=xe&&!Ae.call({1:2},1);Re.f=Ee?function(t){var r=xe(this,t);return!!r&&r.enumerable}:Ae;var Ne,je,qe=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},at=u,_t=X,ut=Object,vt=R("".split),it=at(function(){return!ut("z").propertyIsEnumerable(0)})?function(t){return _t(t)==="String"?vt(t,""):ut(t)}:ut,wt=function(t){return t==null},$t=wt,dt=TypeError,mt=function(t){if($t(t))throw new dt("Can't call method on "+t);return t},ct=it,Ft=mt,sn=function(t){return ct(Ft(t))},Ht=pe,we=function(t){return typeof t=="object"?t!==null:Ht(t)},De={},$e=De,kt=D,At=pe,Tt=function(t){return At(t)?t:void 0},Ut=function(t,r){return arguments.length<2?Tt($e[t])||Tt(kt[t]):$e[t]&&$e[t][r]||kt[t]&&kt[t][r]},Sn=D.navigator,Pn=Sn&&Sn.userAgent,hn=Pn?String(Pn):"",Rt=D,Zn=hn,Dt=Rt.process,Xt=Rt.Deno,Vr=Dt&&Dt.versions||Xt&&Xt.version,Oi=Vr&&Vr.v8;Oi&&(je=(Ne=Oi.split("."))[0]>0&&Ne[0]<4?1:+(Ne[0]+Ne[1])),!je&&Zn&&(!(Ne=Zn.match(/Edge\/(\d+)/))||Ne[1]>=74)&&(Ne=Zn.match(/Chrome\/(\d+)/))&&(je=+Ne[1]);var li=je,Ni=li,Es=u,Yo=D.String,qi=!!Object.getOwnPropertySymbols&&!Es(function(){var t=Symbol("symbol detection");return!Yo(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Ni&&Ni<41}),xi=qi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Kn=Ut,ps=pe,ha=N,Xo=Object,go=xi?function(t){return typeof t=="symbol"}:function(t){var r=Kn("Symbol");return ps(r)&&ha(r.prototype,Xo(t))},ld=String,Jo=function(t){try{return ld(t)}catch{return"Object"}},ud=pe,fc=Jo,Ao=TypeError,wr=function(t){if(ud(t))return t;throw new Ao(fc(t)+" is not a function")},uu=wr,pa=wt,Ba=function(t,r){var s=t[r];return pa(s)?void 0:uu(s)},Vc=be,Qo=pe,Zo=we,dd=TypeError,gh={exports:{}},Tl=D,_h=Object.defineProperty,xs=D,pt=function(t,r){try{_h(Tl,t,{value:r,configurable:!0,writable:!0})}catch{Tl[t]=r}return r},rn="__core-js_shared__",kr=gh.exports=xs[rn]||pt(rn,{});(kr.versions||(kr.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Di=gh.exports,mc=Di,_o=function(t,r){return mc[t]||(mc[t]=r||{})},Cl=mt,yh=Object,Ks=function(t){return yh(Cl(t))},Gr=Ks,Eh=R({}.hasOwnProperty),Hr=Object.hasOwn||function(t,r){return Eh(Gr(t),r)},fa=R,Yi=0,vs=Math.random(),ri=fa(1 .toString),Fc=function(t){return"Symbol("+(t===void 0?"":t)+")_"+ri(++Yi+vs,36)},ma=_o,jp=Hr,Po=Fc,Bp=qi,nm=xi,Rl=D.Symbol,du=ma("wks"),vh=nm?Rl.for||Rl:Rl&&Rl.withoutSetter||Po,Or=function(t){return jp(du,t)||(du[t]=Bp&&jp(Rl,t)?Rl[t]:vh("Symbol."+t)),du[t]},hd=be,pd=we,za=go,ga=Ba,fd=function(t,r){var s,a;if(Qo(s=t.toString)&&!Zo(a=Vc(s,t))||Qo(s=t.valueOf)&&!Zo(a=Vc(s,t)))return a;throw new dd("Can't convert object to primitive value")},Il=TypeError,hu=Or("toPrimitive"),ui=function(t,r){if(!pd(t)||za(t))return t;var s,a=ga(t,hu);if(a){if(s=hd(a,t,r),!pd(s)||za(s))return s;throw new Il("Can't convert object to primitive value")}return fd(t)},pu=go,fr=function(t){var r=ui(t,"string");return pu(r)?r:r+""},Al=we,Sh=D.document,bh=Al(Sh)&&Al(Sh.createElement),fu=function(t){return bh?Sh.createElement(t):{}},rm=fu,zp=!ve&&!u(function(){return Object.defineProperty(rm("div"),"a",{get:function(){return 7}}).a!==7}),Wp=ve,_a=be,Ss=Re,ya=qe,Ea=sn,mu=fr,va=Hr,Wa=zp,Gp=Object.getOwnPropertyDescriptor;he.f=Wp?Gp:function(t,r){if(t=Ea(t),r=mu(r),Wa)try{return Gp(t,r)}catch{}if(va(t,r))return ya(!_a(Ss.f,t,r),t[r])};var jc=u,Ds=pe,Zg=/#|\.prototype\./,Pl=function(t,r){var s=gu[kl(t)];return s===gc||s!==im&&(Ds(r)?jc(r):!!r)},kl=Pl.normalize=function(t){return String(t).replace(Zg,".").toLowerCase()},gu=Pl.data={},im=Pl.NATIVE="N",gc=Pl.POLYFILL="P",Sa=Pl,Ol=wr,Ce=p,Me=ne(ne.bind),ot=function(t,r){return Ol(t),r===void 0?t:Ce?Me(t,r):function(){return t.apply(r,arguments)}},qt={},sr=ve&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Fr=we,ii=String,er=TypeError,tr=function(t){if(Fr(t))return t;throw new er(ii(t)+" is not an object")},Li=ve,qs=zp,Bc=sr,ko=tr,_u=fr,Ls=TypeError,_c=Object.defineProperty,sm=Object.getOwnPropertyDescriptor,zc="enumerable",e_="configurable",wh="writable";qt.f=Li?Bc?function(t,r,s){if(ko(t),r=_u(r),ko(s),typeof t=="function"&&r==="prototype"&&"value"in s&&wh in s&&!s[wh]){var a=sm(t,r);a&&a[wh]&&(t[r]=s.value,s={configurable:e_ in s?s[e_]:a[e_],enumerable:zc in s?s[zc]:a[zc],writable:!1})}return _c(t,r,s)}:_c:function(t,r,s){if(ko(t),r=_u(r),ko(s),qs)try{return _c(t,r,s)}catch{}if("get"in s||"set"in s)throw new Ls("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var md=qt,Th=qe,yc=ve?function(t,r,s){return md.f(t,r,Th(1,s))}:function(t,r,s){return t[r]=s,t},yu=D,t_=re,yE=ne,om=pe,am=he.f,EE=Sa,Ga=De,vE=ot,gd=yc,n_=Hr,r_=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return t_(t,this,arguments)};return r.prototype=t.prototype,r},Gn=function(t,r){var s,a,c,d,h,m,g,E,b,I=t.target,A=t.global,k=t.stat,G=t.proto,j=A?yu:k?yu[I]:yu[I]&&yu[I].prototype,B=A?Ga:Ga[I]||gd(Ga,I,{})[I],Z=B.prototype;for(d in r)a=!(s=EE(A?d:I+(k?".":"#")+d,t.forced))&&j&&n_(j,d),m=B[d],a&&(g=t.dontCallGetSet?(b=am(j,d))&&b.value:j[d]),h=a&&g?g:r[d],(s||G||typeof m!=typeof h)&&(E=t.bind&&a?vE(h,yu):t.wrap&&a?r_(h):G&&om(h)?yE(h):h,(t.sham||h&&h.sham||m&&m.sham)&&gd(E,"sham",!0),gd(B,d,E),G&&(n_(Ga,c=I+"Prototype")||gd(Ga,c,{}),gd(Ga[c],d,h),t.real&&Z&&(s||!Z[d])&&gd(Z,d,h)))},ba=Math.ceil,SE=Math.floor,bE=Math.trunc||function(t){var r=+t;return(r>0?SE:ba)(r)},Eu=bE,P=function(t){var r=+t;return r!=r||r===0?0:Eu(r)},H=P,ie=Math.max,Se=Math.min,Ye=function(t,r){var s=H(t);return s<0?ie(s+r,0):Se(s,r)},ht=P,Kt=Math.min,si=function(t){var r=ht(t);return r>0?Kt(r,9007199254740991):0},Ys=si,dr=function(t){return Ys(t.length)},yo=sn,Ms=Ye,Wc=dr,Ha=function(t){return function(r,s,a){var c=yo(r),d=Wc(c);if(d===0)return!t&&-1;var h,m=Ms(a,d);if(t&&s!=s){for(;d>m;)if((h=c[m++])!=h)return!0}else for(;d>m;m++)if((t||m in c)&&c[m]===s)return t||m||0;return!t&&-1}},_d={includes:Ha(!0),indexOf:Ha(!1)},cm=_d.includes;Gn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return cm(this,t,arguments.length>1?arguments[1]:void 0)}});var rI=D,iI=De,Ec=function(t,r){var s=iI[t+"Prototype"],a=s&&s[r];if(a)return a;var c=rI[t],d=c&&c.prototype;return d&&d[r]},lm=Ec("Array","includes"),cx=we,lx=X,ux=Or("match"),ib=function(t){var r;return cx(t)&&((r=t[ux])!==void 0?!!r:lx(t)==="RegExp")},sI=ib,i_=TypeError,um={};um[Or("toStringTag")]="z";var sb=String(um)==="[object z]",wE=sb,dx=pe,s_=X,ob=Or("toStringTag"),ab=Object,oI=s_(function(){return arguments}())==="Arguments",yd=wE?s_:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=ab(t),ob))=="string"?s:oI?s_(r):(a=s_(r))==="Object"&&dx(r.callee)?"Arguments":a},aI=yd,hx=String,$a=function(t){if(aI(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return hx(t)},px=Or("match"),fx=Gn,mx=function(t){if(sI(t))throw new i_("The method doesn't accept regular expressions");return t},Nl=mt,dm=$a,cI=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[px]=!1,"/./"[t](r)}catch{}}return!1},lI=R("".indexOf);fx({target:"String",proto:!0,forced:!cI("includes")},{includes:function(t){return!!~lI(dm(Nl(this)),dm(mx(t)),arguments.length>1?arguments[1]:void 0)}});var uI=Ec("String","includes"),cb=N,lb=lm,gx=uI,ub=Array.prototype,Ch=String.prototype,db=function(t){var r=t.includes;return t===ub||cb(ub,t)&&r===ub.includes?lb:typeof t=="string"||t===Ch||cb(Ch,t)&&r===Ch.includes?gx:r},tt=l(db),hb=wr,dI=Ks,TE=it,hm=dr,CE=TypeError,pb="Reduce of empty array with no initial value",RE=function(t){return function(r,s,a,c){var d=dI(r),h=TE(d),m=hm(d);if(hb(s),m===0&&a<2)throw new CE(pb);var g=t?m-1:0,E=t?-1:1;if(a<2)for(;;){if(g in h){c=h[g],g+=E;break}if(g+=E,t?g<0:m<=g)throw new CE(pb)}for(;t?g>=0:m>g;g+=E)g in h&&(c=s(c,h[g],g,d));return c}},hI={left:RE(!1)},pI=u,o_=function(t,r){var s=[][t];return!!s&&pI(function(){s.call(null,r||function(){return 1},1)})},pm=D,fI=hn,mI=X,xl=function(t){return fI.slice(0,t.length)===t},a_=xl("Bun/")?"BUN":xl("Cloudflare-Workers")?"CLOUDFLARE":xl("Deno/")?"DENO":xl("Node.js/")?"NODE":pm.Bun&&typeof Bun.version=="string"?"BUN":pm.Deno&&typeof Deno.version=="object"?"DENO":mI(pm.process)==="process"?"NODE":pm.window&&pm.document?"BROWSER":"REST",fm=a_==="NODE",_x=hI.left;Gn({target:"Array",proto:!0,forced:!fm&&li>79&&li<83||!o_("reduce")},{reduce:function(t){var r=arguments.length;return _x(this,t,r,r>1?arguments[1]:void 0)}});var yx=Ec("Array","reduce"),c_=N,Ex=yx,IE=Array.prototype,gI=function(t){var r=t.reduce;return t===IE||c_(IE,t)&&r===IE.reduce?Ex:r},Mi=gI,Ka=l(Mi),AE=X,Ed=Array.isArray||function(t){return AE(t)==="Array"},_I=Gn,fb=Ed,l_=R([].reverse),u_=[1,2];_I({target:"Array",proto:!0,forced:String(u_)===String(u_.reverse())},{reverse:function(){return fb(this)&&(this.length=this.length),l_(this)}});var mm=Ec("Array","reverse"),yI=N,vx=mm,mb=Array.prototype,EI=function(t){var r=t.reverse;return t===mb||yI(mb,t)&&r===mb.reverse?vx:r},d_=EI,h_=l(d_),gb=Fc,PE=_o("keys"),gm=function(t){return PE[t]||(PE[t]=gb(t))},_b=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Sx=Hr,vI=pe,bx=Ks,wx=_b,kE=gm("IE_PROTO"),vu=Object,SI=vu.prototype,Rh=wx?vu.getPrototypeOf:function(t){var r=bx(t);if(Sx(r,kE))return r[kE];var s=r.constructor;return vI(s)&&r instanceof s?s.prototype:r instanceof vu?SI:null},Su=R,p_=wr,vd=we,yb=function(t){return vd(t)||t===null},Tx=String,Cx=TypeError,Hp=function(t,r,s){try{return Su(p_(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},f_=we,_m=mt,OE=function(t){if(yb(t))return t;throw new Cx("Can't set "+Tx(t)+" as a prototype")},Eb=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=Hp(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return _m(a),OE(c),f_(a)&&(r?t(a,c):a.__proto__=c),a}}():void 0),Sd={},Dl={},Ti=Hr,Ui=sn,Ih=_d.indexOf,ea=Dl,wa=R([].push),Ah=function(t,r){var s,a=Ui(t),c=0,d=[];for(s in a)!Ti(ea,s)&&Ti(a,s)&&wa(d,s);for(;r.length>c;)Ti(a,s=r[c++])&&(~Ih(d,s)||wa(d,s));return d},Ph=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qa=Ah,NE=Ph.concat("length","prototype");Sd.f=Object.getOwnPropertyNames||function(t){return qa(t,NE)};var ym={};ym.f=Object.getOwnPropertySymbols;var bI=Ut,xE=Sd,wI=ym,bd=tr,DE=R([].concat),vb=bI("Reflect","ownKeys")||function(t){var r=xE.f(bd(t)),s=wI.f;return s?DE(r,s(t)):r},Sb=Hr,Rx=vb,kh=he,Em=qt,Oh={},LE=Ah,ME=Ph,Ta=Object.keys||function(t){return LE(t,ME)},Gc=ve,$p=sr,wd=qt,Td=tr,Kp=sn,TI=Ta;Oh.f=Gc&&!$p?Object.defineProperties:function(t,r){Td(t);for(var s,a=Kp(r),c=TI(r),d=c.length,h=0;d>h;)wd.f(t,s=c[h++],a[s]);return t};var vm,UE=Ut("document","documentElement"),vc=tr,Sc=Oh,zi=Ph,Ll=Dl,CI=UE,RI=fu,m_="prototype",g_="script",bb=gm("IE_PROTO"),Sm=function(){},wb=function(t){return"<"+g_+">"+t+"</"+g_+">"},qp=function(t){t.write(wb("")),t.close();var r=t.parentWindow.Object;return t=null,r},bm=function(){try{vm=new ActiveXObject("htmlfile")}catch{}var t,r,s;bm=typeof document<"u"?document.domain&&vm?qp(vm):(r=RI("iframe"),s="java"+g_+":",r.style.display="none",CI.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(wb("document.F=Object")),t.close(),t.F):qp(vm);for(var a=zi.length;a--;)delete bm[m_][zi[a]];return bm()};Ll[bb]=!0;var __=Object.create||function(t,r){var s;return t!==null?(Sm[m_]=vc(t),s=new Sm,Sm[m_]=null,s[bb]=t):s=bm(),r===void 0?s:Sc.f(s,r)},y_=we,VE=yc,Tb=Error,II=R("".replace),wm=String(new Tb("zxcasd").stack),Cb=/\n\s*at [^:]*:[^\n]*/,FE=Cb.test(wm),jE=qe,Tm=!u(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",jE(1,7)),t.stack!==7)}),Rb=yc,Ib=function(t,r){if(FE&&typeof t=="string"&&!Tb.prepareStackTrace)for(;r--;)t=II(t,Cb,"");return t},Ab=Tm,BE=Error.captureStackTrace,Ml={},Hc=Ml,Yp=Or("iterator"),Pb=Array.prototype,kb=function(t){return t!==void 0&&(Hc.Array===t||Pb[Yp]===t)},Cd=yd,Rd=Ba,Ob=wt,AI=Ml,Id=Or("iterator"),Ul=function(t){if(!Ob(t))return Rd(t,Id)||Rd(t,"@@iterator")||AI[Cd(t)]},zE=be,PI=wr,WE=tr,kI=Jo,E_=Ul,bu=TypeError,Xp=function(t,r){var s=arguments.length<2?E_(t):r;if(PI(s))return WE(zE(s,t));throw new bu(kI(t)+" is not iterable")},v_=be,Nh=tr,Nb=Ba,Jp=function(t,r,s){var a,c;Nh(t);try{if(!(a=Nb(t,"return"))){if(r==="throw")throw s;return s}a=v_(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return Nh(a),s},OI=ot,xb=be,ns=tr,GE=Jo,Db=kb,Lb=dr,S_=N,Mb=Xp,Qp=Ul,Xi=Jp,Xs=TypeError,bs=function(t,r){this.stopped=t,this.result=r},b_=bs.prototype,Ad=function(t,r,s){var a,c,d,h,m,g,E,b=s&&s.that,I=!(!s||!s.AS_ENTRIES),A=!(!s||!s.IS_RECORD),k=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=OI(r,b),B=function(Q){return a&&Xi(a,"normal",Q),new bs(!0,Q)},Z=function(Q){return I?(ns(Q),G?j(Q[0],Q[1],B):j(Q[0],Q[1])):G?j(Q,B):j(Q)};if(A)a=t.iterator;else if(k)a=t;else{if(!(c=Qp(t)))throw new Xs(GE(t)+" is not iterable");if(Db(c)){for(d=0,h=Lb(t);h>d;d++)if((m=Z(t[d]))&&S_(b_,m))return m;return new bs(!1)}a=Mb(t,c)}for(g=A?t.next:a.next;!(E=xb(g,a)).done;){try{m=Z(E.value)}catch(Q){Xi(a,"throw",Q)}if(typeof m=="object"&&m&&S_(b_,m))return m}return new bs(!1)},w_=$a,Ix=Gn,ta=N,Ub=Rh,Cm=Eb,Vb=function(t,r,s){for(var a=Rx(r),c=Em.f,d=kh.f,h=0;h<a.length;h++){var m=a[h];Sb(t,m)||s&&Sb(s,m)||c(t,m,d(r,m))}},Vl=__,Ya=yc,Zp=qe,Fb=function(t,r){y_(r)&&"cause"in r&&VE(t,"cause",r.cause)},jb=function(t,r,s,a){Ab&&(BE?BE(t,r):Rb(t,"stack",Ib(s,a)))},NI=Ad,xI=function(t,r){return t===void 0?arguments.length<2?"":r:w_(t)},DI=Or("toStringTag"),T_=Error,LI=[].push,ef=function(t,r){var s,a=ta(HE,this);Cm?s=Cm(new T_,a?Ub(this):HE):(s=a?this:Vl(HE),Ya(s,DI,"Error")),r!==void 0&&Ya(s,"message",xI(r)),jb(s,ef,s.stack,1),arguments.length>2&&Fb(s,arguments[2]);var c=[];return NI(t,LI,{that:c}),Ya(s,"errors",c),s};Cm?Cm(ef,T_):Vb(ef,T_,{name:!0});var HE=ef.prototype=Vl(T_.prototype,{constructor:Zp(1,ef),message:Zp(1,""),name:Zp(1,"AggregateError")});Ix({global:!0},{AggregateError:ef});var C_,Pd,R_,$E=pe,I_=D.WeakMap,MI=$E(I_)&&/native code/.test(String(I_)),KE=D,UI=we,VI=yc,qE=Hr,YE=Di,Bb=gm,FI=Dl,zb="Object already initialized",XE=KE.TypeError,Ax=KE.WeakMap;if(MI||YE.state){var Fl=YE.state||(YE.state=new Ax);Fl.get=Fl.get,Fl.has=Fl.has,Fl.set=Fl.set,C_=function(t,r){if(Fl.has(t))throw new XE(zb);return r.facade=t,Fl.set(t,r),r},Pd=function(t){return Fl.get(t)||{}},R_=function(t){return Fl.has(t)}}else{var Rm=Bb("state");FI[Rm]=!0,C_=function(t,r){if(qE(t,Rm))throw new XE(zb);return r.facade=t,VI(t,Rm,r),r},Pd=function(t){return qE(t,Rm)?t[Rm]:{}},R_=function(t){return qE(t,Rm)}}var tf,Wb,Gb,xh={set:C_,get:Pd,has:R_,enforce:function(t){return R_(t)?Pd(t):C_(t,{})},getterFor:function(t){return function(r){var s;if(!UI(r)||(s=Pd(r)).type!==t)throw new XE("Incompatible receiver, "+t+" required");return s}}},Im=ve,Px=Hr,jI=Function.prototype,kx=Im&&Object.getOwnPropertyDescriptor,$c=Px(jI,"name"),JE={PROPER:$c&&(function(){}).name==="something",CONFIGURABLE:$c&&(!Im||Im&&kx(jI,"name").configurable)},QE=yc,kd=function(t,r,s,a){return a&&a.enumerable?t[r]=s:QE(t,r,s),t},BI=u,zI=pe,Hb=we,Am=__,ZE=Rh,$b=kd,Kb=Or("iterator"),qb=!1;[].keys&&("next"in(Gb=[].keys())?(Wb=ZE(ZE(Gb)))!==Object.prototype&&(tf=Wb):qb=!0);var WI=!Hb(tf)||BI(function(){var t={};return tf[Kb].call(t)!==t});zI((tf=WI?{}:Am(tf))[Kb])||$b(tf,Kb,function(){return this});var Yb={IteratorPrototype:tf,BUGGY_SAFARI_ITERATORS:qb},GI=yd,HI=sb?{}.toString:function(){return"[object "+GI(this)+"]"},Ox=sb,Xa=qt.f,Ca=yc,$I=Hr,KI=HI,Xb=Or("toStringTag"),wu=function(t,r,s,a){var c=s?t:t&&t.prototype;c&&($I(c,Xb)||Xa(c,Xb,{configurable:!0,value:r}),a&&!Ox&&Ca(c,"toString",KI))},qI=Yb.IteratorPrototype,Jb=__,YI=qe,Qb=wu,XI=Ml,JI=function(){return this},A_=function(t,r,s,a){var c=r+" Iterator";return t.prototype=Jb(qI,{next:YI(+!a,s)}),Qb(t,c,!1,!0),XI[c]=JI,t},Zb=Gn,QI=be,ew=JE,ev=A_,Nx=Rh,ZI=wu,tv=kd,tw=Ml,nv=Yb,Od=ew.PROPER,rv=nv.BUGGY_SAFARI_ITERATORS,iv=Or("iterator"),sv="keys",P_="values",nw="entries",k_=function(){return this},Oo=function(t,r,s,a,c,d,h){ev(s,r,a);var m,g,E,b=function(Z){if(Z===c&&j)return j;if(!rv&&Z&&Z in k)return k[Z];switch(Z){case sv:case P_:case nw:return function(){return new s(this,Z)}}return function(){return new s(this)}},I=r+" Iterator",A=!1,k=t.prototype,G=k[iv]||k["@@iterator"]||c&&k[c],j=!rv&&G||b(c),B=r==="Array"&&k.entries||G;if(B&&(m=Nx(B.call(new t)))!==Object.prototype&&m.next&&(ZI(m,I,!0,!0),tw[I]=k_),Od&&c===P_&&G&&G.name!==P_&&(A=!0,j=function(){return QI(G,this)}),c)if(g={values:b(P_),keys:d?j:b(sv),entries:b(nw)},h)for(E in g)(rv||A||!(E in k))&&tv(k,E,g[E]);else Zb({target:r,proto:!0,forced:rv||A},g);return h&&k[iv]!==j&&tv(k,iv,j,{}),tw[r]=j,g},ov=function(t,r){return{value:t,done:r}},xx=sn,O_=Ml,No=xh;qt.f;var Dx=Oo,cn=ov,nf="Array Iterator",rw=No.set,eA=No.getterFor(nf);Dx(Array,"Array",function(t,r){rw(this,{type:nf,target:xx(t),index:0,kind:r})},function(){var t=eA(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,cn(void 0,!0);switch(t.kind){case"keys":return cn(s,!1);case"values":return cn(r[s],!1)}return cn([s,r[s]],!1)},"values"),O_.Arguments=O_.Array;var Lx=qt,Dh=function(t,r,s){return Lx.f(t,r,s)},av=Ut,iw=Dh,tA=ve,sw=Or("species"),nA=N,ow=TypeError,N_=function(t,r){if(nA(r,t))return t;throw new ow("Incorrect invocation")},xo=pe,bc=Di,Lh=R(Function.toString);xo(bc.inspectSource)||(bc.inspectSource=function(t){return Lh(t)});var aw=bc.inspectSource,rA=R,jl=u,cw=pe,Tu=yd,Mx=aw,lw=function(){},uw=Ut("Reflect","construct"),cv=/^\s*(?:class|function)\b/,iA=rA(cv.exec),Ux=!cv.test(lw),Mh=function(t){if(!cw(t))return!1;try{return uw(lw,[],t),!0}catch{return!1}},lv=function(t){if(!cw(t))return!1;switch(Tu(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ux||!!iA(cv,Mx(t))}catch{return!0}};lv.sham=!0;var na,Tr,Js,fs,Us=!uw||jl(function(){var t;return Mh(Mh.call)||!Mh(Object)||!Mh(function(){t=!0})||t})?lv:Mh,wc=Us,Pm=Jo,Qs=TypeError,km=tr,rf=function(t){if(wc(t))return t;throw new Qs(Pm(t)+" is not a constructor")},uv=wt,dw=Or("species"),sf=function(t,r){var s,a=km(t).constructor;return a===void 0||uv(s=km(a)[dw])?r:rf(s)},ws=R([].slice),hw=TypeError,Kc=function(t,r){if(t<r)throw new hw("Not enough arguments");return t},Cu=/(?:ipad|iphone|ipod).*applewebkit/i.test(hn),ra=D,pw=re,Uh=ot,x_=pe,Vh=Hr,D_=u,Om=UE,fw=ws,L_=fu,dv=Kc,Ra=Cu,Fh=fm,Tc=ra.setImmediate,ia=ra.clearImmediate,sA=ra.process,M_=ra.Dispatch,mw=ra.Function,oA=ra.MessageChannel,jh=ra.String,hv=0,of={},Bh="onreadystatechange";D_(function(){na=ra.location});var U_=function(t){if(Vh(of,t)){var r=of[t];delete of[t],r()}},Nd=function(t){return function(){U_(t)}},gw=function(t){U_(t.data)},_w=function(t){ra.postMessage(jh(t),na.protocol+"//"+na.host)};Tc&&ia||(Tc=function(t){dv(arguments.length,1);var r=x_(t)?t:mw(t),s=fw(arguments,1);return of[++hv]=function(){pw(r,void 0,s)},Tr(hv),hv},ia=function(t){delete of[t]},Fh?Tr=function(t){sA.nextTick(Nd(t))}:M_&&M_.now?Tr=function(t){M_.now(Nd(t))}:oA&&!Ra?(fs=(Js=new oA).port2,Js.port1.onmessage=gw,Tr=Uh(fs.postMessage,fs)):ra.addEventListener&&x_(ra.postMessage)&&!ra.importScripts&&na&&na.protocol!=="file:"&&!D_(_w)?(Tr=_w,ra.addEventListener("message",gw,!1)):Tr=Bh in L_("script")?function(t){Om.appendChild(L_("script"))[Bh]=function(){Om.removeChild(this),U_(t)}}:function(t){setTimeout(Nd(t),0)});var Nm={set:Tc,clear:ia},V_=D,Vx=ve,Fx=Object.getOwnPropertyDescriptor,yw=function(t){if(!Vx)return V_[t];var r=Fx(V_,t);return r&&r.value},Ew=function(){this.head=null,this.tail=null};Ew.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var qc,vw,zh,pv,rs,aA=Ew,cA=/ipad|iphone|ipod/i.test(hn)&&typeof Pebble<"u",jx=/web0s(?!.*chrome)/i.test(hn),xm=D,lA=yw,Sw=ot,bw=Nm.set,Yc=aA,ww=Cu,Bx=cA,Wh=jx,Dm=fm,Gh=xm.MutationObserver||xm.WebKitMutationObserver,F_=xm.document,fv=xm.process,Lm=xm.Promise,Tw=lA("queueMicrotask");if(!Tw){var Mm=new Yc,mv=function(){var t,r;for(Dm&&(t=fv.domain)&&t.exit();r=Mm.get();)try{r()}catch(s){throw Mm.head&&qc(),s}t&&t.enter()};ww||Dm||Wh||!Gh||!F_?!Bx&&Lm&&Lm.resolve?((pv=Lm.resolve(void 0)).constructor=Lm,rs=Sw(pv.then,pv),qc=function(){rs(mv)}):Dm?qc=function(){fv.nextTick(mv)}:(bw=Sw(bw,xm),qc=function(){bw(mv)}):(vw=!0,zh=F_.createTextNode(""),new Gh(mv).observe(zh,{characterData:!0}),qc=function(){zh.data=vw=!vw}),Tw=function(t){Mm.head||qc(),Mm.add(t)}}var Cw=Tw,af=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Ru=D.Promise,gv=D,Um=Ru,Rw=pe,zx=Sa,uA=aw,Iw=Or,j_=a_,B_=li,z_=Um&&Um.prototype,dA=Iw("species"),hA=Rw(gv.PromiseRejectionEvent),_v=zx("Promise",function(){var t=uA(Um),r=t!==String(Um);if(!r&&B_===66||!z_.catch||!z_.finally)return!0;if(!B_||B_<51||!/native code/.test(t)){var s=new Um(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[dA]=a,!(s.then(function(){})instanceof a))return!0}return!(r||j_!=="BROWSER"&&j_!=="DENO"||hA)}),W_={CONSTRUCTOR:_v,REJECTION_EVENT:hA},Ja={},pA=wr,yv=TypeError,f=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw new yv("Bad Promise constructor");r=a,s=c}),this.resolve=pA(r),this.reject=pA(s)};Ja.f=function(t){return new f(t)};var _,T,x=Gn,V=fm,$=D,fe=be,ke=kd,Ve=wu,lt=function(t){var r=av(t);tA&&r&&!r[sw]&&iw(r,sw,{configurable:!0,get:function(){return this}})},xt=wr,Lt=pe,Nt=we,on=N_,pn=sf,mn=Nm.set,is=Cw,Je=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Be=af,nt=aA,jt=xh,gn=Ru,kn=W_,On=Ja,Un="Promise",Zs=kn.CONSTRUCTOR,Xr=kn.REJECTION_EVENT,Iu=jt.getterFor(Un),Wx=jt.set,lce=gn&&gn.prototype,Aw=gn,Gx=lce,Z3=$.TypeError,Hx=$.document,$x=$.process,Kx=On.f,uce=Kx,dce=!!(Hx&&Hx.createEvent&&$.dispatchEvent),e4="unhandledrejection",t4=function(t){var r;return!(!Nt(t)||!Lt(r=t.then))&&r},n4=function(t,r){var s,a,c,d=r.value,h=r.state===1,m=h?t.ok:t.fail,g=t.resolve,E=t.reject,b=t.domain;try{m?(h||(r.rejection===2&&pce(r),r.rejection=1),m===!0?s=d:(b&&b.enter(),s=m(d),b&&(b.exit(),c=!0)),s===t.promise?E(new Z3("Promise-chain cycle")):(a=t4(s))?fe(a,s,g,E):g(s)):E(d)}catch(I){b&&!c&&b.exit(),E(I)}},r4=function(t,r){t.notified||(t.notified=!0,is(function(){for(var s,a=t.reactions;s=a.get();)n4(s,t);t.notified=!1,r&&!t.rejection&&hce(t)}))},i4=function(t,r,s){var a,c;dce?((a=Hx.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),$.dispatchEvent(a)):a={promise:r,reason:s},!Xr&&(c=$["on"+t])?c(a):t===e4&&Je("Unhandled promise rejection",s)},hce=function(t){fe(mn,$,function(){var r,s=t.facade,a=t.value;if(s4(t)&&(r=Be(function(){V?$x.emit("unhandledRejection",a,s):i4(e4,s,a)}),t.rejection=V||s4(t)?2:1,r.error))throw r.value})},s4=function(t){return t.rejection!==1&&!t.parent},pce=function(t){fe(mn,$,function(){var r=t.facade;V?$x.emit("rejectionHandled",r):i4("rejectionhandled",r,t.value)})},Ev=function(t,r,s){return function(a){t(r,a,s)}},vv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,r4(t,!0))},qx=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw new Z3("Promise can't be resolved itself");var a=t4(r);a?is(function(){var c={done:!1};try{fe(a,r,Ev(qx,c,t),Ev(vv,c,t))}catch(d){vv(c,d,t)}}):(t.value=r,t.state=1,r4(t,!1))}catch(c){vv({done:!1},c,t)}}};Zs&&(Gx=(Aw=function(t){on(this,Gx),xt(t),fe(_,this);var r=Iu(this);try{t(Ev(qx,r),Ev(vv,r))}catch(s){vv(r,s)}}).prototype,(_=function(t){Wx(this,{type:Un,done:!1,notified:!1,parent:!1,reactions:new nt,rejection:!1,state:0,value:null})}).prototype=ke(Gx,"then",function(t,r){var s=Iu(this),a=Kx(pn(this,Aw));return s.parent=!0,a.ok=!Lt(t)||t,a.fail=Lt(r)&&r,a.domain=V?$x.domain:void 0,s.state===0?s.reactions.add(a):is(function(){n4(a,s)}),a.promise}),T=function(){var t=new _,r=Iu(t);this.promise=t,this.resolve=Ev(qx,r),this.reject=Ev(vv,r)},On.f=Kx=function(t){return t===Aw||t===void 0?new T(t):uce(t)}),x({global:!0,wrap:!0,forced:Zs},{Promise:Aw}),Ve(Aw,Un,!1,!0),lt(Un);var o4=Or("iterator"),a4=!1;try{var fce=0,c4={next:function(){return{done:!!fce++}},return:function(){a4=!0}};c4[o4]=function(){return this},Array.from(c4,function(){throw 2})}catch{}var mce=Ru,gce=function(t,r){try{if(!r&&!a4)return!1}catch{return!1}var s=!1;try{var a={};a[o4]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},fA=W_.CONSTRUCTOR||!gce(function(t){mce.all(t).then(void 0,function(){})}),_ce=be,yce=wr,Ece=Ja,vce=af,Sce=Ad;Gn({target:"Promise",stat:!0,forced:fA},{all:function(t){var r=this,s=Ece.f(r),a=s.resolve,c=s.reject,d=vce(function(){var h=yce(r.resolve),m=[],g=0,E=1;Sce(t,function(b){var I=g++,A=!1;E++,_ce(h,r,b).then(function(k){A||(A=!0,m[I]=k,--E||a(m))},c)}),--E||a(m)});return d.error&&c(d.value),s.promise}});var bce=Gn,wce=W_.CONSTRUCTOR;Ru&&Ru.prototype,bce({target:"Promise",proto:!0,forced:wce,real:!0},{catch:function(t){return this.then(void 0,t)}});var Tce=be,Cce=wr,Rce=Ja,Ice=af,Ace=Ad;Gn({target:"Promise",stat:!0,forced:fA},{race:function(t){var r=this,s=Rce.f(r),a=s.reject,c=Ice(function(){var d=Cce(r.resolve);Ace(t,function(h){Tce(d,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var Pce=Ja;Gn({target:"Promise",stat:!0,forced:W_.CONSTRUCTOR},{reject:function(t){var r=Pce.f(this);return(0,r.reject)(t),r.promise}});var kce=tr,Oce=we,Nce=Ja,l4=function(t,r){if(kce(t),Oce(r)&&r.constructor===t)return r;var s=Nce.f(t);return(0,s.resolve)(r),s.promise},xce=Gn,Dce=Ru,Lce=W_.CONSTRUCTOR,Mce=l4,Uce=Ut("Promise"),Vce=!Lce;xce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Mce(Vce&&this===Uce?Dce:this,t)}});var Fce=be,jce=wr,Bce=Ja,zce=af,Wce=Ad;Gn({target:"Promise",stat:!0,forced:fA},{allSettled:function(t){var r=this,s=Bce.f(r),a=s.resolve,c=s.reject,d=zce(function(){var h=jce(r.resolve),m=[],g=0,E=1;Wce(t,function(b){var I=g++,A=!1;E++,Fce(h,r,b).then(function(k){A||(A=!0,m[I]={status:"fulfilled",value:k},--E||a(m))},function(k){A||(A=!0,m[I]={status:"rejected",reason:k},--E||a(m))})}),--E||a(m)});return d.error&&c(d.value),s.promise}});var Gce=be,Hce=wr,$ce=Ut,Kce=Ja,qce=af,Yce=Ad,u4="No one promise resolved";Gn({target:"Promise",stat:!0,forced:fA},{any:function(t){var r=this,s=$ce("AggregateError"),a=Kce.f(r),c=a.resolve,d=a.reject,h=qce(function(){var m=Hce(r.resolve),g=[],E=0,b=1,I=!1;Yce(t,function(A){var k=E++,G=!1;b++,Gce(m,r,A).then(function(j){G||I||(I=!0,c(j))},function(j){G||I||(G=!0,g[k]=j,--b||d(new s(g,u4)))})}),--b||d(new s(g,u4))});return h.error&&d(h.value),a.promise}});var Xce=Gn,Jce=re,Qce=ws,Zce=Ja,ele=wr,d4=af,Yx=D.Promise,h4=!1;Xce({target:"Promise",stat:!0,forced:!Yx||!Yx.try||d4(function(){Yx.try(function(t){h4=t===8},8)}).error||!h4},{try:function(t){var r=arguments.length>1?Qce(arguments,1):[],s=Zce.f(this),a=d4(function(){return Jce(ele(t),void 0,r)});return(a.error?s.reject:s.resolve)(a.value),s.promise}});var tle=Ja;Gn({target:"Promise",stat:!0},{withResolvers:function(){var t=tle.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var nle=Gn,Xx=Ru,rle=u,ile=Ut,sle=pe,ole=sf,p4=l4,ale=Xx&&Xx.prototype;nle({target:"Promise",proto:!0,real:!0,forced:!!Xx&&rle(function(){ale.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=ole(this,ile("Promise")),s=sle(t);return this.then(s?function(a){return p4(r,t()).then(function(){return a})}:t,s?function(a){return p4(r,t()).then(function(){throw a})}:t)}});var Jx=R,cle=P,lle=$a,ule=mt,dle=Jx("".charAt),f4=Jx("".charCodeAt),hle=Jx("".slice),m4=function(t){return function(r,s){var a,c,d=lle(ule(r)),h=cle(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=f4(d,h))<55296||a>56319||h+1===m||(c=f4(d,h+1))<56320||c>57343?t?dle(d,h):a:t?hle(d,h,h+2):c-56320+(a-55296<<10)+65536}},Qx={codeAt:m4(!1),charAt:m4(!0)},ple=Qx.charAt,fle=$a,g4=xh,mle=Oo,_4=ov,y4="String Iterator",gle=g4.set,_le=g4.getterFor(y4);mle(String,"String",function(t){gle(this,{type:y4,string:fle(t),index:0})},function(){var t,r=_le(this),s=r.string,a=r.index;return a>=s.length?_4(void 0,!0):(t=ple(s,a),r.index+=t.length,_4(t,!1))});var yle=De.Promise,Ele={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vle=D,Sle=wu,E4=Ml;for(var Zx in Ele)Sle(vle[Zx],Zx),E4[Zx]=E4.Array;var v4=yle,gt=l(v4),ble=Ec("Array","values"),wle=yd,Tle=Hr,Cle=N,Rle=ble,eD=Array.prototype,Ile={DOMTokenList:!0,NodeList:!0},Ale=function(t){var r=t.values;return t===eD||Cle(eD,t)&&r===eD.values||Tle(Ile,wle(t))?Rle:r},Cc=l(Ale),S4=Jo,Ple=TypeError,b4=ws,kle=Math.floor,tD=function(t,r){var s=t.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=t[d];c&&r(t[c-1],a)>0;)t[c]=t[--c];c!==d++&&(t[c]=a)}else for(var h=kle(s/2),m=tD(b4(t,0,h),r),g=tD(b4(t,h),r),E=m.length,b=g.length,I=0,A=0;I<E||A<b;)t[I+A]=I<E&&A<b?r(m[I],g[A])<=0?m[I++]:g[A++]:I<E?m[I++]:g[A++];return t},w4=tD,T4=hn.match(/firefox\/(\d+)/i),Ole=!!T4&&+T4[1],Nle=/MSIE|Trident/.test(hn),C4=hn.match(/AppleWebKit\/(\d+)\./),xle=!!C4&&+C4[1],Dle=Gn,R4=R,Lle=wr,Mle=Ks,I4=dr,Ule=function(t,r){if(!delete t[r])throw new Ple("Cannot delete property "+S4(r)+" of "+S4(t))},A4=$a,nD=u,Vle=w4,Fle=o_,P4=Ole,jle=Nle,k4=li,O4=xle,Vm=[],N4=R4(Vm.sort),Ble=R4(Vm.push),zle=nD(function(){Vm.sort(void 0)}),Wle=nD(function(){Vm.sort(null)}),Gle=Fle("sort"),x4=!nD(function(){if(k4)return k4<70;if(!(P4&&P4>3)){if(jle)return!0;if(O4)return O4<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Vm.push({k:r+a,v:s})}for(Vm.sort(function(d,h){return h.v-d.v}),a=0;a<Vm.length;a++)r=Vm[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Dle({target:"Array",proto:!0,forced:zle||!Wle||!Gle||!x4},{sort:function(t){t!==void 0&&Lle(t);var r=Mle(this);if(x4)return t===void 0?N4(r):N4(r,t);var s,a,c=[],d=I4(r);for(a=0;a<d;a++)a in r&&Ble(c,r[a]);for(Vle(c,function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:A4(m)>A4(g)?1:-1}}(t)),s=I4(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)Ule(r,a++);return r}});var Hle=Ec("Array","sort"),$le=N,Kle=Hle,rD=Array.prototype,qle=function(t){var r=t.sort;return t===rD||$le(rD,t)&&r===rD.sort?Kle:r},G_=l(qle),Yle=Gn,Xle=R,Jle=Ye,Qle=RangeError,D4=String.fromCharCode,L4=String.fromCodePoint,Zle=Xle([].join);Yle({target:"String",stat:!0,forced:!!L4&&L4.length!==1},{fromCodePoint:function(t){for(var r,s=[],a=arguments.length,c=0;a>c;){if(r=+arguments[c++],Jle(r,1114111)!==r)throw new Qle(r+" is not a valid code point");s[c]=r<65536?D4(r):D4(55296+((r-=65536)>>10),r%1024+56320)}return Zle(s,"")}});var eue=u,tue=Or("iterator"),mA=!eue(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),a+=d+c}),s.delete("a",2),s.delete("b",void 0),!t.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[tue]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"}),nue=kd,iD=Gn,M4=D,sD=yw,rue=Ut,gA=be,xd=R,Pw=ve,U4=mA,V4=kd,iue=Dh,sue=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:nue(t,a,r[a],s);return t},oue=wu,aue=A_,oD=xh,F4=N_,aD=pe,cue=Hr,lue=ot,uue=yd,due=tr,j4=we,Rc=$a,hue=__,B4=qe,z4=Xp,pue=Ul,_A=ov,Sv=Kc,fue=w4,mue=Or("iterator"),bv="URLSearchParams",W4=bv+"Iterator",G4=oD.set,Au=oD.getterFor(bv),gue=oD.getterFor(W4),H4=sD("fetch"),yA=sD("Request"),kw=sD("Headers"),cD=yA&&yA.prototype,$4=kw&&kw.prototype,_ue=M4.TypeError,yue=M4.encodeURIComponent,Eue=String.fromCharCode,vue=rue("String","fromCodePoint"),Sue=parseInt,EA=xd("".charAt),K4=xd([].join),Fm=xd([].push),q4=xd("".replace),bue=xd([].shift),Y4=xd([].splice),X4=xd("".split),J4=xd("".slice),wue=xd(/./.exec),Tue=/\+/g,Cue=/^[0-9a-f]+$/i,Q4=function(t,r){var s=J4(t,r,r+2);return wue(Cue,s)?Sue(s,16):NaN},Rue=function(t){for(var r=0,s=128;s>0&&(t&s)!=0;s>>=1)r++;return r},Iue=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},Z4=function(t){for(var r=(t=q4(t,Tue," ")).length,s="",a=0;a<r;){var c=EA(t,a);if(c==="%"){if(EA(t,a+1)==="%"||a+3>r){s+="%",a++;continue}var d=Q4(t,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=Rue(d);if(h===0)c=Eue(d);else{if(h===1||h>4){s+="",a++;continue}for(var m=[d],g=1;g<h&&!(++a+3>r||EA(t,a)!=="%");){var E=Q4(t,a+1);if(E!=E){a+=3;break}if(E>191||E<128)break;Fm(m,E),a+=2,g++}if(m.length!==h){s+="";continue}var b=Iue(m);b===null?s+="":c=vue(b)}}s+=c,a++}return s},Aue=/[!'()~]|%20/g,Pue={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},kue=function(t){return Pue[t]},eB=function(t){return q4(yue(t),Aue,kue)},lD=aue(function(t,r){G4(this,{type:W4,target:Au(t).entries,index:0,kind:r})},bv,function(){var t=gue(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,_A(void 0,!0);var a=r[s];switch(t.kind){case"keys":return _A(a.key,!1);case"values":return _A(a.value,!1)}return _A([a.key,a.value],!1)},!0),tB=function(t){this.entries=[],this.url=null,t!==void 0&&(j4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?EA(t,0)==="?"?J4(t,1):t:Rc(t)))};tB.prototype={type:bv,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,g=this.entries,E=pue(t);if(E)for(s=(r=z4(t,E)).next;!(a=gA(s,r)).done;){if(d=(c=z4(due(a.value))).next,(h=gA(d,c)).done||(m=gA(d,c)).done||!gA(d,c).done)throw new _ue("Expected sequence with length 2");Fm(g,{key:Rc(h.value),value:Rc(m.value)})}else for(var b in t)cue(t,b)&&Fm(g,{key:b,value:Rc(t[b])})},parseQuery:function(t){if(t)for(var r,s,a=this.entries,c=X4(t,"&"),d=0;d<c.length;)(r=c[d++]).length&&(s=X4(r,"="),Fm(a,{key:Z4(bue(s)),value:Z4(K4(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],Fm(s,eB(t.key)+"="+eB(t.value));return K4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var vA=function(){F4(this,wv);var t=G4(this,new tB(arguments.length>0?arguments[0]:void 0));Pw||(this.size=t.entries.length)},wv=vA.prototype;if(sue(wv,{append:function(t,r){var s=Au(this);Sv(arguments.length,2),Fm(s.entries,{key:Rc(t),value:Rc(r)}),Pw||this.length++,s.updateURL()},delete:function(t){for(var r=Au(this),s=Sv(arguments.length,1),a=r.entries,c=Rc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:Rc(d),m=0;m<a.length;){var g=a[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(Y4(a,m,1),h!==void 0)break}Pw||(this.size=a.length),r.updateURL()},get:function(t){var r=Au(this).entries;Sv(arguments.length,1);for(var s=Rc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=Au(this).entries;Sv(arguments.length,1);for(var s=Rc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&Fm(a,r[c].value);return a},has:function(t){for(var r=Au(this).entries,s=Sv(arguments.length,1),a=Rc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:Rc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=Au(this);Sv(arguments.length,1);for(var a,c=s.entries,d=!1,h=Rc(t),m=Rc(r),g=0;g<c.length;g++)(a=c[g]).key===h&&(d?Y4(c,g--,1):(d=!0,a.value=m));d||Fm(c,{key:h,value:m}),Pw||(this.size=c.length),s.updateURL()},sort:function(){var t=Au(this);fue(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=Au(this).entries,a=lue(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new lD(this,"keys")},values:function(){return new lD(this,"values")},entries:function(){return new lD(this,"entries")}},{enumerable:!0}),V4(wv,mue,wv.entries,{}),V4(wv,"toString",function(){return Au(this).serialize()},{enumerable:!0}),Pw&&iue(wv,"size",{get:function(){return Au(this).entries.length},configurable:!0,enumerable:!0}),oue(vA,bv),iD({global:!0,forced:!U4},{URLSearchParams:vA}),!U4&&aD(kw)){var Oue=xd($4.has),Nue=xd($4.set),nB=function(t){if(j4(t)){var r,s=t.body;if(uue(s)===bv)return r=t.headers?new kw(t.headers):new kw,Oue(r,"content-type")||Nue(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),hue(t,{body:B4(0,Rc(s)),headers:B4(0,r)})}return t};if(aD(H4)&&iD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return H4(t,arguments.length>1?nB(arguments[1]):{})}}),aD(yA)){var uD=function(t){return F4(this,cD),new yA(t,arguments.length>1?nB(arguments[1]):{})};cD.constructor=uD,uD.prototype=cD,iD({global:!0,dontCallGetSet:!0,forced:!0},{Request:uD})}}var Pu,xue={URLSearchParams:vA,getState:Au},Due=De.URLSearchParams,rB=ve,Lue=R,Mue=be,Uue=u,dD=Ta,Vue=ym,Fue=Re,jue=Ks,Bue=it,Tv=Object.assign,iB=Object.defineProperty,zue=Lue([].concat),Wue=!Tv||Uue(function(){if(rB&&Tv({b:1},Tv(iB({},"a",{enumerable:!0,get:function(){iB(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),Tv({},t)[s]!==7||dD(Tv({},r)).join("")!==a})?function(t,r){for(var s=jue(t),a=arguments.length,c=1,d=Vue.f,h=Fue.f;a>c;)for(var m,g=Bue(arguments[c++]),E=d?zue(dD(g),d(g)):dD(g),b=E.length,I=0;b>I;)m=E[I++],rB&&!Mue(h,g,m)||(s[m]=g[m]);return s}:Tv,Gue=tr,Hue=Jp,$ue=ve,Kue=qt,que=qe,hD=function(t,r,s){$ue?Kue.f(t,r,que(0,s)):t[r]=s},Yue=ot,Xue=be,Jue=Ks,Que=function(t,r,s,a){try{return a?r(Gue(s)[0],s[1]):r(s)}catch(c){Hue(t,"throw",c)}},Zue=kb,ede=Us,tde=dr,sB=hD,nde=Xp,rde=Ul,oB=Array,H_=R,pD=2147483647,ide=/[^\0-\u007E]/,aB=/[.\u3002\uFF0E\uFF61]/g,cB="Overflow: input needs wider integers to process",lB=RangeError,sde=H_(aB.exec),Cv=Math.floor,fD=String.fromCharCode,uB=H_("".charCodeAt),dB=H_([].join),jm=H_([].push),ode=H_("".replace),ade=H_("".split),cde=H_("".toLowerCase),hB=function(t){return t+22+75*(t<26)},lde=function(t,r,s){var a=0;for(t=s?Cv(t/700):t>>1,t+=Cv(t/r);t>455;)t=Cv(t/35),a+=36;return Cv(a+36*t/(t+38))},ude=function(t){var r=[];t=function(Z){for(var Q=[],ae=0,ye=Z.length;ae<ye;){var _e=uB(Z,ae++);if(_e>=55296&&_e<=56319&&ae<ye){var ue=uB(Z,ae++);(64512&ue)==56320?jm(Q,((1023&_e)<<10)+(1023&ue)+65536):(jm(Q,_e),ae--)}else jm(Q,_e)}return Q}(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&jm(r,fD(a));var g=r.length,E=g;for(g&&jm(r,"-");E<c;){var b=pD;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<b&&(b=a);var I=E+1;if(b-d>Cv((pD-h)/I))throw new lB(cB);for(h+=(b-d)*I,d=b,s=0;s<t.length;s++){if((a=t[s])<d&&++h>pD)throw new lB(cB);if(a===d){for(var A=h,k=36;;){var G=k<=m?1:k>=m+26?26:k-m;if(A<G)break;var j=A-G,B=36-G;jm(r,fD(hB(G+j%B))),A=Cv(j/B),k+=36}jm(r,fD(hB(A))),m=lde(h,I,E===g),h=0,E++}}h++,d++}return dB(r,"")},dde=Gn,mD=ve,hde=mA,gD=D,pB=ot,ku=R,SA=kd,Ou=Dh,pde=N_,_D=Hr,yD=Wue,Rv=function(t){var r=Jue(t),s=ede(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=Yue(c,a>2?arguments[2]:void 0));var h,m,g,E,b,I,A=rde(r),k=0;if(!A||this===oB&&Zue(A))for(h=tde(r),m=s?new this(h):oB(h);h>k;k++)I=d?c(r[k],k):r[k],sB(m,k,I);else for(m=s?new this:[],b=(E=nde(r,A)).next;!(g=Xue(b,E)).done;k++)I=d?Que(E,c,[g.value,k],!0):g.value,sB(m,k,I);return m.length=k,m},Dd=ws,fde=Qx.codeAt,mde=function(t){var r,s,a=[],c=ade(ode(cde(t),aB,"."),".");for(r=0;r<c.length;r++)s=c[r],jm(a,sde(ide,s)?"xn--"+ude(s):s);return dB(a,".")},cf=$a,gde=wu,_de=Kc,fB=xue,mB=xh,yde=mB.set,bA=mB.getterFor("URL"),Ede=fB.URLSearchParams,vde=fB.getState,Ow=gD.URL,ED=gD.TypeError,wA=gD.parseInt,Sde=Math.floor,gB=Math.pow,Nu=ku("".charAt),Ld=ku(/./.exec),Nw=ku([].join),bde=ku(1 .toString),wde=ku([].pop),Iv=ku([].push),vD=ku("".replace),Tde=ku([].shift),Cde=ku("".split),xw=ku("".slice),TA=ku("".toLowerCase),Rde=ku([].unshift),SD="Invalid scheme",$_="Invalid host",_B="Invalid port",yB=/[a-z]/i,Ide=/[\d+-.a-z]/i,bD=/\d/,Ade=/^0x/i,Pde=/^[0-7]+$/,kde=/^\d+$/,EB=/^[\da-f]+$/i,Ode=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Nde=/[\0\t\n\r #/:<>?@[\\\]^|]/,xde=/^[\u0000-\u0020]+/,Dde=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Lde=/[\t\n\r]/g,Dw=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Rde(r,t%256),t=Sde(t/256);return Nw(r,".")}if(typeof t=="object"){for(r="",a=function(d){for(var h=null,m=1,g=null,E=0,b=0;b<8;b++)d[b]!==0?(E>m&&(h=g,m=E),g=null,E=0):(g===null&&(g=b),++E);return E>m?g:h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=bde(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},CA={},vB=yD({},CA,{" ":1,'"':1,"<":1,">":1,"`":1}),SB=yD({},vB,{"#":1,"?":1,"{":1,"}":1}),wD=yD({},SB,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bm=function(t,r){var s=fde(t,0);return s>32&&s<127&&!_D(r,t)?t:encodeURIComponent(t)},RA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Lw=function(t,r){var s;return t.length===2&&Ld(yB,Nu(t,0))&&((s=Nu(t,1))===":"||!r&&s==="|")},bB=function(t){var r;return t.length>1&&Lw(xw(t,0,2))&&(t.length===2||(r=Nu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Mde=function(t){return t==="."||TA(t)==="%2e"},TD={},wB={},CD={},TB={},CB={},RD={},RB={},IB={},IA={},AA={},ID={},AD={},PD={},kD={},AB={},OD={},Av={},Hh={},PB={},K_={},lf={},ND=function(t,r,s){var a,c,d,h=cf(t);if(r){if(c=this.parse(h))throw new ED(c);this.searchParams=null}else{if(s!==void 0&&(a=new ND(s,!0)),c=this.parse(h,null,a))throw new ED(c);(d=vde(new Ede)).bindURL(this),this.searchParams=d}};ND.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,g=this,E=r||TD,b=0,I="",A=!1,k=!1,G=!1;for(t=cf(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=vD(t,xde,""),t=vD(t,Dde,"$1")),t=vD(t,Lde,""),a=Rv(t);b<=a.length;){switch(c=a[b],E){case TD:if(!c||!Ld(yB,c)){if(r)return SD;E=CD;continue}I+=TA(c),E=wB;break;case wB:if(c&&(Ld(Ide,c)||c==="+"||c==="-"||c==="."))I+=TA(c);else{if(c!==":"){if(r)return SD;I="",E=CD,b=0;continue}if(r&&(g.isSpecial()!==_D(RA,I)||I==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=I,r)return void(g.isSpecial()&&RA[g.scheme]===g.port&&(g.port=null));I="",g.scheme==="file"?E=kD:g.isSpecial()&&s&&s.scheme===g.scheme?E=TB:g.isSpecial()?E=IB:a[b+1]==="/"?(E=CB,b++):(g.cannotBeABaseURL=!0,Iv(g.path,""),E=PB)}break;case CD:if(!s||s.cannotBeABaseURL&&c!=="#")return SD;if(s.cannotBeABaseURL&&c==="#"){g.scheme=s.scheme,g.path=Dd(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,E=lf;break}E=s.scheme==="file"?kD:RD;continue;case TB:if(c!=="/"||a[b+1]!=="/"){E=RD;continue}E=IA,b++;break;case CB:if(c==="/"){E=AA;break}E=Hh;continue;case RD:if(g.scheme=s.scheme,c===Pu)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Dd(s.path),g.query=s.query;else if(c==="/"||c==="\\"&&g.isSpecial())E=RB;else if(c==="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Dd(s.path),g.query="",E=K_;else{if(c!=="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Dd(s.path),g.path.length--,E=Hh;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Dd(s.path),g.query=s.query,g.fragment="",E=lf}break;case RB:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,E=Hh;continue}E=AA}else E=IA;break;case IB:if(E=IA,c!=="/"||Nu(I,b+1)!=="/")continue;b++;break;case IA:if(c!=="/"&&c!=="\\"){E=AA;continue}break;case AA:if(c==="@"){A&&(I="%40"+I),A=!0,d=Rv(I);for(var j=0;j<d.length;j++){var B=d[j];if(B!==":"||G){var Z=Bm(B,wD);G?g.password+=Z:g.username+=Z}else G=!0}I=""}else if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(A&&I==="")return"Invalid authority";b-=Rv(I).length+1,I="",E=ID}else I+=c;break;case ID:case AD:if(r&&g.scheme==="file"){E=OD;continue}if(c!==":"||k){if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&I==="")return $_;if(r&&I===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(I))return h;if(I="",E=Av,r)return;continue}c==="["?k=!0:c==="]"&&(k=!1),I+=c}else{if(I==="")return $_;if(h=g.parseHost(I))return h;if(I="",E=PD,r===AD)return}break;case PD:if(!Ld(bD,c)){if(c===Pu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(I!==""){var Q=wA(I,10);if(Q>65535)return _B;g.port=g.isSpecial()&&Q===RA[g.scheme]?null:Q,I=""}if(r)return;E=Av;continue}return _B}I+=c;break;case kD:if(g.scheme="file",c==="/"||c==="\\")E=AB;else{if(!s||s.scheme!=="file"){E=Hh;continue}switch(c){case Pu:g.host=s.host,g.path=Dd(s.path),g.query=s.query;break;case"?":g.host=s.host,g.path=Dd(s.path),g.query="",E=K_;break;case"#":g.host=s.host,g.path=Dd(s.path),g.query=s.query,g.fragment="",E=lf;break;default:bB(Nw(Dd(a,b),""))||(g.host=s.host,g.path=Dd(s.path),g.shortenPath()),E=Hh;continue}}break;case AB:if(c==="/"||c==="\\"){E=OD;break}s&&s.scheme==="file"&&!bB(Nw(Dd(a,b),""))&&(Lw(s.path[0],!0)?Iv(g.path,s.path[0]):g.host=s.host),E=Hh;continue;case OD:if(c===Pu||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Lw(I))E=Hh;else if(I===""){if(g.host="",r)return;E=Av}else{if(h=g.parseHost(I))return h;if(g.host==="localhost"&&(g.host=""),r)return;I="",E=Av}continue}I+=c;break;case Av:if(g.isSpecial()){if(E=Hh,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Pu&&(E=Hh,c!=="/"))continue}else g.fragment="",E=lf;else g.query="",E=K_;break;case Hh:if(c===Pu||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=TA(m=I))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,"")):Mde(I)?c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,""):(g.scheme==="file"&&!g.path.length&&Lw(I)&&(g.host&&(g.host=""),I=Nu(I,0)+":"),Iv(g.path,I)),I="",g.scheme==="file"&&(c===Pu||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)Tde(g.path);c==="?"?(g.query="",E=K_):c==="#"&&(g.fragment="",E=lf)}else I+=Bm(c,SB);break;case PB:c==="?"?(g.query="",E=K_):c==="#"?(g.fragment="",E=lf):c!==Pu&&(g.path[0]+=Bm(c,CA));break;case K_:r||c!=="#"?c!==Pu&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Bm(c,CA)):(g.fragment="",E=lf);break;case lf:c!==Pu&&(g.fragment+=Bm(c,vB))}b++}},parseHost:function(t){var r,s,a;if(Nu(t,0)==="["){if(Nu(t,t.length-1)!=="]"||(r=function(c){var d,h,m,g,E,b,I,A=[0,0,0,0,0,0,0,0],k=0,G=null,j=0,B=function(){return Nu(c,j)};if(B()===":"){if(Nu(c,1)!==":")return;j+=2,G=++k}for(;B();){if(k===8)return;if(B()!==":"){for(d=h=0;h<4&&Ld(EB,B());)d=16*d+wA(B(),16),j++,h++;if(B()==="."){if(h===0||(j-=h,k>6))return;for(m=0;B();){if(g=null,m>0){if(!(B()==="."&&m<4))return;j++}if(!Ld(bD,B()))return;for(;Ld(bD,B());){if(E=wA(B(),10),g===null)g=E;else{if(g===0)return;g=10*g+E}if(g>255)return;j++}A[k]=256*A[k]+g,++m!=2&&m!==4||k++}if(m!==4)return;break}if(B()===":"){if(j++,!B())return}else if(B())return;A[k++]=d}else{if(G!==null)return;j++,G=++k}}if(G!==null)for(b=k-G,k=7;k!==0&&b>0;)I=A[k],A[k--]=A[G+b-1],A[G+--b]=I;else if(k!==8)return;return A}(xw(t,1,-1)),!r))return $_;this.host=r}else if(this.isSpecial()){if(t=mde(t),Ld(Ode,t)||(r=function(c){var d,h,m,g,E,b,I,A=Cde(c,".");if(A.length&&A[A.length-1]===""&&A.length--,(d=A.length)>4)return c;for(h=[],m=0;m<d;m++){if((g=A[m])==="")return c;if(E=10,g.length>1&&Nu(g,0)==="0"&&(E=Ld(Ade,g)?16:8,g=xw(g,E===8?1:2)),g==="")b=0;else{if(!Ld(E===10?kde:E===8?Pde:EB,g))return c;b=wA(g,E)}Iv(h,b)}for(m=0;m<d;m++)if(b=h[m],m===d-1){if(b>=gB(256,5-d))return null}else if(b>255)return null;for(I=wde(h),m=0;m<h.length;m++)I+=h[m]*gB(256,3-m);return I}(t),r===null))return $_;this.host=r}else{if(Ld(Nde,t))return $_;for(r="",s=Rv(t),a=0;a<s.length;a++)r+=Bm(s[a],CA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return _D(RA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&Lw(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,g=t.fragment,E=r+":";return c!==null?(E+="//",t.includesCredentials()&&(E+=s+(a?":"+a:"")+"@"),E+=Dw(c),d!==null&&(E+=":"+d)):r==="file"&&(E+="//"),E+=t.cannotBeABaseURL?h[0]:h.length?"/"+Nw(h,"/"):"",m!==null&&(E+="?"+m),g!==null&&(E+="#"+g),E},setHref:function(t){var r=this.parse(t);if(r)throw new ED(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new Pv(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Dw(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(cf(t)+":",TD)},getUsername:function(){return this.username},setUsername:function(t){var r=Rv(cf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Bm(r[s],wD)}},getPassword:function(){return this.password},setPassword:function(t){var r=Rv(cf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Bm(r[s],wD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Dw(t):Dw(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,ID)},getHostname:function(){var t=this.host;return t===null?"":Dw(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,AD)},getPort:function(){var t=this.port;return t===null?"":cf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=cf(t))===""?this.port=null:this.parse(t,PD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Nw(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Av))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=cf(t))===""?this.query=null:(Nu(t,0)==="?"&&(t=xw(t,1)),this.query="",this.parse(t,K_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=cf(t))!==""?(Nu(t,0)==="#"&&(t=xw(t,1)),this.fragment="",this.parse(t,lf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(t){var r=pde(this,Ic),s=_de(arguments.length,1)>1?arguments[1]:void 0,a=yde(r,new ND(t,!1,s));mD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Ic=Pv.prototype,xu=function(t,r){return{get:function(){return bA(this)[t]()},set:r&&function(s){return bA(this)[r](s)},configurable:!0,enumerable:!0}};if(mD&&(Ou(Ic,"href",xu("serialize","setHref")),Ou(Ic,"origin",xu("getOrigin")),Ou(Ic,"protocol",xu("getProtocol","setProtocol")),Ou(Ic,"username",xu("getUsername","setUsername")),Ou(Ic,"password",xu("getPassword","setPassword")),Ou(Ic,"host",xu("getHost","setHost")),Ou(Ic,"hostname",xu("getHostname","setHostname")),Ou(Ic,"port",xu("getPort","setPort")),Ou(Ic,"pathname",xu("getPathname","setPathname")),Ou(Ic,"search",xu("getSearch","setSearch")),Ou(Ic,"searchParams",xu("getSearchParams")),Ou(Ic,"hash",xu("getHash","setHash"))),SA(Ic,"toJSON",function(){return bA(this).serialize()},{enumerable:!0}),SA(Ic,"toString",function(){return bA(this).serialize()},{enumerable:!0}),Ow){var kB=Ow.createObjectURL,OB=Ow.revokeObjectURL;kB&&SA(Pv,"createObjectURL",pB(kB,Ow)),OB&&SA(Pv,"revokeObjectURL",pB(OB,Ow))}gde(Pv,"URL"),dde({global:!0,forced:!hde,sham:!mD},{URL:Pv});var Ude=Gn,NB=u,Vde=Kc,xB=$a,Fde=mA,xD=Ut("URL"),jde=Fde&&NB(function(){xD.canParse()}),Bde=NB(function(){return xD.canParse.length!==1});Ude({target:"URL",stat:!0,forced:!jde||Bde},{canParse:function(t){var r=Vde(arguments.length,1),s=xB(t),a=r<2||arguments[1]===void 0?void 0:xB(arguments[1]);try{return!!new xD(s,a)}catch{return!1}}});var zde=Gn,Wde=Kc,DB=$a,Gde=mA,Hde=Ut("URL");zde({target:"URL",stat:!0,forced:!Gde},{parse:function(t){var r=Wde(arguments.length,1),s=DB(t),a=r<2||arguments[1]===void 0?void 0:DB(arguments[1]);try{return new Hde(s,a)}catch{return null}}});var PA=l(De.URL);let LB=!0,MB=!0;function kA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function q_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=E=>{const b=s(E);b&&(m.handleEvent?m.handleEvent(b):m(b))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function $de(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(LB=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Kde(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(MB=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function UB(){if(typeof window=="object"){if(LB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function DD(t,r){MB&&console.warn(t+" is deprecated, please use "+r+" instead.")}function VB(t){return Object.prototype.toString.call(t)==="[object Object]"}function FB(t){var r;return VB(t)?Ka(r=Object.keys(t)).call(r,function(s,a){const c=VB(t[a]),d=c?FB(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):t}function LD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?LD(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{LD(t,t.get(c),s)})}))}function jB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&LD(t,m,c)})}),c}const BB=UB;function zB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const E=typeof h[g]=="object"?h[g]:{ideal:h[g]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const b=function(I,A){return I?I+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(E.ideal!==void 0){m.optional=m.optional||[];let I={};typeof E.ideal=="number"?(I[b("min",g)]=E.ideal,m.optional.push(I),I={},I[b("max",g)]=E.ideal,m.optional.push(I)):(I[b("",g)]=E.ideal,m.optional.push(I))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[b("",g)]=E.exact):["min","max"].forEach(I=>{E[I]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[b(I,g)]=E[I])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(E,b,I){b in E&&!(I in E)&&(E[I]=E[b],delete E[b])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const E=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let b;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?b=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(b=["front"]),b)return s.mediaDevices.enumerateDevices().then(I=>{I=I.filter(k=>k.kind==="videoinput");let A=I.find(k=>b.some(G=>{var j;return tt(j=k.label.toLowerCase()).call(j,G)}));return!A&&I.length&&tt(b).call(b,"back")&&(A=I[I.length-1]),A&&(h.video.deviceId=g.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=a(h.video),BB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return BB("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,g){c(h,E=>{s.webkitGetUserMedia(E,m,b=>{g&&g(d(b))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,g=>h(g).then(E=>{if(g.audio&&!E.getAudioTracks().length||g.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(b=>{b.stop()}),new DOMException("","NotFoundError");return E},E=>gt.reject(d(E))))}}}function WB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function GB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else q_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function HB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $B(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const g={};return m.result().forEach(E=>{const b={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(I=>{b[I]=E.stat(I)}),g[b.id]=b}),g},h=function(m){return new Map(Object.keys(m).map(g=>[g,m[g]]))};if(arguments.length>=2){const m=function(g){a(h(d(g)))};return r.apply(this,[m,s])}return new gt((m,g)=>{r.apply(this,[function(E){m(h(d(E)))},g])}).then(a,c)}}function KB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>jB(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),q_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>jB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?gt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():gt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function qB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(g=>{if(this.getSenders().find(b=>b.track===g))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(g=>h.indexOf(g)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function YB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return qB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map(E=>this._reverseStreams[E.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach(E=>{if(this.getSenders().find(I=>I.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[g.id]){const E=new t.MediaStream(g.getTracks());this._streams[g.id]=E,this._reverseStreams[E.id]=g,g=E}a.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function d(g,E){let b=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(I=>{const A=g._reverseStreams[I],k=g._streams[A.id];b=b.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:E.type,sdp:b})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const b=[].slice.call(arguments,1);if(b.length!==1||!b[0].getTracks().find(k=>k===g))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===g))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[E.id];if(A)A.addTrack(g),gt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new t.MediaStream([g]);this._streams[E.id]=k,this._reverseStreams[k.id]=E,this.addStream(k)}return this.getSenders().find(k=>k.track===g)},["createOffer","createAnswer"].forEach(function(g){const E=t.RTCPeerConnection.prototype[g],b={[g](){const I=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[A=>{const k=d(this,A);I[0].apply(null,[k])},A=>{I[1]&&I[1].apply(null,A)},arguments[2]]):E.apply(this,arguments).then(A=>d(this,A))}};t.RTCPeerConnection.prototype[g]=b[g]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(g,E){let b=E.sdp;return Object.keys(g._reverseStreams||[]).forEach(I=>{const A=g._reverseStreams[I],k=g._streams[A.id];b=b.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:E.type,sdp:b})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:d(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(I=>g.track===I)&&(E=this._streams[b])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function MD(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function XB(t,r){q_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var JB=Object.freeze({__proto__:null,fixNegotiationNeeded:XB,shimAddTrackRemoveTrack:YB,shimAddTrackRemoveTrackWithNative:qB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:HB,shimGetStats:$B,shimGetUserMedia:zB,shimMediaStream:WB,shimOnTrack:GB,shimPeerConnection:MD,shimSenderReceiverGetStats:KB});function QB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){DD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function ZB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function UD(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(g=>{g.type=s[g.type]||g.type})}catch(g){if(g.name!=="TypeError")throw g;m.forEach((E,b)=>{m.set(b,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(d,h)}}function e6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):gt.resolve(new Map)}}function t6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),q_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function n6(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){DD("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&tt(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function r6(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function i6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function s6(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function o6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function a6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?gt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var c6=Object.freeze({__proto__:null,shimAddTransceiver:i6,shimCreateAnswer:a6,shimCreateOffer:o6,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,gt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:s6,shimGetUserMedia:QB,shimOnTrack:ZB,shimPeerConnection:UD,shimRTCDataChannel:r6,shimReceiverGetStats:t6,shimRemoveStream:n6,shimSenderGetStats:e6});function l6(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),tt(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?tt(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{tt(a).call(a,c.track)&&this.removeTrack(c)})})}}function u6(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),tt(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function d6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,E){const b=arguments.length>=2?arguments[2]:arguments[0],I=s.apply(this,[b]);return E?(I.then(g,E),gt.resolve()):I},r.createAnswer=function(g,E){const b=arguments.length>=2?arguments[2]:arguments[0],I=a.apply(this,[b]);return E?(I.then(g,E),gt.resolve()):I};let m=function(g,E,b){const I=c.apply(this,[g]);return b?(I.then(E,b),gt.resolve()):I};r.setLocalDescription=m,m=function(g,E,b){const I=d.apply(this,[g]);return b?(I.then(E,b),gt.resolve()):I},r.setRemoteDescription=m,m=function(g,E,b){const I=h.apply(this,[g]);return b?(I.then(E,b),gt.resolve()):I},r.addIceCandidate=m}function h6(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(p6(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function p6(t){return t&&t.video!==void 0?Object.assign({},t,{video:FB(t.video)}):t}function f6(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(DD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function m6(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function g6(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function _6(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var y6=Object.freeze({__proto__:null,shimAudioContext:_6,shimCallbacksAPI:d6,shimConstraints:p6,shimCreateOfferLegacy:g6,shimGetUserMedia:h6,shimLocalStreamsAPI:l6,shimRTCIceServerUrls:f6,shimRemoteStreamsAPI:u6,shimTrackEventTransceiver:m6}),E6=`	
\v\f\r \u2028\u2029\uFEFF`,qde=mt,Yde=$a,VD=E6,v6=R("".replace),Xde=RegExp("^["+VD+"]+"),Jde=RegExp("(^|[^"+VD+"])["+VD+"]+$"),Qde=function(t){return function(r){var s=Yde(qde(r));return 1&t&&(s=v6(s,Xde,"")),2&t&&(s=v6(s,Jde,"$1")),s}},Zde={trim:Qde(3)},ehe=JE.PROPER,the=u,S6=E6,nhe=Zde.trim;Gn({target:"String",proto:!0,forced:function(t){return the(function(){return!!S6[t]()||""[t]()!==""||ehe&&S6[t].name!==t})}("trim")},{trim:function(){return nhe(this)}});var rhe=Ec("String","trim"),ihe=N,she=rhe,FD=String.prototype,ohe=function(t){var r=t.trim;return typeof t=="string"||t===FD||ihe(FD,t)&&r===FD.trim?she:r},Do=l(ohe),b6={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(g){const E=r.parseRtpMap(g),b=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=b.length?r.parseFmtp(b[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(g=>g.type===m.type&&g.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(A=>r.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),g=m.length>0&&m[0].ssrc;let E;const b=r.matchPrefix(s,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(k=>parseInt(k,10)));b.length>0&&b[0].length>1&&b[0][0]===g&&(E=b[0][1]),c.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let k={ssrc:g,codecPayloadType:parseInt(A.parameters.apt,10)};g&&E&&(k.rtx={ssrc:E}),a.push(k),d&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(k))}}),a.length===0&&g&&a.push({ssrc:g});let I=r.matchPrefix(s,"b=");return I.length&&(I=I[0].indexOf("b=TIAS:")===0?parseInt(I[0].substring(7),10):I[0].indexOf("b=AS:")===0?1e3*parseInt(I[0].substring(5),10)*.95-16e3:void 0,a.forEach(A=>{A.maxBitrate=I})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(b6);var w6=b6.exports,kv=l(w6),ahe=i({__proto__:null,default:kv},[w6]);function OA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=kv.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,q_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function jD(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||q_(t,"icecandidate",r=>{if(r.candidate){const s=kv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function NA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=kv.splitSections(m.sdp);return g.shift(),g.some(E=>{const b=kv.parseMLine(E);return b&&b.kind==="application"&&b.protocol.indexOf("SCTP")!==-1})},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const E=parseInt(g[1],10);return E!=E?-1:E},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},d=function(m,g){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const b=kv.matchPrefix(m.sdp,"a=max-message-size:");return b.length>0?E=parseInt(b[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(E=2147483637),E},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),g=c(m),E=d(arguments[0],m);let b;b=g===0&&E===0?Number.POSITIVE_INFINITY:g===0||E===0?Math.max(g,E):Math.min(g,E);const I={};Object.defineProperty(I,"maxMessageSize",{get:()=>b}),this._sctp=I}return h.apply(this,arguments)}}function xA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},q_(t,"datachannel",a=>(r(a.channel,a.target),a))}function BD(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function zD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(d=>Do(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function DA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?gt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),gt.resolve())})}function LA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var che=Object.freeze({__proto__:null,removeExtmapAllowMixed:zD,shimAddIceCandidateNullOrEmpty:DA,shimConnectionState:BD,shimMaxMessageSize:NA,shimParameterlessSetLocalDescription:LA,shimRTCIceCandidate:OA,shimRTCIceCandidateRelayProtocol:jD,shimSendThrowTypeError:xA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=UB,a=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=kA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=kA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=kA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:che,extractVersion:kA,disableLog:$de,disableWarnings:Kde,sdp:ahe};switch(a.browser){case"chrome":if(!JB||!MD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=JB,DA(t,a),LA(t),zB(t,a),WB(t),MD(t,a),GB(t),YB(t,a),HB(t),$B(t),KB(t),XB(t,a),OA(t),jD(t),BD(t),NA(t,a),xA(t),zD(t,a);break;case"firefox":if(!c6||!UD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=c6,DA(t,a),LA(t),QB(t,a),UD(t,a),ZB(t),n6(t),e6(t),t6(t),r6(t),i6(t),s6(t),o6(t),a6(t),OA(t),BD(t),NA(t,a),xA(t);break;case"safari":if(!y6||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=y6,DA(t,a),LA(t),f6(t),g6(t),d6(t),l6(t),u6(t),m6(t),h6(t),_6(t),OA(t),jD(t),NA(t,a),xA(t),zD(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var WD=D;Gn({global:!0,forced:WD.globalThis!==WD},{globalThis:WD});var T6=l(D),GD={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",g="major",E="model",b="name",I="type",A="vendor",k="version",G="architecture",j="console",B="mobile",Z="tablet",Q="smarttv",ae="wearable",ye="embedded",_e="Amazon",ue="Apple",Ie="ASUS",Ue="BlackBerry",We="Browser",Qe="Chrome",fn="Firefox",vn="Google",Jt="Huawei",nr="LG",qn="Microsoft",so="Motorola",ze="Opera",rt="Samsung",St="Sharp",He="Sony",U="Xiaomi",le="Zebra",me="Facebook",et="Chromium OS",an="Mac OS",Cr=" Browser",Hi=function(ji){for(var $i={},Dr=0;Dr<ji.length;Dr++)$i[ji[Dr].toUpperCase()]=ji[Dr];return $i},Jl=function(ji,$i){return typeof ji===m&&Ku($i).indexOf(Ku(ji))!==-1},Ku=function(ji){return ji.toLowerCase()},FT=function(ji,$i){if(typeof ji===m)return ji=ji.replace(/^\s\s*/,""),typeof $i===d?ji:ji.substring(0,500)},by=function(ji,$i){for(var Dr,ic,Jd,vi,wf,Ln,Qd=0;Qd<$i.length&&!wf;){var wy=$i[Qd],cp=$i[Qd+1];for(Dr=ic=0;Dr<wy.length&&!wf&&wy[Dr];)if(wf=wy[Dr++].exec(ji))for(Jd=0;Jd<cp.length;Jd++)Ln=wf[++ic],typeof(vi=cp[Jd])===h&&vi.length>0?vi.length===2?typeof vi[1]==c?this[vi[0]]=vi[1].call(this,Ln):this[vi[0]]=vi[1]:vi.length===3?typeof vi[1]!==c||vi[1].exec&&vi[1].test?this[vi[0]]=Ln?Ln.replace(vi[1],vi[2]):a:this[vi[0]]=Ln?vi[1].call(this,Ln,vi[2]):a:vi.length===4&&(this[vi[0]]=Ln?vi[3].call(this,Ln.replace(vi[1],vi[2])):a):this[vi]=Ln||a;Qd+=2}},wS=function(ji,$i){for(var Dr in $i)if(typeof $i[Dr]===h&&$i[Dr].length>0){for(var ic=0;ic<$i[Dr].length;ic++)if(Jl($i[Dr][ic],ji))return Dr==="?"?a:Dr}else if(Jl($i[Dr],ji))return Dr==="?"?a:Dr;return $i.hasOwnProperty("*")?$i["*"]:ji},L1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},M1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[b,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[b,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[b,k],[/opios[\/ ]+([\w\.]+)/i],[k,[b,ze+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[k,[b,ze+" GX"]],[/\bopr\/([\w\.]+)/i],[k,[b,ze]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[k,[b,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[k,[b,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[b,k],[/quark(?:pc)?\/([-\w\.]+)/i],[k,[b,"Quark"]],[/\bddg\/([\w\.]+)/i],[k,[b,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[b,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[k,[b,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[b,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[b,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[k,[b,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[k,[b,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[b,/(.+)/,"$1 Secure "+We],k],[/\bfocus\/([\w\.]+)/i],[k,[b,fn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[b,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[b,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[b,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[b,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[b,"MIUI"+Cr]],[/fxios\/([\w\.-]+)/i],[k,[b,fn]],[/\bqihoobrowser\/?([\w\.]*)/i],[k,[b,"360"]],[/\b(qq)\/([\w\.]+)/i],[[b,/(.+)/,"$1Browser"],k],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[b,/(.+)/,"$1"+Cr],k],[/samsungbrowser\/([\w\.]+)/i],[k,[b,rt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[k,[b,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[b,"Sogou Mobile"],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[b,k],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[b],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[k,b],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[b,me],k],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[b,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[b,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[k,[b,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[b,Qe+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[b,Qe+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[b,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[b,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[b,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,b],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[b,[k,wS,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[b,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[b,"Netscape"],k],[/(wolvic|librewolf)\/([\w\.]+)/i],[b,k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[b,fn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[b,[k,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[b,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Ku]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Ku]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Ku]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[A,rt],[I,Z]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[E,[A,rt],[I,B]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[A,ue],[I,B]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[A,ue],[I,Z]],[/(macintosh);/i],[E,[A,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[A,St],[I,B]],[/(?:honor)([-\w ]+)[;\)]/i],[E,[A,"Honor"],[I,B]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[A,Jt],[I,Z]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[A,Jt],[I,B]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[E,/_/g," "],[A,U],[I,B]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[A,U],[I,Z]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[A,"OPPO"],[I,B]],[/\b(opd2\d{3}a?) bui/i],[E,[A,"OPPO"],[I,Z]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[A,"Vivo"],[I,B]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[A,"Realme"],[I,B]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[A,so],[I,B]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[A,so],[I,Z]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[A,nr],[I,Z]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[A,nr],[I,B]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[A,"Lenovo"],[I,Z]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[A,"Nokia"],[I,B]],[/(pixel c)\b/i],[E,[A,vn],[I,Z]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[A,vn],[I,B]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[A,He],[I,B]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[A,He],[I,Z]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[A,"OnePlus"],[I,B]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[A,_e],[I,Z]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[A,_e],[I,B]],[/(playbook);[-\w\),; ]+(rim)/i],[E,A,[I,Z]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[A,Ue],[I,B]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[A,Ie],[I,Z]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[A,Ie],[I,B]],[/(nexus 9)/i],[E,[A,"HTC"],[I,Z]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[E,/_/g," "],[I,B]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[E,[A,"TCL"],[I,Z]],[/(itel) ((\w+))/i],[[A,Ku],E,[I,wS,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[A,"Acer"],[I,Z]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[A,"Meizu"],[I,B]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[A,"Ulefone"],[I,B]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[E,[A,"Energizer"],[I,B]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[E,[A,"Cat"],[I,B]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[E,[A,"Smartfren"],[I,B]],[/droid.+; (a(?:015|06[35]|142p?))/i],[E,[A,"Nothing"],[I,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,E,[I,B]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,E,[I,Z]],[/(surface duo)/i],[E,[A,qn],[I,Z]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[A,"Fairphone"],[I,B]],[/(u304aa)/i],[E,[A,"AT&T"],[I,B]],[/\bsie-(\w*)/i],[E,[A,"Siemens"],[I,B]],[/\b(rct\w+) b/i],[E,[A,"RCA"],[I,Z]],[/\b(venue[\d ]{2,7}) b/i],[E,[A,"Dell"],[I,Z]],[/\b(q(?:mv|ta)\w+) b/i],[E,[A,"Verizon"],[I,Z]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[A,"Barnes & Noble"],[I,Z]],[/\b(tm\d{3}\w+) b/i],[E,[A,"NuVision"],[I,Z]],[/\b(k88) b/i],[E,[A,"ZTE"],[I,Z]],[/\b(nx\d{3}j) b/i],[E,[A,"ZTE"],[I,B]],[/\b(gen\d{3}) b.+49h/i],[E,[A,"Swiss"],[I,B]],[/\b(zur\d{3}) b/i],[E,[A,"Swiss"],[I,Z]],[/\b((zeki)?tb.*\b) b/i],[E,[A,"Zeki"],[I,Z]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],E,[I,Z]],[/\b(ns-?\w{0,9}) b/i],[E,[A,"Insignia"],[I,Z]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[A,"NextBook"],[I,Z]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],E,[I,B]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],E,[I,B]],[/\b(ph-1) /i],[E,[A,"Essential"],[I,B]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[A,"Envizen"],[I,Z]],[/\b(trio[-\w\. ]+) b/i],[E,[A,"MachSpeed"],[I,Z]],[/\btu_(1491) b/i],[E,[A,"Rotor"],[I,Z]],[/(shield[\w ]+) b/i],[E,[A,"Nvidia"],[I,Z]],[/(sprint) (\w+)/i],[A,E,[I,B]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[A,qn],[I,B]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[A,le],[I,Z]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[A,le],[I,B]],[/smart-tv.+(samsung)/i],[A,[I,Q]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[A,rt],[I,Q]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,nr],[I,Q]],[/(apple) ?tv/i],[A,[E,ue+" TV"],[I,Q]],[/crkey/i],[[E,Qe+"cast"],[A,vn],[I,Q]],[/droid.+aft(\w+)( bui|\))/i],[E,[A,_e],[I,Q]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[A,St],[I,Q]],[/(bravia[\w ]+)( bui|\))/i],[E,[A,He],[I,Q]],[/(mitv-\w{5}) bui/i],[E,[A,U],[I,Q]],[/Hbbtv.*(technisat) (.*);/i],[A,E,[I,Q]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,FT],[E,FT],[I,Q]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[I,Q]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,E,[I,j]],[/droid.+; (shield) bui/i],[E,[A,"Nvidia"],[I,j]],[/(playstation [345portablevi]+)/i],[E,[A,He],[I,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[A,qn],[I,j]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[E,[A,rt],[I,ae]],[/((pebble))app/i],[A,E,[I,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[A,ue],[I,ae]],[/droid.+; (glass) \d/i],[E,[A,vn],[I,ae]],[/droid.+; (wt63?0{2,3})\)/i],[E,[A,le],[I,ae]],[/droid.+; (glass) \d/i],[E,[A,vn],[I,ae]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,E,[I,ae]],[/; (quest( \d| pro)?)/i],[E,[A,me],[I,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[I,ye]],[/(aeobc)\b/i],[E,[A,_e],[I,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[E,[I,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[I,Z]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[I,Z]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[I,B]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[b,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[b,k],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[b,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[b,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,b]],os:[[/microsoft (windows) (vista|xp)/i],[b,k],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[b,[k,wS,L1]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[k,wS,L1],[b,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[b,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[b,an],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,b],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[b,k],[/\(bb(10);/i],[k,[b,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[b,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[b,fn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[b,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[b,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[b,Qe+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[b,et],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[b,k],[/(sunos) ?([\w\.\d]*)/i],[[b,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[b,k]]},Ql=function(ji,$i){if(typeof ji===h&&($i=ji,ji=a),!(this instanceof Ql))return new Ql(ji,$i).getResult();var Dr=typeof s!==d&&s.navigator?s.navigator:a,ic=ji||(Dr&&Dr.userAgent?Dr.userAgent:""),Jd=Dr&&Dr.userAgentData?Dr.userAgentData:a,vi=$i?function(Ln,Qd){var wy={};for(var cp in Ln)Qd[cp]&&Qd[cp].length%2==0?wy[cp]=Qd[cp].concat(Ln[cp]):wy[cp]=Ln[cp];return wy}(M1,$i):M1,wf=Dr&&Dr.userAgent==ic;return this.getBrowser=function(){var Ln={};return Ln[b]=a,Ln[k]=a,by.call(Ln,ic,vi.browser),Ln[g]=function(Qd){return typeof Qd===m?Qd.replace(/[^\d\.]/g,"").split(".")[0]:a}(Ln[k]),wf&&Dr&&Dr.brave&&typeof Dr.brave.isBrave==c&&(Ln[b]="Brave"),Ln},this.getCPU=function(){var Ln={};return Ln[G]=a,by.call(Ln,ic,vi.cpu),Ln},this.getDevice=function(){var Ln={};return Ln[A]=a,Ln[E]=a,Ln[I]=a,by.call(Ln,ic,vi.device),wf&&!Ln[I]&&Jd&&Jd.mobile&&(Ln[I]=B),wf&&Ln[E]=="Macintosh"&&Dr&&typeof Dr.standalone!==d&&Dr.maxTouchPoints&&Dr.maxTouchPoints>2&&(Ln[E]="iPad",Ln[I]=Z),Ln},this.getEngine=function(){var Ln={};return Ln[b]=a,Ln[k]=a,by.call(Ln,ic,vi.engine),Ln},this.getOS=function(){var Ln={};return Ln[b]=a,Ln[k]=a,by.call(Ln,ic,vi.os),wf&&!Ln[b]&&Jd&&Jd.platform&&Jd.platform!="Unknown"&&(Ln[b]=Jd.platform.replace(/chrome os/i,et).replace(/macos/i,an)),Ln},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ic},this.setUA=function(Ln){return ic=typeof Ln===m&&Ln.length>500?FT(Ln,500):Ln,this},this.setUA(ic),this};Ql.VERSION="0.7.40",Ql.BROWSER=Hi([b,k,g]),Ql.CPU=Hi([G]),Ql.DEVICE=Hi([E,A,I,j,B,Q,Z,ae,ye]),Ql.ENGINE=Ql.OS=Hi([b,k]),t.exports&&(r=t.exports=Ql),r.UAParser=Ql;var bf=typeof s!==d&&(s.jQuery||s.Zepto);if(bf&&!bf.ua){var U1=new Ql;bf.ua=U1.getResult(),bf.ua.get=function(){return U1.getUA()},bf.ua.set=function(ji){U1.setUA(ji);var $i=U1.getResult();for(var Dr in $i)bf.ua[Dr]=$i[Dr]}}})(typeof window=="object"?window:o)})(GD,GD.exports);var lhe=l(GD.exports),C6=Nm.clear;Gn({global:!0,bind:!0,forced:D.clearImmediate!==C6},{clearImmediate:C6});var R6=D,uhe=re,dhe=pe,hhe=a_,phe=hn,fhe=ws,mhe=Kc,ghe=R6.Function,_he=/MSIE .\./.test(phe)||hhe==="BUN"&&function(){var t=R6.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),yhe=Gn,I6=D,A6=Nm.set,Ehe=function(t,r){var s=1;return _he?function(a,c){var d=mhe(arguments.length,1)>s,h=dhe(a)?a:ghe(a),m=d?fhe(arguments,s):[],g=d?function(){uhe(h,this,m)}:h;return t(g)}:t},P6=I6.setImmediate?Ehe(A6):A6;yhe({global:!0,bind:!0,forced:I6.setImmediate!==P6},{setImmediate:P6});var k6=l(De.setImmediate),vhe=D,She=Cw,bhe=wr,whe=Kc,The=ve;Gn({global:!0,dontCallGetSet:!0,forced:u(function(){return The&&Object.getOwnPropertyDescriptor(vhe,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){whe(arguments.length,1),She(bhe(t))}});var O6=l(De.queueMicrotask);function N6(t,r){return function(){return t.apply(r,arguments)}}const{toString:Che}=Object.prototype,{getPrototypeOf:HD}=Object,{iterator:MA,toStringTag:x6}=Symbol,UA=($D=Object.create(null),t=>{const r=Che.call(t);return $D[r]||($D[r]=r.slice(8,-1).toLowerCase())});var $D;const Md=t=>(t=t.toLowerCase(),r=>UA(r)===t),VA=t=>r=>typeof r===t,{isArray:Ov}=Array,Mw=VA("undefined"),D6=Md("ArrayBuffer"),Rhe=VA("string"),Xc=VA("function"),L6=VA("number"),FA=t=>t!==null&&typeof t=="object",jA=t=>{if(UA(t)!=="object")return!1;const r=HD(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||x6 in t||MA in t)},Ihe=Md("Date"),Ahe=Md("File"),Phe=Md("Blob"),khe=Md("FileList"),Ohe=Md("URLSearchParams"),[Nhe,xhe,Dhe,Lhe]=["ReadableStream","Request","Response","Headers"].map(Md);function Uw(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Ov(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function M6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const Y_=T6!==void 0?T6:typeof self<"u"?self:typeof window<"u"?window:Ny,U6=t=>!Mw(t)&&t!==Y_,Mhe=(KD=typeof Uint8Array<"u"&&HD(Uint8Array),t=>KD&&t instanceof KD);var KD;const Uhe=Md("HTMLFormElement"),V6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),Vhe=Md("RegExp"),F6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};Uw(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)}),Object.defineProperties(t,a)},Fhe=Md("AsyncFunction"),j6=(B6=typeof k6=="function",z6=Xc(Y_.postMessage),B6?k6:z6?(qD="axios@".concat(Math.random()),BA=[],Y_.addEventListener("message",t=>{let{source:r,data:s}=t;r===Y_&&s===qD&&BA.length&&BA.shift()()},!1),t=>{BA.push(t),Y_.postMessage(qD,"*")}):t=>setTimeout(t));var B6,z6,qD,BA;const jhe=O6!==void 0?O6.bind(Y_):typeof process<"u"&&process.nextTick||j6;var ft={isArray:Ov,isArrayBuffer:D6,isBuffer:function(t){return t!==null&&!Mw(t)&&t.constructor!==null&&!Mw(t.constructor)&&Xc(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Xc(t.append)&&((r=UA(t))==="formdata"||r==="object"&&Xc(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&D6(t.buffer),r},isString:Rhe,isNumber:L6,isBoolean:t=>t===!0||t===!1,isObject:FA,isPlainObject:jA,isReadableStream:Nhe,isRequest:xhe,isResponse:Dhe,isHeaders:Lhe,isUndefined:Mw,isDate:Ihe,isFile:Ahe,isBlob:Phe,isRegExp:Vhe,isFunction:Xc,isStream:t=>FA(t)&&Xc(t.pipe),isURLSearchParams:Ohe,isTypedArray:Mhe,isFileList:khe,forEach:Uw,merge:function t(){const{caseless:r}=U6(this)&&this||{},s={},a=(c,d)=>{const h=r&&M6(s,d)||d;jA(s[h])&&jA(c)?s[h]=t(s[h],c):jA(c)?s[h]=t({},c):Ov(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&Uw(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Uw(r,(c,d)=>{s&&Xc(c)?t[d]=N6(c,s):t[d]=c},{allOwnKeys:a}),t},trim:t=>Do(t)?Do(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&HD(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:UA,kindOfTest:Md,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Ov(t))return t;let r=t.length;if(!L6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[MA]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:Uhe,hasOwnProperty:V6,hasOwnProp:V6,reduceDescriptors:F6,freezeMethods:t=>{F6(t,(r,s)=>{if(Xc(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];Xc(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Ov(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:M6,global:Y_,isContextDefined:U6,isSpecCompliantForm:function(t){return!!(t&&Xc(t.append)&&t[x6]==="FormData"&&t[MA])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(FA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=Ov(a)?[]:{};return Uw(a,(h,m)=>{const g=s(h,c+1);!Mw(g)&&(d[m]=g)}),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:Fhe,isThenable:t=>t&&(FA(t)||Xc(t))&&Xc(t.then)&&Xc(t.catch),setImmediate:j6,asap:jhe,isIterable:t=>t!=null&&Xc(t[MA])};function mr(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}ft.inherits(mr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ft.toJSONObject(this.config),code:this.code,status:this.status}}});const W6=mr.prototype,G6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{G6[t]={value:t}}),Object.defineProperties(mr,G6),Object.defineProperty(W6,"isAxiosError",{value:!0}),mr.from=(t,r,s,a,c,d)=>{const h=Object.create(W6);return ft.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),mr.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function YD(t){return ft.isPlainObject(t)||ft.isArray(t)}function H6(t){return ft.endsWith(t,"[]")?t.slice(0,-2):t}function $6(t,r,s){return t?t.concat(r).map(function(a,c){return a=H6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const Bhe=ft.toFlatObject(ft,{},null,function(t){return/^is[A-Z]/.test(t)});function zA(t,r,s){if(!ft.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=ft.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,k){return!ft.isUndefined(k[A])})).metaTokens,c=s.visitor||E,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ft.isSpecCompliantForm(r);if(!ft.isFunction(c))throw new TypeError("visitor must be a function");function g(A){if(A===null)return"";if(ft.isDate(A))return A.toISOString();if(!m&&ft.isBlob(A))throw new mr("Blob is not supported. Use a Buffer instead.");return ft.isArrayBuffer(A)||ft.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function E(A,k,G){let j=A;if(A&&!G&&typeof A=="object"){if(ft.endsWith(k,"{}"))k=a?k:k.slice(0,-2),A=JSON.stringify(A);else if(ft.isArray(A)&&function(B){return ft.isArray(B)&&!B.some(YD)}(A)||(ft.isFileList(A)||ft.endsWith(k,"[]"))&&(j=ft.toArray(A)))return k=H6(k),j.forEach(function(B,Z){!ft.isUndefined(B)&&B!==null&&r.append(h===!0?$6([k],Z,d):h===null?k:k+"[]",g(B))}),!1}return!!YD(A)||(r.append($6(G,k,d),g(A)),!1)}const b=[],I=Object.assign(Bhe,{defaultVisitor:E,convertValue:g,isVisitable:YD});if(!ft.isObject(t))throw new TypeError("data must be an object");return function A(k,G){if(!ft.isUndefined(k)){if(b.indexOf(k)!==-1)throw Error("Circular reference detected in "+G.join("."));b.push(k),ft.forEach(k,function(j,B){(!(ft.isUndefined(j)||j===null)&&c.call(r,j,ft.isString(B)?Do(B).call(B):B,G,I))===!0&&A(j,G?G.concat(B):[B])}),b.pop()}}(t),r}function K6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function XD(t,r){this._pairs=[],t&&zA(t,this,r)}const q6=XD.prototype;function zhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Y6(t,r,s){if(!r)return t;const a=s&&s.encode||zhe;ft.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):ft.isURLSearchParams(r)?r.toString():new XD(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}q6.append=function(t,r){this._pairs.push([t,r])},q6.toString=function(t){const r=t?function(s){return t.call(this,s,K6)}:K6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var X6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ft.forEach(this.handlers,function(r){r!==null&&t(r)})}},J6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Q6={exports:{}},Whe=Gn,Ghe=ve,Z6=qt.f;Whe({target:"Object",stat:!0,forced:Object.defineProperty!==Z6,sham:!Ghe},{defineProperty:Z6});var ez=De.Object,Hhe=Q6.exports=function(t,r,s){return ez.defineProperty(t,r,s)};ez.defineProperty.sham&&(Hhe.sham=!0);var tz=l(Q6.exports),$he=TypeError,nz=Ed,Khe=Us,qhe=we,Yhe=Or("species"),rz=Array,Xhe=function(t){var r;return nz(t)&&(r=t.constructor,(Khe(r)&&(r===rz||nz(r.prototype))||qhe(r)&&(r=r[Yhe])===null)&&(r=void 0)),r===void 0?rz:r},iz=function(t,r){return new(Xhe(t))(r===0?0:r)},Jhe=u,Qhe=li,Zhe=Or("species"),sz=function(t){return Qhe>=51||!Jhe(function(){var r=[];return(r.constructor={})[Zhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},epe=Gn,tpe=u,npe=Ed,rpe=we,ipe=Ks,spe=dr,oz=function(t){if(t>9007199254740991)throw $he("Maximum allowed index exceeded");return t},az=hD,ope=iz,ape=sz,cpe=li,cz=Or("isConcatSpreadable"),lpe=cpe>=51||!tpe(function(){var t=[];return t[cz]=!1,t.concat()[0]!==t}),upe=function(t){if(!rpe(t))return!1;var r=t[cz];return r!==void 0?!!r:npe(t)};epe({target:"Array",proto:!0,forced:!lpe||!ape("concat")},{concat:function(t){var r,s,a,c,d,h=ipe(this),m=ope(h,0),g=0;for(r=-1,a=arguments.length;r<a;r++)if(upe(d=r===-1?h:arguments[r]))for(c=spe(d),oz(g+c),s=0;s<c;s++,g++)s in d&&az(m,g,d[s]);else oz(g+1),az(m,g++,d);return m.length=g,m}});var lz={},dpe=X,hpe=sn,uz=Sd.f,ppe=ws,dz=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];lz.f=function(t){return dz&&dpe(t)==="Window"?function(r){try{return uz(r)}catch{return ppe(dz)}}(t):uz(hpe(t))};var Nv={},fpe=Or;Nv.f=fpe;var hz=De,mpe=Hr,gpe=Nv,_pe=qt.f,Ts=function(t){var r=hz.Symbol||(hz.Symbol={});mpe(r,t)||_pe(r,t,{value:gpe.f(t)})},ype=be,Epe=Ut,vpe=Or,Spe=kd,pz=function(){var t=Epe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=vpe("toPrimitive");r&&!r[a]&&Spe(r,a,function(c){return ype(s,this)},{})},bpe=ot,wpe=it,Tpe=Ks,Cpe=dr,Rpe=iz,fz=R([].push),Ipe=function(t){var r=t===1,s=t===2,a=t===3,c=t===4,d=t===6,h=t===7,m=t===5||d;return function(g,E,b,I){for(var A,k,G=Tpe(g),j=wpe(G),B=Cpe(j),Z=bpe(E,b),Q=0,ae=I||Rpe,ye=r?ae(g,B):s||h?ae(g,0):void 0;B>Q;Q++)if((m||Q in j)&&(k=Z(A=j[Q],Q,G),t))if(r)ye[Q]=k;else if(k)switch(t){case 3:return!0;case 5:return A;case 6:return Q;case 2:fz(ye,A)}else switch(t){case 4:return!1;case 7:fz(ye,A)}return d?-1:a||c?c:ye}},mz={forEach:Ipe(0)},WA=Gn,Vw=D,JD=be,Ape=R,xv=ve,Dv=qi,Ppe=u,sa=Hr,kpe=N,QD=tr,GA=sn,ZD=fr,Ope=$a,eL=qe,Lv=__,gz=Ta,Npe=Sd,_z=lz,xpe=ym,yz=he,Ez=qt,Dpe=Oh,vz=Re,Sz=kd,Lpe=Dh,tL=_o,bz=Dl,wz=Fc,Mpe=Or,Upe=Nv,Vpe=Ts,Fpe=pz,jpe=wu,Tz=xh,HA=mz.forEach,Jc=gm("hidden"),$A="Symbol",Fw="prototype",Bpe=Tz.set,Cz=Tz.getterFor($A),Ud=Object[Fw],X_=Vw.Symbol,KA=X_&&X_[Fw],zpe=Vw.RangeError,Wpe=Vw.TypeError,nL=Vw.QObject,Rz=yz.f,J_=Ez.f,Iz=_z.f,Gpe=vz.f,Az=Ape([].push),uf=tL("symbols"),jw=tL("op-symbols"),Hpe=tL("wks"),rL=!nL||!nL[Fw]||!nL[Fw].findChild,Pz=function(t,r,s){var a=Rz(Ud,r);a&&delete Ud[r],J_(t,r,s),a&&t!==Ud&&J_(Ud,r,a)},iL=xv&&Ppe(function(){return Lv(J_({},"a",{get:function(){return J_(this,"a",{value:7}).a}})).a!==7})?Pz:J_,sL=function(t,r){var s=uf[t]=Lv(KA);return Bpe(s,{type:$A,tag:t,description:r}),xv||(s.description=r),s},qA=function(t,r,s){t===Ud&&qA(jw,r,s),QD(t);var a=ZD(r);return QD(s),sa(uf,a)?(s.enumerable?(sa(t,Jc)&&t[Jc][a]&&(t[Jc][a]=!1),s=Lv(s,{enumerable:eL(0,!1)})):(sa(t,Jc)||J_(t,Jc,eL(1,Lv(null))),t[Jc][a]=!0),iL(t,a,s)):J_(t,a,s)},oL=function(t,r){QD(t);var s=GA(r),a=gz(s).concat(xz(s));return HA(a,function(c){xv&&!JD(kz,s,c)||qA(t,c,s[c])}),t},kz=function(t){var r=ZD(t),s=JD(Gpe,this,r);return!(this===Ud&&sa(uf,r)&&!sa(jw,r))&&(!(s||!sa(this,r)||!sa(uf,r)||sa(this,Jc)&&this[Jc][r])||s)},Oz=function(t,r){var s=GA(t),a=ZD(r);if(s!==Ud||!sa(uf,a)||sa(jw,a)){var c=Rz(s,a);return!c||!sa(uf,a)||sa(s,Jc)&&s[Jc][a]||(c.enumerable=!0),c}},Nz=function(t){var r=Iz(GA(t)),s=[];return HA(r,function(a){sa(uf,a)||sa(bz,a)||Az(s,a)}),s},xz=function(t){var r=t===Ud,s=Iz(r?jw:GA(t)),a=[];return HA(s,function(c){!sa(uf,c)||r&&!sa(Ud,c)||Az(a,uf[c])}),a};Dv||(X_=function(){if(kpe(KA,this))throw new Wpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Ope(arguments[0]):void 0,r=wz(t),s=function(a){var c=this===void 0?Vw:this;c===Ud&&JD(s,jw,a),sa(c,Jc)&&sa(c[Jc],r)&&(c[Jc][r]=!1);var d=eL(1,a);try{iL(c,r,d)}catch(h){if(!(h instanceof zpe))throw h;Pz(c,r,d)}};return xv&&rL&&iL(Ud,r,{configurable:!0,set:s}),sL(r,t)},Sz(KA=X_[Fw],"toString",function(){return Cz(this).tag}),Sz(X_,"withoutSetter",function(t){return sL(wz(t),t)}),vz.f=kz,Ez.f=qA,Dpe.f=oL,yz.f=Oz,Npe.f=_z.f=Nz,xpe.f=xz,Upe.f=function(t){return sL(Mpe(t),t)},xv&&Lpe(KA,"description",{configurable:!0,get:function(){return Cz(this).description}})),WA({global:!0,wrap:!0,forced:!Dv,sham:!Dv},{Symbol:X_}),HA(gz(Hpe),function(t){Vpe(t)}),WA({target:$A,stat:!0,forced:!Dv},{useSetter:function(){rL=!0},useSimple:function(){rL=!1}}),WA({target:"Object",stat:!0,forced:!Dv,sham:!xv},{create:function(t,r){return r===void 0?Lv(t):oL(Lv(t),r)},defineProperty:qA,defineProperties:oL,getOwnPropertyDescriptor:Oz}),WA({target:"Object",stat:!0,forced:!Dv},{getOwnPropertyNames:Nz}),Fpe(),jpe(X_,$A),bz[Jc]=!0;var Dz=qi&&!!Symbol.for&&!!Symbol.keyFor,$pe=Gn,Kpe=Ut,qpe=Hr,Ype=$a,Lz=_o,Xpe=Dz,aL=Lz("string-to-symbol-registry"),Jpe=Lz("symbol-to-string-registry");$pe({target:"Symbol",stat:!0,forced:!Xpe},{for:function(t){var r=Ype(t);if(qpe(aL,r))return aL[r];var s=Kpe("Symbol")(r);return aL[r]=s,Jpe[s]=r,s}});var Qpe=Gn,Zpe=Hr,efe=go,tfe=Jo,nfe=Dz,Mz=_o("symbol-to-string-registry");Qpe({target:"Symbol",stat:!0,forced:!nfe},{keyFor:function(t){if(!efe(t))throw new TypeError(tfe(t)+" is not a symbol");if(Zpe(Mz,t))return Mz[t]}});var Uz=Ed,rfe=pe,Vz=X,ife=$a,Fz=R([].push),sfe=Gn,jz=Ut,Bz=re,ofe=be,Bw=R,zz=u,Wz=pe,Gz=go,Hz=ws,afe=function(t){if(rfe(t))return t;if(Uz(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?Fz(s,c):typeof c!="number"&&Vz(c)!=="Number"&&Vz(c)!=="String"||Fz(s,ife(c))}var d=s.length,h=!0;return function(m,g){if(h)return h=!1,g;if(Uz(this))return g;for(var E=0;E<d;E++)if(s[E]===m)return g}}},cfe=qi,lfe=String,zm=jz("JSON","stringify"),YA=Bw(/./.exec),$z=Bw("".charAt),ufe=Bw("".charCodeAt),dfe=Bw("".replace),hfe=Bw(1 .toString),pfe=/[\uD800-\uDFFF]/g,Kz=/^[\uD800-\uDBFF]$/,qz=/^[\uDC00-\uDFFF]$/,Yz=!cfe||zz(function(){var t=jz("Symbol")("stringify detection");return zm([t])!=="[null]"||zm({a:t})!=="{}"||zm(Object(t))!=="{}"}),Xz=zz(function(){return zm("\uDF06\uD834")!=='"\\udf06\\ud834"'||zm("\uDEAD")!=='"\\udead"'}),ffe=function(t,r){var s=Hz(arguments),a=afe(r);if(Wz(a)||t!==void 0&&!Gz(t))return s[1]=function(c,d){if(Wz(a)&&(d=ofe(a,this,lfe(c),d)),!Gz(d))return d},Bz(zm,null,s)},mfe=function(t,r,s){var a=$z(s,r-1),c=$z(s,r+1);return YA(Kz,t)&&!YA(qz,c)||YA(qz,t)&&!YA(Kz,a)?"\\u"+hfe(ufe(t,0),16):t};zm&&sfe({target:"JSON",stat:!0,forced:Yz||Xz},{stringify:function(t,r,s){var a=Hz(arguments),c=Bz(Yz?ffe:zm,null,a);return Xz&&typeof c=="string"?dfe(c,pfe,mfe):c}});var Jz=ym,gfe=Ks;Gn({target:"Object",stat:!0,forced:!qi||u(function(){Jz.f(1)})},{getOwnPropertySymbols:function(t){var r=Jz.f;return r?r(gfe(t)):[]}}),Ts("asyncIterator"),Ts("hasInstance"),Ts("isConcatSpreadable"),Ts("iterator"),Ts("match"),Ts("matchAll"),Ts("replace"),Ts("search"),Ts("species"),Ts("split");var _fe=pz;Ts("toPrimitive"),_fe();var yfe=Ut,Efe=wu;Ts("toStringTag"),Efe(yfe("Symbol"),"Symbol"),Ts("unscopables"),wu(D.JSON,"JSON",!0);var vfe=De.Symbol,Sfe=Or,bfe=qt.f,Qz=Sfe("metadata"),Zz=Function.prototype;Zz[Qz]===void 0&&bfe(Zz,Qz,{value:null}),Ts("asyncDispose"),Ts("dispose"),Ts("metadata");var wfe=vfe,Tfe=R,cL=Ut("Symbol"),Cfe=cL.keyFor,Rfe=Tfe(cL.prototype.valueOf),e8=cL.isRegisteredSymbol||function(t){try{return Cfe(Rfe(t))!==void 0}catch{return!1}};Gn({target:"Symbol",stat:!0},{isRegisteredSymbol:e8});for(var Ife=_o,t8=Ut,Afe=R,Pfe=go,kfe=Or,XA=t8("Symbol"),n8=XA.isWellKnownSymbol,r8=t8("Object","getOwnPropertyNames"),Ofe=Afe(XA.prototype.valueOf),i8=Ife("wks"),lL=0,s8=r8(XA),Nfe=s8.length;lL<Nfe;lL++)try{var o8=s8[lL];Pfe(XA[o8])&&kfe(o8)}catch{}var a8=function(t){if(n8&&n8(t))return!0;try{for(var r=Ofe(t),s=0,a=r8(i8),c=a.length;s<c;s++)if(i8[a[s]]==r)return!0}catch{}return!1};Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:a8}),Ts("customMatcher"),Ts("observable"),Gn({target:"Symbol",stat:!0},{isRegistered:e8}),Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:a8}),Ts("matcher"),Ts("metadataKey"),Ts("patternMatch"),Ts("replaceAll");var Mv=l(wfe),c8=l(Nv.f("iterator"));function zw(t){return zw=typeof Mv=="function"&&typeof c8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Mv=="function"&&r.constructor===Mv&&r!==Mv.prototype?"symbol":typeof r},zw(t)}var xfe=l(Nv.f("toPrimitive"));function Dfe(t){var r=function(s,a){if(zw(s)!="object"||!s)return s;var c=s[xfe];if(c!==void 0){var d=c.call(s,a);if(zw(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return zw(r)=="symbol"?r:r+""}function Y(t,r,s){return(r=Dfe(r))in t?tz(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var l8=l(Due),Lfe={isBrowser:!0,classes:{URLSearchParams:l8!==void 0?l8:XD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const uL=typeof window<"u"&&typeof document<"u",dL=typeof navigator=="object"&&navigator||void 0,Mfe=uL&&(!dL||["ReactNative","NativeScript","NS"].indexOf(dL.product)<0),Ufe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Vfe=uL&&window.location.href||"http://localhost";function u8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function d8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?u8(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):u8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var Qa=d8(d8({},Object.freeze({__proto__:null,hasBrowserEnv:uL,hasStandardBrowserEnv:Mfe,hasStandardBrowserWebWorkerEnv:Ufe,navigator:dL,origin:Vfe})),Lfe),Ffe=tr,jfe=be,Bfe=Hr,zfe=N,Wfe=function(){var t=Ffe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},h8=RegExp.prototype,p8=function(t){var r=t.flags;return r!==void 0||"flags"in h8||Bfe(t,"flags")||!zfe(h8,t)?r:jfe(Wfe,t)},Gfe=Qx.charAt,f8=be,Hfe=tr,$fe=pe,Kfe=X,qfe=/./.exec,Yfe=TypeError,Xfe=Gn,m8=be,g8=ne,Jfe=A_,JA=ov,_8=mt,y8=si,Ww=$a,Qfe=tr,Zfe=we,eme=X,tme=ib,E8=p8,nme=Ba,rme=u,ime=sf,sme=function(t,r,s){return r+(s?Gfe(t,r).length:1)},ome=function(t,r){var s=t.exec;if($fe(s)){var a=f8(s,t,r);return a!==null&&Hfe(a),a}if(Kfe(t)==="RegExp")return f8(qfe,t,r);throw new Yfe("RegExp#exec called on incompatible receiver")},v8=xh,ame=Or("matchAll"),S8="RegExp String",b8=S8+" Iterator",cme=v8.set,lme=v8.getterFor(b8),ume=TypeError,hL=g8("".indexOf),QA=g8("".matchAll),pL=!!QA&&!rme(function(){QA("a",/./)}),dme=Jfe(function(t,r,s,a){cme(this,{type:b8,regexp:t,string:r,global:s,unicode:a,done:!1})},S8,function(){var t=lme(this);if(t.done)return JA(void 0,!0);var r=t.regexp,s=t.string,a=ome(r,s);return a===null?(t.done=!0,JA(void 0,!0)):t.global?(Ww(a[0])===""&&(r.lastIndex=sme(s,y8(r.lastIndex),t.unicode)),JA(a,!1)):(t.done=!0,JA(a,!1))}),w8=function(t){var r,s,a,c=Qfe(this),d=Ww(t),h=ime(c,RegExp),m=Ww(E8(c));return r=new h(h===RegExp?c.source:c,m),s=!!~hL(m,"g"),a=!!~hL(m,"u"),r.lastIndex=y8(c.lastIndex),new dme(r,d,s,a)};Xfe({target:"String",proto:!0,forced:pL},{matchAll:function(t){var r,s,a,c,d=_8(this);if(Zfe(t)){if(tme(t)&&(r=Ww(_8(E8(t))),!~hL(r,"g")))throw new ume("`.matchAll` does not allow non-global regexes");if(pL)return QA(d,t);if((a=nme(t,ame))===void 0&&eme(t)==="RegExp"&&(a=w8),a)return m8(a,t,d)}else if(pL)return QA(d,t);return s=Ww(d),c=new RegExp(t,"g"),m8(w8,c,s)}});var hme=Ec("String","matchAll"),pme=N,fme=hme,fL=String.prototype,mme=function(t){var r=t.matchAll;return typeof t=="string"||t===fL||pme(fL,t)&&r===fL.matchAll?fme:r},gme=l(mme);function T8(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=d>=s.length;return h=!h&&ft.isArray(c)?c.length:h,g?(ft.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&ft.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&ft.isArray(c[h])&&(c[h]=function(E){const b={},I=Object.keys(E);let A;const k=I.length;let G;for(A=0;A<k;A++)G=I[A],b[G]=E[G];return b}(c[h])),!m)}if(ft.isFormData(t)&&ft.isFunction(t.entries)){const s={};return ft.forEachEntry(t,(a,c)=>{r(function(d){return gme(ft).call(ft,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const mL={transitional:J6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=ft.isObject(t);if(c&&ft.isHTMLForm(t)&&(t=new FormData(t)),ft.isFormData(t))return a?JSON.stringify(T8(t)):t;if(ft.isArrayBuffer(t)||ft.isBuffer(t)||ft.isStream(t)||ft.isFile(t)||ft.isBlob(t)||ft.isReadableStream(t))return t;if(ft.isArrayBufferView(t))return t.buffer;if(ft.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return zA(h,new Qa.classes.URLSearchParams,Object.assign({visitor:function(g,E,b,I){return Qa.isNode&&ft.isBuffer(g)?(this.append(E,g.toString("base64")),!1):I.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=ft.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return zA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,g){if(ft.isString(h))try{return(m||JSON.parse)(h),Do(ft).call(ft,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(g||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||mL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ft.isResponse(t)||ft.isReadableStream(t))return t;if(t&&ft.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?mr.from(d,mr.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qa.classes.FormData,Blob:Qa.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ft.forEach(["delete","get","head","post","put","patch"],t=>{mL.headers[t]={}});var gL=mL;const _me=ft.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),C8=Symbol("internals");function Gw(t){var r;return t&&Do(r=String(t)).call(r).toLowerCase()}function ZA(t){return t===!1||t==null?t:ft.isArray(t)?t.map(ZA):String(t)}function _L(t,r,s,a,c){return ft.isFunction(a)?a.call(this,r,s):(c&&(r=s),ft.isString(r)?ft.isString(a)?r.indexOf(a)!==-1:ft.isRegExp(a)?a.test(r):void 0:void 0)}class eP{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(g,E,b){const I=Gw(E);if(!I)throw new Error("header name must be a non-empty string");const A=ft.findKey(c,I);(!A||c[A]===void 0||b===!0||b===void 0&&c[A]!==!1)&&(c[A||E]=ZA(g))}const h=(g,E)=>ft.forEach(g,(b,I)=>d(b,I,E));if(ft.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ft.isString(r)&&(r=Do(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Do(m=r).call(m)))h((g=>{const E={};let b,I,A;return g&&g.split(`
`).forEach(function(k){var G,j;A=k.indexOf(":"),b=Do(G=k.substring(0,A)).call(G).toLowerCase(),I=Do(j=k.substring(A+1)).call(j),!b||E[b]&&_me[b]||(b==="set-cookie"?E[b]?E[b].push(I):E[b]=[I]:E[b]=E[b]?E[b]+", "+I:I)}),E})(r),s);else if(ft.isObject(r)&&ft.isIterable(r)){let g,E,b={};for(const I of r){if(!ft.isArray(I))throw TypeError("Object iterator must return a key-value pair");b[E=I[0]]=(g=b[E])?ft.isArray(g)?[...g,I[1]]:[g,I[1]]:I[1]}h(b,s)}else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=Gw(r)){const a=ft.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(d);)h[g[1]]=g[2];return h}(c);if(ft.isFunction(s))return s.call(this,c,a);if(ft.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=Gw(r)){const a=ft.findKey(this,r);return!(!a||this[a]===void 0||s&&!_L(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=Gw(h)){const m=ft.findKey(a,h);!m||s&&!_L(0,a[m],m,s)||(delete a[m],c=!0)}}return ft.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!_L(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return ft.forEach(this,(c,d)=>{var h;const m=ft.findKey(a,d);if(m)return s[m]=ZA(c),void delete s[d];const g=r?function(E){return Do(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(b,I,A)=>I.toUpperCase()+A)}(d):Do(h=String(d)).call(h);g!==d&&delete s[d],s[g]=ZA(c),a[g]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ft.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&ft.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[C8]=this[C8]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=Gw(d);s[h]||(function(m,g){const E=ft.toCamelCase(" "+g);["get","set","has"].forEach(b=>{Object.defineProperty(m,b+E,{value:function(I,A,k){return this[b].call(this,g,I,A,k)},configurable:!0})})}(a,d),s[h]=!0)}return ft.isArray(r)?r.forEach(c):c(r),this}}eP.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ft.reduceDescriptors(eP.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),ft.freezeMethods(eP);var Vd=eP;function yL(t,r){const s=this||gL,a=r||s,c=Vd.from(a.headers);let d=a.data;return ft.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function R8(t){return!(!t||!t.__CANCEL__)}function Uv(t,r,s){mr.call(this,t??"canceled",mr.ERR_CANCELED,r,s),this.name="CanceledError"}function I8(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new mr("Request failed with status code "+s.status,[mr.ERR_BAD_REQUEST,mr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ft.inherits(Uv,mr,{__CANCEL__:!0});const tP=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(d,h){d=d||10;const m=new Array(d),g=new Array(d);let E,b=0,I=0;return h=h!==void 0?h:1e3,function(A){const k=Date.now(),G=g[I];E||(E=k),m[b]=A,g[b]=k;let j=I,B=0;for(;j!==b;)B+=m[j++],j%=d;if(b=(b+1)%d,b===I&&(I=(I+1)%d),k-E<h)return;const Z=G&&k-G;return Z?Math.round(1e3*B/Z):void 0}}(50,250);return function(d,h){let m,g,E=0,b=1e3/h;const I=function(A){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),d.apply(null,A)};return[function(){const A=Date.now(),k=A-E;for(var G=arguments.length,j=new Array(G),B=0;B<G;B++)j[B]=arguments[B];k>=b?I(j,A):(m=j,g||(g=setTimeout(()=>{g=null,I(m)},b-k)))},()=>m&&I(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,g=h-a,E=c(g);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},A8=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},P8=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return ft.asap(()=>t(...s))};var yme=Qa.hasStandardBrowserEnv?((t,r)=>s=>(s=new PA(s,Qa.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new PA(Qa.origin),Qa.navigator&&/(msie|trident)/i.test(Qa.navigator.userAgent)):()=>!0,Eme=Qa.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];ft.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ft.isString(a)&&h.push("path="+a),ft.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function k8(t,r,s){let a=!function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)}(r);return t&&(a||s==0)?function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c}(t,r):r}function O8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const N8=t=>t instanceof Vd?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?O8(Object(a),!0).forEach(function(c){Y(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):O8(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function Q_(t,r){r=r||{};const s={};function a(E,b,I,A){return ft.isPlainObject(E)&&ft.isPlainObject(b)?ft.merge.call({caseless:A},E,b):ft.isPlainObject(b)?ft.merge({},b):ft.isArray(b)?b.slice():b}function c(E,b,I,A){return ft.isUndefined(b)?ft.isUndefined(E)?void 0:a(void 0,E,0,A):a(E,b,0,A)}function d(E,b){if(!ft.isUndefined(b))return a(void 0,b)}function h(E,b){return ft.isUndefined(b)?ft.isUndefined(E)?void 0:a(void 0,E):a(void 0,b)}function m(E,b,I){return I in r?a(E,b):I in t?a(void 0,E):void 0}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,b,I)=>c(N8(E),N8(b),0,!0)};return ft.forEach(Object.keys(Object.assign({},t,r)),function(E){const b=g[E]||c,I=b(t[E],r[E],E);ft.isUndefined(I)&&b!==m||(s[E]=I)}),s}var x8=t=>{const r=Q_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:g}=r;if(r.headers=m=Vd.from(m),r.url=Y6(k8(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),ft.isFormData(a)){if(Qa.hasStandardBrowserEnv||Qa.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...b]=s?s.split(";").map(I=>Do(I).call(I)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...b].join("; "))}}if(Qa.hasStandardBrowserEnv&&(c&&ft.isFunction(c)&&(c=c(r)),c||c!==!1&&yme(r.url))){const E=d&&h&&Eme.read(h);E&&m.set(d,E)}return r},vme=typeof XMLHttpRequest<"u"&&function(t){return new gt(function(r,s){const a=x8(t);let c=a.data;const d=Vd.from(a.headers).normalize();let h,m,g,E,b,{responseType:I,onUploadProgress:A,onDownloadProgress:k}=a;function G(){E&&E(),b&&b(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function B(){if(!j)return;const Q=Vd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());I8(function(ae){r(ae),G()},function(ae){s(ae),G()},{data:I&&I!=="text"&&I!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:Q,config:t,request:j}),j=null}j.open(a.method.toUpperCase(),a.url,!0),j.timeout=a.timeout,"onloadend"in j?j.onloadend=B:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(B)},j.onabort=function(){j&&(s(new mr("Request aborted",mr.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new mr("Network Error",mr.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let Q=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const ae=a.transitional||J6;a.timeoutErrorMessage&&(Q=a.timeoutErrorMessage),s(new mr(Q,ae.clarifyTimeoutError?mr.ETIMEDOUT:mr.ECONNABORTED,t,j)),j=null},c===void 0&&d.setContentType(null),"setRequestHeader"in j&&ft.forEach(d.toJSON(),function(Q,ae){j.setRequestHeader(ae,Q)}),ft.isUndefined(a.withCredentials)||(j.withCredentials=!!a.withCredentials),I&&I!=="json"&&(j.responseType=a.responseType),k&&([g,b]=tP(k,!0),j.addEventListener("progress",g)),A&&j.upload&&([m,E]=tP(A),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",E)),(a.cancelToken||a.signal)&&(h=Q=>{j&&(s(!Q||Q.type?new Uv(null,t,j):Q),j.abort(),j=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const Z=function(Q){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Q);return ae&&ae[1]||""}(a.url);Z&&Qa.protocols.indexOf(Z)===-1?s(new mr("Unsupported protocol "+Z+":",mr.ERR_BAD_REQUEST,t)):j.send(c||null)})},Sme=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(E){if(!a){a=!0,m();const b=E instanceof Error?E:this.reason;c.abort(b instanceof mr?b:new Uv(b instanceof Error?b.message:b))}};let h=r&&setTimeout(()=>{h=null,d(new mr("timeout ".concat(r," of ms exceeded"),mr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(E=>{E.unsubscribe?E.unsubscribe(d):E.removeEventListener("abort",d)}),t=null)};t.forEach(E=>E.addEventListener("abort",d));const{signal:g}=c;return g.unsubscribe=()=>ft.asap(m),g}},EL=l(v4),D8=Nv.f("asyncIterator"),bme=l(D8);function vL(t,r){this.v=t,this.k=r}function Bl(t){return function(){return new Hw(t.apply(this,arguments))}}function Hw(t){var r,s;function a(d,h){try{var m=t[d](h),g=m.value,E=g instanceof vL;EL.resolve(E?g.v:g).then(function(b){if(E){var I=d==="return"?"return":"next";if(!g.k||b.done)return a(I,b);b=t[I](b).value}c(m.done?"return":"normal",b)},function(b){a("throw",b)})}catch(b){c("throw",b)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new EL(function(m,g){var E={key:d,arg:h,resolve:m,reject:g,next:null};s?s=s.next=E:(r=s=E,a(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function Vn(t){return new vL(t,0)}function nP(t){var r={},s=!1;function a(c,d){return s=!0,d=new EL(function(h){h(t[c](d))}),{done:!1,value:new vL(d,1)}}return r[Mv!==void 0&&c8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}Hw.prototype[typeof Mv=="function"&&bme||"@@asyncIterator"]=function(){return this},Hw.prototype.next=function(t){return this._invoke("next",t)},Hw.prototype.throw=function(t){return this._invoke("throw",t)},Hw.prototype.return=function(t){return this._invoke("return",t)};var SL=l(D8);function bL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=SL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new rP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function rP(t){function r(s){if(Object(s)!==s)return gt.reject(new TypeError(s+" is not an object."));var a=s.done;return gt.resolve(s.value).then(function(c){return{value:c,done:a}})}return rP=function(s){this.s=s,this.n=s.next},rP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?gt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?gt.reject(s):r(a.apply(this.s,arguments))}},new rP(t)}const wme=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Tme=function(){var t=Bl(function*(r,s){var a,c=!1,d=!1;try{for(var h,m=bL(Cme(r));c=!(h=yield Vn(m.next())).done;c=!1){const g=h.value;yield*nP(bL(wme(g,s)))}}catch(g){d=!0,a=g}finally{try{c&&m.return!=null&&(yield Vn(m.return()))}finally{if(d)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),Cme=function(){var t=Bl(function*(r){if(r[SL])return void(yield*nP(bL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield Vn(s.read());if(a)break;yield c}}finally{yield Vn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),L8=(t,r,s,a)=>{const c=Tme(t,r);let d,h=0,m=g=>{d||(d=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:E,value:b}=await c.next();if(E)return m(),void g.close();let I=b.byteLength;if(s){let A=h+=I;s(A)}g.enqueue(new Uint8Array(b))}catch(E){throw m(E),E}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function M8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function U8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M8(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const iP=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",V8=iP&&typeof ReadableStream=="function",Rme=iP&&(typeof TextEncoder=="function"?(F8=new TextEncoder,t=>F8.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var F8;const j8=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},Ime=V8&&j8(()=>{let t=!1;const r=new Request(Qa.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),wL=V8&&j8(()=>ft.isReadableStream(new Response("").body)),sP={stream:wL&&(t=>t.body)};var B8;iP&&(B8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!sP[t]&&(sP[t]=ft.isFunction(B8[t])?r=>r[t]():(r,s)=>{throw new mr("Response type '".concat(t,"' is not supported"),mr.ERR_NOT_SUPPORT,s)})}));const Ame=async(t,r)=>{const s=ft.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:ft.isBlob(a)?a.size:ft.isSpecCompliantForm(a)?(await new Request(Qa.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:ft.isArrayBufferView(a)||ft.isArrayBuffer(a)?a.byteLength:(ft.isURLSearchParams(a)&&(a+=""),ft.isString(a)?(await Rme(a)).byteLength:void 0))(r)};var Pme=iP&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:E,headers:b,withCredentials:I="same-origin",fetchOptions:A}=x8(t);E=E?(E+"").toLowerCase():"text";let k,G=Sme([c,d&&d.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let B;try{if(g&&Ime&&s!=="get"&&s!=="head"&&(B=await Ame(b,a))!==0){let _e,ue=new Request(r,{method:"POST",body:a,duplex:"half"});if(ft.isFormData(a)&&(_e=ue.headers.get("content-type"))&&b.setContentType(_e),ue.body){const[Ie,Ue]=A8(B,tP(P8(g)));a=L8(ue.body,65536,Ie,Ue)}}ft.isString(I)||(I=I?"include":"omit");const Z="credentials"in Request.prototype;k=new Request(r,U8(U8({},A),{},{signal:G,method:s.toUpperCase(),headers:b.normalize().toJSON(),body:a,duplex:"half",credentials:Z?I:void 0}));let Q=await fetch(k);const ae=wL&&(E==="stream"||E==="response");if(wL&&(m||ae&&j)){const _e={};["status","statusText","headers"].forEach(We=>{_e[We]=Q[We]});const ue=ft.toFiniteNumber(Q.headers.get("content-length")),[Ie,Ue]=m&&A8(ue,tP(P8(m),!0))||[];Q=new Response(L8(Q.body,65536,Ie,()=>{Ue&&Ue(),j&&j()}),_e)}E=E||"text";let ye=await sP[ft.findKey(sP,E)||"text"](Q,t);return!ae&&j&&j(),await new gt((_e,ue)=>{I8(_e,ue,{data:ye,headers:Vd.from(Q.headers),status:Q.status,statusText:Q.statusText,config:t,request:k})})}catch(Z){throw j&&j(),Z&&Z.name==="TypeError"&&/Load failed|fetch/i.test(Z.message)?Object.assign(new mr("Network Error",mr.ERR_NETWORK,t,k),{cause:Z.cause||Z}):mr.from(Z,Z&&Z.code,t,k)}});const TL={http:null,xhr:vme,fetch:Pme};ft.forEach(TL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const z8=t=>"- ".concat(t),kme=t=>ft.isFunction(t)||t===null||t===!1;var W8={getAdapter:t=>{t=ft.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!kme(s)&&(a=TL[(h=String(s)).toLowerCase()],a===void 0))throw new mr("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map(h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")});throw new mr("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(z8).join(`
`):" "+z8(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:TL};function CL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Uv(null,t)}function G8(t){return CL(t),t.headers=Vd.from(t.headers),t.data=yL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),W8.getAdapter(t.adapter||gL.adapter)(t).then(function(r){return CL(t),r.data=yL.call(t,t.transformResponse,r),r.headers=Vd.from(r.headers),r},function(r){return R8(r)||(CL(t),r&&r.response&&(r.response.data=yL.call(t,t.transformResponse,r.response),r.response.headers=Vd.from(r.response.headers))),gt.reject(r)})}const H8="1.9.0",oP={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{oP[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const $8={};oP.transitional=function(t,r,s){function a(c,d){return"[Axios v"+H8+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new mr(a(d," has been removed"+(r?" in "+r:"")),mr.ERR_DEPRECATED);return r&&!$8[d]&&($8[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},oP.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var aP={assertOptions:function(t,r,s){if(typeof t!="object")throw new mr("options must be an object",mr.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],g=m===void 0||h(m,d,t);if(g!==!0)throw new mr("option "+d+" must be "+g,mr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new mr("Unknown option "+d,mr.ERR_BAD_OPTION)}},validators:oP};const $h=aP.validators;let cP=class{constructor(t){this.defaults=t||{},this.interceptors={request:new X6,response:new X6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=Q_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&aP.assertOptions(s,{silentJSONParsing:$h.transitional($h.boolean),forcedJSONParsing:$h.transitional($h.boolean),clarifyTimeoutError:$h.transitional($h.boolean)},!1),a!=null&&(ft.isFunction(a)?r.paramsSerializer={serialize:a}:aP.assertOptions(a,{encode:$h.function,serialize:$h.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),aP.assertOptions(r,{baseUrl:$h.spelling("baseURL"),withXsrfToken:$h.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&ft.merge(c.common,c[r.method]);c&&ft.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),r.headers=Vd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(r)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const g=[];let E;this.interceptors.response.forEach(function(k){g.push(k.fulfilled,k.rejected)});let b,I=0;if(!m){const k=[G8.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,g),b=k.length,E=gt.resolve(r);I<b;)E=E.then(k[I++],k[I++]);return E}b=h.length;let A=r;for(I=0;I<b;){const k=h[I++],G=h[I++];try{A=k(A)}catch(j){G.call(this,j);break}}try{E=G8.call(this,A)}catch(k){return gt.reject(k)}for(I=0,b=g.length;I<b;)E=E.then(g[I++],g[I++]);return E}getUri(t){return Y6(k8((t=Q_(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};ft.forEach(["delete","get","head","options"],function(t){cP.prototype[t]=function(r,s){return this.request(Q_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ft.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,d){return this.request(Q_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}cP.prototype[t]=r(),cP.prototype[t+"Form"]=r(!0)});var lP=cP;class RL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new gt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new gt(m=>{a.subscribe(m),d=m}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r(function(c,d,h){a.reason||(a.reason=new Uv(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new RL(function(a){r=a}),cancel:r}}}var Ome=RL;const IL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(IL).forEach(t=>{let[r,s]=t;IL[s]=r});var Nme=IL;const Eo=function t(r){const s=new lP(r),a=N6(lP.prototype.request,s);return ft.extend(a,lP.prototype,s,{allOwnKeys:!0}),ft.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(Q_(r,c))},a}(gL);Eo.Axios=lP,Eo.CanceledError=Uv,Eo.CancelToken=Ome,Eo.isCancel=R8,Eo.VERSION=H8,Eo.toFormData=zA,Eo.AxiosError=mr,Eo.Cancel=Eo.CanceledError,Eo.all=function(t){return gt.all(t)},Eo.spread=function(t){return function(r){return t.apply(null,r)}},Eo.isAxiosError=function(t){return ft.isObject(t)&&t.isAxiosError===!0},Eo.mergeConfig=Q_,Eo.AxiosHeaders=Vd,Eo.formToJSON=t=>T8(ft.isHTMLForm(t)?new FormData(t):t),Eo.getAdapter=W8.getAdapter,Eo.HttpStatusCode=Nme,Eo.default=Eo;var Ia=Eo;const xme=()=>{};function $w(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:xme};return t.promise=new gt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const uP=new Map,dP=new Map,Kh=new Map;let ss=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Hn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const K8=new lhe;let Fd=K8.getResult(),AL=null;function xn(t){if(!AL){Fd=K8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Hn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Hn.CHROME;case"Safari":case"Mobile Safari":return Hn.SAFARI;case"Edge":return Hn.EDGE;case"Firefox":return Hn.FIREFOX;case"QQ":case"QQBrowser":return Hn.QQ;case"Opera":return Hn.OPERA;case"WeChat":return Hn.WECHAT;default:return m.browser.name||""}}(Fd),s=q8(Fd),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Fd),c=Fd.os.version,d=q8(Fd,!1),h=Fd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};AL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return AL}function q8(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function hP(){return xn().os}function Y8(){const t=xn();return"".concat(t.os," ").concat(t.osVersion)}function pP(){const t=xn();return!!(Fd.engine.name==="WebKit"&&t.os===ss.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Hn.SAFARI||vo()&&t.name!==Hn.SAFARI)}function df(){return xn().name===Hn.CHROME}function Vs(){return xn().name===Hn.SAFARI}function X8(){const t=xn();if(t.name!==Hn.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function J8(){return xn().name===Hn.EDGE}function ei(){return xn().name===Hn.FIREFOX}function vo(){return xn().os===ss.IOS}function Vv(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)>=t}function Q8(t){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)<t}function PL(t,r,s){const a=xn();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function kL(t){const r=xn();return!(r.name!==Hn.EDGE||!r.osVersion)&&Number(r.version)>=t}function OL(t){const r=xn();return!(r.name!==Hn.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function Z8(t){const r=xn();return!(r.name!==Hn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function eW(t,r,s){const a=xn();if(a.os!==ss.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function tW(t,r,s){const a=xn();if(a.os!==ss.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function NL(t,r,s){const a=xn();if(a.name!==Hn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function xL(t){const r=xn();return!(r.name!==Hn.OPERA||!r.osVersion)&&Number(r.version)>=t}function nW(){const t=xn();if(t.os!==ss.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Fv(){const t=xn();if(t.os!==ss.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function DL(){const t=xn();if(t.os!==ss.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function rW(){const t=xn();if(t.os!==ss.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Du(){return Vs()&&navigator.maxTouchPoints>0}function iW(){return xn().name===Hn.WECHAT}function sW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function LL(){const t=hP();return function(){const{deviceType:r}=xn();return r==="mobile"||r==="tablet"}()||t===ss.ANDROID||t===ss.IOS||t===ss.HARMONY_OS}function hf(){const t=xn();return t.name!==Hn.EDGE&&t.name!==Hn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function fP(){return hP()===ss.ANDROID}function Kw(){const t=xn();return fP()&&(t.name===Hn.CHROME||t.name===Hn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Zt(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function oW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ze(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oW(Object(s),!0).forEach(function(a){Zt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let ee=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Zt(this,"code",void 0),Zt(this,"message",void 0),Zt(this,"data",void 0),Zt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function jd(t,r){if(typeof t!="boolean")throw new Le(ee.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ji(t,r,s){if(!tt(s).call(s,t))throw new Le(ee.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function gr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(ee.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function ML(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(ee.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&gr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&gr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&gr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&gr(t.ideal,"".concat(r,".ideal"),1,1/0)}else gr(t,r,1,1/0)}function Cs(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(ee.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!aW(t,s,a,c))throw new Le(ee.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function pf(t,r){if(!Array.isArray(t))throw new Le(ee.INVALID_PARAMS,"".concat(r," should be an array"))}function ti(t){return t==null}function aW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var qw=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(qw||{}),UL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(UL||{});const cW=new class{constructor(){Zt(this,"_clientSize",null),Zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Zt(this,"getStyle",t=>window.getComputedStyle(t,null)),Zt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||tt(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(g=>{var E;const b=g.split("(")[0];return tt(E=["brightness","blur","opacity"]).call(E,b)}).map(g=>{const[E,b]=g.split(/\(|\)/);return[E,Number(b.match(/^[0-9\.]+/))]}).forEach(g=>{const[E,b]=g;switch(E){case"brightness":(b<.1||b>3)&&(s=!1);break;case"blur":b>3&&(s=!1);break;case"opacity":b<.1&&(s=!1)}}),s)}),Zt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),Zt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Zt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}}),Zt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Zt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Zt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),Zt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let E=0;E<5;E++){const b=(s*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,I=(a*m+(E===0?.1:E===4?(d*E*m-1e5)/m:d*E)*m)/m;h.push({x:b,y:I})}return[...h]}),Zt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Zt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Zt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,g,E,b;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(g=r<d?r:d,s<0)E=0;else{if(!(s<c))return!1;E=s}if(a<0)return!1;b=a<c?a:c;const I=g-m,A=b-E;return this.checkSizeIsVisible(I,A,h)}),Zt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Zt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(qw.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(qw.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(qw.SIZE)}}return this.returnHiddenResult(qw.STYLE)}return this.returnHiddenResult(UL.UNMOUNTED)}return this.returnHiddenResult(UL.INVALID_HTML_ELEMENT)}),Zt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function VL(t){return new TextEncoder().encode(t)}const lW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},FL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",VL(t)),16);class Jr{constructor(){Zt(this,"_events",{}),Zt(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(s=>s.listener):[]}on(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(r,s){if(!this._events[r])return;const a=this._events[r],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const s=this._events[r].map(h=>h);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(r,m.listener),m.listener.apply(this,c||[])}}safeEmit(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[r]||[]].forEach(d=>{d.once&&this.off(r,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h==null?void 0:h.toString()))}})}_indexOfListener(r,s){let a=r.length;for(;a--;)if(r[a].listener===s)return a;return-1}}let Yw=null;function uW(){if(Yw)return Yw;if(window.electron)return Yw=window.electron;if(!window.require)return null;try{return Yw=window.require("electron"),Yw}catch{return null}}let di=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t}({}),$r=function(t){return t.TRACER="tracer",t}({});function dW(t){return gr(t.timeout,"config.timeout",0,1e5),gr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),gr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),gr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Dme=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),rr=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Xw(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function hW(t){return Cs(t.turnServerURL,"turnServerURL"),Cs(t.username,"username"),Cs(t.password,"password"),t.udpport&&gr(t.udpport,"udpport",1,99999,!0),t.forceturn&&jd(t.forceturn,"forceturn"),t.security&&jd(t.security,"security"),t.tcpport&&gr(t.tcpport,"tcpport",1,99999,!0),!0}function jL(t){return t.level!==void 0&&Ji(t.level,"level",[1,2,3]),t.delay!==void 0&&gr(t.delay,"delay",0,3e3,!0),!0}let Cn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Fs=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Ac=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),jv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function js(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?gt.reject(new Le(ee.UNEXPECTED_ERROR,"can not emit promise")):new gt((d,h)=>{t.emit(r,...a,d,h)})}function yr(t,r){if(t.getListeners(r).length===0)return gt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return js(t,r,...a)}function Qc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Jw(t,r,...a)}function Jw(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Le(ee.UNEXPECTED_ERROR,"handler is not sync");return s}const Ci=new class extends Jr{set networkState(t){this.emit(jv.NETWORK_STATE_CHANGE,t,this._networkState),t===Ac.ONLINE?this.emit(jv.ONLINE):t===Ac.OFFLINE&&(this.onlineWaiter=new gt(r=>{this.once(jv.ONLINE,()=>{this.onlineWaiter=void 0,r(Ac.ONLINE)})}),this.emit(jv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ac.ONLINE}constructor(){super(),Zt(this,"_moduleName","network-indicator"),Zt(this,"_networkState",Ac.ONLINE),Zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ac.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ac.OFFLINE})}};function mP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Bv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function gP(t){gt!==void 0?gt.resolve().then(t):setTimeout(t,0)}function Kr(t){return JSON.parse(JSON.stringify(t))}function Z_(t){try{return Kr(t)}catch{return t}}const pW={};function Wm(t,r){pW[r]||(pW[r]=!0,t())}function ey(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Gm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function fW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function mW(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Ka(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function qh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function gW(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?qh(s):s.size}),r+138}function Lme(t){const r=new Le(ee.TIMEOUT,"timeout");return new gt((s,a)=>{window.setTimeout(()=>a(r),t)})}function Rs(t){return new gt(r=>{window.setTimeout(r,t)})}function Er(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+Er(t-s.length,"")}function ty(){return Er(32,"").toUpperCase()}const _P=()=>{},_W=new class{constructor(){Zt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:g,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,Ze(Ze({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},yW=_W.throttleByKey.bind(_W);function EW(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function BL(t,r){if(!EW(t)||!EW(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=BL(t[a],r[a]);return s}{const s=Ze({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=BL(t[a],r[a]):s[a]=r[a]);return s}}function vW(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function zv(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function zL(t){return Ka(t).call(t,(r,s)=>r+s,0)}function SW(t){const r="0123456789abcdef";function s(ae){let ye,_e="";for(ye=0;ye<=3;ye++)_e+=r.charAt(ae>>8*ye+4&15)+r.charAt(ae>>8*ye&15);return _e}function a(ae,ye){const _e=(65535&ae)+(65535&ye);return(ae>>16)+(ye>>16)+(_e>>16)<<16|65535&_e}function c(ae,ye,_e,ue,Ie,Ue){return a(function(We,Qe){return We<<Qe|We>>>32-Qe}(a(a(ye,ae),a(ue,Ue)),Ie),_e)}function d(ae,ye,_e,ue,Ie,Ue,We){return c(ye&_e|~ye&ue,ae,ye,Ie,Ue,We)}function h(ae,ye,_e,ue,Ie,Ue,We){return c(ye&ue|_e&~ue,ae,ye,Ie,Ue,We)}function m(ae,ye,_e,ue,Ie,Ue,We){return c(ye^_e^ue,ae,ye,Ie,Ue,We)}function g(ae,ye,_e,ue,Ie,Ue,We){return c(_e^(ye|~ue),ae,ye,Ie,Ue,We)}const E=function(ae){let ye;const _e=1+(ae.length+8>>6),ue=new Array(16*_e);for(ye=0;ye<16*_e;ye++)ue[ye]=0;for(ye=0;ye<ae.length;ye++)ue[ye>>2]|=ae.charCodeAt(ye)<<ye%4*8;return ue[ye>>2]|=128<<ye%4*8,ue[16*_e-2]=8*ae.length,ue}(t);let b,I,A,k,G,j=1732584193,B=-271733879,Z=-1732584194,Q=271733878;for(b=0;b<E.length;b+=16)I=j,A=B,k=Z,G=Q,j=d(j,B,Z,Q,E[b+0],7,-680876936),Q=d(Q,j,B,Z,E[b+1],12,-389564586),Z=d(Z,Q,j,B,E[b+2],17,606105819),B=d(B,Z,Q,j,E[b+3],22,-1044525330),j=d(j,B,Z,Q,E[b+4],7,-176418897),Q=d(Q,j,B,Z,E[b+5],12,1200080426),Z=d(Z,Q,j,B,E[b+6],17,-1473231341),B=d(B,Z,Q,j,E[b+7],22,-45705983),j=d(j,B,Z,Q,E[b+8],7,1770035416),Q=d(Q,j,B,Z,E[b+9],12,-1958414417),Z=d(Z,Q,j,B,E[b+10],17,-42063),B=d(B,Z,Q,j,E[b+11],22,-1990404162),j=d(j,B,Z,Q,E[b+12],7,1804603682),Q=d(Q,j,B,Z,E[b+13],12,-40341101),Z=d(Z,Q,j,B,E[b+14],17,-1502002290),B=d(B,Z,Q,j,E[b+15],22,1236535329),j=h(j,B,Z,Q,E[b+1],5,-165796510),Q=h(Q,j,B,Z,E[b+6],9,-1069501632),Z=h(Z,Q,j,B,E[b+11],14,643717713),B=h(B,Z,Q,j,E[b+0],20,-373897302),j=h(j,B,Z,Q,E[b+5],5,-701558691),Q=h(Q,j,B,Z,E[b+10],9,38016083),Z=h(Z,Q,j,B,E[b+15],14,-660478335),B=h(B,Z,Q,j,E[b+4],20,-405537848),j=h(j,B,Z,Q,E[b+9],5,568446438),Q=h(Q,j,B,Z,E[b+14],9,-1019803690),Z=h(Z,Q,j,B,E[b+3],14,-187363961),B=h(B,Z,Q,j,E[b+8],20,1163531501),j=h(j,B,Z,Q,E[b+13],5,-1444681467),Q=h(Q,j,B,Z,E[b+2],9,-51403784),Z=h(Z,Q,j,B,E[b+7],14,1735328473),B=h(B,Z,Q,j,E[b+12],20,-1926607734),j=m(j,B,Z,Q,E[b+5],4,-378558),Q=m(Q,j,B,Z,E[b+8],11,-2022574463),Z=m(Z,Q,j,B,E[b+11],16,1839030562),B=m(B,Z,Q,j,E[b+14],23,-35309556),j=m(j,B,Z,Q,E[b+1],4,-1530992060),Q=m(Q,j,B,Z,E[b+4],11,1272893353),Z=m(Z,Q,j,B,E[b+7],16,-155497632),B=m(B,Z,Q,j,E[b+10],23,-1094730640),j=m(j,B,Z,Q,E[b+13],4,681279174),Q=m(Q,j,B,Z,E[b+0],11,-358537222),Z=m(Z,Q,j,B,E[b+3],16,-722521979),B=m(B,Z,Q,j,E[b+6],23,76029189),j=m(j,B,Z,Q,E[b+9],4,-640364487),Q=m(Q,j,B,Z,E[b+12],11,-421815835),Z=m(Z,Q,j,B,E[b+15],16,530742520),B=m(B,Z,Q,j,E[b+2],23,-995338651),j=g(j,B,Z,Q,E[b+0],6,-198630844),Q=g(Q,j,B,Z,E[b+7],10,1126891415),Z=g(Z,Q,j,B,E[b+14],15,-1416354905),B=g(B,Z,Q,j,E[b+5],21,-57434055),j=g(j,B,Z,Q,E[b+12],6,1700485571),Q=g(Q,j,B,Z,E[b+3],10,-1894986606),Z=g(Z,Q,j,B,E[b+10],15,-1051523),B=g(B,Z,Q,j,E[b+1],21,-2054922799),j=g(j,B,Z,Q,E[b+8],6,1873313359),Q=g(Q,j,B,Z,E[b+15],10,-30611744),Z=g(Z,Q,j,B,E[b+6],15,-1560198380),B=g(B,Z,Q,j,E[b+13],21,1309151649),j=g(j,B,Z,Q,E[b+4],6,-145523070),Q=g(Q,j,B,Z,E[b+11],10,-1120210379),Z=g(Z,Q,j,B,E[b+2],15,718787259),B=g(B,Z,Q,j,E[b+9],21,-343485551),j=a(j,I),B=a(B,A),Z=a(Z,k),Q=a(Q,G);return s(j)+s(B)+s(Z)+s(Q)}let Mme=1,bW=console,eo=class{static setLogger(t){bW=t}constructor(t,r){Zt(this,"id",void 0),Zt(this,"lockingPromise",gt.resolve()),Zt(this,"locks",0),Zt(this,"name",""),Zt(this,"lockId",void 0),this.lockId=Mme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");bW.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new gt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function Wv(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var g=arguments.length,E=new Array(g),b=0;b<g;b++)E[b]=arguments[b];return await d.apply(this,E)}finally{m()}},c}}const Vi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function WL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Bd(t,r,s,a){const c=Object.assign({},Vi,a);let d=c.timeout;const h=async()=>{await function(E){return new gt(b=>{window.setTimeout(b,E)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const g=new gt(async(E,b)=>{r=r||(()=>!1),s=s||(()=>!0);for(let I=0;I<c.maxRetryCount;I+=1){if(m)return b(new Le(ee.OPERATION_ABORTED));try{const A=await t();if(!r(A,I)||I+1===c.maxRetryCount)return E(A);await h()}catch(A){if(!s(A,I)||I+1===c.maxRetryCount)return b(A);await h()}}});return g.cancel=()=>m=!0,g}let yP,wW=class{constructor(t){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ka(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},EP=0,GL=0;function HL(t,r,s,a){return new gt((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),EP+=qh(r.data)):s&&(r.data.size?EP+=r.data.size:r.data instanceof FormData?EP+=gW(r.data):EP+=qh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ia.request(r).then(h=>{typeof h.data=="string"?GL+=qh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?GL+=h.data.byteLength:GL+=qh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Ia.isCancel(h)?d(new Le(ee.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(ee.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(ee.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(ee.NETWORK_ERROR,h.message))})})}async function Ume(t,r){const s=new Blob([r.data],{type:"buffer"});return await HL(t,Ze(Ze({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const TW=()=>window.isSecureContext!==void 0;function Lu(t){if(Array.isArray(t))return t.map(s=>s);if(!CW(t))return t;const r={};for(const s in t){const a=t[s];CW(a)||Array.isArray(a)?r[s]=Lu(a):r[s]=a}return r}function CW(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let $L=class{constructor(t){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Yh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Qw={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Yh,remoteCandidate:Yh},updateInterval:0},RW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},IW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},AW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},PW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let KL=class{constructor(t,r){Zt(this,"onFirstVideoReceived",void 0),Zt(this,"onFirstVideoDecoded",void 0),Zt(this,"onFirstAudioReceived",void 0),Zt(this,"onFirstVideoDecodedTimeout",void 0),Zt(this,"onFirstAudioDecoded",void 0),Zt(this,"onSelectedLocalCandidateChanged",void 0),Zt(this,"onSelectedRemoteCandidateChanged",void 0),Zt(this,"videoIsReady",!1),Zt(this,"videoIsReady2",{}),Zt(this,"pc",void 0),Zt(this,"options",void 0),Zt(this,"intervalTimer",void 0),Zt(this,"stats",Lu(Qw)),Zt(this,"isFirstVideoReceived",{}),Zt(this,"isFirstVideoDecoded",{}),Zt(this,"isFirstAudioReceived",{}),Zt(this,"isFirstAudioDecoded",{}),Zt(this,"isFirstVideoDecodedTimeout",{}),Zt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new gt(t=>{t({local:Ze({},Yh),remote:Ze({},Yh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const b=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,I=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(a+=b,d+=I):(c+=b,h+=I),Number.isNaN(b)||Number.isNaN(b)?g.packetLostRate=0:g.packetLostRate=b<=0||I<=0?0:I/(b+I)});t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Vme=class extends KL{constructor(){super(...arguments),Zt(this,"_stats",Qw),Zt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Lu(Qw);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=tt(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=Lu(IW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Lu(RW),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:Ze({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Lu(PW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Lu(AW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new gt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},Zw=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),vP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),qL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Zc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Gv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Gv||{});function eT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Gv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const g=Number(t[a]);if(typeof g!="number")return;const E=h-g;return E?(d-m)/E*c:void 0}let kW=class extends KL{constructor(){super(...arguments),Zt(this,"_stats",Qw),Zt(this,"report",void 0),Zt(this,"lastDecodeVideoReceiverStats",new Map),Zt(this,"lastVideoFramesRecv",new Map),Zt(this,"lastVideoFramesSent",new Map),Zt(this,"lastVideoFramesDecode",new Map),Zt(this,"lastVideoFramesOutput",new Map),Zt(this,"lastVideoJBDelay",new Map),Zt(this,"lastAudioJBDelay",new Map),Zt(this,"mediaBytesSent",new Map),Zt(this,"mediaBytesRetransmit",new Map),Zt(this,"mediaBytesTargetEncode",new Map),Zt(this,"lastDecodeAudioReceiverStats",new Map),Zt(this,"lastAudioConcealment",new Map),Zt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Lu(Qw),this.report.forEach(t=>{switch(t.type){case Zc.OUTBOUND:case Zc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===Zc.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===Zc.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case Zc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Zc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:Ze({},Yh),remote:Ze({},Yh)};return t.forEach(s=>{let a;if(s.type===Zc.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===Zc.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Zc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Zc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Zc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Ze({},r),Ze({},this.stats.selectedCandidatePair.localCandidate)),t.type===Zc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Ze({},r),Ze({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=Lu(PW),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=eT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Gv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,s,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,Ze({},r))}calculateAudioFreeze(t,r,s){const a=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&a!=null){const c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=a.nonSilent+m,E=t.totalSamplesReceived-r.totalSamplesReceived;if(E<=0)return;const b=80*E/h,I=200*E/h,A=h/E;let k=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>b&&(a.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*A)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*A)),k=a.plc80+1);let G=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>I&&(a.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*A)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*A)),G=a.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:d,plc80:k,plc200:G})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Lu(RW),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=eT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=eT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=eT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Gv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=eT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:Ze({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=Lu(IW),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new $L(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new $L(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new $L(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,Zc.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=Lu(AW),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Zc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Cc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof g!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,b=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,I=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof E=="number"&&typeof b=="number"||(E=0,b=0),I==null){const A=Date.now(),k=this.lastVideoFramesSent.get(s.ssrc);k&&A-k.lts>=800?(I=Math.round((g-k.count)/((A-k.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:I})):k?I=k.rate:this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:0})}s.sentFrame={width:E,height:b,frameRate:Math.max(0,I)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const g=r?this.report.get(r):void 0,E=(a=g==null?void 0:g.framesReceived)!==null&&a!==void 0?a:t.framesReceived,b=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,I=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:t.frameHeight,A=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,k=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=E;let B=0;G&&j-G.lts>=800?(B=Math.round((E-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:B})):G?B=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:0}),s.receivedFrame={width:b||0,height:I||0,frameRate:B||0},s.decodedFrame={width:b||0,height:I||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:b||0,height:I||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(A&&k){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const B=k-G.jitterBufferEmittedCount;B>0&&(j=1e3*(A-G.jitterBufferDelay)/B),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:k,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,E=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=g,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,g,E,b,I;const A=r?this.report.get(r):void 0,k=(a=A==null?void 0:A.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,G=(c=A==null?void 0:A.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,j=(d=A==null?void 0:A.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,B=(h=A==null?void 0:A.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,Z=(m=A==null?void 0:A.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,Q=(g=A==null?void 0:A.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,ae=(E=A==null?void 0:A.concealedSamples)!==null&&E!==void 0?E:t.concealedSamples,ye=(b=A==null?void 0:A.silentConcealedSamples)!==null&&b!==void 0?b:t.silentConcealedSamples,_e=(I=A==null?void 0:A.concealmentEvents)!==null&&I!==void 0?I:t.concealmentEvents;if(typeof G=="number"&&(s.totalSamplesReceived=G),typeof ye=="number"&&(s.silentConcealedSamples=ye),typeof _e=="number"&&(s.concealmentEvents=_e),typeof ae=="number"&&(s.concealedSamples=ae),k&&G&&(s.accelerateRate=k/G),j&&B){const Ie=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ue=Ie.jitterBufferMs;const We=B-Ie.jitterBufferEmittedCount;We>0&&(Ue=1e3*(j-Ie.jitterBufferDelay)/We),s.jitterBufferMs=Math.round(Ue),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:j,jitterBufferEmittedCount:B,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=Z;let ue=1920;Q&&G&&(ue=G/Q/50,s.receivedFrames=Math.round(G/ue)),ae&&(s.droppedFrames=Math.round(ae/ue))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},Fme=class extends KL{updateStats(){return gt.resolve()}};function YL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Vme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new kW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof gt||function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"}(m))}(t)?new kW(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new Fme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const OW="websdk_ng_install_id";function XL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(OW);return t||(t=ty(),window.localStorage.setItem(OW,t)),hr("INSTALL_ID",t),t}catch{return}}const zl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.24.0"),JL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ny=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Bs=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Bs;const SP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},QL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ZL="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",e2={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},jr=Ze(Ze(Ze(Ze({},e2),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:QL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},SP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function hr(t,r,s){var a,c,d;tt(a=Object.keys(jr)).call(a,t)&&(!s&&tt(c=Object.keys(zd)).call(c,t)||(jr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(jr.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,jr.USE_NEW_NETWORK_CONFIG=d,d&&(jr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],jr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],jr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],jr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],jr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",jr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",jr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(jr.ENABLE_INSTANT_VIDEO=!0,jr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(jr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(jr.NEW_TURN_MODE||(jr.NEW_TURN_MODE=4))))}function oe(t){return jr[t]}JL||(jr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],jr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],jr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],jr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],jr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],jr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],jr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",jr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",jr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",jr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",jr.AREAS=["NORTH_AMERICA","OVERSEA"]);let NW=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const zd={};var tn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(tn||{});let tT=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const xW=128,jme=96,DW=1e3,Hv=10;let Bme=0;var LW=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>We,Printer:()=>nr,parse:()=>rt,print:()=>St});const h=`
`,m="".concat("\r").concat(h),g=" ";let E;function b(He){return He>="0"&&He<="9"}function I(He){return He>="!"&&He<="~"}function A(He){return I(He)||He>=""&&He<=""}function k(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function j(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function B(He){return He==="d"||He==="h"||He==="m"||He==="s"}function Z(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function Q(He){return j(He)||b(He)||He==="+"||He==="/"}function ae(He){return b(He)||j(He)||He==="+"||He==="/"||He==="-"||He==="_"}function ye(He){return j(He)||b(He)||He==="+"||He==="/"}function _e(He,U){var le=Object.keys(He);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(He);U&&(me=me.filter(function(et){return Object.getOwnPropertyDescriptor(He,et).enumerable})),le.push.apply(le,me)}return le}function ue(He){for(var U=1;U<arguments.length;U++){var le=arguments[U]!=null?arguments[U]:{};U%2?_e(Object(le),!0).forEach(function(me){Ie(He,me,le[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(le)):_e(Object(le)).forEach(function(me){Object.defineProperty(He,me,Object.getOwnPropertyDescriptor(le,me))})}return He}function Ie(He,U,le){return U in He?Object.defineProperty(He,U,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[U]=le,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ue{consumeText(U,le){let me=le;for(;me<U.length;){const et=U[me];if(et==="\0"||et==="\r"||et===h)break;me+=1}if(me-le==0)throw new Error("Invalid text, at ".concat(U));return me}consumeUnicastAddress(U,le,me){return this.consumeTill(U,le,g)}consumeOneOrMore(U,le,me){let et=le;for(;me(U[et]);)et++;if(et-le==0)throw new Error("Invalid rule at ".concat(le,"."));return et}consumeSpace(U,le){if(U[le]===g)return le+1;throw new Error("Invalid space at ".concat(le,"."))}consumeIP4Address(U,le){let me=le;for(let et=0;et<4;et++)if(me=this.consumeDecimalUChar(U,me),et!==3){if(U[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(U,le){let me=le;for(let an=0;an<3&&b(U[me]);an++,me++);if(me-le==0)throw new Error("Invalid decimal uchar.");const et=parseInt(U.slice(le,me));if(et>=0&&et<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,le){let me=this.consumeHexpart(U,le);return U[me]===":"&&(me+=1,me=this.consumeIP4Address(U,me)),me}consumeHexpart(U,le){let me=le;if(U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}if(me=this.consumeHexseq(U,me),U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}return me}consumeHexseq(U,le){let me=le;for(;me=this.consumeHex4(U,me),U[me]===":"&&U[me+1]!==":";)me+=1;return me}consumeHex4(U,le){let me=0;for(;me<4;me++)if(!((et=U[le+me])>="0"&&et<="9"||et>="a"&&et<="f"||et>="A"&&et<="F")){if(me===0)throw new Error("Invalid hex 4");break}var et;return le+me}consumeFQDN(U,le){let me=le;for(;b(U[me])||j(U[me])||U[me]==="-"||U[me]===".";)me+=1;if(me-le<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(U,le){return this.consumeOneOrMore(U,le,A)}consumeMulticastAddress(U,le,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,le);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,le);default:try{return this.consumeFQDN(U,le)}catch{return this.consumeExtnAddr(U,le)}}}consumeIP6MulticastAddress(U,le){const me=this.consumeHexpart(U,le);return U[me]==="/"?this.consumeInteger(U,me+1):me}consumeIP4MulticastAddress(U,le){let me=le+3;const et=U.slice(le,me),an=parseInt(et);if(an<224||an>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Cr=0;Cr<3;Cr++){if(U[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(U,me)}return U[me]==="/"&&(me+=1),me=this.consumeTTL(U,me),U[me]==="/"&&(me=this.consumeInteger(U,me)),me}consumeInteger(U,le){if(!G(U[le]))throw new Error("Invalid integer.");for(le+=1;b(U[le]);)le+=1;return le}consumeTTL(U,le){if(U[le]==="0")return le+1;if(!G(U[le]))throw new Error("Invalid TTL.");le+=1;for(let me=0;me<2&&b(U[le]);me++)le+=1;return le}consumeToken(U,le){return this.consumeOneOrMore(U,le,k)}consumeTime(U,le){let me=le;if(U[me]==="0")return me+1;for(G(U[me])&&(me+=1);b(U[me]);)me++;if(me-le<10)throw new Error("Invalid time");return me}consumeAddress(U,le){return this.consumeTill(U,le,g)}consumeTypedTime(U,le){let me=le;return me=this.consumeOneOrMore(U,me,b),B(U[me])?me+1:me}consumeRepeatInterval(U,le){if(!G(U[le]))throw new Error("Invalid repeat interval");for(le+=1;b(U[le]);)le+=1;return B(U[le])&&(le+=1),le}consumePort(U,le){return this.consumeOneOrMore(U,le,b)}consume(U,le,me){for(let et=0;et<me.length;et++){if(le+et>=U.length)throw new Error("consume exceeding value length");if(U[le+et]!==me[et])throw new Error("consume ".concat(me," failed at ").concat(et))}return le+me.length}consumeTill(U,le,me){let et=le;for(;et<U.length&&(typeof me!="string"||U[et]!==me)&&(typeof me!="function"||!me(U[et]));)et++;return et}}class We extends Ue{constructor(){super(),Ie(this,"records",[]),Ie(this,"currentLine",0)}parse(U){const le=this.probeEOL(U);this.records=U.split(le).filter(bf=>!!Do(bf).call(bf)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),et=this.parseOrigin(),an=this.parseSessionName(),Cr=this.parseInformation(),Hi=this.parseUri(),Jl=this.parseEmail(),Ku=this.parsePhone(),FT=this.parseConnection(),by=this.parseBandWidth(),wS=this.parseTimeFields(),L1=this.parseKey(),M1=this.parseSessionAttribute(),Ql=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:et,sessionName:an,information:Cr,uri:Hi,emails:Jl,phones:Ku,connection:FT,bandwidths:by,timeFields:wS,key:L1,attributes:M1,mediaDescriptions:Ql}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let le=0;le<U.length;le++)if(U[le]===h)return U[le-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(U,le){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:U.slice(2),line:le,cur:0}}parseSessionAttribute(){const U=new fn;for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(le,et=>k(et)&&et!==":"),_cur:0};le.value[le.cur]===":"&&(le.cur+=1,me.attValue=this.extractOneOrMore(le,Z)),U.parse(me),this.currentLine++}return U.digest()}parseMediaAttributes(U){const le=new vn(U);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==E.ATTRIBUTE)break;const et={attField:this.extractOneOrMore(me,an=>k(an)&&an!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,et.attValue=this.extractOneOrMore(me,Z)),le.parse(et),this.currentLine++}return le.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===E.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===E.ZONE_ADJUSTMENTS){const le=[];for(;;)try{const me=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let et=!1;U.value[U.cur]==="-"&&(et=!0,U.cur+=1);const an=this.extract(U,this.consumeTypedTime);le.push({time:me,typedTime:an,back:et})}catch{break}if(le.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,le}return[]}parseRepeat(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.REPEAT)break;{const me=this.extract(le,this.consumeRepeatInterval),et=this.parseTypedTime(le);U.push({repeatInterval:me,typedTimes:et}),this.currentLine++}}return U}parseTypedTime(U){const le=[];for(;;)try{this.consumeSpaceForRecord(U),le.push(this.extract(U,this.consumeTypedTime))}catch{break}if(le.length===0)throw new Error("Invalid typed time.");return le}parseTime(){const U=this.getCurrentRecord(),le=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const me=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:le,stopTime:me}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const le=this.getCurrentRecord();if(le.type!==E.BANDWIDTH)break;{const me=this.extractOneOrMore(le,k);if(le.value[le.cur]!==":")throw new Error("Invalid bandwidth field.");le.cur++;const et=this.extractOneOrMore(le,b);U.push({bwtype:me,bandwidth:et}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==E.VERSION)throw new Error("first sdp record must be version");const le=U.value.slice(0,this.consumeOneOrMore(U.value,0,b));if(le.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,le}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const le=this.extractOneOrMore(U,A);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,b);this.consumeSpaceForRecord(U);const et=this.extractOneOrMore(U,b);this.consumeSpaceForRecord(U);const an=this.extractOneOrMore(U,k);this.consumeSpaceForRecord(U);const Cr=this.extractOneOrMore(U,k);this.consumeSpaceForRecord(U);const Hi=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:le,sessId:me,sessVersion:et,nettype:an,addrtype:Cr,unicastAddress:Hi}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===E.SESSION_NAME){const le=this.extract(U,this.consumeText);return this.currentLine++,le}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==E.INFORMATION)return;const le=this.extract(U,this.consumeText);return this.currentLine++,le}parseUri(){const U=this.getCurrentRecord();if(U.type===E.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.EMAIL)break;U.push(le.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const le=this.getCurrentRecord();if(le.type!==E.PHONE)break;U.push(le.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===E.CONNECTION){const le=this.extractOneOrMore(U,k);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,k);this.consumeSpaceForRecord(U);const et=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:le,addrtype:me,address:et}}}parseMedia(){const U=this.getCurrentRecord(),le=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let me=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,me+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const et=[];for(et.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,et.push(this.extract(U,this.consumeToken));if(et.length===0)throw new Error("Invalid proto");const an=this.parseFmt(U);return this.currentLine++,{mediaType:le,port:me,protos:et,fmts:an}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===E.TIME;){const le=this.parseTime(),me=this.parseRepeat(),et=this.parseZone();U.push({time:le,repeats:me,zones:et})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const le=this.parseMedia(),me=this.parseInformation(),et=this.parseConnections(),an=this.parseBandWidth(),Cr=this.parseKey(),Hi=this.parseMediaAttributes(le);U.push({media:le,information:me,connections:et,bandwidths:an,key:Cr,attributes:Hi})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const le=[];for(;;)try{this.consumeSpaceForRecord(U),le.push(this.extract(U,this.consumeToken))}catch{break}if(le.length===0)throw new Error("Invalid fmts");return le}extract(U,le){for(var me=arguments.length,et=new Array(me>2?me-2:0),an=2;an<me;an++)et[an-2]=arguments[an];const Cr=le.call(this,U.value,U.cur,...et),Hi=U.value.slice(U.cur,Cr);return U.cur=Cr,Hi}extractOneOrMore(U,le){const me=this.consumeOneOrMore(U.value,U.cur,le),et=U.value.slice(U.cur,me);return U.cur=me,et}consumeSpaceForRecord(U){if(U.value[U.cur]!==g)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class Qe extends Ue{constructor(){super(...arguments),Ie(this,"attributes",void 0),Ie(this,"digested",!1)}extractOneOrMore(U,le,me){const et=this.consumeOneOrMore(U.attValue,U._cur,le),an=U.attValue.slice(U._cur,et),[Cr,Hi]=me||[];if(typeof Cr=="number"&&an.length<Cr)throw new Error("error in length, should be more or equal than ".concat(Cr," characters."));if(typeof Hi=="number"&&an.length>Hi)throw new Error("error in length, should be less or equal than ".concat(Hi," characters."));return U._cur=et,an}consumeAttributeSpace(U){if(U.attValue[U._cur]!==g)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,le){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,et=new Array(me>2?me-2:0),an=2;an<me;an++)et[an-2]=arguments[an];const Cr=le.call(this,U.attValue,U._cur,...et),Hi=U.attValue.slice(U._cur,Cr);return U._cur=Cr,Hi}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,le){if(!U.attValue)throw new Error;for(let me=0;me<le.length;me++)if(le[me]!==U.attValue[U._cur+me])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,Q,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,Q,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const le=[];for(;!this.atEnd(U);){le.push(this.extractOneOrMore(U,Q));try{this.consumeAttributeSpace(U)}catch(me){if(this.atEnd(U))break;throw me}}this.attributes.iceOptions=le}parseFingerprint(U){const le=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:le,fingerprint:me})}parseExtmap(U){const le=this.extractOneOrMore(U,b);let me;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),me=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeTill,g),an=ue(ue({entry:parseInt(le,10)},me&&{direction:me}),{},{extensionName:et});this.peekChar(U)===g&&(this.consumeAttributeSpace(U),an.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(an)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const le=this.extract(U,this.consumeTill);if(le!=="active"&&le!=="passive"&&le!=="actpass"&&le!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=le}}class fn extends Qe{constructor(){super(...arguments),Ie(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(le){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),le}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const le=this.extract(U,this.consumeToken),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===g;)this.consumeAttributeSpace(U),me.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:le,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,ae)}parseIdentity(U){const le=this.extractOneOrMore(U,ye),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===g;){this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const an=this.extractOneOrMore(U,Cr=>Cr!==g&&Z(Cr));me.push({name:et,value:an})}this.attributes.identities.push({assertionValue:le,extensions:me})}parseMsidSemantic(U){this.peekChar(U)===g&&this.consumeAttributeSpace(U);const le={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),le.applyForAll=!0;break}{const me=this.extract(U,this.consumeTill,g);le.identifierList.push(me)}}this.attributes.msidSemantic=le}}class vn extends Qe{constructor(U){super(),Ie(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(le){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),le}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const le=this.extractOneOrMore(U,Q,[1,32]);this.consumeAttributeSpace(U);const me=this.extractOneOrMore(U,b,[1,5]);this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const an=this.extractOneOrMore(U,b,[1,10]);this.consumeAttributeSpace(U);const Cr=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Hi=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const Jl={foundation:le,componentId:me,transport:et,priority:an,connectionAddress:Cr,port:Hi,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),Jl.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),Jl.relPort=this.extract(U,this.consumePort));this.peekChar(U)===g;){this.consumeAttributeSpace(U);const Ku=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),Jl.extension[Ku]=this.extractOneOrMore(U,I)}this.attributes.candidates.push(Jl)}parseRemoteCandidate(U){const le=[];for(;;){const me=this.extractOneOrMore(U,b,[1,5]);this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const an=this.extract(U,this.consumePort);le.push({componentId:me,connectionAddress:et,port:an});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(le)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const le=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const et={encodingName:me,clockRate:this.extractOneOrMore(U,b)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),et.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const an=this.attributes.payloads.find(Cr=>Cr.payloadType===parseInt(le,10));an?an.rtpMap=et:this.attributes.payloads.push({payloadType:parseInt(le,10),rtpMap:et,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const le=this.extractOneOrMore(U,b);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,":");let et;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),et=this.extract(U,this.consumeTill));const an=this.attributes.ssrcs.find(Cr=>Cr.ssrcId===parseInt(le,10));an?an.attributes[me]=et:this.attributes.ssrcs.push({ssrcId:parseInt(le,10),attributes:{[me]:et}})}parseFmtp(U){const le=this.extract(U,this.consumeTill,g);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill),et={};me.split(";").forEach(Cr=>{let[Hi,Jl]=Cr.split("=");Hi=Do(Hi).call(Hi);const Ku=typeof Jl=="string"?Do(Jl).call(Jl):null;typeof Hi=="string"&&Hi.length>0&&(et[Hi]=Ku)});const an=this.attributes.payloads.find(Cr=>Cr.payloadType===parseInt(le,10));an?an.fmtp={parameters:et}:this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[],fmtp:{parameters:et}})}parseFmtParameters(U){const le={},me=this.extract(U,this.consumeTill,"=");U._cur++;const et=this.extract(U,this.consumeTill,";");for(le[me]=et;U.attValue[U._cur]===";";){const an=this.extract(U,this.consumeTill,"=");U._cur++;const Cr=this.extract(U,this.consumeTill,";");le[an]=Cr}return le}parseRtcpFb(U){let le="";le=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,g),this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,g);let et;if(me==="trr-int")et={type:me,interval:this.extract(U,this.consumeTill)};else{const an={type:me};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),an.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===g&&(an.additional=this.extract(U,this.consumeTill))),et=an}if(le==="*")this.attributes.rtcpFeedbackWildcards.push(et);else{const an=this.attributes.payloads.find(Cr=>Cr.payloadType===parseInt(le,10));an?an.rtcpFeedbacks.push(et):this.attributes.payloads.push({payloadType:parseInt(le,10),rtcpFeedbacks:[et]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const le={port:this.extract(U,this.consumePort)};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),le.netType=this.extractOneOrMore(U,k),this.consumeAttributeSpace(U),le.addressType=this.extractOneOrMore(U,k),this.consumeAttributeSpace(U),le.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=le}parseMsid(U){const le={id:this.extractOneOrMore(U,k,[1,64])};this.peekChar(U)===g&&(this.consumeAttributeSpace(U),le.appdata=this.extractOneOrMore(U,k,[1,64])),this.attributes.msids.push(le)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const le=this.extractOneOrMore(U,et=>j(et)||b(et)||et==="_"||et==="-");this.consumeAttributeSpace(U);const me={id:le,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===g){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const et=[];for(;;){const an=this.extract(U,this.consumeToken);et.push(an);try{this.extract(U,this.consume,",")}catch{break}}me.payloads=et,this.peekChar(U)===g&&this.extract(U,this.consume,g)}for(;;){const et=this.extract(U,this.consumeToken);switch(et){case"depend":{const an={type:et,rids:this.extract(U,this.consume,"=").split(",")};me.params.push(an);break}default:{const an={type:et};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),an.val=this.extract(U,this.consumeTill,";")),me.params.push(an)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,b,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,b,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const le=this.extract(U,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(U);const et=this.extract(U,this.consumeInteger);me.push(parseInt(et,10))}catch{break}this.attributes.ssrcGroups.push({semantic:le,ssrcIds:me})}}function Jt(He,U,le){return U in He?Object.defineProperty(He,U,{value:le,enumerable:!0,configurable:!0,writable:!0}):He[U]=le,He}class nr{constructor(){Jt(this,"eol",m)}print(U,le){let me="";return le&&(this.eol=le),me+=this.printVersion(U.version),me+=this.printOrigin(U.origin),me+=this.printSessionName(U.sessionName),me+=this.printInformation(U.information),me+=this.printUri(U.uri),me+=this.printEmail(U.emails),me+=this.printPhone(U.phones),me+=this.printConnection(U.connection),me+=this.printBandwidth(U.bandwidths),me+=this.printTimeFields(U.timeFields),me+=this.printKey(U.key),me+=this.printSessionAttributes(U.attributes),me+=this.printMediaDescription(U.mediaDescriptions),me}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let le="";for(const me of U)le+="e=".concat(me).concat(this.eol);return le}printPhone(U){let le="";for(const me of U)le+="e=".concat(me).concat(this.eol);return le}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let le="";for(const me of U)le+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return le}printTimeFields(U){let le="";for(const me of U){le+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const et of me.repeats)le+="r=".concat(et.repeatInterval," ").concat(et.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(le+="z=",le+="z=".concat(me.zoneAdjustments.map(et=>"".concat(et.time," ").concat(et.back?"-":""," ").concat(et.typedTime)).join(" ")).concat(this.eol),le+=this.eol)}return le}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let le="";for(const me of U)le+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return le}printMediaDescription(U){let le="";for(const me of U)le+=this.printMedia(me.media),le+=this.printInformation(me.information),le+=this.printConnections(me.connections),le+=this.printBandwidth(me.bandwidths),le+=this.printKey(me.key),le+=this.printMediaAttributes(me);return le}printConnections(U){let le="";for(const me of U)le+=this.printConnection(me);return le}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new so(this.eol).print(U)}printMediaAttributes(U){return new ze(this.eol).print(U)}}class qn{constructor(U){Jt(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(g)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(le=>"a=fingerprint:".concat(le.hashFunction).concat(g).concat(le.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(le=>"a=extmap:".concat(le.entry).concat(le.direction?"/".concat(le.direction):"").concat(g).concat(le.extensionName).concat(le.extensionAttributes?"".concat(g).concat(le.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(le=>"a=".concat(le.attField).concat(le.attValue?":".concat(le.attValue):"").concat(this.eol)).join("")}}class so extends qn{print(U){let le="";return le+=this.printGroups(U.groups),le+=this.printMsidSemantic(U.msidSemantic),le+=this.printIceLite(U.iceLite),le+=this.printIceUfrag(U.iceUfrag),le+=this.printIcePwd(U.icePwd),le+=this.printIceOptions(U.iceOptions),le+=this.printFingerprints(U.fingerprints),le+=this.printSetup(U.setup),le+=this.printTlsId(U.tlsId),le+=this.printIdentity(U.identities),le+=this.printExtmap(U.extmaps),le+=this.printUnrecognized(U.unrecognized),le}printGroups(U){let le="";return U.length>0&&(le+=U.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(et=>"".concat(g).concat(et)).join("")).concat(this.eol)).join("")),le}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(le=>"a=identity:".concat(le.assertionValue).concat(le.extensions.map(me=>"".concat(g).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let le="a=msid-semantic:".concat(U.semantic);return U.applyForAll?le+="".concat(g,"*"):U.identifierList.length>0&&(le+=U.identifierList.map(me=>"".concat(g).concat(me))),le+this.eol}}class ze extends qn{print(U){const le=U.attributes;let me="";return me+=this.printRTCP(le.rtcp),me+=this.printIceUfrag(le.iceUfrag),me+=this.printIcePwd(le.icePwd),me+=this.printIceOptions(le.iceOptions),me+=this.printCandidates(le.candidates),me+=this.printRemoteCandidatesList(le.remoteCandidatesList),me+=this.printEndOfCandidates(le.endOfCandidates),me+=this.printFingerprints(le.fingerprints),me+=this.printSetup(le.setup),me+=this.printMid(le.mid),me+=this.printExtmap(le.extmaps),me+=this.printRTPRelated(le),me+=this.printPtime(le.ptime),me+=this.printMaxPtime(le.maxPtime),me+=this.printDirection(le.direction),me+=this.printSSRCGroups(le.ssrcGroups),me+=this.printSSRC(le.ssrcs),me+=this.printRTCPMux(le.rtcpMux),me+=this.printRTCPMuxOnly(le.rtcpMuxOnly),me+=this.printRTCPRsize(le.rtcpRsize),me+=this.printMSId(le.msids),me+=this.printImageattr(le.imageattr),me+=this.printRid(le.rids),me+=this.printSimulcast(le.simulcast),me+=this.printSCTPPort(le.sctpPort),me+=this.printMaxMessageSize(le.maxMessageSize),me+=this.printUnrecognized(le.unrecognized),me}printCandidates(U){return U.map(le=>"a=candidate:".concat(le.foundation).concat(g).concat(le.componentId).concat(g).concat(le.transport).concat(g).concat(le.priority).concat(g).concat(le.connectionAddress).concat(g).concat(le.port).concat(g,"typ").concat(g).concat(le.type).concat(le.relAddr?"".concat(g,"raddr").concat(g).concat(le.relAddr):"").concat(le.relPort?"".concat(g,"rport").concat(g).concat(le.relPort):"").concat(Object.keys(le.extension).map(me=>"".concat(g).concat(me).concat(g).concat(le.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(le=>"a=remote-candidates:".concat(le.join(g)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const le=U.payloads;let me="";me+=U.rtcpFeedbackWildcards.map(et=>this.printRTCPFeedback("*",et)).join("");for(const et of le)me+=this.printRtpMap(et.payloadType,et.rtpMap),me+=this.printFmtp(et.payloadType,et.fmtp),me+=et.rtcpFeedbacks.map(an=>this.printRTCPFeedback(et.payloadType,an)).join("");return me}printFmtp(U,le){if(!le)return"";const me=Object.keys(le.parameters);return me.length===1&&le.parameters[me[0]]===null?"a=fmtp:".concat(U).concat(g).concat(me[0]).concat(this.eol):"a=fmtp:".concat(U).concat(g).concat(Object.keys(le.parameters).map(et=>"".concat(et,"=").concat(le.parameters[et])).join(";")).concat(this.eol)}printRtpMap(U,le){return le?"a=rtpmap:".concat(U).concat(g).concat(le.encodingName,"/").concat(le.clockRate).concat(le.encodingParameters?"/".concat(le.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,le){let me="a=rtcp-fb:".concat(U).concat(g),et=le;return et.type==="trr-int"?me+="ttr-int".concat(g).concat(et.interval):(me+="".concat(et.type),et.parameter&&(me+="".concat(g).concat(et.parameter),et.additional&&(me+="".concat(g).concat(et.additional)))),me+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(le=>Object.keys(le.attributes).map(me=>"a=ssrc:".concat(le.ssrcId.toString(10)).concat(g).concat(me).concat(le.attributes[me]?":".concat(le.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let le="a=rtcp:".concat(U.port);return U.netType&&(le+="".concat(g).concat(U.netType)),U.addressType&&(le+="".concat(g).concat(U.addressType)),U.address&&(le+="".concat(g).concat(U.address)),le+this.eol}printMSId(U){return U.map(le=>"a=msid:".concat(le.id).concat(le.appdata?"".concat(g).concat(le.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(le=>"a=imageattr:".concat(le).concat(this.eol)).join("")}printRid(U){return U.map(le=>{let me="a=rid:".concat(le.id).concat(g).concat(le.direction);return le.payloads&&(me+="".concat(g,"pt=").concat(le.payloads.join(","))),le.params.length>0&&(me+="".concat(g).concat(le.params.map(et=>et.type==="depend"?"depend=".concat(et.rids.join(",")):"".concat(et.type,"=").concat(et.val)).join(";"))),me+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(le=>"a=ssrc-group:".concat(le.semantic).concat(le.ssrcIds.map(me=>"".concat(g).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function rt(He){return new We().parse(He)}function St(He,U){return new nr().print(He,U)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Za(t){return LW.parse(t)}function Hm(t,r){return LW.print(t,r)}var zme=Ec("Array","keys"),Wme=yd,Gme=Hr,Hme=N,$me=zme,t2=Array.prototype,Kme={DOMTokenList:!0,NodeList:!0},qme=function(t){var r=t.keys;return t===t2||Hme(t2,t)&&r===t2.keys||Gme(Kme,Wme(t))?$me:r},ec=l(qme);function ni(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function MW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function un(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MW(Object(s),!0).forEach(function(a){ni(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const UW=new class extends Jr{constructor(){super(...arguments),ni(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Yme{constructor(r){ni(this,"logger",void 0),ni(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function n2(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function VW(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Wl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},bP=Date.now(),nT=t=>{for(const r in Wl)if(Object.prototype.hasOwnProperty.call(Wl,r)&&Wl[r]===t)return r;return"DEFAULT"},L=new class{constructor(){ni(this,"proxyServerURL",void 0),ni(this,"logLevel",Wl.DEBUG),ni(this,"uploadState","collecting"),ni(this,"uploadLogWaitingList",[]),ni(this,"uploadLogUploadingList",[]),ni(this,"uploadErrorCount",0),ni(this,"currentLogID",0),ni(this,"url",void 0),ni(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Wl.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Wl.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Wl.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Wl.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Wl.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){hr("UPLOAD_LOG",!0)}disableLogUpload(){hr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Yme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-bP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-bP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=n2()+" Agora-SDK [".concat(nT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=n2()+" %cAgora-SDK [".concat(nT(a),"]:");let d=[];if(!oe("USE_NEW_LOG"))switch(a){case Wl.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Wl.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Wl.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Wl.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-bP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-bP);const a=Math.max(0,Math.min(4,r[0]));r[0]=n2()+" Agora-SDK [".concat(nT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=VW()+" Agora-SDK [".concat(nT(t),"]:"):s[0]=VW()+" Agora-SDK [".concat(nT(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:zl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return Bd(async()=>{const s=await Ia.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),UW.reportLogUploadError(a),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var FW;function Xme(t){return Cs(t.reportId,"params.reportId",0,100,!1),Cs(t.category,"params.category",0,100,!1),Cs(t.event,"params.event",0,100,!1),Cs(t.label,"params.label",0,100,!1),gr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(FW={}).FREE="free",FW.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Jme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Qi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Br=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Qme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Gt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];let b=g;if(t.argsMap)try{b=t.argsMap(this,...g)}catch(A){L.warning(A),b=[]}try{JSON.stringify(b)}catch{L.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),b=[]}const I=(t.report||Pt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:b,tag:$r.TRACER,reportResult:t.reportResult},t.throttleTime);try{const A=c.apply(this,g);return A instanceof gt?A.then(k=>(I.onSuccess(t.reportResult&&k),k)).catch(k=>{throw I.onError(k),k}):(I.onSuccess(t.reportResult&&A),A)}catch(A){throw I.onError(A),A}}}return a}}const Pt=new class{constructor(){ni(this,"baseInfoMap",new Map),ni(this,"proxyServer",void 0),ni(this,"eventUploadTimer",void 0),ni(this,"setSessionIdTimer",void 0),ni(this,"url",void 0),ni(this,"sids",new Set),ni(this,"backupUrl",void 0),ni(this,"_appId",void 0),ni(this,"_aid",0),ni(this,"keyEventUploadPendingItems",[]),ni(this,"normalEventUploadPendingItems",[]),ni(this,"apiInvokeUploadPendingItems",[]),ni(this,"apiInvokeCount",0),ni(this,"apiInvokeLoggedCount",0),ni(this,"ltsList",[]),ni(this,"lastSendNormalEventTime",Date.now()),ni(this,"customReportCounterTimer",void 0),ni(this,"customReportCount",0),ni(this,"extApiInvoke",async t=>{for(const r of t){const s=un(un({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:$r.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function E(k,G){if(m){let j="[apiInvoke-".concat(g,"]");if(r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]"),r.name===di.JOIN))return L.info("".concat(j," ").concat(k));L.info("".concat(j," ").concat(k),k==="start"?r.options:G||"")}}const b=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});E("start");let I=!1;Rs(r.timeout).then(()=>{I||(this.sendApiInvoke(un(un({},b()),{},{error:ee.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const A=new Le(ee.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:k=>{const G=()=>{if(I)throw A;return I=!0,this.sendApiInvoke(un(un({},b()),{},{success:!0},r.reportResult&&{result:k})),E("onSuccess"),k};return s?yW(G,r.name+"Success",s,()=>I=!0):G()},onError:k=>{const G=()=>{if(I)throw k;I=!0,this.sendApiInvoke(un(un({},b()),{},{success:!1,error:k})),E("onFailure",k.toString())};return s?yW(G,r.name+"Error",s,()=>I=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:JL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientRole:b}=r,I=Date.now(),A=un(un({},a),{},{eventType:Qi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:ZL,lts:I,elapse:I-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:zl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientType:tt(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:b,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var k;this.send({type:Br.SESSION,data:A},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{role:r.role,eventType:Qi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:Br.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:Qi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Br.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:m}=r,g=c-s.startTime,E=un(un({},a),{},{eventType:Qi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:XL(),isABTestSuccess:r.isABTestSuccess?1:0}),b=E.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Br.JOIN_GATEWAY,data:E},!0);else{let I;if(h)if(m){const k=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),G=h.match(/p=[0-9]{1,6}/g);I={isSuccess:b,gatewayIp:k&&k.length?k[0].split("=")[1].replace(/-/g,"."):"",port:G&&G.length?G[0].split("=")[1]:"",isProxy:m?1:0}}else{const k=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),G=h.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:b,gatewayIp:k&&k.length?k[0].split("//")[1].replace(/-/g,"."):"",port:G&&G.length?G[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else I={isSuccess:b,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const A=Object.assign({},E,I,{eventType:Qi.REJOIN_GATEWAY});this.send({type:Br.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=un(un({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Br.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:Qi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Br.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=un(un({},c),{},{eventType:Qi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Br.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...ec(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=un(un({},d),{},{eventType:Qi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Br.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=r.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=un(un({},a),{},{elapse:c-s.startTime,eventType:Qi.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>d?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:Br.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Qi.AB_TEST,lts:c});this.send({type:Br.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Qi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Br.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Qi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Br.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:Qi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Br.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:Qi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Br.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:Qi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Br.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?L.debug("reportProxyServerurl: ".concat(t)):L.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Br.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const E=qh(JSON.stringify(d));let b=0;const I=[];let A=0;for(let k=0;k<g.length;k++)A+=g.charCodeAt(k)<=127?1:3,A<=m-E||(I[I.length]=Ze(Ze({},d),{},{[h]:g.substring(b,k)}),b=k,A=g.charCodeAt(k)<=127?1:3);return b!==g.length-1&&(I[I.length]=Ze(Ze({},d),{},{[h]:g.substring(b)})),I})(un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:Br.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Br.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Br.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Br.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(ee.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:Br.USER_ANALYTICS,data:un(un({sid:t},c),{},{lts:s})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw L.error("send custom report message failed",c.toString()),new Le(ee.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&tt(r)&&tt(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:g,message:E}=t.error;h=g||E||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Br.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),G_(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),L.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Ci.networkState===Ac.OFFLINE&&await gt.race([Ci.onlineWaiter,Rs(2*Vi.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=VL(JSON.stringify(h.data)),g=new ArrayBuffer(5),E=(I=>{let A=0;return Object.entries(Br).forEach(k=>{let[G,j]=k;j===I.type&&(A=Qme[G])}),A})(h),b=new DataView(g);b.setUint16(0,m.byteLength,!0),b.setUint8(2,255&E),b.setUint8(3,E>>>8&255),b.setUint8(4,E>>>16&255),d=lW(d,new Uint8Array(g)),d=lW(d,m)}),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await HL(a,{timeout:1e4,data:r(t),headers:un(un({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};Ci.networkState===Ac.OFFLINE&&await gt.race([Ci.onlineWaiter,Rs(2*Vi.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d)));try{r?await Ume(h,{timeout:1e4,data:c}):await HL(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Jme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:$r.TRACER}).onSuccess()}};UW.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Ci.networkState,Pt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:$r.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ni(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,L)}throw(){super.throw(L)}}const Is={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Fn(){return Is}function jW(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(df()||J8())&&!LL())}function wP(){return!Is.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&hf()}function r2(t){return!(ei()||Q8(87)||wP()||!oe("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))}function BW(t){return!!oe("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB"))}let As=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function $v(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function jn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Mu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function i2(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Zme={"90p":jn(160,90),"90p_1":jn(160,90),"120p":jn(160,120,15,30,65),"120p_1":jn(160,120,15,30,65),"120p_3":jn(120,120,15,30,50),"120p_4":jn(212,120),"180p":jn(320,180,15,30,140),"180p_1":jn(320,180,15,30,140),"180p_3":jn(180,180,15,30,100),"180p_4":jn(240,180,15,30,120),"240p":jn(320,240,15,40,200),"240p_1":jn(320,240,15,40,200),"240p_3":jn(240,240,15,40,140),"240p_4":jn(424,240,15,40,220),"360p":jn(640,360,15,80,400),"360p_1":jn(640,360,15,80,400),"360p_3":jn(360,360,15,80,260),"360p_4":jn(640,360,30,80,600),"360p_6":jn(360,360,30,80,400),"360p_7":jn(480,360,15,80,320),"360p_8":jn(480,360,30,80,490),"360p_9":jn(640,360,15,80,800),"360p_10":jn(640,360,24,80,800),"360p_11":jn(640,360,24,80,1e3),"480p":jn(640,480,15,100,500),"480p_1":jn(640,480,15,100,500),"480p_2":jn(640,480,30,100,1e3),"480p_3":jn(480,480,15,100,400),"480p_4":jn(640,480,30,100,750),"480p_6":jn(480,480,30,100,600),"480p_8":jn(848,480,15,100,610),"480p_9":jn(848,480,30,100,930),"480p_10":jn(640,480,10,100,400),"720p":jn(1280,720,15,120,1130),"720p_auto":jn(1280,720,30,900,3e3),"720p_1":jn(1280,720,15,120,1130),"720p_2":jn(1280,720,30,120,2e3),"720p_3":jn(1280,720,30,120,1710),"720p_5":jn(960,720,15,120,910),"720p_6":jn(960,720,30,120,1380),"1080p":jn(1920,1080,15,120,2080),"1080p_1":jn(1920,1080,15,120,2080),"1080p_2":jn(1920,1080,30,120,3e3),"1080p_3":jn(1920,1080,30,120,3150),"1080p_5":jn(1920,1080,60,120,4780),"1440p":jn(2560,1440,30,120,4850),"1440p_1":jn(2560,1440,30,120,4850),"1440p_2":jn(2560,1440,60,120,7350),"4k":jn(3840,2160,30,120,8910),"4k_1":jn(3840,2160,30,120,8910),"4k_3":jn(3840,2160,60,120,13500)},ege={"480p":Mu(640,480,5),"480p_1":Mu(640,480,5),"480p_2":Mu(640,480,30),"480p_3":Mu(640,480,15),"720p":Mu(1280,720,5),"720p_auto":jn(1280,720,30,900,3e3),"720p_1":Mu(1280,720,5),"720p_2":Mu(1280,720,30),"720p_3":Mu(1280,720,15),"1080p":Mu(1920,1080,5),"1080p_1":Mu(1920,1080,5),"1080p_2":Mu(1920,1080,30),"1080p_3":Mu(1920,1080,15)},tge={"1SL1TL":i2(1,1),"3SL3TL":i2(3,3),"2SL3TL":i2(2,3)};function Uu(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Zme[t]):t}function s2(t){return typeof t=="string"?Object.assign({},ege[t]):t}function TP(t){return typeof t=="string"?Object.assign({},tge[t]):t}const nge={speech_low_quality:$v(16e3,!1),speech_standard:$v(32e3,!1,18),music_standard:$v(48e3,!1),standard_stereo:$v(48e3,!0,56),high_quality:$v(48e3,!1,128),high_quality_stereo:$v(48e3,!0,192)};function CP(t){return typeof t=="string"?Object.assign({},nge[t]):t}const Kv=[];function zW(t){return Ji(t,"mediaSource",["screen","window","application"]),!0}let Ct=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),_r=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),qv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),rge=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),ige=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ry=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Yv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Gl=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t}({}),Xv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),el=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const o2={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},a2={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},WW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},sge={uplinkNetworkQuality:0,downlinkNetworkQuality:0},GW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let oa=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),tl=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),rT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),iy=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),to=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Xh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const c2={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let RP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Nn(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach(function(g){m[g]=a[g]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ka(d=h_(h=s.slice()).call(h)).call(d,function(g,E){return E(t,r,g)||g},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function Pe(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:c+""}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function HW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ir(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?HW(Object(s),!0).forEach(function(a){Pe(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):HW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class $W extends Jr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ry.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||Er(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){tt(Kv).call(Kv,a)||Kv.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Wm(()=>{var s;Pt.reportApiInvoke(null,{name:di.GET_MEDIA_STREAM_TRACK,options:[],tag:$r.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===qv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Kv.indexOf(r);s!==-1&&Kv.splice(s,1)}(this),this.emit(Yv.CLOSED),this.removeAllListeners(ry.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===qv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ry.TRANSCEIVER_UPDATED,r,s)}}class Jv extends $W{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new eo("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,L.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ct.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Ct.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}stateCheck(r,s){if(L.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),jd(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(ee.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",L);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(ee.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",L)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():gt.resolve([])}}const KW=window.AudioContext||window.webkitAudioContext;let nl=null;const pr=new class extends Jr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{L.info("ios15-interruption-start"),this.emit(As.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{L.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?L.info("ios15-interruption-end-canceled"):(nl&&await nl.suspend(),this.emit(As.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){L.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){L.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Qv(){if(!nl){if(function(){if(!KW)return void L.error("your browser is not support web audio");L.info("create audio context");const t=Ir({},oe("WEBAUDIO_INIT_OPTIONS"));L.debug("audio context init option:",JSON.stringify(t)),nl=new KW(t),pr.curState=nl.state,nl.onstatechange=()=>{pr.prevState=pr.curState,pr.curState=nl?nl.state:void 0;const{prevState:r,curState:s}=pr,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",g=xn().osVersion;(vo()||Du())&&d&&c&&(L.info("ios".concat(g,"-interruption-start")),pr.emit(As.IOS_INTERRUPTION_START)),(vo()||Du())&&(h||m)&&a&&(L.info("ios".concat(g,"-interruption-end")),pr.emit(As.IOS_INTERRUPTION_END)),r!==s&&pr.emit(As.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=nl)===null||r===void 0?void 0:r.currentTime;pr.currentTime!==s?(pr.currentTimeStuckAt&&(L.debug("AudioContext current time resume at ".concat(s)),pr.currentTimeStuckAt=void 0),pr.currentTime=s):(s!==pr.currentTimeStuckAt&&(Pt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:$r.TRACER}).onSuccess(),L.warning("AudioContext current time stuck at ".concat(s))),pr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(j){r.state==="running"?g(!1):vo()||Du()?r.state==="suspended"&&(g(!0),j&&r.resume().then(E,E)):r.state!=="closed"&&(g(!0),j&&r.resume().then(E,E))}function g(j){if(c!==j){c=j;for(let B=0,Z=s;B<Z.length;B+=1){const Q=Z[B];j?window.addEventListener(Q,b,{capture:!0,passive:!0}):window.removeEventListener(Q,b,{capture:!0,passive:!0})}}}function E(){m(!1)}function b(){m(!0)}function I(j){if(!h)if(a.paused)if(j){let B;A(!1),h=!0;try{B=a.play(),B?B.then(k,k):(a.addEventListener("playing",k),a.addEventListener("abort",k),a.addEventListener("error",k))}catch{k()}}else A(!0);else A(!1)}function A(j){if(d!==j){d=j;for(let B=0,Z=s;B<Z.length;B++){const Q=Z[B];j?window.addEventListener(Q,G,{capture:!0,passive:!0}):window.removeEventListener(Q,G,{capture:!0,passive:!0})}}}function k(){a.removeEventListener("playing",k),a.removeEventListener("abort",k),a.removeEventListener("error",k),h=!1,I(!1)}function G(){I(!0)}if(vo()){const j=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=B.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=j.stream,I(!0)}pr.on(As.STATE_CHANGE,function(){m(!0)}),m(!1)}(nl)}(),!nl)throw new Le(ee.NOT_SUPPORTED,"can not create audio context");return nl}return nl}function sy(t){if(function(){if(l2!==null)return l2;const a=Qv(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),l2=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),tt(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?mP(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let l2=null;function u2(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=Qv();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class qW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Qv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||vo()||Du()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Ka(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{L.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class YW extends Jr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Qv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),sy(this.outputNode),this.volumeLevelAnalyser=new qW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(el.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Fn().webAudioMediaStreamDest)throw new Le(ee.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&gP(()=>{pr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;vo()||Du()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await Rs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class XW extends YW{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(L.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void L.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>L.info("resume success")),L.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),sy(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),sy(this.outputNode),this.emit(el.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(ee.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),sy(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,L.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));sy(g),this.originVolumeLevelAnalyser=new qW,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=xn();s&&h.os===ss.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(pr.on(As.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),sy(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(el.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),pr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),L.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));sy(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function JW(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function oge(t,r){const s=await QW(t.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new gt((m,g)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const b=document.createElement("div");b.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const I=document.createElement("div");I.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",I.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Z);const Q=new Error("NotAllowedError");Q.name="NotAllowedError",g(Q)};let j=h;const B=document.createElement("div");if(h){const Q=document.createElement("input");Q.setAttribute("type","checkbox");const ae=document.createElement("span");Q.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",Q.checked=j,Q.onchange=()=>{j=Q.checked},B.appendChild(Q),B.appendChild(ae)}k.appendChild(B),k.appendChild(G),b.appendChild(I),b.appendChild(A),b.appendChild(k);const Z=document.createElement("div");Z.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Z.appendChild(E),Z.appendChild(b),document.body.appendChild(Z),d.map(Q=>{if(Q.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Q.thumbnail;try{const{width:_e}=ye.getSize();_e>1920&&(ye=ye.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Q.name.replace(/[\u00A0-\u9999<>\&]/g,function(_e){return"&#"+_e.charCodeAt(0)+";"})+"</span>",ae.onclick=()=>{document.body.removeChild(Z),m({sourceId:Q.id,audio:j})},A.appendChild(ae)}})})}(s,r);return await JW(a,t,c)}async function QW(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=uW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(ee.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new gt((d,h)=>{s.desktopCapturer.getSources({types:r},(m,g)=>{m?h(m):d(g)})}));try{return await a}catch(d){throw new Le(ee.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const d2=new eo("safari");let ZW=!1,eG=!1;async function rl(t,r){let s=0,a=null;for(;s<2;)try{a=await age(t,r,s>0);break}catch(c){if(c instanceof Le)throw L.error("[".concat(r,"] ").concat(c.toString())),c;const d=IP(c.name||c.code||c,c.message);if(d.code===ee.MEDIA_OPTION_INVALID){L.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await Rs(500);continue}throw L.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(ee.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function age(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(ee.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Fn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return L.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(uW())t.screen.sourceId?Zv(c,await JW(t.screen.sourceId,t.screen,!!t.screenAudio)):Zv(c,await oge(t.screen,!!t.screenAudio));else if(df()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(ee.NOT_SUPPORTED,"This browser does not support screen sharing");L.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const A=await(h=t.screen.extensionId,m=r,new gt((k,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return L.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new Le(ee.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(j.streamId)})}catch(j){L.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new Le(ee.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=A,Zv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&zW(t.screen.mediaSource);const A={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B}=t.screen,Z={selfBrowserSurface:k,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B};!k&&delete Z.selfBrowserSurface,!G&&delete Z.surfaceSwitching,!j&&delete Z.systemAudio,!B&&delete Z.preferCurrentTab,L.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:A,audio:t.screenAudio,controls:Z})),Zv(c,await navigator.mediaDevices.getDisplayMedia(Ir({video:A,audio:t.screenAudio},Z)))}else{if(!ei())throw L.error("[".concat(r,"] This browser does not support screenSharing")),new Le(ee.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&zW(t.screen.mediaSource);const A={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};L.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(A))),Zv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},E=oe("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),g=BL(g,E)}catch{}L.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),xn();let b,I=null;(Vs()||vo()||pP())&&(I=await d2.lock());try{b=await navigator.mediaDevices.getUserMedia(g)}catch(A){throw I&&I(),A}return g.audio&&(ZW=!0),g.video&&(eG=!0),Zv(c,b),I&&I(),c}function IP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(ee.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(ee.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(ee.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(ee.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(ee.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(ee.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return L.error("getUserMedia unexpected error",t),new Le(ee.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Zv(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const il=new class extends Jr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(iy.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",rT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(fP()||hP()===ss.HARMONY_OS)&&hf())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>L.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(ee.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,g=null,E=null;if(!s&&(d||h)){if(d2.isLocked&&(L.debug("[device manager] wait GUM lock"),(await d2.lock())(),L.debug("[device manager] GUM unlock")),ZW&&(d=!1,this.isAccessMicrophonePermission=!0),eG&&(h=!1,this.isAccessCameraPermission=!0),L.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(b){const I=IP(b.name||b.code||b,b.message);if(I.code===ee.PERMISSION_DENIED)throw I;L.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(b){const I=IP(b.name||b.code||b,b.message);if(I.code===ee.PERMISSION_DENIED)throw I;L.warning("getUserMedia failed in getDevices",I)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(b){const I=IP(b.name||b.code||b,b.message);if(I.code===ee.PERMISSION_DENIED)throw I;L.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0}L.debug("[device manager] mic permission",t,"cam permission",r)}try{const b=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(I=>I.stop()),g&&g.getTracks().forEach(I=>I.stop()),E&&E.getTracks().forEach(I=>I.stop()),m=null,g=null,E=null,b}catch(b){return m&&m.getTracks().forEach(I=>I.stop()),g&&g.getTracks().forEach(I=>I.stop()),E&&E.getTracks().forEach(I=>I.stop()),m=null,g=null,E=null,new Le(ee.ENUMERATE_DEVICES_FAILED,b.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(ee.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=rT.INITING;try{await this.updateDevicesInfo(),this.state=rT.INITEND}catch(t){throw L.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=rT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(ee.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?L.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):L.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):L.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==rT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(iy.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(iy.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(iy.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let h2=!1;const sl=new class extends Jr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function tG(){if(xn(),!h2){const t=r=>{r.preventDefault(),h2=!1,Kw()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};h2=!0,Kw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),L.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),sl.onAutoplayFailed?sl.onAutoplayFailed():sl.onAudioAutoplayFailed?L.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):L.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),sl.emit("autoplay-failed")}}function nG(t,r,s,a){if(!t)return;const c=Pt.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Ir(Ir({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:sl.onAutoplayFailed||sl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});Pt.send({type:Br.AUTOPLAY_FAILED,data:m},!0)}const cge=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Aa=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(L.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(pr.curState==="running")return Fv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(L.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),pr.on(As.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.on(As.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),pr.on(As.STATE_CHANGE,()=>{vo()&&pr.prevState==="suspended"&&pr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(ee.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,to.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{L.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){L.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&nG(a,"audio",m.message,r),L.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(L.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),gP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),tG()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){cge.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(L.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&L.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{L.debug("Auto resume audio element success")}).catch(s=>{L.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new gt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Kw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function oi(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(ee.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",L);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof gt?new gt((g,E)=>{m.then(g).catch(E)}):m}),s}}class rG extends Jr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(ee.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(ee.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(oa.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(oa.ON_TRACK,void 0)}}class iG extends Jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await js(this,tl.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return L.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),yr(this,tl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return L.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),yr(this,tl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){L.error(new Le(ee.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof gt&&(a=await a),r.push(Ir(Ir({},a),{},{direction:this.direction}))}catch(a){L.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class sG extends Jr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(ee.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(ee.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(oa.ON_TRACK,void 0),this.emit(oa.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(oa.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(oa.ON_NODE,this.inputNode))}}class oG extends Jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return js(this,tl.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return L.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),yr(this,tl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),yr(this,tl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Cc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){L.error(new Le(ee.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof gt&&(a=await a),r.push(Ir(Ir({},a),{},{direction:this.direction}))}catch(a){L.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class p2 extends Jr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new lge}setVolume(){}createOutputTrack(){throw new Le(ee.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class lge{disconnect(){}connect(){}}function aG(t){return new gt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=vo()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&ei()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(_P),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function AP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Uu(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!sW()&&s.frameRate&&(r.frameRate=s.frameRate),J8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),ei()&&(r.frameRate={ideal:30,max:30}),r}function cG(t){const r={};return sW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,df()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function lG(t){const r=cG(t);if(t.encoderConfig){const s=CP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),fP()&&(r.sampleRate=void 0),r}const uge=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=zv(h),m=zv(m),d=zv(d);const{max:g,min:E}=function(k,G,j){const B=200*Math.pow(j/15,.6)*Math.pow(k*G/640/360,.75);return{min:Math.floor(B),max:Math.floor(4*B)}}(h,m,d),{bitrateMax:b,bitrateMin:I}=r||{};b||L.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(b,", brMin: ").concat(I,"]"));const{maxFramerate:A}=oe("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(d=Math.min(d,A)),{frameRate:d,bitrateMax:b||g,bitrateMin:I||E,scaleResolutionDownBy:1,scale:0}},uG=async(t,r,s)=>await(async(a,c,d)=>{const h=function(E){const b=[];for(let I=0;I<E.length;I+=2)b.push(parseInt(E.slice(I,I+2),16));return Uint8Array.from(b)}(SW(""+c+d)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,a))})(t.buffer,r,s),f2=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new gt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await dG(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(ee.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},dG=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var hG,pG,fG,mG,gG,_G,yG,EG,vG,SG,bG,wG,TG,CG,RG,IG,AG,PG,Qr,kG,OG,NG,xG,DG,LG,Jh,MG,UG,VG,FG,jG,BG,zG,WG,GG,HG,$G,KG,qG,zs;let ai=(hG=Gt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),pG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),fG=oi(),mG=Wv("LocalAudioTrack","_enabledMutex"),gG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),_G=oi(),yG=Wv("LocalAudioTrack","_enabledMutex"),EG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),vG=oi(),SG=oi(),bG=oi(),wG=Gt({argsMap:t=>[t.getTrackId()]}),TG=oi(),CG=Gt({argsMap:t=>[t.getTrackId()]}),RG=oi(),IG=Gt({argsMap:t=>[t.getTrackId()]}),AG=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),PG=Gt({argsMap:t=>[t.getTrackId()]}),Nn((Qr=class extends Jv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Aa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Pe(this,"trackMediaType",Xv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new p2,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Vs()&&!nl?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){gr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Aa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void L.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,yr(this,Ct.NEED_REPLACE_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{L.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!jW())throw new Le(ee.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Aa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await yr(this,Ct.NEED_ENABLE_TRACK,this),L.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await yr(this,Ct.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await yr(this,Ct.NEED_MUTE_TRACK,this):await yr(this,Ct.NEED_UNMUTE_TRACK,this))}getStats(){return Wm(()=>{L.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Qc(this,Ct.GET_STATS)||Ir({},o2)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(el.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(el.ON_AUDIO_BUFFER),this._source.on(el.ON_AUDIO_BUFFER,s=>t(s))}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Aa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Aa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Aa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Ct.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return gt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(ee.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(oa.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await yr(this,Ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Ct.NEED_REPLACE_TRACK,this))}),t.on(oa.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(oa.ON_TRACK),t.removeAllListeners(oa.ON_NODE)}bindProcessorContextEvents(t){t.on(tl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(tl.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof p2&&(this._trackSource=new XW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new oG(this._source.context,this.getTrackId(),"local"),r=new sG(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(el.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Aa.stop(this.getTrackId()),this._source.play()),yr(this,Ct.NEED_REPLACE_MIXING_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{L.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[hG],Object.getOwnPropertyDescriptor(Qr.prototype,"setVolume"),Qr.prototype),Nn(Qr.prototype,"setPlaybackDevice",[pG,fG],Object.getOwnPropertyDescriptor(Qr.prototype,"setPlaybackDevice"),Qr.prototype),Nn(Qr.prototype,"setEnabled",[mG,gG,_G],Object.getOwnPropertyDescriptor(Qr.prototype,"setEnabled"),Qr.prototype),Nn(Qr.prototype,"setMuted",[yG,EG,vG],Object.getOwnPropertyDescriptor(Qr.prototype,"setMuted"),Qr.prototype),Nn(Qr.prototype,"getStats",[SG],Object.getOwnPropertyDescriptor(Qr.prototype,"getStats"),Qr.prototype),Nn(Qr.prototype,"setAudioFrameCallback",[bG],Object.getOwnPropertyDescriptor(Qr.prototype,"setAudioFrameCallback"),Qr.prototype),Nn(Qr.prototype,"play",[wG,TG],Object.getOwnPropertyDescriptor(Qr.prototype,"play"),Qr.prototype),Nn(Qr.prototype,"stop",[CG,RG],Object.getOwnPropertyDescriptor(Qr.prototype,"stop"),Qr.prototype),Nn(Qr.prototype,"close",[IG],Object.getOwnPropertyDescriptor(Qr.prototype,"close"),Qr.prototype),Nn(Qr.prototype,"pipe",[AG],Object.getOwnPropertyDescriptor(Qr.prototype,"pipe"),Qr.prototype),Nn(Qr.prototype,"unpipe",[PG],Object.getOwnPropertyDescriptor(Qr.prototype,"unpipe"),Qr.prototype),Qr),iT=(kG=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),OG=oi(),NG=Wv("MicrophoneAudioTrack","_enabledMutex"),xG=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),DG=oi(),LG=Gt({argsMap:t=>[t.getTrackId()]}),Nn((Jh=class extends ai{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?CP(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Fv()||DL())&&pr.bindInterruptDetectorTrack(this)}async setDevice(t){if(L.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await il.getDeviceById(t),s={};s.audio=Ir({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await rl(s,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await rl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await il.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}L.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return L.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(vo()||Du())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await yr(this,Ct.NEED_DISABLE_TRACK,this)}catch(h){throw L.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Ir({},this._constraints),d=il.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await rl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await yr(this,Ct.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}L.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Fv()||DL())&&pr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((vo()||Du())&&this._enabled&&!this._isClosed&&pr.duringInterruption){const t=async()=>{pr.off(As.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pr.on(As.IOS_INTERRUPTION_END,t)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=il.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await rl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(tl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(tl.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[kG,OG],Object.getOwnPropertyDescriptor(Jh.prototype,"setDevice"),Jh.prototype),Nn(Jh.prototype,"setEnabled",[NG,xG,DG],Object.getOwnPropertyDescriptor(Jh.prototype,"setEnabled"),Jh.prototype),Nn(Jh.prototype,"close",[LG],Object.getOwnPropertyDescriptor(Jh.prototype,"close"),Jh.prototype),Jh),dge=(MG=Gt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),UG=oi(),VG=Gt({argsMap:t=>[t.getTrackId()]}),FG=oi(),jG=Gt({argsMap:t=>[t.getTrackId()]}),BG=oi(),zG=Gt({argsMap:t=>[t.getTrackId()]}),WG=oi(),GG=Gt({argsMap:t=>[t.getTrackId()]}),HG=oi(),$G=Gt({argsMap:t=>[t.getTrackId()]}),KG=Gt({argsMap:t=>[t.getTrackId()]}),qG=oi(),Nn((zs=class extends ai{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(el.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Yv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){gr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[MG,UG],Object.getOwnPropertyDescriptor(zs.prototype,"startProcessAudioBuffer"),zs.prototype),Nn(zs.prototype,"pauseProcessAudioBuffer",[VG,FG],Object.getOwnPropertyDescriptor(zs.prototype,"pauseProcessAudioBuffer"),zs.prototype),Nn(zs.prototype,"seekAudioBuffer",[jG,BG],Object.getOwnPropertyDescriptor(zs.prototype,"seekAudioBuffer"),zs.prototype),Nn(zs.prototype,"resumeProcessAudioBuffer",[zG,WG],Object.getOwnPropertyDescriptor(zs.prototype,"resumeProcessAudioBuffer"),zs.prototype),Nn(zs.prototype,"stopProcessAudioBuffer",[GG,HG],Object.getOwnPropertyDescriptor(zs.prototype,"stopProcessAudioBuffer"),zs.prototype),Nn(zs.prototype,"close",[$G],Object.getOwnPropertyDescriptor(zs.prototype,"close"),zs.prototype),Nn(zs.prototype,"setAudioBufferPlaybackSpeed",[KG,qG],Object.getOwnPropertyDescriptor(zs.prototype,"setAudioBufferPlaybackSpeed"),zs.prototype),zs);class Wi extends ai{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Qv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,Er(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(L.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):L.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){L.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}mP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Wi?s.emit(ry.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class hge extends YW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(el.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):L.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const YG=new Map;function XG(t,r){if(t.length===0||r.length===0)return 1/0;const s=zL(t),a=zL(r);return Math.floor(a/s)}class m2{get rendFrameRate(){const r=Math.max(1,XG(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:to.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(L.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onFirstVideoFrameRender",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"renderFreezeAccTime2",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"isDestroyed",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"internal",!1),Pe(this,"_render_interframe_delays",[]),Pe(this,"_render_interframe_delays_sizes",[]),Pe(this,"_videoState",Xh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",to.NONE),Pe(this,"_isInPage",!0),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return L.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&pr.curState==="running"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y8())),rW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":s.type==="play"&&L.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=to.PLAYING;break;case"loadeddata":if(this.videoState=Xh.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=to.CANPLAY;break;case"stalled":this.videoElementStatus=to.STALLED;break;case"suspend":this.videoElementStatus=to.SUSPEND;break;case"pause":this.videoElementStatus=to.PAUSED,vo()||Du()||Vs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=to.WAITING;break;case"abort":this.videoElementStatus=to.ABORT;break;case"ended":this.videoElementStatus=to.ENDED;break;case"emptied":this.videoElementStatus=to.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=to.ERROR,L.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,Qh.lastVisibleTime<Qh.lastHiddenTime||d<Qh.lastHiddenTime||d<Qh.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y8())),rW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),pr.on(As.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.on(As.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&nG(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(L.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):L.warning("[".concat(this.trackId,"] play warning: "),c)});const a=xn();if((a.name==="Safari"&&Number(a.version)===15||Fv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return L.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new gt((d,h)=>{a.toBlob(async m=>{if(a.remove(),m){const g=await dG(m);d({buffer:g,width:a.width,height:a.height})}else h(new Le(ee.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await f2(r)}destroy(){this.isDestroyed=!0,pr.off(As.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),pr.off(As.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Xh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=to.INIT,!this.videoElementCheckInterval&&(JG.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(d){return d!==document.body&&document.body.contains(d)}(this.videoElement)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Xh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Xh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(E,b)=>{if(this.videoElementStatus===to.PLAYING){if(d){const k=b.presentationTime-d.presentationTime,G=b.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(G),this._render_interframe_delays.push(k);const j=zL(this._render_interframe_delays_sizes),B=j-this._render_interframe_delays_sizes[0];if(j>30&&B>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Xh.VideoStateStarting&&(this.videoState=Xh.VideoStateDecoding),this.videoState===Xh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),k<oe("VIDEO_FREEZE_DURATION")&&this.videoState===Xh.VideoStateFrozen&&(this.videoState=Xh.VideoStateDecoding),k>oe("VIDEO_FREEZE_DURATION")&&Qh.lastVisibleTime>=Qh.lastHiddenTime&&d.timestamp>Qh.lastVisibleTime&&d.timestamp>Qh.lastHiddenTime){const Z=Math.min(66,XG(this._render_interframe_delays_sizes,this._render_interframe_delays)),Q=Math.max(0,k-(G-1)*Z);this.renderFreezeAccTime2+=Q>Z?Q:0,this.renderFreezeAccTime+=k}}d=Ir(Ir({},b),{},{timestamp:E})}else this.isSkipCalcRenderFreezeTime()&&(d=Ir(Ir({},b),{},{timestamp:E}));var I,A;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((I=(A=this.videoElement).requestVideoFrameCallback)===null||I===void 0||I.call(A,g))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),fP()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=xn();a.name==="Safari"&&Number(a.version)===15||Fv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ei()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ei()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{L.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){JG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=to.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===to.DESTROYED||this.internal}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{L.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{L.error(a)}),this.autoplayFailed=!1,Kw()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Kw()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),tG()}}const JG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class g2 extends m2{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.internal=s,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await f2(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var QG,ZG,e9,t9,n9,r9,i9,s9,o9,a9,c9,l9,u9,d9,h9,p9,f9,m9,g9,_9,y9,E9,v9,S9,b9,w9,T9,C9,bn,R9,I9,A9,P9,k9,O9,N9,x9,ol;let Nr=(QG=Gt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),ZG=oi(),e9=Gt({argsMap:t=>[t.getTrackId()]}),t9=Wv("LocalVideoTrack","_enabledMutex"),n9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),r9=oi(),i9=Wv("LocalVideoTrack","_enabledMutex"),s9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),o9=oi(),a9=Gt({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),c9=oi(),l9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),u9=oi(),d9=oi(),h9=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),p9=oi(),f9=oi(),m9=oi(),g9=Gt({argsMap:t=>[t.getTrackId()]}),_9=oi(),y9=oi(),E9=oi(),v9=oi(),S9=oi(),b9=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),w9=Gt({argsMap:t=>[t.getTrackId()]}),T9=Gt({argsMap:t=>[t.getTrackId()]}),C9=Gt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),bn=class Kae extends Jv{get videoHeight(){if(Vs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Vs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==to.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Pe(this,"trackMediaType",Xv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_saveEncodeBitrateRatio",1),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Vs()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(_r.CUSTOM_TRACK)!==-1?this._encoderConfig=Kr(s):this._encoderConfig=s,this._hints.indexOf(_r.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(PL(Hn.CHROME,115)&&hP().indexOf("Windows")!==-1){const m=function(g,E){if("VideoFrame"in window&&"TransformStream"in window&&Fn().supportWebRTCInsertableStream){const b=new MediaStreamTrackProcessor(g),I=new MediaStreamTrackGenerator({kind:"video"});let A,k,G=Date.now();const j=()=>{B&&(clearInterval(B),B=void 0),A&&(A.close(),A=void 0),g.stop(),k=void 0,I.removeEventListener("ended",j)};let B=window.setInterval(()=>{if(k&&A&&Date.now()-G>1e3)try{I.readyState==="live"?k.enqueue(A.clone()):j()}catch{j()}},1e3);const Z=new TransformStream({transform:(Q,ae)=>{I.readyState==="live"?(k=ae,G=Date.now(),A===void 0?(A=Q,ae.enqueue(Q.clone())):(ae.enqueue(A),A=Q)):Q.close()}});return I.addEventListener("ended",j),b.readable.pipeThrough(Z).pipeTo(I.writable),I}}(r);m&&(L.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(_r.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new iG(this.getTrackId(),"local"),this._processorDestination=new rG(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Ir(Ir(Ir({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new m2(a):this._player=new g2(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Yv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await yr(this,Ct.NEED_DISABLE_TRACK,this)}catch(a){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await yr(this,Ct.NEED_ENABLE_TRACK,this)}catch(a){throw L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await yr(this,Ct.NEED_MUTE_TRACK,this):await yr(this,Ct.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),L.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await yr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(L)}}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Uu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=AP({encoderConfig:r});(Vs()||vo()||Du())&&(a.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(ee.UNEXPECTED_ERROR,c.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(L)}}getStats(){return Wm(()=>{L.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Qc(this,Ct.GET_STATS)||Ir({},a2)}async setBeautyEffect(r){L.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await f2(r)}async findClosestProfile(){const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},m=zv(this._videoWidth||r||c||0),g=zv(this._videoHeight||s||d||0),E=function(b,I,A){if(!Array.isArray(oe("VIDEO_ENCODER_CONFIG_LIST"))||oe("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const k=Math.min(b,I);return!(k>=480)&&Ir(Ir({},oe("VIDEO_ENCODER_CONFIG_LIST").find(G=>G.height>k)),{},{frameRate:A})}(m,g,zv(a||h||15));if(E)return L.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(E))),this.setEncoderConfiguration(E)}async setBitrateLimit(r){L.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void L.error(ee.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await yr(this,Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,L.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}L.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return L.error(ee.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,L.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){aG(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(_P)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");L.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Uu(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(L)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(g,E,b,I,A){const k=oe("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:I,max:A};if(A===void 0){const G=Math.floor(200*Math.pow(b/15,.6)*Math.pow(g*E/640/360,.75));A=k==="STANDARD_BITRATE"?4*G:2*G,I=I??G}else I=I??Math.floor(A/10);return{min:I,max:A}}(r,s,a,d,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,oe("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,E]=function(b,I,A){const k=4*Math.floor(2e5*Math.pow(A/15,.6)*Math.pow(b*I/230400,.75)),G=b*I,j=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),B=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let Z=Cc(j).call(j).next().value,Q=1;if(j.has(G))Z=j.get(G);else{var ae;const Qe=G_(ae=Array.from(j.entries())).call(ae,(vn,Jt)=>{let[nr]=vn,[qn]=Jt;return nr-qn}),fn=Qe.find(vn=>{let[Jt]=vn;return Jt>G});if(fn){const vn=Qe.indexOf(fn);if(vn>0){const Jt=Qe[vn-1],nr=(G-Jt[0])/(fn[0]-Jt[0]);Z=Jt[1]+nr*(fn[1]-Jt[1])}else Z=fn[1]}else Z=Qe[Qe.length-1][1]}if(B.has(G))Q=B.get(G);else{var ye;const Qe=G_(ye=Array.from(B.entries())).call(ye,(vn,Jt)=>{let[nr]=vn,[qn]=Jt;return nr-qn}),fn=Qe.find(vn=>{let[Jt]=vn;return Jt>G});if(fn){const vn=Qe.indexOf(fn);if(vn>0){const Jt=Qe[vn-1],nr=(G-Jt[0])/(fn[0]-Jt[0]);Q=Jt[1]+nr*(fn[1]-Jt[1])}else Q=fn[1]}else Q=Qe[Qe.length-1][1]}const _e=oe("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(Z=_e/100);const ue=Math.floor(k*Z),Ie=Math.floor(65e4*Math.pow(b*I/230400,.5)*Math.pow(A/15,.69));let Ue=ue;const We=oe("VIDEO_STANDARD_BITRATE_VERSION");return We&&We>0&&(We===1?Ue=k:We===2?Ue=ue:We===3&&(Ue=Ie)),[Math.floor(Ue/1e3),Q]}(r,s,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=E,L.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else L.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=cW.checkOneElementVisible(d),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=Pt.reportApiInvoke(null,{tag:$r.TRACER,name:di.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new Le(ee.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ir(Ir({},a),Uu(r))),a=Z_(a);const c=Er(8,"track-video-cloned-"),d=new Kae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Z_(this._scalabilityMode),this._optimizationMode,c,Z_(this._hints));return r&&a&&d.setEncoderConfiguration(a),L.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(ee.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(ee.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Wm(()=>{Pt.reportApiInvoke(null,{name:di.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:$r.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void L.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(ee.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void L.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):L.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(oa.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await yr(this,Ct.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await yr(this,Ct.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oa.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(tl.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(tl.REQUEST_CONSTRAINTS)}},Nn(bn.prototype,"play",[QG,ZG],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),Nn(bn.prototype,"stop",[e9],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),Nn(bn.prototype,"setEnabled",[t9,n9,r9],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),Nn(bn.prototype,"setMuted",[i9,s9,o9],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),Nn(bn.prototype,"setSaveEncodeBitrateRatio",[a9,c9],Object.getOwnPropertyDescriptor(bn.prototype,"setSaveEncodeBitrateRatio"),bn.prototype),Nn(bn.prototype,"setEncoderConfiguration",[l9,u9],Object.getOwnPropertyDescriptor(bn.prototype,"setEncoderConfiguration"),bn.prototype),Nn(bn.prototype,"getStats",[d9],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),Nn(bn.prototype,"setBeautyEffect",[h9,p9],Object.getOwnPropertyDescriptor(bn.prototype,"setBeautyEffect"),bn.prototype),Nn(bn.prototype,"getCurrentFrameData",[f9],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameData"),bn.prototype),Nn(bn.prototype,"getCurrentFrameImage",[m9],Object.getOwnPropertyDescriptor(bn.prototype,"getCurrentFrameImage"),bn.prototype),Nn(bn.prototype,"findClosestProfile",[g9,_9],Object.getOwnPropertyDescriptor(bn.prototype,"findClosestProfile"),bn.prototype),Nn(bn.prototype,"setBitrateLimit",[y9],Object.getOwnPropertyDescriptor(bn.prototype,"setBitrateLimit"),bn.prototype),Nn(bn.prototype,"setOptimizationMode",[E9],Object.getOwnPropertyDescriptor(bn.prototype,"setOptimizationMode"),bn.prototype),Nn(bn.prototype,"setScalabiltyMode",[v9],Object.getOwnPropertyDescriptor(bn.prototype,"setScalabiltyMode"),bn.prototype),Nn(bn.prototype,"updateMediaStreamTrackResolution",[S9],Object.getOwnPropertyDescriptor(bn.prototype,"updateMediaStreamTrackResolution"),bn.prototype),Nn(bn.prototype,"pipe",[b9],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),Nn(bn.prototype,"unpipe",[w9],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),Nn(bn.prototype,"close",[T9],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),Nn(bn.prototype,"replaceTrack",[C9],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),bn),PP=(R9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),I9=oi(),A9=Wv("CameraVideoTrack","_enabledMutex"),P9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),k9=oi(),O9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),N9=oi(),x9=Gt({argsMap:t=>[t.getTrackId()]}),ol=class qae extends Nr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,Uu(s.encoderConfig),c,d,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Fv()||DL())&&!function(){const m=xn();if(m.os!==ss.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2}()&&iW()&&this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Uu(this._config.encoderConfig),pr.on(As.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pr.on(As.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(L.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await il.getDeviceById(r),a={};a.video=Ir({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await rl(a,this.getTrackId())}catch(d){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await rl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await il.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}L.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){L.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Ir(Ir({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await rl(s,this.getTrackId())}catch(c){throw L.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await rl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Ir({},s.video),L.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await rl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await yr(this,Ct.NEED_ENABLE_TRACK,this)}catch(a){throw L.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await yr(this,Ct.NEED_DISABLE_TRACK,this)}catch(a){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(ee.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Uu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=Kr(this._config);a.encoderConfig=r;const c=AP(a);(Vs()||vo()||Du())&&(c.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(ee.UNEXPECTED_ERROR,d.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(_r.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await yr(this,Ct.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(L)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((vo()||Du())&&this._enabled&&!this._isClosed&&pr.duringInterruption){const r=async()=>{pr.off(As.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};pr.on(As.IOS_INTERRUPTION_END,r)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=il.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await rl({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),pr.off(As.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),pr.off(As.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ir(Ir({},a),Uu(r))),a=Z_(a);const c=Er(8,"track-cam-cloned-"),d=new qae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,Z_(Ir(Ir({},this._config),{},{encoderConfig:a})),Z_(this._constraints),Z_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),L.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(tl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(tl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Nn(ol.prototype,"setDevice",[R9,I9],Object.getOwnPropertyDescriptor(ol.prototype,"setDevice"),ol.prototype),Nn(ol.prototype,"setEnabled",[A9,P9,k9],Object.getOwnPropertyDescriptor(ol.prototype,"setEnabled"),ol.prototype),Nn(ol.prototype,"setEncoderConfiguration",[O9,N9],Object.getOwnPropertyDescriptor(ol.prototype,"setEncoderConfiguration"),ol.prototype),Nn(ol.prototype,"close",[x9],Object.getOwnPropertyDescriptor(ol.prototype,"close"),ol.prototype),ol);function _2(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Ir(Ir({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?L.debug("[".concat(t,"] set content hint to"),s.optimizationMode):L.debug("[".concat(t,"] set content hint failed")))):L.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var D9,L9,M9,U9,Hl,V9,F9,j9,B9,z9,W9,Lo;class G9 extends $W{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(Er(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,L.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let eS=(D9=Gt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),L9=Gt({argsMap:t=>[t.getTrackId()]}),M9=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),U9=Gt({argsMap:t=>[t.getTrackId()]}),Nn((Hl=class extends G9{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==to.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a,c){super(t,r,s,a),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",Xv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"_prePlayer",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new iG(this.getTrackId(),"remote"),this.processorDestination=new rG(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wm(()=>{L.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Qc(this,Ct.GET_STATS)||Ir({},GW)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Gl.PLAY_START),typeof t=="string"){const a=document.getElementById(t);a?t=a:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Ir(Ir({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new m2(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new g2(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Gl.FIRST_FRAME_DECODED),c&&this.safeEmit(Gl.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Gl.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Gl.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Gl.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){aG(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(_P)}_updatePlayerSource(){L.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=cW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=Pt.reportApiInvoke(null,{tag:$r.TRACER,name:di.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(ee.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oa.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ry.SEI_RECEIVED,t)}}).prototype,"play",[D9],Object.getOwnPropertyDescriptor(Hl.prototype,"play"),Hl.prototype),Nn(Hl.prototype,"stop",[L9],Object.getOwnPropertyDescriptor(Hl.prototype,"stop"),Hl.prototype),Nn(Hl.prototype,"pipe",[M9],Object.getOwnPropertyDescriptor(Hl.prototype,"pipe"),Hl.prototype),Nn(Hl.prototype,"unpipe",[U9],Object.getOwnPropertyDescriptor(Hl.prototype,"unpipe"),Hl.prototype),Hl),tS=(V9=Gt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),F9=Gt({argsMap:(t,r)=>[t.getTrackId(),r]}),j9=Gt({argsMap:t=>[t.getTrackId()]}),B9=Gt({argsMap:t=>[t.getTrackId()]}),z9=Gt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),W9=Gt({argsMap:t=>[t.getTrackId()]}),Nn((Lo=class extends G9{get isPlaying(){return this._useAudioElement?Aa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Pe(this,"trackMediaType",Xv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new p2,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new XW(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(el.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Gl.FIRST_FRAME_DECODED)}),this.processorContext=new oG(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new sG(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(el.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(el.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(el.ON_AUDIO_BUFFER),this._source.on(el.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Aa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!jW())throw new Le(ee.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Aa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wm(()=>{L.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Qc(this,Ct.GET_STATS)||Ir({},WW)}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] use audio element to play")),Aa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Aa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Aa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(ee.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oa.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(oa.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oa.ON_TRACK),this.processorDestination.removeAllListeners(oa.ON_NODE)}}).prototype,"setVolume",[V9],Object.getOwnPropertyDescriptor(Lo.prototype,"setVolume"),Lo.prototype),Nn(Lo.prototype,"setPlaybackDevice",[F9],Object.getOwnPropertyDescriptor(Lo.prototype,"setPlaybackDevice"),Lo.prototype),Nn(Lo.prototype,"play",[j9],Object.getOwnPropertyDescriptor(Lo.prototype,"play"),Lo.prototype),Nn(Lo.prototype,"stop",[B9],Object.getOwnPropertyDescriptor(Lo.prototype,"stop"),Lo.prototype),Nn(Lo.prototype,"pipe",[z9],Object.getOwnPropertyDescriptor(Lo.prototype,"pipe"),Lo.prototype),Nn(Lo.prototype,"unpipe",[W9],Object.getOwnPropertyDescriptor(Lo.prototype,"unpipe"),Lo.prototype),Lo);const Qh=new class extends Jr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),L.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class H9 extends Jr{constructor(r,s){super(),Pe(this,"trackMediaType",Xv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new gt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(ee.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[RP.OPEN,RP.CLOSE,RP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class pge extends H9{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&L.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(RP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class fge extends H9{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function kP(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>PA.revokeObjectURL(t),0),new Worker(PA.createObjectURL(t))}const $9=71,y2=1,E2=2,v2=1,K9=2;var $m=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}($m||{});function S2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==$9)return;const a=t.getUint16(1),c=y2+E2+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=y2+E2;for(;m<c;){const g=t.getUint8(m),E=t.getUint16(m+v2),b=v2+K9;if(g===$m.AUDIO_LEVEL){let I=t.getUint8(m+b);for(let A=1;A<E;A++)I=I<<8|t.getUint8(m+b+A);h.tlv.push({tag:g,length:E,value:r?127^I>>1:127&I})}else if(g===$m.METADATA||g===$m.AUDIO_64_BIT_PTS){const I=new Uint8Array(E);for(let A=0;A<E;A++)I[A]=t.getUint8(m+b+A);h.tlv.push({tag:g,length:E,value:I})}m+=b+E}return h}const OP=new Map,NP=127,oy=1e-10,b2=139/13,xP=new Map;function w2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return xP.has(a)?c=xP.get(a):(c=Math.log(function(h,m){const g=h-m;m<g&&(m=g);let E=1;for(let b=h,I=1;b>m;b--,I++)E=E*b/I;return E}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,xP.set(a,c)),c<oy&&(c=oy),c}function q9(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let g=0;for(let E=m+c;m<E;m++)t[m]>s&&g++;r[h]!==g&&(r[h]=g,d=!0)}return d}window.cache=xP;let mge=0;class Y9{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",oy),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",oy),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",oy),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(mge++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+b2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/b2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return q9(this.mediums,this.longs,4)}computeMediums(){return q9(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=w2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=w2(this.longs[0],10,47),this.longSpeechActivityScore>oy&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=w2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(h_(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>NP&&(a=NP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+b2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>NP&&(s=NP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class gge{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class T2{constructor(r,s,a){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class _ge extends Jr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new Y9(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new T2(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new T2(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new T2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new gge(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Cc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const b=this.speakers.entries().next();b.value&&(d=b.value[0],m=b.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let E=2;for(const b of this.speakers.entries()){const[I,A]=b;if(A===m)continue;A.evaluateSpeechActivityScores(r);for(let B=0;B<g.length;++B){const Z=m==null?oy:m.getSpeechActivityScore(B);g[B]=Math.log(A.getSpeechActivityScore(B)/Z)}const k=g[0],G=g[1],j=g[2];k>3&&G>2&&j>0&&G>E&&(E=G,d=I)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Cc(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const nS=new Map;let Wd=null,DP=null;const X9=3;let ay=[];const Gd=new Map,LP=new Map;class yge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Gd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],d=[];return Array.from(Cc(Gd).call(Gd)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(Cc(Gd).call(Gd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(Cc(Gd).call(Gd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let MP;function J9(t){const r=Gd.get(t);r&&(Gd.delete(t),r.clearTimer())}const UP=new Map,Ege=new Map,C2="video/h264",R2="video/h265";function Q9(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function Z9(t){const r=t.length;let s=[],a=0;for(;a<r;)a+2<r&&t[a]===0&&t[a+1]===0&&(t[a+2]===0||t[a+2]===1||t[a+2]===2||t[a+2]===3)?(s.push(t[a],t[a+1],3,t[a+2]),a+=3):(s.push(t[a]),a++);return new Uint8Array(s)}function eH(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const s=r+(t[r+2]===0?4:3);if(s>=t.length)return"";const a=t[s];return 128&a?"":(a>>1&63)>=32||s+1<t.length&&(248&t[s+1])==0?R2:(31&a)<=31?C2:""}const VP=new Map,sT=new Map;(function(){const t=xn();Is.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Is.getStreamFromExtension=t.name===Hn.CHROME&&Number(t.version)>34,Is.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),Is.supportMinBitrate=t.name===Hn.CHROME||t.name===Hn.EDGE,Is.supportSetRtpSenderParameters=function(){const r=xn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!hf()||!(!Vs()&&!pP())||r.name===Hn.FIREFOX&&Number(r.version)>=64)}(),t.name===Hn.SAFARI&&(Number(t.version)>=14?Is.supportDualStream=!0:Is.supportDualStream=!1),Is.webAudioMediaStreamDest=function(){const r=xn();return!(r.name===Hn.SAFARI&&Number(r.version)<12)}(),Is.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Is.supportWebGL=typeof WebGLRenderingContext<"u",Is.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,hf()||(Is.webAudioWithAEC=!0),Is.supportShareAudio=function(){const r=xn();return(r.os===ss.WIN_10||r.os===ss.WIN_81||r.os===ss.WIN_7||r.os===ss.LINUX||r.os===ss.MAC_OS||r.os===ss.CHROMIUM_OS)&&r.name===Hn.CHROME&&Number(r.version)>=74}(),Is.supportDataChannel=!!(Vv(76)||OL(68)||Z8(14)),Is.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!ei()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Is.supportWebRTCEncodedTransform=Vv(87)||X8()||OL(117),Is.supportWebRTCInsertableStream=function(){const r=xn();return(r.name===Hn.CHROME||r.name===Hn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Is.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Is.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,gP(()=>{Is.supportDualStreamEncoding=function(){const r=xn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),L.debug("browser ua: ",navigator.userAgent),L.info("browser info: ",t),L.info("browser compatibility: ",Is)})})();const vge=["CHINA","GLOBAL"],tH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cy=[],rS=[];function ly(t,r){return!!r&&cy.some(s=>s.uid===t&&s.channelName===r)}function I2(){return rS.length>0}var Sge=mz.forEach,nH=o_("forEach")?[].forEach:function(t){return Sge(this,t,arguments.length>1?arguments[1]:void 0)};Gn({target:"Array",proto:!0,forced:[].forEach!==nH},{forEach:nH});var bge=Ec("Array","forEach"),wge=yd,Tge=Hr,Cge=N,Rge=bge,A2=Array.prototype,Ige={DOMTokenList:!0,NodeList:!0},Age=function(t){var r=t.forEach;return t===A2||Cge(A2,t)&&r===A2.forEach||Tge(Ige,wge(t))?Rge:r},Pge=l(Age),kge=Ks,rH=Ta;Gn({target:"Object",stat:!0,forced:u(function(){rH(1)})},{keys:function(t){return rH(kge(t))}});var Oge=l(De.Object.keys),Nge=l(Mi),xge=l(d_),Dge=Gn,iH=Ed,Lge=Us,Mge=we,sH=Ye,Uge=dr,Vge=sn,Fge=hD,jge=Or,Bge=ws,zge=sz("slice"),Wge=jge("species"),P2=Array,Gge=Math.max;Dge({target:"Array",proto:!0,forced:!zge},{slice:function(t,r){var s,a,c,d=Vge(this),h=Uge(d),m=sH(t,h),g=sH(r===void 0?h:r,h);if(iH(d)&&(s=d.constructor,(Lge(s)&&(s===P2||iH(s.prototype))||Mge(s)&&(s=s[Wge])===null)&&(s=void 0),s===P2||s===void 0))return Bge(d,m,g);for(a=new(s===void 0?P2:s)(Gge(g-m,0)),c=0;m<g;m++,c++)m in d&&Fge(a,c,d[m]);return a.length=c,a}});var Hge=Ec("Array","slice"),$ge=N,Kge=Hge,k2=Array.prototype,qge=function(t){var r=t.slice;return t===k2||$ge(k2,t)&&r===k2.slice?Kge:r},Yge=l(qge);function It(t,r,s,a,c){var d,h,m,g={};return Pge(d=Oge(a)).call(d,function(E){g[E]=a[E]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=Nge(h=xge(m=Yge(s).call(s)).call(m)).call(h,function(E,b){return b(t,r,E)||E},g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(tz(t,r,g),null):g}let FP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),O2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Vu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),aa=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),zt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Ar=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Qt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Yt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t}({}),oT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Rn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),ca=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),ln=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function jP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw L.error("Invalid Channel Name ".concat(t)),new Oe(ee.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function BP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||aW(t,1,255)))throw new Oe(ee.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&L.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ff=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Xge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},N2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function x2(t,r){Cs(t.url,"".concat(r,".url"),1,1e3,!1),ti(t.x)||gr(t.x,"".concat(r,".x"),0,1e4),ti(t.y)||gr(t.y,"".concat(r,".y"),0,1e4),ti(t.width)||gr(t.width,"".concat(r,".width"),0,1e4),ti(t.height)||gr(t.height,"".concat(r,".height"),0,1e4),ti(t.zOrder)||gr(t.zOrder,"".concat(r,".zOrder"),0,255),ti(t.alpha)||gr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Jge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Km=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),D2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Gi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function oH(t){if(!t.channelName)throw new Oe(ee.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(ee.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Cs(t.token,"info.token",1,2047),BP(t.uid),jP(t.channelName),!0}let la=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),mf=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),tc=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),iS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),or=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ms=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),zP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),os=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Jn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const aH=[Jn.AFRICA,Jn.ASIA,Jn.CHINA,Jn.EUROPE,Jn.GLOBAL,Jn.INDIA,Jn.JAPAN,Jn.NORTH_AMERICA,Jn.OCEANIA,Jn.OVERSEA,Jn.SOUTH_AMERICA];let no=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const WP={CHINA:{},ASIA:{CODE:no.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:no.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:no.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:no.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:no.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:no.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:no.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:no.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:no.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:no.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:no.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:no.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:no.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};JL&&(WP.CHINA={CODE:no.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let aT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function cH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class lH extends Jr{constructor(r,s){super(),Y(this,"onICEConnectionStateChange",void 0),Y(this,"onConnectionStateChange",void 0),Y(this,"onDTLSTransportStateChange",void 0),Y(this,"onDTLSTransportError",void 0),Y(this,"onICETransportStateChange",void 0),Y(this,"onFirstAudioReceived",void 0),Y(this,"onFirstVideoReceived",void 0),Y(this,"onFirstAudioDecoded",void 0),Y(this,"onFirstVideoDecoded",void 0),Y(this,"onFirstVideoRender",void 0),Y(this,"onFirstVideoDecodedTimeout",void 0),Y(this,"onSelectedLocalCandidateChanged",void 0),Y(this,"onSelectedRemoteCandidateChanged",void 0),Y(this,"onICECandidateError",void 0),Y(this,"getLocalVideoStats",void 0)}}class uH extends lH{constructor(r,s){super(r,s),Y(this,"establishPromise",void 0)}}let Et=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),ro=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),gf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const dH=["disconnected","failed"];let Xe=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),ir=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Vt=function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Fu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ju=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),gs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),hH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Zh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),$l=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Hd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),sS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Ei=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),oS=function(t){return t.ABORT="abort",t}({}),qm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Qge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Zge={[FP.ACCESS_POINT]:{[aa.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[aa.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[aa.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[aa.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[aa.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[aa.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[aa.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[FP.UNILBS]:{[Vu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Vu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Vu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Vu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Vu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Vu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Vu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Vu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Vu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Vu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Vu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Vu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[FP.STRING_UID_ALLOCATOR]:{[O2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[O2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[O2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function aS(t){const r=Zge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===FP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const e_e={[zt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[zt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[zt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[zt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[zt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[zt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[zt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[zt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[zt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[zt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[zt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[zt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[zt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[zt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[zt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[zt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[zt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[zt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[zt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[zt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[zt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[zt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[zt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[zt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[zt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[zt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[zt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[zt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[zt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[zt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[zt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[zt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[zt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[zt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[zt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[zt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[zt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[zt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[zt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[zt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[zt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[zt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[zt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[zt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[zt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[zt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[zt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[zt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[zt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[zt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[zt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[zt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[zt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[zt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[zt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[zt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[zt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[zt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[zt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[zt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[zt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[zt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[zt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function cT(t){return e_e[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function pH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function L2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):pH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function M2(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const t_e=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,n_e=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,r_e=/wss:\/\/(.+):([0-9]+)\/?/,i_e=/wss:\/\/(.[^\/]+)\/?/;let s_e=0;class o_e{constructor(r,s){Y(this,"id",0),Y(this,"store",void 0),Y(this,"recordIndex",void 0),Y(this,"websockets",[]),Y(this,"try443PortDuration",2e3),Y(this,"forceCloseWSDuration",5e3),Y(this,"try443PortTimeout",null),Y(this,"forceCloseTimeout",null),Y(this,"isTry443PortFailed",!1),Y(this,"isNormalPortFailed",!1),Y(this,"useDoubleDomain",!1),Y(this,"useProxy",!1),Y(this,"startTime",Date.now()),this.id=++s_e,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];L.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(A=>{var k;return tt(k=r.host).call(k,A)});m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach(A=>{g.push(M2(L2(L2({},r),{},{host:r.host.replace(m,A)}),s))});else{const A=L2({},r);if(s&&m){const k=c.find(G=>G!==m);k&&(A.host=A.host.replace(m,k))}g.push(M2(A,s))}try{g.forEach(A=>{const k=new WebSocket(A);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(A){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Oe(ee.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const E=$w();this.store&&this.store.recordJoinChannelService({urls:h.map(A=>A.url),service:"gateway"},this.recordIndex),h.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(k=>{k!==A&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,E.resolve(A)},A.onclose=k=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(A.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),E.reject({code:k.code,reason:zP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),I()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},A.onmessage=k=>this.logger("".concat(A.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const b=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},I=()=>{if(E.isResolved)return b();xn().os===ss.MAC_OS&&ei()&&b(),this.createWebSocket(r,!0,!0).then(A=>{E.resolve(A)}).catch(A=>{this.isNormalPortFailed&&E.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,b()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,b()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,I()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,g;return[,h,m,g]=d.match(t_e)||[],h||([,m,g]=d.match(n_e)||[]),m&&g||([,m,g]=d.match(r_e)||[]),m&&g||([,m]=d.match(i_e)||[]),m||L.warning("un-destructible url: ",d),{proxy:h,host:m,port:g||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(L.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function fH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class mH extends Jr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;tt(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(ln.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(ln.CONNECTED):this._state==="closed"?this.emit(ln.CLOSED):this._state==="failed"&&this.emit(ln.FAILED))}resetReconnectCount(r){L.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),Y(this,"_websocketUrl",null),Y(this,"connectionID",0),Y(this,"currentURLIndex",0),Y(this,"urls",[]),Y(this,"_reconnectMode","tryNext"),Y(this,"reconnectReason",void 0),Y(this,"_initMutex",void 0),Y(this,"name",void 0),Y(this,"_state","closed"),Y(this,"reconnectInterrupter",void 0),Y(this,"websocket",void 0),Y(this,"retryConfig",void 0),Y(this,"reconnectCount",0),Y(this,"forceCloseTimeout",5e3),Y(this,"onlineReconnectListener",void 0),Y(this,"useCompress",void 0),Y(this,"tryDoubleDomain",!1),Y(this,"use443PortOnly",!1),Y(this,"wsInflateLength",0),Y(this,"wsDeflateLength",0),Y(this,"closeEstablishingWs",()=>{}),Y(this,"store",void 0),Y(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(I){for(var A=1;A<arguments.length;A++){var k=arguments[A]!=null?arguments[A]:{};A%2?fH(Object(k),!0).forEach(function(G){Y(I,G,k[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(k)):fH(Object(k)).forEach(function(G){Object.defineProperty(I,G,Object.getOwnPropertyDescriptor(k,G))})}return I}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new eo("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=s,E=Math.max(300,Math.floor(3*m/5)),b=Math.max(1.2,Math.floor(8*g)/10);Ac.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=b),Ci.on(jv.NETWORK_STATE_CHANGE,(I,A)=>{I!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(I)),I===Ac.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=b):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{var c;const d=$w(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),function(m){return!(wP()||oe("USE_NEW_TOKEN")||!oe("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(hH.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(ln.CLOSED,()=>{d.reject(new Le(ee.WS_DISCONNECT))}),this.once(ln.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void L.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),L.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(ee.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(ee.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=$w();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=b=>{var I;(I=this.store)===null||I===void 0||I.signalChannelOpen(),L.debug("[".concat(this.name,"] websocket opened:"),b),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async b=>{var I;if(L.debug("[".concat(this.name,"] websocket close ").concat((I=this.websocket)===null||I===void 0?void 0:I.url,", code: ").concat(b.code,", reason: ").concat(b.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(ee.WS_DISCONNECT,"websocket close: ".concat(b.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=b.reason,this.state="reconnecting");const A=Qc(this,ln.WILL_RECONNECT,this.reconnectMode,b.reason)||this.reconnectMode,k=await this.reconnectWithAction(A);if(this.state==="closed")return void L.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return a.reject(new Le(ee.WS_DISCONNECT,"websocket reconnect failed: ".concat(b.code))),this.close(!0);a.resolve()}},h=b=>{this.emit(ln.ON_MESSAGE,b)},m=b=>{L.warn("[".concat(this.connectionID,"] ws open error ").concat(b))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),L.debug("[".concat(this.name,"] start connect, url:"),r);const g=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;this._websocketUrl=M2(r);const b=await this.chooseBestWebsocketConnection(r);this.websocket=b,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(b){const I=this.state==="closed",A=b instanceof Le,k=A&&b.code===ee.WS_ABORT,G=A&&b.code===ee.WS_ERR,j=A?b.message:b&&(b.reason||b.toString());L.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[b]},g),I||G?(a.reject(I?new Le(ee.WS_DISCONNECT,"websocket is closed: ".concat(j)):new Le(ee.WS_ERR,"init websocket failed: ".concat(j))),G&&L.error("[".concat(this.name,"] init websocket failed: ").concat(j))):d&&d(b)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;L.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Ci.isOnline||!Ci.onlineWaiter||(this.onlineReconnectListener=Ci.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=WL(this.reconnectCount,this.retryConfig);L.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await gt.race([Rs(h),this.onlineReconnectListener||new gt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(ln.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);L.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(L.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await js(this,ln.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;L.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&tt(m).call(m,"dynamic key expired")?(this.emit(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class U2 extends mH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=$w(),c=function(h,m){return new o_e(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(ee.WS_ABORT,"choose best websocket aborted"))};const d=oe("GATEWAY_DOMAINS");return L.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class lT extends mH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new gt((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(ee.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let g;const E=r.indexOf("?h="),b=m.find(G=>E!==-1?tt(r).call(r,G,E):tt(r).call(r,G));L.debug("[choose-best-ws] currentDomain: ",b,", domains: ",m);let I=!this.tryDoubleDomain||!b;if(!I&&b){var A;const G=Date.now();try{m.forEach(j=>{const B=E===-1?r.replace(b,j):r.substr(0,E)+r.substr(E).replace(b,j),Z=new WebSocket(B);Z.binaryType="arraybuffer",h.push(Z),L.debug("[choose-best-ws] ws is connecting:",Z.url)})}catch{for(L.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(B=>B.close());h.length;)h.pop();I=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(d)return;const B=Date.now()-G;L.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),h.filter(Z=>Z!==j).forEach(Z=>{L.debug("[choose-best-ws]close backup websocket: ".concat(Z.url)),Z.close()}),d=!0,a(j)},j.onclose=B=>{g=B,!d&&(h.find(Z=>!(Z.readyState===WebSocket.CLOSED||Z.readyState===WebSocket.CLOSING))||(L.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},j.onmessage=B=>{L.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(B.data))}}),Rs(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(I){var k;let G;L.debug("[choose-best-ws] use single url: ",r),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const B=new Le(ee.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return L.error("[".concat(this.name,"]").concat(B)),void c(B)}G.onopen=()=>{a(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{L.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},Rs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class a_e extends Jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Ar.CONNECTED?this.emit(Qt.WS_CONNECTED):r===Ar.RECONNECTING?this.emit(Qt.WS_RECONNECTING,this._websocketReconnectReason):r===Ar.CLOSED&&this.emit(Qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Ar.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new wW(5)),Y(this,"pingpongTimer",void 0),Y(this,"wsInflateDataTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"ortc",void 0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Qt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Rn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(rr.UID_BANNED);break;case 15:this.close(rr.IP_BANNED);break;case 16:this.close(rr.CHANNEL_BANNED)}if(c._type===Rn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case zt.ERR_LICENSE_MISSING:this.close(rr.LICENSE_MISSING);break;case zt.ERR_LICENSE_EXPIRED:this.close(rr.LICENSE_EXPIRED);break;case zt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(rr.LICENSE_MINUTES_EXCEEDED);break;case zt.ERR_LICENSE_PERIOD_INVALID:this.close(rr.LICENSE_PERIOD_INVALID);break;case zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(rr.LICENSE_MULTIPLE_SDK_SERVICE);break;case zt.ERR_LICENSE_ILLEGAL:this.close(rr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new U2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ar.CONNECTED&&this.reconnect("retry",Fs.OFFLINE)})}async request(r,s,a,c){const d=Er(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new gt((G,j)=>{if(this.connectionState===Ar.CONNECTED)return G();const B=()=>{this.off(Qt.WS_CLOSED,Z),G()},Z=()=>{this.off(Qt.WS_CONNECTED,B),j(new Oe(ee.WS_ABORT))};this.once(Qt.WS_CONNECTED,B),this.once(Qt.WS_CLOSED,Z),r!==Yt.PUBLISH&&r!==Yt.PUBLISH_DATASTREAM&&r!==Yt.SUBSCRIBE&&r!==Yt.SUBSCRIBE_DATASTREAM&&r!==Yt.UNSUBSCRIBE&&r!==Yt.UNSUBSCRIBE_DATASTREAM&&r!==Yt.UNPUBLISH&&r!==Yt.UNPUBLISH_DATASTREAM&&r!==Yt.CONTROL&&r!==Yt.RESTART_ICE||this.once(Qt.DISCONNECT_P2P,()=>{j(new Oe(ee.DISCONNECT_P2P))}),r!==Yt.PUBLISH&&r!==Yt.RESTART_ICE||this.once(Qt.ABORT_P2P_EXECUTION,()=>{j(new Oe(ee.DISCONNECT_P2P))})});if(this.connectionState!==Ar.CONNECTING&&this.connectionState!==Ar.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new gt((G,j)=>{let B=!1;const Z=(ae,ye)=>{B=!0,G({isSuccess:ae==="success",message:ye||{}}),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.emit(Qt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Z);const Q=()=>{j(new Oe(ee.WS_ABORT,"type: ".concat(r))),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.off("res-@".concat(d),Z)};this.once(Qt.WS_CLOSED,Q),this.once(Qt.WS_RECONNECTING,Q),Rs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Qt.REQUEST_TIMEOUT,r,s))})});let b=null;try{b=await E}catch(G){if(this.connectionState===Ar.CLOSED||r===Yt.LEAVE)throw new Oe(ee.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await g(),await this.request(r,s))}if(b.isSuccess)return b.message;const I=Number(b.message.error_code||b.message.code),A=cT(I),k=new Oe(ee.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(b.message.error_str),{code:I,data:b.message,desc:A.desc});return A.action==="success"?b.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===zt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(I===zt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fs.MULTI_IP)):this.reconnect(A.action,Fs.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new gt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(oT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ar.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((s,a)=>{this.once(Qt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Qt.WS_CLOSED,c=>a(this.initError||new Oe(ee.WS_ABORT,c))),this.connectionState=Ar.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||rr.LEAVE,this.connectionState=Ar.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Qt.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await js(this,Qt.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Yt.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!s)return this.emit(Qt.REPORT_JOIN_GATEWAY,zP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ar.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(ee.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Jw(this,Qt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Yt.REJOIN,r);return!!s&&(this.connectionState=Ar.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Rn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Rn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Rn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Rn.MUTE_AUDIO,{uid:a.uid}):this.emit(Rn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Rn.MUTE_VIDEO,{uid:a.uid}):this.emit(Rn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Rn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Rn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Rn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Rn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Rn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){if(!this.ortc)return!1;const s={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Yt.DOWNGRADE_CODEC,s)}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const s=cT(r.code);if(r.code===28&&"detail"in r&&(L.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Qt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(rr.UID_BANNED),void this.close()):void this.reconnect(s.action,Fs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fs.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(oT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(ln.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Qt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(ln.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ln.CLOSED,()=>{this.connectionState=Ar.CLOSED}),this.websocket.on(ln.FAILED,()=>{this._disconnectedReason=rr.NETWORK_ERROR,this.connectionState=Ar.CLOSED}),this.websocket.on(ln.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Ar.CONNECTED?this.connectionState=Ar.RECONNECTING:this.connectionState=Ar.CONNECTING}),this.websocket.on(ln.WILL_RECONNECT,(r,s,a)=>{const c=Jw(this,Qt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(L.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=zP.P2P_DISCONNECTED),d&&(L.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Qt.REPORT_JOIN_GATEWAY,s||zP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Qt.DISCONNECT_P2P)),a(r)}),this.websocket.on(ln.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{L.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Fs.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Qt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===ee.UNEXPECTED_RESPONSE&&r.data.code===zt.ERR_NO_AUTHORIZED)return this.initError=new Oe(ee.TOKEN_EXPIRE,"dynamic key expired"),void this.close(rr.TOKEN_EXPIRE);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fs.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(ln.REQUEST_NEW_URLS,(r,s)=>{js(this,Qt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(hH.PRE_CONNECT_PC,()=>{this.emit(Qt.PRE_CONNECT_PC)})}}let c_e=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Ri=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function gH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function GP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?gH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):gH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ym(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(L.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function HP(t){try{const r=oe("GATEWAY_DOMAINS").concat(oe("TURN_DOMAIN")).find(s=>tt(t).call(t,s));return r?t.split(".".concat(r))[0].replace(/-/g,"."):t}catch{return L.debug("serverUrlToIp error, fallback to url",t),t}}function V2(t,r){t.addresses||(t.addresses=[]);const s=function(m,g){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(I=>{let{ip:A,port:k}=I;return{address:"".concat(A,":").concat(k)}});const E=oe("GATEWAY_DOMAINS");let b=E[1]&&tt(g).call(g,E[1])?1:0;return m.map(I=>{let{domain_prefix:A,port:k,ip:G}=I;if(A)return{address:"".concat(A,".").concat(E[b++%E.length],":").concat(k)};const j=/^[\.\:\d]+$/.test(G),B=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[b++%E.length],":").concat(k):"".concat(G,":").concat(k);return j||L.debug("Cannot recognized as ip address: ".concat(G,", use as host3")),{ip:G,port:k,address:B}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let g=0;g<m.length;g++){var c;const E=Do(c=m[g]).call(c);s[g]&&E&&(s[g].ip6=E)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,g]=d.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Pc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function _H(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Pc(r.width),"x").concat(Pc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function yH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function uT(t,r){let s,a,c;switch(r){case Ri.CHOOSE_SERVER:a=4096,c="choose server";break;case Ri.CLOUD_PROXY:a=1048576,c="proxy";break;case Ri.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Ri.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Oe(ee.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>GP(GP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:GP(GP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Oe(ee.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function EH(t,r){return await gt.all(t.addresses.map(async s=>({address:Ym(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Bs.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await FL(r.toString()):Bs.password})))}function F2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Pc(t.height),Pc(t.width)),1):(L.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xm(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=d}return m}function uy(t){const r=t.split(":"),s=t.split(/[-.]/),a=tt(t).call(t,"-")?"-":".";let c=t;return r.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+r[r.length-1]):c=r.length>2?r[0]+a+"**:"+r[r.length-1]:"**:"+r[r.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function $P(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in vP}(t)?t:vP.L1T3}const vH={[Et.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Et.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function KP(t,r,s){r.forEach(a=>{var c;const d=vH[t].find(m=>{var g;let{key:E}=m;return tt(g=a.extensionName).call(g,E)});if(!d)return;const h=s.find(m=>{let{extensionName:g}=m;return tt(g).call(g,d.key)});h&&tt(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function cS(t,r){r.forEach(s=>{var a;const c=vH[t].find(d=>{var h;let{key:m}=d;return tt(h=s.extensionName).call(h,m)});tt(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function SH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||tt(t).call(t,"abs-send-time")}function qP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||tt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function bH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function wH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function dT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:E,unsupportedVideoDownlinkCodec:b}=r,{useXR:I}=s;let A=[],k=[],G=[],j=[],B=!1,Z=!1;if(Za(t).mediaDescriptions.forEach(ae=>{a&&a!==ae.attributes.direction||(ae.media.mediaType!=="video"||B||(k=ae.attributes.payloads,j=ae.attributes.extmaps,B=!0),ae.media.mediaType!=="audio"||Z||(A=ae.attributes.payloads,G=ae.attributes.extmaps,Z=!0))}),!j||k.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!G||A.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(k.forEach(ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})}),A.forEach(ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})}),c&&(A=A.filter(ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"}),k=k.filter(ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"})),d){const ae=k.filter(ue=>{var Ie;return/(red)|(ulpfec)|(flexfec)/i.test(((Ie=ue.rtpMap)===null||Ie===void 0?void 0:Ie.encodingName)||"")}),ye=Qm(ae,k).map(ue=>ue.payloadType),_e=[...ae.map(ue=>ue.payloadType),...ye];k=k.filter(ue=>!tt(_e).call(_e,ue.payloadType))}if(h&&(A=A.filter(ae=>{var ye;return!/(red)|(ulpfec)|(flexfec)/i.test(((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(A=A.filter(ae=>{var ye;return tt(m).call(m,((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0){const ae=k.filter(ye=>{var _e;return tt(g).call(g,((_e=ye.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"")});k=ae.concat(c?[]:Qm(ae,k))}const Q=oe("UNSUPPORTED_VIDEO_CODEC");if(Q&&Q.length>0){const ae=k.filter(ue=>ue.rtpMap&&tt(Q).call(Q,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(ae,k),_e=ae.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!tt(_e).call(_e,ue.payloadType)),L.debug("unsupportedVideoCodec: ".concat(Q,", toBeRemoved: ").concat(_e))}if(E&&E.length>0&&a==="sendonly"){const ae=k.filter(ue=>ue.rtpMap&&tt(E).call(E,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(ae,k),_e=ae.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!tt(_e).call(_e,ue.payloadType)),L.debug("unsupportedVideoUplinkCodec: ".concat(E,", toBeRemoved: ").concat(_e))}if(b&&b.length>0&&a==="recvonly"){const ae=k.filter(ue=>ue.rtpMap&&tt(b).call(b,ue.rtpMap.encodingName.toLowerCase())),ye=Qm(ae,k),_e=ae.concat(ye).map(ue=>ue.payloadType);k=k.filter(ue=>!tt(_e).call(_e,ue.payloadType)),L.debug("unsupportedVideoDownlinkCodec: ".concat(b,", toBeRemoved: ").concat(_e))}return{audioCodecs:A,videoCodecs:k,audioExtensions:G,videoExtensions:j}}function Jm(t){const r=Za(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function TH(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const g=(m=a.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?g:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function CH(t,r,s){const{cname:a}=t;let c=[];r&&(c=RH(r)),c.length===0&&(c=t.iceParameters.candidates.map(b=>({foundation:b.foundation,componentId:"1",transport:b.protocol,priority:b.priority.toString(),connectionAddress:b.ip,port:b.port.toString(),type:b.type,extension:{}})),L.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(b=>({hashFunction:b.algorithm,fingerprint:b.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=XP(t.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(b=>{E.push({kind:Et.VIDEO,ssrcMsg:[{ssrcId:b.v,rtx:b.v_rtx}],mslabel:"".concat(b.v,"_").concat(b.a)},{kind:Et.AUDIO,ssrcMsg:[{ssrcId:b.a}],mslabel:"".concat(b.v,"_").concat(b.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:a,preSSRCs:E}}function RH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],L.debug("Using remote candidate from AP ".concat(uy(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),L.debug("Using IPV6 remote candidate from AP ".concat(uy(t.ip6),":").concat(t.port)))),r}function hT(t,r,s){const a=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const g=Er(8,"track-"),E={ssrcId:h,attributes:wH({label:g,mslabel:s=s||Er(10,""),msid:"".concat(s," ").concat(g)},r&&{cname:r})};if(a.push(E),m!==void 0){const b={ssrcId:m,attributes:wH({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},r&&{cname:r})};a.push(b),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function lS(t,r){r instanceof ai&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof oe("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=oe("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!ei()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),r instanceof iT&&c==="opus"&&r._config.DTX&&(s.fmtp.parameters.usedtx="1"))})}function j2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function B2(t,r){var s;if(!(r instanceof Nr&&r._encoderConfig&&r._hints.indexOf(_r.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Fn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;tt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Fn().supportMinBitrate&&!tt(s=r._hints).call(s,_r.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;tt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function IH(t){if(t.media.mediaType!=="video")return;const r=xn();if(r.name!==Hn.SAFARI&&r.os!==ss.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function YP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find(h=>qP(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(g=>qP(g.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(g,E){return E.filter(b=>!!g.find(I=>I.payloadType===b.payloadType&&!!I.rtcpFeedbacks.find(A=>A.type==="transport-cc")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="transport-cc")||g.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>qP(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=a.find(h=>SH(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(g=>g.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(g,E){return E.filter(b=>!!g.find(I=>I.payloadType===b.payloadType&&!!I.rtcpFeedbacks.find(A=>A.type==="goog-remb")))}(c,t.attributes.payloads).forEach(g=>{g.rtcpFeedbacks.find(E=>E.type==="goog-remb")||g.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>SH(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(g=>g.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function AH(t,r,s){if(ei()||t.media.mediaType!=="video"||!(r instanceof Nr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Kr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:Kr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function PH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const b=dT(E,m,g,"sendonly"),I=dT(E,m,g,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(b,I,"videoExtensions",A,k,G),Bu(b,I,"videoCodecs",A,k,G),Bu(b,I,"audioExtensions",A,k,G),Bu(b,I,"audioCodecs",A,k,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=[],B=[];if(G.videoCodecs.forEach((Z,Q)=>{var ae;if(((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var ye,_e;const ue=G.videoCodecs[Q+1],Ie=ue&&DH(Z,ue),Ue=(ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],We=(_e=Z.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!Ue||Ue!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&We!==oe("FIRST_PACKETIZATION_MODE")?Ie?B.push([Z,ue]):B.push([Z]):Ie?j.push([Z,ue]):j.push([Z])}}),j.length>0&&B.length>0){L.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Q,ae)=>{var ye;if(((ye=Q.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLocaleLowerCase())==="h264"){const _e=DH(Q,G.videoCodecs[ae+1]),ue=j.shift()||B.shift()||[];ue.length>0&&(_e?G.videoCodecs.splice(ae,2,...ue):G.videoCodecs.splice(ae,1,...ue))}});const Z=k.videoCodecs.filter(Q=>{var ae,ye;return((ae=Q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID")});if(Z.length>0){const Q=Qm(Z,k.videoCodecs).map(ye=>ye.payloadType),ae=[...Z.map(ye=>ye.payloadType),...Q];k.videoCodecs=k.videoCodecs.filter(ye=>!tt(ae).call(ae,ye.payloadType))}oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(Q=>{var ae,ye;return!(((ae=Q.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:A,recv:k,sendrecv:G}}return{send:A,recv:k,sendrecv:G}}(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function kH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=dT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(t,r,"videoExtensions",s,a,c),Bu(t,r,"videoCodecs",s,a,c),Bu(t,r,"audioExtensions",s,a,c),Bu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){L.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function Bu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((g,E)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(E),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((g,E)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(E),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)})}}function XP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function uS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function pT(t,r,s,a){let c=[];if(t===Et.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return tt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],g=[];if(s.videoCodecs.forEach(E=>{const b=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";tt(b).call(b,a)?d.push(E):tt(b).call(b,"vp9")?h.push(E):tt(b).call(b,"vp8")?m.push(E):tt(b).call(b,"h264")&&g.push(E)}),d.length===0){let E="";h.length!==0?(d=h,E="vp9"):m.length!==0?(d=m,E="vp8"):g.length!==0&&(d=g,E="h264"),L.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}d.length!==0&&(c=r.videoCodecs.filter(E=>d.some(b=>b.payloadType===E.payloadType)))}if(c.length===0&&(L.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const d=Qm(c,r.videoCodecs);c=[...c,...d]}}else{c=r.audioCodecs.filter(h=>{var m;return tt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,a)});const d=r.audioCodecs.filter(h=>{var m;return tt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")});c.length===0&&(L.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(h=>{var m;return tt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")})),oe("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function Qm(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&tt(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function Zm(t,r,s){const a=r.toString(),c=NH(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=OH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function OH(t,r,s){const a=Za(t),{useXR:c}=r;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!tt(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&uS(d),c&&tt(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Hm(a)}function NH(t,r,s,a){if(oe("SDP_LOGGING"))return L.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{NH(c,"answer",s==="local"?"remote":"local",a)}:void 0}function xH(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>tt(t).call(t,s))}function DH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function LH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function al(t,r){return typeof oe(t)===r?oe(t):void 0}function l_e(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?LH(Object(a),!0).forEach(function(c){Y(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):LH(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return L.debug("handle gateway attributes failed: ",t),{}}}const MH={};function eg(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&L.debug("install service ".concat(t.name)),MH[t.name]=t}function _f(t){const r=MH[t];if(!r)throw new Le(ee.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function UH(t,r){return _f("DataStream").create(t,r)}function JP(){return _f("InterceptFrame").create()}function VH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function So(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const z2=new Map;class u_e extends Jr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ms.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ms.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){L.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"key",void 0),Y(this,"ntpOffset",0),Y(this,"signal",void 0),Y(this,"role",void 0),Y(this,"isPreallocation",void 0),Y(this,"isPreSub",void 0),Y(this,"inChannelInfo",{joinAt:null,duration:0}),Y(this,"spec",void 0),Y(this,"_state","DISCONNECTED"),Y(this,"_statsCollector",void 0),Y(this,"_disconnectedReason",void 0),Y(this,"isSignalRecover",!1),Y(this,"hasChangeBGPAddress",!1),Y(this,"trafficStatsInterval",void 0),Y(this,"networkQualityInterval",void 0),Y(this,"_joinGatewayStartTime",0),Y(this,"_signalTimeout",!1),Y(this,"_clientRoleOptions",void 0),Y(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:So(So({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=_f("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new a_e(So(So({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=z2.get(r.cname);if(d||(d=new Map,z2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const E=new Oe(ee.UID_CONFLICT);throw Pt.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{L.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(b=>{let{address:I}=b;const[A,k]=I.split(":"),G={host:A,port:k};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(E)).uid,L.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var g;throw L.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),Pt.joinGateway(r.sid,{lts:c,succ:!1,ec:((g=E.data)===null||g===void 0?void 0:g.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),L.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{L.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ms.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ms.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ms.NETWORK_QUALITY,{uplinkNetworkQuality:yH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yH(this._statsCollector.trafficStats.B_dnq)}):this.emit(ms.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==rr.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Ar.CONNECTED||await function(a,c){return c===1/0?a:gt.race([a,Lme(c)])}(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(a){L.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==rr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===zt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===zt.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){L.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(r.map(s=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){L.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===zt.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(Yt.SET_VIDEO_PROFILE,s);L.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){L.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await gt.all(r.map(a=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){L.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){L.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Yt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(Yt.SET_CLIENT_ROLE,So(So({role:r,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),So({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=z2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Bs.username,password:Bs.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(So(So({},Bs),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&gP(()=>{this.emit(ms.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var s,a;if(!this.joinInfo||!this.key)throw new Oe(ee.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let d=oe("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ms.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,tt(rS).call(rS,h)||rS.push(h);const m=r2(this.store),g=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),E=BW(this.store),b=l_e(),I=Vv(87)||X8()||OL(117),A=(function(){const G=xn();if(G.name!==Hn.SAFARI||!G.browserVersion)return!1;const j=G.browserVersion.split(".");return Number(j[0])>18||Number(j[0])===18&&Number(j[1])>=4}()||eW(18,4,!1))&&NL(18,6,!0)&&this.spec.codec==="h264"&&oe("ENABLE_ABSSENDTIME_AS_SENTTS"),k=So({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:So(So({enableEncodedTransform:(!!oe("ENABLE_AUDIO_METADATA")||!!oe("ENABLE_AUDIO_PTS"))&&I||!!oe("ENABLE_AUDIO_TOPN")&&PL(Hn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&I,enableAudioPts:!!oe("ENABLE_AUDIO_PTS")&&I,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:al("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:al("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:al("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:al("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("FORCE_ENABLE_AUT_CC")||!wP()&&(!!oe("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:al("USE_XR","boolean"),enableLossbasedBwe:al("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("FORCE_ENABLE_AUT_CC")||!wP()&&(!!oe("ENABLE_AUT_CC")||void 0),enableCCFallback:al("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?al("PRE_SUB_NUM","number"):void 0,enablePubTWCC:al("PUBLISH_TWCC","boolean"),enableSubTWCC:al("SUBSCRIBE_TWCC","boolean"),enablePubRTX:al("USE_PUB_RTX","boolean"),enableSubRTX:al("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},b),{},{audioDuplicate:al("ENABLE_AUDIO_RED","boolean")?(a=al("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!A||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(k.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(k.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(k.aes_secret=this.joinInfo.aespassword,k.aes_encrypt=!0):k.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(k.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(k.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(k.default_video_stream=this.joinInfo.defaultVideoStream),k}getRejoinMessage(){if(!this.joinInfo)throw new Oe(ee.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Qt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Qt.WS_RECONNECTING,r=>{this.joinInfo&&Pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Fs.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Pt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Qt.WS_CLOSED,r=>{let s;switch(r){case rr.LEAVE:s=Fs.LEAVE;break;case rr.UID_BANNED:case rr.IP_BANNED:case rr.CHANNEL_BANNED:case rr.SERVER_ERROR:s=Fs.SERVER_ERROR;break;case rr.FALLBACK:s=Fs.FALLBACK;break;case rr.LICENSE_MISSING:case rr.LICENSE_EXPIRED:case rr.LICENSE_MINUTES_EXCEEDED:case rr.LICENSE_PERIOD_INVALID:case rr.LICENSE_MULTIPLE_SDK_SERVICE:case rr.LICENSE_ILLEGAL:case rr.TOKEN_EXPIRE:s=r;break;default:s=Fs.NETWORK_ERROR}L.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Fs.NETWORK_ERROR)),this.joinInfo&&Pt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===rr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==rr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Qt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(L.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void L.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));hr("EVENT_REPORT_DOMAIN",r[1]),hr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),hr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(Rn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Qt.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Oe(ee.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,js(this,ms.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Qt.REQUEST_JOIN_INFO,async(r,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=Kr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&m&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let A=m.servers.map(j=>"turnServerURL"in j&&oe("USE_TURN_IP")?So(So({},j),{},{turnServerURL:HP(j.turnServerURL)}):j),k=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map(j=>oe("USE_TURN_IP")?So(So({},j),{},{turnServerURL:HP(j.turnServerURL)}):j);const G=this.signal.currentURLIndex;A.length>0&&(A=[A[G%A.length]],m.servers=A),Array.isArray(k)&&k.length>0&&(k=[k[0]],m.serversFromGateway=k),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(G))}const{iceParameters:E,dtlsParameters:b,rtpCapabilities:I}=await js(this,ms.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:E,dtlsParameters:b,rtpCapabilities:I,version:"2"}}))}catch(A){s(A)}}),this.signal.on(Qt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Qt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof Oe?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,Pt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Qt.IS_P2P_DISCONNECTED,r=>{r(Jw(this,ms.IS_P2P_DISCONNECTED))}),this.signal.on(Qt.DISCONNECT_P2P,()=>{this.emit(ms.DISCONNECT_P2P)}),this.signal.on(Qt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Qt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Qt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(ms.JOIN_RESPONSE,r,s)}),this.signal.on(Qt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var r,s;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),d=Kr((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(oe("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let m=d.servers.map(b=>"turnServerURL"in b&&oe("USE_TURN_IP")?So(So({},b),{},{turnServerURL:HP(b.turnServerURL)}):b),g=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map(b=>oe("USE_TURN_IP")?So(So({},b),{},{turnServerURL:HP(b.turnServerURL)}):b);const E=this.signal.currentURLIndex;m.length>0&&(m=[m[E%m.length]],d.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}const h=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const m=RH(c);this.emit(ms.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:d})}}}),this.signal.on(Qt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw L.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw L.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw L.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw L.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw L.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===or.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===or.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===Et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===Et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Yt.RESTART_ICE,s,!0)}catch(a){throw L.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Fs.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(L.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let QP=0,W2=0;function $d(t,r,s,a){return new gt((c,d)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),QP+=qh(r.data)):s&&(r.data.size?QP+=r.data.size:r.data instanceof FormData?QP+=gW(r.data):QP+=qh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ia.request(r).then(h=>{typeof h.data=="string"?W2+=qh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?W2+=h.data.byteLength:W2+=qh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Ia.isCancel(h)?d(new Oe(ee.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Oe(ee.NETWORK_TIMEOUT,h.message)):h.response?d(new Oe(ee.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Oe(ee.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ze){var rt=0;return function(){return rt<ze.length?{done:!1,value:ze[rt++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,rt,St){return ze==Array.prototype||ze==Object.prototype||(ze[rt]=St.value),ze},a,c=function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var rt=0;rt<ze.length;++rt){var St=ze[rt];if(St&&St.Math==Math)return St}throw Error("Cannot find global object")}(this);function d(ze,rt){if(rt)e:{var St=c;ze=ze.split(".");for(var He=0;He<ze.length-1;He++){var U=ze[He];if(!(U in St))break e;St=St[U]}(rt=rt(He=St[ze=ze[ze.length-1]]))!=He&&rt!=null&&s(St,ze,{configurable:!0,writable:!0,value:rt})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var rt=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return rt?rt.call(ze):{next:r(ze)}}if(d("Symbol",function(ze){function rt(U,le){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:le})}if(ze)return ze;rt.prototype.toString=function(){return this.A};var St="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function U(le){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new rt(St+(le||"")+"_"+He++,le)}}),d("Symbol.iterator",function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var rt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),St=0;St<rt.length;St++){var He=c[rt[St]];typeof He=="function"&&typeof He.prototype[ze]!="function"&&s(He.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var E={};try{E.__proto__={a:!0},g=E.a;break e}catch{}g=!1}a=g?function(ze,rt){if(ze.__proto__=rt,ze.__proto__!==rt)throw new TypeError(ze+" is not extensible");return ze}:null}var b=a;function I(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function k(ze,rt){return ze.h=3,{value:rt}}function G(ze){this.g=new I,this.G=ze}function j(ze,rt,St,He){try{var U=rt.call(ze.g.j,St);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return ze.g.m=!1,U;var le=U.value}catch(me){return ze.g.j=null,ze.g.s(me),B(ze)}return ze.g.j=null,He.call(ze.g,le),B(ze)}function B(ze){for(;ze.g.h;)try{var rt=ze.G(ze.g);if(rt)return ze.g.m=!1,{value:rt.value,done:!1}}catch(St){ze.g.v=void 0,ze.g.s(St)}if(ze.g.m=!1,ze.g.l){if(rt=ze.g.l,ze.g.l=null,rt.F)throw rt.D;return{value:rt.return,done:!0}}return{value:void 0,done:!0}}function Z(ze){this.next=function(rt){return ze.o(rt)},this.throw=function(rt){return ze.s(rt)},this.return=function(rt){return function(St,He){A(St.g);var U=St.g.j;return U?j(St,"return"in U?U.return:function(le){return{value:le,done:!0}},He,St.g.return):(St.g.return(He),B(St))}(ze,rt)},this[Symbol.iterator]=function(){return this}}function Q(ze,rt){return rt=new Z(new G(rt)),b&&ze.prototype&&b(rt,ze.prototype),rt}if(I.prototype.o=function(ze){this.v=ze},I.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},I.prototype.return=function(ze){this.l={return:ze},this.h=this.u},G.prototype.o=function(ze){return A(this.g),this.g.j?j(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),B(this))},G.prototype.s=function(ze){return A(this.g),this.g.j?j(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),B(this))},d("Array.prototype.entries",function(ze){return ze||function(){return function(rt,St){rt instanceof String&&(rt+="");var He=0,U=!1,le={next:function(){if(!U&&He<rt.length){var me=He++;return{value:St(me,rt[me]),done:!1}}return U=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(rt,St){return[rt,St]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ze,rt){for(var St=0;St<ze.length;St++)rt(ze[St])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},_e=function(ze,rt,St){return rt instanceof Blob?(St=St!==void 0?St+"":typeof rt.name=="string"?rt.name:"blob",rt.name===St&&Object.prototype.toString.call(rt)!=="[object Blob]"||(rt=new File([rt],St)),[String(ze),rt]):[String(ze),String(rt)]},ue=function(ze,rt){if(ze.length<rt)throw new TypeError(rt+" argument required, but only "+ze.length+" present.")},Ie=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Ie.FormData,We=Ie.XMLHttpRequest&&Ie.XMLHttpRequest.prototype.send,Qe=Ie.Request&&Ie.fetch,fn=Ie.navigator&&Ie.navigator.sendBeacon,vn=Ie.Element&&Ie.Element.prototype,Jt=Ie.Symbol&&Symbol.toStringTag;Jt&&(Blob.prototype[Jt]||(Blob.prototype[Jt]="Blob"),"File"in Ie&&!File.prototype[Jt]&&(File.prototype[Jt]="File"));try{new File([],"")}catch{Ie.File=function(rt,St,He){return rt=new Blob(rt,He||{}),Object.defineProperties(rt,{name:{value:St},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Jt&&Object.defineProperty(rt,Jt,{value:"File"}),rt}}var nr=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},qn=function(ze){this.i=[];var rt=this;ze&&ae(ze.elements,function(St){if(St.name&&!St.disabled&&St.type!=="submit"&&St.type!=="button"&&!St.matches("form fieldset[disabled] *"))if(St.type==="file"){var He=St.files&&St.files.length?St.files:[new File([],"",{type:"application/octet-stream"})];ae(He,function(U){rt.append(St.name,U)})}else St.type==="select-multiple"||St.type==="select-one"?ae(St.options,function(U){!U.disabled&&U.selected&&rt.append(St.name,U.value)}):St.type==="checkbox"||St.type==="radio"?St.checked&&rt.append(St.name,St.value):(He=St.type==="textarea"?ye(St.value):St.value,rt.append(St.name,He))})};if((t=qn.prototype).append=function(ze,rt,St){ue(arguments,2),this.i.push(_e(ze,rt,St))},t.delete=function(ze){ue(arguments,1);var rt=[];ze=String(ze),ae(this.i,function(St){St[0]!==ze&&rt.push(St)}),this.i=rt},t.entries=function ze(){var rt,St=this;return Q(ze,function(He){if(He.h==1&&(rt=0),He.h!=3)return rt<St.i.length?He=k(He,St.i[rt]):(He.h=0,He=void 0),He;rt++,He.h=2})},t.forEach=function(ze,rt){ue(arguments,1);for(var St=m(this),He=St.next();!He.done;He=St.next()){var U=m(He.value);He=U.next().value,U=U.next().value,ze.call(rt,U,He,this)}},t.get=function(ze){ue(arguments,1);var rt=this.i;ze=String(ze);for(var St=0;St<rt.length;St++)if(rt[St][0]===ze)return rt[St][1];return null},t.getAll=function(ze){ue(arguments,1);var rt=[];return ze=String(ze),ae(this.i,function(St){St[0]===ze&&rt.push(St[1])}),rt},t.has=function(ze){ue(arguments,1),ze=String(ze);for(var rt=0;rt<this.i.length;rt++)if(this.i[rt][0]===ze)return!0;return!1},t.keys=function ze(){var rt,St,He,U,le=this;return Q(ze,function(me){if(me.h==1&&(rt=m(le),St=rt.next()),me.h!=3)return St.done?void(me.h=0):(He=St.value,U=m(He),k(me,U.next().value));St=rt.next(),me.h=2})},t.set=function(ze,rt,St){ue(arguments,2),ze=String(ze);var He=[],U=_e(ze,rt,St),le=!0;ae(this.i,function(me){me[0]===ze?le&&(le=!He.push(U)):He.push(me)}),le&&He.push(U),this.i=He},t.values=function ze(){var rt,St,He,U,le=this;return Q(ze,function(me){if(me.h==1&&(rt=m(le),St=rt.next()),me.h!=3)return St.done?void(me.h=0):(He=St.value,(U=m(He)).next(),k(me,U.next().value));St=rt.next(),me.h=2})},qn.prototype._asNative=function(){for(var ze=new Ue,rt=m(this),St=rt.next();!St.done;St=rt.next()){var He=m(St.value);St=He.next().value,He=He.next().value,ze.append(St,He)}return ze},qn.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),rt=[],St="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,U){return typeof He=="string"?rt.push(St+nr(ye(U))+`"\r
\r
`+ye(He)+`\r
`):rt.push(St+nr(ye(U))+'"; filename="'+nr(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),rt.push("--"+ze+"--"),new Blob(rt,{type:"multipart/form-data; boundary="+ze})},qn.prototype[Symbol.iterator]=function(){return this.entries()},qn.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(ze){for(var rt=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--rt&&ze.item(rt)!==this;);return-1<rt}),Jt&&(qn.prototype[Jt]="FormData"),We){var so=Ie.XMLHttpRequest.prototype.setRequestHeader;Ie.XMLHttpRequest.prototype.setRequestHeader=function(ze,rt){so.call(this,ze,rt),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ie.XMLHttpRequest.prototype.send=function(ze){ze instanceof qn?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),We.call(this,ze)):We.call(this,ze)}}Qe&&(Ie.fetch=function(ze,rt){return rt&&rt.body&&rt.body instanceof qn&&(rt.body=rt.body._blob()),Qe.call(this,ze,rt)}),fn&&(Ie.navigator.sendBeacon=function(ze,rt){return rt instanceof qn&&(rt=rt._asNative()),fn.call(this,ze,rt)}),Ie.FormData=qn}})();const fT=()=>{const t=oe("AREAS");return t.length===0&&t.push(Jn.GLOBAL),Ka(t).call(t,(r,s,a)=>{const c=FH(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},FH=t=>t===Jn.OVERSEA?"".concat(no.ASIA,",").concat(no.EUROPE,",").concat(no.AFRICA,",").concat(no.NORTH_AMERICA,",").concat(no.SOUTH_AMERICA,",").concat(no.OCEANIA):no[t],d_e=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=WP[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))})}),r},ZP={GLOBAL:{ASIA:[Jn.CHINA,Jn.JAPAN,Jn.INDIA,Jn.KOREA,Jn.HKMC],EUROPE:[],NORTH_AMERICA:[Jn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},e1=Object.keys(ZP[Jn.GLOBAL]),G2=[Jn.CHINA,Jn.NORTH_AMERICA,Jn.EUROPE,Jn.ASIA,Jn.JAPAN,Jn.INDIA,Jn.OCEANIA,Jn.SOUTH_AMERICA,Jn.AFRICA,Jn.KOREA,Jn.HKMC,Jn.US],h_e=function(t,r){let s=[];if(tt(t).call(t,Jn.GLOBAL)){const d=[Jn.GLOBAL,Jn.OVERSEA],h=Object.keys(WP);if(r===Jn.GLOBAL)throw new Oe(ee.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Jn.CHINA)s=[Jn.OVERSEA];else if(c=r,tt(e1).call(e1,c)){const m=(a=r,ZP[Jn.GLOBAL][a]||[]),g=[...d,r,...m];s=h.filter(E=>!tt(g).call(g,E))}else if(function(m){let g=!1;return e1.forEach(E=>{var b;tt(b=ZP[Jn.GLOBAL][E]).call(b,m)&&(g=!0)}),g}(r)){const m=function(E){let b;return e1.forEach(I=>{var A;tt(A=ZP[Jn.GLOBAL][I]).call(A,E)&&(b=I)}),b}(r),g=[...d,m,r];s=h.filter(E=>!tt(g).call(g,E))}else s=t;s=function(m){const g=[];return G2.forEach(E=>{tt(m).call(m,E)&&g.push(E)}),g.concat(m.filter(E=>!tt(G2).call(G2,E)))}(s)}else s=t;var a,c;return s};function jH(t){var r,s;if(!t&&tt(r=oe("AREAS")).call(r,Jn.EXTENSIONS))return L.debug("update area from ap : reset"),void H2(vge,!0);if(!tt(s=oe("AREAS")).call(s,Jn.GLOBAL)||!t)return;let a=WP.EXTENSIONS;a&&(a={CODE:FH(Jn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},L.debug("update area from ap success: ".concat(t,",config is "),a),hr("AREAS",[Jn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?hr(c,a[c][0]):hr(c,a[c])}))}function H2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Pt.reportApiInvoke(null,{name:di.SET_AREA,options:t,tag:$r.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!tt(aH).call(aH,d))throw new Oe(ee.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Oe(ee.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?h_e(m,h):m}if(!r){if(zd.AREAS){const d=new Oe(ee.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void L.warning("setArea is prohibited because of config-distribute")}if(tt(a).call(a,Jn.GLOBAL)&&oe("AREAS")===Jn.EXTENSIONS){const d=new Oe(ee.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void L.warning("setArea is prohibited because of ap extensions")}}hr("AREAS",a,r);const c=d_e(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?hr(d,c[d][0]):hr(d,c[d])}),L.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function BH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ep(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?BH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):BH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let $2=1;function p_e(t,r,s,a,c){$2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:$2,requestId:$2,version:zl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,g,E=t[0];return Bd(async()=>{m=Date.now();const b=await $d(E,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,b.code!==0){const k=new Oe(ee.UNEXPECTED_RESPONSE,"live streaming ap error, code"+b.code,{retry:!0,responseTime:g});throw L.error(k.toString()),k}const I=JSON.parse(b.json_body);if(I.code!==200){const k=new Oe(ee.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(I.code,", reason: ").concat(I.reason),{code:I.code,responseTime:g});throw L.error(k.toString()),k}if(!I.servers||I.servers.length===0){const k=new Oe(ee.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:I.code,responseTime:g});throw L.error(k.toString()),k}const A=function(k,G){return{addressList:k.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:k.workerToken,vid:k.vid}}(I,r);return oe("LIVE_STREAMING_ADDRESS")&&(A.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),ep(ep({},A),{},{responseTime:g})},(b,I)=>(Pt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(b.addressList),firstSuccess:I===0,responseTime:g,serverIp:t[I%t.length]}),!1),(b,I)=>(Pt.apworkerEvent(s.sid,{success:!1,sc:b.data&&b.data.code||200,serviceName:r,responseTime:g,serverIp:t[I%t.length]}),!!(b.code!==ee.OPERATION_ABORTED&&b.code!==ee.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(E=t[(I+1)%t.length],!0)),c)}let K2=1;function zH(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,g=Date.now();let E;const b=r.role,[I,A]=Y2(r,d,[Ri.CHOOSE_SERVER]);let k=Ci.networkState;return Bd(async()=>{k&&Ci.networkState===Ac.OFFLINE&&Ci.onlineWaiter&&await gt.race([Ci.onlineWaiter,Rs(a&&a.maxRetryTimeout||Vi.maxRetryTimeout)]),k=Ci.networkState;const{data:G,headers:j}=await $d(c,{data:I,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=j.http3==="1"?1:-1,Pt.reportResourceTiming(c,m),GH(G,c,r,g,[Ri.CHOOSE_SERVER],E);const B=uT(G,Ri.CHOOSE_SERVER);return q2(B),V2(B,c)},G=>(G&&Pt.joinChooseServer(m,{role:b,lts:g,succ:!0,csAddr:c,opid:A,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==ee.OPERATION_ABORTED&&(G.code===ee.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Pt.joinChooseServer(m,{role:b,lts:g,succ:!1,csAddr:c,serverList:null,opid:A,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),L.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),a)}function WH(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const g=Date.now(),E=r.role,[b,I]=Y2(r,h,m);let A;return Bd(async()=>{A&&Ci.networkState===Ac.OFFLINE&&Ci.onlineWaiter&&await gt.race([Ci.onlineWaiter,Rs(a&&a.maxRetryTimeout||Vi.maxRetryTimeout)]),A=Ci.networkState;const{data:k,headers:G}=await $d(d,{data:b,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Pt.reportResourceTiming(d,r.sid),GH(k,d,r,g,m,c);const j=uT(k,Ri.CHOOSE_SERVER),B=uT(k,r.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK),Z=performance.getEntriesByName(d),Q=Z[Z.length-1];let ae;return Q&&(ae={name:Q.name,protocol:"nextHopProtocol"in Q?Q.nextHopProtocol:"",dnscost:"domainLookupEnd"in Q&&"domainLookupStart"in Q&&typeof Q.domainLookupEnd=="number"&&typeof Q.domainLookupStart=="number"?Q.domainLookupEnd-Q.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Q&&"connectStart"in Q&&typeof Q.connectEnd=="number"&&typeof Q.connectStart=="number"?Q.connectEnd-Q.connectStart:-1,reqCost:"requestStart"in Q&&typeof Q.requestStart=="number"&&"responseEnd"in Q&&typeof Q.responseEnd=="number"?Q.responseEnd-Q.requestStart:-1,handleCost:"leave_ts"in k&&"enter_ts"in k&&typeof k.leave_ts=="number"&&typeof k.enter_ts=="number"?k.leave_ts-k.enter_ts:-1}),q2(j),{gatewayInfo:V2(j,d),proxyInfo:B,url:d,resourceTimingInfo:ae}},k=>(k.gatewayInfo&&Pt.joinChooseServer(r.sid,{role:E,lts:g,succ:!0,csAddr:d,serverList:k.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:I,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38],resourceTimingInfo:k.resourceTimingInfo?JSON.stringify(k.resourceTimingInfo):void 0}),k.proxyInfo&&Pt.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:k.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==ee.OPERATION_ABORTED&&(k.code===ee.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(Pt.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:k.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),L.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),k),!0)),a)}const GH=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:g}=s,E=[],b=I=>{I.flag===4096?Pt.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):I.flag!==1048576&&I.flag!==4194304&&I.flag!==4194310||Pt.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:I.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach(I=>{const A=I.buffer.code;if(I.uri===23&&A===0&&!I.buffer.edges_services)if(I.buffer.flag===4194310)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),I.buffer.edges_services=[];else{const k={error:new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:I.buffer.flag};E.push(k),b(k)}if(A!==0){const k=aS(A),G={error:new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:t.detail[502]}),flag:I.buffer.flag};I.buffer.flag===4194310?L.warning(G.error.toString()):E.push(G),b(G)}}),E.length)throw L.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message,", retry: ").concat(I.error.data.retry)).join(" | "))),new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,E.map(I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message)).join(" | "),{retry:!!E.find(I=>I.error.data.retry),csIp:t.detail[502],desc:[...new Set(E.map(I=>{var A;return I==null||(A=I.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(I=>!!I))]})},q2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?jH(t.detail[23].toLowerCase()):jH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var d;const E=Do(d=m[g]).call(d);t.addresses[g]&&m&&(t.addresses[g].fingerprint=E)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){L.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var g,E;const b=(g=(E=t.addresses.find(I=>I.ip===m.ip&&I.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:b}});t.addresses=h}},f_e=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=aS(s.buffer.code);throw new Oe(ee.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw L.debug("update ticket request received ap response without response body:",r),new Oe(ee.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Y2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:ep(ep(ep({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},m_e=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let dS=0;function hS(t){return gt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const mT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let g,E=0;const b=async()=>{const I=(()=>{const A=h*m,k=A+m;return s.slice(A,k).map(a)})();d&&d.push(...I);try{g=await hS(I)}catch(A){if(E+=m,h++,!(E>=s.length))return void await b();c(A)}I.forEach(A=>A.cancel())};return await b(),g},HH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(g){if(d++,d>=c||a!=null&&a(g))throw g;return h()}};return h()};async function g_e(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new gt((g,E)=>{let b;(async function(){t&&t.state!=="closed"||await async function(){t=new VideoDecoder({output:A=>{A.close(),clearTimeout(b),g(!0)},error:A=>{clearTimeout(b),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})}();const I=[r,s,a,c,d,h];for(let A=0;A<I.length;A++){const k=new EncodedVideoChunk({type:A==0?"key":"delta",timestamp:33333*A,duration:33333,data:new Uint8Array(I[A])});try{await t.decode(k)}catch{return void g(!1)}}})(),b=setTimeout(()=>{g(!1)},5e3)})}async function X2(t,r,s,a){return{gatewayInfo:await async function(d,h,m,g){let E=null;const b=[],I=async()=>{const k=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:fT()})),G=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await mT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(L.debug("[".concat(d.clientId,"] Connect to choose_server:"),B.url),zH(B,d,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},A=async()=>{if(await Rs(1e3),E!==null)return E;const k=oe("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:fT()})),G=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await mT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(L.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),B.url),zH(B,d,h,m)),allFailedhandler:B=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:b});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return E=await hS([I(),A()]),b.length&&b.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),E}catch(k){throw k[0]}}(t,r,s,a)}}async function $H(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await X2(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:k}=await YH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:A};const G=k.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Bs.tcpport,udpport:j.udpport||Bs.udpport,username:j.username||Bs.username,password:j.password||Bs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:A.uid,B="glb:".concat(j.toString()),Z=await FL(B),Q=k.map(ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||Bs.tcpport,udpport:ae.udpport||Bs.udpport,username:B,password:Z,forceturn:!1,security:!0}));G.push(...Q)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:A}}return await X2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:g}=await YH(t,r,s,c),E={gatewayInfo:g},b=m.map(A=>({turnServerURL:A.address,tcpport:d==="proxy3"?void 0:A.tcpport?A.tcpport:Bs.tcpport,udpport:d==="proxy4"?void 0:A.udpport?A.udpport:Bs.udpport,username:A.username||Bs.username,password:A.password||Bs.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var I;const A=(I=t.uid)!==null&&I!==void 0?I:g.uid,k="glb:".concat(A.toString()),G=await FL(k),j=m.map(B=>({turnServerURL:B.address,tcpport:d==="proxy3"?void 0:B.tcpport||Bs.tcpport,udpport:d==="proxy4"?void 0:B.udpport||Bs.udpport,username:k,password:G,forceturn:d!=="proxy4",security:d==="proxy5"}));b.push(...j)}return t.turnServer={mode:"manual",servers:b},L.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),E}async function KH(t,r,s,a,c){const d=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1")):d.map(g=>"https://".concat(g,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await async function(E,b,I,A,k){const G=Date.now(),j={sid:I.sid,opid:10,appid:I.appId,string_uid:b};let B=E[0];const Z=await Bd(()=>$d(B+"".concat(B.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Q,ae)=>{if(Q.code===0){if(Q.uid<=0||Q.uid>=Math.pow(2,32))throw L.error("Invalid Uint Uid ".concat(b," => ").concat(Q.uid),Q),Pt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:Q.uid,errorCode:ee.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Oe(ee.INVALID_UINT_UID_FROM_STRING_UID);return Pt.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:B,stringUid:j.string_uid,uid:Q.uid,errorCode:null,extend:j}),!1}const ye=aS(Q.code);return ye.retry&&(B=E[(ae+1)%E.length]),Pt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:Q.uid,errorCode:ye.desc,extend:j}),ye.retry},(Q,ae)=>Q.code!==ee.OPERATION_ABORTED&&(Pt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:null,errorCode:Q.code,extend:j}),B=E[(ae+1)%E.length],!0),k);if(Z.code!==0){const Q=aS(Z.code);throw new Oe(ee.UNEXPECTED_RESPONSE,Q.desc)}return Z}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function __e(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await HH({referenceList:c,asyncMapHandler:h=>async function(m,g,E,b){const I=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:g};try{const k=await $d(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const G=aS(k.code);throw new Oe(ee.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(ee.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:I,url:m,req:A,uid:k.uid,elapse:Date.now()-I}}catch(k){throw k}}(h,t,r,s),closeFn:h=>h.code===ee.OPERATION_ABORTED||h.code===ee.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function y_e(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config")),c=a.map(g=>function(E,b,I,A){const k=xn(),G={flag:64,cipher_method:0,features:ep(ep(ep(ep(ep({install_id:XL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:b.appId,version:zl,cname:b.cname,session_id:b.sid,proxyServer:b.proxyServer,sdk_type:c_e.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:b.cname},b.stringUid&&{string_uid:b.stringUid}),b.uid&&{uid:b.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return Bd(()=>$d(E,{data:G,timeout:1e3,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==ee.OPERATION_ABORTED,A)}(g,t,r,s));let d=null,h=null,m={};try{d=await hS(c)}catch(g){if(g.code===ee.OPERATION_ABORTED)throw g;h=g}if(c.forEach(g=>g.cancel()),Pt.reportApiInvoke(t.sid,{name:di.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(g){if(!g.test_tags)return{};const E=g.test_tags,b=Object.keys(E),I={};return b.forEach(A=>{var k;const G=Do(k=A.slice(4)).call(k),j=JSON.parse(E[A]),B=j[1];I[G]={tag:j[0]||"",value:B}}),I}(d)}catch{}return m}async function qH(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:fT(),serviceIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK]}));try{return await HH({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let g,{url:E,areaCode:b,serviceIds:I}=d;const A=Date.now(),[k,G]=Y2(h,b,I);let j=Ci.networkState;try{j&&Ci.networkState===Ac.OFFLINE&&Ci.onlineWaiter&&await gt.race([Ci.onlineWaiter,Rs(Vi.maxRetryTimeout)]),j=Ci.networkState;const{data:B,headers:Z}=await $d(E,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=Z.http3==="1"?1:-1,(_e=>{const ue=[];if(_e.response_body.forEach(Ie=>{const Ue=Ie.buffer.code;if(Ie.uri===23&&Ue===0&&!Ie.buffer.edges_services)if(Ie.buffer.flag===4194310)Ie.buffer.edges_services=[];else{const We={error:new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ie.buffer.flag};ue.push(We)}if(Ue!==0){const We=aS(Ue),Qe={error:new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,We.desc,{desc:We.desc,retry:We.retry,csIp:_e.detail[502]}),flag:Ie.buffer.flag};Ie.buffer.flag===4194310?L.warning(Qe.error.toString()):ue.push(Qe)}}),ue.length)throw new Oe(ee.CAN_NOT_GET_GATEWAY_SERVER,ue.map(Ie=>"flag: ".concat(Ie.flag,", message: ").concat(Ie.error.message)).join(" | "),{retry:!!ue.find(Ie=>Ie.error.data.retry),csIp:_e.detail[502],desc:[...new Set(ue.map(Ie=>{var Ue;return Ie==null||(Ue=Ie.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc}).filter(Ie=>!!Ie))]})})(B);const ae=uT(B,Ri.CHOOSE_SERVER),ye=uT(B,Ri.CLOUD_PROXY_FALLBACK);return q2(ae),{gatewayInfo:V2(ae,E),proxyInfo:ye,opid:G,requestTime:A,url:E,isHttp3:g,elapse:Date.now()-A}}catch(B){throw B}}(c,t,r),closeFn:c=>c.code===ee.OPERATION_ABORTED||c.code===ee.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function YH(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),d=(k,G,j)=>{let B=j||c;return Array.isArray(B)&&(B=G%2==0&&c[1]||c[0]),"https://".concat(B,"/ap/?url=").concat(k)};let h=null;const m=[],g=async()=>{const k=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((B,Z)=>{let Q;return Q=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z),{url:Q,areaCode:fT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await mT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(L.debug("[".concat(t.clientId,"] Connect to choose_server:"),B.url),WH(B,t,r,s)),allFailedhandler:B=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},E=async()=>{if(await Rs(1e3),h!==null)return h;const k=oe("WEBCS_DOMAIN_BACKUP_LIST").map((B,Z)=>{let Q;return Q=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):d("".concat(B,"/api/v2/transpond/webrtc?v=2"),Z),{url:Q,areaCode:fT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(B=>B.url)}),j=await mT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:B=>(L.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),B.url),WH(B,t,r,s)),allFailedhandler:B=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let b,I,A;try{({gatewayInfo:b,proxyInfo:I,url:A}=await hS([g(),E()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!b||!I)throw new Oe(ee.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=A,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];tt(c).call(c,k)&&(t.proxyServer=k,L.setProxyServer(k),Pt.setProxyServer(k))}return h={gatewayInfo:b,proxyInfo:await EH(I,b.uid)},h}async function E_e(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,m,g,E){const b={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:zl,cname:m.cname,uid:m.uid.toString(),requestId:K2,seq:K2};K2+=1;const I={service_name:"tele_channel",json_body:JSON.stringify(b)};return Bd(async()=>{const A=await $d(h,{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const G=new Oe(ee.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw L.error(G.toString()),G}const k=JSON.parse(A.json_body);if(k.code!==200){const G=new Oe(ee.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw L.error(G.toString()),G}if(!k.servers||k.servers.length===0){const G=new Oe(ee.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw L.error(G.toString()),G}return{vid:k.vid,workerToken:k.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,A=>!!(A.code!==ee.OPERATION_ABORTED&&A.code!==ee.UNEXPECTED_RESPONSE||A.data&&A.data.retry),E)}(d,t,r,s));try{const d=await hS(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function v_e(t,r,s){let a=null;const c=[],d=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2"));return h&&(await Rs(1e3),a!==null)?a:await mT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(L.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),function(E,b,I,A){const[k]=m_e(b,[Ri.CHOOSE_SERVER]);let G=Ci.networkState;return Bd(async()=>{G&&Ci.networkState===Ac.OFFLINE&&Ci.onlineWaiter&&await gt.race([Ci.onlineWaiter,Rs(A&&A.maxRetryTimeout||Vi.maxRetryTimeout)]),G=Ci.networkState;const j=await $d(E,{data:k,cancelToken:I,headers:{"Content-Type":"multipart/form-data;"}},!0);return f_e(j,E)},()=>!1,j=>j.code!==ee.OPERATION_ABORTED&&(j.code===ee.UPDATE_TICKET_FAILED?j.data.retry:(L.warning("[".concat(b.clientId,"] update ticket network error, retry"),j),!0)),A)}(g,t,r,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return a=await hS([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function XH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function J2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class S_e extends Jr{get isSuccess(){return!!this.configs}constructor(r,s){super(),Y(this,"configs",void 0),Y(this,"store",void 0),Y(this,"joinInfo",void 0),Y(this,"cancelToken",void 0),Y(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Y(this,"interval",void 0),Y(this,"mutex",void 0),Y(this,"mutableParamsRead",!1),Y(this,"configCache",{}),Y(this,"limit_bitrate",void 0),this.mutex=new eo("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Pt.reportApiInvoke(null,{options:void 0,name:di.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:$r.TRACER}).onSuccess(JSON.stringify(zd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void L.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await y_e(this.joinInfo,this.cancelToken,this.retryConfig),L.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var d;const h=G_(d=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(d);for(let E=0;E<h.length;E++)for(let b=h.length-1;b>E;b--){const I=h[b],A=c[I].value;if(typeof A.__priority=="number"){const k=A.__priority,G=h[b-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(k>j.__priority))continue;{const B=I;h[b]=h[b-1],h[b-1]=B}}else{const B=I;h[b]=h[b-1],h[b-1]=B}}}const m=Date.now();let g={};return h.forEach(E=>{const b=c[E].value.__expires;b&&b<=m||(g[E]=c[E])}),g}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Oe(ee.NETWORK_RESPONSE_ERROR,a);L.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){cH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(aT.UPDATE_BITRATE_LIMIT,r):this.emit(aT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&J2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const g=h.__type,E=r[d].value,b=r[d].tag;let I=0;g?g===NW.REALTIME&&(I=1):Object.keys(E).some(A=>Object.prototype.hasOwnProperty.call(e2,A)||!I2()&&Object.prototype.hasOwnProperty.call(SP,A)?(I=1,!0):void 0),c.push({tag:b,isApplied:I,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:g,isApplied:E}=d;this.store.sessionId&&Pt.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){L.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,g=m.__expires,E=m.__type;Object.keys(m).forEach(b=>{b==="__id"||b==="__type"||b==="__priority"||b==="__expires"||Object.prototype.hasOwnProperty.call(d,b)||(d[b]=J2(J2({value:m[b]},g&&{expires:g}),E&&{type:E}))})}),d}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&cH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const g=Date.now();Object.keys(m).forEach(E=>{const{value:b,type:I,expires:A}=m[E];A&&A<=g||((I===NW.REALTIME||Object.prototype.hasOwnProperty.call(e2,E))&&(zd[E]=b,jr[E]=b,L.debug("Update realtime parameters from config distribute",E,b)),I||I2()||!Object.prototype.hasOwnProperty.call(SP,E)||(zd[E]=b,jr[E]=b,L.debug("Update gateway parameters from config distribute",E,b)))})}catch(g){L.error("Error update config immediately: ".concat(m),g.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),L.debug("Caching global parameters ".concat(d))}catch(c){L.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(jr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(jr[a],c)||(zd[a]=c,jr[a]=c,this.emit(aT.UPDATE_CLIENT_ROLE_OPTIONS,c),L.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){L.error("Error handling global parameter config:",s.message)}}}class b_e extends Jr{constructor(){super(...arguments),Y(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(a);const d=r==="VIDEO_ENCODE_FAILED"?oe("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const m=tt(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",Q2[r],r,s),!c.isPrevNormal&&m&&this.emit("exception",Q2[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Wi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Pc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var s;return!(!r.codecType||tt(s=oe("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Wi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const Q2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},io=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function JH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function dy(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?JH(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):JH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class gT{constructor(r){Y(this,"store",void 0),Y(this,"onStatsException",void 0),Y(this,"onUploadPublishDuration",void 0),Y(this,"onStatsChanged",void 0),Y(this,"onVideoCodecChanged",void 0),Y(this,"localStats",new Map),Y(this,"remoteStats",new Map),Y(this,"updateStatsInterval",void 0),Y(this,"trafficStats",void 0),Y(this,"trafficStatsPeerList",[]),Y(this,"uplinkStats",void 0),Y(this,"exceptionMonitor",void 0),Y(this,"p2pChannel",void 0),Y(this,"scalabilityMode",vP.L1T1),Y(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new b_e,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Xe.LocalAudioTrack)||dy({},o2)}getLocalVideoTrackStats(){return this.localStats.get(Xe.LocalVideoTrack)||dy({},a2)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(g=>g.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(Xe.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Xe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Xe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:b,videoStats:I}=E;b&&(a+=b.receiveBytes,c+=b.receiveBitrate),I&&(a+=I.receiveBytes,c+=I.receiveBitrate)});let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?io.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?io.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&L.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Xe.LocalVideoTrack:case Xe.LocalVideoLowTrack:{const m=c,g=dy({},a2),E=r.getStats(),b=r.getLocalMedia(a);if(E){const I=E.videoSend.find(A=>A.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(I){const A=r.getLocalVideoSize(),k=r.getEncoderConfig(Xe.LocalVideoTrack);var d;(I.codec==="H264"||I.codec==="H265"||I.codec==="VP8"||I.codec==="VP9"||I.codec==="AV1X"||I.codec==="AV1")&&(g.codecType=I.codec,(m==null?void 0:m.codecType)!==I.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,I.codec.toLocaleLowerCase()))),g.sendBytes=I.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,I.inputFrame?(g.captureFrameRate=I.inputFrame.frameRate,g.captureResolutionHeight=I.inputFrame.height,g.captureResolutionWidth=I.inputFrame.width):A&&(g.captureResolutionWidth=A.width,g.captureResolutionHeight=A.height),I.sentFrame?(g.sendFrameRate=I.sentFrame.frameRate,g.sendResolutionHeight=I.sentFrame.height,g.sendResolutionWidth=I.sentFrame.width):A&&(g.sendResolutionWidth=A.width,g.sendResolutionHeight=A.height),I.avgEncodeMs&&(g.encodeDelay=I.avgEncodeMs),k&&k.bitrateMax?g.targetSendBitrate=1e3*k.bitrateMax:I.targetBitrate&&(g.targetSendBitrate=I.targetBitrate),g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(g.totalFreezeTime+=1),I.scalabilityMode&&this.scalabilityMode!==I.scalabilityMode&&(L.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(I.scalabilityMode)),this.scalabilityMode=I.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&b&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,b.track,g);break}case Xe.LocalAudioTrack:{const m=c,g=dy({},o2),E=r.getStats(),b=r.getLocalMedia(a);if(E){const I=E.audioSend.find(A=>A.ssrc===(b==null?void 0:b.ssrcs[0].ssrcId));if(I){if(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(g.codecType=I.codec),I.inputLevel)g.sendVolumeLevel=Math.round(32767*I.inputLevel);else{const A=r.getLocalAudioVolume();A&&(g.sendVolumeLevel=Math.round(32767*A))}g.sendBytes=I.bytes,g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Xe.LocalAudioTrack,g),g&&b&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,b.track,g);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:g}]=s;const E=m,b=h,I=g,A=dy({},WW),k=dy({},GW),G=dy({},sge),{audioTrack:j,videoTrack:B,audioSSRC:Z,videoSSRC:Q}=r.getRemoteMedia(d);let ae;ae=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=ae)===null||a===void 0?void 0:a.audioRecv.find(Ue=>Ue.ssrc===Z),_e=(c=ae)===null||c===void 0?void 0:c.videoRecv.find(Ue=>Ue.ssrc===Q),ue=this.trafficStats&&this.trafficStats.peer_delay.find(Ue=>Ue.peer_uid===d);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(A.codecType=ye.codec),ye.outputLevel?A.receiveLevel=Math.round(32767*ye.outputLevel):j&&(A.receiveLevel=Math.round(32767*j.getVolumeLevel())),A.receiveBytes=ye.bytes,A.receivePackets=ye.packets,A.receivePacketsLost=ye.packetsLost,A.receivePacketsDiscarded=ye.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=E?8*Math.max(0,A.receiveBytes-E.receiveBytes):0,A.totalDuration=E?E.totalDuration+1:1,A.totalFreezeTime=E?E.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ye.jitterBufferMs,A.totalDuration>10&&gT.isRemoteAudioFreeze(j)&&(A.totalFreezeTime+=1)),_e){var Ie;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(k.codecType=_e.codec),k.receiveBytes=_e.bytes,k.receiveBitrate=b?8*Math.max(0,k.receiveBytes-b.receiveBytes):0,k.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,k.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(k.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(k.receiveFrameRate=_e.receivedFrame.frameRate,k.receiveResolutionHeight=_e.receivedFrame.height,k.receiveResolutionWidth=_e.receivedFrame.width):B&&(k.receiveResolutionHeight=B._videoHeight||0,k.receiveResolutionWidth=B._videoWidth||0),_e.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(_e.framesRateFirefox)),k.receivePackets=_e.packets,k.receivePacketsLost=_e.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ue=b?b.totalFreezeTime:0,We=b?b.totalDuration:0;k.totalDuration=b?b.totalDuration+1:1,k.totalFreezeTime=(Ie=_e.totalFreezesDuration)!==null&&Ie!==void 0?Ie:Ue||0,k.receiveDelay=_e.jitterBufferMs||0;const Qe=!!Q&&r.getRemoteVideoIsReady(Q);_e.totalFreezesDuration===void 0&&B&&Qe&&gT.isRemoteVideoFreeze(B,_e,I)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ue)/(k.totalDuration-We),1))}ue&&(A.end2EndDelay=ue.B_ad,k.end2EndDelay=ue.B_vd,A.transportDelay=ue.B_ed,k.transportDelay=ue.B_ed,A.currentPacketLossRate=ue.B_ealr4/100,k.currentPacketLossRate=ue.B_evlr4/100,G.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,G.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(d,{audioStats:A,videoStats:k,videoPcStats:_e,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,A),B&&this.exceptionMonitor.setRemoteVideoStats(B,k)})}}class QH{constructor(){Y(this,"destChannelMediaInfos",new Map),Y(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){oH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){oH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){jP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function ZH(t){if(!(t instanceof QH))return new Oe(ee.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(ee.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(ee.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class tg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){Y(this,"uid",void 0),Y(this,"_uintid",void 0),Y(this,"_trust_in_room_",!0),Y(this,"_trust_audio_enabled_state_",!0),Y(this,"_trust_video_enabled_state_",!0),Y(this,"_trust_audio_mute_state_",!0),Y(this,"_trust_video_mute_state_",!0),Y(this,"_audio_muted_",!1),Y(this,"_video_muted_",!1),Y(this,"_audio_enabled_",!0),Y(this,"_video_enabled_",!0),Y(this,"_audio_added_",!1),Y(this,"_video_added_",!1),Y(this,"_is_pre_created",!1),Y(this,"_video_pre_subscribed",!1),Y(this,"_audio_pre_subscribed",!1),Y(this,"_trust_video_stream_added_state_",!0),Y(this,"_trust_audio_stream_added_state_",!0),Y(this,"_audioTrack",void 0),Y(this,"_videoTrack",void 0),Y(this,"_dataChannels",[]),Y(this,"_audioSSRC",void 0),Y(this,"_videoSSRC",void 0),Y(this,"_audioOrtc",void 0),Y(this,"_videoOrtc",void 0),Y(this,"_cname",void 0),Y(this,"_rtxSsrcId",void 0),Y(this,"_videoMid",void 0),Y(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function e7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Z2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?e7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const t1="9",eM=2e4,n1=4e4;function t7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function yf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?t7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):t7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var pS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(pS||{});const r1=new Map;function n7(t,r,s,a){let{scale:c}=t;if(c===0&&a===pS.UP||c>=r.length-1&&a===pS.DOWN)return t;let d=yf(yf({},t),{},{scale:a===pS.DOWN?++c:--c});switch(s){case"maintain-framerate":d=yf(yf({},d),r[c].motion);break;case"maintain-resolution":d=yf(yf({},d),r[c].detail);break;case"balanced":d=yf(yf({},d),r[c].balanced)}return d}function r7(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:i7(r)};r1.set(t,s)}else r1.delete(t)}function i7(t){const r=yf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:b,BWE_SCALE_UP_THRESHOLD:I,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:B,BALANCE_RESOLUTION_FACTOR:Z,MOTION_RESOLUTION_FACTOR:Q,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:_e}=QL,ue=Math.min(r.frameRate,m),Ie=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(k,1)*ue),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Ue=1;Ue<=g;Ue++){const We={bwe_up:Math.round(Math.pow(I,Ue)*s),bwe_down:Math.round(Math.pow(A,Ue+1)*s),fps_up:Math.round(Math.pow(G,Ue)*ue),fps_down:Math.round(Math.pow(k,Ue+1)*ue)},Qe={scaleResolutionDownBy:c/Math.pow(Z,Ue),frameRate:Math.max(Math.round(Math.pow(B,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(j,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(j,Ue)*d),E)},fn={scaleResolutionDownBy:c/Math.pow(Q,Ue),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(ae,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(ae,Ue)*d),E)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(_e,Ue)*s),b),bitrateMin:Math.max(Math.round(Math.pow(_e,Ue)*d),E)};Ie.push({scale:Ue,threshold:We,balanced:Qe,motion:fn,detail:vn})}return Ie}function w_e(t,r,s,a,c,d){const h=r1.get(t)||{overUse:0,underUse:0,adaptationList:i7(c)},{adaptationList:m}=h;r1.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:E}=QL,{scale:b}=a;let I,A;return typeof r=="number"&&r>0&&function(k,G,j,B){if(G>=j.length)return!1;let{threshold:{fps_down:Z}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Z=j[0].threshold.fps_down),k<Z}(r,b,m,d)&&(h.overUse++,A=Zw.CPU,h.overUse>g)||typeof s=="number"&&s>0&&function(k,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:B}}=j[G];return k<B}(s,b,m)&&(h.overUse++,A=Zw.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,I=n7(a,m,d,pS.DOWN),[I,A]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(k,G,j,B){if(G===0)return;let{threshold:{fps_up:Z}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Z=j[1].threshold.fps_up),k>Z}(r,b,m,d)&&function(k,G,j){if(G===0)return;const{threshold:{bwe_up:B}}=j[G];return k>B}(s,b,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,I=n7(a,m,d,pS.UP),I.scale===0&&(A=Zw.NONE))),[I,A])}function s7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function tM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?s7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):s7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const i1=new Map;function s1(t,r){const s=i1.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),i1.delete(t)}r.qualityLimitationReason=Zw.NONE,r7(t)}function T_e(t,r){var s;let a;switch(r){case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoTrack:a=tt(s=t._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:a=or.Low}return a}function nM(t){const r=Fn();if(t.some(s=>s._bypassWebAudio))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function rM(t,r){nM(t);const s=new Wi;return t.forEach(a=>s.addAudioTrack(a)),s}const C_e=!Fn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&hf();function o1(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return C_e?(s={spec:r,store:t},_f("PlanBConnection").create(s)):new Kl(r,t)}function iM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function o7(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Xw(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Dn;function a7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Kd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Kl=(Dn=class Py extends uH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return tt(s=Object.keys(tT)).call(s,r)}))]}constructor(r,s){super(r,s),Y(this,"id",Er(5,"connection-")),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"forceTurn",!1),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"transportEventReceiver",void 0),Y(this,"statsFilter",void 0),Y(this,"extension",{useXR:oe("USE_XR")}),Y(this,"localCapabilities",void 0),Y(this,"remoteCodecs",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"isPreallocation",!1),Y(this,"preMediaMap",new Map),Y(this,"dataStreamChannelMap",new Map),Y(this,"establishPromise",void 0),Y(this,"recoveredDataChannelIds",[]),Y(this,"currentDataChannelId",1),Y(this,"supportAV1RtpSpec",!1),Y(this,"mutex",void 0),Y(this,"qualityLimitationReason",Zw.NONE),Y(this,"isFirstConnected",!1),this.store=s,this.forceTurn=o7(r),this.mutex=new eo("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Py.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ei()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void L.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else L.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp),d=await PH({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:oe("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:oe("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=XP(d),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:vP.L1T3}]});const E=await g.createOffer();if(!E.sdp)return void g.close();const b=Za(E.sdp).mediaDescriptions[0];if(!b)return;const I=b.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return g.close(),I}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&xH(a.sdp)&&(h=Kr(d),(s=h).send&&(cS(Et.VIDEO,s.send.videoExtensions),cS(Et.AUDIO,s.send.audioExtensions)),s.recv&&(cS(Et.VIDEO,s.recv.videoExtensions),cS(Et.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(cS(Et.VIDEO,s.sendrecv.videoExtensions),cS(Et.AUDIO,s.sendrecv.audioExtensions))),Kd(Kd({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&xH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(KP(Et.VIDEO,s.send.videoExtensions,a.send.videoExtensions),KP(Et.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(KP(Et.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),KP(Et.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(g){let E=arguments.length>1&&arguments[1]!==void 0&&arguments[1],b=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_isUseExtmapAllowMixed",void 0),Y(this,"_isUseLocalCodecs",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),Y(this,"useLocalCodecsMids",[]),Y(this,"preloadSsrcs",[]),Y(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=E,this._isUseLocalCodecs=b,g=Kr(g);const{iceParameters:I,dtlsParameters:A,candidates:k,rtpCapabilities:G,setup:j,localCapabilities:B,cname:Z}=g;this._rtpCapabilities=G,this._candidates=k,this._originCandidates=Kr(k),this._iceParameters=I,this._dtlsParameters=A,this._localCapabilities=B,this.setup=j,this.cname=Z,[this.sessionDesc]=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every(E=>{var b;return tt(b=this.preloadSsrcs).call(b,E)})}preloadRemoteMedia(g){let E=0;const b=[],I=[];for(;g>0;){const A=[Z2({ssrcId:n1+E},oe("USE_SUB_RTX")?{rtx:n1+E+1}:{})],k="".concat(n1+E,"_").concat(eM+E),{ssrcs:G,ssrcGroups:j}=hT(A,this.cname,oe("SYNC_GROUP")?k:void 0),B=this.preCreateOrRecycleSendMedia("video",G,j,void 0),Z=[{ssrcId:eM+E}],Q="".concat(n1+E,"_").concat(eM+E),{ssrcs:ae,ssrcGroups:ye}=hT(Z,this.cname,oe("SYNC_GROUP")?Q:void 0),_e=this.preCreateOrRecycleSendMedia("audio",ae,ye,void 0);g--,E+=2,b.push(B,_e),I.push(G[0].ssrcId,ae[0].ssrcId)}return this.useLocalCodecsMids.push(...b),this.preloadSsrcs=I,{mids:b,preSSRCs:I,isAvailable:!0}}preCreateOrRecycleSendMedia(g,E,b,I){const A=this.rtpCapabilities.send.videoCodecs,k=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;L.debug("create or recycle send media without remote rtp capabilities, ssrcs ",E[0].ssrcId);const G=g===Et.VIDEO?k.videoCodecs:k.audioCodecs,j=g===Et.VIDEO?k.videoExtensions:k.audioExtensions;this.currentMidIndex+=1;const B="".concat(this.currentMidIndex);let Z={media:{mediaType:g,port:t1,protos:["UDP","TLS","RTP","SAVPF"],fmts:G.map(Q=>Q.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:G,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(B)}};return Z=this.mungSendMediaDesc(Z,I),this.sessionDesc.mediaDescriptions.push(Z),this.updateBundleMids(),B}toString(){return Hm(this.sessionDesc)}send(g,E,b,I){const{ssrcs:A,ssrcGroups:k}=hT(E,this.cname,oe("SYNC_GROUP")?b:void 0),G=this.findPreloadMediaDesc(A);if(G){if(ei()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,G.attributes.mid),I&&(I.twcc||I.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(G);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(G,I),{mid:G.attributes.mid,needExchangeSDP:!0}}return{mid:G.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(g,A);let B;return j===-1||j===1&&(Vs()||function(){const Z=xn();return!(Z.name!==Hn.CHROME||!Z.osVersion)&&Number(Z.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&df())||j===0&&!function(Z){const Q=xn();return!(Q.name!==Hn.FIREFOX||!Q.osVersion)&&Number(Q.version)===Z}(138)&&oe("USE_SUB_RTX")||nW()?(B=this.createOrRecycleSendMedia(g,A,k,"sendonly",I),this.updateBundleMids()):(B=Kr(this.sessionDesc.mediaDescriptions[j]),B.attributes.direction="sendonly",B.attributes.ssrcs=A,B.attributes.ssrcGroups=k,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(B,I)),ei()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,B.attributes.mid),{mid:B.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:E}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:E}}batchSend(g){const E=g.map(A=>{let{kind:k,ssrcMsg:G,mslabel:j}=A;return this.send(k,G,j)}),b=[];let I=!1;return E.forEach(A=>{let{mid:k,needExchangeSDP:G}=A;G&&(I=!0),b.push(k)}),{mids:b,needExchangeSDP:I}}stopSending(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&g.indexOf(b.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");E.forEach(b=>{b.attributes.mid==="0"||ei()||nW()?b.attributes.ssrcs=[]:(b.attributes.ssrcs=[],b.attributes.direction="inactive",b.media.port="0")}),this.updateBundleMids()}mute(g){const E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g);if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}muteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>tt(g).call(g,b.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(b=>{b.attributes.direction="inactive"})}unmuteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>tt(g).call(g,b.attributes.mid||""));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach(b=>{b.attributes.direction="recvonly"})}receive(g,E,b,I){g.forEach((A,k)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",E,b,I[k])}),this.updateBundleMids()}stopReceiving(g){const E=this.sessionDesc.mediaDescriptions.filter(b=>g.indexOf(b.attributes.mid)!==-1);if(E.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");E.forEach(b=>{b.media.port="0",b.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const E=this.sessionDesc||Za((b=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(b?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var b;this._rtpCapabilities=g;let I=!1;const A=this.rtpCapabilities.send,k=this.localCapabilities.send,G=this.localCapabilities.recv,j=G.videoCodecs,B=G.audioCodecs,Z=G.videoExtensions,Q=G.audioExtensions;for(const ue of E.mediaDescriptions){var ae;if(ue.attributes.direction!=="sendonly"||typeof ue.attributes.mid!="string"||!tt(ae=this.useLocalCodecsMids).call(ae,ue.attributes.mid)){if(I=!0,ue.attributes.iceUfrag=this._iceParameters.iceUfrag,ue.attributes.icePwd=this._iceParameters.icePwd,ue.attributes.fingerprints=this._dtlsParameters.fingerprints,ue.attributes.candidates=this._candidates,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var ye;ue.media.fmts=j.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=j,ue.attributes.extmaps=Z;const Ie=ue.attributes.mid;typeof Ie!="string"||tt(ye=this.useLocalCodecsMids).call(ye,Ie)||this.useLocalCodecsMids.push(Ie)}else if(A.videoCodecs.length===0){const Ie=k.videoCodecs.filter(Ue=>{var We,Qe;return(We=Ue.rtpMap)===null||We===void 0?void 0:tt(Qe=We.encodingName.toLowerCase()).call(Qe,"vp8")})||[k.videoCodecs[0]];ue.media.fmts=Ie.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ie,ue.attributes.extmaps=[]}else ue.media.fmts=A.videoCodecs.map(Ie=>Ie.payloadType.toString(10)),ue.attributes.payloads=A.videoCodecs,ue.attributes.extmaps=A.videoExtensions;if(ue.media.mediaType==="audio")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var _e;ue.media.fmts=B.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=B,ue.attributes.extmaps=Q;const Ie=ue.attributes.mid;typeof Ie!="string"||tt(_e=this.useLocalCodecsMids).call(_e,Ie)||this.useLocalCodecsMids.push(Ie)}else if(A.audioCodecs.length===0){const Ie=k.audioCodecs.filter(Ue=>{var We,Qe;return(We=Ue.rtpMap)===null||We===void 0?void 0:tt(Qe=We.encodingName.toLowerCase()).call(Qe,"opus")})||[k.audioCodecs[0]];ue.media.fmts=Ie.map(Ue=>Ue.payloadType.toString(10)),ue.attributes.payloads=Ie,ue.attributes.extmaps=[]}else ue.media.fmts=A.audioCodecs.map(Ie=>Ie.payloadType.toString(10)),ue.attributes.payloads=A.audioCodecs,ue.attributes.extmaps=A.audioExtensions,uS(ue)}}return this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1,[this.sessionDesc,I]}updateCandidates(g){const E=this._originCandidates.filter(I=>I.transport==="udp"),b=[];if(E.forEach(I=>{b.push(Z2(Z2({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))}),E.length!==0){switch(g){case ro.TCP_RELAY:this._candidates=b;break;case ro.UDP_TCP_RELAY:case ro.RELAY:this._candidates=[...E,...b];break;default:this._candidates=E}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(g){g=Kr(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd})}predictReceivingMids(g){const E=[];for(let b=0;b<g;b++)E.push((this.currentMidIndex+b+1).toString(10));return E}findAvailableMediaIndex(g,E){return this.sessionDesc.mediaDescriptions.findIndex(b=>{const I=b.media.mediaType===g&&b.media.port!=="0"&&(b.attributes.direction==="sendonly"||b.attributes.direction==="sendrecv")&&b.attributes.ssrcs.length===0;if(ei()){if(I){const A=this.firefoxSsrcMidMap.get(E[0].ssrcId);return!(A||b.attributes.mid!=="0"&&b.attributes.mid!=="1")||!(!A||A!==b.attributes.mid)}return!1}return I})}createOrRecycleDataChannel(){for(const b of this.sessionDesc.mediaDescriptions)if(b.media.mediaType==="application")return{mediaDesc:b,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),E={media:{mediaType:"application",port:t1,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(E),{mediaDesc:E,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,E,b,I,A,k){const G=g._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,B=pT(G,j,this.localCapabilities.send,G===Et.VIDEO?I:A),Z=G===Et.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let ae={media:{mediaType:G,port:t1,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};ae=this.mungRecvMediaDsec(ae,g,k);const ye=this.findFirstClosedMedia(G);if(ye){const _e=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[_e]=ae}else this.sessionDesc.mediaDescriptions.push(ae);return ae}updateRemoteDtlsParameters(g){const E=new Set(this._dtlsParameters.fingerprints.map(A=>A.fingerprint)),b=new Set(g.map(A=>A.fingerprint));let I=!1;E.size!==b.size&&(I=!0);for(const A of E)b.has(A)||(I=!0);return I}updateRemoteCodec(g,E,b){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").filter(ae=>{var ye;return tt(ye=Object.keys(tT)).call(ye,ae)}))],A=new Set(E);if(I.every(ae=>A.has(ae)))return L.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(E)),!1;const k=this._rtpCapabilities.recv.videoCodecs.filter(ae=>E.some(ye=>{var _e;return tt(_e=ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").call(_e,ye)}));if(k.length===0)return L.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(E)),!1;const G=[...new Set(k.map(ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||""))];let j;if(L.debug("updateRemoteCodec, from ".concat(I," to ").concat(G)),g.length===0)j=this.sessionDesc.mediaDescriptions.filter(ae=>ae.media.mediaType==="video"&&ae.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(ae=>ae.attributes.mid&&ae.media.mediaType==="video"&&tt(g).call(g,ae.attributes.mid)&&ae.attributes.direction==="recvonly"),j.length!==g.length)return L.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(E)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const ae=Qm(k,this.rtpCapabilities.recv.videoCodecs);k.push(...ae)}this._rtpCapabilities.recv.videoCodecs=k;const B=this.localCapabilities.send,Z=this.rtpCapabilities.recv,Q=pT(Et.VIDEO,Z,B,b);return j.forEach(ae=>{const ye=Q.map(_e=>_e.payloadType.toString(10));L.debug("updateRemoteCodec mid: ".concat(ae.attributes.mid,", from"),ae.attributes.payloads,"to",Q),ae.attributes.payloads=Q,ae.media.fmts=ye}),!0}createOrRecycleSendMedia(g,E,b,I,A){const k=this.rtpCapabilities.send.videoCodecs,G=this._isUseLocalCodecs||k.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,j=g===Et.VIDEO?G.videoCodecs:G.audioCodecs,B=g===Et.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Z="".concat(this.currentMidIndex);let Q={media:{mediaType:g,port:t1,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:b,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Z)}};Q=this.mungSendMediaDesc(Q,A);const ae=this.findFirstClosedMedia(g);if(ae){const ye=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[ye]=Q}else this.sessionDesc.mediaDescriptions.push(Q);return Q}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(g=>g.media.port!=="0").map(g=>g.attributes.mid)}mungRecvMediaDsec(g,E,b){const I=Kr(g);return j2(I),lS(I,E),B2(I,E),IH(I),YP(I,b,this.localCapabilities.send),I}mungSendMediaDesc(g,E){const b=Kr(g);return YP(b,E,this.localCapabilities.recv),uS(b),b}updateRecvMedia(g,E){const b=this.sessionDesc.mediaDescriptions.findIndex(I=>I.attributes.mid===g);if(b!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],E);this.sessionDesc.mediaDescriptions[b]=I}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find(E=>ei()?E.media.port==="0"&&E.media.mediaType===g:E.media.port==="0")}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find(E=>{var b;return((b=E.attributes)===null||b===void 0||(b=b.ssrcs[0])===null||b===void 0?void 0:b.ssrcId)===g[0].ssrcId})}getSSRC(g){var E;return(E=this.sessionDesc.mediaDescriptions.find(b=>b.attributes.mid===g))===null||E===void 0?void 0:E.attributes.ssrcs}}(Kd(Kd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!oe("ENABLE_PRE_SUB_WITH_PRE_PC")||!oe("PRE_USE_LOCAL_CODECS"))&&r2(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=OH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),r2(this.store))if(r.preallocation&&oe("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=oe("PRE_SUB_NUM"),{mids:E,preSSRCs:b}=this.remoteSDP.preloadRemoteMedia(g);await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(b)),this.presetMedia(E,b)}else{const{preSSRCs:g=[]}=r,E=g.map(I=>I.ssrcMsg[0].ssrcId);if(g.length===0)return;const{mids:b}=this.remoteSDP.batchSend(g.map(I=>Object.assign({},I)));await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(E)),this.presetMedia(b,E)}}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(r,s){r.forEach((a,c)=>{this.peerConnection.getTransceivers().forEach(d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let m;h.kind==="video"&&oe("ENABLE_PRE_RENDER")&&(m=new g2({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(Er(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const E=this.preMediaMap.get(s[c]);E&&(E.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,s[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:m,transceiver:d})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:a}=r;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}const{preSSRCs:c=[]}=r,d=c.map(h=>h.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every(g=>{let[E,{mid:b,player:I,track:A}]=g;return h.push(b),m.push(E),this.preMediaMap.delete(E),I&&I.destroy(),!0}),h.length>0&&(this.remoteSDP.stopSending(h),await Zm(this.peerConnection,this.remoteSDP,this.extension),L.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),Pt.reportApiInvoke(this.store.sessionId,{name:di.PRELOAD_MEDIA_FAILED,options:[c,m],tag:$r.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map(E=>Object.assign({},E)));await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}s?(await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):L.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Bl(function*(){const d=yield Vn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=$P();r.forEach(B=>{const Z=c.peerConnection.addTransceiver(B._mediaStreamTrack,Kd({direction:"sendonly"},B.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Z),B._updateRtpTransceiver(Z)}),ei()&&oe("SIMULCAST")===!0&&(yield Vn(c.applySimulcastForFirefox(h,r)));const g=yield Vn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),b=c.mungSendOfferSDP(g.sdp,r,E),I=Za(b),A=E.map(B=>{const Z=I.mediaDescriptions.find(Q=>Q.attributes.mid===B);if(!Z)throw new Error("Cannot extract ssrc from mediaDescription.");return TH(Z,oe("USE_PUB_RTX"))});let k;try{k=yield A}catch(B){k=[],c.remoteSDP.receive(r,s,a,k);const Z=c.remoteSDP.toString();throw yield Vn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Vn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Z})),yield Vn(c.stopSending(E,!0)),B}c.remoteSDP.receive(r,s,a,k);const G=c.remoteSDP.toString(),j=c.logSDPExchange(b,"offer","local","send");return yield Vn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Vn(c.applySimulcastEncodings(h,r)),yield Vn(c.applySendEncodings(h,r)),j==null||j(G),yield Vn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((B,Z)=>{const Q=E[Z];return{localSSRC:A[Z],id:Q,transceiver:B}})}catch(h){throw h instanceof Le?h:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")L.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),L.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else L.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(ee.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(g=>{var E;s1(this.id+g.mid,this),g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await Zm(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preMediaMap.entries()).some(h=>{let[m,{mid:g,player:E}]=h;if(g===d)return this.preMediaMap.delete(m),E&&E.destroy(),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Bl(function*(){const a=yield Vn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Fn().supportPCSetConfiguration,d=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===ro.RELAY&&!c)return;if(c&&!d){const I=r===ro.RELAY?"relay":"all",A=s.peerConnection.getConfiguration();A.iceTransportPolicy!==I&&(L.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(I,"]")),A.iceTransportPolicy=I,s.peerConnection.setConfiguration(A))}s.remoteSDP.updateCandidates(r);const h=yield Vn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Jm(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;s.remoteSDP.restartICE(g);const E=s.remoteSDP.toString(),b=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Vn(s.peerConnection.setLocalDescription(h)),b==null||b(E),yield Vn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){L.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(ro.TCP_RELAY),await Zm(this.peerConnection,this.remoteSDP,this.extension)}catch(s){L.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{s1(this.id+s.mid,this)}),this.preMediaMap.forEach(s=>{let{player:a}=s;a&&a.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Kd(Kd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(ee.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?ei()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Kd(Kd({},Yh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Kd(Kd({},Yh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=uy(r.url||"");L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]},a=r.cloudProxyServer||"disabled";return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(Xw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(s.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Fn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,m=d.address+":"+d.port;L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(uy(h)),", remote ").concat(JSON.stringify(uy(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(B=>B.track===r._mediaStreamTrack)),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(j,B){return j.getTransceivers().find(Z=>Z.sender.track===B||Z.receiver.track===B)}(this.peerConnection,r._mediaStreamTrack),g=uge(r);if(function(j){var B;return!(!oe("ENABLE_AG_ADAPTATION")||!(j instanceof PP||tt(B=j._hints).call(B,_r.CUSTOM_TRACK))||!oe("FORCE_SUPPORT_AG_ADAPTATION")&&!(eW(14,0,!1)&&tW(17,4)||Z8(14)&&NL(17,4,!0)))}(r)&&m&&s&&g&&this.getLocalVideoStats&&tt(a=["vp8","vp9"]).call(a,this.store.codec)){var E;const j=d.degradationPreference||(tt(E=r._hints).call(E,_r.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(B,Z,Q,ae,ye,_e){if(s1(B,Q),ye(Z),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let ue=-1;r7(B,Z);const Ie=window.setInterval(()=>{const We=i1.get(B);if(!oe("ENABLE_AG_ADAPTATION")||!We)return s1(B,Q),void ye(Z);const Qe=_e();if(Qe.sendPackets>0&&Qe.OutgoingAvailableBandwidth>0){if(ue===-1)return void(ue=Date.now());if(Date.now()-ue<1e3)return;const fn=Qe.sendFrameRate,vn=Qe.OutgoingAvailableBandwidth,[Jt,nr]=w_e(B,fn,vn,We.adaptationConfig,Z,ae);nr&&(Q.qualityLimitationReason=nr),Jt&&We.adaptationConfig.scale!==Jt.scale&&(L.debug("[".concat(B,"] applyAdaptation: ").concat(Q.qualityLimitationReason,`
           sendFps `).concat(fn,", bwe ").concat(vn,", switch from ").concat(We.adaptationConfig.scale," to ").concat(Jt.scale," ")),We.adaptationConfig=tM(tM({},We.adaptationConfig),Jt),ye(Jt))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ue=tM({},Z);i1.set(B,{timer:Ie,adaptationConfig:Ue,originConfig:Z,adaptationFunc:ye}),L.debug("[".concat(B,"] start adaptation, originConfig: ").concat(JSON.stringify(Z),", degradationPreference: ").concat(ae))})(this.id+m.mid,g,this,j,B=>{s&&this.updateAdaptation(s,B)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var b;const{bitrateMax:j,frameRate:B,scaleResolutionDownBy:Z}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(tt(b=r._hints).call(b,_r.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(B&&(h.maxFramerate=Pc(B)),Z&&Z>=1&&(h.scaleResolutionDownBy=Z))}const{maxFramerate:I}=oe("ENCODER_CONFIG_LIMIT");if(I&&typeof I=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,I):I),oe("DSCP_TYPE")&&hf()){var A;const j=oe("DSCP_TYPE");tt(A=["very-low","low","medium","high"]).call(A,j)&&(h.networkPriority=j)}const k=s.getParameters(),G=(c=k.encodings)===null||c===void 0?void 0:c[0];ei()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(k,d),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await s.setParameters(k),await async function(j,B,Z){try{var Q;if(!Fn().supportSetRtpSenderParameters||!function(Ie){return Ie==="vp9"||Ie==="av1"}(j)||!oe("ENABLE_SVC"))return;const ae={},ye={},_e=B.getParameters(),ue=(Q=_e.encodings)===null||Q===void 0?void 0:Q[0];ye.scalabilityMode=$P(Z),ue&&Object.assign(ue,ye),Object.assign(_e,ae),await B.setParameters(_e),L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(ae){L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}}(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return L.debug("[updateAdaptation] no rtpSender found");if(!Fn().supportSetRtpSenderParameters)return L.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=Pc(m)),g&&g>=1&&tt(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=g);const E=r.getParameters(),b=(c=E.encodings)===null||c===void 0?void 0:c[0];b&&Object.assign(b,d),Object.assign(E,{});try{await r.setParameters(E),L.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(I){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?L.debug("[updateAdaptation] peerConnection not connected}"):L.debug("[updateAdaptation] updateRtpSenderEncodings failed",I):L.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Nr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Za(r);return s.forEach((d,h)=>{const m=a[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(lS(g,d),AH(g,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],b=s[g];if(b instanceof Nr&&!tt(a=b._hints).call(a,_r.LOW_STREAM)&&(c=b._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=b._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=b._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,I))}}}async applySimulcastEncodings(r,s){if(!ei()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Nr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Nr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!tt(s=r._hints).call(s,_r.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Fn().supportPCSetConfiguration){const s=Py.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}r.isPreallocation&&(this.isPreallocation=!0)}},It(Dn.prototype,"updateRemoteRTPCapabilities",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateRemoteRTPCapabilities"),Dn.prototype),It(Dn.prototype,"connect",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"connect"),Dn.prototype),It(Dn.prototype,"updateRemoteConnect",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateRemoteConnect"),Dn.prototype),It(Dn.prototype,"createDataChannels",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"createDataChannels"),Dn.prototype),It(Dn.prototype,"receive",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"receive"),Dn.prototype),It(Dn.prototype,"batchReceive",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"batchReceive"),Dn.prototype),It(Dn.prototype,"stopReceiving",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"stopReceiving"),Dn.prototype),It(Dn.prototype,"muteRemote",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"muteRemote"),Dn.prototype),It(Dn.prototype,"unmuteRemote",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"unmuteRemote"),Dn.prototype),It(Dn.prototype,"muteLocal",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"muteLocal"),Dn.prototype),It(Dn.prototype,"unmuteLocal",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"unmuteLocal"),Dn.prototype),It(Dn.prototype,"close",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"close"),Dn.prototype),It(Dn.prototype,"updateEncoderConfig",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateEncoderConfig"),Dn.prototype),It(Dn.prototype,"updateSendParameters",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateSendParameters"),Dn.prototype),It(Dn.prototype,"replaceTrack",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"replaceTrack"),Dn.prototype),It(Dn.prototype,"updateAdaptation",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"updateAdaptation"),Dn.prototype),It(Dn.prototype,"getRemoteSSRC",[Pa],Object.getOwnPropertyDescriptor(Dn.prototype,"getRemoteSSRC"),Dn.prototype),Dn);function Pa(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function sM(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Pc(r.width),a.height=Pc(r.height);const c=Pc(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new Oe(ee.UNEXPECTED_ERROR,"can not get canvas context");const m=Fn(),g=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const b=s.videoWidth,I=s.videoHeight/b,A=a.width*I;Math.abs(A-a.height)>=2&&(L.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(A)),a.height=A)}h.drawImage(s,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=u2(()=>a.startCapture&&a.startCapture(),c);const E=g.stop;return g.stop=()=>{E.call(g),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),L.debug("clean low stream renderer")},g}var c7=function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t}(c7||{}),qd=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t}(qd||{}),nn=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(nn||{}),Ps=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(Ps||{}),ka=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ka||{}),a1=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(a1||{});const hy=1e3,c1=6,_T=3,R_e=Math.max(c1,_T,60);function Wt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function l7(t){const r={[ka.CONN_TYPE]:0,[ka.RTT]:t.rtt,[ka.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[ka.CONN_TYPE]=1),s==="tcp"&&(r[ka.CONN_TYPE]=3),s==="tls"&&(r[ka.CONN_TYPE]=4);break}case"srflx":r[ka.CONN_TYPE]=2;break;case"unknown":r[ka.CONN_TYPE]=5;break;default:r[ka.CONN_TYPE]=0}return r}function u7(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class d7 extends Jr{constructor(r){super(),Y(this,"store",void 0),Y(this,"uploadWRTCStatsTimer",void 0),Y(this,"uploadOutboundDenoiserStatsTimer",void 0),Y(this,"uploadExtStatsTimer",void 0),Y(this,"uploadExtUsageStatsTimer",void 0),Y(this,"uploadInboundExtStatsTimer",void 0),Y(this,"requestStats",void 0),Y(this,"requestTransportStats",void 0),Y(this,"requestLocalMedia",void 0),Y(this,"requestRemoteMedia",void 0),Y(this,"requestAllTracks",void 0),Y(this,"requestVideoIsReady",void 0),Y(this,"requestUploadStats",void 0),Y(this,"requestUpload",void 0),Y(this,"uploadOutboundStarted",!1),Y(this,"uploadInboundStarted",!1),Y(this,"uploadTransportStarted",!1),Y(this,"uploadBaseStatsStarted",!1),Y(this,"uploadExtensionUsageStarted",!1),Y(this,"lastRecvStats",void 0),Y(this,"lastSendStats",void 0),Y(this,"lastRefRecvStats",void 0),Y(this,"lastRefSendStats",void 0),Y(this,"lastNormalRecvStats",void 0),Y(this,"lastNormalSendStats",void 0),Y(this,"lastExtendStats",{}),Y(this,"needUploadStats",{}),Y(this,"needUploadRenderFreezeTime",!0),Y(this,"lastUploadCompensateTime",-1),Y(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%_T==0,a=r%c1==0,c=r%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var m;const g={};if(this.uploadTransportStarted&&d){const b=this.getTransportStats(d,h,s);b&&(g.misc=[b])}if(this.uploadOutboundStarted&&d){const b=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);b&&(g.outbound=[b])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const b=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);b&&(g.inbound=b)}const E=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[a1.RTC_PEER_CONNECTION_STATE]=qL[E]):g.misc=[{addition:{[a1.RTC_PEER_CONNECTION_STATE]:qL[E]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[c7.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[a1.RTC_PEER_CONNECTION_STATE]:qL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===R_e+1&&(r=1)},hy)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=r%_T==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const m=this.requestRemoteMedia()||[],g=[];m.forEach(E=>{let[b,I]=E;const A={peer:b.uid};if(b._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(b._videoSSRC)&&I.has(Et.VIDEO)&&b.videoTrack){const k=function(G,j,B){if(!j.videoRecv.find(Q=>Q.ssrc===G))return;const Z={};if(B&&B._player){const Q=B._player,{renderFreezeAccTime2:ae,videoElementStatus:ye}=Q;if(Qh.visibility==="visible"&&ye===to.PLAYING&&Fn().supportRequestVideoFrameCallback){const _e=Math.min(6e3,ae);Q.renderFreezeAccTime2=Math.max(0,ae-_e),Wt(Z,qd.Video_Render_Freeze_Time_Render2,_e),oe("USE_NEW_RENDER_FREEZE_TIME")&&Wt(Z,qd.Video_Render_Freeze_Time_Render,_e)}}return Z}(b._videoSSRC,d,b.videoTrack);k&&(A.video=k)}A.video&&g.push(A)}),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[ka.RTT]:r.rtt,[ka.CONN_TYPE]:void 0,[ka.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=l7(r);if(this.store.useP2P){if(s){const d=l7(s);c[ka.CONN_TYPE]+=d[ka.CONN_TYPE]<<3}c[ka.CONN_TYPE]+=110}else c[ka.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,E;return h.forEach(b=>{let[I,{track:A,ssrcs:k}]=b;switch(I){case Xe.LocalVideoLowTrack:case Xe.LocalVideoTrack:if(I===Xe.LocalVideoTrack){var G;const j=function(ae,ye,_e,ue,Ie,Ue){const We=ye.videoSend.find(Jt=>Jt.ssrc===ae);if(!We)return;const Qe={},{sentFrame:fn,inputFrame:vn}=We;if(ue&&(Wt(Qe,qd.Video_Send_Qp_Sum,We.qpSumPerFrame),vn&&fn)){const Jt=vn.frameRate,nr=fn.frameRate;Qe[qd.Video_Send_Freeze]=function(qn,so){let ze=!0;return ze=!(qn<=5)&&(qn<=10?so<3:qn<=20?so<4:so<5),ze}(Jt,nr)?1:0}if(Ie){switch(fn&&(Wt(Qe,nn.Video_Send_Height,fn.height),Wt(Qe,nn.Video_Send_Width,fn.width),Wt(Qe,nn.Video_Send_Frame_Rate,fn.frameRate)),Qe[nn.Video_Send_Disabled]=_e._originMediaStreamTrack&&!_e._originMediaStreamTrack.enabled||_e._mediaStreamTrack&&!_e._mediaStreamTrack.enabled?1:0,We.adaptionChangeReason){case"none":Qe[nn.Video_Send_Adaptation]=0;break;case"cpu":Qe[nn.Video_Send_Adaptation]=1;break;case"bandwidth":Qe[nn.Video_Send_Adaptation]=2;break;case"other":Qe[nn.Video_Send_Adaptation]=3}let Jt=0;We.adaptionChangeReason&&(Jt+=u7(We.adaptionChangeReason)),ye.qualityLimitationReason&&(Jt+=u7(ye.qualityLimitationReason)<<3),Qe[nn.Video_Send_Adaptation]=Jt,Qe[nn.Video_Send_Player_Status]=c2[_e._player?_e._player.videoElementStatus:"uninit"],Wt(Qe,nn.Video_Send_Nacks,We.nacksCount),Wt(Qe,nn.Video_Send_Plis,We.plisCount),Wt(Qe,nn.Video_Send_Firs,We.firsCount),Wt(Qe,nn.Video_Send_Avg_Encode,We.avgEncodeMs),Wt(Qe,nn.Video_Send_Huge_Frame_Sent,We.hugeFramesSent),Wt(Qe,nn.Video_Send_Bytes_Retransmit,We.retransmittedBytesSent),Wt(Qe,nn.Video_Send_Packages_Retransmit,We.retransmittedPacketsSent),Wt(Qe,nn.Video_Send_Key_Frames_Encoded,We.keyFramesEncoded);const nr=Ie.videoSend.find(qn=>qn.ssrc===ae);if(nr){let qn=hy*_T;nr.timestamp&&We.timestamp&&(qn=We.timestamp-nr.timestamp),nr.packets!=null&&We.packets!=null&&Wt(Qe,nn.Video_Send_Package_Rate,1e3*(We.packets-nr.packets)/qn),We.packetsLost!=null&&nr.packetsLost!=null&&Wt(Qe,nn.Video_Send_Package_Lost,We.packetsLost-nr.packetsLost),nr.bytes!=null&&We.bytes!=null&&Wt(Qe,nn.Video_Send_Bitrate,8*(We.bytes-nr.bytes)/qn)}}return Qe}(k[0].ssrcId,r,A,s,a),B=A.__className__==="CameraVideoTrack"?3:tt(G=A._hints).call(G,_r.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==B||d)&&(this.needUploadStats={sendType:B},this.lastExtendStats.sendType=B);const Z=A&&function(ae,ye,_e,ue){const Ie=ye.videoSend.find(We=>We.ssrc===ae);if(!Ie)return null;const Ue={};if(ue){const We=Ie.inputFrame,Qe=We&&We.height||_e.videoHeight||0,fn=We&&We.width||_e.videoWidth||0,vn=We&&We.frameRate||0;Wt(Ue,nn.Video_Capture_Height,Qe),Wt(Ue,nn.Video_Capture_Width,fn),Wt(Ue,nn.Video_Capture_Frame_Rate,vn)}return Ue}(k[0].ssrcId,r,A,!!a),Q=function(ae,ye){const _e={};return ye&&(Wt(_e,nn.Video_Send_Retransmit,ae.bitrate.retransmit),Wt(_e,nn.Video_Send_Target_Encoded,ae.bitrate.targetEncoded),Wt(_e,nn.Video_Send_Actual_Encoded,ae.bitrate.actualEncoded),Wt(_e,nn.Video_Send_Transmit,ae.bitrate.transmit),Wt(_e,nn.Video_Send_Bandwidth,ae.sendBandwidth)),_e}(r,!!a);g=Object.assign({},j,Z,Q)}else E=function(j,B,Z,Q,ae){const ye=B.videoSend.find(ue=>ue.ssrc===j);if(!ye)return;const _e={};if(Q){const ue=ye.sentFrame;ue&&(Wt(_e,nn.Video_Send_Low_Height,ue.height),Wt(_e,nn.Video_Send_Low_Width,ue.width),Wt(_e,nn.Video_Send_Low_Frame_Rate,ue.frameRate));const Ie=Q.videoSend.find(Ue=>Ue.ssrc===j);if(Ie){let Ue=hy*c1;Ie.timestamp&&ye.timestamp&&(Ue=ye.timestamp-Ie.timestamp),Ie.packets!=null&&ye.packets!=null&&Wt(_e,nn.Video_Send_Low_Package_Rate,1e3*(ye.packets-Ie.packets)/Ue),ye.packetsLost!=null&&Ie.packetsLost!=null&&Wt(_e,nn.Video_Send_Low_Package_Lost,ye.packetsLost-Ie.packetsLost),Ie.bytes!=null&&ye.bytes!=null&&Wt(_e,nn.Video_Send_Low_Bitrate,8*(ye.bytes-Ie.bytes)/Ue)}}return _e}(k[0].ssrcId,r,0,a);break;case Xe.LocalAudioTrack:m=A&&function(j,B,Z,Q,ae,ye){const _e=B.audioSend.find(Ie=>Ie.ssrc===j);if(!_e)return;const ue={};if(ae){ue[nn.Audio_Send_Disabled]=Z._originMediaStreamTrack&&!Z._originMediaStreamTrack.enabled||Z._mediaStreamTrack&&!Z._mediaStreamTrack.enabled?1:0;const Ie=100*Z._source.getAccurateVolumeLevel(),Ue=_e.inputLevel;if(Ue!=null){const Qe=Math.ceil(50*Math.log10(100*Ue+1));Wt(ue,nn.Audio_Send_Level,Qe)}Wt(ue,nn.Audio_Capture_PCM_Level,Ie),Wt(ue,nn.Audio_Send_AEC_Return_Loss,_e.aecReturnLoss),Wt(ue,nn.Audio_Send_AEC_Return_Loss_Enhancement,_e.aecReturnLossEnhancement),Wt(ue,nn.Audio_Send_Bytes_Retransmit,_e.retransmittedBytesSent),Wt(ue,nn.Audio_Send_Packages_Retransmit,_e.retransmittedPacketsSent),ue[nn.Audio_Send_Freeze]=0;const We=ae.audioSend.find(Qe=>Qe.ssrc===j);if(We){let Qe=hy*c1;We.timestamp&&_e.timestamp&&(Qe=_e.timestamp-We.timestamp),We.bytes!=null&&_e.bytes!=null&&Wt(ue,nn.Audio_Send_Bitrate,8*(_e.bytes-We.bytes)/Qe),We.packets!=null&&_e.packets!=null&&Wt(ue,nn.Audio_Send_Package_Rate,1e3*(_e.packets-We.packets)/Qe)}}return ue}(k[0].ssrcId,r,A,0,a)}}),{high:g,low:E,audio:m}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[g,E]=m;const b={peer:g.uid};if(E.has(Et.VIDEO)&&g.videoTrack){const I=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?function(k,G,j,B,Z,Q,ae,ye){const _e=G.videoRecv.find(Jt=>Jt.ssrc===k);if(!_e)return;const ue={},{receivedFrame:Ie,outputFrame:Ue,decodeFrameRate:We}=_e;Wt(ue,Ps.Video_Render_Frame_Rate_Decode,We),_e.framesRateFirefox&&Wt(ue,Ps.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ie&&Wt(ue,Ps.Video_Recv_Frame_Rate,Ie.frameRate),Wt(ue,Ps.Video_Recv_Frame_Dropped,_e.framesDroppedCount),Wt(ue,Ps.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),Wt(ue,Ps.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),Wt(ue,Ps.Video_Recv_Packages_Discarded,_e.packetsDiscarded),Wt(ue,Ps.Video_Recv_Avg_Decode,_e.avgDecodeMs),Wt(ue,Ps.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),Wt(ue,Ps.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),Wt(ue,Ps.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),Wt(ue,Ps.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Qe=ye&&ye.videoRecv.find(Jt=>Jt.ssrc===k);if(Qe){const Jt=G.timestamp-ye.timestamp||hy;_e.packetsLost!=null&&Qe.packetsLost!=null&&Wt(ue,Ps.Video_Recv_Package_Lost,_e.packetsLost-Qe.packetsLost),Qe.bytes!=null&&_e.bytes!=null&&Wt(ue,Ps.Video_Recv_Bitrate,8*(_e.bytes-Qe.bytes)/Jt),Qe.packets!=null&&_e.packets!=null&&Wt(ue,Ps.Video_Recv_Package_Rate,1e3*(_e.packets-Qe.packets)/Jt)}const fn=Q&&Q.videoRecv.find(Jt=>Jt.ssrc===k);if(fn&&(Wt(ue,qd.Video_Recv_Qp_Sum,_e.qpSumPerFrame),ue[qd.Video_Recv_Freeze]=B&&gT.isRemoteVideoFreeze(j,_e,fn)?1:0),ae){var vn;const Jt=ae.videoRecv.find(qn=>qn.ssrc===k);Ie?(Wt(ue,nn.Video_Recv_Height,Ie.height),Wt(ue,nn.Video_Recv_Width,Ie.width)):j&&(Wt(ue,nn.Video_Recv_Height,j._videoHeight||0),Wt(ue,nn.Video_Recv_Width,j._videoWidth||0)),Ue&&Wt(ue,nn.Video_Recv_Frame_Rate_Output,Ue.frameRate);const nr=(vn=j._player)===null||vn===void 0?void 0:vn.rendFrameRate.toFixed(0);if(nr&&Wt(ue,nn.Video_Render_Frame_Rate_Render,+nr),Wt(ue,nn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),Wt(ue,nn.Video_Recv_Current_Delay,_e.currentDelayMs),Wt(ue,nn.Video_Recv_Firs,_e.firsCount),Wt(ue,nn.Video_Recv_Nacks,_e.nacksCount),Wt(ue,nn.Video_Recv_Plis,_e.plisCount),j){ue[nn.Video_Recv_Disabled]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const qn=j._player;if(qn){const{freezeTimeCounterList:so,renderFreezeAccTime:ze,renderFreezeAccTime2:rt,videoElementStatus:St}=qn;if(so&&so.length>0&&Wt(ue,qd.Video_Render_Freeze_Time,so.splice(0,1)[0]),Z&&Qh.visibility==="visible"&&St===to.PLAYING&&Fn().supportRequestVideoFrameCallback){const He=Math.min(6e3,rt);qn.renderFreezeAccTime2=Math.max(0,rt-He),Wt(ue,qd.Video_Render_Freeze_Time_Render2,He);const U=Math.min(6e3,ze);qn.renderFreezeAccTime=Math.max(0,ze-U),Wt(ue,qd.Video_Render_Freeze_Time_Render,oe("USE_NEW_RENDER_FREEZE_TIME")?He:U)}if(typeof _e.totalFreezesDuration=="number"){const He=Jt&&Jt.totalFreezesDuration?_e.totalFreezesDuration-Jt.totalFreezesDuration:_e.totalFreezesDuration;Wt(ue,nn.Video_Render_Freeze_Duration,1e3*He)}}}if(ue[nn.Video_Recv_Player_Status]=c2[j._player?j._player.videoElementStatus:"uninit"],Jt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Jt.totalInterFrameDelay!==void 0&&Jt.totalSquaredInterFrameDelay!==void 0){const qn=_e.totalInterFrameDelay-Jt.totalInterFrameDelay,so=_e.totalSquaredInterFrameDelay-Jt.totalSquaredInterFrameDelay,ze=_e.framesDecodeCount-Jt.framesDecodeCount,rt=qn/ze*1e3,St=Math.round(1e3*Math.sqrt((so-Math.pow(qn,2)/ze)/ze));!isNaN(St)&&rt+St>Math.max(3*rt,rt+150)&&(ue[nn.Video_Recv_I_Frame_Delay]=St)}}return ue}(g._videoSSRC,r,g.videoTrack,I===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;A&&(b.video=A)}if(E.has(Et.AUDIO)&&g.audioTrack){const I=g.audioTrack?function(A,k,G,j,B,Z){const Q=k.audioRecv.find(ue=>ue.ssrc===A);if(!Q)return;const ae={};Wt(ae,Ps.Audio_Recv_Jitter,Q.jitterMs),Wt(ae,Ps.Audio_Recv_Bytes_Retransmit,Q.retransmittedBytesReceived),Wt(ae,Ps.Audio_Recv_Packages_Retransmit,Q.retransmittedPacketsReceived),Wt(ae,Ps.Audio_Recv_Packages_Discarded,Q.packetsDiscarded),Wt(ae,Ps.Audio_Recv_Avg_Processing_Delay,Q.avgProcessingDelayMs);const ye=Z&&Z.audioRecv.find(ue=>ue.ssrc===A);if(ye){const ue=hy;Q.packets!=null&&ye.packets!=null&&Wt(ae,Ps.Audio_Recv_Package_Rate,1e3*(Q.packets-ye.packets)/ue),Q.packetsLost!=null&&ye.packetsLost!=null&&Wt(ae,Ps.Audio_Recv_Package_Lost,Q.packetsLost-ye.packetsLost)}if(j){const{receivedFrames:ue,droppedFrames:Ie}=Q;ue!=null&&Ie!=null&&(ae[qd.Audio_Recv_Freeze]=(_e=ue)===0||100*Ie/_e>20?1:0)}var _e;if(B){const ue=100*G._source.getAccurateVolumeLevel(),Ie=Q.outputLevel;if(Ie!=null){const We=Math.ceil(50*Math.log10(100*Ie+1));Wt(ae,nn.Audio_Render_Level,We)}Wt(ae,nn.Audio_Recv_PCM_Level,ue),G&&(ae[nn.Audio_Recv_Disabled]=G._originMediaStreamTrack.enabled&&G._mediaStreamTrack.enabled?0:1),Wt(ae,nn.Audio_Recv_Jitter_Buffer,Q.jitterBufferMs),Wt(ae,nn.Audio_Recv_Current_Delay,Q.jitterBufferMs),ae[nn.Audio_Recv_Player_Status]=c2[Aa.getPlayerState(G.getTrackId())];const Ue=B.audioRecv.find(We=>We.ssrc===A);if(Ue){Ue.bytes!=null&&Q.bytes!=null&&Wt(ae,nn.Audio_Recv_Bitrate,8*(Q.bytes-Ue.bytes)/(hy*_T));const We=Q.concealedSamples-Ue.concealedSamples;We>0&&Wt(ae,nn.Audio_Recv_Concealed_Samples,We);const Qe=Q.totalSamplesReceived-Ue.totalSamplesReceived;Qe>0&&Wt(ae,nn.Audio_Recv_Total_Samples_Received,Qe);const fn=Q.freezeSamples80-Ue.freezeSamples80;fn>0&&Wt(ae,nn.Audio_Render_Freeze_Samples_80ms,fn);const vn=Q.freezeSamples200-Ue.freezeSamples200;vn>0&&Wt(ae,nn.Audio_Render_Freeze_Samples_200ms,vn);const Jt=Q.freezeMs80-Ue.freezeMs80;Wt(ae,nn.Audio_Render_Freeze_Time_80ms,Jt<0?0:Jt);const nr=Q.freezeMs200-Ue.freezeMs200;Wt(ae,nn.Audio_Render_Freeze_Time_200ms,nr<0?0:nr)}}return ae}(g._audioSSRC,r,g.audioTrack,s,a,c):void 0;I&&(b.audio=I)}(b.video||b.audio)&&h.push(b)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof iT);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(oT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(Et.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(Et.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of d)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,b]of h)b.has(Et.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),b.has(Et.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(E,b){const I={};for(const{id:j,value:B,level:Z,direction:Q}of E){var A;const ae=(A=b.get(j))!==null&&A!==void 0?A:0,ye=B===2?ae+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var k,G;b.set(j,ye),I[j]?(B===2&&(I[j].value=B),Z>I[j].level&&(I[j].level=Z),Q==="remote"&&(I[j].remoteUidCount+=1),I[j].totalTs=(k=b.get(j))!==null&&k!==void 0?k:0):I[j]={value:B,level:Z,remoteUidCount:Q==="local"?0:1,totalTs:(G=b.get(j))!==null&&G!==void 0?G:0}}return Object.keys(I).map(j=>{const{level:B,value:Z,totalTs:Q}=I[j];return{id:j,level:B,value:Z,totalTs:Q}})}(c,r);const m=Date.now(),g=m>s?m:s+1;this.requestUpload&&this.requestUpload(oT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const I_e=oe("ICE_RESTART_INTERVAL");let l1=new Map,fS=new Map,ng=[ro.UDP_TCP_RELAY,ro.TCP_RELAY,ro.RELAY],oM=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fn().supportPCSetConfiguration;function h7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=l1.get(t.id);s&&(window.clearTimeout(s),l1.delete(t.id));const a=fS.get(t.id);r&&a&&a.index===ng.length-1&&(L.debug("[".concat(t.id,"] reset ICE restart policy")),fS.delete(t.id))}function p7(t,r,s){if(l1.size===0&&fS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,g){if(m.length!==g.length)return!1;for(let E=0;E<m.length;E+=1){const b=m[E];if(m.filter(I=>I===b).length!==g.filter(I=>I===b).length)return!1}return!0}(ng,oe("RESTART_SEQUENCE"))&&(ng=oe("RESTART_SEQUENCE").filter(m=>{var g;if(tt(g=Object.values(ro)).call(g,m))return!0}),L.debug("use reconnection policy from config distribution, queues: ".concat(ng.join(" => ")))),oM=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fn().supportPCSetConfiguration),ng.length===0)return void s();let a,{index:c=0,type:d}=fS.get(t.id)||{};if(oM&&d===ro.RELAY)return void s();let h=d&&c>=ng.length-1;if(oM)d=ro.RELAY;else{if(h)return void s();d?(c++,d=ng[c]):(d=ng[0],c=0)}L.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),fS.set(t.id,{index:c,type:d}),a=window.setTimeout(()=>p7(t,r,s),I_e),l1.set(t.id,a)}var wn;function f7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function tp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?f7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function m7(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=SL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new u1(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function u1(t){function r(s){if(Object(s)!==s)return gt.reject(new TypeError(s+" is not an object."));var a=s.done;return gt.resolve(s.value).then(function(c){return{value:c,done:a}})}return u1=function(s){this.s=s,this.n=s.next},u1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?gt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?gt.reject(s):r(a.apply(this.s,arguments))}},new u1(t)}let yT=(wn=class extends Jr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),Y(this,"isPlanB",void 0),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"connection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"remoteDataChannelMap",new Map),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"pendingLocalDataChannels",[]),Y(this,"pendingRemoteDataChannels",[]),Y(this,"statsCollector",void 0),Y(this,"shouldForwardP2PCreation",void 0),Y(this,"iceFailedCount",0),Y(this,"dtlsFailedCount",0),Y(this,"mutex",void 0),Y(this,"_state",ir.Disconnected),Y(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?gf.FIRST_CONNECTION:gf.OLD_FIRST_CONNECTION),Y(this,"_isStartRestartIce",!1),Y(this,"_restartTimer",void 0),Y(this,"_isTryConnecting",!1),Y(this,"_iceError",null),Y(this,"_forceTurn",!1),Y(this,"_isWaitPcToRePub",!1),Y(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];this.store.enableInstantMuteRestore?(E.track._originMediaStreamTrack.enabled=!1,L.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):E.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?L.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const g=this.createMuteMessage(h);await yr(this,Vt.RequestMuteLocal,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ir.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(this.store.enableInstantMuteRestore)E.track._originMediaStreamTrack.enabled=!0,L.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(E.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const b=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=b,E.track._originMediaStreamTrack=b}else{const b=sM(s,Jw(this,Vt.RequestLowStreamParameter));E.track._mediaStreamTrack=b,E.track._originMediaStreamTrack=b}await new gt((b,I)=>{this.handleReplaceTrack(E.track,b,I,!0)})}}this.store.enableInstantMuteRestore?L.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const g=this.createUnmuteMessage(h);await yr(this,Vt.RequestUnmuteLocal,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!g||g.track!==s||this.state!==ir.Connected)return void a();const{id:E,track:b}=g;await this.connection.updateSendParameters(E,b),await this.connection.updateEncoderConfig(E,b),this.emit(Vt.UpdateVideoEncoder,b),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),Y(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==ir.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==ir.Connected)return void a();const h=rM([s]);let m;L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(E){c(E)}finally{var g;(g=m)===null||g===void 0||g()}}),Y(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:I}]=b;return s===I});if(!this.connection||!E||this.state!==ir.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const b=E[1];b.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],b)}if(E[0]===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const b=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(b){const I=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=I,b.track._originMediaStreamTrack=I,await new gt((A,k)=>{this.handleReplaceTrack(b.track,A,k,!0)})}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),Y(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new d7(this.store),this.bindStatsUploaderEvents(),this.mutex=new eo("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Fn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&hf(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Fn().supportPCSetConfiguration&&LL(),this.shouldForwardP2PCreation&&(this.connection=o1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var s;this.state=ir.New,this._forceTurn=o7(t),L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||r)&&((a||r)&&this.connection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=o1(this.store,t),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?gf.FIRST_CONNECTION:gf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===ir.Connected){if(this.connection instanceof Kl&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Pt.reportApiInvoke(this.store.sessionId,{name:di.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:$r.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(Vt.RequestReconnect)});await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return tt(d=[Xe.LocalVideoLowTrack,Xe.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),a=r.map(c=>{let[d]=c;return d});if(this.connection instanceof Kl){if(Pt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!tt(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>tt(t).call(t,d));c&&(this.store.codec=c,L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Kl&&this.connection.peerConnectionState!=="closed"&&tt(t=[ir.New,ir.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==ir.Connected){if(this.state===ir.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;tt(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return Bl(function*(){const c=yield Vn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&tt(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==ir.Connected||h){if(a.state===ir.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const g=t.filter(E=>a.pendingLocalTracks.indexOf(E)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,io.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Vn(a.tryToUnmuteAudio(t)));yield*nP(m7(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Bl(function*(){r.forEach(A=>{let{track:k,type:G}=A;const j=Date.now();s.store.publish(k.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const a=r.map(A=>{let{track:k}=A;return k}),c=yield Vn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield Vn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===ee.WS_ABORT&&r.forEach(k=>{let{track:G}=k;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),A}const g=s.mapPubResToRemoteConfig(h,m,a),E=(yield Vn(c.next(g))).value;if(s.state===ir.Disconnected)throw new Le(ee.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const b=oe("ENABLE_ENCODED_TRANSFORM"),I=oe("ENABLE_AUDIO_METADATA");a.forEach(async A=>{const k=A.getRTCRtpTransceiver();if(!k||!b)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=JP();A.trackMediaType===Et.VIDEO?await G(k.sender,A):A.trackMediaType===Et.AUDIO&&await j(k.sender,{metadata:I?()=>{const B=A.metadata.shift();return B&&B.value}:void 0})}),r.forEach(A=>{let{type:k}=A;s.statsCollector.addLocalStats(k)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(A=>{let{track:k,type:G}=A;const j=Date.now();s.store.publish(k.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Nr))return L.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=F2(d,h)),m.maxFramerate=d.framerate?Pc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Xe.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return L.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=Pc(m.width)),m.height&&(g.height=Pc(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=u2(()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()},Pc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),L.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Bl(function*(){if(!r.connection||r.state!==ir.Connected)return;const s=yield Vn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Xe.LocalVideoTrack);if(!c)throw new Le(ee.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Xe.LocalVideoLowTrack))throw new Le(ee.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Xe.LocalVideoLowTrack}];if(yield*nP(m7(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Xe.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Vn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await js(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(L.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await js(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==Et.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==Et.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await js(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===Et.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==ir.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==ir.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ir.Connected)return;const t=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Xe.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==ir.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:g}=h;return m.uid===t.uid&&g===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==ir.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,g,E;const b=this.connection.getPreMedia(s);if(b)L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),g=b.transceiver,h=b.track,m=b.mid,E=b.player,b.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:b.firstVideoRender});else if(c){const k=c.find(j=>{let{stream_type:B}=j;return B===r});if(!k)throw new Le(ee.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const G=await this.connection.receive(r,k.ssrcs,String(t._uintid),k.attributes);this.connection instanceof Kl&&(g=G.transceiver),h=G.track,m=G.id}else{const k=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof Kl&&(g=k.transceiver),h=k.track,m=k.id}if(r===Et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new tS(h,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new eS(h,t.uid,t._uintid,this.store,E),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(Gl.PLAY_START,()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})}),t._videoTrack.once(Gl.PLAY_END,()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)}),E?t._videoTrack.once(Gl.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}):t._videoTrack.once(Gl.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:G}=JP();r==Et.VIDEO?await k(g.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(j=>{var B;return(B=t._videoTrack)===null||B===void 0?void 0:B._onSei(j)})}):r==Et.AUDIO&&await G(g.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:j=>{this.safeEmit(Vt.AudioMetadata,j)},onPts:j=>{this.safeEmit(Vt.AudioPts,j)}})}const I=this.remoteUserMap.get(t);I?I.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(k=>{let{user:G,kind:j}=k;return G.uid===t.uid&&r===j});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==ir.Connected)throw new Le(ee.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:m,transceiver:g,player:E}=d;s.set(c.ssrcId,{track:h,id:m,transceiver:g,player:E})}else r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:g,id:E,transceiver:b,player:I}=m;if(b&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:G,interceptRemoteAudioFrame:j}=JP();d==Et.VIDEO?await G(b.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(B=>{var Z;return(Z=c._videoTrack)===null||Z===void 0?void 0:Z._onSei(B)})}):d==Et.AUDIO&&await j(b.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:B=>{this.safeEmit(Vt.AudioMetadata,B)},onPts:B=>{this.safeEmit(Vt.AudioPts,B)}})}if(d===Et.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new tS(g,c.uid,c._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),b&&c._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new eS(g,c.uid,c._uintid,this.store,I),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),b&&c._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&b){const{interceptRemoteVideoFrame:G,interceptRemoteAudioFrame:j}=JP();d==Et.VIDEO?await G(b.receiver,{onSei:B=>{var Z;(Z=c._videoTrack)===null||Z===void 0||Z._onSei(B)}}):d==Et.AUDIO&&await j(b.receiver)}const A=this.remoteUserMap.get(c);A?A.set(d,E):this.remoteUserMap.set(c,new Map([[d,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const k=this.pendingRemoteTracks.findIndex(G=>{let{user:j,kind:B}=G;return j.uid===c.uid&&d===B});k!==-1&&(this.pendingRemoteTracks.splice(k,1),this.emit(Vt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===ir.Connected||s||a.forEach(h=>{let{kind:m}=h;var g;if(m===Et.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===Et.VIDEO){var E;(E=t._videoTrack)===null||E===void 0||E._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==ir.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:g}]=h;var E,b;if(g===Et.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===Et.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((b=m._videoTrack)===null||b===void 0||b._destroy(),m._videoTrack=void 0);else if(g===Et.AUDIO){var I;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((I=m._audioTrack)===null||I===void 0||I._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:g,kind:E}=m;return d!==void 0?g.uid===c.uid&&d===E:g.uid===c.uid});h.forEach(m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)}),r=r.concat(h)}if(!this.connection||this.state!==ir.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===Et.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===Et.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}});const s=Ka(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,g;if(h===Et.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Et.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===Et.AUDIO){var E;this.unbindRemoteTrackEvents(d._audioTrack),(E=d._audioTrack)===null||E===void 0||E._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==ir.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Et.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Wi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Xe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Pt.publish(this.store.sessionId,{eventElapse:io.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(g=>g instanceof ai),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(g=>g instanceof Nr);Pt.publish(this.store.sessionId,{eventElapse:io.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&Pt.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Et.VIDEO,audio:a===Et.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:io.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new eo("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=o1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Wi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ir.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Nr||r&&r.track instanceof ai?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(ec(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=G_(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=o1(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:tt(r=a._hints).call(r,_r.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Wi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ec(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ec(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Bl(function*(){if(!r.connection||r.state!==ir.Connected)return;const s=yield Vn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Vn(r.connection.restartICE(t));const d=yield Vn(a.next());if(d.done)return;const h=d.value,m=yield h;switch(iM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case ro.UDP_TCP_RELAY:r._pcStatsUploadType=gf.UDP_TCP_RESTART;break;case ro.TCP_RELAY:r._pcStatsUploadType=gf.TCP_RESTART;break;case ro.RELAY:r._pcStatsUploadType=gf.RELAY_RESTART;break;default:r._pcStatsUploadType=gf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find(k=>k.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(k=>k.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const d=Qc(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,b=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(_r.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(k&&G){const j=(1e3*k-G)/(1e3*k);return tH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const g=Qc(this,Vt.NeedSignalRTT),E=t.rtt,b=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let k=.7*A*100/50+.3*b/1500;I&&(k=.6*A*100/50+.2*b/1500+.2*I/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new gt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(L.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==ir.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new gt((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Bv(t=t.filter(g=>c.indexOf(g)===-1));let d,h=!1;const m=this.localTrackMap.get(Xe.LocalAudioTrack);for(const g of t){if(g instanceof Nr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:Xe.LocalVideoLowTrack})}if(g instanceof ai)if(m){const E=m.track;if(E instanceof Wi)nM([g]),E.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const b=rM([E,g]);L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(b.getTrackId(),"]")),this.replaceTrack(E,b)}}else d instanceof Wi?(nM([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&Fn().webAudioMediaStreamDest&&!g._bypassWebAudio?d=rM(d?[g,d]:[g]):d=g}return d&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Xe.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ai){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Wi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Nr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Bv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Bv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(Ct.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ct.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Wi?t.trackList.forEach(s=>{s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(Ct.GET_STATS,this.handleGetLocalVideoStats),s.off(Ct.GET_RTC_STATS,this.handleGetRTCStats),s.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Wi?t.trackList.forEach(r=>{r.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ct.GET_STATS,this.handleGetLocalAudioStats),r.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ct.GET_STATS,this.handleGetLocalAudioStats),t.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ct.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof eS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof tS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,h,{track:m,type:g}=s;switch(g){case Xe.LocalAudioTrack:d=or.Audio,h={dtx:m instanceof iT&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Xe.LocalVideoTrack:d=tt(c=m._hints).call(c,_r.SCREEN_TRACK)?or.Screen:or.High,h=tp(tp({},_H(m)),{},{codec:this.store.codec,svc_mode:$P()});break;case Xe.LocalVideoLowTrack:d=or.Low,h=tp(tp({},_H(m)),{},{codec:this.store.codec,svc_mode:$P()})}return{stream_type:d,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Kl&&!ei()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Kl&&h7(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=gf.DISCONNECTED_OR_FAILED,Qc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Pt.reportApiInvoke(this.store.sessionId,{name:di.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:$r.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof Kl&&!ei()&&!this._forceTurn){if(tt(dH).call(dH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{iM(t)&&(L.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Qc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,c))},a=()=>{iM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),L.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{p7(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Qc(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Gl.FIRST_FRAME_DECODED),Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_AUDIO_DECODE,Br.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_AUDIO_RECEIVED,Br.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{var c;const d=Array.from(ec(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===r);d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoRender=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},t.onFirstVideoReceived=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_VIDEO_RECEIVED,Br.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return tp(tp({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Kl&&function(r){fS.delete(r.id),h7(r)}(t),t.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ai&&(s==null?void 0:s.track)instanceof Wi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ai&&(s==null?void 0:s.track)instanceof Wi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case Et.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:a._videoSSRC}));case Et.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===Et.VIDEO?d|=os.Video:d|=os.Audio,r.set(a,d)}else c===Et.VIDEO?r.set(a,os.Video):r.set(a,os.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new gt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new gt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Kl&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Kl&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find(g=>{let{stream_type:E}=g;return h===E}))===null||d===void 0?void 0:d.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const g=s[c]._hints;(tt(g).call(g,_r.SCREEN_TRACK)||tt(g).call(g,_r.SCREEN_LOW_TRACK))&&(m.remb=!1,L.debug("disable remb for screen share, hints:",g))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof ai){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(a);return void await yr(this,Vt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rs(WL(this.dtlsFailedCount,Vi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await js(this,Vt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Nr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Nr).length>1)throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ai).length>1&&(t.some(r=>r instanceof ai&&r._bypassWebAudio)||!Fn().webAudioMediaStreamDest))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Nr&&this.pendingLocalTracks.some(s=>s instanceof Nr))throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ai&&this.pendingLocalTracks.some(s=>s instanceof ai)&&(!Fn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ai&&s._bypassWebAudio)))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding,c=tp(tp({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():sM(t,c);const h=Er(8,"track-low-"),m=new Nr(d,tp(tp({},a&&{scaleResolutionDownBy:F2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ry.TRANSCEIVER_UPDATED,g=>{t._updateRtpTransceiver(g,qv.LOW_STREAM)}),m._hints.push(_r.LOW_STREAM),tt(s=t._hints).call(s,_r.SCREEN_TRACK)&&m._hints.push(_r.SCREEN_LOW_TRACK),t.on("sei-to-send",g=>{m.emit("sei-to-send",g)}),t.addListener(Ct.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Kl){var c,d,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:b,peerConnectionState:I}=this.connection,{local:A,remote:k}=await this.connection.getSelectedCandidatePair();Pt.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:E,dtlsstate:b,connectionstate:I,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=A.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,s=r.firstVideoFrameDecoded.find(b=>b.userId===t.uid);if(!s)return;const{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=s;let{firstRender:E=0}=s;if(d&&(E||h)&&m&&g){s.isInternalUpload=!0;const{playEnd:b}=s;b&&(s.isExternalUpload=!0);const{firstPreRender:I=0}=s;E=I||E;const A=t.videoTrack,k={peer:t._uintid,width:(A==null?void 0:A._videoWidth)||0,height:(A==null?void 0:A._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:I||0,firstRender:b?Math.max(E,b):Math.max(E,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:BW(this.store)};Pt.firstXLAPeerFirstVideoFrame(this.store.sessionId,k)}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(ec(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===d.uid&&g.type==="video");Pt.firstRemoteVideoDecode(this.store.sessionId,Qi.FIRST_VIDEO_DECODE,Br.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(wn.prototype,"startP2PConnection",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"startP2PConnection"),wn.prototype),It(wn.prototype,"connect",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"connect"),wn.prototype),It(wn.prototype,"updateRemoteRTPCapabilities",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"updateRemoteRTPCapabilities"),wn.prototype),It(wn.prototype,"publishDataChannel",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"publishDataChannel"),wn.prototype),It(wn.prototype,"unpublish",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublish"),wn.prototype),It(wn.prototype,"unpublishDataChannel",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishDataChannel"),wn.prototype),It(wn.prototype,"unpublishLowStream",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unpublishLowStream"),wn.prototype),It(wn.prototype,"subscribeDataChannel",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"subscribeDataChannel"),wn.prototype),It(wn.prototype,"subscribe",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"subscribe"),wn.prototype),It(wn.prototype,"massSubscribe",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"massSubscribe"),wn.prototype),It(wn.prototype,"unsubscribe",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribe"),wn.prototype),It(wn.prototype,"unsubscribeDataChannel",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unsubscribeDataChannel"),wn.prototype),It(wn.prototype,"massUnsubscribe",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"massUnsubscribe"),wn.prototype),It(wn.prototype,"muteRemote",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"muteRemote"),wn.prototype),It(wn.prototype,"unmuteRemote",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"unmuteRemote"),wn.prototype),It(wn.prototype,"hasRemoteMediaWithLock",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"hasRemoteMediaWithLock"),wn.prototype),It(wn.prototype,"disconnectForReconnect",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"disconnectForReconnect"),wn.prototype),It(wn.prototype,"updateBitrateLimit",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"updateBitrateLimit"),wn.prototype),It(wn.prototype,"remoteMediaSsrcChanged",[Mo],Object.getOwnPropertyDescriptor(wn.prototype,"remoteMediaSsrcChanged"),wn.prototype),wn);function Mo(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function g7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function _7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const A_e=Date.now(),P_e=20,aM=new Map,d1=new Map;async function y7(t){const r=aM.get(t),s=Array.isArray(r)&&r[r.length-1],a=d1.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),E7(s.context,c),m=0):m=Math.min(m,P_e),setTimeout(()=>r.length&&y7(t),m)}function E7(t,r){t.safeEmit(Cn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function k_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return E7(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=aM.get(a)||[],d=c.findIndex(E=>t.sendTs>=E.sendTs),h=_7(_7({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),aM.set(a,c);let m=!1;var g;d1.has(a)?m=!((g=d1.get(a))===null||g===void 0||!g.isSyncing):d1.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||y7(a)}const O_e=xn().name;function v7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function S7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v7(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const mS="websdk_ng_cache_parameter",N_e=oe("MAX_PRELOAD_ASYNC_LENGTH"),x_e=1e4,py=new Map,fy=[];let cM=null,lM=0,uM=0;const h1=new Map,D_e=function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new gt(async(g,E)=>{s.push(async()=>{try{const b=await t(...h);g(b)}catch(b){E(b)}}),a<r&&(a++,c())})}}(b7,N_e),dM=Ia.CancelToken.source();async function b7(t,r,s,a,c,d){try{if(!oe("ENABLE_PRELOAD"))return;if(!Fn().supportWebCrypto)return void Wm(()=>{L.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(ee.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Cs(s,"token",1,2047),Cs(t,"appid",1,2047),jP(r),a&&BP(a);const h=ty();L.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let g,E;typeof a=="string"?(m.stringUid=a,[E,g]=await gt.all([__e(a,{sid:h,appId:t},dM.token),qH(S7(S7({},m),{},{token:s||t,uid:0}),dM.token)]),m.uid=E.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),g=await qH(m,dM.token));const b={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:g};await async function(I){let A;try{I.uid&&T7({appId:I.appId,cname:I.cname,token:I.token,uid:I.uid,stringUid:I.stringUid});const k=A7(I),G=await async function(B,Z){try{const Q=await window.crypto.subtle.importKey("raw",fW(Z),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Q,ey(window.btoa(JSON.stringify(B))));return Gm(new Uint8Array(ae))}catch{return}}(I,I.token||I.appId);if(!G)return;A=I7(mS);const j=A?JSON.parse(A):[];j.push({[k]:G}),j.length>oe("AP_CACHE_NUM")&&j.shift(),p1(mS,JSON.stringify(j))}catch(k){L.warn("Error caching server parameters:",k.message),p1(mS,"")}}(b),lM++}catch(h){throw uM++,function(m){cM||(cM=window.setTimeout(()=>{let E="";h1.forEach((b,I)=>{E+="".concat(I,": ").concat(b," ;")}),Pt.reportApiInvoke(null,{name:di.PRELOAD,options:{success:lM,failed:uM,err:E}}).onError(m),lM=0,uM=0,h1.clear(),cM=null},x_e));const g=h1.get(m.code)||0;h1.set(m.code,g+1)}(h),h}}async function w7(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=T7(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",fW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,ey(a));return JSON.parse(window.atob(Gm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){L.warn("Error get preloadInfo",r.message)}}function T7(t){let r;try{if(r=I7(mS),!r)return;const s=JSON.parse(r),a=A7(t),c=function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1}(s,h=>a in h);if(c===-1)return;const d=s.splice(c,1)[0];return p1(mS,JSON.stringify(s)),d[a]}catch(s){L.warn("Error delete preload info: ".concat(r),s.message),p1(mS,"")}}function hM(t){if(t){let r=py.get(t);r&&(window.clearTimeout(r),r=null,py.delete(t)),tt(fy).call(fy,t)||t.cloudProxyServer!=="disabled"||fy.push(t)}if(py.size<oe("AP_CACHE_NUM")&&fy.length>0){const r=fy.shift();py.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await D_e(s,a,c,h,m,d),py.has(r)&&hM(r)}catch(g){L.warn("update preload failed",g.message),C7(r)}},oe("AP_UPDATE_INTERVAL")))}}function C7(t){const r=fy.indexOf(t);r!==-1&&fy.splice(r,1);let s=py.get(t);s&&(window.clearTimeout(s),s=null,py.delete(t),hM())}function R7(t,r){const s=t.sua,a=t.ap;r&&s&&Pt.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Pt.reportResourceTiming(t.ap.url,t.sid),Pt.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK].toString()}),Pt.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function I7(t){return window.atob(window.localStorage.getItem(t)||"")}function p1(t,r){window.localStorage.setItem(t,window.btoa(r))}function A7(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),SW(r)}function L_e(t){let r=function(){const s=V_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Ii(a,10),rg(a,c));let d=s.cid;d!==void 0&&(Ii(a,16),Ii(a,d));let h=s.cname;h!==void 0&&(Ii(a,26),rg(a,h));let m=s.deviceId;m!==void 0&&(Ii(a,34),rg(a,m));let g=s.elapse;g!==void 0&&(Ii(a,40),ig(a,g));let E=s.fileSize;E!==void 0&&(Ii(a,48),ig(a,gS(E)));let b=s.height;b!==void 0&&(Ii(a,56),ig(a,gS(b)));let I=s.jpg;I!==void 0&&(Ii(a,66),Ii(a,I.length),k7(a,I));let A=s.networkType;A!==void 0&&(Ii(a,72),ig(a,gS(A)));let k=s.osType;k!==void 0&&(Ii(a,80),ig(a,gS(k)));let G=s.requestId;G!==void 0&&(Ii(a,90),rg(a,G));let j=s.sdkVersion;j!==void 0&&(Ii(a,98),rg(a,j));let B=s.sequence;B!==void 0&&(Ii(a,104),ig(a,gS(B)));let Z=s.sid;Z!==void 0&&(Ii(a,114),rg(a,Z));let Q=s.timestamp;Q!==void 0&&(Ii(a,120),ig(a,Q));let ae=s.uid;ae!==void 0&&(Ii(a,128),Ii(a,ae));let ye=s.vid;ye!==void 0&&(Ii(a,136),Ii(a,ye));let _e=s.width;_e!==void 0&&(Ii(a,144),ig(a,gS(_e)));let ue=s.service;ue!==void 0&&(Ii(a,152),Ii(a,ue));let Ie=s.callbackData;Ie!==void 0&&(Ii(a,162),Ii(a,Ie.length),k7(a,Ie));let Ue=s.ticket;Ue!==void 0&&(Ii(a,170),rg(a,Ue));let We=s.vendorConfigs;We!==void 0&&(Ii(a,178),rg(a,We))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function M_e(t){return function(s){let a={};e:for(;!F_e(s);){let c=ET(s);switch(c>>>3){case 0:break e;case 1:a.code=ET(s);break;case 2:a.msg=O7(s,ET(s));break;case 3:a.requestId=O7(s,ET(s));break;case 4:a.timestamp=j_e(s,!1);break;default:U_e(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function U_e(t,r){switch(r){case 0:for(;128&zu(t););break;case 2:pM(t,ET(t));break;case 5:pM(t,4);break;case 1:pM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function gS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let V_e=[];function pM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function F_e(t){return t.offset>=t.limit}function f1(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function P7(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function k7(t,r){let s=f1(t,r.length);t.bytes.set(r,s)}function O7(t,r){let s=P7(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,b,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],b=c[m+s+3],(12632256&(g|E<<8|b<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&b,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function rg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Ii(t,a);let c=f1(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function zu(t){return t.bytes[P7(t,1)]}function N7(t,r){let s=f1(t,1);t.bytes[s]=r}function ET(t){let r,s=0,a=0;do r=zu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Ii(t,r){for(r>>>=0;r>=128;)N7(t,127&r|128),r>>>=7;N7(t,r)}function j_e(t,r){let s,a=0,c=0,d=0;return s=zu(t),a=127&s,128&s&&(s=zu(t),a|=(127&s)<<7,128&s&&(s=zu(t),a|=(127&s)<<14,128&s&&(s=zu(t),a|=(127&s)<<21,128&s&&(s=zu(t),c=127&s,128&s&&(s=zu(t),c|=(127&s)<<7,128&s&&(s=zu(t),c|=(127&s)<<14,128&s&&(s=zu(t),c|=(127&s)<<21,128&s&&(s=zu(t),d=127&s,128&s&&(s=zu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function ig(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=f1(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const x7={},D7={},m1=4294967296,B_e=m1*m1,z_e=B_e/2;M7(0,!0);const L7=M7(0),W_e=vT(0,-2147483648,!1),G_e=vT(-1,2147483647,!1);function M7(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=D7[t],a)?a:(s=vT(t,0,!0),c&&(D7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=x7[t],a)?a:(s=vT(t,t<0?-1:0,!1),c&&(x7[t]=s),s)}function vT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function U7(t,r){if(isNaN(t))return L7;{if(t<=-9223372036854776e3)return W_e;if(t+1>=z_e)return G_e}return t<0?L7:vT(t%m1|0,t/m1|0,r)}function V7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class fM extends Jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Hd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),Y(this,"name","AgoraRTCImageModeration"),Y(this,"_connectionState",$l.CONNECTING),Y(this,"_sequence",0),Y(this,"_moderationStartTime",void 0),Y(this,"_workerConnection",void 0),Y(this,"_workerMessageLengthLimit",void 0),Y(this,"_qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",Ia.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"_moderationInterval",void 0),Y(this,"_moderationTimer",null),Y(this,"_moderationMode",1),Y(this,"_quality",1),Y(this,"_qualityTimer",null),Y(this,"_ticket",void 0),Y(this,"_moderationIntervalMinimum",void 0),Y(this,"_uploadFailedNum",0),Y(this,"_uploadNum",0),Y(this,"_uploadTimer",null),Y(this,"_extraInfo",void 0),Y(this,"_vendor",""),Y(this,"_encoder",new TextEncoder),Y(this,"_moderationId",void 0),Y(this,"inspectImage",()=>{if(this.connectionState!==$l.CONNECTED)throw new Oe(ee.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===$l.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Er(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new lT("worker-"+this._moderationId,Vi),this.on(Hd.STATE_CHANGE,(a,c)=>{L.debug("[".concat(this._moderationId,"] Moderation operation :").concat(sS[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Hd.STATE_CHANGE,sS.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new gt((c,d)=>{this.on(Hd.CONNECTION_STATE_CHANGE,(h,m)=>{h===$l.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),L.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===$l.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(g=>"https://".concat(g,"/api/v1")),d=await function(g,E,b,I){let{appId:A,areaCode:k,cname:G,sid:j,token:B,uid:Z}=E;dS++;const Q="moderation_plugin",ae={service_name:Q,json_body:JSON.stringify({appId:A,areaCode:k,cname:G,command:"allocateEdge",requestId:dS,seq:dS,sid:j,appToken:B,ts:Date.now(),uid:Z+""})};let ye,_e,ue=g[0];return Bd(async()=>{ye=Date.now();const Ie=await $d(ue,{data:ae,cancelToken:b,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ye,Ie.code!==0){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ie.code,{retry:!0,responseTime:_e});throw L.error(Qe.toString()),Qe}const Ue=JSON.parse(Ie.json_body);if(Ue.code!==200){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:_e});throw L.error(Qe.toString()),Qe}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:_e});throw L.error(Qe.toString()),Qe}if(!Ue.servers.some(Qe=>!!Qe.wss)){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:_e});throw L.error(Qe.toString()),Qe}const We=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map(Qe=>{let{address:fn,wss:vn}=Qe;if(fn&&vn)return"wss://".concat(fn.replace(/\./g,"-"),".").concat(We,":").concat(vn,"/moderation")}).filter(Qe=>!!Qe),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:_e}},(Ie,Ue)=>(Pt.apworkerEvent(j,{success:!0,sc:200,serviceName:Q,responseDetail:JSON.stringify(Ie.addressList),firstSuccess:Ue===0,responseTime:_e,serverIp:g[Ue%g.length]}),!1),(Ie,Ue)=>(Pt.apworkerEvent(j,{success:!1,sc:Ie.data&&Ie.data.code||200,serviceName:Q,responseTime:_e,serverIp:g[Ue%g.length]}),!!(Ie.code!==ee.OPERATION_ABORTED&&Ie.code!==ee.UNEXPECTED_RESPONSE||Ie.data&&Ie.data.retry)&&(ue=g[(Ue+1)%g.length],!0)),I)}(c,r,s,a);this.emit(Hd.STATE_CHANGE,sS.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Hd.STATE_CHANGE,sS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(ln.CONNECTED,async()=>{this.emit(Hd.STATE_CHANGE,sS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=$l.CONNECTED}),this._workerConnection.on(ln.CLOSED,()=>{this.connectionState=$l.CLOSED}),this._workerConnection.on(ln.FAILED,()=>{this.connectionState=$l.CLOSED}),this._workerConnection.on(ln.RECONNECTING,()=>{this.connectionState=this.connectionState===$l.CONNECTED?$l.RECONNECTING:$l.CONNECTING}),this._workerConnection.on(ln.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=M_e(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,L.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Pt.reportApiInvoke(this._connectInfo.sid||null,{name:di.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:$r.TRACER}).onError(new Oe(ee.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else L.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(ln.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(ln.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Qc(this,Hd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),b=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await uG(b,a,c),A=this._sequence+"-"+d+"-"+g+"-"+E+"-"+Er(12,""),k={appId:a,cid:d,cname:c,deviceId:"",elapse:fM.intToLong(Number(E-this._moderationStartTime)),fileSize:b.buffer.byteLength,height:b.height,width:b.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:U7(E),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const G=L_e(k);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(B){for(var Z=1;Z<arguments.length;Z++){var Q=arguments[Z]!=null?arguments[Z]:{};Z%2?V7(Object(Q),!0).forEach(function(ae){Y(B,ae,Q[ae])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Q)):V7(Object(Q)).forEach(function(ae){Object.defineProperty(B,ae,Object.getOwnPropertyDescriptor(Q,ae))})}return B}({},k);delete j.jpg,L.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ia.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=$l.CLOSED,this.emit(Hd.STATE_CHANGE,sS.CLOSED)}}function F7(t){if(gr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(ee.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(ee.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const H_e={name:"ImageModeration",create:function(t){let{config:r}=t;return F7(r),new fM(r)}};var j7,B7,z7,W7,G7,H7,$7,K7,q7,Y7,X7,J7,Q7,Z7,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,f$,m$,g$,_$,y$,E$,v$,S$,b$,w$,T$,C$,R$,yt;function I$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Wu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I$(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):I$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}eo.setLogger(L);let $_e=(j7=Gt(),B7=Gt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Jv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),z7=Gt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Xv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),W7=Gt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),G7=Gt({argsMap:(t,r,s)=>[r,s]}),H7=Gt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),$7=Gt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),K7=Gt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),q7=Gt(),Y7=Gt(),X7=Gt(),J7=Gt(),Q7=Gt(),Z7=Gt(),e$=Gt(),t$=Gt(),n$=Gt(),r$=Gt(),i$=Gt(),s$=Gt(),o$=Gt(),a$=Gt(),c$=Gt(),l$=Gt({argsMap:(t,r)=>[r]}),u$=Gt(),d$=Gt(),h$=Gt(),p$=Gt(),f$=Gt(),m$=Gt(),g$=Gt(),_$=Gt(),y$=Gt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),E$=Gt(),v$=Gt(),S$=Gt(),b$=Gt(),w$=Gt(),T$=Gt(),C$=Gt({reportResult:!0}),R$=Gt(),yt=class extends Jr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),Y(this,"store",void 0),Y(this,"_uid",void 0),Y(this,"_channelName",void 0),Y(this,"_uintUid",void 0),Y(this,"_users",[]),Y(this,"_config",void 0),Y(this,"_clientId",void 0),Y(this,"_appId",void 0),Y(this,"_sessionId",null),Y(this,"_key",void 0),Y(this,"_rtmConfig",{}),Y(this,"_joinInfo",void 0),Y(this,"_gateway",void 0),Y(this,"_statsCollector",void 0),Y(this,"_configDistribute",void 0),Y(this,"_leaveMutex",void 0),Y(this,"_publishMutex",void 0),Y(this,"_renewTokenMutex",void 0),Y(this,"_subscribeMutex",void 0),Y(this,"_encryptionMode","none"),Y(this,"_encryptionSecret",null),Y(this,"_encryptionSalt",null),Y(this,"_encryptDataStream",!1),Y(this,"_encryptDataStreamKey",null),Y(this,"_encryptDataStreamIv",null),Y(this,"_proxyServer",void 0),Y(this,"_turnServer",{servers:[],mode:"auto"}),Y(this,"_cloudProxyServerMode","disabled"),Y(this,"_isDualStreamEnabled",!1),Y(this,"_defaultStreamFallbackType",void 0),Y(this,"_lowStreamParameter",void 0),Y(this,"_streamFallbackTypeCacheMap",new Map),Y(this,"_remoteStreamTypeCacheMap",new Map),Y(this,"_axiosCancelSource",Ia.CancelToken.source()),Y(this,"_audioVolumeIndicationInterval",void 0),Y(this,"_networkQualityInterval",void 0),Y(this,"_userOfflineTimeout",void 0),Y(this,"_streamRemovedTimeout",void 0),Y(this,"_liveTranscodeStreamingClient",void 0),Y(this,"_liveRawStreamingClient",void 0),Y(this,"_channelMediaRelayClient",void 0),Y(this,"_networkQualitySensitivity","normal"),Y(this,"_p2pChannel",void 0),Y(this,"_useLocalAccessPoint",!1),Y(this,"_setLocalAPVersion",void 0),Y(this,"_joinAndNotLeaveYet",!1),Y(this,"_numberOfJoinCount",0),Y(this,"_joinResponse",null),Y(this,"_remoteDefaultVideoStreamType",void 0),Y(this,"_inspect",void 0),Y(this,"_moderation",void 0),Y(this,"_license",void 0),Y(this,"_pendingPublishedUsers",[]),Y(this,"ntpAlignErrorCount",0),Y(this,"remoteInboundOffset",0),Y(this,"_peerConnectionState",void 0),Y(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),Y(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),Y(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return void L.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&L.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Cn.USER_JOINED,d));else{const h=new tg(c.uid,c.uint_id||c.uid);this._users.push(h),L.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(Cn.USER_JOINED,h)}}),Y(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:mP(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),L.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Cn.USER_LEAVED,d,c.reason))}),Y(this,"_handleAddAudioOrVideoStream",(c,d,h,m,g,E,b,I)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(d,this.channelName))return;const A=this._users.find(G=>G.uid===d);if(!A)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(A.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(A.uid,{videoAddNotify:Date.now()});const k=c==="audio"?A.hasAudio:A.hasVideo;if(A._uintid||(A._uintid=E||d),c==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,c==="audio"?(A._audio_added_=!0,h!==void 0&&(A._audioSSRC=h),m!==void 0&&(A._cname=m),b&&(A._audioOrtc=b)):(A._video_added_=!0,h!==void 0&&(A._videoSSRC=h),m!==void 0&&(A._cname=m),I!==void 0&&(A._rtxSsrcId=I),b&&(A._videoOrtc=b)),(c==="audio"?A.hasAudio:A.hasVideo)&&!k&&(L.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(c)),this.safeEmit(Cn.USER_PUBLISHED,A,c)),c==="video"?Pt.onGatewayStream(this._sessionId,Qi.ON_ADD_VIDEO_STREAM,Br.ON_ADD_VIDEO_STREAM,{peer:E||d,ssrc:A._videoSSRC}):Pt.onGatewayStream(this._sessionId,Qi.ON_ADD_AUDIO_STREAM,Br.ON_ADD_AUDIO_STREAM,{peer:E||d,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,c,h).then(G=>{if(G&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof yT))return this._p2pChannel.unsubscribe(A,c,!0).then(()=>this._subscribe(A,c,!0).catch(j=>{L.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(A,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,c,!0).catch(G=>{L.error("[".concat(this._clientId,"] resubscribe error"),G.toString())})),c==="video"&&!Vs()&&!vo()){const G=this._getEncodingName(g);(G==null?void 0:G.toLocaleLowerCase())==tT.av1&&g_e().then(j=>{j||this._gateway.downgradeCodec(G)})}}),Y(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));L.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Cn.USER_UNPUBLISHED,d,"audio"),L.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Cn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Cn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Cn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof yT&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Pt.onGatewayStream(this._sessionId,Qi.ON_REMOVE_STREAM,Br.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),Y(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(d,this.channelName))return;const m=this._users.find(b=>b.uid===d);if(!m)return void L.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));L.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const b=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===b)return;{const I=m._audio_enabled_?"enable-local-audio":"disable-local-audio";L.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Cn.USER_INFO_UPDATED,d,I)}}else{m._trust_video_enabled_state_=!0;const b=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===b)return;{const I=m._video_enabled_?"enable-local-video":"disable-local-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(Cn.USER_INFO_UPDATED,d,I)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return g!==E?!g&&E?(L.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Cn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),L.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Cn.USER_UNPUBLISHED,m,c)):void 0}),Y(this,"_handleMuteStream",(c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ly(c,this.channelName))return;L.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(b=>b.uid===c);if(!m)return void L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const b=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===b)return;{const I=m._audio_muted_?"mute-audio":"unmute-audio";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Cn.USER_INFO_UPDATED,c,I)}}else{m._trust_video_mute_state_=!0;const b=m._video_muted_;if(m._video_muted_=h,m._video_muted_===b)return;{const I=m._video_muted_?"mute-video":"unmute-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(Cn.USER_INFO_UPDATED,c,I)}}const E=d==="audio"?m.hasAudio:m.hasVideo;if(g!==E){if(!g&&E)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(L.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Cn.USER_PUBLISHED,m,d)):void L.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),L.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Cn.USER_UNPUBLISHED,m,d)}}),Y(this,"_handleP2PLost",async c=>{L.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():L.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),Y(this,"_handleTokenWillExpire",()=>{L.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Cn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Y(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),L.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Y(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Cn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Cn.NETWORK_QUALITY,c)}),Y(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const g=this._users.find(b=>b.uid===d);if(!g)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!E&&(L.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(Cn.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch(b=>{L.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._config=t,this._clientId=r||Er(5,"client-"),this.store=new class{constructor(c,d,h,m){Zt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ny.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case tn.SET_SESSION_ID:return Ze(Ze({},d),{},{sessionId:h.sessionId});case tn.SET_P2P_ID:return Ze(Ze({},d),{},{p2pId:h.p2pId});case tn.SET_UID:return Ze(Ze({},d),{},{uid:h.uid});case tn.SET_INT_UID:return Ze(Ze({},d),{},{intUid:h.intUid});case tn.SET_PUB_ID:return Ze(Ze({},d),{},{pubId:h.pubId});case tn.KEY_METRIC_CLIENT_CREATED:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{clientCreated:h.metric})});case tn.KEY_METRIC_JOIN_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinStart:h.metric})});case tn.KEY_METRIC_PRELOAD_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{preloadStart:h.metric})});case tn.KEY_METRIC_PRELOAD_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{preloadEnd:h.metric})});case tn.KEY_METRIC_JOIN_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinEnd:h.metric})});case tn.KEY_METRIC_REQUEST_AP_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{requestAPStart:h.metric})});case tn.KEY_METRIC_REQUEST_AP_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{requestAPEnd:h.metric})});case tn.KEY_METRIC_REQUEST_SUA_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case tn.KEY_METRIC_BEFORE_CONNECT:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{beforeConnect:h.metric})});case tn.KEY_METRIC_PEER_RECEIVER:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{peerReceiver:h.metric})});case tn.KEY_METRIC_SIGNAL_CONNECTED:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{signalConnected:h.metric})});case tn.KEY_METRIC_JOIN_REQ:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinReq:h.metric})});case tn.KEY_METRIC_JOIN_REP:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinRep:h.metric})});case tn.KEY_METRIC_JOIN_GATEWAY_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case tn.KEY_METRIC_JOIN_GATEWAY_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case tn.KEY_METRIC_PEER_CONNECTION_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case tn.KEY_METRIC_PEER_CONNECTION_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case tn.KEY_METRIC_DESCRIPTION_START:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{descriptionStart:h.metric})});case tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case tn.KEY_METRIC_ICE_CONNECTION_END:return Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case tn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,g=m.findIndex(E=>E.trackId===h.metric.trackId);return g!==-1?(m[g]=Ze(Ze({},m[g]),h.metric),Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{publish:[...m]})})):Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case tn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,g=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return g!==-1?(m[g]=Ze(Ze({},m[g]),h.metric),Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{subscribe:[...m]})})):Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case tn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=d.keyMetrics.firstVideoFrameDecoded,g=m.findIndex(E=>E.userId===h.metric.userId);return g!==-1?(m[g]=Ze(Ze({},m[g]),h.metric),Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):Ze(Ze({},d),{},{keyMetrics:Ze(Ze({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case tn.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case tn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=Ze(Ze({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case tn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case tn.SET_USE_P2P:return Ze(Ze({},d),{},{useP2P:h.val});case tn.SET_TRANSPORT_TYPE:return Ze(Ze({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:tn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:tn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:tn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:tn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:tn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:tn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:tn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:tn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:tn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:tn.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:tn.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:tn.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:tn.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:tn.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:tn.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:tn.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:tn.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:tn.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:tn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:Ze({userId:c},d)})}descriptionStart(){this.dispatch({type:tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:tn.KEY_METRIC_PUBLISH,metric:Ze(Ze({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,g,E,b){this.dispatch({type:tn.KEY_METRIC_SUBSCRIBE,metric:Ze(Ze(Ze(Ze(Ze({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),E&&{streamAdded:E}),b&&{firstDecoded:b})})}massSubscribe(c,d,h,m){c.forEach(g=>{this.dispatch({type:tn.KEY_METRIC_SUBSCRIBE,metric:Ze(Ze(Ze({userId:g.userId,type:g.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:tn.RECORD_JOIN_CHANNEL_SERVICE,record:Ze(Ze({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:tn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:tn.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:tn.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new eo("client-leave",this._clientId),this._publishMutex=new eo("client-publish",this._clientId),this._renewTokenMutex=new eo("client-renewtoken",this._clientId),this._subscribeMutex=new eo("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),L.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(zl," build: ").concat(ZL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{jL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){L.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new gT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{L.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===Q2.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(m=>{m instanceof PP&&oe("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()}),this.safeEmit(Cn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const g=this._users.find(E=>E.uid===c);g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),Pt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(oe("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find(h=>h instanceof Nr);d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?oe("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new u_e(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Vi,httpRetryConfig:t.httpRetryConfig||Vi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new S_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},_f("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new yT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];hr("JOIN_GATEWAY_USE_443PORT_ONLY",d),hr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof U2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(g,E,b){uP.get(g)||uP.set(g,[]),dP.get(g)||dP.set(g,E),Kh.get(g)||Kh.set(g,0);const I=uP.get(g),A=dP.get(g);if(!I||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Kh.get(g)===A){const Z=$w();I.push(Z),await Z.promise}Kh.set(g,Kh.get(g)+1);for(var k=arguments.length,G=new Array(k>3?k-3:0),j=3;j<k;j++)G[j-3]=arguments[j];const B=await b(...G);return Kh.set(g,Kh.get(g)-1),Kh.get(g)===A-1&&I.length>0&&(I[0].resolve(),I.shift()),Kh.get(g)===0&&(uP.set(g,[]),dP.set(g,0),Kh.set(g,0)),B}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(yP||yP||(yP=(window.location.protocol.split(":")[0]||"").toUpperCase(),yP))==="HTTPS",m=TW()?window.isSecureContext:"Browser Not Support";(!TW()&&!h||!window.isSecureContext)&&L.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;Pt.setAppId(t);try{if(!s&&s!==null)throw new Oe(ee.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&Cs(s,"token",1,2047),Cs(t,"appid",1,2047),jP(r),a&&BP(a),c)if(typeof c=="string")Cs(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new Oe(ee.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:B,enableInstantMuteRestore:Z}=c;B&&(jd(B,"autoSubscribe"),L.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(B)),this.store.autoSubscribe=B),Z&&(jd(Z,"enableInstantMuteRestore"),L.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(Z)),this.store.enableInstantMuteRestore=Z)}}}catch(B){throw Pt.reportApiInvoke(ty(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(B),B}if(this._leaveMutex.isLocked&&(L.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),L.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const B=new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Pt.reportApiInvoke(ty(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}).onError(B),B}this._gateway.state="CONNECTING",this.store.preloadStart();const E=await w7({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const b=(E==null?void 0:E.sid)||ty();L.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=b,this.store.sessionId=this._sessionId);const I=Pt.reportApiInvoke(b,{id:this._clientId,name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:$r.TRACER}),A=Wu(Wu(Wu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(A.stringUid=a,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async B=>{const Z=function(_e){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ie=new Uint8Array(new ArrayBuffer(ue.length));for(let Ue=0;Ue<ue.length;Ue+=1)Ie[Ue]=ue.charCodeAt(Ue);return Ie}(),Q=await window.crypto.subtle.importKey("spki",Z,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ae=VL(B),ye=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Q,ae);return function(_e){let ue="";for(let Ie=0;Ie<_e.length;Ie+=1)ue+=String.fromCharCode(_e[Ie]);return window.btoa(ue)}(new Uint8Array(ye))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const B=new TextEncoder,Z=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?B.encode(A.appId+this._encryptionSecret+this._encryptionSecret):B.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Q,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Q==="aes-128-gcm2"?128:256,Ie=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:ye},_e,ue+jme);return new Uint8Array(Ie).subarray(ue/8)}(this._encryptionMode,Z,ey(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Q,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:ye},_e,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,Z,ey(this._encryptionSalt))}else m?L.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):L.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,L.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:A.stringUid});const k=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&k===this._sessionId&&Pt.joinChannelTimeout(this._sessionId,5)},5e3);try{var G;let B;const Z=A.cloudProxyServer;if(tt(G=["proxy3","proxy4","proxy5"]).call(G,Z)){const ue=oe("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(Pt.setProxyServer(A.proxyServer),L.setProxyServer(A.proxyServer),this.store.requestAPStart(),E){if(L.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(E.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=E.intUid),B={gatewayInfo:E.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await EH(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map(Ie=>({turnServerURL:Ie.address,tcpport:Ie.tcpport||Bs.tcpport,udpport:Ie.udpport||Bs.udpport,username:Ie.username||Bs.username,password:Ie.password||Bs.password,forceturn:!1,security:!0}));A.turnServer={mode:"manual",servers:ue}}R7(E,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,B]=await gt.all([KH(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,this.store).finally(()=>{this.store.requestSUAEnd()}),$H(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),L.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,B.gatewayInfo.uid=ue,B.gatewayInfo.res.uid=ue}else B=await $H(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(aT.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)}),this._configDistribute.on(aT.UPDATE_CLIENT_ROLE_OPTIONS,ue=>{this._setClientRoleOptions(ue)})},0),this._key=s||t;const Q=B.gatewayInfo,ae=A.uid?A.uid:Q.uid;this._joinInfo=Wu(Wu({},A),{},{cid:Q.cid,uid:ae,vid:Q.vid,apResponse:Q.res,apGatewayAddress:Q.apGatewayAddress,uni_lbs_ip:Q.uni_lbs_ip,gatewayAddrs:Q.gatewayAddrs}),this.store.intUid=ae,this.store.cid=Q.cid;const ye=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));I.onSuccess(ye),this._appId=t,this._channelName=A.cname,this._uid=ye,this.store.uid=ye,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return L.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{L.startUpload()},5e3),this.store.joinEnd(),j=this,tt(cy).call(cy,j)||cy.push(j),this._cloudProxyServerMode==="disabled"&&Fn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&hM(this._joinInfo),ye}catch(B){const Z=Array.isArray(B)?B[0]:B;throw Z&&Z.code===ee.OPERATION_ABORTED?L.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),Z):L.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),Z),Z.code!==ee.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),I.onError(Z),Z}var j}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(ee.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){L.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=cy.indexOf(r);s!==-1&&cy.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return L.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",rr.LEAVE),L.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Jv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(ee.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(ee.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Jv))throw new Oe(ee.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(ee.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}L.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Nr&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),L.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw L.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){if(t==null)throw new Oe(ee.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));gr(t.id,"id",0,65535,!0),jd(t.ordered,"ordered"),Cs(t.metadata,"metadata",0,512),L.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(ee.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(ee.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(ee.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return UH(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(ee.CREATE_DATACHANNEL_ERROR);try{await gt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==ee.DISCONNECT_P2P)throw c}}return L.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw L.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(ee.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Jv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);L.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(Ei.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),L.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw L.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),L.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),L.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw L.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof tg)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Ji(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(ee.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===Et.AUDIO,a=r===Et.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:g,uint_id:E}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Oe(ee.UNEXPECTED_RESPONSE,"no ssrc id");let b=this._users.find(A=>A.uid===t);b||(b=new tg(t,E||t),b._is_pre_created=!0,this._users.push(b)),g&&(b._cname=g),b._uintid||(b._uintid=E||t),s&&(b._audioSSRC=d,b._audio_pre_subscribed=!0,h&&(b._audioOrtc=h)),a&&(b._videoSSRC=d,b._video_pre_subscribed=!0,h&&(b._videoOrtc=h),m!=null&&(b._rtxSsrcId=m)),L.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(b,r,d,m,h);const I=s?b._audioTrack:b._videoTrack;if(!I)throw new Oe(ee.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0),a&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0),I}catch(d){throw L.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(gr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(ee.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(ee.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&tt(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(ee.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==ee.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Ji(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Oe(ee.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Oe(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Oe(ee.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Ji(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===t)){const E=new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),E}if(!t.hasAudio&&!t.hasVideo){const E=new Oe(ee.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),E}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const E=new Oe(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const b=r==="audio"?t._audioSSRC:t._videoSSRC;b!==void 0&&b!==c&&(c=b,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c}),io.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(I){if((I==null?void 0:I.code)!==ee.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),I;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(b){throw this._p2pChannel.reportSubscribeEvent(!1,b==null?void 0:b.code,t,r),b}L.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(b=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),b)});const E=r==="audio"?t._audioTrack:t._videoTrack;if(!E)throw new Oe(ee.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),E}catch(E){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),E),E}finally{g()}}async massSubscribe(t){if(pf(t,"subscribeList"),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:g,mediaType:E}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(E)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:g,mediaType:E}=m;return{user:g,mediaType:E}}),d=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const E=t[g],{user:b,mediaType:I}=E;if(Ji(I,"mediaType",["audio","video"]),!b){const j=new Oe(ee.INVALID_PARAMS,"user property does not exist in subscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===b)){const j=new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");L.error("[".concat(this._clientId,"] can not massSubscribe ").concat(b.uid,", this user is not in the channel")),c[g].error=j,t.splice(g,1);continue}if(I==="audio"&&(!b.hasAudio||b._audioSSRC===void 0)||I==="video"&&(!b.hasVideo||b._videoSSRC===void 0)){const j=new Oe(ee.REMOTE_USER_IS_NOT_PUBLISHED);L.error("[".concat(this._clientId,"] can not subscribe ").concat(b.uid," with mediaType ").concat(I,", remote user is not published")),c[g].error=j,t.splice(g,1);continue}const k=os.Video|os.LwoVideo,G=s.get(b);if(G){if(I==="video"?G&k:G&os.Audio){t.splice(g,1),L.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(b.uid,", mediaType:").concat(I," twice"));continue}s.set(b,G|(I==="video"?k:os.Audio))}else s.set(b,I==="video"?k:os.Audio)}for(let g=t.length-1;g>=0;g--){const E=t[g],{user:b,mediaType:I}=E,A=os.Video|os.LwoVideo;if(this._p2pChannel.hasRemoteMedia(b,I)){await this._p2pChannel.unmuteRemoteNoLock(b,I);const k=s.get(b);s.set(b,I==="video"?k^A:k^os.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map(g=>({userId:g.user.uid,type:g.mediaType})),r);let m=Ka(h=Array.from(s.entries())).call(h,(g,E)=>{let[b,I]=E;if(I===0)return g;const A={stream_id:b.uid,stream_type:I};return I&os.Audio&&(A.audio_ssrc=b._audioSSRC),I&os.Video&&(A.video_ssrc=b._videoSSRC),g.push(A),g},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(E=>{let{user:b,mediaType:I}=E;return{user:b,mediaType:I,ssrcId:I===Et.VIDEO?b._videoSSRC:b._audioSSRC,rtxSsrcId:I===Et.VIDEO?b._rtxSsrcId:void 0}}));const g=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(b=>{let{stream_id:I,video_error_code:A,audio_error_code:k,error_code:G}=b;(A||k||G)&&g.set(I,{video_error_code:A,audio_error_code:k,error_code:G})})}if(Array.from(g.entries()).length>0){const E=[];Array.from(g.entries()).forEach(b=>{let[I,A]=b;const k=this.remoteUsers.find(G=>G.uid===I);if(k){let G;A.error_code||A.video_error_code&&A.audio_error_code?G=void 0:A.video_error_code?G=Et.VIDEO:A.audio_error_code&&(G=Et.AUDIO),E.push({user:k,mediaType:G})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const b=g.get(E.user.uid);if(b){const I=b.error_code||E.mediaType==="audio"&&b.audio_error_code||E.mediaType==="video"&&b.video_error_code;if(I){const A=cT(I);L.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(A.desc)),E.error=new Oe(ee.SUBSCRIBE_FAILED,"code ".concat(I,": ").concat(A.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var b;Pt.subscribe(this.store.sessionId,{succ:!!E.error,ec:((b=E.error)===null||b===void 0?void 0:b.code)||null,video:E.mediaType===Et.VIDEO,audio:E.mediaType===Et.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===Et.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),L.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(E=>{let{user:b,mediaType:I}=E;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(I)}).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof tg)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Ji(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&mP(this._users,t),L.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===ee.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&gr(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(ee.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Oe(ee.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),L.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===ee.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(pf(t,"unsubscribeList"),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");L.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Oe(ee.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ji(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){L.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=os.Video|os.LwoVideo;if(r.has(a)){const m=r.get(a);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&os.Audio;break;default:g=m&(os.Audio|h)}if(g){L.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|os.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|os.Audio|h)}else c?c==="audio"?r.set(a,os.Audio):c==="video"&&r.set(a,h):r.set(a,os.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),L.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===ee.DISCONNECT_P2P)return void L.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw L.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(ee.INVALID_PARAMS);ti(s.width)||ML(s.width,"streamParameter.width"),ti(s.height)||ML(s.height,"streamParameter.height"),ti(s.framerate)||ML(s.framerate,"streamParameter.framerate"),ti(s.bitrate)||gr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&L.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),L.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Xe.LocalVideoLowTrack)}async enableDualStream(){if(!Fn().supportDualStream)throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(ee.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(ee.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),L.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Xe.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Pt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),L.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){Ji(a,"role",["audience","host"])}(t),r&&jL(r),this.mode==="rtc"||this.mode==="p2p")throw L.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(ee.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(ee.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(ee.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Fs.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),L.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&jL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{L.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Cs(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(ee.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(ee.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Pt.setProxyServer(this._proxyServer),L.setProxyServer(this._proxyServer),L.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(ee.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(ee.INVALID_OPERATION,"You have already set the proxy")}if(Xw(t))return this._turnServer={servers:t,mode:"original-manual"},void L.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>hW(s)),this._turnServer={servers:t,mode:"manual"},L.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(ee.INVALID_OPERATION,"you should set license before join channel");if(Cs(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(ee.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,L.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(ee.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(ee.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(ee.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(ee.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(ee.INVALID_OPERATION,"Stop proxy server after leave channel");Pt.setProxyServer(),L.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(ee.INVALID_PARAMS,"accessPoints is required.");pf(t.accessPoints.serverList,"accessPoints.serverList"),Cs(t.accessPoints.domain,"accessPoints.domain");const r=(A,k)=>{gr(A,k,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(ee.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(hr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),hr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(A=>a.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A),h=d.map(A=>"".concat(A,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,hr("WEBCS_DOMAIN",h),hr("WEBCS_DOMAIN_BACKUP_LIST",h),hr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(pf(t.report.hostname,"report.hostname"),hr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(hr("EVENT_REPORT_DOMAIN",d[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),hr("STATS_COLLECTOR_PORT",m),t.report?hr("ENABLE_EVENT_REPORT",!0):hr("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(pf(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=d[0];let E=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),E=t.log.port),hr("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let b=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(pf(t.cds.hostname,"cds.hostname"),b=t.cds.hostname):b=d;let I=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),I=t.cds.port),hr("CDS_AP",b.map(A=>"".concat(A,":").concat(I))),t.cds?hr("ENABLE_CONFIG_DISTRIBUTE",!0):hr("ENABLE_CONFIG_DISTRIBUTE",!1),L.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(pf(t,"serverList"),Cs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(ee.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,hr("WEBCS_DOMAIN",t),hr("WEBCS_DOMAIN_BACKUP_LIST",t),hr("GATEWAY_DOMAINS",[r]),hr("EVENT_REPORT_DOMAIN",t[0]),hr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),hr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),L.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Ji(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw L.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else L.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Ji(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw L.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}L.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Ji(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw L.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}L.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){Ji(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Cs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(tt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(ee.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(ee.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(jd(a,"encryptDataStream"),!tt(c).call(c,t))throw new Oe(ee.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||L.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Gm(s))}async renewToken(t){if(Cs(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){L.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await v_e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi);L.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else L.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});L.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,L.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?L.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Cn.VOLUME_INDICATOR,t)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(ee.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(ee.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(ee.LIVE_STREAMING_TASK_CONFLICT);const s=r?ff.TRANSCODE:ff.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(ff.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(ee.INVALID_PARAMS,"can not find live streaming url to stop");await gt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){ZH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){ZH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof yT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&tt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,d,h){var m;const g=Ka(m=Array.from(h)).call(m,(j,B)=>j+B,0),E={serverTs:0,seq:Bme++,length:h.length,checkSum:g},b=new Uint8Array(vW(g,2)),I=new ArrayBuffer(Hv),A=new DataView(I);A.setUint32(0,E.serverTs),A.setUint16(4,E.seq),A.setUint16(6,E.length),A.setUint16(8,E.checkSum);const k=16-h.length%16;h=mW(h,new Uint8Array(k));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:xW,additionalData:b},d,h);return mW(new Uint8Array(I),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(ee.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Gm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-A_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(ee.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Gm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Xme),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"can not send custom report, not joined");await Pt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(oe("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(s=>s.uid+"");Object.keys(t).forEach(s=>{tt(r).call(r,s)||delete t[s]})}return t}async pickSVCLayer(t,r){Ji(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ji(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw L.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(jd(r,"apRTM"),gr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,L.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(L.debug("[".concat(this._clientId,"] reset client")),function(t){const r=rS.indexOf(t);r!==-1&&rS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ia.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&C7(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Pt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new eo("client-publish",this._clientId),this._subscribeMutex=new eo("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||ty();t?L.debug("[".concat(this._clientId,"] new Session ").concat(a)):L.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Pt.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Pt.sessionInit(this._sessionId,Wu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(ee.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");L.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(Ei.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==ee.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Nr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{L.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===ee.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(ee.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(ee.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));L.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==ee.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===ee.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(ee.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},_f("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{Pt.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_ERROR,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Cn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Pt.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_WARNING,options:[c,d],tag:$r.TRACER}).onSuccess(),this.safeEmit(Cn.LIVE_STREAMING_WARNING,c,d)},s.on(D2.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Oe(ee.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,E,b){const I=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(A=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await p_e(I,m,g,E,b)})(c,this._joinInfo,this._axiosCancelSource.token,Vi).then(d).catch(h)}),s};return t===ff.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(ee.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},_f("ChannelMediaRelay").create(t));a.on("state",c=>{c===tc.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Cn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Cn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(g=>g.uid!==h._uintid||g.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:E,metadata:b}=d,I=this._users.find(A=>A._uintid===h);if(!I)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(L.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),tt(c).call(c,I)||c.push(I),I._uintid||(I._uintid=h),I._dataChannels.findIndex(A=>A.id===d.stream_id)===-1){const A={id:m,ordered:!!g,maxRetransmits:E,metadata:b},k=function(G){return UH(G,!0)}(A);I._dataChannels.push(k),L.info("[".concat(this._clientId,"] remote user ").concat(I.uid," published datachannel")),r||this.safeEmit(Cn.USER_PUBLISHED,I,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(I,d.stream_id)&&(L.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(I.uid," after reconnect.")),this._subscribeDataChannel(I,d.stream_id).catch(A=>{L.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),r&&(this.safeEmit(Cn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h,stream_id:m}=d,g=this._users.find(b=>b._uintid===h);if(!g)return void L.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find(b=>b.id===d.stream_id);E&&(L.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then(b=>{if(g._dataChannels=g._dataChannels.filter(I=>I!==E),b)return this._gateway.unsubscribeDataChannel(b,g.uid)}),L.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Cn.USER_UNPUBLISHED,g,"datachannel",E._config))})}_getEncodingName(t){var r;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(s)for(const c of s){var a;if(c.payloadType===t)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){L.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(Cn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ms.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||I2()||!Object.prototype.hasOwnProperty.call(SP,a)||(zd[a]=c,jr[a]=c,L.debug("Update gateway parameters from config distribute",a,c))})}catch(r){L.error("Error update config from local cache",r.message)}})()}),this._gateway.on(ms.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ms.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===rr.FALLBACK)return;const c=()=>{this.safeEmit(Cn.CONNECTION_STATE_CHANGE,t,r,s)};if(Pt.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:di.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:$r.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),L.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(g=>{L.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(g=>{L.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{L.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{L.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{L.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.AUDIO,!1)),h._trust_video_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.VIDEO,!1)),h._trust_audio_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(L.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ms.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(ee.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await w7(Wu(Wu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,R7(a),this._joinInfo.preload=!0):(s=await X2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Vi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):c.push({host:m,port:g})}),t(c)}catch(s){r(s)}}),this._gateway.on(ms.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Cn.NETWORK_QUALITY,t)}),this._gateway.on(ms.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Cn.STREAM_TYPE_CHANGED,t,r),Pt.reportApiInvoke(this._sessionId,{name:di.STREAM_TYPE_CHANGE,options:[t,r],tag:$r.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(ms.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ms.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(ms.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;this._joinResponse=t,t.attributes?s=t.attributes.userAttributes.preSubSsrcs:L.debug("no attributes in joinResponse");const a=CH(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(ms.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s,turnServer:a}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(d);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=oe("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===ee.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Rn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Rn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Rn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc)),this._gateway.signal.on(Rn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Rn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Rn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Rn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Rn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Rn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Et.AUDIO,!0)),this._gateway.signal.on(Rn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Et.AUDIO,!1)),this._gateway.signal.on(Rn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Et.VIDEO,!0)),this._gateway.signal.on(Rn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Et.VIDEO,!1)),this._gateway.signal.on(Rn.RECEIVE_METADATA,t=>{const r=ey(t.metadata);this.safeEmit(Cn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(Rn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=ey(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&tt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Hv)throw new Oe(ee.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Hv));s=await async function(d,h,m){const g=m.subarray(0,Hv),E=g.slice(8,Hv),b=(E[0]<<8)+E[1],I=(g[6]<<8)+g[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:xW,additionalData:new Uint8Array(vW(b,2))},h,m.subarray(Hv));return new Uint8Array(A).subarray(0,I)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),k_e(Wu(Wu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Rn.ON_CRYPT_ERROR,()=>{Wm(()=>{L.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Cn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Rn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{L.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,rr.TOKEN_EXPIRE),this.safeEmit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Rn.ON_STREAM_FALLBACK_UPDATE,t=>{L.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Cn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Rn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),L.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Rn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Rn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Qt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Yt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some(g=>{let{stream_type:E}=g;return E===or.Audio}),h=c.some(g=>{let{stream_type:E}=g;return E!==or.Audio}),m=c.some(g=>{let{stream_type:E}=g;return E===or.Screen||E===or.ScreenLow});r.state==="offer"&&Pt.publish(this._joinInfo.sid,{eventElapse:io.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:ee.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(g=>{let{stream_type:E}=g;return E===or.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(g=>{let{stream_type:E}=g;return E!==or.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:r&&Pt.subscribe(this._joinInfo.sid,{succ:!1,ec:ee.TIMEOUT,audio:r.stream_type===Et.AUDIO,video:r.stream_type===Et.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:io.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(Rn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Rn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!ly(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(b=>b._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new tg(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(Cn.PUBLISHED_USER_LIST).length===0&&(L.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Cn.USER_JOINED,c)));const d=os.Audio&a.stream_type,h=(os.Video|os.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,g=d&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!g&&this.getListeners(Cn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Cn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(Cn.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Cn.USER_PUBLISHED,c,"video")),(d&&!g||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(L.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{L.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Cn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(L.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(Cn.PUBLISHED_USER_LIST,r)):L.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(Rn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof yT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return tt(a=Object.keys(tT)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Rn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Ei.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const E=this._users.find(b=>b.uid===a);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,d,!!g)})}),this._gateway.signal.on(Ei.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Qt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(Ei.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const g=m===or.Audio?Et.AUDIO:Et.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(Ei.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case qm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Et.VIDEO,!0);break;case qm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Et.AUDIO,!0);break;case qm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Et.VIDEO,!1);break;case qm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Et.AUDIO,!1)}}),this._gateway.signal.on(Ei.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==ca.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(Ei.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(Ei.RESTART_ICE,t,a===ca.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(Vt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Ei.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(Ei.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===ee.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===ee.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.StateChange,(t,r)=>{r===ir.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Cn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===ee.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===ee.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(t,r,s)=>{gt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==ee.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===Et.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Vt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Vt.MediaReconnectStart,t=>{this.safeEmit(Cn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Vt.MediaReconnectEnd,t=>{this.safeEmit(Cn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Vt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=CH(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(Cn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,t=>{this.safeEmit(Cn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,t=>{this.safeEmit(Cn.AUDIO_METADATA,t)}),this._p2pChannel.on(Vt.AudioPts,t=>{this.safeEmit(Cn.AUDIO_PTS,Number(t))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},_f("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:g,vid:E}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:g,vid:E?Number(E):0},Vi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(gs.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Cn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Fu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Cn.CONTENT_INSPECT_ERROR,new Oe(ee.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(gs.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===ee.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return L.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Cn.CONTENT_INSPECT_RESULT,r,s)}),t.on(gs.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(jd(t,"enabled"),t){if(!r)throw new Oe(ee.INVALID_PARAMS,"config is required");if(F7(r),!this._joinInfo)throw new Oe(ee.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},_f("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:g,cid:E,vid:b}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:g,cid:E,vid:b?Number(b):0},Vi)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Oe(ee.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(Hd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Cn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===$l.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(ee.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Hd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Ji(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(ee.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,L.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return L.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){jd(t,"enabled"),hr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},It(yt.prototype,"leave",[j7],Object.getOwnPropertyDescriptor(yt.prototype,"leave"),yt.prototype),It(yt.prototype,"publish",[B7],Object.getOwnPropertyDescriptor(yt.prototype,"publish"),yt.prototype),It(yt.prototype,"unpublish",[z7],Object.getOwnPropertyDescriptor(yt.prototype,"unpublish"),yt.prototype),It(yt.prototype,"subscribe",[W7],Object.getOwnPropertyDescriptor(yt.prototype,"subscribe"),yt.prototype),It(yt.prototype,"presubscribe",[G7],Object.getOwnPropertyDescriptor(yt.prototype,"presubscribe"),yt.prototype),It(yt.prototype,"massSubscribe",[H7],Object.getOwnPropertyDescriptor(yt.prototype,"massSubscribe"),yt.prototype),It(yt.prototype,"unsubscribe",[$7],Object.getOwnPropertyDescriptor(yt.prototype,"unsubscribe"),yt.prototype),It(yt.prototype,"massUnsubscribe",[K7],Object.getOwnPropertyDescriptor(yt.prototype,"massUnsubscribe"),yt.prototype),It(yt.prototype,"setLowStreamParameter",[q7],Object.getOwnPropertyDescriptor(yt.prototype,"setLowStreamParameter"),yt.prototype),It(yt.prototype,"enableDualStream",[Y7],Object.getOwnPropertyDescriptor(yt.prototype,"enableDualStream"),yt.prototype),It(yt.prototype,"disableDualStream",[X7],Object.getOwnPropertyDescriptor(yt.prototype,"disableDualStream"),yt.prototype),It(yt.prototype,"setClientRole",[J7],Object.getOwnPropertyDescriptor(yt.prototype,"setClientRole"),yt.prototype),It(yt.prototype,"_setClientRoleOptions",[Q7],Object.getOwnPropertyDescriptor(yt.prototype,"_setClientRoleOptions"),yt.prototype),It(yt.prototype,"setProxyServer",[Z7],Object.getOwnPropertyDescriptor(yt.prototype,"setProxyServer"),yt.prototype),It(yt.prototype,"setTurnServer",[e$],Object.getOwnPropertyDescriptor(yt.prototype,"setTurnServer"),yt.prototype),It(yt.prototype,"setLicense",[t$],Object.getOwnPropertyDescriptor(yt.prototype,"setLicense"),yt.prototype),It(yt.prototype,"startProxyServer",[n$],Object.getOwnPropertyDescriptor(yt.prototype,"startProxyServer"),yt.prototype),It(yt.prototype,"stopProxyServer",[r$],Object.getOwnPropertyDescriptor(yt.prototype,"stopProxyServer"),yt.prototype),It(yt.prototype,"setLocalAccessPointsV2",[i$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPointsV2"),yt.prototype),It(yt.prototype,"setLocalAccessPoints",[s$],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPoints"),yt.prototype),It(yt.prototype,"setRemoteDefaultVideoStreamType",[o$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteDefaultVideoStreamType"),yt.prototype),It(yt.prototype,"setRemoteVideoStreamType",[a$],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteVideoStreamType"),yt.prototype),It(yt.prototype,"setStreamFallbackOption",[c$],Object.getOwnPropertyDescriptor(yt.prototype,"setStreamFallbackOption"),yt.prototype),It(yt.prototype,"setEncryptionConfig",[l$],Object.getOwnPropertyDescriptor(yt.prototype,"setEncryptionConfig"),yt.prototype),It(yt.prototype,"renewToken",[u$],Object.getOwnPropertyDescriptor(yt.prototype,"renewToken"),yt.prototype),It(yt.prototype,"enableAudioVolumeIndicator",[d$],Object.getOwnPropertyDescriptor(yt.prototype,"enableAudioVolumeIndicator"),yt.prototype),It(yt.prototype,"startLiveStreaming",[h$],Object.getOwnPropertyDescriptor(yt.prototype,"startLiveStreaming"),yt.prototype),It(yt.prototype,"setLiveTranscoding",[p$],Object.getOwnPropertyDescriptor(yt.prototype,"setLiveTranscoding"),yt.prototype),It(yt.prototype,"stopLiveStreaming",[f$],Object.getOwnPropertyDescriptor(yt.prototype,"stopLiveStreaming"),yt.prototype),It(yt.prototype,"startChannelMediaRelay",[m$],Object.getOwnPropertyDescriptor(yt.prototype,"startChannelMediaRelay"),yt.prototype),It(yt.prototype,"updateChannelMediaRelay",[g$],Object.getOwnPropertyDescriptor(yt.prototype,"updateChannelMediaRelay"),yt.prototype),It(yt.prototype,"stopChannelMediaRelay",[_$],Object.getOwnPropertyDescriptor(yt.prototype,"stopChannelMediaRelay"),yt.prototype),It(yt.prototype,"sendCustomReportMessage",[y$],Object.getOwnPropertyDescriptor(yt.prototype,"sendCustomReportMessage"),yt.prototype),It(yt.prototype,"pickSVCLayer",[E$],Object.getOwnPropertyDescriptor(yt.prototype,"pickSVCLayer"),yt.prototype),It(yt.prototype,"setRTMConfig",[v$],Object.getOwnPropertyDescriptor(yt.prototype,"setRTMConfig"),yt.prototype),It(yt.prototype,"enableContentInspect",[S$],Object.getOwnPropertyDescriptor(yt.prototype,"enableContentInspect"),yt.prototype),It(yt.prototype,"disableContentInspect",[b$],Object.getOwnPropertyDescriptor(yt.prototype,"disableContentInspect"),yt.prototype),It(yt.prototype,"setImageModeration",[w$],Object.getOwnPropertyDescriptor(yt.prototype,"setImageModeration"),yt.prototype),It(yt.prototype,"setP2PTransport",[T$],Object.getOwnPropertyDescriptor(yt.prototype,"setP2PTransport"),yt.prototype),It(yt.prototype,"getJoinChannelServiceRecords",[C$],Object.getOwnPropertyDescriptor(yt.prototype,"getJoinChannelServiceRecords"),yt.prototype),It(yt.prototype,"setPublishAudioFilterEnabled",[R$],Object.getOwnPropertyDescriptor(yt.prototype,"setPublishAudioFilterEnabled"),yt.prototype),yt);class ST{constructor(r,s){Y(this,"id",0),Y(this,"element",void 0),Y(this,"peerPair",void 0),Y(this,"context",void 0),Y(this,"audioPlayerElement",void 0),Y(this,"audioTrack",void 0),ST.count+=1,this.id=ST.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new gt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Oe(ee.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(ee.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(ee.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){L.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var A$,g1;Y(ST,"count",0);const K_e=window.AudioContext||window.webkitAudioContext,q_e=new(A$=Gt({report:Pt}),It((g1=class{constructor(){Y(this,"units",[]),Y(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return L.debug("the system does not need to process local aec"),-1;this.context||(this.context=new K_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new ST(t,this.context),this.units.push(r)),r.startEchoCancellation(),L.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return xn().name!==Hn.SAFARI}}).prototype,"processExternalMediaAEC",[A$],Object.getOwnPropertyDescriptor(g1.prototype,"processExternalMediaAEC"),g1.prototype),g1);function P$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function k$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?P$(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):P$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const mM=window||document;function O$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!mM)return;const s=Fi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(Fi.onSecurityPolicyViolation||Fi.getListeners(Zh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>tt(d).call(d,h))&&(Fi.onSecurityPolicyViolation&&typeof Fi.onSecurityPolicyViolation=="function"&&Fi.onSecurityPolicyViolation(c),Fi.getListeners(Zh.SECURITY_POLICY_VIOLATION).length>0&&Fi.safeEmit(Zh.SECURITY_POLICY_VIOLATION,c))};s&&mM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Fi.getListeners(Zh.SECURITY_POLICY_VIOLATION).length>0)&&mM.addEventListener("securitypolicyviolation",a),Fi._cspEventHandlerPointer=a}var Y_e=N,X_e=p8,N$=RegExp.prototype,J_e=function(t){return t===N$||Y_e(N$,t)?X_e(t):t.flags},Uo=l(J_e);function _S(t){let r=t.length;for(;--r>=0;)t[r]=0}const gM=256,x$=286,bT=30,wT=15,_M=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),_1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Q_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ef=new Array(576);_S(Ef);const TT=new Array(60);_S(TT);const CT=new Array(512);_S(CT);const RT=new Array(256);_S(RT);const yM=new Array(29);_S(yM);const y1=new Array(bT);function EM(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let L$,M$,U$;function vM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}_S(y1);const V$=t=>t<256?CT[t]:CT[256+(t>>>7)],IT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},cl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,IT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},np=(t,r,s)=>{cl(t,s[2*r],s[2*r+1])},F$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},j$=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=wT;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=F$(a[m]++,m))}},B$=t=>{let r;for(r=0;r<x$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<bT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},z$=t=>{t.bi_valid>8?IT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},W$=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},SM=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&W$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!W$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},G$=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?np(t,c,r):(d=RT[c],np(t,d+gM+1,r),h=_M[d],h!==0&&(c-=yM[d],cl(t,c,h)),a--,d=V$(a),np(t,d,s),h=_1[d],h!==0&&(a-=y1[d],cl(t,a,h)));while(m<t.sym_next);np(t,256,r)},bM=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,g,E=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=E=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=E<2?++E:0,s[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=a[2*g+1]);for(r.max_code=E,h=t.heap_len>>1;h>=1;h--)SM(t,s,h);g=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],SM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*g]=s[2*h]+s[2*m],t.depth[g]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=g,t.heap[1]=g++,SM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((b,I)=>{const A=I.dyn_tree,k=I.max_code,G=I.stat_desc.static_tree,j=I.stat_desc.has_stree,B=I.stat_desc.extra_bits,Z=I.stat_desc.extra_base,Q=I.stat_desc.max_length;let ae,ye,_e,ue,Ie,Ue,We=0;for(ue=0;ue<=wT;ue++)b.bl_count[ue]=0;for(A[2*b.heap[b.heap_max]+1]=0,ae=b.heap_max+1;ae<573;ae++)ye=b.heap[ae],ue=A[2*A[2*ye+1]+1]+1,ue>Q&&(ue=Q,We++),A[2*ye+1]=ue,ye>k||(b.bl_count[ue]++,Ie=0,ye>=Z&&(Ie=B[ye-Z]),Ue=A[2*ye],b.opt_len+=Ue*(ue+Ie),j&&(b.static_len+=Ue*(G[2*ye+1]+Ie)));if(We!==0){do{for(ue=Q-1;b.bl_count[ue]===0;)ue--;b.bl_count[ue]--,b.bl_count[ue+1]+=2,b.bl_count[Q]--,We-=2}while(We>0);for(ue=Q;ue!==0;ue--)for(ye=b.bl_count[ue];ye!==0;)_e=b.heap[--ae],_e>k||(A[2*_e+1]!==ue&&(b.opt_len+=(ue-A[2*_e+1])*A[2*_e],A[2*_e+1]=ue),ye--)}})(t,r),j$(s,E,t.bl_count)},H$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<g&&c===h||(m<E?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4))},$$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<g&&c===h)){if(m<E)do np(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(np(t,c,t.bl_tree),m--),np(t,16,t.bl_tree),cl(t,m-3,2)):m<=10?(np(t,17,t.bl_tree),cl(t,m-3,3)):(np(t,18,t.bl_tree),cl(t,m-11,7));m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4)}};let K$=!1;const q$=(t,r,s,a)=>{cl(t,0+(a?1:0),3),z$(t),IT(t,s),IT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var Z_e=t=>{K$||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(yM[c]=a,r=0;r<1<<_M[c];r++)RT[a++]=c;for(RT[a-1]=c,d=0,c=0;c<16;c++)for(y1[c]=d,r=0;r<1<<_1[c];r++)CT[d++]=c;for(d>>=7;c<bT;c++)for(y1[c]=d<<7,r=0;r<1<<_1[c]-7;r++)CT[256+d++]=c;for(s=0;s<=wT;s++)h[s]=0;for(r=0;r<=143;)Ef[2*r+1]=8,r++,h[8]++;for(;r<=255;)Ef[2*r+1]=9,r++,h[9]++;for(;r<=279;)Ef[2*r+1]=7,r++,h[7]++;for(;r<=287;)Ef[2*r+1]=8,r++,h[8]++;for(j$(Ef,287,h),r=0;r<bT;r++)TT[2*r+1]=5,TT[2*r]=F$(r,5);L$=new EM(Ef,_M,257,x$,wT),M$=new EM(TT,_1,0,bT,wT),U$=new EM(new Array(0),Q_e,0,19,7)})(),K$=!0),t.l_desc=new vM(t.dyn_ltree,L$),t.d_desc=new vM(t.dyn_dtree,M$),t.bl_desc=new vM(t.bl_tree,U$),t.bi_buf=0,t.bi_valid=0,B$(t)},eye=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,E=4093624447;for(g=0;g<=31;g++,E>>>=1)if(1&E&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<gM;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),bM(t,t.l_desc),bM(t,t.d_desc),h=(m=>{let g;for(H$(m,m.dyn_ltree,m.l_desc.max_code),H$(m,m.dyn_dtree,m.d_desc.max_code),bM(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*D$[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?q$(t,r,s,a):t.strategy===4||d===c?(cl(t,2+(a?1:0),3),G$(t,Ef,TT)):(cl(t,4+(a?1:0),3),((m,g,E,b)=>{let I;for(cl(m,g-257,5),cl(m,E-1,5),cl(m,b-4,4),I=0;I<b;I++)cl(m,m.bl_tree[2*D$[I]+1],3);$$(m,m.dyn_ltree,g-1),$$(m,m.dyn_dtree,E-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),G$(t,t.dyn_ltree,t.dyn_dtree)),B$(t),a&&z$(t)},tye=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(RT[s]+gM+1)]++,t.dyn_dtree[2*V$(r)]++),t.sym_next===t.sym_end),nye=t=>{cl(t,2,3),np(t,256,Ef),(r=>{r.bi_valid===16?(IT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},rye={_tr_init:Z_e,_tr_stored_block:q$,_tr_flush_block:eye,_tr_tally:tye,_tr_align:nye},AT=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const iye=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ua=(t,r,s,a)=>{const c=iye,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},my={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},E1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:sye,_tr_stored_block:wM,_tr_flush_block:oye,_tr_tally:sg,_tr_align:aye}=rye,{Z_NO_FLUSH:og,Z_PARTIAL_FLUSH:cye,Z_FULL_FLUSH:lye,Z_FINISH:Gu,Z_BLOCK:Y$,Z_OK:Oa,Z_STREAM_END:X$,Z_STREAM_ERROR:rp,Z_DATA_ERROR:uye,Z_BUF_ERROR:TM,Z_DEFAULT_COMPRESSION:dye,Z_FILTERED:hye,Z_HUFFMAN_ONLY:v1,Z_RLE:pye,Z_FIXED:fye,Z_DEFAULT_STRATEGY:mye,Z_UNKNOWN:gye,Z_DEFLATED:S1}=E1,CM=286,_ye=30,yye=19,Eye=2*CM+1,vye=15,gy=258,ip=262,yS=42,_y=113,PT=666,yy=(t,r)=>(t.msg=my[r],r),J$=t=>2*t-(t>4?9:0),ag=t=>{let r=t.length;for(;--r>=0;)t[r]=0},Sye=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let cg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const ql=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Yl=(t,r)=>{oye(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,ql(t.strm)},hi=(t,r)=>{t.pending_buf[t.pending++]=r},kT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},RM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=AT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ua(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},Q$=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-ip?t.strstart-(t.w_size-ip):0,E=t.window,b=t.w_mask,I=t.prev,A=t.strstart+gy;let k=E[d+h-1],G=E[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,E[s+h]===G&&E[s+h-1]===k&&E[s]===E[d]&&E[++s]===E[d+1]){d+=2,s++;do;while(E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&d<A);if(a=gy-(A-d),d=A-gy,a>h){if(t.match_start=r,h=a,a>=m)break;k=E[d+h-1],G=E[d+h]}}while((r=I[r&b])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},ES=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-ip)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),Sye(t),a+=r),t.strm.avail_in===0)break;if(s=RM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=cg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=cg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ip&&t.strm.avail_in!==0)},Z$=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Gu||r===og||s!==a+t.strm.avail_in)))break;h=r===Gu&&s===a+t.strm.avail_in?1:0,wM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,ql(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(RM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==og&&r!==Gu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(RM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===Gu)&&r!==og&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Gu&&t.strm.avail_in===0&&s===a?1:0,wM(t,t.block_start,s,h),t.block_start+=s,ql(t.strm)),h?3:1)},IM=(t,r)=>{let s,a;for(;;){if(t.lookahead<ip){if(ES(t),t.lookahead<ip&&r===og)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-ip&&(t.match_length=Q$(t,s)),t.match_length>=3)if(a=sg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=cg(t,t.ins_h,t.window[t.strstart+1]);else a=sg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(Yl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Gu?(Yl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Yl(t,!1),t.strm.avail_out===0)?1:2},vS=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<ip){if(ES(t),t.lookahead<ip&&r===og)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-ip&&(t.match_length=Q$(t,s),t.match_length<=5&&(t.strategy===hye||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=sg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=cg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(Yl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=sg(t,0,t.window[t.strstart-1]),a&&Yl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=sg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Gu?(Yl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Yl(t,!1),t.strm.avail_out===0)?1:2};function sp(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const OT=[new sp(0,0,0,0,Z$),new sp(4,4,8,4,IM),new sp(4,5,16,8,IM),new sp(4,6,32,32,IM),new sp(4,4,16,16,vS),new sp(8,16,32,32,vS),new sp(8,16,128,128,vS),new sp(8,32,128,256,vS),new sp(32,128,258,1024,vS),new sp(32,258,258,4096,vS)];function bye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Eye),this.dyn_dtree=new Uint16Array(2*(2*_ye+1)),this.bl_tree=new Uint16Array(2*(2*yye+1)),ag(this.dyn_ltree),ag(this.dyn_dtree),ag(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(vye+1),this.heap=new Uint16Array(2*CM+1),ag(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*CM+1),ag(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const NT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==yS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==_y&&r.status!==PT?1:0},eK=t=>{if(NT(t))return yy(t,rp);t.total_in=t.total_out=0,t.data_type=gye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?yS:_y,t.adler=r.wrap===2?0:1,r.last_flush=-2,sye(r),Oa},tK=t=>{const r=eK(t);return r===Oa&&(s=>{s.window_size=2*s.w_size,ag(s.head),s.max_lazy_match=OT[s.level].max_lazy,s.good_match=OT[s.level].good_length,s.nice_match=OT[s.level].nice_length,s.max_chain_length=OT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},nK=(t,r,s,a,c,d)=>{if(!t)return rp;let h=1;if(r===dye&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==S1||a<8||a>15||r<0||r>9||d<0||d>fye||a===8&&h!==1)return yy(t,rp);a===8&&(a=9);const m=new bye;return t.state=m,m.strm=t,m.status=yS,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,tK(t)};var wye=(t,r)=>{if(NT(t)||r>Y$||r<0)return t?yy(t,rp):rp;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===PT&&r!==Gu)return yy(t,t.avail_out===0?TM:rp);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(ql(t),t.avail_out===0)return s.last_flush=-1,Oa}else if(t.avail_in===0&&J$(r)<=J$(a)&&r!==Gu)return yy(t,TM);if(s.status===PT&&t.avail_in!==0)return yy(t,TM);if(s.status===yS&&s.wrap===0&&(s.status=_y),s.status===yS){let c=S1+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=v1||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,kT(s,c),s.strstart!==0&&(kT(s,t.adler>>>16),kT(s,65535&t.adler)),t.adler=1,s.status=_y,ql(t),s.pending!==0)return s.last_flush=-1,Oa}if(s.status===57){if(t.adler=0,hi(s,31),hi(s,139),hi(s,8),s.gzhead)hi(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),hi(s,255&s.gzhead.time),hi(s,s.gzhead.time>>8&255),hi(s,s.gzhead.time>>16&255),hi(s,s.gzhead.time>>24&255),hi(s,s.level===9?2:s.strategy>=v1||s.level<2?4:0),hi(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(hi(s,255&s.gzhead.extra.length),hi(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ua(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,s.level===9?2:s.strategy>=v1||s.level<2?4:0),hi(s,3),s.status=_y,ql(t),s.pending!==0)return s.last_flush=-1,Oa}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ua(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,ql(t),s.pending!==0)return s.last_flush=-1,Oa;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ua(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ua(t.adler,s.pending_buf,s.pending-d,d)),ql(t),s.pending!==0)return s.last_flush=-1,Oa;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ua(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ua(t.adler,s.pending_buf,s.pending-d,d)),ql(t),s.pending!==0)return s.last_flush=-1,Oa;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ua(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(ql(t),s.pending!==0))return s.last_flush=-1,Oa;hi(s,255&t.adler),hi(s,t.adler>>8&255),t.adler=0}if(s.status=_y,ql(t),s.pending!==0)return s.last_flush=-1,Oa}if(t.avail_in!==0||s.lookahead!==0||r!==og&&s.status!==PT){let c=s.level===0?Z$(s,r):s.strategy===v1?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(ES(d),d.lookahead===0)){if(h===og)return 1;break}if(d.match_length=0,m=sg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(Yl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Gu?(Yl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Yl(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===pye?((d,h)=>{let m,g,E,b;const I=d.window;for(;;){if(d.lookahead<=gy){if(ES(d),d.lookahead<=gy&&h===og)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(E=d.strstart-1,g=I[E],g===I[++E]&&g===I[++E]&&g===I[++E])){b=d.strstart+gy;do;while(g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&E<b);d.match_length=gy-(b-E),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=sg(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=sg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(Yl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Gu?(Yl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Yl(d,!1),d.strm.avail_out===0)?1:2})(s,r):OT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=PT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Oa;if(c===2&&(r===cye?aye(s):r!==Y$&&(wM(s,0,0,!1),r===lye&&(ag(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),ql(t),t.avail_out===0))return s.last_flush=-1,Oa}return r!==Gu?Oa:s.wrap<=0?X$:(s.wrap===2?(hi(s,255&t.adler),hi(s,t.adler>>8&255),hi(s,t.adler>>16&255),hi(s,t.adler>>24&255),hi(s,255&t.total_in),hi(s,t.total_in>>8&255),hi(s,t.total_in>>16&255),hi(s,t.total_in>>24&255)):(kT(s,t.adler>>>16),kT(s,65535&t.adler)),ql(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Oa:X$)},Tye=(t,r)=>{let s=r.length;if(NT(t))return rp;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==yS||a.lookahead)return rp;if(c===1&&(t.adler=AT(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(ag(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(r.subarray(s-a.w_size,s),0),r=g,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,ES(a);a.lookahead>=3;){let g=a.strstart,E=a.lookahead-2;do a.ins_h=cg(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--E);a.strstart=g,a.lookahead=2,ES(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,Oa},xT={deflateInit:(t,r)=>nK(t,r,S1,15,8,mye),deflateInit2:nK,deflateReset:tK,deflateResetKeep:eK,deflateSetHeader:(t,r)=>NT(t)||t.state.wrap!==2?rp:(t.state.gzhead=r,Oa),deflate:wye,deflateEnd:t=>{if(NT(t))return rp;const r=t.state.status;return t.state=null,r===_y?yy(t,uye):Oa},deflateSetDictionary:Tye,deflateInfo:"pako deflate (from Nodeca project)"};const Cye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var b1={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)Cye(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let rK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{rK=!1}const DT=new Uint8Array(256);for(let t=0;t<256;t++)DT[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;DT[254]=DT[254]=1;var LT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=DT[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&rK)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let E=0;E<m;E++)g+=String.fromCharCode(h[E]);return g})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+DT[t[s]]>r?s:r}},iK=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const sK=Object.prototype.toString,{Z_NO_FLUSH:Rye,Z_SYNC_FLUSH:Iye,Z_FULL_FLUSH:Aye,Z_FINISH:Pye,Z_OK:w1,Z_STREAM_END:kye,Z_DEFAULT_COMPRESSION:Oye,Z_DEFAULT_STRATEGY:Nye,Z_DEFLATED:xye}=E1;function T1(t){this.options=b1.assign({level:Oye,method:xye,chunkSize:16384,windowBits:15,memLevel:8,strategy:Nye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iK,this.strm.avail_out=0;let s=xT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==w1)throw new Error(my[s]);if(r.header&&xT.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?LT.string2buf(r.dictionary):sK.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=xT.deflateSetDictionary(this.strm,a),s!==w1)throw new Error(my[s]);this._dict_set=!0}}function Dye(t,r){const s=new T1(r);if(s.push(t,!0),s.err)throw s.msg||my[s.err];return s.result}T1.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?Pye:Rye,typeof t=="string"?s.input=LT.string2buf(t):sK.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===Iye||d===Aye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=xT.deflate(s,d),c===kye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=xT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===w1;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},T1.prototype.onData=function(t){this.chunks.push(t)},T1.prototype.onEnd=function(t){t===w1&&(this.result=b1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Lye={deflate:Dye};const C1=16209;var Mye=function(t,r){let s,a,c,d,h,m,g,E,b,I,A,k,G,j,B,Z,Q,ae,ye,_e,ue,Ie,Ue,We;const Qe=t.state;s=t.next_in,Ue=t.input,a=s+(t.avail_in-5),c=t.next_out,We=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=Qe.dmax,g=Qe.wsize,E=Qe.whave,b=Qe.wnext,I=Qe.window,A=Qe.hold,k=Qe.bits,G=Qe.lencode,j=Qe.distcode,B=(1<<Qe.lenbits)-1,Z=(1<<Qe.distbits)-1;e:do{k<15&&(A+=Ue[s++]<<k,k+=8,A+=Ue[s++]<<k,k+=8),Q=G[A&B];t:for(;;){if(ae=Q>>>24,A>>>=ae,k-=ae,ae=Q>>>16&255,ae===0)We[c++]=65535&Q;else{if(!(16&ae)){if((64&ae)==0){Q=G[(65535&Q)+(A&(1<<ae)-1)];continue t}if(32&ae){Qe.mode=16191;break e}t.msg="invalid literal/length code",Qe.mode=C1;break e}ye=65535&Q,ae&=15,ae&&(k<ae&&(A+=Ue[s++]<<k,k+=8),ye+=A&(1<<ae)-1,A>>>=ae,k-=ae),k<15&&(A+=Ue[s++]<<k,k+=8,A+=Ue[s++]<<k,k+=8),Q=j[A&Z];n:for(;;){if(ae=Q>>>24,A>>>=ae,k-=ae,ae=Q>>>16&255,!(16&ae)){if((64&ae)==0){Q=j[(65535&Q)+(A&(1<<ae)-1)];continue n}t.msg="invalid distance code",Qe.mode=C1;break e}if(_e=65535&Q,ae&=15,k<ae&&(A+=Ue[s++]<<k,k+=8,k<ae&&(A+=Ue[s++]<<k,k+=8)),_e+=A&(1<<ae)-1,_e>m){t.msg="invalid distance too far back",Qe.mode=C1;break e}if(A>>>=ae,k-=ae,ae=c-d,_e>ae){if(ae=_e-ae,ae>E&&Qe.sane){t.msg="invalid distance too far back",Qe.mode=C1;break e}if(ue=0,Ie=I,b===0){if(ue+=g-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ie=We}}else if(b<ae){if(ue+=g+b-ae,ae-=b,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);if(ue=0,b<ye){ae=b,ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ie=We}}}else if(ue+=b-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ie=We}for(;ye>2;)We[c++]=Ie[ue++],We[c++]=Ie[ue++],We[c++]=Ie[ue++],ye-=3;ye&&(We[c++]=Ie[ue++],ye>1&&(We[c++]=Ie[ue++]))}else{ue=c-_e;do We[c++]=We[ue++],We[c++]=We[ue++],We[c++]=We[ue++],ye-=3;while(ye>2);ye&&(We[c++]=We[ue++],ye>1&&(We[c++]=We[ue++]))}break}}break}}while(s<a&&c<h);ye=k>>3,s-=ye,k-=ye<<3,A&=(1<<k)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),Qe.hold=A,Qe.bits=k};const R1=15,Uye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Vye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Fye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),jye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var MT=(t,r,s,a,c,d,h,m)=>{const g=m.bits;let E,b,I,A,k,G,j=0,B=0,Z=0,Q=0,ae=0,ye=0,_e=0,ue=0,Ie=0,Ue=0,We=null;const Qe=new Uint16Array(16),fn=new Uint16Array(16);let vn,Jt,nr,qn=null;for(j=0;j<=R1;j++)Qe[j]=0;for(B=0;B<a;B++)Qe[r[s+B]]++;for(ae=g,Q=R1;Q>=1&&Qe[Q]===0;Q--);if(ae>Q&&(ae=Q),Q===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(Z=1;Z<Q&&Qe[Z]===0;Z++);for(ae<Z&&(ae=Z),ue=1,j=1;j<=R1;j++)if(ue<<=1,ue-=Qe[j],ue<0)return-1;if(ue>0&&(t===0||Q!==1))return-1;for(fn[1]=0,j=1;j<R1;j++)fn[j+1]=fn[j]+Qe[j];for(B=0;B<a;B++)r[s+B]!==0&&(h[fn[r[s+B]]++]=B);if(t===0?(We=qn=h,G=20):t===1?(We=Uye,qn=Vye,G=257):(We=Fye,qn=jye,G=0),Ue=0,B=0,j=Z,k=d,ye=ae,_e=0,I=-1,Ie=1<<ae,A=Ie-1,t===1&&Ie>852||t===2&&Ie>592)return 1;for(;;){vn=j-_e,h[B]+1<G?(Jt=0,nr=h[B]):h[B]>=G?(Jt=qn[h[B]-G],nr=We[h[B]-G]):(Jt=96,nr=0),E=1<<j-_e,b=1<<ye,Z=b;do b-=E,c[k+(Ue>>_e)+b]=vn<<24|Jt<<16|nr|0;while(b!==0);for(E=1<<j-1;Ue&E;)E>>=1;if(E!==0?(Ue&=E-1,Ue+=E):Ue=0,B++,--Qe[j]==0){if(j===Q)break;j=r[s+h[B]]}if(j>ae&&(Ue&A)!==I){for(_e===0&&(_e=ae),k+=Z,ye=j-_e,ue=1<<ye;ye+_e<Q&&(ue-=Qe[ye+_e],!(ue<=0));)ye++,ue<<=1;if(Ie+=1<<ye,t===1&&Ie>852||t===2&&Ie>592)return 1;I=Ue&A,c[I]=ae<<24|ye<<16|k-d|0}}return Ue!==0&&(c[k+Ue]=j-_e<<24|64<<16|0),m.bits=ae,0};const{Z_FINISH:oK,Z_BLOCK:Bye,Z_TREES:I1,Z_OK:Ey,Z_STREAM_END:zye,Z_NEED_DICT:Wye,Z_STREAM_ERROR:Hu,Z_DATA_ERROR:aK,Z_MEM_ERROR:cK,Z_BUF_ERROR:Gye,Z_DEFLATED:lK}=E1,A1=16180,P1=16190,vf=16191,AM=16192,PM=16194,k1=16199,O1=16200,kM=16206,_s=16209,uK=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Hye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const vy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<A1||r.mode>16211?1:0},dK=t=>{if(vy(t))return Hu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=A1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Ey},hK=t=>{if(vy(t))return Hu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,dK(t)},pK=(t,r)=>{let s;if(vy(t))return Hu;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Hu:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,hK(t))},fK=(t,r)=>{if(!t)return Hu;const s=new Hye;t.state=s,s.strm=t,s.window=null,s.mode=A1;const a=pK(t,r);return a!==Ey&&(t.state=null),a};let OM,NM,mK=!0;const $ye=t=>{if(mK){OM=new Int32Array(512),NM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(MT(1,t.lens,0,288,OM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;MT(2,t.lens,0,32,NM,0,t.work,{bits:5}),mK=!1}t.lencode=OM,t.lenbits=9,t.distcode=NM,t.distbits=5},gK=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Kye=(t,r)=>{let s,a,c,d,h,m,g,E,b,I,A,k,G,j,B,Z,Q,ae,ye,_e,ue,Ie,Ue=0;const We=new Uint8Array(4);let Qe,fn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(vy(t)||!t.output||!t.input&&t.avail_in!==0)return Hu;s=t.state,s.mode===vf&&(s.mode=AM),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,b=s.bits,I=m,A=g,Ie=Ey;e:for(;;)switch(s.mode){case A1:if(s.wrap===0){s.mode=AM;break}for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,We[0]=255&E,We[1]=E>>>8&255,s.check=ua(s.check,We,2,0),E=0,b=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",s.mode=_s;break}if((15&E)!==lK){t.msg="unknown compression method",s.mode=_s;break}if(E>>>=4,b-=4,ue=8+(15&E),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){t.msg="invalid window size",s.mode=_s;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&E?16189:vf,E=0,b=0;break;case 16181:for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(s.flags=E,(255&Uo(s))!==lK){t.msg="unknown compression method",s.mode=_s;break}if(57344&Uo(s)){t.msg="unknown header flags set",s.mode=_s;break}s.head&&(s.head.text=E>>8&1),512&Uo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=ua(s.check,We,2,0)),E=0,b=0,s.mode=16182;case 16182:for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.head&&(s.head.time=E),512&Uo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,We[2]=E>>>16&255,We[3]=E>>>24&255,s.check=ua(s.check,We,4,0)),E=0,b=0,s.mode=16183;case 16183:for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&Uo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=ua(s.check,We,2,0)),E=0,b=0,s.mode=16184;case 16184:if(1024&Uo(s)){for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.length=E,s.head&&(s.head.extra_len=E),512&Uo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=ua(s.check,We,2,0)),E=0,b=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Uo(s)&&(k=s.length,k>m&&(k=m),k&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+k),ue)),512&Uo(s)&&4&s.wrap&&(s.check=ua(s.check,a,k,d)),m-=k,d+=k,s.length-=k),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Uo(s)){if(m===0)break e;k=0;do ue=a[d+k++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&k<m);if(512&Uo(s)&&4&s.wrap&&(s.check=ua(s.check,a,k,d)),m-=k,d+=k,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Uo(s)){if(m===0)break e;k=0;do ue=a[d+k++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&k<m);if(512&Uo(s)&&4&s.wrap&&(s.check=ua(s.check,a,k,d)),m-=k,d+=k,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Uo(s)){for(;b<16;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(4&s.wrap&&E!==(65535&s.check)){t.msg="header crc mismatch",s.mode=_s;break}E=0,b=0}s.head&&(s.head.hcrc=Uo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=vf;break;case 16189:for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}t.adler=s.check=uK(E),E=0,b=0,s.mode=P1;case P1:if(s.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,Wye;t.adler=s.check=1,s.mode=vf;case vf:if(r===Bye||r===I1)break e;case AM:if(s.last){E>>>=7&b,b-=7&b,s.mode=kM;break}for(;b<3;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}switch(s.last=1&E,E>>>=1,b-=1,3&E){case 0:s.mode=16193;break;case 1:if($ye(s),s.mode=k1,r===I1){E>>>=2,b-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=_s}E>>>=2,b-=2;break;case 16193:for(E>>>=7&b,b-=7&b;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",s.mode=_s;break}if(s.length=65535&E,E=0,b=0,s.mode=PM,r===I1)break e;case PM:s.mode=16195;case 16195:if(k=s.length,k){if(k>m&&(k=m),k>g&&(k=g),k===0)break e;c.set(a.subarray(d,d+k),h),m-=k,d+=k,g-=k,h+=k,s.length-=k;break}s.mode=vf;break;case 16196:for(;b<14;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(s.nlen=257+(31&E),E>>>=5,b-=5,s.ndist=1+(31&E),E>>>=5,b-=5,s.ncode=4+(15&E),E>>>=4,b-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=_s;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;b<3;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.lens[vn[s.have++]]=7&E,E>>>=3,b-=3}for(;s.have<19;)s.lens[vn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Qe={bits:s.lenbits},Ie=MT(0,s.lens,0,19,s.lencode,0,s.work,Qe),s.lenbits=Qe.bits,Ie){t.msg="invalid code lengths set",s.mode=_s;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(Q<16)E>>>=B,b-=B,s.lens[s.have++]=Q;else{if(Q===16){for(fn=B+2;b<fn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(E>>>=B,b-=B,s.have===0){t.msg="invalid bit length repeat",s.mode=_s;break}ue=s.lens[s.have-1],k=3+(3&E),E>>>=2,b-=2}else if(Q===17){for(fn=B+3;b<fn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=B,b-=B,ue=0,k=3+(7&E),E>>>=3,b-=3}else{for(fn=B+7;b<fn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=B,b-=B,ue=0,k=11+(127&E),E>>>=7,b-=7}if(s.have+k>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=_s;break}for(;k--;)s.lens[s.have++]=ue}}if(s.mode===_s)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=_s;break}if(s.lenbits=9,Qe={bits:s.lenbits},Ie=MT(1,s.lens,0,s.nlen,s.lencode,0,s.work,Qe),s.lenbits=Qe.bits,Ie){t.msg="invalid literal/lengths set",s.mode=_s;break}if(s.distbits=6,s.distcode=s.distdyn,Qe={bits:s.distbits},Ie=MT(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Qe),s.distbits=Qe.bits,Ie){t.msg="invalid distances set",s.mode=_s;break}if(s.mode=k1,r===I1)break e;case k1:s.mode=O1;case O1:if(m>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,Mye(t,A),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,b=s.bits,s.mode===vf&&(s.back=-1);break}for(s.back=0;Ue=s.lencode[E&(1<<s.lenbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(Z&&(240&Z)==0){for(ae=B,ye=Z,_e=Q;Ue=s.lencode[_e+((E&(1<<ae+ye)-1)>>ae)],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(ae+B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=ae,b-=ae,s.back+=ae}if(E>>>=B,b-=B,s.back+=B,s.length=Q,Z===0){s.mode=16205;break}if(32&Z){s.back=-1,s.mode=vf;break}if(64&Z){t.msg="invalid literal/length code",s.mode=_s;break}s.extra=15&Z,s.mode=16201;case 16201:if(s.extra){for(fn=s.extra;b<fn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,b-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ue=s.distcode[E&(1<<s.distbits)-1],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if((240&Z)==0){for(ae=B,ye=Z,_e=Q;Ue=s.distcode[_e+((E&(1<<ae+ye)-1)>>ae)],B=Ue>>>24,Z=Ue>>>16&255,Q=65535&Ue,!(ae+B<=b);){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}E>>>=ae,b-=ae,s.back+=ae}if(E>>>=B,b-=B,s.back+=B,64&Z){t.msg="invalid distance code",s.mode=_s;break}s.offset=Q,s.extra=15&Z,s.mode=16203;case 16203:if(s.extra){for(fn=s.extra;b<fn;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,b-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=_s;break}s.mode=16204;case 16204:if(g===0)break e;if(k=A-g,s.offset>k){if(k=s.offset-k,k>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=_s;break}k>s.wnext?(k-=s.wnext,G=s.wsize-k):G=s.wnext-k,k>s.length&&(k=s.length),j=s.window}else j=c,G=h-s.offset,k=s.length;k>g&&(k=g),g-=k,s.length-=k;do c[h++]=j[G++];while(--k);s.length===0&&(s.mode=O1);break;case 16205:if(g===0)break e;c[h++]=s.length,g--,s.mode=O1;break;case kM:if(s.wrap){for(;b<32;){if(m===0)break e;m--,E|=a[d++]<<b,b+=8}if(A-=g,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Uo(s)?ua(s.check,c,A,h-A):AT(s.check,c,A,h-A)),A=g,4&s.wrap&&(Uo(s)?E:uK(E))!==s.check){t.msg="incorrect data check",s.mode=_s;break}E=0,b=0}s.mode=16207;case 16207:if(s.wrap&&Uo(s)){for(;b<32;){if(m===0)break e;m--,E+=a[d++]<<b,b+=8}if(4&s.wrap&&E!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=_s;break}E=0,b=0}s.mode=16208;case 16208:Ie=zye;break e;case _s:Ie=aK;break e;case 16210:return cK;default:return Hu}return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=b,(s.wsize||A!==t.avail_out&&s.mode<_s&&(s.mode<kM||r!==oK))&&gK(t,t.output,t.next_out,A-t.avail_out),I-=t.avail_in,A-=t.avail_out,t.total_in+=I,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=Uo(s)?ua(s.check,c,A,t.next_out-A):AT(s.check,c,A,t.next_out-A)),t.data_type=s.bits+(s.last?64:0)+(s.mode===vf?128:0)+(s.mode===k1||s.mode===PM?256:0),(I===0&&A===0||r===oK)&&Ie===Ey&&(Ie=Gye),Ie},Sf={inflateReset:hK,inflateReset2:pK,inflateResetKeep:dK,inflateInit:t=>fK(t,15),inflateInit2:fK,inflate:Kye,inflateEnd:t=>{if(vy(t))return Hu;let r=t.state;return r.window&&(r.window=null),t.state=null,Ey},inflateGetHeader:(t,r)=>{if(vy(t))return Hu;const s=t.state;return(2&s.wrap)==0?Hu:(s.head=r,r.done=!1,Ey)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return vy(t)?Hu:(a=t.state,a.wrap!==0&&a.mode!==P1?Hu:a.mode===P1&&(c=1,c=AT(c,r,s,0),c!==a.check)?aK:(d=gK(t,r,s,s),d?(a.mode=16210,cK):(a.havedict=1,Ey)))},inflateInfo:"pako inflate (from Nodeca project)"},qye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _K=Object.prototype.toString,{Z_NO_FLUSH:Yye,Z_FINISH:Xye,Z_OK:UT,Z_STREAM_END:xM,Z_NEED_DICT:DM,Z_STREAM_ERROR:Jye,Z_DATA_ERROR:yK,Z_MEM_ERROR:Qye}=E1;function N1(t){this.options=b1.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new iK,this.strm.avail_out=0;let s=Sf.inflateInit2(this.strm,r.windowBits);if(s!==UT)throw new Error(my[s]);if(this.header=new qye,Sf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=LT.string2buf(r.dictionary):_K.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=Sf.inflateSetDictionary(this.strm,r.dictionary),s!==UT)))throw new Error(my[s])}function Zye(t,r){const s=new N1(r);if(s.push(t),s.err)throw s.msg||my[s.err];return s.result}N1.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Xye:Yye,_K.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=Sf.inflate(s,h),d===DM&&c&&(d=Sf.inflateSetDictionary(s,c),d===UT?d=Sf.inflate(s,h):d===yK&&(d=DM));s.avail_in>0&&d===xM&&s.state.wrap>0&&t[s.next_in]!==0;)Sf.inflateReset(s),d=Sf.inflate(s,h);switch(d){case Jye:case yK:case DM:case Qye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===xM))if(this.options.to==="string"){let g=LT.utf8border(s.output,s.next_out),E=s.next_out-g,b=LT.buf2string(s.output,g);s.next_out=E,s.avail_out=a-E,E&&s.output.set(s.output.subarray(g,g+E),0),this.onData(b)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==UT||m!==0){if(d===xM)return d=Sf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},N1.prototype.onData=function(t){this.chunks.push(t)},N1.prototype.onEnd=function(t){t===UT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var eEe={inflate:Zye};const{deflate:tEe}=Lye,{inflate:nEe}=eEe;var rEe=tEe,iEe=nEe,EK=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(EK||{});class sEe{constructor(){Y(this,"_sequence",0),Y(this,"_startTime",Date.now()),Y(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&L.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&L.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let g=!1;if(m.datas.length>0){const E=m.datas.find(b=>b.id===0);E&&(g=(1&new DataView(E.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let g=0;if(m.setUint8(g++,s),m.setUint8(g++,a),c.forEach(E=>{s?(m.setUint8(g++,E.id),m.setUint8(g++,E.length),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength):(m.setUint8(g++,E.id|E.length<<4),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength)}),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===EK.TWO_BYTE,m=[],g=new DataView(r,2);let E=0;for(;E<d;){let b=0,I=0,A=new ArrayBuffer(0);h?(b=g.getUint8(E),E++,I=g.getUint8(E),E++):(b=15&g.getUint8(E),I=g.getUint8(E)>>4,E++),I>0&&(A=g.buffer.slice(E+2,E+2+I),E+=A.byteLength),m.push({id:b,length:I,data:A})}if(E!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return iEe(new Uint8Array(r))}compress(r){return rEe(new Uint8Array(r))}}const oEe={name:"DataStream",create:(t,r)=>{const s=r?new pge(t):new fge(t);return s.useDataStream(new sEe),s}};class aEe extends Jr{constructor(r,s,a){super(),Y(this,"ws",void 0),Y(this,"requestId",1),Y(this,"heartBeatTimer",void 0),Y(this,"joinInfo",void 0),Y(this,"clientId",void 0),Y(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Y(this,"onClose",c=>{this.emit("close"),this.dispose()}),Y(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new lT("cross-channel-".concat(this.clientId),a),this.ws.on(ln.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(ln.CONNECTED,this.onOpen),this.ws.on(ln.ON_MESSAGE,this.onMessage),this.ws.on(ln.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new gt((s,a)=>{const c=window.setTimeout(()=>{a(new Oe(ee.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new Oe(ee.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Oe(ee.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(ee.WS_DISCONNECT);const s=()=>new gt((h,m)=>{this.ws.once(ln.CLOSED,()=>m(new Oe(ee.WS_ABORT))),this.ws.once(ln.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new gt((h,m)=>{const g=()=>{m(new Oe(ee.WS_ABORT))};this.ws.once(ln.RECONNECTING,g),this.ws.once(ln.CLOSED,g),this.once("req_".concat(a),h),Rs(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(ln.RECONNECTING,g),this.ws.off(ln.CLOSED,g),m(new Oe(ee.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Oe(ee.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(ln.REQUEST_NEW_URLS),this.ws.on(ln.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class cEe extends Jr{set state(r){r!==this._state&&(r!==tc.RELAY_STATE_FAILURE&&(this.errorCode=iS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),Y(this,"joinInfo",void 0),Y(this,"sid",void 0),Y(this,"clientId",void 0),Y(this,"cancelToken",Ia.CancelToken.source()),Y(this,"workerToken",void 0),Y(this,"requestId",0),Y(this,"signal",void 0),Y(this,"prevChannelMediaConfig",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"_resolution",void 0),Y(this,"_state",tc.RELAY_STATE_IDLE),Y(this,"errorCode",iS.RELAY_OK),Y(this,"onStatus",h=>{L.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",mf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",mf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=iS.SRC_TOKEN_EXPIRED,this.state=tc.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=iS.DEST_TOKEN_EXPIRED,this.state=tc.RELAY_STATE_FAILURE))}),Y(this,"onReconnect",async()=>{L.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",mf.NETWORK_DISCONNECTED),this.state=tc.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==tc.RELAY_STATE_IDLE&&(L.error("auto restart channel media relay failed",h.toString()),this.errorCode=iS.SERVER_CONNECTION_LOST,this.state=tc.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=ty(),this.signal=new aEe(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==tc.RELAY_STATE_IDLE)throw new Oe(ee.INVALID_OPERATION);this.state=tc.RELAY_STATE_CONNECTING,await this.connect(),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(ee.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(ee.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(ee.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==tc.RELAY_STATE_RUNNING)throw new Oe(ee.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==tc.RELAY_STATE_RUNNING)throw new Oe(ee.INVALID_OPERATION);const s=this.genMessage(la.SetVideoProfile);await this.signal.request(s),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),L.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tc.RELAY_STATE_IDLE,this.dispose()}dispose(){L.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ia.CancelToken.source(),this.state=tc.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await E_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",mf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(la.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(la.SetSdkProfile,r);await this.signal.request(a),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(la.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",mf.PACKET_JOINED_SRC_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(la.SetSourceUserId,r);await this.signal.request(d),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(la.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",mf.PACKET_JOINED_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(la.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",mf.PACKET_SENT_TO_DEST_CHANNEL),this.state=tc.RELAY_STATE_RUNNING,L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(la.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",mf.PACKET_UPDATE_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(la.StopPacketTransfer);await this.signal.request(r),L.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case la.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case la.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new Oe(ee.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case la.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new Oe(ee.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case la.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(ee.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case la.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case la.Reconnect:return h.clientRequest={command:"Reconnect"},h;case la.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case la.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(ee.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case la.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const lEe={name:"ChannelMediaRelay",create:function(t){return new cEe(t.joinInfo,t.clientId,t.websocketRetryConfig||Vi,t.httpRetryConfig||Vi,t.resolution)}};function vK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function VT(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class uEe extends Jr{constructor(r,s,a,c){super(),Y(this,"spec",void 0),Y(this,"token",void 0),Y(this,"websocket",void 0),Y(this,"pingpongTimer",void 0),Y(this,"reconnectMode","retry"),Y(this,"serviceMode",void 0),Y(this,"reqId",0),Y(this,"commandReqId",0),Y(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Y(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Pt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===ff.TRANSCODE?1:2}),this.emit(Km.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new lT("live-streaming",a),this.websocket.on(ln.CONNECTED,this.handleWebSocketOpen),this.websocket.on(ln.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(ln.REQUEST_NEW_URLS,(d,h)=>{js(this,Km.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(ln.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(ee.UNEXPECTED_ERROR);const m=VT({command:r,sdkVersion:zl==="4.24.0"?"0.0.1":zl,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(ee.WS_DISCONNECT);const g=()=>new gt((A,k)=>{this.websocket.once(ln.CLOSED,()=>k(new Oe(ee.WS_ABORT))),this.websocket.once(ln.CONNECTED,A)});this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new gt((A,k)=>{const G=()=>{k(new Oe(ee.WS_ABORT))};this.websocket.once(ln.RECONNECTING,G),this.websocket.once(ln.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{A(j)})});c&&Pt.workerEvent(this.spec.sid,VT(VT({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const b=Date.now();this.websocket.sendMessage(m);let I=null;try{I=await E}catch(A){if(this.websocket.state==="closed")throw A;return await g(),await this.request(r,s,a)}return c&&Pt.workerEvent(this.spec.sid,VT(VT({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(I.serverResponse),serverCode:I.code,success:I.code===200,responseTime:Date.now()-b})),I.code!==200&&this.handleResponseError(I),I}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=zl==="4.24.0"?"0.0.1":zl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Gi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void L.warning("live stream response already exists stream");case Gi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Gi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Gi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(ee.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(ee.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(ee.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(ee.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(ee.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(ee.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Km.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(ee.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(_P)},6e3)}}function SK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function nc(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?SK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):SK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class dEe extends Jr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vi,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Vi;super(),Y(this,"onLiveStreamWarning",void 0),Y(this,"onLiveStreamError",void 0),Y(this,"spec",void 0),Y(this,"retryTimeout",1e4),Y(this,"connection",void 0),Y(this,"httpRetryConfig",void 0),Y(this,"wsRetryConfig",void 0),Y(this,"streamingTasks",new Map),Y(this,"isStartingStreamingTask",!1),Y(this,"taskMutex",new eo("live-streaming")),Y(this,"cancelToken",Ia.CancelToken.source()),Y(this,"transcodingConfig",void 0),Y(this,"uapResponse",void 0),Y(this,"lastTaskId",1),Y(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=nc(nc({},Jge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(L.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>nc(nc(nc({},Xge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){ti(h.width)||gr(h.width,"config.width",0,1e4),ti(h.height)||gr(h.height,"config.height",0,1e4),ti(h.videoBitrate)||gr(h.videoBitrate,"config.videoBitrate",1,1e6),ti(h.videoFrameRate)||gr(h.videoFrameRate,"config.videoFrameRate"),ti(h.lowLatency)||jd(h.lowLatency,"config.lowLatency"),ti(h.audioSampleRate)||Ji(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ti(h.audioBitrate)||gr(h.audioBitrate,"config.audioBitrate",1,128),ti(h.audioChannels)||Ji(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),ti(h.videoGop)||gr(h.videoGop,"config.videoGop"),ti(h.videoCodecProfile)||Ji(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ti(h.userCount)||gr(h.userCount,"config.userCount",0,17),ti(h.backgroundColor)||gr(h.backgroundColor,"config.backgroundColor",0,16777215),ti(h.userConfigExtraInfo)||Cs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!ti(h.transcodingUsers)&&(pf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,g)=>{BP(m.uid),ti(m.x)||gr(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),ti(m.y)||gr(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),ti(m.width)||gr(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),ti(m.height)||gr(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),ti(m.zOrder)||gr(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),ti(m.alpha)||gr(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)})),ti(h.watermark)||x2(h.watermark,"watermark"),ti(h.backgroundImage)||x2(h.backgroundImage,"backgroundImage"),h.images&&!ti(h.images)&&(pf(h.images,"config.images"),h.images.forEach((m,g)=>{x2(m,"images[".concat(g,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>nc(nc(nc({},N2),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(nc(nc(nc({},N2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(nc(nc(nc({},N2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>nc({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?gt.resolve(h.uid):KH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await gt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Cc(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});L.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{L.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{L.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(g=>{L.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===ff.TRANSCODE)throw new Oe(ee.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};L.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new Oe(ee.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case ff.TRANSCODE:c.transcodingConfig=nc({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new gt((E,b)=>{Rs(this.retryTimeout).then(()=>{if(a)return b(a);const I=this.statusError.get(r);return I?(this.statusError.delete(r),b(I)):void 0})}),g=await gt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===ff.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,L.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new gt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(ee.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===ff.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(Cc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ia.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(ee.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await js(this,D2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new uEe(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Km.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Km.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Km.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Oe(ee.UNEXPECTED_ERROR,"can not get new live streaming address list"));js(this,D2.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(ee.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return L.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(ee.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Cc(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(L.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(ee.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{L.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(g=>{L.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const hEe={name:"LiveStreaming",create:function(t){return new dEe(t.joinInfo,t.websocketRetryConfig||Vi,t.httpRetryConfig||Vi)}};function pEe(t){let r=TK();return function(s,a){let c=s.appId;c!==void 0&&(cr(a,10),op(a,c));let d=s.cid;d!==void 0&&(cr(a,16),cr(a,d));let h=s.cname;h!==void 0&&(cr(a,26),op(a,h));let m=s.deviceId;m!==void 0&&(cr(a,34),op(a,m));let g=s.elapse;g!==void 0&&(cr(a,40),lg(a,g));let E=s.fileSize;E!==void 0&&(cr(a,48),lg(a,SS(E)));let b=s.height;b!==void 0&&(cr(a,56),lg(a,SS(b)));let I=s.jpg;I!==void 0&&(cr(a,66),cr(a,I.length),function(so,ze){let rt=bS(so,ze.length);so.bytes.set(ze,rt)}(a,I));let A=s.networkType;A!==void 0&&(cr(a,72),lg(a,SS(A)));let k=s.osType;k!==void 0&&(cr(a,80),lg(a,SS(k)));let G=s.requestId;G!==void 0&&(cr(a,90),op(a,G));let j=s.sdkVersion;j!==void 0&&(cr(a,98),op(a,j));let B=s.sequence;B!==void 0&&(cr(a,104),lg(a,SS(B)));let Z=s.sid;Z!==void 0&&(cr(a,114),op(a,Z));let Q=s.timestamp;Q!==void 0&&(cr(a,120),lg(a,Q));let ae=s.uid;ae!==void 0&&(cr(a,128),cr(a,ae));let ye=s.vid;ye!==void 0&&(cr(a,136),cr(a,ye));let _e=s.width;_e!==void 0&&(cr(a,144),lg(a,SS(_e)));let ue=s.service;ue!==void 0&&(cr(a,152),cr(a,ue));let Ie=s.callbackData;Ie!==void 0&&(cr(a,162),op(a,Ie));let Ue=s.jpgEncryption;Ue!==void 0&&(cr(a,168),cr(a,Ue));let We=s.requestType;We!==void 0&&(cr(a,176),cr(a,We));let Qe=s.scorePorn;Qe!==void 0&&(cr(a,185),FM(a,Qe));let fn=s.scoreSexy;fn!==void 0&&(cr(a,193),FM(a,fn));let vn=s.scoreNeutral;vn!==void 0&&(cr(a,201),FM(a,vn));let Jt=s.scene;Jt!==void 0&&(cr(a,208),cr(a,Jt));let nr=s.ossFilePrefix;nr!==void 0&&(cr(a,218),op(a,nr));let qn=s.serviceVendor;if(qn!==void 0)for(let so of qn){cr(a,226);let ze=TK();gEe(so,ze),cr(a,ze.limit),vEe(a,ze),EEe(ze)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function fEe(t){return function(s){let a={};e:for(;!CK(s);){let c=ap(s);switch(c>>>3){case 0:break e;case 1:a.code=ap(s);break;case 2:a.msg=RK(s,ap(s));break;case 3:{let d=_Ee(s);a.data=mEe(s),s.limit=d;break}default:bK(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function mEe(t){let r={};e:for(;!CK(t);){let s=ap(t);switch(s>>>3){case 0:break e;case 1:r.requestId=RK(t,ap(t));break;case 2:r.requestType=ap(t)>>>0;break;case 3:r.scorePorn=VM(t);break;case 4:r.scoreSexy=VM(t);break;case 5:r.scoreNeutral=VM(t);break;case 6:r.requestScene=ap(t)>>>0;break;case 7:r.scene=ap(t)>>>0;break;default:bK(t,7&s)}}return r}function gEe(t,r){let s=t.service;s!==void 0&&(cr(r,8),cr(r,s));let a=t.vendor;a!==void 0&&(cr(r,16),cr(r,a));let c=t.token;c!==void 0&&(cr(r,26),op(r,c));let d=t.callbackUrl;d!==void 0&&(cr(r,34),op(r,d))}function _Ee(t){let r=ap(t),s=t.limit;return t.limit=t.offset+r,s}function bK(t,r){switch(r){case 0:for(;128&IK(t););break;case 2:MM(t,ap(t));break;case 5:MM(t,4);break;case 1:MM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let yEe=new Float32Array(1);new Uint8Array(yEe.buffer);let LM=new Float64Array(1),rc=new Uint8Array(LM.buffer);function SS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let wK=[];function TK(){const t=wK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function EEe(t){wK.push(t)}function MM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function CK(t){return t.offset>=t.limit}function bS(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function UM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function RK(t,r){let s=UM(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,b,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],b=c[m+s+3],(12632256&(g|E<<8|b<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&b,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function op(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}cr(t,a);let c=bS(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function vEe(t,r){let s=bS(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function IK(t){return t.bytes[UM(t,1)]}function AK(t,r){let s=bS(t,1);t.bytes[s]=r}function VM(t){let r=UM(t,8),s=t.bytes;return rc[0]=s[r++],rc[1]=s[r++],rc[2]=s[r++],rc[3]=s[r++],rc[4]=s[r++],rc[5]=s[r++],rc[6]=s[r++],rc[7]=s[r++],LM[0]}function FM(t,r){let s=bS(t,8),a=t.bytes;LM[0]=r,a[s++]=rc[0],a[s++]=rc[1],a[s++]=rc[2],a[s++]=rc[3],a[s++]=rc[4],a[s++]=rc[5],a[s++]=rc[6],a[s++]=rc[7]}function ap(t){let r,s=0,a=0;do r=IK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function cr(t,r){for(r>>>=0;r>=128;)AK(t,127&r|128),r>>>=7;AK(t,r)}function lg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=bS(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function PK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const SEe=new Map([["moderation",1],["supervise",2]]);class bEe extends Jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(gs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ka(s=r.map(a=>SEe.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),Y(this,"name","AgoraRTCVideoContentInspect"),Y(this,"_connectionState",Fu.CONNECTING),Y(this,"_innerConnectionState",void 0),Y(this,"sequence",0),Y(this,"inspectStartTime",void 0),Y(this,"workerManagerConnection",void 0),Y(this,"workerConnection",void 0),Y(this,"workerMessageLengthLimit",void 0),Y(this,"inspectIntervalMinimum",void 0),Y(this,"qualityRatio",void 0),Y(this,"_connectInfo",void 0),Y(this,"_cancelTokenSource",Ia.CancelToken.source()),Y(this,"_retryConfig",void 0),Y(this,"wmSequence",0),Y(this,"inspectInterval",void 0),Y(this,"inspectTimer",null),Y(this,"ossFilePrefix",void 0),Y(this,"extraInfo",void 0),Y(this,"_inspectType",void 0),Y(this,"_inspectMode",void 0),Y(this,"_quality",1),Y(this,"qualityTimer",null),Y(this,"_inspectId",void 0),Y(this,"_needWorkUrlOnly",!1),Y(this,"inspectImage",()=>{if(this.connectionState!==Fu.CONNECTED)throw new Oe(ee.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Fu.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Er(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new lT("worker-manager-"+this._inspectId,Vi),this.on(gs.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,L.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ju[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new lT("worker-"+this._inspectId,Vi),this.handleWorkerEvents()}async init(r,s){this.emit(gs.STATE_CHANGE,ju.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new gt((c,d)=>{this.on(gs.CONNECTION_STATE_CHANGE,(h,m)=>{m===Fu.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,g,E,b){let{appId:I,areaCode:A,cname:k,sid:G,token:j,uid:B}=g;dS++;const Z="image_moderation_api",Q={service_name:Z,json_body:JSON.stringify({appId:I,areaCode:A,cname:k,command:"allocateEdge",requestId:dS,seq:dS,sid:G,token:j,ts:Date.now(),uid:B+""})};let ae,ye,_e=m[0];return Bd(async()=>{ae=Date.now();const ue=await $d(_e,{data:Q,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-ae,ue.code!==0){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:ye});throw L.error(Qe.toString()),Qe}const Ie=JSON.parse(ue.json_body);if(Ie.code!==200){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ie.code,", reason: ").concat(Ie.reason),{code:Ie.code,responseTime:ye});throw L.error(Qe.toString()),Qe}if(!Ie.servers||!Array.isArray(Ie.servers)||Ie.servers.length===0){const Qe=new Oe(ee.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ie.code,responseTime:ye});throw L.error(Qe.toString()),Qe}const Ue=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),We=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ie.servers.map(Qe=>{let{address:fn,wss:vn}=Qe;if(fn&&vn)return"wss://".concat(fn.replace(/\./g,"-"),".").concat(Ue,":").concat(We||vn)}).filter(Qe=>!!Qe),workerToken:Ie.workerToken,vid:Ie.vid,responseTime:ye}},(ue,Ie)=>(Pt.apworkerEvent(G,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Ie===0,responseTime:ye,serverIp:m[Ie%m.length]}),!1),(ue,Ie)=>(Pt.apworkerEvent(G,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:Z,responseTime:ye,serverIp:m[Ie%m.length]}),!!(ue.code!==ee.OPERATION_ABORTED&&ue.code!==ee.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(_e=m[(Ie+1)%m.length],!0)),b)}(c,r,s,a);this.emit(gs.STATE_CHANGE,ju.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(gs.STATE_CHANGE,ju.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(ln.CONNECTED,async()=>{this.emit(gs.STATE_CHANGE,ju.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(ln.CLOSED,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(ln.FAILED,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(ln.RECONNECTING,()=>{this._innerConnectionState<ju.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(ln.ON_MESSAGE,async r=>{this.emit(gs.STATE_CHANGE,ju.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw L.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Oe(ee.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw L.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Oe(ee.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(gs.STATE_CHANGE,ju.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(gs.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(ln.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(ln.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(ln.CONNECTED,async()=>{this.emit(gs.STATE_CHANGE,ju.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Fu.CONNECTED}),this.workerConnection.on(ln.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=fEe(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&L.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(gs.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Ka(s=Object.keys(c)).call(s,(m,g)=>c[m]>c[g]?m:g,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(gs.INSPECT_RESULT,h)}else this.emit(gs.INSPECT_RESULT,void 0,new Oe(ee.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(gs.INSPECT_RESULT,void 0,new Oe(ee.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else L.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(gs.INSPECT_RESULT,void 0,new Oe(ee.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(ln.CLOSED,()=>{this.connectionState=Fu.CLOSED}),this.workerConnection.on(ln.FAILED,()=>{this.connectionState=Fu.CLOSED}),this.workerConnection.on(ln.RECONNECTING,()=>{this.connectionState=this.connectionState===Fu.CONNECTED?Fu.RECONNECTING:Fu.CONNECTING}),this.workerConnection.on(ln.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(ln.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(gs.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=Qc(this,gs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(gs.INSPECT_RESULT,void 0,new Oe(ee.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(gs.INSPECT_RESULT,void 0,new Oe(ee.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),b=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await uG(b,a,c),A=this.sequence+"-"+d+"-"+g+"-"+E+"-"+Er(12,""),k={appId:a,cid:d,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:I.byteLength,jpgEncryption:2,height:b.height,width:b.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:U7(E),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const j=pEe(k);if(j.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const B=function(Z){for(var Q=1;Q<arguments.length;Q++){var ae=arguments[Q]!=null?arguments[Q]:{};Q%2?PK(Object(ae),!0).forEach(function(ye){Y(Z,ye,ae[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(ae)):PK(Object(ae)).forEach(function(ye){Object.defineProperty(Z,ye,Object.getOwnPropertyDescriptor(ae,ye))})}return Z}({},k);delete B.jpg,L.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(B))}return j}{const B=this.quality*this.qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ia.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Fu.CLOSED,this.emit(gs.STATE_CHANGE,ju.CLOSED)}}const wEe={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(ee.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(ee.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!tt(d=["supervise","moderation"]).call(d,c))throw new Oe(ee.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(ee.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new bEe(r)}};var kK=l(De.Object.getOwnPropertySymbols),TEe=Gn,CEe=_d.indexOf,REe=o_,jM=ne([].indexOf),OK=!!jM&&1/jM([1],1,-0)<0;TEe({target:"Array",proto:!0,forced:OK||!REe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return OK?jM(this,t,r)||0:CEe(this,t,r)}});var IEe=Ec("Array","indexOf"),AEe=N,PEe=IEe,BM=Array.prototype,kEe=function(t){var r=t.indexOf;return t===BM||AEe(BM,t)&&r===BM.indexOf?PEe:r},NK=l(kEe);function OEe(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var g={};for(var E in h)if({}.hasOwnProperty.call(h,E)){if(NK(m).call(m,E)!==-1)continue;g[E]=h[E]}return g}(t,r);if(kK){var d=kK(t);for(a=0;a<d.length;a++)s=d[a],NK(r).call(r,s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let xK=class{get localCapabilities(){return Kr(this._localCapabilities)}get rtpCapabilities(){return Kr(this._rtpCapabilities)}get candidates(){return Kr(this._candidates)}get iceParameters(){return Kr(this._iceParameters)}get dtlsParameters(){return Kr(this._dtlsParameters)}constructor(t){Y(this,"sessionDesc",void 0),Y(this,"_localCapabilities",void 0),Y(this,"_rtpCapabilities",void 0),Y(this,"_candidates",void 0),Y(this,"_iceParameters",void 0),Y(this,"_dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname","o/i14u9pJrxRKAsu"),Y(this,"firefoxSsrcMidMap",new Map),t=Kr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:g,audioCodec:E}=t;let b;this.setup=m,b=h===ca.RECEIVE_ONLY?Za(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Za(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const I=h===ca.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===ca.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===ca.RECEIVE_ONLY?c.send.videoCodecs:pT(Et.VIDEO,I,A,g),G=h===ca.RECEIVE_ONLY?c.send.audioCodecs:pT(Et.AUDIO,I,A,E);for(const j of b.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=a,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=k.map(B=>B.payloadType.toString(10)),j.attributes.payloads=k,j.attributes.extmaps=I.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(B=>B.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=I.audioExtensions,uS(j));this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=hT(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(ei()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,d,a);let E;return g===-1?(E=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(E=Kr(this.sessionDesc.mediaDescriptions[g]),E.attributes.direction="sendonly",E.attributes.ssrcs=d,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(E,c)),ei()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Kr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:g})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(t),E={foundation:r??"",componentId:"1",transport:s??"",priority:g?g+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(b=>b.priority===E.priority&&b.connectionAddress===E.connectionAddress&&b.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(b=>{b.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=pT(d,h,this.localCapabilities.send,d===Et.AUDIO?c:a),g=d===Et.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let b={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};b=this.mungRecvMediaDsec(b,t);const I=this.findFirstClosedMedia(d);if(I){const A=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[A]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>tt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>tt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(ei()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Kr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===Et.VIDEO?h.videoCodecs:h.audioCodecs,g=t===Et.VIDEO?h.videoExtensions:h.audioExtensions;ei()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(I=>I.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,d);const b=this.findFirstClosedMedia(t);if(b){const I=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[I]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(t,r,s){const a=Kr(t);return j2(a),lS(a,r),B2(a,r),IH(a),YP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=Kr(t);return YP(s,r,this.localCapabilities.recv),uS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>ei()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const NEe=["sdp"];var xr;function DK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ug(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):DK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let LK=(xr=class US extends lH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),Y(this,"direction",void 0),Y(this,"name",void 0),Y(this,"store",void 0),Y(this,"spec",void 0),Y(this,"peerConnection",void 0),Y(this,"initialOffer",void 0),Y(this,"transport",void 0),Y(this,"statsFilter",void 0),Y(this,"localCandidateCount",0),Y(this,"_isInRestartIce",!1),Y(this,"mutex",void 0),Y(this,"onLocalCandidate",void 0),Y(this,"remoteSDP",void 0),Y(this,"pendingCandidates",[]),Y(this,"localCapabilities",void 0),Y(this,"isReady",!1),Y(this,"restartCnt",0),Y(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new eo("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(US.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??ca.SEND_ONLY,this.name=this.direction===ca.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ei()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await PH();if(this.localCapabilities=XP(s),r){const{sdp:a}=r,c=OEe(r,NEe),d=function(){const b={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},I=dT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Bu(I,b,"videoExtensions",A,k,G),Bu(I,b,"videoCodecs",A,k,G),Bu(I,b,"audioExtensions",A,k,G),Bu(I,b,"audioCodecs",A,k,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const B=G.videoCodecs.findIndex(Z=>Z.rtpMap&&Z.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<j){L.debug("raising H264 baseline profile priority");const Z=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(B,0,Z)}B!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(Z=>!(Z.rtpMap&&Z.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Z.fmtp&&Z.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:k,sendrecv:G}}({},{},a);this.remoteSDP=new xK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Jm(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await kH({},{},h.sdp);this.localCapabilities=XP(g);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),ug(ug({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp);return this.initialOffer=a,ug(ug({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await kH({},{},s);this.remoteSDP=new xK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(ee.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Bl(function*(){const d=yield Vn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((B,Z)=>{if(m[Z].needCreateTransceiver){const Q=c.peerConnection.addTransceiver(B._mediaStreamTrack,{direction:"sendonly"});h.push(Q),B._updateRtpTransceiver(Q)}else{const Q=c.peerConnection.getTransceivers().find(ae=>ae.mid===m[Z].mid);if(!Q)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Z].mid));h.push(Q),B._updateRtpTransceiver(Q)}}),ei()&&oe("SIMULCAST")===!0&&(yield Vn(c.applySimulcastForFirefox(h,r)));const g=m.map(B=>B.mid),E=yield Vn(c.peerConnection.createOffer()),b=c.mungSendOfferSDP(E.sdp,r,g),I=Za(b),A=g.map(B=>{const Z=I.mediaDescriptions.find(Q=>Q.attributes.mid===B);if(!Z)throw new Error("Cannot extract ssrc from mediaDescription.");return TH(Z,oe("USE_PUB_RTX"))}),k=h.map((B,Z)=>{const Q=g[Z];return{localSSRC:A[Z],id:Q}});yield Vn(c.peerConnection.setLocalDescription({type:"offer",sdp:b}));try{yield k}catch(B){const Z=c.remoteSDP.toString();throw yield Vn(c.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Vn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Z})),yield Vn(c.stopSending(g,!0)),B}yield Vn(c.applySimulcastEncodings(h,r)),yield Vn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(b,"offer","local","send");return j==null||j(G),yield Vn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((B,Z)=>{const Q=g[Z];return{localSSRC:A[Z],id:Q}})}catch(h){throw h instanceof Le?h:new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(g=>r.indexOf(g.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(g=>{var E;g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const b=await this.peerConnection.createAnswer(),I=this.mungReceiveAnswerSDP(b.sdp,d,r);E==null||E(I||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:I}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(g=>g.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),b=this.mungReceiveAnswerSDP(E.sdp,d,r);g==null||g(b||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:b}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===ny.Auto&&(this.store.p2pTransport=ny.SdRtn,Fn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(US.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Fn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(US.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Jm(s.sdp);return this.store.descriptionStart(),this.direction===ca.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===ca.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Jm(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(ee.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?ei()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:ug(ug({},Yh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:ug(ug({},Yh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;tt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Xw(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...US.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...US.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),tt(d=[ny.Relay,ny.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Fn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),L.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);L.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case ny.SdRtn:const m=r.filter(E=>{var b;return tt(b=E.username).call(b,"glb:")&&E.turnServerURL==E.turnServerURL}),g=m.length>a?m[a]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Ym(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Ym(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case ny.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(uy(d)),", remote ").concat(JSON.stringify(uy(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(b=>b.track===r._mediaStreamTrack)),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:b,frameRate:I,scaleResolutionDownBy:A}=r._encoderConfig;b&&(d.maxBitrate=1e3*b),tt(h=r._hints).call(h,_r.LOW_STREAM)&&(I&&(d.maxFramerate=Pc(I)),A&&A>=1&&(d.scaleResolutionDownBy=A))}if(oe("DSCP_TYPE")&&hf()){var m;const b=oe("DSCP_TYPE");tt(m=["very-low","low","medium","high"]).call(m,b)&&(d.networkPriority=b)}const g=s.getParameters(),E=(a=g.encodings)===null||a===void 0?void 0:a[0];ei()&&!E&&(c.encodings=[d]),E&&Object.assign(E,d),Object.assign(g,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Nr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Za(r);return s.forEach((d,h)=>{const m=a[h],g=c.mediaDescriptions.find(E=>E.attributes.mid===m);g&&(lS(g,d),AH(g,d,this.store.codec))}),Hm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],b=s[g];if(b instanceof Nr&&!tt(a=b._hints).call(a,_r.LOW_STREAM)&&(c=b._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=b._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=b._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=b._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=E.sender.getParameters();await E.sender.setParameters(Object.assign(k,I))}}}async applySimulcastEncodings(r,s){if(!ei()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Nr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Nr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!tt(s=r._hints).call(s,_r.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const d=(c=Za(s).mediaDescriptions.find(h=>h.attributes.mid===r))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),tt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=Za(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===Et.AUDIO&&d.media.mediaType==="audio"&&uS(d),Hm(c)}},It(xr.prototype,"establish",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"establish"),xr.prototype),It(xr.prototype,"connect",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"connect"),xr.prototype),It(xr.prototype,"receive",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"receive"),xr.prototype),It(xr.prototype,"mockReceive",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"mockReceive"),xr.prototype),It(xr.prototype,"stopReceiving",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"stopReceiving"),xr.prototype),It(xr.prototype,"restartICE",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"restartICE"),xr.prototype),It(xr.prototype,"close",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"close"),xr.prototype),It(xr.prototype,"updateEncoderConfig",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"updateEncoderConfig"),xr.prototype),It(xr.prototype,"updateSendParameters",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"updateSendParameters"),xr.prototype),It(xr.prototype,"replaceTrack",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"replaceTrack"),xr.prototype),It(xr.prototype,"muteLocal",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"muteLocal"),xr.prototype),It(xr.prototype,"unmuteLocal",[$u],Object.getOwnPropertyDescriptor(xr.prototype,"unmuteLocal"),xr.prototype),xr);function $u(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}let Yd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var MK,UK,VK,FK,jK,BK,zK,WK,GK,HK,$K,qr;function KK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function x1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let xEe=(MK=Xd(Yd.SEND_ONLY),UK=Xd(Yd.SEND_ONLY),VK=Xd(),FK=Xd(Yd.RECEIVE_ONLY),jK=Xd(Yd.RECEIVE_ONLY),BK=Xd(Yd.RECEIVE_ONLY),zK=Xd(Yd.RECEIVE_ONLY),WK=Xd(Yd.RECEIVE_ONLY),GK=Xd(Yd.RECEIVE_ONLY),HK=Xd(),$K=Xd(Yd.RECEIVE_ONLY),qr=class extends Jr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),Y(this,"isPlanB",!1),Y(this,"store",void 0),Y(this,"statsUploader",void 0),Y(this,"sendConnection",void 0),Y(this,"recvConnection",void 0),Y(this,"localTrackMap",new Map),Y(this,"remoteUserMap",new Map),Y(this,"localDataChannels",[]),Y(this,"pendingLocalTracks",[]),Y(this,"pendingRemoteTracks",[]),Y(this,"statsCollector",void 0),Y(this,"dtlsFailedCount",0),Y(this,"sendMutex",void 0),Y(this,"recvMutex",void 0),Y(this,"_state",ir.Disconnected),Y(this,"_restartStates",["disconnected","failed"]),Y(this,"reconnectInterval",void 0),Y(this,"uploadUnplinkStarted",!1),Y(this,"uploadDownlinkStarted",!1),Y(this,"uplinkStateUploadInterval",void 0),Y(this,"downlinkStatsUploadInterval",void 0),Y(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(s);if(g.length===0)return void a();const E=g.find(k=>k[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map(k=>{let[,{id:G}]=k;return G}));let b=!1;var h,m;s.trackMediaType==="video"?b=!((h=this.localTrackMap.get(Xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):b=((m=this.localTrackMap.get(Xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const I=this.createMuteMessage(g);await yr(this,Vt.RequestMuteLocal,I);const A=s.trackMediaType==="video"?qm.MUTE_LOCAL_VIDEO:qm.MUTE_LOCAL_AUDIO;await yr(this,Vt.RequestP2PMuteLocal,{action:A,message:I,isMuteAll:b}),a()}catch(g){c(g)}finally{d()}}),Y(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ir.Connected)return void c(new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:b}]=E;return b}));const m=this.createUnmuteMessage(h),g=s.trackMediaType==="video"?qm.UNMUTE_LOCAL_VIDEO:qm.UNMUTE_LOCAL_AUDIO;await yr(this,Vt.RequestP2PMuteLocal,{action:g,message:m}),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==s||this.state!==ir.Connected)return void a();const{id:E,track:b}=g;E&&(await this.sendConnection.updateSendParameters(E,b),await this.sendConnection.updateEncoderConfig(E,b),this.emit(Vt.UpdateVideoEncoder,b)),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}}),Y(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==ir.Connected)return void a();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}}),Y(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;L.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:I}]=b;return s===I});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==ir.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===Xe.LocalVideoTrack&&Fn().supportDualStreamEncoding){const b=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(b){const I=s._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=I,b.track._originMediaStreamTrack=I,await new gt((A,k)=>{this.handleReplaceTrack(b.track,A,k,!0)})}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}}),Y(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),Y(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),Y(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),Y(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new d7(t),this.bindStatsUploaderEvents(),this.sendMutex=new eo("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new eo("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new LK(t,this.store,ca.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=ir.New,this.sendConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new LK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ir.Connected}async addRemoteCandidate(t,r){if(r===ca.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(ee.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Bl(function*(){const c=yield Vn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==ir.Connected){a.throwIfTrackTypeNotMatch(t);const E=t.filter(b=>a.pendingLocalTracks.indexOf(b)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(E))}a.store.pubId=a.store.pubId+1,io.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield Vn(a.tryToUnmuteAudio(t)));d.forEach(E=>{let{track:b,type:I}=E;const A=Date.now();a.store.publish(b.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",A)}),a.bindLocalTrackEvents(d);const h=yield Vn(a.sendConnection.send(d.map(E=>{let{track:b}=E;return b}),a.store.codec,a.store.audioCodec)),m=(yield Vn(h.next())).value,g=a.createGatewayPublishMessage(d,m);try{yield g}catch(E){throw h.throw(E),(E==null?void 0:E.code)===ee.WS_ABORT&&d.forEach(b=>{let{track:I}=b;a.pendingLocalTracks.indexOf(I)===-1&&a.pendingLocalTracks.push(I)}),a.unbindLocalTrackEvents(d),E}yield Vn(h.next()),d.forEach(E=>{let{type:b}=E;a.statsCollector.addLocalStats(b)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach(E=>{let{track:b,type:I}=E;const A=Date.now();a.store.publish(b.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",void 0,A)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==ir.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!tt(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ir.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:T_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{yr(this,Vt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{yr(this,Vt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Bl(function*(){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await js(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===Et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new tS(d,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new eS(d,t.uid,t._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(b=>{let{user:I,kind:A}=b;return I.uid===t.uid&&r===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var m;if(h===Et.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===Et.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var g,E;if(m===Et.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Et.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===Et.AUDIO){var b;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((b=h._audioTrack)===null||b===void 0||b._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;yr(this,Vt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[Et.VIDEO,Et.AUDIO].forEach(a=>{s.has(a)?yr(this,Vt.RequestP2PUnmuteRemote,a):yr(this,Vt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(ee.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Et.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Wi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Xe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Pt.publish(this.store.sessionId,{eventElapse:io.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(g=>g instanceof ai),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(g=>g instanceof Nr);Pt.publish(this.store.sessionId,{eventElapse:io.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(_r.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&Pt.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Et.VIDEO,audio:a===Et.AUDIO,peerid:s.uid,subscribeRequestid:a===Et.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:io.measureFromSubscribeStart(this.store.clientId,c)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new eo("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new eo("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Wi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ir.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Nr||r&&r.track instanceof ai?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(ec(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=G_(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ir.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:tt(r=a._hints).call(r,_r.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Wi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ec(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof tg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===ca.SEND_ONLY){if(!this.sendConnection)throw new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(ee.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await js(this,Vt.RequestP2PRestartICE,{direction:ca.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find(k=>{var G;return k.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(k=>{var G;return k.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!a||!c)return 1;const d=Qc(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,b=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=b<.17?1:b<.36?2:b<.59?3:b<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(_r.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(k&&G){const j=(1e3*k-G)/(1e3*k);return tH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const g=Qc(this,Vt.NeedSignalRTT),E=t.rtt,b=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let k=.7*A*100/50+.3*b/1500;I&&(k=.6*A*100/50+.2*b/1500+.2*I/400),r+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new gt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=Fn(),d=this.getAllTracks();t=Bv(t=t.filter(g=>d.indexOf(g)===-1));let h=!1,m=!1;for(const g of t){if(g instanceof Nr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:Xe.LocalVideoLowTrack})}if(g instanceof ai){const E=this.localTrackMap.get(Xe.LocalAudioTrack);if(E){if(!(E.track instanceof Wi))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const b=a.find(I=>{let{type:A}=I;return A===Xe.LocalAudioTrack});if(!(b.track instanceof Wi))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");b.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof Wi||g._bypassWebAudio)a.push({track:g,type:Xe.LocalAudioTrack});else{const b=new Wi;b.addAudioTrack(g),a.push({track:b,type:Xe.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ai){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Wi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Nr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(Ct.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Wi?t.trackList.forEach(s=>{s.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Ct.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(Ct.GET_STATS,this.handleGetLocalVideoStats),s.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Ct.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Ct.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Wi?t.trackList.forEach(r=>{r.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Ct.GET_STATS,this.handleGetLocalAudioStats),r.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Ct.GET_STATS,this.handleGetLocalAudioStats),t.off(Ct.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ct.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Ct.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ct.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof eS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof tS&&r.addListener(Ct.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Ct.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case Xe.LocalAudioTrack:d=or.Audio;break;case Xe.LocalVideoTrack:d=tt(c=h._hints).call(c,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:d=or.Low}return{kind:m===Xe.LocalAudioTrack?Et.AUDIO:Et.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),tt(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await Rs(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Pt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:$r.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Gl.FIRST_FRAME_DECODED),Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_AUDIO_DECODE,Br.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_AUDIO_RECEIVED,Br.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(ec(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&Pt.firstRemoteFrame(this.store.sessionId,Qi.FIRST_VIDEO_RECEIVED,Br.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Vt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===ca.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,L.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===ca.SEND_ONLY?this.restartICE(t):js(this,Vt.RequestP2PRestartICE,{direction:ca.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ai&&(s==null?void 0:s.track)instanceof Wi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ai&&(s==null?void 0:s.track)instanceof Wi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=or.Audio;break;case Xe.LocalVideoTrack:a=tt(s=d._hints).call(s,_r.SCREEN_TRACK)?or.Screen:or.High;break;case Xe.LocalVideoLowTrack:a=or.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case Et.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:a._videoSSRC}));case Et.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new gt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new gt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof ai){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await yr(this,Vt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rs(WL(this.dtlsFailedCount,Vi)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Nr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Nr).length>1)throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ai).length>1&&(t.some(r=>r instanceof ai&&r._bypassWebAudio)||!Fn().webAudioMediaStreamDest))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Nr&&this.pendingLocalTracks.some(s=>s instanceof Nr))throw new Le(ee.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ai&&this.pendingLocalTracks.some(s=>s instanceof ai)&&(!Fn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ai&&s._bypassWebAudio)))throw new Le(ee.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding,a=x1(x1({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():sM(t,a);const d=Er(8,"track-low-"),h=new Nr(c,x1(x1({},s&&{scaleResolutionDownBy:F2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(ry.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,qv.LOW_STREAM)}),h._hints.push(_r.LOW_STREAM),t.addListener(Ct.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(ec(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(g=>g.userId===d.uid&&g.type==="video");Pt.firstRemoteVideoDecode(this.store.sessionId,Qi.FIRST_VIDEO_DECODE,Br.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:io.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(ee.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(ee.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(ee.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(ee.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(ee.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(ee.NOT_SUPPORTED)}async preConnect(t){throw new Le(ee.NOT_SUPPORTED)}getEstablishParams(){throw new Le(ee.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(ee.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new Le(ee.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(qr.prototype,"p2pConnect",[MK],Object.getOwnPropertyDescriptor(qr.prototype,"p2pConnect"),qr.prototype),It(qr.prototype,"unpublish",[UK],Object.getOwnPropertyDescriptor(qr.prototype,"unpublish"),qr.prototype),It(qr.prototype,"unpublishLowStream",[VK],Object.getOwnPropertyDescriptor(qr.prototype,"unpublishLowStream"),qr.prototype),It(qr.prototype,"subscribe",[FK],Object.getOwnPropertyDescriptor(qr.prototype,"subscribe"),qr.prototype),It(qr.prototype,"mockSubscribe",[jK],Object.getOwnPropertyDescriptor(qr.prototype,"mockSubscribe"),qr.prototype),It(qr.prototype,"unsubscribe",[BK],Object.getOwnPropertyDescriptor(qr.prototype,"unsubscribe"),qr.prototype),It(qr.prototype,"muteRemote",[zK],Object.getOwnPropertyDescriptor(qr.prototype,"muteRemote"),qr.prototype),It(qr.prototype,"unmuteRemote",[WK],Object.getOwnPropertyDescriptor(qr.prototype,"unmuteRemote"),qr.prototype),It(qr.prototype,"hasRemoteMediaWithLock",[GK],Object.getOwnPropertyDescriptor(qr.prototype,"hasRemoteMediaWithLock"),qr.prototype),It(qr.prototype,"disconnectForReconnect",[HK],Object.getOwnPropertyDescriptor(qr.prototype,"disconnectForReconnect"),qr.prototype),It(qr.prototype,"remoteMediaSsrcChanged",[$K],Object.getOwnPropertyDescriptor(qr.prototype,"remoteMediaSsrcChanged"),qr.prototype),qr);function Xd(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Yd.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}case Yd.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g(),E()}}}},a}}class Sy extends Jr{constructor(r,s){super(),Y(this,"signal",void 0),Y(this,"token",void 0),Y(this,"tokenTimeout",void 0),Y(this,"tokenInterval",void 0),Y(this,"_sequence",0),Y(this,"userMap",new Map),Y(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===Ar.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h;if(this.userMap.size===0)return;const m=Array.from(Cc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??Er(6,""),d=d??this._sequence++;const g={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(m)};oe("SHOW_P2P_LOG")&&L.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach(b=>{this.signal.request(Yt.DATA_STREAM,{payload:Gm(this.encoder.encode(b))})});const E=new gt((b,I)=>{const A=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),k),this.off("res-@".concat(c),j),this.off(oS.ABORT,G),L.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?I(new Le(ee.INVALID_REMOTE_USER)):I(new Le(ee.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),k=()=>{A&&window.clearTimeout(A),this.off(oS.ABORT,G),a&&b()},G=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),k),this.off("res-@".concat(c),j),I(new Le(ee.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(oS.ABORT,G),this.once("res-@".concat(c,"_ack"),k);const j=(Z,Q)=>{B=!0,A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),k),this.off(oS.ABORT,G),Z==="success"?b(Q):I(new Le(ee.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let B=!1;a||(this.once("res-@".concat(c),j),Rs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{B||L.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))}))});try{return await E}catch(b){if(b.code===ee.TIMEOUT)return await this.send(r,s,a,c,d);throw b}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Ei.CHECK)return;const{token:E}=r;c=new Map,d={uid:a,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Rn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:b}=r,I=(h=c.get(E))!==null&&h!==void 0?h:[];if(I.push(r),c.has(E)||c.set(E,I),I.length!==b)return;{const A=G_(I).call(I,(k,G)=>k.index-G.index).map(k=>k.payload).join("");c.delete(E),(r=JSON.parse(A))._uid=a}}const{_type:m,token:g}=r;if(tt(s=[Ei.ACK,Ei.CHECK]).call(s,m))return m===Ei.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(r);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):L.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:Er(6,""),token:this.token,_type:Ei.CHECK};oe("SHOW_P2P_LOG")&&L.debug("send message",r),this.signal.request(Yt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:Ei.ACK,token:this.token};oe("SHOW_P2P_LOG")&&L.debug("send message",s),this.signal.request(Yt.DATA_STREAM,{payload:Gm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(Ei.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:b,nextExpectedSequenceNumber:I}=E;for(;b.has(I);){const A=b.get(I);b.delete(I),this.receiveMessage(A),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(r._id),void L.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(oe("SHOW_P2P_LOG")&&L.debug("receive message",r),s){let h;switch(r._type!==Ei.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Ei.CANDIDATE:case Ei.CONTROL:this.signal.emit(a,h,d);break;case Ei.PUBLISH:case Ei.UNPUBLISH:case Ei.RESTART_ICE:case Ei.CALL:h.uid=d,js(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case Ei.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ei.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(s),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<Sy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=Er(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const g={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>Sy.MAX_MESSAGE_SIZE?h-=50:(s.push(g),r=r.slice(h))}return s.map(g=>JSON.stringify(g))}handleCheckToken(r,s){return r.token!==s?(L.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{L.debug("token timeout, ".concat(s)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await js(this.signal,Ei.CALL,void 0),s=await this.send(Ei.CALL,r);this.signal.emit(Qt.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(oS.ABORT),this.signal.emit(Rn.ON_USER_OFFLINE,{uid:a.uid,reason:Qge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(L.debug("change local token from ".concat(s," to ").concat(s)),this.token=Er(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(oS.ABORT)}}Y(Sy,"MAX_SIZE",1),Y(Sy,"MAX_MESSAGE_SIZE",1024);class DEe extends Jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Ar.CONNECTED?this.emit(Qt.WS_CONNECTED):r===Ar.RECONNECTING?this.emit(Qt.WS_RECONNECTING,this._websocketReconnectReason):r===Ar.CLOSED&&this.emit(Qt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),Y(this,"_disconnectedReason",void 0),Y(this,"_websocketReconnectReason",void 0),Y(this,"_connectionState",Ar.CLOSED),Y(this,"reconnectToken",void 0),Y(this,"p2pToken",void 0),Y(this,"websocket",void 0),Y(this,"openConnectionTime",void 0),Y(this,"clientId",void 0),Y(this,"lastMsgTime",Date.now()),Y(this,"uploadCache",[]),Y(this,"uploadCacheInterval",void 0),Y(this,"rttRolling",new wW(5)),Y(this,"pingpongTimer",void 0),Y(this,"pingpongTimeoutCount",0),Y(this,"joinResponse",void 0),Y(this,"multiIpOption",void 0),Y(this,"initError",void 0),Y(this,"spec",void 0),Y(this,"store",void 0),Y(this,"_external_signal",void 0),Y(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Qt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Rn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Rn.MUTE_AUDIO:case Rn.MUTE_VIDEO:case Rn.ON_P2P_LOST:case Rn.ON_USER_ONLINE:return;case Rn.ON_USER_OFFLINE:const{uid:d}=c._message;return L.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Rn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Rn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(rr.UID_BANNED);break;case 15:this.close(rr.IP_BANNED);break;case 16:this.close(rr.CHANNEL_BANNED)}if(c._type===Rn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case zt.ERR_LICENSE_MISSING:this.close(rr.LICENSE_MISSING);break;case zt.ERR_LICENSE_EXPIRED:this.close(rr.LICENSE_EXPIRED);break;case zt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(rr.LICENSE_MINUTES_EXCEEDED);break;case zt.ERR_LICENSE_PERIOD_INVALID:this.close(rr.LICENSE_PERIOD_INVALID);break;case zt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(rr.LICENSE_MULTIPLE_SDK_SERVICE);break;case zt.ERR_LICENSE_ILLEGAL:this.close(rr.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new U2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Ar.CONNECTED&&this.reconnect("retry",Fs.OFFLINE)}),this.p2pToken=Er(6,""),this._external_signal=new Sy(this,this.p2pToken)}async request(r,s,a,c){const d=Er(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new gt((G,j)=>{if(this.connectionState===Ar.CONNECTED)return G();const B=()=>{this.off(Qt.WS_CLOSED,Z),G()},Z=()=>{this.off(Qt.WS_CONNECTED,B),j(new Le(ee.WS_ABORT))};this.once(Qt.WS_CONNECTED,B),this.once(Qt.WS_CLOSED,Z)});if(this.connectionState!==Ar.CONNECTING&&this.connectionState!==Ar.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new gt((G,j)=>{let B=!1;const Z=(ae,ye)=>{B=!0,G({isSuccess:ae==="success",message:ye||{}}),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.emit(Qt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Z);const Q=()=>{j(new Le(ee.WS_ABORT,"type: ".concat(r))),this.off(Qt.WS_CLOSED,Q),this.off(Qt.WS_RECONNECTING,Q),this.off("res-@".concat(d),Z)};this.once(Qt.WS_CLOSED,Q),this.once(Qt.WS_RECONNECTING,Q),Rs(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Qt.REQUEST_TIMEOUT,r,s))})});let b=null;try{b=await E}catch(G){if(this.connectionState===Ar.CLOSED||r===Yt.LEAVE)throw new Le(ee.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await g(),await this.request(r,s))}if(b.isSuccess)return b.message;const I=Number(b.message.error_code||b.message.code),A=cT(I),k=new Le(ee.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(b.message.error_str),{code:I,data:b.message,desc:A.desc});return A.action==="success"?b.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===zt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(I===zt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=b.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Fs.MULTI_IP)):this.reconnect(A.action,Fs.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new gt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(oT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Ar.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new gt((s,a)=>{this.once(Qt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Qt.WS_CLOSED,()=>a(this.initError||new Le(ee.WS_ABORT))),this.connectionState=Ar.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||rr.LEAVE,this.connectionState=Ar.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Er(6,""),this._external_signal.clear(),this._external_signal=new Sy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Qt.ABORT_P2P_EXECUTION);const r=await js(this,Qt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Qt.REPORT_JOIN_GATEWAY,ee.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Qt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Ar.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){return!1}handleDataStream(r){try{var s;const a=ey(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||tt(s=Object.values(Ei)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(Rn.ON_DATA_STREAM,r)}catch{this.emit(Rn.ON_DATA_STREAM,r)}}handleNotification(r){L.debug("[".concat(this.clientId,"] receive notification: "),r);const s=cT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(rr.UID_BANNED),void this.close()):void this.reconnect(s.action,Fs.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(L.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Fs.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(ln.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Qt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(ln.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ln.CLOSED,()=>{this.connectionState=Ar.CLOSED}),this.websocket.on(ln.FAILED,()=>{this._disconnectedReason=rr.NETWORK_ERROR,this.connectionState=Ar.CLOSED}),this.websocket.on(ln.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Ar.CONNECTED?this.connectionState=Ar.RECONNECTING:this.connectionState=Ar.CONNECTING}),this.websocket.on(ln.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(L.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):L.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(ln.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Qt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===ee.UNEXPECTED_RESPONSE&&r.data.code===zt.ERR_NO_AUTHORIZED)return L.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Fs.SERVER_ERROR);L.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Fs.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(ln.REQUEST_NEW_URLS,(r,s)=>{js(this,Qt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const LEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new xEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new DEe(s,r)}};function qK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function YK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?qK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):qK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class MEe{constructor(r){Y(this,"sessionDesc",void 0),Y(this,"localCapabilities",void 0),Y(this,"rtpCapabilities",void 0),Y(this,"candidates",void 0),Y(this,"_originCandidates",void 0),Y(this,"iceParameters",void 0),Y(this,"dtlsParameters",void 0),Y(this,"setup",void 0),Y(this,"currentMidIndex",void 0),Y(this,"cname",void 0),r=Kr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:g,cname:E}=r,b=Za(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Kr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=E;for(let I=0;I<b.mediaDescriptions.length;I++){const A=b.mediaDescriptions[I];if(A.attributes.iceUfrag=s.iceUfrag,A.attributes.icePwd=s.icePwd,A.attributes.fingerprints=a.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=d.videoCodecs.map(j=>j.payloadType.toString(10));const k=d.videoCodecs.filter(j=>{var B,Z;return(B=j.rtpMap)===null||B===void 0?void 0:tt(Z=B.encodingName.toLowerCase()).call(Z,g)}),G=d.videoCodecs.filter(j=>!tt(k).call(k,j));A.attributes.payloads=[...k,...G],A.attributes.extmaps=d.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=d.audioCodecs.map(k=>k.payloadType.toString(10)),A.attributes.payloads=d.audioCodecs,A.attributes.extmaps=d.audioExtensions),b.mediaDescriptions[I]=this.mungMediaDesc(A)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return Hm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=hT(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===Et.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:g}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{tt(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;tt(m=d.map(g=>g.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(YK(YK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case ro.TCP_RELAY:this.candidates=a;break;case ro.UDP_TCP_RELAY:case ro.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Kr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=Kr(r);return lS(a,s),B2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Et.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=Kr(r);return j2(s),function(a){const c=a.attributes.extmaps.find(d=>qP(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var vr;function XK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function D1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XK(Object(s),!0).forEach(function(a){Y(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let UEe=(vr=class wC extends uH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return tt(s=Object.keys(tT)).call(s,r)}))]}constructor(r,s){super(r,s),Y(this,"store",void 0),Y(this,"peerConnection",void 0),Y(this,"remoteSDP",void 0),Y(this,"initialOffer",void 0),Y(this,"statsFilter",void 0),Y(this,"useRTX",!1),Y(this,"localCapabilities",void 0),Y(this,"localCandidateCount",0),Y(this,"allCandidatesReceived",!1),Y(this,"establishPromise",void 0),Y(this,"mutex",void 0),this.store=s,this.mutex=new eo("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(wC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=YL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ei()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Jm(r.sdp),a=dT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,D1(D1({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(ee.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new MEe(D1(D1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Bl(function*(){const c=yield Vn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(A=>a.peerConnection.addTrack(A._mediaStreamTrack)),h=yield Vn(a.peerConnection.createOffer()),m=Za(h.sdp),g=r.map(A=>{const k=A._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===k.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,B,Z){const Q=j.attributes.ssrcs.filter(ye=>ye.attributes.label===B),ae=j.attributes.ssrcGroups;if(Q.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&Q.length>1){const ye=ae.find(_e=>_e.ssrcIds.indexOf(Q[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Z?ye.ssrcIds[1]:void 0}]:[{ssrcId:Q[0].ssrcId}]}return[{ssrcId:Q[0].ssrcId}]}(G,k.id,a.useRTX)});let E;try{E=yield g}catch(A){throw d.forEach(k=>{Vs()&&k.replaceTrack(null),a.peerConnection.removeTrack(k)}),A}const b=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,E);const I=a.remoteSDP.toString();return yield Vn(a.peerConnection.setLocalDescription({type:"offer",sdp:b})),yield Vn(a.applySendEncodings(d,r)),yield Vn(a.peerConnection.setRemoteDescription({type:"answer",sdp:I})),r.map((A,k)=>{const G=A._mediaStreamTrack.id;return{localSSRC:g[k],id:G}})}catch(d){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{Vs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new gt((b,I)=>{const A=setTimeout(()=>{I(new Error("Cannot receive track, id: ".concat(d)))},1e4),k=G=>{const j=xn();if((j.name==="Safari"&&Number(j.version)===11||vo())&&G.track.id!==d&&G.streams[0].id===h){var B;const Z=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b(Z)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b(G.track)};this.peerConnection.addEventListener("track",k)}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:d}}catch(d){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Vs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(Vs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Bl(function*(){const a=yield Vn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Fn().supportPCSetConfiguration;if(r===ro.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),b=r===ro.RELAY?"relay":"all";E.iceTransportPolicy!==b&&(L.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(b,"]")),E.iceTransportPolicy=b,s.peerConnection.setConfiguration(E))}r!==ro.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield Vn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Jm(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const g=s.remoteSDP.toString();yield Vn(s.peerConnection.setLocalDescription(d)),yield Vn(s.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){L.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(ee.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(ee.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Xw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...wC.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...wC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(E=>{var b;return((b=E.track)===null||b===void 0?void 0:b.id)===r._mediaStreamTrack.id})),!s)return L.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Fn().supportSetRtpSenderParameters)return L.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Nr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&hf()){var h;const E=oe("DSCP_TYPE");tt(h=["very-low","low","medium","high"]).call(h,E)&&(d.networkPriority=E)}const m=s.getParameters(),g=(a=m.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,d),Object.assign(m,c),L.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=Za(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(g=>g.attributes.mid===h.kind);m&&lS(m,c)}),Hm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:g}=d;const{kind:E}=r[h];return new gt((b,I)=>{const A=setTimeout(()=>{I(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=G=>{const j=xn();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===g){var B;const Z=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b({track:Z,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void b({track:G.track,id:m})};this.peerConnection.addEventListener("track",k)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await gt.all(s)}catch(s){throw new Le(ee.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Fn().supportPCSetConfiguration){const s=wC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},It(vr.prototype,"connect",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"connect"),vr.prototype),It(vr.prototype,"stopSending",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"stopSending"),vr.prototype),It(vr.prototype,"receive",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"receive"),vr.prototype),It(vr.prototype,"stopReceiving",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"stopReceiving"),vr.prototype),It(vr.prototype,"muteRemote",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"muteRemote"),vr.prototype),It(vr.prototype,"unmuteRemote",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"unmuteRemote"),vr.prototype),It(vr.prototype,"muteLocal",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"muteLocal"),vr.prototype),It(vr.prototype,"unmuteLocal",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"unmuteLocal"),vr.prototype),It(vr.prototype,"close",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"close"),vr.prototype),It(vr.prototype,"updateEncoderConfig",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"updateEncoderConfig"),vr.prototype),It(vr.prototype,"updateSendParameters",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"updateSendParameters"),vr.prototype),It(vr.prototype,"replaceTrack",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"replaceTrack"),vr.prototype),It(vr.prototype,"getRemoteSSRC",[Xl],Object.getOwnPropertyDescriptor(vr.prototype,"getRemoteSSRC"),vr.prototype),vr);function Xl(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}const VEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new UEe(s,r)}},FEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(OP.has(t)||!t.track)return;const s={track:t.track};if(df()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=r.metadata&&r.metadata();g?function(E,b){const{chunk:I,controller:A}=b,k=$m.METADATA;I.data=function(G,j,B){const Z=B.byteLength,Q=Z+v2+K9,ae=y2+E2+Q,ye=new ArrayBuffer(G.byteLength+ae),_e=new DataView(ye);_e.setUint8(0,$9),_e.setUint16(1,Q),_e.setUint8(3,j),_e.setUint16(4,Z);for(let Ie=0;Ie<Z;Ie++)_e.setUint8(6+Ie,B[Ie]);const ue=new Uint8Array(_e.buffer);return ue.set(new Uint8Array(G),ae),ue.buffer}(I.data,k,E),A.enqueue(I)}(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=kP(),d=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id)L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&d.port1.postMessage({metadata:E})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=OP.get(t);if(c){OP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}OP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(UP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(df()&&!vo()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");PL(Hn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(g,E,b){var I;const A=S2(new DataView(E.data));if(!A)return b.enqueue(E);const k=g.track.id;Ege.set(k,g.track);const G=(I=A.tlv.find(ye=>ye.tag===$m.AUDIO_LEVEL))===null||I===void 0?void 0:I.value;let j=0;typeof G=="number"&&(j=127-G);const B=Math.round(Math.pow(10,j/60)-1),{selected:Z,speaker:Q}=function(ye,_e){let ue=nS.get(ye);if(ue||(ue=function(Ie){const Ue=new Y9;return nS.set(Ie,Ue),Wd||(Wd=new _ge(oe("TOPN_SILENCE_THRESHOLD")||500),Wd.on("ActiveSpeakerChanged",We=>{We!=null&&(DP=We)})),Wd.addSpeakers([Ue]),Ue}(ye)),nS.size<=X9)return{selected:!0,speaker:ue};if(!Wd)throw new Error("no active speaker detector");return Wd.levelChanged(ue.id,_e),ay=Wd.loudest.map(Ie=>Ie.id),DP&&!tt(ay).call(ay,DP)&&ay.length>=X9&&ay.pop(),{selected:tt(ay).call(ay,ue.id)||ue.id===DP,speaker:ue}}(g,B),ae=function(ye,_e,ue){const Ie=Gd.get(ye)||new yge(ye,_e);return Ie.score=ue,Gd.set(ye,Ie),function(Ue){if(LP.set(Ue,!0),!MP)return void(MP=Date.now());const We=Date.now();We-MP>1e3&&(LP.get(Ue)?LP.set(Ue,!1):(J9(Ue),LP.delete(Ue)),MP=We)}(ye),Ie}(k,g.track,Q.energyScore);ae.addSample(Z),ae.active&&(E.data=A.frame.buffer,b.enqueue(E))}(t,h,m):r.enableMetadata||r.enablePts?function(g,E,b,I){const A=new DataView(g.data),k=A.getUint8(0);let G;if((128&k)!=0&&k!==71){const Z=function(Q){if(Q.byteLength<=0)return[];const ae=[];let ye=0;for(;ye<Q.byteLength;){const ue=(128&Q.getUint8(ye))>>7,Ie=127&Q.getUint8(ye);if(!(ue&&ye+4<=Q.byteLength)){ye++;break}{const Ue=Q.getUint32(ye,!1),We=(16776192&Ue)>>10,Qe=1023&Ue;ae.push({pt:Ie,ts_offset:We,length:Qe,data:new Uint8Array}),ye+=4}}let _e=Q.byteLength-ye;for(const ue of ae){if(ue.length>_e)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(Q.buffer,Q.byteOffset+ye,ue.length),ye+=ue.length,_e-=ue.length)}if(_e>0){const ue={pt:ae.length>0?ae[ae.length-1].pt:0,ts_offset:0,length:_e,data:new Uint8Array(Q.buffer,Q.byteOffset+ye,_e)};ae.push(ue)}return ae}(A);if(Z.length>0){const Q=function(ae){let ye=0;for(let Ie=0;Ie<ae.length;Ie++)ye+=Ie<ae.length-1?4:1,ye+=ae[Ie].length;const _e=new Uint8Array(ye);let ue=0;for(let Ie=0;Ie<ae.length;Ie++)if(Ie<ae.length-1){const Ue=(2147483648|(127&ae[Ie].pt)<<24|(262143&ae[Ie].ts_offset)<<10|1023&ae[Ie].length)>>>0;_e[ue++]=Ue>>24&255,_e[ue++]=Ue>>16&255,_e[ue++]=Ue>>8&255,_e[ue++]=255&Ue}else _e[ue++]=127&ae[Ie].pt;for(const Ie of ae)_e.set(Ie.data,ue),ue+=Ie.length;return _e}(Z.map(ae=>{const ye=new Uint8Array(ae.length);ye.set(ae.data);const _e=S2(new DataView(ye.buffer));return _e!=null&&_e.frame&&(ae.data=_e==null?void 0:_e.frame),G=_e,ae}));g.data=Q.buffer}}else G=S2(A),G&&(g.data=G.frame.buffer);if(E.enqueue(g),!G)return;const j=G.tlv.find(Z=>Z.tag===$m.METADATA);j&&b&&j.value instanceof Uint8Array&&b(j.value);const B=G.tlv.find(Z=>Z.tag===$m.AUDIO_64_BIT_PTS);B&&I&&B.value instanceof Uint8Array&&B.value.length==8&&I(new DataView(B.value.buffer).getBigUint64(0,!0))}(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=kP(),d=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(L.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata?s.onMetadata(m.data.metadata):m.data.pts&&s.onPts&&s.onPts(m.data.pts)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const d=UP.get(c);if(d){(function(g){const E=nS.get(g);E&&(nS.delete(g),Wd&&(Wd.removeSpeakers([E]),nS.size===0&&(Wd.destroy(),Wd=null)))})(c),J9(c.track.id),UP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){L.warning(g&&g.message)}}}(t)}UP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Fn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(VP.has(t)||!t.track)return;const s={track:t.track};if(df()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void L.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,g){s.controller||(s.controller=g),t.track&&t.track.id!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const E=eH(new Uint8Array(m.data)),b=d.shift();if(b){const I=function(A,k,G){switch(G){case C2:return function(j,B){const Z=Z9(B),Q=Z.length,ae=Math.floor(Q/255),ye=Q%255,_e=new Uint8Array(6+ae+1+Q+j.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=6,_e[5]=101;let ue=0;for(;ue<ae;)_e[6+ue]=255,ue++;return _e[6+ue]=ye,ue++,_e.set(Z,6+ue),_e.set(new Uint8Array(j),6+ue+Q),_e.buffer}(A,k);case R2:return function(j,B){const Z=Z9(B),Q=Z.length,ae=Math.floor(Q/255),ye=Q%255,_e=new Uint8Array(7+ae+1+Q+1+j.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=78,_e[5]=1,_e[6]=101;let ue=0;for(;ue<ae;)_e[7+ue]=255,ue++;return _e[7+ue]=ye,ue++,_e.set(Z,7+ue),ue+=Q,_e[7+ue]=128,ue++,_e.set(new Uint8Array(j),7+ue),_e.buffer}(A,k);default:return null}}(m.data,b,E);I&&(m.data=I)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Vs())return;{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=kP(),d=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=VP.get(t);if(c){VP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){L.warning(m&&m.message)}}}VP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(!t.track)return;if(sT.has(t)){const c=sT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(df()){if(!t.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void L.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=function(E,b){switch(b){case C2:return function(I){const A=new DataView(I.data);let k=0;for(;k+4<I.data.byteLength;){if(A.getUint8(k+0)===0&&A.getUint8(k+1)===0&&A.getUint8(k+2)===0&&A.getUint8(k+3)===1&&A.getUint8(k+4)===6){let G=k+6,j=0,B=0;for(;(B=A.getUint8(G++))===255;)j+=255;j+=B;const Z=Q9(I.data,G,j);return new Uint8Array(Z)}k++}return null}(E);case R2:return function(I){const A=new DataView(I.data);let k=0;for(;k+5<I.data.byteLength;){if(A.getUint8(k+0)===0&&A.getUint8(k+1)===0&&A.getUint8(k+2)===0&&A.getUint8(k+3)===1&&A.getUint8(k+4)===78&&A.getUint8(k+5)===1&&A.getUint8(k+6)===101){let G=k+7,j=0,B=0;for(;(B=A.getUint8(G++))===255;)j+=255;j+=B;const Z=Q9(I.data,G,j);return new Uint8Array(Z)}k++}return null}(E);default:return null}}(h,eH(new Uint8Array(h.data)));g&&s.onSei&&s.onSei(g),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");const c=kP(),d=new MessageChannel;await new gt(m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new gt(m=>c.onmessage=g=>{g.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(L.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=sT.get(c);if(d){sT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){L.warning(g&&g.message)}}})(t)}sT.set(t,s),t.track.addEventListener("ended",a)}},jEe={name:"InterceptFrame",create:()=>FEe};XL(),hr("PROCESS_ID","process-".concat(Er(8,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(4,""),"-").concat(Er(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void L.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();L.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(jr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;zd[a]=c,jr[a]=c}})}catch(r){L.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(zd.AREAS)&&zd.AREAS.length>0&&H2(zd.AREAS,!0);const JK=(t,r,s)=>{L.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),hr(t,r,s)};eg(lEe,!1),eg(hEe,!1),eg(H_e,!1),eg(wEe,!1),eg(oEe,!1),eg(LEe,!1),eg(VEe,!1),eg(jEe,!1);const Fi=function(t){const r=new Jr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===Zh.SECURITY_POLICY_VIOLATION&&O$(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return k$(k$({},s),a)}({__TRACK_LIST__:Kv,VERSION:zl,BUILD:ZL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:JK,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return Fn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(ee.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Pt.reportApiInvoke(null,{name:di.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:$r.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&LL()&&Q8(75)&&new d().close()}catch(d){return L.error("check system requirement failed: ",d),!1}let s=!1;const a=xn();a.name===Hn.CHROME&&Number(a.version)>=58&&(Fd.engine.name!=="WebKit"||function(){const d=xn();if(pP()){if(d.os===ss.MAC_OS)return!0;if(d.os===ss.IOS){const h=Fd.os.version&&Fd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Hn.FIREFOX&&Number(a.version)>=56||a.name===Hn.OPERA&&Number(a.version)>=45||a.name===Hn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(vo()||Du())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||iW()||xn().name===Hn.QQ)&&(s=!0),L.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return il.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return il.getRecordingDevices(t)},getCameras:function(t){return il.getCamerasDevices(t)},getElectronScreenSources:QW,getPlaybackDevices:function(t){return il.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=Er(5,"client-"),a=Pt.reportApiInvoke(null,{id:s,name:di.CREATE_CLIENT,options:[r],tag:$r.TRACER});try{(function(c){Ji(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ji(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ji(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Cs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&hW(c.turnServer),c.httpRetryConfig!==void 0&&dW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&dW(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(tW(16,0)||NL(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",L.debug("browser not support vp9, force use vp8")),hr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new $_e(Wu(Wu({forceWaitGatewayResponse:!0},r),{},{role:tt(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=Er(8,"track-cam-"),a=Pt.reportApiInvoke(null,{id:s,tag:$r.TRACER,name:di.CREATE_CAM_VIDEO_TRACK,options:[Ir({},t),r]});r&&(t.encoderConfig=r);const c=AP(t);let d=null;L.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await rl({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(L)}if(t.optimizationMode&&_2(s,d,t,Uu(t.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const m=Uu(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new PP(d,t,c,t.scalabiltyMode?TP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),L.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=Er(8,"track-cus-"),s=Pt.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const a=new Nr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?TP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[_r.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),L.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(A){return cG(A)}(r):void 0;s&&(r="auto");const a=Er(8,"track-scr-v-"),c=Pt.reportApiInvoke(null,{id:a,tag:$r.TRACER,name:di.CREATE_SCREEN_VIDEO_TRACK,options:[Ir({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(A){const k={};A.screenSourceType&&(k.mediaSource=A.screenSourceType),A.extensionId&&df()&&(k.extensionId=A.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:B,systemAudio:Z,preferCurrentTab:Q}=A;(Vv(107)||kL(107)||xL(93))&&(G&&(Ji(G,"displaySurface",["browser","window","monitor"]),k.displaySurface=G),j?(Ji(j,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=j):k.selfBrowserSurface="include",B&&(Ji(B,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=B)),(Vv(105)||kL(105)||xL(91))&&Z&&(Ji(Z,"systemAudio",["exclude","include"]),k.systemAudio=Z),(Vv(94)||kL(94)||xL(80))&&Q&&(k.preferCurrentTab=!0),A.electronScreenSourceId&&(k.sourceId=A.electronScreenSourceId);const ae=A.encoderConfig?s2(A.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(k.mandatory.maxFrameRate=ae.frameRate,k.mandatory.minFrameRate=ae.frameRate):(k.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,k.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),k.frameRate=ae.frameRate),ae.width&&(k.width=ae.width),ae.height&&(k.height=ae.height)),k}(t);let h=null,m=null;const g=Fn();if(!g.supportShareAudio&&r==="enable"){const A=new Le(ee.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(L)}L.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const E=g.supportShareAudio&&r!=="disable";try{const A=await rl({screen:d,screenAudio:E?s||!0:void 0},a);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(L)}if(!m&&r==="enable"){h&&h.stop();const A=new Le(ee.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(L)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(_2(a,h,t,t.encoderConfig&&s2(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const b=new Nr(h,t.encoderConfig?s2(t.encoderConfig):{},t.scalabiltyMode?TP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[_r.SCREEN_TRACK]);if(!m)return c.onSuccess(b.getTrackId()),L.info("create screen video track success","video:",b.getTrackId()),b;const I=new ai(m,void 0,Er(8,"track-scr-a-"),!1);return c.onSuccess([b.getTrackId(),I.getTrackId()]),L.info("create screen video track success","video:",b.getTrackId(),"audio:",I.getTrackId()),[b,I]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=Er(8,"track-mic-"),c=Er(8,"track-cam-"),d=Pt.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:$r.TRACER,name:di.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=AP(r),m=lG(t);let g=null,E=null;L.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const A=await rl({audio:m,video:h},"".concat(a,"-").concat(c));g=A.getAudioTracks()[0],E=A.getVideoTracks()[0]}catch(A){throw d.onError(A),A}if(!g||!E){const A=new Le(ee.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(A),A.throw(L)}if(r.optimizationMode&&_2(c,E,r,Uu(r.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const A=Uu(r.encoderConfig);r.encoderConfig=A,delete A.bitrateMax,delete A.bitrateMin}const b=new iT(g,t,m,a),I=new PP(E,r,h,r.scalabiltyMode?TP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([b.getTrackId(),I.getTrackId()]),L.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[b,I]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=Er(8,"track-mic-"),s=Pt.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=lG(t);let c=null;L.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await rl({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(ee.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(L)}const d=new iT(c,t,a,r);return s.onSuccess(d.getTrackId()),L.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=Er(8,"track-cus-"),s=Pt.reportApiInvoke(null,{id:r,tag:$r.TRACER,name:di.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new ai(t.mediaStreamTrack,t.encoderConfig?CP(t.encoderConfig):{},r,!1);return L.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=Er(8,"track-buf-"),m=Pt.reportApiInvoke(null,{id:h,tag:$r.TRACER,name:di.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(oe("DISABLE_WEBAUDIO"))throw new Le(ee.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");L.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await async function(I,A){let k=null;if(typeof I=="string"){const j=YG.get(I);if(j)return L.debug("use cached audio resource: ",I),j;try{k=(await Bd(()=>Ia.get(I,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(B){throw new Le(ee.FETCH_AUDIO_FILE_FAILED,B.toString())}}else k=await new gt((B,Z)=>{const Q=new FileReader;Q.onload=ae=>{ae.target?B(ae.target.result):Z(new Le(ee.READ_LOCAL_AUDIO_FILE_ERROR))},Q.onerror=()=>{Z(new Le(ee.READ_LOCAL_AUDIO_FILE_ERROR))},Q.readAsArrayBuffer(I)});const G=await function(j){const B=Qv();return new gt((Z,Q)=>{B.decodeAudioData(j,ae=>{Z(ae)},ae=>{Q(new Le(ee.DECODE_AUDIO_FILE_FAILED,ae.toString()))})})}(k);return typeof I=="string"&&A&&YG.set(I,G),G}(c,s)}catch(I){return m.onError(I),I.throw(L)}const E=new hge(c),b=new dge(g,E,a?CP(a):{},h);return L.info("create buffer source audio track success, trackId:",h),m.onSuccess(b.getTrackId()),b},setAppType:function(t){if(L.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw L.debug("Invalid appType"),new Oe(ee.INVALID_PARAMS,"invalid app type",t);hr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){L.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?hr("UPLOAD_LOG",!0):L.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?hr("UPLOAD_LOG",!1):L.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new QH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Pt.reportApiInvoke(null,{tag:$r.TRACER,name:di.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof ai||t instanceof tS)){const g=new Oe(ee.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof ai?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new gt(g=>{const E=setInterval(()=>{const b=t.getVolumeLevel();d=b>d?b:d,h=b<h?b:h;const I=d-h>1e-4,A=Date.now()-m;if(I||A>r){clearInterval(E);const k=I,G={duration:A,deviceLabel:a,maxVolumeLevel:d,result:k};L.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),g(k)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Pt.reportApiInvoke(null,{tag:$r.TRACER,name:di.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Nr||t instanceof eS)){const I=new Oe(ee.INVALID_TRACK,"the parameter is not a video track");return s.onError(I),I.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Nr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Vs()||pP())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const I=Date.now();m=await function(A,k,G,j){let B,Z=0,Q=null;return new gt((ae,ye)=>{function _e(){Z>j&&B&&(B(),ae(Z));const ue=G.getContext("2d");if(!ue){const We=new Oe(ee.UNEXPECTED_ERROR,"can not get canvas 2d context.");return L.error(We.toString()),void ye(We)}ue.drawImage(A,0,0,160,120);const Ie=ue.getImageData(0,0,G.width,G.height),Ue=Math.floor(Ie.data.length/3);if(Q){for(let We=0;We<Ue;We+=3)if(Ie.data[We]!==Q[We])return Z+=1,void(Q=Ie.data);Q=Ie.data}else Q=Ie.data}setTimeout(()=>{B&&(B(),ae(Z))},k),B=u2(()=>{_e()},30)})}(d,r,h,4),g=Date.now()-I}catch(I){throw s.onError(I),I}O_e===Hn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const E=m>4,b={duration:g,changedPicNum:m,deviceLabel:a,result:E};return L.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(b))),s.onSuccess(b),E},setArea:H2,audioElementPlayCenter:Aa,resumeAudioContext:function(){Aa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){q_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!tt(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=L.extLog,a.reporter.hookApiInvoke=Pt.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=oe(c)})}),JK("PLUGIN_INFO",r)},ChannelMediaRelayError:iS,ChannelMediaRelayEvent:mf,ChannelMediaRelayState:tc,RemoteStreamFallbackType:ige,RemoteStreamType:rge,ConnectionDisconnectedReason:rr,AudienceLatencyLevelType:Dme,AREAS:Jn,preload:async function(t,r,s,a){return b7(t,r,s,a)}});return Object.defineProperties(Fi,{onAudioAutoplayFailed:{get:()=>sl.onAudioAutoplayFailed,set:t=>{sl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>sl.onAutoplayFailed,set:t=>{sl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Fi._onSecurityPolicyViolation,set(t){Fi._onSecurityPolicyViolation=t,O$(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?cy:[]}}),il.on(iy.CAMERA_DEVICE_CHANGED,t=>{L.info("camera device changed",JSON.stringify(t)),Fi.onCameraChanged&&Fi.onCameraChanged(t),Fi.safeEmit(Zh.CAMERA_CHANGED,t)}),il.on(iy.RECORDING_DEVICE_CHANGED,t=>{L.info("microphone device changed",JSON.stringify(t)),Fi.onMicrophoneChanged&&Fi.onMicrophoneChanged(t),Fi.safeEmit(Zh.MICROPHONE_CHANGED,t)}),il.on(iy.PLAYOUT_DEVICE_CHANGED,t=>{L.debug("playout device changed",JSON.stringify(t)),Fi.onPlaybackDeviceChanged&&Fi.onPlaybackDeviceChanged(t),Fi.safeEmit(Zh.PLAYBACK_DEVICE_CHANGED,t)}),Aa.onAutoplayFailed=()=>{L.info("detect audio element autoplay failed"),sl.onAudioAutoplayFailed&&sl.onAudioAutoplayFailed()},pr.on("autoplay-failed",()=>{L.info("detect webaudio autoplay failed"),sl.onAudioAutoplayFailed&&sl.onAudioAutoplayFailed(),Fi.safeEmit(Zh.AUTOPLAY_FAILED)}),pr.on(As.STATE_CHANGE,(t,r)=>{L.info("audio context state changed: ".concat(r," => ").concat(t)),Fi.onAudioContextStateChanged&&Fi.onAudioContextStateChanged(t,r),Fi.safeEmit(Zh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Ci.on(jv.NETWORK_STATE_CHANGE,(t,r)=>{L.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Fi),Fi})}(Zk)),Zk.exports}var yGe=_Ge();const wR=$g(yGe),EGe="a2a7f4eb05284449b1063eb71d8301dc",vGe=wR.createClient({mode:"rtc",codec:"vp8"});let nC=null;const Yae=O.createContext(null),Xae=({children:n,appId:e=EGe,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:p=!0,onClientReady:y=()=>{}})=>{const[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState([]),[D,F]=O.useState(null),[z,q]=O.useState(null),[K,re]=O.useState(null),[ce,se]=O.useState(!1),[ge,X]=O.useState(!1),[J,te]=O.useState(!1),[ne,de]=O.useState(null),[pe,he]=O.useState(!1),ve=ja(),Te=O.useRef(vGe),Fe=O.useRef({appId:e,channel:i,uid:l,enabled:u}),be=O.useRef(!1),Re=O.useRef(null);O.useRef(null),O.useEffect(()=>{Fe.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),O.useEffect(()=>{q(i)},[i]),O.useEffect(()=>{if(!Te.current)return;const ut=vt=>{W.log(`Connection state changed to: ${vt}`),vt==="DISCONNECTED"?(w(!1),W.log("Disconnected from Agora")):vt==="CONNECTED"&&(w(!0),F(null))};return Te.current.on("connection-state-change",ut),()=>{Te.current.off("connection-state-change",ut)}},[]),O.useEffect(()=>{if(!i||!u)return;const ut=async(dt,mt)=>{W.log(`User published: ${dt.uid}, mediaType: ${mt}`);try{await Te.current.subscribe(dt,mt),mt==="audio"&&dt.audioTrack.play(),M(ct=>ct.some(Ft=>Ft.uid===dt.uid)?ct:[...ct,dt])}catch(ct){W.error("Error subscribing to user:",ct)}},vt=(dt,mt)=>{W.log(`User unpublished: ${dt.uid}, mediaType: ${mt}`),mt==="audio"&&dt.audioTrack&&dt.audioTrack.stop()},it=dt=>{W.log(`User joined: ${dt.uid}`),M(mt=>mt.some(ct=>ct.uid===dt.uid)?mt:[...mt,dt])},wt=dt=>{W.log(`User left: ${dt.uid}`),M(mt=>mt.filter(ct=>ct.uid!==dt.uid))};return Te.current.on("user-published",ut),Te.current.on("user-unpublished",vt),Te.current.on("user-joined",it),Te.current.on("user-left",wt),(async()=>{if(be.current){W.log("Already initializing, skipping duplicate initialization");return}be.current=!0;try{if(v&&Re.current===i){W.log(`Already joined to channel ${i}`),se(!0),y(Te.current);return}if(Te.current.connectionState==="CONNECTING"||Te.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){W.log("Connected to different channel, leaving first");try{await Ee()}catch(dt){W.error("Error leaving channel:",dt)}}else{w(!0),se(!0),Re.current=i,nC=i,y(Te.current);return}W.log(`Joining channel ${i}`),await xe(),W.log("Join channel completed")}catch(dt){W.error("Error during initialization:",dt)}finally{be.current=!1}})(),()=>{W.log("Cleaning up event listeners"),Te.current.off("user-published",ut),Te.current.off("user-unpublished",vt),Te.current.off("user-joined",it),Te.current.off("user-left",wt)}},[i,u,l,y,v]);const Ae=async()=>{if(!u||K)return K;W.log("Initializing microphone");try{const ut=await wR.createMicrophoneAudioTrack();return await ut.setMuted(p),re(ut),W.log("Microphone initialized successfully"),ut}catch(ut){return W.error("Error initializing microphone:",ut),F("Failed to initialize microphone. Please check your permissions."),null}};O.useEffect(()=>{(async()=>{if(i)try{const wt=await Ua(i);wt&&wt.voiceDisabled?(W.log("Voice is disabled for this space"),he(!0),v&&await Ee()):he(!1)}catch(it){W.error("Error checking if voice is disabled:",it)}})();const vt=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(W.log("Voice setting changed:",it.detail.voiceDisabled),he(it.detail.voiceDisabled),it.detail.voiceDisabled&&v?Ee():!it.detail.voiceDisabled&&!v&&u&&i&&xe())};return window.addEventListener("SpaceVoiceSettingChanged",vt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",vt)}},[i,v,u]);const xe=async()=>{if(!u)return W.log("Agora is disabled, not joining channel"),!1;if(pe)return W.log("Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return W.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if(W.log(`joinChannel called for channel ${i} with UID ${l}`),W.log("Current state:",{isJoined:v,isJoining:ge,connectionState:Te.current.connectionState,joinedChannel:Re.current}),v&&Re.current===i)return W.log(`Already joined to channel: ${i}`),!0;if(ge)return W.log("AgoraProvider: Already in the process of joining"),!1;if(Te.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){W.log("Connected to different channel, leaving first");try{await Ee()}catch(ut){W.error("Error leaving channel:",ut)}}else return W.log("Client already connected, setting joined state to true"),w(!0),se(!0),Re.current=i,nC=i,y(Te.current),!0;if(Te.current.connectionState==="CONNECTING")return W.log("Client already connecting, waiting for connection"),X(!0),new Promise(ut=>{const vt=setInterval(()=>{Te.current.connectionState==="CONNECTED"&&(clearInterval(vt),w(!0),X(!1),se(!0),Re.current=i,nC=i,y(Te.current),ut(!0))},500);setTimeout(()=>{clearInterval(vt),W.log("AgoraProvider: Connection timeout, considering join failed"),X(!1),ut(!1)},1e4)});try{if(W.log(`Joining channel: ${i} with UID: ${l||"random"}`),W.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const vt="AgoraProvider: App ID is empty or invalid";return W.error(vt),F(vt),X(!1),!1}X(!0);const ut=l||Math.floor(Math.random()*1e6);return await Te.current.join(e,i,o,ut),W.log(`Joined channel successfully with UID: ${Te.current.uid}`),w(!0),X(!1),se(!0),Re.current=i,nC=i,y(Te.current),!0}catch(ut){return W.error("Error joining channel:",ut),F(`Error joining channel: ${ut.toString()}`),X(!1),!1}},Ee=async()=>{if(v)try{K&&await Te.current.unpublish(K),await Te.current.leave(),nC=null,Re.current=null,W.log("Left channel successfully"),w(!1),M([])}catch(ut){W.error("Error leaving channel:",ut),F(ut.message||"Failed to leave channel")}};O.useEffect(()=>()=>{K&&K.close()},[]),O.useEffect(()=>{u&&i&&(!v||Re.current!==i)&&xe()},[u,i,v]);const Ne=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(ut){return W.error("Error checking microphone status:",ut),!1}};O.useEffect(()=>{const ut=()=>{const it=Ne();it!==C&&(W.log("Syncing microphone state:",{actualStatus:it,currentState:C}),R(it),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:it}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=it,window.agoraClient.microphoneTrack=K))};K&&ut();const vt=setInterval(ut,1e3);return()=>{clearInterval(vt)}},[K,C]);const je=async()=>{var ut;if(pe)return W.log("Voice is disabled for this space, cannot toggle"),ve({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const vt=C!==void 0?C:K?!K.muted:!1;if(W.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:vt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(W.log("AgoraProvider: No microphone track, initializing..."),!await Ae()))return W.error("AgoraProvider: Failed to initialize microphone"),vt;const it=!vt;if(W.log("AgoraProvider: New voice state will be:",it),vt){if(K)try{W.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(W.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),W.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(wt){return W.error("Error muting track:",wt),vt}}else if(K)try{Te.current&&v&&!((ut=Te.current.localTracks)!=null&&ut.includes(K))&&(W.log("AgoraProvider: Publishing microphone track"),await Te.current.publish(K),W.log("AgoraProvider: Microphone track published successfully")),W.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(W.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),W.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(wt){return W.error("Error unmuting track:",wt),vt}return R(it),it}catch(vt){return W.error("Error toggling voice:",vt),C}},qe=async ut=>{try{re(ut),W.log("Microphone track updated successfully")}catch(vt){throw W.error("Error updating microphone track:",vt),vt}},at=async()=>{if(!Te.current||!i)return W.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return W.log("AgoraProvider: Stopping screen share"),ne&&(Array.isArray(ne)?(await Te.current.unpublish(ne),ne.forEach(ut=>ut.close())):(await Te.current.unpublish(ne),ne.close()),de(null)),te(!1),W.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;W.log("AgoraProvider: Starting screen share");try{const ut=await wR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return W.log("AgoraProvider: Screen track created:",ut),ut.on("track-ended",()=>{W.log("AgoraProvider: Screen sharing ended by browser UI"),Te.current.unpublish(ut),ut.close(),de(null),te(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Te.current.publish(ut),de(ut),te(!0),W.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=ut,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(ut){return W.error("AgoraProvider: Error creating screen track:",ut),te(!1),de(null),!1}}catch(ut){return W.error("AgoraProvider: Error toggling screen share:",ut),te(!1),de(null),!1}};O.useEffect(()=>{if(W.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Te.current,isScreenSharing:!1,screenTrack:null};const ut=it=>{W.log("AgoraProvider: Received ToggleScreenShare event"),at().then(wt=>{it.detail&&it.detail.callback&&it.detail.callback(!0,wt)}).catch(wt=>{W.error("AgoraProvider: Error handling ToggleScreenShare event:",wt),it.detail&&it.detail.callback&&it.detail.callback(!1,J)})},vt=it=>{W.log("AgoraProvider: Received JoinVoiceChat event"),xe().then(wt=>{it.detail&&it.detail.callback&&it.detail.callback(wt)}).catch(wt=>{W.error("AgoraProvider: Error handling JoinVoiceChat event:",wt),it.detail&&it.detail.callback&&it.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",ut),window.addEventListener("JoinVoiceChat",vt),()=>{window.removeEventListener("ToggleScreenShare",ut),window.removeEventListener("JoinVoiceChat",vt),typeof window<"u"&&window.agoraClient&&(W.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(W.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),O.useEffect(()=>{W.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Te.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),W.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,K]);const _t={client:Te.current,isJoined:v,isVoiceEnabled:C,users:N,error:D,channel:z,appId:e,toggleVoice:je,leaveChannel:Ee,joinChannel:xe,microphoneTrack:K,isReady:ce,createMicrophoneTrack:qe,isScreenSharing:J,screenTrack:ne,toggleScreenShare:at,voiceDisabled:pe};return S.jsx(Yae.Provider,{value:_t,children:n})},Jae=()=>{const n=O.useContext(Yae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Xae.propTypes={children:Tn.node.isRequired,appId:Tn.string.isRequired,channel:Tn.string.isRequired,token:Tn.string,uid:Tn.oneOfType([Tn.string,Tn.number])};const SGe=()=>{var be,Re;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:p,channel:y,appId:v,toggleVoice:w,joinChannel:C,leaveChannel:R,createMicrophoneTrack:N,isScreenSharing:M,screenTrack:D,toggleScreenShare:F,voiceDisabled:z}=Jae(),[q,K]=O.useState(e!==void 0?e:((be=window.agoraClient)==null?void 0:be.isVoiceEnabled)||!1),[re,ce]=O.useState(M!==void 0?M:((Re=window.agoraClient)==null?void 0:Re.isScreenSharing)||!1),[se,ge]=O.useState(z!==void 0?z:!1),[X,J]=O.useState(!0);O.useEffect(()=>{var Ae;e!==void 0?K(e):((Ae=window.agoraClient)==null?void 0:Ae.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):u&&K(!u.muted)},[e,u]),O.useEffect(()=>{var Ae;M!==void 0?ce(M):((Ae=window.agoraClient)==null?void 0:Ae.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[M]),O.useEffect(()=>{z!==void 0&&ge(z)},[z]);const te=O.useRef({isVoiceEnabled:q,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:v,voiceDisabled:se});O.useEffect(()=>{te.current={isVoiceEnabled:q,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:p,channel:y,appId:v,voiceDisabled:se}},[q,re,i,o,l,p,y,v,se]),O.useEffect(()=>{const Ae=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(Ae)},[]),O.useEffect(()=>{p&&J(!1)},[p]),O.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:q,contextIsScreenSharing:M,localScreenSharing:re,isJoined:i,users:o.length,error:l,isReady:p,channel:y,appId:v,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!D})},[e,q,M,re,i,o,l,p,y,v,u,D]);const ne=async()=>{try{console.log("useVoiceChat: Toggling voice from:",q);const Ae=await w();if(console.log("useVoiceChat: Toggle result:",Ae),Ae!==void 0)K(Ae);else{const xe=!q;K(xe),window.agoraClient&&(window.agoraClient.isVoiceEnabled=xe)}return Ae!==void 0?Ae:!q}catch(Ae){return console.error("useVoiceChat: Error toggling voice:",Ae),q}},de=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",re);const Ae=await F();if(console.log("useVoiceChat: Screen share toggle result:",Ae),Ae!==void 0)ce(Ae);else{const xe=!re;ce(xe),window.agoraClient&&(window.agoraClient.isScreenSharing=xe)}return Ae!==void 0?Ae:!re}catch(Ae){return console.error("useVoiceChat: Error toggling screen share:",Ae),re}},pe=async()=>{q&&u&&await ne()},he=async()=>{!q&&u&&await ne()},ve=Ae=>o.some(xe=>{var Ee;return xe.uid===Ae&&((Ee=xe.audioTrack)==null?void 0:Ee.isPlaying)}),Te=O.useCallback(()=>{if(!u||!q)return 0;try{return u.getVolumeLevel()}catch(Ae){return console.error("Error getting volume level:",Ae),0}},[u,q]);return{isVoiceEnabled:q,isScreenSharing:re,isJoined:i,users:o,error:l,toggleVoice:ne,toggleScreenShare:de,mute:pe,unmute:he,isUserSpeaking:ve,getVolumeLevel:Te,microphoneTrack:u,screenTrack:D,isLoading:X,channel:y,appId:v,joinChannel:C,leaveChannel:R,client:n,setMicrophoneDevice:async Ae=>{try{if(!Ae){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(q&&await n.unpublish(u),await u.close());const xe=await wR.createMicrophoneAudioTrack({microphoneId:Ae,encoderConfig:"music_standard"});N&&await N(xe),q&&await n.publish(xe),console.log("Microphone device changed successfully")}catch(xe){throw console.error("Error changing microphone device:",xe),xe}},voiceDisabled:se}},bGe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:p,isJoined:y,joinChannel:v,channel:w,client:C,voiceDisabled:R}=SGe(),[N,M]=O.useState(!1),[D,F]=O.useState(!1);O.useEffect(()=>{const K=()=>{W.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(W.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),O.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:y,channel:w,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:D,voiceDisabled:R})},[u,y,w,C,D,R]);const z=async()=>{if(!(N||R)){M(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:y});try{if(!y&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(re){re.message&&re.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",re)}console.log("VoiceButton: Toggling voice state from:",u);const K=await p();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{M(!1)}}},q=()=>R?"Voice chat is disabled for this space":D?N?"Processing...":y?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!D||R?null:S.jsx(Ff,{label:q(),placement:e,hasArrow:!0,children:S.jsxs(st,{position:"relative",cursor:"pointer",onClick:z,children:[S.jsx(yl,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?S.jsx(Hae,{color:"white"}):S.jsx(Gae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&S.jsx(st,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(cd,{size:"sm",color:"white"})})]})})},wGe=bi.createContext({user:null}),TGe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=Jae(),[p,y]=O.useState([]),[v,w]=O.useState(!1),[C,R]=O.useState(!0);O.useRef({});const N=O.useRef(null);O.useRef(null);const{user:M}=O.useContext(wGe)||{user:null},[D,F]=O.useState({}),z=O.useRef(o),[q,K]=O.useState(null),{isOpen:re,onOpen:ce,onClose:se}=sd(),[ge,X]=O.useState(!1),J=O.useRef(null),te=O.useRef(null);O.useEffect(()=>{z.current=o},[o]),O.useEffect(()=>{if(!e||!i){w(!1);return}const ve=setTimeout(()=>{R(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const Te=e.connectionState;if(console.log("Current connection state:",Te),Te==="CONNECTED")w(!0),R(!1);else{w(!1);const Fe=be=>{console.log("Connection state changed:",be),be==="CONNECTED"?(w(!0),R(!1)):w(!1)};return e.on("connection-state-change",Fe),()=>{e.off("connection-state-change",Fe),clearTimeout(ve)}}return()=>{clearTimeout(ve)}},[e,i]),O.useEffect(()=>{const ve=async()=>{const Te={...D};let Fe=!1;for(const be of p){if(D[be.uid])continue;let Re=null,Ae=be.uid;if(typeof Ae=="string"&&(Ae.includes("-")?(Re=Ae.split("-")[0],Ae=Ae.split("-")[1]):Ae.includes("_")&&(Re=Ae.split("_")[0],Ae=Ae.split("_")[1])),Ae)try{console.log("Trying to fetch nickname for user ID:",Ae);const xe=await ou(Ae);xe&&xe.Nickname?(console.log("Found nickname in Firebase for user ID:",Ae,"Nickname:",xe.Nickname),Te[be.uid]=xe.Nickname,Fe=!0):Re?(console.log("Using extracted name for user ID:",Ae,"Name:",Re),Te[be.uid]=Re,Fe=!0):(Te[be.uid]="User",Fe=!0)}catch(xe){console.error("Error fetching user profile:",xe),Re?(Te[be.uid]=Re,Fe=!0):(Te[be.uid]="User",Fe=!0)}else Re?(Te[be.uid]=Re,Fe=!0):(Te[be.uid]="User",Fe=!0)}Fe&&F(Te)};p.length>0&&ve()},[p,D]),O.useEffect(()=>{if(!e||!i||!v)return;console.log("Setting up screen share event handlers");const ve=async(be,Re)=>{if(console.log("User published:",be.uid,Re,be),Re==="video"){console.log("Remote video track detected:",be.uid);try{await e.subscribe(be,Re),console.log("Subscribed to remote video track:",be.uid),y(Ae=>Ae.some(xe=>xe.uid===be.uid)?Ae:[...Ae,be])}catch(Ae){console.error("Error subscribing to remote video track:",Ae)}}},Te=(be,Re)=>{if(console.log("User unpublished:",be.uid,Re),Re==="video"){if(console.log("Remote video track unpublished:",be.uid),be.videoTrack)try{be.videoTrack.stop()}catch(Ae){console.error("Error stopping video track:",Ae)}if(y(Ae=>Ae.filter(xe=>xe.uid!==be.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(N.current)}catch(Ae){console.error("Error replaying local screen track:",Ae)}}},Fe=be=>{console.log("User left:",be.uid);const Re=p.find(Ae=>Ae.uid===be.uid);if(Re&&Re.videoTrack)try{Re.videoTrack.stop()}catch(Ae){console.error("Error stopping video track:",Ae)}if(y(Ae=>Ae.filter(xe=>xe.uid!==be.uid)),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(N.current)}catch(Ae){console.error("Error replaying local screen track:",Ae)}};return e.on("user-published",ve),e.on("user-unpublished",Te),e.on("user-left",Fe),()=>{e.off("user-published",ve),e.off("user-unpublished",Te),e.off("user-left",Fe)}},[e,i,v,p,l]),O.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(ve=>{if(ve.videoTrack)try{console.log("Playing video track for:",ve.uid),ve.videoTrack.play(`video-container-${ve.uid}`)}catch(Te){console.error("Error playing video track:",Te)}}),l&&z.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(N.current)}catch(ve){console.error("Error replaying local screen track:",ve)}},[p,l]),O.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&N.current)try{console.log("Playing local screen track"),o.play(N.current)}catch(ve){console.error("Error playing local screen track:",ve)}},[l,o]),O.useEffect(()=>()=>{if(p.forEach(ve=>{if(ve.videoTrack)try{ve.videoTrack.stop()}catch(Te){console.error("Error stopping video track on unmount:",Te)}}),o)try{o.stop()}catch(ve){console.error("Error stopping local screen track on unmount:",ve)}},[p,o]);const ne=()=>{console.log("Stopping local screen share"),u()},de=ve=>(console.log("Getting display name for UID:",ve,"type:",typeof ve),l&&M&&(ve===M.uid||ve===(e==null?void 0:e.uid))?n||"You":D[ve]?D[ve]:typeof ve=="string"?ve.includes("-")?ve.split("-")[0]:ve.includes("_")?ve.split("_")[0]:ve:"User"),pe=ve=>{console.log("Opening modal for remote screen",ve),K(ve),ce()},he=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),ce()};return O.useEffect(()=>{re&&q?(console.log("Modal opened, activeScreen:",q),setTimeout(()=>{if(q.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),X(!0)}catch(ve){console.error("Error playing local screen in modal:",ve)}else if(q.videoTrack)try{console.log("Playing remote screen in modal"),q.videoTrack.play("modal-screen-container"),X(!0)}catch(ve){console.error("Error playing remote screen in modal:",ve)}},500)):re||(X(!1),K(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(ve){console.error("Error playing local screen in small container:",ve)}p.forEach(ve=>{if(ve.videoTrack)try{ve.videoTrack.play(`video-container-${ve.uid}`)}catch(Te){console.error(`Error playing remote screen ${ve.uid} in small container:`,Te)}})},500))},[re,q,l,p]),!v||C&&p.length===0&&!l||p.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!re&&S.jsxs(st,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&o&&S.jsxs(st,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:he,children:[S.jsx(st,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx(st,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(ve=>{const Te=D[ve.uid]||de(ve.uid);return S.jsxs(st,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(ve),children:[S.jsx(st,{id:`video-container-${ve.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx(st,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Te}'s Screen`})]},ve.uid)})]}),re&&S.jsx(st,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:se,children:S.jsxs(st,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:ve=>ve.stopPropagation(),children:[!ge&&S.jsxs(st,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(cd,{size:"xl"}),S.jsx(Ke,{mt:4,children:"Loading screen share..."})]}),S.jsx(st,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:te}),S.jsx(st,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:se,children:""}),S.jsx(st,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:q!=null&&q.isLocal?n?`${n}'s Screen`:"Your Screen":`${D[q==null?void 0:q.uid]||de(q==null?void 0:q.uid)}'s Screen`}),(q==null?void 0:q.isLocal)&&S.jsx(st,{position:"absolute",bottom:4,right:4,children:S.jsx(In,{colorScheme:"red",size:"sm",onClick:ne,children:"Stop Sharing"})})]})})]})},CGe=({onClose:n})=>{const e=ja(),[i,o]=O.useState(!1),[l,u]=O.useState(!1);O.useEffect(()=>{const v=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};v();const w=setInterval(v,1e3),C=()=>{v()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(w),window.removeEventListener("ScreenShareToggled",C)}},[]);const p=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)y();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const w=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}y()}}});window.dispatchEvent(w)}}catch(w){console.error("Error in screen share handler:",w),o(!1),e({title:"Screen sharing error",description:w.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(w,C)=>{o(!1),w?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),o(!1),e({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function RGe({open:n,onClose:e}){const[i,o]=O.useState(0);return S.jsxs(us,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(hs,{backdropFilter:"blur(4px)"}),S.jsxs(ds,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx(fo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx(Os,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(ys,{p:0,display:"flex",children:S.jsxs(k0,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[S.jsxs(O0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:tGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Movement"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:nGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Camera"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:ZWe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Actions"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:eGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(dR,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(Zl,{keyLabel:"W",description:"Move Forward"}),S.jsx(Zl,{keyLabel:"A",description:"Move Left"}),S.jsx(Zl,{keyLabel:"S",description:"Move Backward"}),S.jsx(Zl,{keyLabel:"D",description:"Move Right"}),S.jsx(Zl,{keyLabel:"Shift",description:"Run"}),S.jsx(Zl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(Zl,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(Zl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(Zl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(Mr,{wrap:"wrap",gap:3,children:[S.jsx(Zl,{keyLabel:"E",description:"Interact"}),S.jsx(Zl,{keyLabel:"F",description:"Emote Menu"}),S.jsx(Zl,{keyLabel:"T",description:"Chat"}),S.jsx(Zl,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(Rr,{align:"stretch",spacing:2,children:[S.jsx(Ke,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx(Ke,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx(Ke,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx(Ke,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Zl=({keyLabel:n,description:e})=>S.jsx(st,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(Bn,{spacing:2,children:[S.jsx(st,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx(Ke,{fontSize:"xs",children:e})]})}),IGe=({isOpen:n,onClose:e,containerRef:i})=>{const[o,l]=O.useState([]),[u,p]=O.useState(""),[y,v]=O.useState(0),[w,C]=O.useState(100),[R,N]=O.useState(100),[M,D]=O.useState(!0),[F,z]=O.useState(!0),[q,K]=O.useState(!1),[re,ce]=O.useState(null),[se,ge]=O.useState(null),[X,J]=O.useState(null);O.useEffect(()=>{if(!n)return;(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ve=await wR.getMicrophones();l(ve),ve.length>0&&p(ve[0].deviceId)}catch(ve){console.error("Error getting audio devices:",ve)}})()},[n]),O.useEffect(()=>{if(!n||!q){v(0);return}let he;return(async()=>{try{const Te=await navigator.mediaDevices.getUserMedia({audio:{deviceId:u?{exact:u}:void 0}});J(Te);const Fe=new(window.AudioContext||window.webkitAudioContext),be=Fe.createAnalyser(),Re=Fe.createMediaStreamSource(Te);be.fftSize=256,be.smoothingTimeConstant=.8,Re.connect(be),ce(Fe),ge(be);const Ae=new Uint8Array(be.frequencyBinCount),xe=()=>{be.getByteFrequencyData(Ae);const Ee=Math.sqrt(Ae.reduce((qe,at)=>qe+at*at,0)/Ae.length),je=Math.min(Ee*3,255)/255*100*(w/100);v(Math.min(je,100)),q&&n&&(he=requestAnimationFrame(xe))};xe()}catch(Te){console.error("Error setting up audio analysis:",Te),v(0)}})(),()=>{he&&cancelAnimationFrame(he),X&&(X.getTracks().forEach(Te=>Te.stop()),J(null)),re&&(re.close(),ce(null)),ge(null),v(0)}},[q,n,u,w]);const te=he=>{const ve=he.target.value;p(ve),console.log("Microphone changed to:",ve)},ne=he=>{C(he),console.log("Microphone volume set to:",he)},de=he=>{N(he),console.log("Speaker volume set to:",he)},pe=()=>{K(!q)};return S.jsx(Mc,{containerRef:i,children:S.jsxs(us,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"500px",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Voice Chat Settings"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{px:4,py:3,children:S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(Sr,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone",S.jsx(ih,{ml:2,bg:q?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:q?"#22c55e":"#ef4444",fontSize:"xs",px:2,py:1,borderRadius:"full",children:q?"Enabled":"Muted"})]}),S.jsxs(oie,{value:u,onChange:te,bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",children:[o.map(he=>S.jsx("option",{value:he.deviceId,style:{backgroundColor:"#1a1a1a",color:"white"},children:he.label||`Microphone ${he.deviceId.slice(0,5)}...`},he.deviceId)),o.length===0&&S.jsx("option",{value:"",style:{backgroundColor:"#1a1a1a",color:"white"},children:"No microphones found"})]})]}),S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:"Microphone Level"}),S.jsx(qy,{value:y,colorScheme:"green",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)",hasStripe:y>20,isAnimated:y>20,sx:{"& > div":{backgroundColor:"#22c55e !important"}}})]}),S.jsxs(Sr,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone Volume: ",w,"%"]}),S.jsxs(a0,{value:w,onChange:ne,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(l0,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(u0,{})}),S.jsx(c0,{boxSize:4})]})]}),S.jsxs(Sr,{children:[S.jsxs(gi,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Speaker Volume: ",R,"%"]}),S.jsxs(a0,{value:R,onChange:de,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(l0,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(u0,{})}),S.jsx(c0,{boxSize:4})]})]}),S.jsxs(Sr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Microphone Enabled"}),S.jsx(oh,{isChecked:q,onChange:pe,colorScheme:"gray",size:"md"})]}),S.jsxs(Sr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Echo Cancellation"}),S.jsx(oh,{isChecked:M,onChange:()=>D(!M),colorScheme:"gray",size:"md"})]}),S.jsxs(Sr,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(gi,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Noise Suppression"}),S.jsx(oh,{isChecked:F,onChange:()=>z(!F),colorScheme:"gray",size:"md"})]}),S.jsx(st,{mt:2,p:3,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:S.jsx(Ke,{fontSize:"xs",color:"gray.400",children:"Note: These settings will be applied when you join a voice chat."})})]})})]})]})})};function AGe({open:n,onClose:e,containerRef:i}){const[o,l]=O.useState(!1),[u,p]=O.useState(100),[y,v]=O.useState(100),[w,C]=O.useState(100),R=pc(),N=()=>{l(!0)},M=()=>{l(!1)},D=q=>{p(q),R("SetMasterVolume",{volume:q/100})},F=q=>{v(q),R("SetMusicVolume",{volume:q/100})},z=q=>{C(q),R("SetSFXVolume",{volume:q/100})};return n?S.jsxs(S.Fragment,{children:[S.jsx(Mc,{containerRef:i,children:S.jsx(st,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backdropFilter:"blur(2px)",bg:"rgba(0, 0, 0, 0.3)",zIndex:"999",opacity:n?1:0,visibility:n?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",pointerEvents:n?"auto":"none",onClick:e})}),S.jsx(Mc,{containerRef:i,children:S.jsxs(st,{position:"absolute",top:"0",right:"0",bottom:"0",width:"35%",minWidth:"600px",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",zIndex:"1000",color:"white",overflowY:"auto",transform:n?"translateX(0)":"translateX(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",maxHeight:"100vh",children:[S.jsx(st,{p:4,borderBottom:"1px solid rgba(255, 255, 255, 0.1)",position:"sticky",top:"0",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",zIndex:"1001",children:S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(Ke,{fontSize:"xl",fontWeight:"bold",children:"Settings"}),S.jsx(In,{variant:"ghost",size:"xs",onClick:e,color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Close settings",minW:"auto",h:"auto",p:1,children:""})]})}),S.jsx(st,{p:4,children:S.jsxs(k0,{variant:"unstyled",colorScheme:"blue",children:[S.jsxs(O0,{mb:4,bg:"rgba(255, 255, 255, 0.1)",borderRadius:"md",p:.5,children:[S.jsx(xa,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Audio & Video"}),S.jsx(xa,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Graphics"})]}),S.jsxs(dR,{children:[S.jsx(Oc,{p:0,children:S.jsxs(Rr,{spacing:6,align:"stretch",children:[S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Audio"}),S.jsxs(Rr,{spacing:3,align:"stretch",children:[S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(Ke,{fontSize:"sm",color:"white",minW:"120px",children:"Master Volume"}),S.jsxs(Bn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ke,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[u,"%"]}),S.jsx(st,{width:"180px",children:S.jsxs(a0,{value:u,onChange:D,min:0,max:100,step:1,colorScheme:"blue",size:"sm",children:[S.jsx(l0,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(u0,{})}),S.jsx(c0,{boxSize:4})]})})]})]}),S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(Ke,{fontSize:"sm",color:"white",minW:"120px",children:"Music Volume"}),S.jsxs(Bn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ke,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[y,"%"]}),S.jsx(st,{width:"180px",children:S.jsxs(a0,{value:y,onChange:F,min:0,max:100,step:1,colorScheme:"green",size:"sm",children:[S.jsx(l0,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(u0,{})}),S.jsx(c0,{boxSize:4})]})})]})]}),S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(Ke,{fontSize:"sm",color:"white",minW:"120px",children:"Sound Effects Volume"}),S.jsxs(Bn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(Ke,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[w,"%"]}),S.jsx(st,{width:"180px",children:S.jsxs(a0,{value:w,onChange:z,min:0,max:100,step:1,colorScheme:"orange",size:"sm",children:[S.jsx(l0,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(u0,{})}),S.jsx(c0,{boxSize:4})]})})]})]})]})]}),S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Voice Chat"}),S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(Ke,{fontSize:"sm",color:"white",children:"Microphone"}),S.jsx(In,{onClick:N,variant:"outline",size:"sm",colorScheme:"gray",borderColor:"whiteAlpha.400",color:"white",_hover:{bg:"whiteAlpha.200"},rightIcon:S.jsx(st,{as:"span",children:""}),px:4})]})]})]})}),S.jsx(Oc,{p:0,children:S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsx(Ke,{fontSize:"md",fontWeight:"semibold",children:"Graphics Settings"}),S.jsx(st,{p:4,bg:"whiteAlpha.100",borderRadius:"md",border:"1px solid",borderColor:"whiteAlpha.200",children:S.jsx(Ke,{color:"whiteAlpha.700",fontSize:"sm",children:"Graphics settings will be available here."})})]})})]})]})})]})}),o&&S.jsx(IGe,{isOpen:o,onClose:M,containerRef:i})]}):null}function PGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function kGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function _Z(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Uy(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function OGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function NGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function xGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function DGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function _0(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function eO(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function yZ(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function EZ(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function vZ(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function $C(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function LGe(n){return Ur({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const MGe=async()=>{try{W.log("tagsFirestore: Fetching all tags");const n=bl(Xn,"tags"),e=await id(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw W.error("tagsFirestore: Error fetching tags:",n),n}},UGe=async n=>{try{W.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=br(Xn,"tags",n),i=await Ko(e);return i.exists()?{id:i.id,...i.data()}:(W.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw W.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},VGe=async({id:n,name:e,color:i,description:o})=>{try{W.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const p=br(Xn,"tags",n);await Hg(p,l),u=n}else{const p=bl(Xn,"tags");u=(await f6e(p,l)).id}return{id:u,...l}}catch(l){throw W.error("tagsFirestore: Error creating tag:",l),l}},FGe=async(n,e)=>{try{W.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=br(Xn,"tags",e);if(!(await Ko(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=br(Xn,"spaces",n);return await mo(l,{tags:m6e(e)}),!0}catch(i){throw W.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},jGe=async(n,e)=>{try{W.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=br(Xn,"spaces",n);return await mo(i,{tags:$oe(e)}),!0}catch(i){throw W.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},BGe=async n=>{try{W.log(`tagsFirestore: Getting tags for space ${n}`);const e=br(Xn,"spaces",n),i=await Ko(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const p of l){const y=await UGe(p);y&&u.push(y)}return u}catch(e){throw W.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},zGe=async()=>{W.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){W.log(`tagsFirestore: Processing tag: ${o.name}`);const l=br(Xn,"tags",o.id);(await Ko(l)).exists()?(W.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await VGe(o),e++,W.log(`tagsFirestore: Created tag: ${o.name}`))}return W.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw W.error("tagsFirestore: Error initializing default tags:",e),e}},Qae=({spaceID:n})=>{const[e,i]=O.useState([]),[o,l]=O.useState([]),[u,p]=O.useState(!0),[y,v]=O.useState(!1),[w,C]=O.useState(!1),[R,N]=O.useState(null),{isOpen:M,onOpen:D,onClose:F}=sd(),z=ja(),{user:q}=O.useContext(ts),K=(q==null?void 0:q.groups)&&(q.groups.includes("disruptiveAdmin")||q.groups.includes("admin"));O.useEffect(()=>{re()},[n]);const re=async()=>{p(!0);try{let te=[];try{te=await MGe(),i(te)}catch(ne){W.error("SpaceTagsManager: Error loading available tags:",ne),i([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ne=await BGe(n);l(ne)}catch(ne){W.error("SpaceTagsManager: Error loading space tags:",ne),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(te){W.error("SpaceTagsManager: Error in loadTags:",te),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ce=async()=>{C(!0),N(null);try{const te=await zGe();console.log("Tag initialization result:",te),N(te),z({title:"Tags initialized",description:`Successfully created ${te.created} tags. Skipped ${te.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await re()}catch(te){W.error("SpaceTagsManager: Error initializing tags:",te),N(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},se=async te=>{if(!(!n||!te)){v(!0);try{await FGe(n,te);const ne=e.find(de=>de.id===te);ne&&l(de=>[...de,ne]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ne){W.error(`SpaceTagsManager: Error adding tag ${te} to space:`,ne),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},ge=async te=>{if(!(!n||!te)){v(!0);try{await jGe(n,te),l(ne=>ne.filter(de=>de.id!==te)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ne){W.error(`SpaceTagsManager: Error removing tag ${te} from space:`,ne),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},X=()=>{const te=o.map(ne=>ne.id);return e.filter(ne=>!te.includes(ne.id))},J=X().length===0;return S.jsxs(st,{children:[S.jsx(Mr,{mb:3,justifyContent:"space-between",alignItems:"center",children:S.jsxs(Bn,{spacing:2,ml:"auto",children:[K&&S.jsx(In,{size:"xs",leftIcon:S.jsx(I8e,{}),onClick:D,variant:"outline",colorScheme:"purple",children:"Admin"}),S.jsxs(jR,{children:[S.jsx(BR,{as:In,size:"xs",leftIcon:S.jsx(R8e,{}),rightIcon:S.jsx(_ae,{}),isDisabled:u||y||J,children:J?"No Available Tags":"Add Tag"}),S.jsx(zR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:X().length>0?X().map(te=>S.jsx(Ep,{onClick:()=>se(te.id),icon:S.jsx(st,{width:"12px",height:"12px",borderRadius:"full",bg:te.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:te.name},te.id)):S.jsx(Ep,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?S.jsx(Mr,{justify:"center",py:4,children:S.jsx(cd,{size:"sm",color:"blue.300"})}):e.length===0?S.jsx(st,{children:S.jsxs(Ke,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?S.jsx(Ke,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):S.jsx(_ie,{spacing:2,children:o.map(te=>S.jsx(N5,{children:S.jsxs(hie,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${te.color||"#888"}`,children:[S.jsx(st,{width:"8px",height:"8px",borderRadius:"full",bg:te.color||"#888",mr:1}),S.jsx(pie,{children:te.name}),S.jsx(mie,{onClick:()=>ge(te.id),isDisabled:y})]})},te.id))}),S.jsxs(us,{isOpen:M,onClose:F,size:"md",children:[S.jsx(hs,{backdropFilter:"blur(4px)"}),S.jsxs(ds,{bg:"gray.800",color:"white",children:[S.jsx(fo,{fontSize:"md",children:"Tag System Administration"}),S.jsx(Os,{}),S.jsxs(ys,{children:[S.jsx(Ke,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),R&&S.jsxs(Ig,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[S.jsx(Ag,{}),S.jsxs(Ke,{fontSize:"sm",children:["Tags initialized. Created: ",S.jsx("b",{children:R.created}),", Skipped: ",S.jsx("b",{children:R.skipped})]})]}),S.jsx(In,{colorScheme:"blue",onClick:ce,isLoading:w,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),S.jsx(uh,{children:S.jsx(In,{variant:"ghost",size:"sm",onClick:F,children:"Close"})})]})]})]})};Qae.propTypes={spaceID:Tn.string.isRequired};const WGe=({isOpen:n,onClose:e})=>{const{spaceID:i}=Io(),[o,l]=O.useState(0),[u,p]=O.useState(""),[y,v]=O.useState(""),[w,C]=O.useState(!1),[R,N]=O.useState(null),[M,D]=O.useState(null),[F,z]=O.useState(!1),[q,K]=O.useState(0),[re,ce]=O.useState(null),se=O.useRef(null),[ge,X]=O.useState(null),[J,te]=O.useState(null),[ne,de]=O.useState(!1),[pe,he]=O.useState(0),[ve,Te]=O.useState(null),Fe=O.useRef(null),[be,Re]=O.useState(null),[Ae,xe]=O.useState(null),[Ee,Ne]=O.useState(!1),[je,qe]=O.useState(0),[at,_t]=O.useState(null),ut=O.useRef(null),[vt,it]=O.useState([]),[wt,$t]=O.useState([]),[dt,mt]=O.useState(!1),[ct,Ft]=O.useState([]),[sn,Ht]=O.useState(null),[we,De]=O.useState(!1),[$e,kt]=O.useState(!0),[At,Tt]=O.useState(!1),[Ut,Sn]=O.useState(!1),[Pn,hn]=O.useState(!1),[Rt,Zn]=O.useState(!1),[Dt,Xt]=O.useState(""),[Vr,Oi]=O.useState(""),[li,Ni]=O.useState(""),[Es,Yo]=O.useState(!1),{setHLSStreamUrl:qi,savedStreamData:xi}=xae(),Kn=ja();O.useEffect(()=>{n&&i&&ps()},[n,i]);const ps=async()=>{try{const pt=await Ua(i);pt.logoUrl&&ce(pt.logoUrl),pt.backgroundUrl&&Te(pt.backgroundUrl),pt.videoBackgroundUrl&&_t(pt.videoBackgroundUrl),pt.voiceDisabled!==void 0&&De(pt.voiceDisabled),pt.accessibleToAllUsers!==void 0&&kt(pt.accessibleToAllUsers),pt.allowGuestUsers!==void 0&&Tt(pt.allowGuestUsers),pt.hideGuestSignInButton!==void 0&&Sn(pt.hideGuestSignInButton),p(pt.name||""),v(pt.description||"");try{const rn=await fae(i);if(rn){Xt(rn.streamUrl||""),Oi(rn.rtmpUrl||""),Ni(rn.streamKey||"");const kr=rn.enabled===!0;Zn(kr),W.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:kr,rawValue:rn.enabled})}else Zn(!1),W.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(rn){if(W.error("Error fetching stream data directly:",rn),xi){Xt(xi.streamUrl||""),Oi(xi.rtmpUrl||""),Ni(xi.streamKey||"");const kr=xi.enabled===!0;Zn(kr),W.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:kr,rawValue:xi.enabled})}else Zn(!1),W.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}ha(pt)}catch(pt){W.error("Error fetching space data:",pt),Kn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};O.useEffect(()=>{if(xi){if(!Es){Xt(xi.streamUrl||""),Oi(xi.rtmpUrl||""),Ni(xi.streamKey||"");const pt=xi.enabled===!0;Zn(pt),W.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:pt,rawValue:xi.enabled})}}else n&&!Es&&W.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[xi,Es,n]);const ha=async pt=>{if(i&&n){mt(!0);try{const rn=qk(),kr=`space_${i}_owners`,Di=UO(bl(rn,"users"),NQ("groups","array-contains",kr)),mc=await id(Di),_o=[];for(const Yi of mc.docs){const vs=Yi.data(),ri=await ou(Yi.id);_o.push({uid:Yi.id,email:vs.email,displayName:vs.displayName||ri.Nickname||"Unknown User",photoURL:vs.photoURL||ri.photoURL,firstName:ri.firstName,lastName:ri.lastName})}it(_o);const Cl=`space_${i}_hosts`,yh=UO(bl(rn,"users"),NQ("groups","array-contains",Cl)),Ks=await id(yh),Gr=[];for(const Yi of Ks.docs){const vs=Yi.data(),ri=await ou(Yi.id);Gr.push({uid:Yi.id,email:vs.email,displayName:vs.displayName||ri.Nickname||"Unknown User",photoURL:vs.photoURL||ri.photoURL,firstName:ri.firstName,lastName:ri.lastName})}$t(Gr);const Eh=bl(rn,`spaces/${i}/BannedUsers`),Hr=await id(Eh),fa=[];for(const Yi of Hr.docs){const vs=Yi.id;try{const ri=await ou(vs);fa.push({uid:vs,displayName:(ri==null?void 0:ri.Nickname)||vs,firstName:ri==null?void 0:ri.firstName,lastName:ri==null?void 0:ri.lastName,photoURL:ri==null?void 0:ri.photoURL})}catch{fa.push({uid:vs,displayName:vs})}}Ft(fa)}catch(rn){W.error("Error fetching space users:",rn),Kn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{mt(!1)}}};O.useEffect(()=>{i&&n&&o===4&&ha()},[i,n,o]);const Xo=pt=>{const rn=pt.target.files[0];if(rn){if(!rn.type.startsWith("image/")){Kn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(rn);const kr=new FileReader;kr.onloadend=()=>{D(kr.result)},kr.readAsDataURL(rn)}},go=pt=>{const rn=pt.target.files[0];if(rn){if(!rn.type.startsWith("image/")){Kn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}X(rn);const kr=new FileReader;kr.onloadend=()=>{te(kr.result)},kr.readAsDataURL(rn)}},ld=pt=>{const rn=pt.target.files[0];if(rn){if(!rn.type.startsWith("video/")){Kn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const kr=5*1024*1024;if(rn.size>kr){Kn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}Re(rn);const Di=new FileReader;Di.onloadend=()=>{xe(Di.result)},Di.readAsDataURL(rn)}},Jo=async()=>{if(!R){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const pt=setInterval(()=>{K(kr=>{const Di=kr+10;return Di>=90?90:Di})},300),rn=await d8e(i,R);clearInterval(pt),K(100),ce(rn),Kn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),D(null),K(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:rn}}))}catch(pt){console.error("Error uploading logo:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),K(0)}},ud=async()=>{if(!ge){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{de(!0);const pt=setInterval(()=>{he(kr=>{const Di=kr+10;return Di>=90?90:Di})},300),rn=await p8e(i,ge);clearInterval(pt),he(100),Te(rn),Kn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{X(null),te(null),he(0),de(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:rn}}))}catch(pt){console.error("Error uploading background:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),de(!1),he(0)}},fc=async()=>{if(re)try{z(!0),await h8e(i),ce(null),Kn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(pt){console.error("Error deleting logo:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},Ao=async()=>{if(ve)try{de(!0),await f8e(i),Te(null),Kn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),de(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(pt){console.error("Error deleting background:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),de(!1)}},wr=async()=>{if(!be){Kn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{Ne(!0);const pt=setInterval(()=>{qe(kr=>{const Di=kr+10;return Di>=90?90:Di})},300),rn=await _8e(i,be);clearInterval(pt),qe(100),_t(rn),Kn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Re(null),xe(null),qe(0),Ne(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:rn}}))}catch(pt){console.error("Error uploading video background:",pt),Kn({title:"Upload failed",description:pt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),Ne(!1),qe(0)}},uu=async()=>{if(at)try{Ne(!0),await y8e(i),_t(null),Kn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),Ne(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(pt){console.error("Error deleting video background:",pt),Kn({title:"Deletion failed",description:pt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),Ne(!1)}},pa=()=>{se.current&&se.current.click()},Ba=()=>{Fe.current&&Fe.current.click()},Vc=()=>{ut.current&&ut.current.click()},Qo=async()=>{hn(!0);try{await GC(i,{voiceDisabled:!we}),De(!we),Kn({title:"Settings Updated",description:`Voice chat has been ${we?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){W.error("Error updating voice settings:",pt),Kn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{hn(!1)}},Zo=async()=>{hn(!0);try{await g8e(i,!$e),kt(!$e),Kn({title:"Settings Updated",description:`Space is now ${$e?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){W.error("Error updating accessibility settings:",pt),Kn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{hn(!1)}},dd=async()=>{hn(!0);try{const pt=!At,rn={allowGuestUsers:pt};pt||(rn.hideGuestSignInButton=!1,Sn(!1)),await GC(i,rn),Tt(pt),Kn({title:"Settings Updated",description:`Guest users are now ${pt?"allowed":"not allowed"} in this space.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){W.error("Error updating guest user settings:",pt),Kn({title:"Error",description:"Failed to update guest user settings",status:"error",duration:3e3,isClosable:!0})}finally{hn(!1)}},gh=async()=>{hn(!0);try{await GC(i,{hideGuestSignInButton:!Ut}),Sn(!Ut),window.dispatchEvent(new CustomEvent("SpaceSettingsChanged",{detail:{spaceId:i,hideGuestSignInButton:!Ut}})),Kn({title:"Settings Updated",description:`Guest sign-in button is now ${Ut?"visible":"hidden"}.`,status:"success",duration:3e3,isClosable:!0})}catch(pt){W.error("Error updating sign-in button settings:",pt),Kn({title:"Error",description:"Failed to update sign-in button settings",status:"error",duration:3e3,isClosable:!0})}finally{hn(!1)}},Tl=async()=>{if(i){C(!0);try{const pt=qk(),rn=br(pt,"spaces",i);await mo(rn,{name:u,description:y}),Kn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:y}}))}catch(pt){W.error("Error updating space details:",pt),Kn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},_h=async()=>{if(i){Yo(!0);try{const pt={enabled:Rt,streamUrl:Dt,rtmpUrl:Vr,streamKey:li,playerIndex:"0",updatedAt:new Date().toISOString()};W.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Rt,url:Dt,hasRtmp:!!Vr,hasKey:!!li});try{await BF(i,pt),W.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(rn){throw W.error("SpaceManageModal: Error updating stream settings directly in Firebase:",rn),rn}await qi(Dt,0,{enabled:Rt,rtmpUrl:Vr,streamKey:li}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Rt,spaceId:i}})),Kn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Rt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{ps()},500)}catch(pt){W.error("Error updating stream settings:",pt),Kn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Yo(!1)}}},xs=async pt=>{try{Ht(pt);const rn=qk();await p6e(br(rn,`spaces/${i}/BannedUsers`,pt));const kr=br(rn,"users",pt),Di=`space_${i}_banned`;await mo(kr,{groups:$oe(Di)}),Ft(mc=>mc.filter(_o=>_o.uid!==pt)),Kn({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(rn){W.error("Error unbanning user:",rn),Kn({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{Ht(null)}};return S.jsxs(us,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.200",children:"Manage Space"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{p:0,display:"flex",overflow:"hidden",children:S.jsxs(k0,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[S.jsxs(O0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:OGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Details"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:Uy,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Logo"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:kGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Background"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:xGe,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Settings"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:vZ,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Users"})]}),S.jsxs(xa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(yn,{as:$C,mb:1}),S.jsx(Ke,{fontSize:"xs",children:"Stream"})]})]}),S.jsxs(dR,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Details"}),S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Space Name"}),S.jsx(ci,{value:u,onChange:pt=>p(pt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Description"}),S.jsx(gie,{value:y,onChange:pt=>v(pt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Space Tags"}),S.jsx(st,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?S.jsx(Qae,{spaceID:i}):S.jsxs(Ig,{status:"warning",variant:"subtle",borderRadius:"md",children:[S.jsx(Ag,{}),S.jsx(DC,{fontSize:"sm",children:"Space ID missing"}),S.jsx(LC,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),S.jsx(In,{colorScheme:"blue",size:"sm",onClick:Tl,isLoading:w,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Logo"}),S.jsx(Ke,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(re||M)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[re&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(bp,{src:re,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(In,{mt:3,colorScheme:"red",leftIcon:S.jsx(yn,{as:_0}),onClick:fc,isLoading:F,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),M&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(bp,{src:M,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Logo"}),S.jsx(ci,{type:"file",accept:"image/*",onChange:Xo,ref:se,display:"none"}),F&&S.jsxs(st,{mt:3,mb:3,children:[S.jsxs(Ke,{fontSize:"xs",mb:1,children:["Uploading... ",q,"%"]}),S.jsx(qy,{value:q,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Bn,{mt:3,spacing:3,children:[S.jsx(In,{colorScheme:"blue",leftIcon:S.jsx(yn,{as:Uy}),onClick:pa,isDisabled:F,size:"sm",variant:"outline",children:"Browse"}),S.jsx(In,{colorScheme:"green",leftIcon:S.jsx(yn,{as:eO}),onClick:Jo,isLoading:F,loadingText:"Uploading...",isDisabled:!R||F,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Background"}),S.jsx(Ke,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),S.jsxs(k0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[S.jsxs(O0,{children:[S.jsxs(xa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(yn,{as:Uy,mr:2}),"Image"]}),S.jsxs(xa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(yn,{as:_Z,mr:2}),"Video (max 5MB)"]})]}),S.jsxs(dR,{mt:4,children:[S.jsxs(Oc,{p:0,children:[(ve||J)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ve&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(bp,{src:ve,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(In,{mt:3,colorScheme:"red",leftIcon:S.jsx(yn,{as:_0}),onClick:Ao,isLoading:ne,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(bp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Background Image"}),S.jsx(ci,{type:"file",accept:"image/*",onChange:go,ref:Fe,display:"none"}),ne&&S.jsxs(st,{mt:3,mb:3,children:[S.jsxs(Ke,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),S.jsx(qy,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Bn,{mt:3,spacing:3,children:[S.jsx(In,{colorScheme:"blue",leftIcon:S.jsx(yn,{as:Uy}),onClick:Ba,isDisabled:ne,size:"sm",variant:"outline",children:"Browse"}),S.jsx(In,{colorScheme:"green",leftIcon:S.jsx(yn,{as:eO}),onClick:ud,isLoading:ne,loadingText:"Uploading...",isDisabled:!ge||ne,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(Oc,{p:0,children:[(at||Ae)&&S.jsxs(Mr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[at&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),S.jsx(st,{maxH:"160px",overflow:"hidden",position:"relative",children:S.jsx("video",{src:at,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),S.jsx(In,{mt:3,colorScheme:"red",leftIcon:S.jsx(yn,{as:_0}),onClick:uu,isLoading:Ee,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Ae&&S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(st,{maxH:"160px",overflow:"hidden",children:S.jsx("video",{src:Ae,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Upload New Video Background"}),S.jsx(ci,{type:"file",accept:"video/*",onChange:ld,ref:ut,display:"none"}),Ee&&S.jsxs(st,{mt:3,mb:3,children:[S.jsxs(Ke,{fontSize:"xs",mb:1,children:["Uploading... ",je,"%"]}),S.jsx(qy,{value:je,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Bn,{mt:3,spacing:3,children:[S.jsx(In,{colorScheme:"blue",leftIcon:S.jsx(yn,{as:_Z}),onClick:Vc,isDisabled:Ee,size:"sm",variant:"outline",children:"Browse"}),S.jsx(In,{colorScheme:"green",leftIcon:S.jsx(yn,{as:eO}),onClick:wr,isLoading:Ee,loadingText:"Uploading...",isDisabled:!be||Ee,size:"sm",children:"Upload"})]}),S.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Settings"}),S.jsx(Ke,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsxs(st,{children:[S.jsxs(Bn,{mb:1,spacing:2,children:[S.jsxs(st,{position:"relative",w:"16px",h:"16px",children:[S.jsx(yn,{as:LGe,color:we?"red.400":"green.400"}),we&&S.jsx(st,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.800",children:we?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(oh,{isChecked:!we,onChange:Qo,colorScheme:"green",size:"md",isDisabled:Pn})]})}),S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsxs(st,{children:[S.jsxs(Bn,{mb:1,spacing:2,children:[S.jsx(st,{position:"relative",w:"16px",h:"16px",children:S.jsx(yn,{as:vZ,color:$e?"green.400":"red.400"})}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.800",children:$e?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.700",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),S.jsx(oh,{isChecked:$e,onChange:Zo,colorScheme:"green",size:"md",isDisabled:Pn})]})}),S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsxs(st,{children:[S.jsxs(Bn,{mb:1,spacing:2,children:[S.jsx(st,{position:"relative",w:"16px",h:"16px",children:S.jsx(yn,{as:EZ,color:At?"green.400":"red.400"})}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Allow Guest Users"})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.800",children:At?"Unauthenticated users can enter as guests with usernames like 'Visitor_1234'.":"Only authenticated users can access this space."}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.700",mt:1,children:"Guest users have limited permissions and cannot save progress."})]}),S.jsx(oh,{isChecked:At,onChange:dd,colorScheme:"green",size:"md",isDisabled:Pn})]}),At&&S.jsx(st,{mt:3,pt:3,borderTop:"1px solid",borderColor:"whiteAlpha.200",children:S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsxs(st,{children:[S.jsxs(Bn,{mb:1,spacing:2,children:[S.jsx(st,{position:"relative",w:"14px",h:"14px",ml:1,children:S.jsx(yn,{as:yZ,color:Ut?"orange.400":"gray.400",fontSize:"sm"})}),S.jsx(Ke,{fontSize:"sm",fontWeight:"500",children:"Remove Sign In Button"})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.700",ml:5,children:Ut?"Guest users won't see the sign-in button to upgrade their account.":"Guest users can see a sign-in button to upgrade to a full account."})]}),S.jsx(oh,{isChecked:Ut,onChange:gh,colorScheme:"orange",size:"sm",isDisabled:Pn||!At})]})})]}),S.jsxs(Ig,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[S.jsx(Ag,{color:"blue.300"}),S.jsxs(st,{children:[S.jsx(DC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(LC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Manage Users"}),S.jsx(Ke,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),dt?S.jsx(Mr,{justify:"center",align:"center",h:"200px",children:S.jsx(cd,{color:"blue.300"})}):S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(st,{children:[S.jsxs(Bn,{mb:2,children:[S.jsx(yn,{as:PGe,color:"green.400"}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(ih,{colorScheme:"green",ml:2,children:vt.length})]}),S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:vt.length===0?S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(Rr,{spacing:1,align:"stretch",children:vt.map(pt=>S.jsxs(Bn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(yl,{size:"xs",src:pt.photoURL,name:pt.displayName}),S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"xs",children:pt.displayName}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:pt.firstName&&pt.lastName?`${pt.firstName} ${pt.lastName}`:"Full name not available"})]}),S.jsx(d0,{}),S.jsx(ih,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},pt.uid))})})]}),S.jsxs(st,{children:[S.jsxs(Bn,{mb:2,children:[S.jsx(yn,{as:DGe,color:"purple.400"}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(ih,{colorScheme:"purple",ml:2,children:wt.length})]}),S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:wt.length===0?S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(Rr,{spacing:1,align:"stretch",children:wt.map(pt=>S.jsxs(Bn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(yl,{size:"xs",src:pt.photoURL,name:pt.displayName}),S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"xs",children:pt.displayName}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:pt.firstName&&pt.lastName?`${pt.firstName} ${pt.lastName}`:"Full name not available"})]}),S.jsx(d0,{}),S.jsx(ih,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},pt.uid))})})]}),S.jsxs(st,{children:[S.jsxs(Bn,{mb:2,children:[S.jsx(yn,{as:yZ,color:"red.400"}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),S.jsx(ih,{colorScheme:"red",ml:2,children:ct.length})]}),S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ct.length===0?S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):S.jsx(Rr,{spacing:1,align:"stretch",children:ct.map(pt=>S.jsxs(Bn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(yl,{size:"xs",src:pt.photoURL,name:pt.displayName}),S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"xs",children:pt.displayName}),pt.firstName&&S.jsxs(Ke,{fontSize:"xs",color:"whiteAlpha.600",children:[pt.firstName," ",pt.lastName]})]}),S.jsx(d0,{}),S.jsxs(Bn,{spacing:2,children:[S.jsx(In,{size:"xs",colorScheme:"green",isLoading:sn===pt.uid,onClick:()=>xs(pt.uid),leftIcon:S.jsx(yn,{as:EZ}),children:"Unban"}),S.jsx(ih,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},pt.uid))})})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Stream Settings"}),S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Bn,{justify:"space-between",align:"center",children:[S.jsx(st,{children:S.jsxs(Bn,{mb:1,spacing:2,children:[S.jsx(st,{position:"relative",w:"16px",h:"16px",children:S.jsx(yn,{as:$C,color:Rt?"green.400":"red.400"})}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),S.jsx(oh,{isChecked:Rt,onChange:async()=>{const pt=!Rt;Zn(pt),Yo(!0);try{W.log("SpaceManageModal: Auto-saving streaming enabled state:",pt);const rn={enabled:pt,streamUrl:Dt||"",rtmpUrl:Vr||"",streamKey:li||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await BF(i,rn),W.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(kr){throw W.error("SpaceManageModal: Error updating streaming state directly in Firebase:",kr),kr}await qi(Dt,0,{enabled:pt,rtmpUrl:Vr,streamKey:li}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:pt,spaceId:i}})),Kn({title:"Streaming "+(pt?"Enabled":"Disabled"),description:`Streaming is now ${pt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(rn){W.error("Error auto-saving streaming state:",rn),Zn(!pt),Kn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Yo(!1),setTimeout(()=>{ps()},500)}},colorScheme:"green",size:"md",isDisabled:Es})]})}),S.jsxs(st,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),S.jsxs(Sr,{mb:4,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Stream URL"}),S.jsx(ci,{value:Dt,onChange:pt=>Xt(pt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Es})]}),S.jsx(Ug,{my:3,borderColor:"whiteAlpha.200"}),S.jsx(Ke,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),S.jsxs(Sr,{mb:3,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"RTMP URL"}),S.jsx(ci,{value:Vr,onChange:pt=>Oi(pt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Es})]}),S.jsxs(Sr,{mb:3,children:[S.jsx(gi,{fontSize:"xs",color:"white",children:"Stream Key"}),S.jsx(ci,{value:li,onChange:pt=>Ni(pt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Es,type:"password"})]})]}),S.jsx(In,{colorScheme:"blue",size:"sm",onClick:_h,isLoading:Es,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Rt?"inline-flex":"none",children:"Save Stream Settings"}),S.jsxs(Ig,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[S.jsx(Ag,{color:"blue.300"}),S.jsxs(st,{children:[S.jsx(DC,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),S.jsx(LC,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Zae="spaces",ece="portals",GGe=async(n,e,i)=>{try{const o=br(Xn,Zae,n,ece,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Hg(o,l),W.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return W.error("Error saving portal:",o),!1}},SZ=async(n,e,i)=>{try{const o=br(Xn,Zae,n,ece,e),l={...i,updatedAt:new Date().toISOString()};return await mo(o,l),W.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return W.error("Error updating portal:",o),!1}},HGe=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=O.useState([]),[u,p]=O.useState(!1),[y,v]=O.useState(null),[w,C]=O.useState(!1),R=ja(),{placePortal:N,directPlacePortal:M}=Mae(),D=Cg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),F=Cg("gray.800","white"),z=Cg("gray.200","whiteAlpha.200"),q=Cg("gray.200","whiteAlpha.300");O.useEffect(()=>{n&&(async()=>{p(!0),v(null),l([]);try{const se=bl(Xn,"spaces"),X=(await id(se)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(X)}catch(se){W.error("PortalAdminModal: Error fetching spaces:",se),v("Failed to load spaces. Please check your connection and try again.")}p(!1)})()},[n]);const K=async(ce,se)=>{if(!i){W.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),R({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),W.log(`PortalAdminModal: Attempting to place portal to ${se} (${ce}) in space ${i}`);try{const ge=await Ua(ce);if(!ge)throw new Error(`Failed to fetch target space data for ${ce}`);const X=ge.backgroundUrl||ge.backgroundGsUrl;X||W.warn(`PortalAdminModal: No background image URL found for target space: ${ce}`);const J="PortalObjectPrefab",te={x:0,y:1.5,z:0},ne={x:0,y:0,z:0},de={x:1,y:1,z:1},pe=`portal_${i}_${ce}_${Date.now()}`;if(!await GGe(i,pe,{type:"portal",targetSpaceId:ce,targetSpaceName:se,portalId:pe,position:te,rotation:ne,scale:de,prefabName:J,initialImageUrl:X})){W.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),R({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}W.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Te=!1;try{const Fe={portalId:pe,prefabName:J,position:te,rotation:ne,scale:de,initialImageUrl:X};Te=N(pe,J,te,ne,de,X),Te||(Te=M(pe,J,te,ne,de,X)),W.log("PortalAdminModal: Portal placement in Unity:",Te)}catch(Fe){W.error("PortalAdminModal: Error placing portal in Unity:",Fe)}Te?(R({title:"Portal Placed",description:`Portal to ${se} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(R({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(ge){W.error("PortalAdminModal: Error creating portal:",ge),R({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},re=u||w;return S.jsxs(us,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[S.jsx(hs,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:D,backdropFilter:"blur(18px)",color:F,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[S.jsx(fo,{borderBottom:"1px solid",borderColor:q,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),S.jsx(Os,{}),S.jsxs(ys,{p:6,children:[re&&S.jsxs(Rr,{justifyContent:"center",alignItems:"center",height:"200px",children:[S.jsx(cd,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),S.jsx(Ke,{mt:3,children:"Loading Spaces..."})]}),y&&S.jsxs(Ig,{status:"error",borderRadius:"md",variant:"subtle",children:[S.jsx(Ag,{}),y]}),!u&&!y&&o.length===0&&S.jsx(Ke,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!y&&o.length>0&&S.jsx(mN,{spacing:3,children:o.map(ce=>S.jsx(Rre,{p:3,borderRadius:"md",_hover:{bg:z,cursor:re?"not-allowed":"pointer",transform:re?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!re&&K(ce.id,ce.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:re?.7:1,pointerEvents:re?"none":"auto",children:ce.name},ce.id))})]})]})]})},bZ=["Recent","Furniture","Objects","Upload","Portals"],$Ge={Furniture:"chair",Objects:"misc"},KGe=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=O.useState(bZ[0]),[u,p]=O.useState(""),[y,v]=O.useState(!1),[w,C]=O.useState(!1),[R,N]=O.useState([]),[M,D]=O.useState(!0),[F,z]=O.useState(null),{placeCatalogueItem:q}=Uae(),K=Cg("blue.500","blue.300"),re=Cg("gray.500","gray.400"),ce=Cg("whiteAlpha.200","whiteAlpha.200");O.useEffect(()=>{n&&(async()=>{D(!0),z(null),N([]);try{const pe=bl(Xn,"catalogue"),he=await id(pe),ve=[];he.forEach(Te=>{var Re,Ae;const Fe=Te.data(),be=["chair","misc"];Fe.glbUrl&&((Re=Fe.categories)!=null&&Re.some(xe=>be.includes(xe)))&&ve.push({id:Te.id,name:Fe.name||"Unnamed Item",thumbnail:((Ae=Fe.thumbnail)==null?void 0:Ae.src)||"https://via.placeholder.com/150",glbUrl:Fe.glbUrl,categories:Fe.categories})}),N(ve)}catch(pe){console.error("Error fetching catalogue items:",pe),z("Failed to load catalogue items. Please check your connection and try again.")}D(!1)})()},[n]);const se=de=>{l(de),p(""),v(de==="Portals")},ge=(de,pe)=>{const he=$Ge[pe];let ve=de;return he&&(ve=ve.filter(Te=>{var Fe;return(Fe=Te.categories)==null?void 0:Fe.includes(he)})),u&&(ve=ve.filter(Te=>Te.name.toLowerCase().includes(u.toLowerCase()))),ve},X=["Furniture","Objects"].includes(o)?ge(R,o):[],J=async de=>{console.log(`Placing item: ${de.name}`);try{if(!de.glbUrl){console.error("Item is missing GLB URL");return}const pe=`item_${i.spaceID}_${Date.now()}`,he={x:0,y:0,z:0},ve={x:0,y:0,z:0},Te={x:1,y:1,z:1},Fe={itemId:pe,name:de.name||"Unnamed Item",glbUrl:de.glbUrl,thumbnail:de.thumbnail||"https://via.placeholder.com/150",position:he,rotation:ve,scale:Te,createdAt:Date.now(),updatedAt:Date.now(),categories:de.categories||[]};if(!Fe.glbUrl)throw new Error("GLB URL is required");await Hg(br(Xn,"spaces",i.spaceID,"catalogue",pe),Fe),q(pe,Fe.glbUrl,he,ve,Te)?e():console.error("Failed to place item in Unity")}catch(pe){console.error("Error placing item:",pe)}},te=()=>{C(!0)},ne=()=>{C(!1)};return S.jsxs(us,{isOpen:n,onClose:e,size:"5xl",isCentered:!0,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:y?"Create New Portal":"Content Catalogue"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsxs(ys,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[S.jsxs(Bn,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[bZ.filter(de=>de!=="Portals").map(de=>S.jsx(In,{variant:"ghost",size:"md",fontWeight:o===de?"semibold":"normal",color:o===de?"white":re,bg:o===de?ce:"transparent",borderBottom:o===de?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!==de?"whiteAlpha.100":ce,color:"white"},onClick:()=>se(de),px:4,whiteSpace:"nowrap",children:de},de)),S.jsx(d0,{}),S.jsx(In,{variant:"ghost",size:"md",fontWeight:o==="Portals"?"semibold":"normal",color:o==="Portals"?"white":re,bg:o==="Portals"?ce:"transparent",borderBottom:o==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!=="Portals"?"whiteAlpha.100":ce,color:"white"},onClick:()=>se("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),y&&o==="Portals"?S.jsx(st,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:S.jsx(In,{size:"lg",colorScheme:"blue",onClick:te,children:"Browse"})}):S.jsxs(S.Fragment,{children:[S.jsx(st,{p:4,children:S.jsx(ci,{placeholder:`Search in ${o}...`,value:u,onChange:de=>p(de.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),S.jsx(st,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:S.jsx(v5,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:M?S.jsx(Ke,{color:"whiteAlpha.700",children:"Loading items..."}):X.length>0?X.map(de=>S.jsxs(st,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>J(de),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[S.jsx(st,{bgImage:`url(${de.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),S.jsx(Ke,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:de.name})]},de.id)):S.jsxs(Ke,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),S.jsx(HGe,{isOpen:w,onClose:ne,currentSpaceId:i==null?void 0:i.spaceID})]})},qGe=({onTogglePlayerList:n,spaceID:e,containerRef:i})=>{const{fullscreenRef:o}=fh(),[l,u]=O.useState(!0),[p,y]=O.useState(!1),[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState(!1),[D,F]=O.useState(!1),[z,q]=O.useState(!1),[K,re]=O.useState(null),[ce,se]=O.useState(!1),[ge,X]=O.useState(!1),[J,te]=O.useState(!1),[ne,de]=O.useState(!1),pe=ja(),{user:he,currentUser:ve,isGuestUser:Te}=O.useContext(ts),be=he!=null&&he.Nickname?he.Nickname:ve&&Te(ve)?ve.username||ve.Nickname||"Guest User":"Unknown",[Re,Ae]=O.useState(!1),xe=$t=>{if(!$t)return"G";if($t.startsWith("Visitor_")){const dt=$t.split("_")[1];return`V${dt?dt.charAt(0):""}`}return $t.charAt(0).toUpperCase()},Ee=async()=>{if(he!=null&&he.uid&&e)try{const $t=await ou(he.uid);let dt=!1,mt=!1;if($t.groups){const Ft=`space_${e}_owners`,sn=`space_${e}_hosts`;dt=$t.groups.includes(Ft),mt=$t.groups.includes(sn)}const ct=await Xoe(he.uid,"disruptiveAdmin");if(de(ct),re({rpmURL:$t.rpmURL?$t.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!1}),X(dt||ct),te(mt),!dt&&!ct&&ce){se(!1);const Ft=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Ft),pe({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch($t){console.error("Error fetching profile data:",$t),X(!1),te(!1),de(!1)}else if(ve&&Te(ve)){if(re({rpmURL:ve.rpmURL?ve.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!0}),X(!1),te(!1),de(!1),ce){se(!1);const $t=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent($t)}}else re(null),X(!1),te(!1),de(!1)};O.useEffect(()=>{Ee()},[he==null?void 0:he.uid,ve==null?void 0:ve.uid,ve==null?void 0:ve.rpmURL,e,ce]),O.useEffect(()=>{const $t=()=>{u(!0)};return window.addEventListener("PlayerInstantiated",$t),()=>{window.removeEventListener("PlayerInstantiated",$t)}},[]),O.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&Ae(window.agoraClient.voiceDisabled)}catch(mt){console.error("Error checking if voice is disabled:",mt)}})();const dt=mt=>{mt.detail&&typeof mt.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",mt.detail.voiceDisabled),Ae(mt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[]);const Ne=()=>{w(!v),v||it()},je=()=>R(!C),qe=()=>{F(!D),it()},at=()=>{M(!1),Ee()},_t=()=>{q(!1)},ut=()=>{q(!0),it()},vt=$t=>{$t.stopPropagation(),typeof n=="function"&&(W.log("CanvasMainMenu: Toggling player list"),n())},it=()=>{y(!1)},wt=$t=>{if($t.stopPropagation(),!ge){pe({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const dt=!ce;se(dt);const mt=new CustomEvent("editModeChanged",{detail:{enabled:dt}});window.dispatchEvent(mt),pe({title:dt?"Edit Mode Enabled":"Edit Mode Disabled",description:dt?"You can now make changes to the scene.":"Scene editing is now disabled.",status:dt?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return S.jsxs(S.Fragment,{children:[S.jsxs(jR,{isOpen:p,onClose:()=>y(!1),children:[S.jsx(BR,{as:xc,icon:S.jsx(O8e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:p?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:p?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>y(!p)}),S.jsx(Mc,{containerRef:o,children:S.jsx(zR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:3,borderRadius:"lg",zIndex:9999,transform:"none !important",children:S.jsxs(Rr,{align:"stretch",spacing:3,children:[S.jsxs(Bn,{spacing:3,children:[S.jsx(yl,{size:"sm",src:K==null?void 0:K.rpmURL,bg:"white",name:K!=null&&K.isGuest?xe((ve==null?void 0:ve.username)||(ve==null?void 0:ve.Nickname)):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(Rr,{align:"start",spacing:0,children:[S.jsxs(Bn,{children:[S.jsx(Ke,{fontWeight:"bold",fontSize:"sm",children:be}),ge&&!ne&&S.jsx(Ff,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(st,{display:"inline-block",children:S.jsx(yn,{as:XF,color:"green.400",boxSize:2.5})})}),!ge&&J&&!ne&&S.jsx(Ff,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(st,{display:"inline-block",children:S.jsx(yn,{as:JF,color:"purple.400",boxSize:2.5})})}),ne&&S.jsx(Ff,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx(st,{display:"inline-block",children:S.jsx(yn,{as:iGe,color:"blue.400",boxSize:2.5})})})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(Bn,{spacing:3,justify:"center",children:[S.jsx(xc,{icon:S.jsx(oGe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:vt}),ge&&S.jsx(xc,{icon:S.jsx(JWe,{}),variant:"ghost",colorScheme:ce?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:wt}),!ce&&S.jsx(xc,{icon:S.jsx(st,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),ce&&S.jsx(xc,{icon:S.jsx(XWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:ut}),S.jsx(xc,{icon:S.jsx(st,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(Ug,{borderColor:"whiteAlpha.300"}),S.jsxs(Rr,{align:"stretch",spacing:1,children:[ge&&S.jsxs(Bn,{p:1.5,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[S.jsx(Ke,{fontSize:"sm",children:"Edit Mode"}),S.jsx(oh,{id:"edit-mode-toggle",isChecked:ce,onChange:wt,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ce?"green.500":"black"}}})]}),ge&&S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:qe,children:"Manage Space"}),he&&e&&!Re&&S.jsx(CGe,{onClose:it}),S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ne,children:"Settings"}),S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:je,children:"Controls"}),S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),S.jsx(Ke,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),C&&S.jsx(RGe,{open:C,onClose:je}),v&&S.jsx(AGe,{open:v,onClose:Ne,containerRef:i}),N&&S.jsx($ae,{open:N,onClose:at}),S.jsx(WGe,{isOpen:D,onClose:qe}),S.jsx(KGe,{isOpen:z,onClose:_t,settings:{spaceID:e}})]})},YGe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=Io(),u=pc(),p=ja(),y=O.useRef(null),v=O.useRef(null),w=O.useRef(),[C,R]=O.useState(null),[N,M]=O.useState(""),[D,F]=O.useState(!1),[z,q]=O.useState(0),[K,re]=O.useState(null),[ce,se]=O.useState(!0),[ge,X]=O.useState(!1),[J,te]=O.useState(!1),[ne,de]=O.useState(0),[pe,he]=O.useState("image"),[ve,Te]=O.useState(""),[Fe,be]=O.useState(!1);O.useEffect(()=>{(async()=>{if(n&&i&&l){se(!0);try{const wt=await aE(l,i);if(wt&&(wt.imageUrl||wt.videoUrl)){re(wt);const $t=wt.mediaType==="video";he($t?"video":"image"),be(wt.displayAsVideo||!1),$t&&wt.videoUrl&&(Te(wt.videoUrl),de(1))}else re(null)}catch(wt){W.error("Error fetching existing image:",wt),re(null)}finally{se(!1)}}})()},[n,i,l]),O.useEffect(()=>{n||(R(null),M(""),q(0),Te(""))},[n]);const Re=O.useCallback(it=>{it.preventDefault(),it.stopPropagation(),te(!0)},[]),Ae=O.useCallback(it=>{it.preventDefault(),it.stopPropagation(),te(!1)},[]),xe=O.useCallback(it=>{it.preventDefault(),it.stopPropagation()},[]),Ee=O.useCallback(it=>{if(it.preventDefault(),it.stopPropagation(),te(!1),it.dataTransfer.files&&it.dataTransfer.files.length>0){const wt=it.dataTransfer.files[0];Ne(wt)}},[]);O.useEffect(()=>{const it=v.current;if(it)return it.addEventListener("dragenter",Re),it.addEventListener("dragleave",Ae),it.addEventListener("dragover",xe),it.addEventListener("drop",Ee),()=>{it.removeEventListener("dragenter",Re),it.removeEventListener("dragleave",Ae),it.removeEventListener("dragover",xe),it.removeEventListener("drop",Ee)}},[Re,Ae,xe,Ee]);const Ne=it=>{if(!it)return;if(!it.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}R(it);const wt=new FileReader;wt.onloadend=()=>{M(wt.result)},wt.readAsDataURL(it)},je=it=>{const wt=it.target.files[0];Ne(wt)},qe=async it=>{const wt=it.target.checked;if(be(wt),K)try{await RWe(l,i,wt),wt?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),re({...K,displayAsVideo:wt}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${wt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),W.log(`Updated display mode for media screen ${i} to ${wt?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:wt})}catch($t){W.error("Error updating display mode:",$t),p({title:"Update failed",description:$t.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),be(!wt)}},at=async()=>{if(pe==="image"&&!C){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!ve){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const it=setInterval(()=>{q(mt=>{const ct=mt+10;return ct>=90?90:ct})},300);let wt;pe==="image"?wt=await uZ(l,i,C,{mediaType:pe,displayAsVideo:Fe}):(wt=ve,await uZ(l,i,null,{mediaType:"video",directUrl:ve,displayAsVideo:Fe})),clearInterval(it),q(100);let $t=null,dt=null;pe==="image"?($t=Fe?null:wt,dt=(K==null?void 0:K.videoUrl)||null):($t=!Fe&&(K!=null&&K.imageUrl)?K.imageUrl:null,dt=wt),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$t,videoUrl:dt,mediaType:pe,displayAsVideo:Fe}),W.log(`Uploaded and sent ${pe} for media screen ${i} (display as video: ${Fe})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:pe==="image"?wt:K==null?void 0:K.imageUrl,videoUrl:pe==="video"?wt:K==null?void 0:K.videoUrl,mediaType:pe,displayAsVideo:Fe}),p({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{R(null),M(""),F(!1),q(0),e()},1e3)}catch(it){W.error(`Error uploading ${pe}:`,it),p({title:"Upload failed",description:it.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),F(!1),q(0)}},_t=async()=>{X(!1);try{F(!0),await CWe(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:pe==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:pe==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),W.log(`Deleted ${pe} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),p({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),re(null),F(!1),Te(""),be(!1),setTimeout(()=>{e()},500)}catch(it){W.error(`Error deleting ${pe}:`,it),p({title:"Deletion failed",description:it.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},ut=()=>{D||(R(null),M(""),q(0),e())},vt=it=>{de(it),he(it===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(us,{isOpen:n,onClose:ut,size:"lg",children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",color:"white",maxW:"650px",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Media Screen"}),S.jsx(Os,{isDisabled:D,color:"gray.400",_hover:{color:"white",bg:"rgba(255,255,255,0.1)"},borderRadius:"full",size:"sm",top:3,right:3}),S.jsxs(st,{px:4,pb:1,children:[S.jsxs(Mr,{justify:"space-between",align:"center",bg:"rgba(255,255,255,0.03)",p:2,borderRadius:"lg",mb:1,border:"1px solid rgba(255,255,255,0.08)",children:[S.jsxs(Bn,{spacing:2,children:[S.jsx(Ke,{fontWeight:"500",fontSize:"xs",color:"gray.300",children:"Display:"}),S.jsxs(Bn,{spacing:2,children:[S.jsx(yn,{as:Uy,color:Fe?"gray.500":"white",size:"sm"}),S.jsx(oh,{colorScheme:"gray",size:"sm",isChecked:Fe,onChange:qe}),S.jsx(yn,{as:$C,color:Fe?"white":"gray.500",size:"sm"})]})]}),S.jsx(ih,{bg:"rgba(255,255,255,0.1)",color:"gray.300",fontSize:"xs",px:2,py:1,borderRadius:"md",fontWeight:"500",children:Fe?"Video":"Image"})]}),S.jsxs(Ke,{fontSize:"xs",color:"gray.500",children:["ID: ",i]})]}),S.jsx(ys,{px:4,py:1,children:S.jsxs(Mr,{children:[S.jsx(k0,{orientation:"vertical",variant:"unstyled",index:ne,onChange:vt,h:"100%",minW:"75px",mr:3,children:S.jsxs(O0,{spacing:1,children:[S.jsxs(xa,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},mb:1,py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(yn,{as:Uy,mr:1.5,size:"sm"})," Image"]}),S.jsxs(xa,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(yn,{as:$C,mr:1.5,size:"sm"})," Video"]})]})}),S.jsx(st,{flex:"1",children:ce?S.jsx(Mr,{justify:"center",align:"center",h:"120px",children:S.jsx(cd,{size:"lg",color:"white"})}):S.jsxs(S.Fragment,{children:[S.jsx(st,{children:ne===0?S.jsxs(Rr,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&pe==="image"&&S.jsxs(st,{children:[S.jsx(Ke,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(Mr,{children:[S.jsx(st,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(bp,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(Rr,{align:"flex-start",spacing:2,children:[S.jsxs(Ke,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),S.jsxs(Ke,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),S.jsx(In,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(yn,{as:_0}),onClick:()=>X(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(Ug,{my:4})]}),S.jsx(Ke,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs(st,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.15)",bg:J?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",p:4,textAlign:"center",transition:"all 0.2s ease",_hover:{borderColor:"rgba(255,255,255,0.3)",bg:"rgba(255,255,255,0.06)"},cursor:"pointer",onClick:()=>y.current.click(),children:[N?S.jsx(st,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(bp,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(Rr,{spacing:2,children:[S.jsx(yn,{as:eO,boxSize:"20px",color:"gray.400"}),S.jsxs(Rr,{spacing:0,children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"500",color:"white",children:"Drop image or click to browse"}),S.jsx(Ke,{fontSize:"xs",color:"gray.500",children:"PNG, JPG, JPEG, GIF"})]})]}),S.jsx(ci,{type:"file",accept:"image/*",onChange:je,ref:y,display:"none"})]}),C&&S.jsxs(Ke,{fontSize:"xs",color:"gray.400",bg:"rgba(255,255,255,0.05)",p:2,borderRadius:"md",border:"1px solid rgba(255,255,255,0.1)",children:[C.name," (",Math.round(C.size/1024)," KB)"]})]}):S.jsxs(Rr,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&pe==="video"&&S.jsxs(st,{children:[S.jsx(Ke,{fontWeight:"500",mb:1,fontSize:"xs",color:"gray.400",children:"Current Video URL:"}),S.jsxs(Mr,{children:[S.jsx(st,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx(Ke,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),S.jsxs(Rr,{align:"flex-start",spacing:2,children:[S.jsxs(Ke,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),S.jsxs(Ke,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),S.jsx(In,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(yn,{as:_0}),onClick:()=>X(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(Ug,{my:4})]}),S.jsxs(Sr,{children:[S.jsx(gi,{fontSize:"xs",fontWeight:"500",color:"white",mb:1.5,children:"Video URL"}),S.jsx(ci,{placeholder:"https://youtube.com/watch?v=...",value:ve,onChange:it=>Te(it.target.value),bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},size:"sm",borderRadius:"lg",color:"white",fontSize:"xs",_placeholder:{color:"gray.500",fontSize:"xs"}})]}),ve&&S.jsxs(st,{mt:2,p:2,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:[S.jsxs(Bn,{mb:1,children:[S.jsx(yn,{as:NGe,color:"gray.400",size:"sm"}),S.jsx(Ke,{fontWeight:"500",fontSize:"xs",color:"white",children:"Preview"})]}),S.jsx(Ke,{fontSize:"xs",wordBreak:"break-all",color:"gray.400",children:ve})]})]})}),D&&S.jsxs(st,{mt:3,children:[S.jsxs(Ke,{mb:2,fontSize:"sm",fontWeight:"500",color:"white",children:["Uploading: ",z,"%"]}),S.jsx(qy,{value:z,colorScheme:"gray",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)"})]})]})})]})}),S.jsx(uh,{pt:2,pb:3,px:4,children:S.jsxs(Mr,{w:"full",gap:3,children:[S.jsx(In,{variant:"outline",flex:1,onClick:ut,isDisabled:D,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"500",children:"Cancel"}),S.jsx(In,{bg:"#6b7280",color:"white",flex:2,onClick:at,isLoading:D,loadingText:"Saving",isDisabled:pe==="image"&&!C||pe==="video"&&!ve||D||ce,leftIcon:S.jsx(yn,{as:pe==="image"?Uy:$C,size:"sm"}),_hover:{bg:"#4b5563"},_active:{bg:"#374151"},_disabled:{bg:"#374151",opacity:.5},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"600",children:pe==="image"?"Upload":"Save URL"})]})})]})]}),S.jsx(rUe,{isOpen:ge,leastDestructiveRef:w,onClose:()=>X(!1),children:S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",children:S.jsxs(iUe,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"350px",children:[S.jsxs(fo,{fontSize:"md",fontWeight:"600",pt:4,pb:2,color:"white",children:["Delete ",pe==="video"?"Video":"Image"]}),S.jsx(ys,{py:2,color:"gray.400",fontSize:"sm",children:"Are you sure? This will revert the media screen to its blank state."}),S.jsx(uh,{pt:3,pb:4,children:S.jsxs(Mr,{w:"full",gap:2,children:[S.jsx(In,{ref:w,onClick:()=>X(!1),variant:"outline",flex:1,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)"},borderRadius:"lg",size:"sm",fontSize:"sm",children:"Cancel"}),S.jsx(In,{bg:"#dc2626",color:"white",onClick:_t,flex:1,leftIcon:S.jsx(yn,{as:_0,size:"sm"}),_hover:{bg:"#b91c1c"},borderRadius:"lg",fontWeight:"600",size:"sm",fontSize:"sm",children:"Delete"})]})})]})})})]})},XGe=n=>{const[e,i]=O.useState(null),[o,l]=O.useState(""),[u,p]=O.useState(null),[y,v]=O.useState(!1),w=Uc(),{spaceID:C}=Io(),R=O.useCallback(D=>{var F,z;try{if(!D)return null;if(D.includes("youtube.com")||D.includes("youtu.be")){let q="";return D.includes("youtube.com/watch")?q=new URLSearchParams(new URL(D).search).get("v"):D.includes("youtu.be/")&&(q=D.split("youtu.be/")[1].split("?")[0]),q?`https://www.youtube.com/embed/${q}?autoplay=1`:D}if(D.includes("vimeo.com")){if(D.includes("player.vimeo.com/video"))return D;const q=(z=(F=D.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:z.split("/")[0];return q?`https://player.vimeo.com/video/${q}?autoplay=1`:D}return D}catch(q){return W.error("Error converting to embed URL:",q),D}},[]),N=O.useCallback(()=>{setTimeout(()=>{v(!1),W.log("Video processing state reset")},100)},[]);O.useEffect(()=>{let D=!0,F=null;const q=w("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:re,videoUrl:ce}=K||{};if(!re){W.error("Media screen ID is missing in Unity event data."),N();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${re}, setting ID but not playing video`),W.log("Edit mode is active, setting media screen ID but not playing video"),p(re);return}if(v(!0),F=setTimeout(()=>{D&&(W.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),D)try{const se=R(ce);console.log(`Setting video URL to: ${se} (original: ${ce})`),i(se),l(`Media Screen ${re}`),p(re),W.log("Media screen video URL set directly from event:",se)}catch(se){W.error("Error setting video URL from direct URL:",se)}finally{N(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${re}`);try{const se=await aE(C,re);if(console.log("Media screen data from Firestore:",se),!se||!se.videoUrl){W.error("No video URL found for media screen:",re),N(),clearTimeout(F);return}if(!se.displayAsVideo){W.log("Media screen is not set to display as video:",re),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(F);return}if(D)try{const ge=R(se.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${se.videoUrl})`);const X=se.title||`Media Screen ${re}`;i(ge),l(X),p(re),W.log("Media screen video URL set to:",ge)}catch(ge){W.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(F)}}catch(se){W.error(`Error fetching media screen data for ${re}:`,se),N(),clearTimeout(F)}}catch(re){W.error("Error handling media screen video play:",re),console.error("Error handling media screen video play:",re),N(),clearTimeout(F)}});return()=>{D=!1,F&&clearTimeout(F),q()}},[w,C,n,R,N]);const M=O.useCallback(()=>{i(null),l(""),p(null),v(!1),W.log("Video player state reset")},[]);return[e,o,u,M,y]},JGe=()=>{const{spaceID:n}=Io(),e=pc(),i=Uc(),[o,l]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){W.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const w=()=>{W.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",w),()=>{window.removeEventListener("PlayerInstantiated",w)}},[]);const u=O.useCallback(async w=>{try{return w.includes("vimeo.com")?await p(w):w.includes("youtube.com")||w.includes("youtu.be")?await y(w):"https://via.placeholder.com/640x360?text=Video"}catch(C){return W.error(`Error fetching thumbnail for ${w}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async w=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(w)}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${R.statusText}`);const N=await R.json(),M=N.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let F=null;for(let z of D){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch(K){W.warn(`Failed to validate thumbnail URL: ${q}`,K)}}return F||N.thumbnail_url}catch(C){return W.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async w=>{let C="";if(w.includes("youtube.com/watch")?C=new URLSearchParams(new URL(w).search).get("v"):w.includes("youtu.be/")&&(C=w.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const R=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(R,{method:"HEAD"})).ok)return R}catch(N){W.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,N)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},v=O.useCallback(async w=>{try{if(!n||!w)return;W.log(`Refreshing thumbnail for media screen ${w}`);const C=await aE(n,w);if(!C){W.log(`No media screen found with ID ${w}`);return}if(W.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){W.log(`Media screen ${w} is not set to display as video or has no video URL`);return}const R=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:w,thumbnailUrl:R}),W.log(`Sent refreshed thumbnail for media screen ${w}: ${R}`)}catch(C){W.error(`Error refreshing thumbnail for media screen ${w}:`,C)}},[n,u,e]);O.useEffect(()=>{if(!o){W.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}W.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async R=>{try{const{mediaScreenId:N,thumbnailUrl:M}=R;M==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{C()}},[i,v,o]),O.useEffect(()=>{if(!o){W.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}W.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const w=async()=>{try{if(!n)throw new Error("spaceID is not defined.");W.log("Fetching media screens for thumbnails...");const R=await X3(n);W.log("All media screens:",R);const N=R.filter(F=>F.displayAsVideo&&F.videoUrl);if(W.log("Media screens set to display as videos:",N),N.length===0){W.log("No media screens set to display as videos found.");return}W.log(`Found ${N.length} media screens set to display as videos.`);const M=N.map(async F=>{try{const z=await u(F.videoUrl);return W.log(`Fetched thumbnail for ${F.id}: ${z}`),{mediaScreenId:F.id,thumbnailUrl:z}}catch(z){return W.error(`Error processing thumbnail for media screen ${F.id}:`,z),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),D=await Promise.all(M);W.log("Fetched Media Screen Thumbnails",D),D.forEach(({mediaScreenId:F,thumbnailUrl:z})=>{e("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:z}),W.log(`Sent thumbnail to Unity for media screen ${F}: ${z}`)})}catch(R){W.error("Error fetching media screen thumbnails:",R)}};w();const C=setInterval(w,5*60*1e3);return()=>{clearInterval(C)}},[e,n,u,o])},wZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},QGe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),ZGe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=fh();return sx(o,`video-modal-${i}`),O.useEffect(()=>{if(o){const p=w=>{w.target.classList&&w.target.classList.contains("chakra-modal__overlay")&&(w.stopPropagation(),w.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(w){console.error("Error disabling Unity input:",w)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(w){console.error("Error re-enabling Unity input:",w)}}}},[o]),S.jsxs(S.Fragment,{children:[S.jsx(QGe,{}),S.jsxs(us,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(ds,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx(Os,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(ys,{p:0,width:"100%",children:n?S.jsx(st,{className:"iframe-container",style:wZ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:wZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(Mr,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(cd,{size:"xl",mb:4}),S.jsx(Ke,{children:"Unable to load video"}),S.jsx(Ke,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},e9e=5e3,t9e=n=>{if(!(n!=null&&n.includes("firebasestorage.googleapis.com")))return n;try{const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},n9e=()=>{const{isOpen:n,onOpen:e,onClose:i}=sd(),[o,l]=O.useState(null),[u,p]=O.useState("image"),y=O.useRef(null);sx(n,"image-viewer-modal");const v=O.useCallback(R=>R.stopPropagation(),[]);return O.useEffect(()=>{if(!n||!y.current)return;const R=y.current,N=document.getElementById("unity-canvas"),M=["mousemove","mousedown","mouseup","wheel"];return M.forEach(D=>R.addEventListener(D,v)),N&&(N.style.pointerEvents="none"),()=>{M.forEach(D=>R.removeEventListener(D,v)),N&&(N.style.pointerEvents="auto")}},[n,v]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(R,N="image")=>{const M=typeof R=="string"&&(R.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||R.includes("firebasestorage")&&!R.includes("video"));l(R),p(M?"image":N),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:y,preventPropagation:v}},r9e=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
      body.unity-input-disabled #unity-container,
      body.unity-input-disabled #unity-canvas { pointer-events: none !important; }
      .image-viewer-modal-content,
      .chakra-modal__overlay { pointer-events: auto !important; }
    `}}),i9e=()=>{const[n,e]=O.useState([]),[i,o]=O.useState(!1),[l,u]=O.useState(null),[p,y]=O.useState(!1),v=O.useCallback((C,R)=>{e(N=>Array.isArray(N)&&N.some(D=>D.mediaScreenId===C)?N.map(D=>D.mediaScreenId===C?{...D,...R,lastUpdated:new Date().toISOString()}:D):[...Array.isArray(N)?N:[],{mediaScreenId:C,...R,firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},[]),w=O.useCallback(C=>Array.isArray(n)?n.find(R=>R.mediaScreenId===C):null,[n]);return{mediaScreens:n,setMediaScreens:e,isEditMode:i,setIsEditMode:o,selectedScreen:l,setSelectedScreen:u,unityReady:p,setUnityReady:y,updateMediaScreen:v,getScreenData:w}},s9e=()=>{const{spaceID:n}=Io(),{isOpen:e,onOpen:i,onClose:o}=sd(),l=pc(),{fullscreenRef:u}=fh(),p=Uc(),{trackReactEvent:y}=_E(n),{setMediaScreens:v,isEditMode:w,setIsEditMode:C,selectedScreen:R,setSelectedScreen:N,unityReady:M,setUnityReady:D,updateMediaScreen:F,getScreenData:z}=i9e(),{isOpen:q,currentImageUrl:K,currentMediaType:re,openImageViewer:ce,closeImageViewer:se,modalContentRef:ge,preventPropagation:X}=n9e(),[J,te,ne,de,pe]=XGe(w),{isOpen:he,onOpen:ve,onClose:Te}=sd();JGe(),Dae(),O.useEffect(()=>{if(window.isPlayerInstantiated){D(!0);return}const xe=()=>D(!0);return window.addEventListener("PlayerInstantiated",xe),()=>window.removeEventListener("PlayerInstantiated",xe)},[D]);const Fe=O.useCallback(async xe=>{const Ee=z(xe);if(Ee)return{screen:Ee,imageUrl:Ee.imageUrl,videoUrl:Ee.videoUrl,mediaType:Ee.mediaType||"image",displayAsVideo:Ee.displayAsVideo||!1};if(K)return{screen:{mediaScreenId:xe},imageUrl:K,videoUrl:null,mediaType:"image",displayAsVideo:!1};if(n&&xe)try{const Ne=await aE(n,xe);if(Ne)return F(xe,{...Ne,hasImage:!!Ne.imageUrl,source:"firestore-fetch"}),{screen:Ne,imageUrl:Ne.imageUrl,videoUrl:Ne.videoUrl,mediaType:Ne.mediaType||"image",displayAsVideo:Ne.displayAsVideo||!1}}catch(Ne){console.error(`Error fetching media screen data for ${xe}:`,Ne)}return null},[z,K,n,F]),be=O.useCallback(async xe=>{if(N(xe),w){i();return}if(he&&ne===xe)return;const Ee=await Fe(xe);if(Ee){if(Ee.displayAsVideo&&Ee.videoUrl)l("PlayMediaScreenVideo",{mediaScreenId:xe,videoUrl:Ee.videoUrl});else if(Ee.imageUrl){const Ne=t9e(Ee.imageUrl);ce(Ne,Ee.mediaType||"image")}}},[w,i,he,ne,Fe,l,ce]);O.useEffect(()=>{if(!M||!n)return;const xe=async()=>{try{const Ee=await X3(n),Ne={};Ee.forEach(je=>{je.id&&je.imageUrl&&(Ne[je.id]=je.imageUrl)}),v(je=>je.map(qe=>({...qe,hasImage:!!Ne[qe.mediaScreenId],imageUrl:Ne[qe.mediaScreenId],mediaType:qe.mediaType||"image"})))}catch(Ee){console.error("Error fetching media screen images:",Ee)}};if(xe(),w){const Ee=setInterval(xe,e9e);return()=>clearInterval(Ee)}},[n,w,M,v]);const Re=O.useCallback(xe=>{const{mediaScreenId:Ee,type:Ne,imageUrl:je,mediaType:qe}=xe;Ne==="upload"?F(Ee,{hasImage:!0,imageUrl:je,mediaType:qe||"image"}):Ne==="delete"&&setTimeout(()=>{v(at=>at.filter(_t=>_t.mediaScreenId!==Ee))},100)},[F,v]);O.useEffect(()=>{const xe=Ee=>{const Ne=Ee.detail.enabled;C(Ne),l("SetMediaScreenEditMode",{enabled:Ne,showUploadIcon:Ne})};return window.addEventListener("editModeChanged",xe),()=>window.removeEventListener("editModeChanged",xe)},[l,C]),O.useEffect(()=>(window.JsSendMediaScreenClick=xe=>{try{const Ee=JSON.parse(xe);window.dispatchEvent(new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ee)}))}catch(Ee){console.error("Error processing MediaScreenClick data:",Ee)}},window.handleMediaScreenClick=xe=>{be(xe)},window.TestJavaScriptFromUnity=xe=>{console.log("Unity called JavaScript:",xe)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[be]),O.useEffect(()=>{const xe=qe=>{try{const at=JSON.parse(qe.detail);F(at.mediaScreenId,{...at,source:"event"}),w&&l("SetMediaScreenEditMode",{mediaScreenId:at.mediaScreenId,enabled:!0,showUploadIcon:!0}),n&&at.mediaScreenId&&aE(n,at.mediaScreenId).then(_t=>{_t!=null&&_t.displayAsVideo&&(_t!=null&&_t.videoUrl)&&l("SetMediaScreenImage",{mediaScreenId:at.mediaScreenId,imageUrl:null,displayAsVideo:!0})}).catch(_t=>console.error("Error fetching media screen data:",_t))}catch(at){console.error("Error handling MediaScreen registration:",at)}},Ee=qe=>{try{let at;typeof qe=="string"?at=qe:at=JSON.parse(qe.detail).mediaScreenId,be(at)}catch(at){console.error("Error handling MediaScreen click:",at)}},je=[["RegisterMediaScreen",xe],["MediaScreenClick",Ee],["reactUnityEvent",qe=>{const{eventName:at,eventData:_t}=qe.detail||{};switch(at){case"RegisterMediaScreen":xe({detail:_t});break;case"MediaScreenClick":Ee({detail:_t});break;case"SetMediaScreenImage":try{const ut=JSON.parse(_t);ut.mediaScreenId&&F(ut.mediaScreenId,{imageUrl:ut.imageUrl,hasImage:!!ut.imageUrl,displayAsVideo:ut.displayAsVideo||!1,source:"set-media-screen-image"})}catch(ut){console.error("Error handling SetMediaScreenImage event:",ut)}break}}]];return je.forEach(([qe,at])=>window.addEventListener(qe,at)),()=>{je.forEach(([qe,at])=>window.removeEventListener(qe,at))}},[w,l,n,F,be]),O.useEffect(()=>{J&&(ve(),y(co.REACT.VIDEO_CLICK,{mediaScreenId:ne,videoUrl:J,videoTitle:te,source:"media_screen_controller",trigger:"video_modal_open"}))},[J,ve,y,ne,te]);const Ae=O.useCallback(()=>{de(),Te()},[de,Te]);return O.useEffect(()=>{const Ee=p("RegisterMediaScreen",je=>{je!=null&&je.mediaScreenId&&(F(je.mediaScreenId,{...je,source:"direct-event"}),w&&l("SetMediaScreenEditMode",{mediaScreenId:je.mediaScreenId,enabled:!0,showUploadIcon:!0}))}),Ne=p("MediaScreenClick",je=>{je!=null&&je.mediaScreenId&&be(je.mediaScreenId)});return()=>{Ee(),Ne()}},[p,w,l,F,be]),O.useEffect(()=>{w&&ne&&(N(ne),i(),de())},[w,ne,i,de,N]),S.jsxs(S.Fragment,{children:[S.jsx(YGe,{isOpen:e,onClose:o,mediaScreenId:R,onImageChange:Re}),S.jsx(r9e,{}),S.jsx(Mc,{containerRef:u,children:S.jsxs(us,{isOpen:q,onClose:se,size:"lg",isCentered:!0,portalProps:{containerRef:u},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X}),S.jsxs(ds,{ref:ge,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[S.jsx(Os,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(ys,{p:0,width:"100%",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:K?S.jsx(st,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:re==="image"?S.jsx(bp,{src:K,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",K),onError:xe=>console.error("Error loading image:",xe,K),onClick:X}):S.jsxs(st,{width:"100%",textAlign:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[S.jsx(Ke,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx(Ke,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:K}),S.jsx(Ke,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(Mr,{direction:"column",align:"center",justify:"center",h:"400px",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:S.jsx(Ke,{children:"No image available"})})})]})]})}),S.jsx(ZGe,{videoUrl:J,videoTitle:te,mediaScreenId:ne,isOpen:he,onClose:Ae})]})},tce=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=O.useState(!1),[u,p]=O.useState(n),[y,v]=O.useState(e),w=O.useRef(null),C=O.useRef(null),R=O.useRef(null),N=O.useRef(!1),M=O.useRef(!1);O.useEffect(()=>{if(!(N.current||M.current)){if(M.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),F(e),N.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),z(n),N.current=!0;return}D()}},[n,e]),O.useEffect(()=>{const re=ce=>{const{videoBackgroundUrl:se}=ce.detail;console.log(` PersistentBackground: Received video background update event: ${se}`),se&&!N.current&&(F(se),N.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",re),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",re)}},[]);const D=()=>{const ce=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ce||!ce[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const se=ce[1];console.log(` PersistentBackground: Found space ID: ${se}`),Ua(se).then(ge=>{if(console.log(` PersistentBackground: Retrieved space data for ${se}:`,ge?"success":"null"),ge&&ge.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${ge.videoBackgroundUrl}`),F(ge.videoBackgroundUrl),N.current=!0;else if(ge&&(ge.backgroundUrl||ge.backgroundGsUrl)){const X=ge.backgroundUrl||ge.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${X}`),z(X),N.current=!0}}).catch(ge=>{console.error(" PersistentBackground: Error fetching space data:",ge)})},F=re=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${re}`),K();const ce=document.createElement("video");R.current=ce,ce.autoplay=!0,ce.loop=!0,ce.muted=!0,ce.playsInline=!0,ce.setAttribute("playsinline",""),ce.setAttribute("webkit-playsinline",""),ce.setAttribute("preload","auto"),ce.src=re,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),q(),ce.load();try{ce.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(se=>{console.warn(" First video play attempt failed:",se);const ge=()=>{ce.play().then(()=>console.log(" Video started after user interaction")).catch(X=>console.error(" Video still failed to play:",X))};window.addEventListener("click",ge,{once:!0}),window.addEventListener("touchstart",ge,{once:!0}),setTimeout(()=>{ce.play().then(()=>console.log(" Video started after timeout")).catch(X=>console.error(" Video still failed to play after timeout:",X))},1e3)})}catch(se){console.error(" Error attempting to play video:",se)}},z=re=>{if(!i||!i.current||!re)return;console.log(` PersistentBackground: Setting up image background: ${re}`);const ce=document.createElement("div");w.current=ce,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${re}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),q()},q=()=>{if(!i||!i.current)return;const re=document.createElement("div");C.current=re,Object.assign(re.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(re)},K=()=>{!i||!i.current||(w.current&&i.current.contains(w.current)&&(i.current.removeChild(w.current),w.current=null),R.current&&i.current.contains(R.current)&&(R.current.pause(),R.current.src="",R.current.load(),i.current.removeChild(R.current),R.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return O.useEffect(()=>{if(!i||!i.current)return;const re=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),w.current&&(w.current.style.opacity="0"),R.current&&(R.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),re();return}lh.subscribe(ch.playerInstantiated,re),window.addEventListener("PlayerInstantiated",re);const ce=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),re()},3e4);return()=>{lh.unsubscribe(ch.playerInstantiated,re),window.removeEventListener("PlayerInstantiated",re),clearTimeout(ce),K()}},[i]),null};tce.propTypes={backgroundUrl:Tn.string,videoBackgroundUrl:Tn.string,containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const TZ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",nce=({containerRef:n})=>{const{spaceID:e}=Io(),{isUserBannedFromSpace:i}=O.useContext(ts),[o,l]=O.useState(!1),[u,p]=O.useState(!1),[y,v]=O.useState(!1),[w,C]=O.useState(0),[R,N]=O.useState("Initialising World"),[M,D]=O.useState(null),F=O.useRef(null),z=O.useRef(null),q=O.useRef(null),K=O.useRef(null),re=O.useRef(null),ce=O.useRef(null);O.useEffect(()=>(W.log("PersistentLoader: Component mounted with spaceID:",e),W.log("PersistentLoader: Container ref:",n),()=>{W.log("PersistentLoader: Component unmounting")}),[]);const{error:se}=Io(),[ge,X]=O.useState(!1);return O.useEffect(()=>{se&&(W.error("PersistentLoader: Unity error detected:",se),X(!0),setTimeout(()=>{if(F.current){const J=F.current.querySelector("div:first-child");J&&(J.textContent="Reconnecting...")}},3e3))},[se]),O.useEffect(()=>{(async()=>{if(e){W.log(`PersistentLoader: Fetching logo for space ${e}`);try{const te=await Ua(e);te&&te.logoUrl?(W.log(`PersistentLoader: Found logo URL: ${te.logoUrl}`),D(te.logoUrl)):W.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(te){W.error("PersistentLoader: Error fetching space logo:",te)}}else W.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),O.useEffect(()=>{const J=te=>{const{logoUrl:ne}=te.detail;W.log(`PersistentLoader: Logo update event received with URL: ${ne}`),D(ne),z.current?ne?(W.log("PersistentLoader: Updating logo element with new URL"),z.current.src=ne,q.current.style.display="flex"):(W.log("PersistentLoader: Hiding logo element (no URL)"),q.current.style.display="none"):W.warn("PersistentLoader: Logo ref is null during update")};return W.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",J),()=>{W.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",J)}},[]),O.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&(W.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(te){W.error("PersistentLoader: error checking ban status",te)}})()},[e,i]),O.useEffect(()=>{if(!n||!n.current){W.error("PersistentLoader: Container ref missing");return}if(o){const xe=document.createElement("div");return Object.assign(xe.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),xe.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(xe),()=>{n.current.removeChild(xe)}}W.log("PersistentLoader: Creating loader elements");const J=document.createElement("div");if(F.current=J,Object.assign(J.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),M){W.log(`PersistentLoader: Creating logo element with URL: ${M}`);const xe=document.createElement("div");q.current=xe,Object.assign(xe.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const Ee=document.createElement("img");z.current=Ee,Ee.src=M,Ee.alt="Space Logo",Ee.style.maxHeight="100px",Ee.style.maxWidth="100%",Ee.style.objectFit="contain",Ee.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",xe.appendChild(Ee),n.current.appendChild(xe),W.log("PersistentLoader: Logo container added to main container")}else W.log("PersistentLoader: No logo URL available, skipping logo creation");const te=document.createElement("style");te.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(te),W.log("PersistentLoader: Animation styles added to document head");const ne=document.createElement("div");ne.style.fontSize="16px",ne.style.fontWeight="bold",ne.style.textAlign="center",ne.style.marginBottom="16px",ne.style.color="#ffffff",ne.textContent="Initialising World";const de=document.createElement("div");de.style.width="240px",de.style.height="100px",de.style.position="relative",de.style.marginBottom="15px",de.style.padding="0px",de.style.overflow="hidden",de.style.boxSizing="border-box",de.style.transition="opacity 0.8s ease-in-out",de.style.opacity="0";const pe=document.createElement("div");pe.style.width="100%",pe.style.height="100%",pe.style.position="absolute",pe.style.top="0",pe.style.left="0",pe.style.maskImage=`url(${TZ})`,pe.style.maskSize="contain",pe.style.maskPosition="center",pe.style.maskRepeat="no-repeat",pe.style.webkitMaskImage=`url(${TZ})`,pe.style.webkitMaskSize="contain",pe.style.webkitMaskPosition="center",pe.style.webkitMaskRepeat="no-repeat",pe.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",pe.style.backgroundSize="100% 100%",pe.style.transition="background 0.5s ease-out",K.current=pe,re.current=null,de.appendChild(pe);const he=document.createElement("div");he.style.marginTop="8px",he.style.fontSize="14px",he.style.fontWeight="bold",he.style.color="#ffffff",he.textContent="0%",J.appendChild(ne),J.appendChild(de),J.appendChild(he),n.current.appendChild(J),W.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{q.current&&(q.current.style.opacity="1"),J.style.opacity="1",de.style.opacity="1"},500);const ve=xe=>{C(xe);const Ee=Math.round(xe*100),Ne=`linear-gradient(to right, #4facfe 0%, #00f2fe ${Ee}%, white ${Ee}%, white 100%)`;pe.style.background=Ne,he.textContent=`${Ee}%`,W.log(`PersistentLoader: Progress updated to ${Ee}%`)},Te=xe=>{N(xe),ne.textContent=xe,W.log(`PersistentLoader: Loading stage updated to "${xe}"`)},Fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ge&&(Fe[0].stage="Connecting to Space",Fe[1].stage="Reconnecting...",Fe[2].stage="Please Wait"),Te(Fe[0].stage),ve(.25);const be=xe=>{const Ee=xe.detail.progress;W.log(`PersistentLoader: Progress event received with value: ${Ee}`),ve(Ee),Ee<.33?Te(Fe[0].stage):Ee<.66?Te(Fe[1].stage):Te(Fe[2].stage)},Re=()=>{W.log("PersistentLoader: First scene loaded event received"),p(!0),Te(Fe[1].stage),ve(.66)},Ae=()=>{if(W.log("PersistentLoader: Player instantiated event received"),ce.current&&(clearInterval(ce.current),W.log("PersistentLoader: Progress interval cleared")),v(!0),Te(Fe[2].stage),ve(1),ge){W.log("PersistentLoader: Keeping loader visible due to Unity error");return}J.style.transition="all 0.5s ease-in-out",de.style.transition="opacity 1.2s ease-in-out",ne.style.transition="opacity 0.4s ease-in-out",he.style.transition="opacity 0.4s ease-in-out",q.current&&(q.current.style.transition="opacity 0.5s ease-in-out"),J.style.backgroundColor="rgba(0, 0, 0, 0)",J.style.backdropFilter="blur(0px)",J.style.WebkitBackdropFilter="blur(0px)",J.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",J.style.border="1px solid rgba(255, 255, 255, 0)",ne.style.opacity="0",he.style.opacity="0",q.current&&(q.current.style.opacity="0"),setTimeout(()=>{de.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(J)?(n.current.removeChild(J),W.log("PersistentLoader: Loader element removed after fade")):W.warn("PersistentLoader: Could not remove loader element (not found in container)"),q.current&&n.current&&n.current.contains(q.current)?(n.current.removeChild(q.current),W.log("PersistentLoader: Logo container removed after fade")):q.current&&W.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)W.log("PersistentLoader: Player was already instantiated"),Ae();else{W.log("PersistentLoader: Subscribing to playerInstantiated event"),lh.subscribe(ch.playerInstantiated,Ae);const xe=()=>Ae();W.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",xe),W.log("PersistentLoader: Adding firstSceneLoaded event listener"),lh.subscribe(ch.firstSceneLoaded,Re),W.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",be),ce.current=setInterval(()=>{y||C(Ne=>{const je=Math.min(Ne+.02,.95);return ve(je),je<.33&&R!==Fe[0].stage?Te(Fe[0].stage):je>=.33&&je<.66&&R!==Fe[1].stage?Te(Fe[1].stage):je>=.66&&R!==Fe[2].stage&&Te(Fe[2].stage),je})},300);const Ee=setTimeout(()=>{W.log("PersistentLoader: Forcing loader removal after timeout"),Ae()},6e4);return()=>{W.log("PersistentLoader: Cleaning up event listeners"),lh.unsubscribe(ch.playerInstantiated,Ae),window.removeEventListener("PlayerInstantiated",xe),lh.unsubscribe(ch.firstSceneLoaded,Re),window.removeEventListener("UnityProgress",be),clearInterval(ce.current),clearTimeout(Ee),n.current&&n.current.contains(J)&&(n.current.removeChild(J),W.log("PersistentLoader: Loader element removed during cleanup")),q.current&&n.current&&n.current.contains(q.current)&&(n.current.removeChild(q.current),W.log("PersistentLoader: Logo container removed during cleanup"))}}},[M,n]),null};nce.propTypes={containerRef:Tn.shape({current:Tn.instanceOf(Element)})};const o9e=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=O.useState(!1),[u,p]=O.useState(!1),{savedStreamData:y,reloadStreamData:v}=xae(),{spaceID:w}=Io(),{user:C}=O.useContext(ts),R=ja(),[N,M]=O.useState(!1),D=_q((y==null?void 0:y.rtmpUrl)||""),F=_q((y==null?void 0:y.streamKey)||"");O.useEffect(()=>{if(w){W.log("LiveStreamButton: Forcing reload of stream data"),v();const K=()=>{W.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[w,v]),O.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!w){M(!1);return}try{const re=await G6e(C.uid,"disruptiveAdmin"),ce=await Y6e(C,w);M(re||ce)}catch(re){W.error("Error checking user permissions:",re),M(!1)}})()},[C==null?void 0:C.uid,w]),O.useEffect(()=>{W.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:N,isPlayerReady:u})},[y,N,u]),O.useEffect(()=>{const K=()=>{W.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(W.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},q=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!N||(y==null?void 0:y.enabled)!==!0?(W.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!N,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:"Live Stream Info",placement:e,hasArrow:!0,children:S.jsx(yl,{size:n,borderRadius:"full",bg:"black",icon:S.jsx(aGe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),S.jsxs(us,{isOpen:o,onClose:q,isCentered:!0,size:"md",children:[S.jsx(hs,{backdropFilter:"blur(4px)"}),S.jsxs(ds,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[S.jsx(fo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),S.jsx(Os,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(ys,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?S.jsxs(st,{children:[S.jsx(Ke,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),S.jsxs(st,{mb:4,children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),S.jsx(Mr,{children:S.jsxs(Pg,{size:"sm",children:[S.jsx(ci,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),S.jsx(fO,{children:S.jsx(xc,{"aria-label":"Copy RTMP URL",icon:D.hasCopied?S.jsx(pZ,{}):S.jsx(fZ,{}),size:"xs",colorScheme:D.hasCopied?"green":"blue",onClick:()=>{D.onCopy(),R({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsxs(st,{mb:4,children:[S.jsx(Ke,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),S.jsx(Mr,{children:S.jsxs(Pg,{size:"sm",children:[S.jsx(ci,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),S.jsx(fO,{children:S.jsx(xc,{"aria-label":"Copy Stream Key",icon:F.hasCopied?S.jsx(pZ,{}):S.jsx(fZ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),R({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsx(Ke,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):S.jsxs(st,{textAlign:"center",p:4,children:[S.jsx(Ke,{color:"white",children:"No stream configuration found for this space."}),S.jsx(Ke,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})};function a9e(n,e,i){const o=O.useRef();O.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const c9e=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=O.useState({x:0,y:1.5,z:0}),[y,v]=O.useState({x:0,y:0,z:0}),[w,C]=O.useState({x:1,y:1,z:1}),R=pc(),N=ja();O.useEffect(()=>{i&&(p(i.position||{x:0,y:1.5,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),O.useEffect(()=>{R("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:y,scale:w})},[u,y,w,i.portalId,R]),a9e(()=>{const D={...i,position:u,rotation:y,scale:w};SZ(o,i.portalId,D)},300,[u,y,w,o,i.portalId]);const M=async()=>{try{if(R("DeletePortal",{portalId:i.portalId}),await SZ(o,i.portalId,null))N({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{N({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(st,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(st,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(Sr,{children:[S.jsx(gi,{children:"Position"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:u.x,onChange:(D,F)=>p(z=>({...z,x:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:u.y,onChange:(D,F)=>p(z=>({...z,y:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:u.z,onChange:(D,F)=>p(z=>({...z,z:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{children:"Rotation"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:y.x,onChange:(D,F)=>v(z=>({...z,x:F})),step:1,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:y.y,onChange:(D,F)=>v(z=>({...z,y:F})),step:1,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:y.z,onChange:(D,F)=>v(z=>({...z,z:F})),step:1,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{children:"Scale"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:w.x,onChange:(D,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:w.y,onChange:(D,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:w.z,onChange:(D,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsx(Bn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(In,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Portal"})}),S.jsx(In,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},l9e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},u9e=()=>{const{spaceID:n}=Io(),e=pc(),[i,o]=O.useState(!1);O.useEffect(()=>{if(window.isPlayerInstantiated){W.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{W.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),O.useEffect(()=>{if(!i){W.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}W.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=bl(Xn,"spaces",n,"portals"),p=await id(u);if(p.empty){W.log("useUnityPortalImages: No portals found for space:",n);return}W.log(`useUnityPortalImages: Found ${p.size} portals for space ${n}`);for(const y of p.docs){const v=y.data(),w=v.portalId,C=v.targetSpaceId;if(!C){W.warn(`useUnityPortalImages: No target space ID found for portal: ${w}`);continue}const R=await Ua(C);if(!R){W.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const N=R.backgroundUrl||R.backgroundGsUrl;if(!N){W.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const M=l9e(N);e("SetPortalImage",JSON.stringify({portalId:w,imageUrl:M})),W.log(`Sent portal image data to Unity for portal ${w}: ${M}`)}}catch(u){W.error("Error fetching portal images:",u)}})()},[e,n,i])},d9e=()=>(u9e(),null);function h9e(n,e,i){const o=O.useRef();O.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const p9e=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,p]=O.useState({x:0,y:0,z:0}),[y,v]=O.useState({x:0,y:0,z:0}),[w,C]=O.useState({x:1,y:1,z:1}),R=pc(),N=ja();O.useEffect(()=>{i&&(p(i.position||{x:0,y:0,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),O.useEffect(()=>{R("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:y,scale:w})},[u,y,w,i.hotspotId,R]),h9e(()=>{const D=br(Xn,"spaces",o,"catalogue",i.hotspotId);mo(D,{position:u,rotation:y,scale:w,updatedAt:Date.now()})},300,[u,y,w,o,i.hotspotId]);const M=async()=>{try{R("DeleteCatalogueItem",{hotspotId:i.hotspotId});const D=br(Xn,"spaces",o,"catalogue",i.hotspotId);await mo(D,{deleted:!0}),N({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{N({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(st,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(st,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(Sr,{children:[S.jsx(gi,{children:"Position"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:u.x,onChange:(D,F)=>p(z=>({...z,x:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:u.y,onChange:(D,F)=>p(z=>({...z,y:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:u.z,onChange:(D,F)=>p(z=>({...z,z:F})),step:.1,precision:2,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{children:"Rotation"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:y.x,onChange:(D,F)=>v(z=>({...z,x:F})),step:1,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:y.y,onChange:(D,F)=>v(z=>({...z,y:F})),step:1,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:y.z,onChange:(D,F)=>v(z=>({...z,z:F})),step:1,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsxs(Sr,{children:[S.jsx(gi,{children:"Scale"}),S.jsxs(Bn,{children:[S.jsxs(jo,{value:w.x,onChange:(D,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"X"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:w.y,onChange:(D,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"Y"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]}),S.jsxs(jo,{value:w.z,onChange:(D,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[S.jsx(zo,{placeholder:"Z"}),S.jsxs(Bo,{children:[S.jsx(Go,{}),S.jsx(Wo,{})]})]})]})]}),S.jsx(Bn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(In,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Item"})}),S.jsx(In,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function f9e(){const{clickedItem:n,clearClickedItem:e}=Fae(),[i,o]=O.useState(!1);O.useEffect(()=>{const p=y=>{y!=null&&y.detail&&typeof y.detail.enabled=="boolean"&&(o(y.detail.enabled),y.detail.enabled||e())};return window.addEventListener("editModeChanged",p),()=>window.removeEventListener("editModeChanged",p)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const p=n.hotspotId.split("_");p.length>=3&&(u=p.slice(1,-1).join("_"))}return S.jsx(S.Fragment,{children:n&&i&&S.jsx(p9e,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const m9e=(n,e={})=>{const{user:i}=O.useContext(ts),{trackUnityEvent:o,isReady:l}=_E(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=Uc();return O.useEffect(()=>{if(!l||!i)return;W.log(" Unity Analytics: Setting up event listeners");const p=u("PlayVideo",D=>{W.log(" Unity Analytics: Video play event detected",D),o(co.UNITY.VIDEO_PLAY,{category:lo.MEDIA_INTERACTION,videoId:D==null?void 0:D.gameObjectName,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),y=u("PlayMediaScreenVideo",D=>{W.log(" Unity Analytics: Media screen click event detected",D),o(co.UNITY.MEDIA_SCREEN_CLICK,{category:lo.MEDIA_INTERACTION,mediaScreenId:D==null?void 0:D.mediaScreenId,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),v=u("OpenNameplateModal",D=>{W.log(" Unity Analytics: Nameplate click event detected",D),o(co.UNITY.NAMEPLATE_CLICK,{category:lo.SOCIAL_INTERACTION,targetUserId:D==null?void 0:D.uid,targetPlayerName:D==null?void 0:D.playerName,targetPlayerId:D==null?void 0:D.playerId,isLocalPlayer:(D==null?void 0:D.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...D})}),w=u("PlayerInstantiated",D=>{W.log(" Unity Analytics: Player spawn event detected",D),o(co.UNITY.PLAYER_SPAWN,{category:lo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),C=u("FirstSceneLoaded",D=>{W.log(" Unity Analytics: First scene loaded event detected",D),o(co.UNITY.SPACE_READY,{category:lo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),R=u("SeatingHotspotClicked",D=>{W.log(" Unity Analytics: Catalogue item click event detected",D),o(co.UNITY.OBJECT_INTERACT,{category:lo.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:D==null?void 0:D.hotspotId,itemId:D==null?void 0:D.itemId,position:D==null?void 0:D.position,timestamp:new Date().toISOString(),...D})}),N=u("UpdatePlayerList",D=>{D!=null&&D.players&&Array.isArray(D.players)&&(W.log(" Unity Analytics: Player list update event detected",D),o(co.UNITY.PLAYER_MOVE,{category:lo.SOCIAL_INTERACTION,activePlayerCount:D.players.length,playerList:D.players.map(F=>({playerId:F.playerId,playerName:F.playerName,isLocalPlayer:F.isLocalPlayer})),timestamp:new Date().toISOString()}))}),M=u("RequestUserForUnity",D=>{W.log(" Unity Analytics: Unity user request event detected",D),o(co.UNITY.SPACE_LOAD,{category:lo.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...D})});return()=>{W.log(" Unity Analytics: Cleaning up event listeners"),p(),y(),v(),w(),C(),R(),N(),M()}},[l,i,o,u]),{isReady:l,trackUnityEvent:o}},g9e="a2a7f4eb05284449b1063eb71d8301dc",fV=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),J3=O.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=Io(),u=bWe();TWe();const p=pc(),y=WWe(u),{user:v}=O.useContext(ts),[w,C]=O.useState(!1),[R,N]=O.useState(window.devicePixelRatio),[M,D]=wWe();Lae().find(dt=>dt.isLocalPlayer);const[z,q]=O.useState(!0),[K,re]=O.useState(!0),ce=n.spaceID||"default";BWe(),FWe(ce),m9e(ce,{enableDebugLogs:!0});const{trackUnityEvent:se}=_E(ce,{enableDebugLogs:!0}),[ge,X]=O.useState(!1),[J,te]=O.useState(!1),[ne,de]=O.useState(!1),pe=O.useMemo(()=>{const ct=new URLSearchParams(window.location.search).get("sessionId")||ce;return console.log("WebGLRenderer: Using session ID:",ct),ct},[ce]),[he,ve]=O.useState(null);O.useEffect(()=>{v!=null&&v.uid&&ou(v.uid).then(dt=>{ve(dt),console.log("WebGLRenderer: User profile loaded:",(dt==null?void 0:dt.Nickname)||"Unknown")}).catch(dt=>{console.error("Error fetching user profile:",dt)})},[v==null?void 0:v.uid]),O.useEffect(()=>{const dt=async()=>{if(l){console.log("WebGLRenderer: Unity error, showing sign-in modal"),te(!0),de(!0);return}if(v){te(!1);return}try{const ct=await Ua(ce);ct&&ct.allowGuestUsers===!0?(console.log("WebGLRenderer: Guest users confirmed allowed, not showing sign-in modal"),te(!1)):(console.log("WebGLRenderer: Guest users not allowed or space data invalid, showing sign-in modal"),te(!0),de(!0))}catch{console.log("WebGLRenderer: Cannot verify space guest access, showing sign-in modal for security"),te(!0),de(!0)}},mt=setTimeout(()=>{dt()},1e3);return()=>clearTimeout(mt)},[l,v,ce]),O.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const dt=()=>{console.log("WebGLRenderer: Player instantiated event received"),re(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),re(!0)),lh.subscribe(ch.playerInstantiated,dt);const mt=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),re(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{lh.unsubscribe(ch.playerInstantiated,dt),clearTimeout(mt)}},[K]),O.useEffect(()=>{const dt=()=>{console.log("WebGLRenderer: Modal opened"),de(!0)},mt=()=>{console.log("WebGLRenderer: Modal closed"),de(!1)};return window.addEventListener("modal-opened",dt),window.addEventListener("modal-closed",mt),()=>{window.removeEventListener("modal-opened",dt),window.removeEventListener("modal-closed",mt)}},[]),O.useEffect(()=>{de(M!==null)},[M]),O.useEffect(()=>{o||u?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),O.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(dt){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",dt)}},1e3)},[o,i]),O.useEffect(()=>{const dt=document.getElementById("webgl-root");return dt?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),dt.style.display="block",dt.getAttribute("data-space-id")!==ce&&(dt.setAttribute("data-space-id",ce),console.log(`WebGLRenderer: Set data-space-id attribute to ${ce}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ce]),O.useEffect(()=>{const dt=()=>{const Ft=fV();Ft?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ft.tabIndex=1,Ft.style.outline="none",Ft.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ne||XS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};dt();const mt=setTimeout(dt,1e3),ct=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),dt()};return window.addEventListener("unityReady",ct),()=>{clearTimeout(mt),window.removeEventListener("unityReady",ct)}},[o,ne]);const Te=O.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ne||XS(!0)},[ne]);O.useEffect(()=>{if(o&&i){const dt=fV();if(dt)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),dt.addEventListener("click",Te),()=>{dt.removeEventListener("click",Te)}}},[o,i,Te]),O.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const dt=mt=>{if(ne){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(mt.target.tagName==="INPUT"||mt.target.tagName==="TEXTAREA"||mt.target.tagName==="SELECT"||mt.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(mt.target.closest(".chakra-modal__content")||mt.target.closest('[role="dialog"]')||mt.target.closest('[role="menu"]')||mt.target.closest(".chakra-popover__content")||mt.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ct=fV();if(ct&&(mt.target===ct||ct.contains(mt.target)))return;if(mt.target.closest(".webgl-overlay")||mt.target.closest(".game-ui")||mt.target.closest(".player-list")||mt.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ne||XS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ct&&!ne&&((ct.tabIndex===void 0||ct.tabIndex<0)&&(ct.tabIndex=1),ct.focus(),XS(!0))},50)};return document.addEventListener("click",dt,!0),()=>{document.removeEventListener("click",dt,!0)}}},[o,i,ne]),O.useEffect(()=>{const dt=mt=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),console.log("WebGLRenderer: Sending to Unity via 'FirebaseUserFromReact':",mt),console.log("WebGLRenderer: User data keys:",Object.keys(mt)),console.log("WebGLRenderer: RPM URL being sent:",mt.rpmURL),console.log("WebGLRenderer: Nickname being sent:",mt.Nickname),console.log("WebGLRenderer: Username being sent:",mt.username),console.log("WebGLRenderer: Is Guest:",mt.isGuest),console.log("WebGLRenderer: UID:",mt.uid),console.log("WebGLRenderer: JSON data being sent to Unity:",JSON.stringify(mt,null,2)),p("FirebaseUserFromReact",mt)};return lh.subscribe(ch.sendUserToUnity,dt),()=>lh.unsubscribe(ch.sendUserToUnity,dt)},[p]);const{setFullscreenRef:Fe,fullscreenRef:be}=fh();O.useEffect(()=>{Fe(e.current)},[e,Fe]);const Re=()=>{q(!z)},Ae=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ae,sessionId:pe}),O.useEffect(()=>{const dt=mt=>{console.log("Edit mode changed event:",mt.detail),X(mt.detail.enabled)};return window.addEventListener("editModeChanged",dt),()=>{window.removeEventListener("editModeChanged",dt)}},[]),Dae(),AWe();const xe=O.useRef(null),{clickedPortal:Ee,clearClickedPortal:Ne}=jWe(),[je,qe]=O.useState(!1),[at,_t]=O.useState(!1),[ut,vt]=O.useState(""),[it,wt]=O.useState("");O.useEffect(()=>{async function dt(){if(vt(""),wt(""),Ee&&!ge){let mt=Ee.targetSpaceId;if(!mt&&Ee.portalId)try{const ct=br(Xn,"spaces",ce,"portals",Ee.portalId),Ft=await Ko(ct);Ft.exists()&&(mt=Ft.data().targetSpaceId)}catch{}if(mt)try{const ct=await Ua(mt);vt((ct==null?void 0:ct.name)||mt),wt((ct==null?void 0:ct.slug)||""),_t(!0)}catch{vt(mt),wt(""),_t(!0)}else vt(""),wt(""),_t(!0)}}Ee&&ge&&qe(!0),Ee&&!ge&&dt()},[Ee,ge,ce]);const $t=()=>{console.log("Closing portal editor"),qe(!1),Ne()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:je,clickedPortal:Ee,isEditMode:ge}),zWe(ce),Fae(),S.jsxs(st,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(tce,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:xe}),!J&&S.jsx(nce,{containerRef:xe}),J&&S.jsx(st,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(W0,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(f9e,{spaceId:ce,isEditMode:ge}),S.jsx(_j,{containerRef:be.current?be:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[S.jsxs(st,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[S.jsx(HWe,{}),v&&S.jsx(o9e,{size:"md"}),Ae&&S.jsxs(Xae,{appId:g9e,channel:pe,uid:v==null?void 0:v.uid,enabled:!0,children:[S.jsx(bGe,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(TGe,{userNickname:he==null?void 0:he.Nickname})]}),S.jsx(lGe,{}),S.jsx(st,{position:"relative",zIndex:"9999",children:S.jsx(qGe,{onTogglePlayerList:Re,spaceID:ce,containerRef:xe})})]}),S.jsxs(st,{ref:xe,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx(st,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx(st,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i&&!J?S.jsx(Nae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:R,tabIndex:1}):S.jsx(st,{width:"100%",height:"100%",backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center",children:J&&S.jsx(Ke,{color:"white",fontSize:"lg",children:"Authentication Required"})})}),S.jsx(st,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(GWe,{})})]}),S.jsx(st,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(bp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsxs(st,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx($We,{}),S.jsx(hGe,{})]}),S.jsx(pGe,{}),S.jsx(fGe,{isOpen:M!==null,onClose:()=>{console.log(" Closing nameplate modal"),D()},playerName:(M==null?void 0:M.playerName)||"Unknown Player",playerId:(M==null?void 0:M.playerId)||"Unknown ID"}),S.jsx(mGe,{isVisible:z,onToggleVisibility:q,spaceID:ce}),S.jsx(s9e,{}),S.jsx(st,{position:"absolute",top:4,right:4,zIndex:1e3,children:je&&Ee&&S.jsx(c9e,{isOpen:je,onClose:$t,portal:Ee,spaceId:ce})}),!ge&&at&&S.jsxs(us,{isOpen:at,onClose:()=>{_t(!1),Ne(),vt(""),wt("")},isCentered:!0,children:[S.jsx(hs,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(ds,{bg:"#1a1a1a",borderRadius:"xl",border:"1px solid #333",maxW:"420px",p:0,children:[S.jsx(fo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",textAlign:"center",children:ut?`Visit ${ut}?`:"Visit Space?"}),S.jsx(Os,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(ys,{pb:8,pt:2,px:8,children:S.jsxs(Mr,{mt:4,gap:6,justify:"center",children:[S.jsx(In,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{_t(!1),Ne(),vt(""),wt("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),S.jsx(In,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(Ee&&v){let dt=null;if(Ee.portalId){const mt=Ee.portalId.split("_");mt.length>=3&&(dt=mt[2])}await se(co.UNITY.PORTAL_NAVIGATE,{category:lo.NAVIGATION,portalId:Ee.portalId,targetSpaceId:dt,sourceSpaceId:ce,targetSpaceName:ut,targetSpaceSlug:it,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",Ee.portalId,"",dt)}it&&window.open(`https://www.spacesmetaverse.com/w/${it}`,"_blank","noopener"),_t(!1),Ne(),vt(""),wt("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),S.jsx(d9e,{})]})})]})});J3.displayName="WebGLRenderer";J3.propTypes={settings:Tn.shape({urlLoadingBackground:Tn.string,videoBackgroundUrl:Tn.string,showAuthButton:Tn.bool,showDisruptiveLogo:Tn.bool,urlDisruptiveLogo:Tn.string,showHelpButton:Tn.bool,enableVoiceChat:Tn.bool,spaceID:Tn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(W.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),W.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const Q3=({spaceID:n,overrideSettings:e})=>{const i=O.useRef(null),[o,l]=O.useState(!0),{loading:u,isUserBannedFromSpace:p,user:y}=O.useContext(ts),[v,w]=O.useState(!1),[C,R]=O.useState(!1),[N,M]=O.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[D,F]=O.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return O.useEffect(()=>{(async()=>{try{const q=await Ua(n);if(q){if(console.log("Space data: ",q),console.log("WebGLLoader: Current user state:",y?"authenticated":"not authenticated"),console.log("WebGLLoader: allowGuestUsers setting:",q.allowGuestUsers),!y&&(!q.allowGuestUsers||q.allowGuestUsers!==!0)){console.log("WebGLLoader:  AUTHENTICATION REQUIRED - guest users not allowed"),console.log("WebGLLoader:  BLOCKING UNITY INITIALIZATION"),R(!0),l(!1);return}else!y&&q.allowGuestUsers===!0?(console.log("WebGLLoader:  Guest users allowed, proceeding with Unity load"),R(!1)):y&&(console.log("WebGLLoader:  User authenticated, proceeding with Unity load"),R(!1));M(se=>({...se,spaceID:n,loaderUrl:q.loaderUrl,dataUrl:q.dataUrl,frameworkUrl:q.frameworkUrl,codeUrl:q.codeUrl}));const K=await Xk(D.urlDisruptiveLogo);let re="";if(q.backgroundUrl)re=q.backgroundUrl;else if(q.backgroundGsUrl)try{re=await Xk(q.backgroundGsUrl)}catch(se){W.warn("WebGLLoader: Error fetching background from GS URL:",se)}else if(q.gsUrlLoadingBackground)try{re=await Xk(q.gsUrlLoadingBackground)}catch(se){W.warn("WebGLLoader: Error fetching background from legacy GS URL:",se)}let ce="";q.videoBackgroundUrl&&(ce=q.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",ce)),F(se=>({...se,urlLoadingBackground:re,videoBackgroundUrl:ce,showAuthButton:q.showAuthButton!==void 0?q.showAuthButton:!0,showDisruptiveLogo:q.showDisruptiveLogo!==void 0?q.showDisruptiveLogo:!0,showHelpButton:q.showHelpButton!==void 0?q.showHelpButton:!0,enableVoiceChat:q.enableVoiceChat!==void 0?q.enableVoiceChat:!0,urlDisruptiveLogo:K,spaceID:n,...e||{}})),ce&&(console.log("WebGLLoader: Dispatching video background event with URL:",ce),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:ce}}))),l(!1)}else W.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(q){W.error("WebGLLoader: Error fetching space data:",q)}finally{l(!1)}})()},[n,D.urlDisruptiveLogo,e,y]),O.useEffect(()=>{(async()=>{if(!u&&y&&p)try{const q=await p(n);w(q)}catch(q){W.error("WebGLLoader: ban check error",q)}})()},[u,y,n,p]),O.useEffect(()=>{o||(W.log("WebGLLoader: Unity config from Firebase",N),W.log("WebGLLoader: Space settings from Firebase",D))},[o]),u?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):v?S.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):C?S.jsx(st,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:"1000",children:S.jsx(W0,{mode:"button",label:"Sign In Required",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}):n?S.jsx(S.Fragment,{children:o?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(SWe,{...N,children:S.jsx(J3,{ref:i,settings:D})})}):null};Q3.propTypes={spaceID:Tn.string.isRequired,overrideSettings:Tn.object};function CZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,u]=O.useState(null);return O.useEffect(()=>{pR(i).then(u)},[]),l?S.jsx(hN,{theme:l,children:S.jsx(nx,{children:S.jsx(W3,{children:S.jsx(Q3,{spaceID:e})})})}):S.jsx("div",{children:"Loading theme..."})};try{$O.createRoot(n).render(S.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",CZ):CZ());const _9e=(n,e)=>{try{const i=bl(Xn,`spaces/${n}/chatMessages`),o=new Date,l=UO(i,a6e("timestamp","asc"),l6e(o));return Goe(l,u=>{const p=[];u.docChanges().forEach(y=>{if(y.type==="added"){const v=y.doc.data();console.log("Firestore document data:",v),p.push({id:y.doc.id,...v})}}),p.length>0&&e(p)})}catch(i){throw W.error("Error subscribing to space chat messages:",i),i}};function mh(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function cE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const rce=6048e5,y9e=864e5;let E9e={};function ax(){return E9e}function TR(n,e){var y,v,w,C;const i=ax(),o=(e==null?void 0:e.weekStartsOn)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.weekStartsOn)??i.weekStartsOn??((C=(w=i.locale)==null?void 0:w.options)==null?void 0:C.weekStartsOn)??0,l=mh(n),u=l.getDay(),p=(u<o?7:0)+u-o;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function HO(n){return TR(n,{weekStartsOn:1})}function ice(n){const e=mh(n),i=e.getFullYear(),o=cE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=HO(o),u=cE(n,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const p=HO(u);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function RZ(n){const e=mh(n);return e.setHours(0,0,0,0),e}function IZ(n){const e=mh(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function v9e(n,e){const i=RZ(n),o=RZ(e),l=+i-IZ(i),u=+o-IZ(o);return Math.round((l-u)/y9e)}function S9e(n){const e=ice(n),i=cE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),HO(i)}function b9e(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function w9e(n){if(!b9e(n)&&typeof n!="number")return!1;const e=mh(n);return!isNaN(Number(e))}function T9e(n){const e=mh(n),i=cE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const C9e={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},R9e=(n,e,i)=>{let o;const l=C9e[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function mV(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const I9e={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},A9e={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},P9e={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},k9e={date:mV({formats:I9e,defaultWidth:"full"}),time:mV({formats:A9e,defaultWidth:"full"}),dateTime:mV({formats:P9e,defaultWidth:"full"})},O9e={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},N9e=(n,e,i,o)=>O9e[n];function rC(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,y=i!=null&&i.width?String(i.width):p;l=n.formattingValues[y]||n.formattingValues[p]}else{const p=n.defaultWidth,y=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[y]||n.values[p]}const u=n.argumentCallback?n.argumentCallback(e):e;return l[u]}}const x9e={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},D9e={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},L9e={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},M9e={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},U9e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},V9e={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},F9e=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},j9e={ordinalNumber:F9e,era:rC({values:x9e,defaultWidth:"wide"}),quarter:rC({values:D9e,defaultWidth:"wide",argumentCallback:n=>n-1}),month:rC({values:L9e,defaultWidth:"wide"}),day:rC({values:M9e,defaultWidth:"wide"}),dayPeriod:rC({values:U9e,defaultWidth:"wide",formattingValues:V9e,defaultFormattingWidth:"wide"})};function iC(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],u=e.match(l);if(!u)return null;const p=u[0],y=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],v=Array.isArray(y)?z9e(y,R=>R.test(p)):B9e(y,R=>R.test(p));let w;w=n.valueCallback?n.valueCallback(v):v,w=i.valueCallback?i.valueCallback(w):w;const C=e.slice(p.length);return{value:w,rest:C}}}function B9e(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function z9e(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function W9e(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],u=e.match(n.parsePattern);if(!u)return null;let p=n.valueCallback?n.valueCallback(u[0]):u[0];p=i.valueCallback?i.valueCallback(p):p;const y=e.slice(l.length);return{value:p,rest:y}}}const G9e=/^(\d+)(th|st|nd|rd)?/i,H9e=/\d+/i,$9e={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},K9e={any:[/^b/i,/^(a|c)/i]},q9e={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Y9e={any:[/1/i,/2/i,/3/i,/4/i]},X9e={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},J9e={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Q9e={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Z9e={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},eHe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},tHe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},nHe={ordinalNumber:W9e({matchPattern:G9e,parsePattern:H9e,valueCallback:n=>parseInt(n,10)}),era:iC({matchPatterns:$9e,defaultMatchWidth:"wide",parsePatterns:K9e,defaultParseWidth:"any"}),quarter:iC({matchPatterns:q9e,defaultMatchWidth:"wide",parsePatterns:Y9e,defaultParseWidth:"any",valueCallback:n=>n+1}),month:iC({matchPatterns:X9e,defaultMatchWidth:"wide",parsePatterns:J9e,defaultParseWidth:"any"}),day:iC({matchPatterns:Q9e,defaultMatchWidth:"wide",parsePatterns:Z9e,defaultParseWidth:"any"}),dayPeriod:iC({matchPatterns:eHe,defaultMatchWidth:"any",parsePatterns:tHe,defaultParseWidth:"any"})},rHe={code:"en-US",formatDistance:R9e,formatLong:k9e,formatRelative:N9e,localize:j9e,match:nHe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function iHe(n){const e=mh(n);return v9e(e,T9e(e))+1}function sHe(n){const e=mh(n),i=+HO(e)-+S9e(e);return Math.round(i/rce)+1}function sce(n,e){var C,R,N,M;const i=mh(n),o=i.getFullYear(),l=ax(),u=(e==null?void 0:e.firstWeekContainsDate)??((R=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:R.firstWeekContainsDate)??l.firstWeekContainsDate??((M=(N=l.locale)==null?void 0:N.options)==null?void 0:M.firstWeekContainsDate)??1,p=cE(n,0);p.setFullYear(o+1,0,u),p.setHours(0,0,0,0);const y=TR(p,e),v=cE(n,0);v.setFullYear(o,0,u),v.setHours(0,0,0,0);const w=TR(v,e);return i.getTime()>=y.getTime()?o+1:i.getTime()>=w.getTime()?o:o-1}function oHe(n,e){var y,v,w,C;const i=ax(),o=(e==null?void 0:e.firstWeekContainsDate)??((v=(y=e==null?void 0:e.locale)==null?void 0:y.options)==null?void 0:v.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(w=i.locale)==null?void 0:w.options)==null?void 0:C.firstWeekContainsDate)??1,l=sce(n,e),u=cE(n,0);return u.setFullYear(l,0,o),u.setHours(0,0,0,0),TR(u,e)}function aHe(n,e){const i=mh(n),o=+TR(i,e)-+oHe(i,e);return Math.round(o/rce)+1}function Ai(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const fg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ai(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ai(i+1,2)},d(n,e){return Ai(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ai(n.getHours()%12||12,e.length)},H(n,e){return Ai(n.getHours(),e.length)},m(n,e){return Ai(n.getMinutes(),e.length)},s(n,e){return Ai(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ai(l,e.length)}},NS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},AZ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return fg.y(n,e)},Y:function(n,e,i,o){const l=sce(n,o),u=l>0?l:1-l;if(e==="YY"){const p=u%100;return Ai(p,2)}return e==="Yo"?i.ordinalNumber(u,{unit:"year"}):Ai(u,e.length)},R:function(n,e){const i=ice(n);return Ai(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ai(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ai(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ai(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return fg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ai(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=aHe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ai(l,e.length)},I:function(n,e,i){const o=sHe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ai(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):fg.d(n,e)},D:function(n,e,i){const o=iHe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ai(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return Ai(u,2);case"eo":return i.ordinalNumber(u,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return Ai(u,e.length);case"co":return i.ordinalNumber(u,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ai(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=NS.noon:o===0?l=NS.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=NS.evening:o>=12?l=NS.afternoon:o>=4?l=NS.morning:l=NS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return fg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):fg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ai(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ai(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):fg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):fg.s(n,e)},S:function(n,e){return fg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return kZ(o);case"XXXX":case"XX":return ky(o);case"XXXXX":case"XXX":default:return ky(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return kZ(o);case"xxxx":case"xx":return ky(o);case"xxxxx":case"xxx":default:return ky(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+PZ(o,":");case"OOOO":default:return"GMT"+ky(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+PZ(o,":");case"zzzz":default:return"GMT"+ky(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ai(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ai(o,e.length)}};function PZ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),u=o%60;return u===0?i+String(l):i+String(l)+e+Ai(u,2)}function kZ(n,e){return n%60===0?(n>0?"-":"+")+Ai(Math.abs(n)/60,2):ky(n,e)}function ky(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ai(Math.trunc(o/60),2),u=Ai(o%60,2);return i+l+e+u}const OZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},oce=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},cHe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return OZ(n,e);let u;switch(o){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",OZ(o,e)).replace("{{time}}",oce(l,e))},lHe={p:oce,P:cHe},uHe=/^D+$/,dHe=/^Y+$/,hHe=["D","DD","YY","YYYY"];function pHe(n){return uHe.test(n)}function fHe(n){return dHe.test(n)}function mHe(n,e,i){const o=gHe(n,e,i);if(console.warn(o),hHe.includes(n))throw new RangeError(o)}function gHe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const _He=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,yHe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,EHe=/^'([^]*?)'?$/,vHe=/''/g,SHe=/[a-zA-Z]/;function bHe(n,e,i){var C,R,N,M;const o=ax(),l=o.locale??rHe,u=o.firstWeekContainsDate??((R=(C=o.locale)==null?void 0:C.options)==null?void 0:R.firstWeekContainsDate)??1,p=o.weekStartsOn??((M=(N=o.locale)==null?void 0:N.options)==null?void 0:M.weekStartsOn)??0,y=mh(n);if(!w9e(y))throw new RangeError("Invalid time value");let v=e.match(yHe).map(D=>{const F=D[0];if(F==="p"||F==="P"){const z=lHe[F];return z(D,l.formatLong)}return D}).join("").match(_He).map(D=>{if(D==="''")return{isToken:!1,value:"'"};const F=D[0];if(F==="'")return{isToken:!1,value:wHe(D)};if(AZ[F])return{isToken:!0,value:D};if(F.match(SHe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:D}});l.localize.preprocessor&&(v=l.localize.preprocessor(y,v));const w={firstWeekContainsDate:u,weekStartsOn:p,locale:l};return v.map(D=>{if(!D.isToken)return D.value;const F=D.value;(fHe(F)||pHe(F))&&mHe(F,e,String(n));const z=AZ[F[0]];return z(y,F,l.localize,w)}).join("")}function wHe(n){const e=n.match(EHe);return e?e[1].replace(vHe,"'"):n}const THe=Up(st),ace=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?bHe(e.toDate(),"HH:mm"):"Invalid date";return S.jsxs(THe,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsxs(st,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[S.jsx(Ke,{fontWeight:"bold",children:n}),S.jsx(Ke,{children:i})]}),S.jsx(Ke,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};ace.propTypes={name:Tn.string.isRequired,timestamp:Tn.object,text:Tn.string.isRequired,isCurrentUser:Tn.bool.isRequired};const CHe=({spaceID:n})=>{const[e,i]=O.useState([]),{user:o}=O.useContext(ts),l=O.useRef(null);return O.useEffect(()=>{const u=_9e(n,p=>{console.log("New messages received:",p),i(y=>[...y,...p]),W.log("Messages updated:",p)});return()=>u()},[n]),O.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),S.jsxs(st,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(u=>{const p=u.uid===(o==null?void 0:o.uid);return S.jsx(ace,{name:u.user,timestamp:u.timestamp,text:u.text,isCurrentUser:p},u.id)}),S.jsx("div",{ref:l})]})},RHe=({spaceID:n})=>{},cce=({spaceID:n})=>{const{user:e}=O.useContext(ts);return e?S.jsxs(st,{children:[S.jsx(st,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:S.jsx(CHe,{spaceID:n})}),S.jsx(st,{mt:"8px",children:S.jsx(RHe,{spaceID:n})})]}):(console.log("No user found, returning login message"),S.jsx(st,{children:S.jsx(Ke,{children:"Please log in to view the chat."})}))},gk=document.getElementById("chat-root");if(gk){const n=gk.getAttribute("data-space-id"),e=gk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=O.useState(null);return O.useEffect(()=>{pR(e).then(l)},[]),o?S.jsx(hN,{theme:o,children:S.jsx(nx,{children:S.jsx(cce,{spaceID:n})})}):S.jsx("div",{children:"Loading theme..."})};$O.createRoot(gk).render(S.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class IHe extends O.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?S.jsx(st,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:S.jsx(Ke,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const _k=document.getElementById("root");if(_k){const n=_k.getAttribute("data-space-id"),e=_k.getAttribute("data-theme")||"default",i=()=>{const[o,l]=O.useState(null);return O.useEffect(()=>{pR(e).then(l);const u=()=>{document.hidden||pR(e).then(l)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),o?S.jsx(hN,{theme:o,children:S.jsx(nx,{children:S.jsx(W3,{children:S.jsxs(Rr,{spacing:4,align:"stretch",children:[S.jsxs(Mr,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[S.jsx(Ke,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),S.jsx(st,{zIndex:"100",position:"relative",children:S.jsx(kae,{})})]}),S.jsx(QV,{maxW:"container.xl",p:0,zIndex:"1",children:S.jsx(Mne,{ratio:16/9,bg:"blue.100",m:0,children:S.jsx(st,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:S.jsx(IHe,{children:S.jsx(Q3,{spaceID:n})})})})}),S.jsx(QV,{maxW:"container.xl",p:0,children:S.jsx(cce,{spaceID:n})})]})})})}):S.jsx("div",{children:"Loading theme..."})};$O.createRoot(_k).render(S.jsx(i,{}))}else console.error("Root element 'root' not found.");export{uve as a,M0e as b,es as c,x0e as d,PHe as e,AHe as f,C0e as g,ed as i,Sp as m,DIe as t};
